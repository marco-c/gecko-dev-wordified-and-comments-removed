'
use
strict
'
;
const
{
asyncWindowLeakTest
}
=
require
(
"
.
/
leak
-
utils
"
)
;
const
{
Loader
}
=
require
(
'
sdk
/
test
/
loader
'
)
;
const
openWindow
=
require
(
"
sdk
/
window
/
utils
"
)
.
open
;
exports
[
"
test
sdk
/
event
/
dom
does
not
leak
when
attached
to
closed
window
"
]
=
function
*
(
assert
)
{
yield
asyncWindowLeakTest
(
assert
_
=
>
{
return
new
Promise
(
resolve
=
>
{
let
loader
=
Loader
(
module
)
;
let
{
open
}
=
loader
.
require
(
'
sdk
/
event
/
dom
'
)
;
let
w
=
openWindow
(
)
;
w
.
addEventListener
(
"
DOMWindowClose
"
function
windowClosed
(
evt
)
{
w
.
removeEventListener
(
"
DOMWindowClose
"
windowClosed
)
;
open
(
w
.
document
"
TestEvent1
"
)
;
resolve
(
loader
)
;
}
)
;
w
.
close
(
)
;
}
)
;
}
)
;
}
require
(
"
sdk
/
test
"
)
.
run
(
exports
)
;
