#
include
"
mozilla
/
scache
/
StartupCacheParent
.
h
"
#
include
"
mozilla
/
scache
/
StartupCache
.
h
"
#
include
"
mozilla
/
dom
/
ContentParent
.
h
"
namespace
mozilla
{
namespace
scache
{
IPCResult
StartupCacheParent
:
:
Recv__delete__
(
nsTArray
<
EntryData
>
&
&
entries
)
{
if
(
!
mWantCacheData
&
&
entries
.
Length
(
)
)
{
return
IPC_FAIL
(
this
"
UnexpectedScriptData
"
)
;
}
mWantCacheData
=
false
;
if
(
entries
.
Length
(
)
)
{
auto
*
cache
=
StartupCache
:
:
GetSingleton
(
)
;
for
(
auto
&
entry
:
entries
)
{
auto
buffer
=
MakeUnique
<
char
[
]
>
(
entry
.
data
(
)
.
Length
(
)
)
;
memcpy
(
buffer
.
get
(
)
entry
.
data
(
)
.
Elements
(
)
entry
.
data
(
)
.
Length
(
)
)
;
cache
-
>
PutBuffer
(
entry
.
key
(
)
.
get
(
)
std
:
:
move
(
buffer
)
entry
.
data
(
)
.
Length
(
)
true
)
;
}
}
return
IPC_OK
(
)
;
}
void
StartupCacheParent
:
:
ActorDestroy
(
ActorDestroyReason
aWhy
)
{
}
}
}
