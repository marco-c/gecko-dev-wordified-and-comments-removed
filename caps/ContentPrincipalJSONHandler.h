#
ifndef
mozilla_ContentPrincipalJSONHandler_h
#
define
mozilla_ContentPrincipalJSONHandler_h
#
include
<
stddef
.
h
>
#
include
<
stdint
.
h
>
#
include
"
js
/
TypeDecls
.
h
"
#
include
"
mozilla
/
RefPtr
.
h
"
#
include
"
nsCOMPtr
.
h
"
#
include
"
nsDebug
.
h
"
#
include
"
nsIURI
.
h
"
#
include
"
ContentPrincipal
.
h
"
#
include
"
OriginAttributes
.
h
"
#
include
"
SharedJSONHandler
.
h
"
namespace
mozilla
{
class
ContentPrincipalJSONHandler
:
public
PrincipalJSONHandlerShared
{
enum
class
State
{
Init
StartObject
URIKey
DomainKey
SuffixKey
AfterPropertyValue
EndObject
Error
}
;
public
:
ContentPrincipalJSONHandler
(
)
=
default
;
virtual
~
ContentPrincipalJSONHandler
(
)
=
default
;
virtual
bool
startObject
(
)
override
;
using
PrincipalJSONHandlerShared
:
:
propertyName
;
virtual
bool
propertyName
(
const
JS
:
:
Latin1Char
*
name
size_t
length
)
override
;
virtual
bool
endObject
(
)
override
;
virtual
bool
startArray
(
)
override
{
NS_WARNING
(
"
Unexpected
array
value
"
)
;
mState
=
State
:
:
Error
;
return
false
;
}
virtual
bool
endArray
(
)
override
{
NS_WARNING
(
"
Unexpected
array
value
"
)
;
mState
=
State
:
:
Error
;
return
false
;
}
using
PrincipalJSONHandlerShared
:
:
stringValue
;
virtual
bool
stringValue
(
const
JS
:
:
Latin1Char
*
str
size_t
length
)
override
;
bool
HasAccepted
(
)
const
{
return
mState
=
=
State
:
:
EndObject
;
}
protected
:
virtual
void
SetErrorState
(
)
override
{
mState
=
State
:
:
Error
;
}
private
:
State
mState
=
State
:
:
Init
;
nsCOMPtr
<
nsIURI
>
mPrincipalURI
;
nsCOMPtr
<
nsIURI
>
mDomain
;
OriginAttributes
mAttrs
;
}
;
}
#
endif
