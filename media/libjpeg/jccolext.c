INLINE
LOCAL
(
void
)
rgb_ycc_convert_internal
(
j_compress_ptr
cinfo
_JSAMPARRAY
input_buf
_JSAMPIMAGE
output_buf
JDIMENSION
output_row
int
num_rows
)
{
#
if
BITS_IN_JSAMPLE
!
=
16
my_cconvert_ptr
cconvert
=
(
my_cconvert_ptr
)
cinfo
-
>
cconvert
;
register
int
r
g
b
;
register
JLONG
*
ctab
=
cconvert
-
>
rgb_ycc_tab
;
register
_JSAMPROW
inptr
;
register
_JSAMPROW
outptr0
outptr1
outptr2
;
register
JDIMENSION
col
;
JDIMENSION
num_cols
=
cinfo
-
>
image_width
;
while
(
-
-
num_rows
>
=
0
)
{
inptr
=
*
input_buf
+
+
;
outptr0
=
output_buf
[
0
]
[
output_row
]
;
outptr1
=
output_buf
[
1
]
[
output_row
]
;
outptr2
=
output_buf
[
2
]
[
output_row
]
;
output_row
+
+
;
for
(
col
=
0
;
col
<
num_cols
;
col
+
+
)
{
r
=
RANGE_LIMIT
(
inptr
[
RGB_RED
]
)
;
g
=
RANGE_LIMIT
(
inptr
[
RGB_GREEN
]
)
;
b
=
RANGE_LIMIT
(
inptr
[
RGB_BLUE
]
)
;
inptr
+
=
RGB_PIXELSIZE
;
outptr0
[
col
]
=
(
_JSAMPLE
)
(
(
ctab
[
r
+
R_Y_OFF
]
+
ctab
[
g
+
G_Y_OFF
]
+
ctab
[
b
+
B_Y_OFF
]
)
>
>
SCALEBITS
)
;
outptr1
[
col
]
=
(
_JSAMPLE
)
(
(
ctab
[
r
+
R_CB_OFF
]
+
ctab
[
g
+
G_CB_OFF
]
+
ctab
[
b
+
B_CB_OFF
]
)
>
>
SCALEBITS
)
;
outptr2
[
col
]
=
(
_JSAMPLE
)
(
(
ctab
[
r
+
R_CR_OFF
]
+
ctab
[
g
+
G_CR_OFF
]
+
ctab
[
b
+
B_CR_OFF
]
)
>
>
SCALEBITS
)
;
}
}
#
else
ERREXIT
(
cinfo
JERR_CONVERSION_NOTIMPL
)
;
#
endif
}
INLINE
LOCAL
(
void
)
rgb_gray_convert_internal
(
j_compress_ptr
cinfo
_JSAMPARRAY
input_buf
_JSAMPIMAGE
output_buf
JDIMENSION
output_row
int
num_rows
)
{
#
if
BITS_IN_JSAMPLE
!
=
16
my_cconvert_ptr
cconvert
=
(
my_cconvert_ptr
)
cinfo
-
>
cconvert
;
register
int
r
g
b
;
register
JLONG
*
ctab
=
cconvert
-
>
rgb_ycc_tab
;
register
_JSAMPROW
inptr
;
register
_JSAMPROW
outptr
;
register
JDIMENSION
col
;
JDIMENSION
num_cols
=
cinfo
-
>
image_width
;
while
(
-
-
num_rows
>
=
0
)
{
inptr
=
*
input_buf
+
+
;
outptr
=
output_buf
[
0
]
[
output_row
]
;
output_row
+
+
;
for
(
col
=
0
;
col
<
num_cols
;
col
+
+
)
{
r
=
RANGE_LIMIT
(
inptr
[
RGB_RED
]
)
;
g
=
RANGE_LIMIT
(
inptr
[
RGB_GREEN
]
)
;
b
=
RANGE_LIMIT
(
inptr
[
RGB_BLUE
]
)
;
inptr
+
=
RGB_PIXELSIZE
;
outptr
[
col
]
=
(
_JSAMPLE
)
(
(
ctab
[
r
+
R_Y_OFF
]
+
ctab
[
g
+
G_Y_OFF
]
+
ctab
[
b
+
B_Y_OFF
]
)
>
>
SCALEBITS
)
;
}
}
#
else
ERREXIT
(
cinfo
JERR_CONVERSION_NOTIMPL
)
;
#
endif
}
INLINE
LOCAL
(
void
)
rgb_rgb_convert_internal
(
j_compress_ptr
cinfo
_JSAMPARRAY
input_buf
_JSAMPIMAGE
output_buf
JDIMENSION
output_row
int
num_rows
)
{
register
_JSAMPROW
inptr
;
register
_JSAMPROW
outptr0
outptr1
outptr2
;
register
JDIMENSION
col
;
JDIMENSION
num_cols
=
cinfo
-
>
image_width
;
while
(
-
-
num_rows
>
=
0
)
{
inptr
=
*
input_buf
+
+
;
outptr0
=
output_buf
[
0
]
[
output_row
]
;
outptr1
=
output_buf
[
1
]
[
output_row
]
;
outptr2
=
output_buf
[
2
]
[
output_row
]
;
output_row
+
+
;
for
(
col
=
0
;
col
<
num_cols
;
col
+
+
)
{
outptr0
[
col
]
=
inptr
[
RGB_RED
]
;
outptr1
[
col
]
=
inptr
[
RGB_GREEN
]
;
outptr2
[
col
]
=
inptr
[
RGB_BLUE
]
;
inptr
+
=
RGB_PIXELSIZE
;
}
}
}
