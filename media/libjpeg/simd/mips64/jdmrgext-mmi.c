#
if
RGB_RED
=
=
0
#
define
mmA
re
#
define
mmB
ro
#
elif
RGB_GREEN
=
=
0
#
define
mmA
ge
#
define
mmB
go
#
elif
RGB_BLUE
=
=
0
#
define
mmA
be
#
define
mmB
bo
#
else
#
define
mmA
xe
#
define
mmB
xo
#
endif
#
if
RGB_RED
=
=
1
#
define
mmC
re
#
define
mmD
ro
#
elif
RGB_GREEN
=
=
1
#
define
mmC
ge
#
define
mmD
go
#
elif
RGB_BLUE
=
=
1
#
define
mmC
be
#
define
mmD
bo
#
else
#
define
mmC
xe
#
define
mmD
xo
#
endif
#
if
RGB_RED
=
=
2
#
define
mmE
re
#
define
mmF
ro
#
elif
RGB_GREEN
=
=
2
#
define
mmE
ge
#
define
mmF
go
#
elif
RGB_BLUE
=
=
2
#
define
mmE
be
#
define
mmF
bo
#
else
#
define
mmE
xe
#
define
mmF
xo
#
endif
#
if
RGB_RED
=
=
3
#
define
mmG
re
#
define
mmH
ro
#
elif
RGB_GREEN
=
=
3
#
define
mmG
ge
#
define
mmH
go
#
elif
RGB_BLUE
=
=
3
#
define
mmG
be
#
define
mmH
bo
#
else
#
define
mmG
xe
#
define
mmH
xo
#
endif
void
jsimd_h2v1_merged_upsample_mmi
(
JDIMENSION
output_width
JSAMPIMAGE
input_buf
JDIMENSION
in_row_group_ctr
JSAMPARRAY
output_buf
)
{
JSAMPROW
outptr
inptr0
inptr1
inptr2
;
int
num_cols
col
;
__m64
ythise
ythiso
ythis
ynexte
ynexto
ynext
yl
y
;
__m64
cbl
cbl2
cbh
cbh2
cb
crl
crl2
crh
crh2
cr
;
__m64
rle
rlo
rl
rhe
rho
rh
re
ro
;
__m64
ga
gb
gle
glo
gl
gc
gd
ghe
gho
gh
ge
go
;
__m64
ble
blo
bl
bhe
bho
bh
be
bo
xe
=
0
.
0
xo
=
0
.
0
;
__m64
decenter
mask
zero
=
0
.
0
;
#
if
RGB_PIXELSIZE
=
=
4
__m64
mm8
mm9
;
#
endif
inptr0
=
input_buf
[
0
]
[
in_row_group_ctr
]
;
inptr1
=
input_buf
[
1
]
[
in_row_group_ctr
]
;
inptr2
=
input_buf
[
2
]
[
in_row_group_ctr
]
;
outptr
=
output_buf
[
0
]
;
for
(
num_cols
=
output_width
>
>
1
;
num_cols
>
0
;
num_cols
-
=
8
inptr0
+
=
16
inptr1
+
=
8
inptr2
+
=
8
)
{
cb
=
_mm_load_si64
(
(
__m64
*
)
inptr1
)
;
cr
=
_mm_load_si64
(
(
__m64
*
)
inptr2
)
;
ythis
=
_mm_load_si64
(
(
__m64
*
)
inptr0
)
;
ynext
=
_mm_load_si64
(
(
__m64
*
)
inptr0
+
1
)
;
mask
=
decenter
=
0
.
0
;
mask
=
_mm_cmpeq_pi16
(
mask
mask
)
;
decenter
=
_mm_cmpeq_pi16
(
decenter
decenter
)
;
mask
=
_mm_srli_pi16
(
mask
BYTE_BIT
)
;
decenter
=
_mm_slli_pi16
(
decenter
7
)
;
cbl
=
_mm_unpacklo_pi8
(
cb
zero
)
;
cbh
=
_mm_unpackhi_pi8
(
cb
zero
)
;
crl
=
_mm_unpacklo_pi8
(
cr
zero
)
;
crh
=
_mm_unpackhi_pi8
(
cr
zero
)
;
cbl
=
_mm_add_pi16
(
cbl
decenter
)
;
cbh
=
_mm_add_pi16
(
cbh
decenter
)
;
crl
=
_mm_add_pi16
(
crl
decenter
)
;
crh
=
_mm_add_pi16
(
crh
decenter
)
;
cbl2
=
_mm_add_pi16
(
cbl
cbl
)
;
cbh2
=
_mm_add_pi16
(
cbh
cbh
)
;
crl2
=
_mm_add_pi16
(
crl
crl
)
;
crh2
=
_mm_add_pi16
(
crh
crh
)
;
bl
=
_mm_mulhi_pi16
(
cbl2
PW_MF0228
)
;
bh
=
_mm_mulhi_pi16
(
cbh2
PW_MF0228
)
;
rl
=
_mm_mulhi_pi16
(
crl2
PW_F0402
)
;
rh
=
_mm_mulhi_pi16
(
crh2
PW_F0402
)
;
bl
=
_mm_add_pi16
(
bl
PW_ONE
)
;
bh
=
_mm_add_pi16
(
bh
PW_ONE
)
;
bl
=
_mm_srai_pi16
(
bl
1
)
;
bh
=
_mm_srai_pi16
(
bh
1
)
;
rl
=
_mm_add_pi16
(
rl
PW_ONE
)
;
rh
=
_mm_add_pi16
(
rh
PW_ONE
)
;
rl
=
_mm_srai_pi16
(
rl
1
)
;
rh
=
_mm_srai_pi16
(
rh
1
)
;
bl
=
_mm_add_pi16
(
bl
cbl
)
;
bh
=
_mm_add_pi16
(
bh
cbh
)
;
bl
=
_mm_add_pi16
(
bl
cbl
)
;
bh
=
_mm_add_pi16
(
bh
cbh
)
;
rl
=
_mm_add_pi16
(
rl
crl
)
;
rh
=
_mm_add_pi16
(
rh
crh
)
;
ga
=
_mm_unpacklo_pi16
(
cbl
crl
)
;
gb
=
_mm_unpackhi_pi16
(
cbl
crl
)
;
ga
=
_mm_madd_pi16
(
ga
PW_MF0344_F0285
)
;
gb
=
_mm_madd_pi16
(
gb
PW_MF0344_F0285
)
;
gc
=
_mm_unpacklo_pi16
(
cbh
crh
)
;
gd
=
_mm_unpackhi_pi16
(
cbh
crh
)
;
gc
=
_mm_madd_pi16
(
gc
PW_MF0344_F0285
)
;
gd
=
_mm_madd_pi16
(
gd
PW_MF0344_F0285
)
;
ga
=
_mm_add_pi32
(
ga
PD_ONEHALF
)
;
gb
=
_mm_add_pi32
(
gb
PD_ONEHALF
)
;
ga
=
_mm_srai_pi32
(
ga
SCALEBITS
)
;
gb
=
_mm_srai_pi32
(
gb
SCALEBITS
)
;
gc
=
_mm_add_pi32
(
gc
PD_ONEHALF
)
;
gd
=
_mm_add_pi32
(
gd
PD_ONEHALF
)
;
gc
=
_mm_srai_pi32
(
gc
SCALEBITS
)
;
gd
=
_mm_srai_pi32
(
gd
SCALEBITS
)
;
gl
=
_mm_packs_pi32
(
ga
gb
)
;
gh
=
_mm_packs_pi32
(
gc
gd
)
;
gl
=
_mm_sub_pi16
(
gl
crl
)
;
gh
=
_mm_sub_pi16
(
gh
crh
)
;
ythise
=
_mm_and_si64
(
mask
ythis
)
;
ythiso
=
_mm_srli_pi16
(
ythis
BYTE_BIT
)
;
ynexte
=
_mm_and_si64
(
mask
ynext
)
;
ynexto
=
_mm_srli_pi16
(
ynext
BYTE_BIT
)
;
rle
=
_mm_add_pi16
(
rl
ythise
)
;
rlo
=
_mm_add_pi16
(
rl
ythiso
)
;
rhe
=
_mm_add_pi16
(
rh
ynexte
)
;
rho
=
_mm_add_pi16
(
rh
ynexto
)
;
re
=
_mm_packs_pu16
(
rle
rhe
)
;
ro
=
_mm_packs_pu16
(
rlo
rho
)
;
gle
=
_mm_add_pi16
(
gl
ythise
)
;
glo
=
_mm_add_pi16
(
gl
ythiso
)
;
ghe
=
_mm_add_pi16
(
gh
ynexte
)
;
gho
=
_mm_add_pi16
(
gh
ynexto
)
;
ge
=
_mm_packs_pu16
(
gle
ghe
)
;
go
=
_mm_packs_pu16
(
glo
gho
)
;
ble
=
_mm_add_pi16
(
bl
ythise
)
;
blo
=
_mm_add_pi16
(
bl
ythiso
)
;
bhe
=
_mm_add_pi16
(
bh
ynexte
)
;
bho
=
_mm_add_pi16
(
bh
ynexto
)
;
be
=
_mm_packs_pu16
(
ble
bhe
)
;
bo
=
_mm_packs_pu16
(
blo
bho
)
;
#
if
RGB_PIXELSIZE
=
=
3
mmG
=
_mm_unpacklo_pi8
(
mmA
mmC
)
;
mmA
=
_mm_unpackhi_pi8
(
mmA
mmC
)
;
mmH
=
_mm_unpacklo_pi8
(
mmE
mmB
)
;
mmE
=
_mm_unpackhi_pi8
(
mmE
mmB
)
;
mmC
=
_mm_unpacklo_pi8
(
mmD
mmF
)
;
mmD
=
_mm_unpackhi_pi8
(
mmD
mmF
)
;
mmB
=
_mm_unpacklo_pi16
(
mmG
mmA
)
;
mmA
=
_mm_unpackhi_pi16
(
mmG
mmA
)
;
mmF
=
_mm_unpacklo_pi16
(
mmH
mmE
)
;
mmE
=
_mm_unpackhi_pi16
(
mmH
mmE
)
;
mmH
=
_mm_unpacklo_pi16
(
mmC
mmD
)
;
mmG
=
_mm_unpackhi_pi16
(
mmC
mmD
)
;
mmC
=
_mm_unpacklo_pi16
(
mmB
mmF
)
;
mmB
=
_mm_srli_si64
(
mmB
4
*
BYTE_BIT
)
;
mmB
=
_mm_unpacklo_pi16
(
mmH
mmB
)
;
mmD
=
_mm_unpackhi_pi16
(
mmF
mmH
)
;
mmF
=
_mm_unpacklo_pi16
(
mmA
mmE
)
;
mmA
=
_mm_srli_si64
(
mmA
4
*
BYTE_BIT
)
;
mmH
=
_mm_unpacklo_pi16
(
mmG
mmA
)
;
mmG
=
_mm_unpackhi_pi16
(
mmE
mmG
)
;
mmA
=
_mm_unpacklo_pi32
(
mmC
mmB
)
;
mmE
=
_mm_unpackhi_pi32
(
mmC
mmB
)
;
mmB
=
_mm_unpacklo_pi32
(
mmD
mmF
)
;
mmF
=
_mm_unpackhi_pi32
(
mmD
mmF
)
;
mmC
=
_mm_unpacklo_pi32
(
mmH
mmG
)
;
mmG
=
_mm_unpackhi_pi32
(
mmH
mmG
)
;
if
(
num_cols
>
=
8
)
{
if
(
!
(
(
(
long
)
outptr
)
&
7
)
)
{
_mm_store_si64
(
(
__m64
*
)
outptr
mmA
)
;
_mm_store_si64
(
(
__m64
*
)
(
outptr
+
8
)
mmB
)
;
_mm_store_si64
(
(
__m64
*
)
(
outptr
+
16
)
mmC
)
;
_mm_store_si64
(
(
__m64
*
)
(
outptr
+
24
)
mmE
)
;
_mm_store_si64
(
(
__m64
*
)
(
outptr
+
32
)
mmF
)
;
_mm_store_si64
(
(
__m64
*
)
(
outptr
+
40
)
mmG
)
;
}
else
{
_mm_storeu_si64
(
(
__m64
*
)
outptr
mmA
)
;
_mm_storeu_si64
(
(
__m64
*
)
(
outptr
+
8
)
mmB
)
;
_mm_storeu_si64
(
(
__m64
*
)
(
outptr
+
16
)
mmC
)
;
_mm_storeu_si64
(
(
__m64
*
)
(
outptr
+
24
)
mmE
)
;
_mm_storeu_si64
(
(
__m64
*
)
(
outptr
+
32
)
mmF
)
;
_mm_storeu_si64
(
(
__m64
*
)
(
outptr
+
40
)
mmG
)
;
}
outptr
+
=
RGB_PIXELSIZE
*
16
;
}
else
{
if
(
output_width
&
1
)
col
=
num_cols
*
6
+
3
;
else
col
=
num_cols
*
6
;
asm
(
"
.
set
noreorder
\
r
\
n
"
"
li
8
24
\
r
\
n
"
"
move
9
%
7
\
r
\
n
"
"
mov
.
s
f4
%
1
\
r
\
n
"
"
mov
.
s
f6
%
2
\
r
\
n
"
"
mov
.
s
f8
%
3
\
r
\
n
"
"
move
10
%
8
\
r
\
n
"
"
bltu
9
8
1f
\
r
\
n
"
"
nop
\
r
\
n
"
"
gssdlc1
f4
7
(
10
)
\
r
\
n
"
"
gssdrc1
f4
0
(
10
)
\
r
\
n
"
"
gssdlc1
f6
7
+
8
(
10
)
\
r
\
n
"
"
gssdrc1
f6
8
(
10
)
\
r
\
n
"
"
gssdlc1
f8
7
+
16
(
10
)
\
r
\
n
"
"
gssdrc1
f8
16
(
10
)
\
r
\
n
"
"
mov
.
s
f4
%
4
\
r
\
n
"
"
mov
.
s
f6
%
5
\
r
\
n
"
"
mov
.
s
f8
%
6
\
r
\
n
"
"
subu
9
9
24
\
r
\
n
"
PTR_ADDU
"
10
10
24
\
r
\
n
"
"
1
:
\
r
\
n
"
"
li
8
16
\
r
\
n
"
"
bltu
9
8
2f
\
r
\
n
"
"
nop
\
r
\
n
"
"
gssdlc1
f4
7
(
10
)
\
r
\
n
"
"
gssdrc1
f4
0
(
10
)
\
r
\
n
"
"
gssdlc1
f6
7
+
8
(
10
)
\
r
\
n
"
"
gssdrc1
f6
8
(
10
)
\
r
\
n
"
"
mov
.
s
f4
f8
\
r
\
n
"
"
subu
9
9
16
\
r
\
n
"
PTR_ADDU
"
10
10
16
\
r
\
n
"
"
2
:
\
r
\
n
"
"
li
8
8
\
r
\
n
"
"
bltu
9
8
3f
\
r
\
n
"
"
nop
\
r
\
n
"
"
gssdlc1
f4
7
(
10
)
\
r
\
n
"
"
gssdrc1
f4
0
(
10
)
\
r
\
n
"
"
mov
.
s
f4
f6
\
r
\
n
"
"
subu
9
9
8
\
r
\
n
"
PTR_ADDU
"
10
10
8
\
r
\
n
"
"
3
:
\
r
\
n
"
"
li
8
4
\
r
\
n
"
"
mfc1
11
f4
\
r
\
n
"
"
bltu
9
8
4f
\
r
\
n
"
"
nop
\
r
\
n
"
"
swl
11
3
(
10
)
\
r
\
n
"
"
swr
11
0
(
10
)
\
r
\
n
"
"
li
8
32
\
r
\
n
"
"
mtc1
8
f6
\
r
\
n
"
"
dsrl
f4
f4
f6
\
r
\
n
"
"
mfc1
11
f4
\
r
\
n
"
"
subu
9
9
4
\
r
\
n
"
PTR_ADDU
"
10
10
4
\
r
\
n
"
"
4
:
\
r
\
n
"
"
li
8
2
\
r
\
n
"
"
bltu
9
8
5f
\
r
\
n
"
"
nop
\
r
\
n
"
"
ush
11
0
(
10
)
\
r
\
n
"
"
srl
11
16
\
r
\
n
"
"
subu
9
9
2
\
r
\
n
"
PTR_ADDU
"
10
10
2
\
r
\
n
"
"
5
:
\
r
\
n
"
"
li
8
1
\
r
\
n
"
"
bltu
9
8
6f
\
r
\
n
"
"
nop
\
r
\
n
"
"
sb
11
0
(
10
)
\
r
\
n
"
"
6
:
\
r
\
n
"
"
nop
\
r
\
n
"
:
"
=
m
"
(
*
outptr
)
:
"
f
"
(
mmA
)
"
f
"
(
mmB
)
"
f
"
(
mmC
)
"
f
"
(
mmE
)
"
f
"
(
mmF
)
"
f
"
(
mmG
)
"
r
"
(
col
)
"
r
"
(
outptr
)
:
"
f4
"
"
f6
"
"
f8
"
"
8
"
"
9
"
"
10
"
"
11
"
"
memory
"
)
;
}
#
else
#
ifdef
RGBX_FILLER_0XFF
xe
=
_mm_cmpeq_pi8
(
xe
xe
)
;
xo
=
_mm_cmpeq_pi8
(
xo
xo
)
;
#
else
xe
=
_mm_xor_si64
(
xe
xe
)
;
xo
=
_mm_xor_si64
(
xo
xo
)
;
#
endif
mm8
=
_mm_unpacklo_pi8
(
mmA
mmC
)
;
mm9
=
_mm_unpackhi_pi8
(
mmA
mmC
)
;
mmA
=
_mm_unpacklo_pi8
(
mmE
mmG
)
;
mmE
=
_mm_unpackhi_pi8
(
mmE
mmG
)
;
mmG
=
_mm_unpacklo_pi8
(
mmB
mmD
)
;
mmB
=
_mm_unpackhi_pi8
(
mmB
mmD
)
;
mmD
=
_mm_unpacklo_pi8
(
mmF
mmH
)
;
mmF
=
_mm_unpackhi_pi8
(
mmF
mmH
)
;
mmH
=
_mm_unpacklo_pi16
(
mm8
mmA
)
;
mm8
=
_mm_unpackhi_pi16
(
mm8
mmA
)
;
mmA
=
_mm_unpacklo_pi16
(
mmG
mmD
)
;
mmD
=
_mm_unpackhi_pi16
(
mmG
mmD
)
;
mmG
=
_mm_unpackhi_pi16
(
mm9
mmE
)
;
mm9
=
_mm_unpacklo_pi16
(
mm9
mmE
)
;
mmE
=
_mm_unpacklo_pi16
(
mmB
mmF
)
;
mmF
=
_mm_unpackhi_pi16
(
mmB
mmF
)
;
mmB
=
_mm_unpackhi_pi32
(
mmH
mmA
)
;
mmA
=
_mm_unpacklo_pi32
(
mmH
mmA
)
;
mmC
=
_mm_unpacklo_pi32
(
mm8
mmD
)
;
mmD
=
_mm_unpackhi_pi32
(
mm8
mmD
)
;
mmH
=
_mm_unpackhi_pi32
(
mmG
mmF
)
;
mmG
=
_mm_unpacklo_pi32
(
mmG
mmF
)
;
mmF
=
_mm_unpackhi_pi32
(
mm9
mmE
)
;
mmE
=
_mm_unpacklo_pi32
(
mm9
mmE
)
;
if
(
num_cols
>
=
8
)
{
if
(
!
(
(
(
long
)
outptr
)
&
7
)
)
{
_mm_store_si64
(
(
__m64
*
)
outptr
mmA
)
;
_mm_store_si64
(
(
__m64
*
)
(
outptr
+
8
)
mmB
)
;
_mm_store_si64
(
(
__m64
*
)
(
outptr
+
16
)
mmC
)
;
_mm_store_si64
(
(
__m64
*
)
(
outptr
+
24
)
mmD
)
;
_mm_store_si64
(
(
__m64
*
)
(
outptr
+
32
)
mmE
)
;
_mm_store_si64
(
(
__m64
*
)
(
outptr
+
40
)
mmF
)
;
_mm_store_si64
(
(
__m64
*
)
(
outptr
+
48
)
mmG
)
;
_mm_store_si64
(
(
__m64
*
)
(
outptr
+
56
)
mmH
)
;
}
else
{
_mm_storeu_si64
(
(
__m64
*
)
outptr
mmA
)
;
_mm_storeu_si64
(
(
__m64
*
)
(
outptr
+
8
)
mmB
)
;
_mm_storeu_si64
(
(
__m64
*
)
(
outptr
+
16
)
mmC
)
;
_mm_storeu_si64
(
(
__m64
*
)
(
outptr
+
24
)
mmD
)
;
_mm_storeu_si64
(
(
__m64
*
)
(
outptr
+
32
)
mmE
)
;
_mm_storeu_si64
(
(
__m64
*
)
(
outptr
+
40
)
mmF
)
;
_mm_storeu_si64
(
(
__m64
*
)
(
outptr
+
48
)
mmG
)
;
_mm_storeu_si64
(
(
__m64
*
)
(
outptr
+
56
)
mmH
)
;
}
outptr
+
=
RGB_PIXELSIZE
*
16
;
}
else
{
if
(
output_width
&
1
)
col
=
num_cols
*
2
+
1
;
else
col
=
num_cols
*
2
;
asm
(
"
.
set
noreorder
\
r
\
n
"
"
li
8
8
\
r
\
n
"
"
move
9
%
10
\
r
\
n
"
"
move
10
%
11
\
r
\
n
"
"
mov
.
s
f4
%
2
\
r
\
n
"
"
mov
.
s
f6
%
3
\
r
\
n
"
"
mov
.
s
f8
%
4
\
r
\
n
"
"
mov
.
s
f10
%
5
\
r
\
n
"
"
bltu
9
8
1f
\
r
\
n
"
"
nop
\
r
\
n
"
"
gssdlc1
f4
7
(
10
)
\
r
\
n
"
"
gssdrc1
f4
0
(
10
)
\
r
\
n
"
"
gssdlc1
f6
7
+
8
(
10
)
\
r
\
n
"
"
gssdrc1
f6
8
(
10
)
\
r
\
n
"
"
gssdlc1
f8
7
+
16
(
10
)
\
r
\
n
"
"
gssdrc1
f8
16
(
10
)
\
r
\
n
"
"
gssdlc1
f10
7
+
24
(
10
)
\
r
\
n
"
"
gssdrc1
f10
24
(
10
)
\
r
\
n
"
"
mov
.
s
f4
%
6
\
r
\
n
"
"
mov
.
s
f6
%
7
\
r
\
n
"
"
mov
.
s
f8
%
8
\
r
\
n
"
"
mov
.
s
f10
%
9
\
r
\
n
"
"
subu
9
9
8
\
r
\
n
"
PTR_ADDU
"
10
10
32
\
r
\
n
"
"
1
:
\
r
\
n
"
"
li
8
4
\
r
\
n
"
"
bltu
9
8
2f
\
r
\
n
"
"
nop
\
r
\
n
"
"
gssdlc1
f4
7
(
10
)
\
r
\
n
"
"
gssdrc1
f4
0
(
10
)
\
r
\
n
"
"
gssdlc1
f6
7
+
8
(
10
)
\
r
\
n
"
"
gssdrc1
f6
8
(
10
)
\
r
\
n
"
"
mov
.
s
f4
f8
\
r
\
n
"
"
mov
.
s
f6
f10
\
r
\
n
"
"
subu
9
9
4
\
r
\
n
"
PTR_ADDU
"
10
10
16
\
r
\
n
"
"
2
:
\
r
\
n
"
"
li
8
2
\
r
\
n
"
"
bltu
9
8
3f
\
r
\
n
"
"
nop
\
r
\
n
"
"
gssdlc1
f4
7
(
10
)
\
r
\
n
"
"
gssdrc1
f4
0
(
10
)
\
r
\
n
"
"
mov
.
s
f4
f6
\
r
\
n
"
"
subu
9
9
2
\
r
\
n
"
PTR_ADDU
"
10
10
8
\
r
\
n
"
"
3
:
\
r
\
n
"
"
li
8
1
\
r
\
n
"
"
bltu
9
8
4f
\
r
\
n
"
"
nop
\
r
\
n
"
"
gsswlc1
f4
3
(
10
)
\
r
\
n
"
"
gsswrc1
f4
0
(
10
)
\
r
\
n
"
"
4
:
\
r
\
n
"
"
li
%
1
0
\
r
\
n
"
:
"
=
m
"
(
*
outptr
)
"
=
r
"
(
col
)
:
"
f
"
(
mmA
)
"
f
"
(
mmB
)
"
f
"
(
mmC
)
"
f
"
(
mmD
)
"
f
"
(
mmE
)
"
f
"
(
mmF
)
"
f
"
(
mmG
)
"
f
"
(
mmH
)
"
r
"
(
col
)
"
r
"
(
outptr
)
:
"
f4
"
"
f6
"
"
f8
"
"
f10
"
"
8
"
"
9
"
"
10
"
"
memory
"
)
;
}
#
endif
}
if
(
!
(
(
output_width
>
>
1
)
&
7
)
)
{
if
(
output_width
&
1
)
{
cb
=
_mm_load_si64
(
(
__m64
*
)
inptr1
)
;
cr
=
_mm_load_si64
(
(
__m64
*
)
inptr2
)
;
y
=
_mm_load_si64
(
(
__m64
*
)
inptr0
)
;
decenter
=
0
.
0
;
decenter
=
_mm_cmpeq_pi16
(
decenter
decenter
)
;
decenter
=
_mm_slli_pi16
(
decenter
7
)
;
cbl
=
_mm_unpacklo_pi8
(
cb
zero
)
;
crl
=
_mm_unpacklo_pi8
(
cr
zero
)
;
cbl
=
_mm_add_pi16
(
cbl
decenter
)
;
crl
=
_mm_add_pi16
(
crl
decenter
)
;
cbl2
=
_mm_add_pi16
(
cbl
cbl
)
;
crl2
=
_mm_add_pi16
(
crl
crl
)
;
bl
=
_mm_mulhi_pi16
(
cbl2
PW_MF0228
)
;
rl
=
_mm_mulhi_pi16
(
crl2
PW_F0402
)
;
bl
=
_mm_add_pi16
(
bl
PW_ONE
)
;
bl
=
_mm_srai_pi16
(
bl
1
)
;
rl
=
_mm_add_pi16
(
rl
PW_ONE
)
;
rl
=
_mm_srai_pi16
(
rl
1
)
;
bl
=
_mm_add_pi16
(
bl
cbl
)
;
bl
=
_mm_add_pi16
(
bl
cbl
)
;
rl
=
_mm_add_pi16
(
rl
crl
)
;
gl
=
_mm_unpacklo_pi16
(
cbl
crl
)
;
gl
=
_mm_madd_pi16
(
gl
PW_MF0344_F0285
)
;
gl
=
_mm_add_pi32
(
gl
PD_ONEHALF
)
;
gl
=
_mm_srai_pi32
(
gl
SCALEBITS
)
;
gl
=
_mm_packs_pi32
(
gl
zero
)
;
gl
=
_mm_sub_pi16
(
gl
crl
)
;
yl
=
_mm_unpacklo_pi8
(
y
zero
)
;
rl
=
_mm_add_pi16
(
rl
yl
)
;
gl
=
_mm_add_pi16
(
gl
yl
)
;
bl
=
_mm_add_pi16
(
bl
yl
)
;
re
=
_mm_packs_pu16
(
rl
rl
)
;
ge
=
_mm_packs_pu16
(
gl
gl
)
;
be
=
_mm_packs_pu16
(
bl
bl
)
;
#
if
RGB_PIXELSIZE
=
=
3
mmA
=
_mm_unpacklo_pi8
(
mmA
mmC
)
;
mmA
=
_mm_unpacklo_pi16
(
mmA
mmE
)
;
asm
(
"
.
set
noreorder
\
r
\
n
"
"
move
8
%
2
\
r
\
n
"
"
mov
.
s
f4
%
1
\
r
\
n
"
"
mfc1
9
f4
\
r
\
n
"
"
ush
9
0
(
8
)
\
r
\
n
"
"
srl
9
16
\
r
\
n
"
"
sb
9
2
(
8
)
\
r
\
n
"
:
"
=
m
"
(
*
outptr
)
:
"
f
"
(
mmA
)
"
r
"
(
outptr
)
:
"
f4
"
"
8
"
"
9
"
"
memory
"
)
;
#
else
#
ifdef
RGBX_FILLER_0XFF
xe
=
_mm_cmpeq_pi8
(
xe
xe
)
;
#
else
xe
=
_mm_xor_si64
(
xe
xe
)
;
#
endif
mmA
=
_mm_unpacklo_pi8
(
mmA
mmC
)
;
mmE
=
_mm_unpacklo_pi8
(
mmE
mmG
)
;
mmA
=
_mm_unpacklo_pi16
(
mmA
mmE
)
;
asm
(
"
.
set
noreorder
\
r
\
n
"
"
move
8
%
2
\
r
\
n
"
"
mov
.
s
f4
%
1
\
r
\
n
"
"
gsswlc1
f4
3
(
8
)
\
r
\
n
"
"
gsswrc1
f4
0
(
8
)
\
r
\
n
"
:
"
=
m
"
(
*
outptr
)
:
"
f
"
(
mmA
)
"
r
"
(
outptr
)
:
"
f4
"
"
8
"
"
memory
"
)
;
#
endif
}
}
}
void
jsimd_h2v2_merged_upsample_mmi
(
JDIMENSION
output_width
JSAMPIMAGE
input_buf
JDIMENSION
in_row_group_ctr
JSAMPARRAY
output_buf
)
{
JSAMPROW
inptr
outptr
;
inptr
=
input_buf
[
0
]
[
in_row_group_ctr
]
;
outptr
=
output_buf
[
0
]
;
input_buf
[
0
]
[
in_row_group_ctr
]
=
input_buf
[
0
]
[
in_row_group_ctr
*
2
]
;
jsimd_h2v1_merged_upsample_mmi
(
output_width
input_buf
in_row_group_ctr
output_buf
)
;
input_buf
[
0
]
[
in_row_group_ctr
]
=
input_buf
[
0
]
[
in_row_group_ctr
*
2
+
1
]
;
output_buf
[
0
]
=
output_buf
[
1
]
;
jsimd_h2v1_merged_upsample_mmi
(
output_width
input_buf
in_row_group_ctr
output_buf
)
;
input_buf
[
0
]
[
in_row_group_ctr
]
=
inptr
;
output_buf
[
0
]
=
outptr
;
}
#
undef
mmA
#
undef
mmB
#
undef
mmC
#
undef
mmD
#
undef
mmE
#
undef
mmF
#
undef
mmG
#
undef
mmH
