#
ifdef
HAVE_CONFIG_H
#
include
"
config
.
h
"
#
endif
#
include
"
main_FLP
.
h
"
void
silk_LTP_scale_ctrl_FLP
(
silk_encoder_state_FLP
*
psEnc
silk_encoder_control_FLP
*
psEncCtrl
opus_int
condCoding
)
{
opus_int
round_loss
;
if
(
condCoding
=
=
CODE_INDEPENDENTLY
)
{
round_loss
=
psEnc
-
>
sCmn
.
PacketLoss_perc
*
psEnc
-
>
sCmn
.
nFramesPerPacket
;
if
(
psEnc
-
>
sCmn
.
LBRR_flag
)
{
round_loss
=
2
+
silk_SMULBB
(
round_loss
round_loss
)
/
100
;
}
psEnc
-
>
sCmn
.
indices
.
LTP_scaleIndex
=
silk_SMULBB
(
psEncCtrl
-
>
LTPredCodGain
round_loss
)
>
silk_log2lin
(
2900
-
psEnc
-
>
sCmn
.
SNR_dB_Q7
)
;
psEnc
-
>
sCmn
.
indices
.
LTP_scaleIndex
+
=
silk_SMULBB
(
psEncCtrl
-
>
LTPredCodGain
round_loss
)
>
silk_log2lin
(
3900
-
psEnc
-
>
sCmn
.
SNR_dB_Q7
)
;
}
else
{
psEnc
-
>
sCmn
.
indices
.
LTP_scaleIndex
=
0
;
}
psEncCtrl
-
>
LTP_scale
=
(
silk_float
)
silk_LTPScales_table_Q14
[
psEnc
-
>
sCmn
.
indices
.
LTP_scaleIndex
]
/
16384
.
0f
;
}
