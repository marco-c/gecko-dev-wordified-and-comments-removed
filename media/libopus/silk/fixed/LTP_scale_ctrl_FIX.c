#
ifdef
HAVE_CONFIG_H
#
include
"
config
.
h
"
#
endif
#
include
"
main_FIX
.
h
"
void
silk_LTP_scale_ctrl_FIX
(
silk_encoder_state_FIX
*
psEnc
silk_encoder_control_FIX
*
psEncCtrl
opus_int
condCoding
)
{
opus_int
round_loss
;
if
(
condCoding
=
=
CODE_INDEPENDENTLY
)
{
round_loss
=
psEnc
-
>
sCmn
.
PacketLoss_perc
*
psEnc
-
>
sCmn
.
nFramesPerPacket
;
if
(
psEnc
-
>
sCmn
.
LBRR_flag
)
{
round_loss
=
2
+
silk_SMULBB
(
round_loss
round_loss
)
/
100
;
}
psEnc
-
>
sCmn
.
indices
.
LTP_scaleIndex
=
silk_SMULBB
(
psEncCtrl
-
>
LTPredCodGain_Q7
round_loss
)
>
silk_log2lin
(
128
*
7
+
2900
-
psEnc
-
>
sCmn
.
SNR_dB_Q7
)
;
psEnc
-
>
sCmn
.
indices
.
LTP_scaleIndex
+
=
silk_SMULBB
(
psEncCtrl
-
>
LTPredCodGain_Q7
round_loss
)
>
silk_log2lin
(
128
*
7
+
3900
-
psEnc
-
>
sCmn
.
SNR_dB_Q7
)
;
}
else
{
psEnc
-
>
sCmn
.
indices
.
LTP_scaleIndex
=
0
;
}
psEncCtrl
-
>
LTP_scale_Q14
=
silk_LTPScales_table_Q14
[
psEnc
-
>
sCmn
.
indices
.
LTP_scaleIndex
]
;
}
