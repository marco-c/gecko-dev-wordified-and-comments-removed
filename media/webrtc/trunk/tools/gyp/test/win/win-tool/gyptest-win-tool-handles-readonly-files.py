"
"
"
Make
sure
overwriting
read
-
only
files
works
as
expected
(
via
win
-
tool
)
.
"
"
"
import
TestGyp
import
filecmp
import
os
import
stat
import
sys
if
sys
.
platform
=
=
'
win32
'
:
  
test
=
TestGyp
.
TestGyp
(
formats
=
[
'
ninja
'
]
)
  
os
.
makedirs
(
'
subdir
'
)
  
read_only_files
=
[
'
read
-
only
-
file
'
'
subdir
/
A
'
'
subdir
/
B
'
'
subdir
/
C
'
]
  
for
f
in
read_only_files
:
    
test
.
write
(
f
'
source_contents
'
)
    
test
.
chmod
(
f
stat
.
S_IREAD
)
    
if
os
.
access
(
f
os
.
W_OK
)
:
      
test
.
fail_test
(
)
  
os
.
makedirs
(
test
.
built_file_path
(
'
dest
/
subdir
'
)
)
  
for
f
in
read_only_files
:
    
f
=
os
.
path
.
join
(
'
dest
'
f
)
    
test
.
write
(
test
.
built_file_path
(
f
)
'
SHOULD
BE
OVERWRITTEN
'
)
    
test
.
chmod
(
test
.
built_file_path
(
f
)
stat
.
S_IREAD
)
    
if
os
.
access
(
test
.
built_file_path
(
f
)
os
.
W_OK
)
:
      
test
.
fail_test
(
)
  
test
.
run_gyp
(
'
copies_readonly_files
.
gyp
'
)
  
test
.
build
(
'
copies_readonly_files
.
gyp
'
)
  
for
f
in
read_only_files
:
    
f
=
os
.
path
.
join
(
'
dest
'
f
)
    
test
.
must_contain
(
test
.
built_file_path
(
f
)
'
source_contents
'
)
  
for
f
in
read_only_files
:
    
if
not
filecmp
.
cmp
(
f
test
.
built_file_path
(
os
.
path
.
join
(
'
dest
'
f
)
)
)
:
      
test
.
fail_test
(
)
  
test
.
pass_test
(
)
