#
include
"
webrtc
/
modules
/
rtp_rtcp
/
source
/
rtcp_packet
/
rapid_resync_request
.
h
"
#
include
"
webrtc
/
base
/
checks
.
h
"
#
include
"
webrtc
/
base
/
logging
.
h
"
#
include
"
webrtc
/
modules
/
rtp_rtcp
/
source
/
rtcp_packet
/
common_header
.
h
"
namespace
webrtc
{
namespace
rtcp
{
constexpr
uint8_t
RapidResyncRequest
:
:
kFeedbackMessageType
;
bool
RapidResyncRequest
:
:
Parse
(
const
CommonHeader
&
packet
)
{
RTC_DCHECK_EQ
(
packet
.
type
(
)
kPacketType
)
;
RTC_DCHECK_EQ
(
packet
.
fmt
(
)
kFeedbackMessageType
)
;
if
(
packet
.
payload_size_bytes
(
)
!
=
kCommonFeedbackLength
)
{
LOG
(
LS_WARNING
)
<
<
"
Packet
payload
size
should
be
"
<
<
kCommonFeedbackLength
<
<
"
instead
of
"
<
<
packet
.
payload_size_bytes
(
)
<
<
"
to
be
a
valid
Rapid
Resynchronisation
Request
"
;
return
false
;
}
ParseCommonFeedback
(
packet
.
payload
(
)
)
;
return
true
;
}
bool
RapidResyncRequest
:
:
Create
(
uint8_t
*
packet
size_t
*
index
size_t
max_length
RtcpPacket
:
:
PacketReadyCallback
*
callback
)
const
{
while
(
*
index
+
BlockLength
(
)
>
max_length
)
{
if
(
!
OnBufferFull
(
packet
index
callback
)
)
return
false
;
}
CreateHeader
(
kFeedbackMessageType
kPacketType
HeaderLength
(
)
packet
index
)
;
CreateCommonFeedback
(
packet
+
*
index
)
;
*
index
+
=
kCommonFeedbackLength
;
return
true
;
}
}
}
