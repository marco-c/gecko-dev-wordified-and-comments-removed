#
include
"
modules
/
desktop_capture
/
screen_drawer_lock_posix
.
h
"
#
include
<
fcntl
.
h
>
#
include
<
sys
/
stat
.
h
>
#
include
"
rtc_base
/
checks
.
h
"
#
include
"
rtc_base
/
logging
.
h
"
namespace
webrtc
{
namespace
{
static
constexpr
char
kSemaphoreName
[
]
=
"
GSDL54fe5552804711e6a7253f429a
"
;
}
ScreenDrawerLockPosix
:
:
ScreenDrawerLockPosix
(
)
:
ScreenDrawerLockPosix
(
kSemaphoreName
)
{
}
ScreenDrawerLockPosix
:
:
ScreenDrawerLockPosix
(
const
char
*
name
)
{
semaphore_
=
sem_open
(
name
O_CREAT
S_IRWXU
|
S_IRWXG
|
S_IRWXO
1
)
;
if
(
semaphore_
=
=
SEM_FAILED
)
{
RTC_LOG_ERRNO
(
LS_ERROR
)
<
<
"
Failed
to
create
named
semaphore
with
"
<
<
name
;
RTC_NOTREACHED
(
)
;
}
sem_wait
(
semaphore_
)
;
}
ScreenDrawerLockPosix
:
:
~
ScreenDrawerLockPosix
(
)
{
if
(
semaphore_
=
=
SEM_FAILED
)
{
return
;
}
sem_post
(
semaphore_
)
;
sem_close
(
semaphore_
)
;
}
void
ScreenDrawerLockPosix
:
:
Unlink
(
const
char
*
name
)
{
sem_unlink
(
name
)
;
}
}
