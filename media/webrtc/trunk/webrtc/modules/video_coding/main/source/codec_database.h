#
ifndef
WEBRTC_MODULES_VIDEO_CODING_MAIN_SOURCE_CODEC_DATABASE_H_
#
define
WEBRTC_MODULES_VIDEO_CODING_MAIN_SOURCE_CODEC_DATABASE_H_
#
include
<
map
>
#
include
"
webrtc
/
base
/
scoped_ptr
.
h
"
#
include
"
webrtc
/
modules
/
video_coding
/
codecs
/
interface
/
video_codec_interface
.
h
"
#
include
"
webrtc
/
modules
/
video_coding
/
main
/
interface
/
video_coding
.
h
"
#
include
"
webrtc
/
modules
/
video_coding
/
main
/
source
/
generic_decoder
.
h
"
#
include
"
webrtc
/
modules
/
video_coding
/
main
/
source
/
generic_encoder
.
h
"
#
include
"
webrtc
/
typedefs
.
h
"
namespace
webrtc
{
struct
VCMDecoderMapItem
{
public
:
VCMDecoderMapItem
(
VideoCodec
*
settings
int
number_of_cores
bool
require_key_frame
)
;
rtc
:
:
scoped_ptr
<
VideoCodec
>
settings
;
int
number_of_cores
;
bool
require_key_frame
;
}
;
struct
VCMExtDecoderMapItem
{
public
:
VCMExtDecoderMapItem
(
VideoDecoder
*
external_decoder_instance
uint8_t
payload_type
bool
internal_render_timing
)
;
uint8_t
payload_type
;
VideoDecoder
*
external_decoder_instance
;
bool
internal_render_timing
;
}
;
class
VCMCodecDataBase
{
public
:
explicit
VCMCodecDataBase
(
VideoEncoderRateObserver
*
encoder_rate_observer
)
;
~
VCMCodecDataBase
(
)
;
static
int
NumberOfCodecs
(
)
;
static
bool
Codec
(
int
list_id
VideoCodec
*
settings
)
;
static
bool
Codec
(
VideoCodecType
codec_type
VideoCodec
*
settings
)
;
void
ResetSender
(
)
;
bool
SetSendCodec
(
const
VideoCodec
*
send_codec
int
number_of_cores
size_t
max_payload_size
VCMEncodedFrameCallback
*
encoded_frame_callback
)
;
bool
SendCodec
(
VideoCodec
*
current_send_codec
)
const
;
VideoCodecType
SendCodec
(
)
const
;
void
RegisterExternalEncoder
(
VideoEncoder
*
external_encoder
uint8_t
payload_type
bool
internal_source
)
;
bool
DeregisterExternalEncoder
(
uint8_t
payload_type
bool
*
was_send_codec
)
;
VCMGenericEncoder
*
GetEncoder
(
)
;
bool
SetPeriodicKeyFrames
(
bool
enable
)
;
void
ResetReceiver
(
)
;
bool
DeregisterExternalDecoder
(
uint8_t
payload_type
)
;
bool
RegisterExternalDecoder
(
VideoDecoder
*
external_decoder
uint8_t
payload_type
bool
internal_render_timing
)
;
bool
DecoderRegistered
(
)
const
;
bool
RegisterReceiveCodec
(
const
VideoCodec
*
receive_codec
int
number_of_cores
bool
require_key_frame
)
;
bool
DeregisterReceiveCodec
(
uint8_t
payload_type
)
;
bool
ReceiveCodec
(
VideoCodec
*
current_receive_codec
)
const
;
VideoCodecType
ReceiveCodec
(
)
const
;
VCMGenericDecoder
*
GetDecoder
(
uint8_t
payload_type
VCMDecodedFrameCallback
*
decoded_frame_callback
)
;
void
ReleaseDecoder
(
VCMGenericDecoder
*
decoder
)
const
;
bool
SupportsRenderScheduling
(
)
const
;
bool
MatchesCurrentResolution
(
int
width
int
height
)
const
;
private
:
typedef
std
:
:
map
<
uint8_t
VCMDecoderMapItem
*
>
DecoderMap
;
typedef
std
:
:
map
<
uint8_t
VCMExtDecoderMapItem
*
>
ExternalDecoderMap
;
VCMGenericDecoder
*
CreateAndInitDecoder
(
uint8_t
payload_type
VideoCodec
*
new_codec
)
const
;
bool
RequiresEncoderReset
(
const
VideoCodec
&
send_codec
)
;
VCMGenericEncoder
*
CreateEncoder
(
const
VideoCodecType
type
)
const
;
void
DeleteEncoder
(
)
;
VCMGenericDecoder
*
CreateDecoder
(
VideoCodecType
type
)
const
;
const
VCMDecoderMapItem
*
FindDecoderItem
(
uint8_t
payload_type
)
const
;
const
VCMExtDecoderMapItem
*
FindExternalDecoderItem
(
uint8_t
payload_type
)
const
;
int
number_of_cores_
;
size_t
max_payload_size_
;
bool
periodic_key_frames_
;
bool
pending_encoder_reset_
;
bool
current_enc_is_external_
;
VideoCodec
send_codec_
;
VideoCodec
receive_codec_
;
uint8_t
external_payload_type_
;
VideoEncoder
*
external_encoder_
;
bool
internal_source_
;
VideoEncoderRateObserver
*
const
encoder_rate_observer_
;
VCMGenericEncoder
*
ptr_encoder_
;
VCMGenericDecoder
*
ptr_decoder_
;
DecoderMap
dec_map_
;
ExternalDecoderMap
dec_external_map_
;
}
;
}
#
endif
