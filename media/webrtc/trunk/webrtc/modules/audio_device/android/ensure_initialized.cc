#
include
"
webrtc
/
modules
/
audio_device
/
android
/
ensure_initialized
.
h
"
#
include
<
pthread
.
h
>
#
include
"
base
/
android
/
jni_android
.
h
"
#
include
"
webrtc
/
base
/
checks
.
h
"
#
include
"
webrtc
/
modules
/
audio_device
/
android
/
audio_device_template
.
h
"
#
include
"
webrtc
/
modules
/
audio_device
/
android
/
audio_record_jni
.
h
"
#
include
"
webrtc
/
modules
/
audio_device
/
android
/
audio_track_jni
.
h
"
#
include
"
webrtc
/
modules
/
audio_device
/
android
/
opensles_input
.
h
"
#
include
"
webrtc
/
modules
/
audio_device
/
android
/
opensles_output
.
h
"
namespace
webrtc
{
namespace
audiodevicemodule
{
static
pthread_once_t
g_initialize_once
=
PTHREAD_ONCE_INIT
;
void
EnsureInitializedOnce
(
)
{
CHECK
(
:
:
base
:
:
android
:
:
IsVMInitialized
(
)
)
;
JNIEnv
*
jni
=
:
:
base
:
:
android
:
:
AttachCurrentThread
(
)
;
JavaVM
*
jvm
=
NULL
;
CHECK_EQ
(
0
jni
-
>
GetJavaVM
(
&
jvm
)
)
;
jobject
context
=
:
:
base
:
:
android
:
:
GetApplicationContext
(
)
;
using
AudioDeviceJava
=
AudioDeviceTemplate
<
AudioRecordJni
AudioTrackJni
>
;
AudioDeviceJava
:
:
SetAndroidAudioDeviceObjects
(
jvm
context
)
;
}
void
EnsureInitialized
(
)
{
CHECK_EQ
(
0
pthread_once
(
&
g_initialize_once
&
EnsureInitializedOnce
)
)
;
}
}
}
