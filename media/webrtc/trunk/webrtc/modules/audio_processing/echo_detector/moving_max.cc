#
include
"
webrtc
/
modules
/
audio_processing
/
echo_detector
/
moving_max
.
h
"
#
include
"
webrtc
/
base
/
checks
.
h
"
namespace
webrtc
{
namespace
{
constexpr
float
kDecayFactor
=
0
.
99f
;
}
MovingMax
:
:
MovingMax
(
size_t
window_size
)
:
window_size_
(
window_size
)
{
RTC_DCHECK_GT
(
window_size
0
)
;
}
MovingMax
:
:
~
MovingMax
(
)
{
}
void
MovingMax
:
:
Update
(
float
value
)
{
if
(
counter_
>
=
window_size_
-
1
)
{
max_value_
*
=
kDecayFactor
;
}
else
{
+
+
counter_
;
}
if
(
value
>
max_value_
)
{
max_value_
=
value
;
counter_
=
0
;
}
}
float
MovingMax
:
:
max
(
)
const
{
return
max_value_
;
}
void
MovingMax
:
:
Clear
(
)
{
max_value_
=
0
.
f
;
counter_
=
0
;
}
}
