#
ifndef
MODULES_AUDIO_PROCESSING_NS_NS_CORE_H_
#
define
MODULES_AUDIO_PROCESSING_NS_NS_CORE_H_
#
include
"
modules
/
audio_processing
/
ns
/
defines
.
h
"
typedef
struct
NSParaExtract_
{
float
binSizeLrt
;
float
binSizeSpecFlat
;
float
binSizeSpecDiff
;
float
rangeAvgHistLrt
;
float
factor1ModelPars
;
float
factor2ModelPars
;
float
thresPosSpecFlat
;
float
limitPeakSpacingSpecFlat
;
float
limitPeakSpacingSpecDiff
;
float
limitPeakWeightsSpecFlat
;
float
limitPeakWeightsSpecDiff
;
float
thresFluctLrt
;
float
maxLrt
;
float
minLrt
;
float
maxSpecFlat
;
float
minSpecFlat
;
float
maxSpecDiff
;
float
minSpecDiff
;
int
thresWeightSpecFlat
;
int
thresWeightSpecDiff
;
}
NSParaExtract
;
typedef
struct
NoiseSuppressionC_
{
uint32_t
fs
;
size_t
blockLen
;
size_t
windShift
;
size_t
anaLen
;
size_t
magnLen
;
int
aggrMode
;
const
float
*
window
;
float
analyzeBuf
[
ANAL_BLOCKL_MAX
]
;
float
dataBuf
[
ANAL_BLOCKL_MAX
]
;
float
syntBuf
[
ANAL_BLOCKL_MAX
]
;
int
initFlag
;
float
density
[
SIMULT
*
HALF_ANAL_BLOCKL
]
;
float
lquantile
[
SIMULT
*
HALF_ANAL_BLOCKL
]
;
float
quantile
[
HALF_ANAL_BLOCKL
]
;
int
counter
[
SIMULT
]
;
int
updates
;
float
smooth
[
HALF_ANAL_BLOCKL
]
;
float
overdrive
;
float
denoiseBound
;
int
gainmap
;
size_t
ip
[
IP_LENGTH
]
;
float
wfft
[
W_LENGTH
]
;
int32_t
blockInd
;
int
modelUpdatePars
[
4
]
;
float
priorModelPars
[
7
]
;
float
noise
[
HALF_ANAL_BLOCKL
]
;
float
noisePrev
[
HALF_ANAL_BLOCKL
]
;
float
magnPrevAnalyze
[
HALF_ANAL_BLOCKL
]
;
float
magnPrevProcess
[
HALF_ANAL_BLOCKL
]
;
float
logLrtTimeAvg
[
HALF_ANAL_BLOCKL
]
;
float
priorSpeechProb
;
float
featureData
[
7
]
;
float
magnAvgPause
[
HALF_ANAL_BLOCKL
]
;
float
signalEnergy
;
float
sumMagn
;
float
whiteNoiseLevel
;
float
initMagnEst
[
HALF_ANAL_BLOCKL
]
;
float
pinkNoiseNumerator
;
float
pinkNoiseExp
;
float
parametricNoise
[
HALF_ANAL_BLOCKL
]
;
NSParaExtract
featureExtractionParams
;
int
histLrt
[
HIST_PAR_EST
]
;
int
histSpecFlat
[
HIST_PAR_EST
]
;
int
histSpecDiff
[
HIST_PAR_EST
]
;
float
speechProb
[
HALF_ANAL_BLOCKL
]
;
float
dataBufHB
[
NUM_HIGH_BANDS_MAX
]
[
ANAL_BLOCKL_MAX
]
;
}
NoiseSuppressionC
;
#
ifdef
__cplusplus
extern
"
C
"
{
#
endif
int
WebRtcNs_InitCore
(
NoiseSuppressionC
*
self
uint32_t
fs
)
;
int
WebRtcNs_set_policy_core
(
NoiseSuppressionC
*
self
int
mode
)
;
void
WebRtcNs_AnalyzeCore
(
NoiseSuppressionC
*
self
const
float
*
speechFrame
)
;
void
WebRtcNs_ProcessCore
(
NoiseSuppressionC
*
self
const
float
*
const
*
inFrame
size_t
num_bands
float
*
const
*
outFrame
)
;
#
ifdef
__cplusplus
}
#
endif
#
endif
