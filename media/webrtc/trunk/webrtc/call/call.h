#
ifndef
CALL_CALL_H_
#
define
CALL_CALL_H_
#
include
<
algorithm
>
#
include
<
memory
>
#
include
<
string
>
#
include
<
vector
>
#
include
"
api
/
rtcerror
.
h
"
#
include
"
call
/
audio_receive_stream
.
h
"
#
include
"
call
/
audio_send_stream
.
h
"
#
include
"
call
/
audio_state
.
h
"
#
include
"
call
/
flexfec_receive_stream
.
h
"
#
include
"
call
/
rtp_transport_controller_send_interface
.
h
"
#
include
"
call
/
video_receive_stream
.
h
"
#
include
"
call
/
video_send_stream
.
h
"
#
include
"
common_types
.
h
"
#
include
"
rtc_base
/
bitrateallocationstrategy
.
h
"
#
include
"
rtc_base
/
networkroute
.
h
"
#
include
"
rtc_base
/
platform_file
.
h
"
#
include
"
rtc_base
/
socket
.
h
"
namespace
webrtc
{
class
AudioProcessing
;
class
RtcEventLog
;
enum
class
MediaType
{
ANY
AUDIO
VIDEO
DATA
}
;
template
<
typename
T
>
static
T
MinPositive
(
T
a
T
b
)
{
if
(
a
<
=
0
)
{
return
b
;
}
if
(
b
<
=
0
)
{
return
a
;
}
return
std
:
:
min
(
a
b
)
;
}
class
PacketReceiver
{
public
:
enum
DeliveryStatus
{
DELIVERY_OK
DELIVERY_UNKNOWN_SSRC
DELIVERY_PACKET_ERROR
}
;
virtual
DeliveryStatus
DeliverPacket
(
MediaType
media_type
const
uint8_t
*
packet
size_t
length
const
PacketTime
&
packet_time
)
=
0
;
protected
:
virtual
~
PacketReceiver
(
)
{
}
}
;
class
Call
{
public
:
struct
Config
{
explicit
Config
(
RtcEventLog
*
event_log
)
:
event_log
(
event_log
)
{
RTC_DCHECK
(
event_log
)
;
}
static
constexpr
int
kDefaultStartBitrateBps
=
300000
;
struct
BitrateConfig
{
int
min_bitrate_bps
=
0
;
int
start_bitrate_bps
=
kDefaultStartBitrateBps
;
int
max_bitrate_bps
=
-
1
;
}
bitrate_config
;
struct
BitrateConfigMask
{
rtc
:
:
Optional
<
int
>
min_bitrate_bps
;
rtc
:
:
Optional
<
int
>
start_bitrate_bps
;
rtc
:
:
Optional
<
int
>
max_bitrate_bps
;
}
;
rtc
:
:
scoped_refptr
<
AudioState
>
audio_state
;
AudioProcessing
*
audio_processing
=
nullptr
;
RtcEventLog
*
event_log
=
nullptr
;
}
;
struct
Stats
{
std
:
:
string
ToString
(
int64_t
time_ms
)
const
;
int
send_bandwidth_bps
=
0
;
int
max_padding_bitrate_bps
=
0
;
int
recv_bandwidth_bps
=
0
;
int64_t
pacer_delay_ms
=
0
;
int64_t
rtt_ms
=
-
1
;
}
;
static
Call
*
Create
(
const
Call
:
:
Config
&
config
)
;
static
Call
*
Create
(
const
Call
:
:
Config
&
config
std
:
:
unique_ptr
<
RtpTransportControllerSendInterface
>
transport_send
)
;
virtual
AudioSendStream
*
CreateAudioSendStream
(
const
AudioSendStream
:
:
Config
&
config
)
=
0
;
virtual
void
DestroyAudioSendStream
(
AudioSendStream
*
send_stream
)
=
0
;
virtual
AudioReceiveStream
*
CreateAudioReceiveStream
(
const
AudioReceiveStream
:
:
Config
&
config
)
=
0
;
virtual
void
DestroyAudioReceiveStream
(
AudioReceiveStream
*
receive_stream
)
=
0
;
virtual
VideoSendStream
*
CreateVideoSendStream
(
VideoSendStream
:
:
Config
config
VideoEncoderConfig
encoder_config
)
=
0
;
virtual
void
DestroyVideoSendStream
(
VideoSendStream
*
send_stream
)
=
0
;
virtual
VideoReceiveStream
*
CreateVideoReceiveStream
(
VideoReceiveStream
:
:
Config
configuration
)
=
0
;
virtual
void
DestroyVideoReceiveStream
(
VideoReceiveStream
*
receive_stream
)
=
0
;
virtual
FlexfecReceiveStream
*
CreateFlexfecReceiveStream
(
const
FlexfecReceiveStream
:
:
Config
&
config
)
=
0
;
virtual
void
DestroyFlexfecReceiveStream
(
FlexfecReceiveStream
*
receive_stream
)
=
0
;
virtual
PacketReceiver
*
Receiver
(
)
=
0
;
virtual
Stats
GetStats
(
)
const
=
0
;
virtual
void
SetBitrateConfig
(
const
Config
:
:
BitrateConfig
&
bitrate_config
)
=
0
;
virtual
void
SetBitrateConfigMask
(
const
Config
:
:
BitrateConfigMask
&
bitrate_mask
)
=
0
;
virtual
void
SetBitrateAllocationStrategy
(
std
:
:
unique_ptr
<
rtc
:
:
BitrateAllocationStrategy
>
bitrate_allocation_strategy
)
=
0
;
virtual
void
SignalChannelNetworkState
(
MediaType
media
NetworkState
state
)
=
0
;
virtual
void
OnTransportOverheadChanged
(
MediaType
media
int
transport_overhead_per_packet
)
=
0
;
virtual
void
OnNetworkRouteChanged
(
const
std
:
:
string
&
transport_name
const
rtc
:
:
NetworkRoute
&
network_route
)
=
0
;
virtual
void
OnSentPacket
(
const
rtc
:
:
SentPacket
&
sent_packet
)
=
0
;
virtual
VoiceEngine
*
voice_engine
(
)
=
0
;
virtual
~
Call
(
)
{
}
}
;
}
#
endif
