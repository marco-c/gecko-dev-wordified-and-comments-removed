#
include
"
webrtc
/
base
/
criticalsection
.
h
"
#
include
"
webrtc
/
base
/
checks
.
h
"
#
include
"
webrtc
/
base
/
thread
.
h
"
namespace
rtc
{
void
GlobalLockPod
:
:
Lock
(
)
{
while
(
AtomicOps
:
:
CompareAndSwap
(
&
lock_acquired
0
1
)
)
{
Thread
:
:
SleepMs
(
0
)
;
}
}
void
GlobalLockPod
:
:
Unlock
(
)
{
int
old_value
=
AtomicOps
:
:
CompareAndSwap
(
&
lock_acquired
1
0
)
;
DCHECK_EQ
(
1
old_value
)
<
<
"
Unlock
called
without
calling
Lock
first
"
;
}
GlobalLock
:
:
GlobalLock
(
)
{
lock_acquired
=
0
;
}
}
