#
ifndef
WEBRTC_VIDEO_STREAM_SYNCHRONIZATION_H_
#
define
WEBRTC_VIDEO_STREAM_SYNCHRONIZATION_H_
#
include
<
list
>
#
include
"
webrtc
/
system_wrappers
/
include
/
rtp_to_ntp_estimator
.
h
"
#
include
"
webrtc
/
typedefs
.
h
"
namespace
webrtc
{
class
StreamSynchronization
{
public
:
struct
Measurements
{
Measurements
(
)
:
latest_receive_time_ms
(
0
)
latest_timestamp
(
0
)
{
}
RtpToNtpEstimator
rtp_to_ntp
;
int64_t
latest_receive_time_ms
;
uint32_t
latest_timestamp
;
}
;
StreamSynchronization
(
uint32_t
video_primary_ssrc
int
audio_channel_id
)
;
bool
ComputeDelays
(
int
relative_delay_ms
int
current_audio_delay_ms
int
*
extra_audio_delay_ms
int
*
total_video_delay_target_ms
)
;
static
bool
ComputeRelativeDelay
(
const
Measurements
&
audio_measurement
const
Measurements
&
video_measurement
int
*
relative_delay_ms
)
;
void
SetTargetBufferingDelay
(
int
target_delay_ms
)
;
private
:
struct
SynchronizationDelays
{
int
extra_video_delay_ms
=
0
;
int
last_video_delay_ms
=
0
;
int
extra_audio_delay_ms
=
0
;
int
last_audio_delay_ms
=
0
;
}
;
SynchronizationDelays
channel_delay_
;
const
uint32_t
video_primary_ssrc_
;
const
int
audio_channel_id_
;
int
base_target_delay_ms_
;
int
avg_diff_ms_
;
}
;
}
#
endif
