#
ifndef
VIDEO_CALL_STATS_H_
#
define
VIDEO_CALL_STATS_H_
#
include
<
list
>
#
include
<
memory
>
#
include
"
modules
/
include
/
module
.
h
"
#
include
"
rtc_base
/
constructormagic
.
h
"
#
include
"
rtc_base
/
criticalsection
.
h
"
#
include
"
system_wrappers
/
include
/
clock
.
h
"
namespace
webrtc
{
class
CallStatsObserver
;
class
RtcpRttStats
;
class
CallStats
:
public
Module
{
public
:
friend
class
RtcpObserver
;
explicit
CallStats
(
Clock
*
clock
)
;
~
CallStats
(
)
;
int64_t
TimeUntilNextProcess
(
)
override
;
void
Process
(
)
override
;
RtcpRttStats
*
rtcp_rtt_stats
(
)
const
;
void
RegisterStatsObserver
(
CallStatsObserver
*
observer
)
;
void
DeregisterStatsObserver
(
CallStatsObserver
*
observer
)
;
struct
RttTime
{
RttTime
(
int64_t
new_rtt
int64_t
rtt_time
)
:
rtt
(
new_rtt
)
time
(
rtt_time
)
{
}
const
int64_t
rtt
;
const
int64_t
time
;
}
;
protected
:
void
OnRttUpdate
(
int64_t
rtt
)
;
int64_t
avg_rtt_ms
(
)
const
;
private
:
void
UpdateHistograms
(
)
;
Clock
*
const
clock_
;
rtc
:
:
CriticalSection
crit_
;
std
:
:
unique_ptr
<
RtcpRttStats
>
rtcp_rtt_stats_
;
int64_t
last_process_time_
;
int64_t
max_rtt_ms_
;
int64_t
avg_rtt_ms_
;
int64_t
sum_avg_rtt_ms_
RTC_GUARDED_BY
(
crit_
)
;
int64_t
num_avg_rtt_
RTC_GUARDED_BY
(
crit_
)
;
int64_t
time_of_first_rtt_ms_
RTC_GUARDED_BY
(
crit_
)
;
std
:
:
list
<
RttTime
>
reports_
;
std
:
:
list
<
CallStatsObserver
*
>
observers_
;
RTC_DISALLOW_COPY_AND_ASSIGN
(
CallStats
)
;
}
;
}
#
endif
