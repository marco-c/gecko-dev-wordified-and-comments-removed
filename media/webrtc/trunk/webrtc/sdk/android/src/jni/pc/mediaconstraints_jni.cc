#
include
"
sdk
/
android
/
src
/
jni
/
pc
/
mediaconstraints_jni
.
h
"
#
include
"
rtc_base
/
ptr_util
.
h
"
#
include
"
sdk
/
android
/
generated_peerconnection_jni
/
jni
/
MediaConstraints_jni
.
h
"
#
include
"
sdk
/
android
/
src
/
jni
/
jni_helpers
.
h
"
namespace
webrtc
{
namespace
jni
{
namespace
{
MediaConstraintsInterface
:
:
Constraints
PopulateConstraintsFromJavaPairList
(
JNIEnv
*
env
jobject
j_list
)
{
MediaConstraintsInterface
:
:
Constraints
constraints
;
for
(
jobject
entry
:
Iterable
(
env
j_list
)
)
{
jstring
j_key
=
Java_KeyValuePair_getKey
(
env
entry
)
;
jstring
j_value
=
Java_KeyValuePair_getValue
(
env
entry
)
;
constraints
.
emplace_back
(
JavaToStdString
(
env
j_key
)
JavaToStdString
(
env
j_value
)
)
;
}
return
constraints
;
}
class
MediaConstraintsJni
:
public
MediaConstraintsInterface
{
public
:
MediaConstraintsJni
(
JNIEnv
*
env
jobject
j_constraints
)
:
mandatory_
(
PopulateConstraintsFromJavaPairList
(
env
Java_MediaConstraints_getMandatory
(
env
j_constraints
)
)
)
optional_
(
PopulateConstraintsFromJavaPairList
(
env
Java_MediaConstraints_getOptional
(
env
j_constraints
)
)
)
{
}
virtual
~
MediaConstraintsJni
(
)
=
default
;
const
Constraints
&
GetMandatory
(
)
const
override
{
return
mandatory_
;
}
const
Constraints
&
GetOptional
(
)
const
override
{
return
optional_
;
}
private
:
const
Constraints
mandatory_
;
const
Constraints
optional_
;
}
;
}
std
:
:
unique_ptr
<
MediaConstraintsInterface
>
JavaToNativeMediaConstraints
(
JNIEnv
*
env
jobject
j_constraints
)
{
return
rtc
:
:
MakeUnique
<
MediaConstraintsJni
>
(
env
j_constraints
)
;
}
}
}
