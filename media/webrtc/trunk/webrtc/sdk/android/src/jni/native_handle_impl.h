#
ifndef
WEBRTC_SDK_ANDROID_SRC_JNI_NATIVE_HANDLE_IMPL_H_
#
define
WEBRTC_SDK_ANDROID_SRC_JNI_NATIVE_HANDLE_IMPL_H_
#
include
<
jni
.
h
>
#
include
"
webrtc
/
api
/
video
/
video_rotation
.
h
"
#
include
"
webrtc
/
common_video
/
include
/
video_frame_buffer
.
h
"
namespace
webrtc_jni
{
class
Matrix
{
public
:
Matrix
(
JNIEnv
*
jni
jfloatArray
a
)
;
jfloatArray
ToJava
(
JNIEnv
*
jni
)
;
void
Crop
(
float
cropped_width
float
cropped_height
float
crop_x
float
crop_y
)
;
void
Rotate
(
webrtc
:
:
VideoRotation
rotation
)
;
private
:
static
void
Multiply
(
const
float
a
[
16
]
const
float
b
[
16
]
float
result
[
16
]
)
;
float
elem_
[
16
]
;
}
;
struct
NativeHandleImpl
{
NativeHandleImpl
(
JNIEnv
*
jni
jint
j_oes_texture_id
jfloatArray
j_transform_matrix
)
;
NativeHandleImpl
(
int
id
const
Matrix
&
matrix
)
;
const
int
oes_texture_id
;
Matrix
sampling_matrix
;
}
;
class
AndroidTextureBuffer
:
public
webrtc
:
:
NativeHandleBuffer
{
public
:
AndroidTextureBuffer
(
int
width
int
height
const
NativeHandleImpl
&
native_handle
jobject
surface_texture_helper
const
rtc
:
:
Callback0
<
void
>
&
no_longer_used
)
;
~
AndroidTextureBuffer
(
)
;
rtc
:
:
scoped_refptr
<
VideoFrameBuffer
>
NativeToI420Buffer
(
)
override
;
rtc
:
:
scoped_refptr
<
AndroidTextureBuffer
>
CropScaleAndRotate
(
int
cropped_width
int
cropped_height
int
crop_x
int
crop_y
int
dst_width
int
dst_height
webrtc
:
:
VideoRotation
rotation
)
;
private
:
NativeHandleImpl
native_handle_
;
jobject
surface_texture_helper_
;
rtc
:
:
Callback0
<
void
>
no_longer_used_cb_
;
}
;
}
#
endif
