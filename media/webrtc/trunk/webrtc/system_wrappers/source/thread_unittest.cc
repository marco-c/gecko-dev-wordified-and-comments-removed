#
include
"
webrtc
/
system_wrappers
/
interface
/
thread_wrapper
.
h
"
#
include
"
testing
/
gtest
/
include
/
gtest
/
gtest
.
h
"
#
include
"
webrtc
/
base
/
scoped_ptr
.
h
"
#
include
"
webrtc
/
system_wrappers
/
interface
/
sleep
.
h
"
namespace
webrtc
{
bool
NullRunFunction
(
void
*
obj
)
{
SleepMs
(
0
)
;
return
true
;
}
TEST
(
ThreadTest
StartStop
)
{
rtc
:
:
scoped_ptr
<
ThreadWrapper
>
thread
=
ThreadWrapper
:
:
CreateThread
(
&
NullRunFunction
nullptr
"
ThreadTest
"
)
;
ASSERT_TRUE
(
thread
-
>
Start
(
)
)
;
EXPECT_TRUE
(
thread
-
>
Stop
(
)
)
;
}
bool
SetFlagRunFunction
(
void
*
obj
)
{
bool
*
obj_as_bool
=
static_cast
<
bool
*
>
(
obj
)
;
*
obj_as_bool
=
true
;
SleepMs
(
0
)
;
return
true
;
}
TEST
(
ThreadTest
RunFunctionIsCalled
)
{
bool
flag
=
false
;
rtc
:
:
scoped_ptr
<
ThreadWrapper
>
thread
=
ThreadWrapper
:
:
CreateThread
(
&
SetFlagRunFunction
&
flag
"
RunFunctionIsCalled
"
)
;
ASSERT_TRUE
(
thread
-
>
Start
(
)
)
;
EXPECT_TRUE
(
thread
-
>
Stop
(
)
)
;
EXPECT_TRUE
(
flag
)
;
}
}
