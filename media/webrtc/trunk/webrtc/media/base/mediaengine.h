#
ifndef
WEBRTC_MEDIA_BASE_MEDIAENGINE_H_
#
define
WEBRTC_MEDIA_BASE_MEDIAENGINE_H_
#
if
defined
(
WEBRTC_MAC
)
&
&
!
defined
(
WEBRTC_IOS
)
#
include
<
CoreAudio
/
CoreAudio
.
h
>
#
endif
#
include
<
string
>
#
include
<
vector
>
#
include
"
webrtc
/
api
/
rtpparameters
.
h
"
#
include
"
webrtc
/
base
/
fileutils
.
h
"
#
include
"
webrtc
/
base
/
sigslotrepeater
.
h
"
#
include
"
webrtc
/
call
/
audio_state
.
h
"
#
include
"
webrtc
/
media
/
base
/
codec
.
h
"
#
include
"
webrtc
/
media
/
base
/
mediachannel
.
h
"
#
include
"
webrtc
/
media
/
base
/
videocommon
.
h
"
#
include
"
webrtc
/
modules
/
audio_coding
/
codecs
/
audio_decoder_factory
.
h
"
#
if
defined
(
GOOGLE_CHROME_BUILD
)
|
|
defined
(
CHROMIUM_BUILD
)
#
define
DISABLE_MEDIA_ENGINE_FACTORY
#
endif
namespace
webrtc
{
class
AudioDeviceModule
;
class
AudioMixer
;
class
Call
;
}
namespace
cricket
{
struct
RtpCapabilities
{
std
:
:
vector
<
webrtc
:
:
RtpExtension
>
header_extensions
;
}
;
class
MediaEngineInterface
{
public
:
virtual
~
MediaEngineInterface
(
)
{
}
virtual
bool
Init
(
)
=
0
;
virtual
rtc
:
:
scoped_refptr
<
webrtc
:
:
AudioState
>
GetAudioState
(
)
const
=
0
;
virtual
VoiceMediaChannel
*
CreateChannel
(
webrtc
:
:
Call
*
call
const
MediaConfig
&
config
const
AudioOptions
&
options
)
=
0
;
virtual
VideoMediaChannel
*
CreateVideoChannel
(
webrtc
:
:
Call
*
call
const
MediaConfig
&
config
const
VideoOptions
&
options
)
=
0
;
virtual
int
GetInputLevel
(
)
=
0
;
virtual
const
std
:
:
vector
<
AudioCodec
>
&
audio_send_codecs
(
)
=
0
;
virtual
const
std
:
:
vector
<
AudioCodec
>
&
audio_recv_codecs
(
)
=
0
;
virtual
RtpCapabilities
GetAudioCapabilities
(
)
=
0
;
virtual
std
:
:
vector
<
VideoCodec
>
video_codecs
(
)
=
0
;
virtual
RtpCapabilities
GetVideoCapabilities
(
)
=
0
;
virtual
bool
StartAecDump
(
rtc
:
:
PlatformFile
file
int64_t
max_size_bytes
)
=
0
;
virtual
void
StopAecDump
(
)
=
0
;
}
;
#
if
!
defined
(
DISABLE_MEDIA_ENGINE_FACTORY
)
class
MediaEngineFactory
{
public
:
typedef
cricket
:
:
MediaEngineInterface
*
(
*
MediaEngineCreateFunction
)
(
)
;
static
MediaEngineInterface
*
Create
(
)
;
static
MediaEngineCreateFunction
SetCreateFunction
(
MediaEngineCreateFunction
function
)
;
private
:
static
MediaEngineCreateFunction
create_function_
;
}
;
#
endif
template
<
class
VOICE
class
VIDEO
>
class
CompositeMediaEngine
:
public
MediaEngineInterface
{
public
:
CompositeMediaEngine
(
webrtc
:
:
AudioDeviceModule
*
adm
const
rtc
:
:
scoped_refptr
<
webrtc
:
:
AudioDecoderFactory
>
&
audio_decoder_factory
rtc
:
:
scoped_refptr
<
webrtc
:
:
AudioMixer
>
audio_mixer
)
:
voice_
(
adm
audio_decoder_factory
audio_mixer
)
{
}
virtual
~
CompositeMediaEngine
(
)
{
}
virtual
bool
Init
(
)
{
video_
.
Init
(
)
;
return
true
;
}
virtual
rtc
:
:
scoped_refptr
<
webrtc
:
:
AudioState
>
GetAudioState
(
)
const
{
return
voice_
.
GetAudioState
(
)
;
}
virtual
VoiceMediaChannel
*
CreateChannel
(
webrtc
:
:
Call
*
call
const
MediaConfig
&
config
const
AudioOptions
&
options
)
{
return
voice_
.
CreateChannel
(
call
config
options
)
;
}
virtual
VideoMediaChannel
*
CreateVideoChannel
(
webrtc
:
:
Call
*
call
const
MediaConfig
&
config
const
VideoOptions
&
options
)
{
return
video_
.
CreateChannel
(
call
config
options
)
;
}
virtual
int
GetInputLevel
(
)
{
return
voice_
.
GetInputLevel
(
)
;
}
virtual
const
std
:
:
vector
<
AudioCodec
>
&
audio_send_codecs
(
)
{
return
voice_
.
send_codecs
(
)
;
}
virtual
const
std
:
:
vector
<
AudioCodec
>
&
audio_recv_codecs
(
)
{
return
voice_
.
recv_codecs
(
)
;
}
virtual
RtpCapabilities
GetAudioCapabilities
(
)
{
return
voice_
.
GetCapabilities
(
)
;
}
virtual
std
:
:
vector
<
VideoCodec
>
video_codecs
(
)
{
return
video_
.
codecs
(
)
;
}
virtual
RtpCapabilities
GetVideoCapabilities
(
)
{
return
video_
.
GetCapabilities
(
)
;
}
virtual
bool
StartAecDump
(
rtc
:
:
PlatformFile
file
int64_t
max_size_bytes
)
{
return
voice_
.
StartAecDump
(
file
max_size_bytes
)
;
}
virtual
void
StopAecDump
(
)
{
voice_
.
StopAecDump
(
)
;
}
protected
:
VOICE
voice_
;
VIDEO
video_
;
}
;
enum
DataChannelType
{
DCT_NONE
=
0
DCT_RTP
=
1
DCT_SCTP
=
2
DCT_QUIC
=
3
}
;
class
DataEngineInterface
{
public
:
virtual
~
DataEngineInterface
(
)
{
}
virtual
DataMediaChannel
*
CreateChannel
(
const
MediaConfig
&
config
)
=
0
;
virtual
const
std
:
:
vector
<
DataCodec
>
&
data_codecs
(
)
=
0
;
}
;
webrtc
:
:
RtpParameters
CreateRtpParametersWithOneEncoding
(
)
;
}
#
endif
