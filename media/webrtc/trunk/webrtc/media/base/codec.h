#
ifndef
MEDIA_BASE_CODEC_H_
#
define
MEDIA_BASE_CODEC_H_
#
include
<
map
>
#
include
<
set
>
#
include
<
string
>
#
include
<
vector
>
#
include
"
api
/
rtpparameters
.
h
"
#
include
"
api
/
video_codecs
/
sdp_video_format
.
h
"
#
include
"
common_types
.
h
"
#
include
"
media
/
base
/
mediaconstants
.
h
"
namespace
cricket
{
typedef
std
:
:
map
<
std
:
:
string
std
:
:
string
>
CodecParameterMap
;
class
FeedbackParam
{
public
:
FeedbackParam
(
)
=
default
;
FeedbackParam
(
const
std
:
:
string
&
id
const
std
:
:
string
&
param
)
:
id_
(
id
)
param_
(
param
)
{
}
explicit
FeedbackParam
(
const
std
:
:
string
&
id
)
:
id_
(
id
)
param_
(
kParamValueEmpty
)
{
}
bool
operator
=
=
(
const
FeedbackParam
&
other
)
const
;
const
std
:
:
string
&
id
(
)
const
{
return
id_
;
}
const
std
:
:
string
&
param
(
)
const
{
return
param_
;
}
private
:
std
:
:
string
id_
;
std
:
:
string
param_
;
}
;
class
FeedbackParams
{
public
:
FeedbackParams
(
)
;
bool
operator
=
=
(
const
FeedbackParams
&
other
)
const
;
bool
Has
(
const
FeedbackParam
&
param
)
const
;
void
Add
(
const
FeedbackParam
&
param
)
;
void
Intersect
(
const
FeedbackParams
&
from
)
;
const
std
:
:
vector
<
FeedbackParam
>
&
params
(
)
const
{
return
params_
;
}
private
:
bool
HasDuplicateEntries
(
)
const
;
std
:
:
vector
<
FeedbackParam
>
params_
;
}
;
struct
Codec
{
int
id
;
std
:
:
string
name
;
int
clockrate
;
CodecParameterMap
params
;
FeedbackParams
feedback_params
;
virtual
~
Codec
(
)
;
bool
Matches
(
const
Codec
&
codec
)
const
;
bool
GetParam
(
const
std
:
:
string
&
name
std
:
:
string
*
out
)
const
;
bool
GetParam
(
const
std
:
:
string
&
name
int
*
out
)
const
;
void
SetParam
(
const
std
:
:
string
&
name
const
std
:
:
string
&
value
)
;
void
SetParam
(
const
std
:
:
string
&
name
int
value
)
;
bool
RemoveParam
(
const
std
:
:
string
&
name
)
;
bool
HasFeedbackParam
(
const
FeedbackParam
&
param
)
const
;
void
AddFeedbackParam
(
const
FeedbackParam
&
param
)
;
void
IntersectFeedbackParams
(
const
Codec
&
other
)
;
virtual
webrtc
:
:
RtpCodecParameters
ToCodecParameters
(
)
const
;
Codec
&
operator
=
(
const
Codec
&
c
)
;
Codec
&
operator
=
(
Codec
&
&
c
)
;
bool
operator
=
=
(
const
Codec
&
c
)
const
;
bool
operator
!
=
(
const
Codec
&
c
)
const
{
return
!
(
*
this
=
=
c
)
;
}
protected
:
Codec
(
int
id
const
std
:
:
string
&
name
int
clockrate
)
;
Codec
(
)
;
Codec
(
const
Codec
&
c
)
;
Codec
(
Codec
&
&
c
)
;
}
;
struct
AudioCodec
:
public
Codec
{
int
bitrate
;
size_t
channels
;
AudioCodec
(
int
id
const
std
:
:
string
&
name
int
clockrate
int
bitrate
size_t
channels
)
;
AudioCodec
(
)
;
AudioCodec
(
const
AudioCodec
&
c
)
;
AudioCodec
(
AudioCodec
&
&
c
)
;
~
AudioCodec
(
)
override
=
default
;
bool
Matches
(
const
AudioCodec
&
codec
)
const
;
std
:
:
string
ToString
(
)
const
;
webrtc
:
:
RtpCodecParameters
ToCodecParameters
(
)
const
override
;
AudioCodec
&
operator
=
(
const
AudioCodec
&
c
)
;
AudioCodec
&
operator
=
(
AudioCodec
&
&
c
)
;
bool
operator
=
=
(
const
AudioCodec
&
c
)
const
;
bool
operator
!
=
(
const
AudioCodec
&
c
)
const
{
return
!
(
*
this
=
=
c
)
;
}
}
;
inline
std
:
:
ostream
&
operator
<
<
(
std
:
:
ostream
&
os
const
AudioCodec
&
ac
)
{
os
<
<
"
{
id
:
"
<
<
ac
.
id
;
os
<
<
"
name
:
"
<
<
ac
.
name
;
os
<
<
"
clockrate
:
"
<
<
ac
.
clockrate
;
os
<
<
"
bitrate
:
"
<
<
ac
.
bitrate
;
os
<
<
"
channels
:
"
<
<
ac
.
channels
;
os
<
<
"
params
:
{
"
;
const
char
*
sep
=
"
"
;
for
(
const
auto
&
kv
:
ac
.
params
)
{
os
<
<
sep
<
<
kv
.
first
<
<
"
:
"
<
<
kv
.
second
;
sep
=
"
"
;
}
os
<
<
"
}
feedback_params
:
{
"
;
sep
=
"
"
;
for
(
const
FeedbackParam
&
fp
:
ac
.
feedback_params
.
params
(
)
)
{
os
<
<
sep
<
<
fp
.
id
(
)
<
<
"
:
"
<
<
fp
.
param
(
)
;
sep
=
"
"
;
}
os
<
<
"
}
}
"
;
return
os
;
}
struct
VideoCodec
:
public
Codec
{
VideoCodec
(
int
id
const
std
:
:
string
&
name
)
;
explicit
VideoCodec
(
const
std
:
:
string
&
name
)
;
VideoCodec
(
)
;
VideoCodec
(
const
VideoCodec
&
c
)
;
explicit
VideoCodec
(
const
webrtc
:
:
SdpVideoFormat
&
c
)
;
VideoCodec
(
VideoCodec
&
&
c
)
;
~
VideoCodec
(
)
override
=
default
;
bool
Matches
(
const
VideoCodec
&
codec
)
const
;
std
:
:
string
ToString
(
)
const
;
webrtc
:
:
RtpCodecParameters
ToCodecParameters
(
)
const
override
;
VideoCodec
&
operator
=
(
const
VideoCodec
&
c
)
;
VideoCodec
&
operator
=
(
VideoCodec
&
&
c
)
;
bool
operator
=
=
(
const
VideoCodec
&
c
)
const
;
bool
operator
!
=
(
const
VideoCodec
&
c
)
const
{
return
!
(
*
this
=
=
c
)
;
}
static
VideoCodec
CreateRtxCodec
(
int
rtx_payload_type
int
associated_payload_type
)
;
enum
CodecType
{
CODEC_VIDEO
CODEC_RED
CODEC_ULPFEC
CODEC_FLEXFEC
CODEC_RTX
}
;
CodecType
GetCodecType
(
)
const
;
bool
ValidateCodecFormat
(
)
const
;
private
:
void
SetDefaultParameters
(
)
;
}
;
struct
DataCodec
:
public
Codec
{
DataCodec
(
int
id
const
std
:
:
string
&
name
)
;
DataCodec
(
)
;
DataCodec
(
const
DataCodec
&
c
)
;
DataCodec
(
DataCodec
&
&
c
)
;
~
DataCodec
(
)
override
=
default
;
DataCodec
&
operator
=
(
const
DataCodec
&
c
)
;
DataCodec
&
operator
=
(
DataCodec
&
&
c
)
;
std
:
:
string
ToString
(
)
const
;
}
;
template
<
class
Codec
>
const
Codec
*
FindCodecById
(
const
std
:
:
vector
<
Codec
>
&
codecs
int
payload_type
)
{
for
(
const
auto
&
codec
:
codecs
)
{
if
(
codec
.
id
=
=
payload_type
)
return
&
codec
;
}
return
nullptr
;
}
bool
CodecNamesEq
(
const
std
:
:
string
&
name1
const
std
:
:
string
&
name2
)
;
bool
CodecNamesEq
(
const
char
*
name1
const
char
*
name2
)
;
bool
HasNack
(
const
Codec
&
codec
)
;
bool
HasRemb
(
const
Codec
&
codec
)
;
bool
HasTransportCc
(
const
Codec
&
codec
)
;
const
VideoCodec
*
FindMatchingCodec
(
const
std
:
:
vector
<
VideoCodec
>
&
supported_codecs
const
VideoCodec
&
codec
)
;
bool
IsSameCodec
(
const
std
:
:
string
&
name1
const
CodecParameterMap
&
params1
const
std
:
:
string
&
name2
const
CodecParameterMap
&
params2
)
;
}
#
endif
