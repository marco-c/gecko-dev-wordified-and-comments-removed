#
ifndef
VOICE_ENGINE_CHANNEL_MANAGER_H_
#
define
VOICE_ENGINE_CHANNEL_MANAGER_H_
#
include
<
memory
>
#
include
<
vector
>
#
include
"
api
/
refcountedbase
.
h
"
#
include
"
rtc_base
/
constructormagic
.
h
"
#
include
"
rtc_base
/
criticalsection
.
h
"
#
include
"
rtc_base
/
random
.
h
"
#
include
"
rtc_base
/
scoped_ref_ptr
.
h
"
#
include
"
system_wrappers
/
include
/
atomic32
.
h
"
#
include
"
typedefs
.
h
"
#
include
"
voice_engine
/
include
/
voe_base
.
h
"
namespace
webrtc
{
class
AudioDecoderFactory
;
namespace
voe
{
class
Channel
;
class
ChannelOwner
{
public
:
explicit
ChannelOwner
(
Channel
*
channel
)
;
ChannelOwner
(
const
ChannelOwner
&
channel_owner
)
=
default
;
~
ChannelOwner
(
)
=
default
;
ChannelOwner
&
operator
=
(
const
ChannelOwner
&
other
)
=
default
;
Channel
*
channel
(
)
const
{
return
channel_ref_
-
>
channel
.
get
(
)
;
}
bool
IsValid
(
)
{
return
channel_ref_
-
>
channel
.
get
(
)
!
=
NULL
;
}
private
:
struct
ChannelRef
:
public
rtc
:
:
RefCountedBase
{
ChannelRef
(
Channel
*
channel
)
;
const
std
:
:
unique_ptr
<
Channel
>
channel
;
}
;
rtc
:
:
scoped_refptr
<
ChannelRef
>
channel_ref_
;
}
;
class
ChannelManager
{
public
:
ChannelManager
(
uint32_t
instance_id
)
;
class
Iterator
{
public
:
explicit
Iterator
(
ChannelManager
*
channel_manager
)
;
Channel
*
GetChannel
(
)
;
bool
IsValid
(
)
;
void
Increment
(
)
;
private
:
size_t
iterator_pos_
;
std
:
:
vector
<
ChannelOwner
>
channels_
;
RTC_DISALLOW_COPY_AND_ASSIGN
(
Iterator
)
;
}
;
ChannelOwner
CreateChannel
(
const
VoEBase
:
:
ChannelConfig
&
config
)
;
ChannelOwner
GetChannel
(
int32_t
channel_id
)
;
void
GetAllChannels
(
std
:
:
vector
<
ChannelOwner
>
*
channels
)
;
void
DestroyChannel
(
int32_t
channel_id
)
;
void
DestroyAllChannels
(
)
;
size_t
NumOfChannels
(
)
const
;
private
:
uint32_t
instance_id_
;
Atomic32
last_channel_id_
;
rtc
:
:
CriticalSection
lock_
;
std
:
:
vector
<
ChannelOwner
>
channels_
;
webrtc
:
:
Random
random_
;
RTC_DISALLOW_COPY_AND_ASSIGN
(
ChannelManager
)
;
}
;
}
}
#
endif
