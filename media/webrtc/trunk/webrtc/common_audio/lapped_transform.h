#
ifndef
WEBRTC_COMMON_AUDIO_LAPPED_TRANSFORM_H_
#
define
WEBRTC_COMMON_AUDIO_LAPPED_TRANSFORM_H_
#
include
<
complex
>
#
include
<
memory
>
#
include
"
webrtc
/
common_audio
/
blocker
.
h
"
#
include
"
webrtc
/
common_audio
/
real_fourier
.
h
"
#
include
"
webrtc
/
system_wrappers
/
include
/
aligned_array
.
h
"
namespace
webrtc
{
class
LappedTransform
{
public
:
class
Callback
{
public
:
virtual
~
Callback
(
)
{
}
virtual
void
ProcessAudioBlock
(
const
std
:
:
complex
<
float
>
*
const
*
in_block
size_t
num_in_channels
size_t
frames
size_t
num_out_channels
std
:
:
complex
<
float
>
*
const
*
out_block
)
=
0
;
}
;
LappedTransform
(
size_t
num_in_channels
size_t
num_out_channels
size_t
chunk_length
const
float
*
window
size_t
block_length
size_t
shift_amount
Callback
*
callback
)
;
~
LappedTransform
(
)
;
void
ProcessChunk
(
const
float
*
const
*
in_chunk
float
*
const
*
out_chunk
)
;
size_t
chunk_length
(
)
const
{
return
chunk_length_
;
}
size_t
num_in_channels
(
)
const
{
return
num_in_channels_
;
}
size_t
num_out_channels
(
)
const
{
return
num_out_channels_
;
}
size_t
initial_delay
(
)
const
{
return
blocker_
.
initial_delay
(
)
;
}
private
:
class
BlockThunk
:
public
BlockerCallback
{
public
:
explicit
BlockThunk
(
LappedTransform
*
parent
)
:
parent_
(
parent
)
{
}
void
ProcessBlock
(
const
float
*
const
*
input
size_t
num_frames
size_t
num_input_channels
size_t
num_output_channels
float
*
const
*
output
)
override
;
private
:
LappedTransform
*
const
parent_
;
}
blocker_callback_
;
const
size_t
num_in_channels_
;
const
size_t
num_out_channels_
;
const
size_t
block_length_
;
const
size_t
chunk_length_
;
Callback
*
const
block_processor_
;
Blocker
blocker_
;
std
:
:
unique_ptr
<
RealFourier
>
fft_
;
const
size_t
cplx_length_
;
AlignedArray
<
float
>
real_buf_
;
AlignedArray
<
std
:
:
complex
<
float
>
>
cplx_pre_
;
AlignedArray
<
std
:
:
complex
<
float
>
>
cplx_post_
;
}
;
}
#
endif
