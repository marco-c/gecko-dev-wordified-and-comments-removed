#
ifndef
WEBRTC_VIDEO_SEND_STREAM_H_
#
define
WEBRTC_VIDEO_SEND_STREAM_H_
#
include
<
map
>
#
include
<
string
>
#
include
"
webrtc
/
common_types
.
h
"
#
include
"
webrtc
/
config
.
h
"
#
include
"
webrtc
/
frame_callback
.
h
"
#
include
"
webrtc
/
stream
.
h
"
#
include
"
webrtc
/
transport
.
h
"
#
include
"
webrtc
/
video_renderer
.
h
"
namespace
webrtc
{
class
LoadObserver
;
class
VideoEncoder
;
class
EncodingTimeObserver
{
public
:
virtual
~
EncodingTimeObserver
(
)
{
}
virtual
void
OnReportEncodedTime
(
int64_t
ntp_time_ms
int
encode_time_ms
)
=
0
;
}
;
class
VideoCaptureInput
{
public
:
virtual
void
IncomingCapturedFrame
(
const
VideoFrame
&
video_frame
)
=
0
;
protected
:
virtual
~
VideoCaptureInput
(
)
{
}
}
;
class
VideoSendStream
:
public
SendStream
{
public
:
struct
StreamStats
{
FrameCounts
frame_counts
;
int
width
=
0
;
int
height
=
0
;
int
total_bitrate_bps
=
0
;
int
retransmit_bitrate_bps
=
0
;
int
avg_delay_ms
=
0
;
int
max_delay_ms
=
0
;
StreamDataCounters
rtp_stats
;
RtcpPacketTypeCounter
rtcp_packet_type_counts
;
RtcpStatistics
rtcp_stats
;
}
;
struct
Stats
{
std
:
:
string
encoder_implementation_name
=
"
unknown
"
;
int
input_frame_rate
=
0
;
int
encode_frame_rate
=
0
;
int
avg_encode_time_ms
=
0
;
int
encode_usage_percent
=
0
;
int
target_media_bitrate_bps
=
0
;
int
media_bitrate_bps
=
0
;
bool
suspended
=
false
;
bool
bw_limited_resolution
=
false
;
std
:
:
map
<
uint32_t
StreamStats
>
substreams
;
}
;
struct
Config
{
Config
(
)
=
delete
;
explicit
Config
(
Transport
*
send_transport
)
:
send_transport
(
send_transport
)
{
}
std
:
:
string
ToString
(
)
const
;
struct
EncoderSettings
{
std
:
:
string
ToString
(
)
const
;
std
:
:
string
payload_name
;
int
payload_type
=
-
1
;
bool
internal_source
=
false
;
VideoEncoder
*
encoder
=
nullptr
;
}
encoder_settings
;
static
const
size_t
kDefaultMaxPacketSize
=
1500
-
40
;
struct
Rtp
{
std
:
:
string
ToString
(
)
const
;
std
:
:
vector
<
uint32_t
>
ssrcs
;
RtcpMode
rtcp_mode
=
RtcpMode
:
:
kCompound
;
size_t
max_packet_size
=
kDefaultMaxPacketSize
;
std
:
:
vector
<
RtpExtension
>
extensions
;
NackConfig
nack
;
FecConfig
fec
;
struct
Rtx
{
std
:
:
string
ToString
(
)
const
;
std
:
:
vector
<
uint32_t
>
ssrcs
;
int
payload_type
=
-
1
;
}
rtx
;
std
:
:
string
c_name
;
std
:
:
vector
<
std
:
:
string
>
rids
;
}
rtp
;
Transport
*
send_transport
=
nullptr
;
LoadObserver
*
overuse_callback
=
nullptr
;
I420FrameCallback
*
pre_encode_callback
=
nullptr
;
EncodedFrameObserver
*
post_encode_callback
=
nullptr
;
VideoRenderer
*
local_renderer
=
nullptr
;
int
render_delay_ms
=
0
;
int
target_delay_ms
=
0
;
bool
suspend_below_min_bitrate
=
false
;
EncodingTimeObserver
*
encoding_time_observer
=
nullptr
;
}
;
virtual
VideoCaptureInput
*
Input
(
)
=
0
;
virtual
CPULoadStateObserver
*
LoadStateObserver
(
)
=
0
;
virtual
bool
ReconfigureVideoEncoder
(
const
VideoEncoderConfig
&
config
)
=
0
;
virtual
Stats
GetStats
(
)
=
0
;
}
;
}
#
endif
