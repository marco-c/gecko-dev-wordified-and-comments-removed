#
ifndef
WEBRTC_TEST_FAKE_NETWORK_PIPE_H_
#
define
WEBRTC_TEST_FAKE_NETWORK_PIPE_H_
#
include
<
queue
>
#
include
"
webrtc
/
base
/
constructormagic
.
h
"
#
include
"
webrtc
/
base
/
criticalsection
.
h
"
#
include
"
webrtc
/
base
/
scoped_ptr
.
h
"
#
include
"
webrtc
/
typedefs
.
h
"
namespace
webrtc
{
class
Clock
;
class
CriticalSectionWrapper
;
class
NetworkPacket
;
class
PacketReceiver
;
class
FakeNetworkPipe
{
public
:
struct
Config
{
Config
(
)
{
}
size_t
queue_length_packets
=
0
;
int
queue_delay_ms
=
0
;
int
delay_standard_deviation_ms
=
0
;
int
link_capacity_kbps
=
0
;
int
loss_percent
=
0
;
}
;
FakeNetworkPipe
(
Clock
*
clock
const
FakeNetworkPipe
:
:
Config
&
config
)
;
~
FakeNetworkPipe
(
)
;
void
SetReceiver
(
PacketReceiver
*
receiver
)
;
void
SetConfig
(
const
FakeNetworkPipe
:
:
Config
&
config
)
;
void
SendPacket
(
const
uint8_t
*
packet
size_t
packet_length
)
;
void
Process
(
)
;
int64_t
TimeUntilNextProcess
(
)
const
;
float
PercentageLoss
(
)
;
int
AverageDelay
(
)
;
size_t
dropped_packets
(
)
{
return
dropped_packets_
;
}
size_t
sent_packets
(
)
{
return
sent_packets_
;
}
private
:
Clock
*
const
clock_
;
mutable
rtc
:
:
CriticalSection
lock_
;
PacketReceiver
*
packet_receiver_
;
std
:
:
queue
<
NetworkPacket
*
>
capacity_link_
;
std
:
:
queue
<
NetworkPacket
*
>
delay_link_
;
Config
config_
;
size_t
dropped_packets_
;
size_t
sent_packets_
;
int64_t
total_packet_delay_
;
int64_t
next_process_time_
;
RTC_DISALLOW_COPY_AND_ASSIGN
(
FakeNetworkPipe
)
;
}
;
}
#
endif
