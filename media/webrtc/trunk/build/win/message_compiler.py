import
os
import
subprocess
import
sys
def
main
(
)
:
  
env_pairs
=
open
(
sys
.
argv
[
1
]
)
.
read
(
)
[
:
-
2
]
.
split
(
'
\
0
'
)
  
env_dict
=
dict
(
[
item
.
split
(
'
=
'
1
)
for
item
in
env_pairs
]
)
  
try
:
    
rest
=
sys
.
argv
[
2
:
]
    
subprocess
.
check_output
(
[
'
mc
.
exe
'
]
+
rest
                            
env
=
env_dict
                            
stderr
=
subprocess
.
STDOUT
                            
shell
=
True
)
    
header_dir
=
None
    
input_file
=
None
    
for
i
arg
in
enumerate
(
rest
)
:
      
if
arg
=
=
'
-
h
'
and
len
(
rest
)
>
i
+
1
:
        
assert
header_dir
=
=
None
        
header_dir
=
rest
[
i
+
1
]
      
elif
arg
.
endswith
(
'
.
mc
'
)
or
arg
.
endswith
(
'
.
man
'
)
:
        
assert
input_file
=
=
None
        
input_file
=
arg
    
if
header_dir
:
      
header_file
=
os
.
path
.
join
(
          
header_dir
os
.
path
.
splitext
(
os
.
path
.
basename
(
input_file
)
)
[
0
]
+
'
.
h
'
)
      
header_contents
=
[
]
      
with
open
(
header_file
'
rb
'
)
as
f
:
        
for
line
in
f
.
readlines
(
)
:
          
if
line
.
startswith
(
'
/
/
'
)
and
'
?
'
in
line
:
            
continue
          
header_contents
.
append
(
line
)
      
with
open
(
header_file
'
wb
'
)
as
f
:
        
f
.
write
(
'
'
.
join
(
header_contents
)
)
  
except
subprocess
.
CalledProcessError
as
e
:
    
print
e
.
output
    
sys
.
exit
(
e
.
returncode
)
if
__name__
=
=
'
__main__
'
:
  
main
(
)
