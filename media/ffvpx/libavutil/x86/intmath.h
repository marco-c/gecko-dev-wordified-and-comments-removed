#
ifndef
AVUTIL_X86_INTMATH_H
#
define
AVUTIL_X86_INTMATH_H
#
include
<
stdint
.
h
>
#
include
"
config
.
h
"
#
if
defined
(
__GNUC__
)
#
if
defined
(
__POPCNT__
)
#
define
av_popcount
__builtin_popcount
#
if
ARCH_X86_64
#
define
av_popcount64
__builtin_popcountll
#
endif
#
endif
#
if
defined
(
__BMI2__
)
#
if
AV_GCC_VERSION_AT_LEAST
(
5
1
)
#
define
av_mod_uintp2
__builtin_ia32_bzhi_si
#
elif
HAVE_INLINE_ASM
#
define
av_mod_uintp2
av_mod_uintp2_bmi2
static
av_always_inline
av_const
unsigned
av_mod_uintp2_bmi2
(
unsigned
a
unsigned
p
)
{
if
(
av_builtin_constant_p
(
p
)
)
return
a
&
(
(
1
<
<
p
)
-
1
)
;
else
{
unsigned
x
;
__asm__
(
"
bzhi
%
2
%
1
%
0
\
n
\
t
"
:
"
=
r
"
(
x
)
:
"
rm
"
(
a
)
"
r
"
(
p
)
)
;
return
x
;
}
}
#
endif
#
endif
#
endif
#
endif
