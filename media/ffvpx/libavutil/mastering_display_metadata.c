#
include
<
stddef
.
h
>
#
include
<
stdint
.
h
>
#
include
<
string
.
h
>
#
include
"
mastering_display_metadata
.
h
"
#
include
"
mem
.
h
"
static
void
get_defaults
(
AVMasteringDisplayMetadata
*
mastering
)
{
for
(
int
i
=
0
;
i
<
3
;
i
+
+
)
for
(
int
j
=
0
;
j
<
2
;
j
+
+
)
mastering
-
>
display_primaries
[
i
]
[
j
]
=
(
AVRational
)
{
0
1
}
;
mastering
-
>
white_point
[
0
]
=
mastering
-
>
white_point
[
1
]
=
mastering
-
>
min_luminance
=
mastering
-
>
max_luminance
=
(
AVRational
)
{
0
1
}
;
}
AVMasteringDisplayMetadata
*
av_mastering_display_metadata_alloc
(
void
)
{
return
av_mastering_display_metadata_alloc_size
(
NULL
)
;
}
AVMasteringDisplayMetadata
*
av_mastering_display_metadata_alloc_size
(
size_t
*
size
)
{
AVMasteringDisplayMetadata
*
mastering
=
av_mallocz
(
sizeof
(
AVMasteringDisplayMetadata
)
)
;
if
(
!
mastering
)
return
NULL
;
get_defaults
(
mastering
)
;
if
(
size
)
*
size
=
sizeof
(
*
mastering
)
;
return
mastering
;
}
AVMasteringDisplayMetadata
*
av_mastering_display_metadata_create_side_data
(
AVFrame
*
frame
)
{
AVFrameSideData
*
side_data
=
av_frame_new_side_data
(
frame
AV_FRAME_DATA_MASTERING_DISPLAY_METADATA
sizeof
(
AVMasteringDisplayMetadata
)
)
;
if
(
!
side_data
)
return
NULL
;
memset
(
side_data
-
>
data
0
sizeof
(
AVMasteringDisplayMetadata
)
)
;
get_defaults
(
(
AVMasteringDisplayMetadata
*
)
side_data
-
>
data
)
;
return
(
AVMasteringDisplayMetadata
*
)
side_data
-
>
data
;
}
AVContentLightMetadata
*
av_content_light_metadata_alloc
(
size_t
*
size
)
{
AVContentLightMetadata
*
metadata
=
av_mallocz
(
sizeof
(
AVContentLightMetadata
)
)
;
if
(
size
)
*
size
=
sizeof
(
*
metadata
)
;
return
metadata
;
}
AVContentLightMetadata
*
av_content_light_metadata_create_side_data
(
AVFrame
*
frame
)
{
AVFrameSideData
*
side_data
=
av_frame_new_side_data
(
frame
AV_FRAME_DATA_CONTENT_LIGHT_LEVEL
sizeof
(
AVContentLightMetadata
)
)
;
if
(
!
side_data
)
return
NULL
;
memset
(
side_data
-
>
data
0
sizeof
(
AVContentLightMetadata
)
)
;
return
(
AVContentLightMetadata
*
)
side_data
-
>
data
;
}
