#
include
<
assert
.
h
>
#
include
<
stdio
.
h
>
#
include
<
string
.
h
>
#
include
"
ClearKeyCDM
.
h
"
#
include
"
ClearKeySessionManager
.
h
"
#
include
"
stddef
.
h
"
#
include
"
content_decryption_module
.
h
"
#
ifdef
ENABLE_WMF
#
include
"
WMFUtils
.
h
"
#
endif
extern
"
C
"
{
CDM_EXPORT
void
INITIALIZE_CDM_MODULE
(
)
{
}
CDM_EXPORT
void
*
CreateCdmInstance
(
int
cdm_interface_version
const
char
*
key_system
uint32_t
key_system_size
GetCdmHostFunc
get_cdm_host_func
void
*
user_data
)
{
CK_LOGE
(
"
ClearKey
CreateCDMInstance
"
)
;
#
ifdef
ENABLE_WMF
if
(
!
wmf
:
:
EnsureLibs
(
)
)
{
CK_LOGE
(
"
Required
libraries
were
not
found
"
)
;
return
nullptr
;
}
#
endif
cdm
:
:
Host_8
*
host
=
static_cast
<
cdm
:
:
Host_8
*
>
(
get_cdm_host_func
(
cdm_interface_version
user_data
)
)
;
ClearKeyCDM
*
clearKey
=
new
ClearKeyCDM
(
host
)
;
CK_LOGE
(
"
Created
ClearKeyCDM
instance
!
"
)
;
return
clearKey
;
}
}
