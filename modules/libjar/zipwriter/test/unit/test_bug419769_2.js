const
DATA
=
"
"
;
const
FILENAME
=
"
test
.
txt
"
;
const
CRC
=
0x00000000
;
function
testpass
(
source
)
{
Assert
.
ok
(
source
.
hasEntry
(
FILENAME
)
)
;
var
entry
=
source
.
getEntry
(
FILENAME
)
;
Assert
.
notEqual
(
entry
null
)
;
Assert
.
ok
(
!
entry
.
isDirectory
)
;
Assert
.
equal
(
entry
.
compression
ZIP_METHOD_DEFLATE
)
;
Assert
.
equal
(
entry
.
realSize
DATA
.
length
)
;
Assert
.
equal
(
entry
.
CRC32
CRC
)
;
}
function
run_test
(
)
{
zipW
.
open
(
tmpFile
PR_RDWR
|
PR_CREATE_FILE
|
PR_TRUNCATE
)
;
Assert
.
ok
(
!
zipW
.
hasEntry
(
FILENAME
)
)
;
Assert
.
ok
(
!
zipW
.
inQueue
)
;
var
file
=
do_get_file
(
DATA_DIR
+
"
emptyfile
.
txt
"
)
;
zipW
.
addEntryFile
(
FILENAME
Ci
.
nsIZipWriter
.
COMPRESSION_BEST
file
false
)
;
testpass
(
zipW
)
;
zipW
.
close
(
)
;
zipW
.
open
(
tmpFile
PR_RDWR
)
;
testpass
(
zipW
)
;
zipW
.
close
(
)
;
var
zipR
=
new
ZipReader
(
tmpFile
)
;
testpass
(
zipR
)
;
zipR
.
test
(
FILENAME
)
;
var
stream
=
Cc
[
"
mozilla
.
org
/
scriptableinputstream
;
1
"
]
.
createInstance
(
Ci
.
nsIScriptableInputStream
)
;
stream
.
init
(
zipR
.
getInputStream
(
FILENAME
)
)
;
var
result
=
stream
.
read
(
DATA
.
length
)
;
stream
.
close
(
)
;
zipR
.
close
(
)
;
Assert
.
equal
(
result
DATA
)
;
}
