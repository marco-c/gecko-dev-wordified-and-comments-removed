#
include
<
freetype
/
freetype
.
h
>
#
include
<
freetype
/
internal
/
ftdebug
.
h
>
#
ifdef
FT_DEBUG_LEVEL_ERROR
#
include
<
stdarg
.
h
>
#
include
<
stdlib
.
h
>
#
include
<
string
.
h
>
#
include
<
windows
.
h
>
static
void
OutputDebugStringEx
(
const
char
*
str
)
{
static
WCHAR
buf
[
8192
]
;
int
sz
=
MultiByteToWideChar
(
CP_ACP
0
str
-
1
buf
sizeof
(
buf
)
/
sizeof
(
*
buf
)
)
;
if
(
!
sz
)
lstrcpyW
(
buf
L
"
OutputDebugStringEx
:
MultiByteToWideChar
failed
"
)
;
OutputDebugStringW
(
buf
)
;
}
FT_BASE_DEF
(
void
)
FT_Message
(
const
char
*
fmt
.
.
.
)
{
static
char
buf
[
8192
]
;
va_list
ap
;
va_start
(
ap
fmt
)
;
vfprintf
(
stderr
fmt
ap
)
;
vsprintf
(
buf
fmt
ap
)
;
OutputDebugStringEx
(
buf
)
;
va_end
(
ap
)
;
}
FT_BASE_DEF
(
void
)
FT_Panic
(
const
char
*
fmt
.
.
.
)
{
static
char
buf
[
8192
]
;
va_list
ap
;
va_start
(
ap
fmt
)
;
vsprintf
(
buf
fmt
ap
)
;
OutputDebugStringEx
(
buf
)
;
va_end
(
ap
)
;
exit
(
EXIT_FAILURE
)
;
}
FT_BASE_DEF
(
int
)
FT_Throw
(
FT_Error
error
int
line
const
char
*
file
)
{
#
if
0
fprintf
(
stderr
"
%
s
:
%
d
:
error
0x
%
02x
:
%
s
\
n
"
file
line
error
FT_Error_String
(
error
)
)
;
#
else
FT_UNUSED
(
error
)
;
FT_UNUSED
(
line
)
;
FT_UNUSED
(
file
)
;
#
endif
return
0
;
}
#
endif
#
ifdef
FT_DEBUG_LEVEL_TRACE
static
int
ft_trace_levels_enabled
[
trace_count
]
;
static
int
ft_trace_levels_disabled
[
trace_count
]
;
int
*
ft_trace_levels
;
#
define
FT_TRACE_DEF
(
x
)
#
x
static
const
char
*
ft_trace_toggles
[
trace_count
+
1
]
=
{
#
include
<
freetype
/
internal
/
fttrace
.
h
>
NULL
}
;
#
undef
FT_TRACE_DEF
FT_BASE_DEF
(
FT_Int
)
FT_Trace_Get_Count
(
void
)
{
return
trace_count
;
}
FT_BASE_DEF
(
const
char
*
)
FT_Trace_Get_Name
(
FT_Int
idx
)
{
int
max
=
FT_Trace_Get_Count
(
)
;
if
(
idx
<
max
)
return
ft_trace_toggles
[
idx
]
;
else
return
NULL
;
}
FT_BASE_DEF
(
void
)
FT_Trace_Disable
(
void
)
{
ft_trace_levels
=
ft_trace_levels_disabled
;
}
FT_BASE_DEF
(
void
)
FT_Trace_Enable
(
void
)
{
ft_trace_levels
=
ft_trace_levels_enabled
;
}
FT_BASE_DEF
(
void
)
ft_debug_init
(
void
)
{
const
char
*
ft2_debug
=
NULL
;
if
(
ft2_debug
)
{
const
char
*
p
=
ft2_debug
;
const
char
*
q
;
for
(
;
*
p
;
p
+
+
)
{
if
(
*
p
=
=
'
'
|
|
*
p
=
=
'
\
t
'
|
|
*
p
=
=
'
'
|
|
*
p
=
=
'
;
'
|
|
*
p
=
=
'
=
'
)
continue
;
q
=
p
;
while
(
*
p
&
&
*
p
!
=
'
:
'
)
p
+
+
;
if
(
!
*
p
)
break
;
if
(
*
p
=
=
'
:
'
&
&
p
>
q
)
{
FT_Int
n
i
len
=
(
FT_Int
)
(
p
-
q
)
;
FT_Int
level
=
-
1
found
=
-
1
;
for
(
n
=
0
;
n
<
trace_count
;
n
+
+
)
{
const
char
*
toggle
=
ft_trace_toggles
[
n
]
;
for
(
i
=
0
;
i
<
len
;
i
+
+
)
{
if
(
toggle
[
i
]
!
=
q
[
i
]
)
break
;
}
if
(
i
=
=
len
&
&
toggle
[
i
]
=
=
0
)
{
found
=
n
;
break
;
}
}
p
+
+
;
if
(
*
p
)
{
level
=
*
p
-
'
0
'
;
if
(
level
<
0
|
|
level
>
7
)
level
=
-
1
;
}
if
(
found
>
=
0
&
&
level
>
=
0
)
{
if
(
found
=
=
trace_any
)
{
for
(
n
=
0
;
n
<
trace_count
;
n
+
+
)
ft_trace_levels_enabled
[
n
]
=
level
;
}
else
ft_trace_levels_enabled
[
found
]
=
level
;
}
}
}
}
ft_trace_levels
=
ft_trace_levels_enabled
;
}
#
else
FT_BASE_DEF
(
void
)
ft_debug_init
(
void
)
{
}
FT_BASE_DEF
(
FT_Int
)
FT_Trace_Get_Count
(
void
)
{
return
0
;
}
FT_BASE_DEF
(
const
char
*
)
FT_Trace_Get_Name
(
FT_Int
idx
)
{
FT_UNUSED
(
idx
)
;
return
NULL
;
}
FT_BASE_DEF
(
void
)
FT_Trace_Disable
(
void
)
{
}
FT_BASE_DEF
(
void
)
FT_Trace_Enable
(
void
)
{
}
#
endif
