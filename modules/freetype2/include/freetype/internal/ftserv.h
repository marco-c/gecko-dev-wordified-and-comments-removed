#
ifndef
FTSERV_H_
#
define
FTSERV_H_
#
include
"
compiler
-
macros
.
h
"
FT_BEGIN_HEADER
#
ifdef
__cplusplus
#
define
FT_FACE_FIND_SERVICE
(
face
ptr
id
)
\
FT_BEGIN_STMNT
\
FT_Module
module
=
FT_MODULE
(
FT_FACE
(
face
)
-
>
driver
)
;
\
FT_Pointer
_tmp_
=
NULL
;
\
FT_Pointer
*
_pptr_
=
(
FT_Pointer
*
)
&
(
ptr
)
;
\
\
\
if
(
module
-
>
clazz
-
>
get_interface
)
\
_tmp_
=
module
-
>
clazz
-
>
get_interface
(
module
FT_SERVICE_ID_
#
#
id
)
;
\
*
_pptr_
=
_tmp_
;
\
FT_END_STMNT
#
else
#
define
FT_FACE_FIND_SERVICE
(
face
ptr
id
)
\
FT_BEGIN_STMNT
\
FT_Module
module
=
FT_MODULE
(
FT_FACE
(
face
)
-
>
driver
)
;
\
FT_Pointer
_tmp_
=
NULL
;
\
\
if
(
module
-
>
clazz
-
>
get_interface
)
\
_tmp_
=
module
-
>
clazz
-
>
get_interface
(
module
FT_SERVICE_ID_
#
#
id
)
;
\
ptr
=
_tmp_
;
\
FT_END_STMNT
#
endif
#
ifdef
__cplusplus
#
define
FT_FACE_FIND_GLOBAL_SERVICE
(
face
ptr
id
)
\
FT_BEGIN_STMNT
\
FT_Module
module
=
FT_MODULE
(
FT_FACE
(
face
)
-
>
driver
)
;
\
FT_Pointer
_tmp_
;
\
FT_Pointer
*
_pptr_
=
(
FT_Pointer
*
)
&
(
ptr
)
;
\
\
\
_tmp_
=
ft_module_get_service
(
module
FT_SERVICE_ID_
#
#
id
1
)
;
\
*
_pptr_
=
_tmp_
;
\
FT_END_STMNT
#
else
#
define
FT_FACE_FIND_GLOBAL_SERVICE
(
face
ptr
id
)
\
FT_BEGIN_STMNT
\
FT_Module
module
=
FT_MODULE
(
FT_FACE
(
face
)
-
>
driver
)
;
\
FT_Pointer
_tmp_
;
\
\
\
_tmp_
=
ft_module_get_service
(
module
FT_SERVICE_ID_
#
#
id
1
)
;
\
ptr
=
_tmp_
;
\
FT_END_STMNT
#
endif
typedef
struct
FT_ServiceDescRec_
{
const
char
*
serv_id
;
const
void
*
serv_data
;
}
FT_ServiceDescRec
;
typedef
const
FT_ServiceDescRec
*
FT_ServiceDesc
;
#
define
FT_DEFINE_SERVICEDESCREC1
(
class_
\
serv_id_1
serv_data_1
)
\
static
const
FT_ServiceDescRec
class_
[
]
=
\
{
\
{
serv_id_1
serv_data_1
}
\
{
NULL
NULL
}
\
}
;
#
define
FT_DEFINE_SERVICEDESCREC2
(
class_
\
serv_id_1
serv_data_1
\
serv_id_2
serv_data_2
)
\
static
const
FT_ServiceDescRec
class_
[
]
=
\
{
\
{
serv_id_1
serv_data_1
}
\
{
serv_id_2
serv_data_2
}
\
{
NULL
NULL
}
\
}
;
#
define
FT_DEFINE_SERVICEDESCREC3
(
class_
\
serv_id_1
serv_data_1
\
serv_id_2
serv_data_2
\
serv_id_3
serv_data_3
)
\
static
const
FT_ServiceDescRec
class_
[
]
=
\
{
\
{
serv_id_1
serv_data_1
}
\
{
serv_id_2
serv_data_2
}
\
{
serv_id_3
serv_data_3
}
\
{
NULL
NULL
}
\
}
;
#
define
FT_DEFINE_SERVICEDESCREC4
(
class_
\
serv_id_1
serv_data_1
\
serv_id_2
serv_data_2
\
serv_id_3
serv_data_3
\
serv_id_4
serv_data_4
)
\
static
const
FT_ServiceDescRec
class_
[
]
=
\
{
\
{
serv_id_1
serv_data_1
}
\
{
serv_id_2
serv_data_2
}
\
{
serv_id_3
serv_data_3
}
\
{
serv_id_4
serv_data_4
}
\
{
NULL
NULL
}
\
}
;
#
define
FT_DEFINE_SERVICEDESCREC5
(
class_
\
serv_id_1
serv_data_1
\
serv_id_2
serv_data_2
\
serv_id_3
serv_data_3
\
serv_id_4
serv_data_4
\
serv_id_5
serv_data_5
)
\
static
const
FT_ServiceDescRec
class_
[
]
=
\
{
\
{
serv_id_1
serv_data_1
}
\
{
serv_id_2
serv_data_2
}
\
{
serv_id_3
serv_data_3
}
\
{
serv_id_4
serv_data_4
}
\
{
serv_id_5
serv_data_5
}
\
{
NULL
NULL
}
\
}
;
#
define
FT_DEFINE_SERVICEDESCREC6
(
class_
\
serv_id_1
serv_data_1
\
serv_id_2
serv_data_2
\
serv_id_3
serv_data_3
\
serv_id_4
serv_data_4
\
serv_id_5
serv_data_5
\
serv_id_6
serv_data_6
)
\
static
const
FT_ServiceDescRec
class_
[
]
=
\
{
\
{
serv_id_1
serv_data_1
}
\
{
serv_id_2
serv_data_2
}
\
{
serv_id_3
serv_data_3
}
\
{
serv_id_4
serv_data_4
}
\
{
serv_id_5
serv_data_5
}
\
{
serv_id_6
serv_data_6
}
\
{
NULL
NULL
}
\
}
;
#
define
FT_DEFINE_SERVICEDESCREC7
(
class_
\
serv_id_1
serv_data_1
\
serv_id_2
serv_data_2
\
serv_id_3
serv_data_3
\
serv_id_4
serv_data_4
\
serv_id_5
serv_data_5
\
serv_id_6
serv_data_6
\
serv_id_7
serv_data_7
)
\
static
const
FT_ServiceDescRec
class_
[
]
=
\
{
\
{
serv_id_1
serv_data_1
}
\
{
serv_id_2
serv_data_2
}
\
{
serv_id_3
serv_data_3
}
\
{
serv_id_4
serv_data_4
}
\
{
serv_id_5
serv_data_5
}
\
{
serv_id_6
serv_data_6
}
\
{
serv_id_7
serv_data_7
}
\
{
NULL
NULL
}
\
}
;
#
define
FT_DEFINE_SERVICEDESCREC8
(
class_
\
serv_id_1
serv_data_1
\
serv_id_2
serv_data_2
\
serv_id_3
serv_data_3
\
serv_id_4
serv_data_4
\
serv_id_5
serv_data_5
\
serv_id_6
serv_data_6
\
serv_id_7
serv_data_7
\
serv_id_8
serv_data_8
)
\
static
const
FT_ServiceDescRec
class_
[
]
=
\
{
\
{
serv_id_1
serv_data_1
}
\
{
serv_id_2
serv_data_2
}
\
{
serv_id_3
serv_data_3
}
\
{
serv_id_4
serv_data_4
}
\
{
serv_id_5
serv_data_5
}
\
{
serv_id_6
serv_data_6
}
\
{
serv_id_7
serv_data_7
}
\
{
serv_id_8
serv_data_8
}
\
{
NULL
NULL
}
\
}
;
#
define
FT_DEFINE_SERVICEDESCREC9
(
class_
\
serv_id_1
serv_data_1
\
serv_id_2
serv_data_2
\
serv_id_3
serv_data_3
\
serv_id_4
serv_data_4
\
serv_id_5
serv_data_5
\
serv_id_6
serv_data_6
\
serv_id_7
serv_data_7
\
serv_id_8
serv_data_8
\
serv_id_9
serv_data_9
)
\
static
const
FT_ServiceDescRec
class_
[
]
=
\
{
\
{
serv_id_1
serv_data_1
}
\
{
serv_id_2
serv_data_2
}
\
{
serv_id_3
serv_data_3
}
\
{
serv_id_4
serv_data_4
}
\
{
serv_id_5
serv_data_5
}
\
{
serv_id_6
serv_data_6
}
\
{
serv_id_7
serv_data_7
}
\
{
serv_id_8
serv_data_8
}
\
{
serv_id_9
serv_data_9
}
\
{
NULL
NULL
}
\
}
;
#
define
FT_DEFINE_SERVICEDESCREC10
(
class_
\
serv_id_1
serv_data_1
\
serv_id_2
serv_data_2
\
serv_id_3
serv_data_3
\
serv_id_4
serv_data_4
\
serv_id_5
serv_data_5
\
serv_id_6
serv_data_6
\
serv_id_7
serv_data_7
\
serv_id_8
serv_data_8
\
serv_id_9
serv_data_9
\
serv_id_10
serv_data_10
)
\
static
const
FT_ServiceDescRec
class_
[
]
=
\
{
\
{
serv_id_1
serv_data_1
}
\
{
serv_id_2
serv_data_2
}
\
{
serv_id_3
serv_data_3
}
\
{
serv_id_4
serv_data_4
}
\
{
serv_id_5
serv_data_5
}
\
{
serv_id_6
serv_data_6
}
\
{
serv_id_7
serv_data_7
}
\
{
serv_id_8
serv_data_8
}
\
{
serv_id_9
serv_data_9
}
\
{
serv_id_10
serv_data_10
}
\
{
NULL
NULL
}
\
}
;
FT_BASE
(
FT_Pointer
)
ft_service_list_lookup
(
FT_ServiceDesc
service_descriptors
const
char
*
service_id
)
;
typedef
struct
FT_ServiceCacheRec_
{
FT_Pointer
service_POSTSCRIPT_FONT_NAME
;
FT_Pointer
service_MULTI_MASTERS
;
FT_Pointer
service_METRICS_VARIATIONS
;
FT_Pointer
service_GLYPH_DICT
;
FT_Pointer
service_PFR_METRICS
;
FT_Pointer
service_WINFNT
;
}
FT_ServiceCacheRec
*
FT_ServiceCache
;
#
define
FT_SERVICE_UNAVAILABLE
(
(
FT_Pointer
)
~
(
FT_PtrDist
)
1
)
#
ifdef
__cplusplus
#
define
FT_FACE_LOOKUP_SERVICE
(
face
ptr
id
)
\
FT_BEGIN_STMNT
\
FT_Pointer
svc
;
\
FT_Pointer
*
Pptr
=
(
FT_Pointer
*
)
&
(
ptr
)
;
\
\
\
svc
=
FT_FACE
(
face
)
-
>
internal
-
>
services
.
service_
#
#
id
;
\
if
(
svc
=
=
FT_SERVICE_UNAVAILABLE
)
\
svc
=
NULL
;
\
else
if
(
svc
=
=
NULL
)
\
{
\
FT_FACE_FIND_SERVICE
(
face
svc
id
)
;
\
\
FT_FACE
(
face
)
-
>
internal
-
>
services
.
service_
#
#
id
=
\
(
FT_Pointer
)
(
svc
!
=
NULL
?
svc
\
:
FT_SERVICE_UNAVAILABLE
)
;
\
}
\
*
Pptr
=
svc
;
\
FT_END_STMNT
#
else
#
define
FT_FACE_LOOKUP_SERVICE
(
face
ptr
id
)
\
FT_BEGIN_STMNT
\
FT_Pointer
svc
;
\
\
\
svc
=
FT_FACE
(
face
)
-
>
internal
-
>
services
.
service_
#
#
id
;
\
if
(
svc
=
=
FT_SERVICE_UNAVAILABLE
)
\
svc
=
NULL
;
\
else
if
(
svc
=
=
NULL
)
\
{
\
FT_FACE_FIND_SERVICE
(
face
svc
id
)
;
\
\
FT_FACE
(
face
)
-
>
internal
-
>
services
.
service_
#
#
id
=
\
(
FT_Pointer
)
(
svc
!
=
NULL
?
svc
\
:
FT_SERVICE_UNAVAILABLE
)
;
\
}
\
ptr
=
svc
;
\
FT_END_STMNT
#
endif
#
define
FT_DEFINE_SERVICE
(
name
)
\
typedef
struct
FT_Service_
#
#
name
#
#
Rec_
\
FT_Service_
#
#
name
#
#
Rec
;
\
typedef
struct
FT_Service_
#
#
name
#
#
Rec_
\
const
*
FT_Service_
#
#
name
;
\
struct
FT_Service_
#
#
name
#
#
Rec_
FT_END_HEADER
#
endif
