#
include
<
ft2build
.
h
>
#
include
FT_CONFIG_CONFIG_H
#
include
FT_INTERNAL_OBJECTS_H
#
include
FT_INTERNAL_DEBUG_H
#
include
FT_MODULE_H
#
undef
FT_COMPONENT
#
define
FT_COMPONENT
init
#
undef
FT_USE_MODULE
#
ifdef
__cplusplus
#
define
FT_USE_MODULE
(
type
x
)
extern
"
C
"
const
type
x
;
#
else
#
define
FT_USE_MODULE
(
type
x
)
extern
const
type
x
;
#
endif
#
include
FT_CONFIG_MODULES_H
#
undef
FT_USE_MODULE
#
define
FT_USE_MODULE
(
type
x
)
(
const
FT_Module_Class
*
)
&
(
x
)
static
const
FT_Module_Class
*
const
ft_default_modules
[
]
=
{
#
include
FT_CONFIG_MODULES_H
0
}
;
FT_EXPORT_DEF
(
void
)
FT_Add_Default_Modules
(
FT_Library
library
)
{
FT_Error
error
;
const
FT_Module_Class
*
const
*
cur
;
cur
=
(
const
FT_Module_Class
*
const
*
)
ft_default_modules
;
while
(
*
cur
)
{
error
=
FT_Add_Module
(
library
*
cur
)
;
if
(
error
)
FT_TRACE0
(
(
"
FT_Add_Default_Module
:
"
"
Cannot
install
%
s
'
error
=
0x
%
x
\
n
"
(
*
cur
)
-
>
module_name
error
)
)
;
cur
+
+
;
}
}
#
ifdef
FT_CONFIG_OPTION_ENVIRONMENT_PROPERTIES
#
define
MAX_LENGTH
128
FT_EXPORT_DEF
(
void
)
FT_Set_Default_Properties
(
FT_Library
library
)
{
const
char
*
env
;
const
char
*
p
;
const
char
*
q
;
char
module_name
[
MAX_LENGTH
+
1
]
;
char
property_name
[
MAX_LENGTH
+
1
]
;
char
property_value
[
MAX_LENGTH
+
1
]
;
int
i
;
env
=
ft_getenv
(
"
FREETYPE_PROPERTIES
"
)
;
if
(
!
env
)
return
;
for
(
p
=
env
;
*
p
;
p
+
+
)
{
if
(
*
p
=
=
'
'
|
|
*
p
=
=
'
\
t
'
)
continue
;
q
=
p
;
for
(
i
=
0
;
i
<
MAX_LENGTH
;
i
+
+
)
{
if
(
!
*
p
|
|
*
p
=
=
'
:
'
)
break
;
module_name
[
i
]
=
*
p
+
+
;
}
module_name
[
i
]
=
'
\
0
'
;
if
(
!
*
p
|
|
*
p
!
=
'
:
'
|
|
p
=
=
q
)
break
;
q
=
+
+
p
;
for
(
i
=
0
;
i
<
MAX_LENGTH
;
i
+
+
)
{
if
(
!
*
p
|
|
*
p
=
=
'
=
'
)
break
;
property_name
[
i
]
=
*
p
+
+
;
}
property_name
[
i
]
=
'
\
0
'
;
if
(
!
*
p
|
|
*
p
!
=
'
=
'
|
|
p
=
=
q
)
break
;
q
=
+
+
p
;
for
(
i
=
0
;
i
<
MAX_LENGTH
;
i
+
+
)
{
if
(
!
*
p
|
|
*
p
=
=
'
'
|
|
*
p
=
=
'
\
t
'
)
break
;
property_value
[
i
]
=
*
p
+
+
;
}
property_value
[
i
]
=
'
\
0
'
;
if
(
!
(
*
p
=
=
'
\
0
'
|
|
*
p
=
=
'
'
|
|
*
p
=
=
'
\
t
'
)
|
|
p
=
=
q
)
break
;
ft_property_string_set
(
library
module_name
property_name
property_value
)
;
if
(
!
*
p
)
break
;
}
}
#
else
FT_EXPORT_DEF
(
void
)
FT_Set_Default_Properties
(
FT_Library
library
)
{
FT_UNUSED
(
library
)
;
}
#
endif
FT_EXPORT_DEF
(
FT_Error
)
FT_Init_FreeType
(
FT_Library
*
alibrary
)
{
FT_Error
error
;
FT_Memory
memory
;
memory
=
FT_New_Memory
(
)
;
if
(
!
memory
)
{
FT_ERROR
(
(
"
FT_Init_FreeType
:
cannot
find
memory
manager
\
n
"
)
)
;
return
FT_THROW
(
Unimplemented_Feature
)
;
}
error
=
FT_New_Library
(
memory
alibrary
)
;
if
(
error
)
FT_Done_Memory
(
memory
)
;
else
FT_Add_Default_Modules
(
*
alibrary
)
;
FT_Set_Default_Properties
(
*
alibrary
)
;
return
error
;
}
FT_EXPORT_DEF
(
FT_Error
)
FT_Done_FreeType
(
FT_Library
library
)
{
FT_Memory
memory
;
if
(
!
library
)
return
FT_THROW
(
Invalid_Library_Handle
)
;
memory
=
library
-
>
memory
;
FT_Done_Library
(
library
)
;
FT_Done_Memory
(
memory
)
;
return
FT_Err_Ok
;
}
