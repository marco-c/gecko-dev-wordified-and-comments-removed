#
include
"
cidriver
.
h
"
#
include
"
cidgload
.
h
"
#
include
<
freetype
/
internal
/
ftdebug
.
h
>
#
include
<
freetype
/
internal
/
ftpsprop
.
h
>
#
include
"
ciderrs
.
h
"
#
include
<
freetype
/
internal
/
services
/
svpostnm
.
h
>
#
include
<
freetype
/
internal
/
services
/
svfntfmt
.
h
>
#
include
<
freetype
/
internal
/
services
/
svpsinfo
.
h
>
#
include
<
freetype
/
internal
/
services
/
svcid
.
h
>
#
include
<
freetype
/
internal
/
services
/
svprop
.
h
>
#
include
<
freetype
/
ftdriver
.
h
>
#
include
<
freetype
/
internal
/
psaux
.
h
>
#
undef
FT_COMPONENT
#
define
FT_COMPONENT
ciddriver
FT_CALLBACK_DEF
(
const
char
*
)
cid_get_postscript_name
(
FT_Face
face
)
{
CID_Face
cidface
=
(
CID_Face
)
face
;
const
char
*
result
=
cidface
-
>
cid
.
cid_font_name
;
if
(
result
&
&
result
[
0
]
=
=
'
/
'
)
result
+
+
;
return
result
;
}
static
const
FT_Service_PsFontNameRec
cid_service_ps_name
=
{
(
FT_PsName_GetFunc
)
cid_get_postscript_name
}
;
FT_CALLBACK_DEF
(
FT_Error
)
cid_ps_get_font_info
(
FT_Face
face
PS_FontInfoRec
*
afont_info
)
{
*
afont_info
=
(
(
CID_Face
)
face
)
-
>
cid
.
font_info
;
return
FT_Err_Ok
;
}
FT_CALLBACK_DEF
(
FT_Error
)
cid_ps_get_font_extra
(
FT_Face
face
PS_FontExtraRec
*
afont_extra
)
{
*
afont_extra
=
(
(
CID_Face
)
face
)
-
>
font_extra
;
return
FT_Err_Ok
;
}
static
const
FT_Service_PsInfoRec
cid_service_ps_info
=
{
cid_ps_get_font_info
cid_ps_get_font_extra
NULL
NULL
NULL
}
;
FT_CALLBACK_DEF
(
FT_Error
)
cid_get_ros
(
FT_Face
face
const
char
*
*
registry
const
char
*
*
ordering
FT_Int
*
supplement
)
{
CID_Face
cidface
=
(
CID_Face
)
face
;
CID_FaceInfo
cid
=
&
cidface
-
>
cid
;
if
(
registry
)
*
registry
=
cid
-
>
registry
;
if
(
ordering
)
*
ordering
=
cid
-
>
ordering
;
if
(
supplement
)
*
supplement
=
cid
-
>
supplement
;
return
FT_Err_Ok
;
}
FT_CALLBACK_DEF
(
FT_Error
)
cid_get_is_cid
(
FT_Face
face
FT_Bool
*
is_cid
)
{
FT_Error
error
=
FT_Err_Ok
;
FT_UNUSED
(
face
)
;
if
(
is_cid
)
*
is_cid
=
1
;
return
error
;
}
FT_CALLBACK_DEF
(
FT_Error
)
cid_get_cid_from_glyph_index
(
FT_Face
face
FT_UInt
glyph_index
FT_UInt
*
cid
)
{
FT_Error
error
=
FT_Err_Ok
;
CID_Face
cidface
=
(
CID_Face
)
face
;
error
=
cid_compute_fd_and_offsets
(
cidface
glyph_index
NULL
NULL
NULL
)
;
if
(
error
)
*
cid
=
0
;
else
*
cid
=
glyph_index
;
return
error
;
}
static
const
FT_Service_CIDRec
cid_service_cid_info
=
{
cid_get_ros
cid_get_is_cid
cid_get_cid_from_glyph_index
}
;
FT_DEFINE_SERVICE_PROPERTIESREC
(
cid_service_properties
ps_property_set
ps_property_get
)
static
const
FT_ServiceDescRec
cid_services
[
]
=
{
{
FT_SERVICE_ID_FONT_FORMAT
FT_FONT_FORMAT_CID
}
{
FT_SERVICE_ID_POSTSCRIPT_FONT_NAME
&
cid_service_ps_name
}
{
FT_SERVICE_ID_POSTSCRIPT_INFO
&
cid_service_ps_info
}
{
FT_SERVICE_ID_CID
&
cid_service_cid_info
}
{
FT_SERVICE_ID_PROPERTIES
&
cid_service_properties
}
{
NULL
NULL
}
}
;
FT_CALLBACK_DEF
(
FT_Module_Interface
)
cid_get_interface
(
FT_Module
module
const
char
*
cid_interface
)
{
FT_UNUSED
(
module
)
;
return
ft_service_list_lookup
(
cid_services
cid_interface
)
;
}
FT_CALLBACK_TABLE_DEF
const
FT_Driver_ClassRec
t1cid_driver_class
=
{
{
FT_MODULE_FONT_DRIVER
|
FT_MODULE_DRIVER_SCALABLE
|
FT_MODULE_DRIVER_HAS_HINTER
sizeof
(
PS_DriverRec
)
"
t1cid
"
0x10000L
0x20000L
NULL
cid_driver_init
cid_driver_done
cid_get_interface
}
sizeof
(
CID_FaceRec
)
sizeof
(
CID_SizeRec
)
sizeof
(
CID_GlyphSlotRec
)
cid_face_init
cid_face_done
cid_size_init
cid_size_done
cid_slot_init
cid_slot_done
cid_slot_load_glyph
NULL
NULL
NULL
cid_size_request
NULL
}
;
