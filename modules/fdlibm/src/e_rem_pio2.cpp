#
include
<
float
.
h
>
#
include
"
mozilla
/
Attributes
.
h
"
#
include
"
math_private
.
h
"
static
const
double
zero
=
0
.
00000000000000000000e
+
00
two24
=
1
.
67772160000000000000e
+
07
invpio2
=
6
.
36619772367581382433e
-
01
pio2_1
=
1
.
57079632673412561417e
+
00
pio2_1t
=
6
.
07710050650619224932e
-
11
pio2_2
=
6
.
07710050630396597660e
-
11
pio2_2t
=
2
.
02226624879595063154e
-
21
pio2_3
=
2
.
02226624871116645580e
-
21
pio2_3t
=
8
.
47842766036889956997e
-
32
;
#
ifdef
INLINE_REM_PIO2
static
MOZ_ALWAYS_INLINE
#
endif
int
__ieee754_rem_pio2
(
double
x
double
*
y
)
{
double
z
w
t
r
fn
;
double
tx
[
3
]
ty
[
2
]
;
int32_t
e0
i
j
nx
n
ix
hx
;
u_int32_t
low
;
GET_HIGH_WORD
(
hx
x
)
;
ix
=
hx
&
0x7fffffff
;
#
if
0
if
(
ix
<
=
0x3fe921fb
)
{
y
[
0
]
=
x
;
y
[
1
]
=
0
;
return
0
;
}
#
endif
if
(
ix
<
=
0x400f6a7a
)
{
if
(
(
ix
&
0xfffff
)
=
=
0x921fb
)
goto
medium
;
if
(
ix
<
=
0x4002d97c
)
{
if
(
hx
>
0
)
{
z
=
x
-
pio2_1
;
y
[
0
]
=
z
-
pio2_1t
;
y
[
1
]
=
(
z
-
y
[
0
]
)
-
pio2_1t
;
return
1
;
}
else
{
z
=
x
+
pio2_1
;
y
[
0
]
=
z
+
pio2_1t
;
y
[
1
]
=
(
z
-
y
[
0
]
)
+
pio2_1t
;
return
-
1
;
}
}
else
{
if
(
hx
>
0
)
{
z
=
x
-
2
*
pio2_1
;
y
[
0
]
=
z
-
2
*
pio2_1t
;
y
[
1
]
=
(
z
-
y
[
0
]
)
-
2
*
pio2_1t
;
return
2
;
}
else
{
z
=
x
+
2
*
pio2_1
;
y
[
0
]
=
z
+
2
*
pio2_1t
;
y
[
1
]
=
(
z
-
y
[
0
]
)
+
2
*
pio2_1t
;
return
-
2
;
}
}
}
if
(
ix
<
=
0x401c463b
)
{
if
(
ix
<
=
0x4015fdbc
)
{
if
(
ix
=
=
0x4012d97c
)
goto
medium
;
if
(
hx
>
0
)
{
z
=
x
-
3
*
pio2_1
;
y
[
0
]
=
z
-
3
*
pio2_1t
;
y
[
1
]
=
(
z
-
y
[
0
]
)
-
3
*
pio2_1t
;
return
3
;
}
else
{
z
=
x
+
3
*
pio2_1
;
y
[
0
]
=
z
+
3
*
pio2_1t
;
y
[
1
]
=
(
z
-
y
[
0
]
)
+
3
*
pio2_1t
;
return
-
3
;
}
}
else
{
if
(
ix
=
=
0x401921fb
)
goto
medium
;
if
(
hx
>
0
)
{
z
=
x
-
4
*
pio2_1
;
y
[
0
]
=
z
-
4
*
pio2_1t
;
y
[
1
]
=
(
z
-
y
[
0
]
)
-
4
*
pio2_1t
;
return
4
;
}
else
{
z
=
x
+
4
*
pio2_1
;
y
[
0
]
=
z
+
4
*
pio2_1t
;
y
[
1
]
=
(
z
-
y
[
0
]
)
+
4
*
pio2_1t
;
return
-
4
;
}
}
}
if
(
ix
<
0x413921fb
)
{
medium
:
double
const_0x1_8p52
=
pow
(
2
52
)
+
pow
(
2
51
)
;
STRICT_ASSIGN
(
double
fn
x
*
invpio2
+
const_0x1_8p52
)
;
fn
=
fn
-
const_0x1_8p52
;
#
ifdef
HAVE_EFFICIENT_IRINT
n
=
irint
(
fn
)
;
#
else
n
=
(
int32_t
)
fn
;
#
endif
r
=
x
-
fn
*
pio2_1
;
w
=
fn
*
pio2_1t
;
{
u_int32_t
high
;
j
=
ix
>
>
20
;
y
[
0
]
=
r
-
w
;
GET_HIGH_WORD
(
high
y
[
0
]
)
;
i
=
j
-
(
(
high
>
>
20
)
&
0x7ff
)
;
if
(
i
>
16
)
{
t
=
r
;
w
=
fn
*
pio2_2
;
r
=
t
-
w
;
w
=
fn
*
pio2_2t
-
(
(
t
-
r
)
-
w
)
;
y
[
0
]
=
r
-
w
;
GET_HIGH_WORD
(
high
y
[
0
]
)
;
i
=
j
-
(
(
high
>
>
20
)
&
0x7ff
)
;
if
(
i
>
49
)
{
t
=
r
;
w
=
fn
*
pio2_3
;
r
=
t
-
w
;
w
=
fn
*
pio2_3t
-
(
(
t
-
r
)
-
w
)
;
y
[
0
]
=
r
-
w
;
}
}
}
y
[
1
]
=
(
r
-
y
[
0
]
)
-
w
;
return
n
;
}
if
(
ix
>
=
0x7ff00000
)
{
y
[
0
]
=
y
[
1
]
=
x
-
x
;
return
0
;
}
GET_LOW_WORD
(
low
x
)
;
e0
=
(
ix
>
>
20
)
-
1046
;
INSERT_WORDS
(
z
ix
-
(
(
int32_t
)
(
e0
<
<
20
)
)
low
)
;
for
(
i
=
0
;
i
<
2
;
i
+
+
)
{
tx
[
i
]
=
(
double
)
(
(
int32_t
)
(
z
)
)
;
z
=
(
z
-
tx
[
i
]
)
*
two24
;
}
tx
[
2
]
=
z
;
nx
=
3
;
while
(
tx
[
nx
-
1
]
=
=
zero
)
nx
-
-
;
n
=
__kernel_rem_pio2
(
tx
ty
e0
nx
1
)
;
if
(
hx
<
0
)
{
y
[
0
]
=
-
ty
[
0
]
;
y
[
1
]
=
-
ty
[
1
]
;
return
-
n
;
}
y
[
0
]
=
ty
[
0
]
;
y
[
1
]
=
ty
[
1
]
;
return
n
;
}
