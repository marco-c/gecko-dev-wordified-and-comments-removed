#
ifndef
BROTLI_ENC_CONTEXT_H_
#
define
BROTLI_ENC_CONTEXT_H_
#
include
<
brotli
/
port
.
h
>
#
include
<
brotli
/
types
.
h
>
#
if
defined
(
__cplusplus
)
|
|
defined
(
c_plusplus
)
extern
"
C
"
{
#
endif
static
const
uint8_t
kUTF8ContextLookup
[
512
]
=
{
0
0
0
0
0
0
0
0
0
4
4
0
0
4
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
8
12
16
12
12
20
12
16
24
28
12
12
32
12
36
12
44
44
44
44
44
44
44
44
44
44
32
32
24
40
28
12
12
48
52
52
52
48
52
52
52
48
52
52
52
52
52
48
52
52
52
52
52
48
52
52
52
52
52
24
12
28
12
12
12
56
60
60
60
56
60
60
60
56
60
60
60
60
60
56
60
60
60
60
60
56
60
60
60
60
60
24
12
28
12
0
0
1
0
1
0
1
0
1
0
1
0
1
0
1
0
1
0
1
0
1
0
1
0
1
0
1
0
1
0
1
0
1
0
1
0
1
0
1
0
1
0
1
0
1
0
1
0
1
0
1
0
1
0
1
0
1
0
1
0
1
0
1
0
1
2
3
2
3
2
3
2
3
2
3
2
3
2
3
2
3
2
3
2
3
2
3
2
3
2
3
2
3
2
3
2
3
2
3
2
3
2
3
2
3
2
3
2
3
2
3
2
3
2
3
2
3
2
3
2
3
2
3
2
3
2
3
2
3
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
1
1
1
1
1
1
1
1
1
1
1
1
1
1
1
2
2
2
2
2
2
2
2
2
2
1
1
1
1
1
1
1
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
1
1
1
1
1
1
3
3
3
3
3
3
3
3
3
3
3
3
3
3
3
3
3
3
3
3
3
3
3
3
3
3
1
1
1
1
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
}
;
static
const
uint8_t
kSigned3BitContextLookup
[
]
=
{
0
1
1
1
1
1
1
1
1
1
1
1
1
1
1
1
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
3
3
3
3
3
3
3
3
3
3
3
3
3
3
3
3
3
3
3
3
3
3
3
3
3
3
3
3
3
3
3
3
3
3
3
3
3
3
3
3
3
3
3
3
3
3
3
3
3
3
3
3
3
3
3
3
3
3
3
3
3
3
3
3
4
4
4
4
4
4
4
4
4
4
4
4
4
4
4
4
4
4
4
4
4
4
4
4
4
4
4
4
4
4
4
4
4
4
4
4
4
4
4
4
4
4
4
4
4
4
4
4
4
4
4
4
4
4
4
4
4
4
4
4
4
4
4
4
5
5
5
5
5
5
5
5
5
5
5
5
5
5
5
5
5
5
5
5
5
5
5
5
5
5
5
5
5
5
5
5
5
5
5
5
5
5
5
5
5
5
5
5
5
5
5
5
6
6
6
6
6
6
6
6
6
6
6
6
6
6
6
7
}
;
typedef
enum
ContextType
{
CONTEXT_LSB6
=
0
CONTEXT_MSB6
=
1
CONTEXT_UTF8
=
2
CONTEXT_SIGNED
=
3
}
ContextType
;
static
BROTLI_INLINE
uint8_t
Context
(
uint8_t
p1
uint8_t
p2
ContextType
mode
)
{
switch
(
mode
)
{
case
CONTEXT_LSB6
:
return
p1
&
0x3f
;
case
CONTEXT_MSB6
:
return
(
uint8_t
)
(
p1
>
>
2
)
;
case
CONTEXT_UTF8
:
return
kUTF8ContextLookup
[
p1
]
|
kUTF8ContextLookup
[
p2
+
256
]
;
case
CONTEXT_SIGNED
:
return
(
uint8_t
)
(
(
kSigned3BitContextLookup
[
p1
]
<
<
3
)
+
kSigned3BitContextLookup
[
p2
]
)
;
default
:
return
0
;
}
}
#
if
defined
(
__cplusplus
)
|
|
defined
(
c_plusplus
)
}
#
endif
#
endif
