#
ifndef
BROTLI_ENC_ENCODER_DICT_H_
#
define
BROTLI_ENC_ENCODER_DICT_H_
#
include
"
.
.
/
common
/
dictionary
.
h
"
#
include
<
brotli
/
shared_dictionary
.
h
>
#
include
"
.
.
/
common
/
platform
.
h
"
#
include
"
compound_dictionary
.
h
"
#
include
"
memory
.
h
"
#
include
"
static_dict_lut
.
h
"
#
if
defined
(
__cplusplus
)
|
|
defined
(
c_plusplus
)
extern
"
C
"
{
#
endif
typedef
struct
BrotliTrieNode
{
uint8_t
single
;
uint8_t
c
;
uint8_t
len_
;
uint32_t
idx_
;
uint32_t
sub
;
}
BrotliTrieNode
;
typedef
struct
BrotliTrie
{
BrotliTrieNode
*
pool
;
size_t
pool_capacity
;
size_t
pool_size
;
BrotliTrieNode
root
;
}
BrotliTrie
;
#
if
defined
(
BROTLI_EXPERIMENTAL
)
BROTLI_INTERNAL
const
BrotliTrieNode
*
BrotliTrieSub
(
const
BrotliTrie
*
trie
const
BrotliTrieNode
*
node
uint8_t
c
)
;
#
endif
typedef
struct
BrotliEncoderDictionary
{
const
BrotliDictionary
*
words
;
uint32_t
num_transforms
;
uint32_t
cutoffTransformsCount
;
uint64_t
cutoffTransforms
;
const
uint16_t
*
hash_table_words
;
const
uint8_t
*
hash_table_lengths
;
const
uint16_t
*
buckets
;
const
DictWord
*
dict_words
;
BrotliTrie
trie
;
BROTLI_BOOL
has_words_heavy
;
const
struct
ContextualEncoderDictionary
*
parent
;
uint16_t
*
hash_table_data_words_
;
uint8_t
*
hash_table_data_lengths_
;
size_t
buckets_alloc_size_
;
uint16_t
*
buckets_data_
;
size_t
dict_words_alloc_size_
;
DictWord
*
dict_words_data_
;
BrotliDictionary
*
words_instance_
;
}
BrotliEncoderDictionary
;
typedef
struct
ContextualEncoderDictionary
{
BROTLI_BOOL
context_based
;
uint8_t
num_dictionaries
;
uint8_t
context_map
[
SHARED_BROTLI_NUM_DICTIONARY_CONTEXTS
]
;
const
BrotliEncoderDictionary
*
dict
[
SHARED_BROTLI_NUM_DICTIONARY_CONTEXTS
]
;
size_t
num_instances_
;
BrotliEncoderDictionary
instance_
;
BrotliEncoderDictionary
*
instances_
;
}
ContextualEncoderDictionary
;
typedef
struct
SharedEncoderDictionary
{
uint32_t
magic
;
CompoundDictionary
compound
;
ContextualEncoderDictionary
contextual
;
int
max_quality
;
}
SharedEncoderDictionary
;
typedef
struct
ManagedDictionary
{
uint32_t
magic
;
MemoryManager
memory_manager_
;
uint32_t
*
dictionary
;
}
ManagedDictionary
;
BROTLI_INTERNAL
void
BrotliInitSharedEncoderDictionary
(
SharedEncoderDictionary
*
dict
)
;
#
if
defined
(
BROTLI_EXPERIMENTAL
)
BROTLI_INTERNAL
BROTLI_BOOL
BrotliInitCustomSharedEncoderDictionary
(
MemoryManager
*
m
const
uint8_t
*
encoded_dict
size_t
size
int
quality
SharedEncoderDictionary
*
dict
)
;
#
endif
BROTLI_INTERNAL
void
BrotliCleanupSharedEncoderDictionary
(
MemoryManager
*
m
SharedEncoderDictionary
*
dict
)
;
BROTLI_INTERNAL
ManagedDictionary
*
BrotliCreateManagedDictionary
(
brotli_alloc_func
alloc_func
brotli_free_func
free_func
void
*
opaque
)
;
BROTLI_INTERNAL
void
BrotliDestroyManagedDictionary
(
ManagedDictionary
*
dictionary
)
;
#
if
defined
(
__cplusplus
)
|
|
defined
(
c_plusplus
)
}
#
endif
#
endif
