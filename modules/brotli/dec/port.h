#
ifndef
BROTLI_DEC_PORT_H_
#
define
BROTLI_DEC_PORT_H_
#
if
defined
(
BROTLI_ENABLE_LOG
)
|
|
defined
(
BROTLI_DEBUG
)
#
include
<
assert
.
h
>
#
include
<
stdio
.
h
>
#
endif
#
include
<
brotli
/
port
.
h
>
#
if
defined
(
__arm__
)
|
|
defined
(
__thumb__
)
|
|
\
defined
(
_M_ARM
)
|
|
defined
(
_M_ARMT
)
|
|
defined
(
__ARM64_ARCH_8__
)
#
define
BROTLI_TARGET_ARM
#
if
(
defined
(
__ARM_ARCH
)
&
&
(
__ARM_ARCH
=
=
7
)
)
|
|
\
(
defined
(
M_ARM
)
&
&
(
M_ARM
=
=
7
)
)
#
define
BROTLI_TARGET_ARMV7
#
endif
#
if
defined
(
__aarch64__
)
|
|
defined
(
__ARM64_ARCH_8__
)
#
define
BROTLI_TARGET_ARMV8
#
endif
#
endif
#
if
defined
(
__i386
)
|
|
defined
(
_M_IX86
)
#
define
BROTLI_TARGET_X86
#
endif
#
if
defined
(
__x86_64__
)
|
|
defined
(
_M_X64
)
#
define
BROTLI_TARGET_X64
#
endif
#
if
defined
(
__PPC64__
)
#
define
BROTLI_TARGET_POWERPC64
#
endif
#
ifdef
BROTLI_BUILD_PORTABLE
#
define
BROTLI_ALIGNED_READ
(
!
!
1
)
#
elif
defined
(
BROTLI_TARGET_X86
)
|
|
defined
(
BROTLI_TARGET_X64
)
|
|
\
defined
(
BROTLI_TARGET_ARMV7
)
|
|
defined
(
BROTLI_TARGET_ARMV8
)
#
define
BROTLI_ALIGNED_READ
(
!
!
0
)
#
else
#
define
BROTLI_ALIGNED_READ
(
!
!
1
)
#
endif
#
if
BROTLI_MODERN_COMPILER
|
|
__has_builtin
(
__builtin_constant_p
)
#
define
IS_CONSTANT
(
x
)
(
!
!
__builtin_constant_p
(
x
)
)
#
else
#
define
IS_CONSTANT
(
x
)
(
!
!
0
)
#
endif
#
ifdef
BROTLI_ENABLE_LOG
#
define
BROTLI_DCHECK
(
x
)
assert
(
x
)
#
define
BROTLI_LOG
(
x
)
printf
x
#
else
#
define
BROTLI_DCHECK
(
x
)
#
define
BROTLI_LOG
(
x
)
#
endif
#
if
defined
(
BROTLI_DEBUG
)
|
|
defined
(
BROTLI_ENABLE_LOG
)
static
BROTLI_INLINE
void
BrotliDump
(
const
char
*
f
int
l
const
char
*
fn
)
{
fprintf
(
stderr
"
%
s
:
%
d
(
%
s
)
\
n
"
f
l
fn
)
;
fflush
(
stderr
)
;
}
#
define
BROTLI_DUMP
(
)
BrotliDump
(
__FILE__
__LINE__
__FUNCTION__
)
#
else
#
define
BROTLI_DUMP
(
)
(
void
)
(
0
)
#
endif
#
if
defined
(
BROTLI_BUILD_64_BIT
)
#
define
BROTLI_64_BITS
1
#
elif
defined
(
BROTLI_BUILD_32_BIT
)
#
define
BROTLI_64_BITS
0
#
elif
defined
(
BROTLI_TARGET_X64
)
|
|
defined
(
BROTLI_TARGET_ARMV8
)
|
|
\
defined
(
BROTLI_TARGET_POWERPC64
)
#
define
BROTLI_64_BITS
1
#
else
#
define
BROTLI_64_BITS
0
#
endif
#
if
(
BROTLI_64_BITS
)
#
define
reg_t
uint64_t
#
else
#
define
reg_t
uint32_t
#
endif
#
if
defined
(
BROTLI_BUILD_BIG_ENDIAN
)
#
define
BROTLI_LITTLE_ENDIAN
0
#
define
BROTLI_BIG_ENDIAN
1
#
elif
defined
(
BROTLI_BUILD_LITTLE_ENDIAN
)
#
define
BROTLI_LITTLE_ENDIAN
1
#
define
BROTLI_BIG_ENDIAN
0
#
elif
defined
(
BROTLI_BUILD_ENDIAN_NEUTRAL
)
#
define
BROTLI_LITTLE_ENDIAN
0
#
define
BROTLI_BIG_ENDIAN
0
#
elif
defined
(
__BYTE_ORDER__
)
&
&
(
__BYTE_ORDER__
=
=
__ORDER_LITTLE_ENDIAN__
)
#
define
BROTLI_LITTLE_ENDIAN
1
#
define
BROTLI_BIG_ENDIAN
0
#
elif
defined
(
_WIN32
)
#
define
BROTLI_LITTLE_ENDIAN
1
#
define
BROTLI_BIG_ENDIAN
0
#
else
#
if
(
defined
(
__BYTE_ORDER__
)
&
&
(
__BYTE_ORDER__
=
=
__ORDER_BIG_ENDIAN__
)
)
#
define
BROTLI_BIG_ENDIAN
1
#
else
#
define
BROTLI_BIG_ENDIAN
0
#
endif
#
define
BROTLI_LITTLE_ENDIAN
0
#
endif
#
define
BROTLI_REPEAT
(
N
X
)
{
\
if
(
(
N
&
1
)
!
=
0
)
{
X
;
}
\
if
(
(
N
&
2
)
!
=
0
)
{
X
;
X
;
}
\
if
(
(
N
&
4
)
!
=
0
)
{
X
;
X
;
X
;
X
;
}
\
}
#
if
(
BROTLI_MODERN_COMPILER
|
|
defined
(
__llvm__
)
)
&
&
\
!
defined
(
BROTLI_BUILD_NO_RBIT
)
#
if
defined
(
BROTLI_TARGET_ARMV7
)
|
|
defined
(
BROTLI_TARGET_ARMV8
)
static
BROTLI_INLINE
reg_t
BrotliRBit
(
reg_t
input
)
{
reg_t
output
;
__asm__
(
"
rbit
%
0
%
1
\
n
"
:
"
=
r
"
(
output
)
:
"
r
"
(
input
)
)
;
return
output
;
}
#
define
BROTLI_RBIT
(
x
)
BrotliRBit
(
x
)
#
endif
#
endif
#
if
defined
(
BROTLI_TARGET_ARM
)
#
define
BROTLI_HAS_UBFX
(
!
!
1
)
#
else
#
define
BROTLI_HAS_UBFX
(
!
!
0
)
#
endif
#
define
BROTLI_ALLOC
(
S
L
)
S
-
>
alloc_func
(
S
-
>
memory_manager_opaque
L
)
#
define
BROTLI_FREE
(
S
X
)
{
\
S
-
>
free_func
(
S
-
>
memory_manager_opaque
X
)
;
\
X
=
NULL
;
\
}
#
endif
