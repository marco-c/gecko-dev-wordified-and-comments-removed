add_task
(
async
function
runTests
(
)
{
let
tab
=
await
BrowserTestUtils
.
openNewForegroundTab
(
gBrowser
"
about
:
about
"
)
;
registerCleanupFunction
(
function
(
)
{
gBrowser
.
removeTab
(
tab
)
;
}
)
;
let
browser
=
tab
.
linkedBrowser
;
browser
.
loadURI
(
"
about
:
about
"
)
;
let
href
=
await
BrowserTestUtils
.
browserLoaded
(
browser
)
;
is
(
href
"
about
:
about
"
"
Check
about
:
about
loaded
"
)
;
browser
.
loadURI
(
"
data
:
text
/
html
<
body
%
20onunload
=
'
'
>
<
iframe
>
<
/
iframe
>
<
/
body
>
"
)
;
href
=
await
BrowserTestUtils
.
browserLoaded
(
browser
)
;
is
(
href
"
data
:
text
/
html
<
body
%
20onunload
=
'
'
>
<
iframe
>
<
/
iframe
>
<
/
body
>
"
"
Check
data
URL
loaded
"
)
;
browser
.
goBack
(
)
;
href
=
await
BrowserTestUtils
.
browserLoaded
(
browser
)
;
is
(
href
"
about
:
about
"
"
Check
we
'
ve
gone
back
to
about
:
about
"
)
;
browser
.
goForward
(
)
;
href
=
await
BrowserTestUtils
.
browserLoaded
(
browser
)
;
is
(
href
"
data
:
text
/
html
<
body
%
20onunload
=
'
'
>
<
iframe
>
<
/
iframe
>
<
/
body
>
"
"
Check
we
'
ve
gone
forward
to
data
URL
"
)
;
}
)
;
