add_task
(
async
function
runTests
(
)
{
await
SpecialPowers
.
pushPrefEnv
(
{
set
:
[
[
"
browser
.
navigation
.
requireUserInteraction
"
false
]
]
}
)
;
let
tab
=
await
BrowserTestUtils
.
openNewForegroundTab
(
gBrowser
"
about
:
about
"
)
;
registerCleanupFunction
(
function
(
)
{
gBrowser
.
removeTab
(
tab
)
;
}
)
;
let
browser
=
tab
.
linkedBrowser
;
let
loaded
=
BrowserTestUtils
.
browserLoaded
(
browser
)
;
BrowserTestUtils
.
startLoadingURIString
(
browser
"
about
:
config
"
)
;
let
href
=
await
loaded
;
is
(
href
"
about
:
config
"
"
Check
about
:
config
loaded
"
)
;
loaded
=
BrowserTestUtils
.
browserLoaded
(
browser
)
;
BrowserTestUtils
.
startLoadingURIString
(
browser
"
data
:
text
/
html
<
body
%
20onunload
=
'
'
>
<
iframe
>
<
/
iframe
>
<
/
body
>
"
)
;
href
=
await
loaded
;
is
(
href
"
data
:
text
/
html
<
body
%
20onunload
=
'
'
>
<
iframe
>
<
/
iframe
>
<
/
body
>
"
"
Check
data
URL
loaded
"
)
;
loaded
=
BrowserTestUtils
.
browserLoaded
(
browser
)
;
browser
.
goBack
(
)
;
href
=
await
loaded
;
is
(
href
"
about
:
config
"
"
Check
we
'
ve
gone
back
to
about
:
config
"
)
;
loaded
=
BrowserTestUtils
.
browserLoaded
(
browser
)
;
browser
.
goForward
(
)
;
href
=
await
loaded
;
is
(
href
"
data
:
text
/
html
<
body
%
20onunload
=
'
'
>
<
iframe
>
<
/
iframe
>
<
/
body
>
"
"
Check
we
'
ve
gone
forward
to
data
URL
"
)
;
}
)
;
