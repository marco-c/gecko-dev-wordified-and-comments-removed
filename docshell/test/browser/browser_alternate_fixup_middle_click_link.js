"
use
strict
"
;
add_task
(
async
function
test_alt_fixup_middle_click
(
)
{
await
BrowserTestUtils
.
withNewTab
(
"
about
:
blank
"
async
browser
=
>
{
await
SpecialPowers
.
spawn
(
browser
[
]
(
)
=
>
{
let
link
=
content
.
document
.
createElement
(
"
a
"
)
;
link
.
href
=
"
http
:
/
/
example
/
foo
"
;
link
.
textContent
=
"
Me
me
click
me
!
"
;
content
.
document
.
body
.
append
(
link
)
;
}
)
;
let
newTabPromise
=
BrowserTestUtils
.
waitForNewTab
(
gBrowser
null
true
false
true
)
;
await
BrowserTestUtils
.
synthesizeMouseAtCenter
(
"
a
[
href
]
"
{
button
:
1
}
browser
)
;
let
tab
=
await
newTabPromise
;
let
{
browsingContext
}
=
tab
.
linkedBrowser
;
is
(
tab
.
linkedBrowser
.
currentURI
.
spec
"
http
:
/
/
example
/
foo
"
"
URL
for
tab
should
be
correct
.
"
)
;
ok
(
browsingContext
.
currentWindowGlobal
.
documentURI
.
spec
.
startsWith
(
"
about
:
neterror
"
)
"
Should
be
showing
error
page
.
"
)
;
BrowserTestUtils
.
removeTab
(
tab
)
;
}
)
;
}
)
;
