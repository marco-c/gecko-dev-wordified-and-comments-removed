add_task
(
function
*
test
(
)
{
waitForExplicitFinish
(
)
;
yield
BrowserTestUtils
.
withNewTab
(
{
gBrowser
url
:
"
http
:
/
/
example
.
com
"
}
function
*
(
browser
)
{
yield
ContentTask
.
spawn
(
browser
null
function
*
(
)
{
let
cw
=
content
;
let
oldTitle
=
cw
.
document
.
title
;
ok
(
oldTitle
'
Content
window
should
initially
have
a
title
.
'
)
;
cw
.
history
.
pushState
(
'
'
'
'
'
new_page
'
)
;
let
shistory
=
cw
.
QueryInterface
(
Ci
.
nsIInterfaceRequestor
)
.
getInterface
(
Ci
.
nsIWebNavigation
)
.
sessionHistory
;
is
(
shistory
.
getEntryAtIndex
(
shistory
.
index
false
)
.
title
oldTitle
'
SHEntry
title
after
pushstate
.
'
)
;
}
)
;
}
)
;
}
)
;
