#
ifndef
nsSHEntryShared_h__
#
define
nsSHEntryShared_h__
#
include
"
nsAutoPtr
.
h
"
#
include
"
nsCOMArray
.
h
"
#
include
"
nsCOMPtr
.
h
"
#
include
"
nsExpirationTracker
.
h
"
#
include
"
nsIBFCacheEntry
.
h
"
#
include
"
nsIWeakReferenceUtils
.
h
"
#
include
"
nsRect
.
h
"
#
include
"
nsString
.
h
"
#
include
"
nsStubMutationObserver
.
h
"
#
include
"
mozilla
/
Attributes
.
h
"
class
nsSHEntry
;
class
nsISHEntry
;
class
nsIContentViewer
;
class
nsIDocShellTreeItem
;
class
nsILayoutHistoryState
;
class
nsDocShellEditorData
;
class
nsIMutableArray
;
class
nsSHistory
;
namespace
mozilla
{
namespace
dom
{
class
Document
;
class
SHEntrySharedParentState
{
public
:
uint64_t
GetID
(
)
const
{
return
mID
;
}
void
NotifyListenersContentViewerEvicted
(
)
;
protected
:
SHEntrySharedParentState
(
nsISHistory
*
aSHistory
uint64_t
aID
)
;
SHEntrySharedParentState
(
SHEntrySharedParentState
*
aDuplicate
uint64_t
aID
)
:
SHEntrySharedParentState
(
aDuplicate
-
>
mSHistory
aID
)
{
}
SHEntrySharedParentState
(
nsIWeakReference
*
aSHistory
uint64_t
aID
)
;
virtual
~
SHEntrySharedParentState
(
)
;
NS_INLINE_DECL_VIRTUAL_REFCOUNTING_WITH_DESTROY
(
SHEntrySharedParentState
Destroy
(
)
)
virtual
void
Destroy
(
)
{
delete
this
;
}
void
CopyFrom
(
SHEntrySharedParentState
*
aSource
)
;
nsID
mDocShellID
;
nsCOMPtr
<
nsIPrincipal
>
mTriggeringPrincipal
;
nsCOMPtr
<
nsIPrincipal
>
mPrincipalToInherit
;
nsCOMPtr
<
nsIPrincipal
>
mStoragePrincipalToInherit
;
nsCOMPtr
<
nsIContentSecurityPolicy
>
mCsp
;
nsCString
mContentType
;
nsIntRect
mViewerBounds
;
uint32_t
mCacheKey
;
uint32_t
mLastTouched
;
uint64_t
mID
;
nsWeakPtr
mSHistory
;
bool
mIsFrameNavigation
;
bool
mSticky
;
bool
mDynamicallyCreated
;
bool
mExpired
;
}
;
class
SHEntrySharedChildState
{
protected
:
SHEntrySharedChildState
(
)
;
void
CopyFrom
(
SHEntrySharedChildState
*
aSource
)
;
public
:
nsCOMArray
<
nsIDocShellTreeItem
>
mChildShells
;
nsCOMPtr
<
nsIContentViewer
>
mContentViewer
;
RefPtr
<
mozilla
:
:
dom
:
:
Document
>
mDocument
;
nsCOMPtr
<
nsILayoutHistoryState
>
mLayoutHistoryState
;
nsCOMPtr
<
nsISupports
>
mWindowState
;
nsCOMPtr
<
nsIMutableArray
>
mRefreshURIList
;
nsExpirationState
mExpirationState
;
nsAutoPtr
<
nsDocShellEditorData
>
mEditorData
;
bool
mSaveLayoutState
;
}
;
}
}
class
nsSHEntryShared
final
:
public
nsIBFCacheEntry
public
nsStubMutationObserver
public
mozilla
:
:
dom
:
:
SHEntrySharedParentState
public
mozilla
:
:
dom
:
:
SHEntrySharedChildState
{
public
:
static
void
EnsureHistoryTracker
(
)
;
static
void
Shutdown
(
)
;
using
SHEntrySharedParentState
:
:
SHEntrySharedParentState
;
already_AddRefed
<
nsSHEntryShared
>
Duplicate
(
uint64_t
aNewSharedID
)
;
NS_DECL_ISUPPORTS_INHERITED
NS_DECL_NSIBFCACHEENTRY
NS_DECL_NSIMUTATIONOBSERVER_CHARACTERDATACHANGED
NS_DECL_NSIMUTATIONOBSERVER_ATTRIBUTECHANGED
NS_DECL_NSIMUTATIONOBSERVER_CONTENTAPPENDED
NS_DECL_NSIMUTATIONOBSERVER_CONTENTINSERTED
NS_DECL_NSIMUTATIONOBSERVER_CONTENTREMOVED
nsExpirationState
*
GetExpirationState
(
)
{
return
&
mExpirationState
;
}
private
:
~
nsSHEntryShared
(
)
;
friend
class
nsLegacySHEntry
;
void
RemoveFromExpirationTracker
(
)
;
void
SyncPresentationState
(
)
;
void
DropPresentationState
(
)
;
nsresult
SetContentViewer
(
nsIContentViewer
*
aViewer
)
;
}
;
#
endif
