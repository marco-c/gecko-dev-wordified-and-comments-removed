#
include
"
ChromeBrowsingContext
.
h
"
#
include
"
mozilla
/
dom
/
ContentParent
.
h
"
namespace
mozilla
{
namespace
dom
{
ChromeBrowsingContext
:
:
ChromeBrowsingContext
(
BrowsingContext
*
aParent
BrowsingContext
*
aOpener
const
nsAString
&
aName
uint64_t
aBrowsingContextId
uint64_t
aProcessId
BrowsingContext
:
:
Type
aType
)
:
BrowsingContext
(
aParent
aOpener
aName
aBrowsingContextId
aType
)
mProcessId
(
aProcessId
)
{
MOZ_RELEASE_ASSERT
(
XRE_IsParentProcess
(
)
)
;
}
void
ChromeBrowsingContext
:
:
CleanupContexts
(
uint64_t
aProcessId
)
{
nsTArray
<
RefPtr
<
BrowsingContext
>
>
roots
;
BrowsingContext
:
:
GetRootBrowsingContexts
(
roots
)
;
for
(
RefPtr
<
BrowsingContext
>
context
:
roots
)
{
if
(
Cast
(
context
)
-
>
IsOwnedByProcess
(
aProcessId
)
)
{
context
-
>
Detach
(
)
;
}
}
}
already_AddRefed
<
ChromeBrowsingContext
>
ChromeBrowsingContext
:
:
Get
(
uint64_t
aId
)
{
MOZ_RELEASE_ASSERT
(
XRE_IsParentProcess
(
)
)
;
return
BrowsingContext
:
:
Get
(
aId
)
.
downcast
<
ChromeBrowsingContext
>
(
)
;
}
ChromeBrowsingContext
*
ChromeBrowsingContext
:
:
Cast
(
BrowsingContext
*
aContext
)
{
MOZ_RELEASE_ASSERT
(
XRE_IsParentProcess
(
)
)
;
return
static_cast
<
ChromeBrowsingContext
*
>
(
aContext
)
;
}
const
ChromeBrowsingContext
*
ChromeBrowsingContext
:
:
Cast
(
const
BrowsingContext
*
aContext
)
{
MOZ_RELEASE_ASSERT
(
XRE_IsParentProcess
(
)
)
;
return
static_cast
<
const
ChromeBrowsingContext
*
>
(
aContext
)
;
}
}
}
