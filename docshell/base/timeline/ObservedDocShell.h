#
ifndef
mozilla_ObservedDocShell_h_
#
define
mozilla_ObservedDocShell_h_
#
include
"
MarkersStorage
.
h
"
#
include
"
mozilla
/
RefPtr
.
h
"
#
include
"
mozilla
/
Mutex
.
h
"
#
include
"
mozilla
/
UniquePtr
.
h
"
#
include
"
nsTArray
.
h
"
class
nsIDocShell
;
namespace
mozilla
{
class
AbstractTimelineMarker
;
namespace
dom
{
struct
ProfileTimelineMarker
;
}
class
ObservedDocShell
:
public
MarkersStorage
{
private
:
RefPtr
<
nsIDocShell
>
mDocShell
;
nsTArray
<
UniquePtr
<
AbstractTimelineMarker
>
>
mTimelineMarkers
;
bool
mPopping
=
false
;
Mutex
mLock
;
nsTArray
<
UniquePtr
<
AbstractTimelineMarker
>
>
mOffTheMainThreadTimelineMarkers
GUARDED_BY
(
mLock
)
;
public
:
explicit
ObservedDocShell
(
nsIDocShell
*
aDocShell
)
;
nsIDocShell
*
operator
*
(
)
const
{
return
mDocShell
.
get
(
)
;
}
void
AddMarker
(
UniquePtr
<
AbstractTimelineMarker
>
&
&
aMarker
)
override
;
void
AddOTMTMarker
(
UniquePtr
<
AbstractTimelineMarker
>
&
&
aMarker
)
override
;
void
ClearMarkers
(
)
override
;
void
PopMarkers
(
JSContext
*
aCx
nsTArray
<
dom
:
:
ProfileTimelineMarker
>
&
aStore
)
override
;
}
;
}
#
endif
