#
include
"
TimelineMarker
.
h
"
namespace
mozilla
{
TimelineMarker
:
:
TimelineMarker
(
const
char
*
aName
MarkerTracingType
aTracingType
MarkerStackRequest
aStackRequest
)
:
AbstractTimelineMarker
(
aName
aTracingType
)
{
CaptureStackIfNecessary
(
aTracingType
aStackRequest
)
;
}
TimelineMarker
:
:
TimelineMarker
(
const
char
*
aName
const
TimeStamp
&
aTime
MarkerTracingType
aTracingType
MarkerStackRequest
aStackRequest
)
:
AbstractTimelineMarker
(
aName
aTime
aTracingType
)
{
CaptureStackIfNecessary
(
aTracingType
aStackRequest
)
;
}
bool
TimelineMarker
:
:
Equals
(
const
AbstractTimelineMarker
&
aOther
)
{
return
strcmp
(
GetName
(
)
aOther
.
GetName
(
)
)
=
=
0
;
}
void
TimelineMarker
:
:
AddDetails
(
JSContext
*
aCx
dom
:
:
ProfileTimelineMarker
&
aMarker
)
{
}
JSObject
*
TimelineMarker
:
:
GetStack
(
)
{
if
(
mStackTrace
.
initialized
(
)
)
{
return
mStackTrace
;
}
return
nullptr
;
}
void
TimelineMarker
:
:
CaptureStack
(
)
{
JSContext
*
ctx
=
nsContentUtils
:
:
GetCurrentJSContext
(
)
;
if
(
ctx
)
{
JS
:
:
RootedObject
stack
(
ctx
)
;
if
(
JS
:
:
CaptureCurrentStack
(
ctx
&
stack
)
)
{
mStackTrace
.
init
(
ctx
stack
.
get
(
)
)
;
}
else
{
JS_ClearPendingException
(
ctx
)
;
}
}
}
void
TimelineMarker
:
:
CaptureStackIfNecessary
(
MarkerTracingType
aTracingType
MarkerStackRequest
aStackRequest
)
{
if
(
(
aTracingType
=
=
MarkerTracingType
:
:
START
|
|
aTracingType
=
=
MarkerTracingType
:
:
TIMESTAMP
)
&
&
aStackRequest
!
=
MarkerStackRequest
:
:
NO_STACK
)
{
CaptureStack
(
)
;
}
}
}
