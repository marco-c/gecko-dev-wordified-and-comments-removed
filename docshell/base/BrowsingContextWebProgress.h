#
ifndef
mozilla_dom_BrowsingContextWebProgress_h
#
define
mozilla_dom_BrowsingContextWebProgress_h
#
include
"
nsIWebProgress
.
h
"
#
include
"
nsIWebProgressListener
.
h
"
#
include
"
nsTObserverArray
.
h
"
#
include
"
nsWeakReference
.
h
"
namespace
mozilla
{
namespace
dom
{
class
BrowsingContextWebProgress
final
:
public
nsIWebProgress
public
nsIWebProgressListener
{
public
:
NS_DECL_ISUPPORTS
NS_DECL_NSIWEBPROGRESS
NS_DECL_NSIWEBPROGRESSLISTENER
BrowsingContextWebProgress
(
)
=
default
;
struct
ListenerInfo
{
ListenerInfo
(
nsIWeakReference
*
aListener
unsigned
long
aNotifyMask
)
:
mWeakListener
(
aListener
)
mNotifyMask
(
aNotifyMask
)
{
}
bool
operator
=
=
(
const
ListenerInfo
&
aOther
)
const
{
return
mWeakListener
=
=
aOther
.
mWeakListener
;
}
bool
operator
=
=
(
const
nsWeakPtr
&
aOther
)
const
{
return
mWeakListener
=
=
aOther
;
}
nsWeakPtr
mWeakListener
;
unsigned
long
mNotifyMask
;
}
;
void
ContextDiscarded
(
)
;
private
:
virtual
~
BrowsingContextWebProgress
(
)
=
default
;
void
UpdateAndNotifyListeners
(
uint32_t
aFlag
const
std
:
:
function
<
void
(
nsIWebProgressListener
*
)
>
&
aCallback
)
;
using
ListenerArray
=
nsAutoTObserverArray
<
ListenerInfo
4
>
;
ListenerArray
mListenerInfoList
;
bool
mAwaitingStop
=
false
;
}
;
}
}
#
endif
