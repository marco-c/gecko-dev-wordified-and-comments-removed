#
ifndef
mozilla_dom_BrowsingContextWebProgress_h
#
define
mozilla_dom_BrowsingContextWebProgress_h
#
include
"
nsIWebProgress
.
h
"
#
include
"
nsIWebProgressListener
.
h
"
#
include
"
nsTObserverArray
.
h
"
#
include
"
nsWeakReference
.
h
"
#
include
"
nsCycleCollectionParticipant
.
h
"
namespace
mozilla
{
namespace
dom
{
class
CanonicalBrowsingContext
;
class
BrowsingContextWebProgress
final
:
public
nsIWebProgress
public
nsIWebProgressListener
{
public
:
NS_DECL_CYCLE_COLLECTING_ISUPPORTS
NS_DECL_CYCLE_COLLECTION_CLASS_AMBIGUOUS
(
BrowsingContextWebProgress
nsIWebProgress
)
NS_DECL_NSIWEBPROGRESS
NS_DECL_NSIWEBPROGRESSLISTENER
explicit
BrowsingContextWebProgress
(
CanonicalBrowsingContext
*
aBrowsingContext
)
;
struct
ListenerInfo
{
ListenerInfo
(
nsIWeakReference
*
aListener
unsigned
long
aNotifyMask
)
:
mWeakListener
(
aListener
)
mNotifyMask
(
aNotifyMask
)
{
}
bool
operator
=
=
(
const
ListenerInfo
&
aOther
)
const
{
return
mWeakListener
=
=
aOther
.
mWeakListener
;
}
bool
operator
=
=
(
const
nsWeakPtr
&
aOther
)
const
{
return
mWeakListener
=
=
aOther
;
}
nsWeakPtr
mWeakListener
;
unsigned
long
mNotifyMask
;
}
;
void
ContextDiscarded
(
)
;
void
ContextReplaced
(
CanonicalBrowsingContext
*
aNewContext
)
;
void
SetLoadType
(
uint32_t
aLoadType
)
{
mLoadType
=
aLoadType
;
}
private
:
virtual
~
BrowsingContextWebProgress
(
)
;
void
UpdateAndNotifyListeners
(
uint32_t
aFlag
const
std
:
:
function
<
void
(
nsIWebProgressListener
*
)
>
&
aCallback
)
;
using
ListenerArray
=
nsAutoTObserverArray
<
ListenerInfo
4
>
;
ListenerArray
mListenerInfoList
;
RefPtr
<
CanonicalBrowsingContext
>
mCurrentBrowsingContext
;
nsCOMPtr
<
nsIRequest
>
mLoadingDocumentRequest
;
uint32_t
mLoadType
=
0
;
bool
mIsLoadingDocument
=
false
;
}
;
}
}
#
endif
