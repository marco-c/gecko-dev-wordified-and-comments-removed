#
ifndef
mozilla_dom_ChildProcessChannelListener_h
#
define
mozilla_dom_ChildProcessChannelListener_h
#
include
<
functional
>
#
include
"
mozilla
/
net
/
NeckoChannelParams
.
h
"
#
include
"
nsDOMNavigationTiming
.
h
"
#
include
"
nsDataHashtable
.
h
"
#
include
"
nsIChildChannel
.
h
"
namespace
mozilla
{
namespace
dom
{
class
ChildProcessChannelListener
final
{
NS_INLINE_DECL_REFCOUNTING
(
ChildProcessChannelListener
)
using
Callback
=
std
:
:
function
<
void
(
nsIChildChannel
*
nsTArray
<
net
:
:
DocumentChannelRedirect
>
&
&
uint32_t
nsDOMNavigationTiming
*
)
>
;
void
RegisterCallback
(
uint64_t
aIdentifier
Callback
&
&
aCallback
)
;
void
OnChannelReady
(
nsIChildChannel
*
aChannel
uint64_t
aIdentifier
nsTArray
<
net
:
:
DocumentChannelRedirect
>
&
&
aRedirects
uint32_t
aLoadStateLoadFlags
nsDOMNavigationTiming
*
aTiming
)
;
static
already_AddRefed
<
ChildProcessChannelListener
>
GetSingleton
(
)
;
private
:
ChildProcessChannelListener
(
)
=
default
;
~
ChildProcessChannelListener
(
)
=
default
;
struct
CallbackArgs
{
nsCOMPtr
<
nsIChildChannel
>
mChannel
;
nsTArray
<
net
:
:
DocumentChannelRedirect
>
mRedirects
;
uint32_t
mLoadStateLoadFlags
;
RefPtr
<
nsDOMNavigationTiming
>
mTiming
;
}
;
nsDataHashtable
<
nsUint64HashKey
Callback
>
mCallbacks
;
nsDataHashtable
<
nsUint64HashKey
CallbackArgs
>
mChannelArgs
;
}
;
}
}
#
endif
