#
ifndef
mozilla_dom_ChildProcessChannelListener_h
#
define
mozilla_dom_ChildProcessChannelListener_h
#
include
<
functional
>
#
include
"
nsCOMPtr
.
h
"
#
include
"
nsDataHashtable
.
h
"
#
include
"
nsIChildProcessChannelListener
.
h
"
#
include
"
nsIChildChannel
.
h
"
#
include
"
mozilla
/
Variant
.
h
"
namespace
mozilla
{
namespace
dom
{
class
ChildProcessChannelListener
final
:
public
nsIChildProcessChannelListener
{
public
:
using
Callback
=
std
:
:
function
<
void
(
nsIChildChannel
*
nsTArray
<
net
:
:
DocumentChannelRedirect
>
&
&
)
>
;
struct
CallbackArgs
{
nsCOMPtr
<
nsIChildChannel
>
mChannel
;
nsTArray
<
net
:
:
DocumentChannelRedirect
>
mRedirects
;
}
;
ChildProcessChannelListener
(
)
;
NS_DECL_ISUPPORTS
NS_DECL_NSICHILDPROCESSCHANNELLISTENER
void
RegisterCallback
(
uint64_t
aIdentifier
Callback
&
&
aCallback
)
;
static
already_AddRefed
<
ChildProcessChannelListener
>
GetSingleton
(
)
;
private
:
virtual
~
ChildProcessChannelListener
(
)
;
nsDataHashtable
<
nsUint64HashKey
Callback
>
mCallbacks
;
nsDataHashtable
<
nsUint64HashKey
CallbackArgs
>
mChannelArgs
;
}
;
}
}
#
endif
