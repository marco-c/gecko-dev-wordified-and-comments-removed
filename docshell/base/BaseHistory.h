#
ifndef
mozilla_BaseHistory_h
#
define
mozilla_BaseHistory_h
#
include
"
IHistory
.
h
"
#
include
"
mozilla
/
Result
.
h
"
namespace
mozilla
{
class
BaseHistory
:
public
IHistory
{
public
:
NS_IMETHODIMP
RegisterVisitedCallback
(
nsIURI
*
dom
:
:
Link
*
)
final
;
NS_IMETHODIMP
UnregisterVisitedCallback
(
nsIURI
*
dom
:
:
Link
*
)
final
;
NS_IMETHODIMP
NotifyVisited
(
nsIURI
*
aURI
)
final
;
protected
:
static
constexpr
const
size_t
kTrackedUrisInitialSize
=
64
;
BaseHistory
(
)
:
mTrackedURIs
(
kTrackedUrisInitialSize
)
{
}
virtual
Result
<
Ok
nsresult
>
StartVisitedQuery
(
nsIURI
*
)
=
0
;
virtual
void
CancelVisitedQueryIfPossible
(
nsIURI
*
)
=
0
;
using
ObserverArray
=
nsTObserverArray
<
dom
:
:
Link
*
>
;
struct
ObservingLinks
{
ObserverArray
mLinks
;
bool
mKnownVisited
=
false
;
size_t
SizeOfExcludingThis
(
MallocSizeOf
aMallocSizeOf
)
const
{
return
mLinks
.
ShallowSizeOfExcludingThis
(
aMallocSizeOf
)
;
}
}
;
private
:
void
NotifyVisitedForDocument
(
nsIURI
*
dom
:
:
Document
*
)
;
void
DispatchNotifyVisited
(
nsIURI
*
dom
:
:
Document
*
)
;
protected
:
nsDataHashtable
<
nsURIHashKey
ObservingLinks
>
mTrackedURIs
;
}
;
}
#
endif
