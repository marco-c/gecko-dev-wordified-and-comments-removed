#
ifndef
nsDocShell_h__
#
define
nsDocShell_h__
#
include
"
mozilla
/
BasePrincipal
.
h
"
#
include
"
mozilla
/
HalScreenConfiguration
.
h
"
#
include
"
mozilla
/
LinkedList
.
h
"
#
include
"
mozilla
/
Maybe
.
h
"
#
include
"
mozilla
/
Move
.
h
"
#
include
"
mozilla
/
TimeStamp
.
h
"
#
include
"
mozilla
/
UniquePtr
.
h
"
#
include
"
mozilla
/
WeakPtr
.
h
"
#
include
"
mozilla
/
dom
/
BrowsingContext
.
h
"
#
include
"
mozilla
/
dom
/
ProfileTimelineMarkerBinding
.
h
"
#
include
"
mozilla
/
gfx
/
Matrix
.
h
"
#
include
"
mozilla
/
dom
/
ChildSHistory
.
h
"
#
include
"
nsIAuthPromptProvider
.
h
"
#
include
"
nsIBaseWindow
.
h
"
#
include
"
nsIDeprecationWarner
.
h
"
#
include
"
nsIDocShell
.
h
"
#
include
"
nsIDocShellTreeItem
.
h
"
#
include
"
nsIDOMStorageManager
.
h
"
#
include
"
nsIInterfaceRequestor
.
h
"
#
include
"
nsILinkHandler
.
h
"
#
include
"
nsILoadContext
.
h
"
#
include
"
nsILoadURIDelegate
.
h
"
#
include
"
nsINetworkInterceptController
.
h
"
#
include
"
nsIRefreshURI
.
h
"
#
include
"
nsIScrollable
.
h
"
#
include
"
nsITabParent
.
h
"
#
include
"
nsIWebNavigation
.
h
"
#
include
"
nsIWebPageDescriptor
.
h
"
#
include
"
nsIWebProgressListener
.
h
"
#
include
"
nsAutoPtr
.
h
"
#
include
"
nsCharsetSource
.
h
"
#
include
"
nsCOMPtr
.
h
"
#
include
"
nsContentPolicyUtils
.
h
"
#
include
"
nsContentUtils
.
h
"
#
include
"
nsCRT
.
h
"
#
include
"
nsDocLoader
.
h
"
#
include
"
nsPoint
.
h
"
#
include
"
nsRect
.
h
"
#
include
"
nsString
.
h
"
#
include
"
nsThreadUtils
.
h
"
#
include
"
GeckoProfiler
.
h
"
#
include
"
jsapi
.
h
"
#
include
"
prtime
.
h
"
#
include
"
Units
.
h
"
#
include
"
mozilla
/
ObservedDocShell
.
h
"
#
include
"
mozilla
/
TimelineConsumers
.
h
"
#
include
"
mozilla
/
TimelineMarker
.
h
"
namespace
mozilla
{
class
Encoding
;
class
HTMLEditor
;
enum
class
TaskCategory
;
namespace
dom
{
class
ClientInfo
;
class
ClientSource
;
class
EventTarget
;
}
}
class
nsICommandManager
;
class
nsIContentViewer
;
class
nsIController
;
class
nsIDocShellTreeOwner
;
class
nsIHttpChannel
;
class
nsIMutableArray
;
class
nsIPrompt
;
class
nsIScrollableFrame
;
class
nsISecureBrowserUI
;
class
nsISHistory
;
class
nsIStringBundle
;
class
nsIURIFixup
;
class
nsIURILoader
;
class
nsIWebBrowserFind
;
class
nsIWidget
;
class
nsIReferrerInfo
;
class
nsDocShell
;
class
nsDocShellEditorData
;
class
nsDOMNavigationTiming
;
class
nsDSURIContentListener
;
class
nsGlobalWindowInner
;
class
nsGlobalWindowOuter
;
class
FramingChecker
;
class
OnLinkClickEvent
;
enum
ViewMode
{
viewNormal
=
0x0
viewSource
=
0x1
}
;
enum
eCharsetReloadState
{
eCharsetReloadInit
eCharsetReloadRequested
eCharsetReloadStopOrigional
}
;
class
nsDocShell
final
:
public
nsDocLoader
public
nsIDocShell
public
nsIWebNavigation
public
nsIBaseWindow
public
nsIScrollable
public
nsIRefreshURI
public
nsIWebProgressListener
public
nsIWebPageDescriptor
public
nsIAuthPromptProvider
public
nsILoadContext
public
nsILinkHandler
public
nsIDOMStorageManager
public
nsINetworkInterceptController
public
nsIDeprecationWarner
public
mozilla
:
:
SupportsWeakPtr
<
nsDocShell
>
{
public
:
enum
InternalLoad
:
uint32_t
{
INTERNAL_LOAD_FLAGS_NONE
=
0x0
INTERNAL_LOAD_FLAGS_INHERIT_PRINCIPAL
=
0x1
INTERNAL_LOAD_FLAGS_DONT_SEND_REFERRER
=
0x2
INTERNAL_LOAD_FLAGS_ALLOW_THIRD_PARTY_FIXUP
=
0x4
INTERNAL_LOAD_FLAGS_FIRST_LOAD
=
0x8
INTERNAL_LOAD_FLAGS_LOADURI_SETUP_FLAGS
=
0xf
INTERNAL_LOAD_FLAGS_BYPASS_CLASSIFIER
=
0x10
INTERNAL_LOAD_FLAGS_FORCE_ALLOW_COOKIES
=
0x20
INTERNAL_LOAD_FLAGS_IS_SRCDOC
=
0x40
INTERNAL_LOAD_FLAGS_ORIGINAL_FRAME_SRC
=
0x80
INTERNAL_LOAD_FLAGS_NO_OPENER
=
0x100
INTERNAL_LOAD_FLAGS_FORCE_ALLOW_DATA_URI
=
0x200
INTERNAL_LOAD_FLAGS_IS_USER_TRIGGERED
=
0x1000
}
;
class
RestorePresentationEvent
:
public
mozilla
:
:
Runnable
{
public
:
NS_DECL_NSIRUNNABLE
explicit
RestorePresentationEvent
(
nsDocShell
*
aDs
)
:
mozilla
:
:
Runnable
(
"
nsDocShell
:
:
RestorePresentationEvent
"
)
mDocShell
(
aDs
)
{
}
void
Revoke
(
)
{
mDocShell
=
nullptr
;
}
private
:
RefPtr
<
nsDocShell
>
mDocShell
;
}
;
class
InterfaceRequestorProxy
:
public
nsIInterfaceRequestor
{
public
:
explicit
InterfaceRequestorProxy
(
nsIInterfaceRequestor
*
aRequestor
)
;
NS_DECL_THREADSAFE_ISUPPORTS
NS_DECL_NSIINTERFACEREQUESTOR
private
:
virtual
~
InterfaceRequestorProxy
(
)
;
InterfaceRequestorProxy
(
)
{
}
nsWeakPtr
mWeakPtr
;
}
;
MOZ_DECLARE_WEAKREFERENCE_TYPENAME
(
nsDocShell
)
NS_DECL_ISUPPORTS_INHERITED
NS_DECL_CYCLE_COLLECTION_CLASS_INHERITED
(
nsDocShell
nsDocLoader
)
NS_DECL_NSIDOCSHELL
NS_DECL_NSIDOCSHELLTREEITEM
NS_DECL_NSIWEBNAVIGATION
NS_DECL_NSIBASEWINDOW
NS_DECL_NSISCROLLABLE
NS_DECL_NSIINTERFACEREQUESTOR
NS_DECL_NSIWEBPROGRESSLISTENER
NS_DECL_NSIREFRESHURI
NS_DECL_NSIWEBPAGEDESCRIPTOR
NS_DECL_NSIAUTHPROMPTPROVIDER
NS_DECL_NSINETWORKINTERCEPTCONTROLLER
NS_DECL_NSIDEPRECATIONWARNER
NS_FORWARD_SAFE_NSIDOMSTORAGEMANAGER
(
TopSessionStorageManager
(
)
)
static
already_AddRefed
<
nsDocShell
>
Create
(
mozilla
:
:
dom
:
:
BrowsingContext
*
aBrowsingContext
)
;
NS_IMETHOD
Stop
(
)
override
{
return
nsDocLoader
:
:
Stop
(
)
;
}
NS_IMETHOD
OnLinkClick
(
nsIContent
*
aContent
nsIURI
*
aURI
const
nsAString
&
aTargetSpec
const
nsAString
&
aFileName
nsIInputStream
*
aPostDataStream
nsIInputStream
*
aHeadersDataStream
bool
aIsUserTriggered
bool
aIsTrusted
nsIPrincipal
*
aTriggeringPrincipal
)
override
;
NS_IMETHOD
OnLinkClickSync
(
nsIContent
*
aContent
nsIURI
*
aURI
const
nsAString
&
aTargetSpec
const
nsAString
&
aFileName
nsIInputStream
*
aPostDataStream
=
0
nsIInputStream
*
aHeadersDataStream
=
0
bool
aNoOpenerImplied
=
false
nsIDocShell
*
*
aDocShell
=
0
nsIRequest
*
*
aRequest
=
0
bool
aIsUserTriggered
=
false
nsIPrincipal
*
aTriggeringPrincipal
=
nullptr
)
override
;
NS_IMETHOD
OnOverLink
(
nsIContent
*
aContent
nsIURI
*
aURI
const
nsAString
&
aTargetSpec
)
override
;
NS_IMETHOD
OnLeaveLink
(
)
override
;
NS_IMETHOD
GetAssociatedWindow
(
mozIDOMWindowProxy
*
*
)
override
;
NS_IMETHOD
GetTopWindow
(
mozIDOMWindowProxy
*
*
)
override
;
NS_IMETHOD
GetTopFrameElement
(
mozilla
:
:
dom
:
:
Element
*
*
)
override
;
NS_IMETHOD
GetNestedFrameId
(
uint64_t
*
)
override
;
NS_IMETHOD
GetIsContent
(
bool
*
)
override
;
NS_IMETHOD
GetUsePrivateBrowsing
(
bool
*
)
override
;
NS_IMETHOD
SetUsePrivateBrowsing
(
bool
)
override
;
NS_IMETHOD
SetPrivateBrowsing
(
bool
)
override
;
NS_IMETHOD
GetUseRemoteTabs
(
bool
*
)
override
;
NS_IMETHOD
SetRemoteTabs
(
bool
)
override
;
NS_IMETHOD
GetScriptableOriginAttributes
(
JSContext
*
JS
:
:
MutableHandle
<
JS
:
:
Value
>
)
override
;
NS_IMETHOD_
(
void
)
GetOriginAttributes
(
mozilla
:
:
OriginAttributes
&
aAttrs
)
override
;
nsresult
RestoreFromHistory
(
)
;
nsresult
ForceRefreshURIFromTimer
(
nsIURI
*
aURI
nsIPrincipal
*
aPrincipal
int32_t
aDelay
bool
aMetaRefresh
nsITimer
*
aTimer
)
;
void
FireDummyOnLocationChange
(
)
{
FireOnLocationChange
(
this
nullptr
mCurrentURI
LOCATION_CHANGE_SAME_DOCUMENT
)
;
}
nsresult
HistoryEntryRemoved
(
int32_t
aIndex
)
;
MOZ_CAN_RUN_SCRIPT_BOUNDARY
void
NotifyAsyncPanZoomStarted
(
)
;
MOZ_CAN_RUN_SCRIPT_BOUNDARY
void
NotifyAsyncPanZoomStopped
(
)
;
void
SetInFrameSwap
(
bool
aInSwap
)
{
mInFrameSwap
=
aInSwap
;
}
bool
InFrameSwap
(
)
;
void
SetIsFrame
(
)
{
mIsFrame
=
true
;
}
;
const
mozilla
:
:
Encoding
*
GetForcedCharset
(
)
{
return
mForcedCharset
;
}
mozilla
:
:
HTMLEditor
*
GetHTMLEditorInternal
(
)
;
nsresult
SetHTMLEditorInternal
(
mozilla
:
:
HTMLEditor
*
aHTMLEditor
)
;
nsresult
CharsetChangeReloadDocument
(
const
char
*
aCharset
=
nullptr
int32_t
aSource
=
kCharsetUninitialized
)
;
nsresult
CharsetChangeStopDocumentLoad
(
)
;
nsDOMNavigationTiming
*
GetNavigationTiming
(
)
const
;
nsresult
SetOriginAttributes
(
const
mozilla
:
:
OriginAttributes
&
aAttrs
)
;
const
nsTArray
<
nsCOMPtr
<
nsIPrincipal
>
>
&
AncestorPrincipals
(
)
const
{
return
mAncestorPrincipals
;
}
void
SetAncestorPrincipals
(
nsTArray
<
nsCOMPtr
<
nsIPrincipal
>
>
&
&
aAncestorPrincipals
)
{
mAncestorPrincipals
=
std
:
:
move
(
aAncestorPrincipals
)
;
}
const
nsTArray
<
uint64_t
>
&
AncestorOuterWindowIDs
(
)
const
{
return
mAncestorOuterWindowIDs
;
}
void
SetAncestorOuterWindowIDs
(
nsTArray
<
uint64_t
>
&
&
aAncestorOuterWindowIDs
)
{
mAncestorOuterWindowIDs
=
std
:
:
move
(
aAncestorOuterWindowIDs
)
;
}
const
mozilla
:
:
OriginAttributes
&
GetOriginAttributes
(
)
{
return
mOriginAttributes
;
}
bool
HasHistoryEntry
(
nsISHEntry
*
aEntry
)
const
{
return
aEntry
&
&
(
aEntry
=
=
mOSHE
|
|
aEntry
=
=
mLSHE
)
;
}
void
SwapHistoryEntries
(
nsISHEntry
*
aOldEntry
nsISHEntry
*
aNewEntry
)
;
mozilla
:
:
gfx
:
:
Matrix5x4
*
GetColorMatrix
(
)
{
return
mColorMatrix
.
get
(
)
;
}
static
bool
SandboxFlagsImplyCookies
(
const
uint32_t
&
aSandboxFlags
)
;
static
void
CopyFavicon
(
nsIURI
*
aOldURI
nsIURI
*
aNewURI
nsIPrincipal
*
aLoadingPrincipal
bool
aInPrivateBrowsing
)
;
static
nsDocShell
*
Cast
(
nsIDocShell
*
aDocShell
)
{
return
static_cast
<
nsDocShell
*
>
(
aDocShell
)
;
}
bool
IsForceReloading
(
)
;
mozilla
:
:
dom
:
:
BrowsingContext
*
GetBrowsingContext
(
)
const
{
return
mBrowsingContext
;
}
mozilla
:
:
dom
:
:
BrowsingContext
*
GetWindowProxy
(
)
{
EnsureScriptEnvironment
(
)
;
return
mBrowsingContext
;
}
nsresult
InternalLoad
(
nsDocShellLoadState
*
aLoadState
nsIDocShell
*
*
aDocShell
nsIRequest
*
*
aRequest
)
;
private
:
friend
class
nsDSURIContentListener
;
friend
class
FramingChecker
;
friend
class
OnLinkClickEvent
;
friend
class
nsIDocShell
;
friend
class
mozilla
:
:
dom
:
:
BrowsingContext
;
friend
void
mozilla
:
:
TimelineConsumers
:
:
AddConsumer
(
nsDocShell
*
)
;
friend
void
mozilla
:
:
TimelineConsumers
:
:
RemoveConsumer
(
nsDocShell
*
)
;
friend
void
mozilla
:
:
TimelineConsumers
:
:
AddMarkerForDocShell
(
nsDocShell
*
const
char
*
MarkerTracingType
MarkerStackRequest
)
;
friend
void
mozilla
:
:
TimelineConsumers
:
:
AddMarkerForDocShell
(
nsDocShell
*
const
char
*
const
TimeStamp
&
MarkerTracingType
MarkerStackRequest
)
;
friend
void
mozilla
:
:
TimelineConsumers
:
:
AddMarkerForDocShell
(
nsDocShell
*
UniquePtr
<
AbstractTimelineMarker
>
&
&
)
;
friend
void
mozilla
:
:
TimelineConsumers
:
:
PopMarkers
(
nsDocShell
*
JSContext
*
nsTArray
<
dom
:
:
ProfileTimelineMarker
>
&
)
;
explicit
nsDocShell
(
mozilla
:
:
dom
:
:
BrowsingContext
*
aBrowsingContext
)
;
static
bool
CanAccessItem
(
nsIDocShellTreeItem
*
aTargetItem
nsIDocShellTreeItem
*
aAccessingItem
bool
aConsiderOpener
=
true
)
;
static
bool
ValidateOrigin
(
nsIDocShellTreeItem
*
aOriginTreeItem
nsIDocShellTreeItem
*
aTargetTreeItem
)
;
static
inline
uint32_t
PRTimeToSeconds
(
PRTime
aTimeUsec
)
{
PRTime
usecPerSec
=
PR_USEC_PER_SEC
;
return
uint32_t
(
aTimeUsec
/
=
usecPerSec
)
;
}
static
const
nsCString
FrameTypeToString
(
uint32_t
aFrameType
)
{
switch
(
aFrameType
)
{
case
FRAME_TYPE_BROWSER
:
return
NS_LITERAL_CSTRING
(
"
browser
"
)
;
case
FRAME_TYPE_REGULAR
:
return
NS_LITERAL_CSTRING
(
"
regular
"
)
;
default
:
NS_ERROR
(
"
Unknown
frame
type
"
)
;
return
EmptyCString
(
)
;
}
}
virtual
~
nsDocShell
(
)
;
virtual
void
DestroyChildren
(
)
override
;
virtual
void
OnRedirectStateChange
(
nsIChannel
*
aOldChannel
nsIChannel
*
aNewChannel
uint32_t
aRedirectFlags
uint32_t
aStateFlags
)
override
;
virtual
nsresult
SetDocLoaderParent
(
nsDocLoader
*
aLoader
)
override
;
nsresult
EnsureContentViewer
(
)
;
nsresult
CreateAboutBlankContentViewer
(
nsIPrincipal
*
aPrincipal
nsIURI
*
aBaseURI
bool
aTryToSaveOldPresentation
=
true
bool
aCheckPermitUnload
=
true
)
;
nsresult
CreateContentViewer
(
const
nsACString
&
aContentType
nsIRequest
*
aRequest
nsIStreamListener
*
*
aContentHandler
)
;
nsresult
NewContentViewerObj
(
const
nsACString
&
aContentType
nsIRequest
*
aRequest
nsILoadGroup
*
aLoadGroup
nsIStreamListener
*
*
aContentHandler
nsIContentViewer
*
*
aViewer
)
;
nsresult
SetupNewViewer
(
nsIContentViewer
*
aNewViewer
)
;
bool
ShouldAddToSessionHistory
(
nsIURI
*
aURI
nsIChannel
*
aChannel
)
;
nsresult
AddToSessionHistory
(
nsIURI
*
aURI
nsIChannel
*
aChannel
nsIPrincipal
*
aTriggeringPrincipal
nsIPrincipal
*
aPrincipalToInherit
bool
aCloneChildren
nsISHEntry
*
*
aNewEntry
)
;
nsresult
AddChildSHEntryToParent
(
nsISHEntry
*
aNewEntry
int32_t
aChildOffset
bool
aCloneChildren
)
;
nsresult
AddChildSHEntryInternal
(
nsISHEntry
*
aCloneRef
nsISHEntry
*
aNewEntry
int32_t
aChildOffset
uint32_t
aLoadType
bool
aCloneChildren
)
;
void
SetHistoryEntry
(
nsCOMPtr
<
nsISHEntry
>
*
aPtr
nsISHEntry
*
aEntry
)
;
nsresult
DoURILoad
(
nsDocShellLoadState
*
aLoadState
bool
aLoadFromExternal
nsIDocShell
*
*
aDocShell
nsIRequest
*
*
aRequest
)
;
nsresult
AddHeadersToChannel
(
nsIInputStream
*
aHeadersData
nsIChannel
*
aChannel
)
;
nsresult
DoChannelLoad
(
nsIChannel
*
aChannel
nsIURILoader
*
aURILoader
bool
aBypassClassifier
)
;
nsresult
OpenInitializedChannel
(
nsIChannel
*
aChannel
nsIURILoader
*
aURILoader
uint32_t
aOpenFlags
)
;
nsresult
ScrollToAnchor
(
bool
aCurHasRef
bool
aNewHasRef
nsACString
&
aNewHash
uint32_t
aLoadType
)
;
bool
OnLoadingSite
(
nsIChannel
*
aChannel
bool
aFireOnLocationChange
bool
aAddToGlobalHistory
=
true
)
;
bool
OnNewURI
(
nsIURI
*
aURI
nsIChannel
*
aChannel
nsIPrincipal
*
aTriggeringPrincipal
nsIPrincipal
*
aPrincipalToInherit
uint32_t
aLoadType
bool
aFireOnLocationChange
bool
aAddToGlobalHistory
bool
aCloneSHChildren
)
;
nsresult
EndPageLoad
(
nsIWebProgress
*
aProgress
nsIChannel
*
aChannel
nsresult
aResult
)
;
nsresult
LoadErrorPage
(
nsIURI
*
aURI
const
char16_t
*
aURL
const
char
*
aErrorPage
const
char
*
aErrorType
const
char16_t
*
aDescription
const
char
*
aCSSClass
nsIChannel
*
aFailedChannel
)
;
nsresult
LoadErrorPage
(
nsIURI
*
aErrorURI
nsIURI
*
aFailedURI
nsIChannel
*
aFailedChannel
)
;
bool
DisplayLoadError
(
nsresult
aError
nsIURI
*
aURI
const
char16_t
*
aURL
nsIChannel
*
aFailedChannel
)
{
bool
didDisplayLoadError
=
false
;
DisplayLoadError
(
aError
aURI
aURL
aFailedChannel
&
didDisplayLoadError
)
;
return
didDisplayLoadError
;
}
nsIPrincipal
*
GetInheritedPrincipal
(
bool
aConsiderCurrentDocument
)
;
bool
ChannelIsPost
(
nsIChannel
*
aChannel
)
;
void
ExtractLastVisit
(
nsIChannel
*
aChannel
nsIURI
*
*
aURI
uint32_t
*
aChannelRedirectFlags
)
;
void
SaveLastVisit
(
nsIChannel
*
aChannel
nsIURI
*
aURI
uint32_t
aChannelRedirectFlags
)
;
void
AddURIVisit
(
nsIURI
*
aURI
nsIURI
*
aPreviousURI
uint32_t
aChannelRedirectFlags
uint32_t
aResponseStatus
=
0
)
;
nsresult
SetDocCurrentStateObj
(
nsISHEntry
*
aShEntry
)
;
bool
SetCurrentURI
(
nsIURI
*
aURI
nsIRequest
*
aRequest
bool
aFireOnLocationChange
uint32_t
aLocationFlags
)
;
bool
CanSavePresentation
(
uint32_t
aLoadType
nsIRequest
*
aNewRequest
mozilla
:
:
dom
:
:
Document
*
aNewDocument
)
;
nsresult
CaptureState
(
)
;
nsresult
RestorePresentation
(
nsISHEntry
*
aSHEntry
bool
*
aRestoring
)
;
nsresult
BeginRestoreChildren
(
)
;
void
DoGetPositionAndSize
(
int32_t
*
aX
int32_t
*
aY
int32_t
*
aWidth
int32_t
*
aHeight
)
;
bool
IsOKToLoadURI
(
nsIURI
*
aURI
)
;
nsresult
GetControllerForCommand
(
const
char
*
aCommand
nsIController
*
*
aResult
)
;
void
MaybeCreateInitialClientSource
(
nsIPrincipal
*
aPrincipal
=
nullptr
)
;
bool
ServiceWorkerAllowedToControlWindow
(
nsIPrincipal
*
aPrincipal
nsIURI
*
aURI
)
;
mozilla
:
:
Maybe
<
mozilla
:
:
dom
:
:
ClientInfo
>
GetInitialClientInfo
(
)
const
;
MOZ_MUST_USE
bool
MaybeInitTiming
(
)
;
void
MaybeResetInitTiming
(
bool
aReset
)
;
nsresult
DoFindItemWithName
(
const
nsAString
&
aName
nsIDocShellTreeItem
*
aRequestor
nsIDocShellTreeItem
*
aOriginalRequestor
bool
aSkipTabGroup
nsIDocShellTreeItem
*
*
aResult
)
;
already_AddRefed
<
nsDocShell
>
GetParentDocshell
(
)
;
void
AssertOriginAttributesMatchPrivateBrowsing
(
)
;
void
MaybeNotifyKeywordSearchLoading
(
const
nsString
&
aProvider
const
nsString
&
aKeyword
)
;
void
FirePageHideNotificationInternal
(
bool
aIsUnload
bool
aSkipCheckingDynEntries
)
;
nsresult
DispatchToTabGroup
(
mozilla
:
:
TaskCategory
aCategory
already_AddRefed
<
nsIRunnable
>
&
&
aRunnable
)
;
void
SetupReferrerInfoFromChannel
(
nsIChannel
*
aChannel
)
;
void
SetReferrerInfo
(
nsIReferrerInfo
*
aReferrerInfo
)
;
void
ReattachEditorToWindow
(
nsISHEntry
*
aSHEntry
)
;
void
RecomputeCanExecuteScripts
(
)
;
void
ClearFrameHistory
(
nsISHEntry
*
aEntry
)
;
void
UpdateGlobalHistoryTitle
(
nsIURI
*
aURI
)
;
bool
IsFrame
(
)
;
bool
CanSetOriginAttributes
(
)
;
bool
ShouldBlockLoadingForBackButton
(
)
;
bool
ShouldDiscardLayoutState
(
nsIHttpChannel
*
aChannel
)
;
bool
HasUnloadedParent
(
)
;
bool
JustStartedNetworkLoad
(
)
;
bool
IsPrintingOrPP
(
bool
aDisplayErrorDialog
=
true
)
;
bool
IsNavigationAllowed
(
bool
aDisplayPrintErrorDialog
=
true
bool
aCheckIfUnloadFired
=
true
)
;
uint32_t
GetInheritedFrameType
(
)
;
nsIScrollableFrame
*
GetRootScrollFrame
(
)
;
nsIDOMStorageManager
*
TopSessionStorageManager
(
)
;
nsIChannel
*
GetCurrentDocChannel
(
)
;
nsresult
EnsureScriptEnvironment
(
)
;
nsresult
EnsureEditorData
(
)
;
nsresult
EnsureTransferableHookData
(
)
;
nsresult
EnsureFind
(
)
;
nsresult
EnsureCommandHandler
(
)
;
nsresult
RefreshURIFromQueue
(
)
;
nsresult
Embed
(
nsIContentViewer
*
aContentViewer
const
char
*
aCommand
nsISupports
*
aExtraInfo
)
;
nsPresContext
*
GetEldestPresContext
(
)
;
nsresult
CheckLoadingPermissions
(
)
;
nsresult
PersistLayoutHistoryState
(
)
;
nsresult
LoadHistoryEntry
(
nsISHEntry
*
aEntry
uint32_t
aLoadType
)
;
nsresult
SetBaseUrlForWyciwyg
(
nsIContentViewer
*
aContentViewer
)
;
nsresult
GetHttpChannel
(
nsIChannel
*
aChannel
nsIHttpChannel
*
*
aReturn
)
;
nsresult
ConfirmRepost
(
bool
*
aRepost
)
;
nsresult
GetPromptAndStringBundle
(
nsIPrompt
*
*
aPrompt
nsIStringBundle
*
*
aStringBundle
)
;
nsresult
SetCurScrollPosEx
(
int32_t
aCurHorizontalPos
int32_t
aCurVerticalPos
)
;
nsPoint
GetCurScrollPos
(
)
;
already_AddRefed
<
mozilla
:
:
dom
:
:
ChildSHistory
>
GetRootSessionHistory
(
)
;
inline
bool
UseErrorPages
(
)
{
return
(
mObserveErrorPages
?
sUseErrorPages
:
mUseErrorPages
)
;
}
bool
CSSErrorReportingEnabled
(
)
const
{
return
mCSSErrorReportingEnabled
;
}
void
MaybeHandleSubframeHistory
(
nsDocShellLoadState
*
aLoadState
)
;
nsresult
PerformRetargeting
(
nsDocShellLoadState
*
aLoadState
nsIDocShell
*
*
aDocShell
nsIRequest
*
*
aRequest
)
;
uint32_t
DetermineContentType
(
)
;
nsresult
MaybeHandleLoadDelegate
(
nsDocShellLoadState
*
aLoadState
uint32_t
aWindowType
bool
*
aDidHandleLoad
)
;
nsresult
MaybeHandleSameDocumentNavigation
(
nsDocShellLoadState
*
aLoadState
bool
*
aWasSameDocument
)
;
private
:
static
nsIURIFixup
*
sURIFixup
;
static
bool
sUseErrorPages
;
#
ifdef
DEBUG
static
unsigned
long
gNumberOfDocShells
;
#
endif
nsID
mHistoryID
;
nsString
mTitle
;
nsString
mCustomUserAgent
;
nsCString
mOriginalUriString
;
nsWeakPtr
mOnePermittedSandboxedNavigator
;
nsWeakPtr
mOpener
;
nsTObserverArray
<
nsWeakPtr
>
mPrivacyObservers
;
nsTObserverArray
<
nsWeakPtr
>
mReflowObservers
;
nsTObserverArray
<
nsWeakPtr
>
mScrollObservers
;
mozilla
:
:
OriginAttributes
mOriginAttributes
;
mozilla
:
:
UniquePtr
<
mozilla
:
:
dom
:
:
ClientSource
>
mInitialClientSource
;
nsCOMPtr
<
nsINetworkInterceptController
>
mInterceptController
;
RefPtr
<
nsDOMNavigationTiming
>
mTiming
;
RefPtr
<
nsDSURIContentListener
>
mContentListener
;
RefPtr
<
nsGlobalWindowOuter
>
mScriptGlobal
;
nsCOMPtr
<
nsIPrincipal
>
mParentCharsetPrincipal
;
nsCOMPtr
<
nsILoadURIDelegate
>
mLoadURIDelegate
;
nsCOMPtr
<
nsIMutableArray
>
mRefreshURIList
;
nsCOMPtr
<
nsIMutableArray
>
mSavedRefreshURIList
;
nsCOMPtr
<
nsIDOMStorageManager
>
mSessionStorageManager
;
uint64_t
mContentWindowID
;
nsCOMPtr
<
nsIContentViewer
>
mContentViewer
;
nsCOMPtr
<
nsIWidget
>
mParentWidget
;
RefPtr
<
mozilla
:
:
dom
:
:
ChildSHistory
>
mSessionHistory
;
nsCOMPtr
<
nsIWebBrowserFind
>
mFind
;
nsCOMPtr
<
nsICommandManager
>
mCommandManager
;
RefPtr
<
mozilla
:
:
dom
:
:
BrowsingContext
>
mBrowsingContext
;
nsWeakPtr
mTabChild
;
nsIntRect
mBounds
;
nsCString
mContentTypeHint
;
mozilla
:
:
UniquePtr
<
mozilla
:
:
ObservedDocShell
>
mObserved
;
nsCOMPtr
<
nsIURI
>
mCurrentURI
;
nsCOMPtr
<
nsIReferrerInfo
>
mReferrerInfo
;
nsCOMPtr
<
nsISHEntry
>
mOSHE
;
nsCOMPtr
<
nsISHEntry
>
mLSHE
;
nsRevocableEventPtr
<
RestorePresentationEvent
>
mRestorePresentationEvent
;
nsAutoPtr
<
nsDocShellEditorData
>
mEditorData
;
nsCOMPtr
<
nsISecureBrowserUI
>
mSecurityUI
;
nsCOMPtr
<
nsIURI
>
mLoadingURI
;
nsTArray
<
nsCOMPtr
<
nsIPrincipal
>
>
mAncestorPrincipals
;
nsTArray
<
uint64_t
>
mAncestorOuterWindowIDs
;
nsCOMPtr
<
nsIURI
>
mFailedURI
;
nsCOMPtr
<
nsIChannel
>
mFailedChannel
;
nsCOMPtr
<
nsIChannel
>
mMixedContentChannel
;
mozilla
:
:
UniquePtr
<
mozilla
:
:
gfx
:
:
Matrix5x4
>
mColorMatrix
;
const
mozilla
:
:
Encoding
*
mForcedCharset
;
const
mozilla
:
:
Encoding
*
mParentCharset
;
nsIDocShellTreeOwner
*
mTreeOwner
;
mozilla
:
:
dom
:
:
EventTarget
*
mChromeEventHandler
;
nsIntPoint
mDefaultScrollbarPref
;
eCharsetReloadState
mCharsetReloadState
;
mozilla
:
:
hal
:
:
ScreenOrientation
mOrientationLock
;
int32_t
mParentCharsetSource
;
int32_t
mMarginWidth
;
int32_t
mMarginHeight
;
const
int32_t
mItemType
;
int32_t
mPreviousEntryIndex
;
int32_t
mLoadedEntryIndex
;
int32_t
mChildOffset
;
uint32_t
mSandboxFlags
;
BusyFlags
mBusyFlags
;
AppType
mAppType
;
uint32_t
mLoadType
;
uint32_t
mDefaultLoadFlags
;
uint32_t
mFailedLoadType
;
FrameType
mFrameType
;
uint32_t
mPrivateBrowsingId
;
DisplayMode
mDisplayMode
;
uint32_t
mJSRunToCompletionDepth
;
TouchEventsOverride
mTouchEventsOverride
;
MetaViewportOverride
mMetaViewportOverride
;
enum
FullscreenAllowedState
:
uint8_t
{
CHECK_ATTRIBUTES
PARENT_ALLOWS
PARENT_PROHIBITS
}
;
FullscreenAllowedState
mFullscreenAllowed
;
bool
mCreatingDocument
;
#
ifdef
DEBUG
bool
mInEnsureScriptEnv
;
#
endif
bool
mCreated
:
1
;
bool
mAllowSubframes
:
1
;
bool
mAllowPlugins
:
1
;
bool
mAllowJavascript
:
1
;
bool
mAllowMetaRedirects
:
1
;
bool
mAllowImages
:
1
;
bool
mAllowMedia
:
1
;
bool
mAllowDNSPrefetch
:
1
;
bool
mAllowWindowControl
:
1
;
bool
mAllowContentRetargeting
:
1
;
bool
mAllowContentRetargetingOnChildren
:
1
;
bool
mUseErrorPages
:
1
;
bool
mUseStrictSecurityChecks
:
1
;
bool
mObserveErrorPages
:
1
;
bool
mCSSErrorReportingEnabled
:
1
;
bool
mAllowAuth
:
1
;
bool
mAllowKeywordFixup
:
1
;
bool
mIsOffScreenBrowser
:
1
;
bool
mIsActive
:
1
;
bool
mDisableMetaRefreshWhenInactive
:
1
;
bool
mIsAppTab
:
1
;
bool
mUseGlobalHistory
:
1
;
bool
mUseRemoteTabs
:
1
;
bool
mUseTrackingProtection
:
1
;
bool
mDeviceSizeIsPageSize
:
1
;
bool
mWindowDraggingAllowed
:
1
;
bool
mInFrameSwap
:
1
;
bool
mInheritPrivateBrowsingId
:
1
;
bool
mCanExecuteScripts
:
1
;
bool
mFiredUnloadEvent
:
1
;
bool
mEODForCurrentDocument
:
1
;
bool
mURIResultedInDocument
:
1
;
bool
mIsBeingDestroyed
:
1
;
bool
mIsExecutingOnLoadHandler
:
1
;
bool
mIsPrintingOrPP
:
1
;
bool
mSavingOldViewer
:
1
;
bool
mDynamicallyCreated
:
1
;
bool
mAffectPrivateSessionLifetime
:
1
;
bool
mInvisible
:
1
;
bool
mHasLoadedNonBlankURI
:
1
;
bool
mBlankTiming
:
1
;
bool
mTitleValidForCurrentURI
:
1
;
bool
mIsFrame
:
1
;
}
;
#
endif
