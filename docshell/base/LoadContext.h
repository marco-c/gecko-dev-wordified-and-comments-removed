#
ifndef
LoadContext_h
#
define
LoadContext_h
#
include
"
SerializedLoadContext
.
h
"
#
include
"
mozilla
/
Attributes
.
h
"
#
include
"
mozilla
/
BasePrincipal
.
h
"
#
include
"
nsIWeakReferenceUtils
.
h
"
#
include
"
mozilla
/
dom
/
Element
.
h
"
#
include
"
nsIInterfaceRequestor
.
h
"
#
include
"
nsILoadContext
.
h
"
namespace
mozilla
{
class
LoadContext
final
:
public
nsILoadContext
public
nsIInterfaceRequestor
{
public
:
NS_DECL_ISUPPORTS
NS_DECL_NSILOADCONTEXT
NS_DECL_NSIINTERFACEREQUESTOR
LoadContext
(
const
IPC
:
:
SerializedLoadContext
&
aToCopy
dom
:
:
Element
*
aTopFrameElement
DocShellOriginAttributes
&
aAttrs
)
:
mTopFrameElement
(
do_GetWeakReference
(
aTopFrameElement
)
)
mNestedFrameId
(
0
)
mIsContent
(
aToCopy
.
mIsContent
)
mUsePrivateBrowsing
(
aToCopy
.
mUsePrivateBrowsing
)
mUseRemoteTabs
(
aToCopy
.
mUseRemoteTabs
)
mOriginAttributes
(
aAttrs
)
#
ifdef
DEBUG
mIsNotNull
(
aToCopy
.
mIsNotNull
)
#
endif
{
MOZ_ASSERT
(
aToCopy
.
mUsePrivateBrowsing
=
=
(
aAttrs
.
mPrivateBrowsingId
!
=
0
)
)
;
}
LoadContext
(
const
IPC
:
:
SerializedLoadContext
&
aToCopy
uint64_t
aNestedFrameId
DocShellOriginAttributes
&
aAttrs
)
:
mTopFrameElement
(
nullptr
)
mNestedFrameId
(
aNestedFrameId
)
mIsContent
(
aToCopy
.
mIsContent
)
mUsePrivateBrowsing
(
aToCopy
.
mUsePrivateBrowsing
)
mUseRemoteTabs
(
aToCopy
.
mUseRemoteTabs
)
mOriginAttributes
(
aAttrs
)
#
ifdef
DEBUG
mIsNotNull
(
aToCopy
.
mIsNotNull
)
#
endif
{
MOZ_ASSERT
(
aToCopy
.
mUsePrivateBrowsing
=
=
(
aAttrs
.
mPrivateBrowsingId
!
=
0
)
)
;
}
LoadContext
(
dom
:
:
Element
*
aTopFrameElement
bool
aIsContent
bool
aUsePrivateBrowsing
bool
aUseRemoteTabs
const
DocShellOriginAttributes
&
aAttrs
)
:
mTopFrameElement
(
do_GetWeakReference
(
aTopFrameElement
)
)
mNestedFrameId
(
0
)
mIsContent
(
aIsContent
)
mUsePrivateBrowsing
(
aUsePrivateBrowsing
)
mUseRemoteTabs
(
aUseRemoteTabs
)
mOriginAttributes
(
aAttrs
)
#
ifdef
DEBUG
mIsNotNull
(
true
)
#
endif
{
MOZ_ASSERT
(
aUsePrivateBrowsing
=
=
(
aAttrs
.
mPrivateBrowsingId
!
=
0
)
)
;
}
explicit
LoadContext
(
uint32_t
aAppId
)
:
mTopFrameElement
(
nullptr
)
mNestedFrameId
(
0
)
mIsContent
(
false
)
mUsePrivateBrowsing
(
false
)
mUseRemoteTabs
(
false
)
mOriginAttributes
(
aAppId
false
)
#
ifdef
DEBUG
mIsNotNull
(
true
)
#
endif
{
}
explicit
LoadContext
(
nsIPrincipal
*
aPrincipal
nsILoadContext
*
aOptionalBase
=
nullptr
)
;
private
:
~
LoadContext
(
)
{
}
nsWeakPtr
mTopFrameElement
;
uint64_t
mNestedFrameId
;
bool
mIsContent
;
bool
mUsePrivateBrowsing
;
bool
mUseRemoteTabs
;
DocShellOriginAttributes
mOriginAttributes
;
#
ifdef
DEBUG
bool
mIsNotNull
;
#
endif
}
;
}
#
endif
