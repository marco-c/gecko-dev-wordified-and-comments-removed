"
use
strict
"
;
const
{
classes
:
Cc
interfaces
:
Ci
utils
:
Cu
results
:
Cr
}
=
Components
;
var
gCertDB
=
Cc
[
"
mozilla
.
org
/
security
/
x509certdb
;
1
"
]
.
getService
(
Ci
.
nsIX509CertDB
)
;
var
gCert
;
function
onLoad
(
)
{
gCert
=
window
.
arguments
[
0
]
;
let
bundle
=
document
.
getElementById
(
"
pippki_bundle
"
)
;
setText
(
"
certmsg
"
bundle
.
getFormattedString
(
"
editTrustCA
"
[
gCert
.
commonName
]
)
)
;
let
sslCheckbox
=
document
.
getElementById
(
"
trustSSL
"
)
;
sslCheckbox
.
checked
=
gCertDB
.
isCertTrusted
(
gCert
Ci
.
nsIX509Cert
.
CA_CERT
Ci
.
nsIX509CertDB
.
TRUSTED_SSL
)
;
let
emailCheckbox
=
document
.
getElementById
(
"
trustEmail
"
)
;
emailCheckbox
.
checked
=
gCertDB
.
isCertTrusted
(
gCert
Ci
.
nsIX509Cert
.
CA_CERT
Ci
.
nsIX509CertDB
.
TRUSTED_EMAIL
)
;
let
objSignCheckbox
=
document
.
getElementById
(
"
trustObjSign
"
)
;
objSignCheckbox
.
checked
=
gCertDB
.
isCertTrusted
(
gCert
Ci
.
nsIX509Cert
.
CA_CERT
Ci
.
nsIX509CertDB
.
TRUSTED_OBJSIGN
)
;
}
function
onDialogAccept
(
)
{
let
sslCheckbox
=
document
.
getElementById
(
"
trustSSL
"
)
;
let
emailCheckbox
=
document
.
getElementById
(
"
trustEmail
"
)
;
let
objSignCheckbox
=
document
.
getElementById
(
"
trustObjSign
"
)
;
let
trustSSL
=
sslCheckbox
.
checked
?
Ci
.
nsIX509CertDB
.
TRUSTED_SSL
:
0
;
let
trustEmail
=
emailCheckbox
.
checked
?
Ci
.
nsIX509CertDB
.
TRUSTED_EMAIL
:
0
;
let
trustObjSign
=
objSignCheckbox
.
checked
?
Ci
.
nsIX509CertDB
.
TRUSTED_OBJSIGN
:
0
;
gCertDB
.
setCertTrust
(
gCert
Ci
.
nsIX509Cert
.
CA_CERT
trustSSL
|
trustEmail
|
trustObjSign
)
;
return
true
;
}
