"
use
strict
"
;
do_get_profile
(
)
;
const
certdb
=
Cc
[
"
mozilla
.
org
/
security
/
x509certdb
;
1
"
]
.
getService
(
Ci
.
nsIX509CertDB
)
;
async
function
do_testcase
(
certname
checkCommonName
)
{
let
cert
=
constructCertFromFile
(
test_cert_embedded_null
/
{
certname
}
.
pem
)
;
if
(
checkCommonName
)
{
equal
(
cert
.
commonName
"
www
.
bank1
.
com
\
\
00www
.
bad
-
guy
.
com
"
"
certificate
subject
common
name
should
have
an
embedded
NUL
byte
"
)
;
}
await
checkCertErrorGeneric
(
certdb
cert
SSL_ERROR_BAD_CERT_DOMAIN
Ci
.
nsIX509CertDB
.
verifyUsageTLSServer
undefined
"
www
.
bank1
.
com
"
)
;
await
checkCertErrorGeneric
(
certdb
cert
SSL_ERROR_BAD_CERT_DOMAIN
Ci
.
nsIX509CertDB
.
verifyUsageTLSServer
undefined
"
www
.
bad
-
guy
.
com
"
)
;
}
add_task
(
async
function
(
)
{
addCertFromFile
(
certdb
"
test_cert_embedded_null
/
ca
.
pem
"
"
CTu
"
)
;
await
do_testcase
(
"
embeddedNull
"
true
)
;
await
do_testcase
(
"
embeddedNullSAN
"
false
)
;
await
do_testcase
(
"
embeddedNullCNAndSAN
"
true
)
;
await
do_testcase
(
"
embeddedNullSAN2
"
false
)
;
}
)
;
