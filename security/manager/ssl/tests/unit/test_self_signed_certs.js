"
use
strict
"
;
add_task
(
async
function
run_test_no_overlong_path_building
(
)
{
let
profile
=
do_get_profile
(
)
;
const
CERT_DB_NAME
=
"
cert9
.
db
"
;
let
srcCertDBFile
=
do_get_file
(
test_self_signed_certs
/
{
CERT_DB_NAME
}
)
;
srcCertDBFile
.
copyTo
(
profile
CERT_DB_NAME
)
;
let
certDB
=
Cc
[
"
mozilla
.
org
/
security
/
x509certdb
;
1
"
]
.
getService
(
Ci
.
nsIX509CertDB
)
;
let
certToVerify
=
null
;
for
(
let
cert
of
certDB
.
getCerts
(
)
.
getEnumerator
(
)
)
{
if
(
cert
.
subjectName
=
=
"
CN
=
self
-
signed
cert
"
)
{
certToVerify
=
cert
;
break
;
}
}
notEqual
(
certToVerify
null
"
should
have
found
one
of
the
preloaded
self
-
signed
certs
"
)
;
let
timeBefore
=
Date
.
now
(
)
;
for
(
let
i
=
0
;
i
<
10
;
i
+
+
)
{
let
date
=
new
Date
(
"
2019
-
05
-
15T00
:
00
:
00
.
000Z
"
)
;
await
checkCertErrorGenericAtTime
(
certDB
certToVerify
SEC_ERROR_UNKNOWN_ISSUER
certificateUsageSSLCA
date
.
getTime
(
)
/
1000
)
;
}
let
timeAfter
=
Date
.
now
(
)
;
let
secondsElapsed
=
(
timeAfter
-
timeBefore
)
/
1000
;
ok
(
secondsElapsed
<
120
"
verifications
shouldn
'
t
take
too
long
"
)
;
}
)
;
