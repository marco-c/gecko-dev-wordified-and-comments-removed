"
use
strict
"
;
function
shouldBeDelegatedCredential
(
aTransportSecurityInfo
)
{
Assert
.
ok
(
aTransportSecurityInfo
.
isDelegatedCredential
"
This
host
should
have
used
a
delegated
credential
"
)
;
}
function
shouldNotBeDelegatedCredential
(
aTransportSecurityInfo
)
{
Assert
.
ok
(
!
aTransportSecurityInfo
.
isDelegatedCredential
"
This
host
should
not
have
used
a
delegated
credential
"
)
;
}
do_get_profile
(
)
;
add_tls_server_setup
(
"
DelegatedCredentialsServer
"
"
test_delegated_credentials
"
)
;
add_test
(
function
(
)
{
clearSessionCache
(
)
;
Services
.
prefs
.
setBoolPref
(
"
security
.
tls
.
enable_delegated_credentials
"
false
)
;
run_next_test
(
)
;
}
)
;
add_connection_test
(
"
delegated
-
enabled
.
example
.
com
"
PRErrorCodeSuccess
null
shouldNotBeDelegatedCredential
)
;
add_test
(
function
(
)
{
clearSessionCache
(
)
;
Services
.
prefs
.
setBoolPref
(
"
security
.
tls
.
enable_delegated_credentials
"
true
)
;
run_next_test
(
)
;
}
)
;
add_connection_test
(
"
standard
-
enabled
.
example
.
com
"
SSL_ERROR_DC_INVALID_KEY_USAGE
null
null
)
;
add_connection_test
(
"
delegated
-
disabled
.
example
.
com
"
PRErrorCodeSuccess
null
shouldNotBeDelegatedCredential
)
;
add_connection_test
(
"
delegated
-
enabled
.
example
.
com
"
PRErrorCodeSuccess
null
shouldBeDelegatedCredential
)
;
