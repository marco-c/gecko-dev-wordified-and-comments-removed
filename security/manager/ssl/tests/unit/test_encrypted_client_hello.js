"
use
strict
"
;
const
ECH_CONFIG_FIXED
=
"
AEn
+
DQBFTQAgACCKB1Y5SfrGIyk27W82xPpzWTDs3q72c04xSurDWlb9CgAEAAEAA2QWZWNoLXB1YmxpYy5leGFtcGxlLmNvbQAA
"
;
const
ECH_CONFIG_TRUSTED_RETRY
=
"
AEn
+
DQBFTQAgACCKB1Y5SfrGIyk27W82xPpzWTDs3q72c04xSurDWlb9CgAEAAMAA2QWZWNoLXB1YmxpYy5leGFtcGxlLmNvbQAA
"
;
const
ECH_CONFIG_UNTRUSTED_RETRY
=
"
AEn
+
DQBFTQAgACCKB1Y5SfrGIyk27W82xPpzWTDs3q72c04xSurDWlb9CgAEAAMAA2QWc2VsZnNpZ25lZC5leGFtcGxlLmNvbQAA
"
;
function
shouldBeAcceptedEch
(
aTransportSecurityInfo
)
{
Assert
.
ok
(
aTransportSecurityInfo
.
isAcceptedEch
"
This
host
should
have
accepted
ECH
"
)
;
Assert
.
ok
(
!
aTransportSecurityInfo
.
usedPrivateDNS
"
This
connection
does
not
use
DoH
"
)
;
}
function
shouldBeRejectedEch
(
aTransportSecurityInfo
)
{
Assert
.
ok
(
!
aTransportSecurityInfo
.
isAcceptedEch
"
This
host
should
have
rejected
ECH
"
)
;
Assert
.
ok
(
!
aTransportSecurityInfo
.
usedPrivateDNS
"
This
connection
does
not
use
DoH
"
)
;
}
do_get_profile
(
)
;
add_tls_server_setup
(
"
EncryptedClientHelloServer
"
"
test_encrypted_client_hello
"
)
;
add_connection_test
(
"
ech
-
public
.
example
.
com
"
PRErrorCodeSuccess
null
shouldBeRejectedEch
)
;
add_connection_test
(
"
ech
-
private
.
example
.
com
"
PRErrorCodeSuccess
null
shouldBeAcceptedEch
null
null
ECH_CONFIG_FIXED
)
;
add_connection_test
(
"
ech
-
private
.
example
.
com
"
SSL_ERROR_ECH_RETRY_WITH_ECH
null
null
null
null
ECH_CONFIG_TRUSTED_RETRY
)
;
add_connection_test
(
"
ech
-
private
.
example
.
com
"
MOZILLA_PKIX_ERROR_SELF_SIGNED_CERT
null
null
null
null
ECH_CONFIG_UNTRUSTED_RETRY
)
;
