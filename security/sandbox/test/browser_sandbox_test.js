"
use
strict
"
;
function
test
(
)
{
waitForExplicitFinish
(
)
;
const
{
Services
}
=
ChromeUtils
.
import
(
"
resource
:
/
/
gre
/
modules
/
Services
.
jsm
"
)
;
var
processTypes
=
[
"
tab
"
"
socket
"
"
rdd
"
"
gpu
"
]
;
let
sandboxTestResult
=
(
subject
topic
data
)
=
>
{
let
{
testid
shouldPermit
wasPermitted
message
}
=
JSON
.
parse
(
data
)
;
ok
(
shouldPermit
=
=
wasPermitted
"
Test
"
+
testid
+
"
was
"
+
(
wasPermitted
?
"
"
:
"
not
"
)
+
"
permitted
.
|
"
+
message
)
;
}
;
Services
.
obs
.
addObserver
(
sandboxTestResult
"
sandbox
-
test
-
result
"
)
;
var
remainingTests
=
processTypes
.
length
;
let
sandboxTestDone
=
(
)
=
>
{
remainingTests
=
remainingTests
-
1
;
if
(
remainingTests
=
=
0
)
{
Services
.
obs
.
removeObserver
(
sandboxTestResult
"
sandbox
-
test
-
result
"
)
;
Services
.
obs
.
removeObserver
(
sandboxTestDone
"
sandbox
-
test
-
done
"
)
;
comp
.
finishTests
(
)
;
finish
(
)
;
}
}
;
Services
.
obs
.
addObserver
(
sandboxTestDone
"
sandbox
-
test
-
done
"
)
;
var
comp
=
Cc
[
"
mozilla
.
org
/
sandbox
/
sandbox
-
test
;
1
"
]
.
getService
(
Ci
.
mozISandboxTest
)
;
comp
.
startTests
(
processTypes
)
;
}
