#
include
"
base
/
logging
.
h
"
#
if
defined
(
OS_WIN
)
#
include
<
windows
.
h
>
#
endif
#
if
defined
(
OS_POSIX
)
#
include
<
errno
.
h
>
#
endif
#
if
defined
(
OS_WIN
)
#
include
"
base
/
strings
/
utf_string_conversions
.
h
"
#
endif
#
include
<
algorithm
>
#
include
"
mozilla
/
Unused
.
h
"
namespace
logging
{
namespace
{
int
g_min_log_level
=
0
;
LoggingDestination
g_logging_destination
=
LOG_DEFAULT
;
const
int
kAlwaysPrintErrorLevel
=
LOG_ERROR
;
LogMessageHandlerFunction
log_message_handler
=
nullptr
;
}
std
:
:
ostream
*
g_swallow_stream
;
void
SetMinLogLevel
(
int
level
)
{
g_min_log_level
=
std
:
:
min
(
LOG_FATAL
level
)
;
}
int
GetMinLogLevel
(
)
{
return
g_min_log_level
;
}
bool
ShouldCreateLogMessage
(
int
severity
)
{
if
(
severity
<
g_min_log_level
)
return
false
;
return
g_logging_destination
!
=
LOG_NONE
|
|
log_message_handler
|
|
severity
>
=
kAlwaysPrintErrorLevel
;
}
int
GetVlogLevelHelper
(
const
char
*
file
size_t
N
)
{
return
0
;
}
template
std
:
:
string
*
MakeCheckOpString
<
int
int
>
(
const
int
&
const
int
&
const
char
*
names
)
;
template
std
:
:
string
*
MakeCheckOpString
<
unsigned
long
unsigned
long
>
(
const
unsigned
long
&
const
unsigned
long
&
const
char
*
names
)
;
template
std
:
:
string
*
MakeCheckOpString
<
unsigned
long
unsigned
int
>
(
const
unsigned
long
&
const
unsigned
int
&
const
char
*
names
)
;
template
std
:
:
string
*
MakeCheckOpString
<
unsigned
int
unsigned
long
>
(
const
unsigned
int
&
const
unsigned
long
&
const
char
*
names
)
;
template
std
:
:
string
*
MakeCheckOpString
<
std
:
:
string
std
:
:
string
>
(
const
std
:
:
string
&
const
std
:
:
string
&
const
char
*
name
)
;
#
if
defined
(
OS_WIN
)
LogMessage
:
:
SaveLastError
:
:
SaveLastError
(
)
:
last_error_
(
:
:
GetLastError
(
)
)
{
}
LogMessage
:
:
SaveLastError
:
:
~
SaveLastError
(
)
{
:
:
SetLastError
(
last_error_
)
;
}
#
endif
LogMessage
:
:
LogMessage
(
const
char
*
file
int
line
LogSeverity
severity
)
:
severity_
(
severity
)
file_
(
file
)
line_
(
line
)
{
}
LogMessage
:
:
LogMessage
(
const
char
*
file
int
line
const
char
*
condition
)
:
severity_
(
LOG_FATAL
)
file_
(
file
)
line_
(
line
)
{
}
LogMessage
:
:
LogMessage
(
const
char
*
file
int
line
std
:
:
string
*
result
)
:
severity_
(
LOG_FATAL
)
file_
(
file
)
line_
(
line
)
{
delete
result
;
}
LogMessage
:
:
LogMessage
(
const
char
*
file
int
line
LogSeverity
severity
std
:
:
string
*
result
)
:
severity_
(
severity
)
file_
(
file
)
line_
(
line
)
{
delete
result
;
}
LogMessage
:
:
~
LogMessage
(
)
{
}
SystemErrorCode
GetLastSystemErrorCode
(
)
{
#
if
defined
(
OS_WIN
)
return
:
:
GetLastError
(
)
;
#
elif
defined
(
OS_POSIX
)
return
errno
;
#
else
#
error
Not
implemented
#
endif
}
#
if
defined
(
OS_WIN
)
Win32ErrorLogMessage
:
:
Win32ErrorLogMessage
(
const
char
*
file
int
line
LogSeverity
severity
SystemErrorCode
err
)
:
err_
(
err
)
log_message_
(
file
line
severity
)
{
mozilla
:
:
Unused
<
<
err_
;
}
Win32ErrorLogMessage
:
:
~
Win32ErrorLogMessage
(
)
{
}
#
elif
defined
(
OS_POSIX
)
ErrnoLogMessage
:
:
ErrnoLogMessage
(
const
char
*
file
int
line
LogSeverity
severity
SystemErrorCode
err
)
:
err_
(
err
)
log_message_
(
file
line
severity
)
{
mozilla
:
:
Unused
<
<
err_
;
}
ErrnoLogMessage
:
:
~
ErrnoLogMessage
(
)
{
}
#
endif
void
RawLog
(
int
level
const
char
*
message
)
{
}
}
#
if
defined
(
OS_WIN
)
std
:
:
ostream
&
std
:
:
operator
<
<
(
std
:
:
ostream
&
out
const
wchar_t
*
wstr
)
{
return
out
<
<
base
:
:
WideToUTF8
(
std
:
:
wstring
(
wstr
)
)
;
}
#
endif
