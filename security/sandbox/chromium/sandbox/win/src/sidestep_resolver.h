#
ifndef
SANDBOX_SRC_SIDESTEP_RESOLVER_H__
#
define
SANDBOX_SRC_SIDESTEP_RESOLVER_H__
#
include
<
stddef
.
h
>
#
include
"
base
/
macros
.
h
"
#
include
"
sandbox
/
win
/
src
/
nt_internals
.
h
"
#
include
"
sandbox
/
win
/
src
/
resolver
.
h
"
namespace
sandbox
{
class
SidestepResolverThunk
:
public
ResolverThunk
{
public
:
SidestepResolverThunk
(
)
{
}
~
SidestepResolverThunk
(
)
override
{
}
NTSTATUS
Setup
(
const
void
*
target_module
const
void
*
interceptor_module
const
char
*
target_name
const
char
*
interceptor_name
const
void
*
interceptor_entry_point
void
*
thunk_storage
size_t
storage_bytes
size_t
*
storage_used
)
override
;
size_t
GetThunkSize
(
)
const
override
;
private
:
DISALLOW_COPY_AND_ASSIGN
(
SidestepResolverThunk
)
;
}
;
class
SmartSidestepResolverThunk
:
public
SidestepResolverThunk
{
public
:
SmartSidestepResolverThunk
(
)
{
}
~
SmartSidestepResolverThunk
(
)
override
{
}
NTSTATUS
Setup
(
const
void
*
target_module
const
void
*
interceptor_module
const
char
*
target_name
const
char
*
interceptor_name
const
void
*
interceptor_entry_point
void
*
thunk_storage
size_t
storage_bytes
size_t
*
storage_used
)
override
;
size_t
GetThunkSize
(
)
const
override
;
private
:
static
void
SmartStub
(
)
;
static
bool
IsInternalCall
(
const
void
*
base
void
*
return_address
)
;
DISALLOW_COPY_AND_ASSIGN
(
SmartSidestepResolverThunk
)
;
}
;
}
#
endif
