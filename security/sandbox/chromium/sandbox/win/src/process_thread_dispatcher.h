#
ifndef
SANDBOX_WIN_SRC_PROCESS_THREAD_DISPATCHER_H_
#
define
SANDBOX_WIN_SRC_PROCESS_THREAD_DISPATCHER_H_
#
include
<
stdint
.
h
>
#
include
"
sandbox
/
win
/
src
/
crosscall_server
.
h
"
#
include
"
sandbox
/
win
/
src
/
ipc_tags
.
h
"
#
include
"
sandbox
/
win
/
src
/
sandbox_policy_base
.
h
"
namespace
sandbox
{
class
ThreadProcessDispatcher
:
public
Dispatcher
{
public
:
explicit
ThreadProcessDispatcher
(
)
;
ThreadProcessDispatcher
(
const
ThreadProcessDispatcher
&
)
=
delete
;
ThreadProcessDispatcher
&
operator
=
(
const
ThreadProcessDispatcher
&
)
=
delete
;
~
ThreadProcessDispatcher
(
)
override
{
}
bool
SetupService
(
InterceptionManager
*
manager
IpcTag
service
)
override
;
private
:
bool
NtOpenThread
(
IPCInfo
*
ipc
uint32_t
desired_access
uint32_t
thread_id
)
;
bool
NtOpenProcessTokenEx
(
IPCInfo
*
ipc
HANDLE
process
uint32_t
desired_access
uint32_t
attributes
)
;
bool
CreateThread
(
IPCInfo
*
ipc
SIZE_T
stack_size
LPTHREAD_START_ROUTINE
start_address
LPVOID
parameter
DWORD
creation_flags
)
;
}
;
}
#
endif
