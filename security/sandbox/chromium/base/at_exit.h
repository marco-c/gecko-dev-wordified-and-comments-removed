#
ifndef
BASE_AT_EXIT_H_
#
define
BASE_AT_EXIT_H_
#
include
"
base
/
base_export
.
h
"
#
include
"
base
/
callback
.
h
"
#
include
"
base
/
containers
/
stack
.
h
"
#
include
"
base
/
macros
.
h
"
#
include
"
base
/
synchronization
/
lock
.
h
"
#
include
"
base
/
thread_annotations
.
h
"
namespace
base
{
class
BASE_EXPORT
AtExitManager
{
public
:
typedef
void
(
*
AtExitCallbackType
)
(
void
*
)
;
AtExitManager
(
)
;
~
AtExitManager
(
)
;
static
void
RegisterCallback
(
AtExitCallbackType
func
void
*
param
)
;
static
void
RegisterTask
(
base
:
:
Closure
task
)
;
static
void
ProcessCallbacksNow
(
)
;
static
void
DisableAllAtExitManagers
(
)
;
protected
:
explicit
AtExitManager
(
bool
shadow
)
;
private
:
base
:
:
Lock
lock_
;
base
:
:
stack
<
base
:
:
Closure
>
stack_
GUARDED_BY
(
lock_
)
;
#
if
DCHECK_IS_ON
(
)
bool
processing_callbacks_
GUARDED_BY
(
lock_
)
=
false
;
#
endif
AtExitManager
*
const
next_manager_
;
DISALLOW_COPY_AND_ASSIGN
(
AtExitManager
)
;
}
;
#
if
defined
(
UNIT_TEST
)
class
ShadowingAtExitManager
:
public
AtExitManager
{
public
:
ShadowingAtExitManager
(
)
:
AtExitManager
(
true
)
{
}
}
;
#
endif
}
#
endif
