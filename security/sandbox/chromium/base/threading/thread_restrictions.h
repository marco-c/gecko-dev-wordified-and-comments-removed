#
ifndef
BASE_THREADING_THREAD_RESTRICTIONS_H_
#
define
BASE_THREADING_THREAD_RESTRICTIONS_H_
#
include
"
base
/
base_export
.
h
"
#
include
"
base
/
logging
.
h
"
#
include
"
base
/
macros
.
h
"
class
BrowserProcessImpl
;
class
HistogramSynchronizer
;
class
NativeBackendKWallet
;
namespace
android_webview
{
class
AwFormDatabaseService
;
class
CookieManager
;
}
namespace
cc
{
class
CompletionEvent
;
class
SingleThreadTaskGraphRunner
;
}
namespace
chromeos
{
class
BlockingMethodCaller
;
namespace
system
{
class
StatisticsProviderImpl
;
}
}
namespace
chrome_browser_net
{
class
Predictor
;
}
namespace
content
{
class
BrowserGpuChannelHostFactory
;
class
BrowserGpuMemoryBufferManager
;
class
BrowserMainLoop
;
class
BrowserShutdownProfileDumper
;
class
BrowserSurfaceViewManager
;
class
BrowserTestBase
;
class
CategorizedWorkerPool
;
class
NestedMessagePumpAndroid
;
class
ScopedAllowWaitForAndroidLayoutTests
;
class
ScopedAllowWaitForDebugURL
;
class
SoftwareOutputDeviceMus
;
class
SynchronousCompositor
;
class
SynchronousCompositorBrowserFilter
;
class
SynchronousCompositorHost
;
class
TextInputClientMac
;
}
namespace
dbus
{
class
Bus
;
}
namespace
disk_cache
{
class
BackendImpl
;
class
InFlightIO
;
}
namespace
gpu
{
class
GpuChannelHost
;
}
namespace
mojo
{
class
SyncCallRestrictions
;
namespace
edk
{
class
ScopedIPCSupport
;
}
}
namespace
ui
{
class
CommandBufferClientImpl
;
class
CommandBufferLocal
;
class
GpuState
;
}
namespace
net
{
class
NetworkChangeNotifierMac
;
namespace
internal
{
class
AddressTrackerLinux
;
}
}
namespace
remoting
{
class
AutoThread
;
}
namespace
ui
{
class
WindowResizeHelperMac
;
}
namespace
views
{
class
ScreenMus
;
}
namespace
viz
{
class
ServerGpuMemoryBufferManager
;
}
namespace
base
{
namespace
android
{
class
JavaHandlerThread
;
}
namespace
internal
{
class
TaskTracker
;
}
class
SequencedWorkerPool
;
class
SimpleThread
;
class
StackSamplingProfiler
;
class
Thread
;
class
ThreadTestHelper
;
class
BASE_EXPORT
ThreadRestrictions
{
public
:
class
BASE_EXPORT
ScopedAllowIO
{
public
:
ScopedAllowIO
(
)
{
previous_value_
=
SetIOAllowed
(
true
)
;
}
~
ScopedAllowIO
(
)
{
SetIOAllowed
(
previous_value_
)
;
}
private
:
bool
previous_value_
;
DISALLOW_COPY_AND_ASSIGN
(
ScopedAllowIO
)
;
}
;
#
if
DCHECK_IS_ON
(
)
static
bool
SetIOAllowed
(
bool
allowed
)
;
static
void
AssertIOAllowed
(
)
;
static
bool
SetSingletonAllowed
(
bool
allowed
)
;
static
void
AssertSingletonAllowed
(
)
;
static
void
DisallowWaiting
(
)
;
static
void
AssertWaitAllowed
(
)
;
#
else
static
bool
SetIOAllowed
(
bool
allowed
)
{
return
true
;
}
static
void
AssertIOAllowed
(
)
{
}
static
bool
SetSingletonAllowed
(
bool
allowed
)
{
return
true
;
}
static
void
AssertSingletonAllowed
(
)
{
}
static
void
DisallowWaiting
(
)
{
}
static
void
AssertWaitAllowed
(
)
{
}
#
endif
private
:
friend
class
android_webview
:
:
AwFormDatabaseService
;
friend
class
android_webview
:
:
CookieManager
;
friend
class
base
:
:
StackSamplingProfiler
;
friend
class
content
:
:
BrowserMainLoop
;
friend
class
content
:
:
BrowserShutdownProfileDumper
;
friend
class
content
:
:
BrowserSurfaceViewManager
;
friend
class
content
:
:
BrowserTestBase
;
friend
class
content
:
:
NestedMessagePumpAndroid
;
friend
class
content
:
:
ScopedAllowWaitForAndroidLayoutTests
;
friend
class
content
:
:
ScopedAllowWaitForDebugURL
;
friend
class
content
:
:
SynchronousCompositor
;
friend
class
content
:
:
SynchronousCompositorBrowserFilter
;
friend
class
content
:
:
SynchronousCompositorHost
;
friend
class
:
:
HistogramSynchronizer
;
friend
class
internal
:
:
TaskTracker
;
friend
class
cc
:
:
CompletionEvent
;
friend
class
cc
:
:
SingleThreadTaskGraphRunner
;
friend
class
content
:
:
CategorizedWorkerPool
;
friend
class
remoting
:
:
AutoThread
;
friend
class
ui
:
:
WindowResizeHelperMac
;
friend
class
MessagePumpDefault
;
friend
class
SequencedWorkerPool
;
friend
class
SimpleThread
;
friend
class
Thread
;
friend
class
ThreadTestHelper
;
friend
class
PlatformThread
;
friend
class
android
:
:
JavaHandlerThread
;
friend
class
mojo
:
:
SyncCallRestrictions
;
friend
class
mojo
:
:
edk
:
:
ScopedIPCSupport
;
friend
class
ui
:
:
CommandBufferClientImpl
;
friend
class
ui
:
:
CommandBufferLocal
;
friend
class
ui
:
:
GpuState
;
friend
class
:
:
chromeos
:
:
BlockingMethodCaller
;
friend
class
:
:
chromeos
:
:
system
:
:
StatisticsProviderImpl
;
friend
class
chrome_browser_net
:
:
Predictor
;
friend
class
content
:
:
BrowserGpuChannelHostFactory
;
friend
class
content
:
:
BrowserGpuMemoryBufferManager
;
friend
class
content
:
:
TextInputClientMac
;
friend
class
dbus
:
:
Bus
;
friend
class
disk_cache
:
:
BackendImpl
;
friend
class
disk_cache
:
:
InFlightIO
;
friend
class
gpu
:
:
GpuChannelHost
;
friend
class
net
:
:
internal
:
:
AddressTrackerLinux
;
friend
class
net
:
:
NetworkChangeNotifierMac
;
friend
class
:
:
BrowserProcessImpl
;
friend
class
:
:
NativeBackendKWallet
;
#
if
!
defined
(
OFFICIAL_BUILD
)
friend
class
content
:
:
SoftwareOutputDeviceMus
;
#
endif
friend
class
views
:
:
ScreenMus
;
friend
class
viz
:
:
ServerGpuMemoryBufferManager
;
#
if
DCHECK_IS_ON
(
)
static
bool
SetWaitAllowed
(
bool
allowed
)
;
#
else
static
bool
SetWaitAllowed
(
bool
allowed
)
{
return
true
;
}
#
endif
class
BASE_EXPORT
ScopedAllowWait
{
public
:
ScopedAllowWait
(
)
{
previous_value_
=
SetWaitAllowed
(
true
)
;
}
~
ScopedAllowWait
(
)
{
SetWaitAllowed
(
previous_value_
)
;
}
private
:
bool
previous_value_
;
DISALLOW_COPY_AND_ASSIGN
(
ScopedAllowWait
)
;
}
;
DISALLOW_IMPLICIT_CONSTRUCTORS
(
ThreadRestrictions
)
;
}
;
}
#
endif
