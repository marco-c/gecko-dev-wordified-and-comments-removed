#
ifndef
BASE_PROCESS_LAUNCH_H_
#
define
BASE_PROCESS_LAUNCH_H_
#
include
<
stddef
.
h
>
#
include
<
string
>
#
include
<
utility
>
#
include
<
vector
>
#
include
"
base
/
base_export
.
h
"
#
include
"
base
/
environment
.
h
"
#
include
"
base
/
macros
.
h
"
#
include
"
base
/
process
/
process
.
h
"
#
include
"
base
/
process
/
process_handle
.
h
"
#
include
"
base
/
strings
/
string_piece
.
h
"
#
include
"
build
/
build_config
.
h
"
#
if
defined
(
OS_WIN
)
#
include
<
windows
.
h
>
#
elif
defined
(
OS_FUCHSIA
)
#
include
<
lib
/
fdio
/
spawn
.
h
>
#
include
<
zircon
/
types
.
h
>
#
endif
#
if
defined
(
OS_POSIX
)
|
|
defined
(
OS_FUCHSIA
)
#
include
"
base
/
posix
/
file_descriptor_shuffle
.
h
"
#
endif
#
if
defined
(
OS_MACOSX
)
&
&
!
defined
(
OS_IOS
)
#
include
"
base
/
mac
/
mach_port_rendezvous
.
h
"
#
endif
namespace
base
{
class
CommandLine
;
#
if
defined
(
OS_WIN
)
typedef
std
:
:
vector
<
HANDLE
>
HandlesToInheritVector
;
#
elif
defined
(
OS_FUCHSIA
)
struct
PathToTransfer
{
base
:
:
FilePath
path
;
zx_handle_t
handle
;
}
;
struct
HandleToTransfer
{
uint32_t
id
;
zx_handle_t
handle
;
}
;
typedef
std
:
:
vector
<
HandleToTransfer
>
HandlesToTransferVector
;
typedef
std
:
:
vector
<
std
:
:
pair
<
int
int
>
>
FileHandleMappingVector
;
#
elif
defined
(
OS_POSIX
)
typedef
std
:
:
vector
<
std
:
:
pair
<
int
int
>
>
FileHandleMappingVector
;
#
endif
struct
BASE_EXPORT
LaunchOptions
{
#
if
(
defined
(
OS_POSIX
)
|
|
defined
(
OS_FUCHSIA
)
)
&
&
!
defined
(
OS_MACOSX
)
class
BASE_EXPORT
PreExecDelegate
{
public
:
PreExecDelegate
(
)
=
default
;
virtual
~
PreExecDelegate
(
)
=
default
;
virtual
void
RunAsyncSafe
(
)
=
0
;
private
:
DISALLOW_COPY_AND_ASSIGN
(
PreExecDelegate
)
;
}
;
#
endif
LaunchOptions
(
)
;
LaunchOptions
(
const
LaunchOptions
&
)
;
~
LaunchOptions
(
)
;
bool
wait
=
false
;
base
:
:
FilePath
current_directory
;
#
if
defined
(
OS_WIN
)
bool
start_hidden
=
false
;
bool
feedback_cursor_off
=
false
;
enum
class
Inherit
{
kSpecific
kAll
}
;
Inherit
inherit_mode
=
Inherit
:
:
kSpecific
;
HandlesToInheritVector
handles_to_inherit
;
UserTokenHandle
as_user
=
nullptr
;
bool
empty_desktop_name
=
false
;
HANDLE
job_handle
=
nullptr
;
HANDLE
stdin_handle
=
nullptr
;
HANDLE
stdout_handle
=
nullptr
;
HANDLE
stderr_handle
=
nullptr
;
bool
force_breakaway_from_job_
=
false
;
bool
grant_foreground_privilege
=
false
;
#
elif
defined
(
OS_POSIX
)
|
|
defined
(
OS_FUCHSIA
)
EnvironmentMap
environ
;
bool
clear_environ
=
false
;
FileHandleMappingVector
fds_to_remap
;
#
endif
#
if
defined
(
OS_LINUX
)
int
clone_flags
=
0
;
bool
allow_new_privs
=
false
;
bool
kill_on_parent_death
=
false
;
#
endif
#
if
defined
(
OS_MACOSX
)
&
&
!
defined
(
OS_IOS
)
MachPortsForRendezvous
mach_ports_for_rendezvous
;
#
endif
#
if
defined
(
OS_FUCHSIA
)
zx_handle_t
job_handle
=
ZX_HANDLE_INVALID
;
HandlesToTransferVector
handles_to_transfer
;
static
uint32_t
AddHandleToTransfer
(
HandlesToTransferVector
*
handles_to_transfer
zx_handle_t
handle
)
;
uint32_t
spawn_flags
=
FDIO_SPAWN_CLONE_NAMESPACE
|
FDIO_SPAWN_CLONE_STDIO
|
FDIO_SPAWN_CLONE_JOB
;
std
:
:
vector
<
FilePath
>
paths_to_clone
;
std
:
:
vector
<
PathToTransfer
>
paths_to_transfer
;
#
endif
#
if
defined
(
OS_POSIX
)
base
:
:
FilePath
real_path
;
#
if
!
defined
(
OS_MACOSX
)
PreExecDelegate
*
pre_exec_delegate
=
nullptr
;
#
endif
const
std
:
:
vector
<
int
>
*
maximize_rlimits
=
nullptr
;
bool
new_process_group
=
false
;
#
endif
#
if
defined
(
OS_CHROMEOS
)
int
ctrl_terminal_fd
=
-
1
;
#
endif
}
;
BASE_EXPORT
Process
LaunchProcess
(
const
CommandLine
&
cmdline
const
LaunchOptions
&
options
)
;
#
if
defined
(
OS_WIN
)
BASE_EXPORT
Process
LaunchProcess
(
const
string16
&
cmdline
const
LaunchOptions
&
options
)
;
BASE_EXPORT
Process
LaunchElevatedProcess
(
const
CommandLine
&
cmdline
const
LaunchOptions
&
options
)
;
#
elif
defined
(
OS_POSIX
)
|
|
defined
(
OS_FUCHSIA
)
BASE_EXPORT
Process
LaunchProcess
(
const
std
:
:
vector
<
std
:
:
string
>
&
argv
const
LaunchOptions
&
options
)
;
#
if
!
defined
(
OS_MACOSX
)
BASE_EXPORT
void
CloseSuperfluousFds
(
const
InjectiveMultimap
&
saved_map
)
;
#
endif
#
endif
#
if
defined
(
OS_WIN
)
BASE_EXPORT
bool
SetJobObjectLimitFlags
(
HANDLE
job_object
DWORD
limit_flags
)
;
BASE_EXPORT
void
RouteStdioToConsole
(
bool
create_console_if_not_found
)
;
#
endif
BASE_EXPORT
bool
GetAppOutput
(
const
CommandLine
&
cl
std
:
:
string
*
output
)
;
BASE_EXPORT
bool
GetAppOutputAndError
(
const
CommandLine
&
cl
std
:
:
string
*
output
)
;
BASE_EXPORT
bool
GetAppOutputWithExitCode
(
const
CommandLine
&
cl
std
:
:
string
*
output
int
*
exit_code
)
;
#
if
defined
(
OS_WIN
)
BASE_EXPORT
bool
GetAppOutput
(
const
StringPiece16
&
cl
std
:
:
string
*
output
)
;
#
elif
defined
(
OS_POSIX
)
|
|
defined
(
OS_FUCHSIA
)
BASE_EXPORT
bool
GetAppOutput
(
const
std
:
:
vector
<
std
:
:
string
>
&
argv
std
:
:
string
*
output
)
;
BASE_EXPORT
bool
GetAppOutputAndError
(
const
std
:
:
vector
<
std
:
:
string
>
&
argv
std
:
:
string
*
output
)
;
#
endif
BASE_EXPORT
void
RaiseProcessToHighPriority
(
)
;
BASE_EXPORT
LaunchOptions
LaunchOptionsForTest
(
)
;
#
if
defined
(
OS_LINUX
)
|
|
defined
(
OS_NACL_NONSFI
)
BASE_EXPORT
pid_t
ForkWithFlags
(
unsigned
long
flags
pid_t
*
ptid
pid_t
*
ctid
)
;
#
endif
}
#
endif
