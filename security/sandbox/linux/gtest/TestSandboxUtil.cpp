#
include
"
gtest
/
gtest
.
h
"
#
include
"
SandboxUtil
.
h
"
#
include
"
SandboxInfo
.
h
"
#
include
<
pthread
.
h
>
namespace
mozilla
{
namespace
{
struct
EarlyTest
{
bool
mWasSingleThreaded
;
EarlyTest
(
)
:
mWasSingleThreaded
(
IsSingleThreaded
(
)
)
{
}
}
;
static
const
EarlyTest
gEarlyTest
;
}
TEST
(
SandboxUtil
IsSingleThreaded
)
{
ASSERT_FALSE
(
SandboxInfo
:
:
Get
(
)
.
Test
(
SandboxInfo
:
:
kUnexpectedThreads
)
)
;
EXPECT_TRUE
(
gEarlyTest
.
mWasSingleThreaded
)
;
EXPECT_FALSE
(
IsSingleThreaded
(
)
)
;
}
}
