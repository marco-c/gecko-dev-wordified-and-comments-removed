#
ifndef
mozilla_SandboxTestingThread_h
#
define
mozilla_SandboxTestingThread_h
#
include
"
nsThreadManager
.
h
"
#
if
!
defined
(
MOZ_SANDBOX
)
|
|
!
defined
(
MOZ_DEBUG
)
|
|
!
defined
(
ENABLE_TESTS
)
#
error
"
This
file
should
not
be
used
outside
of
debug
with
tests
"
#
endif
namespace
mozilla
{
class
SandboxTestingThread
{
public
:
void
Dispatch
(
already_AddRefed
<
nsIRunnable
>
&
&
aRunnable
)
{
mThread
-
>
Dispatch
(
std
:
:
move
(
aRunnable
)
nsIEventTarget
:
:
NS_DISPATCH_NORMAL
)
;
}
bool
IsOnThread
(
)
{
bool
on
;
return
NS_SUCCEEDED
(
mThread
-
>
IsOnCurrentThread
(
&
on
)
)
&
&
on
;
}
static
SandboxTestingThread
*
Create
(
)
{
MOZ_RELEASE_ASSERT
(
NS_IsMainThread
(
)
)
;
nsCOMPtr
<
nsIThread
>
thread
;
if
(
NS_FAILED
(
NS_NewNamedThread
(
"
Sandbox
Testing
"
getter_AddRefs
(
thread
)
)
)
)
{
return
nullptr
;
}
return
new
SandboxTestingThread
(
thread
)
;
}
~
SandboxTestingThread
(
)
{
NS_DispatchToMainThread
(
NewRunnableMethod
(
"
~
SandboxTestingThread
"
mThread
&
nsIThread
:
:
Shutdown
)
)
;
}
private
:
explicit
SandboxTestingThread
(
nsIThread
*
aThread
)
:
mThread
(
aThread
)
{
MOZ_ASSERT
(
mThread
)
;
}
nsCOMPtr
<
nsIThread
>
mThread
;
}
;
}
#
endif
