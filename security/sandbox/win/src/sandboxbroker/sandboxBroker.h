#
ifndef
__SECURITY_SANDBOX_SANDBOXBROKER_H__
#
define
__SECURITY_SANDBOX_SANDBOXBROKER_H__
#
include
<
stdint
.
h
>
#
include
<
windows
.
h
>
#
include
"
mozilla
/
ipc
/
EnvironmentMap
.
h
"
#
include
"
nsCOMPtr
.
h
"
#
include
"
nsXULAppAPI
.
h
"
#
include
"
nsISupportsImpl
.
h
"
#
include
"
mozilla
/
ipc
/
UtilityProcessSandboxing
.
h
"
#
include
"
mozilla
/
ipc
/
LaunchError
.
h
"
#
include
"
mozilla
/
Result
.
h
"
namespace
sandbox
{
class
BrokerServices
;
class
TargetPolicy
;
}
namespace
mozilla
{
enum
GMPSandboxKind
{
Default
Widevine
Clearkey
}
;
class
SandboxBroker
{
public
:
SandboxBroker
(
)
;
static
void
Initialize
(
sandbox
:
:
BrokerServices
*
aBrokerServices
const
nsAString
&
aBinDir
)
;
static
void
EnsureLpacPermsissionsOnDir
(
const
nsString
&
aDir
)
;
static
void
GeckoDependentInitialize
(
)
;
Result
<
Ok
mozilla
:
:
ipc
:
:
LaunchError
>
LaunchApp
(
const
wchar_t
*
aPath
const
wchar_t
*
aArguments
base
:
:
EnvironmentMap
&
aEnvironment
GeckoProcessType
aProcessType
const
bool
aEnableLogging
const
IMAGE_THUNK_DATA
*
aCachedNtdllThunk
void
*
*
aProcessHandle
)
;
~
SandboxBroker
(
)
;
void
SetSecurityLevelForContentProcess
(
int32_t
aSandboxLevel
bool
aIsFileProcess
)
;
void
SetSecurityLevelForGPUProcess
(
int32_t
aSandboxLevel
)
;
bool
SetSecurityLevelForRDDProcess
(
)
;
bool
SetSecurityLevelForSocketProcess
(
)
;
bool
SetSecurityLevelForGMPlugin
(
GMPSandboxKind
aGMPSandboxKind
)
;
bool
SetSecurityLevelForUtilityProcess
(
mozilla
:
:
ipc
:
:
SandboxingKind
aSandbox
)
;
bool
AllowReadFile
(
wchar_t
const
*
file
)
;
void
AddHandleToShare
(
HANDLE
aHandle
)
;
bool
IsWin32kLockedDown
(
)
;
void
ApplyLoggingConfig
(
)
;
private
:
static
bool
sRunningFromNetworkDrive
;
std
:
:
unique_ptr
<
sandbox
:
:
TargetPolicy
>
mPolicy
;
}
;
}
#
endif
