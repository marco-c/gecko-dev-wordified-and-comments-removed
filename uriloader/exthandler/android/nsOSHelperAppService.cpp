#
include
"
nsOSHelperAppService
.
h
"
#
include
"
mozilla
/
java
/
GeckoAppShellWrappers
.
h
"
#
include
"
nsMIMEInfoAndroid
.
h
"
using
namespace
mozilla
;
nsOSHelperAppService
:
:
nsOSHelperAppService
(
)
:
nsExternalHelperAppService
(
)
{
}
nsOSHelperAppService
:
:
~
nsOSHelperAppService
(
)
{
}
nsresult
nsOSHelperAppService
:
:
GetMIMEInfoFromOS
(
const
nsACString
&
aMIMEType
const
nsACString
&
aFileExt
bool
*
aFound
nsIMIMEInfo
*
*
aMIMEInfo
)
{
RefPtr
<
nsMIMEInfoAndroid
>
mimeInfo
;
*
aFound
=
false
;
if
(
jni
:
:
IsAvailable
(
)
)
{
if
(
!
aMIMEType
.
IsEmpty
(
)
)
{
nsCString
fileExt
;
auto
fileExtJavaStr
=
java
:
:
GeckoAppShell
:
:
GetExtensionFromMimeType
(
aMIMEType
)
;
if
(
fileExtJavaStr
)
{
fileExt
=
fileExtJavaStr
-
>
ToCString
(
)
;
}
if
(
!
fileExt
.
IsEmpty
(
)
)
{
mimeInfo
=
new
nsMIMEInfoAndroid
(
aMIMEType
)
;
mimeInfo
-
>
SetPrimaryExtension
(
fileExt
)
;
*
aFound
=
true
;
}
}
if
(
!
*
aFound
)
{
nsCString
mimeType
;
auto
javaString
=
java
:
:
GeckoAppShell
:
:
GetMimeTypeFromExtensions
(
aFileExt
)
;
if
(
javaString
)
{
mimeType
=
javaString
-
>
ToCString
(
)
;
}
if
(
!
mimeType
.
IsEmpty
(
)
&
&
!
mimeType
.
Equals
(
nsDependentCString
(
"
*
/
*
"
)
nsCaseInsensitiveCStringComparator
)
)
{
mimeInfo
=
new
nsMIMEInfoAndroid
(
mimeType
)
;
mimeInfo
-
>
SetPrimaryExtension
(
aFileExt
)
;
*
aFound
=
true
;
}
}
}
if
(
!
*
aFound
)
{
mimeInfo
=
new
nsMIMEInfoAndroid
(
aMIMEType
)
;
}
mimeInfo
.
forget
(
aMIMEInfo
)
;
return
NS_OK
;
}
nsresult
nsOSHelperAppService
:
:
OSProtocolHandlerExists
(
const
char
*
aScheme
bool
*
aExists
)
{
nsAutoCString
scheme
(
aScheme
)
;
*
aExists
=
!
scheme
.
Equals
(
"
unsupported
"
_ns
)
&
&
!
scheme
.
Equals
(
"
unknownextproto
"
_ns
)
;
return
NS_OK
;
}
NS_IMETHODIMP
nsOSHelperAppService
:
:
GetApplicationDescription
(
const
nsACString
&
aScheme
nsAString
&
_retval
)
{
return
NS_ERROR_NOT_AVAILABLE
;
}
NS_IMETHODIMP
nsOSHelperAppService
:
:
IsCurrentAppOSDefaultForProtocol
(
const
nsACString
&
aScheme
bool
*
_retval
)
{
return
NS_ERROR_NOT_AVAILABLE
;
}
nsresult
nsOSHelperAppService
:
:
GetProtocolHandlerInfoFromOS
(
const
nsACString
&
aScheme
bool
*
found
nsIHandlerInfo
*
*
info
)
{
return
NS_ERROR_NOT_IMPLEMENTED
;
}
