#
include
"
nsMIMEInfoUnix
.
h
"
#
include
"
nsGNOMERegistry
.
h
"
#
include
"
nsIGIOService
.
h
"
#
include
"
nsNetCID
.
h
"
#
include
"
nsIIOService
.
h
"
#
include
"
nsLocalFile
.
h
"
#
ifdef
MOZ_ENABLE_DBUS
#
include
"
nsDBusHandlerApp
.
h
"
#
endif
nsresult
nsMIMEInfoUnix
:
:
LoadUriInternal
(
nsIURI
*
aURI
)
{
return
nsGNOMERegistry
:
:
LoadURL
(
aURI
)
;
}
NS_IMETHODIMP
nsMIMEInfoUnix
:
:
GetDefaultExecutable
(
nsIFile
*
*
aExecutable
)
{
return
NS_ERROR_NOT_IMPLEMENTED
;
}
NS_IMETHODIMP
nsMIMEInfoUnix
:
:
GetHasDefaultHandler
(
bool
*
_retval
)
{
if
(
GetDefaultApplication
(
)
)
{
return
nsMIMEInfoImpl
:
:
GetHasDefaultHandler
(
_retval
)
;
}
*
_retval
=
false
;
if
(
mClass
=
=
eProtocolInfo
)
{
*
_retval
=
nsGNOMERegistry
:
:
HandlerExists
(
mSchemeOrType
.
get
(
)
)
;
}
else
{
RefPtr
<
nsMIMEInfoBase
>
mimeInfo
=
nsGNOMERegistry
:
:
GetFromType
(
mSchemeOrType
)
;
if
(
!
mimeInfo
)
{
nsAutoCString
ext
;
nsresult
rv
=
GetPrimaryExtension
(
ext
)
;
if
(
NS_SUCCEEDED
(
rv
)
)
{
mimeInfo
=
nsGNOMERegistry
:
:
GetFromExtension
(
ext
)
;
}
}
if
(
mimeInfo
)
*
_retval
=
true
;
}
if
(
*
_retval
)
return
NS_OK
;
return
NS_OK
;
}
nsresult
nsMIMEInfoUnix
:
:
LaunchDefaultWithFile
(
nsIFile
*
aFile
)
{
if
(
GetDefaultApplication
(
)
)
{
return
nsMIMEInfoImpl
:
:
LaunchDefaultWithFile
(
aFile
)
;
}
nsAutoCString
nativePath
;
aFile
-
>
GetNativePath
(
nativePath
)
;
nsCOMPtr
<
nsIGIOService
>
giovfs
=
do_GetService
(
NS_GIOSERVICE_CONTRACTID
)
;
if
(
!
giovfs
)
{
return
NS_ERROR_FAILURE
;
}
nsresult
rv
;
nsCOMPtr
<
nsIIOService
>
ioservice
=
do_GetService
(
NS_IOSERVICE_CONTRACTID
&
rv
)
;
NS_ENSURE_SUCCESS
(
rv
rv
)
;
nsCOMPtr
<
nsIURI
>
uri
;
rv
=
ioservice
-
>
NewFileURI
(
aFile
getter_AddRefs
(
uri
)
)
;
NS_ENSURE_SUCCESS
(
rv
rv
)
;
nsCOMPtr
<
nsIHandlerApp
>
app
;
if
(
NS_FAILED
(
giovfs
-
>
GetAppForMimeType
(
mSchemeOrType
getter_AddRefs
(
app
)
)
)
|
|
!
app
)
{
return
NS_ERROR_FILE_NOT_FOUND
;
}
return
app
-
>
LaunchWithURI
(
uri
nullptr
)
;
}
