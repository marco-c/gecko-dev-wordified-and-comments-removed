#
include
"
nsExternalHelperAppService
.
h
"
#
include
"
gtest
/
gtest
.
h
"
#
include
"
nsNetUtil
.
h
"
#
include
"
mozilla
/
StaticPrefs_network
.
h
"
using
namespace
mozilla
;
TEST
(
ExternalHelperAppService
EscapeURI
)
{
if
(
StaticPrefs
:
:
network_url_useDefaultURI
(
)
)
{
return
;
}
nsCString
input
(
"
myproto
:
/
/
hello
world
"
)
;
nsCString
expected
(
"
myproto
:
/
/
hello
%
20world
"
)
;
nsCOMPtr
<
nsIIOService
>
ios
(
do_GetIOService
(
)
)
;
nsCOMPtr
<
nsIURI
>
uri
;
nsresult
rv
=
ios
-
>
NewURI
(
input
nullptr
nullptr
getter_AddRefs
(
uri
)
)
;
EXPECT_EQ
(
rv
NS_OK
)
;
nsAutoCString
spec
;
rv
=
uri
-
>
GetSpec
(
spec
)
;
EXPECT_EQ
(
rv
NS_OK
)
;
ASSERT_TRUE
(
spec
.
Equals
(
input
)
)
;
nsCOMPtr
<
nsIURI
>
escapedURI
;
rv
=
nsExternalHelperAppService
:
:
EscapeURI
(
uri
getter_AddRefs
(
escapedURI
)
)
;
EXPECT_EQ
(
rv
NS_OK
)
;
nsAutoCString
escapedSpec
;
rv
=
escapedURI
-
>
GetSpec
(
escapedSpec
)
;
EXPECT_EQ
(
rv
NS_OK
)
;
ASSERT_TRUE
(
escapedSpec
.
Equals
(
expected
)
)
;
}
