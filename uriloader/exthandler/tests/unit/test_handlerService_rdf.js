Cu
.
import
(
"
resource
:
/
/
gre
/
modules
/
XPCOMUtils
.
jsm
"
)
;
Cu
.
import
(
"
resource
:
/
/
gre
/
modules
/
Services
.
jsm
"
)
;
Cu
.
import
(
"
resource
:
/
/
gre
/
modules
/
NetUtil
.
jsm
"
)
;
XPCOMUtils
.
defineLazyServiceGetter
(
this
"
gHandlerService
"
"
mozilla
.
org
/
uriloader
/
handler
-
service
;
1
"
"
nsIHandlerService
"
)
;
var
scriptFile
=
do_get_file
(
"
common_test_handlerService
.
js
"
)
;
Services
.
scriptloader
.
loadSubScript
(
NetUtil
.
newURI
(
scriptFile
)
.
spec
)
;
var
prepareImportDB
=
Task
.
async
(
function
*
(
)
{
yield
reloadData
(
)
;
yield
OS
.
File
.
copy
(
do_get_file
(
"
mimeTypes
.
rdf
"
)
.
path
rdfFile
.
path
)
;
}
)
;
var
removeImportDB
=
Task
.
async
(
function
*
(
)
{
yield
reloadData
(
)
;
yield
OS
.
File
.
remove
(
rdfFile
.
path
{
ignoreAbsent
:
true
}
)
;
}
)
;
var
reloadData
=
Task
.
async
(
function
*
(
)
{
let
svc
=
gHandlerService
;
let
promise
=
TestUtils
.
topicObserved
(
"
handlersvc
-
rdf
-
replace
-
complete
"
)
;
Services
.
obs
.
notifyObservers
(
null
"
handlersvc
-
rdf
-
replace
"
null
)
;
yield
promise
;
}
)
;
