XPCOMUtils
.
defineLazyServiceGetter
(
this
"
gHandlerService
"
"
mozilla
.
org
/
uriloader
/
handler
-
service
-
json
;
1
"
"
nsIHandlerService
"
)
;
var
scriptFile
=
do_get_file
(
"
common_test_handlerService
.
js
"
)
;
Services
.
scriptloader
.
loadSubScript
(
NetUtil
.
newURI
(
scriptFile
)
.
spec
)
;
var
prepareImportDB
=
Task
.
async
(
function
*
(
)
{
yield
reloadData
(
)
;
yield
OS
.
File
.
copy
(
do_get_file
(
"
handlers
.
json
"
)
.
path
jsonPath
)
;
}
)
;
var
removeImportDB
=
Task
.
async
(
function
*
(
)
{
yield
reloadData
(
)
;
yield
OS
.
File
.
remove
(
jsonPath
{
ignoreAbsent
:
true
}
)
;
}
)
;
var
reloadData
=
Task
.
async
(
function
*
(
)
{
let
svc
=
gHandlerService
;
let
promise
=
TestUtils
.
topicObserved
(
"
handlersvc
-
json
-
replace
-
complete
"
)
;
Services
.
obs
.
notifyObservers
(
null
"
handlersvc
-
json
-
replace
"
null
)
;
yield
promise
;
}
)
;
