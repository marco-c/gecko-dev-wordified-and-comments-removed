#
ifndef
mozilla_Attributes_h
#
define
mozilla_Attributes_h
#
include
"
mozilla
/
Compiler
.
h
"
#
if
defined
(
_MSC_VER
)
#
define
MOZ_ALWAYS_INLINE_EVEN_DEBUG
__forceinline
#
elif
defined
(
__GNUC__
)
#
define
MOZ_ALWAYS_INLINE_EVEN_DEBUG
__attribute__
(
(
always_inline
)
)
inline
#
else
#
define
MOZ_ALWAYS_INLINE_EVEN_DEBUG
inline
#
endif
#
if
!
defined
(
DEBUG
)
#
define
MOZ_ALWAYS_INLINE
MOZ_ALWAYS_INLINE_EVEN_DEBUG
#
elif
defined
(
_MSC_VER
)
&
&
!
defined
(
__cplusplus
)
#
define
MOZ_ALWAYS_INLINE
__inline
#
else
#
define
MOZ_ALWAYS_INLINE
inline
#
endif
#
if
defined
(
_MSC_VER
)
#
define
MOZ_HAVE_NEVER_INLINE
__declspec
(
noinline
)
#
define
MOZ_HAVE_NORETURN
__declspec
(
noreturn
)
#
elif
defined
(
__clang__
)
#
ifndef
__has_extension
#
define
__has_extension
\
__has_feature
/
*
compatibility
for
older
versions
of
clang
*
/
#
endif
#
if
__has_attribute
(
noinline
)
#
define
MOZ_HAVE_NEVER_INLINE
__attribute__
(
(
noinline
)
)
#
endif
#
if
__has_attribute
(
noreturn
)
#
define
MOZ_HAVE_NORETURN
__attribute__
(
(
noreturn
)
)
#
endif
#
elif
defined
(
__GNUC__
)
#
define
MOZ_HAVE_NEVER_INLINE
__attribute__
(
(
noinline
)
)
#
define
MOZ_HAVE_NORETURN
__attribute__
(
(
noreturn
)
)
#
define
MOZ_HAVE_NORETURN_PTR
__attribute__
(
(
noreturn
)
)
#
endif
#
if
defined
(
__clang__
)
#
if
__has_attribute
(
no_stack_protector
)
#
define
MOZ_HAVE_NO_STACK_PROTECTOR
__attribute__
(
(
no_stack_protector
)
)
#
endif
#
elif
defined
(
__GNUC__
)
#
define
MOZ_HAVE_NO_STACK_PROTECTOR
__attribute__
(
(
no_stack_protector
)
)
#
endif
#
if
defined
(
__clang__
)
#
define
MOZ_HAS_CLANG_ATTRIBUTE
(
attr
)
__has_attribute
(
attr
)
#
else
#
define
MOZ_HAS_CLANG_ATTRIBUTE
(
attr
)
0
#
endif
#
ifdef
__clang_analyzer__
#
if
__has_extension
(
attribute_analyzer_noreturn
)
#
define
MOZ_HAVE_ANALYZER_NORETURN
__attribute__
(
(
analyzer_noreturn
)
)
#
endif
#
endif
#
if
defined
(
__GNUC__
)
|
|
MOZ_HAS_CLANG_ATTRIBUTE
(
no_profile_instrument_function
)
#
define
MOZ_NOPROFILE
__attribute__
(
(
no_profile_instrument_function
)
)
#
else
#
define
MOZ_NOPROFILE
#
endif
#
if
defined
(
__GNUC__
)
|
|
(
MOZ_HAS_CLANG_ATTRIBUTE
(
no_instrument_function
)
)
#
define
MOZ_NOINSTRUMENT
__attribute__
(
(
no_instrument_function
)
)
#
else
#
define
MOZ_NOINSTRUMENT
#
endif
#
define
MOZ_NAKED
__attribute__
(
(
naked
)
)
MOZ_NOPROFILE
MOZ_NOINSTRUMENT
#
if
MOZ_HAS_CLANG_ATTRIBUTE
(
nomerge
)
#
define
MOZ_NOMERGE
__attribute__
(
(
nomerge
)
)
#
else
#
define
MOZ_NOMERGE
#
endif
#
if
defined
(
MOZ_HAVE_NEVER_INLINE
)
#
define
MOZ_NEVER_INLINE
MOZ_HAVE_NEVER_INLINE
#
else
#
define
MOZ_NEVER_INLINE
#
endif
#
if
defined
(
DEBUG
)
#
define
MOZ_NEVER_INLINE_DEBUG
MOZ_NEVER_INLINE
#
else
#
define
MOZ_NEVER_INLINE_DEBUG
#
endif
#
if
defined
(
MOZ_HAVE_NORETURN
)
#
define
MOZ_NORETURN
MOZ_HAVE_NORETURN
#
else
#
define
MOZ_NORETURN
#
endif
#
if
defined
(
MOZ_HAVE_NORETURN_PTR
)
#
define
MOZ_NORETURN_PTR
MOZ_HAVE_NORETURN_PTR
#
else
#
define
MOZ_NORETURN_PTR
#
endif
#
if
defined
(
__GNUC__
)
|
|
defined
(
__clang__
)
#
define
MOZ_COLD
__attribute__
(
(
cold
)
)
#
else
#
define
MOZ_COLD
#
endif
#
if
defined
(
__GNUC__
)
|
|
defined
(
__clang__
)
#
define
MOZ_NONNULL
(
.
.
.
)
__attribute__
(
(
nonnull
(
__VA_ARGS__
)
)
)
#
else
#
define
MOZ_NONNULL
(
.
.
.
)
#
endif
#
if
defined
(
__GNUC__
)
|
|
defined
(
__clang__
)
#
define
MOZ_NONNULL_RETURN
__attribute__
(
(
returns_nonnull
)
)
#
else
#
define
MOZ_NONNULL_RETURN
#
endif
#
if
defined
(
MOZ_HAVE_ANALYZER_NORETURN
)
#
define
MOZ_PRETEND_NORETURN_FOR_STATIC_ANALYSIS
MOZ_HAVE_ANALYZER_NORETURN
#
else
#
define
MOZ_PRETEND_NORETURN_FOR_STATIC_ANALYSIS
#
endif
#
if
defined
(
__has_feature
)
#
if
__has_feature
(
address_sanitizer
)
#
define
MOZ_HAVE_ASAN_IGNORE
#
endif
#
elif
defined
(
__GNUC__
)
#
if
defined
(
__SANITIZE_ADDRESS__
)
#
define
MOZ_HAVE_ASAN_IGNORE
#
endif
#
endif
#
if
defined
(
MOZ_HAVE_ASAN_IGNORE
)
#
define
MOZ_ASAN_IGNORE
MOZ_NEVER_INLINE
__attribute__
(
(
no_sanitize_address
)
)
#
else
#
define
MOZ_ASAN_IGNORE
#
endif
#
if
defined
(
__has_feature
)
#
if
__has_feature
(
thread_sanitizer
)
#
define
MOZ_TSAN_IGNORE
MOZ_NEVER_INLINE
__attribute__
(
(
no_sanitize_thread
)
)
#
else
#
define
MOZ_TSAN_IGNORE
#
endif
#
else
#
define
MOZ_TSAN_IGNORE
#
endif
#
if
defined
(
__has_attribute
)
#
if
__has_attribute
(
no_sanitize
)
#
define
MOZ_HAVE_NO_SANITIZE_ATTR
#
endif
#
endif
#
ifdef
__clang__
#
ifdef
MOZ_HAVE_NO_SANITIZE_ATTR
#
define
MOZ_HAVE_UNSIGNED_OVERFLOW_SANITIZE_ATTR
#
define
MOZ_HAVE_SIGNED_OVERFLOW_SANITIZE_ATTR
#
endif
#
endif
#
ifdef
MOZ_HAVE_UNSIGNED_OVERFLOW_SANITIZE_ATTR
#
define
MOZ_NO_SANITIZE_UNSIGNED_OVERFLOW
\
__attribute__
(
(
no_sanitize
(
"
unsigned
-
integer
-
overflow
"
)
)
)
#
else
#
define
MOZ_NO_SANITIZE_UNSIGNED_OVERFLOW
#
endif
#
ifdef
MOZ_HAVE_SIGNED_OVERFLOW_SANITIZE_ATTR
#
define
MOZ_NO_SANITIZE_SIGNED_OVERFLOW
\
__attribute__
(
(
no_sanitize
(
"
signed
-
integer
-
overflow
"
)
)
)
#
else
#
define
MOZ_NO_SANITIZE_SIGNED_OVERFLOW
#
endif
#
undef
MOZ_HAVE_NO_SANITIZE_ATTR
#
if
defined
(
__GNUC__
)
|
|
defined
(
__clang__
)
#
define
MOZ_ALLOCATOR
__attribute__
(
(
malloc
warn_unused_result
)
)
#
define
MOZ_INFALLIBLE_ALLOCATOR
\
__attribute__
(
(
malloc
warn_unused_result
returns_nonnull
)
)
#
else
#
define
MOZ_ALLOCATOR
#
define
MOZ_INFALLIBLE_ALLOCATOR
#
endif
#
if
defined
(
__GNUC__
)
|
|
defined
(
__clang__
)
#
define
MOZ_MAYBE_UNUSED
__attribute__
(
(
__unused__
)
)
#
elif
defined
(
_MSC_VER
)
#
define
MOZ_MAYBE_UNUSED
__pragma
(
warning
(
suppress
:
4505
)
)
#
else
#
define
MOZ_MAYBE_UNUSED
#
endif
#
if
defined
(
MOZ_HAVE_NO_STACK_PROTECTOR
)
#
define
MOZ_NO_STACK_PROTECTOR
MOZ_HAVE_NO_STACK_PROTECTOR
#
else
#
define
MOZ_NO_STACK_PROTECTOR
#
endif
#
if
defined
(
__clang__
)
&
&
defined
(
__has_cpp_attribute
)
#
if
__has_cpp_attribute
(
clang
:
:
lifetimebound
)
#
define
MOZ_LIFETIME_BOUND
[
[
clang
:
:
lifetimebound
]
]
#
else
#
define
MOZ_LIFETIME_BOUND
#
endif
#
else
#
define
MOZ_LIFETIME_BOUND
#
endif
#
ifdef
__cplusplus
#
if
defined
(
_MSC_VER
)
#
define
MOZ_PUSH_DISABLE_NONTRIVIAL_UNION_WARNINGS
\
__pragma
(
warning
(
push
)
)
__pragma
(
warning
(
disable
:
4582
)
)
\
__pragma
(
warning
(
disable
:
4583
)
)
#
define
MOZ_POP_DISABLE_NONTRIVIAL_UNION_WARNINGS
__pragma
(
warning
(
pop
)
)
#
else
#
define
MOZ_PUSH_DISABLE_NONTRIVIAL_UNION_WARNINGS
#
define
MOZ_POP_DISABLE_NONTRIVIAL_UNION_WARNINGS
#
endif
#
ifdef
XGILL_PLUGIN
#
pragma
GCC
diagnostic
ignored
"
-
Wignored
-
attributes
"
#
pragma
GCC
diagnostic
ignored
"
-
Wattributes
"
#
endif
#
if
defined
(
MOZ_CLANG_PLUGIN
)
|
|
defined
(
XGILL_PLUGIN
)
#
define
MOZ_CAN_RUN_SCRIPT
__attribute__
(
(
annotate
(
"
moz_can_run_script
"
)
)
)
#
define
MOZ_CAN_RUN_SCRIPT_FOR_DEFINITION
\
__attribute__
(
(
annotate
(
"
moz_can_run_script
"
)
)
)
\
__attribute__
(
(
annotate
(
"
moz_can_run_script_for_definition
"
)
)
)
#
define
MOZ_CAN_RUN_SCRIPT_BOUNDARY
\
__attribute__
(
(
annotate
(
"
moz_can_run_script_boundary
"
)
)
)
#
define
MOZ_MUST_OVERRIDE
__attribute__
(
(
annotate
(
"
moz_must_override
"
)
)
)
#
define
MOZ_STATIC_CLASS
__attribute__
(
(
annotate
(
"
moz_global_class
"
)
)
)
#
define
MOZ_STATIC_LOCAL_CLASS
\
__attribute__
(
(
annotate
(
"
moz_static_local_class
"
)
)
)
\
__attribute__
(
(
annotate
(
"
moz_trivial_dtor
"
)
)
)
#
define
MOZ_STACK_CLASS
__attribute__
(
(
annotate
(
"
moz_stack_class
"
)
)
)
#
define
MOZ_NONHEAP_CLASS
__attribute__
(
(
annotate
(
"
moz_nonheap_class
"
)
)
)
#
define
MOZ_HEAP_CLASS
__attribute__
(
(
annotate
(
"
moz_heap_class
"
)
)
)
#
define
MOZ_NON_TEMPORARY_CLASS
\
__attribute__
(
(
annotate
(
"
moz_non_temporary_class
"
)
)
)
#
define
MOZ_TEMPORARY_CLASS
__attribute__
(
(
annotate
(
"
moz_temporary_class
"
)
)
)
#
define
MOZ_TRIVIAL_CTOR_DTOR
\
__attribute__
(
(
annotate
(
"
moz_trivial_ctor_dtor
"
)
)
)
#
define
MOZ_ALLOW_TEMPORARY
__attribute__
(
(
annotate
(
"
moz_allow_temporary
"
)
)
)
#
ifdef
DEBUG
#
define
MOZ_ONLY_USED_TO_AVOID_STATIC_CONSTRUCTORS
\
__attribute__
(
(
annotate
(
"
moz_global_class
"
)
)
)
#
else
#
define
MOZ_ONLY_USED_TO_AVOID_STATIC_CONSTRUCTORS
\
__attribute__
(
(
annotate
(
"
moz_global_class
"
)
)
)
MOZ_TRIVIAL_CTOR_DTOR
#
endif
#
define
MOZ_IMPLICIT
__attribute__
(
(
annotate
(
"
moz_implicit
"
)
)
)
#
define
MOZ_IS_SMARTPTR_TO_REFCOUNTED
\
__attribute__
(
(
annotate
(
"
moz_is_smartptr_to_refcounted
"
)
)
)
#
define
MOZ_IS_REFPTR
MOZ_IS_SMARTPTR_TO_REFCOUNTED
#
define
MOZ_NO_ARITHMETIC_EXPR_IN_ARGUMENT
\
__attribute__
(
(
annotate
(
"
moz_no_arith_expr_in_arg
"
)
)
)
#
define
MOZ_OWNING_REF
__attribute__
(
(
annotate
(
"
moz_owning_ref
"
)
)
)
#
define
MOZ_NON_OWNING_REF
__attribute__
(
(
annotate
(
"
moz_non_owning_ref
"
)
)
)
#
define
MOZ_UNSAFE_REF
(
reason
)
__attribute__
(
(
annotate
(
"
moz_unsafe_ref
"
)
)
)
#
define
MOZ_NO_ADDREF_RELEASE_ON_RETURN
\
__attribute__
(
(
annotate
(
"
moz_no_addref_release_on_return
"
)
)
)
#
define
MOZ_NEEDS_NO_VTABLE_TYPE
\
__attribute__
(
(
annotate
(
"
moz_needs_no_vtable_type
"
)
)
)
#
define
MOZ_NON_MEMMOVABLE
__attribute__
(
(
annotate
(
"
moz_non_memmovable
"
)
)
)
#
define
MOZ_NEEDS_MEMMOVABLE_TYPE
\
__attribute__
(
(
annotate
(
"
moz_needs_memmovable_type
"
)
)
)
#
define
MOZ_NEEDS_MEMMOVABLE_MEMBERS
\
__attribute__
(
(
annotate
(
"
moz_needs_memmovable_members
"
)
)
)
#
define
MOZ_NO_DANGLING_ON_TEMPORARIES
\
__attribute__
(
(
annotate
(
"
moz_no_dangling_on_temporaries
"
)
)
)
#
define
MOZ_INHERIT_TYPE_ANNOTATIONS_FROM_TEMPLATE_ARGS
\
__attribute__
(
(
\
annotate
(
"
moz_inherit_type_annotations_from_template_args
"
)
)
)
#
define
MOZ_NON_AUTOABLE
__attribute__
(
(
annotate
(
"
moz_non_autoable
"
)
)
)
#
define
MOZ_INIT_OUTSIDE_CTOR
#
define
MOZ_IS_CLASS_INIT
#
define
MOZ_NON_PARAM
__attribute__
(
(
annotate
(
"
moz_non_param
"
)
)
)
#
define
MOZ_REQUIRED_BASE_METHOD
\
__attribute__
(
(
annotate
(
"
moz_required_base_method
"
)
)
)
#
define
MOZ_MUST_RETURN_FROM_CALLER_IF_THIS_IS_ARG
\
__attribute__
(
(
annotate
(
"
moz_must_return_from_caller_if_this_is_arg
"
)
)
)
#
define
MOZ_MAY_CALL_AFTER_MUST_RETURN
\
__attribute__
(
(
annotate
(
"
moz_may_call_after_must_return
"
)
)
)
#
define
MOZ_KNOWN_LIVE
__attribute__
(
(
annotate
(
"
moz_known_live
"
)
)
)
#
ifdef
MOZ_CLANG_PLUGIN
#
define
MOZ_UNANNOTATED
__attribute__
(
(
annotate
(
"
moz_unannotated
"
)
)
)
#
define
MOZ_ANNOTATED
__attribute__
(
(
annotate
(
"
moz_annotated
"
)
)
)
#
define
MOZ_RUNINIT
__attribute__
(
(
annotate
(
"
moz_global_var
"
)
)
)
#
define
MOZ_GLOBINIT
\
MOZ_RUNINIT
__attribute__
(
(
annotate
(
"
moz_generated
"
)
)
)
#
else
#
define
MOZ_UNANNOTATED
#
define
MOZ_ANNOTATED
#
define
MOZ_RUNINIT
#
define
MOZ_GLOBINIT
#
endif
#
ifdef
__clang__
#
define
MOZ_HEAP_ALLOCATOR
\
_Pragma
(
"
clang
diagnostic
push
"
)
\
_Pragma
(
"
clang
diagnostic
ignored
\
"
-
Wgcc
-
compat
\
"
"
)
\
__attribute__
(
(
annotate
(
"
moz_heap_allocator
"
)
)
)
_Pragma
(
\
"
clang
diagnostic
pop
"
)
#
else
#
define
MOZ_HEAP_ALLOCATOR
__attribute__
(
(
annotate
(
"
moz_heap_allocator
"
)
)
)
#
endif
#
else
#
define
MOZ_CAN_RUN_SCRIPT
#
define
MOZ_CAN_RUN_SCRIPT_FOR_DEFINITION
#
define
MOZ_CAN_RUN_SCRIPT_BOUNDARY
#
define
MOZ_MUST_OVERRIDE
#
define
MOZ_STATIC_CLASS
#
define
MOZ_RUNINIT
#
define
MOZ_GLOBINIT
#
define
MOZ_STATIC_LOCAL_CLASS
#
define
MOZ_STACK_CLASS
#
define
MOZ_NONHEAP_CLASS
#
define
MOZ_HEAP_CLASS
#
define
MOZ_NON_TEMPORARY_CLASS
#
define
MOZ_TEMPORARY_CLASS
#
define
MOZ_TRIVIAL_CTOR_DTOR
#
define
MOZ_ALLOW_TEMPORARY
#
define
MOZ_ONLY_USED_TO_AVOID_STATIC_CONSTRUCTORS
#
define
MOZ_IMPLICIT
#
define
MOZ_IS_SMARTPTR_TO_REFCOUNTED
#
define
MOZ_IS_REFPTR
#
define
MOZ_NO_ARITHMETIC_EXPR_IN_ARGUMENT
#
define
MOZ_HEAP_ALLOCATOR
#
define
MOZ_OWNING_REF
#
define
MOZ_NON_OWNING_REF
#
define
MOZ_UNSAFE_REF
(
reason
)
#
define
MOZ_NO_ADDREF_RELEASE_ON_RETURN
#
define
MOZ_NEEDS_NO_VTABLE_TYPE
#
define
MOZ_NON_MEMMOVABLE
#
define
MOZ_NEEDS_MEMMOVABLE_TYPE
#
define
MOZ_NEEDS_MEMMOVABLE_MEMBERS
#
define
MOZ_NO_DANGLING_ON_TEMPORARIES
#
define
MOZ_INHERIT_TYPE_ANNOTATIONS_FROM_TEMPLATE_ARGS
#
define
MOZ_INIT_OUTSIDE_CTOR
#
define
MOZ_IS_CLASS_INIT
#
define
MOZ_NON_PARAM
#
define
MOZ_NON_AUTOABLE
#
define
MOZ_REQUIRED_BASE_METHOD
#
define
MOZ_MUST_RETURN_FROM_CALLER_IF_THIS_IS_ARG
#
define
MOZ_MAY_CALL_AFTER_MUST_RETURN
#
define
MOZ_KNOWN_LIVE
#
define
MOZ_UNANNOTATED
#
define
MOZ_ANNOTATED
#
endif
#
define
MOZ_RAII
MOZ_NON_TEMPORARY_CLASS
MOZ_STACK_CLASS
#
ifdef
XGILL_PLUGIN
#
undef
MOZ_MUST_OVERRIDE
#
undef
MOZ_CAN_RUN_SCRIPT_FOR_DEFINITION
#
undef
MOZ_CAN_RUN_SCRIPT
#
undef
MOZ_CAN_RUN_SCRIPT_BOUNDARY
#
define
MOZ_MUST_OVERRIDE
#
define
MOZ_CAN_RUN_SCRIPT_FOR_DEFINITION
#
define
MOZ_CAN_RUN_SCRIPT
#
define
MOZ_CAN_RUN_SCRIPT_BOUNDARY
#
endif
#
endif
#
ifdef
__MINGW32__
#
define
MOZ_FORMAT_PRINTF
(
stringIndex
firstToCheck
)
\
__attribute__
(
(
format
(
__MINGW_PRINTF_FORMAT
stringIndex
firstToCheck
)
)
)
#
ifndef
__MINGW_WPRINTF_FORMAT
#
if
defined
(
__clang__
)
#
define
__MINGW_WPRINTF_FORMAT
wprintf
#
elif
defined
(
_UCRT
)
|
|
__USE_MINGW_ANSI_STDIO
#
define
__MINGW_WPRINTF_FORMAT
gnu_wprintf
#
else
#
define
__MINGW_WPRINTF_FORMAT
ms_wprintf
#
endif
#
endif
#
define
MOZ_FORMAT_WPRINTF
(
stringIndex
firstToCheck
)
\
__attribute__
(
(
format
(
__MINGW_WPRINTF_FORMAT
stringIndex
firstToCheck
)
)
)
#
elif
__GNUC__
|
|
__clang__
#
define
MOZ_FORMAT_PRINTF
(
stringIndex
firstToCheck
)
\
__attribute__
(
(
format
(
printf
stringIndex
firstToCheck
)
)
)
#
define
MOZ_FORMAT_WPRINTF
(
stringIndex
firstToCheck
)
\
__attribute__
(
(
format
(
wprintf
stringIndex
firstToCheck
)
)
)
#
else
#
define
MOZ_FORMAT_PRINTF
(
stringIndex
firstToCheck
)
#
define
MOZ_FORMAT_WPRINTF
(
stringIndex
firstToCheck
)
#
endif
#
if
defined
(
XP_WIN
)
#
define
MOZ_XPCOM_ABI
__stdcall
#
else
#
define
MOZ_XPCOM_ABI
#
endif
#
if
defined
(
_MSC_VER
)
#
define
MOZ_EMPTY_BASES
__declspec
(
empty_bases
)
#
else
#
define
MOZ_EMPTY_BASES
#
endif
#
if
defined
(
__cpp_constinit
)
#
define
MOZ_CONSTINIT
constinit
#
elif
defined
(
__clang__
)
#
define
MOZ_CONSTINIT
[
[
clang
:
:
require_constant_initialization
]
]
#
elif
MOZ_GCC_VERSION_AT_LEAST
(
10
1
0
)
#
define
MOZ_CONSTINIT
__constinit
#
else
#
define
MOZ_CONSTINIT
#
endif
#
ifdef
__clang__
#
define
MOZ_CAN_RUN_SCRIPT_BOUNDARY_LAMBDA
MOZ_CAN_RUN_SCRIPT_BOUNDARY
#
else
#
define
MOZ_CAN_RUN_SCRIPT_BOUNDARY_LAMBDA
#
endif
#
endif
