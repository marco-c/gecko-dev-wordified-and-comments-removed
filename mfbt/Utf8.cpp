#
include
"
mozilla
/
Maybe
.
h
"
#
include
"
mozilla
/
TextUtils
.
h
"
#
include
"
mozilla
/
Types
.
h
"
#
include
"
mozilla
/
Utf8
.
h
"
#
include
<
stddef
.
h
>
#
include
<
stdint
.
h
>
MFBT_API
bool
mozilla
:
:
detail
:
:
IsValidUtf8
(
const
void
*
aCodeUnits
size_t
aCount
)
{
const
auto
*
s
=
reinterpret_cast
<
const
unsigned
char
*
>
(
aCodeUnits
)
;
const
auto
*
const
limit
=
s
+
aCount
;
while
(
s
<
limit
)
{
unsigned
char
c
=
*
s
+
+
;
if
(
IsAscii
(
c
)
)
{
continue
;
}
Maybe
<
char32_t
>
maybeCodePoint
=
DecodeOneUtf8CodePoint
(
Utf8Unit
(
c
)
&
s
limit
)
;
if
(
maybeCodePoint
.
isNothing
(
)
)
{
return
false
;
}
}
MOZ_ASSERT
(
s
=
=
limit
)
;
return
true
;
}
