#
ifndef
mozilla_ThreadSafety_h
#
define
mozilla_ThreadSafety_h
#
include
"
mozilla
/
Attributes
.
h
"
#
if
defined
(
__clang__
)
&
&
(
!
defined
(
SWIG
)
)
#
define
THREAD_ANNOTATION_ATTRIBUTE__
(
x
)
__attribute__
(
(
x
)
)
#
define
PUSH_IGNORE_THREAD_SAFETY
\
_Pragma
(
"
GCC
diagnostic
push
"
)
\
_Pragma
(
"
GCC
diagnostic
ignored
\
"
-
Wthread
-
safety
\
"
"
)
#
define
POP_THREAD_SAFETY
_Pragma
(
"
GCC
diagnostic
pop
"
)
#
else
#
define
THREAD_ANNOTATION_ATTRIBUTE__
(
x
)
#
define
PUSH_IGNORE_THREAD_SAFETY
#
define
POP_THREAD_SAFETY
#
endif
#
define
GUARDED_BY
(
x
)
THREAD_ANNOTATION_ATTRIBUTE__
(
guarded_by
(
x
)
)
#
define
GUARDED_VAR
THREAD_ANNOTATION_ATTRIBUTE__
(
guarded
)
#
define
PT_GUARDED_BY
(
x
)
THREAD_ANNOTATION_ATTRIBUTE__
(
pt_guarded_by
(
x
)
)
#
define
PT_GUARDED_VAR
THREAD_ANNOTATION_ATTRIBUTE__
(
pt_guarded
)
#
define
ACQUIRED_AFTER
(
.
.
.
)
THREAD_ANNOTATION_ATTRIBUTE__
(
acquired_after
(
__VA_ARGS__
)
)
#
define
ACQUIRED_BEFORE
(
.
.
.
)
THREAD_ANNOTATION_ATTRIBUTE__
(
acquired_before
(
__VA_ARGS__
)
)
#
define
REQUIRES
(
.
.
.
)
\
THREAD_ANNOTATION_ATTRIBUTE__
(
exclusive_locks_required
(
__VA_ARGS__
)
)
#
define
REQUIRES_SHARED
(
.
.
.
)
\
THREAD_ANNOTATION_ATTRIBUTE__
(
shared_locks_required
(
__VA_ARGS__
)
)
#
define
EXCLUDES
(
x
)
THREAD_ANNOTATION_ATTRIBUTE__
(
locks_excluded
(
x
)
)
#
define
RETURN_CAPABILITY
(
x
)
THREAD_ANNOTATION_ATTRIBUTE__
(
lock_returned
(
x
)
)
#
define
CAPABILITY
THREAD_ANNOTATION_ATTRIBUTE__
(
lockable
)
#
define
SCOPED_CAPABILITY
THREAD_ANNOTATION_ATTRIBUTE__
(
scoped_lockable
)
#
define
CAPABILITY_ACQUIRE
(
.
.
.
)
\
THREAD_ANNOTATION_ATTRIBUTE__
(
exclusive_lock_function
(
__VA_ARGS__
)
)
#
define
EXCLUSIVE_RELEASE
(
.
.
.
)
\
THREAD_ANNOTATION_ATTRIBUTE__
(
release_capability
(
__VA_ARGS__
)
)
#
define
ACQUIRE_SHARED
(
.
.
.
)
\
THREAD_ANNOTATION_ATTRIBUTE__
(
shared_lock_function
(
__VA_ARGS__
)
)
#
define
TRY_ACQUIRE
(
.
.
.
)
\
THREAD_ANNOTATION_ATTRIBUTE__
(
exclusive_trylock_function
(
__VA_ARGS__
)
)
#
define
SHARED_TRYLOCK_FUNCTION
(
.
.
.
)
\
THREAD_ANNOTATION_ATTRIBUTE__
(
shared_trylock_function
(
__VA_ARGS__
)
)
#
define
CAPABILITY_RELEASE
(
.
.
.
)
THREAD_ANNOTATION_ATTRIBUTE__
(
unlock_function
(
__VA_ARGS__
)
)
#
define
NO_THREAD_SAFETY_ANALYSIS
\
THREAD_ANNOTATION_ATTRIBUTE__
(
no_thread_safety_analysis
)
#
define
ASSERT_CAPABILITY
(
x
)
THREAD_ANNOTATION_ATTRIBUTE__
(
assert_capability
(
x
)
)
#
define
ASSERT_SHARED_CAPABILITY
(
x
)
\
THREAD_ANNOTATION_ATTRIBUTE__
(
assert_shared_capability
(
x
)
)
#
define
RELEASE_SHARED
(
.
.
.
)
\
THREAD_ANNOTATION_ATTRIBUTE__
(
release_shared_capability
(
__VA_ARGS__
)
)
#
define
RELEASE_GENERIC
(
.
.
.
)
\
THREAD_ANNOTATION_ATTRIBUTE__
(
release_generic_capability
(
__VA_ARGS__
)
)
#
define
SCOPED_UNLOCK_RELEASE
(
.
.
.
)
EXCLUSIVE_RELEASE
(
__VA_ARGS__
)
#
define
SCOPED_UNLOCK_REACQUIRE
(
.
.
.
)
EXCLUSIVE_RELEASE
(
__VA_ARGS__
)
#
endif
