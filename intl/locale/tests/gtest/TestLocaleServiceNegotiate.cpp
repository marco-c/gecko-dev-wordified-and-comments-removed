#
include
"
gtest
/
gtest
.
h
"
#
include
"
mozilla
/
intl
/
LocaleService
.
h
"
#
include
"
mozilla
/
Services
.
h
"
#
include
"
nsIToolkitChromeRegistry
.
h
"
using
namespace
mozilla
:
:
intl
;
TEST
(
Intl_Locale_LocaleService
Negotiate
)
{
nsTArray
<
nsCString
>
requestedLocales
;
nsTArray
<
nsCString
>
availableLocales
;
nsTArray
<
nsCString
>
supportedLocales
;
nsAutoCString
defaultLocale
(
"
en
-
US
"
)
;
LocaleService
:
:
LangNegStrategy
strategy
=
LocaleService
:
:
LangNegStrategy
:
:
Filtering
;
requestedLocales
.
AppendElement
(
NS_LITERAL_CSTRING
(
"
sr
"
)
)
;
availableLocales
.
AppendElement
(
NS_LITERAL_CSTRING
(
"
sr
-
Cyrl
"
)
)
;
availableLocales
.
AppendElement
(
NS_LITERAL_CSTRING
(
"
sr
-
Latn
"
)
)
;
LocaleService
:
:
GetInstance
(
)
-
>
NegotiateLanguages
(
requestedLocales
availableLocales
defaultLocale
strategy
supportedLocales
)
;
ASSERT_TRUE
(
supportedLocales
.
Length
(
)
=
=
2
)
;
ASSERT_TRUE
(
supportedLocales
[
0
]
.
EqualsLiteral
(
"
sr
-
Cyrl
"
)
)
;
ASSERT_TRUE
(
supportedLocales
[
1
]
.
EqualsLiteral
(
"
en
-
US
"
)
)
;
}
