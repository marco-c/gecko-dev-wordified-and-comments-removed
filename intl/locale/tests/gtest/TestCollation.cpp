#
include
"
gtest
/
gtest
.
h
"
#
include
"
nsCollationCID
.
h
"
#
include
"
nsComponentManagerUtils
.
h
"
#
include
"
nsCOMPtr
.
h
"
#
include
"
nsICollation
.
h
"
#
include
"
nsString
.
h
"
#
include
"
nsTArray
.
h
"
TEST
(
Collation
AllocateRowSortKey
)
{
nsCOMPtr
<
nsICollationFactory
>
colFactory
=
do_CreateInstance
(
NS_COLLATIONFACTORY_CONTRACTID
)
;
ASSERT_TRUE
(
colFactory
)
;
nsCOMPtr
<
nsICollation
>
collator
;
nsresult
rv
=
colFactory
-
>
CreateCollationForLocale
(
NS_LITERAL_CSTRING
(
"
languageName
"
)
getter_AddRefs
(
collator
)
)
;
ASSERT_TRUE
(
NS_SUCCEEDED
(
rv
)
)
;
nsTArray
<
uint8_t
>
sortKey1
;
rv
=
collator
-
>
AllocateRawSortKey
(
nsICollation
:
:
kCollationStrengthDefault
NS_LITERAL_STRING
(
"
ABC
"
)
sortKey1
)
;
ASSERT_TRUE
(
NS_SUCCEEDED
(
rv
)
)
;
nsTArray
<
uint8_t
>
sortKey2
;
rv
=
collator
-
>
AllocateRawSortKey
(
nsICollation
:
:
kCollationStrengthDefault
NS_LITERAL_STRING
(
"
DEF
"
)
sortKey2
)
;
ASSERT_TRUE
(
NS_SUCCEEDED
(
rv
)
)
;
int32_t
result
;
rv
=
collator
-
>
CompareRawSortKey
(
sortKey1
sortKey2
&
result
)
;
ASSERT_TRUE
(
NS_SUCCEEDED
(
rv
)
)
;
ASSERT_TRUE
(
result
<
0
)
;
}
