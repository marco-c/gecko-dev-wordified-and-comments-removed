#
include
"
OSPreferences
.
h
"
#
include
"
mozilla
/
ClearOnShutdown
.
h
"
using
namespace
mozilla
:
:
intl
;
mozilla
:
:
StaticAutoPtr
<
OSPreferences
>
OSPreferences
:
:
sInstance
;
OSPreferences
*
OSPreferences
:
:
GetInstance
(
)
{
if
(
!
sInstance
)
{
sInstance
=
new
OSPreferences
(
)
;
ClearOnShutdown
(
&
sInstance
)
;
}
return
sInstance
;
}
bool
OSPreferences
:
:
GetSystemLocales
(
nsTArray
<
nsCString
>
&
aRetVal
)
{
bool
status
=
true
;
if
(
mSystemLocales
.
IsEmpty
(
)
)
{
status
=
ReadSystemLocales
(
mSystemLocales
)
;
}
aRetVal
=
mSystemLocales
;
return
status
;
}
bool
OSPreferences
:
:
CanonicalizeLanguageTag
(
nsCString
&
aLoc
)
{
char
langTag
[
512
]
;
UErrorCode
status
=
U_ZERO_ERROR
;
int32_t
langTagLen
=
uloc_toLanguageTag
(
aLoc
.
get
(
)
langTag
sizeof
(
langTag
)
-
1
false
&
status
)
;
if
(
U_FAILURE
(
status
)
)
{
return
false
;
}
aLoc
.
Assign
(
langTag
langTagLen
)
;
return
true
;
}
