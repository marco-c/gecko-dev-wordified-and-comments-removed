#
include
"
OSPreferences
.
h
"
#
include
<
Carbon
/
Carbon
.
h
>
using
namespace
mozilla
:
:
intl
;
bool
OSPreferences
:
:
ReadSystemLocales
(
nsTArray
<
nsCString
>
&
aLocaleList
)
{
MOZ_ASSERT
(
aLocaleList
.
IsEmpty
(
)
)
;
CFLocaleRef
userLocaleRef
=
:
:
CFLocaleCopyCurrent
(
)
;
CFStringRef
userLocaleStr
=
:
:
CFLocaleGetIdentifier
(
userLocaleRef
)
;
AutoTArray
<
UniChar
32
>
buffer
;
int
size
=
:
:
CFStringGetLength
(
userLocaleStr
)
;
CFRange
range
=
:
:
CFRangeMake
(
0
size
)
;
:
:
CFStringGetCharacters
(
userLocaleStr
range
buffer
.
Elements
(
)
)
;
NS_LossyConvertUTF16toASCII
locale
(
reinterpret_cast
<
const
char16_t
*
>
(
buffer
.
Elements
(
)
)
buffer
.
Length
(
)
)
;
CFRelease
(
userLocaleRef
)
;
if
(
CanonicalizeLanguageTag
(
locale
)
)
{
aLocaleList
.
AppendElement
(
locale
)
;
return
true
;
}
return
false
;
}
