#
ifndef
intl_components_Collator_h_
#
define
intl_components_Collator_h_
#
ifndef
JS_STANDALONE
#
include
"
gtest
/
MozGtestFriend
.
h
"
#
endif
#
include
"
unicode
/
ucol
.
h
"
#
include
"
mozilla
/
intl
/
ICU4CGlue
.
h
"
#
include
"
mozilla
/
intl
/
ICUError
.
h
"
#
include
"
mozilla
/
Result
.
h
"
#
include
"
mozilla
/
Span
.
h
"
namespace
mozilla
:
:
intl
{
class
Collator
final
{
public
:
explicit
Collator
(
UCollator
*
aCollator
)
;
Collator
(
const
Collator
&
)
=
delete
;
Collator
&
operator
=
(
const
Collator
&
)
=
delete
;
static
Result
<
UniquePtr
<
Collator
>
ICUError
>
TryCreate
(
const
char
*
aLocale
)
;
~
Collator
(
)
;
template
<
typename
B
>
ICUResult
GetSortKey
(
Span
<
const
char16_t
>
aString
B
&
aBuffer
)
const
{
static_assert
(
std
:
:
is_same_v
<
typename
B
:
:
CharType
uint8_t
>
"
Expected
a
uint8_t
*
buffer
.
"
)
;
UErrorCode
status
=
U_ZERO_ERROR
;
int32_t
length
=
ucol_getSortKey
(
mCollator
.
GetConst
(
)
aString
.
data
(
)
static_cast
<
int32_t
>
(
aString
.
size
(
)
)
nullptr
0
)
;
if
(
U_FAILURE
(
status
)
|
|
length
=
=
0
)
{
return
Err
(
ICUError
:
:
InternalError
)
;
}
if
(
!
aBuffer
.
reserve
(
length
)
)
{
return
Err
(
ICUError
:
:
OutOfMemory
)
;
}
length
=
ucol_getSortKey
(
mCollator
.
GetConst
(
)
aString
.
data
(
)
aString
.
size
(
)
aBuffer
.
data
(
)
length
)
;
if
(
U_FAILURE
(
status
)
|
|
length
=
=
0
)
{
return
Err
(
ICUError
:
:
InternalError
)
;
}
aBuffer
.
written
(
length
)
;
return
Ok
(
)
;
}
int32_t
CompareStrings
(
Span
<
const
char16_t
>
aSource
Span
<
const
char16_t
>
aTarget
)
const
;
int32_t
CompareSortKeys
(
Span
<
const
uint8_t
>
aKey1
Span
<
const
uint8_t
>
aKey2
)
const
;
enum
class
CaseFirst
{
Upper
Lower
False
}
;
enum
class
Sensitivity
{
Base
Accent
Case
Variant
}
;
struct
Options
{
Sensitivity
sensitivity
=
Sensitivity
:
:
Variant
;
CaseFirst
caseFirst
=
CaseFirst
:
:
False
;
bool
ignorePunctuation
=
false
;
bool
numeric
=
false
;
}
;
ICUResult
SetOptions
(
const
Options
&
aOptions
const
Maybe
<
Options
&
>
aPrevOptions
=
Nothing
(
)
)
;
static
SpanResult
<
char
>
KeywordValueToBcp47Extension
(
const
char
*
aKeyword
int32_t
aLength
)
;
using
Bcp47ExtEnumeration
=
Enumeration
<
char
SpanResult
<
char
>
Collator
:
:
KeywordValueToBcp47Extension
>
;
static
Result
<
Bcp47ExtEnumeration
InternalError
>
GetBcp47KeywordValuesForLocale
(
const
char
*
aLocale
)
;
private
:
enum
class
Feature
{
On
Off
Default
}
;
enum
class
AlternateHandling
{
NonIgnorable
Shifted
Default
}
;
enum
class
Strength
{
Primary
Secondary
Tertiary
Quaternary
Identical
Default
}
;
void
SetStrength
(
Strength
strength
)
;
ICUResult
SetAlternateHandling
(
AlternateHandling
aAlternateHandling
)
;
ICUResult
SetCaseLevel
(
Feature
aFeature
)
;
ICUResult
SetNumericCollation
(
Feature
aFeature
)
;
ICUResult
SetNormalizationMode
(
Feature
aFeature
)
;
ICUResult
SetCaseFirst
(
CaseFirst
aCaseFirst
)
;
#
ifndef
JS_STANDALONE
FRIEND_TEST
(
IntlCollator
SetAttributesInternal
)
;
#
endif
ICUPointer
<
UCollator
>
mCollator
=
ICUPointer
<
UCollator
>
(
nullptr
)
;
Maybe
<
Sensitivity
>
mLastStrategy
=
Nothing
(
)
;
}
;
}
#
endif
