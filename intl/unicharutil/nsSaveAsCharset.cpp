#
include
"
nsSaveAsCharset
.
h
"
using
namespace
mozilla
;
NS_IMPL_ISUPPORTS
(
nsSaveAsCharset
nsISaveAsCharset
)
nsSaveAsCharset
:
:
nsSaveAsCharset
(
)
{
}
nsSaveAsCharset
:
:
~
nsSaveAsCharset
(
)
{
}
NS_IMETHODIMP
nsSaveAsCharset
:
:
Init
(
const
nsACString
&
aCharset
uint32_t
aIgnored
uint32_t
aAlsoIgnored
)
{
mEncoding
=
Encoding
:
:
ForLabelNoReplacement
(
aCharset
)
;
if
(
!
mEncoding
)
{
return
NS_ERROR_DOM_ENCODING_NOT_SUPPORTED_ERR
;
}
return
NS_OK
;
}
NS_IMETHODIMP
nsSaveAsCharset
:
:
Convert
(
const
nsAString
&
aIn
nsACString
&
aOut
)
{
if
(
!
mEncoding
)
{
return
NS_ERROR_DOM_ENCODING_NOT_SUPPORTED_ERR
;
}
nsresult
rv
;
const
Encoding
*
ignored
;
Tie
(
rv
ignored
)
=
mEncoding
-
>
Encode
(
aIn
aOut
)
;
if
(
NS_FAILED
(
rv
)
)
{
return
rv
;
}
return
NS_OK
;
}
NS_IMETHODIMP
nsSaveAsCharset
:
:
GetCharset
(
nsACString
&
aCharset
)
{
if
(
!
mEncoding
)
{
aCharset
.
Truncate
(
)
;
}
else
{
mEncoding
-
>
Name
(
aCharset
)
;
}
return
NS_OK
;
}
