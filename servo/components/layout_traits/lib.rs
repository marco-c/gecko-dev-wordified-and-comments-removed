#
!
[
feature
(
custom_derive
plugin
)
]
#
!
[
plugin
(
serde_macros
)
]
#
!
[
deny
(
unsafe_code
)
]
extern
crate
gfx
;
extern
crate
ipc_channel
;
extern
crate
msg
;
extern
crate
net_traits
;
extern
crate
profile_traits
;
extern
crate
script_traits
;
extern
crate
serde
;
extern
crate
url
;
extern
crate
util
;
extern
crate
webrender_traits
;
use
gfx
:
:
font_cache_thread
:
:
FontCacheThread
;
use
gfx
:
:
paint_thread
:
:
LayoutToPaintMsg
;
use
ipc_channel
:
:
ipc
:
:
{
IpcReceiver
IpcSender
}
;
use
msg
:
:
constellation_msg
:
:
{
ConstellationChan
PanicMsg
PipelineId
PipelineNamespaceId
PipelineIndex
}
;
use
net_traits
:
:
image_cache_thread
:
:
ImageCacheThread
;
use
profile_traits
:
:
{
mem
time
}
;
use
script_traits
:
:
LayoutMsg
as
ConstellationMsg
;
use
script_traits
:
:
{
LayoutControlMsg
ConstellationControlMsg
OpaqueScriptLayoutChannel
}
;
use
url
:
:
Url
;
use
util
:
:
ipc
:
:
OptionalIpcSender
;
#
[
derive
(
Clone
Deserialize
Serialize
)
]
pub
struct
LayoutControlChan
(
pub
IpcSender
<
LayoutControlMsg
>
)
;
pub
trait
LayoutThreadFactory
{
fn
create
(
_phantom
:
Option
<
&
mut
Self
>
id
:
PipelineId
url
:
Url
is_iframe
:
bool
chan
:
OpaqueScriptLayoutChannel
pipeline_port
:
IpcReceiver
<
LayoutControlMsg
>
constellation_chan
:
ConstellationChan
<
ConstellationMsg
>
panic_chan
:
ConstellationChan
<
PanicMsg
>
script_chan
:
IpcSender
<
ConstellationControlMsg
>
layout_to_paint_chan
:
OptionalIpcSender
<
LayoutToPaintMsg
>
image_cache_thread
:
ImageCacheThread
font_cache_thread
:
FontCacheThread
time_profiler_chan
:
time
:
:
ProfilerChan
mem_profiler_chan
:
mem
:
:
ProfilerChan
shutdown_chan
:
IpcSender
<
(
)
>
content_process_shutdown_chan
:
IpcSender
<
(
)
>
webrender_api_sender
:
Option
<
webrender_traits
:
:
RenderApiSender
>
)
;
}
pub
trait
ConvertPipelineIdToWebRender
{
fn
to_webrender
(
&
self
)
-
>
webrender_traits
:
:
PipelineId
;
}
impl
ConvertPipelineIdToWebRender
for
PipelineId
{
fn
to_webrender
(
&
self
)
-
>
webrender_traits
:
:
PipelineId
{
let
PipelineNamespaceId
(
namespace_id
)
=
self
.
namespace_id
;
let
PipelineIndex
(
index
)
=
self
.
index
;
webrender_traits
:
:
PipelineId
(
namespace_id
index
)
}
}
