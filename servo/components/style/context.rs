use
animation
:
:
Animation
;
use
app_units
:
:
Au
;
use
dom
:
:
OpaqueNode
;
use
error_reporting
:
:
ParseErrorReporter
;
use
euclid
:
:
Size2D
;
use
matching
:
:
{
ApplicableDeclarationsCache
StyleSharingCandidateCache
}
;
use
selector_impl
:
:
SelectorImplExt
;
use
selector_matching
:
:
Stylist
;
use
std
:
:
cell
:
:
RefCell
;
use
std
:
:
collections
:
:
HashMap
;
use
std
:
:
sync
:
:
mpsc
:
:
Sender
;
use
std
:
:
sync
:
:
{
Arc
Mutex
RwLock
}
;
pub
struct
LocalStyleContextCreationInfo
<
Impl
:
SelectorImplExt
>
{
new_animations_sender
:
Sender
<
Animation
<
Impl
>
>
}
impl
<
Impl
:
SelectorImplExt
>
LocalStyleContextCreationInfo
<
Impl
>
{
pub
fn
new
(
animations_sender
:
Sender
<
Animation
<
Impl
>
>
)
-
>
Self
{
LocalStyleContextCreationInfo
{
new_animations_sender
:
animations_sender
}
}
}
pub
struct
SharedStyleContext
<
Impl
:
SelectorImplExt
>
{
pub
viewport_size
:
Size2D
<
Au
>
pub
screen_size_changed
:
bool
pub
stylist
:
Arc
<
Stylist
<
Impl
>
>
pub
generation
:
u32
pub
goal
:
ReflowGoal
pub
running_animations
:
Arc
<
RwLock
<
HashMap
<
OpaqueNode
Vec
<
Animation
<
Impl
>
>
>
>
>
pub
expired_animations
:
Arc
<
RwLock
<
HashMap
<
OpaqueNode
Vec
<
Animation
<
Impl
>
>
>
>
>
pub
error_reporter
:
Box
<
ParseErrorReporter
+
Sync
>
pub
local_context_creation_data
:
Mutex
<
LocalStyleContextCreationInfo
<
Impl
>
>
}
pub
struct
LocalStyleContext
<
Impl
:
SelectorImplExt
>
{
pub
applicable_declarations_cache
:
RefCell
<
ApplicableDeclarationsCache
<
Impl
:
:
ComputedValues
>
>
pub
style_sharing_candidate_cache
:
RefCell
<
StyleSharingCandidateCache
<
Impl
:
:
ComputedValues
>
>
pub
new_animations_sender
:
Sender
<
Animation
<
Impl
>
>
}
impl
<
Impl
:
SelectorImplExt
>
LocalStyleContext
<
Impl
>
{
pub
fn
new
(
local_context_creation_data
:
&
LocalStyleContextCreationInfo
<
Impl
>
)
-
>
Self
{
LocalStyleContext
{
applicable_declarations_cache
:
RefCell
:
:
new
(
ApplicableDeclarationsCache
:
:
new
(
)
)
style_sharing_candidate_cache
:
RefCell
:
:
new
(
StyleSharingCandidateCache
:
:
new
(
)
)
new_animations_sender
:
local_context_creation_data
.
new_animations_sender
.
clone
(
)
}
}
}
pub
trait
StyleContext
<
'
a
Impl
:
SelectorImplExt
>
{
fn
shared_context
(
&
self
)
-
>
&
'
a
SharedStyleContext
<
Impl
>
;
fn
local_context
(
&
self
)
-
>
&
LocalStyleContext
<
Impl
>
;
}
#
[
derive
(
PartialEq
Copy
Clone
Debug
)
]
pub
enum
ReflowGoal
{
ForDisplay
ForScriptQuery
}
