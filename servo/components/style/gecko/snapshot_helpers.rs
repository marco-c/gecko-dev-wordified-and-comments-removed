use
CaseSensitivityExt
;
use
gecko_bindings
:
:
structs
:
:
nsAtom
;
use
gecko_string_cache
:
:
WeakAtom
;
use
selectors
:
:
attr
:
:
CaseSensitivity
;
use
std
:
:
{
ptr
slice
}
;
use
string_cache
:
:
Atom
;
pub
type
ClassOrClassList
<
T
>
=
unsafe
extern
fn
(
T
*
mut
*
mut
nsAtom
*
mut
*
mut
*
mut
nsAtom
)
-
>
u32
;
pub
fn
has_class
<
T
>
(
item
:
T
name
:
&
Atom
case_sensitivity
:
CaseSensitivity
getter
:
ClassOrClassList
<
T
>
)
-
>
bool
{
unsafe
{
let
mut
class
:
*
mut
nsAtom
=
ptr
:
:
null_mut
(
)
;
let
mut
list
:
*
mut
*
mut
nsAtom
=
ptr
:
:
null_mut
(
)
;
let
length
=
getter
(
item
&
mut
class
&
mut
list
)
;
match
length
{
0
=
>
false
1
=
>
case_sensitivity
.
eq_atom
(
name
WeakAtom
:
:
new
(
class
)
)
n
=
>
{
let
classes
=
slice
:
:
from_raw_parts
(
list
n
as
usize
)
;
classes
.
iter
(
)
.
any
(
|
ptr
|
case_sensitivity
.
eq_atom
(
name
WeakAtom
:
:
new
(
*
ptr
)
)
)
}
}
}
}
pub
fn
each_class
<
F
T
>
(
item
:
T
mut
callback
:
F
getter
:
ClassOrClassList
<
T
>
)
where
F
:
FnMut
(
&
Atom
)
{
unsafe
{
let
mut
class
:
*
mut
nsAtom
=
ptr
:
:
null_mut
(
)
;
let
mut
list
:
*
mut
*
mut
nsAtom
=
ptr
:
:
null_mut
(
)
;
let
length
=
getter
(
item
&
mut
class
&
mut
list
)
;
match
length
{
0
=
>
{
}
1
=
>
Atom
:
:
with
(
class
callback
)
n
=
>
{
let
classes
=
slice
:
:
from_raw_parts
(
list
n
as
usize
)
;
for
c
in
classes
{
Atom
:
:
with
(
*
c
&
mut
callback
)
}
}
}
}
}
