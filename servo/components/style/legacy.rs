use
node
:
:
{
TElement
TElementAttributes
TNode
}
;
use
properties
:
:
{
BackgroundColorDeclaration
BorderBottomWidthDeclaration
}
;
use
properties
:
:
{
BorderLeftWidthDeclaration
BorderRightWidthDeclaration
}
;
use
properties
:
:
{
BorderTopWidthDeclaration
SpecifiedValue
WidthDeclaration
specified
}
;
use
selector_matching
:
:
{
DeclarationBlock
Stylist
}
;
use
cssparser
:
:
RGBAColor
;
use
servo_util
:
:
geometry
:
:
Au
;
use
servo_util
:
:
smallvec
:
:
VecLike
;
use
servo_util
:
:
str
:
:
{
AutoLpa
LengthLpa
PercentageLpa
}
;
pub
enum
LengthAttribute
{
WidthLengthAttribute
}
pub
enum
IntegerAttribute
{
SizeIntegerAttribute
}
pub
enum
UnsignedIntegerAttribute
{
BorderUnsignedIntegerAttribute
ColSpanUnsignedIntegerAttribute
}
pub
enum
SimpleColorAttribute
{
BgColorSimpleColorAttribute
}
pub
trait
PresentationalHintSynthesis
{
fn
synthesize_presentational_hints_for_legacy_attributes
<
'
a
E
N
V
>
(
&
self
node
:
&
N
matching_rules_list
:
&
mut
V
shareable
:
&
mut
bool
)
where
E
:
TElement
<
'
a
>
+
TElementAttributes
N
:
TNode
<
'
a
E
>
V
:
VecLike
<
DeclarationBlock
>
;
fn
synthesize_presentational_hint_for_legacy_background_color_attribute
<
'
a
E
V
>
(
&
self
element
:
E
matching_rules_list
:
&
mut
V
shareable
:
&
mut
bool
)
where
E
:
TElement
<
'
a
>
+
TElementAttributes
V
:
VecLike
<
DeclarationBlock
>
;
fn
synthesize_presentational_hint_for_legacy_border_attribute
<
'
a
E
V
>
(
&
self
element
:
E
matching_rules_list
:
&
mut
V
shareable
:
&
mut
bool
)
where
E
:
TElement
<
'
a
>
+
TElementAttributes
V
:
VecLike
<
DeclarationBlock
>
;
}
impl
PresentationalHintSynthesis
for
Stylist
{
fn
synthesize_presentational_hints_for_legacy_attributes
<
'
a
E
N
V
>
(
&
self
node
:
&
N
matching_rules_list
:
&
mut
V
shareable
:
&
mut
bool
)
where
E
:
TElement
<
'
a
>
+
TElementAttributes
N
:
TNode
<
'
a
E
>
V
:
VecLike
<
DeclarationBlock
>
{
let
element
=
node
.
as_element
(
)
;
match
element
.
get_local_name
(
)
{
name
if
*
name
=
=
atom
!
(
"
td
"
)
=
>
{
match
element
.
get_length_attribute
(
WidthLengthAttribute
)
{
AutoLpa
=
>
{
}
PercentageLpa
(
percentage
)
=
>
{
let
width_value
=
specified
:
:
LPA_Percentage
(
percentage
)
;
matching_rules_list
.
vec_push
(
DeclarationBlock
:
:
from_declaration
(
WidthDeclaration
(
SpecifiedValue
(
width_value
)
)
)
)
;
*
shareable
=
false
}
LengthLpa
(
length
)
=
>
{
let
width_value
=
specified
:
:
LPA_Length
(
specified
:
:
Au_
(
length
)
)
;
matching_rules_list
.
vec_push
(
DeclarationBlock
:
:
from_declaration
(
WidthDeclaration
(
SpecifiedValue
(
width_value
)
)
)
)
;
*
shareable
=
false
}
}
self
.
synthesize_presentational_hint_for_legacy_background_color_attribute
(
element
matching_rules_list
shareable
)
;
self
.
synthesize_presentational_hint_for_legacy_border_attribute
(
element
matching_rules_list
shareable
)
;
}
name
if
*
name
=
=
atom
!
(
"
table
"
)
=
>
{
self
.
synthesize_presentational_hint_for_legacy_background_color_attribute
(
element
matching_rules_list
shareable
)
;
self
.
synthesize_presentational_hint_for_legacy_border_attribute
(
element
matching_rules_list
shareable
)
;
}
name
if
*
name
=
=
atom
!
(
"
body
"
)
|
|
*
name
=
=
atom
!
(
"
tr
"
)
|
|
*
name
=
=
atom
!
(
"
thead
"
)
|
|
*
name
=
=
atom
!
(
"
tbody
"
)
|
|
*
name
=
=
atom
!
(
"
tfoot
"
)
=
>
{
self
.
synthesize_presentational_hint_for_legacy_background_color_attribute
(
element
matching_rules_list
shareable
)
;
}
name
if
*
name
=
=
atom
!
(
"
input
"
)
=
>
{
match
element
.
get_integer_attribute
(
SizeIntegerAttribute
)
{
Some
(
value
)
if
value
!
=
0
=
>
{
let
value
=
match
element
.
get_attr
(
&
ns
!
(
"
"
)
&
atom
!
(
"
type
"
)
)
{
Some
(
"
text
"
)
|
Some
(
"
password
"
)
=
>
{
specified
:
:
ServoCharacterWidth
(
value
)
}
_
=
>
specified
:
:
Au_
(
Au
:
:
from_px
(
value
as
int
)
)
}
;
matching_rules_list
.
vec_push
(
DeclarationBlock
:
:
from_declaration
(
WidthDeclaration
(
SpecifiedValue
(
specified
:
:
LPA_Length
(
value
)
)
)
)
)
;
*
shareable
=
false
}
Some
(
_
)
|
None
=
>
{
}
}
}
_
=
>
{
}
}
}
fn
synthesize_presentational_hint_for_legacy_background_color_attribute
<
'
a
E
V
>
(
&
self
element
:
E
matching_rules_list
:
&
mut
V
shareable
:
&
mut
bool
)
where
E
:
TElement
<
'
a
>
+
TElementAttributes
V
:
VecLike
<
DeclarationBlock
>
{
match
element
.
get_simple_color_attribute
(
BgColorSimpleColorAttribute
)
{
None
=
>
{
}
Some
(
color
)
=
>
{
matching_rules_list
.
vec_push
(
DeclarationBlock
:
:
from_declaration
(
BackgroundColorDeclaration
(
SpecifiedValue
(
RGBAColor
(
color
)
)
)
)
)
;
*
shareable
=
false
}
}
}
fn
synthesize_presentational_hint_for_legacy_border_attribute
<
'
a
E
V
>
(
&
self
element
:
E
matching_rules_list
:
&
mut
V
shareable
:
&
mut
bool
)
where
E
:
TElement
<
'
a
>
+
TElementAttributes
V
:
VecLike
<
DeclarationBlock
>
{
match
element
.
get_unsigned_integer_attribute
(
BorderUnsignedIntegerAttribute
)
{
None
=
>
{
}
Some
(
length
)
=
>
{
let
width_value
=
specified
:
:
Au_
(
Au
:
:
from_px
(
length
as
int
)
)
;
matching_rules_list
.
vec_push
(
DeclarationBlock
:
:
from_declaration
(
BorderTopWidthDeclaration
(
SpecifiedValue
(
width_value
)
)
)
)
;
matching_rules_list
.
vec_push
(
DeclarationBlock
:
:
from_declaration
(
BorderLeftWidthDeclaration
(
SpecifiedValue
(
width_value
)
)
)
)
;
matching_rules_list
.
vec_push
(
DeclarationBlock
:
:
from_declaration
(
BorderBottomWidthDeclaration
(
SpecifiedValue
(
width_value
)
)
)
)
;
matching_rules_list
.
vec_push
(
DeclarationBlock
:
:
from_declaration
(
BorderRightWidthDeclaration
(
SpecifiedValue
(
width_value
)
)
)
)
;
*
shareable
=
false
}
}
}
}
