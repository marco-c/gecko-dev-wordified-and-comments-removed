use
std
:
:
sync
:
:
Arc
;
use
selectors
:
:
tree
:
:
{
TElement
TNode
}
;
use
selectors
:
:
matching
:
:
DeclarationBlock
;
use
node
:
:
TElementAttributes
;
use
values
:
:
specified
;
use
properties
:
:
DeclaredValue
:
:
SpecifiedValue
;
use
properties
:
:
PropertyDeclaration
;
use
properties
:
:
longhands
;
use
selector_matching
:
:
Stylist
;
use
util
:
:
geometry
:
:
Au
;
use
util
:
:
smallvec
:
:
VecLike
;
#
[
derive
(
Copy
Clone
PartialEq
Eq
)
]
pub
enum
UnsignedIntegerAttribute
{
Border
ColSpan
}
pub
trait
PresentationalHintSynthesis
{
fn
synthesize_presentational_hints_for_legacy_attributes
<
'
a
N
V
>
(
&
self
node
:
&
N
matching_rules_list
:
&
mut
V
shareable
:
&
mut
bool
)
where
N
:
TNode
<
'
a
>
N
:
:
Element
:
TElementAttributes
<
'
a
>
V
:
VecLike
<
DeclarationBlock
<
Vec
<
PropertyDeclaration
>
>
>
;
fn
synthesize_presentational_hint_for_legacy_border_attribute
<
'
a
E
V
>
(
&
self
element
:
E
matching_rules_list
:
&
mut
V
shareable
:
&
mut
bool
)
where
E
:
TElement
<
'
a
>
+
TElementAttributes
<
'
a
>
V
:
VecLike
<
DeclarationBlock
<
Vec
<
PropertyDeclaration
>
>
>
;
}
impl
PresentationalHintSynthesis
for
Stylist
{
fn
synthesize_presentational_hints_for_legacy_attributes
<
'
a
N
V
>
(
&
self
node
:
&
N
matching_rules_list
:
&
mut
V
shareable
:
&
mut
bool
)
where
N
:
TNode
<
'
a
>
N
:
:
Element
:
TElementAttributes
<
'
a
>
V
:
VecLike
<
DeclarationBlock
<
Vec
<
PropertyDeclaration
>
>
>
{
let
element
=
node
.
as_element
(
)
;
let
length
=
matching_rules_list
.
len
(
)
;
element
.
synthesize_presentational_hints_for_legacy_attributes
(
matching_rules_list
)
;
if
matching_rules_list
.
len
(
)
!
=
length
{
*
shareable
=
false
;
}
match
element
.
get_local_name
(
)
{
name
if
*
name
=
=
atom
!
(
"
td
"
)
=
>
{
self
.
synthesize_presentational_hint_for_legacy_border_attribute
(
element
matching_rules_list
shareable
)
;
}
name
if
*
name
=
=
atom
!
(
"
table
"
)
=
>
{
self
.
synthesize_presentational_hint_for_legacy_border_attribute
(
element
matching_rules_list
shareable
)
;
}
_
=
>
{
}
}
}
fn
synthesize_presentational_hint_for_legacy_border_attribute
<
'
a
E
V
>
(
&
self
element
:
E
matching_rules_list
:
&
mut
V
shareable
:
&
mut
bool
)
where
E
:
TElement
<
'
a
>
+
TElementAttributes
<
'
a
>
V
:
VecLike
<
DeclarationBlock
<
Vec
<
PropertyDeclaration
>
>
>
{
match
element
.
get_unsigned_integer_attribute
(
UnsignedIntegerAttribute
:
:
Border
)
{
None
=
>
{
}
Some
(
length
)
=
>
{
let
width_value
=
specified
:
:
Length
:
:
Absolute
(
Au
:
:
from_px
(
length
as
i32
)
)
;
matching_rules_list
.
push
(
from_declaration
(
PropertyDeclaration
:
:
BorderTopWidth
(
SpecifiedValue
(
longhands
:
:
border_top_width
:
:
SpecifiedValue
(
width_value
)
)
)
)
)
;
matching_rules_list
.
push
(
from_declaration
(
PropertyDeclaration
:
:
BorderLeftWidth
(
SpecifiedValue
(
longhands
:
:
border_left_width
:
:
SpecifiedValue
(
width_value
)
)
)
)
)
;
matching_rules_list
.
push
(
from_declaration
(
PropertyDeclaration
:
:
BorderBottomWidth
(
SpecifiedValue
(
longhands
:
:
border_bottom_width
:
:
SpecifiedValue
(
width_value
)
)
)
)
)
;
matching_rules_list
.
push
(
from_declaration
(
PropertyDeclaration
:
:
BorderRightWidth
(
SpecifiedValue
(
longhands
:
:
border_right_width
:
:
SpecifiedValue
(
width_value
)
)
)
)
)
;
*
shareable
=
false
}
}
}
}
#
[
inline
]
pub
fn
from_declaration
(
rule
:
PropertyDeclaration
)
-
>
DeclarationBlock
<
Vec
<
PropertyDeclaration
>
>
{
DeclarationBlock
:
:
from_declarations
(
Arc
:
:
new
(
vec
!
[
rule
]
)
)
}
