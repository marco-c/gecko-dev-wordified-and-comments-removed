use
servo_arc
:
:
ThinArc
;
use
std
:
:
mem
;
use
std
:
:
ops
:
:
Deref
;
use
std
:
:
ptr
:
:
NonNull
;
const
ARC_SLICE_CANARY
:
u32
=
0xf3f3f3f3
;
/
/
/
cbindgen
:
derive
-
eq
=
false
/
/
/
cbindgen
:
derive
-
neq
=
false
#
[
repr
(
C
)
]
#
[
derive
(
Debug
Clone
PartialEq
Eq
ToShmem
)
]
pub
struct
ArcSlice
<
T
>
(
#
[
shmem
(
field_bound
)
]
ThinArc
<
u32
T
>
)
;
impl
<
T
>
Deref
for
ArcSlice
<
T
>
{
type
Target
=
[
T
]
;
#
[
inline
]
fn
deref
(
&
self
)
-
>
&
Self
:
:
Target
{
debug_assert_eq
!
(
self
.
0
.
header
.
header
ARC_SLICE_CANARY
)
;
&
self
.
0
.
slice
}
}
#
[
repr
(
C
)
]
pub
struct
ForgottenArcSlicePtr
<
T
>
(
NonNull
<
T
>
)
;
impl
<
T
>
ArcSlice
<
T
>
{
#
[
inline
]
pub
fn
from_iter
<
I
>
(
items
:
I
)
-
>
Self
where
I
:
Iterator
<
Item
=
T
>
+
ExactSizeIterator
{
ArcSlice
(
ThinArc
:
:
from_header_and_iter
(
ARC_SLICE_CANARY
items
)
)
}
#
[
inline
]
#
[
allow
(
unsafe_code
)
]
pub
fn
forget
(
self
)
-
>
ForgottenArcSlicePtr
<
T
>
{
let
ret
=
unsafe
{
ForgottenArcSlicePtr
(
NonNull
:
:
new_unchecked
(
self
.
0
.
ptr
(
)
as
*
const
_
as
*
mut
_
)
)
}
;
mem
:
:
forget
(
self
)
;
ret
}
}
