#
!
[
feature
(
custom_derive
plugin
)
]
#
!
[
plugin
(
plugins
serde_macros
)
]
#
!
[
deny
(
missing_docs
)
]
extern
crate
app_units
;
extern
crate
devtools_traits
;
extern
crate
euclid
;
extern
crate
ipc_channel
;
extern
crate
libc
;
extern
crate
msg
;
extern
crate
net_traits
;
extern
crate
profile_traits
;
extern
crate
serde
;
extern
crate
time
;
extern
crate
url
;
extern
crate
util
;
use
app_units
:
:
Au
;
use
devtools_traits
:
:
ScriptToDevtoolsControlMsg
;
use
euclid
:
:
length
:
:
Length
;
use
euclid
:
:
point
:
:
Point2D
;
use
euclid
:
:
rect
:
:
Rect
;
use
ipc_channel
:
:
ipc
:
:
{
IpcReceiver
IpcSender
}
;
use
libc
:
:
c_void
;
use
msg
:
:
compositor_msg
:
:
{
Epoch
LayerId
ScriptToCompositorMsg
}
;
use
msg
:
:
constellation_msg
:
:
ScriptMsg
as
ConstellationMsg
;
use
msg
:
:
constellation_msg
:
:
{
ConstellationChan
Failure
PipelineId
WindowSizeData
}
;
use
msg
:
:
constellation_msg
:
:
{
Key
KeyModifiers
KeyState
LoadData
SubpageId
}
;
use
msg
:
:
constellation_msg
:
:
{
MozBrowserEvent
PipelineNamespaceId
}
;
use
msg
:
:
webdriver_msg
:
:
WebDriverScriptCommand
;
use
net_traits
:
:
ResourceTask
;
use
net_traits
:
:
image_cache_task
:
:
ImageCacheTask
;
use
net_traits
:
:
storage_task
:
:
StorageTask
;
use
profile_traits
:
:
mem
;
use
std
:
:
any
:
:
Any
;
use
util
:
:
ipc
:
:
OptionalOpaqueIpcSender
;
use
util
:
:
mem
:
:
HeapSizeOf
;
#
[
derive
(
Copy
Clone
Debug
)
]
pub
struct
UntrustedNodeAddress
(
pub
*
const
c_void
)
;
unsafe
impl
Send
for
UntrustedNodeAddress
{
}
#
[
derive
(
Deserialize
Serialize
)
]
pub
enum
LayoutControlMsg
{
ExitNow
GetCurrentEpoch
(
IpcSender
<
Epoch
>
)
TickAnimations
SetVisibleRects
(
Vec
<
(
LayerId
Rect
<
Au
>
)
>
)
GetWebFontLoadState
(
IpcSender
<
bool
>
)
}
#
[
derive
(
Deserialize
Serialize
)
]
pub
struct
NewLayoutInfo
{
pub
containing_pipeline_id
:
PipelineId
pub
new_pipeline_id
:
PipelineId
pub
subpage_id
:
SubpageId
pub
load_data
:
LoadData
pub
paint_chan
:
OptionalOpaqueIpcSender
pub
failure
:
Failure
pub
pipeline_port
:
IpcReceiver
<
LayoutControlMsg
>
pub
layout_shutdown_chan
:
IpcSender
<
(
)
>
pub
content_process_shutdown_chan
:
IpcSender
<
(
)
>
}
#
[
derive
(
Copy
Clone
Debug
PartialEq
Deserialize
Serialize
)
]
pub
enum
ScriptState
{
DocumentLoaded
DocumentLoading
}
#
[
derive
(
Deserialize
Serialize
)
]
pub
enum
ConstellationControlMsg
{
AttachLayout
(
NewLayoutInfo
)
Resize
(
PipelineId
WindowSizeData
)
ResizeInactive
(
PipelineId
WindowSizeData
)
ExitPipeline
(
PipelineId
)
SendEvent
(
PipelineId
CompositorEvent
)
Viewport
(
PipelineId
Rect
<
f32
>
)
GetTitle
(
PipelineId
)
Freeze
(
PipelineId
)
Thaw
(
PipelineId
)
Navigate
(
PipelineId
SubpageId
LoadData
)
MozBrowserEvent
(
PipelineId
SubpageId
MozBrowserEvent
)
UpdateSubpageId
(
PipelineId
SubpageId
SubpageId
)
FocusIFrame
(
PipelineId
SubpageId
)
WebDriverScriptCommand
(
PipelineId
WebDriverScriptCommand
)
TickAllAnimations
(
PipelineId
)
WebFontLoaded
(
PipelineId
)
GetCurrentState
(
IpcSender
<
ScriptState
>
PipelineId
)
DispatchFrameLoadEvent
{
target
:
PipelineId
parent
:
PipelineId
}
}
#
[
derive
(
Clone
Copy
Debug
Deserialize
Serialize
)
]
pub
enum
MouseButton
{
Left
Middle
Right
}
#
[
derive
(
Clone
Copy
Debug
Deserialize
Serialize
)
]
pub
enum
TouchEventType
{
Down
Move
Up
Cancel
}
#
[
derive
(
Clone
Copy
Debug
Eq
PartialEq
Deserialize
Serialize
)
]
pub
struct
TouchId
(
pub
i32
)
;
#
[
derive
(
Deserialize
Serialize
)
]
pub
enum
CompositorEvent
{
ResizeEvent
(
WindowSizeData
)
ClickEvent
(
MouseButton
Point2D
<
f32
>
)
MouseDownEvent
(
MouseButton
Point2D
<
f32
>
)
MouseUpEvent
(
MouseButton
Point2D
<
f32
>
)
MouseMoveEvent
(
Option
<
Point2D
<
f32
>
>
)
TouchEvent
(
TouchEventType
TouchId
Point2D
<
f32
>
)
KeyEvent
(
Key
KeyState
KeyModifiers
)
}
pub
struct
OpaqueScriptLayoutChannel
(
pub
(
Box
<
Any
+
Send
>
Box
<
Any
+
Send
>
)
)
;
#
[
derive
(
Deserialize
Serialize
)
]
pub
struct
TimerEventRequest
(
pub
IpcSender
<
TimerEvent
>
pub
TimerSource
pub
TimerEventId
pub
MsDuration
)
;
#
[
derive
(
Deserialize
Serialize
)
]
pub
struct
TimerEvent
(
pub
TimerSource
pub
TimerEventId
)
;
#
[
derive
(
Copy
Clone
HeapSizeOf
Deserialize
Serialize
)
]
pub
enum
TimerSource
{
FromWindow
(
PipelineId
)
FromWorker
}
#
[
derive
(
PartialEq
Eq
Copy
Clone
Debug
HeapSizeOf
Deserialize
Serialize
)
]
pub
struct
TimerEventId
(
pub
u32
)
;
#
[
derive
(
Clone
Copy
HeapSizeOf
)
]
pub
enum
Milliseconds
{
}
#
[
derive
(
Clone
Copy
HeapSizeOf
)
]
pub
enum
Nanoseconds
{
}
pub
type
MsDuration
=
Length
<
Milliseconds
u64
>
;
pub
type
NsDuration
=
Length
<
Nanoseconds
u64
>
;
pub
fn
precise_time_ms
(
)
-
>
MsDuration
{
Length
:
:
new
(
time
:
:
precise_time_ns
(
)
/
(
1000
*
1000
)
)
}
pub
fn
precise_time_ns
(
)
-
>
NsDuration
{
Length
:
:
new
(
time
:
:
precise_time_ns
(
)
)
}
pub
struct
InitialScriptState
{
pub
id
:
PipelineId
pub
parent_info
:
Option
<
(
PipelineId
SubpageId
)
>
pub
compositor
:
IpcSender
<
ScriptToCompositorMsg
>
pub
control_chan
:
IpcSender
<
ConstellationControlMsg
>
pub
control_port
:
IpcReceiver
<
ConstellationControlMsg
>
pub
constellation_chan
:
ConstellationChan
<
ConstellationMsg
>
pub
scheduler_chan
:
IpcSender
<
TimerEventRequest
>
pub
failure_info
:
Failure
pub
resource_task
:
ResourceTask
pub
storage_task
:
StorageTask
pub
image_cache_task
:
ImageCacheTask
pub
time_profiler_chan
:
profile_traits
:
:
time
:
:
ProfilerChan
pub
mem_profiler_chan
:
mem
:
:
ProfilerChan
pub
devtools_chan
:
Option
<
IpcSender
<
ScriptToDevtoolsControlMsg
>
>
pub
window_size
:
Option
<
WindowSizeData
>
pub
pipeline_namespace_id
:
PipelineNamespaceId
pub
content_process_shutdown_chan
:
IpcSender
<
(
)
>
}
#
[
derive
(
Clone
Deserialize
Serialize
)
]
pub
struct
ScriptControlChan
(
pub
IpcSender
<
ConstellationControlMsg
>
)
;
pub
trait
ScriptTaskFactory
{
fn
create
(
_phantom
:
Option
<
&
mut
Self
>
state
:
InitialScriptState
layout_chan
:
&
OpaqueScriptLayoutChannel
load_data
:
LoadData
)
;
fn
create_layout_channel
(
_phantom
:
Option
<
&
mut
Self
>
)
-
>
OpaqueScriptLayoutChannel
;
fn
clone_layout_channel
(
_phantom
:
Option
<
&
mut
Self
>
pair
:
&
OpaqueScriptLayoutChannel
)
-
>
Box
<
Any
+
Send
>
;
}
