use
std
:
:
sync
:
:
mpsc
:
:
Sender
;
#
[
derive
(
Clone
)
]
pub
struct
ProfilerChan
(
pub
Sender
<
ProfilerMsg
>
)
;
impl
ProfilerChan
{
pub
fn
send
(
&
self
msg
:
ProfilerMsg
)
{
let
ProfilerChan
(
ref
c
)
=
*
self
;
c
.
send
(
msg
)
.
unwrap
(
)
;
}
}
pub
struct
Report
{
pub
path
:
Vec
<
String
>
pub
size
:
usize
}
#
[
derive
(
Clone
)
]
pub
struct
ReportsChan
(
pub
Sender
<
Vec
<
Report
>
>
)
;
impl
ReportsChan
{
pub
fn
send
(
&
self
report
:
Vec
<
Report
>
)
{
let
ReportsChan
(
ref
c
)
=
*
self
;
c
.
send
(
report
)
.
unwrap
(
)
;
}
}
pub
trait
Reporter
{
fn
collect_reports
(
&
self
reports_chan
:
ReportsChan
)
-
>
bool
;
}
#
[
macro_export
]
macro_rules
!
path
{
(
(
x
:
expr
)
*
)
=
>
{
{
use
std
:
:
borrow
:
:
ToOwned
;
vec
!
[
(
x
.
to_owned
(
)
)
*
]
}
}
}
pub
enum
ProfilerMsg
{
RegisterReporter
(
String
Box
<
Reporter
+
Send
>
)
UnregisterReporter
(
String
)
Print
Exit
}
