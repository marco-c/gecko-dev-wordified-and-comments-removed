use
dom
:
:
bindings
:
:
codegen
:
:
PrototypeList
:
:
proto_id_to_name
;
use
dom
:
:
bindings
:
:
conversions
:
:
ToJSValConvertible
;
use
dom
:
:
bindings
:
:
global
:
:
GlobalRef
;
use
dom
:
:
domexception
:
:
{
DOMErrorName
DOMException
}
;
use
js
:
:
error
:
:
{
throw_range_error
throw_type_error
}
;
use
js
:
:
jsapi
:
:
JSAutoCompartment
;
use
js
:
:
jsapi
:
:
{
JSContext
JSObject
RootedValue
}
;
use
js
:
:
jsapi
:
:
{
JS_IsExceptionPending
JS_ReportPendingException
JS_SetPendingException
}
;
use
js
:
:
jsapi
:
:
{
JS_RestoreFrameChain
JS_SaveFrameChain
}
;
use
js
:
:
jsval
:
:
UndefinedValue
;
use
util
:
:
mem
:
:
HeapSizeOf
;
#
[
derive
(
Debug
Clone
HeapSizeOf
)
]
pub
enum
Error
{
IndexSize
NotFound
HierarchyRequest
WrongDocument
InvalidCharacter
NotSupported
InUseAttribute
InvalidState
Syntax
Namespace
InvalidAccess
Security
Network
Abort
Timeout
InvalidNodeType
DataClone
NoModificationAllowed
QuotaExceeded
TypeMismatch
Type
(
String
)
Range
(
String
)
JSFailed
}
pub
type
Fallible
<
T
>
=
Result
<
T
Error
>
;
pub
type
ErrorResult
=
Fallible
<
(
)
>
;
pub
unsafe
fn
throw_dom_exception
(
cx
:
*
mut
JSContext
global
:
GlobalRef
result
:
Error
)
{
let
code
=
match
result
{
Error
:
:
IndexSize
=
>
DOMErrorName
:
:
IndexSizeError
Error
:
:
NotFound
=
>
DOMErrorName
:
:
NotFoundError
Error
:
:
HierarchyRequest
=
>
DOMErrorName
:
:
HierarchyRequestError
Error
:
:
WrongDocument
=
>
DOMErrorName
:
:
WrongDocumentError
Error
:
:
InvalidCharacter
=
>
DOMErrorName
:
:
InvalidCharacterError
Error
:
:
NotSupported
=
>
DOMErrorName
:
:
NotSupportedError
Error
:
:
InUseAttribute
=
>
DOMErrorName
:
:
InUseAttributeError
Error
:
:
InvalidState
=
>
DOMErrorName
:
:
InvalidStateError
Error
:
:
Syntax
=
>
DOMErrorName
:
:
SyntaxError
Error
:
:
Namespace
=
>
DOMErrorName
:
:
NamespaceError
Error
:
:
InvalidAccess
=
>
DOMErrorName
:
:
InvalidAccessError
Error
:
:
Security
=
>
DOMErrorName
:
:
SecurityError
Error
:
:
Network
=
>
DOMErrorName
:
:
NetworkError
Error
:
:
Abort
=
>
DOMErrorName
:
:
AbortError
Error
:
:
Timeout
=
>
DOMErrorName
:
:
TimeoutError
Error
:
:
InvalidNodeType
=
>
DOMErrorName
:
:
InvalidNodeTypeError
Error
:
:
DataClone
=
>
DOMErrorName
:
:
DataCloneError
Error
:
:
NoModificationAllowed
=
>
DOMErrorName
:
:
NoModificationAllowedError
Error
:
:
QuotaExceeded
=
>
DOMErrorName
:
:
QuotaExceededError
Error
:
:
TypeMismatch
=
>
DOMErrorName
:
:
TypeMismatchError
Error
:
:
Type
(
message
)
=
>
{
assert
!
(
!
JS_IsExceptionPending
(
cx
)
)
;
throw_type_error
(
cx
&
message
)
;
return
;
}
Error
:
:
Range
(
message
)
=
>
{
assert
!
(
!
JS_IsExceptionPending
(
cx
)
)
;
throw_range_error
(
cx
&
message
)
;
return
;
}
Error
:
:
JSFailed
=
>
{
assert
!
(
JS_IsExceptionPending
(
cx
)
)
;
return
;
}
}
;
assert
!
(
!
JS_IsExceptionPending
(
cx
)
)
;
let
exception
=
DOMException
:
:
new
(
global
code
)
;
let
mut
thrown
=
RootedValue
:
:
new
(
cx
UndefinedValue
(
)
)
;
exception
.
to_jsval
(
cx
thrown
.
handle_mut
(
)
)
;
JS_SetPendingException
(
cx
thrown
.
handle
(
)
)
;
}
pub
fn
report_pending_exception
(
cx
:
*
mut
JSContext
obj
:
*
mut
JSObject
)
{
unsafe
{
if
JS_IsExceptionPending
(
cx
)
{
let
saved
=
JS_SaveFrameChain
(
cx
)
;
{
let
_ac
=
JSAutoCompartment
:
:
new
(
cx
obj
)
;
JS_ReportPendingException
(
cx
)
;
}
if
saved
{
JS_RestoreFrameChain
(
cx
)
;
}
}
}
}
pub
unsafe
fn
throw_not_in_union
(
cx
:
*
mut
JSContext
names
:
&
'
static
str
)
{
assert
!
(
!
JS_IsExceptionPending
(
cx
)
)
;
let
error
=
format
!
(
"
argument
could
not
be
converted
to
any
of
:
{
}
"
names
)
;
throw_type_error
(
cx
&
error
)
;
}
pub
unsafe
fn
throw_invalid_this
(
cx
:
*
mut
JSContext
proto_id
:
u16
)
{
debug_assert
!
(
!
JS_IsExceptionPending
(
cx
)
)
;
let
error
=
format
!
(
"
\
"
this
\
"
object
does
not
implement
interface
{
}
.
"
proto_id_to_name
(
proto_id
)
)
;
throw_type_error
(
cx
&
error
)
;
}
