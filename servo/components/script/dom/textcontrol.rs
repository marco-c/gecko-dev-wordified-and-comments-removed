use
dom
:
:
bindings
:
:
cell
:
:
DomRefCell
;
use
dom
:
:
bindings
:
:
conversions
:
:
DerivedFrom
;
use
dom
:
:
bindings
:
:
str
:
:
DOMString
;
use
dom
:
:
event
:
:
{
EventBubbles
EventCancelable
}
;
use
dom
:
:
eventtarget
:
:
EventTarget
;
use
dom
:
:
node
:
:
{
Node
NodeDamage
window_from_node
}
;
use
script_traits
:
:
ScriptToConstellationChan
;
use
textinput
:
:
{
SelectionDirection
TextInput
}
;
pub
trait
TextControl
:
DerivedFrom
<
EventTarget
>
+
DerivedFrom
<
Node
>
{
fn
textinput
(
&
self
)
-
>
&
DomRefCell
<
TextInput
<
ScriptToConstellationChan
>
>
;
fn
dom_selection_start
(
&
self
)
-
>
u32
{
self
.
textinput
(
)
.
borrow
(
)
.
get_selection_start
(
)
}
fn
set_dom_selection_start
(
&
self
start
:
u32
)
{
let
mut
end
=
self
.
dom_selection_end
(
)
;
if
end
<
start
{
end
=
start
;
}
self
.
set_selection_range
(
start
end
self
.
selection_direction
(
)
)
;
}
fn
dom_selection_end
(
&
self
)
-
>
u32
{
self
.
textinput
(
)
.
borrow
(
)
.
get_absolute_insertion_point
(
)
as
u32
}
fn
set_dom_selection_end
(
&
self
end
:
u32
)
{
self
.
set_selection_range
(
self
.
dom_selection_start
(
)
end
self
.
selection_direction
(
)
)
;
}
fn
dom_selection_direction
(
&
self
)
-
>
DOMString
{
DOMString
:
:
from
(
self
.
selection_direction
(
)
)
}
fn
set_dom_selection_direction
(
&
self
direction
:
DOMString
)
{
self
.
textinput
(
)
.
borrow_mut
(
)
.
selection_direction
=
SelectionDirection
:
:
from
(
direction
)
;
}
fn
set_dom_selection_range
(
&
self
start
:
u32
end
:
u32
direction
:
Option
<
DOMString
>
)
{
let
direction
=
direction
.
map_or
(
SelectionDirection
:
:
None
|
d
|
SelectionDirection
:
:
from
(
d
)
)
;
self
.
set_selection_range
(
start
end
direction
)
;
}
fn
selection_direction
(
&
self
)
-
>
SelectionDirection
{
self
.
textinput
(
)
.
borrow
(
)
.
selection_direction
}
fn
set_selection_range
(
&
self
start
:
u32
end
:
u32
direction
:
SelectionDirection
)
{
self
.
textinput
(
)
.
borrow_mut
(
)
.
selection_direction
=
direction
;
self
.
textinput
(
)
.
borrow_mut
(
)
.
set_selection_range
(
start
end
)
;
let
window
=
window_from_node
(
self
)
;
let
_
=
window
.
user_interaction_task_source
(
)
.
queue_event
(
&
self
.
upcast
:
:
<
EventTarget
>
(
)
atom
!
(
"
select
"
)
EventBubbles
:
:
Bubbles
EventCancelable
:
:
NotCancelable
&
window
)
;
self
.
upcast
:
:
<
Node
>
(
)
.
dirty
(
NodeDamage
:
:
OtherNodeDamage
)
;
}
}
