use
std
:
:
fs
:
:
File
;
use
std
:
:
io
:
:
{
self
Read
}
;
use
std
:
:
path
:
:
PathBuf
;
use
std
:
:
sync
:
:
{
Arc
Mutex
}
;
lazy_static
!
{
static
ref
CMD_RESOURCE_DIR
:
Arc
<
Mutex
<
Option
<
String
>
>
>
=
{
Arc
:
:
new
(
Mutex
:
:
new
(
None
)
)
}
;
}
pub
fn
set_resources_path
(
path
:
Option
<
String
>
)
{
let
mut
dir
=
CMD_RESOURCE_DIR
.
lock
(
)
.
unwrap
(
)
;
*
dir
=
path
;
}
#
[
cfg
(
target_os
=
"
android
"
)
]
pub
fn
resources_dir_path
(
)
-
>
PathBuf
{
PathBuf
:
:
from
(
"
/
sdcard
/
servo
/
"
)
}
#
[
cfg
(
not
(
target_os
=
"
android
"
)
)
]
pub
fn
resources_dir_path
(
)
-
>
PathBuf
{
use
std
:
:
env
;
match
*
CMD_RESOURCE_DIR
.
lock
(
)
.
unwrap
(
)
{
Some
(
ref
path
)
=
>
PathBuf
:
:
from
(
path
)
None
=
>
{
let
mut
path
=
env
:
:
current_exe
(
)
.
expect
(
"
can
'
t
get
exe
path
"
)
;
path
=
path
.
canonicalize
(
)
.
expect
(
"
path
does
not
exist
"
)
;
path
.
pop
(
)
;
path
.
push
(
"
resources
"
)
;
if
!
path
.
is_dir
(
)
{
path
.
pop
(
)
;
path
.
pop
(
)
;
path
.
pop
(
)
;
path
.
push
(
"
resources
"
)
;
if
!
path
.
is_dir
(
)
{
path
.
pop
(
)
;
path
.
pop
(
)
;
path
.
push
(
"
resources
"
)
;
}
}
path
}
}
}
pub
fn
read_resource_file
(
relative_path_components
:
&
[
&
str
]
)
-
>
io
:
:
Result
<
Vec
<
u8
>
>
{
let
mut
path
=
resources_dir_path
(
)
;
for
component
in
relative_path_components
{
path
.
push
(
component
)
;
}
let
mut
file
=
try
!
(
File
:
:
open
(
&
path
)
)
;
let
mut
data
=
Vec
:
:
new
(
)
;
try
!
(
file
.
read_to_end
(
&
mut
data
)
)
;
Ok
(
data
)
}
