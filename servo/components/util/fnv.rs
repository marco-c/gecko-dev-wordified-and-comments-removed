pub
use
std
:
:
hash
:
:
{
Hash
Hasher
Writer
}
;
#
[
deriving
(
Clone
)
]
pub
struct
FnvHasher
;
pub
struct
FnvState
(
u64
)
;
impl
Hasher
<
FnvState
>
for
FnvHasher
{
fn
hash
<
T
:
Hash
<
FnvState
>
>
(
&
self
t
:
&
T
)
-
>
u64
{
let
mut
state
=
FnvState
(
0xcbf29ce484222325
)
;
t
.
hash
(
&
mut
state
)
;
let
FnvState
(
ret
)
=
state
;
return
ret
;
}
}
impl
Writer
for
FnvState
{
fn
write
(
&
mut
self
bytes
:
&
[
u8
]
)
{
let
FnvState
(
mut
hash
)
=
*
self
;
for
byte
in
bytes
.
iter
(
)
{
hash
=
hash
^
(
*
byte
as
u64
)
;
hash
=
hash
*
0x100000001b3
;
}
*
self
=
FnvState
(
hash
)
;
}
}
#
[
inline
(
always
)
]
pub
fn
hash
<
T
:
Hash
<
FnvState
>
>
(
t
:
&
T
)
-
>
u64
{
let
s
=
FnvHasher
;
s
.
hash
(
t
)
}
