use
rustc
:
:
hir
;
use
rustc
:
:
lint
:
:
{
LateContext
LintPass
LintArray
LateLintPass
LintContext
}
;
use
syntax
:
:
ast
;
declare_lint
!
(
PRIVATIZE
Deny
"
Allows
to
enforce
private
fields
for
struct
definitions
"
)
;
pub
struct
PrivatizePass
;
impl
LintPass
for
PrivatizePass
{
fn
get_lints
(
&
self
)
-
>
LintArray
{
lint_array
!
(
PRIVATIZE
)
}
}
impl
<
'
a
'
tcx
>
LateLintPass
<
'
a
'
tcx
>
for
PrivatizePass
{
fn
check_struct_def
(
&
mut
self
cx
:
&
LateContext
def
:
&
hir
:
:
VariantData
_n
:
ast
:
:
Name
_gen
:
&
hir
:
:
Generics
id
:
ast
:
:
NodeId
)
{
if
cx
.
tcx
.
has_attr
(
cx
.
tcx
.
hir
.
local_def_id
(
id
)
"
privatize
"
)
{
for
field
in
def
.
fields
(
)
{
if
field
.
vis
=
=
hir
:
:
Public
{
cx
.
span_lint
(
PRIVATIZE
field
.
span
&
format
!
(
"
Field
{
}
is
public
where
only
private
fields
are
allowed
"
field
.
name
)
)
;
}
}
}
}
}
