use
layout
:
:
incremental
:
:
RestyleDamage
;
use
std
:
:
cast
;
use
std
:
:
cell
:
:
Cell
;
use
newcss
:
:
complete
:
:
CompleteSelectResults
;
use
script
:
:
dom
:
:
node
:
:
{
AbstractNode
LayoutView
}
;
pub
trait
NodeUtil
<
'
self
>
{
fn
get_css_select_results
(
self
)
-
>
&
'
self
CompleteSelectResults
;
fn
set_css_select_results
(
self
decl
:
CompleteSelectResults
)
;
fn
have_css_select_results
(
self
)
-
>
bool
;
fn
get_restyle_damage
(
self
)
-
>
RestyleDamage
;
fn
set_restyle_damage
(
self
damage
:
RestyleDamage
)
;
}
impl
<
'
self
>
NodeUtil
<
'
self
>
for
AbstractNode
<
LayoutView
>
{
fn
get_css_select_results
(
self
)
-
>
&
'
self
CompleteSelectResults
{
do
self
.
read_layout_data
|
layout_data
|
{
match
layout_data
.
style
{
None
=
>
fail
!
(
~
"
style
(
)
called
on
node
without
a
style
!
"
)
Some
(
ref
style
)
=
>
unsafe
{
cast
:
:
transmute_region
(
style
)
}
}
}
}
fn
have_css_select_results
(
self
)
-
>
bool
{
self
.
read_layout_data
(
|
data
|
data
.
style
.
is_some
(
)
)
}
fn
set_css_select_results
(
self
decl
:
CompleteSelectResults
)
{
let
cell
=
Cell
:
:
new
(
decl
)
;
self
.
write_layout_data
(
|
data
|
data
.
style
=
Some
(
cell
.
take
(
)
)
)
;
}
fn
get_restyle_damage
(
self
)
-
>
RestyleDamage
{
let
default
=
if
self
.
is_element
(
)
{
RestyleDamage
:
:
all
(
)
}
else
{
RestyleDamage
:
:
none
(
)
}
;
do
self
.
read_layout_data
|
layout_data
|
{
layout_data
.
restyle_damage
.
map
(
|
&
x
|
RestyleDamage
:
:
from_int
(
x
)
)
.
unwrap_or_default
(
default
)
}
}
fn
set_restyle_damage
(
self
damage
:
RestyleDamage
)
{
self
.
write_layout_data
(
|
data
|
data
.
restyle_damage
=
Some
(
damage
.
to_int
(
)
)
)
;
}
}
