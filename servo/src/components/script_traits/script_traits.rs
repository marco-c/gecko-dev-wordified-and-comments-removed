#
!
[
crate_name
=
"
script_traits
"
]
#
!
[
crate_type
=
"
rlib
"
]
#
!
[
comment
=
"
The
Servo
Parallel
Browser
Project
"
]
#
!
[
license
=
"
MPL
"
]
extern
crate
geom
;
extern
crate
servo_msg
=
"
msg
"
;
extern
crate
servo_net
=
"
net
"
;
extern
crate
url
=
"
url_
"
;
extern
crate
std
;
extern
crate
serialize
;
use
servo_msg
:
:
constellation_msg
:
:
{
ConstellationChan
PipelineId
Failure
WindowSizeData
}
;
use
servo_msg
:
:
constellation_msg
:
:
SubpageId
;
use
servo_msg
:
:
compositor_msg
:
:
ScriptListener
;
use
servo_net
:
:
image_cache_task
:
:
ImageCacheTask
;
use
servo_net
:
:
resource_task
:
:
ResourceTask
;
use
std
:
:
any
:
:
Any
;
use
url
:
:
Url
;
use
geom
:
:
point
:
:
Point2D
;
use
serialize
:
:
{
Encodable
Encoder
}
;
pub
struct
NewLayoutInfo
{
pub
old_pipeline_id
:
PipelineId
pub
new_pipeline_id
:
PipelineId
pub
subpage_id
:
SubpageId
pub
layout_chan
:
Box
<
Any
+
Send
>
}
pub
enum
ConstellationControlMsg
{
LoadMsg
(
PipelineId
Url
)
AttachLayoutMsg
(
NewLayoutInfo
)
ResizeMsg
(
PipelineId
WindowSizeData
)
ResizeInactiveMsg
(
PipelineId
WindowSizeData
)
ExitPipelineMsg
(
PipelineId
)
SendEventMsg
(
PipelineId
CompositorEvent
)
ReflowCompleteMsg
(
PipelineId
uint
)
}
pub
enum
CompositorEvent
{
ResizeEvent
(
WindowSizeData
)
ReflowEvent
ClickEvent
(
uint
Point2D
<
f32
>
)
MouseDownEvent
(
uint
Point2D
<
f32
>
)
MouseUpEvent
(
uint
Point2D
<
f32
>
)
MouseMoveEvent
(
Point2D
<
f32
>
)
}
pub
struct
OpaqueScriptLayoutChannel
(
pub
(
Box
<
Any
+
Send
>
Box
<
Any
+
Send
>
)
)
;
#
[
deriving
(
Clone
)
]
pub
struct
ScriptControlChan
(
pub
Sender
<
ConstellationControlMsg
>
)
;
impl
<
S
:
Encoder
<
E
>
E
>
Encodable
<
S
E
>
for
ScriptControlChan
{
fn
encode
(
&
self
_s
:
&
mut
S
)
-
>
Result
<
(
)
E
>
{
Ok
(
(
)
)
}
}
pub
trait
ScriptTaskFactory
{
fn
create
<
C
:
ScriptListener
+
Send
>
(
_phantom
:
Option
<
&
mut
Self
>
id
:
PipelineId
compositor
:
Box
<
C
>
layout_chan
:
&
OpaqueScriptLayoutChannel
control_chan
:
ScriptControlChan
control_port
:
Receiver
<
ConstellationControlMsg
>
constellation_msg
:
ConstellationChan
failure_msg
:
Failure
resource_task
:
ResourceTask
image_cache_task
:
ImageCacheTask
window_size
:
WindowSizeData
)
;
fn
create_layout_channel
(
_phantom
:
Option
<
&
mut
Self
>
)
-
>
OpaqueScriptLayoutChannel
;
fn
clone_layout_channel
(
_phantom
:
Option
<
&
mut
Self
>
pair
:
&
OpaqueScriptLayoutChannel
)
-
>
Box
<
Any
+
Send
>
;
}
