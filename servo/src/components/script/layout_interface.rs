use
dom
:
:
node
:
:
{
AbstractNode
ScriptView
LayoutView
}
;
use
script_task
:
:
{
ScriptMsg
ScriptChan
}
;
use
std
:
:
comm
:
:
{
Chan
SharedChan
}
;
use
geom
:
:
rect
:
:
Rect
;
use
geom
:
:
size
:
:
Size2D
;
use
geom
:
:
point
:
:
Point2D
;
use
gfx
:
:
geometry
:
:
Au
;
use
newcss
:
:
stylesheet
:
:
Stylesheet
;
use
extra
:
:
net
:
:
url
:
:
Url
;
pub
enum
Msg
{
AddStylesheetMsg
(
Stylesheet
)
ReflowMsg
(
~
Reflow
)
QueryMsg
(
LayoutQuery
)
RouteScriptMsg
(
ScriptMsg
)
ExitMsg
}
pub
enum
LayoutQuery
{
ContentBoxQuery
(
AbstractNode
<
ScriptView
>
Chan
<
Result
<
ContentBoxResponse
(
)
>
>
)
ContentBoxesQuery
(
AbstractNode
<
ScriptView
>
Chan
<
Result
<
ContentBoxesResponse
(
)
>
>
)
HitTestQuery
(
AbstractNode
<
ScriptView
>
Point2D
<
f32
>
Chan
<
Result
<
HitTestResponse
(
)
>
>
)
}
pub
struct
ContentBoxResponse
(
Rect
<
Au
>
)
;
pub
struct
ContentBoxesResponse
(
~
[
Rect
<
Au
>
]
)
;
pub
struct
HitTestResponse
(
AbstractNode
<
LayoutView
>
)
;
pub
enum
DocumentDamageLevel
{
MatchSelectorsDocumentDamage
ReflowDocumentDamage
}
impl
DocumentDamageLevel
{
fn
add
(
&
mut
self
new_damage
:
DocumentDamageLevel
)
{
match
(
*
self
new_damage
)
{
(
ReflowDocumentDamage
new_damage
)
=
>
*
self
=
new_damage
(
MatchSelectorsDocumentDamage
_
)
=
>
*
self
=
MatchSelectorsDocumentDamage
}
}
}
pub
struct
DocumentDamage
{
root
:
AbstractNode
<
ScriptView
>
level
:
DocumentDamageLevel
}
#
[
deriving
(
Eq
)
]
pub
enum
ReflowGoal
{
ReflowForDisplay
ReflowForScriptQuery
}
pub
struct
Reflow
{
document_root
:
AbstractNode
<
ScriptView
>
damage
:
DocumentDamage
goal
:
ReflowGoal
url
:
Url
script_chan
:
ScriptChan
window_size
:
Size2D
<
uint
>
script_join_chan
:
Chan
<
(
)
>
}
#
[
deriving
(
Clone
)
]
pub
struct
LayoutChan
{
chan
:
SharedChan
<
Msg
>
}
impl
LayoutChan
{
pub
fn
new
(
chan
:
Chan
<
Msg
>
)
-
>
LayoutChan
{
LayoutChan
{
chan
:
SharedChan
:
:
new
(
chan
)
}
}
pub
fn
send
(
&
self
msg
:
Msg
)
{
self
.
chan
.
send
(
msg
)
;
}
}
