use
style
:
:
ComputedValues
;
bitflags
!
{
#
[
doc
=
"
Individual
layout
actions
that
may
be
necessary
after
restyling
.
"
]
flags
RestyleDamage
:
int
{
#
[
doc
=
"
Repaint
the
node
itself
.
"
]
#
[
doc
=
"
Currently
unused
;
need
to
decide
how
this
propagates
.
"
]
static
Repaint
=
0x01
#
[
doc
=
"
Recompute
intrinsic
inline_sizes
(
minimum
and
preferred
)
.
"
]
#
[
doc
=
"
Propagates
down
the
flow
tree
because
the
computation
is
"
]
#
[
doc
=
"
bottom
-
up
.
"
]
static
BubbleISizes
=
0x02
#
[
doc
=
"
Recompute
actual
inline_sizes
and
block_sizes
.
"
]
#
[
doc
=
"
Propagates
up
the
flow
tree
because
the
computation
is
"
]
#
[
doc
=
"
top
-
down
.
"
]
static
Reflow
=
0x04
}
}
impl
RestyleDamage
{
pub
fn
propagate_up
(
self
)
-
>
RestyleDamage
{
self
&
Reflow
}
pub
fn
propagate_down
(
self
)
-
>
RestyleDamage
{
self
&
BubbleISizes
}
}
macro_rules
!
add_if_not_equal
(
(
old
:
ident
new
:
ident
damage
:
ident
[
(
effect
:
ident
)
*
]
[
(
style_struct_getter
:
ident
.
name
:
ident
)
*
]
)
=
>
(
{
if
(
(
old
.
style_struct_getter
(
)
.
name
!
=
new
.
style_struct_getter
(
)
.
name
)
)
|
|
*
{
damage
.
insert
(
(
effect
)
|
*
)
;
}
}
)
)
pub
fn
compute_damage
(
old
:
&
ComputedValues
new
:
&
ComputedValues
)
-
>
RestyleDamage
{
let
mut
damage
=
RestyleDamage
:
:
empty
(
)
;
add_if_not_equal
!
(
old
new
damage
[
Repaint
]
[
get_color
.
color
get_background
.
background_color
get_border
.
border_top_color
get_border
.
border_right_color
get_border
.
border_bottom_color
get_border
.
border_left_color
]
)
;
add_if_not_equal
!
(
old
new
damage
[
Repaint
BubbleISizes
Reflow
]
[
get_border
.
border_top_width
get_border
.
border_right_width
get_border
.
border_bottom_width
get_border
.
border_left_width
get_margin
.
margin_top
get_margin
.
margin_right
get_margin
.
margin_bottom
get_margin
.
margin_left
get_padding
.
padding_top
get_padding
.
padding_right
get_padding
.
padding_bottom
get_padding
.
padding_left
get_box
.
position
get_box
.
width
get_box
.
height
get_box
.
float
get_box
.
display
get_font
.
font_family
get_font
.
font_size
get_font
.
font_style
get_font
.
font_weight
get_inheritedtext
.
text_align
get_text
.
text_decoration
get_inheritedbox
.
line_height
]
)
;
damage
}
