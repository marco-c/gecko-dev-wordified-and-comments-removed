use
azure
:
:
azure_hl
:
:
DrawTarget
;
use
azure
:
:
azure
:
:
AzGLContext
;
use
geom
:
:
rect
:
:
Rect
;
use
geom
:
:
size
:
:
Size2D
;
use
constellation_msg
:
:
PipelineId
;
#
[
deriving
(
Clone
)
]
pub
struct
LayerBuffer
{
draw_target
:
DrawTarget
rect
:
Rect
<
f32
>
screen_pos
:
Rect
<
uint
>
resolution
:
f32
stride
:
uint
}
#
[
deriving
(
Clone
)
]
pub
struct
LayerBufferSet
{
buffers
:
~
[
~
LayerBuffer
]
}
#
[
deriving
(
Eq
)
]
pub
enum
RenderState
{
IdleRenderState
RenderingRenderState
}
#
[
deriving
(
Eq
)
]
pub
enum
ReadyState
{
Blank
Loading
PerformingLayout
FinishedLoading
}
#
[
deriving
(
Eq
)
]
pub
struct
Epoch
(
uint
)
;
impl
Epoch
{
pub
fn
next
(
&
mut
self
)
{
*
*
self
+
=
1
;
}
}
pub
trait
RenderListener
{
fn
get_gl_context
(
&
self
)
-
>
AzGLContext
;
fn
new_layer
(
&
self
PipelineId
Size2D
<
uint
>
)
;
fn
set_layer_page_size
(
&
self
PipelineId
Size2D
<
uint
>
Epoch
)
;
fn
set_layer_clip_rect
(
&
self
PipelineId
Rect
<
uint
>
)
;
fn
delete_layer
(
&
self
PipelineId
)
;
fn
paint
(
&
self
id
:
PipelineId
layer_buffer_set
:
~
LayerBufferSet
Epoch
)
;
fn
set_render_state
(
&
self
render_state
:
RenderState
)
;
}
pub
trait
ScriptListener
:
Clone
{
fn
set_ready_state
(
&
self
ReadyState
)
;
fn
invalidate_rect
(
&
self
PipelineId
Rect
<
uint
>
)
;
}
pub
trait
Tile
{
fn
get_mem
(
&
self
)
-
>
uint
;
fn
is_valid
(
&
self
f32
)
-
>
bool
;
fn
get_size_2d
(
&
self
)
-
>
Size2D
<
uint
>
;
}
impl
Tile
for
~
LayerBuffer
{
fn
get_mem
(
&
self
)
-
>
uint
{
self
.
screen_pos
.
size
.
width
*
self
.
screen_pos
.
size
.
height
}
fn
is_valid
(
&
self
scale
:
f32
)
-
>
bool
{
self
.
resolution
.
approx_eq
(
&
scale
)
}
fn
get_size_2d
(
&
self
)
-
>
Size2D
<
uint
>
{
self
.
screen_pos
.
size
}
}
