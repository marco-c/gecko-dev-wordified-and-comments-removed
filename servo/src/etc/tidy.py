import
fileinput
sys
os
from
licenseck
import
*
err
=
0
def
report_error_name_no
(
name
no
s
)
:
    
global
err
    
print
(
"
%
s
:
%
d
:
%
s
"
%
(
name
no
s
)
)
    
err
=
1
def
report_err
(
s
)
:
    
report_error_name_no
(
fileinput
.
filename
(
)
fileinput
.
filelineno
(
)
s
)
def
report_warn
(
s
)
:
    
print
(
"
%
s
:
%
d
:
%
s
"
%
(
fileinput
.
filename
(
)
                         
fileinput
.
filelineno
(
)
                         
s
)
)
def
do_license_check
(
name
contents
)
:
    
if
not
check_license
(
name
contents
)
:
        
report_error_name_no
(
name
1
"
incorrect
license
"
)
exceptions
=
[
    
"
src
/
cairo
"
    
"
src
/
libcss
"
    
"
src
/
libhubbub
"
    
"
src
/
libparserutils
"
    
"
src
/
libwapcaplet
"
    
"
src
/
mozjs
"
    
"
src
/
pixman
"
    
"
src
/
rust
/
"
    
"
src
/
rust
-
azure
/
src
"
    
"
src
/
rust
-
azure
/
include
"
    
"
src
/
rust
-
harfbuzz
/
harfbuzz
"
    
"
src
/
skia
"
    
"
src
/
servo
/
dom
/
bindings
/
codegen
"
    
"
src
/
rust
-
opengles
"
    
"
src
/
rust
-
stb
-
image
"
]
def
should_check
(
name
)
:
    
if
"
.
#
"
in
name
:
        
return
False
    
if
not
(
name
.
endswith
(
"
.
rs
"
)
            
or
name
.
endswith
(
"
.
rc
"
)
            
or
name
.
endswith
(
"
.
cpp
"
)
            
or
name
.
endswith
(
"
.
c
"
)
            
or
name
.
endswith
(
"
.
h
"
)
            
or
name
.
endswith
(
"
.
py
"
)
)
:
        
return
False
    
for
exception
in
exceptions
:
        
if
exception
in
name
:
            
return
False
    
return
True
file_names
=
[
]
for
root
dirs
files
in
os
.
walk
(
sys
.
argv
[
1
]
)
:
    
for
myfile
in
files
:
        
file_name
=
root
+
"
/
"
+
myfile
        
if
should_check
(
file_name
)
:
            
file_names
.
append
(
file_name
)
current_name
=
"
"
current_contents
=
"
"
for
line
in
fileinput
.
input
(
file_names
)
:
    
if
fileinput
.
isfirstline
(
)
and
current_name
!
=
"
"
:
        
do_license_check
(
current_name
current_contents
)
    
if
fileinput
.
isfirstline
(
)
:
        
current_name
=
fileinput
.
filename
(
)
        
current_contents
=
"
"
    
current_contents
+
=
line
if
current_name
!
=
"
"
:
    
do_license_check
(
current_name
current_contents
)
sys
.
exit
(
err
)
