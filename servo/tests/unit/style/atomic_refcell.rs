use
style
:
:
atomic_refcell
:
:
{
AtomicRef
AtomicRefCell
}
;
struct
Foo
{
u
:
u32
}
struct
Bar
{
f
:
Foo
}
#
[
test
]
fn
map
(
)
{
let
a
=
AtomicRefCell
:
:
new
(
Bar
{
f
:
Foo
{
u
:
42
}
}
)
;
let
b
=
a
.
borrow
(
)
;
assert_eq
!
(
b
.
f
.
u
42
)
;
let
c
=
AtomicRef
:
:
map
(
b
|
x
|
&
x
.
f
)
;
assert_eq
!
(
c
.
u
42
)
;
let
d
=
AtomicRef
:
:
map
(
c
|
x
|
&
x
.
u
)
;
assert_eq
!
(
*
d
42
)
;
}
