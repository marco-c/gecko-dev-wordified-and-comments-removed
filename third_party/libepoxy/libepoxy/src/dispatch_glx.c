#
include
<
assert
.
h
>
#
include
<
string
.
h
>
#
include
<
stdio
.
h
>
#
include
"
dispatch_common
.
h
"
int
epoxy_conservative_glx_version
(
void
)
{
Display
*
dpy
=
glXGetCurrentDisplay
(
)
;
GLXContext
ctx
=
glXGetCurrentContext
(
)
;
int
screen
;
if
(
!
dpy
|
|
!
ctx
)
return
14
;
glXQueryContext
(
dpy
ctx
GLX_SCREEN
&
screen
)
;
return
epoxy_glx_version
(
dpy
screen
)
;
}
int
epoxy_glx_version
(
Display
*
dpy
int
screen
)
{
int
server_major
server_minor
;
int
client_major
client_minor
;
int
server
client
;
const
char
*
version_string
;
int
ret
;
version_string
=
glXQueryServerString
(
dpy
screen
GLX_VERSION
)
;
if
(
!
version_string
)
return
0
;
ret
=
sscanf
(
version_string
"
%
d
.
%
d
"
&
server_major
&
server_minor
)
;
assert
(
ret
=
=
2
)
;
server
=
server_major
*
10
+
server_minor
;
version_string
=
glXGetClientString
(
dpy
GLX_VERSION
)
;
if
(
!
version_string
)
return
0
;
ret
=
sscanf
(
version_string
"
%
d
.
%
d
"
&
client_major
&
client_minor
)
;
assert
(
ret
=
=
2
)
;
client
=
client_major
*
10
+
client_minor
;
if
(
client
<
server
)
return
client
;
else
return
server
;
}
bool
epoxy_conservative_has_glx_extension
(
const
char
*
ext
)
{
Display
*
dpy
=
glXGetCurrentDisplay
(
)
;
GLXContext
ctx
=
glXGetCurrentContext
(
)
;
int
screen
;
if
(
!
dpy
|
|
!
ctx
)
return
true
;
glXQueryContext
(
dpy
ctx
GLX_SCREEN
&
screen
)
;
return
epoxy_has_glx_extension
(
dpy
screen
ext
)
;
}
bool
epoxy_has_glx_extension
(
Display
*
dpy
int
screen
const
char
*
ext
)
{
return
epoxy_extension_in_string
(
glXQueryExtensionsString
(
dpy
screen
)
ext
)
;
}
bool
epoxy_has_glx
(
Display
*
dpy
)
{
#
if
!
PLATFORM_HAS_GLX
return
false
;
#
else
if
(
epoxy_load_glx
(
false
true
)
)
{
Bool
(
*
pf_glXQueryExtension
)
(
Display
*
int
*
int
*
)
;
int
error_base
event_base
;
pf_glXQueryExtension
=
epoxy_conservative_glx_dlsym
(
"
glXQueryExtension
"
false
)
;
if
(
pf_glXQueryExtension
&
&
pf_glXQueryExtension
(
dpy
&
error_base
&
event_base
)
)
return
true
;
}
return
false
;
#
endif
}
