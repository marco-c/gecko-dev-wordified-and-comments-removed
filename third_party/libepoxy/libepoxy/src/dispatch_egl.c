#
include
<
assert
.
h
>
#
include
<
string
.
h
>
#
include
<
stdio
.
h
>
#
include
"
dispatch_common
.
h
"
int
epoxy_conservative_egl_version
(
void
)
{
EGLDisplay
dpy
=
eglGetCurrentDisplay
(
)
;
if
(
!
dpy
)
return
14
;
return
epoxy_egl_version
(
dpy
)
;
}
int
epoxy_egl_version
(
EGLDisplay
dpy
)
{
int
major
minor
;
const
char
*
version_string
;
int
ret
;
version_string
=
eglQueryString
(
dpy
EGL_VERSION
)
;
if
(
!
version_string
)
return
0
;
ret
=
sscanf
(
version_string
"
%
d
.
%
d
"
&
major
&
minor
)
;
assert
(
ret
=
=
2
)
;
return
major
*
10
+
minor
;
}
bool
epoxy_conservative_has_egl_extension
(
const
char
*
ext
)
{
return
epoxy_has_egl_extension
(
eglGetCurrentDisplay
(
)
ext
)
;
}
bool
epoxy_has_egl_extension
(
EGLDisplay
dpy
const
char
*
ext
)
{
return
epoxy_extension_in_string
(
eglQueryString
(
dpy
EGL_EXTENSIONS
)
ext
)
|
|
epoxy_extension_in_string
(
eglQueryString
(
NULL
EGL_EXTENSIONS
)
ext
)
;
}
bool
epoxy_has_egl
(
void
)
{
#
if
!
PLATFORM_HAS_EGL
return
false
;
#
else
if
(
epoxy_load_egl
(
false
true
)
)
{
EGLDisplay
*
(
*
pf_eglGetCurrentDisplay
)
(
void
)
;
pf_eglGetCurrentDisplay
=
epoxy_conservative_egl_dlsym
(
"
eglGetCurrentDisplay
"
false
)
;
if
(
pf_eglGetCurrentDisplay
)
return
true
;
}
return
false
;
#
endif
}
