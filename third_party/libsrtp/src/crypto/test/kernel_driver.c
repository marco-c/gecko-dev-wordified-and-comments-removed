#
ifdef
HAVE_CONFIG_H
#
include
<
config
.
h
>
#
endif
#
include
<
stdio
.
h
>
#
include
"
getopt_s
.
h
"
#
include
"
crypto_kernel
.
h
"
void
usage
(
char
*
prog_name
)
{
printf
(
"
usage
:
%
s
[
-
v
]
[
-
d
debug_module
]
*
\
n
"
prog_name
)
;
exit
(
255
)
;
}
int
main
(
int
argc
char
*
argv
[
]
)
{
int
q
;
int
do_validation
=
0
;
srtp_err_status_t
status
;
if
(
argc
=
=
1
)
usage
(
argv
[
0
]
)
;
status
=
srtp_crypto_kernel_init
(
)
;
if
(
status
)
{
printf
(
"
error
:
srtp_crypto_kernel
init
failed
\
n
"
)
;
exit
(
1
)
;
}
printf
(
"
srtp_crypto_kernel
successfully
initalized
\
n
"
)
;
while
(
1
)
{
q
=
getopt_s
(
argc
argv
"
vd
:
"
)
;
if
(
q
=
=
-
1
)
break
;
switch
(
q
)
{
case
'
v
'
:
do_validation
=
1
;
break
;
case
'
d
'
:
status
=
srtp_crypto_kernel_set_debug_module
(
optarg_s
1
)
;
if
(
status
)
{
printf
(
"
error
:
set
debug
module
(
%
s
)
failed
\
n
"
optarg_s
)
;
exit
(
1
)
;
}
break
;
default
:
usage
(
argv
[
0
]
)
;
}
}
if
(
do_validation
)
{
printf
(
"
checking
srtp_crypto_kernel
status
.
.
.
\
n
"
)
;
status
=
srtp_crypto_kernel_status
(
)
;
if
(
status
)
{
printf
(
"
failed
\
n
"
)
;
exit
(
1
)
;
}
printf
(
"
srtp_crypto_kernel
passed
self
-
tests
\
n
"
)
;
}
status
=
srtp_crypto_kernel_shutdown
(
)
;
if
(
status
)
{
printf
(
"
error
:
srtp_crypto_kernel
shutdown
failed
\
n
"
)
;
exit
(
1
)
;
}
printf
(
"
srtp_crypto_kernel
successfully
shut
down
\
n
"
)
;
return
0
;
}
