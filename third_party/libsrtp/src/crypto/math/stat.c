#
ifdef
HAVE_CONFIG_H
#
include
<
config
.
h
>
#
endif
#
include
"
stat
.
h
"
srtp_debug_module_t
srtp_mod_stat
=
{
0
(
char
*
)
"
stat
test
"
}
;
#
define
STAT_TEST_DATA_LEN
2500
srtp_err_status_t
stat_test_monobit
(
uint8_t
*
data
)
{
uint8_t
*
data_end
=
data
+
STAT_TEST_DATA_LEN
;
uint16_t
ones_count
;
ones_count
=
0
;
while
(
data
<
data_end
)
{
ones_count
+
=
octet_get_weight
(
*
data
)
;
data
+
+
;
}
debug_print
(
srtp_mod_stat
"
bit
count
:
%
d
"
ones_count
)
;
if
(
(
ones_count
<
9725
)
|
|
(
ones_count
>
10275
)
)
return
srtp_err_status_algo_fail
;
return
srtp_err_status_ok
;
}
srtp_err_status_t
stat_test_poker
(
uint8_t
*
data
)
{
int
i
;
uint8_t
*
data_end
=
data
+
STAT_TEST_DATA_LEN
;
double
poker
;
uint16_t
f
[
16
]
=
{
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
}
;
while
(
data
<
data_end
)
{
f
[
*
data
&
0x0f
]
+
+
;
f
[
(
*
data
)
>
>
4
]
+
+
;
data
+
+
;
}
poker
=
0
.
0
;
for
(
i
=
0
;
i
<
16
;
i
+
+
)
poker
+
=
(
double
)
f
[
i
]
*
f
[
i
]
;
poker
*
=
(
16
.
0
/
5000
.
0
)
;
poker
-
=
5000
.
0
;
debug_print
(
srtp_mod_stat
"
poker
test
:
%
f
\
n
"
poker
)
;
if
(
(
poker
<
2
.
16
)
|
|
(
poker
>
46
.
17
)
)
return
srtp_err_status_algo_fail
;
return
srtp_err_status_ok
;
}
srtp_err_status_t
stat_test_runs
(
uint8_t
*
data
)
{
uint8_t
*
data_end
=
data
+
STAT_TEST_DATA_LEN
;
uint16_t
runs
[
6
]
=
{
0
0
0
0
0
0
}
;
uint16_t
gaps
[
6
]
=
{
0
0
0
0
0
0
}
;
uint16_t
lo_value
[
6
]
=
{
2315
1114
527
240
103
103
}
;
uint16_t
hi_value
[
6
]
=
{
2685
1386
723
384
209
209
}
;
int
state
=
0
;
uint16_t
mask
;
int
i
;
while
(
data
<
data_end
)
{
for
(
mask
=
1
;
mask
<
256
;
mask
<
<
=
1
)
{
if
(
*
data
&
mask
)
{
if
(
state
>
0
)
{
state
+
+
;
if
(
state
>
25
)
{
debug_print
(
srtp_mod_stat
"
>
25
runs
:
%
d
"
state
)
;
return
srtp_err_status_algo_fail
;
}
}
else
if
(
state
<
0
)
{
if
(
state
<
-
25
)
{
debug_print
(
srtp_mod_stat
"
>
25
gaps
:
%
d
"
state
)
;
return
srtp_err_status_algo_fail
;
}
if
(
state
<
-
6
)
{
state
=
-
6
;
}
gaps
[
-
1
-
state
]
+
+
;
state
=
1
;
}
else
{
state
=
1
;
}
}
else
{
if
(
state
>
0
)
{
if
(
state
>
25
)
{
debug_print
(
srtp_mod_stat
"
>
25
runs
(
2
)
:
%
d
"
state
)
;
return
srtp_err_status_algo_fail
;
}
if
(
state
>
6
)
{
state
=
6
;
}
runs
[
state
-
1
]
+
+
;
state
=
-
1
;
}
else
if
(
state
<
0
)
{
state
-
-
;
if
(
state
<
-
25
)
{
debug_print
(
srtp_mod_stat
"
>
25
gaps
(
2
)
:
%
d
"
state
)
;
return
srtp_err_status_algo_fail
;
}
}
else
{
state
=
-
1
;
}
}
}
data
+
+
;
}
if
(
srtp_mod_stat
.
on
)
{
debug_print
(
srtp_mod_stat
"
runs
test
"
NULL
)
;
for
(
i
=
0
;
i
<
6
;
i
+
+
)
debug_print
(
srtp_mod_stat
"
runs
[
]
:
%
d
"
runs
[
i
]
)
;
for
(
i
=
0
;
i
<
6
;
i
+
+
)
debug_print
(
srtp_mod_stat
"
gaps
[
]
:
%
d
"
gaps
[
i
]
)
;
}
for
(
i
=
0
;
i
<
6
;
i
+
+
)
if
(
(
runs
[
i
]
<
lo_value
[
i
]
)
|
|
(
runs
[
i
]
>
hi_value
[
i
]
)
|
|
(
gaps
[
i
]
<
lo_value
[
i
]
)
|
|
(
gaps
[
i
]
>
hi_value
[
i
]
)
)
return
srtp_err_status_algo_fail
;
return
srtp_err_status_ok
;
}
