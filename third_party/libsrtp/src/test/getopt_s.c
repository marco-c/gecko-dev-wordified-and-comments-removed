#
include
<
stdlib
.
h
>
int
optind_s
=
0
;
char
*
optarg_s
;
#
define
GETOPT_FOUND_WITHOUT_ARGUMENT
2
#
define
GETOPT_FOUND_WITH_ARGUMENT
1
#
define
GETOPT_NOT_FOUND
0
static
int
getopt_check_character
(
char
c
const
char
*
string
)
{
unsigned
int
max_string_len
=
128
;
while
(
*
string
!
=
0
)
{
if
(
max_string_len
=
=
0
)
{
return
GETOPT_NOT_FOUND
;
}
max_string_len
-
-
;
if
(
*
string
+
+
=
=
c
)
{
if
(
*
string
=
=
'
:
'
)
{
return
GETOPT_FOUND_WITH_ARGUMENT
;
}
else
{
return
GETOPT_FOUND_WITHOUT_ARGUMENT
;
}
}
}
return
GETOPT_NOT_FOUND
;
}
int
getopt_s
(
int
argc
char
*
const
argv
[
]
const
char
*
optstring
)
{
while
(
optind_s
+
1
<
argc
)
{
char
*
string
;
optind_s
+
+
;
string
=
argv
[
optind_s
]
;
if
(
string
=
=
NULL
)
return
'
?
'
;
if
(
string
[
0
]
!
=
'
-
'
)
return
-
1
;
switch
(
getopt_check_character
(
string
[
1
]
optstring
)
)
{
case
GETOPT_FOUND_WITH_ARGUMENT
:
if
(
optind_s
+
1
<
argc
)
{
optind_s
+
+
;
optarg_s
=
argv
[
optind_s
]
;
return
string
[
1
]
;
}
else
{
return
'
?
'
;
}
case
GETOPT_FOUND_WITHOUT_ARGUMENT
:
return
string
[
1
]
;
case
GETOPT_NOT_FOUND
:
default
:
return
'
?
'
;
break
;
}
}
return
-
1
;
}
