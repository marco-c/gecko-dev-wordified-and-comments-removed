use
core
:
:
result
;
use
core
:
:
ops
:
:
{
Index
RangeFrom
}
;
use
crate
:
:
ctx
:
:
{
TryFromCtx
MeasureWith
}
;
use
crate
:
:
error
;
pub
trait
Pread
<
Ctx
E
>
:
Index
<
usize
>
+
Index
<
RangeFrom
<
usize
>
>
+
MeasureWith
<
Ctx
>
where
Ctx
:
Copy
E
:
From
<
error
:
:
Error
>
{
#
[
inline
]
fn
pread
<
'
a
N
:
TryFromCtx
<
'
a
Ctx
<
Self
as
Index
<
RangeFrom
<
usize
>
>
>
:
:
Output
Error
=
E
>
>
(
&
'
a
self
offset
:
usize
)
-
>
result
:
:
Result
<
N
E
>
where
<
Self
as
Index
<
RangeFrom
<
usize
>
>
>
:
:
Output
:
'
a
Ctx
:
Default
{
self
.
pread_with
(
offset
Ctx
:
:
default
(
)
)
}
#
[
inline
]
fn
pread_with
<
'
a
N
:
TryFromCtx
<
'
a
Ctx
<
Self
as
Index
<
RangeFrom
<
usize
>
>
>
:
:
Output
Error
=
E
>
>
(
&
'
a
self
offset
:
usize
ctx
:
Ctx
)
-
>
result
:
:
Result
<
N
E
>
where
<
Self
as
Index
<
RangeFrom
<
usize
>
>
>
:
:
Output
:
'
a
{
let
len
=
self
.
measure_with
(
&
ctx
)
;
if
offset
>
=
len
{
return
Err
(
error
:
:
Error
:
:
BadOffset
(
offset
)
.
into
(
)
)
}
N
:
:
try_from_ctx
(
&
self
[
offset
.
.
]
ctx
)
.
and_then
(
|
(
n
_
)
|
Ok
(
n
)
)
}
#
[
inline
]
fn
gread
<
'
a
N
:
TryFromCtx
<
'
a
Ctx
<
Self
as
Index
<
RangeFrom
<
usize
>
>
>
:
:
Output
Error
=
E
>
>
(
&
'
a
self
offset
:
&
mut
usize
)
-
>
result
:
:
Result
<
N
E
>
where
Ctx
:
Default
<
Self
as
Index
<
RangeFrom
<
usize
>
>
>
:
:
Output
:
'
a
{
let
ctx
=
Ctx
:
:
default
(
)
;
self
.
gread_with
(
offset
ctx
)
}
#
[
inline
]
fn
gread_with
<
'
a
N
:
TryFromCtx
<
'
a
Ctx
<
Self
as
Index
<
RangeFrom
<
usize
>
>
>
:
:
Output
Error
=
E
>
>
(
&
'
a
self
offset
:
&
mut
usize
ctx
:
Ctx
)
-
>
result
:
:
Result
<
N
E
>
where
<
Self
as
Index
<
RangeFrom
<
usize
>
>
>
:
:
Output
:
'
a
{
let
o
=
*
offset
;
let
len
=
self
.
measure_with
(
&
ctx
)
;
if
o
>
=
len
{
return
Err
(
error
:
:
Error
:
:
BadOffset
(
o
)
.
into
(
)
)
}
N
:
:
try_from_ctx
(
&
self
[
o
.
.
]
ctx
)
.
and_then
(
|
(
n
size
)
|
{
*
offset
+
=
size
;
Ok
(
n
)
}
)
}
#
[
inline
]
fn
gread_inout
<
'
a
N
>
(
&
'
a
self
offset
:
&
mut
usize
inout
:
&
mut
[
N
]
)
-
>
result
:
:
Result
<
(
)
E
>
where
N
:
TryFromCtx
<
'
a
Ctx
<
Self
as
Index
<
RangeFrom
<
usize
>
>
>
:
:
Output
Error
=
E
>
Ctx
:
Default
<
Self
as
Index
<
RangeFrom
<
usize
>
>
>
:
:
Output
:
'
a
{
for
i
in
inout
.
iter_mut
(
)
{
*
i
=
self
.
gread
(
offset
)
?
;
}
Ok
(
(
)
)
}
#
[
inline
]
fn
gread_inout_with
<
'
a
N
>
(
&
'
a
self
offset
:
&
mut
usize
inout
:
&
mut
[
N
]
ctx
:
Ctx
)
-
>
result
:
:
Result
<
(
)
E
>
where
N
:
TryFromCtx
<
'
a
Ctx
<
Self
as
Index
<
RangeFrom
<
usize
>
>
>
:
:
Output
Error
=
E
>
<
Self
as
Index
<
RangeFrom
<
usize
>
>
>
:
:
Output
:
'
a
{
for
i
in
inout
.
iter_mut
(
)
{
*
i
=
self
.
gread_with
(
offset
ctx
)
?
;
}
Ok
(
(
)
)
}
}
impl
<
Ctx
:
Copy
E
:
From
<
error
:
:
Error
>
R
:
?
Sized
+
Index
<
usize
>
+
Index
<
RangeFrom
<
usize
>
>
+
MeasureWith
<
Ctx
>
>
Pread
<
Ctx
E
>
for
R
{
}
