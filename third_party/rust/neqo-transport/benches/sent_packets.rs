use
std
:
:
{
hint
:
:
black_box
time
:
:
Instant
}
;
use
criterion
:
:
{
criterion_group
criterion_main
Criterion
}
;
use
neqo_transport
:
:
{
self
packet
recovery
:
:
{
self
sent
}
}
;
fn
sent_packets
(
)
-
>
sent
:
:
Packets
{
let
mut
pkts
=
sent
:
:
Packets
:
:
default
(
)
;
let
now
=
Instant
:
:
now
(
)
;
for
i
in
0
.
.
2_000u64
{
pkts
.
track
(
sent
:
:
Packet
:
:
new
(
packet
:
:
Type
:
:
Short
packet
:
:
Number
:
:
from
(
i
)
now
true
recovery
:
:
Tokens
:
:
new
(
)
100
)
)
;
}
pkts
}
fn
take_ranges
(
c
:
&
mut
Criterion
)
{
c
.
bench_function
(
"
sent
:
:
Packets
:
:
take_ranges
"
|
b
|
{
b
.
iter_batched_ref
(
sent_packets
|
pkts
|
black_box
(
pkts
.
take_ranges
(
[
70
.
.
=
89
40
.
.
=
59
10
.
.
=
29
]
)
)
criterion
:
:
BatchSize
:
:
SmallInput
)
;
}
)
;
}
criterion_group
!
(
benches
take_ranges
)
;
criterion_main
!
(
benches
)
;
