use
libc
:
:
c_char
;
use
std
:
:
{
ffi
ptr
}
;
extern
"
C
"
{
fn
get_os_release
(
)
-
>
*
const
c_char
;
fn
str_free
(
ptr
:
*
const
c_char
)
;
}
pub
fn
kernel_version
(
)
-
>
Option
<
String
>
{
unsafe
{
let
rp
=
get_os_release
(
)
;
if
rp
=
=
ptr
:
:
null
(
)
{
None
}
else
{
let
typ
=
ffi
:
:
CStr
:
:
from_ptr
(
rp
)
;
let
res
=
Some
(
typ
.
to_string_lossy
(
)
.
into_owned
(
)
)
;
str_free
(
rp
)
;
res
}
}
}
