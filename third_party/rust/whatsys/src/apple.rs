use
libc
:
:
c_int
;
fn
get_system_info
(
value
:
c_int
)
-
>
Option
<
String
>
{
let
mut
mib
:
[
c_int
;
2
]
=
[
libc
:
:
CTL_KERN
value
]
;
let
mut
size
=
0
;
unsafe
{
libc
:
:
sysctl
(
mib
.
as_mut_ptr
(
)
2
std
:
:
ptr
:
:
null_mut
(
)
&
mut
size
std
:
:
ptr
:
:
null_mut
(
)
0
)
}
;
if
size
=
=
0
{
return
None
;
}
let
mut
buf
=
vec
!
[
0_u8
;
size
as
usize
]
;
if
unsafe
{
libc
:
:
sysctl
(
mib
.
as_mut_ptr
(
)
2
buf
.
as_mut_ptr
(
)
as
_
&
mut
size
std
:
:
ptr
:
:
null_mut
(
)
0
)
}
=
=
-
1
{
None
}
else
{
if
let
Some
(
pos
)
=
buf
.
iter
(
)
.
position
(
|
x
|
*
x
=
=
0
)
{
buf
.
resize
(
pos
0
)
;
}
String
:
:
from_utf8
(
buf
)
.
ok
(
)
}
}
pub
fn
kernel_version
(
)
-
>
Option
<
String
>
{
get_system_info
(
libc
:
:
KERN_OSRELEASE
)
}
