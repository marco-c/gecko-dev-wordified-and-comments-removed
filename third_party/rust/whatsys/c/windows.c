#
include
<
assert
.
h
>
#
include
<
stdio
.
h
>
#
include
<
string
.
h
>
#
include
<
windows
.
h
>
int
get_os_release
(
char
*
outbuf
size_t
outlen
)
{
assert
(
outlen
>
1
)
;
OSVERSIONINFO
osvi
;
ZeroMemory
(
&
osvi
sizeof
(
osvi
)
)
;
osvi
.
dwOSVersionInfoSize
=
sizeof
(
osvi
)
;
int
written
=
0
;
if
(
GetVersionEx
(
&
osvi
)
)
{
written
=
snprintf
(
outbuf
outlen
"
%
ld
.
%
ld
"
osvi
.
dwMajorVersion
osvi
.
dwMinorVersion
)
;
}
else
{
int
res
=
strncpy_s
(
outbuf
outlen
"
unknown
"
strlen
(
"
unknown
"
)
)
;
if
(
res
!
=
0
)
{
return
0
;
}
written
=
strlen
(
"
unknown
"
)
;
}
return
min
(
written
(
int
)
outlen
-
1
)
;
}
int
get_build_number
(
)
{
OSVERSIONINFO
osvi
;
ZeroMemory
(
&
osvi
sizeof
(
osvi
)
)
;
osvi
.
dwOSVersionInfoSize
=
sizeof
(
osvi
)
;
if
(
GetVersionEx
(
&
osvi
)
)
{
return
osvi
.
dwBuildNumber
;
}
return
0
;
}
