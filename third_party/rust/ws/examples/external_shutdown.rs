extern
crate
ws
;
use
std
:
:
thread
;
use
std
:
:
time
:
:
Duration
;
use
std
:
:
sync
:
:
mpsc
:
:
channel
;
fn
main
(
)
{
let
(
tx
rx
)
=
channel
(
)
;
let
socket
=
ws
:
:
Builder
:
:
new
(
)
.
build
(
move
|
out
:
ws
:
:
Sender
|
{
tx
.
send
(
out
)
.
unwrap
(
)
;
move
|
_
|
Ok
(
println
!
(
"
Message
handler
called
.
"
)
)
}
)
.
unwrap
(
)
;
let
handle
=
socket
.
broadcaster
(
)
;
let
t
=
thread
:
:
spawn
(
move
|
|
{
socket
.
listen
(
"
127
.
0
.
0
.
1
:
3012
"
)
.
unwrap
(
)
;
}
)
;
thread
:
:
sleep
(
Duration
:
:
from_millis
(
5000
)
)
;
if
let
Err
(
_
)
=
rx
.
try_recv
(
)
{
handle
.
shutdown
(
)
.
unwrap
(
)
;
println
!
(
"
Shutting
down
server
because
no
connections
were
established
.
"
)
;
}
t
.
join
(
)
.
unwrap
(
)
;
}
