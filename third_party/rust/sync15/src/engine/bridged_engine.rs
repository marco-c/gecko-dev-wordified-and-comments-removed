use
crate
:
:
bso
:
:
{
IncomingBso
OutgoingBso
}
;
use
crate
:
:
Guid
;
pub
trait
BridgedEngine
{
type
Error
;
fn
last_sync
(
&
self
)
-
>
Result
<
i64
Self
:
:
Error
>
;
fn
set_last_sync
(
&
self
last_sync_millis
:
i64
)
-
>
Result
<
(
)
Self
:
:
Error
>
;
fn
sync_id
(
&
self
)
-
>
Result
<
Option
<
String
>
Self
:
:
Error
>
;
fn
reset_sync_id
(
&
self
)
-
>
Result
<
String
Self
:
:
Error
>
;
fn
ensure_current_sync_id
(
&
self
new_sync_id
:
&
str
)
-
>
Result
<
String
Self
:
:
Error
>
;
fn
prepare_for_sync
(
&
self
_client_data
:
&
str
)
-
>
Result
<
(
)
Self
:
:
Error
>
{
Ok
(
(
)
)
}
fn
sync_started
(
&
self
)
-
>
Result
<
(
)
Self
:
:
Error
>
;
fn
store_incoming
(
&
self
incoming_records
:
Vec
<
IncomingBso
>
)
-
>
Result
<
(
)
Self
:
:
Error
>
;
fn
apply
(
&
self
)
-
>
Result
<
ApplyResults
Self
:
:
Error
>
;
fn
set_uploaded
(
&
self
server_modified_millis
:
i64
ids
:
&
[
Guid
]
)
-
>
Result
<
(
)
Self
:
:
Error
>
;
fn
sync_finished
(
&
self
)
-
>
Result
<
(
)
Self
:
:
Error
>
;
fn
reset
(
&
self
)
-
>
Result
<
(
)
Self
:
:
Error
>
;
fn
wipe
(
&
self
)
-
>
Result
<
(
)
Self
:
:
Error
>
;
}
#
[
derive
(
Debug
Default
)
]
pub
struct
ApplyResults
{
pub
records
:
Vec
<
OutgoingBso
>
pub
num_reconciled
:
Option
<
usize
>
}
impl
ApplyResults
{
pub
fn
new
(
records
:
Vec
<
OutgoingBso
>
num_reconciled
:
impl
Into
<
Option
<
usize
>
>
)
-
>
Self
{
Self
{
records
num_reconciled
:
num_reconciled
.
into
(
)
}
}
}
impl
From
<
Vec
<
OutgoingBso
>
>
for
ApplyResults
{
fn
from
(
records
:
Vec
<
OutgoingBso
>
)
-
>
Self
{
Self
{
records
num_reconciled
:
None
}
}
}
