use
crate
:
:
runtime
:
:
context
;
use
std
:
:
future
:
:
Future
;
use
std
:
:
pin
:
:
Pin
;
use
std
:
:
task
:
:
{
ready
Context
Poll
}
;
#
[
cfg_attr
(
docsrs
doc
(
cfg
(
feature
=
"
rt
"
)
)
)
]
pub
async
fn
yield_now
(
)
{
struct
YieldNow
{
yielded
:
bool
}
impl
Future
for
YieldNow
{
type
Output
=
(
)
;
fn
poll
(
mut
self
:
Pin
<
&
mut
Self
>
cx
:
&
mut
Context
<
'
_
>
)
-
>
Poll
<
(
)
>
{
ready
!
(
crate
:
:
trace
:
:
trace_leaf
(
cx
)
)
;
if
self
.
yielded
{
return
Poll
:
:
Ready
(
(
)
)
;
}
self
.
yielded
=
true
;
context
:
:
defer
(
cx
.
waker
(
)
)
;
Poll
:
:
Pending
}
}
YieldNow
{
yielded
:
false
}
.
await
;
}
