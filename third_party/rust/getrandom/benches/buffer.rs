#
!
[
feature
(
test
maybe_uninit_uninit_array_transpose
)
]
extern
crate
test
;
use
std
:
:
mem
:
:
MaybeUninit
;
#
[
inline
(
always
)
]
fn
bench_getrandom
<
const
N
:
usize
>
(
)
{
let
mut
buf
=
[
0u8
;
N
]
;
getrandom
:
:
getrandom
(
&
mut
buf
)
.
unwrap
(
)
;
test
:
:
black_box
(
&
buf
as
&
[
u8
]
)
;
}
#
[
inline
(
always
)
]
fn
bench_getrandom_uninit
<
const
N
:
usize
>
(
)
{
let
mut
uninit
=
[
MaybeUninit
:
:
uninit
(
)
;
N
]
;
let
buf
:
&
[
u8
]
=
getrandom
:
:
getrandom_uninit
(
&
mut
uninit
)
.
unwrap
(
)
;
test
:
:
black_box
(
buf
)
;
}
macro_rules
!
bench
{
(
name
:
ident
size
:
expr
)
=
>
{
pub
mod
name
{
#
[
bench
]
pub
fn
bench_getrandom
(
b
:
&
mut
test
:
:
Bencher
)
{
#
[
inline
(
never
)
]
fn
inner
(
)
{
super
:
:
bench_getrandom
:
:
<
{
size
}
>
(
)
}
b
.
bytes
=
size
as
u64
;
b
.
iter
(
inner
)
;
}
#
[
bench
]
pub
fn
bench_getrandom_uninit
(
b
:
&
mut
test
:
:
Bencher
)
{
#
[
inline
(
never
)
]
fn
inner
(
)
{
super
:
:
bench_getrandom_uninit
:
:
<
{
size
}
>
(
)
}
b
.
bytes
=
size
as
u64
;
b
.
iter
(
inner
)
;
}
}
}
;
}
bench
!
(
aes128
128
/
8
)
;
bench
!
(
p256
256
/
8
)
;
bench
!
(
p384
384
/
8
)
;
bench
!
(
page
4096
)
;
