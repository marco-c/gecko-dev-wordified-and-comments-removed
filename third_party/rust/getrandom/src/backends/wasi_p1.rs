use
crate
:
:
Error
;
use
core
:
:
mem
:
:
MaybeUninit
;
pub
use
crate
:
:
util
:
:
{
inner_u32
inner_u64
}
;
#
[
link
(
wasm_import_module
=
"
wasi_snapshot_preview1
"
)
]
extern
"
C
"
{
fn
random_get
(
arg0
:
i32
arg1
:
i32
)
-
>
i32
;
}
const
MAX_ERROR_CODE
:
i32
=
u16
:
:
MAX
as
i32
;
#
[
inline
]
pub
fn
fill_inner
(
dest
:
&
mut
[
MaybeUninit
<
u8
>
]
)
-
>
Result
<
(
)
Error
>
{
#
[
allow
(
clippy
:
:
cast_possible_truncation
clippy
:
:
cast_possible_wrap
)
]
let
ret
=
unsafe
{
random_get
(
dest
.
as_mut_ptr
(
)
as
i32
dest
.
len
(
)
as
i32
)
}
;
match
ret
{
0
=
>
Ok
(
(
)
)
code
if
code
<
=
MAX_ERROR_CODE
=
>
Err
(
Error
:
:
from_neg_error_code
(
-
code
)
)
_
=
>
Err
(
Error
:
:
UNEXPECTED
)
}
}
