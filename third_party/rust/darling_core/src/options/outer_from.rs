use
syn
:
:
spanned
:
:
Spanned
;
use
syn
:
:
{
Field
Ident
Meta
}
;
use
crate
:
:
codegen
:
:
ForwardAttrs
;
use
crate
:
:
options
:
:
{
AttrsField
Core
DefaultExpression
ForwardAttrsFilter
ParseAttribute
ParseData
}
;
use
crate
:
:
util
:
:
PathList
;
use
crate
:
:
{
FromField
FromMeta
Result
}
;
#
[
derive
(
Debug
Clone
)
]
pub
struct
OuterFrom
{
pub
ident
:
Option
<
Ident
>
pub
attrs
:
Option
<
AttrsField
>
pub
container
:
Core
pub
attr_names
:
PathList
pub
forward_attrs
:
Option
<
ForwardAttrsFilter
>
pub
from_ident
:
bool
}
impl
OuterFrom
{
pub
fn
start
(
di
:
&
syn
:
:
DeriveInput
)
-
>
Result
<
Self
>
{
Ok
(
OuterFrom
{
container
:
Core
:
:
start
(
di
)
?
attrs
:
Default
:
:
default
(
)
ident
:
Default
:
:
default
(
)
attr_names
:
Default
:
:
default
(
)
forward_attrs
:
Default
:
:
default
(
)
from_ident
:
Default
:
:
default
(
)
}
)
}
pub
fn
as_forward_attrs
(
&
self
)
-
>
ForwardAttrs
<
'
_
>
{
ForwardAttrs
{
field
:
self
.
attrs
.
as_ref
(
)
filter
:
self
.
forward_attrs
.
as_ref
(
)
}
}
}
impl
ParseAttribute
for
OuterFrom
{
fn
parse_nested
(
&
mut
self
mi
:
&
Meta
)
-
>
Result
<
(
)
>
{
let
path
=
mi
.
path
(
)
;
if
path
.
is_ident
(
"
attributes
"
)
{
self
.
attr_names
=
FromMeta
:
:
from_meta
(
mi
)
?
;
}
else
if
path
.
is_ident
(
"
forward_attrs
"
)
{
self
.
forward_attrs
=
FromMeta
:
:
from_meta
(
mi
)
?
;
}
else
if
path
.
is_ident
(
"
from_ident
"
)
{
self
.
container
.
default
=
Some
(
DefaultExpression
:
:
Trait
{
span
:
path
.
span
(
)
}
)
;
self
.
from_ident
=
true
;
}
else
{
return
self
.
container
.
parse_nested
(
mi
)
;
}
Ok
(
(
)
)
}
}
impl
ParseData
for
OuterFrom
{
fn
parse_field
(
&
mut
self
field
:
&
Field
)
-
>
Result
<
(
)
>
{
match
field
.
ident
.
as_ref
(
)
.
map
(
|
v
|
v
.
to_string
(
)
)
.
as_deref
(
)
{
Some
(
"
ident
"
)
=
>
{
self
.
ident
.
clone_from
(
&
field
.
ident
)
;
Ok
(
(
)
)
}
Some
(
"
attrs
"
)
=
>
{
self
.
attrs
=
AttrsField
:
:
from_field
(
field
)
.
map
(
Some
)
?
;
Ok
(
(
)
)
}
_
=
>
self
.
container
.
parse_field
(
field
)
}
}
fn
validate_body
(
&
self
errors
:
&
mut
crate
:
:
error
:
:
Accumulator
)
{
self
.
container
.
validate_body
(
errors
)
;
}
}
