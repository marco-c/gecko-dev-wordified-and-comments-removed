use
std
:
:
fmt
;
use
std
:
:
os
:
:
raw
:
:
c_void
;
#
[
inline
(
never
)
]
pub
fn
trace
<
F
:
FnMut
(
&
Frame
)
-
>
bool
>
(
mut
cb
:
F
)
{
trace_imp
(
&
mut
cb
)
}
pub
struct
Frame
{
inner
:
FrameImp
}
impl
Frame
{
pub
fn
ip
(
&
self
)
-
>
*
mut
c_void
{
self
.
inner
.
ip
(
)
}
pub
fn
symbol_address
(
&
self
)
-
>
*
mut
c_void
{
self
.
inner
.
symbol_address
(
)
}
}
impl
fmt
:
:
Debug
for
Frame
{
fn
fmt
(
&
self
f
:
&
mut
fmt
:
:
Formatter
)
-
>
fmt
:
:
Result
{
f
.
debug_struct
(
"
Frame
"
)
.
field
(
"
ip
"
&
self
.
ip
(
)
)
.
field
(
"
symbol_address
"
&
self
.
symbol_address
(
)
)
.
finish
(
)
}
}
cfg_if
!
{
if
#
[
cfg
(
all
(
unix
not
(
target_os
=
"
emscripten
"
)
feature
=
"
libunwind
"
)
)
]
{
mod
libunwind
;
use
self
:
:
libunwind
:
:
trace
as
trace_imp
;
use
self
:
:
libunwind
:
:
Frame
as
FrameImp
;
}
else
if
#
[
cfg
(
all
(
unix
not
(
target_os
=
"
emscripten
"
)
feature
=
"
unix
-
backtrace
"
)
)
]
{
mod
unix_backtrace
;
use
self
:
:
unix_backtrace
:
:
trace
as
trace_imp
;
use
self
:
:
unix_backtrace
:
:
Frame
as
FrameImp
;
}
else
if
#
[
cfg
(
all
(
windows
feature
=
"
dbghelp
"
)
)
]
{
mod
dbghelp
;
use
self
:
:
dbghelp
:
:
trace
as
trace_imp
;
use
self
:
:
dbghelp
:
:
Frame
as
FrameImp
;
}
else
{
mod
noop
;
use
self
:
:
noop
:
:
trace
as
trace_imp
;
use
self
:
:
noop
:
:
Frame
as
FrameImp
;
}
}
