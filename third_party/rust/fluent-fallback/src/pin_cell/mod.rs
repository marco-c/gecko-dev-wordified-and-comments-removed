#
!
[
deny
(
missing_docs
missing_debug_implementations
)
]
mod
pin_mut
;
mod
pin_ref
;
use
core
:
:
cell
:
:
{
BorrowMutError
RefCell
RefMut
}
;
use
core
:
:
pin
:
:
Pin
;
pub
use
pin_mut
:
:
PinMut
;
pub
use
pin_ref
:
:
PinRef
;
#
[
derive
(
Default
Clone
Ord
PartialOrd
Eq
PartialEq
Debug
)
]
pub
struct
PinCell
<
T
:
?
Sized
>
{
inner
:
RefCell
<
T
>
}
impl
<
T
>
PinCell
<
T
>
{
pub
const
fn
new
(
value
:
T
)
-
>
PinCell
<
T
>
{
PinCell
{
inner
:
RefCell
:
:
new
(
value
)
}
}
}
impl
<
T
:
?
Sized
>
PinCell
<
T
>
{
pub
fn
borrow_mut
(
self
:
Pin
<
&
Self
>
)
-
>
PinMut
<
'
_
T
>
{
self
.
try_borrow_mut
(
)
.
expect
(
"
already
borrowed
"
)
}
pub
fn
try_borrow_mut
<
'
a
>
(
self
:
Pin
<
&
'
a
Self
>
)
-
>
Result
<
PinMut
<
'
a
T
>
BorrowMutError
>
{
let
ref_mut
:
RefMut
<
'
a
T
>
=
Pin
:
:
get_ref
(
self
)
.
inner
.
try_borrow_mut
(
)
?
;
let
pin_ref_mut
:
Pin
<
RefMut
<
'
a
T
>
>
=
unsafe
{
Pin
:
:
new_unchecked
(
ref_mut
)
}
;
Ok
(
PinMut
{
inner
:
pin_ref_mut
}
)
}
}
impl
<
T
>
From
<
T
>
for
PinCell
<
T
>
{
fn
from
(
value
:
T
)
-
>
PinCell
<
T
>
{
PinCell
:
:
new
(
value
)
}
}
impl
<
T
>
From
<
RefCell
<
T
>
>
for
PinCell
<
T
>
{
fn
from
(
cell
:
RefCell
<
T
>
)
-
>
PinCell
<
T
>
{
PinCell
{
inner
:
cell
}
}
}
impl
<
T
>
From
<
PinCell
<
T
>
>
for
RefCell
<
T
>
{
fn
from
(
input
:
PinCell
<
T
>
)
-
>
Self
{
input
.
inner
}
}
