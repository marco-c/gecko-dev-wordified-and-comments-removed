use
std
:
:
collections
:
:
HashMap
;
use
chrono
:
:
prelude
:
:
{
DateTime
Utc
}
;
use
serde_json
:
:
{
self
Value
as
JsonValue
}
;
#
[
derive
(
PartialEq
Debug
Clone
)
]
pub
struct
PingRequest
{
pub
document_id
:
String
pub
path
:
String
pub
body
:
JsonValue
pub
headers
:
HashMap
<
&
'
static
str
String
>
}
impl
PingRequest
{
pub
fn
new
(
document_id
:
&
str
path
:
&
str
body
:
JsonValue
)
-
>
Self
{
Self
{
document_id
:
document_id
.
into
(
)
path
:
path
.
into
(
)
body
headers
:
Self
:
:
create_request_headers
(
)
}
}
pub
fn
is_deletion_request
(
&
self
)
-
>
bool
{
self
.
path
.
split
(
'
/
'
)
.
nth
(
3
)
.
map
(
|
url
|
url
=
=
"
deletion
-
request
"
)
.
unwrap_or
(
false
)
}
fn
create_request_headers
(
)
-
>
HashMap
<
&
'
static
str
String
>
{
let
mut
headers
=
HashMap
:
:
new
(
)
;
let
date
:
DateTime
<
Utc
>
=
Utc
:
:
now
(
)
;
headers
.
insert
(
"
Date
"
date
.
to_string
(
)
)
;
headers
.
insert
(
"
X
-
Client
-
Type
"
"
Glean
"
.
to_string
(
)
)
;
headers
.
insert
(
"
Content
-
Type
"
"
application
/
json
;
charset
=
utf
-
8
"
.
to_string
(
)
)
;
headers
.
insert
(
"
X
-
Client
-
Version
"
crate
:
:
GLEAN_VERSION
.
to_string
(
)
)
;
headers
}
}
