#
!
[
deny
(
missing_docs
)
]
#
!
[
deny
(
rustdoc
:
:
broken_intra_doc_links
)
]
cfg_if
:
:
cfg_if
!
{
if
#
[
cfg
(
any
(
target_os
=
"
macos
"
target_os
=
"
ios
"
)
)
]
{
mod
mac
;
use
mac
as
sys
;
}
else
if
#
[
cfg
(
any
(
target_os
=
"
linux
"
target_os
=
"
android
"
)
)
]
{
mod
linux
;
use
linux
as
sys
;
}
else
if
#
[
cfg
(
all
(
windows
feature
=
"
win10plus
"
)
)
]
{
mod
win10
;
use
win10
as
sys
;
}
else
if
#
[
cfg
(
windows
)
]
{
mod
win
;
use
win
as
sys
;
}
else
{
mod
fallback
;
use
fallback
as
sys
;
}
}
pub
fn
now
(
)
-
>
u64
{
sys
:
:
now_including_suspend
(
)
}
pub
fn
now_awake
(
)
-
>
u64
{
sys
:
:
now_awake
(
)
}
#
[
cfg
(
test
)
]
mod
test
{
use
super
:
:
*
;
use
std
:
:
thread
;
use
std
:
:
time
:
:
Duration
;
#
[
test
]
fn
order
(
)
{
let
ts1
=
now
(
)
;
thread
:
:
sleep
(
Duration
:
:
from_millis
(
2
)
)
;
let
ts2
=
now
(
)
;
assert
!
(
ts1
<
ts2
)
;
}
#
[
test
]
fn
awake_time_atleast_total_time
(
)
{
let
ts1
=
now
(
)
;
let
a_ts1
=
now_awake
(
)
;
thread
:
:
sleep
(
Duration
:
:
from_millis
(
2
)
)
;
let
ts2
=
now
(
)
;
let
a_ts2
=
now_awake
(
)
;
assert
!
(
ts1
<
ts2
)
;
assert
!
(
a_ts1
<
a_ts2
)
;
let
total_diff
=
Duration
:
:
from_nanos
(
ts2
-
ts1
)
;
let
awake_diff
=
Duration
:
:
from_nanos
(
a_ts2
-
a_ts1
)
;
assert
!
(
total_diff
.
as_millis
(
)
<
=
awake_diff
.
as_millis
(
)
"
total
:
{
:
?
}
awake
:
{
:
?
}
"
total_diff
awake_diff
)
;
}
}
