#
[
cfg
(
feature
=
"
stream
"
)
]
use
futures_core
:
:
Stream
;
use
crate
:
:
common
:
:
{
task
:
:
{
self
Poll
}
Pin
}
;
pub
trait
Accept
{
type
Conn
;
type
Error
;
fn
poll_accept
(
self
:
Pin
<
&
mut
Self
>
cx
:
&
mut
task
:
:
Context
<
'
_
>
)
-
>
Poll
<
Option
<
Result
<
Self
:
:
Conn
Self
:
:
Error
>
>
>
;
}
pub
fn
poll_fn
<
F
IO
E
>
(
func
:
F
)
-
>
impl
Accept
<
Conn
=
IO
Error
=
E
>
where
F
:
FnMut
(
&
mut
task
:
:
Context
<
'
_
>
)
-
>
Poll
<
Option
<
Result
<
IO
E
>
>
>
{
struct
PollFn
<
F
>
(
F
)
;
impl
<
F
IO
E
>
Accept
for
PollFn
<
F
>
where
F
:
FnMut
(
&
mut
task
:
:
Context
<
'
_
>
)
-
>
Poll
<
Option
<
Result
<
IO
E
>
>
>
{
type
Conn
=
IO
;
type
Error
=
E
;
fn
poll_accept
(
self
:
Pin
<
&
mut
Self
>
cx
:
&
mut
task
:
:
Context
<
'
_
>
)
-
>
Poll
<
Option
<
Result
<
Self
:
:
Conn
Self
:
:
Error
>
>
>
{
unsafe
{
(
self
.
get_unchecked_mut
(
)
.
0
)
(
cx
)
}
}
}
PollFn
(
func
)
}
#
[
cfg
(
feature
=
"
stream
"
)
]
pub
fn
from_stream
<
S
IO
E
>
(
stream
:
S
)
-
>
impl
Accept
<
Conn
=
IO
Error
=
E
>
where
S
:
Stream
<
Item
=
Result
<
IO
E
>
>
{
struct
FromStream
<
S
>
(
S
)
;
impl
<
S
IO
E
>
Accept
for
FromStream
<
S
>
where
S
:
Stream
<
Item
=
Result
<
IO
E
>
>
{
type
Conn
=
IO
;
type
Error
=
E
;
fn
poll_accept
(
self
:
Pin
<
&
mut
Self
>
cx
:
&
mut
task
:
:
Context
<
'
_
>
)
-
>
Poll
<
Option
<
Result
<
Self
:
:
Conn
Self
:
:
Error
>
>
>
{
unsafe
{
Pin
:
:
new_unchecked
(
&
mut
self
.
get_unchecked_mut
(
)
.
0
)
.
poll_next
(
cx
)
}
}
}
FromStream
(
stream
)
}
