#
[
macro_export
]
macro_rules
!
report_error
{
(
type_name
:
expr
(
arg
:
tt
)
*
)
=
>
{
let
message
=
std
:
:
format
!
(
(
arg
)
*
)
;
:
:
log
:
:
warn
!
(
"
report
{
}
:
{
}
"
type_name
message
)
;
crate
:
:
report_error
(
type_name
.
to_string
(
)
message
.
to_string
(
)
)
;
}
;
}
#
[
macro_export
]
macro_rules
!
trace_error
{
(
result
:
expr
)
=
>
{
{
let
result
=
result
;
if
let
Err
(
e
)
=
&
result
{
crate
:
:
breadcrumb
!
(
"
Saw
error
:
{
}
"
e
)
;
}
;
result
}
}
;
}
#
[
macro_export
]
macro_rules
!
breadcrumb
{
(
(
arg
:
tt
)
*
)
=
>
{
{
let
message
=
std
:
:
format
!
(
(
arg
)
*
)
;
:
:
log
:
:
info
!
(
"
breadcrumb
:
{
}
"
message
)
;
crate
:
:
report_breadcrumb
(
message
std
:
:
module_path
!
(
)
.
to_string
(
)
std
:
:
line
!
(
)
std
:
:
column
!
(
)
)
;
}
}
;
}
#
[
macro_export
]
macro_rules
!
handle_error
{
{
(
tt
:
tt
)
*
}
=
>
{
let
body
=
|
|
{
(
tt
)
*
}
;
let
result
:
Result
<
_
>
=
body
(
)
;
result
.
map_err
(
crate
:
:
convert_log_report_error
)
}
}
