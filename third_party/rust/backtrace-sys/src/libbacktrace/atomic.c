#
include
"
config
.
h
"
#
include
<
sys
/
types
.
h
>
#
include
"
backtrace
.
h
"
#
include
"
backtrace
-
supported
.
h
"
#
include
"
internal
.
h
"
#
if
!
defined
(
HAVE_ATOMIC_FUNCTIONS
)
&
&
defined
(
HAVE_SYNC_FUNCTIONS
)
void
*
backtrace_atomic_load_pointer
(
void
*
arg
)
{
void
*
*
pp
;
void
*
p
;
pp
=
(
void
*
*
)
arg
;
p
=
*
pp
;
while
(
!
__sync_bool_compare_and_swap
(
pp
p
p
)
)
p
=
*
pp
;
return
p
;
}
int
backtrace_atomic_load_int
(
int
*
p
)
{
int
i
;
i
=
*
p
;
while
(
!
__sync_bool_compare_and_swap
(
p
i
i
)
)
i
=
*
p
;
return
i
;
}
void
backtrace_atomic_store_pointer
(
void
*
arg
void
*
p
)
{
void
*
*
pp
;
void
*
old
;
pp
=
(
void
*
*
)
arg
;
old
=
*
pp
;
while
(
!
__sync_bool_compare_and_swap
(
pp
old
p
)
)
old
=
*
pp
;
}
void
backtrace_atomic_store_size_t
(
size_t
*
p
size_t
v
)
{
size_t
old
;
old
=
*
p
;
while
(
!
__sync_bool_compare_and_swap
(
p
old
v
)
)
old
=
*
p
;
}
void
backtrace_atomic_store_int
(
int
*
p
int
v
)
{
size_t
old
;
old
=
*
p
;
while
(
!
__sync_bool_compare_and_swap
(
p
old
v
)
)
old
=
*
p
;
}
#
endif
