use
core
:
:
u64
;
#
[
cfg_attr
(
all
(
test
assert_no_panic
)
no_panic
:
:
no_panic
)
]
pub
fn
fabs
(
x
:
f64
)
-
>
f64
{
llvm_intrinsically_optimized
!
{
#
[
cfg
(
target_arch
=
"
wasm32
"
)
]
{
return
unsafe
{
:
:
core
:
:
intrinsics
:
:
fabsf64
(
x
)
}
}
}
f64
:
:
from_bits
(
x
.
to_bits
(
)
&
(
u64
:
:
MAX
/
2
)
)
}
#
[
cfg
(
test
)
]
mod
tests
{
use
super
:
:
*
;
use
core
:
:
f64
:
:
*
;
#
[
test
]
fn
sanity_check
(
)
{
assert_eq
!
(
fabs
(
-
1
.
0
)
1
.
0
)
;
assert_eq
!
(
fabs
(
2
.
8
)
2
.
8
)
;
}
#
[
test
]
fn
spec_tests
(
)
{
assert
!
(
fabs
(
NAN
)
.
is_nan
(
)
)
;
for
f
in
[
0
.
0
-
0
.
0
]
.
iter
(
)
.
copied
(
)
{
assert_eq
!
(
fabs
(
f
)
0
.
0
)
;
}
for
f
in
[
INFINITY
NEG_INFINITY
]
.
iter
(
)
.
copied
(
)
{
assert_eq
!
(
fabs
(
f
)
INFINITY
)
;
}
}
}
