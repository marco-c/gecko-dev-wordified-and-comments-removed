use
core
:
:
{
fmt
ops
}
;
use
crate
:
:
lock
:
:
rank
:
:
LockRank
;
pub
struct
RankData
;
pub
struct
Mutex
<
T
>
(
parking_lot
:
:
Mutex
<
T
>
)
;
pub
struct
MutexGuard
<
'
a
T
>
(
parking_lot
:
:
MutexGuard
<
'
a
T
>
)
;
impl
<
T
>
Mutex
<
T
>
{
pub
fn
new
(
_rank
:
LockRank
value
:
T
)
-
>
Mutex
<
T
>
{
Mutex
(
parking_lot
:
:
Mutex
:
:
new
(
value
)
)
}
pub
fn
lock
(
&
self
)
-
>
MutexGuard
<
'
_
T
>
{
MutexGuard
(
self
.
0
.
lock
(
)
)
}
pub
fn
into_inner
(
self
)
-
>
T
{
self
.
0
.
into_inner
(
)
}
}
impl
<
'
a
T
>
ops
:
:
Deref
for
MutexGuard
<
'
a
T
>
{
type
Target
=
T
;
fn
deref
(
&
self
)
-
>
&
Self
:
:
Target
{
self
.
0
.
deref
(
)
}
}
impl
<
'
a
T
>
ops
:
:
DerefMut
for
MutexGuard
<
'
a
T
>
{
fn
deref_mut
(
&
mut
self
)
-
>
&
mut
Self
:
:
Target
{
self
.
0
.
deref_mut
(
)
}
}
impl
<
T
:
fmt
:
:
Debug
>
fmt
:
:
Debug
for
Mutex
<
T
>
{
fn
fmt
(
&
self
f
:
&
mut
fmt
:
:
Formatter
<
'
_
>
)
-
>
fmt
:
:
Result
{
self
.
0
.
fmt
(
f
)
}
}
pub
struct
RwLock
<
T
>
(
parking_lot
:
:
RwLock
<
T
>
)
;
pub
struct
RwLockReadGuard
<
'
a
T
>
(
parking_lot
:
:
RwLockReadGuard
<
'
a
T
>
)
;
pub
struct
RwLockWriteGuard
<
'
a
T
>
(
parking_lot
:
:
RwLockWriteGuard
<
'
a
T
>
)
;
impl
<
T
>
RwLock
<
T
>
{
pub
fn
new
(
_rank
:
LockRank
value
:
T
)
-
>
RwLock
<
T
>
{
RwLock
(
parking_lot
:
:
RwLock
:
:
new
(
value
)
)
}
pub
fn
read
(
&
self
)
-
>
RwLockReadGuard
<
'
_
T
>
{
RwLockReadGuard
(
self
.
0
.
read
(
)
)
}
pub
fn
write
(
&
self
)
-
>
RwLockWriteGuard
<
'
_
T
>
{
RwLockWriteGuard
(
self
.
0
.
write
(
)
)
}
pub
unsafe
fn
force_unlock_read
(
&
self
_data
:
RankData
)
{
unsafe
{
self
.
0
.
force_unlock_read
(
)
}
;
}
}
impl
<
'
a
T
>
RwLockReadGuard
<
'
a
T
>
{
pub
fn
forget
(
this
:
Self
)
-
>
RankData
{
core
:
:
mem
:
:
forget
(
this
.
0
)
;
RankData
}
}
impl
<
'
a
T
>
RwLockWriteGuard
<
'
a
T
>
{
pub
fn
downgrade
(
this
:
Self
)
-
>
RwLockReadGuard
<
'
a
T
>
{
RwLockReadGuard
(
parking_lot
:
:
RwLockWriteGuard
:
:
downgrade
(
this
.
0
)
)
}
}
impl
<
T
:
fmt
:
:
Debug
>
fmt
:
:
Debug
for
RwLock
<
T
>
{
fn
fmt
(
&
self
f
:
&
mut
fmt
:
:
Formatter
<
'
_
>
)
-
>
fmt
:
:
Result
{
self
.
0
.
fmt
(
f
)
}
}
impl
<
'
a
T
>
ops
:
:
Deref
for
RwLockReadGuard
<
'
a
T
>
{
type
Target
=
T
;
fn
deref
(
&
self
)
-
>
&
Self
:
:
Target
{
self
.
0
.
deref
(
)
}
}
impl
<
'
a
T
>
ops
:
:
Deref
for
RwLockWriteGuard
<
'
a
T
>
{
type
Target
=
T
;
fn
deref
(
&
self
)
-
>
&
Self
:
:
Target
{
self
.
0
.
deref
(
)
}
}
impl
<
'
a
T
>
ops
:
:
DerefMut
for
RwLockWriteGuard
<
'
a
T
>
{
fn
deref_mut
(
&
mut
self
)
-
>
&
mut
Self
:
:
Target
{
self
.
0
.
deref_mut
(
)
}
}
