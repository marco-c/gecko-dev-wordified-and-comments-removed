use
std
:
:
convert
:
:
{
TryFrom
TryInto
}
;
use
super
:
:
{
Authority
Parts
PathAndQuery
Scheme
}
;
use
crate
:
:
Uri
;
#
[
derive
(
Debug
)
]
pub
struct
Builder
{
parts
:
Result
<
Parts
crate
:
:
Error
>
}
impl
Builder
{
#
[
inline
]
pub
fn
new
(
)
-
>
Builder
{
Builder
:
:
default
(
)
}
pub
fn
scheme
<
T
>
(
self
scheme
:
T
)
-
>
Self
where
Scheme
:
TryFrom
<
T
>
<
Scheme
as
TryFrom
<
T
>
>
:
:
Error
:
Into
<
crate
:
:
Error
>
{
self
.
map
(
move
|
mut
parts
|
{
let
scheme
=
scheme
.
try_into
(
)
.
map_err
(
Into
:
:
into
)
?
;
parts
.
scheme
=
Some
(
scheme
)
;
Ok
(
parts
)
}
)
}
pub
fn
authority
<
T
>
(
self
auth
:
T
)
-
>
Self
where
Authority
:
TryFrom
<
T
>
<
Authority
as
TryFrom
<
T
>
>
:
:
Error
:
Into
<
crate
:
:
Error
>
{
self
.
map
(
move
|
mut
parts
|
{
let
auth
=
auth
.
try_into
(
)
.
map_err
(
Into
:
:
into
)
?
;
parts
.
authority
=
Some
(
auth
)
;
Ok
(
parts
)
}
)
}
pub
fn
path_and_query
<
T
>
(
self
p_and_q
:
T
)
-
>
Self
where
PathAndQuery
:
TryFrom
<
T
>
<
PathAndQuery
as
TryFrom
<
T
>
>
:
:
Error
:
Into
<
crate
:
:
Error
>
{
self
.
map
(
move
|
mut
parts
|
{
let
p_and_q
=
p_and_q
.
try_into
(
)
.
map_err
(
Into
:
:
into
)
?
;
parts
.
path_and_query
=
Some
(
p_and_q
)
;
Ok
(
parts
)
}
)
}
pub
fn
build
(
self
)
-
>
Result
<
Uri
crate
:
:
Error
>
{
let
parts
=
self
.
parts
?
;
Uri
:
:
from_parts
(
parts
)
.
map_err
(
Into
:
:
into
)
}
fn
map
<
F
>
(
self
func
:
F
)
-
>
Self
where
F
:
FnOnce
(
Parts
)
-
>
Result
<
Parts
crate
:
:
Error
>
{
Builder
{
parts
:
self
.
parts
.
and_then
(
func
)
}
}
}
impl
Default
for
Builder
{
#
[
inline
]
fn
default
(
)
-
>
Builder
{
Builder
{
parts
:
Ok
(
Parts
:
:
default
(
)
)
}
}
}
