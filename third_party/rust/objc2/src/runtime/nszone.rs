use
core
:
:
fmt
;
use
core
:
:
panic
:
:
{
RefUnwindSafe
UnwindSafe
}
;
#
[
cfg
(
feature
=
"
gnustep
-
1
-
7
"
)
]
use
crate
:
:
encode
:
:
Encode
;
use
crate
:
:
encode
:
:
{
Encoding
RefEncode
}
;
use
crate
:
:
ffi
;
#
[
repr
(
C
)
]
pub
struct
NSZone
{
_priv
:
[
u8
;
0
]
_inner
:
ffi
:
:
OpaqueData
}
impl
fmt
:
:
Debug
for
NSZone
{
fn
fmt
(
&
self
f
:
&
mut
fmt
:
:
Formatter
<
'
_
>
)
-
>
fmt
:
:
Result
{
write
!
(
f
"
<
NSZone
{
self
:
p
}
>
"
)
}
}
impl
UnwindSafe
for
NSZone
{
}
impl
RefUnwindSafe
for
NSZone
{
}
unsafe
impl
RefEncode
for
NSZone
{
#
[
cfg
(
not
(
feature
=
"
gnustep
-
1
-
7
"
)
)
]
const
ENCODING_REF
:
Encoding
=
Encoding
:
:
Pointer
(
&
Encoding
:
:
Struct
(
"
_NSZone
"
&
[
]
)
)
;
#
[
cfg
(
feature
=
"
gnustep
-
1
-
7
"
)
]
const
ENCODING_REF
:
Encoding
=
Encoding
:
:
Pointer
(
&
Encoding
:
:
Struct
(
"
_NSZone
"
&
[
Encoding
:
:
Pointer
(
&
Encoding
:
:
Unknown
)
Encoding
:
:
Pointer
(
&
Encoding
:
:
Unknown
)
Encoding
:
:
Pointer
(
&
Encoding
:
:
Unknown
)
Encoding
:
:
Pointer
(
&
Encoding
:
:
Unknown
)
Encoding
:
:
Pointer
(
&
Encoding
:
:
Unknown
)
Encoding
:
:
Pointer
(
&
Encoding
:
:
Unknown
)
Encoding
:
:
Pointer
(
&
Encoding
:
:
Unknown
)
usize
:
:
ENCODING
Encoding
:
:
Object
Encoding
:
:
Pointer
(
&
Encoding
:
:
Struct
(
"
_NSZone
"
&
[
]
)
)
]
)
)
;
}
#
[
cfg
(
test
)
]
mod
tests
{
use
alloc
:
:
string
:
:
ToString
;
use
core
:
:
ptr
;
use
super
:
:
*
;
use
crate
:
:
msg_send
;
use
crate
:
:
rc
:
:
Allocated
;
use
crate
:
:
runtime
:
:
NSObject
;
use
crate
:
:
ClassType
;
#
[
test
]
fn
alloc_with_zone
(
)
{
let
zone
:
*
const
NSZone
=
ptr
:
:
null
(
)
;
let
_obj
:
Allocated
<
NSObject
>
=
unsafe
{
msg_send
!
[
NSObject
:
:
class
(
)
allocWithZone
:
zone
]
}
;
}
#
[
test
]
fn
verify_encoding
(
)
{
let
expected
=
if
cfg
!
(
all
(
feature
=
"
gnustep
-
1
-
7
"
target_pointer_width
=
"
64
"
)
)
{
"
^
{
_NSZone
=
^
?
^
?
^
?
^
?
^
?
^
?
^
?
Q
^
{
_NSZone
}
}
"
}
else
if
cfg
!
(
all
(
feature
=
"
gnustep
-
1
-
7
"
not
(
target_pointer_width
=
"
64
"
)
)
)
{
"
^
{
_NSZone
=
^
?
^
?
^
?
^
?
^
?
^
?
^
?
I
^
{
_NSZone
}
}
"
}
else
{
"
^
{
_NSZone
=
}
"
}
;
assert_eq
!
(
NSZone
:
:
ENCODING_REF
.
to_string
(
)
expected
)
;
}
}
