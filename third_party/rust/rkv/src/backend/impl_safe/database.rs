use
id_arena
:
:
Id
;
use
serde_derive
:
:
{
Deserialize
Serialize
}
;
use
super
:
:
snapshot
:
:
Snapshot
;
use
super
:
:
DatabaseFlagsImpl
;
use
crate
:
:
backend
:
:
traits
:
:
BackendDatabase
;
pub
type
DatabaseId
=
Id
<
DatabaseImpl
>
;
impl
BackendDatabase
for
DatabaseId
{
}
#
[
derive
(
Debug
Serialize
Deserialize
)
]
pub
struct
DatabaseImpl
{
snapshot
:
Snapshot
}
impl
DatabaseImpl
{
pub
(
crate
)
fn
new
(
flags
:
Option
<
DatabaseFlagsImpl
>
snapshot
:
Option
<
Snapshot
>
)
-
>
DatabaseImpl
{
DatabaseImpl
{
snapshot
:
snapshot
.
unwrap_or_else
(
|
|
Snapshot
:
:
new
(
flags
)
)
}
}
pub
(
crate
)
fn
snapshot
(
&
self
)
-
>
Snapshot
{
self
.
snapshot
.
clone
(
)
}
pub
(
crate
)
fn
replace
(
&
mut
self
snapshot
:
Snapshot
)
-
>
Snapshot
{
std
:
:
mem
:
:
replace
(
&
mut
self
.
snapshot
snapshot
)
}
}
