use
std
:
:
{
env
fs
:
:
File
io
:
:
Write
path
:
:
Path
}
;
use
sha1
:
:
{
Digest
as
_
Sha1
}
;
pub
fn
write_item_to_fuzzing_corpus
(
target
:
&
str
data
:
&
[
u8
]
)
{
let
corpus
=
Path
:
:
new
(
&
env
:
:
var
(
"
NEQO_CORPUS
"
)
.
unwrap_or_else
(
|
_
|
"
.
.
/
fuzz
/
corpus
"
.
to_string
(
)
)
)
.
join
(
target
)
;
if
!
corpus
.
exists
(
)
{
std
:
:
fs
:
:
create_dir_all
(
&
corpus
)
.
expect
(
"
failed
to
create
corpus
directory
"
)
;
}
let
mut
hasher
=
Sha1
:
:
new
(
)
;
hasher
.
update
(
data
)
;
let
item_name
=
hex
:
:
encode
(
hasher
.
finalize
(
)
)
;
let
item_path
=
corpus
.
join
(
item_name
)
;
if
item_path
.
exists
(
)
{
return
;
}
let
mut
file
=
File
:
:
create
(
item_path
)
.
expect
(
"
failed
to
create
corpus
item
"
)
;
Write
:
:
write_all
(
&
mut
file
data
)
.
expect
(
"
failed
to
write
to
corpus
item
"
)
;
}
