use
std
:
:
{
env
process
:
:
Command
str
}
;
fn
main
(
)
{
let
compiler
=
match
rustc_version
(
)
{
Some
(
compiler
)
=
>
compiler
None
=
>
return
}
;
if
compiler
.
minor
>
=
44
{
println
!
(
"
cargo
:
rustc
-
cfg
=
path_buf_capacity
"
)
;
}
if
compiler
.
minor
>
=
56
{
println
!
(
"
cargo
:
rustc
-
cfg
=
shrink_to
"
)
;
}
if
(
compiler
.
minor
>
=
63
&
&
(
compiler
.
channel
=
=
ReleaseChannel
:
:
Stable
|
|
compiler
.
channel
=
=
ReleaseChannel
:
:
Beta
)
)
|
|
compiler
.
minor
>
=
64
{
println
!
(
"
cargo
:
rustc
-
cfg
=
try_reserve_2
"
)
;
}
}
struct
Compiler
{
minor
:
u32
channel
:
ReleaseChannel
}
#
[
derive
(
Clone
Copy
Debug
Eq
PartialEq
)
]
enum
ReleaseChannel
{
Stable
Beta
Nightly
}
fn
rustc_version
(
)
-
>
Option
<
Compiler
>
{
let
rustc
=
env
:
:
var_os
(
"
RUSTC
"
)
?
;
let
output
=
Command
:
:
new
(
rustc
)
.
arg
(
"
-
-
version
"
)
.
output
(
)
.
ok
(
)
?
;
let
version
=
str
:
:
from_utf8
(
&
output
.
stdout
)
.
ok
(
)
?
;
let
mut
pieces
=
version
.
split
(
'
.
'
)
;
if
pieces
.
next
(
)
!
=
Some
(
"
rustc
1
"
)
{
return
None
;
}
let
minor
=
pieces
.
next
(
)
?
.
parse
(
)
.
ok
(
)
?
;
let
channel
=
if
version
.
contains
(
"
nightly
"
)
{
ReleaseChannel
:
:
Nightly
}
else
if
version
.
contains
(
"
beta
"
)
{
ReleaseChannel
:
:
Beta
}
else
{
ReleaseChannel
:
:
Stable
}
;
Some
(
Compiler
{
minor
channel
}
)
}
