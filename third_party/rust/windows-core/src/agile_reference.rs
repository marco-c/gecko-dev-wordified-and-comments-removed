use
super
:
:
*
;
use
core
:
:
marker
:
:
PhantomData
;
#
[
repr
(
transparent
)
]
#
[
derive
(
Clone
PartialEq
Eq
)
]
pub
struct
AgileReference
<
T
>
(
imp
:
:
IAgileReference
PhantomData
<
T
>
)
;
impl
<
T
:
Interface
>
AgileReference
<
T
>
{
pub
fn
new
(
object
:
&
T
)
-
>
Result
<
Self
>
{
assert
!
(
T
:
:
UNKNOWN
)
;
unsafe
{
imp
:
:
RoGetAgileReference
(
imp
:
:
AGILEREFERENCE_DEFAULT
&
T
:
:
IID
core
:
:
mem
:
:
transmute
:
:
<
&
T
&
IUnknown
>
(
object
)
)
.
map
(
|
reference
|
Self
(
reference
Default
:
:
default
(
)
)
)
}
}
pub
fn
resolve
(
&
self
)
-
>
Result
<
T
>
{
unsafe
{
self
.
0
.
Resolve
(
)
}
}
}
unsafe
impl
<
T
:
Interface
>
Send
for
AgileReference
<
T
>
{
}
unsafe
impl
<
T
:
Interface
>
Sync
for
AgileReference
<
T
>
{
}
impl
<
T
>
core
:
:
fmt
:
:
Debug
for
AgileReference
<
T
>
{
fn
fmt
(
&
self
f
:
&
mut
core
:
:
fmt
:
:
Formatter
<
'
_
>
)
-
>
core
:
:
fmt
:
:
Result
{
write
!
(
f
"
AgileReference
(
{
:
?
}
)
"
&
self
.
0
)
}
}
