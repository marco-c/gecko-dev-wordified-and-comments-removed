use
std
:
:
time
:
:
SystemTime
;
use
util
:
:
HttpDate
;
#
[
derive
(
Debug
Clone
Copy
PartialEq
Eq
PartialOrd
Ord
Hash
Header
)
]
pub
struct
IfUnmodifiedSince
(
HttpDate
)
;
impl
IfUnmodifiedSince
{
pub
fn
precondition_passes
(
&
self
last_modified
:
SystemTime
)
-
>
bool
{
self
.
0
>
=
last_modified
.
into
(
)
}
}
impl
From
<
SystemTime
>
for
IfUnmodifiedSince
{
fn
from
(
time
:
SystemTime
)
-
>
IfUnmodifiedSince
{
IfUnmodifiedSince
(
time
.
into
(
)
)
}
}
impl
From
<
IfUnmodifiedSince
>
for
SystemTime
{
fn
from
(
date
:
IfUnmodifiedSince
)
-
>
SystemTime
{
date
.
0
.
into
(
)
}
}
#
[
cfg
(
test
)
]
mod
tests
{
use
std
:
:
time
:
:
Duration
;
use
super
:
:
*
;
#
[
test
]
fn
precondition_passes
(
)
{
let
newer
=
SystemTime
:
:
now
(
)
;
let
exact
=
newer
-
Duration
:
:
from_secs
(
2
)
;
let
older
=
newer
-
Duration
:
:
from_secs
(
4
)
;
let
if_unmod
=
IfUnmodifiedSince
:
:
from
(
exact
)
;
assert
!
(
!
if_unmod
.
precondition_passes
(
newer
)
)
;
assert
!
(
if_unmod
.
precondition_passes
(
exact
)
)
;
assert
!
(
if_unmod
.
precondition_passes
(
older
)
)
;
}
}
