#
include
"
.
.
/
miniz_tinfl
.
h
"
#
ifdef
__cplusplus
extern
"
C
"
{
#
endif
#
define
TINFL_MEMCPY
(
d
s
l
)
memcpy
(
d
s
l
)
#
define
TINFL_MEMSET
(
p
c
l
)
memset
(
p
c
l
)
tinfl_status
tinfl_decompress
(
tinfl_decompressor
*
r
const
mz_uint8
*
pIn_buf_next
size_t
*
pIn_buf_size
mz_uint8
*
pOut_buf_start
mz_uint8
*
pOut_buf_next
size_t
*
pOut_buf_size
const
mz_uint32
decomp_flags
)
;
void
*
tinfl_decompress_mem_to_heap
(
const
void
*
pSrc_buf
size_t
src_buf_len
size_t
*
pOut_len
int
flags
)
;
size_t
tinfl_decompress_mem_to_mem
(
void
*
pOut_buf
size_t
out_buf_len
const
void
*
pSrc_buf
size_t
src_buf_len
int
flags
)
;
int
tinfl_decompress_mem_to_callback
(
const
void
*
pIn_buf
size_t
*
pIn_buf_size
tinfl_put_buf_func_ptr
pPut_buf_func
void
*
pPut_buf_user
int
flags
)
{
int
result
=
0
;
tinfl_decompressor
decomp
;
mz_uint8
*
pDict
=
(
mz_uint8
*
)
MZ_MALLOC
(
TINFL_LZ_DICT_SIZE
)
;
size_t
in_buf_ofs
=
0
dict_ofs
=
0
;
if
(
!
pDict
)
return
TINFL_STATUS_FAILED
;
tinfl_init
(
&
decomp
)
;
for
(
;
;
)
{
size_t
in_buf_size
=
*
pIn_buf_size
-
in_buf_ofs
dst_buf_size
=
TINFL_LZ_DICT_SIZE
-
dict_ofs
;
tinfl_status
status
=
tinfl_decompress
(
&
decomp
(
const
mz_uint8
*
)
pIn_buf
+
in_buf_ofs
&
in_buf_size
pDict
pDict
+
dict_ofs
&
dst_buf_size
(
flags
&
~
(
TINFL_FLAG_HAS_MORE_INPUT
|
TINFL_FLAG_USING_NON_WRAPPING_OUTPUT_BUF
)
)
)
;
in_buf_ofs
+
=
in_buf_size
;
if
(
(
dst_buf_size
)
&
&
(
!
(
*
pPut_buf_func
)
(
pDict
+
dict_ofs
(
int
)
dst_buf_size
pPut_buf_user
)
)
)
break
;
if
(
status
!
=
TINFL_STATUS_HAS_MORE_OUTPUT
)
{
result
=
(
status
=
=
TINFL_STATUS_DONE
)
;
break
;
}
dict_ofs
=
(
dict_ofs
+
dst_buf_size
)
&
(
TINFL_LZ_DICT_SIZE
-
1
)
;
}
MZ_FREE
(
pDict
)
;
*
pIn_buf_size
=
in_buf_ofs
;
return
result
;
}
tinfl_decompressor
*
tinfl_decompressor_alloc
(
)
{
tinfl_decompressor
*
pDecomp
=
(
tinfl_decompressor
*
)
MZ_MALLOC
(
sizeof
(
tinfl_decompressor
)
)
;
if
(
pDecomp
)
tinfl_init
(
pDecomp
)
;
return
pDecomp
;
}
void
tinfl_decompressor_free
(
tinfl_decompressor
*
pDecomp
)
{
MZ_FREE
(
pDecomp
)
;
}
#
ifdef
__cplusplus
}
#
endif
