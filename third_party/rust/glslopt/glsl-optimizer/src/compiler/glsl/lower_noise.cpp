#
include
"
ir
.
h
"
#
include
"
ir_rvalue_visitor
.
h
"
class
lower_noise_visitor
:
public
ir_rvalue_visitor
{
public
:
lower_noise_visitor
(
)
:
progress
(
false
)
{
}
void
handle_rvalue
(
ir_rvalue
*
*
rvalue
)
{
if
(
!
*
rvalue
)
return
;
ir_expression
*
expr
=
(
*
rvalue
)
-
>
as_expression
(
)
;
if
(
!
expr
)
return
;
if
(
expr
-
>
operation
=
=
ir_unop_noise
)
{
*
rvalue
=
ir_constant
:
:
zero
(
ralloc_parent
(
expr
)
expr
-
>
type
)
;
this
-
>
progress
=
true
;
}
}
bool
progress
;
}
;
bool
lower_noise
(
exec_list
*
instructions
)
{
lower_noise_visitor
v
;
visit_list_elements
(
&
v
instructions
)
;
return
v
.
progress
;
}
