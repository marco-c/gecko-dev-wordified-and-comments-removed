#
include
"
ir
.
h
"
#
include
"
ir_visitor
.
h
"
#
include
"
ir_optimization
.
h
"
void
optimize_dead_builtin_variables
(
exec_list
*
instructions
enum
ir_variable_mode
other
)
{
foreach_in_list_safe
(
ir_variable
var
instructions
)
{
if
(
var
-
>
ir_type
!
=
ir_type_variable
|
|
var
-
>
data
.
used
)
continue
;
if
(
var
-
>
data
.
mode
!
=
ir_var_uniform
&
&
var
-
>
data
.
mode
!
=
ir_var_auto
&
&
var
-
>
data
.
mode
!
=
ir_var_system_value
&
&
var
-
>
data
.
mode
!
=
other
)
continue
;
if
(
(
var
-
>
data
.
mode
=
=
other
|
|
var
-
>
data
.
mode
=
=
ir_var_system_value
)
&
&
var
-
>
data
.
how_declared
!
=
ir_var_declared_implicitly
)
continue
;
if
(
!
is_gl_identifier
(
var
-
>
name
)
)
continue
;
if
(
strcmp
(
var
-
>
name
"
gl_ModelViewProjectionMatrix
"
)
=
=
0
|
|
strcmp
(
var
-
>
name
"
gl_Vertex
"
)
=
=
0
|
|
strstr
(
var
-
>
name
"
Transpose
"
)
!
=
NULL
)
continue
;
var
-
>
remove
(
)
;
}
}
