use
crate
:
:
stdlib
:
:
pin
:
:
Pin
;
use
crate
:
:
stdlib
:
:
task
:
:
{
Context
Poll
}
;
use
crate
:
:
stdlib
:
:
{
future
:
:
Future
marker
:
:
Sized
}
;
use
crate
:
:
{
dispatcher
:
:
{
self
Dispatch
}
span
:
:
Span
}
;
use
pin_project_lite
:
:
pin_project
;
pub
trait
Instrument
:
Sized
{
fn
instrument
(
self
span
:
Span
)
-
>
Instrumented
<
Self
>
{
Instrumented
{
inner
:
self
span
}
}
#
[
inline
]
fn
in_current_span
(
self
)
-
>
Instrumented
<
Self
>
{
self
.
instrument
(
Span
:
:
current
(
)
)
}
}
#
[
cfg_attr
(
docsrs
doc
(
cfg
(
feature
=
"
std
"
)
)
)
]
pub
trait
WithSubscriber
:
Sized
{
fn
with_subscriber
<
S
>
(
self
subscriber
:
S
)
-
>
WithDispatch
<
Self
>
where
S
:
Into
<
Dispatch
>
{
WithDispatch
{
inner
:
self
dispatcher
:
subscriber
.
into
(
)
}
}
#
[
inline
]
fn
with_current_subscriber
(
self
)
-
>
WithDispatch
<
Self
>
{
WithDispatch
{
inner
:
self
dispatcher
:
crate
:
:
dispatcher
:
:
get_default
(
|
default
|
default
.
clone
(
)
)
}
}
}
pin_project
!
{
/
/
/
A
[
Future
]
that
has
been
instrumented
with
a
tracing
[
Subscriber
]
.
/
/
/
/
/
/
This
type
is
returned
by
the
[
WithSubscriber
]
extension
trait
.
See
that
/
/
/
trait
'
s
documentation
for
details
.
/
/
/
/
/
/
[
Future
]
:
std
:
:
future
:
:
Future
/
/
/
[
Subscriber
]
:
crate
:
:
Subscriber
#
[
derive
(
Clone
Debug
)
]
#
[
must_use
=
"
futures
do
nothing
unless
you
.
await
or
poll
them
"
]
#
[
cfg_attr
(
docsrs
doc
(
cfg
(
feature
=
"
std
"
)
)
)
]
pub
struct
WithDispatch
<
T
>
{
#
[
pin
]
inner
:
T
dispatcher
:
Dispatch
}
}
pin_project
!
{
/
/
/
A
[
Future
]
that
has
been
instrumented
with
a
tracing
[
Span
]
.
/
/
/
/
/
/
This
type
is
returned
by
the
[
Instrument
]
extension
trait
.
See
that
/
/
/
trait
'
s
documentation
for
details
.
/
/
/
/
/
/
[
Future
]
:
std
:
:
future
:
:
Future
/
/
/
[
Span
]
:
crate
:
:
Span
#
[
derive
(
Debug
Clone
)
]
#
[
must_use
=
"
futures
do
nothing
unless
you
.
await
or
poll
them
"
]
pub
struct
Instrumented
<
T
>
{
#
[
pin
]
inner
:
T
span
:
Span
}
}
impl
<
T
:
Future
>
Future
for
Instrumented
<
T
>
{
type
Output
=
T
:
:
Output
;
fn
poll
(
self
:
Pin
<
&
mut
Self
>
cx
:
&
mut
Context
<
'
_
>
)
-
>
Poll
<
Self
:
:
Output
>
{
let
this
=
self
.
project
(
)
;
let
_enter
=
this
.
span
.
enter
(
)
;
this
.
inner
.
poll
(
cx
)
}
}
impl
<
T
:
Sized
>
Instrument
for
T
{
}
impl
<
T
>
Instrumented
<
T
>
{
pub
fn
span
(
&
self
)
-
>
&
Span
{
&
self
.
span
}
pub
fn
span_mut
(
&
mut
self
)
-
>
&
mut
Span
{
&
mut
self
.
span
}
pub
fn
inner
(
&
self
)
-
>
&
T
{
&
self
.
inner
}
pub
fn
inner_mut
(
&
mut
self
)
-
>
&
mut
T
{
&
mut
self
.
inner
}
pub
fn
inner_pin_ref
(
self
:
Pin
<
&
Self
>
)
-
>
Pin
<
&
T
>
{
self
.
project_ref
(
)
.
inner
}
pub
fn
inner_pin_mut
(
self
:
Pin
<
&
mut
Self
>
)
-
>
Pin
<
&
mut
T
>
{
self
.
project
(
)
.
inner
}
pub
fn
into_inner
(
self
)
-
>
T
{
self
.
inner
}
}
#
[
cfg
(
feature
=
"
std
"
)
]
#
[
cfg_attr
(
docsrs
doc
(
cfg
(
feature
=
"
std
"
)
)
)
]
impl
<
T
:
Future
>
Future
for
WithDispatch
<
T
>
{
type
Output
=
T
:
:
Output
;
fn
poll
(
self
:
Pin
<
&
mut
Self
>
cx
:
&
mut
Context
<
'
_
>
)
-
>
Poll
<
Self
:
:
Output
>
{
let
this
=
self
.
project
(
)
;
let
dispatcher
=
this
.
dispatcher
;
let
future
=
this
.
inner
;
let
_default
=
dispatcher
:
:
set_default
(
dispatcher
)
;
future
.
poll
(
cx
)
}
}
#
[
cfg_attr
(
docsrs
doc
(
cfg
(
feature
=
"
std
"
)
)
)
]
impl
<
T
:
Sized
>
WithSubscriber
for
T
{
}
#
[
cfg
(
feature
=
"
std
"
)
]
#
[
cfg_attr
(
docsrs
doc
(
cfg
(
feature
=
"
std
"
)
)
)
]
impl
<
T
>
WithDispatch
<
T
>
{
pub
fn
dispatcher
(
&
self
)
-
>
&
Dispatch
{
&
self
.
dispatcher
}
pub
fn
inner
(
&
self
)
-
>
&
T
{
&
self
.
inner
}
pub
fn
inner_mut
(
&
mut
self
)
-
>
&
mut
T
{
&
mut
self
.
inner
}
pub
fn
inner_pin_ref
(
self
:
Pin
<
&
Self
>
)
-
>
Pin
<
&
T
>
{
self
.
project_ref
(
)
.
inner
}
pub
fn
inner_pin_mut
(
self
:
Pin
<
&
mut
Self
>
)
-
>
Pin
<
&
mut
T
>
{
self
.
project
(
)
.
inner
}
pub
fn
into_inner
(
self
)
-
>
T
{
self
.
inner
}
}
