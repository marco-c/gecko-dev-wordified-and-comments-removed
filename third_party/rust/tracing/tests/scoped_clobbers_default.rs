#
!
[
cfg
(
feature
=
"
std
"
)
]
use
tracing_mock
:
:
{
expect
subscriber
}
;
#
[
test
]
fn
scoped_clobbers_global
(
)
{
let
(
scoped
scoped_handle
)
=
subscriber
:
:
mock
(
)
.
event
(
expect
:
:
event
(
)
.
with_fields
(
expect
:
:
msg
(
"
before
global
"
)
)
)
.
event
(
expect
:
:
event
(
)
.
with_fields
(
expect
:
:
msg
(
"
before
drop
"
)
)
)
.
only
(
)
.
run_with_handle
(
)
;
let
(
global
global_handle
)
=
subscriber
:
:
mock
(
)
.
event
(
expect
:
:
event
(
)
.
with_fields
(
expect
:
:
msg
(
"
after
drop
"
)
)
)
.
only
(
)
.
run_with_handle
(
)
;
let
guard
=
tracing
:
:
subscriber
:
:
set_default
(
scoped
)
;
tracing
:
:
info
!
(
"
before
global
"
)
;
tracing
:
:
subscriber
:
:
set_global_default
(
global
)
.
expect
(
"
global
default
should
not
already
be
set
"
)
;
tracing
:
:
info
!
(
"
before
drop
"
)
;
drop
(
guard
)
;
tracing
:
:
info
!
(
"
after
drop
"
)
;
scoped_handle
.
assert_finished
(
)
;
global_handle
.
assert_finished
(
)
;
}
