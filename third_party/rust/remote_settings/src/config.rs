use
url
:
:
Url
;
use
crate
:
:
{
ApiResult
Error
RemoteSettingsContext
Result
}
;
#
[
derive
(
Debug
Clone
uniffi
:
:
Record
)
]
pub
struct
RemoteSettingsConfig2
{
#
[
uniffi
(
default
=
None
)
]
pub
server
:
Option
<
RemoteSettingsServer
>
#
[
uniffi
(
default
=
None
)
]
pub
bucket_name
:
Option
<
String
>
#
[
uniffi
(
default
=
None
)
]
pub
app_context
:
Option
<
RemoteSettingsContext
>
}
#
[
derive
(
Debug
Clone
uniffi
:
:
Record
)
]
pub
struct
RemoteSettingsConfig
{
pub
collection_name
:
String
#
[
uniffi
(
default
=
None
)
]
pub
bucket_name
:
Option
<
String
>
#
[
uniffi
(
default
=
None
)
]
pub
server_url
:
Option
<
String
>
#
[
uniffi
(
default
=
None
)
]
pub
server
:
Option
<
RemoteSettingsServer
>
}
#
[
derive
(
Debug
Clone
uniffi
:
:
Enum
)
]
pub
enum
RemoteSettingsServer
{
Prod
Stage
Dev
Custom
{
url
:
String
}
}
impl
RemoteSettingsServer
{
#
[
error_support
:
:
handle_error
(
Error
)
]
pub
fn
url
(
&
self
)
-
>
ApiResult
<
Url
>
{
self
.
get_url
(
)
}
pub
fn
get_url_with_prod_fallback
(
&
self
)
-
>
Url
{
match
self
.
get_url
(
)
{
Ok
(
url
)
=
>
url
Err
(
_
)
=
>
{
log
:
:
warn
!
(
"
Invalid
Custom
URL
:
{
}
"
self
.
raw_url
(
)
)
;
Self
:
:
Prod
.
get_url
(
)
.
unwrap
(
)
}
}
}
fn
raw_url
(
&
self
)
-
>
&
str
{
match
self
{
Self
:
:
Prod
=
>
"
https
:
/
/
firefox
.
settings
.
services
.
mozilla
.
com
/
v1
"
Self
:
:
Stage
=
>
"
https
:
/
/
firefox
.
settings
.
services
.
allizom
.
org
/
v1
"
Self
:
:
Dev
=
>
"
https
:
/
/
remote
-
settings
-
dev
.
allizom
.
org
/
v1
"
Self
:
:
Custom
{
url
}
=
>
url
}
}
pub
fn
get_url
(
&
self
)
-
>
Result
<
Url
>
{
Ok
(
match
self
{
Self
:
:
Prod
=
>
Url
:
:
parse
(
"
https
:
/
/
firefox
.
settings
.
services
.
mozilla
.
com
/
v1
"
)
?
Self
:
:
Stage
=
>
Url
:
:
parse
(
"
https
:
/
/
firefox
.
settings
.
services
.
allizom
.
org
/
v1
"
)
?
Self
:
:
Dev
=
>
Url
:
:
parse
(
"
https
:
/
/
remote
-
settings
-
dev
.
allizom
.
org
/
v1
"
)
?
Self
:
:
Custom
{
url
}
=
>
{
let
mut
url
=
Url
:
:
parse
(
url
)
?
;
if
url
.
scheme
(
)
!
=
"
file
"
{
url
=
url
.
join
(
"
v1
"
)
?
}
url
}
}
)
}
}
