use
core
:
:
marker
:
:
PhantomData
;
use
serde
:
:
ser
:
:
Error
as
_
;
use
serde
:
:
{
Deserializer
Serialize
Serializer
}
;
use
super
:
:
Visitor
;
use
crate
:
:
format_description
:
:
well_known
:
:
Rfc3339
;
use
crate
:
:
OffsetDateTime
;
pub
fn
serialize
<
S
:
Serializer
>
(
datetime
:
&
OffsetDateTime
serializer
:
S
)
-
>
Result
<
S
:
:
Ok
S
:
:
Error
>
{
datetime
.
format
(
&
Rfc3339
)
.
map_err
(
S
:
:
Error
:
:
custom
)
?
.
serialize
(
serializer
)
}
pub
fn
deserialize
<
'
a
D
:
Deserializer
<
'
a
>
>
(
deserializer
:
D
)
-
>
Result
<
OffsetDateTime
D
:
:
Error
>
{
deserializer
.
deserialize_any
(
Visitor
:
:
<
Rfc3339
>
(
PhantomData
)
)
}
pub
mod
option
{
#
[
allow
(
clippy
:
:
wildcard_imports
)
]
use
super
:
:
*
;
pub
fn
serialize
<
S
:
Serializer
>
(
option
:
&
Option
<
OffsetDateTime
>
serializer
:
S
)
-
>
Result
<
S
:
:
Ok
S
:
:
Error
>
{
option
.
map
(
|
odt
|
odt
.
format
(
&
Rfc3339
)
)
.
transpose
(
)
.
map_err
(
S
:
:
Error
:
:
custom
)
?
.
serialize
(
serializer
)
}
pub
fn
deserialize
<
'
a
D
:
Deserializer
<
'
a
>
>
(
deserializer
:
D
)
-
>
Result
<
Option
<
OffsetDateTime
>
D
:
:
Error
>
{
deserializer
.
deserialize_option
(
Visitor
:
:
<
Option
<
Rfc3339
>
>
(
PhantomData
)
)
}
}
