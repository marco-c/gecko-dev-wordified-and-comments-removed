use
crate
:
:
isa
:
:
TargetIsa
;
use
crate
:
:
settings
:
:
LibcallCallConv
;
use
core
:
:
fmt
;
use
core
:
:
str
;
use
target_lexicon
:
:
{
CallingConvention
Triple
}
;
#
[
derive
(
Debug
Copy
Clone
PartialEq
Eq
Hash
)
]
pub
enum
CallConv
{
Fast
Cold
SystemV
WindowsFastcall
BaldrdashSystemV
BaldrdashWindows
Probestack
}
impl
CallConv
{
pub
fn
triple_default
(
triple
:
&
Triple
)
-
>
Self
{
match
triple
.
default_calling_convention
(
)
{
Ok
(
CallingConvention
:
:
SystemV
)
|
Err
(
(
)
)
=
>
CallConv
:
:
SystemV
Ok
(
CallingConvention
:
:
WindowsFastcall
)
=
>
CallConv
:
:
WindowsFastcall
Ok
(
unimp
)
=
>
unimplemented
!
(
"
calling
convention
:
{
:
?
}
"
unimp
)
}
}
pub
fn
for_libcall
(
isa
:
&
dyn
TargetIsa
)
-
>
Self
{
match
isa
.
flags
(
)
.
libcall_call_conv
(
)
{
LibcallCallConv
:
:
IsaDefault
=
>
isa
.
default_call_conv
(
)
LibcallCallConv
:
:
Fast
=
>
CallConv
:
:
Fast
LibcallCallConv
:
:
Cold
=
>
CallConv
:
:
Cold
LibcallCallConv
:
:
SystemV
=
>
CallConv
:
:
SystemV
LibcallCallConv
:
:
WindowsFastcall
=
>
CallConv
:
:
WindowsFastcall
LibcallCallConv
:
:
BaldrdashSystemV
=
>
CallConv
:
:
BaldrdashSystemV
LibcallCallConv
:
:
BaldrdashWindows
=
>
CallConv
:
:
BaldrdashWindows
LibcallCallConv
:
:
Probestack
=
>
CallConv
:
:
Probestack
}
}
pub
fn
extends_windows_fastcall
(
&
self
)
-
>
bool
{
match
self
{
CallConv
:
:
WindowsFastcall
|
CallConv
:
:
BaldrdashWindows
=
>
true
_
=
>
false
}
}
pub
fn
extends_baldrdash
(
&
self
)
-
>
bool
{
match
self
{
CallConv
:
:
BaldrdashSystemV
|
CallConv
:
:
BaldrdashWindows
=
>
true
_
=
>
false
}
}
}
impl
fmt
:
:
Display
for
CallConv
{
fn
fmt
(
&
self
f
:
&
mut
fmt
:
:
Formatter
)
-
>
fmt
:
:
Result
{
f
.
write_str
(
match
*
self
{
CallConv
:
:
Fast
=
>
"
fast
"
CallConv
:
:
Cold
=
>
"
cold
"
CallConv
:
:
SystemV
=
>
"
system_v
"
CallConv
:
:
WindowsFastcall
=
>
"
windows_fastcall
"
CallConv
:
:
BaldrdashSystemV
=
>
"
baldrdash_system_v
"
CallConv
:
:
BaldrdashWindows
=
>
"
baldrdash_windows
"
CallConv
:
:
Probestack
=
>
"
probestack
"
}
)
}
}
impl
str
:
:
FromStr
for
CallConv
{
type
Err
=
(
)
;
fn
from_str
(
s
:
&
str
)
-
>
Result
<
Self
Self
:
:
Err
>
{
match
s
{
"
fast
"
=
>
Ok
(
CallConv
:
:
Fast
)
"
cold
"
=
>
Ok
(
CallConv
:
:
Cold
)
"
system_v
"
=
>
Ok
(
CallConv
:
:
SystemV
)
"
windows_fastcall
"
=
>
Ok
(
CallConv
:
:
WindowsFastcall
)
"
baldrdash_system_v
"
=
>
Ok
(
CallConv
:
:
BaldrdashSystemV
)
"
baldrdash_windows
"
=
>
Ok
(
CallConv
:
:
BaldrdashWindows
)
"
probestack
"
=
>
Ok
(
CallConv
:
:
Probestack
)
_
=
>
Err
(
(
)
)
}
}
}
