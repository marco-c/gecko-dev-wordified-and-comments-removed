pub
use
cranelift_codegen_shared
:
:
constant_hash
:
:
*
;
pub
trait
Table
<
K
:
Copy
+
Eq
>
{
fn
len
(
&
self
)
-
>
usize
;
fn
key
(
&
self
idx
:
usize
)
-
>
Option
<
K
>
;
}
pub
fn
probe
<
K
:
Copy
+
Eq
T
:
Table
<
K
>
+
?
Sized
>
(
table
:
&
T
key
:
K
hash
:
usize
)
-
>
Result
<
usize
usize
>
{
debug_assert
!
(
table
.
len
(
)
.
is_power_of_two
(
)
)
;
let
mask
=
table
.
len
(
)
-
1
;
let
mut
idx
=
hash
;
let
mut
step
=
0
;
loop
{
idx
&
=
mask
;
match
table
.
key
(
idx
)
{
None
=
>
return
Err
(
idx
)
Some
(
k
)
if
k
=
=
key
=
>
return
Ok
(
idx
)
_
=
>
{
}
}
step
+
=
1
;
debug_assert
!
(
step
<
table
.
len
(
)
)
;
idx
+
=
step
;
}
}
