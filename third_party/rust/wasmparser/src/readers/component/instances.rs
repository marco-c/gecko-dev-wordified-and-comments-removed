use
crate
:
:
{
BinaryReader
ComponentExport
ComponentExternalKind
Export
Result
SectionIteratorLimited
SectionReader
SectionWithLimitedItems
}
;
use
std
:
:
ops
:
:
Range
;
#
[
derive
(
Debug
Copy
Clone
PartialEq
Eq
)
]
pub
enum
InstantiationArgKind
{
Instance
}
#
[
derive
(
Debug
Clone
)
]
pub
struct
InstantiationArg
<
'
a
>
{
pub
name
:
&
'
a
str
pub
kind
:
InstantiationArgKind
pub
index
:
u32
}
#
[
derive
(
Debug
Clone
)
]
pub
enum
Instance
<
'
a
>
{
Instantiate
{
module_index
:
u32
args
:
Box
<
[
InstantiationArg
<
'
a
>
]
>
}
FromExports
(
Box
<
[
Export
<
'
a
>
]
>
)
}
#
[
derive
(
Clone
)
]
pub
struct
InstanceSectionReader
<
'
a
>
{
reader
:
BinaryReader
<
'
a
>
count
:
u32
}
impl
<
'
a
>
InstanceSectionReader
<
'
a
>
{
pub
fn
new
(
data
:
&
'
a
[
u8
]
offset
:
usize
)
-
>
Result
<
Self
>
{
let
mut
reader
=
BinaryReader
:
:
new_with_offset
(
data
offset
)
;
let
count
=
reader
.
read_var_u32
(
)
?
;
Ok
(
Self
{
reader
count
}
)
}
pub
fn
original_position
(
&
self
)
-
>
usize
{
self
.
reader
.
original_position
(
)
}
pub
fn
get_count
(
&
self
)
-
>
u32
{
self
.
count
}
pub
fn
read
(
&
mut
self
)
-
>
Result
<
Instance
<
'
a
>
>
{
self
.
reader
.
read_instance
(
)
}
}
impl
<
'
a
>
SectionReader
for
InstanceSectionReader
<
'
a
>
{
type
Item
=
Instance
<
'
a
>
;
fn
read
(
&
mut
self
)
-
>
Result
<
Self
:
:
Item
>
{
Self
:
:
read
(
self
)
}
fn
eof
(
&
self
)
-
>
bool
{
self
.
reader
.
eof
(
)
}
fn
original_position
(
&
self
)
-
>
usize
{
Self
:
:
original_position
(
self
)
}
fn
range
(
&
self
)
-
>
Range
<
usize
>
{
self
.
reader
.
range
(
)
}
}
impl
<
'
a
>
SectionWithLimitedItems
for
InstanceSectionReader
<
'
a
>
{
fn
get_count
(
&
self
)
-
>
u32
{
Self
:
:
get_count
(
self
)
}
}
impl
<
'
a
>
IntoIterator
for
InstanceSectionReader
<
'
a
>
{
type
Item
=
Result
<
Instance
<
'
a
>
>
;
type
IntoIter
=
SectionIteratorLimited
<
Self
>
;
fn
into_iter
(
self
)
-
>
Self
:
:
IntoIter
{
SectionIteratorLimited
:
:
new
(
self
)
}
}
#
[
derive
(
Debug
Clone
)
]
pub
struct
ComponentInstantiationArg
<
'
a
>
{
pub
name
:
&
'
a
str
pub
kind
:
ComponentExternalKind
pub
index
:
u32
}
#
[
derive
(
Debug
Clone
)
]
pub
enum
ComponentInstance
<
'
a
>
{
Instantiate
{
component_index
:
u32
args
:
Box
<
[
ComponentInstantiationArg
<
'
a
>
]
>
}
FromExports
(
Box
<
[
ComponentExport
<
'
a
>
]
>
)
}
#
[
derive
(
Clone
)
]
pub
struct
ComponentInstanceSectionReader
<
'
a
>
{
reader
:
BinaryReader
<
'
a
>
count
:
u32
}
impl
<
'
a
>
ComponentInstanceSectionReader
<
'
a
>
{
pub
fn
new
(
data
:
&
'
a
[
u8
]
offset
:
usize
)
-
>
Result
<
Self
>
{
let
mut
reader
=
BinaryReader
:
:
new_with_offset
(
data
offset
)
;
let
count
=
reader
.
read_var_u32
(
)
?
;
Ok
(
Self
{
reader
count
}
)
}
pub
fn
original_position
(
&
self
)
-
>
usize
{
self
.
reader
.
original_position
(
)
}
pub
fn
get_count
(
&
self
)
-
>
u32
{
self
.
count
}
pub
fn
read
(
&
mut
self
)
-
>
Result
<
ComponentInstance
<
'
a
>
>
{
self
.
reader
.
read_component_instance
(
)
}
}
impl
<
'
a
>
SectionReader
for
ComponentInstanceSectionReader
<
'
a
>
{
type
Item
=
ComponentInstance
<
'
a
>
;
fn
read
(
&
mut
self
)
-
>
Result
<
Self
:
:
Item
>
{
Self
:
:
read
(
self
)
}
fn
eof
(
&
self
)
-
>
bool
{
self
.
reader
.
eof
(
)
}
fn
original_position
(
&
self
)
-
>
usize
{
Self
:
:
original_position
(
self
)
}
fn
range
(
&
self
)
-
>
Range
<
usize
>
{
self
.
reader
.
range
(
)
}
}
impl
<
'
a
>
SectionWithLimitedItems
for
ComponentInstanceSectionReader
<
'
a
>
{
fn
get_count
(
&
self
)
-
>
u32
{
Self
:
:
get_count
(
self
)
}
}
impl
<
'
a
>
IntoIterator
for
ComponentInstanceSectionReader
<
'
a
>
{
type
Item
=
Result
<
ComponentInstance
<
'
a
>
>
;
type
IntoIter
=
SectionIteratorLimited
<
Self
>
;
fn
into_iter
(
self
)
-
>
Self
:
:
IntoIter
{
SectionIteratorLimited
:
:
new
(
self
)
}
}
