extern
crate
nix
;
extern
crate
tempfile
;
#
[
test
]
#
[
should_panic
(
expected
=
"
Dropped
an
in
-
progress
AioCb
"
)
]
#
[
cfg
(
all
(
not
(
target_env
=
"
musl
"
)
any
(
target_os
=
"
linux
"
target_os
=
"
ios
"
target_os
=
"
macos
"
target_os
=
"
freebsd
"
target_os
=
"
netbsd
"
)
)
)
]
fn
test_drop
(
)
{
use
nix
:
:
sys
:
:
aio
:
:
*
;
use
nix
:
:
sys
:
:
signal
:
:
*
;
use
std
:
:
os
:
:
unix
:
:
io
:
:
AsRawFd
;
use
tempfile
:
:
tempfile
;
const
WBUF
:
&
[
u8
]
=
b
"
CDEF
"
;
let
f
=
tempfile
(
)
.
unwrap
(
)
;
f
.
set_len
(
6
)
.
unwrap
(
)
;
let
mut
aiocb
=
AioCb
:
:
from_slice
(
f
.
as_raw_fd
(
)
2
WBUF
0
SigevNotify
:
:
SigevNone
LioOpcode
:
:
LIO_NOP
)
;
aiocb
.
write
(
)
.
unwrap
(
)
;
}
