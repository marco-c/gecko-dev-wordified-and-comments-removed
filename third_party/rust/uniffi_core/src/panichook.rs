#
[
cfg
(
feature
=
"
log_panics
"
)
]
pub
fn
ensure_setup
(
)
{
use
std
:
:
sync
:
:
Once
;
static
INIT_BACKTRACES
:
Once
=
Once
:
:
new
(
)
;
INIT_BACKTRACES
.
call_once
(
move
|
|
{
#
[
cfg
(
all
(
feature
=
"
log_backtraces
"
not
(
target_os
=
"
android
"
)
)
)
]
{
std
:
:
env
:
:
set_var
(
"
RUST_BACKTRACE
"
"
1
"
)
;
}
std
:
:
panic
:
:
set_hook
(
Box
:
:
new
(
move
|
panic_info
|
{
let
(
file
line
)
=
if
let
Some
(
loc
)
=
panic_info
.
location
(
)
{
(
loc
.
file
(
)
loc
.
line
(
)
)
}
else
{
(
"
<
unknown
>
"
0
)
}
;
log
:
:
error
!
(
"
#
#
#
Rust
panic
!
hit
at
file
'
{
file
}
'
line
{
line
}
"
)
;
#
[
cfg
(
all
(
feature
=
"
log_backtraces
"
not
(
target_os
=
"
android
"
)
)
)
]
{
log
:
:
error
!
(
"
Complete
stack
trace
:
\
n
{
:
?
}
"
backtrace
:
:
Backtrace
:
:
new
(
)
)
;
}
}
)
)
;
}
)
;
}
#
[
cfg
(
not
(
feature
=
"
log_panics
"
)
)
]
pub
fn
ensure_setup
(
)
{
}
