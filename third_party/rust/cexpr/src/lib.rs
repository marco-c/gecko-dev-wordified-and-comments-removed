#
[
macro_use
]
extern
crate
nom
as
nom_crate
;
pub
mod
nom
{
pub
use
nom_crate
:
:
{
IResult
Needed
Err
ErrorKind
}
;
}
pub
mod
literal
;
pub
mod
expr
;
pub
mod
token
;
use
nom
:
:
*
;
#
[
derive
(
Debug
)
]
pub
enum
Error
{
ExactToken
(
token
:
:
Kind
&
'
static
[
u8
]
)
TypedToken
(
token
:
:
Kind
)
UnknownIdentifier
InvalidLiteral
Partial
}
macro_rules
!
identity
(
(
i
:
expr
e
:
expr
)
=
>
(
e
)
;
)
;
pub
fn
assert_full_parse
<
I
O
E
>
(
result
:
IResult
<
&
[
I
]
O
E
>
)
-
>
IResult
<
&
[
I
]
O
:
:
Error
>
{
match
fix_error
!
(
(
)
:
:
Error
identity
!
(
result
)
)
{
IResult
:
:
Done
(
rem
output
)
=
>
if
rem
.
len
(
)
=
=
0
{
IResult
:
:
Done
(
rem
output
)
}
else
{
IResult
:
:
Error
(
Err
:
:
Position
(
ErrorKind
:
:
Custom
(
:
:
Error
:
:
Partial
)
rem
)
)
}
r
=
>
r
}
}
