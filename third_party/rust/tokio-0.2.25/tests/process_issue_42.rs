#
!
[
warn
(
rust_2018_idioms
)
]
#
!
[
cfg
(
feature
=
"
full
"
)
]
#
!
[
cfg
(
unix
)
]
use
futures
:
:
future
:
:
join_all
;
use
std
:
:
process
:
:
Stdio
;
use
tokio
:
:
process
:
:
Command
;
use
tokio
:
:
task
;
#
[
tokio
:
:
test
]
async
fn
issue_42
(
)
{
let
join_handles
=
(
0
.
.
10usize
)
.
map
(
|
_
|
{
task
:
:
spawn
(
async
{
let
processes
=
(
0
.
.
10usize
)
.
map
(
|
i
|
{
Command
:
:
new
(
"
echo
"
)
.
arg
(
format
!
(
"
I
am
spawned
process
#
{
}
"
i
)
)
.
stdin
(
Stdio
:
:
null
(
)
)
.
stdout
(
Stdio
:
:
null
(
)
)
.
stderr
(
Stdio
:
:
null
(
)
)
.
kill_on_drop
(
true
)
.
spawn
(
)
.
unwrap
(
)
}
)
;
join_all
(
processes
)
.
await
;
}
)
}
)
;
join_all
(
join_handles
)
.
await
;
}
