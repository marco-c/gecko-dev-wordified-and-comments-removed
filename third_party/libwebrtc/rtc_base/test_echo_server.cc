#
include
"
rtc_base
/
test_echo_server
.
h
"
#
include
"
rtc_base
/
socket_server
.
h
"
namespace
rtc
{
TestEchoServer
:
:
TestEchoServer
(
Thread
*
thread
const
SocketAddress
&
addr
)
:
server_socket_
(
thread
-
>
socketserver
(
)
-
>
CreateAsyncSocket
(
addr
.
family
(
)
SOCK_STREAM
)
)
{
server_socket_
-
>
Bind
(
addr
)
;
server_socket_
-
>
Listen
(
5
)
;
server_socket_
-
>
SignalReadEvent
.
connect
(
this
&
TestEchoServer
:
:
OnAccept
)
;
}
TestEchoServer
:
:
~
TestEchoServer
(
)
{
for
(
ClientList
:
:
iterator
it
=
client_sockets_
.
begin
(
)
;
it
!
=
client_sockets_
.
end
(
)
;
+
+
it
)
{
delete
*
it
;
}
}
}
