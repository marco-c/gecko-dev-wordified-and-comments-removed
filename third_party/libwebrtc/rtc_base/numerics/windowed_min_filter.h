#
ifndef
RTC_BASE_NUMERICS_WINDOWED_MIN_FILTER_H_
#
define
RTC_BASE_NUMERICS_WINDOWED_MIN_FILTER_H_
#
include
<
deque
>
#
include
"
rtc_base
/
checks
.
h
"
namespace
webrtc
{
template
<
typename
V
>
class
WindowedMinFilter
{
public
:
explicit
WindowedMinFilter
(
int
window_length
)
:
max_size_
(
window_length
)
{
RTC_DCHECK_GT
(
window_length
1
)
;
}
void
Insert
(
V
value
)
{
if
(
!
min_values_
.
empty
(
)
)
{
if
(
min_values_
.
front
(
)
.
index
=
=
index_
)
{
min_values_
.
pop_front
(
)
;
}
if
(
min_values_
.
front
(
)
.
value
>
=
value
)
{
min_values_
.
clear
(
)
;
}
else
{
while
(
min_values_
.
back
(
)
.
value
>
=
value
)
{
min_values_
.
pop_back
(
)
;
}
}
}
RTC_DCHECK_LT
(
min_values_
.
size
(
)
max_size_
)
;
min_values_
.
push_back
(
{
.
value
=
value
.
index
=
index_
}
)
;
index_
=
(
index_
+
1
)
%
max_size_
;
}
V
GetMin
(
)
const
{
if
(
min_values_
.
empty
(
)
)
{
return
V
(
)
;
}
return
min_values_
.
front
(
)
.
value
;
}
void
Reset
(
)
{
min_values_
.
clear
(
)
;
index_
=
0
;
}
private
:
const
int
max_size_
;
struct
ValueAndIndex
{
V
value
;
int
index
;
}
;
int
index_
=
0
;
std
:
:
deque
<
ValueAndIndex
>
min_values_
;
}
;
}
#
endif
