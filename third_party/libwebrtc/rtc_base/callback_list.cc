#
include
"
rtc_base
/
callback_list
.
h
"
#
include
"
rtc_base
/
checks
.
h
"
namespace
webrtc
{
namespace
callback_list_impl
{
CallbackListReceivers
:
:
CallbackListReceivers
(
)
=
default
;
CallbackListReceivers
:
:
~
CallbackListReceivers
(
)
{
RTC_CHECK
(
!
send_in_progress_
)
;
}
void
CallbackListReceivers
:
:
RemoveReceivers
(
const
void
*
removal_tag
)
{
RTC_CHECK
(
!
send_in_progress_
)
;
RTC_DCHECK
(
removal_tag
!
=
nullptr
)
;
size_t
first_todo
=
0
;
size_t
first_remove
=
receivers_
.
size
(
)
;
while
(
first_todo
!
=
first_remove
)
{
if
(
receivers_
[
first_todo
]
.
removal_tag
!
=
removal_tag
)
{
+
+
first_todo
;
}
else
if
(
receivers_
[
first_remove
-
1
]
.
removal_tag
=
=
removal_tag
)
{
-
-
first_remove
;
}
else
{
RTC_DCHECK_NE
(
first_todo
first_remove
-
1
)
;
using
std
:
:
swap
;
swap
(
receivers_
[
first_todo
]
receivers_
[
first_remove
-
1
]
)
;
RTC_DCHECK_NE
(
receivers_
[
first_todo
]
.
removal_tag
removal_tag
)
;
+
+
first_todo
;
RTC_DCHECK_EQ
(
receivers_
[
first_remove
-
1
]
.
removal_tag
removal_tag
)
;
-
-
first_remove
;
}
}
receivers_
.
resize
(
first_remove
)
;
}
void
CallbackListReceivers
:
:
Foreach
(
rtc
:
:
FunctionView
<
void
(
UntypedFunction
&
)
>
fv
)
{
RTC_CHECK
(
!
send_in_progress_
)
;
send_in_progress_
=
true
;
for
(
auto
&
r
:
receivers_
)
{
fv
(
r
.
function
)
;
}
send_in_progress_
=
false
;
}
template
void
CallbackListReceivers
:
:
AddReceiver
(
const
void
*
UntypedFunction
:
:
TrivialUntypedFunctionArgs
<
1
>
)
;
template
void
CallbackListReceivers
:
:
AddReceiver
(
const
void
*
UntypedFunction
:
:
TrivialUntypedFunctionArgs
<
2
>
)
;
template
void
CallbackListReceivers
:
:
AddReceiver
(
const
void
*
UntypedFunction
:
:
TrivialUntypedFunctionArgs
<
3
>
)
;
template
void
CallbackListReceivers
:
:
AddReceiver
(
const
void
*
UntypedFunction
:
:
TrivialUntypedFunctionArgs
<
4
>
)
;
template
void
CallbackListReceivers
:
:
AddReceiver
(
const
void
*
UntypedFunction
:
:
NontrivialUntypedFunctionArgs
)
;
template
void
CallbackListReceivers
:
:
AddReceiver
(
const
void
*
UntypedFunction
:
:
FunctionPointerUntypedFunctionArgs
)
;
template
void
CallbackListReceivers
:
:
AddReceiver
(
UntypedFunction
:
:
TrivialUntypedFunctionArgs
<
1
>
)
;
template
void
CallbackListReceivers
:
:
AddReceiver
(
UntypedFunction
:
:
TrivialUntypedFunctionArgs
<
2
>
)
;
template
void
CallbackListReceivers
:
:
AddReceiver
(
UntypedFunction
:
:
TrivialUntypedFunctionArgs
<
3
>
)
;
template
void
CallbackListReceivers
:
:
AddReceiver
(
UntypedFunction
:
:
TrivialUntypedFunctionArgs
<
4
>
)
;
template
void
CallbackListReceivers
:
:
AddReceiver
(
UntypedFunction
:
:
NontrivialUntypedFunctionArgs
)
;
template
void
CallbackListReceivers
:
:
AddReceiver
(
UntypedFunction
:
:
FunctionPointerUntypedFunctionArgs
)
;
}
}
