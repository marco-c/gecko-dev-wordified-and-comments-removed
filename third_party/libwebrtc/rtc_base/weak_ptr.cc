#
include
"
rtc_base
/
weak_ptr
.
h
"
namespace
webrtc
{
namespace
internal
{
void
WeakReference
:
:
Flag
:
:
Invalidate
(
)
{
RTC_DCHECK_RUN_ON
(
&
checker_
)
;
is_valid_
=
false
;
}
bool
WeakReference
:
:
Flag
:
:
IsValid
(
)
const
{
RTC_DCHECK_RUN_ON
(
&
checker_
)
;
return
is_valid_
;
}
WeakReference
:
:
WeakReference
(
)
{
}
WeakReference
:
:
WeakReference
(
const
RefCountedFlag
*
flag
)
:
flag_
(
flag
)
{
}
WeakReference
:
:
~
WeakReference
(
)
{
}
WeakReference
:
:
WeakReference
(
WeakReference
&
&
other
)
=
default
;
WeakReference
:
:
WeakReference
(
const
WeakReference
&
other
)
=
default
;
bool
WeakReference
:
:
is_valid
(
)
const
{
return
flag_
.
get
(
)
&
&
flag_
-
>
IsValid
(
)
;
}
WeakReferenceOwner
:
:
WeakReferenceOwner
(
)
{
}
WeakReferenceOwner
:
:
~
WeakReferenceOwner
(
)
{
Invalidate
(
)
;
}
WeakReference
WeakReferenceOwner
:
:
GetRef
(
)
const
{
if
(
!
HasRefs
(
)
)
flag_
=
new
WeakReference
:
:
RefCountedFlag
(
)
;
return
WeakReference
(
flag_
.
get
(
)
)
;
}
void
WeakReferenceOwner
:
:
Invalidate
(
)
{
if
(
flag_
.
get
(
)
)
{
flag_
-
>
Invalidate
(
)
;
flag_
=
nullptr
;
}
}
WeakPtrBase
:
:
WeakPtrBase
(
)
{
}
WeakPtrBase
:
:
~
WeakPtrBase
(
)
{
}
WeakPtrBase
:
:
WeakPtrBase
(
const
WeakReference
&
ref
)
:
ref_
(
ref
)
{
}
}
}
