#
include
"
rtc_base
/
ifaddrs_converter
.
h
"
#
include
"
rtc_base
/
ip_address
.
h
"
namespace
webrtc
{
IfAddrsConverter
:
:
IfAddrsConverter
(
)
{
}
IfAddrsConverter
:
:
~
IfAddrsConverter
(
)
{
}
bool
IfAddrsConverter
:
:
ConvertIfAddrsToIPAddress
(
const
struct
ifaddrs
*
interface
InterfaceAddress
*
ip
IPAddress
*
mask
)
{
switch
(
interface
-
>
ifa_addr
-
>
sa_family
)
{
case
AF_INET
:
{
*
ip
=
InterfaceAddress
(
IPAddress
(
reinterpret_cast
<
sockaddr_in
*
>
(
interface
-
>
ifa_addr
)
-
>
sin_addr
)
)
;
*
mask
=
IPAddress
(
reinterpret_cast
<
sockaddr_in
*
>
(
interface
-
>
ifa_netmask
)
-
>
sin_addr
)
;
return
true
;
}
case
AF_INET6
:
{
int
ip_attributes
=
webrtc
:
:
IPV6_ADDRESS_FLAG_NONE
;
if
(
!
ConvertNativeAttributesToIPAttributes
(
interface
&
ip_attributes
)
)
{
return
false
;
}
*
ip
=
InterfaceAddress
(
reinterpret_cast
<
sockaddr_in6
*
>
(
interface
-
>
ifa_addr
)
-
>
sin6_addr
ip_attributes
)
;
*
mask
=
IPAddress
(
reinterpret_cast
<
sockaddr_in6
*
>
(
interface
-
>
ifa_netmask
)
-
>
sin6_addr
)
;
return
true
;
}
default
:
{
return
false
;
}
}
}
bool
IfAddrsConverter
:
:
ConvertNativeAttributesToIPAttributes
(
const
struct
ifaddrs
*
int
*
ip_attributes
)
{
*
ip_attributes
=
webrtc
:
:
IPV6_ADDRESS_FLAG_NONE
;
return
true
;
}
#
if
!
defined
(
WEBRTC_MAC
)
IfAddrsConverter
*
CreateIfAddrsConverter
(
)
{
return
new
IfAddrsConverter
(
)
;
}
#
endif
}
