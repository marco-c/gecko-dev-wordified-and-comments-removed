#
ifndef
RTC_BASE_ROBO_CALLER_H_
#
define
RTC_BASE_ROBO_CALLER_H_
#
include
<
utility
>
#
include
<
vector
>
#
include
"
api
/
function_view
.
h
"
#
include
"
rtc_base
/
system
/
assume
.
h
"
#
include
"
rtc_base
/
system
/
inline
.
h
"
#
include
"
rtc_base
/
untyped_function
.
h
"
namespace
webrtc
{
namespace
robo_caller_impl
{
class
RoboCallerReceivers
{
public
:
RoboCallerReceivers
(
)
;
RoboCallerReceivers
(
const
RoboCallerReceivers
&
)
=
delete
;
RoboCallerReceivers
&
operator
=
(
const
RoboCallerReceivers
&
)
=
delete
;
RoboCallerReceivers
(
RoboCallerReceivers
&
&
)
=
delete
;
RoboCallerReceivers
&
operator
=
(
RoboCallerReceivers
&
&
)
=
delete
;
~
RoboCallerReceivers
(
)
;
template
<
typename
UntypedFunctionArgsT
>
RTC_NO_INLINE
void
AddReceiver
(
UntypedFunctionArgsT
args
)
{
receivers_
.
push_back
(
UntypedFunction
:
:
Create
(
args
)
)
;
}
void
Foreach
(
rtc
:
:
FunctionView
<
void
(
UntypedFunction
&
)
>
fv
)
;
private
:
std
:
:
vector
<
UntypedFunction
>
receivers_
;
}
;
extern
template
void
RoboCallerReceivers
:
:
AddReceiver
(
UntypedFunction
:
:
TrivialUntypedFunctionArgs
<
1
>
)
;
extern
template
void
RoboCallerReceivers
:
:
AddReceiver
(
UntypedFunction
:
:
TrivialUntypedFunctionArgs
<
2
>
)
;
extern
template
void
RoboCallerReceivers
:
:
AddReceiver
(
UntypedFunction
:
:
TrivialUntypedFunctionArgs
<
3
>
)
;
extern
template
void
RoboCallerReceivers
:
:
AddReceiver
(
UntypedFunction
:
:
TrivialUntypedFunctionArgs
<
4
>
)
;
extern
template
void
RoboCallerReceivers
:
:
AddReceiver
(
UntypedFunction
:
:
NontrivialUntypedFunctionArgs
)
;
extern
template
void
RoboCallerReceivers
:
:
AddReceiver
(
UntypedFunction
:
:
FunctionPointerUntypedFunctionArgs
)
;
}
template
<
typename
.
.
.
ArgT
>
class
RoboCaller
{
public
:
RoboCaller
(
)
=
default
;
RoboCaller
(
const
RoboCaller
&
)
=
delete
;
RoboCaller
&
operator
=
(
const
RoboCaller
&
)
=
delete
;
RoboCaller
(
RoboCaller
&
&
)
=
delete
;
RoboCaller
&
operator
=
(
RoboCaller
&
&
)
=
delete
;
template
<
typename
F
>
void
AddReceiver
(
F
&
&
f
)
{
receivers_
.
AddReceiver
(
UntypedFunction
:
:
PrepareArgs
<
void
(
ArgT
.
.
.
)
>
(
std
:
:
forward
<
F
>
(
f
)
)
)
;
}
template
<
typename
.
.
.
ArgU
>
void
Send
(
ArgU
&
&
.
.
.
args
)
{
receivers_
.
Foreach
(
[
&
]
(
UntypedFunction
&
f
)
{
f
.
Call
<
void
(
ArgT
.
.
.
)
>
(
std
:
:
forward
<
ArgU
>
(
args
)
.
.
.
)
;
}
)
;
}
private
:
robo_caller_impl
:
:
RoboCallerReceivers
receivers_
;
}
;
}
#
endif
