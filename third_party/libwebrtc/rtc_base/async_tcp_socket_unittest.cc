#
include
"
rtc_base
/
async_tcp_socket
.
h
"
#
include
<
memory
>
#
include
<
string
>
#
include
"
rtc_base
/
gunit
.
h
"
#
include
"
rtc_base
/
virtual_socket_server
.
h
"
namespace
webrtc
{
class
AsyncTCPSocketTest
:
public
:
:
testing
:
:
Test
public
sigslot
:
:
has_slots
<
>
{
public
:
AsyncTCPSocketTest
(
)
:
vss_
(
new
webrtc
:
:
VirtualSocketServer
(
)
)
socket_
(
vss_
-
>
CreateSocket
(
SOCK_STREAM
)
)
tcp_socket_
(
new
AsyncTCPSocket
(
socket_
true
)
)
ready_to_send_
(
false
)
{
tcp_socket_
-
>
SignalReadyToSend
.
connect
(
this
&
AsyncTCPSocketTest
:
:
OnReadyToSend
)
;
}
void
OnReadyToSend
(
webrtc
:
:
AsyncPacketSocket
*
socket
)
{
ready_to_send_
=
true
;
}
protected
:
std
:
:
unique_ptr
<
VirtualSocketServer
>
vss_
;
Socket
*
socket_
;
std
:
:
unique_ptr
<
AsyncTCPSocket
>
tcp_socket_
;
bool
ready_to_send_
;
}
;
TEST_F
(
AsyncTCPSocketTest
OnWriteEvent
)
{
EXPECT_FALSE
(
ready_to_send_
)
;
socket_
-
>
SignalWriteEvent
(
socket_
)
;
EXPECT_TRUE
(
ready_to_send_
)
;
}
}
