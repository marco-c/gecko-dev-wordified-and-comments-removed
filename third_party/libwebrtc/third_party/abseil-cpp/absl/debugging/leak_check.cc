#
include
"
absl
/
debugging
/
leak_check
.
h
"
#
ifndef
LEAK_SANITIZER
namespace
absl
{
ABSL_NAMESPACE_BEGIN
bool
HaveLeakSanitizer
(
)
{
return
false
;
}
void
DoIgnoreLeak
(
const
void
*
)
{
}
void
RegisterLivePointers
(
const
void
*
size_t
)
{
}
void
UnRegisterLivePointers
(
const
void
*
size_t
)
{
}
LeakCheckDisabler
:
:
LeakCheckDisabler
(
)
{
}
LeakCheckDisabler
:
:
~
LeakCheckDisabler
(
)
{
}
ABSL_NAMESPACE_END
}
#
else
#
include
<
sanitizer
/
lsan_interface
.
h
>
namespace
absl
{
ABSL_NAMESPACE_BEGIN
bool
HaveLeakSanitizer
(
)
{
return
true
;
}
void
DoIgnoreLeak
(
const
void
*
ptr
)
{
__lsan_ignore_object
(
ptr
)
;
}
void
RegisterLivePointers
(
const
void
*
ptr
size_t
size
)
{
__lsan_register_root_region
(
ptr
size
)
;
}
void
UnRegisterLivePointers
(
const
void
*
ptr
size_t
size
)
{
__lsan_unregister_root_region
(
ptr
size
)
;
}
LeakCheckDisabler
:
:
LeakCheckDisabler
(
)
{
__lsan_disable
(
)
;
}
LeakCheckDisabler
:
:
~
LeakCheckDisabler
(
)
{
__lsan_enable
(
)
;
}
ABSL_NAMESPACE_END
}
#
endif
