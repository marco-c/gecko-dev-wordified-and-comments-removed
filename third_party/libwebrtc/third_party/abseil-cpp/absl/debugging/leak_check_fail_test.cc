#
include
<
memory
>
#
include
"
gtest
/
gtest
.
h
"
#
include
"
absl
/
base
/
internal
/
raw_logging
.
h
"
#
include
"
absl
/
debugging
/
leak_check
.
h
"
namespace
{
TEST
(
LeakCheckTest
LeakMemory
)
{
char
*
foo
=
strdup
(
"
lsan
should
complain
about
this
leaked
string
"
)
;
ABSL_RAW_LOG
(
INFO
"
Should
detect
leaked
string
%
s
"
foo
)
;
}
TEST
(
LeakCheckTest
LeakMemoryAfterDisablerScope
)
{
{
absl
:
:
LeakCheckDisabler
disabler
;
}
char
*
foo
=
strdup
(
"
lsan
should
also
complain
about
this
leaked
string
"
)
;
ABSL_RAW_LOG
(
INFO
"
Re
-
enabled
leak
detection
.
Should
detect
leaked
string
%
s
"
foo
)
;
}
}
