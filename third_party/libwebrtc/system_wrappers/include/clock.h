#
ifndef
SYSTEM_WRAPPERS_INCLUDE_CLOCK_H_
#
define
SYSTEM_WRAPPERS_INCLUDE_CLOCK_H_
#
include
<
stdint
.
h
>
#
include
<
memory
>
#
include
"
api
/
units
/
timestamp
.
h
"
#
include
"
rtc_base
/
synchronization
/
rw_lock_wrapper
.
h
"
#
include
"
rtc_base
/
system
/
rtc_export
.
h
"
#
include
"
system_wrappers
/
include
/
ntp_time
.
h
"
namespace
webrtc
{
const
uint32_t
kNtpJan1970
=
2208988800UL
;
const
double
kMagicNtpFractionalUnit
=
4
.
294967296E
+
9
;
class
RTC_EXPORT
Clock
{
public
:
virtual
~
Clock
(
)
{
}
virtual
Timestamp
CurrentTime
(
)
{
return
Timestamp
:
:
Micros
(
TimeInMicroseconds
(
)
)
;
}
virtual
int64_t
TimeInMilliseconds
(
)
{
return
CurrentTime
(
)
.
ms
(
)
;
}
virtual
int64_t
TimeInMicroseconds
(
)
{
return
CurrentTime
(
)
.
us
(
)
;
}
virtual
NtpTime
CurrentNtpTime
(
)
=
0
;
virtual
int64_t
CurrentNtpInMilliseconds
(
)
=
0
;
static
int64_t
NtpToMs
(
uint32_t
seconds
uint32_t
fractions
)
{
return
NtpTime
(
seconds
fractions
)
.
ToMs
(
)
;
}
static
Clock
*
GetRealTimeClock
(
)
;
}
;
class
SimulatedClock
:
public
Clock
{
public
:
explicit
SimulatedClock
(
int64_t
initial_time_us
)
;
explicit
SimulatedClock
(
Timestamp
initial_time
)
;
~
SimulatedClock
(
)
override
;
Timestamp
CurrentTime
(
)
override
;
NtpTime
CurrentNtpTime
(
)
override
;
int64_t
CurrentNtpInMilliseconds
(
)
override
;
void
AdvanceTimeMilliseconds
(
int64_t
milliseconds
)
;
void
AdvanceTimeMicroseconds
(
int64_t
microseconds
)
;
void
AdvanceTime
(
TimeDelta
delta
)
;
private
:
Timestamp
time_
;
std
:
:
unique_ptr
<
RWLockWrapper
>
lock_
;
}
;
}
#
endif
