#
include
"
api
/
video
/
builtin_video_bitrate_allocator_factory
.
h
"
#
include
<
memory
>
#
include
"
absl
/
base
/
attributes
.
h
"
#
include
"
absl
/
base
/
macros
.
h
"
#
include
"
api
/
video
/
video_bitrate_allocator
.
h
"
#
include
"
api
/
video_codecs
/
video_codec
.
h
"
#
include
"
modules
/
video_coding
/
svc
/
svc_rate_allocator
.
h
"
#
include
"
modules
/
video_coding
/
utility
/
simulcast_rate_allocator
.
h
"
namespace
webrtc
{
namespace
{
class
BuiltinVideoBitrateAllocatorFactory
:
public
VideoBitrateAllocatorFactory
{
public
:
BuiltinVideoBitrateAllocatorFactory
(
)
=
default
;
~
BuiltinVideoBitrateAllocatorFactory
(
)
override
=
default
;
std
:
:
unique_ptr
<
VideoBitrateAllocator
>
CreateVideoBitrateAllocator
(
const
VideoCodec
&
codec
)
override
{
switch
(
codec
.
codecType
)
{
case
kVideoCodecAV1
:
case
kVideoCodecVP9
:
if
(
codec
.
numberOfSimulcastStreams
<
=
1
)
{
return
std
:
:
make_unique
<
SvcRateAllocator
>
(
codec
)
;
}
ABSL_FALLTHROUGH_INTENDED
;
default
:
return
std
:
:
make_unique
<
SimulcastRateAllocator
>
(
codec
)
;
}
}
}
;
}
std
:
:
unique_ptr
<
VideoBitrateAllocatorFactory
>
CreateBuiltinVideoBitrateAllocatorFactory
(
)
{
return
std
:
:
make_unique
<
BuiltinVideoBitrateAllocatorFactory
>
(
)
;
}
}
