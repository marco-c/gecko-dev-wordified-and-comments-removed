#
ifndef
API_FRAME_TRANSFORMER_INTERFACE_H_
#
define
API_FRAME_TRANSFORMER_INTERFACE_H_
#
include
<
cstdint
>
#
include
<
memory
>
#
include
<
optional
>
#
include
<
string
>
#
include
"
api
/
array_view
.
h
"
#
include
"
api
/
ref_count
.
h
"
#
include
"
api
/
scoped_refptr
.
h
"
#
include
"
api
/
units
/
time_delta
.
h
"
#
include
"
api
/
units
/
timestamp
.
h
"
#
include
"
api
/
video
/
video_frame_metadata
.
h
"
#
include
"
rtc_base
/
system
/
rtc_export
.
h
"
namespace
webrtc
{
class
TransformableFrameInterface
{
public
:
class
Passkey
;
RTC_EXPORT
explicit
TransformableFrameInterface
(
Passkey
)
;
TransformableFrameInterface
(
TransformableFrameInterface
&
&
)
=
default
;
TransformableFrameInterface
&
operator
=
(
TransformableFrameInterface
&
&
)
=
default
;
virtual
~
TransformableFrameInterface
(
)
=
default
;
virtual
ArrayView
<
const
uint8_t
>
GetData
(
)
const
=
0
;
virtual
void
SetData
(
ArrayView
<
const
uint8_t
>
data
)
=
0
;
virtual
uint8_t
GetPayloadType
(
)
const
=
0
;
virtual
uint32_t
GetSsrc
(
)
const
=
0
;
virtual
uint32_t
GetTimestamp
(
)
const
=
0
;
virtual
void
SetRTPTimestamp
(
uint32_t
timestamp
)
=
0
;
[
[
deprecated
(
"
Use
GetPresentationTimestamp
instead
"
)
]
]
virtual
std
:
:
optional
<
Timestamp
>
GetCaptureTimeIdentifier
(
)
const
{
return
std
:
:
nullopt
;
}
virtual
std
:
:
optional
<
Timestamp
>
GetPresentationTimestamp
(
)
const
{
return
std
:
:
nullopt
;
}
enum
class
Direction
{
kUnknown
kReceiver
kSender
}
;
virtual
Direction
GetDirection
(
)
const
{
return
Direction
:
:
kUnknown
;
}
virtual
std
:
:
string
GetMimeType
(
)
const
=
0
;
virtual
std
:
:
optional
<
Timestamp
>
ReceiveTime
(
)
const
=
0
;
virtual
std
:
:
optional
<
Timestamp
>
CaptureTime
(
)
const
=
0
;
virtual
std
:
:
optional
<
TimeDelta
>
SenderCaptureTimeOffset
(
)
const
=
0
;
}
;
class
TransformableVideoFrameInterface
:
public
TransformableFrameInterface
{
public
:
RTC_EXPORT
explicit
TransformableVideoFrameInterface
(
Passkey
passkey
)
;
virtual
~
TransformableVideoFrameInterface
(
)
=
default
;
virtual
bool
IsKeyFrame
(
)
const
=
0
;
virtual
const
std
:
:
string
&
GetRid
(
)
const
=
0
;
virtual
VideoFrameMetadata
Metadata
(
)
const
=
0
;
virtual
void
SetMetadata
(
const
VideoFrameMetadata
&
)
=
0
;
}
;
class
TransformableAudioFrameInterface
:
public
TransformableFrameInterface
{
public
:
RTC_EXPORT
explicit
TransformableAudioFrameInterface
(
Passkey
passkey
)
;
virtual
~
TransformableAudioFrameInterface
(
)
=
default
;
virtual
ArrayView
<
const
uint32_t
>
GetContributingSources
(
)
const
=
0
;
virtual
const
std
:
:
optional
<
uint16_t
>
SequenceNumber
(
)
const
=
0
;
virtual
std
:
:
optional
<
uint64_t
>
AbsoluteCaptureTimestamp
(
)
const
=
0
;
enum
class
FrameType
{
kEmptyFrame
kAudioFrameSpeech
kAudioFrameCN
}
;
virtual
FrameType
Type
(
)
const
{
return
FrameType
:
:
kEmptyFrame
;
}
virtual
std
:
:
optional
<
uint8_t
>
AudioLevel
(
)
const
=
0
;
}
;
class
TransformedFrameCallback
:
public
RefCountInterface
{
public
:
virtual
void
OnTransformedFrame
(
std
:
:
unique_ptr
<
TransformableFrameInterface
>
frame
)
=
0
;
virtual
void
StartShortCircuiting
(
)
{
}
protected
:
~
TransformedFrameCallback
(
)
override
=
default
;
}
;
class
FrameTransformerInterface
:
public
RefCountInterface
{
public
:
virtual
void
Transform
(
std
:
:
unique_ptr
<
TransformableFrameInterface
>
transformable_frame
)
=
0
;
virtual
void
RegisterTransformedFrameCallback
(
scoped_refptr
<
TransformedFrameCallback
>
)
{
}
virtual
void
RegisterTransformedFrameSinkCallback
(
scoped_refptr
<
TransformedFrameCallback
>
uint32_t
)
{
}
virtual
void
UnregisterTransformedFrameCallback
(
)
{
}
virtual
void
UnregisterTransformedFrameSinkCallback
(
uint32_t
)
{
}
protected
:
~
FrameTransformerInterface
(
)
override
=
default
;
}
;
class
FrameTransformerHost
{
public
:
virtual
~
FrameTransformerHost
(
)
{
}
virtual
void
SetFrameTransformer
(
scoped_refptr
<
FrameTransformerInterface
>
frame_transformer
)
=
0
;
}
;
class
TransformableFrameInterface
:
:
Passkey
{
public
:
~
Passkey
(
)
=
default
;
private
:
friend
class
TransformableOutgoingAudioFrame
;
friend
class
TransformableIncomingAudioFrame
;
friend
class
TransformableVideoSenderFrame
;
friend
class
TransformableVideoReceiverFrame
;
friend
class
MockTransformableFrame
;
friend
class
MockTransformableAudioFrame
;
friend
class
MockTransformableVideoFrame
;
Passkey
(
)
=
default
;
}
;
}
#
endif
