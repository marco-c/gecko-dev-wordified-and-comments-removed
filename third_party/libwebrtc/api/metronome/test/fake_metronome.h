#
ifndef
API_METRONOME_TEST_FAKE_METRONOME_H_
#
define
API_METRONOME_TEST_FAKE_METRONOME_H_
#
include
<
memory
>
#
include
<
set
>
#
include
"
api
/
metronome
/
metronome
.
h
"
#
include
"
api
/
task_queue
/
task_queue_base
.
h
"
#
include
"
api
/
task_queue
/
task_queue_factory
.
h
"
#
include
"
api
/
units
/
time_delta
.
h
"
#
include
"
rtc_base
/
synchronization
/
mutex
.
h
"
#
include
"
rtc_base
/
task_queue
.
h
"
#
include
"
rtc_base
/
task_utils
/
repeating_task
.
h
"
#
include
"
rtc_base
/
thread_annotations
.
h
"
namespace
webrtc
:
:
test
{
class
ForcedTickMetronome
:
public
Metronome
{
public
:
explicit
ForcedTickMetronome
(
TimeDelta
tick_period
)
;
void
Tick
(
)
;
size_t
NumListeners
(
)
;
void
AddListener
(
TickListener
*
listener
)
override
;
void
RemoveListener
(
TickListener
*
listener
)
override
;
TimeDelta
TickPeriod
(
)
const
override
;
private
:
const
TimeDelta
tick_period_
;
std
:
:
set
<
TickListener
*
>
listeners_
;
}
;
class
FakeMetronome
:
public
Metronome
{
public
:
FakeMetronome
(
TaskQueueFactory
*
factory
TimeDelta
tick_period
)
;
~
FakeMetronome
(
)
override
;
void
AddListener
(
TickListener
*
listener
)
override
;
void
RemoveListener
(
TickListener
*
listener
)
override
;
TimeDelta
TickPeriod
(
)
const
override
;
void
Stop
(
)
;
private
:
const
TimeDelta
tick_period_
;
RepeatingTaskHandle
tick_task_
;
bool
started_
RTC_GUARDED_BY
(
mutex_
)
=
false
;
std
:
:
set
<
TickListener
*
>
listeners_
RTC_GUARDED_BY
(
mutex_
)
;
Mutex
mutex_
;
rtc
:
:
TaskQueue
queue_
;
}
;
}
#
endif
