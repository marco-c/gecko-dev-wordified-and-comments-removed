#
ifndef
API_TRANSPORT_RTP_CORRUPTION_DETECTION_MESSAGE_H_
#
define
API_TRANSPORT_RTP_CORRUPTION_DETECTION_MESSAGE_H_
#
include
<
cstddef
>
#
include
<
optional
>
#
include
"
absl
/
container
/
inlined_vector
.
h
"
#
include
"
api
/
array_view
.
h
"
#
include
"
api
/
video
/
corruption_detection
/
frame_instrumentation_data
.
h
"
namespace
webrtc
{
class
CorruptionDetectionMessage
{
public
:
class
Builder
;
CorruptionDetectionMessage
(
)
=
default
;
CorruptionDetectionMessage
(
const
CorruptionDetectionMessage
&
)
=
default
;
CorruptionDetectionMessage
&
operator
=
(
const
CorruptionDetectionMessage
&
)
=
default
;
~
CorruptionDetectionMessage
(
)
=
default
;
int
sequence_index
(
)
const
{
return
sequence_index_
;
}
bool
interpret_sequence_index_as_most_significant_bits
(
)
const
{
return
interpret_sequence_index_as_most_significant_bits_
;
}
double
std_dev
(
)
const
{
return
std_dev_
;
}
int
luma_error_threshold
(
)
const
{
return
luma_error_threshold_
;
}
int
chroma_error_threshold
(
)
const
{
return
chroma_error_threshold_
;
}
ArrayView
<
const
double
>
sample_values
(
)
const
{
return
MakeArrayView
(
sample_values_
.
data
(
)
sample_values_
.
size
(
)
)
;
}
static
CorruptionDetectionMessage
FromFrameInstrumentationData
(
const
FrameInstrumentationData
&
frame_instrumentation
)
;
private
:
friend
class
CorruptionDetectionExtension
;
static
const
size_t
kMaxSampleSize
=
13
;
int
sequence_index_
=
0
;
bool
interpret_sequence_index_as_most_significant_bits_
=
false
;
double
std_dev_
=
0
.
0
;
int
luma_error_threshold_
=
0
;
int
chroma_error_threshold_
=
0
;
absl
:
:
InlinedVector
<
double
kMaxSampleSize
>
sample_values_
;
}
;
class
CorruptionDetectionMessage
:
:
Builder
{
public
:
Builder
(
)
=
default
;
Builder
(
const
Builder
&
)
=
default
;
Builder
&
operator
=
(
const
Builder
&
)
=
default
;
~
Builder
(
)
=
default
;
std
:
:
optional
<
CorruptionDetectionMessage
>
Build
(
)
;
Builder
&
WithSequenceIndex
(
int
sequence_index
)
;
Builder
&
WithInterpretSequenceIndexAsMostSignificantBits
(
bool
interpret_sequence_index_as_most_significant_bits
)
;
Builder
&
WithStdDev
(
double
std_dev
)
;
Builder
&
WithLumaErrorThreshold
(
int
luma_error_threshold
)
;
Builder
&
WithChromaErrorThreshold
(
int
chroma_error_threshold
)
;
Builder
&
WithSampleValues
(
const
ArrayView
<
const
double
>
&
sample_values
)
;
private
:
CorruptionDetectionMessage
message_
;
}
;
}
#
endif
