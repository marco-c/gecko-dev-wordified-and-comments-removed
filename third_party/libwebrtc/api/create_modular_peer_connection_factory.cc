#
include
"
api
/
create_modular_peer_connection_factory
.
h
"
#
include
<
utility
>
#
include
"
api
/
peer_connection_interface
.
h
"
#
include
"
api
/
scoped_refptr
.
h
"
#
include
"
api
/
sequence_checker
.
h
"
#
include
"
pc
/
peer_connection_factory
.
h
"
#
include
"
pc
/
peer_connection_factory_proxy
.
h
"
#
include
"
rtc_base
/
thread
.
h
"
namespace
webrtc
{
scoped_refptr
<
PeerConnectionFactoryInterface
>
CreateModularPeerConnectionFactory
(
PeerConnectionFactoryDependencies
dependencies
)
{
if
(
dependencies
.
signaling_thread
&
&
!
dependencies
.
signaling_thread
-
>
IsCurrent
(
)
)
{
return
dependencies
.
signaling_thread
-
>
BlockingCall
(
[
&
dependencies
]
{
return
CreateModularPeerConnectionFactory
(
std
:
:
move
(
dependencies
)
)
;
}
)
;
}
auto
pc_factory
=
PeerConnectionFactory
:
:
Create
(
std
:
:
move
(
dependencies
)
)
;
if
(
!
pc_factory
)
{
return
nullptr
;
}
RTC_DCHECK_RUN_ON
(
pc_factory
-
>
signaling_thread
(
)
)
;
return
PeerConnectionFactoryProxy
:
:
Create
(
pc_factory
-
>
signaling_thread
(
)
pc_factory
-
>
worker_thread
(
)
pc_factory
)
;
}
}
