#
include
"
api
/
task_queue
/
pending_task_safety_flag
.
h
"
#
include
"
absl
/
base
/
nullability
.
h
"
#
include
"
api
/
scoped_refptr
.
h
"
#
include
"
api
/
sequence_checker
.
h
"
#
include
"
api
/
task_queue
/
task_queue_base
.
h
"
#
include
"
rtc_base
/
checks
.
h
"
namespace
webrtc
{
rtc
:
:
scoped_refptr
<
PendingTaskSafetyFlag
>
PendingTaskSafetyFlag
:
:
CreateInternal
(
bool
alive
)
{
return
rtc
:
:
scoped_refptr
<
PendingTaskSafetyFlag
>
(
new
PendingTaskSafetyFlag
(
alive
)
)
;
}
rtc
:
:
scoped_refptr
<
PendingTaskSafetyFlag
>
PendingTaskSafetyFlag
:
:
Create
(
)
{
return
CreateInternal
(
true
)
;
}
rtc
:
:
scoped_refptr
<
PendingTaskSafetyFlag
>
PendingTaskSafetyFlag
:
:
CreateDetached
(
)
{
rtc
:
:
scoped_refptr
<
PendingTaskSafetyFlag
>
safety_flag
=
CreateInternal
(
true
)
;
safety_flag
-
>
main_sequence_
.
Detach
(
)
;
return
safety_flag
;
}
rtc
:
:
scoped_refptr
<
PendingTaskSafetyFlag
>
PendingTaskSafetyFlag
:
:
CreateAttachedToTaskQueue
(
bool
alive
TaskQueueBase
*
absl_nonnull
attached_queue
)
{
RTC_DCHECK
(
attached_queue
)
<
<
"
Null
TaskQueue
provided
"
;
return
rtc
:
:
scoped_refptr
<
PendingTaskSafetyFlag
>
(
new
PendingTaskSafetyFlag
(
alive
attached_queue
)
)
;
}
rtc
:
:
scoped_refptr
<
PendingTaskSafetyFlag
>
PendingTaskSafetyFlag
:
:
CreateDetachedInactive
(
)
{
rtc
:
:
scoped_refptr
<
PendingTaskSafetyFlag
>
safety_flag
=
CreateInternal
(
false
)
;
safety_flag
-
>
main_sequence_
.
Detach
(
)
;
return
safety_flag
;
}
void
PendingTaskSafetyFlag
:
:
SetNotAlive
(
)
{
RTC_DCHECK_RUN_ON
(
&
main_sequence_
)
;
alive_
=
false
;
}
void
PendingTaskSafetyFlag
:
:
SetAlive
(
)
{
RTC_DCHECK_RUN_ON
(
&
main_sequence_
)
;
alive_
=
true
;
}
bool
PendingTaskSafetyFlag
:
:
alive
(
)
const
{
RTC_DCHECK_RUN_ON
(
&
main_sequence_
)
;
return
alive_
;
}
}
