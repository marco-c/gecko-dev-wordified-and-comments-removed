#
include
"
api
/
peer_connection_interface
.
h
"
#
include
<
memory
>
#
include
<
utility
>
#
include
"
api
/
media_types
.
h
"
#
include
"
api
/
rtc_error
.
h
"
#
include
"
api
/
rtp_parameters
.
h
"
#
include
"
api
/
scoped_refptr
.
h
"
#
include
"
p2p
/
base
/
port_allocator
.
h
"
#
include
"
pc
/
media_factory
.
h
"
#
include
"
rtc_base
/
rtc_certificate_generator
.
h
"
namespace
webrtc
{
PeerConnectionInterface
:
:
IceServer
:
:
IceServer
(
)
=
default
;
PeerConnectionInterface
:
:
IceServer
:
:
IceServer
(
const
IceServer
&
rhs
)
=
default
;
PeerConnectionInterface
:
:
IceServer
:
:
~
IceServer
(
)
=
default
;
PeerConnectionInterface
:
:
RTCConfiguration
:
:
RTCConfiguration
(
)
=
default
;
PeerConnectionInterface
:
:
RTCConfiguration
:
:
RTCConfiguration
(
const
RTCConfiguration
&
rhs
)
=
default
;
PeerConnectionInterface
:
:
RTCConfiguration
:
:
RTCConfiguration
(
RTCConfigurationType
type
)
{
if
(
type
=
=
RTCConfigurationType
:
:
kAggressive
)
{
bundle_policy
=
kBundlePolicyMaxBundle
;
rtcp_mux_policy
=
kRtcpMuxPolicyRequire
;
ice_connection_receiving_timeout
=
kAggressiveIceConnectionReceivingTimeout
;
enable_ice_renomination
=
true
;
redetermine_role_on_ice_restart
=
false
;
}
}
PeerConnectionInterface
:
:
RTCConfiguration
:
:
~
RTCConfiguration
(
)
=
default
;
PeerConnectionDependencies
:
:
PeerConnectionDependencies
(
PeerConnectionObserver
*
observer_in
)
:
observer
(
observer_in
)
{
}
#
pragma
clang
diagnostic
push
#
pragma
clang
diagnostic
ignored
"
-
Wdeprecated
-
declarations
"
PeerConnectionDependencies
:
:
PeerConnectionDependencies
(
PeerConnectionDependencies
&
&
)
=
default
;
#
pragma
clang
diagnostic
pop
PeerConnectionDependencies
:
:
~
PeerConnectionDependencies
(
)
=
default
;
PeerConnectionFactoryDependencies
:
:
PeerConnectionFactoryDependencies
(
)
=
default
;
#
pragma
clang
diagnostic
push
#
pragma
clang
diagnostic
ignored
"
-
Wdeprecated
-
declarations
"
PeerConnectionFactoryDependencies
:
:
PeerConnectionFactoryDependencies
(
PeerConnectionFactoryDependencies
&
&
)
=
default
;
#
pragma
clang
diagnostic
pop
PeerConnectionFactoryDependencies
:
:
~
PeerConnectionFactoryDependencies
(
)
=
default
;
rtc
:
:
scoped_refptr
<
PeerConnectionInterface
>
PeerConnectionFactoryInterface
:
:
CreatePeerConnection
(
const
PeerConnectionInterface
:
:
RTCConfiguration
&
configuration
std
:
:
unique_ptr
<
cricket
:
:
PortAllocator
>
allocator
std
:
:
unique_ptr
<
rtc
:
:
RTCCertificateGeneratorInterface
>
cert_generator
PeerConnectionObserver
*
observer
)
{
PeerConnectionDependencies
dependencies
(
observer
)
;
dependencies
.
allocator
=
std
:
:
move
(
allocator
)
;
dependencies
.
cert_generator
=
std
:
:
move
(
cert_generator
)
;
auto
result
=
CreatePeerConnectionOrError
(
configuration
std
:
:
move
(
dependencies
)
)
;
if
(
!
result
.
ok
(
)
)
{
return
nullptr
;
}
return
result
.
MoveValue
(
)
;
}
rtc
:
:
scoped_refptr
<
PeerConnectionInterface
>
PeerConnectionFactoryInterface
:
:
CreatePeerConnection
(
const
PeerConnectionInterface
:
:
RTCConfiguration
&
configuration
PeerConnectionDependencies
dependencies
)
{
auto
result
=
CreatePeerConnectionOrError
(
configuration
std
:
:
move
(
dependencies
)
)
;
if
(
!
result
.
ok
(
)
)
{
return
nullptr
;
}
return
result
.
MoveValue
(
)
;
}
RTCErrorOr
<
rtc
:
:
scoped_refptr
<
PeerConnectionInterface
>
>
PeerConnectionFactoryInterface
:
:
CreatePeerConnectionOrError
(
const
PeerConnectionInterface
:
:
RTCConfiguration
&
PeerConnectionDependencies
)
{
return
RTCError
(
RTCErrorType
:
:
INTERNAL_ERROR
)
;
}
}
