#
ifndef
PC_SCTP_TRANSPORT_H_
#
define
PC_SCTP_TRANSPORT_H_
#
include
<
cstddef
>
#
include
<
memory
>
#
include
"
api
/
dtls_transport_interface
.
h
"
#
include
"
api
/
priority
.
h
"
#
include
"
api
/
rtc_error
.
h
"
#
include
"
api
/
scoped_refptr
.
h
"
#
include
"
api
/
sctp_transport_interface
.
h
"
#
include
"
api
/
sequence_checker
.
h
"
#
include
"
api
/
transport
/
data_channel_transport_interface
.
h
"
#
include
"
media
/
sctp
/
sctp_transport_internal
.
h
"
#
include
"
p2p
/
dtls
/
dtls_transport_internal
.
h
"
#
include
"
pc
/
dtls_transport
.
h
"
#
include
"
rtc_base
/
copy_on_write_buffer
.
h
"
#
include
"
rtc_base
/
thread
.
h
"
#
include
"
rtc_base
/
thread_annotations
.
h
"
namespace
webrtc
{
class
SctpTransport
:
public
SctpTransportInterface
public
DataChannelTransportInterface
{
public
:
SctpTransport
(
std
:
:
unique_ptr
<
SctpTransportInternal
>
internal
rtc
:
:
scoped_refptr
<
DtlsTransport
>
dtls_transport
)
;
rtc
:
:
scoped_refptr
<
DtlsTransportInterface
>
dtls_transport
(
)
const
override
;
SctpTransportInformation
Information
(
)
const
override
;
void
RegisterObserver
(
SctpTransportObserverInterface
*
observer
)
override
;
void
UnregisterObserver
(
)
override
;
RTCError
OpenChannel
(
int
channel_id
PriorityValue
priority
)
override
;
RTCError
SendData
(
int
channel_id
const
SendDataParams
&
params
const
rtc
:
:
CopyOnWriteBuffer
&
buffer
)
override
;
RTCError
CloseChannel
(
int
channel_id
)
override
;
void
SetDataSink
(
DataChannelSink
*
sink
)
override
;
bool
IsReadyToSend
(
)
const
override
;
size_t
buffered_amount
(
int
channel_id
)
const
override
;
size_t
buffered_amount_low_threshold
(
int
channel_id
)
const
override
;
void
SetBufferedAmountLowThreshold
(
int
channel_id
size_t
bytes
)
override
;
void
Clear
(
)
;
void
Start
(
const
SctpOptions
&
options
)
;
SctpTransportInternal
*
internal
(
)
{
RTC_DCHECK_RUN_ON
(
owner_thread_
)
;
return
internal_sctp_transport_
.
get
(
)
;
}
const
SctpTransportInternal
*
internal
(
)
const
{
RTC_DCHECK_RUN_ON
(
owner_thread_
)
;
return
internal_sctp_transport_
.
get
(
)
;
}
protected
:
~
SctpTransport
(
)
override
;
private
:
void
UpdateInformation
(
SctpTransportState
state
)
;
void
OnInternalReadyToSendData
(
)
;
void
OnAssociationChangeCommunicationUp
(
)
;
void
OnInternalClosingProcedureStartedRemotely
(
int
sid
)
;
void
OnInternalClosingProcedureComplete
(
int
sid
)
;
void
OnDtlsStateChange
(
DtlsTransportInternal
*
transport
DtlsTransportState
state
)
;
Thread
*
const
owner_thread_
;
SctpTransportInformation
info_
RTC_GUARDED_BY
(
owner_thread_
)
;
std
:
:
unique_ptr
<
SctpTransportInternal
>
internal_sctp_transport_
RTC_GUARDED_BY
(
owner_thread_
)
;
SctpTransportObserverInterface
*
observer_
RTC_GUARDED_BY
(
owner_thread_
)
=
nullptr
;
rtc
:
:
scoped_refptr
<
DtlsTransport
>
dtls_transport_
RTC_GUARDED_BY
(
owner_thread_
)
;
}
;
}
#
endif
