#
include
"
pc
/
rtp_receiver
.
h
"
#
include
<
stddef
.
h
>
#
include
<
utility
>
#
include
<
vector
>
#
include
"
api
/
media_stream_proxy
.
h
"
#
include
"
api
/
media_stream_track_proxy
.
h
"
#
include
"
pc
/
media_stream
.
h
"
#
include
"
rtc_base
/
checks
.
h
"
#
include
"
rtc_base
/
location
.
h
"
#
include
"
rtc_base
/
logging
.
h
"
#
include
"
rtc_base
/
trace_event
.
h
"
namespace
webrtc
{
int
RtpReceiverInternal
:
:
GenerateUniqueId
(
)
{
static
int
g_unique_id
=
0
;
return
+
+
g_unique_id
;
}
std
:
:
vector
<
rtc
:
:
scoped_refptr
<
MediaStreamInterface
>
>
RtpReceiverInternal
:
:
CreateStreamsFromIds
(
std
:
:
vector
<
std
:
:
string
>
stream_ids
)
{
std
:
:
vector
<
rtc
:
:
scoped_refptr
<
MediaStreamInterface
>
>
streams
(
stream_ids
.
size
(
)
)
;
for
(
size_t
i
=
0
;
i
<
stream_ids
.
size
(
)
;
+
+
i
)
{
streams
[
i
]
=
MediaStreamProxy
:
:
Create
(
rtc
:
:
Thread
:
:
Current
(
)
MediaStream
:
:
Create
(
std
:
:
move
(
stream_ids
[
i
]
)
)
)
;
}
return
streams
;
}
void
RtpReceiverInternal
:
:
MaybeAttachFrameDecryptorToMediaChannel
(
const
absl
:
:
optional
<
uint32_t
>
&
ssrc
rtc
:
:
Thread
*
worker_thread
rtc
:
:
scoped_refptr
<
webrtc
:
:
FrameDecryptorInterface
>
frame_decryptor
cricket
:
:
MediaChannel
*
media_channel
bool
stopped
)
{
if
(
media_channel
&
&
frame_decryptor
&
&
ssrc
.
has_value
(
)
&
&
!
stopped
)
{
worker_thread
-
>
Invoke
<
void
>
(
RTC_FROM_HERE
[
&
]
{
media_channel
-
>
SetFrameDecryptor
(
*
ssrc
frame_decryptor
)
;
}
)
;
}
}
}
