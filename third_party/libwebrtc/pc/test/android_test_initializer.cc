#
include
"
pc
/
test
/
android_test_initializer
.
h
"
#
include
<
jni
.
h
>
#
include
<
pthread
.
h
>
#
include
<
stddef
.
h
>
#
include
"
modules
/
utility
/
include
/
jvm_android
.
h
"
#
include
"
rtc_base
/
checks
.
h
"
#
include
"
sdk
/
android
/
src
/
jni
/
jvm
.
h
"
#
include
"
rtc_base
/
ssl_adapter
.
h
"
namespace
webrtc
{
namespace
{
static
pthread_once_t
g_initialize_once
=
PTHREAD_ONCE_INIT
;
void
EnsureInitializedOnce
(
)
{
RTC_CHECK
(
:
:
webrtc
:
:
jni
:
:
GetJVM
(
)
!
=
nullptr
)
;
JNIEnv
*
jni
=
:
:
webrtc
:
:
jni
:
:
AttachCurrentThreadIfNeeded
(
)
;
JavaVM
*
jvm
=
NULL
;
RTC_CHECK_EQ
(
0
jni
-
>
GetJavaVM
(
&
jvm
)
)
;
RTC_CHECK
(
webrtc
:
:
InitializeSSL
(
)
)
<
<
"
Failed
to
InitializeSSL
(
)
"
;
JVM
:
:
Initialize
(
jvm
)
;
}
}
void
InitializeAndroidObjects
(
)
{
RTC_CHECK_EQ
(
0
pthread_once
(
&
g_initialize_once
&
EnsureInitializedOnce
)
)
;
}
}
