#
include
"
pc
/
jitter_buffer_delay
.
h
"
#
include
"
api
/
sequence_checker
.
h
"
#
include
"
rtc_base
/
checks
.
h
"
#
include
"
rtc_base
/
numerics
/
safe_conversions
.
h
"
#
include
"
rtc_base
/
numerics
/
safe_minmax
.
h
"
namespace
{
constexpr
int
kDefaultDelay
=
0
;
constexpr
int
kMaximumDelayMs
=
10000
;
}
namespace
webrtc
{
JitterBufferDelay
:
:
JitterBufferDelay
(
)
{
worker_thread_checker_
.
Detach
(
)
;
}
void
JitterBufferDelay
:
:
Set
(
absl
:
:
optional
<
double
>
delay_seconds
)
{
RTC_DCHECK_RUN_ON
(
&
worker_thread_checker_
)
;
cached_delay_seconds_
=
delay_seconds
;
}
int
JitterBufferDelay
:
:
GetMs
(
)
const
{
RTC_DCHECK_RUN_ON
(
&
worker_thread_checker_
)
;
return
rtc
:
:
SafeClamp
(
rtc
:
:
saturated_cast
<
int
>
(
cached_delay_seconds_
.
value_or
(
kDefaultDelay
)
*
1000
)
0
kMaximumDelayMs
)
;
}
}
