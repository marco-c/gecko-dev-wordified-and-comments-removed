#
ifndef
PC_SRTP_SESSION_H_
#
define
PC_SRTP_SESSION_H_
#
include
<
vector
>
#
include
"
api
/
scoped_refptr
.
h
"
#
include
"
rtc_base
/
constructor_magic
.
h
"
#
include
"
rtc_base
/
synchronization
/
mutex
.
h
"
#
include
"
rtc_base
/
thread_checker
.
h
"
struct
srtp_event_data_t
;
struct
srtp_ctx_t_
;
namespace
cricket
{
void
ProhibitLibsrtpInitialization
(
)
;
class
SrtpSession
{
public
:
SrtpSession
(
)
;
~
SrtpSession
(
)
;
bool
SetSend
(
int
cs
const
uint8_t
*
key
size_t
len
const
std
:
:
vector
<
int
>
&
extension_ids
)
;
bool
UpdateSend
(
int
cs
const
uint8_t
*
key
size_t
len
const
std
:
:
vector
<
int
>
&
extension_ids
)
;
bool
SetRecv
(
int
cs
const
uint8_t
*
key
size_t
len
const
std
:
:
vector
<
int
>
&
extension_ids
)
;
bool
UpdateRecv
(
int
cs
const
uint8_t
*
key
size_t
len
const
std
:
:
vector
<
int
>
&
extension_ids
)
;
bool
ProtectRtp
(
void
*
data
int
in_len
int
max_len
int
*
out_len
)
;
bool
ProtectRtp
(
void
*
data
int
in_len
int
max_len
int
*
out_len
int64_t
*
index
)
;
bool
ProtectRtcp
(
void
*
data
int
in_len
int
max_len
int
*
out_len
)
;
bool
UnprotectRtp
(
void
*
data
int
in_len
int
*
out_len
)
;
bool
UnprotectRtcp
(
void
*
data
int
in_len
int
*
out_len
)
;
bool
GetRtpAuthParams
(
uint8_t
*
*
key
int
*
key_len
int
*
tag_len
)
;
int
GetSrtpOverhead
(
)
const
;
void
EnableExternalAuth
(
)
;
bool
IsExternalAuthEnabled
(
)
const
;
bool
IsExternalAuthActive
(
)
const
;
private
:
bool
DoSetKey
(
int
type
int
cs
const
uint8_t
*
key
size_t
len
const
std
:
:
vector
<
int
>
&
extension_ids
)
;
bool
SetKey
(
int
type
int
cs
const
uint8_t
*
key
size_t
len
const
std
:
:
vector
<
int
>
&
extension_ids
)
;
bool
UpdateKey
(
int
type
int
cs
const
uint8_t
*
key
size_t
len
const
std
:
:
vector
<
int
>
&
extension_ids
)
;
bool
GetSendStreamPacketIndex
(
void
*
data
int
in_len
int64_t
*
index
)
;
void
DumpPacket
(
const
void
*
buf
int
len
bool
outbound
)
;
static
bool
IncrementLibsrtpUsageCountAndMaybeInit
(
)
;
static
void
DecrementLibsrtpUsageCountAndMaybeDeinit
(
)
;
void
HandleEvent
(
const
srtp_event_data_t
*
ev
)
;
static
void
HandleEventThunk
(
srtp_event_data_t
*
ev
)
;
rtc
:
:
ThreadChecker
thread_checker_
;
srtp_ctx_t_
*
session_
=
nullptr
;
int
rtp_auth_tag_len_
=
0
;
int
rtcp_auth_tag_len_
=
0
;
bool
inited_
=
false
;
static
webrtc
:
:
GlobalMutex
lock_
;
int
last_send_seq_num_
=
-
1
;
bool
external_auth_active_
=
false
;
bool
external_auth_enabled_
=
false
;
int
decryption_failure_count_
=
0
;
bool
dump_plain_rtp_
=
false
;
RTC_DISALLOW_COPY_AND_ASSIGN
(
SrtpSession
)
;
}
;
}
#
endif
