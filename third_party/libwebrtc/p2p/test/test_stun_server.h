#
ifndef
P2P_TEST_TEST_STUN_SERVER_H_
#
define
P2P_TEST_TEST_STUN_SERVER_H_
#
include
<
functional
>
#
include
<
memory
>
#
include
"
api
/
transport
/
stun
.
h
"
#
include
"
p2p
/
test
/
stun_server
.
h
"
#
include
"
rtc_base
/
async_udp_socket
.
h
"
#
include
"
rtc_base
/
socket_address
.
h
"
#
include
"
rtc_base
/
socket_server
.
h
"
#
include
"
rtc_base
/
thread
.
h
"
namespace
webrtc
{
class
TestStunServer
:
StunServer
{
public
:
using
StunServerPtr
=
std
:
:
unique_ptr
<
TestStunServer
std
:
:
function
<
void
(
webrtc
:
:
TestStunServer
*
)
>
>
;
static
StunServerPtr
Create
(
SocketServer
*
ss
const
SocketAddress
&
addr
Thread
&
network_thread
)
;
void
set_fake_stun_addr
(
const
SocketAddress
&
addr
)
{
fake_stun_addr_
=
addr
;
}
private
:
static
void
DeleteOnNetworkThread
(
TestStunServer
*
server
)
;
TestStunServer
(
AsyncUDPSocket
*
socket
Thread
&
network_thread
)
:
StunServer
(
socket
)
network_thread_
(
network_thread
)
{
}
void
OnBindingRequest
(
StunMessage
*
msg
const
SocketAddress
&
remote_addr
)
override
;
private
:
SocketAddress
fake_stun_addr_
;
Thread
&
network_thread_
;
}
;
}
namespace
cricket
{
using
:
:
webrtc
:
:
TestStunServer
;
}
#
endif
