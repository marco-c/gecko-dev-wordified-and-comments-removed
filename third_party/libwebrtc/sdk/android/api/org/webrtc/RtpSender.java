package
org
.
webrtc
;
import
android
.
support
.
annotation
.
Nullable
;
import
java
.
util
.
List
;
public
class
RtpSender
{
private
long
nativeRtpSender
;
Nullable
private
MediaStreamTrack
cachedTrack
;
private
boolean
ownsTrack
=
true
;
private
final
Nullable
DtmfSender
dtmfSender
;
CalledByNative
public
RtpSender
(
long
nativeRtpSender
)
{
this
.
nativeRtpSender
=
nativeRtpSender
;
long
nativeTrack
=
nativeGetTrack
(
nativeRtpSender
)
;
cachedTrack
=
MediaStreamTrack
.
createMediaStreamTrack
(
nativeTrack
)
;
long
nativeDtmfSender
=
nativeGetDtmfSender
(
nativeRtpSender
)
;
dtmfSender
=
(
nativeDtmfSender
!
=
0
)
?
new
DtmfSender
(
nativeDtmfSender
)
:
null
;
}
public
boolean
setTrack
(
Nullable
MediaStreamTrack
track
boolean
takeOwnership
)
{
checkRtpSenderExists
(
)
;
if
(
!
nativeSetTrack
(
nativeRtpSender
(
track
=
=
null
)
?
0
:
track
.
getNativeMediaStreamTrack
(
)
)
)
{
return
false
;
}
if
(
cachedTrack
!
=
null
&
&
ownsTrack
)
{
cachedTrack
.
dispose
(
)
;
}
cachedTrack
=
track
;
ownsTrack
=
takeOwnership
;
return
true
;
}
Nullable
public
MediaStreamTrack
track
(
)
{
return
cachedTrack
;
}
public
void
setStreams
(
List
<
String
>
streamIds
)
{
checkRtpSenderExists
(
)
;
nativeSetStreams
(
nativeRtpSender
streamIds
)
;
}
public
List
<
String
>
getStreams
(
)
{
checkRtpSenderExists
(
)
;
return
nativeGetStreams
(
nativeRtpSender
)
;
}
public
boolean
setParameters
(
RtpParameters
parameters
)
{
checkRtpSenderExists
(
)
;
return
nativeSetParameters
(
nativeRtpSender
parameters
)
;
}
public
RtpParameters
getParameters
(
)
{
checkRtpSenderExists
(
)
;
return
nativeGetParameters
(
nativeRtpSender
)
;
}
public
String
id
(
)
{
checkRtpSenderExists
(
)
;
return
nativeGetId
(
nativeRtpSender
)
;
}
Nullable
public
DtmfSender
dtmf
(
)
{
return
dtmfSender
;
}
public
void
setFrameEncryptor
(
FrameEncryptor
frameEncryptor
)
{
checkRtpSenderExists
(
)
;
nativeSetFrameEncryptor
(
nativeRtpSender
frameEncryptor
.
getNativeFrameEncryptor
(
)
)
;
}
public
void
dispose
(
)
{
checkRtpSenderExists
(
)
;
if
(
dtmfSender
!
=
null
)
{
dtmfSender
.
dispose
(
)
;
}
if
(
cachedTrack
!
=
null
&
&
ownsTrack
)
{
cachedTrack
.
dispose
(
)
;
}
JniCommon
.
nativeReleaseRef
(
nativeRtpSender
)
;
nativeRtpSender
=
0
;
}
long
getNativeRtpSender
(
)
{
checkRtpSenderExists
(
)
;
return
nativeRtpSender
;
}
private
void
checkRtpSenderExists
(
)
{
if
(
nativeRtpSender
=
=
0
)
{
throw
new
IllegalStateException
(
"
RtpSender
has
been
disposed
.
"
)
;
}
}
private
static
native
boolean
nativeSetTrack
(
long
rtpSender
long
nativeTrack
)
;
private
static
native
long
nativeGetTrack
(
long
rtpSender
)
;
private
static
native
void
nativeSetStreams
(
long
rtpSender
List
<
String
>
streamIds
)
;
private
static
native
List
<
String
>
nativeGetStreams
(
long
rtpSender
)
;
private
static
native
long
nativeGetDtmfSender
(
long
rtpSender
)
;
private
static
native
boolean
nativeSetParameters
(
long
rtpSender
RtpParameters
parameters
)
;
private
static
native
RtpParameters
nativeGetParameters
(
long
rtpSender
)
;
private
static
native
String
nativeGetId
(
long
rtpSender
)
;
private
static
native
void
nativeSetFrameEncryptor
(
long
rtpSender
long
nativeFrameEncryptor
)
;
}
;
