#
import
"
UIDevice
+
H264Profile
.
h
"
#
import
"
helpers
/
UIDevice
+
RTCDevice
.
h
"
#
include
<
algorithm
>
namespace
{
using
namespace
webrtc
;
struct
SupportedH264Profile
{
const
char
*
machineName
;
const
H264ProfileLevelId
profile
;
}
;
constexpr
SupportedH264Profile
kH264MaxSupportedProfiles
[
]
=
{
{
"
iPhone15
3
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel5_2
}
}
{
"
iPhone15
2
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel5_2
}
}
{
"
iPhone14
8
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel5_2
}
}
{
"
iPhone14
7
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel5_2
}
}
{
"
iPhone14
6
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel5_2
}
}
{
"
iPhone14
5
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel5_2
}
}
{
"
iPhone14
4
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel5_2
}
}
{
"
iPhone14
3
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel5_2
}
}
{
"
iPhone14
2
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel5_2
}
}
{
"
iPhone13
4
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel5_2
}
}
{
"
iPhone13
3
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel5_2
}
}
{
"
iPhone13
2
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel5_2
}
}
{
"
iPhone13
1
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel5_2
}
}
{
"
iPhone12
8
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel5_2
}
}
{
"
iPhone12
5
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel5_2
}
}
{
"
iPhone12
3
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel5_2
}
}
{
"
iPhone12
1
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel5_2
}
}
{
"
iPhone11
8
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel5_2
}
}
{
"
iPhone11
6
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel5_2
}
}
{
"
iPhone11
4
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel5_2
}
}
{
"
iPhone11
2
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel5_2
}
}
{
"
iPhone10
6
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel5_2
}
}
{
"
iPhone10
5
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel5_2
}
}
{
"
iPhone10
4
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel5_2
}
}
{
"
iPhone10
3
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel5_2
}
}
{
"
iPhone10
2
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel5_2
}
}
{
"
iPhone10
1
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel5_2
}
}
{
"
iPhone9
4
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel5_1
}
}
{
"
iPhone9
3
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel5_1
}
}
{
"
iPhone9
2
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel5_1
}
}
{
"
iPhone9
1
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel5_1
}
}
{
"
iPhone8
4
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel4_2
}
}
{
"
iPhone8
2
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel4_2
}
}
{
"
iPhone8
1
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel4_2
}
}
{
"
iPhone7
2
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel4_2
}
}
{
"
iPhone7
1
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel4_2
}
}
{
"
iPhone6
2
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel4_1
}
}
{
"
iPhone6
1
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel4_1
}
}
{
"
iPod9
1
"
{
H264Profile
:
:
kProfileMain
H264Level
:
:
kLevel4_1
}
}
{
"
iPod7
1
"
{
H264Profile
:
:
kProfileMain
H264Level
:
:
kLevel4_1
}
}
{
"
iPad14
6
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel5_2
}
}
{
"
iPad14
5
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel5_2
}
}
{
"
iPad14
4
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel5_2
}
}
{
"
iPad14
3
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel5_2
}
}
{
"
iPad14
2
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel5_2
}
}
{
"
iPad14
1
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel5_2
}
}
{
"
iPad13
19
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel5_2
}
}
{
"
iPad13
18
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel5_2
}
}
{
"
iPad13
17
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel5_2
}
}
{
"
iPad13
16
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel5_2
}
}
{
"
iPad13
11
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel5_2
}
}
{
"
iPad13
10
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel5_2
}
}
{
"
iPad13
9
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel5_2
}
}
{
"
iPad13
8
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel5_2
}
}
{
"
iPad13
7
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel5_2
}
}
{
"
iPad13
6
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel5_2
}
}
{
"
iPad13
5
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel5_2
}
}
{
"
iPad13
4
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel5_2
}
}
{
"
iPad13
2
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel5_2
}
}
{
"
iPad13
1
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel5_2
}
}
{
"
iPad12
2
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel4_1
}
}
{
"
iPad12
1
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel4_1
}
}
{
"
iPad11
7
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel4_1
}
}
{
"
iPad11
6
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel4_1
}
}
{
"
iPad11
4
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel4_1
}
}
{
"
iPad11
3
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel4_1
}
}
{
"
iPad11
2
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel4_1
}
}
{
"
iPad11
1
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel4_1
}
}
{
"
iPad8
12
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel5_2
}
}
{
"
iPad8
11
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel5_2
}
}
{
"
iPad8
10
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel5_2
}
}
{
"
iPad8
9
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel5_2
}
}
{
"
iPad8
8
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel5_2
}
}
{
"
iPad8
7
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel5_2
}
}
{
"
iPad8
6
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel5_2
}
}
{
"
iPad8
5
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel5_2
}
}
{
"
iPad8
4
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel5_2
}
}
{
"
iPad8
3
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel5_2
}
}
{
"
iPad8
2
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel5_2
}
}
{
"
iPad8
1
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel5_2
}
}
{
"
iPad7
12
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel4_1
}
}
{
"
iPad7
11
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel4_1
}
}
{
"
iPad7
6
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel4_1
}
}
{
"
iPad7
5
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel4_1
}
}
{
"
iPad7
4
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel5_1
}
}
{
"
iPad7
3
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel5_1
}
}
{
"
iPad7
2
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel5_1
}
}
{
"
iPad7
1
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel5_1
}
}
{
"
iPad6
12
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel4_1
}
}
{
"
iPad6
11
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel4_1
}
}
{
"
iPad6
8
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel4_1
}
}
{
"
iPad6
7
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel4_1
}
}
{
"
iPad6
4
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel5_1
}
}
{
"
iPad6
3
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel5_1
}
}
{
"
iPad5
4
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel4_1
}
}
{
"
iPad5
3
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel4_1
}
}
{
"
iPad5
2
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel4_1
}
}
{
"
iPad5
1
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel4_1
}
}
{
"
iPad4
9
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel4_1
}
}
{
"
iPad4
8
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel4_1
}
}
{
"
iPad4
7
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel4_1
}
}
{
"
iPad4
6
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel4_1
}
}
{
"
iPad4
5
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel4_1
}
}
{
"
iPad4
4
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel4_1
}
}
{
"
iPad4
3
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel4_1
}
}
{
"
iPad4
2
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel4_1
}
}
{
"
iPad4
1
"
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel4_1
}
}
}
;
std
:
:
optional
<
H264ProfileLevelId
>
FindMaxSupportedProfileForDevice
(
NSString
*
machineName
)
{
const
auto
*
result
=
std
:
:
find_if
(
std
:
:
begin
(
kH264MaxSupportedProfiles
)
std
:
:
end
(
kH264MaxSupportedProfiles
)
[
machineName
]
(
const
SupportedH264Profile
&
supportedProfile
)
{
return
[
machineName
isEqualToString
:
(
supportedProfile
.
machineName
)
]
;
}
)
;
if
(
result
!
=
std
:
:
end
(
kH264MaxSupportedProfiles
)
)
{
return
result
-
>
profile
;
}
if
(
[
machineName
hasPrefix
:
"
iPhone
"
]
|
|
[
machineName
hasPrefix
:
"
iPad
"
]
)
{
H264ProfileLevelId
fallbackProfile
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel4_1
}
;
return
fallbackProfile
;
}
if
(
[
machineName
hasPrefix
:
"
iPod
"
]
)
{
H264ProfileLevelId
fallbackProfile
{
H264Profile
:
:
kProfileMain
H264Level
:
:
kLevel4_1
}
;
return
fallbackProfile
;
}
return
std
:
:
nullopt
;
}
}
implementation
UIDevice
(
H264Profile
)
+
(
std
:
:
optional
<
webrtc
:
:
H264ProfileLevelId
>
)
maxSupportedH264Profile
{
return
FindMaxSupportedProfileForDevice
(
[
UIDevice
machineName
]
)
;
}
end
