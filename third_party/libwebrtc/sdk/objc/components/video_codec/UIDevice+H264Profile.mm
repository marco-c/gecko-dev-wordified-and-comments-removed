#
import
"
UIDevice
+
H264Profile
.
h
"
#
import
"
helpers
/
UIDevice
+
RTCDevice
.
h
"
#
include
<
algorithm
>
namespace
{
using
namespace
webrtc
;
struct
SupportedH264Profile
{
const
RTCDeviceType
deviceType
;
const
H264ProfileLevelId
profile
;
}
;
constexpr
SupportedH264Profile
kH264MaxSupportedProfiles
[
]
=
{
{
RTCDeviceTypeIPhone12ProMax
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel5_2
}
}
{
RTCDeviceTypeIPhone12Pro
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel5_2
}
}
{
RTCDeviceTypeIPhone12
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel5_2
}
}
{
RTCDeviceTypeIPhone12Mini
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel5_2
}
}
{
RTCDeviceTypeIPhone11ProMax
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel5_2
}
}
{
RTCDeviceTypeIPhone11Pro
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel5_2
}
}
{
RTCDeviceTypeIPhone11
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel5_2
}
}
{
RTCDeviceTypeIPhoneXS
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel5_2
}
}
{
RTCDeviceTypeIPhoneXSMax
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel5_2
}
}
{
RTCDeviceTypeIPhoneXR
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel5_2
}
}
{
RTCDeviceTypeIPhoneX
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel5_2
}
}
{
RTCDeviceTypeIPhone8
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel5_2
}
}
{
RTCDeviceTypeIPhone8Plus
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel5_2
}
}
{
RTCDeviceTypeIPhone7
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel5_1
}
}
{
RTCDeviceTypeIPhone7Plus
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel5_1
}
}
{
RTCDeviceTypeIPhoneSE
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel4_2
}
}
{
RTCDeviceTypeIPhone6S
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel4_2
}
}
{
RTCDeviceTypeIPhone6SPlus
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel4_2
}
}
{
RTCDeviceTypeIPhone6
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel4_2
}
}
{
RTCDeviceTypeIPhone6Plus
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel4_2
}
}
{
RTCDeviceTypeIPhone5SGSM
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel4_2
}
}
{
RTCDeviceTypeIPhone5SGSM_CDMA
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel4_2
}
}
{
RTCDeviceTypeIPhone5GSM
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel4_1
}
}
{
RTCDeviceTypeIPhone5GSM_CDMA
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel4_1
}
}
{
RTCDeviceTypeIPhone5CGSM
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel4_1
}
}
{
RTCDeviceTypeIPhone5CGSM_CDMA
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel4_1
}
}
{
RTCDeviceTypeIPhone4S
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel4_1
}
}
{
RTCDeviceTypeIPodTouch7G
{
H264Profile
:
:
kProfileMain
H264Level
:
:
kLevel4_1
}
}
{
RTCDeviceTypeIPodTouch6G
{
H264Profile
:
:
kProfileMain
H264Level
:
:
kLevel4_1
}
}
{
RTCDeviceTypeIPodTouch5G
{
H264Profile
:
:
kProfileMain
H264Level
:
:
kLevel3_1
}
}
{
RTCDeviceTypeIPadAir4Gen
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel4_1
}
}
{
RTCDeviceTypeIPad8
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel4_1
}
}
{
RTCDeviceTypeIPadPro4Gen12Inch
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel4_1
}
}
{
RTCDeviceTypeIPadPro4Gen11Inch
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel4_1
}
}
{
RTCDeviceTypeIPadAir3Gen
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel4_1
}
}
{
RTCDeviceTypeIPadMini5Gen
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel4_1
}
}
{
RTCDeviceTypeIPadPro3Gen12Inch
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel5_2
}
}
{
RTCDeviceTypeIPadPro3Gen11Inch
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel5_2
}
}
{
RTCDeviceTypeIPad7Gen10Inch
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel4_1
}
}
{
RTCDeviceTypeIPad2Wifi
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel4_1
}
}
{
RTCDeviceTypeIPad2GSM
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel4_1
}
}
{
RTCDeviceTypeIPad2CDMA
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel4_1
}
}
{
RTCDeviceTypeIPad2Wifi2
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel4_1
}
}
{
RTCDeviceTypeIPadMiniWifi
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel4_1
}
}
{
RTCDeviceTypeIPadMiniGSM
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel4_1
}
}
{
RTCDeviceTypeIPadMiniGSM_CDMA
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel4_1
}
}
{
RTCDeviceTypeIPad3Wifi
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel4_1
}
}
{
RTCDeviceTypeIPad3GSM_CDMA
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel4_1
}
}
{
RTCDeviceTypeIPad3GSM
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel4_1
}
}
{
RTCDeviceTypeIPad4Wifi
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel4_1
}
}
{
RTCDeviceTypeIPad4GSM
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel4_1
}
}
{
RTCDeviceTypeIPad4GSM_CDMA
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel4_1
}
}
{
RTCDeviceTypeIPad5
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel4_2
}
}
{
RTCDeviceTypeIPad6
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel4_2
}
}
{
RTCDeviceTypeIPadAirWifi
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel4_2
}
}
{
RTCDeviceTypeIPadAirCellular
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel4_2
}
}
{
RTCDeviceTypeIPadAirWifiCellular
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel4_2
}
}
{
RTCDeviceTypeIPadAir2
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel4_2
}
}
{
RTCDeviceTypeIPadMini2GWifi
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel4_2
}
}
{
RTCDeviceTypeIPadMini2GCellular
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel4_2
}
}
{
RTCDeviceTypeIPadMini2GWifiCellular
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel4_2
}
}
{
RTCDeviceTypeIPadMini3
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel4_2
}
}
{
RTCDeviceTypeIPadMini4
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel4_2
}
}
{
RTCDeviceTypeIPadPro9Inch
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel4_2
}
}
{
RTCDeviceTypeIPadPro12Inch
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel4_2
}
}
{
RTCDeviceTypeIPadPro12Inch2
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel4_2
}
}
{
RTCDeviceTypeIPadPro10Inch
{
H264Profile
:
:
kProfileHigh
H264Level
:
:
kLevel4_2
}
}
}
;
absl
:
:
optional
<
H264ProfileLevelId
>
FindMaxSupportedProfileForDevice
(
RTCDeviceType
deviceType
)
{
const
auto
*
result
=
std
:
:
find_if
(
std
:
:
begin
(
kH264MaxSupportedProfiles
)
std
:
:
end
(
kH264MaxSupportedProfiles
)
[
deviceType
]
(
const
SupportedH264Profile
&
supportedProfile
)
{
return
supportedProfile
.
deviceType
=
=
deviceType
;
}
)
;
if
(
result
!
=
std
:
:
end
(
kH264MaxSupportedProfiles
)
)
{
return
result
-
>
profile
;
}
return
absl
:
:
nullopt
;
}
}
implementation
UIDevice
(
H264Profile
)
+
(
absl
:
:
optional
<
webrtc
:
:
H264ProfileLevelId
>
)
maxSupportedH264Profile
{
return
FindMaxSupportedProfileForDevice
(
[
self
deviceType
]
)
;
}
end
