#
include
"
sdk
/
media_constraints
.
h
"
#
include
"
api
/
peer_connection_interface
.
h
"
#
include
"
test
/
gtest
.
h
"
namespace
webrtc
{
namespace
{
bool
Matches
(
const
PeerConnectionInterface
:
:
RTCConfiguration
&
a
const
PeerConnectionInterface
:
:
RTCConfiguration
&
b
)
{
return
a
.
audio_jitter_buffer_max_packets
=
=
b
.
audio_jitter_buffer_max_packets
&
&
a
.
screencast_min_bitrate
=
=
b
.
screencast_min_bitrate
&
&
a
.
media_config
=
=
b
.
media_config
;
}
TEST
(
MediaConstraints
CopyConstraintsIntoRtcConfiguration
)
{
const
MediaConstraints
constraints_empty
;
PeerConnectionInterface
:
:
RTCConfiguration
old_configuration
;
PeerConnectionInterface
:
:
RTCConfiguration
configuration
;
CopyConstraintsIntoRtcConfiguration
(
&
constraints_empty
&
configuration
)
;
EXPECT_TRUE
(
Matches
(
old_configuration
configuration
)
)
;
const
MediaConstraints
constraints_screencast
(
{
MediaConstraints
:
:
Constraint
(
MediaConstraints
:
:
kScreencastMinBitrate
"
27
"
)
}
{
}
)
;
CopyConstraintsIntoRtcConfiguration
(
&
constraints_screencast
&
configuration
)
;
EXPECT_TRUE
(
configuration
.
screencast_min_bitrate
)
;
EXPECT_EQ
(
27
*
(
configuration
.
screencast_min_bitrate
)
)
;
configuration
=
old_configuration
;
configuration
.
audio_jitter_buffer_max_packets
=
34
;
CopyConstraintsIntoRtcConfiguration
(
&
constraints_empty
&
configuration
)
;
EXPECT_EQ
(
34
configuration
.
audio_jitter_buffer_max_packets
)
;
}
}
}
