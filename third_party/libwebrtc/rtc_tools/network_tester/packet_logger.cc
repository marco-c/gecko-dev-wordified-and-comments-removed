#
include
"
rtc_tools
/
network_tester
/
packet_logger
.
h
"
#
include
<
string
>
#
include
"
rtc_base
/
checks
.
h
"
namespace
webrtc
{
PacketLogger
:
:
PacketLogger
(
const
std
:
:
string
&
log_file_path
)
:
packet_logger_stream_
(
log_file_path
std
:
:
ios_base
:
:
out
|
std
:
:
ios_base
:
:
binary
)
{
RTC_DCHECK
(
packet_logger_stream_
.
is_open
(
)
)
;
RTC_DCHECK
(
packet_logger_stream_
.
good
(
)
)
;
}
PacketLogger
:
:
~
PacketLogger
(
)
=
default
;
void
PacketLogger
:
:
LogPacket
(
const
NetworkTesterPacket
&
packet
)
{
std
:
:
string
packet_data
;
packet
.
SerializeToString
(
&
packet_data
)
;
RTC_DCHECK_LE
(
packet_data
.
length
(
)
255
)
;
RTC_DCHECK_GE
(
packet_data
.
length
(
)
0
)
;
char
proto_size
=
packet_data
.
length
(
)
;
packet_logger_stream_
.
write
(
&
proto_size
sizeof
(
proto_size
)
)
;
packet_logger_stream_
.
write
(
packet_data
.
data
(
)
packet_data
.
length
(
)
)
;
}
}
