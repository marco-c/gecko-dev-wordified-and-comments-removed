#
ifndef
RTC_TOOLS_DATA_CHANNEL_BENCHMARK_PEER_CONNECTION_CLIENT_H_
#
define
RTC_TOOLS_DATA_CHANNEL_BENCHMARK_PEER_CONNECTION_CLIENT_H_
#
include
<
stdint
.
h
>
#
include
<
functional
>
#
include
<
memory
>
#
include
<
string
>
#
include
<
vector
>
#
include
"
api
/
data_channel_interface
.
h
"
#
include
"
api
/
jsep
.
h
"
#
include
"
api
/
peer_connection_interface
.
h
"
#
include
"
api
/
rtp_receiver_interface
.
h
"
#
include
"
api
/
scoped_refptr
.
h
"
#
include
"
api
/
set_local_description_observer_interface
.
h
"
#
include
"
rtc_base
/
logging
.
h
"
#
include
"
rtc_base
/
thread
.
h
"
#
include
"
rtc_tools
/
data_channel_benchmark
/
signaling_interface
.
h
"
namespace
webrtc
{
class
PeerConnectionClient
:
public
webrtc
:
:
PeerConnectionObserver
{
public
:
explicit
PeerConnectionClient
(
webrtc
:
:
PeerConnectionFactoryInterface
*
factory
webrtc
:
:
SignalingInterface
*
signaling
)
;
~
PeerConnectionClient
(
)
override
;
PeerConnectionClient
(
const
PeerConnectionClient
&
)
=
delete
;
PeerConnectionClient
&
operator
=
(
const
PeerConnectionClient
&
)
=
delete
;
bool
StartPeerConnection
(
)
;
bool
IsConnected
(
)
;
void
Disconnect
(
)
;
scoped_refptr
<
webrtc
:
:
PeerConnectionInterface
>
peerConnection
(
)
{
return
peer_connection_
;
}
void
SetOnDataChannel
(
std
:
:
function
<
void
(
webrtc
:
:
scoped_refptr
<
webrtc
:
:
DataChannelInterface
>
)
>
callback
)
;
std
:
:
vector
<
scoped_refptr
<
webrtc
:
:
DataChannelInterface
>
>
&
dataChannels
(
)
{
return
data_channels_
;
}
static
scoped_refptr
<
webrtc
:
:
PeerConnectionFactoryInterface
>
CreateDefaultFactory
(
Thread
*
signaling_thread
)
;
private
:
void
AddIceCandidate
(
std
:
:
unique_ptr
<
webrtc
:
:
IceCandidate
>
candidate
)
;
bool
SetRemoteDescription
(
std
:
:
unique_ptr
<
webrtc
:
:
SessionDescriptionInterface
>
desc
)
;
bool
InitializePeerConnection
(
webrtc
:
:
PeerConnectionFactoryInterface
*
factory
)
;
void
DeletePeerConnection
(
)
;
void
OnSignalingChange
(
webrtc
:
:
PeerConnectionInterface
:
:
SignalingState
new_state
)
override
{
RTC_LOG
(
LS_INFO
)
<
<
__FUNCTION__
<
<
"
new
state
:
"
<
<
new_state
;
}
void
OnDataChannel
(
scoped_refptr
<
webrtc
:
:
DataChannelInterface
>
channel
)
override
;
void
OnNegotiationNeededEvent
(
uint32_t
event_id
)
override
;
void
OnIceConnectionChange
(
webrtc
:
:
PeerConnectionInterface
:
:
IceConnectionState
new_state
)
override
;
void
OnIceGatheringChange
(
webrtc
:
:
PeerConnectionInterface
:
:
IceGatheringState
new_state
)
override
;
void
OnIceCandidate
(
const
webrtc
:
:
IceCandidate
*
candidate
)
override
;
void
OnIceConnectionReceivingChange
(
bool
receiving
)
override
{
RTC_LOG
(
LS_INFO
)
<
<
__FUNCTION__
<
<
"
receiving
?
"
<
<
receiving
;
}
scoped_refptr
<
webrtc
:
:
PeerConnectionInterface
>
peer_connection_
;
std
:
:
function
<
void
(
webrtc
:
:
scoped_refptr
<
webrtc
:
:
DataChannelInterface
>
)
>
on_data_channel_callback_
;
std
:
:
vector
<
scoped_refptr
<
webrtc
:
:
DataChannelInterface
>
>
data_channels_
;
webrtc
:
:
SignalingInterface
*
signaling_
;
}
;
}
#
endif
