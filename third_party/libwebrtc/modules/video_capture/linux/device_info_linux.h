#
ifndef
MODULES_VIDEO_CAPTURE_MAIN_SOURCE_LINUX_DEVICE_INFO_LINUX_H_
#
define
MODULES_VIDEO_CAPTURE_MAIN_SOURCE_LINUX_DEVICE_INFO_LINUX_H_
#
include
<
stdint
.
h
>
#
include
"
modules
/
video_capture
/
device_info_impl
.
h
"
#
include
"
rtc_base
/
platform_thread
.
h
"
#
ifdef
WEBRTC_LINUX
#
include
<
sys
/
inotify
.
h
>
#
endif
struct
v4l2_capability
;
namespace
webrtc
{
namespace
videocapturemodule
{
class
DeviceInfoLinux
:
public
DeviceInfoImpl
{
public
:
DeviceInfoLinux
(
)
;
~
DeviceInfoLinux
(
)
override
;
uint32_t
NumberOfDevices
(
)
override
;
int32_t
GetDeviceName
(
uint32_t
deviceNumber
char
*
deviceNameUTF8
uint32_t
deviceNameLength
char
*
deviceUniqueIdUTF8
uint32_t
deviceUniqueIdUTF8Length
char
*
productUniqueIdUTF8
=
0
uint32_t
productUniqueIdUTF8Length
=
0
pid_t
*
pid
=
0
)
override
;
int32_t
CreateCapabilityMap
(
const
char
*
deviceUniqueIdUTF8
)
override
RTC_EXCLUSIVE_LOCKS_REQUIRED
(
_apiLock
)
;
int32_t
DisplayCaptureSettingsDialogBox
(
const
char
*
const
char
*
void
*
uint32_t
uint32_t
)
override
;
int32_t
FillCapabilities
(
int
fd
)
RTC_EXCLUSIVE_LOCKS_REQUIRED
(
_apiLock
)
;
int32_t
Init
(
)
override
;
private
:
bool
IsDeviceNameMatches
(
const
char
*
name
const
char
*
deviceUniqueIdUTF8
)
;
bool
IsVideoCaptureDevice
(
struct
v4l2_capability
*
cap
)
;
#
ifdef
WEBRTC_LINUX
void
HandleEvent
(
inotify_event
*
event
int
fd
)
;
int
EventCheck
(
int
fd
)
;
int
HandleEvents
(
int
fd
)
;
int
ProcessInotifyEvents
(
)
;
rtc
:
:
PlatformThread
_inotifyEventThread
;
void
InotifyProcess
(
)
;
int
_fd_v4l
_fd_dev
_wd_v4l
_wd_dev
;
std
:
:
atomic
<
bool
>
_isShutdown
;
#
endif
}
;
}
}
#
endif
