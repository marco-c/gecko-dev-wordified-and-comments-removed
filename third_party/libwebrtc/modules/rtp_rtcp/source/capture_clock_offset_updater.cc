#
include
"
modules
/
rtp_rtcp
/
source
/
capture_clock_offset_updater
.
h
"
#
include
<
cstdint
>
#
include
<
optional
>
#
include
"
api
/
units
/
time_delta
.
h
"
#
include
"
system_wrappers
/
include
/
ntp_time
.
h
"
namespace
webrtc
{
std
:
:
optional
<
int64_t
>
CaptureClockOffsetUpdater
:
:
AdjustEstimatedCaptureClockOffset
(
std
:
:
optional
<
int64_t
>
remote_capture_clock_offset
)
const
{
if
(
remote_capture_clock_offset
=
=
std
:
:
nullopt
|
|
remote_to_local_clock_offset_
=
=
std
:
:
nullopt
)
{
return
std
:
:
nullopt
;
}
return
static_cast
<
uint64_t
>
(
*
remote_capture_clock_offset
)
+
static_cast
<
uint64_t
>
(
*
remote_to_local_clock_offset_
)
;
}
std
:
:
optional
<
TimeDelta
>
CaptureClockOffsetUpdater
:
:
ConvertsToTimeDela
(
std
:
:
optional
<
int64_t
>
q32x32
)
{
if
(
q32x32
=
=
std
:
:
nullopt
)
{
return
std
:
:
nullopt
;
}
return
TimeDelta
:
:
Millis
(
Q32x32ToInt64Ms
(
*
q32x32
)
)
;
}
void
CaptureClockOffsetUpdater
:
:
SetRemoteToLocalClockOffset
(
std
:
:
optional
<
int64_t
>
offset_q32x32
)
{
remote_to_local_clock_offset_
=
offset_q32x32
;
}
}
