#
include
"
modules
/
rtp_rtcp
/
include
/
rtp_header_extension_map
.
h
"
#
include
<
vector
>
#
include
"
api
/
rtp_parameters
.
h
"
#
include
"
modules
/
rtp_rtcp
/
source
/
rtp_header_extensions
.
h
"
#
include
"
test
/
gtest
.
h
"
namespace
webrtc
{
TEST
(
RtpHeaderExtensionTest
RegisterByType
)
{
RtpHeaderExtensionMap
map
;
EXPECT_FALSE
(
map
.
IsRegistered
(
TransmissionOffset
:
:
kId
)
)
;
EXPECT_TRUE
(
map
.
RegisterByType
(
3
TransmissionOffset
:
:
kId
)
)
;
EXPECT_TRUE
(
map
.
IsRegistered
(
TransmissionOffset
:
:
kId
)
)
;
EXPECT_EQ
(
3
map
.
GetId
(
TransmissionOffset
:
:
kId
)
)
;
EXPECT_EQ
(
TransmissionOffset
:
:
kId
map
.
GetType
(
3
)
)
;
}
TEST
(
RtpHeaderExtensionTest
RegisterByUri
)
{
RtpHeaderExtensionMap
map
;
EXPECT_TRUE
(
map
.
RegisterByUri
(
3
TransmissionOffset
:
:
Uri
(
)
)
)
;
EXPECT_TRUE
(
map
.
IsRegistered
(
TransmissionOffset
:
:
kId
)
)
;
EXPECT_EQ
(
3
map
.
GetId
(
TransmissionOffset
:
:
kId
)
)
;
EXPECT_EQ
(
TransmissionOffset
:
:
kId
map
.
GetType
(
3
)
)
;
}
TEST
(
RtpHeaderExtensionTest
RegisterWithTrait
)
{
RtpHeaderExtensionMap
map
;
EXPECT_TRUE
(
map
.
Register
<
TransmissionOffset
>
(
3
)
)
;
EXPECT_TRUE
(
map
.
IsRegistered
(
TransmissionOffset
:
:
kId
)
)
;
EXPECT_EQ
(
3
map
.
GetId
(
TransmissionOffset
:
:
kId
)
)
;
EXPECT_EQ
(
TransmissionOffset
:
:
kId
map
.
GetType
(
3
)
)
;
}
TEST
(
RtpHeaderExtensionTest
RegisterDuringContruction
)
{
const
std
:
:
vector
<
RtpExtension
>
config
=
{
{
TransmissionOffset
:
:
Uri
(
)
1
}
{
AbsoluteSendTime
:
:
Uri
(
)
3
}
}
;
const
RtpHeaderExtensionMap
map
(
config
)
;
EXPECT_EQ
(
1
map
.
GetId
(
TransmissionOffset
:
:
kId
)
)
;
EXPECT_EQ
(
3
map
.
GetId
(
AbsoluteSendTime
:
:
kId
)
)
;
}
TEST
(
RtpHeaderExtensionTest
RegisterTwoByteHeaderExtensions
)
{
RtpHeaderExtensionMap
map
;
EXPECT_TRUE
(
map
.
Register
<
TransmissionOffset
>
(
18
)
)
;
EXPECT_TRUE
(
map
.
Register
<
AbsoluteSendTime
>
(
255
)
)
;
}
TEST
(
RtpHeaderExtensionTest
RegisterIllegalArg
)
{
RtpHeaderExtensionMap
map
;
EXPECT_FALSE
(
map
.
Register
<
TransmissionOffset
>
(
0
)
)
;
EXPECT_FALSE
(
map
.
Register
<
TransmissionOffset
>
(
256
)
)
;
}
TEST
(
RtpHeaderExtensionTest
Idempotent
)
{
RtpHeaderExtensionMap
map
;
EXPECT_TRUE
(
map
.
Register
<
TransmissionOffset
>
(
3
)
)
;
EXPECT_TRUE
(
map
.
Register
<
TransmissionOffset
>
(
3
)
)
;
map
.
Deregister
(
TransmissionOffset
:
:
Uri
(
)
)
;
map
.
Deregister
(
TransmissionOffset
:
:
Uri
(
)
)
;
}
TEST
(
RtpHeaderExtensionTest
NonUniqueId
)
{
RtpHeaderExtensionMap
map
;
EXPECT_TRUE
(
map
.
Register
<
TransmissionOffset
>
(
3
)
)
;
EXPECT_FALSE
(
map
.
Register
<
AudioLevelExtension
>
(
3
)
)
;
EXPECT_TRUE
(
map
.
Register
<
AudioLevelExtension
>
(
4
)
)
;
}
TEST
(
RtpHeaderExtensionTest
GetType
)
{
RtpHeaderExtensionMap
map
;
EXPECT_EQ
(
RtpHeaderExtensionMap
:
:
kInvalidType
map
.
GetType
(
3
)
)
;
EXPECT_TRUE
(
map
.
Register
<
TransmissionOffset
>
(
3
)
)
;
EXPECT_EQ
(
TransmissionOffset
:
:
kId
map
.
GetType
(
3
)
)
;
}
TEST
(
RtpHeaderExtensionTest
GetId
)
{
RtpHeaderExtensionMap
map
;
EXPECT_EQ
(
RtpHeaderExtensionMap
:
:
kInvalidId
map
.
GetId
(
TransmissionOffset
:
:
kId
)
)
;
EXPECT_TRUE
(
map
.
Register
<
TransmissionOffset
>
(
3
)
)
;
EXPECT_EQ
(
3
map
.
GetId
(
TransmissionOffset
:
:
kId
)
)
;
}
TEST
(
RtpHeaderExtensionTest
RemapFails
)
{
RtpHeaderExtensionMap
map
;
EXPECT_TRUE
(
map
.
Register
<
TransmissionOffset
>
(
3
)
)
;
EXPECT_FALSE
(
map
.
Register
<
TransmissionOffset
>
(
4
)
)
;
}
}
