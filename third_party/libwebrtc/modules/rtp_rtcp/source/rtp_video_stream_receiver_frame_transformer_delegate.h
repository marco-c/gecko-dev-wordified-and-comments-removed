#
ifndef
MODULES_RTP_RTCP_SOURCE_RTP_VIDEO_STREAM_RECEIVER_FRAME_TRANSFORMER_DELEGATE_H_
#
define
MODULES_RTP_RTCP_SOURCE_RTP_VIDEO_STREAM_RECEIVER_FRAME_TRANSFORMER_DELEGATE_H_
#
include
<
cstdint
>
#
include
<
memory
>
#
include
"
api
/
frame_transformer_interface
.
h
"
#
include
"
api
/
scoped_refptr
.
h
"
#
include
"
api
/
sequence_checker
.
h
"
#
include
"
modules
/
rtp_rtcp
/
source
/
frame_object
.
h
"
#
include
"
rtc_base
/
system
/
no_unique_address
.
h
"
#
include
"
rtc_base
/
thread
.
h
"
#
include
"
rtc_base
/
thread_annotations
.
h
"
#
include
"
system_wrappers
/
include
/
clock
.
h
"
namespace
webrtc
{
class
RtpVideoFrameReceiver
{
public
:
virtual
void
ManageFrame
(
std
:
:
unique_ptr
<
RtpFrameObject
>
frame
)
=
0
;
protected
:
virtual
~
RtpVideoFrameReceiver
(
)
=
default
;
}
;
class
RtpVideoStreamReceiverFrameTransformerDelegate
:
public
TransformedFrameCallback
{
public
:
RtpVideoStreamReceiverFrameTransformerDelegate
(
RtpVideoFrameReceiver
*
receiver
Clock
*
clock
scoped_refptr
<
FrameTransformerInterface
>
frame_transformer
TaskQueueBase
*
network_thread
uint32_t
ssrc
)
;
void
Init
(
)
;
void
Reset
(
)
;
void
TransformFrame
(
std
:
:
unique_ptr
<
RtpFrameObject
>
frame
)
;
void
OnTransformedFrame
(
std
:
:
unique_ptr
<
TransformableFrameInterface
>
frame
)
override
;
void
StartShortCircuiting
(
)
override
;
void
ManageFrame
(
std
:
:
unique_ptr
<
TransformableFrameInterface
>
frame
)
;
protected
:
~
RtpVideoStreamReceiverFrameTransformerDelegate
(
)
override
=
default
;
private
:
void
StartShortCircuitingOnNetworkSequence
(
)
;
RTC_NO_UNIQUE_ADDRESS
SequenceChecker
network_sequence_checker_
;
RtpVideoFrameReceiver
*
receiver_
RTC_GUARDED_BY
(
network_sequence_checker_
)
;
scoped_refptr
<
FrameTransformerInterface
>
frame_transformer_
RTC_GUARDED_BY
(
network_sequence_checker_
)
;
TaskQueueBase
*
const
network_thread_
;
const
uint32_t
ssrc_
;
Clock
*
const
clock_
;
bool
short_circuit_
RTC_GUARDED_BY
(
network_sequence_checker_
)
=
false
;
}
;
}
#
endif
