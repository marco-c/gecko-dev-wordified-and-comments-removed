#
include
"
modules
/
rtp_rtcp
/
source
/
rtp_header_extension_size
.
h
"
#
include
"
api
/
array_view
.
h
"
#
include
"
api
/
rtp_parameters
.
h
"
#
include
"
modules
/
rtp_rtcp
/
include
/
rtp_header_extension_map
.
h
"
namespace
webrtc
{
int
RtpHeaderExtensionSize
(
ArrayView
<
const
RtpExtensionSize
>
extensions
const
RtpHeaderExtensionMap
&
registered_extensions
)
{
static
constexpr
int
kExtensionBlockHeaderSize
=
4
;
int
values_size
=
0
;
int
num_extensions
=
0
;
int
each_extension_header_size
=
1
;
for
(
const
RtpExtensionSize
&
extension
:
extensions
)
{
int
id
=
registered_extensions
.
GetId
(
extension
.
type
)
;
if
(
id
=
=
RtpHeaderExtensionMap
:
:
kInvalidId
)
continue
;
if
(
id
>
RtpExtension
:
:
kOneByteHeaderExtensionMaxId
|
|
extension
.
value_size
>
RtpExtension
:
:
kOneByteHeaderExtensionMaxValueSize
)
{
each_extension_header_size
=
2
;
}
values_size
+
=
extension
.
value_size
;
num_extensions
+
+
;
}
if
(
values_size
=
=
0
)
return
0
;
int
size
=
kExtensionBlockHeaderSize
+
each_extension_header_size
*
num_extensions
+
values_size
;
return
size
+
3
-
(
size
+
3
)
%
4
;
}
}
