#
ifndef
MODULES_RTP_RTCP_SOURCE_ABSOLUTE_CAPTURE_TIME_INTERPOLATOR_H_
#
define
MODULES_RTP_RTCP_SOURCE_ABSOLUTE_CAPTURE_TIME_INTERPOLATOR_H_
#
include
"
api
/
array_view
.
h
"
#
include
"
api
/
rtp_headers
.
h
"
#
include
"
api
/
units
/
time_delta
.
h
"
#
include
"
api
/
units
/
timestamp
.
h
"
#
include
"
rtc_base
/
synchronization
/
mutex
.
h
"
#
include
"
rtc_base
/
thread_annotations
.
h
"
#
include
"
system_wrappers
/
include
/
clock
.
h
"
namespace
webrtc
{
class
AbsoluteCaptureTimeInterpolator
{
public
:
static
constexpr
TimeDelta
kInterpolationMaxInterval
=
TimeDelta
:
:
Millis
(
5000
)
;
explicit
AbsoluteCaptureTimeInterpolator
(
Clock
*
clock
)
;
static
uint32_t
GetSource
(
uint32_t
ssrc
rtc
:
:
ArrayView
<
const
uint32_t
>
csrcs
)
;
absl
:
:
optional
<
AbsoluteCaptureTime
>
OnReceivePacket
(
uint32_t
source
uint32_t
rtp_timestamp
uint32_t
rtp_clock_frequency
const
absl
:
:
optional
<
AbsoluteCaptureTime
>
&
received_extension
)
;
private
:
friend
class
AbsoluteCaptureTimeSender
;
static
uint64_t
InterpolateAbsoluteCaptureTimestamp
(
uint32_t
rtp_timestamp
uint32_t
rtp_clock_frequency
uint32_t
last_rtp_timestamp
uint64_t
last_absolute_capture_timestamp
)
;
bool
ShouldInterpolateExtension
(
Timestamp
receive_time
uint32_t
source
uint32_t
rtp_timestamp
uint32_t
rtp_clock_frequency
)
const
RTC_EXCLUSIVE_LOCKS_REQUIRED
(
mutex_
)
;
Clock
*
const
clock_
;
Mutex
mutex_
;
Timestamp
last_receive_time_
RTC_GUARDED_BY
(
mutex_
)
;
uint32_t
last_source_
RTC_GUARDED_BY
(
mutex_
)
;
uint32_t
last_rtp_timestamp_
RTC_GUARDED_BY
(
mutex_
)
;
uint32_t
last_rtp_clock_frequency_
RTC_GUARDED_BY
(
mutex_
)
;
uint64_t
last_absolute_capture_timestamp_
RTC_GUARDED_BY
(
mutex_
)
;
absl
:
:
optional
<
int64_t
>
last_estimated_capture_clock_offset_
RTC_GUARDED_BY
(
mutex_
)
;
}
;
}
#
endif
