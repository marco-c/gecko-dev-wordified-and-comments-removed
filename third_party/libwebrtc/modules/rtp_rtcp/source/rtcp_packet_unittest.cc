#
include
"
modules
/
rtp_rtcp
/
source
/
rtcp_packet
.
h
"
#
include
<
cstddef
>
#
include
<
cstdint
>
#
include
"
api
/
array_view
.
h
"
#
include
"
modules
/
rtp_rtcp
/
source
/
rtcp_packet
/
receiver_report
.
h
"
#
include
"
modules
/
rtp_rtcp
/
source
/
rtcp_packet
/
report_block
.
h
"
#
include
"
test
/
gmock
.
h
"
#
include
"
test
/
gtest
.
h
"
namespace
{
using
:
:
testing
:
:
_
;
using
:
:
testing
:
:
MockFunction
;
using
:
:
webrtc
:
:
rtcp
:
:
ReceiverReport
;
using
:
:
webrtc
:
:
rtcp
:
:
ReportBlock
;
const
uint32_t
kSenderSsrc
=
0x12345678
;
TEST
(
RtcpPacketTest
BuildWithTooSmallBuffer
)
{
ReportBlock
rb
;
ReceiverReport
rr
;
rr
.
SetSenderSsrc
(
kSenderSsrc
)
;
EXPECT_TRUE
(
rr
.
AddReportBlock
(
rb
)
)
;
const
size_t
kRrLength
=
8
;
const
size_t
kReportBlockLength
=
24
;
MockFunction
<
void
(
webrtc
:
:
ArrayView
<
const
uint8_t
>
)
>
callback
;
EXPECT_CALL
(
callback
Call
(
_
)
)
.
Times
(
0
)
;
const
size_t
kBufferSize
=
kRrLength
+
kReportBlockLength
-
1
;
EXPECT_FALSE
(
rr
.
Build
(
kBufferSize
callback
.
AsStdFunction
(
)
)
)
;
}
}
