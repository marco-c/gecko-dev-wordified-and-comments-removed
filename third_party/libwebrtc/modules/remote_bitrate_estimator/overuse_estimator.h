#
ifndef
MODULES_REMOTE_BITRATE_ESTIMATOR_OVERUSE_ESTIMATOR_H_
#
define
MODULES_REMOTE_BITRATE_ESTIMATOR_OVERUSE_ESTIMATOR_H_
#
include
<
stdint
.
h
>
#
include
<
deque
>
#
include
"
api
/
network_state_predictor
.
h
"
#
include
"
rtc_base
/
constructor_magic
.
h
"
namespace
webrtc
{
struct
OverUseDetectorOptions
{
OverUseDetectorOptions
(
)
=
default
;
double
initial_slope
=
8
.
0
/
512
.
0
;
double
initial_offset
=
0
;
double
initial_e
[
2
]
[
2
]
=
{
{
100
.
0
0
.
0
}
{
0
.
0
1e
-
1
}
}
;
double
initial_process_noise
[
2
]
=
{
1e
-
13
1e
-
3
}
;
double
initial_avg_noise
=
0
.
0
;
double
initial_var_noise
=
50
.
0
;
}
;
class
OveruseEstimator
{
public
:
explicit
OveruseEstimator
(
const
OverUseDetectorOptions
&
options
)
;
~
OveruseEstimator
(
)
;
void
Update
(
int64_t
t_delta
double
ts_delta
int
size_delta
BandwidthUsage
current_hypothesis
int64_t
now_ms
)
;
double
var_noise
(
)
const
{
return
var_noise_
;
}
double
offset
(
)
const
{
return
offset_
;
}
unsigned
int
num_of_deltas
(
)
const
{
return
num_of_deltas_
;
}
private
:
double
UpdateMinFramePeriod
(
double
ts_delta
)
;
void
UpdateNoiseEstimate
(
double
residual
double
ts_delta
bool
stable_state
)
;
OverUseDetectorOptions
options_
;
uint16_t
num_of_deltas_
;
double
slope_
;
double
offset_
;
double
prev_offset_
;
double
E_
[
2
]
[
2
]
;
double
process_noise_
[
2
]
;
double
avg_noise_
;
double
var_noise_
;
std
:
:
deque
<
double
>
ts_delta_hist_
;
RTC_DISALLOW_COPY_AND_ASSIGN
(
OveruseEstimator
)
;
}
;
}
#
endif
