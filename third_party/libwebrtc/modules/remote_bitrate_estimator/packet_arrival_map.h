#
ifndef
MODULES_REMOTE_BITRATE_ESTIMATOR_PACKET_ARRIVAL_MAP_H_
#
define
MODULES_REMOTE_BITRATE_ESTIMATOR_PACKET_ARRIVAL_MAP_H_
#
include
<
cstddef
>
#
include
<
cstdint
>
#
include
<
deque
>
#
include
"
api
/
units
/
timestamp
.
h
"
#
include
"
rtc_base
/
checks
.
h
"
namespace
webrtc
{
class
PacketArrivalTimeMap
{
public
:
static
constexpr
size_t
kMaxNumberOfPackets
=
(
1
<
<
15
)
;
bool
has_received
(
int64_t
sequence_number
)
const
;
int64_t
begin_sequence_number
(
)
const
{
return
begin_sequence_number_
;
}
int64_t
end_sequence_number
(
)
const
{
return
begin_sequence_number_
+
arrival_times_
.
size
(
)
;
}
Timestamp
get
(
int64_t
sequence_number
)
{
int64_t
pos
=
sequence_number
-
begin_sequence_number_
;
RTC_DCHECK
(
pos
>
=
0
&
&
pos
<
static_cast
<
int64_t
>
(
arrival_times_
.
size
(
)
)
)
;
return
arrival_times_
[
pos
]
;
}
int64_t
clamp
(
int64_t
sequence_number
)
const
;
void
EraseTo
(
int64_t
sequence_number
)
;
void
AddPacket
(
int64_t
sequence_number
Timestamp
arrival_time
)
;
void
RemoveOldPackets
(
int64_t
sequence_number
Timestamp
arrival_time_limit
)
;
private
:
std
:
:
deque
<
Timestamp
>
arrival_times_
;
int64_t
begin_sequence_number_
=
0
;
bool
has_seen_packet_
=
false
;
}
;
}
#
endif
