#
include
"
modules
/
desktop_capture
/
cropped_desktop_frame
.
h
"
#
include
<
memory
>
#
include
<
utility
>
#
include
"
modules
/
desktop_capture
/
desktop_frame
.
h
"
#
include
"
modules
/
desktop_capture
/
desktop_geometry
.
h
"
#
include
"
modules
/
desktop_capture
/
desktop_region
.
h
"
#
include
"
rtc_base
/
checks
.
h
"
namespace
webrtc
{
class
CroppedDesktopFrame
:
public
DesktopFrame
{
public
:
CroppedDesktopFrame
(
std
:
:
unique_ptr
<
DesktopFrame
>
frame
const
DesktopRect
&
rect
)
;
CroppedDesktopFrame
(
const
CroppedDesktopFrame
&
)
=
delete
;
CroppedDesktopFrame
&
operator
=
(
const
CroppedDesktopFrame
&
)
=
delete
;
private
:
const
std
:
:
unique_ptr
<
DesktopFrame
>
frame_
;
}
;
std
:
:
unique_ptr
<
DesktopFrame
>
CreateCroppedDesktopFrame
(
std
:
:
unique_ptr
<
DesktopFrame
>
frame
const
DesktopRect
&
rect
)
{
RTC_DCHECK
(
frame
)
;
DesktopRect
intersection
=
DesktopRect
:
:
MakeSize
(
frame
-
>
size
(
)
)
;
intersection
.
IntersectWith
(
rect
)
;
if
(
intersection
.
is_empty
(
)
)
{
return
nullptr
;
}
if
(
frame
-
>
size
(
)
.
equals
(
rect
.
size
(
)
)
)
{
return
frame
;
}
return
std
:
:
unique_ptr
<
DesktopFrame
>
(
new
CroppedDesktopFrame
(
std
:
:
move
(
frame
)
intersection
)
)
;
}
CroppedDesktopFrame
:
:
CroppedDesktopFrame
(
std
:
:
unique_ptr
<
DesktopFrame
>
frame
const
DesktopRect
&
rect
)
:
DesktopFrame
(
rect
.
size
(
)
frame
-
>
stride
(
)
frame
-
>
GetFrameDataAtPos
(
rect
.
top_left
(
)
)
frame
-
>
shared_memory
(
)
)
frame_
(
std
:
:
move
(
frame
)
)
{
MoveFrameInfoFrom
(
frame_
.
get
(
)
)
;
set_top_left
(
frame_
-
>
top_left
(
)
.
add
(
rect
.
top_left
(
)
)
)
;
mutable_updated_region
(
)
-
>
IntersectWith
(
rect
)
;
mutable_updated_region
(
)
-
>
Translate
(
-
rect
.
left
(
)
-
rect
.
top
(
)
)
;
}
}
