#
include
"
modules
/
desktop_capture
/
linux
/
x11
/
x_window_property
.
h
"
#
include
<
X11
/
X
.
h
>
#
include
<
X11
/
Xlib
.
h
>
namespace
webrtc
{
XWindowPropertyBase
:
:
XWindowPropertyBase
(
Display
*
display
Window
window
Atom
property
int
expected_size
)
{
const
int
kBitsPerByte
=
8
;
Atom
actual_type
;
int
actual_format
;
unsigned
long
bytes_after
;
int
status
=
XGetWindowProperty
(
display
window
property
0L
~
0L
False
AnyPropertyType
&
actual_type
&
actual_format
&
size_
&
bytes_after
&
data_
)
;
if
(
status
!
=
Success
)
{
data_
=
nullptr
;
return
;
}
if
(
(
expected_size
*
kBitsPerByte
)
!
=
actual_format
)
{
size_
=
0
;
return
;
}
is_valid_
=
true
;
}
XWindowPropertyBase
:
:
~
XWindowPropertyBase
(
)
{
if
(
data_
)
XFree
(
data_
)
;
}
}
