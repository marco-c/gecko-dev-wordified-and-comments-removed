#
ifndef
MODULES_DESKTOP_CAPTURE_LINUX_X11_X_SERVER_PIXEL_BUFFER_H_
#
define
MODULES_DESKTOP_CAPTURE_LINUX_X11_X_SERVER_PIXEL_BUFFER_H_
#
include
<
X11
/
Xutil
.
h
>
#
include
<
X11
/
extensions
/
XShm
.
h
>
#
include
<
memory
>
#
include
<
vector
>
#
include
"
modules
/
desktop_capture
/
desktop_geometry
.
h
"
#
include
"
rtc_base
/
constructor_magic
.
h
"
namespace
webrtc
{
class
DesktopFrame
;
class
XAtomCache
;
class
XServerPixelBuffer
{
public
:
XServerPixelBuffer
(
)
;
~
XServerPixelBuffer
(
)
;
void
Release
(
)
;
bool
Init
(
XAtomCache
*
cache
Window
window
)
;
bool
is_initialized
(
)
{
return
window_
!
=
0
;
}
DesktopSize
window_size
(
)
{
return
window_rect_
.
size
(
)
;
}
const
DesktopRect
&
window_rect
(
)
{
return
window_rect_
;
}
bool
IsWindowValid
(
)
const
;
void
Synchronize
(
)
;
bool
CaptureRect
(
const
DesktopRect
&
rect
DesktopFrame
*
frame
)
;
private
:
void
ReleaseSharedMemorySegment
(
)
;
void
InitShm
(
const
XWindowAttributes
&
attributes
)
;
bool
InitPixmaps
(
int
depth
)
;
Display
*
display_
=
nullptr
;
Window
window_
=
0
;
DesktopRect
window_rect_
;
XImage
*
x_image_
=
nullptr
;
XShmSegmentInfo
*
shm_segment_info_
=
nullptr
;
XImage
*
x_shm_image_
=
nullptr
;
Pixmap
shm_pixmap_
=
0
;
GC
shm_gc_
=
nullptr
;
bool
xshm_get_image_succeeded_
=
false
;
std
:
:
vector
<
uint8_t
>
icc_profile_
;
RTC_DISALLOW_COPY_AND_ASSIGN
(
XServerPixelBuffer
)
;
}
;
}
#
endif
