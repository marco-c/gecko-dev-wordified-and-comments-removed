#
ifndef
MODULES_AUDIO_PROCESSING_AGC2_RNN_VAD_SPECTRAL_FEATURES_H_
#
define
MODULES_AUDIO_PROCESSING_AGC2_RNN_VAD_SPECTRAL_FEATURES_H_
#
include
<
array
>
#
include
<
cstddef
>
#
include
<
memory
>
#
include
<
vector
>
#
include
"
api
/
array_view
.
h
"
#
include
"
modules
/
audio_processing
/
agc2
/
rnn_vad
/
common
.
h
"
#
include
"
modules
/
audio_processing
/
agc2
/
rnn_vad
/
ring_buffer
.
h
"
#
include
"
modules
/
audio_processing
/
agc2
/
rnn_vad
/
spectral_features_internal
.
h
"
#
include
"
modules
/
audio_processing
/
agc2
/
rnn_vad
/
symmetric_matrix_buffer
.
h
"
#
include
"
modules
/
audio_processing
/
utility
/
pffft_wrapper
.
h
"
namespace
webrtc
{
namespace
rnn_vad
{
class
SpectralFeaturesExtractor
{
public
:
SpectralFeaturesExtractor
(
)
;
SpectralFeaturesExtractor
(
const
SpectralFeaturesExtractor
&
)
=
delete
;
SpectralFeaturesExtractor
&
operator
=
(
const
SpectralFeaturesExtractor
&
)
=
delete
;
~
SpectralFeaturesExtractor
(
)
;
void
Reset
(
)
;
bool
CheckSilenceComputeFeatures
(
rtc
:
:
ArrayView
<
const
float
kFrameSize20ms24kHz
>
reference_frame
rtc
:
:
ArrayView
<
const
float
kFrameSize20ms24kHz
>
lagged_frame
rtc
:
:
ArrayView
<
float
kNumBands
-
kNumLowerBands
>
higher_bands_cepstrum
rtc
:
:
ArrayView
<
float
kNumLowerBands
>
average
rtc
:
:
ArrayView
<
float
kNumLowerBands
>
first_derivative
rtc
:
:
ArrayView
<
float
kNumLowerBands
>
second_derivative
rtc
:
:
ArrayView
<
float
kNumLowerBands
>
bands_cross_corr
float
*
variability
)
;
private
:
void
ComputeAvgAndDerivatives
(
rtc
:
:
ArrayView
<
float
kNumLowerBands
>
average
rtc
:
:
ArrayView
<
float
kNumLowerBands
>
first_derivative
rtc
:
:
ArrayView
<
float
kNumLowerBands
>
second_derivative
)
const
;
void
ComputeNormalizedCepstralCorrelation
(
rtc
:
:
ArrayView
<
float
kNumLowerBands
>
bands_cross_corr
)
;
float
ComputeVariability
(
)
const
;
const
std
:
:
array
<
float
kFrameSize20ms24kHz
/
2
>
half_window_
;
Pffft
fft_
;
std
:
:
unique_ptr
<
Pffft
:
:
FloatBuffer
>
fft_buffer_
;
std
:
:
unique_ptr
<
Pffft
:
:
FloatBuffer
>
reference_frame_fft_
;
std
:
:
unique_ptr
<
Pffft
:
:
FloatBuffer
>
lagged_frame_fft_
;
SpectralCorrelator
spectral_correlator_
;
std
:
:
array
<
float
kOpusBands24kHz
>
reference_frame_bands_energy_
;
std
:
:
array
<
float
kOpusBands24kHz
>
lagged_frame_bands_energy_
;
std
:
:
array
<
float
kOpusBands24kHz
>
bands_cross_corr_
;
const
std
:
:
array
<
float
kNumBands
*
kNumBands
>
dct_table_
;
RingBuffer
<
float
kNumBands
kCepstralCoeffsHistorySize
>
cepstral_coeffs_ring_buf_
;
SymmetricMatrixBuffer
<
float
kCepstralCoeffsHistorySize
>
cepstral_diffs_buf_
;
}
;
}
}
#
endif
