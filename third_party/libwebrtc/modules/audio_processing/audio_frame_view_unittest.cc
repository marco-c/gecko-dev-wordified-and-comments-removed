#
include
"
modules
/
audio_processing
/
include
/
audio_frame_view
.
h
"
#
include
"
modules
/
audio_processing
/
audio_buffer
.
h
"
#
include
"
test
/
gtest
.
h
"
namespace
webrtc
{
TEST
(
AudioFrameTest
ConstructFromAudioBuffer
)
{
constexpr
int
kSampleRateHz
=
48000
;
constexpr
int
kNumChannels
=
2
;
constexpr
float
kFloatConstant
=
1272
.
f
;
constexpr
float
kIntConstant
=
17252
;
const
webrtc
:
:
StreamConfig
stream_config
(
kSampleRateHz
kNumChannels
false
)
;
webrtc
:
:
AudioBuffer
buffer
(
stream_config
.
sample_rate_hz
(
)
stream_config
.
num_channels
(
)
stream_config
.
sample_rate_hz
(
)
stream_config
.
num_channels
(
)
stream_config
.
sample_rate_hz
(
)
stream_config
.
num_channels
(
)
)
;
AudioFrameView
<
float
>
non_const_view
(
buffer
.
channels
(
)
buffer
.
num_channels
(
)
buffer
.
num_frames
(
)
)
;
non_const_view
.
channel
(
0
)
[
0
]
=
kFloatConstant
;
EXPECT_EQ
(
buffer
.
channels
(
)
[
0
]
[
0
]
kFloatConstant
)
;
AudioFrameView
<
const
float
>
const_view
(
buffer
.
channels
(
)
buffer
.
num_channels
(
)
buffer
.
num_frames
(
)
)
;
AudioFrameView
<
const
float
>
other_const_view
=
non_const_view
;
static_cast
<
void
>
(
other_const_view
)
;
AudioFrameView
<
float
>
non_const_float_view
(
buffer
.
channels
(
)
buffer
.
num_channels
(
)
buffer
.
num_frames
(
)
)
;
non_const_float_view
.
channel
(
0
)
[
0
]
=
kIntConstant
;
EXPECT_EQ
(
buffer
.
channels
(
)
[
0
]
[
0
]
kIntConstant
)
;
}
}
