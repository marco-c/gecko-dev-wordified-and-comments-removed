#
ifndef
MODULES_AUDIO_PROCESSING_AGC_CLIPPING_PREDICTOR_EVALUATOR_H_
#
define
MODULES_AUDIO_PROCESSING_AGC_CLIPPING_PREDICTOR_EVALUATOR_H_
#
include
<
vector
>
#
include
"
absl
/
types
/
optional
.
h
"
namespace
webrtc
{
struct
ClippingPredictionCounters
{
int
true_positives
;
int
true_negatives
;
int
false_positives
;
int
false_negatives
;
}
;
class
ClippingPredictorEvaluator
{
public
:
explicit
ClippingPredictorEvaluator
(
int
history_size
)
;
ClippingPredictorEvaluator
(
const
ClippingPredictorEvaluator
&
)
=
delete
;
ClippingPredictorEvaluator
&
operator
=
(
const
ClippingPredictorEvaluator
&
)
=
delete
;
~
ClippingPredictorEvaluator
(
)
;
absl
:
:
optional
<
int
>
Observe
(
bool
clipping_detected
bool
clipping_predicted
)
;
void
RemoveExpectations
(
)
;
void
Reset
(
)
;
ClippingPredictionCounters
counters
(
)
const
{
return
counters_
;
}
private
:
const
int
history_size_
;
struct
ExpectedDetection
{
int
ttl
;
bool
detected
;
}
;
const
int
ring_buffer_capacity_
;
std
:
:
vector
<
ExpectedDetection
>
ring_buffer_
;
int
ring_buffer_tail_
;
int
ring_buffer_size_
;
void
Push
(
ExpectedDetection
expected_detection
)
;
void
DecreaseTimesToLive
(
)
;
absl
:
:
optional
<
int
>
FindEarliestPredictionInterval
(
)
const
;
int
MarkExpectedDetectionAsDetected
(
)
;
bool
HasExpiredUnmatchedExpectedDetection
(
)
const
;
ClippingPredictionCounters
counters_
;
}
;
struct
ClippingPredictionMetrics
{
float
precision
;
float
recall
;
float
f1_score
;
}
;
absl
:
:
optional
<
ClippingPredictionMetrics
>
ComputeClippingPredictionMetrics
(
const
ClippingPredictionCounters
&
counters
)
;
}
#
endif
