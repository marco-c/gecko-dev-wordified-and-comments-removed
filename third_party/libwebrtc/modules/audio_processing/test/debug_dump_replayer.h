#
ifndef
MODULES_AUDIO_PROCESSING_TEST_DEBUG_DUMP_REPLAYER_H_
#
define
MODULES_AUDIO_PROCESSING_TEST_DEBUG_DUMP_REPLAYER_H_
#
include
<
cstdio
>
#
include
<
memory
>
#
include
<
optional
>
#
include
"
absl
/
strings
/
string_view
.
h
"
#
include
"
api
/
audio
/
audio_processing
.
h
"
#
include
"
api
/
scoped_refptr
.
h
"
#
include
"
common_audio
/
channel_buffer
.
h
"
#
include
"
modules
/
audio_processing
/
debug
.
pb
.
h
"
namespace
webrtc
{
namespace
test
{
class
DebugDumpReplayer
{
public
:
DebugDumpReplayer
(
)
;
~
DebugDumpReplayer
(
)
;
bool
SetDumpFile
(
absl
:
:
string_view
filename
)
;
std
:
:
optional
<
audioproc
:
:
Event
>
GetNextEvent
(
)
const
;
bool
RunNextEvent
(
)
;
const
ChannelBuffer
<
float
>
*
GetOutput
(
)
const
;
StreamConfig
GetOutputConfig
(
)
const
;
private
:
void
OnInitEvent
(
const
audioproc
:
:
Init
&
msg
)
;
void
OnStreamEvent
(
const
audioproc
:
:
Stream
&
msg
)
;
void
OnReverseStreamEvent
(
const
audioproc
:
:
ReverseStream
&
msg
)
;
void
OnConfigEvent
(
const
audioproc
:
:
Config
&
msg
)
;
void
OnRuntimeSettingEvent
(
const
audioproc
:
:
RuntimeSetting
&
msg
)
;
void
MaybeRecreateApm
(
const
audioproc
:
:
Config
&
msg
)
;
void
ConfigureApm
(
const
audioproc
:
:
Config
&
msg
)
;
void
LoadNextMessage
(
)
;
std
:
:
unique_ptr
<
ChannelBuffer
<
float
>
>
input_
;
std
:
:
unique_ptr
<
ChannelBuffer
<
float
>
>
reverse_
;
std
:
:
unique_ptr
<
ChannelBuffer
<
float
>
>
output_
;
scoped_refptr
<
AudioProcessing
>
apm_
;
FILE
*
debug_file_
;
StreamConfig
input_config_
;
StreamConfig
reverse_config_
;
StreamConfig
output_config_
;
bool
has_next_event_
;
audioproc
:
:
Event
next_event_
;
}
;
}
}
#
endif
