#
ifndef
MODULES_AUDIO_PROCESSING_AEC3_ECHO_PATH_DELAY_ESTIMATOR_H_
#
define
MODULES_AUDIO_PROCESSING_AEC3_ECHO_PATH_DELAY_ESTIMATOR_H_
#
include
<
cstddef
>
#
include
<
optional
>
#
include
"
modules
/
audio_processing
/
aec3
/
alignment_mixer
.
h
"
#
include
"
modules
/
audio_processing
/
aec3
/
block
.
h
"
#
include
"
modules
/
audio_processing
/
aec3
/
clockdrift_detector
.
h
"
#
include
"
modules
/
audio_processing
/
aec3
/
decimator
.
h
"
#
include
"
modules
/
audio_processing
/
aec3
/
delay_estimate
.
h
"
#
include
"
modules
/
audio_processing
/
aec3
/
matched_filter
.
h
"
#
include
"
modules
/
audio_processing
/
aec3
/
matched_filter_lag_aggregator
.
h
"
namespace
webrtc
{
class
ApmDataDumper
;
struct
DownsampledRenderBuffer
;
struct
EchoCanceller3Config
;
class
EchoPathDelayEstimator
{
public
:
EchoPathDelayEstimator
(
ApmDataDumper
*
data_dumper
const
EchoCanceller3Config
&
config
size_t
num_capture_channels
)
;
~
EchoPathDelayEstimator
(
)
;
EchoPathDelayEstimator
(
const
EchoPathDelayEstimator
&
)
=
delete
;
EchoPathDelayEstimator
&
operator
=
(
const
EchoPathDelayEstimator
&
)
=
delete
;
void
Reset
(
bool
reset_delay_confidence
)
;
std
:
:
optional
<
DelayEstimate
>
EstimateDelay
(
const
DownsampledRenderBuffer
&
render_buffer
const
Block
&
capture
)
;
void
LogDelayEstimationProperties
(
int
sample_rate_hz
size_t
shift
)
const
{
matched_filter_
.
LogFilterProperties
(
sample_rate_hz
shift
down_sampling_factor_
)
;
}
ClockdriftDetector
:
:
Level
Clockdrift
(
)
const
{
return
clockdrift_detector_
.
ClockdriftLevel
(
)
;
}
private
:
ApmDataDumper
*
const
data_dumper_
;
const
size_t
down_sampling_factor_
;
const
size_t
sub_block_size_
;
AlignmentMixer
capture_mixer_
;
Decimator
capture_decimator_
;
MatchedFilter
matched_filter_
;
MatchedFilterLagAggregator
matched_filter_lag_aggregator_
;
std
:
:
optional
<
DelayEstimate
>
old_aggregated_lag_
;
size_t
consistent_estimate_counter_
=
0
;
ClockdriftDetector
clockdrift_detector_
;
void
Reset
(
bool
reset_lag_aggregator
bool
reset_delay_confidence
)
;
}
;
}
#
endif
