#
include
"
modules
/
audio_processing
/
aec3
/
aec3_common
.
h
"
#
include
<
cstdint
>
#
include
"
rtc_base
/
checks
.
h
"
#
include
"
rtc_base
/
cpu_info
.
h
"
#
include
"
rtc_base
/
system
/
arch
.
h
"
namespace
webrtc
{
Aec3Optimization
DetectOptimization
(
)
{
#
if
defined
(
WEBRTC_ARCH_X86_FAMILY
)
if
(
cpu_info
:
:
Supports
(
cpu_info
:
:
ISA
:
:
kAVX2
)
)
{
return
Aec3Optimization
:
:
kAvx2
;
}
else
if
(
cpu_info
:
:
Supports
(
cpu_info
:
:
ISA
:
:
kSSE2
)
)
{
return
Aec3Optimization
:
:
kSse2
;
}
#
endif
#
if
defined
(
WEBRTC_HAS_NEON
)
return
Aec3Optimization
:
:
kNeon
;
#
else
return
Aec3Optimization
:
:
kNone
;
#
endif
}
float
FastApproxLog2f
(
const
float
in
)
{
RTC_DCHECK_GT
(
in
.
0f
)
;
union
{
float
dummy
;
uint32_t
a
;
}
x
=
{
in
}
;
float
out
=
x
.
a
;
out
*
=
1
.
1920929e
-
7f
;
out
-
=
126
.
942695f
;
return
out
;
}
float
Log2TodB
(
const
float
in_log2
)
{
return
3
.
0102999566398121
*
in_log2
;
}
}
