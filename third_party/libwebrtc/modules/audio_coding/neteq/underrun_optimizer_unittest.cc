#
include
"
modules
/
audio_coding
/
neteq
/
underrun_optimizer
.
h
"
#
include
<
optional
>
#
include
"
api
/
neteq
/
tick_timer
.
h
"
#
include
"
test
/
gtest
.
h
"
namespace
webrtc
{
namespace
{
constexpr
int
kDefaultHistogramQuantile
=
1020054733
;
constexpr
int
kForgetFactor
=
32745
;
}
TEST
(
UnderrunOptimizerTest
ResamplePacketDelays
)
{
TickTimer
tick_timer
;
constexpr
int
kResampleIntervalMs
=
500
;
UnderrunOptimizer
underrun_optimizer
(
&
tick_timer
kDefaultHistogramQuantile
kForgetFactor
std
:
:
nullopt
kResampleIntervalMs
)
;
for
(
int
i
=
0
;
i
<
500
;
i
+
=
20
)
{
underrun_optimizer
.
Update
(
i
)
;
EXPECT_FALSE
(
underrun_optimizer
.
GetOptimalDelayMs
(
)
)
;
}
tick_timer
.
Increment
(
kResampleIntervalMs
/
tick_timer
.
ms_per_tick
(
)
+
1
)
;
underrun_optimizer
.
Update
(
0
)
;
EXPECT_EQ
(
underrun_optimizer
.
GetOptimalDelayMs
(
)
500
)
;
}
}
