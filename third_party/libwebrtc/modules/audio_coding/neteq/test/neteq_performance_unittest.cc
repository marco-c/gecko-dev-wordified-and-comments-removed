#
include
<
cstdint
>
#
include
"
absl
/
flags
/
flag
.
h
"
#
include
"
api
/
test
/
metrics
/
global_metrics_logger_and_exporter
.
h
"
#
include
"
api
/
test
/
metrics
/
metric
.
h
"
#
include
"
modules
/
audio_coding
/
neteq
/
tools
/
neteq_performance_test
.
h
"
#
include
"
test
/
gtest
.
h
"
#
include
"
test
/
test_flags
.
h
"
namespace
webrtc
{
namespace
{
using
test
:
:
GetGlobalMetricsLogger
;
using
test
:
:
ImprovementDirection
;
using
test
:
:
Unit
;
TEST
(
NetEqPerformanceTest
10_Pl_10_Drift
)
{
const
int
kSimulationTimeMs
=
10000000
;
const
int
kQuickSimulationTimeMs
=
100000
;
const
int
kLossPeriod
=
10
;
const
double
kDriftFactor
=
0
.
1
;
int64_t
runtime
=
test
:
:
NetEqPerformanceTest
:
:
Run
(
absl
:
:
GetFlag
(
FLAGS_webrtc_quick_perf_test
)
?
kQuickSimulationTimeMs
:
kSimulationTimeMs
kLossPeriod
kDriftFactor
)
;
ASSERT_GT
(
runtime
0
)
;
GetGlobalMetricsLogger
(
)
-
>
LogSingleValueMetric
(
"
neteq_performance
"
"
10_pl_10_drift
"
runtime
Unit
:
:
kMilliseconds
ImprovementDirection
:
:
kNeitherIsBetter
)
;
}
TEST
(
NetEqPerformanceTest
0_Pl_0_Drift
)
{
const
int
kSimulationTimeMs
=
10000000
;
const
int
kQuickSimulationTimeMs
=
100000
;
const
int
kLossPeriod
=
0
;
const
double
kDriftFactor
=
0
.
0
;
int64_t
runtime
=
test
:
:
NetEqPerformanceTest
:
:
Run
(
absl
:
:
GetFlag
(
FLAGS_webrtc_quick_perf_test
)
?
kQuickSimulationTimeMs
:
kSimulationTimeMs
kLossPeriod
kDriftFactor
)
;
ASSERT_GT
(
runtime
0
)
;
GetGlobalMetricsLogger
(
)
-
>
LogSingleValueMetric
(
"
neteq_performance
"
"
0_pl_0_drift
"
runtime
Unit
:
:
kMilliseconds
ImprovementDirection
:
:
kNeitherIsBetter
)
;
}
}
}
