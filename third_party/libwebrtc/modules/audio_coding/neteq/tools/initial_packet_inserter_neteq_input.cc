#
include
"
modules
/
audio_coding
/
neteq
/
tools
/
initial_packet_inserter_neteq_input
.
h
"
#
include
<
cstdint
>
#
include
<
memory
>
#
include
<
optional
>
#
include
<
utility
>
#
include
"
api
/
rtp_headers
.
h
"
#
include
"
modules
/
audio_coding
/
neteq
/
tools
/
neteq_input
.
h
"
#
include
"
modules
/
rtp_rtcp
/
source
/
rtp_packet_received
.
h
"
#
include
"
rtc_base
/
checks
.
h
"
namespace
webrtc
{
namespace
test
{
InitialPacketInserterNetEqInput
:
:
InitialPacketInserterNetEqInput
(
std
:
:
unique_ptr
<
NetEqInput
>
source
int
number_of_initial_packets
int
sample_rate_hz
)
:
source_
(
std
:
:
move
(
source
)
)
packets_to_insert_
(
number_of_initial_packets
)
sample_rate_hz_
(
sample_rate_hz
)
{
}
std
:
:
optional
<
int64_t
>
InitialPacketInserterNetEqInput
:
:
NextPacketTime
(
)
const
{
return
source_
-
>
NextPacketTime
(
)
;
}
std
:
:
optional
<
int64_t
>
InitialPacketInserterNetEqInput
:
:
NextOutputEventTime
(
)
const
{
return
source_
-
>
NextOutputEventTime
(
)
;
}
std
:
:
optional
<
NetEqInput
:
:
SetMinimumDelayInfo
>
InitialPacketInserterNetEqInput
:
:
NextSetMinimumDelayInfo
(
)
const
{
return
source_
-
>
NextSetMinimumDelayInfo
(
)
;
}
std
:
:
unique_ptr
<
RtpPacketReceived
>
InitialPacketInserterNetEqInput
:
:
PopPacket
(
)
{
if
(
!
first_packet_
)
{
first_packet_
=
source_
-
>
PopPacket
(
)
;
if
(
!
first_packet_
)
{
packets_to_insert_
=
0
;
}
}
if
(
packets_to_insert_
>
0
)
{
RTC_CHECK
(
first_packet_
)
;
auto
dummy_packet
=
std
:
:
make_unique
<
RtpPacketReceived
>
(
*
first_packet_
)
;
dummy_packet
-
>
SetSequenceNumber
(
first_packet_
-
>
SequenceNumber
(
)
-
packets_to_insert_
)
;
dummy_packet
-
>
SetTimestamp
(
first_packet_
-
>
Timestamp
(
)
-
20
*
sample_rate_hz_
*
packets_to_insert_
/
1000
)
;
packets_to_insert_
-
-
;
return
dummy_packet
;
}
return
source_
-
>
PopPacket
(
)
;
}
void
InitialPacketInserterNetEqInput
:
:
AdvanceSetMinimumDelay
(
)
{
source_
-
>
AdvanceSetMinimumDelay
(
)
;
}
void
InitialPacketInserterNetEqInput
:
:
AdvanceOutputEvent
(
)
{
source_
-
>
AdvanceOutputEvent
(
)
;
}
bool
InitialPacketInserterNetEqInput
:
:
ended
(
)
const
{
return
source_
-
>
ended
(
)
;
}
std
:
:
optional
<
RTPHeader
>
InitialPacketInserterNetEqInput
:
:
NextHeader
(
)
const
{
return
source_
-
>
NextHeader
(
)
;
}
}
}
