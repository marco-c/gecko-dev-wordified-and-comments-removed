#
ifndef
MODULES_AUDIO_CODING_NETEQ_TOOLS_AUDIO_CHECKSUM_H_
#
define
MODULES_AUDIO_CODING_NETEQ_TOOLS_AUDIO_CHECKSUM_H_
#
include
<
cstddef
>
#
include
<
cstdint
>
#
include
<
memory
>
#
include
<
string
>
#
include
"
modules
/
audio_coding
/
neteq
/
tools
/
audio_sink
.
h
"
#
include
"
rtc_base
/
buffer
.
h
"
#
include
"
rtc_base
/
message_digest
.
h
"
#
include
"
rtc_base
/
string_encode
.
h
"
#
include
"
rtc_base
/
system
/
arch
.
h
"
namespace
webrtc
{
namespace
test
{
class
AudioChecksum
:
public
AudioSink
{
public
:
AudioChecksum
(
)
:
checksum_
(
MessageDigestFactory
:
:
Create
(
DIGEST_MD5
)
)
checksum_result_
(
checksum_
-
>
Size
(
)
)
finished_
(
false
)
{
}
AudioChecksum
(
const
AudioChecksum
&
)
=
delete
;
AudioChecksum
&
operator
=
(
const
AudioChecksum
&
)
=
delete
;
bool
WriteArray
(
const
int16_t
*
audio
size_t
num_samples
)
override
{
if
(
finished_
)
return
false
;
#
ifndef
WEBRTC_ARCH_LITTLE_ENDIAN
#
error
"
Big
-
endian
gives
a
different
checksum
"
#
endif
checksum_
-
>
Update
(
audio
num_samples
*
sizeof
(
*
audio
)
)
;
return
true
;
}
std
:
:
string
Finish
(
)
{
if
(
!
finished_
)
{
finished_
=
true
;
checksum_
-
>
Finish
(
checksum_result_
.
data
(
)
checksum_result_
.
size
(
)
)
;
}
return
rtc
:
:
hex_encode
(
checksum_result_
)
;
}
private
:
std
:
:
unique_ptr
<
MessageDigest
>
checksum_
;
rtc
:
:
Buffer
checksum_result_
;
bool
finished_
;
}
;
}
}
#
endif
