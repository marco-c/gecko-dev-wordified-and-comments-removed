#
include
"
modules
/
video_coding
/
svc
/
create_scalability_structure
.
h
"
#
include
<
memory
>
#
include
<
optional
>
#
include
"
api
/
video_codecs
/
scalability_mode
.
h
"
#
include
"
modules
/
video_coding
/
svc
/
scalability_structure_full_svc
.
h
"
#
include
"
modules
/
video_coding
/
svc
/
scalability_structure_key_svc
.
h
"
#
include
"
modules
/
video_coding
/
svc
/
scalability_structure_l2t2_key_shift
.
h
"
#
include
"
modules
/
video_coding
/
svc
/
scalability_structure_simulcast
.
h
"
#
include
"
modules
/
video_coding
/
svc
/
scalable_video_controller
.
h
"
#
include
"
modules
/
video_coding
/
svc
/
scalable_video_controller_no_layering
.
h
"
namespace
webrtc
{
namespace
{
struct
NamedStructureFactory
{
ScalabilityMode
name
;
std
:
:
unique_ptr
<
ScalableVideoController
>
(
*
factory
)
(
)
;
ScalableVideoController
:
:
StreamLayersConfig
config
;
}
;
template
<
typename
T
>
std
:
:
unique_ptr
<
ScalableVideoController
>
Create
(
)
{
return
std
:
:
make_unique
<
T
>
(
)
;
}
template
<
typename
T
>
std
:
:
unique_ptr
<
ScalableVideoController
>
CreateH
(
)
{
typename
T
:
:
ScalingFactor
factor
;
factor
.
num
=
2
;
factor
.
den
=
3
;
return
std
:
:
make_unique
<
T
>
(
factor
)
;
}
constexpr
ScalableVideoController
:
:
StreamLayersConfig
kConfigL1T1
=
{
1
1
false
}
;
constexpr
ScalableVideoController
:
:
StreamLayersConfig
kConfigL1T2
=
{
1
2
false
}
;
constexpr
ScalableVideoController
:
:
StreamLayersConfig
kConfigL1T3
=
{
1
3
false
}
;
constexpr
ScalableVideoController
:
:
StreamLayersConfig
kConfigL2T1
=
{
2
1
true
{
1
1
}
{
2
1
}
}
;
constexpr
ScalableVideoController
:
:
StreamLayersConfig
kConfigL2T1h
=
{
2
1
true
{
2
1
}
{
3
1
}
}
;
constexpr
ScalableVideoController
:
:
StreamLayersConfig
kConfigL2T2
=
{
2
2
true
{
1
1
}
{
2
1
}
}
;
constexpr
ScalableVideoController
:
:
StreamLayersConfig
kConfigL2T2h
=
{
2
2
true
{
2
1
}
{
3
1
}
}
;
constexpr
ScalableVideoController
:
:
StreamLayersConfig
kConfigL2T3
=
{
2
3
true
{
1
1
}
{
2
1
}
}
;
constexpr
ScalableVideoController
:
:
StreamLayersConfig
kConfigL2T3h
=
{
2
3
true
{
2
1
}
{
3
1
}
}
;
constexpr
ScalableVideoController
:
:
StreamLayersConfig
kConfigL3T1
=
{
3
1
true
{
1
1
1
}
{
4
2
1
}
}
;
constexpr
ScalableVideoController
:
:
StreamLayersConfig
kConfigL3T1h
=
{
3
1
true
{
4
2
1
}
{
9
3
1
}
}
;
constexpr
ScalableVideoController
:
:
StreamLayersConfig
kConfigL3T2
=
{
3
2
true
{
1
1
1
}
{
4
2
1
}
}
;
constexpr
ScalableVideoController
:
:
StreamLayersConfig
kConfigL3T2h
=
{
3
2
true
{
4
2
1
}
{
9
3
1
}
}
;
constexpr
ScalableVideoController
:
:
StreamLayersConfig
kConfigL3T3
=
{
3
3
true
{
1
1
1
}
{
4
2
1
}
}
;
constexpr
ScalableVideoController
:
:
StreamLayersConfig
kConfigL3T3h
=
{
3
3
true
{
4
2
1
}
{
9
3
1
}
}
;
constexpr
ScalableVideoController
:
:
StreamLayersConfig
kConfigS2T1
=
{
2
1
false
{
1
1
}
{
2
1
}
}
;
constexpr
ScalableVideoController
:
:
StreamLayersConfig
kConfigS2T1h
=
{
2
1
false
{
2
1
}
{
3
1
}
}
;
constexpr
ScalableVideoController
:
:
StreamLayersConfig
kConfigS2T2
=
{
2
2
false
{
1
1
}
{
2
1
}
}
;
constexpr
ScalableVideoController
:
:
StreamLayersConfig
kConfigS2T2h
=
{
2
2
false
{
2
1
}
{
3
1
}
}
;
constexpr
ScalableVideoController
:
:
StreamLayersConfig
kConfigS2T3
=
{
2
3
false
{
1
1
}
{
2
1
}
}
;
constexpr
ScalableVideoController
:
:
StreamLayersConfig
kConfigS2T3h
=
{
2
3
false
{
2
1
}
{
3
1
}
}
;
constexpr
ScalableVideoController
:
:
StreamLayersConfig
kConfigS3T1
=
{
3
1
false
{
1
1
1
}
{
4
2
1
}
}
;
constexpr
ScalableVideoController
:
:
StreamLayersConfig
kConfigS3T1h
=
{
3
1
false
{
4
2
1
}
{
9
3
1
}
}
;
constexpr
ScalableVideoController
:
:
StreamLayersConfig
kConfigS3T2
=
{
3
2
false
{
1
1
1
}
{
4
2
1
}
}
;
constexpr
ScalableVideoController
:
:
StreamLayersConfig
kConfigS3T2h
=
{
3
2
false
{
4
2
1
}
{
9
3
1
}
}
;
constexpr
ScalableVideoController
:
:
StreamLayersConfig
kConfigS3T3
=
{
3
3
false
{
1
1
1
}
{
4
2
1
}
}
;
constexpr
ScalableVideoController
:
:
StreamLayersConfig
kConfigS3T3h
=
{
3
3
false
{
4
2
1
}
{
9
3
1
}
}
;
constexpr
NamedStructureFactory
kFactories
[
]
=
{
{
ScalabilityMode
:
:
kL1T1
Create
<
ScalableVideoControllerNoLayering
>
kConfigL1T1
}
{
ScalabilityMode
:
:
kL1T2
Create
<
ScalabilityStructureL1T2
>
kConfigL1T2
}
{
ScalabilityMode
:
:
kL1T3
Create
<
ScalabilityStructureL1T3
>
kConfigL1T3
}
{
ScalabilityMode
:
:
kL2T1
Create
<
ScalabilityStructureL2T1
>
kConfigL2T1
}
{
ScalabilityMode
:
:
kL2T1h
CreateH
<
ScalabilityStructureL2T1
>
kConfigL2T1h
}
{
ScalabilityMode
:
:
kL2T1_KEY
Create
<
ScalabilityStructureL2T1Key
>
kConfigL2T1
}
{
ScalabilityMode
:
:
kL2T2
Create
<
ScalabilityStructureL2T2
>
kConfigL2T2
}
{
ScalabilityMode
:
:
kL2T2h
CreateH
<
ScalabilityStructureL2T2
>
kConfigL2T2h
}
{
ScalabilityMode
:
:
kL2T2_KEY
Create
<
ScalabilityStructureL2T2Key
>
kConfigL2T2
}
{
ScalabilityMode
:
:
kL2T2_KEY_SHIFT
Create
<
ScalabilityStructureL2T2KeyShift
>
kConfigL2T2
}
{
ScalabilityMode
:
:
kL2T3
Create
<
ScalabilityStructureL2T3
>
kConfigL2T3
}
{
ScalabilityMode
:
:
kL2T3h
CreateH
<
ScalabilityStructureL2T3
>
kConfigL2T3h
}
{
ScalabilityMode
:
:
kL2T3_KEY
Create
<
ScalabilityStructureL2T3Key
>
kConfigL2T3
}
{
ScalabilityMode
:
:
kL3T1
Create
<
ScalabilityStructureL3T1
>
kConfigL3T1
}
{
ScalabilityMode
:
:
kL3T1h
CreateH
<
ScalabilityStructureL3T1
>
kConfigL3T1h
}
{
ScalabilityMode
:
:
kL3T1_KEY
Create
<
ScalabilityStructureL3T1Key
>
kConfigL3T1
}
{
ScalabilityMode
:
:
kL3T2
Create
<
ScalabilityStructureL3T2
>
kConfigL3T2
}
{
ScalabilityMode
:
:
kL3T2h
CreateH
<
ScalabilityStructureL3T2
>
kConfigL3T2h
}
{
ScalabilityMode
:
:
kL3T2_KEY
Create
<
ScalabilityStructureL3T2Key
>
kConfigL3T2
}
{
ScalabilityMode
:
:
kL3T3
Create
<
ScalabilityStructureL3T3
>
kConfigL3T3
}
{
ScalabilityMode
:
:
kL3T3h
CreateH
<
ScalabilityStructureL3T3
>
kConfigL3T3h
}
{
ScalabilityMode
:
:
kL3T3_KEY
Create
<
ScalabilityStructureL3T3Key
>
kConfigL3T3
}
{
ScalabilityMode
:
:
kS2T1
Create
<
ScalabilityStructureS2T1
>
kConfigS2T1
}
{
ScalabilityMode
:
:
kS2T1h
CreateH
<
ScalabilityStructureS2T1
>
kConfigS2T1h
}
{
ScalabilityMode
:
:
kS2T2
Create
<
ScalabilityStructureS2T2
>
kConfigS2T2
}
{
ScalabilityMode
:
:
kS2T2h
CreateH
<
ScalabilityStructureS2T2
>
kConfigS2T2h
}
{
ScalabilityMode
:
:
kS2T3
Create
<
ScalabilityStructureS2T3
>
kConfigS2T3
}
{
ScalabilityMode
:
:
kS2T3h
CreateH
<
ScalabilityStructureS2T3
>
kConfigS2T3h
}
{
ScalabilityMode
:
:
kS3T1
Create
<
ScalabilityStructureS3T1
>
kConfigS3T1
}
{
ScalabilityMode
:
:
kS3T1h
CreateH
<
ScalabilityStructureS3T1
>
kConfigS3T1h
}
{
ScalabilityMode
:
:
kS3T2
Create
<
ScalabilityStructureS3T2
>
kConfigS3T2
}
{
ScalabilityMode
:
:
kS3T2h
CreateH
<
ScalabilityStructureS3T2
>
kConfigS3T2h
}
{
ScalabilityMode
:
:
kS3T3
Create
<
ScalabilityStructureS3T3
>
kConfigS3T3
}
{
ScalabilityMode
:
:
kS3T3h
CreateH
<
ScalabilityStructureS3T3
>
kConfigS3T3h
}
}
;
}
std
:
:
unique_ptr
<
ScalableVideoController
>
CreateScalabilityStructure
(
ScalabilityMode
name
)
{
for
(
const
auto
&
entry
:
kFactories
)
{
if
(
entry
.
name
=
=
name
)
{
return
entry
.
factory
(
)
;
}
}
return
nullptr
;
}
std
:
:
optional
<
ScalableVideoController
:
:
StreamLayersConfig
>
ScalabilityStructureConfig
(
ScalabilityMode
name
)
{
for
(
const
auto
&
entry
:
kFactories
)
{
if
(
entry
.
name
=
=
name
)
{
return
entry
.
config
;
}
}
return
std
:
:
nullopt
;
}
}
