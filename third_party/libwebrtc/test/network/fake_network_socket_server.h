#
ifndef
TEST_NETWORK_FAKE_NETWORK_SOCKET_SERVER_H_
#
define
TEST_NETWORK_FAKE_NETWORK_SOCKET_SERVER_H_
#
include
<
vector
>
#
include
"
api
/
units
/
time_delta
.
h
"
#
include
"
rtc_base
/
event
.
h
"
#
include
"
rtc_base
/
ip_address
.
h
"
#
include
"
rtc_base
/
socket
.
h
"
#
include
"
rtc_base
/
socket_server
.
h
"
#
include
"
rtc_base
/
synchronization
/
mutex
.
h
"
#
include
"
rtc_base
/
thread_annotations
.
h
"
#
include
"
test
/
network
/
network_emulation
.
h
"
namespace
webrtc
{
namespace
test
{
class
FakeNetworkSocket
;
class
FakeNetworkSocketServer
:
public
SocketServer
{
public
:
explicit
FakeNetworkSocketServer
(
EndpointsContainer
*
endpoints_controller
)
;
~
FakeNetworkSocketServer
(
)
override
;
Socket
*
CreateSocket
(
int
family
int
type
)
override
;
void
SetMessageQueue
(
Thread
*
thread
)
override
;
bool
Wait
(
webrtc
:
:
TimeDelta
max_wait_duration
bool
process_io
)
override
;
void
WakeUp
(
)
override
;
protected
:
friend
class
FakeNetworkSocket
;
EmulatedEndpointImpl
*
GetEndpointNode
(
const
IPAddress
&
ip
)
;
void
Unregister
(
FakeNetworkSocket
*
socket
)
;
private
:
const
EndpointsContainer
*
endpoints_container_
;
Event
wakeup_
;
Thread
*
thread_
=
nullptr
;
Mutex
lock_
;
std
:
:
vector
<
FakeNetworkSocket
*
>
sockets_
RTC_GUARDED_BY
(
lock_
)
;
}
;
}
}
#
endif
