#
include
"
test
/
pc
/
e2e
/
analyzer
/
video
/
simulcast_dummy_buffer_helper
.
h
"
#
include
"
api
/
video
/
i420_buffer
.
h
"
#
include
"
api
/
video
/
video_frame
.
h
"
#
include
"
api
/
video
/
video_frame_buffer
.
h
"
namespace
webrtc
{
namespace
webrtc_pc_e2e
{
namespace
{
constexpr
char
kIrrelatedSimulcastStreamFrameData
[
]
=
"
Dummy
!
"
;
}
rtc
:
:
scoped_refptr
<
webrtc
:
:
VideoFrameBuffer
>
CreateDummyFrameBuffer
(
)
{
rtc
:
:
scoped_refptr
<
webrtc
:
:
I420Buffer
>
buffer
=
webrtc
:
:
I420Buffer
:
:
Create
(
2
2
)
;
memcpy
(
buffer
-
>
MutableDataY
(
)
kIrrelatedSimulcastStreamFrameData
2
)
;
memcpy
(
buffer
-
>
MutableDataY
(
)
+
buffer
-
>
StrideY
(
)
kIrrelatedSimulcastStreamFrameData
+
2
2
)
;
memcpy
(
buffer
-
>
MutableDataU
(
)
kIrrelatedSimulcastStreamFrameData
+
4
1
)
;
memcpy
(
buffer
-
>
MutableDataV
(
)
kIrrelatedSimulcastStreamFrameData
+
5
1
)
;
return
buffer
;
}
bool
IsDummyFrame
(
const
webrtc
:
:
VideoFrame
&
video_frame
)
{
if
(
video_frame
.
width
(
)
!
=
2
|
|
video_frame
.
height
(
)
!
=
2
)
{
return
false
;
}
rtc
:
:
scoped_refptr
<
webrtc
:
:
I420BufferInterface
>
buffer
=
video_frame
.
video_frame_buffer
(
)
-
>
ToI420
(
)
;
if
(
memcmp
(
buffer
-
>
DataY
(
)
kIrrelatedSimulcastStreamFrameData
2
)
!
=
0
)
{
return
false
;
}
if
(
memcmp
(
buffer
-
>
DataY
(
)
+
buffer
-
>
StrideY
(
)
kIrrelatedSimulcastStreamFrameData
+
2
2
)
!
=
0
)
{
return
false
;
}
if
(
memcmp
(
buffer
-
>
DataU
(
)
kIrrelatedSimulcastStreamFrameData
+
4
1
)
!
=
0
)
{
return
false
;
}
if
(
memcmp
(
buffer
-
>
DataV
(
)
kIrrelatedSimulcastStreamFrameData
+
5
1
)
!
=
0
)
{
return
false
;
}
return
true
;
}
}
}
