#
ifndef
TEST_PC_E2E_ANALYZER_VIDEO_DEFAULT_VIDEO_QUALITY_ANALYZER_INTERNAL_SHARED_OBJECTS_H_
#
define
TEST_PC_E2E_ANALYZER_VIDEO_DEFAULT_VIDEO_QUALITY_ANALYZER_INTERNAL_SHARED_OBJECTS_H_
#
include
<
memory
>
#
include
<
string
>
#
include
<
utility
>
#
include
"
absl
/
types
/
optional
.
h
"
#
include
"
api
/
units
/
timestamp
.
h
"
#
include
"
api
/
video
/
video_frame
.
h
"
#
include
"
test
/
pc
/
e2e
/
analyzer
/
video
/
default_video_quality_analyzer_shared_objects
.
h
"
namespace
webrtc
{
struct
InternalStatsKey
{
InternalStatsKey
(
size_t
stream
size_t
sender
size_t
receiver
)
:
stream
(
stream
)
sender
(
sender
)
receiver
(
receiver
)
{
}
std
:
:
string
ToString
(
)
const
;
size_t
stream
;
size_t
sender
;
size_t
receiver
;
}
;
bool
operator
<
(
const
InternalStatsKey
&
a
const
InternalStatsKey
&
b
)
;
bool
operator
=
=
(
const
InternalStatsKey
&
a
const
InternalStatsKey
&
b
)
;
struct
FrameStats
{
explicit
FrameStats
(
Timestamp
captured_time
)
:
captured_time
(
captured_time
)
{
}
Timestamp
captured_time
;
Timestamp
pre_encode_time
=
Timestamp
:
:
MinusInfinity
(
)
;
Timestamp
encoded_time
=
Timestamp
:
:
MinusInfinity
(
)
;
Timestamp
received_time
=
Timestamp
:
:
MinusInfinity
(
)
;
Timestamp
decode_start_time
=
Timestamp
:
:
MinusInfinity
(
)
;
Timestamp
decode_end_time
=
Timestamp
:
:
MinusInfinity
(
)
;
Timestamp
rendered_time
=
Timestamp
:
:
MinusInfinity
(
)
;
Timestamp
prev_frame_rendered_time
=
Timestamp
:
:
MinusInfinity
(
)
;
int64_t
encoded_image_size
=
0
;
uint32_t
target_encode_bitrate
=
0
;
absl
:
:
optional
<
int
>
rendered_frame_width
=
absl
:
:
nullopt
;
absl
:
:
optional
<
int
>
rendered_frame_height
=
absl
:
:
nullopt
;
absl
:
:
optional
<
webrtc_pc_e2e
:
:
StreamCodecInfo
>
used_encoder
=
absl
:
:
nullopt
;
absl
:
:
optional
<
webrtc_pc_e2e
:
:
StreamCodecInfo
>
used_decoder
=
absl
:
:
nullopt
;
}
;
enum
class
OverloadReason
{
kNone
kCpu
kMemory
}
;
enum
class
FrameComparisonType
{
kRegular
kDroppedFrame
kFrameInFlight
}
;
struct
FrameComparison
{
FrameComparison
(
InternalStatsKey
stats_key
absl
:
:
optional
<
VideoFrame
>
captured
absl
:
:
optional
<
VideoFrame
>
rendered
FrameComparisonType
type
FrameStats
frame_stats
OverloadReason
overload_reason
)
;
InternalStatsKey
stats_key
;
absl
:
:
optional
<
VideoFrame
>
captured
;
absl
:
:
optional
<
VideoFrame
>
rendered
;
FrameComparisonType
type
;
FrameStats
frame_stats
;
OverloadReason
overload_reason
;
}
;
}
#
endif
