#
include
"
test
/
testsupport
/
copy_to_file_audio_capturer
.
h
"
#
include
<
cstdint
>
#
include
<
memory
>
#
include
<
string
>
#
include
<
utility
>
#
include
"
common_audio
/
wav_file
.
h
"
#
include
"
modules
/
audio_device
/
include
/
test_audio_device
.
h
"
#
include
"
rtc_base
/
buffer
.
h
"
namespace
webrtc
{
namespace
test
{
CopyToFileAudioCapturer
:
:
CopyToFileAudioCapturer
(
std
:
:
unique_ptr
<
TestAudioDeviceModule
:
:
Capturer
>
delegate
std
:
:
string
stream_dump_file_name
)
:
delegate_
(
std
:
:
move
(
delegate
)
)
wav_writer_
(
std
:
:
make_unique
<
WavWriter
>
(
std
:
:
move
(
stream_dump_file_name
)
delegate_
-
>
SamplingFrequency
(
)
delegate_
-
>
NumChannels
(
)
)
)
{
}
CopyToFileAudioCapturer
:
:
~
CopyToFileAudioCapturer
(
)
=
default
;
int
CopyToFileAudioCapturer
:
:
SamplingFrequency
(
)
const
{
return
delegate_
-
>
SamplingFrequency
(
)
;
}
int
CopyToFileAudioCapturer
:
:
NumChannels
(
)
const
{
return
delegate_
-
>
NumChannels
(
)
;
}
bool
CopyToFileAudioCapturer
:
:
Capture
(
BufferT
<
int16_t
>
*
buffer
)
{
bool
result
=
delegate_
-
>
Capture
(
buffer
)
;
if
(
result
)
{
wav_writer_
-
>
WriteSamples
(
buffer
-
>
data
(
)
buffer
-
>
size
(
)
)
;
}
return
result
;
}
}
}
