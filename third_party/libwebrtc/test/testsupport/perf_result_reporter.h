#
ifndef
TEST_TESTSUPPORT_PERF_RESULT_REPORTER_H_
#
define
TEST_TESTSUPPORT_PERF_RESULT_REPORTER_H_
#
include
<
string
>
#
include
<
unordered_map
>
#
include
"
absl
/
strings
/
string_view
.
h
"
#
include
"
absl
/
types
/
optional
.
h
"
#
include
"
api
/
array_view
.
h
"
#
include
"
test
/
testsupport
/
perf_test
.
h
"
namespace
webrtc
{
namespace
test
{
enum
class
Unit
{
kMs
kMsBestFitFormat
kMsTs
kNPercent
kSizeInBytes
kBytesPerSecond
kHertz
kUnitless
kCount
kSigma
}
;
struct
MetricInfo
{
Unit
unit
;
ImproveDirection
improve_direction
;
}
;
class
PerfResultReporter
{
public
:
PerfResultReporter
(
absl
:
:
string_view
metric_basename
absl
:
:
string_view
story_name
)
;
~
PerfResultReporter
(
)
;
void
RegisterMetric
(
absl
:
:
string_view
metric_suffix
Unit
unit
)
;
void
RegisterMetric
(
absl
:
:
string_view
metric_suffix
Unit
unit
ImproveDirection
improve_direction
)
;
void
AddResult
(
absl
:
:
string_view
metric_suffix
size_t
value
)
const
;
void
AddResult
(
absl
:
:
string_view
metric_suffix
double
value
)
const
;
void
AddResultList
(
absl
:
:
string_view
metric_suffix
rtc
:
:
ArrayView
<
const
double
>
values
)
const
;
void
AddResultMeanAndError
(
absl
:
:
string_view
metric_suffix
double
mean
double
error
)
;
absl
:
:
optional
<
MetricInfo
>
GetMetricInfo
(
absl
:
:
string_view
metric_suffix
)
const
;
private
:
MetricInfo
GetMetricInfoOrFail
(
absl
:
:
string_view
metric_suffix
)
const
;
std
:
:
string
metric_basename_
;
std
:
:
string
story_name_
;
std
:
:
unordered_map
<
std
:
:
string
MetricInfo
>
metric_map_
;
}
;
}
}
#
endif
