#
include
"
net
/
dcsctp
/
packet
/
chunk
/
init_chunk
.
h
"
#
include
<
stdint
.
h
>
#
include
<
type_traits
>
#
include
<
vector
>
#
include
"
net
/
dcsctp
/
packet
/
parameter
/
forward_tsn_supported_parameter
.
h
"
#
include
"
net
/
dcsctp
/
packet
/
parameter
/
parameter
.
h
"
#
include
"
net
/
dcsctp
/
packet
/
parameter
/
supported_extensions_parameter
.
h
"
#
include
"
net
/
dcsctp
/
testing
/
testing_macros
.
h
"
#
include
"
rtc_base
/
gunit
.
h
"
#
include
"
test
/
gmock
.
h
"
namespace
dcsctp
{
namespace
{
TEST
(
InitChunkTest
FromCapture
)
{
uint8_t
data
[
]
=
{
0x01
0x00
0x00
0x5a
0xde
0x7a
0x16
0x90
0x00
0x02
0x00
0x00
0x03
0xe8
0x03
0xe8
0x25
0x0d
0x37
0xe8
0x80
0x00
0x00
0x04
0xc0
0x00
0x00
0x04
0x80
0x08
0x00
0x09
0xc0
0x0f
0xc1
0x80
0x82
0x00
0x00
0x00
0x80
0x02
0x00
0x24
0xab
0x31
0x44
0x62
0x12
0x1a
0x15
0x13
0xfd
0x5a
0x5f
0x69
0xef
0xaa
0x06
0xe9
0xab
0xd7
0x48
0xcc
0x3b
0xd1
0x4b
0x60
0xed
0x7f
0xa6
0x44
0xce
0x4d
0xd2
0xad
0x80
0x04
0x00
0x06
0x00
0x01
0x00
0x00
0x80
0x03
0x00
0x06
0x80
0xc1
0x00
0x00
}
;
ASSERT_HAS_VALUE_AND_ASSIGN
(
InitChunk
chunk
InitChunk
:
:
Parse
(
data
)
)
;
EXPECT_EQ
(
chunk
.
initiate_tag
(
)
VerificationTag
(
0xde7a1690
)
)
;
EXPECT_EQ
(
chunk
.
a_rwnd
(
)
131072u
)
;
EXPECT_EQ
(
chunk
.
nbr_outbound_streams
(
)
1000u
)
;
EXPECT_EQ
(
chunk
.
nbr_inbound_streams
(
)
1000u
)
;
EXPECT_EQ
(
chunk
.
initial_tsn
(
)
TSN
(
621623272u
)
)
;
EXPECT_TRUE
(
chunk
.
parameters
(
)
.
get
<
ForwardTsnSupportedParameter
>
(
)
.
has_value
(
)
)
;
EXPECT_TRUE
(
chunk
.
parameters
(
)
.
get
<
SupportedExtensionsParameter
>
(
)
.
has_value
(
)
)
;
}
TEST
(
InitChunkTest
SerializeAndDeserialize
)
{
InitChunk
chunk
(
VerificationTag
(
123
)
456
65535
65534
TSN
(
789
)
Parameters
:
:
Builder
(
)
.
Build
(
)
)
;
std
:
:
vector
<
uint8_t
>
serialized
;
chunk
.
SerializeTo
(
serialized
)
;
ASSERT_HAS_VALUE_AND_ASSIGN
(
InitChunk
deserialized
InitChunk
:
:
Parse
(
serialized
)
)
;
EXPECT_EQ
(
deserialized
.
initiate_tag
(
)
VerificationTag
(
123u
)
)
;
EXPECT_EQ
(
deserialized
.
a_rwnd
(
)
456u
)
;
EXPECT_EQ
(
deserialized
.
nbr_outbound_streams
(
)
65535u
)
;
EXPECT_EQ
(
deserialized
.
nbr_inbound_streams
(
)
65534u
)
;
EXPECT_EQ
(
deserialized
.
initial_tsn
(
)
TSN
(
789u
)
)
;
EXPECT_EQ
(
deserialized
.
ToString
(
)
"
INIT
initiate_tag
=
0x7b
initial_tsn
=
789
"
)
;
}
}
}
