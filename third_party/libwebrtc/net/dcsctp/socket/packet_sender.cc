#
include
"
net
/
dcsctp
/
socket
/
packet_sender
.
h
"
#
include
<
cstdint
>
#
include
<
functional
>
#
include
<
utility
>
#
include
<
vector
>
#
include
"
api
/
array_view
.
h
"
#
include
"
net
/
dcsctp
/
packet
/
sctp_packet
.
h
"
#
include
"
net
/
dcsctp
/
public
/
dcsctp_socket
.
h
"
namespace
dcsctp
{
PacketSender
:
:
PacketSender
(
DcSctpSocketCallbacks
&
callbacks
std
:
:
function
<
void
(
webrtc
:
:
ArrayView
<
const
uint8_t
>
SendPacketStatus
)
>
on_sent_packet
)
:
callbacks_
(
callbacks
)
on_sent_packet_
(
std
:
:
move
(
on_sent_packet
)
)
{
}
bool
PacketSender
:
:
Send
(
SctpPacket
:
:
Builder
&
builder
bool
write_checksum
)
{
if
(
builder
.
empty
(
)
)
{
return
false
;
}
std
:
:
vector
<
uint8_t
>
payload
=
builder
.
Build
(
write_checksum
)
;
SendPacketStatus
status
=
callbacks_
.
SendPacketWithStatus
(
payload
)
;
on_sent_packet_
(
payload
status
)
;
switch
(
status
)
{
case
SendPacketStatus
:
:
kSuccess
:
{
return
true
;
}
case
SendPacketStatus
:
:
kTemporaryFailure
:
{
return
false
;
}
case
SendPacketStatus
:
:
kError
:
{
return
false
;
}
}
}
}
