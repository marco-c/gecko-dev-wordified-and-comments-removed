#
include
"
call
/
rtp_stream_receiver_controller
.
h
"
#
include
"
rtc_base
/
logging
.
h
"
#
include
"
rtc_base
/
ptr_util
.
h
"
namespace
webrtc
{
RtpStreamReceiverController
:
:
Receiver
:
:
Receiver
(
RtpStreamReceiverController
*
controller
uint32_t
ssrc
RtpPacketSinkInterface
*
sink
)
:
controller_
(
controller
)
sink_
(
sink
)
{
const
bool
sink_added
=
controller_
-
>
AddSink
(
ssrc
sink_
)
;
if
(
!
sink_added
)
{
RTC_LOG
(
LS_ERROR
)
<
<
"
RtpStreamReceiverController
:
:
Receiver
:
:
Receiver
:
Sink
"
<
<
"
could
not
be
added
for
SSRC
=
"
<
<
ssrc
<
<
"
.
"
;
}
}
RtpStreamReceiverController
:
:
Receiver
:
:
~
Receiver
(
)
{
controller_
-
>
RemoveSink
(
sink_
)
;
}
RtpStreamReceiverController
:
:
RtpStreamReceiverController
(
)
=
default
;
RtpStreamReceiverController
:
:
~
RtpStreamReceiverController
(
)
=
default
;
std
:
:
unique_ptr
<
RtpStreamReceiverInterface
>
RtpStreamReceiverController
:
:
CreateReceiver
(
uint32_t
ssrc
RtpPacketSinkInterface
*
sink
)
{
return
rtc
:
:
MakeUnique
<
Receiver
>
(
this
ssrc
sink
)
;
}
bool
RtpStreamReceiverController
:
:
OnRtpPacket
(
const
RtpPacketReceived
&
packet
)
{
rtc
:
:
CritScope
cs
(
&
lock_
)
;
return
demuxer_
.
OnRtpPacket
(
packet
)
;
}
bool
RtpStreamReceiverController
:
:
AddSink
(
uint32_t
ssrc
RtpPacketSinkInterface
*
sink
)
{
rtc
:
:
CritScope
cs
(
&
lock_
)
;
return
demuxer_
.
AddSink
(
ssrc
sink
)
;
}
size_t
RtpStreamReceiverController
:
:
RemoveSink
(
const
RtpPacketSinkInterface
*
sink
)
{
rtc
:
:
CritScope
cs
(
&
lock_
)
;
return
demuxer_
.
RemoveSink
(
sink
)
;
}
}
