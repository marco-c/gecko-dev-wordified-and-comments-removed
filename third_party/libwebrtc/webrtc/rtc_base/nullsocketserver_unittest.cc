#
include
"
rtc_base
/
nullsocketserver
.
h
"
#
include
"
rtc_base
/
gunit
.
h
"
namespace
rtc
{
static
const
uint32_t
kTimeout
=
5000U
;
class
NullSocketServerTest
:
public
testing
:
:
Test
public
MessageHandler
{
protected
:
void
OnMessage
(
Message
*
message
)
override
{
ss_
.
WakeUp
(
)
;
}
NullSocketServer
ss_
;
}
;
TEST_F
(
NullSocketServerTest
WaitAndSet
)
{
auto
thread
=
Thread
:
:
Create
(
)
;
EXPECT_TRUE
(
thread
-
>
Start
(
)
)
;
thread
-
>
Post
(
RTC_FROM_HERE
this
0
)
;
const
bool
process_io
=
true
;
EXPECT_TRUE_WAIT
(
ss_
.
Wait
(
SocketServer
:
:
kForever
process_io
)
kTimeout
)
;
}
TEST_F
(
NullSocketServerTest
TestWait
)
{
int64_t
start
=
TimeMillis
(
)
;
ss_
.
Wait
(
200
true
)
;
EXPECT_GE
(
TimeSince
(
start
)
180
)
;
}
}
