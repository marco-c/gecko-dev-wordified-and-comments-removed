#
ifndef
MODULES_PACING_BITRATE_PROBER_H_
#
define
MODULES_PACING_BITRATE_PROBER_H_
#
include
<
queue
>
#
include
"
modules
/
include
/
module_common_types
.
h
"
#
include
"
rtc_base
/
basictypes
.
h
"
#
include
"
typedefs
.
h
"
namespace
webrtc
{
class
RtcEventLog
;
class
BitrateProber
{
public
:
BitrateProber
(
)
;
explicit
BitrateProber
(
RtcEventLog
*
event_log
)
;
void
SetEnabled
(
bool
enable
)
;
bool
IsProbing
(
)
const
;
void
OnIncomingPacket
(
size_t
packet_size
)
;
void
CreateProbeCluster
(
int
bitrate_bps
int64_t
now_ms
)
;
int
TimeUntilNextProbe
(
int64_t
now_ms
)
;
PacedPacketInfo
CurrentCluster
(
)
const
;
size_t
RecommendedMinProbeSize
(
)
const
;
void
ProbeSent
(
int64_t
now_ms
size_t
probe_size
)
;
private
:
enum
class
ProbingState
{
kDisabled
kInactive
kActive
kSuspended
}
;
struct
ProbeCluster
{
PacedPacketInfo
pace_info
;
int
sent_probes
=
0
;
int
sent_bytes
=
0
;
int64_t
time_created_ms
=
-
1
;
int64_t
time_started_ms
=
-
1
;
int
retries
=
0
;
}
;
void
ResetState
(
int64_t
now_ms
)
;
int64_t
GetNextProbeTime
(
const
ProbeCluster
&
cluster
)
;
ProbingState
probing_state_
;
std
:
:
queue
<
ProbeCluster
>
clusters_
;
int64_t
next_probe_time_ms_
;
int
next_cluster_id_
;
RtcEventLog
*
const
event_log_
;
}
;
}
#
endif
