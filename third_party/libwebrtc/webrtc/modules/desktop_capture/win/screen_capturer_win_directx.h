#
ifndef
MODULES_DESKTOP_CAPTURE_WIN_SCREEN_CAPTURER_WIN_DIRECTX_H_
#
define
MODULES_DESKTOP_CAPTURE_WIN_SCREEN_CAPTURER_WIN_DIRECTX_H_
#
include
<
D3DCommon
.
h
>
#
include
<
memory
>
#
include
<
vector
>
#
include
"
modules
/
desktop_capture
/
desktop_capture_options
.
h
"
#
include
"
modules
/
desktop_capture
/
desktop_capturer
.
h
"
#
include
"
modules
/
desktop_capture
/
desktop_region
.
h
"
#
include
"
modules
/
desktop_capture
/
screen_capture_frame_queue
.
h
"
#
include
"
modules
/
desktop_capture
/
win
/
dxgi_duplicator_controller
.
h
"
#
include
"
modules
/
desktop_capture
/
win
/
dxgi_frame
.
h
"
#
include
"
rtc_base
/
scoped_ref_ptr
.
h
"
namespace
webrtc
{
class
ScreenCapturerWinDirectx
:
public
DesktopCapturer
{
public
:
using
D3dInfo
=
DxgiDuplicatorController
:
:
D3dInfo
;
static
bool
IsSupported
(
)
;
static
bool
RetrieveD3dInfo
(
D3dInfo
*
info
)
;
static
bool
IsCurrentSessionSupported
(
)
;
static
bool
GetScreenListFromDeviceNames
(
const
std
:
:
vector
<
std
:
:
string
>
&
device_names
DesktopCapturer
:
:
SourceList
*
screens
)
;
static
int
GetIndexFromScreenId
(
ScreenId
id
const
std
:
:
vector
<
std
:
:
string
>
&
device_names
)
;
explicit
ScreenCapturerWinDirectx
(
)
;
~
ScreenCapturerWinDirectx
(
)
override
;
void
Start
(
Callback
*
callback
)
override
;
void
SetSharedMemoryFactory
(
std
:
:
unique_ptr
<
SharedMemoryFactory
>
shared_memory_factory
)
override
;
void
CaptureFrame
(
)
override
;
bool
GetSourceList
(
SourceList
*
sources
)
override
;
bool
SelectSource
(
SourceId
id
)
override
;
private
:
const
rtc
:
:
scoped_refptr
<
DxgiDuplicatorController
>
controller_
;
ScreenCaptureFrameQueue
<
DxgiFrame
>
frames_
;
std
:
:
unique_ptr
<
SharedMemoryFactory
>
shared_memory_factory_
;
Callback
*
callback_
=
nullptr
;
SourceId
current_screen_id_
=
kFullDesktopScreenId
;
RTC_DISALLOW_COPY_AND_ASSIGN
(
ScreenCapturerWinDirectx
)
;
}
;
}
#
endif
