#
ifndef
MODULES_AUDIO_CODING_NETEQ_INCLUDE_NETEQ_H_
#
define
MODULES_AUDIO_CODING_NETEQ_INCLUDE_NETEQ_H_
#
include
<
string
.
h
>
#
include
<
string
>
#
include
<
vector
>
#
include
"
api
/
audio_codecs
/
audio_decoder
.
h
"
#
include
"
api
/
optional
.
h
"
#
include
"
common_types
.
h
"
#
include
"
modules
/
audio_coding
/
neteq
/
neteq_decoder_enum
.
h
"
#
include
"
rtc_base
/
constructormagic
.
h
"
#
include
"
rtc_base
/
scoped_ref_ptr
.
h
"
#
include
"
typedefs
.
h
"
namespace
webrtc
{
class
AudioFrame
;
class
AudioDecoderFactory
;
struct
NetEqNetworkStatistics
{
uint16_t
current_buffer_size_ms
;
uint16_t
preferred_buffer_size_ms
;
uint16_t
jitter_peaks_found
;
uint16_t
packet_loss_rate
;
uint16_t
expand_rate
;
uint16_t
speech_expand_rate
;
uint16_t
preemptive_rate
;
uint16_t
accelerate_rate
;
uint16_t
secondary_decoded_rate
;
uint16_t
secondary_discarded_rate
;
int32_t
clockdrift_ppm
;
size_t
added_zero_samples
;
int
mean_waiting_time_ms
;
int
median_waiting_time_ms
;
int
min_waiting_time_ms
;
int
max_waiting_time_ms
;
}
;
struct
NetEqLifetimeStatistics
{
uint64_t
total_samples_received
=
0
;
uint64_t
concealed_samples
=
0
;
uint64_t
concealment_events
=
0
;
uint64_t
jitter_buffer_delay_ms
=
0
;
}
;
enum
NetEqPlayoutMode
{
kPlayoutOn
kPlayoutOff
kPlayoutFax
kPlayoutStreaming
}
;
class
NetEq
{
public
:
enum
BackgroundNoiseMode
{
kBgnOn
kBgnFade
kBgnOff
}
;
struct
Config
{
Config
(
)
:
sample_rate_hz
(
16000
)
enable_post_decode_vad
(
false
)
max_packets_in_buffer
(
50
)
max_delay_ms
(
2000
)
background_noise_mode
(
kBgnOff
)
playout_mode
(
kPlayoutOn
)
enable_fast_accelerate
(
false
)
{
}
std
:
:
string
ToString
(
)
const
;
int
sample_rate_hz
;
bool
enable_post_decode_vad
;
size_t
max_packets_in_buffer
;
int
max_delay_ms
;
BackgroundNoiseMode
background_noise_mode
;
NetEqPlayoutMode
playout_mode
;
bool
enable_fast_accelerate
;
bool
enable_muted_state
=
false
;
}
;
enum
ReturnCodes
{
kOK
=
0
kFail
=
-
1
kNotImplemented
=
-
2
}
;
static
NetEq
*
Create
(
const
NetEq
:
:
Config
&
config
const
rtc
:
:
scoped_refptr
<
AudioDecoderFactory
>
&
decoder_factory
)
;
virtual
~
NetEq
(
)
{
}
virtual
int
InsertPacket
(
const
RTPHeader
&
rtp_header
rtc
:
:
ArrayView
<
const
uint8_t
>
payload
uint32_t
receive_timestamp
)
=
0
;
virtual
void
InsertEmptyPacket
(
const
RTPHeader
&
rtp_header
)
=
0
;
virtual
int
GetAudio
(
AudioFrame
*
audio_frame
bool
*
muted
)
=
0
;
virtual
void
SetCodecs
(
const
std
:
:
map
<
int
SdpAudioFormat
>
&
codecs
)
=
0
;
virtual
int
RegisterPayloadType
(
NetEqDecoder
codec
const
std
:
:
string
&
codec_name
uint8_t
rtp_payload_type
)
=
0
;
virtual
int
RegisterExternalDecoder
(
AudioDecoder
*
decoder
NetEqDecoder
codec
const
std
:
:
string
&
codec_name
uint8_t
rtp_payload_type
)
=
0
;
virtual
bool
RegisterPayloadType
(
int
rtp_payload_type
const
SdpAudioFormat
&
audio_format
)
=
0
;
virtual
int
RemovePayloadType
(
uint8_t
rtp_payload_type
)
=
0
;
virtual
void
RemoveAllPayloadTypes
(
)
=
0
;
virtual
bool
SetMinimumDelay
(
int
delay_ms
)
=
0
;
virtual
bool
SetMaximumDelay
(
int
delay_ms
)
=
0
;
virtual
int
LeastRequiredDelayMs
(
)
const
=
0
;
virtual
int
SetTargetDelay
(
)
=
0
;
virtual
int
TargetDelayMs
(
)
const
=
0
;
virtual
int
CurrentDelayMs
(
)
const
=
0
;
virtual
int
FilteredCurrentDelayMs
(
)
const
=
0
;
virtual
void
SetPlayoutMode
(
NetEqPlayoutMode
mode
)
=
0
;
virtual
NetEqPlayoutMode
PlayoutMode
(
)
const
=
0
;
virtual
int
NetworkStatistics
(
NetEqNetworkStatistics
*
stats
)
=
0
;
virtual
NetEqLifetimeStatistics
GetLifetimeStatistics
(
)
const
=
0
;
virtual
void
GetRtcpStatistics
(
RtcpStatistics
*
stats
)
=
0
;
virtual
void
GetRtcpStatisticsNoReset
(
RtcpStatistics
*
stats
)
=
0
;
virtual
void
EnableVad
(
)
=
0
;
virtual
void
DisableVad
(
)
=
0
;
virtual
rtc
:
:
Optional
<
uint32_t
>
GetPlayoutTimestamp
(
)
const
=
0
;
virtual
int
last_output_sample_rate_hz
(
)
const
=
0
;
virtual
rtc
:
:
Optional
<
CodecInst
>
GetDecoder
(
int
payload_type
)
const
=
0
;
virtual
rtc
:
:
Optional
<
SdpAudioFormat
>
GetDecoderFormat
(
int
payload_type
)
const
=
0
;
virtual
int
SetTargetNumberOfChannels
(
)
=
0
;
virtual
int
SetTargetSampleRate
(
)
=
0
;
virtual
void
FlushBuffers
(
)
=
0
;
virtual
void
PacketBufferStatistics
(
int
*
current_num_packets
int
*
max_num_packets
)
const
=
0
;
virtual
void
EnableNack
(
size_t
max_nack_list_size
)
=
0
;
virtual
void
DisableNack
(
)
=
0
;
virtual
std
:
:
vector
<
uint16_t
>
GetNackList
(
int64_t
round_trip_time_ms
)
const
=
0
;
virtual
std
:
:
vector
<
uint32_t
>
LastDecodedTimestamps
(
)
const
=
0
;
virtual
int
SyncBufferSizeMs
(
)
const
=
0
;
protected
:
NetEq
(
)
{
}
private
:
RTC_DISALLOW_COPY_AND_ASSIGN
(
NetEq
)
;
}
;
}
#
endif
