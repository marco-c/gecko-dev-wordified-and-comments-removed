#
include
"
modules
/
audio_coding
/
audio_network_adaptor
/
dtx_controller
.
h
"
#
include
"
rtc_base
/
checks
.
h
"
namespace
webrtc
{
DtxController
:
:
Config
:
:
Config
(
bool
initial_dtx_enabled
int
dtx_enabling_bandwidth_bps
int
dtx_disabling_bandwidth_bps
)
:
initial_dtx_enabled
(
initial_dtx_enabled
)
dtx_enabling_bandwidth_bps
(
dtx_enabling_bandwidth_bps
)
dtx_disabling_bandwidth_bps
(
dtx_disabling_bandwidth_bps
)
{
}
DtxController
:
:
DtxController
(
const
Config
&
config
)
:
config_
(
config
)
dtx_enabled_
(
config_
.
initial_dtx_enabled
)
{
}
DtxController
:
:
~
DtxController
(
)
=
default
;
void
DtxController
:
:
UpdateNetworkMetrics
(
const
NetworkMetrics
&
network_metrics
)
{
if
(
network_metrics
.
uplink_bandwidth_bps
)
uplink_bandwidth_bps_
=
network_metrics
.
uplink_bandwidth_bps
;
}
void
DtxController
:
:
MakeDecision
(
AudioEncoderRuntimeConfig
*
config
)
{
RTC_DCHECK
(
!
config
-
>
enable_dtx
)
;
if
(
uplink_bandwidth_bps_
)
{
if
(
dtx_enabled_
&
&
*
uplink_bandwidth_bps_
>
=
config_
.
dtx_disabling_bandwidth_bps
)
{
dtx_enabled_
=
false
;
}
else
if
(
!
dtx_enabled_
&
&
*
uplink_bandwidth_bps_
<
=
config_
.
dtx_enabling_bandwidth_bps
)
{
dtx_enabled_
=
true
;
}
}
config
-
>
enable_dtx
=
dtx_enabled_
;
}
}
