#
ifndef
SYSTEM_WRAPPERS_INCLUDE_CLOCK_H_
#
define
SYSTEM_WRAPPERS_INCLUDE_CLOCK_H_
#
include
<
memory
>
#
include
"
system_wrappers
/
include
/
ntp_time
.
h
"
#
include
"
system_wrappers
/
include
/
rw_lock_wrapper
.
h
"
#
include
"
typedefs
.
h
"
namespace
webrtc
{
const
uint32_t
kNtpJan1970
=
2208988800UL
;
const
double
kMagicNtpFractionalUnit
=
4
.
294967296E
+
9
;
class
Clock
{
public
:
virtual
~
Clock
(
)
{
}
virtual
int64_t
TimeInMilliseconds
(
)
const
=
0
;
virtual
int64_t
TimeInMicroseconds
(
)
const
=
0
;
virtual
NtpTime
CurrentNtpTime
(
)
const
=
0
;
virtual
int64_t
CurrentNtpInMilliseconds
(
)
const
=
0
;
static
int64_t
NtpToMs
(
uint32_t
seconds
uint32_t
fractions
)
{
return
NtpTime
(
seconds
fractions
)
.
ToMs
(
)
;
}
static
Clock
*
GetRealTimeClock
(
)
;
}
;
class
SimulatedClock
:
public
Clock
{
public
:
explicit
SimulatedClock
(
int64_t
initial_time_us
)
;
~
SimulatedClock
(
)
override
;
int64_t
TimeInMilliseconds
(
)
const
override
;
int64_t
TimeInMicroseconds
(
)
const
override
;
NtpTime
CurrentNtpTime
(
)
const
override
;
int64_t
CurrentNtpInMilliseconds
(
)
const
override
;
void
AdvanceTimeMilliseconds
(
int64_t
milliseconds
)
;
void
AdvanceTimeMicroseconds
(
int64_t
microseconds
)
;
private
:
int64_t
time_us_
;
std
:
:
unique_ptr
<
RWLockWrapper
>
lock_
;
}
;
}
;
#
endif
