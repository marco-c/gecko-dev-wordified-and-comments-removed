#
ifndef
MEDIA_BASE_VIDEOBROADCASTER_H_
#
define
MEDIA_BASE_VIDEOBROADCASTER_H_
#
include
<
memory
>
#
include
<
utility
>
#
include
<
vector
>
#
include
"
api
/
video
/
video_frame
.
h
"
#
include
"
media
/
base
/
videosinkinterface
.
h
"
#
include
"
media
/
base
/
videosourcebase
.
h
"
#
include
"
rtc_base
/
criticalsection
.
h
"
#
include
"
rtc_base
/
thread_checker
.
h
"
namespace
rtc
{
class
VideoBroadcaster
:
public
VideoSourceBase
public
VideoSinkInterface
<
webrtc
:
:
VideoFrame
>
{
public
:
VideoBroadcaster
(
)
;
void
AddOrUpdateSink
(
VideoSinkInterface
<
webrtc
:
:
VideoFrame
>
*
sink
const
VideoSinkWants
&
wants
)
override
;
void
RemoveSink
(
VideoSinkInterface
<
webrtc
:
:
VideoFrame
>
*
sink
)
override
;
bool
frame_wanted
(
)
const
;
VideoSinkWants
wants
(
)
const
;
void
OnFrame
(
const
webrtc
:
:
VideoFrame
&
frame
)
override
;
void
OnDiscardedFrame
(
)
override
;
protected
:
void
UpdateWants
(
)
RTC_EXCLUSIVE_LOCKS_REQUIRED
(
sinks_and_wants_lock_
)
;
const
rtc
:
:
scoped_refptr
<
webrtc
:
:
VideoFrameBuffer
>
&
GetBlackFrameBuffer
(
int
width
int
height
)
RTC_EXCLUSIVE_LOCKS_REQUIRED
(
sinks_and_wants_lock_
)
;
ThreadChecker
thread_checker_
;
rtc
:
:
CriticalSection
sinks_and_wants_lock_
;
VideoSinkWants
current_wants_
RTC_GUARDED_BY
(
sinks_and_wants_lock_
)
;
rtc
:
:
scoped_refptr
<
webrtc
:
:
VideoFrameBuffer
>
black_frame_buffer_
;
}
;
}
#
endif
