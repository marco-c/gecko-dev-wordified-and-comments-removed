#
ifndef
MEDIA_BASE_VIDEO_SOURCE_BASE_H_
#
define
MEDIA_BASE_VIDEO_SOURCE_BASE_H_
#
include
<
vector
>
#
include
"
api
/
sequence_checker
.
h
"
#
include
"
api
/
video
/
video_frame
.
h
"
#
include
"
api
/
video
/
video_sink_interface
.
h
"
#
include
"
api
/
video
/
video_source_interface
.
h
"
#
include
"
rtc_base
/
system
/
no_unique_address
.
h
"
#
include
"
rtc_base
/
thread_annotations
.
h
"
namespace
webrtc
{
class
VideoSourceBase
:
public
VideoSourceInterface
<
VideoFrame
>
{
public
:
VideoSourceBase
(
)
;
~
VideoSourceBase
(
)
override
;
void
AddOrUpdateSink
(
VideoSinkInterface
<
VideoFrame
>
*
sink
const
VideoSinkWants
&
wants
)
override
;
void
RemoveSink
(
VideoSinkInterface
<
VideoFrame
>
*
sink
)
override
;
protected
:
struct
SinkPair
{
SinkPair
(
VideoSinkInterface
<
VideoFrame
>
*
sink
VideoSinkWants
wants
)
:
sink
(
sink
)
wants
(
wants
)
{
}
VideoSinkInterface
<
VideoFrame
>
*
sink
;
VideoSinkWants
wants
;
}
;
SinkPair
*
FindSinkPair
(
const
VideoSinkInterface
<
VideoFrame
>
*
sink
)
;
const
std
:
:
vector
<
SinkPair
>
&
sink_pairs
(
)
const
{
return
sinks_
;
}
private
:
std
:
:
vector
<
SinkPair
>
sinks_
;
}
;
class
VideoSourceBaseGuarded
:
public
VideoSourceInterface
<
VideoFrame
>
{
public
:
VideoSourceBaseGuarded
(
)
;
~
VideoSourceBaseGuarded
(
)
override
;
void
AddOrUpdateSink
(
VideoSinkInterface
<
VideoFrame
>
*
sink
const
VideoSinkWants
&
wants
)
override
;
void
RemoveSink
(
VideoSinkInterface
<
VideoFrame
>
*
sink
)
override
;
protected
:
struct
SinkPair
{
SinkPair
(
VideoSinkInterface
<
VideoFrame
>
*
sink
VideoSinkWants
wants
)
:
sink
(
sink
)
wants
(
wants
)
{
}
VideoSinkInterface
<
VideoFrame
>
*
sink
;
VideoSinkWants
wants
;
}
;
SinkPair
*
FindSinkPair
(
const
VideoSinkInterface
<
VideoFrame
>
*
sink
)
;
const
std
:
:
vector
<
SinkPair
>
&
sink_pairs
(
)
const
;
RTC_NO_UNIQUE_ADDRESS
SequenceChecker
source_sequence_
;
private
:
std
:
:
vector
<
SinkPair
>
sinks_
RTC_GUARDED_BY
(
&
source_sequence_
)
;
}
;
}
#
ifdef
WEBRTC_ALLOW_DEPRECATED_NAMESPACES
namespace
rtc
{
using
:
:
webrtc
:
:
VideoSourceBase
;
using
:
:
webrtc
:
:
VideoSourceBaseGuarded
;
}
#
endif
#
endif
