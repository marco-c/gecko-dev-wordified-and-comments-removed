#
ifndef
MEDIA_BASE_MEDIA_ENGINE_H_
#
define
MEDIA_BASE_MEDIA_ENGINE_H_
#
include
<
memory
>
#
include
<
string
>
#
include
<
vector
>
#
include
"
api
/
audio_codecs
/
audio_decoder_factory
.
h
"
#
include
"
api
/
audio_codecs
/
audio_encoder_factory
.
h
"
#
include
"
api
/
crypto
/
crypto_options
.
h
"
#
include
"
api
/
rtp_parameters
.
h
"
#
include
"
api
/
transport
/
webrtc_key_value_config
.
h
"
#
include
"
api
/
video
/
video_bitrate_allocator_factory
.
h
"
#
include
"
call
/
audio_state
.
h
"
#
include
"
media
/
base
/
codec
.
h
"
#
include
"
media
/
base
/
media_channel
.
h
"
#
include
"
media
/
base
/
video_common
.
h
"
#
include
"
rtc_base
/
system
/
file_wrapper
.
h
"
namespace
webrtc
{
class
AudioDeviceModule
;
class
AudioMixer
;
class
AudioProcessing
;
class
Call
;
}
namespace
cricket
{
webrtc
:
:
RTCError
CheckRtpParametersValues
(
const
webrtc
:
:
RtpParameters
&
new_parameters
)
;
webrtc
:
:
RTCError
CheckRtpParametersInvalidModificationAndValues
(
const
webrtc
:
:
RtpParameters
&
old_parameters
const
webrtc
:
:
RtpParameters
&
new_parameters
)
;
struct
RtpCapabilities
{
RtpCapabilities
(
)
;
~
RtpCapabilities
(
)
;
std
:
:
vector
<
webrtc
:
:
RtpExtension
>
header_extensions
;
}
;
class
RtpHeaderExtensionQueryInterface
{
public
:
virtual
~
RtpHeaderExtensionQueryInterface
(
)
=
default
;
virtual
std
:
:
vector
<
webrtc
:
:
RtpHeaderExtensionCapability
>
GetRtpHeaderExtensions
(
)
const
=
0
;
}
;
class
VoiceEngineInterface
:
public
RtpHeaderExtensionQueryInterface
{
public
:
VoiceEngineInterface
(
)
=
default
;
virtual
~
VoiceEngineInterface
(
)
=
default
;
RTC_DISALLOW_COPY_AND_ASSIGN
(
VoiceEngineInterface
)
;
virtual
void
Init
(
)
=
0
;
virtual
rtc
:
:
scoped_refptr
<
webrtc
:
:
AudioState
>
GetAudioState
(
)
const
=
0
;
virtual
VoiceMediaChannel
*
CreateMediaChannel
(
webrtc
:
:
Call
*
call
const
MediaConfig
&
config
const
AudioOptions
&
options
const
webrtc
:
:
CryptoOptions
&
crypto_options
)
=
0
;
virtual
const
std
:
:
vector
<
AudioCodec
>
&
send_codecs
(
)
const
=
0
;
virtual
const
std
:
:
vector
<
AudioCodec
>
&
recv_codecs
(
)
const
=
0
;
virtual
bool
StartAecDump
(
webrtc
:
:
FileWrapper
file
int64_t
max_size_bytes
)
=
0
;
virtual
void
StopAecDump
(
)
=
0
;
}
;
class
VideoEngineInterface
:
public
RtpHeaderExtensionQueryInterface
{
public
:
VideoEngineInterface
(
)
=
default
;
virtual
~
VideoEngineInterface
(
)
=
default
;
RTC_DISALLOW_COPY_AND_ASSIGN
(
VideoEngineInterface
)
;
virtual
VideoMediaChannel
*
CreateMediaChannel
(
webrtc
:
:
Call
*
call
const
MediaConfig
&
config
const
VideoOptions
&
options
const
webrtc
:
:
CryptoOptions
&
crypto_options
webrtc
:
:
VideoBitrateAllocatorFactory
*
video_bitrate_allocator_factory
)
=
0
;
virtual
std
:
:
vector
<
VideoCodec
>
send_codecs
(
)
const
=
0
;
virtual
std
:
:
vector
<
VideoCodec
>
recv_codecs
(
)
const
=
0
;
}
;
class
MediaEngineInterface
{
public
:
virtual
~
MediaEngineInterface
(
)
{
}
virtual
bool
Init
(
)
=
0
;
virtual
VoiceEngineInterface
&
voice
(
)
=
0
;
virtual
VideoEngineInterface
&
video
(
)
=
0
;
virtual
const
VoiceEngineInterface
&
voice
(
)
const
=
0
;
virtual
const
VideoEngineInterface
&
video
(
)
const
=
0
;
}
;
class
CompositeMediaEngine
:
public
MediaEngineInterface
{
public
:
CompositeMediaEngine
(
std
:
:
unique_ptr
<
webrtc
:
:
WebRtcKeyValueConfig
>
trials
std
:
:
unique_ptr
<
VoiceEngineInterface
>
audio_engine
std
:
:
unique_ptr
<
VideoEngineInterface
>
video_engine
)
;
CompositeMediaEngine
(
std
:
:
unique_ptr
<
VoiceEngineInterface
>
audio_engine
std
:
:
unique_ptr
<
VideoEngineInterface
>
video_engine
)
;
~
CompositeMediaEngine
(
)
override
;
bool
Init
(
)
override
;
VoiceEngineInterface
&
voice
(
)
override
;
VideoEngineInterface
&
video
(
)
override
;
const
VoiceEngineInterface
&
voice
(
)
const
override
;
const
VideoEngineInterface
&
video
(
)
const
override
;
private
:
const
std
:
:
unique_ptr
<
webrtc
:
:
WebRtcKeyValueConfig
>
trials_
;
std
:
:
unique_ptr
<
VoiceEngineInterface
>
voice_engine_
;
std
:
:
unique_ptr
<
VideoEngineInterface
>
video_engine_
;
}
;
enum
DataChannelType
{
DCT_NONE
=
0
DCT_RTP
=
1
DCT_SCTP
=
2
}
;
class
DataEngineInterface
{
public
:
virtual
~
DataEngineInterface
(
)
{
}
virtual
DataMediaChannel
*
CreateChannel
(
const
MediaConfig
&
config
)
=
0
;
virtual
const
std
:
:
vector
<
DataCodec
>
&
data_codecs
(
)
=
0
;
}
;
webrtc
:
:
RtpParameters
CreateRtpParametersWithOneEncoding
(
)
;
webrtc
:
:
RtpParameters
CreateRtpParametersWithEncodings
(
StreamParams
sp
)
;
std
:
:
vector
<
webrtc
:
:
RtpExtension
>
GetDefaultEnabledRtpHeaderExtensions
(
const
RtpHeaderExtensionQueryInterface
&
query_interface
)
;
}
#
endif
