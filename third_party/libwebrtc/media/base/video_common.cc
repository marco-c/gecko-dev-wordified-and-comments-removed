#
include
"
media
/
base
/
video_common
.
h
"
#
include
<
cstdint
>
#
include
<
numeric
>
#
include
<
string
>
#
include
"
api
/
array_view
.
h
"
#
include
"
rtc_base
/
checks
.
h
"
#
include
"
rtc_base
/
strings
/
string_builder
.
h
"
namespace
webrtc
{
struct
FourCCAliasEntry
{
uint32_t
alias
;
uint32_t
canonical
;
}
;
static
const
FourCCAliasEntry
kFourCCAliases
[
]
=
{
{
.
alias
=
FOURCC_IYUV
.
canonical
=
FOURCC_I420
}
{
.
alias
=
FOURCC_YU16
.
canonical
=
FOURCC_I422
}
{
.
alias
=
FOURCC_YU24
.
canonical
=
FOURCC_I444
}
{
.
alias
=
FOURCC_YUYV
.
canonical
=
FOURCC_YUY2
}
{
.
alias
=
FOURCC_YUVS
.
canonical
=
FOURCC_YUY2
}
{
.
alias
=
FOURCC_HDYC
.
canonical
=
FOURCC_UYVY
}
{
.
alias
=
FOURCC_2VUY
.
canonical
=
FOURCC_UYVY
}
{
.
alias
=
FOURCC_JPEG
.
canonical
=
FOURCC_MJPG
}
{
.
alias
=
FOURCC_DMB1
.
canonical
=
FOURCC_MJPG
}
{
.
alias
=
FOURCC_BA81
.
canonical
=
FOURCC_BGGR
}
{
.
alias
=
FOURCC_RGB3
.
canonical
=
FOURCC_RAW
}
{
.
alias
=
FOURCC_BGR3
.
canonical
=
FOURCC_24BG
}
{
.
alias
=
FOURCC_CM32
.
canonical
=
FOURCC_BGRA
}
{
.
alias
=
FOURCC_CM24
.
canonical
=
FOURCC_RAW
}
}
;
uint32_t
CanonicalFourCC
(
uint32_t
fourcc
)
{
for
(
const
FourCCAliasEntry
&
entry
:
kFourCCAliases
)
{
if
(
entry
.
alias
=
=
fourcc
)
{
return
entry
.
canonical
;
}
}
return
fourcc
;
}
#
ifndef
_MSC_EXTENSIONS
const
int64_t
VideoFormat
:
:
kMinimumInterval
;
#
endif
std
:
:
string
VideoFormat
:
:
ToString
(
)
const
{
std
:
:
string
fourcc_name
=
GetFourccName
(
fourcc
)
+
"
"
;
for
(
std
:
:
string
:
:
const_iterator
i
=
fourcc_name
.
begin
(
)
;
i
<
fourcc_name
.
end
(
)
;
+
+
i
)
{
if
(
*
i
<
32
|
|
*
i
>
=
127
)
{
fourcc_name
=
"
"
;
break
;
}
}
char
buf
[
256
]
;
SimpleStringBuilder
sb
(
buf
)
;
sb
<
<
fourcc_name
<
<
width
<
<
"
x
"
<
<
height
<
<
"
x
"
<
<
IntervalToFpsFloat
(
interval
)
;
return
sb
.
str
(
)
;
}
int
GreatestCommonDivisor
(
int
a
int
b
)
{
RTC_DCHECK_GE
(
a
0
)
;
RTC_DCHECK_GT
(
b
0
)
;
return
std
:
:
gcd
(
a
b
)
;
}
int
LeastCommonMultiple
(
int
a
int
b
)
{
RTC_DCHECK_GT
(
a
0
)
;
RTC_DCHECK_GT
(
b
0
)
;
return
std
:
:
lcm
(
a
b
)
;
}
}
