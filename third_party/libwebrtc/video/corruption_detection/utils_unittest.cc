#
include
"
video
/
corruption_detection
/
utils
.
h
"
#
include
"
api
/
video
/
encoded_image
.
h
"
#
include
"
api
/
video
/
video_codec_type
.
h
"
#
include
"
test
/
gmock
.
h
"
#
include
"
test
/
gtest
.
h
"
namespace
webrtc
{
namespace
{
#
if
GTEST_HAS_DEATH_TEST
using
:
:
testing
:
:
_
;
#
endif
TEST
(
UtilsTest
FindCodecFromString
)
{
EXPECT_EQ
(
GetVideoCodecType
(
"
VP8
"
)
kVideoCodecVP8
)
;
EXPECT_EQ
(
GetVideoCodecType
(
"
libvpx
-
vp9
"
)
kVideoCodecVP9
)
;
EXPECT_EQ
(
GetVideoCodecType
(
"
ImprovedAV1
"
)
kVideoCodecAV1
)
;
EXPECT_EQ
(
GetVideoCodecType
(
"
lets_use_h264
"
)
kVideoCodecH264
)
;
}
#
if
GTEST_HAS_DEATH_TEST
TEST
(
UtilsTest
IfCodecDoesNotExistRaiseError
)
{
EXPECT_DEATH
(
GetVideoCodecType
(
"
Not_a_codec
"
)
_
)
;
}
#
endif
TEST
(
UtilsTest
GetLayerIdReturnsZeroForEmptyIndices
)
{
EncodedImage
encoded_image
;
EXPECT_EQ
(
GetSpatialLayerId
(
encoded_image
)
0
)
;
}
TEST
(
UtilsTest
GetLayerIdReturnsSpatialIndexWhenSet
)
{
EncodedImage
encoded_image
;
encoded_image
.
SetSpatialIndex
(
2
)
;
EXPECT_EQ
(
GetSpatialLayerId
(
encoded_image
)
2
)
;
}
TEST
(
UtilsTest
GetLayerIdReturnsSimulcastIndexWhenSet
)
{
EncodedImage
encoded_image
;
encoded_image
.
SetSimulcastIndex
(
1
)
;
EXPECT_EQ
(
GetSpatialLayerId
(
encoded_image
)
1
)
;
}
TEST
(
UtilsTest
GetLayerIdReturnsMaxOfSpatialAndSimulcastIndex
)
{
EncodedImage
encoded_image
;
encoded_image
.
SetSpatialIndex
(
1
)
;
encoded_image
.
SetSimulcastIndex
(
2
)
;
EXPECT_EQ
(
GetSpatialLayerId
(
encoded_image
)
2
)
;
encoded_image
.
SetSpatialIndex
(
3
)
;
encoded_image
.
SetSimulcastIndex
(
1
)
;
EXPECT_EQ
(
GetSpatialLayerId
(
encoded_image
)
3
)
;
}
}
}
