'
use
strict
'
;
let
uniqueID
=
1
;
class
Store
{
constructor
(
name
callback
)
{
this
.
_dbName
=
name
;
this
.
memoryStorage
=
this
.
memoryStorage
|
|
{
}
;
if
(
!
this
.
memoryStorage
[
name
]
)
{
let
data
=
{
todos
:
[
]
}
;
this
.
memoryStorage
[
name
]
=
JSON
.
stringify
(
data
)
;
}
if
(
callback
)
{
callback
.
call
(
this
JSON
.
parse
(
this
.
memoryStorage
[
name
]
)
)
;
}
}
find
(
query
callback
)
{
if
(
!
callback
)
{
return
;
}
let
todos
=
JSON
.
parse
(
this
.
memoryStorage
[
this
.
_dbName
]
)
.
todos
;
callback
.
call
(
this
todos
.
filter
(
todo
=
>
{
for
(
let
q
in
query
)
{
if
(
query
[
q
]
!
=
=
todo
[
q
]
)
{
return
false
;
}
}
return
true
;
}
)
)
;
}
findAll
(
callback
)
{
if
(
callback
)
{
callback
.
call
(
this
JSON
.
parse
(
this
.
memoryStorage
[
this
.
_dbName
]
)
.
todos
)
;
}
}
save
(
updateData
callback
id
)
{
const
data
=
JSON
.
parse
(
this
.
memoryStorage
[
this
.
_dbName
]
)
;
let
todos
=
data
.
todos
;
const
len
=
todos
.
length
;
if
(
id
)
{
for
(
let
i
=
0
;
i
<
len
;
i
+
+
)
{
if
(
todos
[
i
]
.
id
=
=
=
id
)
{
for
(
let
key
in
updateData
)
{
todos
[
i
]
[
key
]
=
updateData
[
key
]
;
}
break
;
}
}
this
.
memoryStorage
[
this
.
_dbName
]
=
JSON
.
stringify
(
data
)
;
if
(
callback
)
{
callback
.
call
(
this
JSON
.
parse
(
this
.
memoryStorage
[
this
.
_dbName
]
)
.
todos
)
;
}
}
else
{
updateData
.
id
=
uniqueID
+
+
;
todos
.
push
(
updateData
)
;
this
.
memoryStorage
[
this
.
_dbName
]
=
JSON
.
stringify
(
data
)
;
if
(
callback
)
{
callback
.
call
(
this
[
updateData
]
)
;
}
}
}
remove
(
id
callback
)
{
const
data
=
JSON
.
parse
(
this
.
memoryStorage
[
this
.
_dbName
]
)
;
let
todos
=
data
.
todos
;
const
len
=
todos
.
length
;
for
(
let
i
=
0
;
i
<
todos
.
length
;
i
+
+
)
{
if
(
todos
[
i
]
.
id
=
=
id
)
{
todos
.
splice
(
i
1
)
;
break
;
}
}
this
.
memoryStorage
[
this
.
_dbName
]
=
JSON
.
stringify
(
data
)
;
if
(
callback
)
{
callback
.
call
(
this
JSON
.
parse
(
this
.
memoryStorage
[
this
.
_dbName
]
)
.
todos
)
;
}
}
drop
(
callback
)
{
this
.
memoryStorage
[
this
.
_dbName
]
=
JSON
.
stringify
(
{
todos
:
[
]
}
)
;
if
(
callback
)
{
callback
.
call
(
this
JSON
.
parse
(
this
.
memoryStorage
[
this
.
_dbName
]
)
.
todos
)
;
}
}
}
