#
ifndef
SPA_DBUS_H
#
define
SPA_DBUS_H
#
ifdef
__cplusplus
extern
"
C
"
{
#
endif
#
include
<
spa
/
support
/
loop
.
h
>
#
define
SPA_TYPE_INTERFACE_DBus
SPA_TYPE_INFO_INTERFACE_BASE
"
DBus
"
#
define
SPA_VERSION_DBUS
0
struct
spa_dbus
{
struct
spa_interface
iface
;
}
;
enum
spa_dbus_type
{
SPA_DBUS_TYPE_SESSION
SPA_DBUS_TYPE_SYSTEM
SPA_DBUS_TYPE_STARTER
}
;
#
define
SPA_DBUS_CONNECTION_EVENT_DESTROY
0
#
define
SPA_DBUS_CONNECTION_EVENT_DISCONNECTED
1
#
define
SPA_DBUS_CONNECTION_EVENT_NUM
2
struct
spa_dbus_connection_events
{
#
define
SPA_VERSION_DBUS_CONNECTION_EVENTS
0
uint32_t
version
;
void
(
*
destroy
)
(
void
*
data
)
;
void
(
*
disconnected
)
(
void
*
data
)
;
}
;
struct
spa_dbus_connection
{
#
define
SPA_VERSION_DBUS_CONNECTION
1
uint32_t
version
;
void
*
(
*
get
)
(
struct
spa_dbus_connection
*
conn
)
;
void
(
*
destroy
)
(
struct
spa_dbus_connection
*
conn
)
;
void
(
*
add_listener
)
(
struct
spa_dbus_connection
*
conn
struct
spa_hook
*
listener
const
struct
spa_dbus_connection_events
*
events
void
*
data
)
;
}
;
#
define
spa_dbus_connection_call
(
c
method
vers
.
.
.
)
\
(
{
\
if
(
SPA_LIKELY
(
SPA_CALLBACK_CHECK
(
c
method
vers
)
)
)
\
c
-
>
method
(
(
c
)
#
#
__VA_ARGS__
)
;
\
}
)
#
define
spa_dbus_connection_call_vp
(
c
method
vers
.
.
.
)
\
(
{
\
void
*
_res
=
NULL
;
\
if
(
SPA_LIKELY
(
SPA_CALLBACK_CHECK
(
c
method
vers
)
)
)
\
_res
=
c
-
>
method
(
(
c
)
#
#
__VA_ARGS__
)
;
\
_res
;
\
}
)
#
define
spa_dbus_connection_get
(
c
)
spa_dbus_connection_call_vp
(
c
get
0
)
#
define
spa_dbus_connection_destroy
(
c
)
spa_dbus_connection_call
(
c
destroy
0
)
#
define
spa_dbus_connection_add_listener
(
c
.
.
.
)
spa_dbus_connection_call
(
c
add_listener
1
__VA_ARGS__
)
struct
spa_dbus_methods
{
#
define
SPA_VERSION_DBUS_METHODS
0
uint32_t
version
;
struct
spa_dbus_connection
*
(
*
get_connection
)
(
void
*
object
enum
spa_dbus_type
type
)
;
}
;
static
inline
struct
spa_dbus_connection
*
spa_dbus_get_connection
(
struct
spa_dbus
*
dbus
enum
spa_dbus_type
type
)
{
struct
spa_dbus_connection
*
res
=
NULL
;
spa_interface_call_res
(
&
dbus
-
>
iface
struct
spa_dbus_methods
res
get_connection
0
type
)
;
return
res
;
}
#
ifdef
__cplusplus
}
#
endif
#
endif
