#
include
"
absl
/
flags
/
internal
/
program_name
.
h
"
#
include
<
string
>
#
include
"
absl
/
base
/
attributes
.
h
"
#
include
"
absl
/
base
/
config
.
h
"
#
include
"
absl
/
base
/
no_destructor
.
h
"
#
include
"
absl
/
base
/
thread_annotations
.
h
"
#
include
"
absl
/
flags
/
internal
/
path_util
.
h
"
#
include
"
absl
/
strings
/
string_view
.
h
"
#
include
"
absl
/
synchronization
/
mutex
.
h
"
namespace
absl
{
ABSL_NAMESPACE_BEGIN
namespace
flags_internal
{
static
absl
:
:
Mutex
*
ProgramNameMutex
(
)
{
static
absl
:
:
NoDestructor
<
absl
:
:
Mutex
>
mutex
;
return
mutex
.
get
(
)
;
}
ABSL_CONST_INIT
static
std
:
:
string
*
program_name
ABSL_GUARDED_BY
(
ProgramNameMutex
(
)
)
ABSL_PT_GUARDED_BY
(
ProgramNameMutex
(
)
)
=
nullptr
;
std
:
:
string
ProgramInvocationName
(
)
{
absl
:
:
MutexLock
l
(
ProgramNameMutex
(
)
)
;
return
program_name
?
*
program_name
:
"
UNKNOWN
"
;
}
std
:
:
string
ShortProgramInvocationName
(
)
{
absl
:
:
MutexLock
l
(
ProgramNameMutex
(
)
)
;
return
program_name
?
std
:
:
string
(
flags_internal
:
:
Basename
(
*
program_name
)
)
:
"
UNKNOWN
"
;
}
void
SetProgramInvocationName
(
absl
:
:
string_view
prog_name_str
)
{
absl
:
:
MutexLock
l
(
ProgramNameMutex
(
)
)
;
if
(
!
program_name
)
{
program_name
=
new
std
:
:
string
(
prog_name_str
)
;
}
else
{
program_name
-
>
assign
(
prog_name_str
.
data
(
)
prog_name_str
.
size
(
)
)
;
}
}
}
ABSL_NAMESPACE_END
}
