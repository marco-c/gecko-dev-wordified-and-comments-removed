#
include
"
absl
/
base
/
internal
/
thread_identity
.
h
"
#
include
"
absl
/
synchronization
/
internal
/
create_thread_identity
.
h
"
#
include
"
absl
/
synchronization
/
internal
/
per_thread_sem
.
h
"
#
include
"
benchmark
/
benchmark
.
h
"
namespace
{
void
BM_SafeCurrentThreadIdentity
(
benchmark
:
:
State
&
state
)
{
for
(
auto
_
:
state
)
{
benchmark
:
:
DoNotOptimize
(
absl
:
:
synchronization_internal
:
:
GetOrCreateCurrentThreadIdentity
(
)
)
;
}
}
BENCHMARK
(
BM_SafeCurrentThreadIdentity
)
;
void
BM_UnsafeCurrentThreadIdentity
(
benchmark
:
:
State
&
state
)
{
for
(
auto
_
:
state
)
{
benchmark
:
:
DoNotOptimize
(
absl
:
:
base_internal
:
:
CurrentThreadIdentityIfPresent
(
)
)
;
}
}
BENCHMARK
(
BM_UnsafeCurrentThreadIdentity
)
;
}
