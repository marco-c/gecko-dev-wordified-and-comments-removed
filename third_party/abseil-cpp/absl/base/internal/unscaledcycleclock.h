#
ifndef
ABSL_BASE_INTERNAL_UNSCALEDCYCLECLOCK_H_
#
define
ABSL_BASE_INTERNAL_UNSCALEDCYCLECLOCK_H_
#
include
<
cstdint
>
#
if
defined
(
__APPLE__
)
#
include
<
TargetConditionals
.
h
>
#
endif
#
include
"
absl
/
base
/
config
.
h
"
#
include
"
absl
/
base
/
internal
/
unscaledcycleclock_config
.
h
"
#
if
ABSL_USE_UNSCALED_CYCLECLOCK
namespace
absl
{
ABSL_NAMESPACE_BEGIN
namespace
time_internal
{
class
UnscaledCycleClockWrapperForGetCurrentTime
;
}
namespace
base_internal
{
class
CycleClock
;
class
UnscaledCycleClockWrapperForInitializeFrequency
;
class
UnscaledCycleClock
{
private
:
UnscaledCycleClock
(
)
=
delete
;
static
int64_t
Now
(
)
;
static
double
Frequency
(
)
;
friend
class
base_internal
:
:
CycleClock
;
friend
class
time_internal
:
:
UnscaledCycleClockWrapperForGetCurrentTime
;
friend
class
base_internal
:
:
UnscaledCycleClockWrapperForInitializeFrequency
;
}
;
#
if
defined
(
__x86_64__
)
inline
int64_t
UnscaledCycleClock
:
:
Now
(
)
{
uint64_t
low
high
;
__asm__
volatile
(
"
rdtsc
"
:
"
=
a
"
(
low
)
"
=
d
"
(
high
)
)
;
return
static_cast
<
int64_t
>
(
(
high
<
<
32
)
|
low
)
;
}
#
elif
defined
(
__aarch64__
)
inline
int64_t
UnscaledCycleClock
:
:
Now
(
)
{
int64_t
virtual_timer_value
;
asm
volatile
(
"
mrs
%
0
cntvct_el0
"
:
"
=
r
"
(
virtual_timer_value
)
)
;
return
virtual_timer_value
;
}
#
endif
}
ABSL_NAMESPACE_END
}
#
endif
#
endif
