#
ifndef
HIGHWAY_HWY_NANOBENCHMARK_H_
#
define
HIGHWAY_HWY_NANOBENCHMARK_H_
#
include
<
stddef
.
h
>
#
include
<
stdint
.
h
>
#
include
"
hwy
/
highway_export
.
h
"
#
include
"
hwy
/
timer
.
h
"
namespace
hwy
{
HWY_DLLEXPORT
int
Unpredictable1
(
)
;
using
FuncInput
=
size_t
;
using
FuncOutput
=
uint64_t
;
using
Func
=
FuncOutput
(
*
)
(
const
void
*
FuncInput
)
;
struct
Params
{
size_t
precision_divisor
=
1024
;
size_t
subset_ratio
=
2
;
double
seconds_per_eval
=
4E
-
3
;
size_t
min_samples_per_eval
=
7
;
size_t
min_mode_samples
=
64
;
double
target_rel_mad
=
0
.
002
;
size_t
max_evals
=
9
;
bool
verbose
=
true
;
}
;
struct
Result
{
FuncInput
input
;
float
ticks
;
float
variability
;
}
;
HWY_DLLEXPORT
size_t
Measure
(
Func
func
const
uint8_t
*
arg
const
FuncInput
*
inputs
size_t
num_inputs
Result
*
results
const
Params
&
p
=
Params
(
)
)
;
template
<
class
Closure
>
static
FuncOutput
CallClosure
(
const
void
*
f
const
FuncInput
input
)
{
return
(
*
reinterpret_cast
<
const
Closure
*
>
(
f
)
)
(
input
)
;
}
template
<
class
Closure
>
static
inline
size_t
MeasureClosure
(
const
Closure
&
closure
const
FuncInput
*
inputs
const
size_t
num_inputs
Result
*
results
const
Params
&
p
=
Params
(
)
)
{
return
Measure
(
static_cast
<
Func
>
(
&
CallClosure
<
Closure
>
)
reinterpret_cast
<
const
uint8_t
*
>
(
&
closure
)
inputs
num_inputs
results
p
)
;
}
}
#
endif
