#
include
<
mprio
.
h
>
#
include
"
rand
.
h
"
#
include
"
share
.
h
"
#
include
"
util
.
h
"
SECStatus
share_int
(
const
struct
prio_config
*
cfg
const
mp_int
*
src
mp_int
*
shareA
mp_int
*
shareB
)
{
SECStatus
rv
;
P_CHECK
(
rand_int
(
shareA
&
cfg
-
>
modulus
)
)
;
MP_CHECK
(
mp_submod
(
src
shareA
&
cfg
-
>
modulus
shareB
)
)
;
return
rv
;
}
BeaverTriple
BeaverTriple_new
(
void
)
{
BeaverTriple
triple
=
malloc
(
sizeof
*
triple
)
;
if
(
!
triple
)
return
NULL
;
MP_DIGITS
(
&
triple
-
>
a
)
=
NULL
;
MP_DIGITS
(
&
triple
-
>
b
)
=
NULL
;
MP_DIGITS
(
&
triple
-
>
c
)
=
NULL
;
SECStatus
rv
=
SECSuccess
;
MP_CHECKC
(
mp_init
(
&
triple
-
>
a
)
)
;
MP_CHECKC
(
mp_init
(
&
triple
-
>
b
)
)
;
MP_CHECKC
(
mp_init
(
&
triple
-
>
c
)
)
;
cleanup
:
if
(
rv
!
=
SECSuccess
)
{
BeaverTriple_clear
(
triple
)
;
return
NULL
;
}
return
triple
;
}
void
BeaverTriple_clear
(
BeaverTriple
triple
)
{
if
(
!
triple
)
return
;
mp_clear
(
&
triple
-
>
a
)
;
mp_clear
(
&
triple
-
>
b
)
;
mp_clear
(
&
triple
-
>
c
)
;
free
(
triple
)
;
}
SECStatus
BeaverTriple_set_rand
(
const
struct
prio_config
*
cfg
struct
beaver_triple
*
triple_1
struct
beaver_triple
*
triple_2
)
{
SECStatus
rv
=
SECSuccess
;
P_CHECK
(
rand_int
(
&
triple_1
-
>
a
&
cfg
-
>
modulus
)
)
;
P_CHECK
(
rand_int
(
&
triple_1
-
>
b
&
cfg
-
>
modulus
)
)
;
P_CHECK
(
rand_int
(
&
triple_2
-
>
a
&
cfg
-
>
modulus
)
)
;
P_CHECK
(
rand_int
(
&
triple_2
-
>
b
&
cfg
-
>
modulus
)
)
;
MP_CHECK
(
mp_addmod
(
&
triple_1
-
>
a
&
triple_2
-
>
a
&
cfg
-
>
modulus
&
triple_1
-
>
c
)
)
;
MP_CHECK
(
mp_addmod
(
&
triple_1
-
>
b
&
triple_2
-
>
b
&
cfg
-
>
modulus
&
triple_2
-
>
c
)
)
;
MP_CHECK
(
mp_mulmod
(
&
triple_1
-
>
c
&
triple_2
-
>
c
&
cfg
-
>
modulus
&
triple_1
-
>
c
)
)
;
MP_CHECK
(
rand_int
(
&
triple_2
-
>
c
&
cfg
-
>
modulus
)
)
;
MP_CHECK
(
mp_submod
(
&
triple_1
-
>
c
&
triple_2
-
>
c
&
cfg
-
>
modulus
&
triple_1
-
>
c
)
)
;
return
rv
;
}
bool
BeaverTriple_areEqual
(
const_BeaverTriple
t1
const_BeaverTriple
t2
)
{
return
(
mp_cmp
(
&
t1
-
>
a
&
t2
-
>
a
)
=
=
0
&
&
mp_cmp
(
&
t1
-
>
b
&
t2
-
>
b
)
=
=
0
&
&
mp_cmp
(
&
t1
-
>
c
&
t2
-
>
c
)
=
=
0
)
;
}
