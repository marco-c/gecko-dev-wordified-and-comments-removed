#
ifdef
HAVE_CONFIG_H
#
include
"
config
.
h
"
#
endif
#
include
"
generic_code
.
h
"
void
aom_cdf_init_q15_1D
(
uint16_t
*
cdf
int
nsyms
int
cdf_size
)
{
int
i
;
for
(
i
=
0
;
i
<
nsyms
;
i
+
+
)
cdf
[
i
]
=
AOM_ICDF
(
(
i
+
1
)
*
CDF_PROB_TOP
/
nsyms
)
;
cdf
[
cdf_size
-
1
]
=
0
;
}
void
aom_cdf_adapt_q15
(
int
val
uint16_t
*
cdf
int
n
int
*
count
int
rate
)
{
int
i
;
*
count
=
OD_MINI
(
*
count
+
1
1
<
<
rate
)
;
OD_ASSERT
(
AOM_ICDF
(
cdf
[
n
-
1
]
)
=
=
32768
)
;
if
(
*
count
>
=
1
<
<
rate
)
{
for
(
i
=
0
;
i
<
n
;
i
+
+
)
{
int
tmp
;
tmp
=
2
-
(
1
<
<
rate
)
+
i
+
(
32767
+
(
1
<
<
rate
)
-
n
)
*
(
i
>
=
val
)
;
cdf
[
i
]
=
AOM_ICDF
(
AOM_ICDF
(
cdf
[
i
]
)
-
(
(
AOM_ICDF
(
cdf
[
i
]
)
-
tmp
)
>
>
rate
)
)
;
}
}
else
{
int
alpha
;
alpha
=
4
*
32768
/
(
n
+
4
*
*
count
)
;
for
(
i
=
0
;
i
<
n
;
i
+
+
)
{
int
tmp
;
tmp
=
(
32768
-
n
)
*
(
i
>
=
val
)
+
i
+
1
;
cdf
[
i
]
=
AOM_ICDF
(
AOM_ICDF
(
cdf
[
i
]
)
-
(
(
(
AOM_ICDF
(
cdf
[
i
]
)
-
tmp
)
*
alpha
)
>
>
15
)
)
;
}
}
OD_ASSERT
(
AOM_ICDF
(
cdf
[
n
-
1
]
)
=
=
32768
)
;
}
int
log_ex
(
int
ex_q16
)
{
int
lg
;
int
lg_q1
;
int
odd
;
lg
=
OD_ILOG
(
ex_q16
)
;
if
(
lg
<
15
)
{
odd
=
ex_q16
*
ex_q16
>
2
<
<
2
*
lg
;
}
else
{
int
tmp
;
tmp
=
ex_q16
>
>
(
lg
-
8
)
;
odd
=
tmp
*
tmp
>
(
1
<
<
15
)
;
}
lg_q1
=
OD_MAXI
(
0
2
*
lg
-
33
+
odd
)
;
return
lg_q1
;
}
void
generic_model_update
(
int
*
ex_q16
int
x
int
integration
)
{
x
=
OD_MINI
(
x
32767
)
;
OD_IIR_DIADIC
(
*
ex_q16
x
<
<
16
integration
)
;
}
