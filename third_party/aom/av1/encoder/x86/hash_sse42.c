#
include
<
stdint
.
h
>
#
include
<
smmintrin
.
h
>
#
define
ALIGN_SIZE
8
#
define
ALIGN_MASK
(
ALIGN_SIZE
-
1
)
#
define
CALC_CRC
(
op
crc
type
buf
len
)
\
while
(
(
len
)
>
=
sizeof
(
type
)
)
{
\
(
crc
)
=
op
(
(
crc
)
*
(
type
*
)
(
buf
)
)
;
\
(
len
)
-
=
sizeof
(
type
)
;
\
buf
+
=
sizeof
(
type
)
;
\
}
uint32_t
av1_get_crc32c_value_sse4_2
(
void
*
crc_calculator
uint8_t
*
p
size_t
len
)
{
(
void
)
crc_calculator
;
const
uint8_t
*
buf
=
p
;
uint32_t
crc
=
0xFFFFFFFF
;
for
(
;
(
len
>
0
)
&
&
(
(
intptr_t
)
buf
&
ALIGN_MASK
)
;
len
-
-
buf
+
+
)
{
crc
=
_mm_crc32_u8
(
crc
*
buf
)
;
}
#
ifdef
__x86_64__
uint64_t
crc64
=
crc
;
CALC_CRC
(
_mm_crc32_u64
crc64
uint64_t
buf
len
)
;
crc
=
(
uint32_t
)
crc64
;
#
endif
CALC_CRC
(
_mm_crc32_u32
crc
uint32_t
buf
len
)
;
CALC_CRC
(
_mm_crc32_u16
crc
uint16_t
buf
len
)
;
CALC_CRC
(
_mm_crc32_u8
crc
uint8_t
buf
len
)
;
return
(
crc
^
=
0xFFFFFFFF
)
;
}
