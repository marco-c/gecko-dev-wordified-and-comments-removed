#
include
"
.
/
ivfenc
.
h
"
#
include
"
aom
/
aom_encoder
.
h
"
#
include
"
aom_ports
/
mem_ops
.
h
"
void
ivf_write_file_header
(
FILE
*
outfile
const
struct
aom_codec_enc_cfg
*
cfg
unsigned
int
fourcc
int
frame_cnt
)
{
char
header
[
32
]
;
header
[
0
]
=
'
D
'
;
header
[
1
]
=
'
K
'
;
header
[
2
]
=
'
I
'
;
header
[
3
]
=
'
F
'
;
mem_put_le16
(
header
+
4
0
)
;
mem_put_le16
(
header
+
6
32
)
;
mem_put_le32
(
header
+
8
fourcc
)
;
mem_put_le16
(
header
+
12
cfg
-
>
g_w
)
;
mem_put_le16
(
header
+
14
cfg
-
>
g_h
)
;
mem_put_le32
(
header
+
16
cfg
-
>
g_timebase
.
den
)
;
mem_put_le32
(
header
+
20
cfg
-
>
g_timebase
.
num
)
;
mem_put_le32
(
header
+
24
frame_cnt
)
;
mem_put_le32
(
header
+
28
0
)
;
fwrite
(
header
1
32
outfile
)
;
}
void
ivf_write_frame_header
(
FILE
*
outfile
int64_t
pts
size_t
frame_size
)
{
char
header
[
12
]
;
mem_put_le32
(
header
(
int
)
frame_size
)
;
mem_put_le32
(
header
+
4
(
int
)
(
pts
&
0xFFFFFFFF
)
)
;
mem_put_le32
(
header
+
8
(
int
)
(
pts
>
>
32
)
)
;
fwrite
(
header
1
12
outfile
)
;
}
void
ivf_write_frame_size
(
FILE
*
outfile
size_t
frame_size
)
{
char
header
[
4
]
;
mem_put_le32
(
header
(
int
)
frame_size
)
;
fwrite
(
header
1
4
outfile
)
;
}
