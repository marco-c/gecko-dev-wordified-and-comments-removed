#
include
"
arm_cpudetect
.
h
"
#
if
!
CONFIG_RUNTIME_CPU_DETECT
static
int
arm_get_cpu_caps
(
void
)
{
int
flags
=
0
;
#
if
HAVE_NEON
flags
|
=
HAS_NEON
;
#
endif
return
flags
;
}
#
elif
defined
(
_MSC_VER
)
static
int
arm_get_cpu_caps
(
void
)
{
int
flags
=
0
;
#
if
HAVE_NEON
__try
{
__emit
(
0xF2200150
)
;
flags
|
=
HAS_NEON
;
}
__except
(
GetExceptionCode
(
)
=
=
EXCEPTION_ILLEGAL_INSTRUCTION
)
{
}
#
endif
return
flags
;
}
#
elif
defined
(
AOM_USE_ANDROID_CPU_FEATURES
)
static
int
arm_get_cpu_caps
(
void
)
{
int
flags
=
0
;
#
if
HAVE_NEON
uint64_t
features
=
android_getCpuFeatures
(
)
;
if
(
features
&
ANDROID_CPU_ARM_FEATURE_NEON
)
flags
|
=
HAS_NEON
;
#
endif
return
flags
;
}
#
elif
defined
(
__linux__
)
#
include
<
sys
/
auxv
.
h
>
#
define
AOM_AARCH32_HWCAP_NEON
(
1
<
<
12
)
static
int
arm_get_cpu_caps
(
void
)
{
int
flags
=
0
;
unsigned
long
hwcap
=
getauxval
(
AT_HWCAP
)
;
#
if
HAVE_NEON
if
(
hwcap
&
AOM_AARCH32_HWCAP_NEON
)
flags
|
=
HAS_NEON
;
#
endif
return
flags
;
}
#
else
#
error
\
"
Runtime
CPU
detection
selected
but
no
CPU
detection
method
"
\
"
available
for
your
platform
.
Rerun
cmake
with
-
DCONFIG_RUNTIME_CPU_DETECT
=
0
.
"
#
endif
int
aom_arm_cpu_caps
(
void
)
{
int
flags
=
0
;
if
(
arm_cpu_env_flags
(
&
flags
)
)
{
return
flags
;
}
return
arm_get_cpu_caps
(
)
&
arm_cpu_env_mask
(
)
;
}
