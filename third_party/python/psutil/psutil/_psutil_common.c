#
include
<
Python
.
h
>
#
include
<
stdio
.
h
>
int
PSUTIL_DEBUG
=
0
;
int
PSUTIL_TESTING
=
0
;
#
if
PY_MAJOR_VERSION
<
3
PyObject
*
PyUnicode_DecodeFSDefault
(
char
*
s
)
{
return
PyString_FromString
(
s
)
;
}
PyObject
*
PyUnicode_DecodeFSDefaultAndSize
(
char
*
s
Py_ssize_t
size
)
{
return
PyString_FromStringAndSize
(
s
size
)
;
}
#
endif
PyObject
*
NoSuchProcess
(
char
*
msg
)
{
PyObject
*
exc
;
exc
=
PyObject_CallFunction
(
PyExc_OSError
"
(
is
)
"
ESRCH
strlen
(
msg
)
?
msg
:
strerror
(
ESRCH
)
)
;
PyErr_SetObject
(
PyExc_OSError
exc
)
;
Py_XDECREF
(
exc
)
;
return
NULL
;
}
PyObject
*
AccessDenied
(
char
*
msg
)
{
PyObject
*
exc
;
exc
=
PyObject_CallFunction
(
PyExc_OSError
"
(
is
)
"
EACCES
strlen
(
msg
)
?
msg
:
strerror
(
EACCES
)
)
;
PyErr_SetObject
(
PyExc_OSError
exc
)
;
Py_XDECREF
(
exc
)
;
return
NULL
;
}
PyObject
*
psutil_set_testing
(
PyObject
*
self
PyObject
*
args
)
{
PSUTIL_TESTING
=
1
;
Py_INCREF
(
Py_None
)
;
return
Py_None
;
}
void
psutil_debug
(
const
char
*
format
.
.
.
)
{
va_list
argptr
;
va_start
(
argptr
format
)
;
fprintf
(
stderr
"
psutil
-
dubug
>
"
)
;
vfprintf
(
stderr
format
argptr
)
;
fprintf
(
stderr
"
\
n
"
)
;
va_end
(
argptr
)
;
}
void
psutil_setup
(
void
)
{
if
(
getenv
(
"
PSUTIL_DEBUG
"
)
!
=
NULL
)
PSUTIL_DEBUG
=
1
;
if
(
getenv
(
"
PSUTIL_TESTING
"
)
!
=
NULL
)
PSUTIL_TESTING
=
1
;
}
