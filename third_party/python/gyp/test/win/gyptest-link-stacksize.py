"
"
"
Make
sure
StackReserveSize
and
StackCommitSize
settings
are
extracted
properly
.
"
"
"
import
TestGyp
import
sys
if
sys
.
platform
=
=
'
win32
'
:
  
test
=
TestGyp
.
TestGyp
(
formats
=
[
'
msvs
'
'
ninja
'
]
)
  
CHDIR
=
'
linker
-
flags
'
  
test
.
run_gyp
(
'
stacksize
.
gyp
'
chdir
=
CHDIR
)
  
test
.
build
(
'
stacksize
.
gyp
'
test
.
ALL
chdir
=
CHDIR
)
  
def
GetHeaders
(
exe
)
:
    
return
test
.
run_dumpbin
(
'
/
headers
'
test
.
built_file_path
(
exe
chdir
=
CHDIR
)
)
  
default_headers
=
GetHeaders
(
'
test_default
.
exe
'
)
  
if
'
100000
size
of
stack
reserve
'
not
in
default_headers
:
    
test
.
fail_test
(
)
  
if
'
1000
size
of
stack
commit
'
not
in
default_headers
:
    
test
.
fail_test
(
)
  
set_reserved_size_headers
=
GetHeaders
(
'
test_set_reserved_size
.
exe
'
)
  
if
'
200000
size
of
stack
reserve
'
not
in
set_reserved_size_headers
:
    
test
.
fail_test
(
)
  
if
'
1000
size
of
stack
commit
'
not
in
set_reserved_size_headers
:
    
test
.
fail_test
(
)
  
set_commit_size_headers
=
GetHeaders
(
'
test_set_commit_size
.
exe
'
)
  
if
'
100000
size
of
stack
reserve
'
not
in
set_commit_size_headers
:
    
test
.
fail_test
(
)
  
if
'
1000
size
of
stack
commit
'
not
in
set_commit_size_headers
:
    
test
.
fail_test
(
)
  
set_both_headers
=
GetHeaders
(
'
test_set_both
.
exe
'
)
  
if
'
200000
size
of
stack
reserve
'
not
in
set_both_headers
:
    
test
.
fail_test
(
)
  
if
'
2000
size
of
stack
commit
'
not
in
set_both_headers
:
    
test
.
fail_test
(
)
  
test
.
pass_test
(
)
