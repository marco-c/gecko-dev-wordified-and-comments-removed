"
"
"
Make
sure
LTCG
is
working
properly
.
"
"
"
import
TestGyp
import
sys
if
sys
.
platform
=
=
'
win32
'
:
  
test
=
TestGyp
.
TestGyp
(
formats
=
[
'
msvs
'
'
ninja
'
]
)
  
CHDIR
=
'
linker
-
flags
'
  
test
.
run_gyp
(
'
ltcg
.
gyp
'
chdir
=
CHDIR
)
  
INLINE_MARKER
=
'
=
=
=
=
inlined
=
=
=
=
'
  
LTCG_LINKER_MESSAGES
=
[
'
Generating
code
'
'
Finished
generating
code
'
]
  
test
.
build
(
'
ltcg
.
gyp
'
'
test_ltcg_off
'
chdir
=
CHDIR
)
  
test
.
run_built_executable
(
'
test_ltcg_off
'
chdir
=
CHDIR
)
  
test
.
must_not_contain_any_line
(
test
.
stdout
(
)
[
INLINE_MARKER
]
)
  
test
.
build
(
'
ltcg
.
gyp
'
'
test_ltcg_on
'
chdir
=
CHDIR
)
  
if
test
.
format
=
=
'
ninja
'
:
    
test
.
must_not_contain_any_line
(
test
.
stdout
(
)
LTCG_LINKER_MESSAGES
)
  
elif
test
.
format
=
=
'
msvs
'
:
    
test
.
must_contain_any_line
(
test
.
stdout
(
)
LTCG_LINKER_MESSAGES
)
  
test
.
run_built_executable
(
'
test_ltcg_on
'
chdir
=
CHDIR
)
  
test
.
must_contain_any_line
(
test
.
stdout
(
)
[
INLINE_MARKER
]
)
  
test
.
pass_test
(
)
