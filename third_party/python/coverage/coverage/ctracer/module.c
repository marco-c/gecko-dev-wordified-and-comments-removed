#
include
"
util
.
h
"
#
include
"
tracer
.
h
"
#
include
"
filedisp
.
h
"
#
define
MODULE_DOC
PyDoc_STR
(
"
Fast
coverage
tracer
.
"
)
#
if
PY_MAJOR_VERSION
>
=
3
static
PyModuleDef
moduledef
=
{
PyModuleDef_HEAD_INIT
"
coverage
.
tracer
"
MODULE_DOC
-
1
NULL
NULL
NULL
NULL
NULL
}
;
PyObject
*
PyInit_tracer
(
void
)
{
PyObject
*
mod
=
PyModule_Create
(
&
moduledef
)
;
if
(
mod
=
=
NULL
)
{
return
NULL
;
}
if
(
CTracer_intern_strings
(
)
<
0
)
{
return
NULL
;
}
CTracerType
.
tp_new
=
PyType_GenericNew
;
if
(
PyType_Ready
(
&
CTracerType
)
<
0
)
{
Py_DECREF
(
mod
)
;
return
NULL
;
}
Py_INCREF
(
&
CTracerType
)
;
if
(
PyModule_AddObject
(
mod
"
CTracer
"
(
PyObject
*
)
&
CTracerType
)
<
0
)
{
Py_DECREF
(
mod
)
;
Py_DECREF
(
&
CTracerType
)
;
return
NULL
;
}
CFileDispositionType
.
tp_new
=
PyType_GenericNew
;
if
(
PyType_Ready
(
&
CFileDispositionType
)
<
0
)
{
Py_DECREF
(
mod
)
;
Py_DECREF
(
&
CTracerType
)
;
return
NULL
;
}
Py_INCREF
(
&
CFileDispositionType
)
;
if
(
PyModule_AddObject
(
mod
"
CFileDisposition
"
(
PyObject
*
)
&
CFileDispositionType
)
<
0
)
{
Py_DECREF
(
mod
)
;
Py_DECREF
(
&
CTracerType
)
;
Py_DECREF
(
&
CFileDispositionType
)
;
return
NULL
;
}
return
mod
;
}
#
else
void
inittracer
(
void
)
{
PyObject
*
mod
;
mod
=
Py_InitModule3
(
"
coverage
.
tracer
"
NULL
MODULE_DOC
)
;
if
(
mod
=
=
NULL
)
{
return
;
}
if
(
CTracer_intern_strings
(
)
<
0
)
{
return
;
}
CTracerType
.
tp_new
=
PyType_GenericNew
;
if
(
PyType_Ready
(
&
CTracerType
)
<
0
)
{
return
;
}
Py_INCREF
(
&
CTracerType
)
;
PyModule_AddObject
(
mod
"
CTracer
"
(
PyObject
*
)
&
CTracerType
)
;
CFileDispositionType
.
tp_new
=
PyType_GenericNew
;
if
(
PyType_Ready
(
&
CFileDispositionType
)
<
0
)
{
return
;
}
Py_INCREF
(
&
CFileDispositionType
)
;
PyModule_AddObject
(
mod
"
CFileDisposition
"
(
PyObject
*
)
&
CFileDispositionType
)
;
}
#
endif
