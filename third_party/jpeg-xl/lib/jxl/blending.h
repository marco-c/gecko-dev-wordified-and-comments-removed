#
ifndef
LIB_JXL_BLENDING_H_
#
define
LIB_JXL_BLENDING_H_
#
include
"
lib
/
jxl
/
dec_cache
.
h
"
#
include
"
lib
/
jxl
/
image_bundle
.
h
"
namespace
jxl
{
class
ImageBlender
{
public
:
class
RectBlender
{
public
:
Status
DoBlending
(
size_t
y
)
const
;
bool
done
(
)
const
{
return
done_
;
}
private
:
friend
class
ImageBlender
;
explicit
RectBlender
(
bool
done
)
:
done_
(
done
)
{
}
bool
done_
;
Rect
current_overlap_
;
Rect
current_cropbox_
;
ImageBundle
foreground_
;
BlendingInfo
info_
;
ImageBundle
*
dest_
;
const
std
:
:
vector
<
BlendingInfo
>
*
ec_info_
;
size_t
first_alpha_
;
}
;
Status
PrepareBlending
(
PassesDecoderState
*
dec_state
ImageBundle
*
foreground
ImageBundle
*
output
)
;
RectBlender
PrepareRect
(
const
Rect
&
rect
const
ImageBundle
&
foreground
)
const
;
bool
done
(
)
const
{
return
done_
;
}
private
:
BlendingInfo
info_
;
ImageBundle
*
dest_
;
Rect
cropbox_
;
Rect
overlap_
;
bool
done_
=
false
;
const
std
:
:
vector
<
BlendingInfo
>
*
ec_info_
;
size_t
first_alpha_
;
FrameOrigin
o_
{
}
;
}
;
}
#
endif
