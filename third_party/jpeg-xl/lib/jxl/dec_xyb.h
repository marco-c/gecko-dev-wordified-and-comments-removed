#
ifndef
LIB_JXL_DEC_XYB_H_
#
define
LIB_JXL_DEC_XYB_H_
#
include
<
jxl
/
cms_interface
.
h
>
#
include
<
cstddef
>
#
include
<
cstdint
>
#
include
"
lib
/
jxl
/
base
/
compiler_specific
.
h
"
#
include
"
lib
/
jxl
/
base
/
data_parallel
.
h
"
#
include
"
lib
/
jxl
/
base
/
matrix_ops
.
h
"
#
include
"
lib
/
jxl
/
base
/
rect
.
h
"
#
include
"
lib
/
jxl
/
base
/
status
.
h
"
#
include
"
lib
/
jxl
/
color_encoding_internal
.
h
"
#
include
"
lib
/
jxl
/
image
.
h
"
#
include
"
lib
/
jxl
/
image_metadata
.
h
"
namespace
jxl
{
struct
OpsinParams
{
float
inverse_opsin_matrix
[
9
*
4
]
;
float
opsin_biases
[
4
]
;
float
opsin_biases_cbrt
[
4
]
;
float
quant_biases
[
4
]
;
void
Init
(
float
intensity_target
)
;
}
;
struct
OutputEncodingInfo
{
ColorEncoding
orig_color_encoding
;
float
orig_intensity_target
;
Matrix3x3
orig_inverse_matrix
;
bool
default_transform
;
bool
xyb_encoded
;
ColorEncoding
color_encoding
;
ColorEncoding
linear_color_encoding
;
bool
color_encoding_is_original
;
OpsinParams
opsin_params
;
bool
all_default_opsin
;
float
inverse_gamma
;
Vector3
luminances
;
float
desired_intensity_target
;
bool
cms_set
=
false
;
JxlCmsInterface
color_management_system
;
Status
SetFromMetadata
(
const
CodecMetadata
&
metadata
)
;
Status
MaybeSetColorEncoding
(
const
ColorEncoding
&
c_desired
)
;
private
:
Status
SetColorEncoding
(
const
ColorEncoding
&
c_desired
)
;
}
;
Status
OpsinToLinearInplace
(
Image3F
*
JXL_RESTRICT
inout
ThreadPool
*
pool
const
OpsinParams
&
opsin_params
)
;
Status
OpsinToLinear
(
const
Image3F
&
opsin
const
Rect
&
rect
ThreadPool
*
pool
Image3F
*
JXL_RESTRICT
linear
const
OpsinParams
&
opsin_params
)
;
void
YcbcrToRgb
(
const
Image3F
&
ycbcr
Image3F
*
rgb
const
Rect
&
rect
)
;
bool
HasFastXYBTosRGB8
(
)
;
Status
FastXYBTosRGB8
(
const
float
*
input
[
4
]
uint8_t
*
output
bool
is_rgba
size_t
xsize
)
;
}
#
endif
