#
include
"
config
.
h
"
#
include
"
src
/
mc
.
h
"
#
include
"
src
/
cpu
.
h
"
#
define
decl_8tap_gen
(
decl_name
fn_name
opt
)
\
decl_
#
#
decl_name
#
#
_fn
(
BF
(
dav1d_
#
#
fn_name
#
#
_8tap_regular
opt
)
)
;
\
decl_
#
#
decl_name
#
#
_fn
(
BF
(
dav1d_
#
#
fn_name
#
#
_8tap_regular_smooth
opt
)
)
;
\
decl_
#
#
decl_name
#
#
_fn
(
BF
(
dav1d_
#
#
fn_name
#
#
_8tap_regular_sharp
opt
)
)
;
\
decl_
#
#
decl_name
#
#
_fn
(
BF
(
dav1d_
#
#
fn_name
#
#
_8tap_smooth_regular
opt
)
)
;
\
decl_
#
#
decl_name
#
#
_fn
(
BF
(
dav1d_
#
#
fn_name
#
#
_8tap_smooth
opt
)
)
;
\
decl_
#
#
decl_name
#
#
_fn
(
BF
(
dav1d_
#
#
fn_name
#
#
_8tap_smooth_sharp
opt
)
)
;
\
decl_
#
#
decl_name
#
#
_fn
(
BF
(
dav1d_
#
#
fn_name
#
#
_8tap_sharp_regular
opt
)
)
;
\
decl_
#
#
decl_name
#
#
_fn
(
BF
(
dav1d_
#
#
fn_name
#
#
_8tap_sharp_smooth
opt
)
)
;
\
decl_
#
#
decl_name
#
#
_fn
(
BF
(
dav1d_
#
#
fn_name
#
#
_8tap_sharp
opt
)
)
#
define
decl_8tap_fns
(
opt
)
\
decl_8tap_gen
(
mc
put
opt
)
;
\
decl_8tap_gen
(
mct
prep
opt
)
#
define
init_8tap_gen
(
name
opt
)
\
init_
#
#
name
#
#
_fn
(
FILTER_2D_8TAP_REGULAR
8tap_regular
opt
)
;
\
init_
#
#
name
#
#
_fn
(
FILTER_2D_8TAP_REGULAR_SMOOTH
8tap_regular_smooth
opt
)
;
\
init_
#
#
name
#
#
_fn
(
FILTER_2D_8TAP_REGULAR_SHARP
8tap_regular_sharp
opt
)
;
\
init_
#
#
name
#
#
_fn
(
FILTER_2D_8TAP_SMOOTH_REGULAR
8tap_smooth_regular
opt
)
;
\
init_
#
#
name
#
#
_fn
(
FILTER_2D_8TAP_SMOOTH
8tap_smooth
opt
)
;
\
init_
#
#
name
#
#
_fn
(
FILTER_2D_8TAP_SMOOTH_SHARP
8tap_smooth_sharp
opt
)
;
\
init_
#
#
name
#
#
_fn
(
FILTER_2D_8TAP_SHARP_REGULAR
8tap_sharp_regular
opt
)
;
\
init_
#
#
name
#
#
_fn
(
FILTER_2D_8TAP_SHARP_SMOOTH
8tap_sharp_smooth
opt
)
;
\
init_
#
#
name
#
#
_fn
(
FILTER_2D_8TAP_SHARP
8tap_sharp
opt
)
#
define
init_8tap_fns
(
opt
)
\
init_8tap_gen
(
mc
opt
)
;
\
init_8tap_gen
(
mct
opt
)
decl_8tap_fns
(
neon
)
;
decl_8tap_fns
(
neon_dotprod
)
;
decl_8tap_fns
(
neon_i8mm
)
;
decl_8tap_fns
(
sve2
)
;
decl_mc_fn
(
BF
(
dav1d_put_bilin
neon
)
)
;
decl_mct_fn
(
BF
(
dav1d_prep_bilin
neon
)
)
;
decl_avg_fn
(
BF
(
dav1d_avg
neon
)
)
;
decl_w_avg_fn
(
BF
(
dav1d_w_avg
neon
)
)
;
decl_mask_fn
(
BF
(
dav1d_mask
neon
)
)
;
decl_blend_fn
(
BF
(
dav1d_blend
neon
)
)
;
decl_blend_dir_fn
(
BF
(
dav1d_blend_h
neon
)
)
;
decl_blend_dir_fn
(
BF
(
dav1d_blend_v
neon
)
)
;
decl_w_mask_fn
(
BF
(
dav1d_w_mask_444
neon
)
)
;
decl_w_mask_fn
(
BF
(
dav1d_w_mask_422
neon
)
)
;
decl_w_mask_fn
(
BF
(
dav1d_w_mask_420
neon
)
)
;
decl_warp8x8_fn
(
BF
(
dav1d_warp_affine_8x8
neon
)
)
;
decl_warp8x8t_fn
(
BF
(
dav1d_warp_affine_8x8t
neon
)
)
;
decl_emu_edge_fn
(
BF
(
dav1d_emu_edge
neon
)
)
;
static
ALWAYS_INLINE
void
mc_dsp_init_arm
(
Dav1dMCDSPContext
*
const
c
)
{
#
define
init_mc_fn
(
type
name
suffix
)
\
c
-
>
mc
[
type
]
=
BF
(
dav1d_put_
#
#
name
suffix
)
#
define
init_mct_fn
(
type
name
suffix
)
\
c
-
>
mct
[
type
]
=
BF
(
dav1d_prep_
#
#
name
suffix
)
const
unsigned
flags
=
dav1d_get_cpu_flags
(
)
;
if
(
!
(
flags
&
DAV1D_ARM_CPU_FLAG_NEON
)
)
return
;
init_8tap_fns
(
neon
)
;
init_mc_fn
(
FILTER_2D_BILINEAR
bilin
neon
)
;
init_mct_fn
(
FILTER_2D_BILINEAR
bilin
neon
)
;
c
-
>
avg
=
BF
(
dav1d_avg
neon
)
;
c
-
>
w_avg
=
BF
(
dav1d_w_avg
neon
)
;
c
-
>
mask
=
BF
(
dav1d_mask
neon
)
;
c
-
>
blend
=
BF
(
dav1d_blend
neon
)
;
c
-
>
blend_h
=
BF
(
dav1d_blend_h
neon
)
;
c
-
>
blend_v
=
BF
(
dav1d_blend_v
neon
)
;
c
-
>
w_mask
[
0
]
=
BF
(
dav1d_w_mask_444
neon
)
;
c
-
>
w_mask
[
1
]
=
BF
(
dav1d_w_mask_422
neon
)
;
c
-
>
w_mask
[
2
]
=
BF
(
dav1d_w_mask_420
neon
)
;
c
-
>
warp8x8
=
BF
(
dav1d_warp_affine_8x8
neon
)
;
c
-
>
warp8x8t
=
BF
(
dav1d_warp_affine_8x8t
neon
)
;
c
-
>
emu_edge
=
BF
(
dav1d_emu_edge
neon
)
;
#
if
ARCH_AARCH64
#
if
BITDEPTH
=
=
8
#
if
HAVE_DOTPROD
if
(
flags
&
DAV1D_ARM_CPU_FLAG_DOTPROD
)
{
init_8tap_fns
(
neon_dotprod
)
;
}
#
endif
#
if
HAVE_I8MM
if
(
flags
&
DAV1D_ARM_CPU_FLAG_I8MM
)
{
init_8tap_fns
(
neon_i8mm
)
;
}
#
endif
#
endif
#
if
BITDEPTH
=
=
16
#
if
HAVE_SVE2
if
(
flags
&
DAV1D_ARM_CPU_FLAG_SVE2
)
{
init_8tap_fns
(
sve2
)
;
}
#
endif
#
endif
#
endif
}
