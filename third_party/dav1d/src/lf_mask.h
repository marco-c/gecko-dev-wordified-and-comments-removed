#
ifndef
DAV1D_SRC_LF_MASK_H
#
define
DAV1D_SRC_LF_MASK_H
#
include
<
stddef
.
h
>
#
include
<
stdint
.
h
>
#
include
"
src
/
levels
.
h
"
typedef
struct
Av1FilterLUT
{
uint8_t
e
[
64
]
;
uint8_t
i
[
64
]
;
uint64_t
sharp
[
2
]
;
}
Av1FilterLUT
;
typedef
struct
Av1RestorationUnit
{
enum
Dav1dRestorationType
type
;
int16_t
filter_h
[
3
]
;
int16_t
filter_v
[
3
]
;
uint8_t
sgr_idx
;
int16_t
sgr_weights
[
2
]
;
}
Av1RestorationUnit
;
typedef
struct
Av1Filter
{
uint16_t
filter_y
[
2
]
[
32
]
[
3
]
[
2
]
;
uint16_t
filter_uv
[
2
]
[
32
]
[
2
]
[
2
]
;
int8_t
cdef_idx
[
4
]
;
uint16_t
noskip_mask
[
32
]
[
2
]
;
}
Av1Filter
;
typedef
struct
Av1Restoration
{
Av1RestorationUnit
lr
[
3
]
[
4
]
;
}
Av1Restoration
;
void
dav1d_create_lf_mask_intra
(
Av1Filter
*
lflvl
uint8_t
(
*
level_cache
)
[
4
]
const
ptrdiff_t
b4_stride
const
uint8_t
(
*
level
)
[
8
]
[
2
]
int
bx
int
by
int
iw
int
ih
enum
BlockSize
bs
enum
RectTxfmSize
ytx
enum
RectTxfmSize
uvtx
enum
Dav1dPixelLayout
layout
uint8_t
*
ay
uint8_t
*
ly
uint8_t
*
auv
uint8_t
*
luv
)
;
void
dav1d_create_lf_mask_inter
(
Av1Filter
*
lflvl
uint8_t
(
*
level_cache
)
[
4
]
const
ptrdiff_t
b4_stride
const
uint8_t
(
*
level
)
[
8
]
[
2
]
int
bx
int
by
int
iw
int
ih
int
skip_inter
enum
BlockSize
bs
enum
RectTxfmSize
max_ytx
const
uint16_t
*
tx_mask
enum
RectTxfmSize
uvtx
enum
Dav1dPixelLayout
layout
uint8_t
*
ay
uint8_t
*
ly
uint8_t
*
auv
uint8_t
*
luv
)
;
void
dav1d_calc_eih
(
Av1FilterLUT
*
lim_lut
int
filter_sharpness
)
;
void
dav1d_calc_lf_values
(
uint8_t
(
*
values
)
[
4
]
[
8
]
[
2
]
const
Dav1dFrameHeader
*
hdr
const
int8_t
lf_delta
[
4
]
)
;
#
endif
