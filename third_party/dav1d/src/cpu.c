#
include
"
config
.
h
"
#
include
<
stdint
.
h
>
#
include
"
src
/
cpu
.
h
"
static
unsigned
flags
=
0
;
#
if
__has_feature
(
memory_sanitizer
)
static
unsigned
flags_mask
=
0
;
#
elif
ARCH_X86
static
unsigned
flags_mask
=
~
DAV1D_X86_CPU_FLAG_AVX512ICL
;
#
else
static
unsigned
flags_mask
=
-
1
;
#
endif
COLD
void
dav1d_init_cpu
(
void
)
{
#
if
HAVE_ASM
#
if
ARCH_AARCH64
|
|
ARCH_ARM
flags
=
dav1d_get_cpu_flags_arm
(
)
;
#
elif
ARCH_PPC64LE
flags
=
dav1d_get_cpu_flags_ppc
(
)
;
#
elif
ARCH_X86
flags
=
dav1d_get_cpu_flags_x86
(
)
;
#
endif
#
endif
}
COLD
unsigned
dav1d_get_cpu_flags
(
void
)
{
return
flags
&
flags_mask
;
}
COLD
void
dav1d_set_cpu_flags_mask
(
const
unsigned
mask
)
{
flags_mask
=
mask
;
}
