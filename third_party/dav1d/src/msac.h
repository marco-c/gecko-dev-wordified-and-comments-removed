#
ifndef
DAV1D_SRC_MSAC_H
#
define
DAV1D_SRC_MSAC_H
#
include
<
stdint
.
h
>
#
include
<
stdlib
.
h
>
typedef
uint64_t
ec_win
;
typedef
struct
MsacContext
{
const
uint8_t
*
buf_pos
;
const
uint8_t
*
buf_end
;
ec_win
dif
;
unsigned
rng
;
int
cnt
;
int
allow_update_cdf
;
}
MsacContext
;
void
dav1d_msac_init
(
MsacContext
*
s
const
uint8_t
*
data
size_t
sz
int
disable_cdf_update_flag
)
;
unsigned
dav1d_msac_decode_symbol_adapt_c
(
MsacContext
*
s
uint16_t
*
cdf
size_t
n_symbols
)
;
unsigned
dav1d_msac_decode_bool_equi
(
MsacContext
*
s
)
;
unsigned
dav1d_msac_decode_bool
(
MsacContext
*
s
unsigned
f
)
;
unsigned
dav1d_msac_decode_bool_adapt
(
MsacContext
*
s
uint16_t
*
cdf
)
;
unsigned
dav1d_msac_decode_bools
(
MsacContext
*
s
unsigned
n
)
;
int
dav1d_msac_decode_subexp
(
MsacContext
*
s
int
ref
int
n
unsigned
k
)
;
int
dav1d_msac_decode_uniform
(
MsacContext
*
s
unsigned
n
)
;
#
if
ARCH_AARCH64
&
&
HAVE_ASM
unsigned
dav1d_msac_decode_symbol_adapt4_neon
(
MsacContext
*
s
uint16_t
*
cdf
size_t
n_symbols
)
;
unsigned
dav1d_msac_decode_symbol_adapt8_neon
(
MsacContext
*
s
uint16_t
*
cdf
size_t
n_symbols
)
;
unsigned
dav1d_msac_decode_symbol_adapt16_neon
(
MsacContext
*
s
uint16_t
*
cdf
size_t
n_symbols
)
;
#
define
dav1d_msac_decode_symbol_adapt4
dav1d_msac_decode_symbol_adapt4_neon
#
define
dav1d_msac_decode_symbol_adapt8
dav1d_msac_decode_symbol_adapt8_neon
#
define
dav1d_msac_decode_symbol_adapt16
dav1d_msac_decode_symbol_adapt16_neon
#
elif
ARCH_X86_64
&
&
HAVE_ASM
unsigned
dav1d_msac_decode_symbol_adapt4_sse2
(
MsacContext
*
s
uint16_t
*
cdf
size_t
n_symbols
)
;
unsigned
dav1d_msac_decode_symbol_adapt8_sse2
(
MsacContext
*
s
uint16_t
*
cdf
size_t
n_symbols
)
;
unsigned
dav1d_msac_decode_symbol_adapt16_sse2
(
MsacContext
*
s
uint16_t
*
cdf
size_t
n_symbols
)
;
#
define
dav1d_msac_decode_symbol_adapt4
dav1d_msac_decode_symbol_adapt4_sse2
#
define
dav1d_msac_decode_symbol_adapt8
dav1d_msac_decode_symbol_adapt8_sse2
#
define
dav1d_msac_decode_symbol_adapt16
dav1d_msac_decode_symbol_adapt16_sse2
#
else
#
define
dav1d_msac_decode_symbol_adapt4
dav1d_msac_decode_symbol_adapt_c
#
define
dav1d_msac_decode_symbol_adapt8
dav1d_msac_decode_symbol_adapt_c
#
define
dav1d_msac_decode_symbol_adapt16
dav1d_msac_decode_symbol_adapt_c
#
endif
#
endif
