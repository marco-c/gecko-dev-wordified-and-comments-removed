#
include
"
src
/
cpu
.
h
"
#
include
"
src
/
looprestoration
.
h
"
#
include
"
common
/
intops
.
h
"
#
define
decl_wiener_filter_fns
(
ext
)
\
decl_lr_filter_fn
(
BF
(
dav1d_wiener_filter7
ext
)
)
;
\
decl_lr_filter_fn
(
BF
(
dav1d_wiener_filter5
ext
)
)
#
define
decl_sgr_filter_fns
(
ext
)
\
decl_lr_filter_fn
(
BF
(
dav1d_sgr_filter_5x5
ext
)
)
;
\
decl_lr_filter_fn
(
BF
(
dav1d_sgr_filter_3x3
ext
)
)
;
\
decl_lr_filter_fn
(
BF
(
dav1d_sgr_filter_mix
ext
)
)
decl_wiener_filter_fns
(
sse2
)
;
decl_wiener_filter_fns
(
ssse3
)
;
decl_wiener_filter_fns
(
avx2
)
;
decl_wiener_filter_fns
(
avx512icl
)
;
decl_sgr_filter_fns
(
ssse3
)
;
decl_sgr_filter_fns
(
avx2
)
;
decl_sgr_filter_fns
(
avx512icl
)
;
static
ALWAYS_INLINE
void
loop_restoration_dsp_init_x86
(
Dav1dLoopRestorationDSPContext
*
const
c
const
int
bpc
)
{
const
unsigned
flags
=
dav1d_get_cpu_flags
(
)
;
if
(
!
(
flags
&
DAV1D_X86_CPU_FLAG_SSE2
)
)
return
;
#
if
BITDEPTH
=
=
8
c
-
>
wiener
[
0
]
=
BF
(
dav1d_wiener_filter7
sse2
)
;
c
-
>
wiener
[
1
]
=
BF
(
dav1d_wiener_filter5
sse2
)
;
#
endif
if
(
!
(
flags
&
DAV1D_X86_CPU_FLAG_SSSE3
)
)
return
;
c
-
>
wiener
[
0
]
=
BF
(
dav1d_wiener_filter7
ssse3
)
;
c
-
>
wiener
[
1
]
=
BF
(
dav1d_wiener_filter5
ssse3
)
;
if
(
BITDEPTH
=
=
8
|
|
bpc
=
=
10
)
{
c
-
>
sgr
[
0
]
=
BF
(
dav1d_sgr_filter_5x5
ssse3
)
;
c
-
>
sgr
[
1
]
=
BF
(
dav1d_sgr_filter_3x3
ssse3
)
;
c
-
>
sgr
[
2
]
=
BF
(
dav1d_sgr_filter_mix
ssse3
)
;
}
#
if
ARCH_X86_64
if
(
!
(
flags
&
DAV1D_X86_CPU_FLAG_AVX2
)
)
return
;
c
-
>
wiener
[
0
]
=
BF
(
dav1d_wiener_filter7
avx2
)
;
c
-
>
wiener
[
1
]
=
BF
(
dav1d_wiener_filter5
avx2
)
;
if
(
BITDEPTH
=
=
8
|
|
bpc
=
=
10
)
{
c
-
>
sgr
[
0
]
=
BF
(
dav1d_sgr_filter_5x5
avx2
)
;
c
-
>
sgr
[
1
]
=
BF
(
dav1d_sgr_filter_3x3
avx2
)
;
c
-
>
sgr
[
2
]
=
BF
(
dav1d_sgr_filter_mix
avx2
)
;
}
if
(
!
(
flags
&
DAV1D_X86_CPU_FLAG_AVX512ICL
)
)
return
;
c
-
>
wiener
[
0
]
=
BF
(
dav1d_wiener_filter7
avx512icl
)
;
#
if
BITDEPTH
=
=
8
c
-
>
wiener
[
1
]
=
c
-
>
wiener
[
0
]
;
#
else
c
-
>
wiener
[
1
]
=
BF
(
dav1d_wiener_filter5
avx512icl
)
;
#
endif
if
(
BITDEPTH
=
=
8
|
|
bpc
=
=
10
)
{
c
-
>
sgr
[
0
]
=
BF
(
dav1d_sgr_filter_5x5
avx512icl
)
;
c
-
>
sgr
[
1
]
=
BF
(
dav1d_sgr_filter_3x3
avx512icl
)
;
c
-
>
sgr
[
2
]
=
BF
(
dav1d_sgr_filter_mix
avx512icl
)
;
}
#
endif
}
