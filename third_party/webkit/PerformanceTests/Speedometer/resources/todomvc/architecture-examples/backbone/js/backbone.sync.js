Backbone
.
sync
=
function
(
method
model
options
)
{
var
cache
=
{
}
;
var
size
=
0
;
return
function
(
method
model
options
)
{
var
deferred
=
.
Deferred
(
)
;
if
(
method
=
=
=
"
create
"
)
{
model
.
id
=
size
;
cache
[
model
.
id
]
=
model
;
size
+
=
1
;
if
(
options
.
success
)
{
options
.
success
(
model
model
.
toJSON
(
)
options
)
;
}
deferred
.
resolve
(
model
)
;
}
else
if
(
method
=
=
=
"
update
"
)
{
if
(
cache
[
model
.
id
]
)
{
cache
[
model
.
id
]
=
model
;
if
(
options
.
success
)
{
options
.
success
(
model
model
.
toJSON
(
)
options
)
;
}
deferred
.
resolve
(
model
)
;
}
else
{
if
(
options
.
error
)
{
options
.
error
(
model
"
Model
not
found
"
)
;
}
deferred
.
reject
(
model
)
;
}
}
else
if
(
method
=
=
=
"
read
"
)
{
if
(
cache
[
model
.
id
]
)
{
if
(
options
.
success
)
{
options
.
success
(
model
cache
[
model
.
id
]
.
toJSON
(
)
options
)
;
}
deferred
.
resolve
(
model
)
;
}
else
{
if
(
options
.
error
)
{
options
.
error
(
model
"
Model
not
found
"
)
;
}
deferred
.
reject
(
model
)
;
}
}
else
if
(
method
=
=
=
"
delete
"
)
{
if
(
cache
[
model
.
id
]
)
{
delete
cache
[
model
.
id
]
;
if
(
options
.
success
)
{
options
.
success
(
model
{
}
options
)
;
}
deferred
.
resolve
(
model
)
;
}
else
{
if
(
options
.
error
)
{
options
.
error
(
model
"
Model
not
found
"
)
;
}
deferred
.
reject
(
model
)
;
}
}
return
deferred
.
promise
(
)
;
}
}
(
)
;
