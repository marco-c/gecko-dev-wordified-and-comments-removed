#
include
<
prinrval
.
h
>
#
include
<
thread
>
#
include
<
mutex
>
#
include
"
FuzzingTraits
.
h
"
namespace
mozilla
{
namespace
fuzzing
{
unsigned
int
FuzzingTraits
:
:
Random
(
unsigned
int
aMax
)
{
MOZ_ASSERT
(
aMax
>
0
"
aMax
needs
to
be
bigger
than
0
"
)
;
std
:
:
uniform_int_distribution
<
unsigned
int
>
d
(
0
aMax
)
;
return
d
(
Rng
(
)
)
;
}
bool
FuzzingTraits
:
:
Sometimes
(
unsigned
int
aProbability
)
{
return
FuzzingTraits
:
:
Random
(
aProbability
)
=
=
0
;
}
size_t
FuzzingTraits
:
:
Frequency
(
const
size_t
aSize
const
uint64_t
aFactor
)
{
return
RandomIntegerRange
<
size_t
>
(
0
ceil
(
float
(
aSize
)
/
aFactor
)
)
+
1
;
}
std
:
:
mt19937_64
&
FuzzingTraits
:
:
Rng
(
)
{
static
std
:
:
mt19937_64
rng
;
static
std
:
:
once_flag
flag
;
std
:
:
call_once
(
flag
[
&
]
{
rng
.
seed
(
PR_IntervalNow
(
)
)
;
}
)
;
return
rng
;
}
}
}
