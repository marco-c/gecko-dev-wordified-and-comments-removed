#
ifndef
LLVM_FUZZER_MERGE_H
#
define
LLVM_FUZZER_MERGE_H
#
include
"
FuzzerDefs
.
h
"
#
include
"
FuzzerIO
.
h
"
#
include
<
istream
>
#
include
<
ostream
>
#
include
<
set
>
#
include
<
vector
>
namespace
fuzzer
{
struct
MergeFileInfo
{
std
:
:
string
Name
;
size_t
Size
=
0
;
std
:
:
vector
<
uint32_t
>
Features
Cov
;
}
;
struct
Merger
{
std
:
:
vector
<
MergeFileInfo
>
Files
;
size_t
NumFilesInFirstCorpus
=
0
;
size_t
FirstNotProcessedFile
=
0
;
std
:
:
string
LastFailure
;
bool
Parse
(
std
:
:
istream
&
IS
bool
ParseCoverage
)
;
bool
Parse
(
const
std
:
:
string
&
Str
bool
ParseCoverage
)
;
void
ParseOrExit
(
std
:
:
istream
&
IS
bool
ParseCoverage
)
;
size_t
Merge
(
const
std
:
:
set
<
uint32_t
>
&
InitialFeatures
std
:
:
set
<
uint32_t
>
*
NewFeatures
const
std
:
:
set
<
uint32_t
>
&
InitialCov
std
:
:
set
<
uint32_t
>
*
NewCov
std
:
:
vector
<
std
:
:
string
>
*
NewFiles
)
;
size_t
SetCoverMerge
(
const
std
:
:
set
<
uint32_t
>
&
InitialFeatures
std
:
:
set
<
uint32_t
>
*
NewFeatures
const
std
:
:
set
<
uint32_t
>
&
InitialCov
std
:
:
set
<
uint32_t
>
*
NewCov
std
:
:
vector
<
std
:
:
string
>
*
NewFiles
)
;
size_t
ApproximateMemoryConsumption
(
)
const
;
std
:
:
set
<
uint32_t
>
AllFeatures
(
)
const
;
}
;
void
CrashResistantMerge
(
const
std
:
:
vector
<
std
:
:
string
>
&
Args
const
std
:
:
vector
<
SizedFile
>
&
OldCorpus
const
std
:
:
vector
<
SizedFile
>
&
NewCorpus
std
:
:
vector
<
std
:
:
string
>
*
NewFiles
const
std
:
:
set
<
uint32_t
>
&
InitialFeatures
std
:
:
set
<
uint32_t
>
*
NewFeatures
const
std
:
:
set
<
uint32_t
>
&
InitialCov
std
:
:
set
<
uint32_t
>
*
NewCov
const
std
:
:
string
&
CFPath
bool
Verbose
bool
IsSetCoverMerge
)
;
}
#
endif
