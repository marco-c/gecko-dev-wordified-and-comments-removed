#
include
"
LibFuzzerRegistry
.
h
"
extern
"
C
"
{
void
MOZ_EXPORT
XRE_LibFuzzerGetFuncs
(
const
char
*
moduleName
LibFuzzerInitFunc
*
initFunc
LibFuzzerTestingFunc
*
testingFunc
)
{
std
:
:
string
moduleNameStr
(
moduleName
)
;
mozilla
:
:
LibFuzzerFunctions
funcs
=
mozilla
:
:
LibFuzzerRegistry
:
:
getInstance
(
)
.
getModuleFunctions
(
moduleNameStr
)
;
*
initFunc
=
funcs
.
first
;
*
testingFunc
=
funcs
.
second
;
}
}
namespace
mozilla
{
LibFuzzerRegistry
&
LibFuzzerRegistry
:
:
getInstance
(
)
{
static
LibFuzzerRegistry
instance
;
return
instance
;
}
void
LibFuzzerRegistry
:
:
registerModule
(
std
:
:
string
moduleName
LibFuzzerInitFunc
initFunc
LibFuzzerTestingFunc
testingFunc
)
{
moduleMap
.
insert
(
std
:
:
pair
<
std
:
:
string
LibFuzzerFunctions
>
(
moduleName
LibFuzzerFunctions
(
initFunc
testingFunc
)
)
)
;
}
LibFuzzerFunctions
LibFuzzerRegistry
:
:
getModuleFunctions
(
std
:
:
string
&
moduleName
)
{
return
moduleMap
[
moduleName
]
;
}
}
