#
ifndef
memory_profiler_UncensoredAllocator_h
#
define
memory_profiler_UncensoredAllocator_h
#
include
"
mozilla
/
Attributes
.
h
"
#
include
"
mozilla
/
ThreadLocal
.
h
"
#
ifdef
MOZ_REPLACE_MALLOC
#
include
"
replace_malloc_bridge
.
h
"
#
endif
class
NativeProfiler
;
namespace
mozilla
{
class
MallocHook
final
{
public
:
static
void
Initialize
(
)
;
static
void
Enable
(
NativeProfiler
*
aNativeProfiler
)
;
static
void
Disable
(
)
;
static
bool
Enabled
(
)
;
private
:
static
void
*
SampleNative
(
void
*
aAddr
size_t
aSize
)
;
static
void
RemoveNative
(
void
*
aAddr
)
;
#
ifdef
MOZ_REPLACE_MALLOC
static
MOZ_THREAD_LOCAL
(
bool
)
mEnabledTLS
;
static
NativeProfiler
*
mNativeProfiler
;
static
malloc_hook_table_t
mMallocHook
;
#
endif
friend
class
AutoUseUncensoredAllocator
;
}
;
class
MOZ_RAII
AutoUseUncensoredAllocator
final
{
public
:
AutoUseUncensoredAllocator
(
)
;
~
AutoUseUncensoredAllocator
(
)
;
}
;
}
#
endif
