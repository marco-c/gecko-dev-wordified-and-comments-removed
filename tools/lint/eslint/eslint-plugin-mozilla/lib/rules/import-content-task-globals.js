"
use
strict
"
;
var
helpers
=
require
(
"
.
.
/
helpers
"
)
;
var
frameScriptEnv
=
require
(
"
.
.
/
environments
/
frame
-
script
"
)
;
var
sandboxGlobals
=
[
"
Assert
"
"
Blob
"
"
BrowsingContext
"
"
ChromeUtils
"
"
ContentTaskUtils
"
"
EventUtils
"
"
Services
"
"
TextDecoder
"
"
TextEncoder
"
"
URL
"
"
assert
"
"
info
"
"
is
"
"
isnot
"
"
ok
"
"
todo
"
"
todo_is
"
]
;
module
.
exports
=
{
create
(
context
)
{
return
{
"
CallExpression
[
callee
.
object
.
name
=
'
ContentTask
'
]
[
callee
.
property
.
name
=
'
spawn
'
]
"
:
function
(
node
)
{
for
(
let
global
in
frameScriptEnv
.
globals
)
{
helpers
.
addVarToScope
(
global
context
.
getScope
(
)
frameScriptEnv
.
globals
[
global
]
)
;
}
}
"
CallExpression
[
callee
.
object
.
name
=
'
SpecialPowers
'
]
[
callee
.
property
.
name
=
'
spawn
'
]
"
:
function
(
node
)
{
let
globals
=
[
.
.
.
sandboxGlobals
"
SpecialPowers
"
"
content
"
"
docShell
"
]
;
for
(
let
global
of
globals
)
{
helpers
.
addVarToScope
(
global
context
.
getScope
(
)
false
)
;
}
}
"
CallExpression
[
callee
.
object
.
name
=
'
SpecialPowers
'
]
[
callee
.
property
.
name
=
'
spawnChrome
'
]
"
:
function
(
node
)
{
let
globals
=
[
.
.
.
sandboxGlobals
"
browsingContext
"
"
windowGlobalParent
"
]
;
for
(
let
global
of
globals
)
{
helpers
.
addVarToScope
(
global
context
.
getScope
(
)
false
)
;
}
}
}
;
}
}
;
