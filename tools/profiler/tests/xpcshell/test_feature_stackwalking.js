add_task
(
async
(
)
=
>
{
if
(
!
AppConstants
.
MOZ_GECKO_PROFILER
)
{
return
;
}
const
entries
=
10000
;
const
interval
=
1
;
const
threads
=
[
]
;
const
features
=
[
"
stackwalk
"
]
;
Services
.
profiler
.
StartProfiler
(
entries
interval
features
threads
)
;
const
sampleIndex
=
await
captureAtLeastOneJsSample
(
)
;
const
profile
=
await
Services
.
profiler
.
getProfileDataAsync
(
)
;
const
[
thread
]
=
profile
.
threads
;
const
{
samples
}
=
thread
;
const
inflatedStackFrames
=
getInflatedStackLocations
(
thread
samples
.
data
[
sampleIndex
]
)
;
const
nativeStack
=
/
^
0x
[
0
-
9a
-
f
]
+
/
;
expectStackToContain
(
inflatedStackFrames
[
"
(
root
)
"
nativeStack
nativeStack
"
js
:
:
RunScript
"
nativeStack
nativeStack
]
"
Expected
native
stacks
to
be
interleaved
between
some
frame
labels
.
There
should
"
+
"
be
more
than
one
native
stack
if
stack
walking
is
working
correctly
.
There
"
+
"
is
no
attempt
here
to
determine
if
the
memory
addresses
point
to
the
correct
"
+
"
symbols
"
)
;
}
)
;
