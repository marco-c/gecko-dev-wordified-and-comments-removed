#
include
"
GeckoProfiler
.
h
"
#
include
"
ProfilerIOInterposeObserver
.
h
"
#
include
"
ProfilerMarkerPayload
.
h
"
using
namespace
mozilla
;
void
ProfilerIOInterposeObserver
:
:
Observe
(
Observation
&
aObservation
)
{
if
(
!
IsMainThread
(
)
)
{
return
;
}
UniqueProfilerBacktrace
stack
=
profiler_get_backtrace
(
)
;
nsCString
filename
;
if
(
aObservation
.
Filename
(
)
)
{
filename
=
NS_ConvertUTF16toUTF8
(
aObservation
.
Filename
(
)
)
;
}
profiler_add_marker
(
aObservation
.
ObservedOperationString
(
)
MakeUnique
<
IOMarkerPayload
>
(
aObservation
.
Reference
(
)
filename
.
get
(
)
aObservation
.
Start
(
)
aObservation
.
End
(
)
Move
(
stack
)
)
)
;
}
