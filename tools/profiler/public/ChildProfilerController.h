#
ifndef
ChildProfilerController_h
#
define
ChildProfilerController_h
#
include
"
base
/
process
.
h
"
#
include
"
mozilla
/
Attributes
.
h
"
#
include
"
mozilla
/
ipc
/
ProtocolUtils
.
h
"
#
include
"
mozilla
/
DataMutex
.
h
"
#
include
"
mozilla
/
RefPtr
.
h
"
#
include
"
nsISupportsImpl
.
h
"
#
include
"
nsStringFwd
.
h
"
#
include
"
ProfileAdditionalInformation
.
h
"
namespace
mozilla
{
class
ProfilerChild
;
class
PProfilerChild
;
class
PProfilerParent
;
class
ChildProfilerController
final
{
public
:
NS_INLINE_DECL_THREADSAFE_REFCOUNTING
(
ChildProfilerController
)
#
ifdef
MOZ_GECKO_PROFILER
static
already_AddRefed
<
ChildProfilerController
>
Create
(
mozilla
:
:
ipc
:
:
Endpoint
<
PProfilerChild
>
&
&
aEndpoint
)
;
[
[
nodiscard
]
]
ProfileAndAdditionalInformation
GrabShutdownProfileAndShutdown
(
)
;
void
Shutdown
(
)
;
private
:
ChildProfilerController
(
)
;
~
ChildProfilerController
(
)
;
void
Init
(
mozilla
:
:
ipc
:
:
Endpoint
<
PProfilerChild
>
&
&
aEndpoint
)
;
void
ShutdownAndMaybeGrabShutdownProfileFirst
(
ProfileAndAdditionalInformation
*
aOutShutdownProfileInformation
)
;
void
SetupProfilerChild
(
mozilla
:
:
ipc
:
:
Endpoint
<
PProfilerChild
>
&
&
aEndpoint
)
;
void
ShutdownProfilerChild
(
ProfileAndAdditionalInformation
*
aOutShutdownProfileInformation
)
;
RefPtr
<
ProfilerChild
>
mProfilerChild
;
DataMutex
<
RefPtr
<
nsIThread
>
>
mThread
;
#
else
static
already_AddRefed
<
ChildProfilerController
>
Create
(
mozilla
:
:
ipc
:
:
Endpoint
<
PProfilerChild
>
&
&
aEndpoint
)
{
return
nullptr
;
}
[
[
nodiscard
]
]
ProfileAndAdditionalInformation
GrabShutdownProfileAndShutdown
(
)
{
return
ProfileAndAdditionalInformation
(
)
;
}
void
Shutdown
(
)
{
}
private
:
~
ChildProfilerController
(
)
{
}
#
endif
}
;
}
#
endif
