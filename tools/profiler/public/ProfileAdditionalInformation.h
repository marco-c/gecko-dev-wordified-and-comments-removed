#
ifndef
ProfileAdditionalInformation_h
#
define
ProfileAdditionalInformation_h
#
ifdef
MOZ_GECKO_PROFILER
#
include
"
shared
-
libraries
.
h
"
#
endif
#
include
"
js
/
Value
.
h
"
#
include
"
nsString
.
h
"
namespace
IPC
{
class
MessageReader
;
class
MessageWriter
;
template
<
typename
T
>
struct
ParamTraits
;
}
namespace
mozilla
{
struct
ProfileGenerationAdditionalInformation
{
#
ifdef
MOZ_GECKO_PROFILER
ProfileGenerationAdditionalInformation
(
)
=
default
;
explicit
ProfileGenerationAdditionalInformation
(
const
SharedLibraryInfo
&
&
aSharedLibraries
)
:
mSharedLibraries
(
aSharedLibraries
)
{
}
size_t
SizeOf
(
)
const
{
return
mSharedLibraries
.
SizeOf
(
)
;
}
void
Append
(
ProfileGenerationAdditionalInformation
&
&
aOther
)
{
mSharedLibraries
.
AddAllSharedLibraries
(
aOther
.
mSharedLibraries
)
;
}
void
FinishGathering
(
)
{
mSharedLibraries
.
DeduplicateEntries
(
)
;
}
void
ToJSValue
(
JSContext
*
aCx
JS
:
:
MutableHandle
<
JS
:
:
Value
>
aRetVal
)
const
;
SharedLibraryInfo
mSharedLibraries
;
#
endif
}
;
struct
ProfileAndAdditionalInformation
{
ProfileAndAdditionalInformation
(
)
=
default
;
explicit
ProfileAndAdditionalInformation
(
const
nsCString
&
&
aProfile
)
:
mProfile
(
aProfile
)
{
}
ProfileAndAdditionalInformation
(
const
nsCString
&
&
aProfile
const
ProfileGenerationAdditionalInformation
&
&
aAdditionalInformation
)
:
mProfile
(
aProfile
)
mAdditionalInformation
(
Some
(
aAdditionalInformation
)
)
{
}
size_t
SizeOf
(
)
const
{
size_t
size
=
mProfile
.
Length
(
)
;
#
ifdef
MOZ_GECKO_PROFILER
if
(
mAdditionalInformation
.
isSome
(
)
)
{
size
+
=
mAdditionalInformation
-
>
SizeOf
(
)
;
}
#
endif
return
size
;
}
nsCString
mProfile
;
Maybe
<
ProfileGenerationAdditionalInformation
>
mAdditionalInformation
;
}
;
}
namespace
IPC
{
template
<
>
struct
ParamTraits
<
mozilla
:
:
ProfileGenerationAdditionalInformation
>
{
typedef
mozilla
:
:
ProfileGenerationAdditionalInformation
paramType
;
static
void
Write
(
MessageWriter
*
aWriter
const
paramType
&
aParam
)
;
static
bool
Read
(
MessageReader
*
aReader
paramType
*
aResult
)
;
}
;
}
#
endif
