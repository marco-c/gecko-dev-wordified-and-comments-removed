#
include
"
mozilla
/
ProfilerUtils
.
h
"
#
if
defined
(
XP_WIN
)
#
include
"
mozilla
/
Assertions
.
h
"
#
include
<
process
.
h
>
#
include
<
processthreadsapi
.
h
>
ProfilerProcessId
profiler_current_process_id
(
)
{
return
ProfilerProcessId
:
:
FromNumber
(
_getpid
(
)
)
;
}
ProfilerThreadId
profiler_current_thread_id
(
)
{
DWORD
threadId
=
GetCurrentThreadId
(
)
;
MOZ_ASSERT
(
threadId
<
=
INT32_MAX
"
native
thread
ID
is
>
INT32_MAX
"
)
;
return
ProfilerThreadId
:
:
FromNumber
(
static_cast
<
ProfilerThreadId
:
:
NumberType
>
(
threadId
)
)
;
}
#
else
#
include
<
unistd
.
h
>
ProfilerProcessId
profiler_current_process_id
(
)
{
return
ProfilerProcessId
:
:
FromNumber
(
getpid
(
)
)
;
}
#
if
defined
(
XP_MACOSX
)
#
include
<
pthread
.
h
>
ProfilerThreadId
profiler_current_thread_id
(
)
{
uint64_t
tid
;
pthread_threadid_np
(
nullptr
&
tid
)
;
return
ProfilerThreadId
:
:
FromNumber
(
static_cast
<
ProfilerThreadId
:
:
NumberType
>
(
tid
)
)
;
}
#
elif
defined
(
__ANDROID__
)
|
|
defined
(
ANDROID
)
#
include
<
sys
/
types
.
h
>
ProfilerThreadId
profiler_current_thread_id
(
)
{
return
ProfilerThreadId
:
:
FromNumber
(
static_cast
<
ProfilerThreadId
:
:
NumberType
>
(
gettid
(
)
)
)
;
}
#
elif
defined
(
XP_LINUX
)
#
include
<
sys
/
syscall
.
h
>
ProfilerThreadId
profiler_current_thread_id
(
)
{
return
ProfilerThreadId
:
:
FromNumber
(
static_cast
<
ProfilerThreadId
:
:
NumberType
>
(
syscall
(
SYS_gettid
)
)
)
;
}
#
elif
defined
(
XP_FREEBSD
)
#
include
<
sys
/
thr
.
h
>
ProfilerThreadId
profiler_current_thread_id
(
)
{
long
id
;
(
void
)
thr_self
(
&
id
)
;
return
ProfilerThreadId
:
:
FromNumber
(
static_cast
<
ProfilerThreadId
:
:
NumberType
>
(
id
)
)
;
}
#
else
ProfilerThreadId
profiler_current_thread_id
(
)
{
return
ProfilerThreadId
{
}
;
}
#
endif
#
endif
#
include
"
MainThreadUtils
.
h
"
#
include
"
mozilla
/
Assertions
.
h
"
static
ProfilerThreadId
scProfilerMainThreadId
;
void
profiler_init_main_thread_id
(
)
{
MOZ_ASSERT
(
NS_IsMainThread
(
)
)
;
mozilla
:
:
baseprofiler
:
:
profiler_init_main_thread_id
(
)
;
if
(
!
scProfilerMainThreadId
.
IsSpecified
(
)
)
{
scProfilerMainThreadId
=
profiler_current_thread_id
(
)
;
}
}
[
[
nodiscard
]
]
ProfilerThreadId
profiler_main_thread_id
(
)
{
return
scProfilerMainThreadId
;
}
[
[
nodiscard
]
]
bool
profiler_is_main_thread
(
)
{
return
profiler_current_thread_id
(
)
=
=
scProfilerMainThreadId
;
}
