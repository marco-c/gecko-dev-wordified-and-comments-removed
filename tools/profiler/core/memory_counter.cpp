#
include
"
memory_counter
.
h
"
#
include
"
mozilla
/
UniquePtr
.
h
"
#
include
"
mozmemory
.
h
"
#
include
"
GeckoProfiler
.
h
"
namespace
mozilla
:
:
profiler
{
class
MemoryCounter
:
public
BaseProfilerCount
{
public
:
MemoryCounter
(
)
:
BaseProfilerCount
(
"
malloc
"
"
Memory
"
"
Amount
of
allocated
memory
"
)
{
}
;
virtual
~
MemoryCounter
(
)
{
}
CountSample
Sample
(
)
override
{
jemalloc_stats_lite_t
stats
;
jemalloc_stats_lite
(
&
stats
)
;
CountSample
sample
=
{
.
count
=
int64_t
(
stats
.
allocated_bytes
)
.
number
=
stats
.
num_operations
.
isSampleNew
=
true
}
;
return
sample
;
}
}
;
UniquePtr
<
BaseProfilerCount
>
create_memory_counter
(
)
{
return
MakeUnique
<
MemoryCounter
>
(
)
;
}
}
