add_task
(
async
function
(
)
{
let
principal
=
Services
.
scriptSecurityManager
.
createContentPrincipalFromOrigin
(
"
http
:
/
/
example
.
com
"
)
;
Services
.
perms
.
addFromPrincipal
(
principal
"
viewsourceTestingPerm
"
Services
.
perms
.
ALLOW_ACTION
)
;
let
tab
=
await
BrowserTestUtils
.
openNewForegroundTab
(
gBrowser
"
view
-
source
:
http
:
/
/
example
.
com
"
true
false
true
)
;
await
SpecialPowers
.
spawn
(
tab
.
linkedBrowser
[
principal
]
async
function
(
p
)
{
is
(
Services
.
perms
.
testPermissionFromPrincipal
(
p
"
viewsourceTestingPerm
"
)
Services
.
perms
.
ALLOW_ACTION
)
;
}
)
;
BrowserTestUtils
.
removeTab
(
tab
)
;
}
)
;
