function
run_test
(
)
{
let
principal
=
Services
.
scriptSecurityManager
.
createContentPrincipalFromOrigin
(
"
https
:
/
/
example
.
org
"
)
;
Assert
.
equal
(
Services
.
perms
.
testPermissionFromPrincipal
(
principal
"
camera
"
)
Services
.
perms
.
UNKNOWN_ACTION
)
;
Services
.
prefs
.
setIntPref
(
"
permissions
.
default
.
camera
"
Services
.
perms
.
MAX_VALID_ACTION
+
1
)
;
Assert
.
equal
(
Services
.
perms
.
testPermissionFromPrincipal
(
principal
"
camera
"
)
Services
.
perms
.
UNKNOWN_ACTION
)
;
Services
.
prefs
.
setIntPref
(
"
permissions
.
default
.
camera
"
-
1
)
;
Assert
.
equal
(
Services
.
perms
.
testPermissionFromPrincipal
(
principal
"
camera
"
)
Services
.
perms
.
UNKNOWN_ACTION
)
;
Services
.
prefs
.
setIntPref
(
"
permissions
.
default
.
camera
"
Services
.
perms
.
DENY_ACTION
)
;
Assert
.
equal
(
Services
.
perms
.
testPermissionFromPrincipal
(
principal
"
camera
"
)
Services
.
perms
.
DENY_ACTION
)
;
Assert
.
equal
(
null
Services
.
perms
.
getPermissionObject
(
principal
"
camera
"
false
)
)
;
Assert
.
equal
(
Services
.
perms
.
testPermissionFromPrincipal
(
principal
"
geo
"
)
Services
.
perms
.
UNKNOWN_ACTION
)
;
Services
.
prefs
.
setIntPref
(
"
permissions
.
default
.
camera
"
Services
.
perms
.
ALLOW_ACTION
)
;
Assert
.
equal
(
Services
.
perms
.
testPermissionFromPrincipal
(
principal
"
camera
"
)
Services
.
perms
.
ALLOW_ACTION
)
;
Services
.
perms
.
addFromPrincipal
(
principal
"
camera
"
Services
.
perms
.
DENY_ACTION
)
;
Assert
.
equal
(
Services
.
perms
.
testPermissionFromPrincipal
(
principal
"
camera
"
)
Services
.
perms
.
DENY_ACTION
)
;
Assert
.
notEqual
(
Services
.
perms
.
getPermissionObject
(
principal
"
camera
"
false
)
null
)
;
Services
.
perms
.
removeAll
(
)
;
Assert
.
equal
(
Services
.
perms
.
testPermissionFromPrincipal
(
principal
"
camera
"
)
Services
.
perms
.
ALLOW_ACTION
)
;
Services
.
prefs
.
clearUserPref
(
"
permissions
.
default
.
camera
"
)
;
Assert
.
equal
(
Services
.
perms
.
testPermissionFromPrincipal
(
principal
"
camera
"
)
Services
.
perms
.
UNKNOWN_ACTION
)
;
}
