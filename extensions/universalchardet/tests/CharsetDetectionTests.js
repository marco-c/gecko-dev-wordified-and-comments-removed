var
gExpectedCharset
;
var
gLocalDir
;
function
CharsetDetectionTests
(
aTestFile
aExpectedCharset
)
{
gExpectedCharset
=
aExpectedCharset
;
InitDetectorTests
(
)
;
var
fileURI
=
gLocalDir
+
aTestFile
;
(
"
testframe
"
)
.
src
=
fileURI
;
SimpleTest
.
waitForExplicitFinish
(
)
;
}
function
InitDetectorTests
(
)
{
var
loader
=
Services
.
scriptloader
;
var
ioService
=
Services
.
io
;
loader
.
loadSubScript
(
"
chrome
:
/
/
mochikit
/
content
/
chrome
-
harness
.
js
"
)
;
(
"
testframe
"
)
.
onload
=
DoDetectionTest
;
if
(
gExpectedCharset
=
=
"
default
"
)
{
gExpectedCharset
=
"
windows
-
1252
"
;
}
var
jar
=
getJar
(
getRootDirectory
(
window
.
location
.
href
)
)
;
var
dir
=
jar
?
extractJarToTmp
(
jar
)
:
getChromeDir
(
getResolvedURI
(
window
.
location
.
href
)
)
;
gLocalDir
=
ioService
.
newFileURI
(
dir
)
.
spec
;
}
function
DoDetectionTest
(
)
{
var
iframeDoc
=
(
"
testframe
"
)
.
contentDocument
;
var
charset
=
iframeDoc
.
characterSet
;
is
(
charset
gExpectedCharset
"
decoded
as
"
+
gExpectedCharset
)
;
SimpleTest
.
finish
(
)
;
}
