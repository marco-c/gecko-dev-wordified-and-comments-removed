function
run_test
(
)
{
let
uri
=
Services
.
io
.
newURI
(
"
https
:
/
/
example
.
org
"
)
;
do_check_eq
(
Services
.
perms
.
testPermission
(
uri
"
camera
"
)
Services
.
perms
.
UNKNOWN_ACTION
)
;
Services
.
prefs
.
setIntPref
(
"
permissions
.
default
.
camera
"
Services
.
perms
.
DENY_ACTION
)
;
do_check_eq
(
Services
.
perms
.
testPermission
(
uri
"
camera
"
)
Services
.
perms
.
DENY_ACTION
)
;
do_check_null
(
Services
.
perms
.
getPermissionObjectForURI
(
uri
"
camera
"
false
)
)
;
do_check_eq
(
Services
.
perms
.
testPermission
(
uri
"
geo
"
)
Services
.
perms
.
UNKNOWN_ACTION
)
;
Services
.
prefs
.
setIntPref
(
"
permissions
.
default
.
camera
"
Services
.
perms
.
ALLOW_ACTION
)
;
do_check_eq
(
Services
.
perms
.
testPermission
(
uri
"
camera
"
)
Services
.
perms
.
ALLOW_ACTION
)
;
Services
.
perms
.
add
(
uri
"
camera
"
Services
.
perms
.
DENY_ACTION
)
;
do_check_eq
(
Services
.
perms
.
testPermission
(
uri
"
camera
"
)
Services
.
perms
.
DENY_ACTION
)
;
do_check_true
(
Services
.
perms
.
getPermissionObjectForURI
(
uri
"
camera
"
false
)
!
=
null
)
;
Services
.
perms
.
removeAll
(
)
;
do_check_eq
(
Services
.
perms
.
testPermission
(
uri
"
camera
"
)
Services
.
perms
.
ALLOW_ACTION
)
;
Services
.
prefs
.
clearUserPref
(
"
permissions
.
default
.
camera
"
)
;
do_check_eq
(
Services
.
perms
.
testPermission
(
uri
"
camera
"
)
Services
.
perms
.
UNKNOWN_ACTION
)
;
}
