#
include
"
mozilla
/
UniquePtr
.
h
"
#
include
"
RemoteSpellCheckEngineChild
.
h
"
namespace
mozilla
{
RemoteSpellcheckEngineChild
:
:
RemoteSpellcheckEngineChild
(
mozSpellChecker
*
aOwner
)
:
mOwner
(
aOwner
)
{
}
RemoteSpellcheckEngineChild
:
:
~
RemoteSpellcheckEngineChild
(
)
{
mOwner
-
>
DeleteRemoteEngine
(
)
;
}
RefPtr
<
GenericPromise
>
RemoteSpellcheckEngineChild
:
:
SetCurrentDictionaryFromList
(
const
nsTArray
<
nsString
>
&
aList
)
{
MozPromiseHolder
<
GenericPromise
>
*
promiseHolder
=
new
MozPromiseHolder
<
GenericPromise
>
(
)
;
RefPtr
<
GenericPromise
>
promise
=
promiseHolder
-
>
Ensure
(
__func__
)
;
RefPtr
<
mozSpellChecker
>
spellChecker
=
mOwner
;
SendSetDictionaryFromList
(
aList
)
-
>
Then
(
GetMainThreadSerialEventTarget
(
)
__func__
[
spellChecker
promiseHolder
]
(
const
Tuple
<
bool
nsString
>
&
aParam
)
{
UniquePtr
<
MozPromiseHolder
<
GenericPromise
>
>
holder
(
promiseHolder
)
;
if
(
!
Get
<
0
>
(
aParam
)
)
{
spellChecker
-
>
mCurrentDictionary
.
Truncate
(
)
;
holder
-
>
Reject
(
NS_ERROR_NOT_AVAILABLE
__func__
)
;
return
;
}
spellChecker
-
>
mCurrentDictionary
=
Get
<
1
>
(
aParam
)
;
holder
-
>
Resolve
(
true
__func__
)
;
}
[
spellChecker
promiseHolder
]
(
ResponseRejectReason
aReason
)
{
UniquePtr
<
MozPromiseHolder
<
GenericPromise
>
>
holder
(
promiseHolder
)
;
spellChecker
-
>
mCurrentDictionary
.
Truncate
(
)
;
holder
-
>
Reject
(
NS_ERROR_NOT_AVAILABLE
__func__
)
;
}
)
;
return
promise
;
}
}
