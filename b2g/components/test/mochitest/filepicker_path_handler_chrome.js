'
use
strict
'
;
var
Cc
=
Components
.
classes
;
var
Ci
=
Components
.
interfaces
;
var
ppmm
=
Cc
[
'
mozilla
.
org
/
parentprocessmessagemanager
;
1
'
]
.
getService
(
Ci
.
nsIMessageListenerManager
)
;
var
pickResult
=
null
;
var
timer
=
null
;
function
processPickMessage
(
message
)
{
let
sender
=
message
.
target
.
QueryInterface
(
Ci
.
nsIMessageSender
)
;
sender
.
sendAsyncMessage
(
'
file
-
picked
'
pickResult
)
;
timer
=
Cc
[
"
mozilla
.
org
/
timer
;
1
"
]
.
createInstance
(
Components
.
interfaces
.
nsITimer
)
;
timer
.
initWithCallback
(
function
(
)
{
sendAsyncMessage
(
'
file
-
picked
-
posted
'
{
type
:
'
file
-
picked
-
posted
'
}
)
;
}
3000
Ci
.
nsITimer
.
TYPE_ONE_SHOT
)
;
}
function
updatePickResult
(
result
)
{
pickResult
=
result
;
sendAsyncMessage
(
'
pick
-
result
-
updated
'
{
type
:
'
pick
-
result
-
updated
'
}
)
;
}
ppmm
.
addMessageListener
(
'
file
-
picker
'
processPickMessage
)
;
addMessageListener
(
'
update
-
pick
-
result
'
updatePickResult
)
;
