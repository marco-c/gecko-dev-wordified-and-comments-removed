"
use
strict
"
;
var
fs
=
require
(
"
fs
"
)
;
var
helpers
=
require
(
"
.
.
/
helpers
"
)
;
var
path
=
require
(
"
path
"
)
;
module
.
exports
=
function
(
context
)
{
function
importGlobalsFrom
(
filePath
)
{
var
content
=
fs
.
readFileSync
(
filePath
"
utf8
"
)
;
var
ast
=
helpers
.
getAST
(
content
)
;
var
globalVars
=
helpers
.
getGlobals
(
ast
)
;
for
(
var
i
=
0
;
i
<
globalVars
.
length
;
i
+
+
)
{
var
varName
=
globalVars
[
i
]
;
helpers
.
addVarToScope
(
varName
context
)
;
}
}
return
{
Program
:
function
(
node
)
{
var
comments
=
context
.
getSourceCode
(
)
.
getAllComments
(
)
;
comments
.
forEach
(
function
(
comment
)
{
var
value
=
comment
.
value
.
trim
(
)
;
var
match
=
/
^
import
-
globals
-
from
\
s
+
(
.
*
)
/
.
exec
(
value
)
;
if
(
match
)
{
var
currentFilePath
=
helpers
.
getAbsoluteFilePath
(
context
)
;
var
filePath
=
match
[
1
]
;
if
(
!
path
.
isAbsolute
(
filePath
)
)
{
var
dirName
=
path
.
dirname
(
currentFilePath
)
;
filePath
=
path
.
resolve
(
dirName
filePath
)
;
}
try
{
importGlobalsFrom
(
filePath
)
;
}
catch
(
e
)
{
context
.
report
(
node
"
Could
not
load
globals
from
file
{
{
filePath
}
}
:
{
{
error
}
}
"
{
filePath
:
filePath
error
:
e
}
)
;
}
}
}
)
;
}
}
;
}
;
