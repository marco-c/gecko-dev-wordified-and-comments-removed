const
{
logTest
}
=
require
(
"
.
/
utils
/
profiling
"
)
;
module
.
exports
=
logTest
(
"
dns
lookup
pageload
"
async
function
(
context
commands
)
{
context
.
log
.
info
(
"
Starting
a
pageload
to
measure
DNS
lookup
time
"
)
;
const
testType
=
{
context
.
options
.
browsertime
.
test_type
}
;
context
.
log
.
info
(
"
testType
:
"
+
testType
)
;
const
url
=
context
.
options
.
browsertime
.
test_url
|
|
"
https
:
/
/
httpbin
.
org
/
"
;
context
.
log
.
info
(
"
url
:
"
+
url
)
;
await
commands
.
navigate
(
"
about
:
blank
"
)
;
await
commands
.
wait
.
byTime
(
45000
)
;
if
(
testType
=
=
=
"
trr_warm
"
)
{
await
commands
.
navigate
(
"
https
:
/
/
www
.
w3
.
org
"
)
;
await
commands
.
wait
.
byTime
(
2000
)
;
}
await
commands
.
measure
.
start
(
)
;
await
commands
.
navigate
(
url
)
;
await
commands
.
measure
.
stop
(
)
;
let
dns_lookup_time
=
await
commands
.
js
.
run
(
return
(
window
.
performance
.
timing
.
domainLookupEnd
-
window
.
performance
.
timing
.
domainLookupStart
)
;
)
;
let
connect_time
=
await
commands
.
js
.
run
(
return
(
window
.
performance
.
timing
.
connectEnd
-
window
.
performance
.
timing
.
navigationStart
)
;
)
;
context
.
log
.
info
(
"
dns_lookup_time
:
"
+
dns_lookup_time
)
;
context
.
log
.
info
(
"
connect_time
:
"
+
connect_time
)
;
await
commands
.
measure
.
addObject
(
{
custom_data
:
{
dns_lookup_time
connect_time
}
}
)
;
context
.
log
.
info
(
"
DNS
lookup
test
finished
.
"
)
;
return
true
;
}
)
;
