<
html
>
<
meta
charset
=
"
utf
-
8
"
>
<
script
>
window
.
onerror
=
(
message
source
lineno
)
=
>
{
dump
(
TEST
-
UNEXPECTED
-
FAIL
|
tspaint_test
|
{
source
}
line
{
lineno
}
:
{
message
}
\
n
)
;
}
;
<
/
script
>
<
script
language
=
"
Javascript
"
type
=
"
text
/
javascript
"
src
=
"
.
.
/
talos
-
powers
/
content
/
TalosPowersContent
.
js
"
>
<
/
script
>
<
script
language
=
"
Javascript
"
type
=
"
text
/
javascript
"
src
=
"
.
.
/
talos
-
powers
/
content
/
TalosContentProfiler
.
js
"
>
<
/
script
>
<
script
language
=
"
javascript
"
type
=
"
text
/
javascript
"
>
async
function
painted
(
)
{
window
.
removeEventListener
(
"
MozAfterPaint
"
painted
true
)
;
await
TalosPowers
.
loadPromise
;
await
TalosContentProfiler
.
pause
(
)
;
await
TalosContentProfiler
.
initFromURLQueryParams
(
location
.
search
)
;
await
TalosContentProfiler
.
finishStartupProfiling
(
)
;
let
startupInfo
=
await
TalosPowersContent
.
getStartupInfo
(
)
;
let
startupTime
=
startupInfo
.
firstPaint
-
startupInfo
.
process
;
document
.
body
.
textContent
=
"
Startup
time
=
"
+
startupTime
+
"
ms
"
;
if
(
window
.
dump
)
{
dump
(
"
__start_report
"
+
startupTime
+
"
__end_report
\
n
\
n
"
)
;
}
dumpConsoleAndQuit
(
)
;
}
function
failed
(
)
{
if
(
window
.
dump
)
{
dump
(
"
BROWSER
FAILED
TO
GENERATE
MOZAFTERPAINT
IN
5
SECONDS
\
n
"
)
;
}
dumpConsoleAndQuit
(
)
;
}
function
dumpConsoleAndQuit
(
)
{
var
messages
;
try
{
netscape
.
security
.
PrivilegeManager
.
enablePrivilege
(
"
UniversalXPConnect
"
)
;
/
/
ChromeUtils
is
not
available
in
this
scope
.
/
/
eslint
-
disable
-
next
-
line
mozilla
/
use
-
chromeutils
-
import
Cu
.
import
(
"
resource
:
/
/
gre
/
modules
/
Services
.
jsm
"
)
;
messages
=
Services
.
console
.
getMessageArray
(
)
;
}
catch
(
ex
)
{
dump
(
ex
+
"
\
n
"
)
;
messages
=
[
]
;
}
for
(
var
i
=
0
;
i
<
messages
.
length
;
i
+
+
)
dump
(
messages
[
i
]
.
message
+
"
\
n
"
)
;
/
/
Close
window
asynchronously
there
might
still
be
startup
operations
that
still
need
to
run
window
.
setTimeout
(
function
(
)
{
if
(
window
.
dump
)
{
/
/
eslint
-
disable
-
next
-
line
mozilla
/
avoid
-
Date
-
timing
dump
(
"
__startTimestamp
"
+
Date
.
now
(
)
+
"
__endTimestamp
\
n
"
)
;
}
TalosPowersContent
.
goQuitApplication
(
)
;
}
0
)
;
}
window
.
addEventListener
(
"
MozAfterPaint
"
painted
true
)
;
setTimeout
(
failed
5000
)
;
<
/
script
>
<
body
>
<
/
body
>
<
/
html
>
