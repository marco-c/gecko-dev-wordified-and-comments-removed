ChromeUtils
.
import
(
"
resource
:
/
/
gre
/
modules
/
Services
.
jsm
"
)
;
ChromeUtils
.
import
(
"
resource
:
/
/
gre
/
modules
/
XPCOMUtils
.
jsm
"
)
;
XPCOMUtils
.
defineLazyServiceGetter
(
this
"
categoryManager
"
"
mozilla
.
org
/
categorymanager
;
1
"
"
nsICategoryManager
"
)
;
const
Cm
=
Components
.
manager
.
QueryInterface
(
Ci
.
nsIComponentRegistrar
)
;
const
CATMAN_CONTRACTID
=
"
mozilla
.
org
/
categorymanager
;
1
"
;
const
CATEGORY_NAME
=
"
command
-
line
-
handler
"
;
const
CATEGORY_ENTRY
=
"
m
-
tp
"
;
function
PageLoaderCmdLine
(
)
{
}
PageLoaderCmdLine
.
prototype
=
{
factory
:
XPCOMUtils
.
_getFactory
(
PageLoaderCmdLine
)
classDescription
:
"
Loads
pages
.
Tests
them
.
"
classID
:
Components
.
ID
(
"
{
8AF052F5
-
8EFE
-
4359
-
8266
-
E16498A82E8B
}
"
)
contractID
:
"
mozilla
.
org
/
commandlinehandler
/
general
-
startup
;
1
?
type
=
tp
"
QueryInterface
:
ChromeUtils
.
generateQI
(
[
Ci
.
nsICommandLineHandler
]
)
register
(
)
{
Cm
.
registerFactory
(
this
.
classID
this
.
classDescription
this
.
contractID
this
.
factory
)
;
categoryManager
.
addCategoryEntry
(
CATEGORY_NAME
CATEGORY_ENTRY
this
.
contractID
false
true
)
;
}
unregister
(
)
{
categoryManager
.
deleteCategoryEntry
(
CATEGORY_NAME
CATEGORY_ENTRY
this
.
contractID
false
)
;
Cm
.
unregisterFactory
(
this
.
classID
this
.
factory
)
;
}
handle
:
function
handler_handle
(
cmdLine
)
{
var
args
=
{
}
;
var
tpmanifest
=
Services
.
prefs
.
getCharPref
(
"
talos
.
tpmanifest
"
null
)
;
if
(
tpmanifest
=
=
null
)
{
return
;
}
let
chromeURL
=
"
chrome
:
/
/
pageloader
/
content
/
pageloader
.
xul
"
;
args
.
wrappedJSObject
=
args
;
Services
.
ww
.
openWindow
(
null
chromeURL
"
_blank
"
"
chrome
dialog
=
no
all
"
args
)
;
cmdLine
.
preventDefault
=
true
;
}
}
;
function
startup
(
data
reason
)
{
PageLoaderCmdLine
.
prototype
.
register
(
)
;
}
function
shutdown
(
data
reason
)
{
PageLoaderCmdLine
.
prototype
.
unregister
(
)
;
}
function
install
(
data
reason
)
{
}
function
uninstall
(
data
reason
)
{
}
