(
function
(
)
{
addEventListener
(
"
load
"
loadevt
=
>
{
if
(
!
content
.
location
.
pathname
.
endsWith
(
"
target
.
html
"
)
)
{
return
;
}
let
opened
=
parseInt
(
content
.
location
.
search
.
substring
(
1
)
10
)
;
addEventListener
(
"
MozAfterPaint
"
function
onPaint
(
e
)
{
let
rect
=
e
.
boundingClientRect
;
if
(
!
rect
.
width
&
&
!
rect
.
height
)
{
return
;
}
removeEventListener
(
"
MozAfterPaint
"
onPaint
)
;
let
fetchStart
=
content
.
performance
.
timing
.
fetchStart
;
let
presented
=
fetchStart
+
e
.
paintTimeStamp
;
let
delta
=
presented
-
opened
;
sendAsyncMessage
(
"
TabPaint
:
Painted
"
{
delta
}
)
;
}
)
;
}
true
)
;
addEventListener
(
"
TabPaint
:
Ping
"
e
=
>
{
let
evt
=
new
content
.
CustomEvent
(
"
TabPaint
:
Pong
"
{
bubbles
:
true
}
)
;
content
.
dispatchEvent
(
evt
)
;
}
false
true
)
;
addEventListener
(
"
TabPaint
:
Go
"
e
=
>
{
sendAsyncMessage
(
"
TabPaint
:
Go
"
{
target
:
e
.
detail
.
target
}
)
;
}
false
true
)
;
addMessageListener
(
"
TabPaint
:
OpenFromContent
"
msg
=
>
{
let
evt
=
new
content
.
CustomEvent
(
"
TabPaint
:
OpenFromContent
"
{
bubbles
:
true
}
)
;
content
.
dispatchEvent
(
evt
)
;
}
)
;
addMessageListener
(
"
TabPaint
:
FinalResults
"
msg
=
>
{
let
evt
=
Cu
.
cloneInto
(
{
bubbles
:
true
detail
:
msg
.
data
}
content
)
;
content
.
dispatchEvent
(
new
content
.
CustomEvent
(
"
TabPaint
:
FinalResults
"
evt
)
)
;
}
)
;
}
)
(
)
;
