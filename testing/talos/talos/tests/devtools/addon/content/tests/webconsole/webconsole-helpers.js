"
use
strict
"
;
const
{
reloadPageAndLog
}
=
require
(
"
.
.
/
head
"
)
;
exports
.
reloadConsoleAndLog
=
async
function
(
label
toolbox
expectedMessages
)
{
const
onReload
=
async
function
(
)
{
const
{
hud
}
=
toolbox
.
getPanel
(
"
webconsole
"
)
;
await
waitForConsoleOutputChildListChange
(
hud
consoleOutputEl
=
>
{
const
messageCount
=
consoleOutputEl
.
querySelectorAll
(
"
.
message
"
)
.
length
;
return
messageCount
>
=
expectedMessages
;
}
)
;
}
;
await
reloadPageAndLog
(
label
+
"
.
webconsole
"
toolbox
onReload
)
;
}
;
async
function
waitForConsoleOutputChildListChange
(
hud
predicate
)
{
const
{
window
document
}
=
hud
.
ui
;
const
webConsoleOutputEl
=
document
.
querySelector
(
"
.
webconsole
-
output
"
)
;
await
new
Promise
(
resolve
=
>
{
const
observer
=
new
window
.
MutationObserver
(
(
mutationsList
observer
)
=
>
{
if
(
predicate
(
webConsoleOutputEl
)
)
{
observer
.
disconnect
(
)
;
resolve
(
)
;
}
}
)
;
observer
.
observe
(
webConsoleOutputEl
{
childList
:
true
}
)
;
}
)
;
}
exports
.
waitForConsoleOutputChildListChange
=
waitForConsoleOutputChildListChange
;
