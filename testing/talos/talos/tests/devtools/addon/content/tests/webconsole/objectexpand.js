"
use
strict
"
;
const
{
openToolbox
closeToolboxAndLog
getBrowserWindow
runTest
testSetup
testTeardown
SIMPLE_URL
}
=
require
(
"
.
.
/
head
"
)
;
module
.
exports
=
async
function
(
)
{
let
tab
=
await
testSetup
(
SIMPLE_URL
)
;
let
messageManager
=
tab
.
linkedBrowser
.
messageManager
;
let
toolbox
=
await
openToolbox
(
"
webconsole
"
)
;
let
webconsole
=
toolbox
.
getPanel
(
"
webconsole
"
)
;
const
waitForDirMessage
=
async
(
)
=
>
{
let
message
=
webconsole
.
hud
.
ui
.
outputNode
.
querySelector
(
"
.
dir
.
message
"
)
;
if
(
message
)
{
return
message
;
}
await
new
Promise
(
res
=
>
setTimeout
(
res
50
)
)
;
return
waitForDirMessage
(
)
;
}
;
messageManager
.
loadFrameScript
(
"
data
:
(
"
+
encodeURIComponent
(
function
(
)
{
addMessageListener
(
"
do
-
dir
"
function
(
)
{
content
.
console
.
dir
(
Array
.
from
(
{
length
:
333
}
)
.
reduce
(
(
res
_
i
)
=
>
{
res
[
"
item_
"
+
i
]
=
"
alphanum
-
indexed
-
"
+
i
;
res
[
i
]
=
"
num
-
indexed
-
"
+
i
;
res
[
Symbol
(
i
)
]
=
"
symbol
-
indexed
-
"
+
i
;
return
res
;
}
{
}
)
)
;
}
)
;
}
)
+
"
)
(
)
"
true
)
;
let
test
=
runTest
(
"
console
.
objectexpand
"
)
;
messageManager
.
sendAsyncMessage
(
"
do
-
dir
"
)
;
const
message
=
await
waitForDirMessage
(
)
;
const
tree
=
message
.
querySelector
(
"
.
tree
"
)
;
if
(
tree
.
querySelectorAll
(
"
.
node
"
)
.
length
=
=
=
1
)
{
await
new
Promise
(
resolve
=
>
{
const
observer
=
new
(
getBrowserWindow
(
)
)
.
MutationObserver
(
mutations
=
>
{
resolve
(
mutations
)
;
observer
.
disconnect
(
)
;
}
)
;
observer
.
observe
(
tree
{
childList
:
true
}
)
;
}
)
;
}
test
.
done
(
)
;
await
closeToolboxAndLog
(
"
console
.
objectexpanded
"
toolbox
)
;
await
testTeardown
(
)
;
}
;
