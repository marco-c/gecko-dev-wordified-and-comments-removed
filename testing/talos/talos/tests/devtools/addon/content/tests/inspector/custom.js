"
use
strict
"
;
const
{
reloadInspectorAndLog
}
=
require
(
"
chrome
:
/
/
damp
/
content
/
tests
/
inspector
/
inspector
-
helpers
"
)
;
const
{
openToolboxAndLog
closeToolboxAndLog
runTest
testSetup
testTeardown
PAGES_BASE_URL
}
=
require
(
"
chrome
:
/
/
damp
/
content
/
tests
/
head
"
)
;
module
.
exports
=
async
function
(
)
{
await
testSetup
(
PAGES_BASE_URL
+
"
custom
/
inspector
/
index
.
html
"
)
;
let
toolbox
=
await
openToolboxAndLog
(
"
custom
.
inspector
"
"
inspector
"
)
;
await
reloadInspectorAndLog
(
"
custom
"
toolbox
)
;
await
selectNodeWithManyRulesAndLog
(
toolbox
)
;
await
closeToolboxAndLog
(
"
custom
.
inspector
"
toolbox
)
;
await
testTeardown
(
)
;
}
;
async
function
selectNodeWithManyRulesAndLog
(
toolbox
)
{
let
inspector
=
toolbox
.
getPanel
(
"
inspector
"
)
;
let
selectNodeFront
=
(
nodeFront
)
=
>
{
let
onRuleViewRefreshed
=
inspector
.
once
(
"
rule
-
view
-
refreshed
"
)
;
inspector
.
selection
.
setNodeFront
(
nodeFront
)
;
return
onRuleViewRefreshed
;
}
;
let
initialNodeFront
=
inspector
.
selection
.
nodeFront
;
let
root
=
await
inspector
.
walker
.
getRootNode
(
)
;
let
referenceNodeFront
=
await
inspector
.
walker
.
querySelector
(
root
"
.
no
-
css
-
rules
"
)
;
let
testNodeFront
=
await
inspector
.
walker
.
querySelector
(
root
"
.
many
-
css
-
rules
"
)
;
dump
(
"
Selecting
.
many
-
css
-
rules
test
node
front
\
n
"
)
;
let
test
=
runTest
(
"
custom
.
inspector
.
manyrules
.
selectnode
"
)
;
await
selectNodeFront
(
testNodeFront
)
;
test
.
done
(
)
;
dump
(
"
Move
the
selection
to
a
node
with
no
rules
\
n
"
)
;
test
=
runTest
(
"
custom
.
inspector
.
manyrules
.
deselectnode
"
)
;
await
selectNodeFront
(
referenceNodeFront
)
;
test
.
done
(
)
;
await
selectNodeFront
(
initialNodeFront
)
;
}
