"
use
strict
"
;
const
Services
=
require
(
"
Services
"
)
;
const
{
openToolbox
closeToolbox
runTest
testSetup
testTeardown
SIMPLE_URL
}
=
require
(
"
.
.
/
head
"
)
;
module
.
exports
=
async
function
(
)
{
let
tab
=
await
testSetup
(
SIMPLE_URL
)
;
let
messageManager
=
tab
.
linkedBrowser
.
messageManager
;
let
sidebarTab
=
Services
.
prefs
.
getCharPref
(
"
devtools
.
inspector
.
activeSidebar
"
)
;
Services
.
prefs
.
setCharPref
(
"
devtools
.
inspector
.
activeSidebar
"
"
layoutview
"
)
;
await
new
Promise
(
resolve
=
>
{
messageManager
.
addMessageListener
(
"
setup
-
test
-
done
"
resolve
)
;
const
NODES
=
5000
;
const
GRID_NODES
=
10
;
messageManager
.
loadFrameScript
(
"
data
:
(
"
+
encodeURIComponent
(
function
(
)
{
let
div
=
content
.
document
.
createElement
(
"
div
"
)
;
div
.
innerHTML
=
new
Array
(
{
NODES
}
)
.
join
(
"
<
div
>
<
/
div
>
"
)
+
new
Array
(
{
GRID_NODES
}
)
.
join
(
"
<
div
style
=
'
display
:
grid
'
>
<
/
div
>
"
)
;
content
.
document
.
body
.
appendChild
(
div
)
;
sendSyncMessage
(
"
setup
-
test
-
done
"
)
;
}
)
+
"
)
(
)
"
false
)
;
}
)
;
let
test
=
runTest
(
"
inspector
.
layout
.
open
"
)
;
await
openToolbox
(
"
inspector
"
)
;
test
.
done
(
)
;
await
closeToolbox
(
)
;
Services
.
prefs
.
setCharPref
(
"
devtools
.
inspector
.
activeSidebar
"
sidebarTab
)
;
await
testTeardown
(
)
;
}
;
