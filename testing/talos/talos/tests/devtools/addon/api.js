"
use
strict
"
;
this
.
damp
=
class
extends
ExtensionAPI
{
getAPI
(
context
)
{
return
{
damp
:
{
startTest
(
)
{
dump
(
"
[
damp
-
api
]
Retrieve
the
main
DevTools
loader
\
n
"
)
;
const
{
loader
require
}
=
ChromeUtils
.
importESModule
(
"
resource
:
/
/
devtools
/
shared
/
loader
/
Loader
.
sys
.
mjs
"
)
;
const
{
rootURI
}
=
context
.
extension
;
const
dampRootDir
=
rootURI
.
QueryInterface
(
Ci
.
nsIFileURL
)
;
const
protocolHandler
=
Services
.
io
.
getProtocolHandler
(
"
resource
"
)
.
QueryInterface
(
Ci
.
nsIResProtocolHandler
)
;
protocolHandler
.
setSubstitution
(
"
damp
-
test
"
dampRootDir
)
;
loader
.
loader
.
globals
.
dampWindow
=
context
.
appWindow
;
loader
.
loader
.
globals
.
fetch
=
context
.
appWindow
.
fetch
;
dump
(
"
[
damp
-
api
]
Retrieve
the
DAMP
runner
and
start
the
test
\
n
"
)
;
const
{
damp
}
=
require
(
"
damp
-
test
/
damp
"
)
;
return
damp
.
startTest
(
)
;
}
}
}
;
}
}
;
