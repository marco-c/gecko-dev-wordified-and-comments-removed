import
time
from
firefox_puppeteer
import
PuppeteerMixin
from
marionette_driver
import
By
expected
Wait
from
marionette_driver
.
errors
import
MarionetteException
from
marionette_harness
import
MarionetteTestCase
class
TestSSLDisabledErrorPage
(
PuppeteerMixin
MarionetteTestCase
)
:
    
def
setUp
(
self
)
:
        
super
(
TestSSLDisabledErrorPage
self
)
.
setUp
(
)
        
self
.
url
=
'
https
:
/
/
tls
-
v1
-
0
.
badssl
.
com
:
1010
'
        
self
.
puppeteer
.
utils
.
sanitize
(
{
"
sessions
"
:
True
}
)
        
self
.
marionette
.
set_pref
(
'
security
.
tls
.
version
.
min
'
3
)
        
self
.
marionette
.
set_pref
(
'
security
.
tls
.
version
.
max
'
3
)
    
def
tearDown
(
self
)
:
        
try
:
            
self
.
marionette
.
clear_pref
(
'
security
.
tls
.
version
.
min
'
)
            
self
.
marionette
.
clear_pref
(
'
security
.
tls
.
version
.
max
'
)
        
finally
:
            
super
(
TestSSLDisabledErrorPage
self
)
.
tearDown
(
)
    
def
test_ssl_disabled_error_page
(
self
)
:
        
with
self
.
marionette
.
using_context
(
'
content
'
)
:
            
self
.
assertRaises
(
MarionetteException
self
.
marionette
.
navigate
self
.
url
)
            
time
.
sleep
(
1
)
            
title
=
self
.
marionette
.
find_element
(
By
.
CLASS_NAME
'
title
-
text
'
)
            
nss_failure2title
=
self
.
browser
.
localize_entity
(
'
nssFailure2
.
title
'
)
            
self
.
assertEquals
(
title
.
get_property
(
'
textContent
'
)
nss_failure2title
)
            
short_description
=
self
.
marionette
.
find_element
(
By
.
ID
'
errorShortDescText
'
)
            
self
.
assertIn
(
'
SSL_ERROR_UNSUPPORTED_VERSION
'
                          
short_description
.
get_property
(
'
textContent
'
)
)
            
reset_button
=
self
.
marionette
.
find_element
(
By
.
ID
'
prefResetButton
'
)
            
reset_button
.
click
(
)
            
el
=
Wait
(
self
.
marionette
timeout
=
self
.
marionette
.
timeout
.
page_load
)
.
until
(
                
expected
.
element_present
(
By
.
TAG_NAME
'
h1
'
)
)
            
self
.
assertIn
(
'
tls
-
v1
-
0
'
el
.
get_property
(
'
innerText
'
)
)
