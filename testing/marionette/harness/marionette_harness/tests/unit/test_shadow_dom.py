from
marionette_driver
.
by
import
By
from
marionette_driver
.
errors
import
(
    
NoSuchElementException
    
StaleElementException
)
from
marionette_harness
import
MarionetteTestCase
class
TestShadowDom
(
MarionetteTestCase
)
:
    
def
setUp
(
self
)
:
        
MarionetteTestCase
.
setUp
(
self
)
        
self
.
marionette
.
enforce_gecko_prefs
(
{
"
dom
.
webcomponents
.
enabled
"
:
True
}
)
        
self
.
marionette
.
navigate
(
self
.
marionette
.
absolute_url
(
"
test_shadow_dom
.
html
"
)
)
        
self
.
host
=
self
.
marionette
.
find_element
(
By
.
ID
"
host
"
)
        
self
.
marionette
.
switch_to_shadow_root
(
self
.
host
)
        
self
.
button
=
self
.
marionette
.
find_element
(
By
.
ID
"
button
"
)
    
def
test_shadow_dom
(
self
)
:
        
self
.
button
.
click
(
)
    
def
test_shadow_dom_after_switch_away_from_shadow_root
(
self
)
:
        
self
.
button
.
click
(
)
        
self
.
marionette
.
switch_to_shadow_root
(
)
        
self
.
assertRaises
(
StaleElementException
self
.
button
.
click
)
    
def
test_shadow_dom_raises_stale_element_exception_when_button_remove
(
self
)
:
        
self
.
marionette
.
execute_script
(
            
'
document
.
getElementById
(
"
host
"
)
.
shadowRoot
.
getElementById
(
"
button
"
)
.
remove
(
)
;
'
)
        
self
.
assertRaises
(
StaleElementException
self
.
button
.
click
)
    
def
test_shadow_dom_raises_stale_element_exception_when_host_removed
(
self
)
:
        
self
.
marionette
.
execute_script
(
'
document
.
getElementById
(
"
host
"
)
.
remove
(
)
;
'
)
        
self
.
assertRaises
(
StaleElementException
self
.
button
.
click
)
    
def
test_non_existent_shadow_dom
(
self
)
:
        
self
.
marionette
.
switch_to_shadow_root
(
)
        
self
.
assertRaises
(
NoSuchElementException
self
.
marionette
.
switch_to_shadow_root
                          
self
.
marionette
.
find_element
(
By
.
ID
"
empty
-
host
"
)
)
    
def
test_inner_shadow_dom
(
self
)
:
        
self
.
button
.
click
(
)
        
self
.
inner_host
=
self
.
marionette
.
find_element
(
By
.
ID
"
inner
-
host
"
)
        
self
.
marionette
.
switch_to_shadow_root
(
self
.
inner_host
)
        
self
.
inner_button
=
self
.
marionette
.
find_element
(
By
.
ID
"
inner
-
button
"
)
        
self
.
inner_button
.
click
(
)
        
self
.
marionette
.
switch_to_shadow_root
(
)
        
self
.
button
.
click
(
)
        
self
.
assertRaises
(
StaleElementException
self
.
inner_button
.
click
)
        
self
.
marionette
.
switch_to_shadow_root
(
)
        
self
.
assertRaises
(
StaleElementException
self
.
button
.
click
)
        
self
.
assertRaises
(
StaleElementException
self
.
inner_button
.
click
)
