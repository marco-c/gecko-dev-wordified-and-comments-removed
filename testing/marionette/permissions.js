"
use
strict
"
;
const
EXPORTED_SYMBOLS
=
[
"
permissions
"
]
;
const
{
Services
}
=
ChromeUtils
.
import
(
"
resource
:
/
/
gre
/
modules
/
Services
.
jsm
"
)
;
const
{
XPCOMUtils
}
=
ChromeUtils
.
import
(
"
resource
:
/
/
gre
/
modules
/
XPCOMUtils
.
jsm
"
)
;
XPCOMUtils
.
defineLazyModuleGetters
(
this
{
error
:
"
chrome
:
/
/
marionette
/
content
/
error
.
js
"
MarionettePrefs
:
"
chrome
:
/
/
marionette
/
content
/
prefs
.
js
"
}
)
;
this
.
permissions
=
{
}
;
permissions
.
set
=
function
(
descriptor
state
oneRealm
)
{
if
(
!
MarionettePrefs
.
setPermissionEnabled
)
{
throw
new
error
.
UnsupportedOperationError
(
"
'
Set
Permission
'
is
not
available
"
)
;
}
const
{
name
}
=
descriptor
;
if
(
!
[
"
clipboard
-
write
"
"
clipboard
-
read
"
]
.
includes
(
name
)
)
{
throw
new
error
.
UnsupportedOperationError
(
'
Set
Permission
'
doesn
'
t
support
'
{
name
}
'
)
;
}
if
(
state
=
=
=
"
prompt
"
)
{
throw
new
error
.
UnsupportedOperationError
(
"
'
Set
Permission
'
doesn
'
t
support
prompt
"
)
;
}
if
(
!
Services
.
prefs
.
getBoolPref
(
"
dom
.
events
.
testing
.
asyncClipboard
"
false
)
)
{
throw
new
error
.
UnsupportedOperationError
(
"
'
Set
Permission
'
expected
dom
.
events
.
testing
.
asyncClipboard
to
be
set
"
)
;
}
}
;
