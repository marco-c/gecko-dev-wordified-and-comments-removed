function
_defineProperty
(
obj
key
value
)
{
if
(
key
in
obj
)
{
Object
.
defineProperty
(
obj
key
{
value
:
value
enumerable
:
true
configurable
:
true
writable
:
true
}
)
;
}
else
{
obj
[
key
]
=
value
;
}
return
obj
;
}
export
class
AsyncMutex
{
constructor
(
)
{
_defineProperty
(
this
"
newestQueueItem
"
void
0
)
;
}
async
with
(
fn
)
{
const
p
=
(
async
(
)
=
>
{
if
(
this
.
newestQueueItem
)
{
await
this
.
newestQueueItem
;
}
return
fn
(
)
;
}
)
(
)
;
this
.
newestQueueItem
=
p
;
return
p
;
}
}
