class
ActiveProcessingTester
extends
AudioWorkletProcessor
{
constructor
(
options
)
{
super
(
options
)
;
this
.
_lastChannelCount
=
0
;
if
(
options
.
hasOwnProperty
(
'
processorOptions
'
)
&
&
options
.
processorOptions
.
hasOwnProperty
(
'
testDuration
'
)
)
{
this
.
_testDuration
=
options
.
processorOptions
.
testDuration
;
}
else
{
this
.
_testDuration
=
5
;
}
this
.
_endTime
=
currentTime
+
this
.
_testDuration
;
}
process
(
inputs
outputs
)
{
const
input
=
inputs
[
0
]
;
const
output
=
outputs
[
0
]
;
const
inputChannelCount
=
input
.
length
;
const
isFinished
=
currentTime
>
this
.
_endTime
;
if
(
isFinished
|
|
(
inputChannelCount
!
=
this
.
_lastChannelCount
)
)
{
this
.
port
.
postMessage
(
{
channelCount
:
inputChannelCount
finished
:
isFinished
time
:
currentTime
}
)
;
this
.
_lastChannelCount
=
inputChannelCount
;
}
for
(
let
channel
=
0
;
channel
<
input
.
length
;
+
+
channel
)
{
output
[
channel
]
.
set
(
input
[
channel
]
)
;
}
return
!
isFinished
;
}
}
registerProcessor
(
'
active
-
processing
-
tester
'
ActiveProcessingTester
)
;
