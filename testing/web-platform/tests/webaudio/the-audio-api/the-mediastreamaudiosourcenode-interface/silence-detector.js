class
SilenceDetector
extends
AudioWorkletProcessor
{
constructor
(
)
{
super
(
)
;
this
.
isSilent
=
true
;
this
.
hasInput
=
false
;
}
process
(
inputs
outputs
parameters
)
{
const
input
=
inputs
[
0
]
;
const
currentHasInput
=
input
&
&
input
.
length
>
0
;
let
isCurrentlySilent
=
true
;
if
(
currentHasInput
)
{
const
channel
=
input
[
0
]
;
for
(
let
i
=
0
;
i
<
channel
.
length
;
i
+
+
)
{
if
(
channel
[
i
]
!
=
=
0
)
{
isCurrentlySilent
=
false
;
break
;
}
}
}
const
hasInputChanged
=
this
.
hasInput
!
=
=
currentHasInput
;
const
isSilentChanged
=
this
.
isSilent
!
=
=
isCurrentlySilent
;
this
.
hasInput
=
currentHasInput
;
this
.
isSilent
=
isCurrentlySilent
;
if
(
hasInputChanged
|
|
isSilentChanged
)
{
this
.
port
.
postMessage
(
{
type
:
"
stateChanged
"
isSilent
:
this
.
isSilent
hasInput
:
this
.
hasInput
hasInputChanged
:
hasInputChanged
isSilentChanged
:
isSilentChanged
}
)
;
}
return
currentHasInput
;
}
}
registerProcessor
(
"
silence
-
detector
"
SilenceDetector
)
;
