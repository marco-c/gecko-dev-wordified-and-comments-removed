function
trusted_click
(
container
=
document
.
body
)
{
var
document
=
container
.
ownerDocument
;
var
button
=
document
.
createElement
(
"
button
"
)
;
button
.
textContent
=
"
click
to
continue
test
"
;
button
.
style
.
display
=
"
block
"
;
button
.
style
.
fontSize
=
"
20px
"
;
button
.
style
.
padding
=
"
10px
"
;
button
.
addEventListener
(
"
click
"
(
)
=
>
{
button
.
remove
(
)
;
}
)
;
container
.
appendChild
(
button
)
;
return
Promise
.
race
(
[
test_driver
.
click
(
button
)
new
Promise
(
(
resolve
)
=
>
{
button
.
addEventListener
(
"
click
"
resolve
)
;
}
)
]
)
;
}
async
function
trusted_request
(
element
=
document
.
body
whereToCreateButton
=
null
)
{
await
trusted_click
(
whereToCreateButton
?
?
element
.
parentNode
?
?
element
)
;
return
element
.
requestFullscreen
(
)
;
}
function
fullScreenChange
(
target
=
document
)
{
return
new
Promise
(
(
resolve
)
=
>
target
.
addEventListener
(
"
fullscreenchange
"
resolve
{
once
:
true
}
)
)
;
}
function
promiseMessage
(
iframe
)
{
return
new
Promise
(
(
resolve
)
=
>
{
window
.
addEventListener
(
"
message
"
(
e
)
=
>
{
if
(
e
.
data
?
.
report
.
api
=
=
=
"
fullscreen
"
)
{
resolve
(
e
.
data
)
;
}
}
{
once
:
true
}
)
;
iframe
.
contentWindow
.
postMessage
(
{
action
:
"
report
"
}
"
*
"
)
;
}
)
;
}
