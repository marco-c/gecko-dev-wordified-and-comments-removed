const
url_base
=
"
/
feature
-
policy
/
experimental
-
features
/
resources
/
"
;
window
.
messageResponseCallback
=
null
;
function
setFeatureState
(
iframe
feature
origins
)
{
iframe
.
setAttribute
(
"
allow
"
{
feature
}
{
origins
}
;
)
;
}
function
loadUrlInIframe
(
iframe
url
)
{
return
new
Promise
(
(
resolve
)
=
>
{
iframe
.
addEventListener
(
"
load
"
resolve
)
;
iframe
.
src
=
url
;
}
)
;
}
function
sendMessageAndGetResponse
(
target
message
)
{
return
new
Promise
(
(
resolve
)
=
>
{
window
.
messageResponseCallback
=
resolve
;
target
.
postMessage
(
message
"
*
"
)
;
}
)
;
}
function
onMessage
(
e
)
{
if
(
window
.
messageResponseCallback
)
{
window
.
messageResponseCallback
(
e
.
data
)
;
window
.
messageResponseCallback
=
null
;
}
}
window
.
addEventListener
(
"
message
"
onMessage
)
;
function
waitForMessageOrTimeout
(
t
id
load_timeout
)
{
return
new
Promise
(
(
resolve
)
=
>
{
window
.
addEventListener
(
"
message
"
(
e
)
=
>
{
if
(
!
e
.
data
|
|
e
.
data
.
id
!
=
=
id
)
return
;
resolve
(
e
.
data
.
contents
)
;
}
)
;
t
.
step_timeout
(
(
)
=
>
{
resolve
(
false
)
;
}
load_timeout
)
;
}
)
;
}
function
createIframe
(
container
attributes
)
{
var
new_iframe
=
document
.
createElement
(
"
iframe
"
)
;
for
(
attr_name
in
attributes
)
new_iframe
.
setAttribute
(
attr_name
attributes
[
attr_name
]
)
;
container
.
appendChild
(
new_iframe
)
;
return
new_iframe
;
}
function
wait_for_load
(
e
)
{
return
new
Promise
(
(
resolve
)
=
>
{
e
.
addEventListener
(
"
load
"
resolve
)
;
}
)
;
}
