const
numMillisecondsWait
=
50
;
const
numFramesWaiting
=
3
;
function
waitTime
(
t
)
{
return
new
Promise
(
resolve
=
>
t
.
step_timeout
(
resolve
numMillisecondsWait
)
)
;
}
function
waitForAnimationFrames
(
count
)
{
return
new
Promise
(
resolve
=
>
{
if
(
count
-
-
<
=
0
)
{
resolve
(
)
;
}
else
{
requestAnimationFrame
(
(
)
=
>
{
waitForAnimationFrames
(
count
)
.
then
(
resolve
)
;
}
)
;
}
}
)
;
}
function
assertNoFirstContentfulPaint
(
t
)
{
return
waitTime
(
t
)
.
then
(
(
)
=
>
{
return
waitForAnimationFrames
(
numFramesWaiting
)
;
}
)
.
then
(
(
)
=
>
{
return
new
Promise
(
(
resolve
reject
)
=
>
{
const
observer
=
new
PerformanceObserver
(
entryList
=
>
{
const
entries
=
entryList
.
getEntriesByName
(
'
first
-
contentful
-
paint
'
)
;
observer
.
disconnect
(
)
;
if
(
entries
.
length
>
0
)
reject
(
'
Received
a
first
contentful
paint
entry
.
'
)
;
else
resolve
(
)
;
}
)
;
observer
.
observe
(
{
type
:
'
paint
'
buffered
:
true
}
)
;
observer
.
observe
(
{
type
:
'
mark
'
}
)
;
performance
.
mark
(
'
flush
'
)
;
}
)
;
}
)
;
}
function
assertFirstContentfulPaint
(
t
)
{
return
waitTime
(
t
)
.
then
(
(
)
=
>
{
return
waitForAnimationFrames
(
numFramesWaiting
)
;
}
)
.
then
(
(
)
=
>
{
return
new
Promise
(
(
resolve
reject
)
=
>
{
const
observer
=
new
PerformanceObserver
(
entryList
=
>
{
const
entries
=
entryList
.
getEntriesByName
(
'
first
-
contentful
-
paint
'
)
;
observer
.
disconnect
(
)
;
if
(
entries
.
length
=
=
=
0
)
reject
(
'
Did
not
receive
a
first
contentful
paint
entry
.
'
)
;
else
{
resolve
(
)
;
}
}
)
;
observer
.
observe
(
{
type
:
'
paint
'
buffered
:
true
}
)
;
observer
.
observe
(
{
type
:
'
mark
'
}
)
;
performance
.
mark
(
'
flush
'
)
;
}
)
;
}
)
;
}
