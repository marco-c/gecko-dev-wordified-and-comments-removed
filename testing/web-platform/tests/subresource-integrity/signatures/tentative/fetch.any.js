function
resourceURL
(
data
)
{
let
params
=
new
URLSearchParams
(
data
)
;
return
"
.
/
resource
.
py
?
"
+
params
.
toString
(
)
;
}
promise_test
(
test
=
>
{
const
data
=
{
body
:
{
"
hello
"
:
"
world
"
}
}
;
return
fetch
(
resourceURL
(
data
)
)
.
then
(
r
=
>
{
assert_equals
(
r
.
status
200
"
Response
status
is
200
.
"
)
;
}
)
;
}
"
No
signature
:
loads
.
"
)
;
promise_test
(
test
=
>
{
const
data
=
{
body
:
{
"
hello
"
:
"
world
"
}
digest
:
sha
-
256
=
:
X48E9qOokqqrvdts8nOJRJN3OWDUoyWxBf7kbu9DBPE
=
:
signature
:
signature
=
:
H7AqWWgo1DJ7VdyF9DKotG
/
4hvatKDfRTq2mpuY
/
hvJupSn
+
EYzus5p24qPK7DtVQcxJFhzSYDj4RBq9grZTAQ
=
=
:
signatureInput
:
signature
=
(
"
identity
-
digest
"
;
sf
)
;
alg
=
"
ed25519
"
;
keyid
=
"
JrQLj5P
/
89iXES9
+
vFgrIy29clF9CC
/
oPPsw3c5D0bs
=
"
;
tag
=
"
sri
"
}
;
return
fetch
(
resourceURL
(
data
)
)
.
then
(
r
=
>
{
assert_equals
(
r
.
status
200
"
Response
status
is
200
.
"
)
;
}
)
;
}
"
Valid
signature
:
loads
.
"
)
;
promise_test
(
test
=
>
{
const
data
=
{
body
:
{
"
hello
"
:
"
world
"
}
digest
:
sha
-
256
=
:
X48E9qOokqqrvdts8nOJRJN3OWDUoyWxBf7kbu9DBPE
=
:
signature
:
signature
=
:
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
=
=
:
signatureInput
:
signature
=
(
"
identity
-
digest
"
;
sf
)
;
alg
=
"
ed25519
"
;
keyid
=
"
JrQLj5P
/
89iXES9
+
vFgrIy29clF9CC
/
oPPsw3c5D0bs
=
"
;
tag
=
"
sri
"
}
;
return
promise_rejects_js
(
test
TypeError
fetch
(
resourceURL
(
data
)
)
)
;
}
"
Non
-
matching
signature
:
blocked
.
"
)
;
