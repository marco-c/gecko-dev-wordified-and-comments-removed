const
JITTER_ALLOWANCE_MS
=
200
;
const
MESSAGE_SIZE
=
8
*
1024
*
1024
;
promise_test
(
async
t
=
>
{
const
wss
=
new
WebSocketStream
(
{
BASEURL
}
/
receive
-
backpressure
)
;
const
{
writable
}
=
await
wss
.
connection
;
const
writer
=
writable
.
getWriter
(
)
;
const
start
=
performance
.
now
(
)
;
await
writer
.
write
(
new
Uint8Array
(
MESSAGE_SIZE
)
)
;
const
elapsed
=
performance
.
now
(
)
-
start
;
assert_greater_than_equal
(
elapsed
2000
-
JITTER_ALLOWANCE_MS
)
;
}
'
backpressure
should
be
applied
to
sent
messages
'
)
;
