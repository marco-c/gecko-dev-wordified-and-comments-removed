'
use
strict
'
;
function
waitForDocumentReady
(
)
{
return
new
Promise
(
resolve
=
>
{
if
(
document
.
readyState
=
=
=
'
complete
'
)
{
resolve
(
)
;
}
window
.
addEventListener
(
'
load
'
(
)
=
>
{
resolve
(
)
;
}
{
once
:
true
}
)
;
}
)
;
}
async
function
callWithTrustedClick
(
callback
)
{
await
waitForDocumentReady
(
)
;
return
new
Promise
(
resolve
=
>
{
let
button
=
document
.
createElement
(
'
button
'
)
;
button
.
textContent
=
'
click
to
continue
test
'
;
button
.
style
.
display
=
'
block
'
;
button
.
style
.
fontSize
=
'
20px
'
;
button
.
style
.
padding
=
'
10px
'
;
button
.
onclick
=
(
)
=
>
{
document
.
body
.
removeChild
(
button
)
;
resolve
(
callback
(
)
)
;
}
;
document
.
body
.
appendChild
(
button
)
;
test_driver
.
click
(
button
)
;
}
)
;
}
function
selectFirstDeviceOnDevicePromptUpdated
(
)
{
return
test_driver
.
bidi
.
bluetooth
.
request_device_prompt_updated
.
once
(
)
.
then
(
(
promptEvent
)
=
>
{
assert_greater_than_equal
(
promptEvent
.
devices
.
length
0
)
;
return
test_driver
.
bidi
.
bluetooth
.
handle_request_device_prompt
(
{
prompt
:
promptEvent
.
prompt
accept
:
true
device
:
promptEvent
.
devices
[
0
]
.
id
}
)
;
}
)
;
}
function
requestDeviceWithTrustedClick
(
.
.
.
args
)
{
return
callWithTrustedClick
(
(
)
=
>
navigator
.
bluetooth
.
requestDevice
(
.
.
.
args
)
)
;
}
