promise_test
(
async
t
=
>
{
const
wt
=
new
WebTransport
(
webtransport_url
(
'
echo
.
py
'
)
)
;
await
wt
.
ready
;
const
numBytes
=
1024
*
1024
;
const
numStreams
=
5
;
for
(
let
i
=
0
;
i
<
numStreams
;
i
+
+
)
{
const
stream
=
await
wt
.
createBidirectionalStream
(
)
;
const
writer
=
stream
.
writable
.
getWriter
(
)
;
await
writer
.
write
(
new
Uint8Array
(
numBytes
)
)
;
await
writer
.
close
(
)
;
const
response
=
await
(
new
Response
(
stream
.
readable
)
.
arrayBuffer
(
)
)
;
assert_equals
(
response
.
byteLength
numBytes
)
;
}
}
'
Ensure
large
bidirectional
streams
does
not
cause
race
condition
'
)
;
