import
asyncio
import
signal
import
websockets
async
def
echo
(
websocket
path
)
:
    
async
for
message
in
websocket
:
        
await
websocket
.
send
(
message
)
async
def
echo_server
(
stop
)
:
    
async
with
websockets
.
serve
(
echo
"
localhost
"
8765
)
:
        
await
stop
loop
=
asyncio
.
get_event_loop
(
)
stop
=
loop
.
create_future
(
)
loop
.
add_signal_handler
(
signal
.
SIGTERM
stop
.
set_result
None
)
loop
.
run_until_complete
(
echo_server
(
stop
)
)
