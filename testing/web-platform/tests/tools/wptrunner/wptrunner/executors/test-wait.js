const
initialized
=
!
!
window
.
__wptrunner_url
;
window
.
__wptrunner_testdriver_callback
=
arguments
[
arguments
.
length
-
1
]
;
window
.
__wptrunner_url
=
arguments
.
length
>
1
?
arguments
[
0
]
:
location
.
href
;
var
observer
=
null
;
var
root
=
document
.
documentElement
;
function
wait_load
(
)
{
if
(
Document
.
prototype
.
hasOwnProperty
(
"
fonts
"
)
)
{
document
.
fonts
.
ready
.
then
(
wait_paints
)
;
}
else
{
wait_paints
(
)
;
}
}
function
wait_paints
(
)
{
requestAnimationFrame
(
function
(
)
{
requestAnimationFrame
(
function
(
)
{
screenshot_if_ready
(
)
;
}
)
;
}
)
;
}
function
screenshot_if_ready
(
)
{
if
(
root
&
&
root
.
classList
.
contains
(
"
%
(
classname
)
s
"
)
)
{
if
(
observer
=
=
=
null
)
{
observer
=
new
MutationObserver
(
wait_paints
)
;
observer
.
observe
(
root
{
attributes
:
true
}
)
;
var
event
=
new
Event
(
"
TestRendered
"
{
bubbles
:
true
}
)
;
root
.
dispatchEvent
(
event
)
;
}
return
;
}
if
(
observer
!
=
=
null
)
{
observer
.
disconnect
(
)
;
}
if
(
window
.
__wptrunner_message_queue
)
{
__wptrunner_message_queue
.
push
(
{
type
:
"
complete
"
}
)
;
}
else
{
__wptrunner_testdriver_callback
(
[
__wptrunner_url
"
complete
"
[
]
]
)
;
}
}
if
(
!
initialized
)
{
if
(
document
.
readyState
!
=
"
complete
"
)
{
addEventListener
(
'
load
'
wait_load
{
once
:
true
}
)
;
}
else
{
wait_load
(
)
;
}
}
if
(
window
.
__wptrunner_process_next_event
)
{
window
.
__wptrunner_process_next_event
(
)
;
}
