var
callback
=
arguments
[
arguments
.
length
-
1
]
;
function
root_wait
(
)
{
if
(
!
root
.
classList
.
contains
(
"
reftest
-
wait
"
)
)
{
observer
.
disconnect
(
)
;
if
(
Document
.
prototype
.
hasOwnProperty
(
"
fonts
"
)
)
{
document
.
fonts
.
ready
.
then
(
ready_for_screenshot
)
;
}
else
{
ready_for_screenshot
(
)
;
}
}
}
function
ready_for_screenshot
(
)
{
requestAnimationFrame
(
function
(
)
{
requestAnimationFrame
(
function
(
)
{
callback
(
)
;
}
)
;
}
)
;
}
var
root
=
document
.
documentElement
;
var
observer
=
new
MutationObserver
(
root_wait
)
;
observer
.
observe
(
root
{
attributes
:
true
}
)
;
if
(
document
.
readyState
!
=
"
complete
"
)
{
onload
=
root_wait
;
}
else
{
root_wait
(
)
;
}
