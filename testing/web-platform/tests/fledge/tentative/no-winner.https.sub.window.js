"
use
strict
;
"
const
COMMON_SCRIPT_ERRORS
=
[
'
error
=
close
-
connection
'
'
error
=
http
-
error
'
'
error
=
no
-
content
-
type
'
'
error
=
wrong
-
content
-
type
'
'
error
=
bad
-
allow
-
fledge
'
'
error
=
fledge
-
not
-
allowed
'
'
error
=
no
-
allow
-
fledge
'
'
error
=
no
-
body
'
]
;
const
BIDDING_LOGIC_SCRIPT_ERRORS
=
[
.
.
.
COMMON_SCRIPT_ERRORS
'
error
=
no
-
generateBid
'
'
generateBid
=
throw
1
;
'
'
generateBid
=
This
does
not
compile
'
'
generateBid
=
while
(
1
)
;
'
'
generateBid
=
return
5
;
'
'
generateBid
=
return
"
Foo
"
;
'
'
generateBid
=
return
interestGroup
.
ads
[
0
]
.
renderURL
;
'
'
generateBid
=
return
{
bid
:
1
render
:
"
https
:
/
/
not
-
in
-
ads
-
array
.
test
/
"
}
;
'
'
generateBid
=
return
{
bid
:
1
}
;
'
'
generateBid
=
return
{
render
:
interestGroup
.
ads
[
0
]
.
renderURL
}
;
'
'
generateBid
=
return
{
bid
:
0
render
:
interestGroup
.
ads
[
0
]
.
renderURL
}
;
'
'
generateBid
=
return
{
bid
:
-
1
render
:
interestGroup
.
ads
[
0
]
.
renderURL
}
;
'
]
;
const
DECISION_LOGIC_SCRIPT_ERRORS
=
[
.
.
.
COMMON_SCRIPT_ERRORS
'
error
=
no
-
scoreAd
'
'
scoreAd
=
throw
1
;
'
'
scoreAd
=
This
does
not
compile
'
'
scoreAd
=
while
(
1
)
;
'
'
scoreAd
=
return
"
Foo
"
;
'
'
scoreAd
=
return
{
desirability
:
"
Foo
"
}
;
'
'
scoreAd
=
return
0
;
'
'
scoreAd
=
return
-
1
;
'
'
scoreAd
=
return
{
desirability
:
0
}
;
'
'
scoreAd
=
return
{
desirability
:
-
1
}
;
'
]
;
for
(
error
of
BIDDING_LOGIC_SCRIPT_ERRORS
)
{
subsetTest
(
promise_test
(
async
(
error
test
)
=
>
{
let
biddingLogicURL
=
{
BASE_URL
}
resources
/
bidding
-
logic
.
sub
.
py
?
{
error
}
;
await
joinGroupAndRunBasicFledgeTestExpectingNoWinner
(
test
{
interestGroupOverrides
:
{
biddingLogicURL
:
biddingLogicURL
}
}
)
;
}
)
.
bind
(
undefined
error
)
Bidding
logic
script
:
{
error
}
)
;
}
for
(
error
of
DECISION_LOGIC_SCRIPT_ERRORS
)
{
subsetTest
(
promise_test
(
async
(
error
test
)
=
>
{
let
decisionLogicURL
=
{
BASE_URL
}
resources
/
decision
-
logic
.
sub
.
py
?
{
error
}
;
await
joinGroupAndRunBasicFledgeTestExpectingNoWinner
(
test
{
auctionConfigOverrides
:
{
decisionLogicURL
:
decisionLogicURL
}
}
)
;
}
)
.
bind
(
undefined
error
)
Decision
logic
script
:
{
error
}
)
;
}
