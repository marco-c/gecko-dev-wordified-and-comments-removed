import
os
from
wptserve
.
utils
import
isomorphic_decode
def
main
(
request
response
)
:
  
if
b
"
increment
"
in
request
.
GET
:
    
uuid
=
request
.
GET
[
b
"
increment
"
]
    
stash_value
=
request
.
server
.
stash
.
take
(
uuid
)
    
if
stash_value
is
None
:
      
stash_value
=
0
    
request
.
server
.
stash
.
put
(
uuid
stash_value
+
1
)
    
response_headers
=
[
(
b
"
Content
-
Type
"
b
"
image
/
png
"
)
]
    
image_path
=
os
.
path
.
join
(
os
.
path
.
dirname
(
isomorphic_decode
(
__file__
)
)
u
"
image
.
png
"
)
    
return
(
200
response_headers
open
(
image_path
mode
=
'
rb
'
)
.
read
(
)
)
  
elif
b
"
read
"
in
request
.
GET
:
    
uuid
=
request
.
GET
[
b
"
read
"
]
    
stash_value
=
request
.
server
.
stash
.
take
(
uuid
)
    
if
stash_value
is
None
:
      
stash_value
=
0
    
request
.
server
.
stash
.
put
(
uuid
stash_value
)
;
    
return
(
200
[
]
str
(
stash_value
)
)
  
return
(
404
[
]
"
Not
found
"
)
