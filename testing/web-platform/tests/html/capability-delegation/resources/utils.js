function
getMessageData
(
message_data_type
source
)
{
return
new
Promise
(
resolve
=
>
{
function
waitAndRemove
(
e
)
{
if
(
e
.
source
!
=
source
|
|
!
e
.
data
|
|
e
.
data
.
type
!
=
message_data_type
)
return
;
window
.
removeEventListener
(
"
message
"
waitAndRemove
)
;
resolve
(
e
.
data
)
;
}
window
.
addEventListener
(
"
message
"
waitAndRemove
)
;
}
)
;
}
async
function
postCapabilityDelegationMessage
(
frame
message
origin
capability
activate
)
{
let
result_promise
=
getMessageData
(
"
result
"
frame
)
;
if
(
activate
)
await
test_driver
.
bless
(
)
;
frame
.
postMessage
(
message
{
targetOrigin
:
origin
delegate
:
capability
}
)
;
return
await
result_promise
;
}
