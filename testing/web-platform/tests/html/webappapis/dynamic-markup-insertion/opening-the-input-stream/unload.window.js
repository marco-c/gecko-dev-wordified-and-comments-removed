async_test
(
t
=
>
{
const
frame
=
document
.
body
.
appendChild
(
document
.
createElement
(
"
iframe
"
)
)
;
t
.
add_cleanup
(
(
)
=
>
frame
.
remove
(
)
)
;
frame
.
src
=
"
/
common
/
blank
.
html
"
;
frame
.
onload
=
t
.
step_func
(
(
)
=
>
{
frame
.
contentWindow
.
onpagehide
=
t
.
unreached_func
(
"
onpagehide
got
called
"
)
;
frame
.
contentDocument
.
onvisibilitychange
=
t
.
unreached_func
(
"
onvisibilitychange
got
called
"
)
;
frame
.
contentWindow
.
onunload
=
t
.
unreached_func
(
"
onunload
got
called
"
)
;
frame
.
contentDocument
.
open
(
)
;
t
.
step_timeout
(
t
.
step_func_done
(
(
)
=
>
{
}
)
500
)
;
}
)
;
}
"
document
.
open
(
)
:
Do
not
fire
pagehide
visibilitychange
or
unload
events
"
)
;
