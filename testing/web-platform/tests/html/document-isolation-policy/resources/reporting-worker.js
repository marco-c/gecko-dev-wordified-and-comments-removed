function
run
(
{
script
port
}
)
{
const
observer
=
new
ReportingObserver
(
(
rs
)
=
>
{
for
(
const
r
of
rs
)
{
port
.
postMessage
(
r
.
toJSON
(
)
)
;
}
}
)
;
observer
.
observe
(
)
;
eval
(
script
)
;
}
self
.
addEventListener
(
'
message
'
(
e
)
=
>
run
(
e
.
data
)
)
;
self
.
addEventListener
(
'
connect
'
(
e
)
=
>
{
e
.
ports
[
0
]
.
onmessage
=
(
ev
)
=
>
run
(
ev
.
data
)
;
}
)
;
