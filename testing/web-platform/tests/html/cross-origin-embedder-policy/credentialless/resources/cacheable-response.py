import
json
from
wptserve
.
utils
import
isomorphic_decode
def
main
(
request
response
)
:
    
response
.
headers
.
set
(
b
"
Cache
-
Control
"
b
"
max
-
age
=
31536000
"
)
;
    
uuid
=
request
.
GET
[
b
'
uuid
'
]
;
    
headers
=
{
}
;
    
for
key
value
in
request
.
headers
.
items
(
)
:
        
headers
[
isomorphic_decode
(
key
)
]
=
isomorphic_decode
(
request
.
headers
[
key
]
)
    
headers
=
json
.
dumps
(
headers
)
;
    
stash
=
request
.
server
.
stash
;
    
with
stash
.
lock
:
        
queue
=
stash
.
take
(
uuid
'
/
coep
-
credentialless
'
)
or
[
]
;
        
queue
.
append
(
headers
)
;
        
stash
.
put
(
uuid
queue
'
/
coep
-
credentialless
'
)
;
    
return
b
"
done
"
;
