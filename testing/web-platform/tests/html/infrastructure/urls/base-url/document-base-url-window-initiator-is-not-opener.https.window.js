const
runTest
=
(
description
)
=
>
{
const
opener_base_uri
=
document
.
baseURI
;
promise_test
(
(
test
)
=
>
{
return
new
Promise
(
async
resolve
=
>
{
window
.
popup
=
window
.
open
(
)
;
test
.
add_cleanup
(
(
)
=
>
popup
.
close
(
)
)
;
assert_equals
(
window
.
popup
.
location
.
href
'
about
:
blank
'
)
;
const
iframe
=
document
.
createElement
(
'
iframe
'
)
;
iframe
.
srcdoc
=
<
head
>
<
base
href
=
'
https
:
/
/
example
.
com
'
>
<
script
>
window
.
top
.
popup
.
location
.
href
=
'
about
:
blank
'
;
<
/
scr
+
ipt
>
<
/
head
>
<
body
>
<
/
body
>
;
const
popup_navigated
=
new
Promise
(
r
=
>
window
.
popup
.
onpagehide
=
e
=
>
r
(
)
)
;
document
.
body
.
append
(
iframe
)
;
await
popup_navigated
;
test
.
step_timeout
(
resolve
500
)
;
}
)
.
then
(
(
)
=
>
{
assert_equals
(
'
https
:
/
/
example
.
com
/
'
window
.
popup
.
document
.
baseURI
)
;
}
)
;
}
description
)
;
}
;
onload
=
(
)
=
>
{
runTest
(
"
window
.
open
(
)
gets
base
url
from
initiator
not
opener
.
"
)
;
}
;
