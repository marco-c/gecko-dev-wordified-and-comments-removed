'
use
strict
'
;
const
getElemCenterInIframe
=
(
element
iframe
)
=
>
{
const
elemClientRect
=
element
.
getBoundingClientRect
(
)
;
const
frameClientRect
=
iframe
.
getBoundingClientRect
(
)
;
const
centerX
=
frameClientRect
.
left
+
(
elemClientRect
.
left
+
elemClientRect
.
right
)
/
2
;
const
centerY
=
frameClientRect
.
top
+
(
elemClientRect
.
top
+
elemClientRect
.
bottom
)
/
2
;
return
[
centerX
centerY
]
;
}
;
const
movePointerToCenter
=
(
element
iframe
actions
)
=
>
{
return
(
iframe
=
=
undefined
)
?
actions
.
pointerMove
(
0
0
{
origin
:
element
}
)
:
actions
.
pointerMove
(
.
.
.
getElemCenterInIframe
(
element
iframe
)
)
}
function
dragDropTest
(
dragElement
dropElement
onDropCallBack
testDescription
iframe
=
undefined
)
{
promise_test
(
(
t
)
=
>
new
Promise
(
async
(
resolve
reject
)
=
>
{
dropElement
.
addEventListener
(
'
drop
'
t
.
step_func
(
(
event
)
=
>
{
if
(
onDropCallBack
(
event
)
=
=
true
)
{
resolve
(
)
;
}
else
{
reject
(
)
;
}
}
)
)
;
try
{
var
actions
=
new
test_driver
.
Actions
(
)
.
pointerMove
(
0
0
{
origin
:
dragElement
}
)
.
pointerDown
(
)
;
actions
=
movePointerToCenter
(
dropElement
iframe
actions
)
;
await
actions
.
pointerUp
(
)
.
send
(
)
;
}
catch
(
e
)
{
reject
(
e
)
;
}
}
testDescription
)
)
;
}
