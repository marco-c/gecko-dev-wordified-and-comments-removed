importScripts
(
"
/
resources
/
testharness
.
js
"
)
;
importScripts
(
"
/
html
/
canvas
/
resources
/
canvas
-
tests
.
js
"
)
;
var
t
=
async_test
(
"
test
display
-
p3
float16
canvas
storing
8
-
bit
srgb
data
accurately
"
)
;
var
t_pass
=
t
.
done
.
bind
(
t
)
;
var
t_fail
=
t
.
step_func
(
function
(
reason
)
{
throw
reason
;
}
)
;
t
.
step
(
function
(
)
{
var
canvas
=
new
OffscreenCanvas
(
100
50
)
;
var
ctx
=
canvas
.
getContext
(
'
2d
'
{
colorType
:
"
float16
"
colorSpace
:
"
display
-
p3
"
}
)
;
var
input
=
new
ImageData
(
new
Uint8ClampedArray
(
[
5
250
128
255
]
)
1
1
{
colorSpace
:
"
srgb
"
}
)
;
ctx
.
putImageData
(
input
0
0
)
;
var
readback
=
ctx
.
getImageData
(
0
0
1
1
{
colorSpace
:
"
srgb
"
}
)
;
const
kEpsilon
=
2
;
assert_approx_equals
(
readback
.
data
[
0
]
5
kEpsilon
)
;
assert_approx_equals
(
readback
.
data
[
1
]
250
kEpsilon
)
;
assert_approx_equals
(
readback
.
data
[
2
]
128
kEpsilon
)
;
t
.
done
(
)
;
}
)
;
done
(
)
;
