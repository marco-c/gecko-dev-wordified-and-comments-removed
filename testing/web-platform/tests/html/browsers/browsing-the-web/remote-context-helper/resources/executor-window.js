'
use
strict
'
;
let
executorStartEvent
=
null
;
function
requestExecutor
(
uuid
startOn
)
{
if
(
startOn
)
{
addEventListener
(
startOn
(
e
)
=
>
{
executorStartEvent
=
e
;
startExecutor
(
uuid
)
;
}
)
;
}
else
{
startExecutor
(
uuid
)
;
}
}
function
addScript
(
url
)
{
const
script
=
document
.
createElement
(
'
script
'
)
;
script
.
src
=
url
;
const
promise
=
new
Promise
(
(
resolve
reject
)
=
>
{
script
.
onload
=
(
)
=
>
resolve
(
url
)
;
script
.
onerror
=
(
e
)
=
>
reject
(
e
)
;
}
)
;
document
.
body
.
appendChild
(
script
)
;
return
promise
;
}
function
executeScriptToNavigate
(
fnString
args
)
{
const
controller
=
new
AbortController
(
)
;
window
.
addEventListener
(
'
pageshow
'
(
event
)
=
>
{
controller
.
abort
(
)
;
executor
.
resume
(
)
;
}
{
signal
:
controller
.
signal
once
:
true
}
)
;
window
.
addEventListener
(
'
hashchange
'
(
event
)
=
>
{
controller
.
abort
(
)
;
const
oldURLObject
=
new
URL
(
event
.
oldURL
)
;
const
newURLObject
=
new
URL
(
event
.
newURL
)
;
oldURLObject
.
hash
=
'
'
;
newURLObject
.
hash
=
'
'
;
if
(
oldURLObject
.
toString
(
)
=
=
newURLObject
.
toString
(
)
)
{
executor
.
resume
(
)
;
}
}
{
signal
:
controller
.
signal
once
:
true
}
)
;
executor
.
suspend
(
(
)
=
>
{
eval
(
fnString
)
.
apply
(
null
args
)
;
}
)
;
}
