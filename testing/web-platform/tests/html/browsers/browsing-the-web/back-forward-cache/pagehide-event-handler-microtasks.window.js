'
use
strict
'
;
promise_test
(
async
t
=
>
{
const
uuid
=
token
(
)
;
const
url
=
remoteExecutorUrl
(
uuid
{
protocol
:
'
http
:
'
}
)
;
const
win
=
window
.
open
(
url
'
_blank
'
'
noopener
'
)
;
const
context
=
new
RemoteContext
(
uuid
)
;
const
{
persisted
}
=
await
context
.
execute_script
(
(
)
=
>
new
Promise
(
resolve
=
>
{
window
.
addEventListener
(
'
pagehide
'
async
(
event
)
=
>
{
await
Promise
.
resolve
(
)
;
resolve
(
{
persisted
:
event
.
persisted
}
)
;
}
false
)
;
location
.
href
+
=
'
&
navigated
'
;
}
)
)
;
assert_true
(
persisted
)
;
}
'
Assure
microtasks
posted
by
pagehide
event
handler
are
dispatched
'
)
;
