const
params
=
new
URLSearchParams
(
window
.
location
.
search
)
;
const
uuid
=
params
.
get
(
'
uuid
'
)
;
window
.
isPageshowFired
=
false
;
window
.
isPageshowPersisted
=
null
;
window
.
loadCount
=
parseInt
(
localStorage
.
getItem
(
uuid
+
'
.
loadCount
'
)
|
|
'
0
'
)
+
1
;
localStorage
.
setItem
(
uuid
+
'
.
loadCount
'
loadCount
)
;
window
.
pageShowPromise
=
new
Promise
(
resolve
=
>
window
.
addEventListener
(
'
pageshow
'
resolve
{
once
:
true
}
)
)
;
const
executor
=
new
Executor
(
uuid
)
;
window
.
prepareNavigation
=
function
(
callback
)
{
window
.
addEventListener
(
'
pageshow
'
(
event
)
=
>
{
window
.
isPageshowFired
=
true
;
window
.
isPageshowPersisted
=
event
.
persisted
;
executor
.
resume
(
)
;
}
{
once
:
true
}
)
;
executor
.
suspend
(
callback
)
;
}
window
.
disableBFCache
=
(
)
=
>
{
return
new
Promise
(
resolve
=
>
{
navigator
.
locks
.
request
(
uuid
(
)
=
>
{
resolve
(
)
;
return
new
Promise
(
(
)
=
>
{
}
)
;
}
)
;
}
)
;
}
;
