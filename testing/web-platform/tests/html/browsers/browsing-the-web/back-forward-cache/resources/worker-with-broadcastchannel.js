let
messages
=
[
]
;
const
channel
=
new
BroadcastChannel
(
'
foo
'
)
;
channel
.
addEventListener
(
'
message
'
event
=
>
{
messages
.
push
(
event
.
data
)
;
}
)
;
function
waitForEventsPromise
(
count
)
{
return
new
Promise
(
resolve
=
>
{
function
checkMessages
(
)
{
if
(
messages
.
length
>
=
count
)
{
channel
.
removeEventListener
(
'
message
'
checkMessages
)
;
resolve
(
messages
.
length
)
;
}
}
checkMessages
(
)
;
channel
.
addEventListener
(
'
message
'
checkMessages
)
;
}
)
;
}
