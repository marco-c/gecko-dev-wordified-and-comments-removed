'
use
strict
'
;
promise_test
(
async
testCase
=
>
{
let
scope
;
if
(
self
.
GLOBAL
.
isWindow
(
)
)
{
scope
=
'
/
cookiestore
/
resources
/
does
/
not
/
exist
'
;
const
registration
=
await
service_worker_unregister_and_register
(
testCase
'
resources
/
empty_sw
.
js
'
scope
)
;
testCase
.
add_cleanup
(
(
)
=
>
registration
.
unregister
(
)
)
;
await
wait_for_state
(
testCase
registration
.
installing
'
activated
'
)
;
self
.
registration
=
registration
;
}
else
{
scope
=
'
/
cookiestore
/
does
/
not
/
exist
'
;
await
new
Promise
(
resolve
=
>
{
self
.
addEventListener
(
'
activate
'
event
=
>
{
resolve
(
)
;
}
)
;
}
)
;
}
{
const
subscriptions
=
[
{
name
:
'
cookie
-
name
'
url
:
{
scope
}
/
path
}
]
;
await
registration
.
cookies
.
subscribe
(
subscriptions
)
;
testCase
.
add_cleanup
(
(
)
=
>
{
if
(
self
.
GLOBAL
.
isWorker
(
)
)
{
return
registration
.
cookies
.
unsubscribe
(
subscriptions
)
;
}
}
)
;
}
const
subscriptions
=
await
registration
.
cookies
.
getSubscriptions
(
)
;
assert_equals
(
subscriptions
.
length
1
)
;
assert_equals
(
subscriptions
[
0
]
.
name
'
cookie
-
name
'
)
;
assert_equals
(
subscriptions
[
0
]
.
url
(
new
URL
(
{
scope
}
/
path
self
.
location
.
href
)
)
.
href
)
;
}
'
getSubscriptions
returns
a
subscription
passed
to
subscribe
'
)
;
