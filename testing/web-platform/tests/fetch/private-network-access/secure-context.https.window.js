setup
(
(
)
=
>
{
assert_true
(
window
.
isSecureContext
)
;
}
)
;
promise_test
(
async
t
=
>
{
const
response
=
await
fetch
(
"
/
common
/
blank
.
html
"
)
assert_true
(
response
.
ok
)
;
}
"
Local
secure
context
fetches
local
subresource
.
"
)
;
promise_test
(
async
t
=
>
{
const
url
=
"
resources
/
fetcher
.
html
"
+
"
?
pipe
=
header
(
Content
-
Security
-
Policy
treat
-
as
-
public
-
address
)
"
;
const
iframe
=
await
appendIframe
(
t
document
url
)
;
const
reply
=
futureMessage
(
)
;
iframe
.
contentWindow
.
postMessage
(
"
/
common
/
blank
-
with
-
cors
.
html
"
"
*
"
)
;
assert_equals
(
await
reply
true
)
;
}
"
Treat
-
as
-
public
secure
context
fetches
local
subresource
.
"
)
;
promise_test
(
async
t
=
>
{
const
url
=
resolveUrl
(
"
resources
/
fetcher
.
html
"
{
protocol
:
"
https
:
"
port
:
kPorts
.
httpsPrivate
}
)
;
const
iframe
=
await
appendIframe
(
t
document
url
)
;
const
targetUrl
=
resolveUrl
(
"
/
common
/
blank
-
with
-
cors
.
html
"
)
;
const
reply
=
futureMessage
(
)
;
iframe
.
contentWindow
.
postMessage
(
targetUrl
.
href
"
*
"
)
;
assert_equals
(
await
reply
true
)
;
}
"
Private
secure
context
can
fetch
local
subresource
.
"
)
;
promise_test
(
async
t
=
>
{
const
url
=
resolveUrl
(
"
resources
/
fetcher
.
html
"
{
protocol
:
"
https
:
"
port
:
kPorts
.
httpsPublic
}
)
;
const
iframe
=
await
appendIframe
(
t
document
url
)
;
const
targetUrl
=
resolveUrl
(
"
/
common
/
blank
-
with
-
cors
.
html
"
)
;
const
reply
=
futureMessage
(
)
;
iframe
.
contentWindow
.
postMessage
(
targetUrl
.
href
"
*
"
)
;
assert_equals
(
await
reply
true
)
;
}
"
Public
secure
context
can
fetch
local
subresource
.
"
)
;
