promise_test
(
function
(
)
{
var
cacheBuster
=
token
(
)
;
var
url
=
"
.
.
/
resources
/
cache
.
py
?
v
=
"
+
cacheBuster
;
var
etag
;
return
fetch
(
url
)
.
then
(
function
(
response
)
{
assert_equals
(
response
.
status
200
)
;
assert_equals
(
response
.
headers
.
get
(
"
X
-
HTTP
-
STATUS
"
)
null
)
return
response
.
text
(
)
;
}
)
.
then
(
function
(
body
)
{
return
fetch
(
url
)
;
}
)
.
then
(
function
(
response
)
{
assert_equals
(
response
.
status
200
)
;
assert_equals
(
response
.
headers
.
get
(
"
X
-
HTTP
-
STATUS
"
)
"
304
"
)
etag
=
response
.
headers
.
get
(
"
ETag
"
)
return
response
.
text
(
)
;
}
)
.
then
(
function
(
body
)
{
var
headers
=
{
"
If
-
None
-
Match
"
:
etag
}
return
fetch
(
url
{
headers
:
headers
}
)
}
)
.
then
(
function
(
response
)
{
assert_equals
(
response
.
status
304
)
;
}
)
;
}
"
Testing
conditional
GET
with
ETags
"
)
;
