function
check_partition_ids
(
location
)
{
const
NUM_FETCHES
=
20
;
var
base_url
=
'
SUBRESOURCE_PREFIX
:
&
dispatch
=
check_partition
'
;
var
include_credentials
=
base_url
.
search
(
'
include_credentials
=
true
'
)
!
=
-
1
;
var
exclude_credentials
=
base_url
.
search
(
'
include_credentials
=
false
'
)
!
=
-
1
;
if
(
include_credentials
!
=
!
exclude_credentials
)
throw
new
Exception
(
'
Credentials
mode
not
specified
'
)
;
var
fetches
=
[
]
;
for
(
i
=
0
;
i
<
NUM_FETCHES
;
+
+
i
)
{
var
fetch_params
=
{
credentials
:
'
omit
'
mode
:
'
cors
'
headers
:
{
'
Header
-
To
-
Force
-
CORS
'
:
'
cors
'
}
}
;
var
url
=
{
base_url
}
&
{
token
(
)
}
;
fetches
.
push
(
fetch
(
url
fetch_params
)
.
then
(
function
(
response
)
{
return
response
.
text
(
)
.
then
(
function
(
text
)
{
assert_equals
(
text
'
ok
'
Socket
unexpectedly
reused
)
;
}
)
;
}
)
)
;
}
return
Promise
.
allSettled
(
fetches
)
.
then
(
function
(
results
)
{
results
.
forEach
(
function
(
result
)
{
if
(
result
.
status
!
=
'
fulfilled
'
)
throw
result
.
reason
;
}
)
;
}
)
;
}
