'
use
strict
'
;
async
function
compressData
(
chunk
format
)
{
const
cs
=
new
CompressionStream
(
format
)
;
const
writer
=
cs
.
writable
.
getWriter
(
)
;
writer
.
write
(
chunk
)
;
writer
.
close
(
)
;
return
await
concatenateStream
(
cs
.
readable
)
;
}
const
fullData
=
new
TextEncoder
(
)
.
encode
(
JSON
.
stringify
(
Array
.
from
(
{
length
:
10_000
}
(
_
i
)
=
>
i
)
)
)
;
const
data
=
fullData
.
subarray
(
0
35_579
)
;
const
expectedValue
=
data
;
for
(
const
format
of
formats
)
{
promise_test
(
async
t
=
>
{
const
compressedData
=
await
compressData
(
data
format
)
;
const
decompressedData
=
await
decompressDataOrPako
(
compressedData
format
)
;
assert_array_equals
(
decompressedData
expectedValue
'
value
should
match
'
)
;
}
{
format
}
compression
with
large
flush
output
)
;
}
