"
use
strict
"
;
function
navigateToTestWithEarlyHints
(
test_url
preloads
)
{
const
params
=
new
URLSearchParams
(
)
;
params
.
set
(
"
test_url
"
test_url
)
;
for
(
const
preload
of
preloads
)
{
params
.
append
(
"
preloads
"
JSON
.
stringify
(
preload
)
)
;
}
const
url
=
"
resources
/
early
-
hints
-
test
-
loader
.
h2
.
py
?
"
+
params
.
toString
(
)
;
window
.
location
.
replace
(
new
URL
(
url
window
.
location
)
)
;
}
function
getPreloadsFromSearchParams
(
)
{
const
params
=
new
URLSearchParams
(
window
.
location
.
search
)
;
const
encoded_preloads
=
params
.
getAll
(
"
preloads
"
)
;
const
preloads
=
[
]
;
for
(
const
encoded
of
encoded_preloads
)
{
preloads
.
push
(
JSON
.
parse
(
encoded
)
)
;
}
return
preloads
;
}
function
testReferrerPolicy
(
referrer_policy
)
{
const
params
=
new
URLSearchParams
(
)
;
params
.
set
(
"
referrer
-
policy
"
referrer_policy
)
;
const
same_origin_preload_url
=
"
https
:
/
/
{
{
host
}
}
:
{
{
ports
[
h2
]
[
0
]
}
}
/
loading
/
early
-
hints
/
resources
/
fetch
-
and
-
record
-
js
.
h2
.
py
?
id
=
"
+
token
(
)
;
params
.
set
(
"
same
-
origin
-
preload
-
url
"
same_origin_preload_url
)
;
const
cross_origin_preload_url
=
"
https
:
/
/
{
{
hosts
[
alt
]
[
www
]
}
}
:
{
{
ports
[
h2
]
[
0
]
}
}
/
loading
/
early
-
hints
/
resources
/
fetch
-
and
-
record
-
js
.
h2
.
py
?
id
=
"
+
token
(
)
;
params
.
set
(
"
cross
-
origin
-
preload
-
url
"
cross_origin_preload_url
)
;
const
path
=
"
resources
/
referrer
-
policy
-
test
-
loader
.
h2
.
py
?
"
+
params
.
toString
(
)
;
const
url
=
new
URL
(
path
window
.
location
)
;
window
.
location
.
replace
(
url
)
;
}
