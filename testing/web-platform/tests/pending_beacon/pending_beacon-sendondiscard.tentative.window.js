'
use
strict
'
;
promise_test
(
async
t
=
>
{
const
uuid
=
token
(
)
;
const
iframe
=
document
.
createElement
(
'
iframe
'
)
;
iframe
.
src
=
/
pending_beacon
/
resources
/
iframe_create_beacon_no_send
.
html
?
uuid
=
{
uuid
}
;
const
iframe_load_promise
=
new
Promise
(
resolve
=
>
iframe
.
onload
=
(
)
=
>
resolve
(
)
)
;
document
.
body
.
appendChild
(
iframe
)
;
await
iframe_load_promise
;
document
.
body
.
removeChild
(
iframe
)
;
await
expectBeacon
(
uuid
{
count
:
2
}
)
;
}
'
Verify
that
a
discarded
document
sends
its
beacons
.
'
)
;
promise_test
(
async
t
=
>
{
const
uuid
=
token
(
)
;
const
iframe
=
document
.
createElement
(
'
iframe
'
)
;
iframe
.
src
=
/
pending_beacon
/
resources
/
iframe_create_beacon_then_send
.
html
?
uuid
=
{
uuid
}
;
const
iframe_load_promise
=
new
Promise
(
resolve
=
>
iframe
.
onload
=
(
)
=
>
resolve
(
)
)
;
document
.
body
.
appendChild
(
iframe
)
;
await
iframe_load_promise
;
await
expectBeacon
(
uuid
{
count
:
1
}
)
;
document
.
body
.
removeChild
(
iframe
)
;
await
expectBeacon
(
uuid
{
count
:
1
}
)
;
}
'
Verify
that
a
discarded
document
does
not
send
an
already
sent
beacon
.
'
)
;
