'
use
strict
'
;
const
test_desc
=
'
subsequent
watchAdvertisements
(
)
calls
result
in
the
'
+
'
second
call
resolving
successfully
.
'
;
bluetooth_test
(
async
(
t
)
=
>
{
let
{
device
}
=
await
getDiscoveredHealthThermometerDevice
(
)
;
const
watcher
=
new
EventWatcher
(
t
device
[
'
advertisementreceived
'
]
)
;
await
device
.
watchAdvertisements
(
)
;
await
device
.
watchAdvertisements
(
)
;
let
advertisementreceivedPromise
=
watcher
.
wait_for
(
'
advertisementreceived
'
)
;
await
fake_central
.
simulateAdvertisementReceived
(
health_thermometer_ad_packet
)
;
let
evt
=
await
advertisementreceivedPromise
;
assert_equals
(
evt
.
device
device
)
;
}
test_desc
)
;
