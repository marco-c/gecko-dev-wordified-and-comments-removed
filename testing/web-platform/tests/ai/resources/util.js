const
testAbortPromise
=
async
(
t
method
)
=
>
{
{
const
controller
=
new
AbortController
(
)
;
const
promise
=
method
(
controller
.
signal
)
;
controller
.
abort
(
)
;
await
promise_rejects_dom
(
t
'
AbortError
'
promise
)
;
const
anotherPromise
=
method
(
controller
.
signal
)
;
await
promise_rejects_dom
(
t
'
AbortError
'
anotherPromise
)
;
}
{
const
err
=
new
Error
(
'
test
'
)
;
const
controller
=
new
AbortController
(
)
;
const
promise
=
method
(
controller
.
signal
)
;
controller
.
abort
(
err
)
;
await
promise_rejects_exactly
(
t
err
promise
)
;
const
anotherPromise
=
method
(
controller
.
signal
)
;
await
promise_rejects_exactly
(
t
err
anotherPromise
)
;
}
}
;
