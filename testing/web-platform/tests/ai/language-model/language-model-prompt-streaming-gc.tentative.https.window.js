'
use
strict
'
;
promise_test
(
async
t
=
>
{
await
ensureLanguageModel
(
)
;
const
session
=
await
createLanguageModel
(
)
;
const
streamingResponse
=
session
.
promptStreaming
(
kTestPrompt
)
;
gc
(
)
;
assert_equals
(
Object
.
prototype
.
toString
.
call
(
streamingResponse
)
"
[
object
ReadableStream
]
"
)
;
let
result
=
"
"
;
for
await
(
const
value
of
streamingResponse
)
{
result
+
=
value
;
gc
(
)
;
}
assert_greater_than
(
result
.
length
0
"
The
result
should
not
be
empty
.
"
)
;
}
'
Prompt
Streaming
API
must
continue
even
after
GC
has
been
performed
.
'
)
;
