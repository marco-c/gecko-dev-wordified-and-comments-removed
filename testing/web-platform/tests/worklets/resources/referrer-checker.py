def
main
(
request
response
)
:
    
referrer
=
request
.
headers
.
get
(
b
"
referer
"
b
"
"
)
.
split
(
b
"
?
"
)
[
0
]
    
referrer_policy
=
request
.
GET
.
first
(
b
"
referrer_policy
"
)
    
expected_referrer
=
request
.
GET
.
first
(
b
"
expected_referrer
"
b
"
"
)
    
response_headers
=
[
(
b
"
Content
-
Type
"
b
"
text
/
javascript
"
)
                        
(
b
"
Access
-
Control
-
Allow
-
Origin
"
b
"
*
"
)
]
    
if
referrer_policy
=
=
b
"
no
-
referrer
"
or
referrer_policy
=
=
b
"
origin
"
:
        
if
referrer
=
=
expected_referrer
:
            
return
(
200
response_headers
u
"
"
)
        
return
(
404
response_headers
)
    
if
referrer_policy
=
=
b
"
same
-
origin
"
:
        
if
referrer
=
=
expected_referrer
:
            
return
(
200
response_headers
u
"
"
)
        
return
(
404
response_headers
)
    
return
(
404
response_headers
)
