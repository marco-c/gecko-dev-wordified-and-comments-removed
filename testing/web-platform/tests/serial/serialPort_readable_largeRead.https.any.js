serial_test
(
async
(
t
fake
)
=
>
{
const
{
port
fakePort
}
=
await
getFakeSerialPort
(
fake
)
;
await
port
.
open
(
{
baudRate
:
9600
bufferSize
:
64
}
)
;
const
reader
=
port
.
readable
.
getReader
(
)
;
await
fakePort
.
writable
(
)
;
const
data
=
new
Uint8Array
(
1024
)
;
for
(
let
i
=
0
;
i
<
data
.
byteLength
;
+
+
i
)
data
[
i
]
=
i
&
0xff
;
fakePort
.
write
(
data
)
;
const
value
=
await
readWithLength
(
reader
data
.
byteLength
)
;
compareArrays
(
data
value
)
;
reader
.
releaseLock
(
)
;
await
port
.
close
(
)
;
}
'
Can
read
a
large
amount
of
data
'
)
;
