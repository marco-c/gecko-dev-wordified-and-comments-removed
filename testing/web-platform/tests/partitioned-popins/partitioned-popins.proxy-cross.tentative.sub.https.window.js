'
use
strict
'
;
async_test
(
t
=
>
{
let
popin_proxy
;
window
.
addEventListener
(
"
message
"
t
.
step_func
(
e
=
>
{
switch
(
e
.
data
.
type
)
{
case
'
ready
'
:
assert_equals
(
e
.
data
.
message
"
Closed
Then
"
)
;
assert_equals
(
getUsableMethods
(
popin_proxy
)
"
Closed
Then
"
)
;
popin_proxy
.
postMessage
(
{
type
:
"
cleanup
"
}
"
*
"
)
;
break
;
case
'
cleanup
'
:
t
.
done
(
)
;
break
;
}
}
)
)
;
popin_proxy
=
window
.
open
(
"
https
:
/
/
{
{
hosts
[
alt
]
[
]
}
}
:
{
{
ports
[
https
]
[
0
]
}
}
/
partitioned
-
popins
/
resources
/
partitioned
-
popins
.
proxy
-
popin
.
html
"
'
_blank
'
'
popin
'
)
;
}
"
Verify
cross
-
site
Partitioned
Popins
proxies
only
have
access
to
postMessage
and
closed
methods
.
"
)
;
