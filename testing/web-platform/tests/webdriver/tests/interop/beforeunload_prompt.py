import
pytest
from
tests
.
support
.
sync
import
Poll
pytest
.
fixture
def
check_beforeunload_not_implicitly_accepted
(
bidi_session
current_session
url
)
:
    
def
check_beforeunload_not_implicitly_accepted
(
)
:
        
page_beforeunload
=
url
(
            
"
/
webdriver
/
tests
/
support
/
html
/
beforeunload
.
html
"
)
        
page_target
=
url
(
"
/
webdriver
/
tests
/
support
/
html
/
default
.
html
"
)
        
current_session
.
url
=
page_beforeunload
        
element
=
current_session
.
find
.
css
(
"
input
"
all
=
False
)
        
element
.
send_keys
(
"
bar
"
)
        
current_session
.
url
=
page_target
        
assert
type
(
current_session
.
alert
.
text
)
is
str
        
wait
=
Poll
(
current_session
timeout
=
2
                    
message
=
f
"
Target
page
has
been
loaded
"
)
        
wait
.
until
(
lambda
_
:
current_session
.
url
=
=
page_target
)
    
return
check_beforeunload_not_implicitly_accepted
pytest
.
mark
.
capabilities
(
{
"
unhandledPromptBehavior
"
:
"
accept
"
}
)
def
test_accept
(
check_beforeunload_not_implicitly_accepted
)
:
    
check_beforeunload_not_implicitly_accepted
(
)
