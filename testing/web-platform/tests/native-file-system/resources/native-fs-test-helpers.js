const
directory_promise
=
(
async
(
)
=
>
{
await
new
Promise
(
resolve
=
>
{
window
.
addEventListener
(
'
DOMContentLoaded
'
resolve
)
;
}
)
;
await
new
Promise
(
resolve
=
>
step_timeout
(
resolve
100
)
)
;
await
window
.
test_driver
.
bless
(
'
show
a
file
picker
.
<
br
/
>
Please
select
an
empty
directory
'
)
;
const
entries
=
await
self
.
showDirectoryPicker
(
)
;
assert_true
(
entries
instanceof
FileSystemHandle
)
;
assert_true
(
entries
instanceof
FileSystemDirectoryHandle
)
;
for
await
(
const
entry
of
entries
)
{
assert_unreached
(
'
Selected
directory
is
not
empty
'
)
;
}
return
entries
;
}
)
(
)
;
function
directory_test
(
func
description
)
{
promise_test
(
async
t
=
>
{
const
directory
=
await
directory_promise
;
for
await
(
let
entry
of
directory
.
values
(
)
)
{
await
directory
.
removeEntry
(
entry
.
name
{
recursive
:
entry
.
kind
=
=
=
'
directory
'
}
)
;
}
await
func
(
t
directory
)
;
}
description
)
;
}
directory_test
(
async
(
t
dir
)
=
>
{
assert_equals
(
await
dir
.
queryPermission
(
{
mode
:
'
read
'
}
)
'
granted
'
)
;
}
'
User
succesfully
selected
an
empty
directory
.
'
)
;
directory_test
(
async
(
t
dir
)
=
>
{
const
status
=
await
dir
.
queryPermission
(
{
mode
:
'
readwrite
'
}
)
;
if
(
status
=
=
'
granted
'
)
return
;
await
window
.
test_driver
.
bless
(
'
ask
for
write
permission
'
)
;
assert_equals
(
await
dir
.
requestPermission
(
{
mode
:
'
readwrite
'
}
)
'
granted
'
)
;
}
'
User
granted
write
access
.
'
)
;
