def
main
(
request
response
)
:
    
mode
=
'
init
'
    
if
'
update
-
recovery
-
mode
'
in
request
.
cookies
:
        
mode
=
request
.
cookies
[
'
update
-
recovery
-
mode
'
]
.
value
    
headers
=
[
(
'
Cache
-
Control
'
'
no
-
cache
must
-
revalidate
'
)
               
(
'
Pragma
'
'
no
-
cache
'
)
]
    
extra_body
=
'
'
    
if
mode
=
=
'
init
'
:
        
response
.
set_cookie
(
'
update
-
recovery
-
mode
'
'
bad
'
)
        
extra_body
=
"
addEventListener
(
'
fetch
'
function
(
e
)
{
e
.
respondWith
(
Promise
.
reject
(
)
)
;
}
)
;
"
    
elif
mode
=
=
'
bad
'
:
        
response
.
delete_cookie
(
'
update
-
recovery
-
mode
'
)
    
headers
.
append
(
(
'
Content
-
Type
'
'
application
/
javascript
'
)
)
    
return
headers
'
%
s
'
%
(
extra_body
)
