self
.
onmessage
=
function
(
e
)
{
var
port
=
e
.
data
.
port
;
var
message
=
[
]
;
var
promise
=
Promise
.
resolve
(
)
.
then
(
function
(
)
{
return
self
.
clients
.
matchAll
(
)
.
then
(
function
(
clients
)
{
clients
.
forEach
(
function
(
client
)
{
message
.
push
(
client
.
id
)
;
}
)
;
}
)
;
}
)
.
then
(
function
(
)
{
return
self
.
clients
.
matchAll
(
)
.
then
(
function
(
clients
)
{
clients
.
forEach
(
function
(
client
)
{
message
.
push
(
client
.
id
)
;
}
)
;
}
)
;
}
)
.
then
(
function
(
)
{
port
.
postMessage
(
message
)
;
}
)
;
e
.
waitUntil
(
promise
)
;
}
;
