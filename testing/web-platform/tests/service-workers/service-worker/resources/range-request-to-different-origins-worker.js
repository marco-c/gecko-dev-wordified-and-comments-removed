importScripts
(
'
/
common
/
get
-
host
-
info
.
sub
.
js
'
)
let
initial
=
true
;
function
is_initial_request
(
)
{
const
old
=
initial
;
initial
=
false
;
return
old
;
}
self
.
addEventListener
(
'
fetch
'
e
=
>
{
const
url
=
new
URL
(
e
.
request
.
url
)
;
if
(
url
.
search
.
indexOf
(
'
VIDEO
'
)
=
=
-
1
)
{
return
;
}
if
(
is_initial_request
(
)
)
{
const
cross_origin_url
=
get_host_info
(
)
.
HTTPS_REMOTE_ORIGIN
+
url
.
pathname
+
url
.
search
;
const
cross_origin_request
=
new
Request
(
cross_origin_url
{
mode
:
'
no
-
cors
'
headers
:
e
.
request
.
headers
}
)
;
e
.
respondWith
(
fetch
(
cross_origin_request
)
)
;
return
;
}
}
)
;
