let
source
;
let
resolveDone
;
let
done
=
new
Promise
(
resolve
=
>
resolveDone
=
resolve
)
;
self
.
addEventListener
(
'
message
'
event
=
>
{
source
=
event
.
data
.
port
;
source
.
postMessage
(
'
pong
'
)
;
event
.
waitUntil
(
done
)
;
}
)
;
self
.
addEventListener
(
'
fetch
'
event
=
>
{
const
url
=
new
URL
(
event
.
request
.
url
)
;
const
cssPath
=
'
request
-
url
-
path
/
fetch
-
request
-
css
-
base
-
url
-
style
.
css
'
;
if
(
url
.
pathname
.
indexOf
(
cssPath
)
!
=
-
1
)
{
if
(
url
.
search
=
=
'
?
fetch
'
)
{
event
.
respondWith
(
fetch
(
'
fetch
-
request
-
css
-
base
-
url
-
style
.
css
?
fetch
'
)
)
;
}
else
if
(
url
.
search
=
=
'
?
newResponse
'
)
{
const
styleString
=
'
body
{
background
-
image
:
url
(
"
.
/
sample
.
png
"
)
;
}
'
;
const
headers
=
{
'
content
-
type
'
:
'
text
/
css
'
}
;
event
.
respondWith
(
new
Response
(
styleString
headers
)
)
;
}
}
else
if
(
url
.
pathname
.
indexOf
(
'
sample
.
png
'
)
!
=
-
1
)
{
source
.
postMessage
(
{
url
:
event
.
request
.
url
referrer
:
event
.
request
.
referrer
}
)
;
resolveDone
(
)
;
}
}
)
;
