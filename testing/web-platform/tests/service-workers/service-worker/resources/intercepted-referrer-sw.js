self
.
addEventListener
(
'
install
'
event
=
>
{
event
.
waitUntil
(
self
.
skipWaiting
(
)
)
;
}
)
;
self
.
addEventListener
(
'
activate
'
event
=
>
{
event
.
waitUntil
(
self
.
clients
.
claim
(
)
)
;
}
)
;
self
.
addEventListener
(
'
fetch
'
event
=
>
{
if
(
event
.
request
.
mode
=
=
=
'
navigate
'
)
{
const
html
=
<
!
doctype
html
>
<
meta
charset
=
"
utf
-
8
"
>
<
title
>
SW
Intercepted
Page
<
/
title
>
<
script
>
/
/
Post
the
referrer
observed
by
this
new
Document
.
window
.
addEventListener
(
'
load
'
(
)
=
>
{
parent
.
postMessage
(
{
source
:
'
sw
-
intercepted
'
referrer
:
document
.
referrer
url
:
location
.
href
}
'
*
'
)
;
}
)
;
<
/
script
>
<
h1
>
SW
-
synthesized
page
<
/
h1
>
<
p
>
This
page
was
served
by
a
Service
Worker
via
respondWith
(
)
.
<
/
p
>
;
event
.
respondWith
(
new
Response
(
html
{
headers
:
{
'
Content
-
Type
'
:
'
text
/
html
;
charset
=
utf
-
8
'
}
}
)
)
;
}
}
)
;
