var
messageHandler
=
function
(
port
e
)
{
var
text_decoder
=
new
TextDecoder
;
port
.
postMessage
(
{
content
:
text_decoder
.
decode
(
e
.
data
)
byteLength
:
e
.
data
.
byteLength
}
)
;
port
.
postMessage
(
e
.
data
{
transfer
:
[
e
.
data
.
buffer
]
}
)
;
port
.
postMessage
(
{
content
:
text_decoder
.
decode
(
e
.
data
)
byteLength
:
e
.
data
.
byteLength
}
)
;
}
;
self
.
addEventListener
(
'
message
'
e
=
>
{
if
(
e
.
ports
[
0
]
)
{
e
.
ports
[
0
]
.
onmessage
=
messageHandler
.
bind
(
null
e
.
ports
[
0
]
)
;
return
;
}
messageHandler
(
e
.
source
e
)
;
}
)
;
