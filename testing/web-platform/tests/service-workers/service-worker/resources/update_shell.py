import
os
import
time
from
six
import
PY3
from
wptserve
.
utils
import
isomorphic_encode
def
main
(
request
response
)
:
  
headers
=
[
(
b
'
Cache
-
Control
'
b
'
no
-
cache
must
-
revalidate
'
)
             
(
b
'
Pragma
'
b
'
no
-
cache
'
)
             
(
b
'
Content
-
Type
'
b
'
application
/
javascript
'
)
]
  
timestamp
=
u
'
/
/
%
s
%
s
'
%
(
time
.
time
(
)
time
.
perf_counter
(
)
if
PY3
else
time
.
clock
(
)
)
  
body
=
isomorphic_encode
(
timestamp
)
+
b
'
\
n
'
  
if
b
'
filename
'
in
request
.
GET
:
    
path
=
os
.
path
.
join
(
os
.
path
.
dirname
(
isomorphic_encode
(
__file__
)
)
                        
request
.
GET
[
b
'
filename
'
]
)
    
with
open
(
path
'
rb
'
)
as
f
:
      
body
+
=
f
.
read
(
)
  
return
headers
body
