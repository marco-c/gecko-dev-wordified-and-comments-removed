function
runTest
(
test
path
credentials
expectSuccess
)
{
const
xhr
=
new
XMLHttpRequest
(
)
;
xhr
.
withCredentials
=
credentials
;
xhr
.
open
(
"
GET
"
"
resources
/
redirect
.
py
?
location
=
"
+
get_host_info
(
)
.
HTTP_REMOTE_ORIGIN
+
path
true
)
;
xhr
.
onload
=
test
.
step_func_done
(
function
(
)
{
assert_true
(
expectSuccess
)
;
assert_equals
(
xhr
.
responseText
"
PASS
:
Cross
-
domain
access
allowed
.
"
)
;
}
)
;
xhr
.
onerror
=
test
.
step_func_done
(
function
(
)
{
assert_false
(
expectSuccess
)
;
assert_equals
(
xhr
.
status
0
)
;
}
)
;
xhr
.
send
(
null
)
;
}
const
withoutCredentials
=
false
;
const
withCredentials
=
true
;
const
succeeds
=
true
;
const
fails
=
false
;
async_test
(
t
=
>
{
runTest
(
t
"
/
xhr
/
resources
/
access
-
control
-
basic
-
allow
-
star
.
py
"
withoutCredentials
succeeds
)
}
"
Request
without
credentials
is
redirected
to
a
cross
-
origin
response
with
Access
-
Control
-
Allow
-
Origin
=
*
(
with
star
)
"
)
;
async_test
(
t
=
>
{
runTest
(
t
"
/
xhr
/
resources
/
access
-
control
-
basic
-
allow
-
star
.
py
"
withCredentials
fails
)
}
"
Request
with
credentials
is
redirected
to
a
cross
-
origin
response
with
Access
-
Control
-
Allow
-
Origin
=
*
(
with
star
)
"
)
;
async_test
(
t
=
>
{
runTest
(
t
"
/
xhr
/
resources
/
access
-
control
-
basic
-
allow
.
py
"
withoutCredentials
succeeds
)
}
"
Request
without
credentials
is
redirected
to
a
cross
-
origin
response
with
a
specific
Access
-
Control
-
Allow
-
Origin
"
)
;
async_test
(
t
=
>
{
runTest
(
t
"
/
xhr
/
resources
/
access
-
control
-
basic
-
allow
.
py
"
withCredentials
succeeds
)
}
"
Request
with
credentials
is
redirected
to
a
cross
-
origin
response
with
a
specific
Access
-
Control
-
Allow
-
Origin
"
)
;
async_test
(
t
=
>
{
runTest
(
t
"
/
xhr
/
resources
/
access
-
control
-
basic
-
allow
-
no
-
credentials
.
py
"
withoutCredentials
succeeds
)
}
"
Request
without
credentials
is
redirected
to
a
cross
-
origin
response
with
a
specific
Access
-
Control
-
Allow
-
Origin
(
no
credentials
)
"
)
;
async_test
(
t
=
>
{
runTest
(
t
"
/
xhr
/
resources
/
access
-
control
-
basic
-
allow
-
no
-
credentials
.
py
"
withCredentials
fails
)
}
"
Request
with
credentials
is
redirected
to
a
cross
-
origin
response
with
a
specific
Access
-
Control
-
Allow
-
Origin
(
no
credentials
)
"
)
;
