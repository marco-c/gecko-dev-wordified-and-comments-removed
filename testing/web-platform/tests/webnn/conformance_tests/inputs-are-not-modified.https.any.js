'
use
strict
'
;
let
mlContext
;
promise_setup
(
async
(
)
=
>
{
assert_implements
(
navigator
.
ml
'
missing
navigator
.
ml
'
)
;
mlContext
=
await
navigator
.
ml
.
createContext
(
contextOptions
)
;
}
)
;
promise_test
(
async
(
)
=
>
{
const
builder
=
new
MLGraphBuilder
(
mlContext
)
;
const
inputOperand
=
builder
.
input
(
'
input
'
{
dataType
:
'
float32
'
shape
:
[
4
]
}
)
;
const
hardSwishOperand
=
builder
.
hardSwish
(
inputOperand
)
;
const
outputOperand
=
builder
.
identity
(
hardSwishOperand
)
;
const
[
inputTensor
outputTensor
mlGraph
]
=
await
Promise
.
all
(
[
mlContext
.
createTensor
(
{
dataType
:
'
float32
'
shape
:
[
4
]
usage
:
MLTensorUsage
.
WRITE
|
MLTensorUsage
.
READ
}
)
mlContext
.
createTensor
(
{
dataType
:
'
float32
'
shape
:
[
4
]
usage
:
MLTensorUsage
.
READ
}
)
builder
.
build
(
{
'
output
'
:
outputOperand
}
)
]
)
;
const
inputData
=
Float32Array
.
from
(
[
-
4
-
1
1
4
]
)
;
mlContext
.
writeTensor
(
inputTensor
inputData
)
;
mlContext
.
dispatch
(
mlGraph
{
'
input
'
:
inputTensor
}
{
'
output
'
:
outputTensor
}
)
;
await
mlContext
.
readTensor
(
outputTensor
)
;
assert_array_equals
(
new
Float32Array
(
await
mlContext
.
readTensor
(
inputTensor
)
)
inputData
)
;
}
'
input
tensor
is
not
modified
:
hardSwish
'
)
;
promise_test
(
async
(
)
=
>
{
const
builder
=
new
MLGraphBuilder
(
mlContext
)
;
const
inputOperand
=
builder
.
input
(
'
input
'
{
dataType
:
'
float32
'
shape
:
[
4
]
}
)
;
const
constantOperand
=
builder
.
constant
(
{
dataType
:
'
float32
'
shape
:
[
4
]
}
Float32Array
.
from
(
[
-
2
0
3
4
]
)
)
;
const
mulOperand
=
builder
.
mul
(
inputOperand
constantOperand
)
;
const
outputOperand
=
builder
.
add
(
mulOperand
constantOperand
)
;
const
[
inputTensor
outputTensor
mlGraph
]
=
await
Promise
.
all
(
[
mlContext
.
createTensor
(
{
dataType
:
'
float32
'
shape
:
[
4
]
usage
:
MLTensorUsage
.
WRITE
|
MLTensorUsage
.
READ
}
)
mlContext
.
createTensor
(
{
dataType
:
'
float32
'
shape
:
[
4
]
usage
:
MLTensorUsage
.
READ
}
)
builder
.
build
(
{
'
output
'
:
outputOperand
}
)
]
)
;
const
inputData
=
Float32Array
.
from
(
[
1
2
3
4
]
)
;
mlContext
.
writeTensor
(
inputTensor
inputData
)
;
mlContext
.
dispatch
(
mlGraph
{
'
input
'
:
inputTensor
}
{
'
output
'
:
outputTensor
}
)
;
await
mlContext
.
readTensor
(
outputTensor
)
;
assert_array_equals
(
new
Float32Array
(
await
mlContext
.
readTensor
(
inputTensor
)
)
inputData
)
;
}
'
input
tensor
is
not
modified
:
mul
'
)
;
