'
use
strict
'
;
(
(
)
=
>
{
if
(
this
.
constructor
.
name
=
=
=
'
DedicatedWorkerGlobalScope
'
|
|
this
!
=
=
window
.
top
)
{
if
(
typeof
MojoInterfaceInterceptor
!
=
=
'
undefined
'
)
{
let
messageChannel
=
new
MessageChannel
(
)
;
messageChannel
.
port1
.
onmessage
=
async
(
messageEvent
)
=
>
{
if
(
messageEvent
.
data
.
type
=
=
=
'
Attach
'
)
{
messageEvent
.
data
.
interfaces
.
forEach
(
interfaceName
=
>
{
let
interfaceInterceptor
=
new
MojoInterfaceInterceptor
(
interfaceName
)
;
interfaceInterceptor
.
oninterfacerequest
=
e
=
>
messageChannel
.
port1
.
postMessage
(
{
type
:
interfaceName
handle
:
e
.
handle
}
[
e
.
handle
]
)
;
interfaceInterceptor
.
start
(
)
;
}
)
;
await
navigator
.
usb
.
getDevices
(
)
;
messageChannel
.
port1
.
postMessage
(
{
type
:
'
Complete
'
}
)
;
}
}
;
let
message
=
{
type
:
'
ReadyForAttachment
'
port
:
messageChannel
.
port2
}
;
if
(
typeof
Window
!
=
=
'
undefined
'
)
parent
.
postMessage
(
message
'
*
'
[
messageChannel
.
port2
]
)
;
else
postMessage
(
message
[
messageChannel
.
port2
]
)
;
}
}
}
)
(
)
;
