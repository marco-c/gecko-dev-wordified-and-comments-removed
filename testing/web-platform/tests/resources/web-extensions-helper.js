setup
(
{
explicit_done
:
true
}
)
globalThis
.
runTestsWithWebExtension
=
function
(
extensionPath
)
{
test_driver
.
install_web_extension
(
{
type
:
"
path
"
path
:
extensionPath
}
)
.
then
(
(
result
)
=
>
{
let
test
;
browser
.
test
.
onTestStarted
.
addListener
(
(
data
)
=
>
{
test
=
async_test
(
data
.
testName
)
}
)
browser
.
test
.
onTestFinished
.
addListener
(
(
data
)
=
>
{
test
.
step
(
(
)
=
>
{
let
description
=
data
.
message
?
{
data
.
assertionDescription
}
.
{
data
.
message
}
:
data
.
assertionDescription
assert_true
(
data
.
result
description
)
}
)
test
.
done
(
)
if
(
!
data
.
result
)
{
test
.
set_status
(
test
.
FAIL
)
}
if
(
!
data
.
remainingTests
)
{
test_driver
.
uninstall_web_extension
(
result
.
extension
)
.
then
(
(
)
=
>
{
done
(
)
}
)
}
}
)
}
)
}
