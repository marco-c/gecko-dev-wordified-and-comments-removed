globalThis
.
TestRunner
=
class
TestRunner
extends
AudioWorkletProcessor
{
constructor
(
)
{
super
(
)
;
this
.
createShadowRealmAndStartTests
(
)
;
}
fetchOverPortExecutor
(
resource
)
{
return
(
resolve
reject
)
=
>
{
const
listener
=
(
event
)
=
>
{
if
(
typeof
event
.
data
!
=
=
"
string
"
|
|
!
event
.
data
.
startsWith
(
"
fetchResult
:
:
"
)
)
{
return
;
}
const
result
=
event
.
data
.
slice
(
"
fetchResult
:
:
"
.
length
)
;
if
(
result
.
startsWith
(
"
success
:
:
"
)
)
{
resolve
(
result
.
slice
(
"
success
:
:
"
.
length
)
)
;
}
else
{
reject
(
result
.
slice
(
"
fail
:
:
"
.
length
)
)
;
}
this
.
port
.
removeEventListener
(
"
message
"
listener
)
;
}
this
.
port
.
addEventListener
(
"
message
"
listener
)
;
this
.
port
.
start
(
)
;
this
.
port
.
postMessage
(
fetchRequest
:
:
{
resource
}
)
;
}
}
async
createShadowRealmAndStartTests
(
)
{
throw
new
Error
(
"
Forgot
to
overwrite
this
method
!
"
)
;
}
process
(
)
{
return
false
;
}
}
;
registerProcessor
(
"
test
-
runner
"
TestRunner
)
;
