'
use
strict
'
;
const
isChromiumBased
=
'
MojoInterfaceInterceptor
'
in
self
;
const
isWebKitBased
=
!
isChromiumBased
&
&
'
internals
'
in
self
;
function
loadScript
(
path
)
{
if
(
typeof
document
=
=
=
'
undefined
'
)
{
importScripts
(
path
)
;
return
Promise
.
resolve
(
)
;
}
else
{
const
script
=
document
.
createElement
(
'
script
'
)
;
script
.
src
=
path
;
script
.
async
=
false
;
const
p
=
new
Promise
(
(
resolve
reject
)
=
>
{
script
.
onload
=
(
)
=
>
{
resolve
(
)
;
}
;
script
.
onerror
=
e
=
>
{
reject
(
Error
loading
{
path
}
)
;
}
;
}
)
document
.
head
.
appendChild
(
script
)
;
return
p
;
}
}
async
function
loadMojoResources
(
resources
lite
=
false
)
{
if
(
!
isChromiumBased
)
{
throw
new
Error
(
'
MojoJS
not
enabled
;
start
Chrome
with
-
-
enable
-
blink
-
features
=
MojoJS
MojoJSTest
'
)
;
}
if
(
resources
.
length
=
=
0
)
{
return
;
}
let
genPrefix
=
'
'
;
if
(
self
.
location
.
pathname
.
includes
(
'
/
web_tests
/
'
)
)
{
genPrefix
=
'
file
:
/
/
'
;
}
for
(
const
path
of
resources
)
{
if
(
path
.
endsWith
(
'
/
mojo_bindings
.
js
'
)
)
{
throw
new
Error
(
'
Do
not
load
mojo_bindings
.
js
explicitly
.
'
)
;
}
if
(
path
.
endsWith
(
'
/
mojo_bindings_lite
.
js
'
)
)
{
throw
new
Error
(
'
Do
not
load
mojo_bindings_lite
.
js
explicitly
.
'
)
;
}
if
(
lite
)
{
if
(
!
/
^
\
/
gen
\
/
.
*
\
.
mojom
-
lite
\
.
js
/
.
test
(
path
)
)
{
throw
new
Error
(
Unrecognized
resource
path
:
{
path
}
)
;
}
}
else
{
if
(
!
/
^
\
/
gen
\
/
.
*
\
.
mojom
\
.
js
/
.
test
(
path
)
)
{
throw
new
Error
(
Unrecognized
resource
path
:
{
path
}
)
;
}
}
}
if
(
lite
)
{
await
loadScript
(
genPrefix
+
'
/
gen
/
layout_test_data
/
mojo
/
public
/
js
/
mojo_bindings_lite
.
js
'
)
;
}
else
{
await
loadScript
(
genPrefix
+
'
/
gen
/
layout_test_data
/
mojo
/
public
/
js
/
mojo_bindings
.
js
'
)
;
mojo
.
config
.
autoLoadMojomDeps
=
false
;
}
for
(
const
path
of
resources
)
{
await
loadScript
(
genPrefix
+
path
)
;
}
}
