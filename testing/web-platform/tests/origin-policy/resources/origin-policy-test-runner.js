window
.
runTestsInSubframe
=
(
{
hostname
testJS
}
)
=
>
{
test
(
(
)
=
>
{
assert_equals
(
location
.
protocol
"
https
:
"
)
;
}
"
Prerequisite
check
:
running
on
HTTPS
"
)
;
promise_test
(
(
)
=
>
new
Promise
(
(
resolve
reject
)
=
>
{
const
url
=
new
URL
(
window
.
location
.
href
)
;
url
.
hostname
=
{
hostname
}
.
{
document
.
domain
}
;
url
.
pathname
=
"
/
origin
-
policy
/
resources
/
subframe
-
with
-
origin
-
policy
.
py
"
;
url
.
searchParams
.
append
(
"
test
"
new
URL
(
testJS
document
.
baseURI
)
.
pathname
)
;
const
iframe
=
document
.
createElement
(
"
iframe
"
)
;
iframe
.
src
=
url
.
href
;
iframe
.
allow
=
"
camera
*
;
geolocation
*
"
;
iframe
.
onload
=
resolve
;
iframe
.
onerror
=
(
)
=
>
reject
(
new
Error
(
Could
not
load
{
url
.
href
}
)
)
;
document
.
body
.
append
(
iframe
)
;
fetch_tests_from_window
(
iframe
.
contentWindow
)
;
}
)
"
Test
setup
of
the
iframe
"
)
;
}
;
