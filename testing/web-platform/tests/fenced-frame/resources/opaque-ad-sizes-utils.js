async
function
runOpaqueAdSizesTest
(
input_width
input_height
output_width
output_height
)
{
const
frame
=
await
attachFencedFrameContext
(
{
generator_api
:
"
fledge
"
resolve_to_config
:
true
attributes
:
[
[
"
width
"
input_width
]
[
"
height
"
input_height
]
]
}
)
;
const
assert_dimensions
=
(
label
input_width
input_height
output_width
output_height
)
=
>
{
assert_equals
(
getComputedStyle
(
document
.
documentElement
)
.
width
output_width
+
"
px
"
label
+
"
the
computed
width
coerces
to
"
+
output_width
)
;
assert_equals
(
window
.
innerWidth
output_width
label
+
"
the
innerWidth
"
+
input_width
+
"
coerces
to
"
+
output_width
)
;
assert_equals
(
window
.
innerHeight
output_height
label
+
"
the
innerHeight
"
+
input_height
+
"
coerces
to
"
+
output_height
)
;
}
await
frame
.
execute
(
assert_dimensions
[
"
After
navigation
"
input_width
input_height
output_width
output_height
]
)
;
assert_equals
(
frame
.
width
input_width
.
toString
(
)
"
The
outer
container
width
is
the
requested
width
.
"
)
;
assert_equals
(
frame
.
height
input_height
.
toString
(
)
"
The
outer
container
height
is
the
requested
height
.
"
)
;
const
new_size_x
=
320
;
const
new_size_y
=
50
;
frame
.
width
=
new_size_x
;
frame
.
height
=
new_size_y
;
await
frame
.
execute
(
(
)
=
>
{
window
.
executor
.
suspend
(
(
)
=
>
{
location
.
href
=
location
.
href
;
}
)
;
}
)
;
await
frame
.
execute
(
assert_dimensions
[
"
After
resizing
"
input_width
input_height
output_width
output_height
]
)
;
}
