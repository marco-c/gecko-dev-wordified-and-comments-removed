promise_setup
(
async
(
)
=
>
{
await
test_driver
.
set_permission
(
{
name
:
"
notifications
"
}
"
granted
"
)
;
registration
=
await
registerSw
(
"
noop
-
sw
.
js
"
)
;
await
navigator
.
serviceWorker
.
ready
;
}
)
;
promise_test
(
async
(
t
)
=
>
{
await
promise_rejects_dom
(
t
"
InvalidAccessError
"
registration
.
pushManager
.
subscribe
(
{
applicationServerKey
:
"
"
}
)
)
;
}
"
Reject
empty
string
applicationServerKey
"
)
;
promise_test
(
async
(
t
)
=
>
{
await
promise_rejects_dom
(
t
"
InvalidAccessError
"
registration
.
pushManager
.
subscribe
(
{
applicationServerKey
:
new
ArrayBuffer
(
0
)
}
)
)
;
}
"
Reject
empty
ArrayBuffer
applicationServerKey
"
)
;
promise_test
(
async
(
t
)
=
>
{
await
promise_rejects_dom
(
t
"
InvalidAccessError
"
registration
.
pushManager
.
subscribe
(
{
applicationServerKey
:
new
Uint8Array
(
0
)
}
)
)
;
}
"
Reject
empty
Uint8Array
applicationServerKey
"
)
;
promise_test
(
async
(
t
)
=
>
{
await
promise_rejects_dom
(
t
"
InvalidAccessError
"
registration
.
pushManager
.
subscribe
(
{
applicationServerKey
:
new
Uint8Array
(
[
1
2
3
]
)
}
)
)
;
}
"
Reject
a
key
that
is
not
a
valid
point
on
P
-
256
curve
"
)
;
promise_test
(
async
(
t
)
=
>
{
await
promise_rejects_dom
(
t
"
InvalidCharacterError
"
registration
.
pushManager
.
subscribe
(
{
applicationServerKey
:
"
!
#
^
&
*
"
}
)
)
;
}
"
Reject
a
string
key
that
can
'
t
be
decoded
by
base64url
"
)
;
