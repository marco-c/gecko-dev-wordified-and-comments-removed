function
runFocusChangeTest
(
t
crossOrigin
)
{
window
.
onload
=
(
)
=
>
{
const
iframe
=
document
.
createElement
(
'
iframe
'
)
;
let
src
=
location
.
href
.
slice
(
0
location
.
href
.
lastIndexOf
(
'
/
'
)
)
+
'
/
resources
/
focus
-
change
-
test
-
subframe
.
html
'
;
if
(
crossOrigin
)
{
src
=
src
.
replace
(
'
:
/
/
'
'
:
/
/
www1
.
'
)
}
iframe
.
src
=
src
;
iframe
.
onload
=
(
)
=
>
{
test_driver
.
send_keys
(
document
.
body
"
\
ue004
"
)
;
test_driver
.
send_keys
(
document
.
body
"
\
ue004
"
)
;
}
document
.
body
.
appendChild
(
iframe
)
;
}
let
count
=
0
;
window
.
onmessage
=
t
.
step_func
(
(
e
)
=
>
{
if
(
e
.
data
.
status
=
=
=
'
focus
'
)
{
+
+
count
;
if
(
count
=
=
1
)
{
scheduler
.
postTask
(
(
)
=
>
{
input
.
focus
(
)
;
}
{
priority
:
'
background
'
}
)
;
}
else
{
assert_equals
(
count
2
)
;
scheduler
.
postTask
(
async
(
)
=
>
{
await
Promise
.
resolve
(
)
;
input
.
focus
(
)
;
}
{
priority
:
'
background
'
}
)
;
}
}
else
{
assert_equals
(
e
.
data
.
status
'
done
'
)
;
const
expectedToRun
=
!
crossOrigin
;
assert_equals
(
expectedToRun
e
.
data
.
didRun
)
;
if
(
count
=
=
1
)
{
test_driver
.
send_keys
(
document
.
body
"
\
ue004
"
)
;
}
else
{
assert_equals
(
count
2
)
;
t
.
done
(
)
;
}
}
}
)
;
}
