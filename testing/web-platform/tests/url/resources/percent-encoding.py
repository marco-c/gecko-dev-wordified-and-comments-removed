import
base64
from
wptserve
.
utils
import
isomorphic_decode
def
numeric_references
(
input
)
:
    
output
=
b
"
"
    
for
cp
in
input
:
        
output
+
=
b
"
&
#
x
"
+
format
(
ord
(
cp
)
u
"
X
"
)
.
encode
(
u
"
utf
-
8
"
)
+
b
"
;
"
    
return
output
def
main
(
request
response
)
:
    
value
=
request
.
GET
.
first
(
b
"
value
"
)
.
replace
(
b
"
"
b
"
+
"
)
    
encoding
=
request
.
GET
.
first
(
b
"
encoding
"
)
    
output_value
=
numeric_references
(
base64
.
b64decode
(
value
)
.
decode
(
u
"
utf
-
8
"
)
)
    
return
(
        
[
(
b
"
Content
-
Type
"
b
"
text
/
html
;
charset
=
"
+
encoding
)
]
        
b
"
"
"
<
!
doctype
html
>
<
a
href
=
"
https
:
/
/
doesnotmatter
.
invalid
/
?
%
s
#
%
s
"
>
test
<
/
a
>
"
"
"
%
(
output_value
output_value
)
)
