import
time
def
main
(
request
response
)
:
    
mode
=
'
init
'
    
if
'
mode
'
in
request
.
cookies
:
        
mode
=
request
.
cookies
[
'
mode
'
]
.
value
    
headers
=
[
(
'
Cache
-
Control
'
'
no
-
cache
must
-
revalidate
'
)
               
(
'
Pragma
'
'
no
-
cache
'
)
]
    
content_type
=
'
'
    
extra_body
=
'
'
    
if
mode
=
=
'
init
'
:
        
content_type
=
'
application
/
javascript
'
        
response
.
set_cookie
(
'
mode
'
'
normal
'
)
    
elif
mode
=
=
'
normal
'
:
        
content_type
=
'
application
/
javascript
'
        
response
.
set_cookie
(
'
mode
'
'
error
'
)
;
    
elif
mode
=
=
'
error
'
:
        
content_type
=
'
text
/
html
'
        
response
.
set_cookie
(
'
mode
'
'
syntax
-
error
'
)
;
    
elif
mode
=
=
'
syntax
-
error
'
:
        
content_type
=
'
application
/
javascript
'
        
response
.
set_cookie
(
'
mode
'
'
throw
-
install
'
)
;
        
extra_body
=
'
badsyntax
(
isbad
;
'
    
elif
mode
=
=
'
throw
-
install
'
:
        
content_type
=
'
application
/
javascript
'
        
response
.
delete_cookie
(
'
mode
'
)
        
extra_body
=
"
addEventListener
(
'
install
'
function
(
e
)
{
throw
new
Error
(
'
boom
'
)
;
}
)
;
"
    
headers
.
append
(
(
'
Content
-
Type
'
content_type
)
)
    
return
headers
'
/
*
%
s
%
s
*
/
%
s
'
%
(
time
.
time
(
)
time
.
clock
(
)
extra_body
)
