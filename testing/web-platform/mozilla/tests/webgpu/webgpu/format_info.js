import
{
isCompatibilityDevice
}
from
'
.
.
/
common
/
framework
/
test_config
.
js
'
;
import
{
keysOf
}
from
'
.
.
/
common
/
util
/
data_tables
.
js
'
;
import
{
assert
unreachable
}
from
'
.
.
/
common
/
util
/
util
.
js
'
;
import
{
align
}
from
'
.
/
util
/
math
.
js
'
;
const
kFormatUniversalDefaults
=
{
blockWidth
:
undefined
blockHeight
:
undefined
color
:
undefined
depth
:
undefined
stencil
:
undefined
colorRender
:
undefined
multisample
:
undefined
feature
:
undefined
baseFormat
:
undefined
bytesPerBlock
:
undefined
}
;
function
formatTableWithDefaults
(
{
defaults
table
}
)
{
return
Object
.
fromEntries
(
Object
.
entries
(
table
)
.
map
(
(
[
k
row
]
)
=
>
[
k
{
.
.
.
kFormatUniversalDefaults
.
.
.
defaults
.
.
.
row
}
]
)
)
;
}
const
kRegularTextureFormatInfo
=
formatTableWithDefaults
(
{
defaults
:
{
blockWidth
:
1
blockHeight
:
1
}
table
:
{
r8unorm
:
{
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
1
}
colorRender
:
{
blend
:
true
resolve
:
true
byteCost
:
1
alignment
:
1
}
multisample
:
true
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
r8snorm
:
{
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
1
}
multisample
:
false
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
r8uint
:
{
color
:
{
type
:
'
uint
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
1
}
colorRender
:
{
blend
:
false
resolve
:
false
byteCost
:
1
alignment
:
1
}
multisample
:
true
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
r8sint
:
{
color
:
{
type
:
'
sint
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
1
}
colorRender
:
{
blend
:
false
resolve
:
false
byteCost
:
1
alignment
:
1
}
multisample
:
true
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
rg8unorm
:
{
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
2
}
colorRender
:
{
blend
:
true
resolve
:
true
byteCost
:
2
alignment
:
1
}
multisample
:
true
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
rg8snorm
:
{
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
2
}
multisample
:
false
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
rg8uint
:
{
color
:
{
type
:
'
uint
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
2
}
colorRender
:
{
blend
:
false
resolve
:
false
byteCost
:
2
alignment
:
1
}
multisample
:
true
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
rg8sint
:
{
color
:
{
type
:
'
sint
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
2
}
colorRender
:
{
blend
:
false
resolve
:
false
byteCost
:
2
alignment
:
1
}
multisample
:
true
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
rgba8unorm
:
{
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
true
readWriteStorage
:
false
bytes
:
4
}
colorRender
:
{
blend
:
true
resolve
:
true
byteCost
:
8
alignment
:
1
}
multisample
:
true
baseFormat
:
'
rgba8unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
rgba8unorm
-
srgb
'
:
{
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
4
}
colorRender
:
{
blend
:
true
resolve
:
true
byteCost
:
8
alignment
:
1
}
multisample
:
true
baseFormat
:
'
rgba8unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
rgba8snorm
:
{
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
true
readWriteStorage
:
false
bytes
:
4
}
multisample
:
false
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
rgba8uint
:
{
color
:
{
type
:
'
uint
'
copySrc
:
true
copyDst
:
true
storage
:
true
readWriteStorage
:
false
bytes
:
4
}
colorRender
:
{
blend
:
false
resolve
:
false
byteCost
:
4
alignment
:
1
}
multisample
:
true
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
rgba8sint
:
{
color
:
{
type
:
'
sint
'
copySrc
:
true
copyDst
:
true
storage
:
true
readWriteStorage
:
false
bytes
:
4
}
colorRender
:
{
blend
:
false
resolve
:
false
byteCost
:
4
alignment
:
1
}
multisample
:
true
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
bgra8unorm
:
{
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
4
}
colorRender
:
{
blend
:
true
resolve
:
true
byteCost
:
8
alignment
:
1
}
multisample
:
true
baseFormat
:
'
bgra8unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
bgra8unorm
-
srgb
'
:
{
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
4
}
colorRender
:
{
blend
:
true
resolve
:
true
byteCost
:
8
alignment
:
1
}
multisample
:
true
baseFormat
:
'
bgra8unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
r16uint
:
{
color
:
{
type
:
'
uint
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
2
}
colorRender
:
{
blend
:
false
resolve
:
false
byteCost
:
2
alignment
:
2
}
multisample
:
true
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
r16sint
:
{
color
:
{
type
:
'
sint
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
2
}
colorRender
:
{
blend
:
false
resolve
:
false
byteCost
:
2
alignment
:
2
}
multisample
:
true
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
r16float
:
{
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
2
}
colorRender
:
{
blend
:
true
resolve
:
true
byteCost
:
2
alignment
:
2
}
multisample
:
true
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
rg16uint
:
{
color
:
{
type
:
'
uint
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
4
}
colorRender
:
{
blend
:
false
resolve
:
false
byteCost
:
4
alignment
:
2
}
multisample
:
true
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
rg16sint
:
{
color
:
{
type
:
'
sint
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
4
}
colorRender
:
{
blend
:
false
resolve
:
false
byteCost
:
4
alignment
:
2
}
multisample
:
true
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
rg16float
:
{
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
4
}
colorRender
:
{
blend
:
true
resolve
:
true
byteCost
:
4
alignment
:
2
}
multisample
:
true
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
rgba16uint
:
{
color
:
{
type
:
'
uint
'
copySrc
:
true
copyDst
:
true
storage
:
true
readWriteStorage
:
false
bytes
:
8
}
colorRender
:
{
blend
:
false
resolve
:
false
byteCost
:
8
alignment
:
2
}
multisample
:
true
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
rgba16sint
:
{
color
:
{
type
:
'
sint
'
copySrc
:
true
copyDst
:
true
storage
:
true
readWriteStorage
:
false
bytes
:
8
}
colorRender
:
{
blend
:
false
resolve
:
false
byteCost
:
8
alignment
:
2
}
multisample
:
true
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
rgba16float
:
{
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
true
readWriteStorage
:
false
bytes
:
8
}
colorRender
:
{
blend
:
true
resolve
:
true
byteCost
:
8
alignment
:
2
}
multisample
:
true
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
r32uint
:
{
color
:
{
type
:
'
uint
'
copySrc
:
true
copyDst
:
true
storage
:
true
readWriteStorage
:
true
bytes
:
4
}
colorRender
:
{
blend
:
false
resolve
:
false
byteCost
:
4
alignment
:
4
}
multisample
:
false
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
r32sint
:
{
color
:
{
type
:
'
sint
'
copySrc
:
true
copyDst
:
true
storage
:
true
readWriteStorage
:
true
bytes
:
4
}
colorRender
:
{
blend
:
false
resolve
:
false
byteCost
:
4
alignment
:
4
}
multisample
:
false
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
r32float
:
{
color
:
{
type
:
'
unfilterable
-
float
'
copySrc
:
true
copyDst
:
true
storage
:
true
readWriteStorage
:
true
bytes
:
4
}
colorRender
:
{
blend
:
false
resolve
:
false
byteCost
:
4
alignment
:
4
}
multisample
:
true
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
rg32uint
:
{
color
:
{
type
:
'
uint
'
copySrc
:
true
copyDst
:
true
storage
:
true
readWriteStorage
:
false
bytes
:
8
}
colorRender
:
{
blend
:
false
resolve
:
false
byteCost
:
8
alignment
:
4
}
multisample
:
false
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
rg32sint
:
{
color
:
{
type
:
'
sint
'
copySrc
:
true
copyDst
:
true
storage
:
true
readWriteStorage
:
false
bytes
:
8
}
colorRender
:
{
blend
:
false
resolve
:
false
byteCost
:
8
alignment
:
4
}
multisample
:
false
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
rg32float
:
{
color
:
{
type
:
'
unfilterable
-
float
'
copySrc
:
true
copyDst
:
true
storage
:
true
readWriteStorage
:
false
bytes
:
8
}
colorRender
:
{
blend
:
false
resolve
:
false
byteCost
:
8
alignment
:
4
}
multisample
:
false
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
rgba32uint
:
{
color
:
{
type
:
'
uint
'
copySrc
:
true
copyDst
:
true
storage
:
true
readWriteStorage
:
false
bytes
:
16
}
colorRender
:
{
blend
:
false
resolve
:
false
byteCost
:
16
alignment
:
4
}
multisample
:
false
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
rgba32sint
:
{
color
:
{
type
:
'
sint
'
copySrc
:
true
copyDst
:
true
storage
:
true
readWriteStorage
:
false
bytes
:
16
}
colorRender
:
{
blend
:
false
resolve
:
false
byteCost
:
16
alignment
:
4
}
multisample
:
false
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
rgba32float
:
{
color
:
{
type
:
'
unfilterable
-
float
'
copySrc
:
true
copyDst
:
true
storage
:
true
readWriteStorage
:
false
bytes
:
16
}
colorRender
:
{
blend
:
false
resolve
:
false
byteCost
:
16
alignment
:
4
}
multisample
:
false
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
rgb10a2uint
:
{
color
:
{
type
:
'
uint
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
4
}
colorRender
:
{
blend
:
false
resolve
:
false
byteCost
:
8
alignment
:
4
}
multisample
:
true
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
rgb10a2unorm
:
{
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
4
}
colorRender
:
{
blend
:
true
resolve
:
true
byteCost
:
8
alignment
:
4
}
multisample
:
true
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
rg11b10ufloat
:
{
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
4
}
multisample
:
false
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
rgb9e5ufloat
:
{
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
4
}
multisample
:
false
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
}
}
)
;
const
kSizedDepthStencilFormatInfo
=
formatTableWithDefaults
(
{
defaults
:
{
blockWidth
:
1
blockHeight
:
1
multisample
:
true
}
table
:
{
stencil8
:
{
stencil
:
{
type
:
'
uint
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
1
}
bytesPerBlock
:
1
}
depth16unorm
:
{
depth
:
{
type
:
'
depth
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
2
}
bytesPerBlock
:
2
}
depth32float
:
{
depth
:
{
type
:
'
depth
'
copySrc
:
true
copyDst
:
false
storage
:
false
readWriteStorage
:
false
bytes
:
4
}
bytesPerBlock
:
4
}
}
}
)
;
const
kUnsizedDepthStencilFormatInfo
=
formatTableWithDefaults
(
{
defaults
:
{
blockWidth
:
1
blockHeight
:
1
multisample
:
true
}
table
:
{
depth24plus
:
{
depth
:
{
type
:
'
depth
'
copySrc
:
false
copyDst
:
false
storage
:
false
readWriteStorage
:
false
bytes
:
undefined
}
}
'
depth24plus
-
stencil8
'
:
{
depth
:
{
type
:
'
depth
'
copySrc
:
false
copyDst
:
false
storage
:
false
readWriteStorage
:
false
bytes
:
undefined
}
stencil
:
{
type
:
'
uint
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
1
}
}
'
depth32float
-
stencil8
'
:
{
depth
:
{
type
:
'
depth
'
copySrc
:
true
copyDst
:
false
storage
:
false
readWriteStorage
:
false
bytes
:
4
}
stencil
:
{
type
:
'
uint
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
1
}
feature
:
'
depth32float
-
stencil8
'
}
}
}
)
;
const
kBCTextureFormatInfo
=
formatTableWithDefaults
(
{
defaults
:
{
blockWidth
:
4
blockHeight
:
4
multisample
:
false
feature
:
'
texture
-
compression
-
bc
'
}
table
:
{
'
bc1
-
rgba
-
unorm
'
:
{
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
8
}
baseFormat
:
'
bc1
-
rgba
-
unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
bc1
-
rgba
-
unorm
-
srgb
'
:
{
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
8
}
baseFormat
:
'
bc1
-
rgba
-
unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
bc2
-
rgba
-
unorm
'
:
{
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
16
}
baseFormat
:
'
bc2
-
rgba
-
unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
bc2
-
rgba
-
unorm
-
srgb
'
:
{
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
16
}
baseFormat
:
'
bc2
-
rgba
-
unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
bc3
-
rgba
-
unorm
'
:
{
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
16
}
baseFormat
:
'
bc3
-
rgba
-
unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
bc3
-
rgba
-
unorm
-
srgb
'
:
{
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
16
}
baseFormat
:
'
bc3
-
rgba
-
unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
bc4
-
r
-
unorm
'
:
{
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
8
}
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
bc4
-
r
-
snorm
'
:
{
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
8
}
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
bc5
-
rg
-
unorm
'
:
{
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
16
}
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
bc5
-
rg
-
snorm
'
:
{
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
16
}
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
bc6h
-
rgb
-
ufloat
'
:
{
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
16
}
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
bc6h
-
rgb
-
float
'
:
{
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
16
}
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
bc7
-
rgba
-
unorm
'
:
{
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
16
}
baseFormat
:
'
bc7
-
rgba
-
unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
bc7
-
rgba
-
unorm
-
srgb
'
:
{
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
16
}
baseFormat
:
'
bc7
-
rgba
-
unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
}
}
)
;
const
kETC2TextureFormatInfo
=
formatTableWithDefaults
(
{
defaults
:
{
blockWidth
:
4
blockHeight
:
4
multisample
:
false
feature
:
'
texture
-
compression
-
etc2
'
}
table
:
{
'
etc2
-
rgb8unorm
'
:
{
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
8
}
baseFormat
:
'
etc2
-
rgb8unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
etc2
-
rgb8unorm
-
srgb
'
:
{
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
8
}
baseFormat
:
'
etc2
-
rgb8unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
etc2
-
rgb8a1unorm
'
:
{
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
8
}
baseFormat
:
'
etc2
-
rgb8a1unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
etc2
-
rgb8a1unorm
-
srgb
'
:
{
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
8
}
baseFormat
:
'
etc2
-
rgb8a1unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
etc2
-
rgba8unorm
'
:
{
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
16
}
baseFormat
:
'
etc2
-
rgba8unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
etc2
-
rgba8unorm
-
srgb
'
:
{
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
16
}
baseFormat
:
'
etc2
-
rgba8unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
eac
-
r11unorm
'
:
{
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
8
}
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
eac
-
r11snorm
'
:
{
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
8
}
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
eac
-
rg11unorm
'
:
{
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
16
}
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
eac
-
rg11snorm
'
:
{
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
16
}
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
}
}
)
;
const
kASTCTextureFormatInfo
=
formatTableWithDefaults
(
{
defaults
:
{
multisample
:
false
feature
:
'
texture
-
compression
-
astc
'
}
table
:
{
'
astc
-
4x4
-
unorm
'
:
{
blockWidth
:
4
blockHeight
:
4
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
16
}
baseFormat
:
'
astc
-
4x4
-
unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
astc
-
4x4
-
unorm
-
srgb
'
:
{
blockWidth
:
4
blockHeight
:
4
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
16
}
baseFormat
:
'
astc
-
4x4
-
unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
astc
-
5x4
-
unorm
'
:
{
blockWidth
:
5
blockHeight
:
4
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
16
}
baseFormat
:
'
astc
-
5x4
-
unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
astc
-
5x4
-
unorm
-
srgb
'
:
{
blockWidth
:
5
blockHeight
:
4
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
16
}
baseFormat
:
'
astc
-
5x4
-
unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
astc
-
5x5
-
unorm
'
:
{
blockWidth
:
5
blockHeight
:
5
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
16
}
baseFormat
:
'
astc
-
5x5
-
unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
astc
-
5x5
-
unorm
-
srgb
'
:
{
blockWidth
:
5
blockHeight
:
5
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
16
}
baseFormat
:
'
astc
-
5x5
-
unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
astc
-
6x5
-
unorm
'
:
{
blockWidth
:
6
blockHeight
:
5
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
16
}
baseFormat
:
'
astc
-
6x5
-
unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
astc
-
6x5
-
unorm
-
srgb
'
:
{
blockWidth
:
6
blockHeight
:
5
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
16
}
baseFormat
:
'
astc
-
6x5
-
unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
astc
-
6x6
-
unorm
'
:
{
blockWidth
:
6
blockHeight
:
6
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
16
}
baseFormat
:
'
astc
-
6x6
-
unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
astc
-
6x6
-
unorm
-
srgb
'
:
{
blockWidth
:
6
blockHeight
:
6
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
16
}
baseFormat
:
'
astc
-
6x6
-
unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
astc
-
8x5
-
unorm
'
:
{
blockWidth
:
8
blockHeight
:
5
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
16
}
baseFormat
:
'
astc
-
8x5
-
unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
astc
-
8x5
-
unorm
-
srgb
'
:
{
blockWidth
:
8
blockHeight
:
5
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
16
}
baseFormat
:
'
astc
-
8x5
-
unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
astc
-
8x6
-
unorm
'
:
{
blockWidth
:
8
blockHeight
:
6
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
16
}
baseFormat
:
'
astc
-
8x6
-
unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
astc
-
8x6
-
unorm
-
srgb
'
:
{
blockWidth
:
8
blockHeight
:
6
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
16
}
baseFormat
:
'
astc
-
8x6
-
unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
astc
-
8x8
-
unorm
'
:
{
blockWidth
:
8
blockHeight
:
8
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
16
}
baseFormat
:
'
astc
-
8x8
-
unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
astc
-
8x8
-
unorm
-
srgb
'
:
{
blockWidth
:
8
blockHeight
:
8
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
16
}
baseFormat
:
'
astc
-
8x8
-
unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
astc
-
10x5
-
unorm
'
:
{
blockWidth
:
10
blockHeight
:
5
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
16
}
baseFormat
:
'
astc
-
10x5
-
unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
astc
-
10x5
-
unorm
-
srgb
'
:
{
blockWidth
:
10
blockHeight
:
5
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
16
}
baseFormat
:
'
astc
-
10x5
-
unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
astc
-
10x6
-
unorm
'
:
{
blockWidth
:
10
blockHeight
:
6
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
16
}
baseFormat
:
'
astc
-
10x6
-
unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
astc
-
10x6
-
unorm
-
srgb
'
:
{
blockWidth
:
10
blockHeight
:
6
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
16
}
baseFormat
:
'
astc
-
10x6
-
unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
astc
-
10x8
-
unorm
'
:
{
blockWidth
:
10
blockHeight
:
8
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
16
}
baseFormat
:
'
astc
-
10x8
-
unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
astc
-
10x8
-
unorm
-
srgb
'
:
{
blockWidth
:
10
blockHeight
:
8
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
16
}
baseFormat
:
'
astc
-
10x8
-
unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
astc
-
10x10
-
unorm
'
:
{
blockWidth
:
10
blockHeight
:
10
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
16
}
baseFormat
:
'
astc
-
10x10
-
unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
astc
-
10x10
-
unorm
-
srgb
'
:
{
blockWidth
:
10
blockHeight
:
10
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
16
}
baseFormat
:
'
astc
-
10x10
-
unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
astc
-
12x10
-
unorm
'
:
{
blockWidth
:
12
blockHeight
:
10
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
16
}
baseFormat
:
'
astc
-
12x10
-
unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
astc
-
12x10
-
unorm
-
srgb
'
:
{
blockWidth
:
12
blockHeight
:
10
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
16
}
baseFormat
:
'
astc
-
12x10
-
unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
astc
-
12x12
-
unorm
'
:
{
blockWidth
:
12
blockHeight
:
12
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
16
}
baseFormat
:
'
astc
-
12x12
-
unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
astc
-
12x12
-
unorm
-
srgb
'
:
{
blockWidth
:
12
blockHeight
:
12
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
16
}
baseFormat
:
'
astc
-
12x12
-
unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
}
}
)
;
const
kCompressedTextureFormatInfo
=
{
.
.
.
kBCTextureFormatInfo
.
.
.
kETC2TextureFormatInfo
.
.
.
kASTCTextureFormatInfo
}
;
const
kColorTextureFormatInfo
=
{
.
.
.
kRegularTextureFormatInfo
.
.
.
kCompressedTextureFormatInfo
}
;
const
kEncodableTextureFormatInfo
=
{
.
.
.
kRegularTextureFormatInfo
.
.
.
kSizedDepthStencilFormatInfo
}
;
const
kSizedTextureFormatInfo
=
{
.
.
.
kRegularTextureFormatInfo
.
.
.
kSizedDepthStencilFormatInfo
.
.
.
kCompressedTextureFormatInfo
}
;
const
kDepthStencilFormatInfo
=
{
.
.
.
kSizedDepthStencilFormatInfo
.
.
.
kUnsizedDepthStencilFormatInfo
}
;
const
kUncompressedTextureFormatInfo
=
{
.
.
.
kRegularTextureFormatInfo
.
.
.
kSizedDepthStencilFormatInfo
.
.
.
kUnsizedDepthStencilFormatInfo
}
;
const
kAllTextureFormatInfo
=
{
.
.
.
kUncompressedTextureFormatInfo
.
.
.
kCompressedTextureFormatInfo
}
;
export
const
kRegularTextureFormats
=
keysOf
(
kRegularTextureFormatInfo
)
;
export
const
kSizedDepthStencilFormats
=
keysOf
(
kSizedDepthStencilFormatInfo
)
;
export
const
kUnsizedDepthStencilFormats
=
keysOf
(
kUnsizedDepthStencilFormatInfo
)
;
export
const
kCompressedTextureFormats
=
keysOf
(
kCompressedTextureFormatInfo
)
;
export
const
kColorTextureFormats
=
keysOf
(
kColorTextureFormatInfo
)
;
export
const
kEncodableTextureFormats
=
keysOf
(
kEncodableTextureFormatInfo
)
;
export
const
kSizedTextureFormats
=
keysOf
(
kSizedTextureFormatInfo
)
;
export
const
kDepthStencilFormats
=
keysOf
(
kDepthStencilFormatInfo
)
;
export
const
kUncompressedTextureFormats
=
keysOf
(
kUncompressedTextureFormatInfo
)
;
export
const
kAllTextureFormats
=
keysOf
(
kAllTextureFormatInfo
)
;
const
kTextureFormatInfo
=
{
.
.
.
kRegularTextureFormatInfo
.
.
.
kSizedDepthStencilFormatInfo
.
.
.
kUnsizedDepthStencilFormatInfo
.
.
.
kBCTextureFormatInfo
.
.
.
kETC2TextureFormatInfo
.
.
.
kASTCTextureFormatInfo
}
;
const
kTextureFormatInfo_TypeCheck
=
kTextureFormatInfo
;
export
const
kDepthTextureFormats
=
[
.
.
.
kDepthStencilFormats
.
filter
(
(
v
)
=
>
kTextureFormatInfo
[
v
]
.
depth
)
]
;
export
const
kStencilTextureFormats
=
kDepthStencilFormats
.
filter
(
(
v
)
=
>
kTextureFormatInfo
[
v
]
.
stencil
)
;
export
const
kPossibleStorageTextureFormats
=
[
.
.
.
kRegularTextureFormats
.
filter
(
(
f
)
=
>
kTextureFormatInfo
[
f
]
.
color
?
.
storage
)
'
bgra8unorm
'
]
;
export
const
kPossibleReadWriteStorageTextureFormats
=
[
.
.
.
kPossibleStorageTextureFormats
.
filter
(
(
f
)
=
>
kTextureFormatInfo
[
f
]
.
color
?
.
readWriteStorage
)
]
;
export
const
kPossibleMultisampledTextureFormats
=
[
.
.
.
kRegularTextureFormats
.
filter
(
(
f
)
=
>
kTextureFormatInfo
[
f
]
.
multisample
)
.
.
.
kDepthStencilFormats
.
filter
(
(
f
)
=
>
kTextureFormatInfo
[
f
]
.
multisample
)
'
rg11b10ufloat
'
]
;
export
const
kPossibleColorRenderableTextureFormats
=
[
.
.
.
kRegularTextureFormats
.
filter
(
(
f
)
=
>
kTextureFormatInfo
[
f
]
.
colorRender
)
'
rg11b10ufloat
'
]
;
export
const
kDifferentBaseFormatTextureFormats
=
kColorTextureFormats
.
filter
(
(
f
)
=
>
kTextureFormatInfo
[
f
]
.
baseFormat
&
&
kTextureFormatInfo
[
f
]
.
baseFormat
!
=
=
f
)
;
export
const
kDifferentBaseFormatRegularTextureFormats
=
kRegularTextureFormats
.
filter
(
(
f
)
=
>
kTextureFormatInfo
[
f
]
.
baseFormat
&
&
kTextureFormatInfo
[
f
]
.
baseFormat
!
=
=
f
)
;
export
const
kOptionalTextureFormats
=
kAllTextureFormats
.
filter
(
(
t
)
=
>
kTextureFormatInfo
[
t
]
.
feature
!
=
=
undefined
)
;
export
const
kValidTextureFormatsForCopyE2T
=
[
'
r8unorm
'
'
r16float
'
'
r32float
'
'
rg8unorm
'
'
rg16float
'
'
rg32float
'
'
rgba8unorm
'
'
rgba8unorm
-
srgb
'
'
bgra8unorm
'
'
bgra8unorm
-
srgb
'
'
rgb10a2unorm
'
'
rgba16float
'
'
rgba32float
'
]
;
const
kDepthStencilFormatCapabilityInBufferTextureCopy
=
{
depth24plus
:
{
CopyB2T
:
[
]
CopyT2B
:
[
]
texelAspectSize
:
{
'
depth
-
only
'
:
-
1
'
stencil
-
only
'
:
-
1
}
}
'
depth24plus
-
stencil8
'
:
{
CopyB2T
:
[
'
stencil
-
only
'
]
CopyT2B
:
[
'
stencil
-
only
'
]
texelAspectSize
:
{
'
depth
-
only
'
:
-
1
'
stencil
-
only
'
:
1
}
}
depth16unorm
:
{
CopyB2T
:
[
'
all
'
'
depth
-
only
'
]
CopyT2B
:
[
'
all
'
'
depth
-
only
'
]
texelAspectSize
:
{
'
depth
-
only
'
:
2
'
stencil
-
only
'
:
-
1
}
}
depth32float
:
{
CopyB2T
:
[
]
CopyT2B
:
[
'
all
'
'
depth
-
only
'
]
texelAspectSize
:
{
'
depth
-
only
'
:
4
'
stencil
-
only
'
:
-
1
}
}
'
depth32float
-
stencil8
'
:
{
CopyB2T
:
[
'
stencil
-
only
'
]
CopyT2B
:
[
'
depth
-
only
'
'
stencil
-
only
'
]
texelAspectSize
:
{
'
depth
-
only
'
:
4
'
stencil
-
only
'
:
1
}
}
stencil8
:
{
CopyB2T
:
[
'
all
'
'
stencil
-
only
'
]
CopyT2B
:
[
'
all
'
'
stencil
-
only
'
]
texelAspectSize
:
{
'
depth
-
only
'
:
-
1
'
stencil
-
only
'
:
1
}
}
}
;
export
const
kDepthStencilFormatResolvedAspect
=
{
depth24plus
:
{
all
:
'
depth24plus
'
'
depth
-
only
'
:
'
depth24plus
'
'
stencil
-
only
'
:
undefined
}
'
depth24plus
-
stencil8
'
:
{
all
:
'
depth24plus
-
stencil8
'
'
depth
-
only
'
:
'
depth24plus
'
'
stencil
-
only
'
:
'
stencil8
'
}
depth16unorm
:
{
all
:
'
depth16unorm
'
'
depth
-
only
'
:
'
depth16unorm
'
'
stencil
-
only
'
:
undefined
}
depth32float
:
{
all
:
'
depth32float
'
'
depth
-
only
'
:
'
depth32float
'
'
stencil
-
only
'
:
undefined
}
'
depth32float
-
stencil8
'
:
{
all
:
'
depth32float
-
stencil8
'
'
depth
-
only
'
:
'
depth32float
'
'
stencil
-
only
'
:
'
stencil8
'
}
stencil8
:
{
all
:
'
stencil8
'
'
depth
-
only
'
:
undefined
'
stencil
-
only
'
:
'
stencil8
'
}
}
;
export
function
resolvePerAspectFormat
(
format
aspect
)
{
if
(
aspect
=
=
=
'
all
'
|
|
aspect
=
=
=
undefined
)
{
return
format
;
}
assert
(
!
!
kTextureFormatInfo
[
format
]
.
depth
|
|
!
!
kTextureFormatInfo
[
format
]
.
stencil
)
;
const
resolved
=
kDepthStencilFormatResolvedAspect
[
format
]
[
aspect
?
?
'
all
'
]
;
assert
(
resolved
!
=
=
undefined
)
;
return
resolved
;
}
export
function
sampleTypeForFormatAndAspect
(
format
aspect
)
{
const
info
=
kTextureFormatInfo
[
format
]
;
if
(
info
.
color
)
{
assert
(
aspect
=
=
=
'
all
'
color
format
{
format
}
used
with
aspect
{
aspect
}
)
;
return
info
.
color
.
type
;
}
else
if
(
info
.
depth
&
&
info
.
stencil
)
{
if
(
aspect
=
=
=
'
depth
-
only
'
)
{
return
info
.
depth
.
type
;
}
else
if
(
aspect
=
=
=
'
stencil
-
only
'
)
{
return
info
.
stencil
.
type
;
}
else
{
unreachable
(
depth
-
stencil
format
{
format
}
used
with
aspect
{
aspect
}
)
;
}
}
else
if
(
info
.
depth
)
{
assert
(
aspect
!
=
=
'
stencil
-
only
'
depth
-
only
format
{
format
}
used
with
aspect
{
aspect
}
)
;
return
info
.
depth
.
type
;
}
else
if
(
info
.
stencil
)
{
assert
(
aspect
!
=
=
'
depth
-
only
'
stencil
-
only
format
{
format
}
used
with
aspect
{
aspect
}
)
;
return
info
.
stencil
.
type
;
}
unreachable
(
)
;
}
export
function
depthStencilFormatCopyableAspects
(
type
format
)
{
const
appliedType
=
type
=
=
=
'
WriteTexture
'
?
'
CopyB2T
'
:
type
;
return
kDepthStencilFormatCapabilityInBufferTextureCopy
[
format
]
[
appliedType
]
;
}
export
function
depthStencilBufferTextureCopySupported
(
type
format
aspect
)
{
const
supportedAspects
=
depthStencilFormatCopyableAspects
(
type
format
)
;
return
supportedAspects
.
includes
(
aspect
)
;
}
export
function
depthStencilFormatAspectSize
(
format
aspect
)
{
const
texelAspectSize
=
kDepthStencilFormatCapabilityInBufferTextureCopy
[
format
]
.
texelAspectSize
[
aspect
]
;
assert
(
texelAspectSize
>
0
)
;
return
texelAspectSize
;
}
export
function
textureDimensionAndFormatCompatible
(
dimension
format
)
{
const
info
=
kAllTextureFormatInfo
[
format
]
;
return
!
(
(
dimension
=
=
=
'
1d
'
|
|
dimension
=
=
=
'
3d
'
)
&
&
(
info
.
blockWidth
>
1
|
|
info
.
depth
|
|
info
.
stencil
)
)
;
}
export
function
textureFormatsAreViewCompatible
(
device
a
b
)
{
return
isCompatibilityDevice
(
device
)
?
a
=
=
=
b
:
a
=
=
=
b
|
|
a
+
'
-
srgb
'
=
=
=
b
|
|
b
+
'
-
srgb
'
=
=
=
a
;
}
export
function
getBlockInfoForColorTextureFormat
(
format
)
{
const
info
=
kTextureFormatInfo
[
format
]
;
return
{
blockWidth
:
info
.
blockWidth
blockHeight
:
info
.
blockHeight
bytesPerBlock
:
info
.
color
?
.
bytes
}
;
}
export
function
getBlockInfoForSizedTextureFormat
(
format
)
{
const
info
=
kTextureFormatInfo
[
format
]
;
const
bytesPerBlock
=
info
.
color
?
.
bytes
|
|
info
.
depth
?
.
bytes
|
|
info
.
stencil
?
.
bytes
;
assert
(
!
!
bytesPerBlock
)
;
return
{
blockWidth
:
info
.
blockWidth
blockHeight
:
info
.
blockHeight
bytesPerBlock
}
;
}
export
function
getBlockInfoForEncodableTextureFormat
(
format
)
{
const
info
=
kTextureFormatInfo
[
format
]
;
const
bytesPerBlock
=
info
.
color
?
.
bytes
|
|
info
.
depth
?
.
bytes
|
|
info
.
stencil
?
.
bytes
;
assert
(
!
!
bytesPerBlock
)
;
return
{
blockWidth
:
info
.
blockWidth
blockHeight
:
info
.
blockHeight
bytesPerBlock
}
;
}
export
function
getBlockInfoForTextureFormat
(
format
)
{
const
info
=
kTextureFormatInfo
[
format
]
;
return
{
blockWidth
:
info
.
blockWidth
blockHeight
:
info
.
blockHeight
bytesPerBlock
:
info
.
color
?
.
bytes
?
?
info
.
depth
?
.
bytes
?
?
info
.
stencil
?
.
bytes
}
;
}
export
function
getColorRenderByteCost
(
format
)
{
const
byteCost
=
format
=
=
=
'
rg11b10ufloat
'
?
8
:
kTextureFormatInfo
[
format
]
.
colorRender
?
.
byteCost
;
assert
(
byteCost
!
=
=
undefined
)
;
return
byteCost
;
}
export
function
getColorRenderAlignment
(
format
)
{
const
alignment
=
format
=
=
=
'
rg11b10ufloat
'
?
1
:
kTextureFormatInfo
[
format
]
.
colorRender
?
.
alignment
;
assert
(
alignment
!
=
=
undefined
)
;
return
alignment
;
}
export
function
getBaseFormatForTextureFormat
(
format
)
{
return
kTextureFormatInfo
[
format
]
.
baseFormat
;
}
export
function
getBaseFormatForRegularTextureFormat
(
format
)
{
return
kTextureFormatInfo
[
format
]
.
baseFormat
;
}
export
function
getRequiredFeatureForTextureFormat
(
format
)
{
return
kTextureFormatInfo
[
format
]
.
feature
;
}
export
function
getFeaturesForFormats
(
formats
)
{
return
Array
.
from
(
new
Set
(
formats
.
map
(
(
f
)
=
>
f
?
kTextureFormatInfo
[
f
]
.
feature
:
undefined
)
)
)
;
}
export
function
filterFormatsByFeature
(
feature
formats
)
{
return
formats
.
filter
(
(
f
)
=
>
f
=
=
=
undefined
|
|
kTextureFormatInfo
[
f
]
.
feature
=
=
=
feature
)
;
}
export
function
canCopyToAspectOfTextureFormat
(
format
aspect
)
{
const
info
=
kTextureFormatInfo
[
format
]
;
switch
(
aspect
)
{
case
'
depth
-
only
'
:
assert
(
isDepthTextureFormat
(
format
)
)
;
return
info
.
depth
&
&
info
.
depth
.
copyDst
;
case
'
stencil
-
only
'
:
assert
(
isStencilTextureFormat
(
format
)
)
;
return
info
.
stencil
&
&
info
.
stencil
.
copyDst
;
case
'
all
'
:
return
(
(
!
isDepthTextureFormat
(
format
)
|
|
info
.
depth
?
.
copyDst
)
&
&
(
!
isStencilTextureFormat
(
format
)
|
|
info
.
stencil
?
.
copyDst
)
&
&
(
!
isColorTextureFormat
(
format
)
|
|
!
info
.
color
?
.
copyDst
)
)
;
}
}
export
function
canCopyFromAspectOfTextureFormat
(
format
aspect
)
{
const
info
=
kTextureFormatInfo
[
format
]
;
switch
(
aspect
)
{
case
'
depth
-
only
'
:
assert
(
isDepthTextureFormat
(
format
)
)
;
return
info
.
depth
&
&
info
.
depth
.
copySrc
;
case
'
stencil
-
only
'
:
assert
(
isStencilTextureFormat
(
format
)
)
;
return
info
.
stencil
&
&
info
.
stencil
.
copySrc
;
case
'
all
'
:
return
(
(
!
isDepthTextureFormat
(
format
)
|
|
info
.
depth
?
.
copySrc
)
&
&
(
!
isStencilTextureFormat
(
format
)
|
|
info
.
stencil
?
.
copySrc
)
&
&
(
!
isColorTextureFormat
(
format
)
|
|
!
info
.
color
?
.
copySrc
)
)
;
}
}
export
function
canCopyToAllAspectsOfTextureFormat
(
format
)
{
const
info
=
kTextureFormatInfo
[
format
]
;
return
(
(
!
info
.
color
|
|
info
.
color
.
copyDst
)
&
&
(
!
info
.
depth
|
|
info
.
depth
.
copyDst
)
&
&
(
!
info
.
stencil
|
|
info
.
stencil
.
copyDst
)
)
;
}
export
function
canCopyFromAllAspectsOfTextureFormat
(
format
)
{
const
info
=
kTextureFormatInfo
[
format
]
;
return
(
(
!
info
.
color
|
|
info
.
color
.
copySrc
)
&
&
(
!
info
.
depth
|
|
info
.
depth
.
copySrc
)
&
&
(
!
info
.
stencil
|
|
info
.
stencil
.
copySrc
)
)
;
}
export
function
isCompressedTextureFormat
(
format
)
{
return
format
in
kCompressedTextureFormatInfo
;
}
export
function
isColorTextureFormat
(
format
)
{
return
!
!
kTextureFormatInfo
[
format
]
.
color
;
}
export
function
isDepthTextureFormat
(
format
)
{
return
!
!
kTextureFormatInfo
[
format
]
.
depth
;
}
export
function
isStencilTextureFormat
(
format
)
{
return
!
!
kTextureFormatInfo
[
format
]
.
stencil
;
}
export
function
isDepthOrStencilTextureFormat
(
format
)
{
return
isDepthTextureFormat
(
format
)
|
|
isStencilTextureFormat
(
format
)
;
}
export
function
isEncodableTextureFormat
(
format
)
{
return
kEncodableTextureFormats
.
includes
(
format
)
;
}
export
function
isTextureFormatUsableAsRenderAttachment
(
device
format
)
{
if
(
format
=
=
=
'
rg11b10ufloat
'
&
&
device
.
features
.
has
(
'
rg11b10ufloat
-
renderable
'
)
)
{
return
true
;
}
return
kTextureFormatInfo
[
format
]
.
colorRender
|
|
isDepthOrStencilTextureFormat
(
format
)
;
}
export
function
isTextureFormatColorRenderable
(
device
format
)
{
if
(
format
=
=
=
'
rg11b10ufloat
'
&
&
device
.
features
.
has
(
'
rg11b10ufloat
-
renderable
'
)
)
{
return
true
;
}
return
!
!
kAllTextureFormatInfo
[
format
]
.
colorRender
;
}
export
function
isTextureFormatBlendable
(
device
format
)
{
if
(
!
isTextureFormatColorRenderable
(
device
format
)
)
{
return
false
;
}
if
(
format
=
=
=
'
rg11b10ufloat
'
&
&
device
.
features
.
has
(
'
rg11b10ufloat
-
renderable
'
)
)
{
return
true
;
}
if
(
is32Float
(
format
)
&
&
device
.
features
.
has
(
'
float32
-
blendable
'
)
)
{
return
true
;
}
return
!
!
kAllTextureFormatInfo
[
format
]
.
colorRender
?
.
blend
;
}
export
function
getTextureFormatType
(
format
)
{
const
info
=
kTextureFormatInfo
[
format
]
;
const
type
=
info
.
color
?
.
type
?
?
info
.
depth
?
.
type
?
?
info
.
stencil
?
.
type
;
assert
(
!
!
type
)
;
return
type
;
}
export
function
getTextureFormatColorType
(
format
)
{
const
info
=
kTextureFormatInfo
[
format
]
;
const
type
=
info
.
color
?
.
type
;
assert
(
!
!
type
)
;
return
type
;
}
export
function
isTextureFormatPossiblyUsableAsRenderAttachment
(
format
)
{
const
info
=
kTextureFormatInfo
[
format
]
;
return
format
=
=
=
'
rg11b10ufloat
'
|
|
isDepthOrStencilTextureFormat
(
format
)
|
|
!
!
info
.
colorRender
;
}
export
function
isTextureFormatPossiblyUsableAsColorRenderAttachment
(
format
)
{
const
info
=
kTextureFormatInfo
[
format
]
;
return
format
=
=
=
'
rg11b10ufloat
'
|
|
!
!
info
.
colorRender
;
}
export
function
isTextureFormatPossiblyMultisampled
(
format
)
{
const
info
=
kTextureFormatInfo
[
format
]
;
return
format
=
=
=
'
rg11b10ufloat
'
|
|
info
.
multisample
;
}
export
function
isTextureFormatPossiblyStorageReadable
(
format
)
{
return
!
!
kTextureFormatInfo
[
format
]
.
color
?
.
storage
;
}
export
function
isTextureFormatPossiblyStorageReadWritable
(
format
)
{
return
!
!
kTextureFormatInfo
[
format
]
.
color
?
.
readWriteStorage
;
}
export
function
is16Float
(
format
)
{
return
format
=
=
=
'
r16float
'
|
|
format
=
=
=
'
rg16float
'
|
|
format
=
=
=
'
rgba16float
'
;
}
export
function
is32Float
(
format
)
{
return
format
=
=
=
'
r32float
'
|
|
format
=
=
=
'
rg32float
'
|
|
format
=
=
=
'
rgba32float
'
;
}
export
function
isTextureFormatPossiblyFilterableAsTextureF32
(
format
)
{
const
info
=
kTextureFormatInfo
[
format
]
;
return
info
.
color
?
.
type
=
=
=
'
float
'
|
|
is32Float
(
format
)
;
}
export
const
kCompatModeUnsupportedStorageTextureFormats
=
[
'
rg32float
'
'
rg32sint
'
'
rg32uint
'
]
;
export
function
isTextureFormatUsableAsStorageFormat
(
device
format
)
{
if
(
isCompatibilityDevice
(
device
)
)
{
if
(
kCompatModeUnsupportedStorageTextureFormats
.
indexOf
(
format
)
>
=
0
)
{
return
false
;
}
}
if
(
format
=
=
=
'
bgra8unorm
'
&
&
device
.
features
.
has
(
'
bgra8unorm
-
storage
'
)
)
{
return
true
;
}
const
info
=
kTextureFormatInfo
[
format
]
;
return
!
!
(
info
.
color
?
.
storage
|
|
info
.
depth
?
.
storage
|
|
info
.
stencil
?
.
storage
)
;
}
export
function
isTextureFormatUsableAsStorageFormatInCreateShaderModule
(
device
format
)
{
if
(
format
=
=
=
'
bgra8unorm
'
)
{
return
true
;
}
const
info
=
kTextureFormatInfo
[
format
]
;
return
!
!
(
info
.
color
?
.
storage
|
|
info
.
depth
?
.
storage
|
|
info
.
stencil
?
.
storage
)
;
}
export
function
isTextureFormatUsableAsReadWriteStorageTexture
(
device
format
)
{
return
(
isTextureFormatUsableAsStorageFormat
(
device
format
)
&
&
!
!
kTextureFormatInfo
[
format
]
.
color
?
.
readWriteStorage
)
;
}
export
function
isRegularTextureFormat
(
format
)
{
return
format
in
kRegularTextureFormatInfo
;
}
export
function
isCompressedFloatTextureFormat
(
format
)
{
return
isCompressedTextureFormat
(
format
)
&
&
format
.
includes
(
'
float
'
)
;
}
export
function
isSintOrUintFormat
(
format
)
{
const
info
=
kTextureFormatInfo
[
format
]
;
const
type
=
info
.
color
?
.
type
?
?
info
.
depth
?
.
type
?
?
info
.
stencil
?
.
type
;
return
type
=
=
=
'
sint
'
|
|
type
=
=
=
'
uint
'
;
}
export
const
kCompatModeUnsupportedMultisampledTextureFormats
=
[
'
r8uint
'
'
r8sint
'
'
rg8uint
'
'
rg8sint
'
'
rgba8uint
'
'
rgba8sint
'
'
r16uint
'
'
r16sint
'
'
rg16uint
'
'
rg16sint
'
'
rgba16uint
'
'
rgba16sint
'
'
rgb10a2uint
'
'
rgba16float
'
'
r32float
'
]
;
export
function
isTextureFormatMultisampled
(
device
format
)
{
if
(
isCompatibilityDevice
(
device
)
)
{
if
(
kCompatModeUnsupportedMultisampledTextureFormats
.
indexOf
(
format
)
>
=
0
)
{
return
false
;
}
}
if
(
format
=
=
=
'
rg11b10ufloat
'
&
&
device
.
features
.
has
(
'
rg11b10ufloat
-
renderable
'
)
)
{
return
true
;
}
return
kAllTextureFormatInfo
[
format
]
.
multisample
;
}
export
function
isTextureFormatResolvable
(
device
format
)
{
if
(
format
=
=
=
'
rg11b10ufloat
'
&
&
device
.
features
.
has
(
'
rg11b10ufloat
-
renderable
'
)
)
{
return
true
;
}
if
(
!
isTextureFormatMultisampled
(
device
format
)
)
{
return
false
;
}
const
info
=
kAllTextureFormatInfo
[
format
]
;
return
!
!
info
.
colorRender
?
.
resolve
;
}
export
const
kFeaturesForFormats
=
getFeaturesForFormats
(
kAllTextureFormats
)
;
export
function
computeBytesPerSampleFromFormats
(
formats
)
{
let
bytesPerSample
=
0
;
for
(
const
format
of
formats
)
{
const
info
=
format
=
=
=
'
rg11b10ufloat
'
?
{
colorRender
:
{
alignment
:
4
byteCost
:
8
}
}
:
kTextureFormatInfo
[
format
]
;
const
alignedBytesPerSample
=
align
(
bytesPerSample
info
.
colorRender
.
alignment
)
;
bytesPerSample
=
alignedBytesPerSample
+
info
.
colorRender
.
byteCost
;
}
return
bytesPerSample
;
}
export
function
computeBytesPerSample
(
targets
)
{
return
computeBytesPerSampleFromFormats
(
targets
.
map
(
(
{
format
}
)
=
>
format
)
)
;
}
