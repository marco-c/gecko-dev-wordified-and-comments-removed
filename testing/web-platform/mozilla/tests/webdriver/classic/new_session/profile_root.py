import
copy
import
os
import
pytest
pytestmark
=
pytest
.
mark
.
asyncio
async
def
test_profile_root
(
tmp_path
configuration
geckodriver
default_preferences
)
:
    
profile_path
=
os
.
path
.
join
(
tmp_path
"
geckodriver
-
test
"
)
    
os
.
makedirs
(
profile_path
)
    
config
=
copy
.
deepcopy
(
configuration
)
    
config
[
"
capabilities
"
]
[
"
moz
:
firefoxOptions
"
]
[
"
prefs
"
]
=
default_preferences
    
del
config
[
"
capabilities
"
]
[
"
moz
:
firefoxOptions
"
]
[
"
args
"
]
    
extra_args
=
[
"
-
-
profile
-
root
"
profile_path
]
    
assert
os
.
listdir
(
profile_path
)
=
=
[
]
    
driver
=
geckodriver
(
config
=
config
extra_args
=
extra_args
)
    
driver
.
new_session
(
)
    
assert
len
(
os
.
listdir
(
profile_path
)
)
=
=
1
    
await
driver
.
delete_session
(
)
    
assert
os
.
listdir
(
profile_path
)
=
=
[
]
def
test_profile_root_missing
(
tmp_path
configuration
geckodriver
)
:
    
profile_path
=
os
.
path
.
join
(
tmp_path
"
missing
-
path
"
)
    
assert
not
os
.
path
.
exists
(
profile_path
)
    
config
=
copy
.
deepcopy
(
configuration
)
    
del
config
[
"
capabilities
"
]
[
"
moz
:
firefoxOptions
"
]
[
"
args
"
]
    
extra_args
=
[
"
-
-
profile
-
root
"
profile_path
]
    
with
pytest
.
raises
(
ChildProcessError
)
as
exc_info
:
        
geckodriver
(
config
=
config
extra_args
=
extra_args
)
    
assert
str
(
exc_info
.
value
)
=
=
"
geckodriver
terminated
with
code
64
"
