#
ifndef
mozilla_CSSEditUtils_h
#
define
mozilla_CSSEditUtils_h
#
include
"
mozilla
/
ChangeStyleTransaction
.
h
"
#
include
"
nsCOMPtr
.
h
"
#
include
"
nsStringFwd
.
h
"
#
include
"
nsTArray
.
h
"
#
include
"
nscore
.
h
"
class
nsComputedDOMStyle
;
class
nsAtom
;
class
nsIContent
;
class
nsICSSDeclaration
;
class
nsINode
;
namespace
mozilla
{
class
HTMLEditor
;
namespace
dom
{
class
Element
;
}
typedef
void
(
*
nsProcessValueFunc
)
(
const
nsAString
*
aInputString
nsAString
&
aOutputString
const
char
*
aDefaultValueString
const
char
*
aPrependString
const
char
*
aAppendString
)
;
class
CSSEditUtils
final
{
public
:
explicit
CSSEditUtils
(
HTMLEditor
*
aEditor
)
;
enum
nsCSSEditableProperty
{
eCSSEditableProperty_NONE
=
0
eCSSEditableProperty_background_color
eCSSEditableProperty_background_image
eCSSEditableProperty_border
eCSSEditableProperty_caption_side
eCSSEditableProperty_color
eCSSEditableProperty_float
eCSSEditableProperty_font_family
eCSSEditableProperty_font_size
eCSSEditableProperty_font_style
eCSSEditableProperty_font_weight
eCSSEditableProperty_height
eCSSEditableProperty_list_style_type
eCSSEditableProperty_margin_left
eCSSEditableProperty_margin_right
eCSSEditableProperty_text_align
eCSSEditableProperty_text_decoration
eCSSEditableProperty_vertical_align
eCSSEditableProperty_whitespace
eCSSEditableProperty_width
}
;
struct
CSSEquivTable
{
nsCSSEditableProperty
cssProperty
;
nsProcessValueFunc
processValueFunctor
;
const
char
*
defaultValue
;
const
char
*
prependValue
;
const
char
*
appendValue
;
bool
gettable
;
bool
caseSensitiveValue
;
}
;
static
bool
IsCSSEditableProperty
(
nsINode
*
aNode
nsAtom
*
aProperty
nsAtom
*
aAttribute
)
;
MOZ_CAN_RUN_SCRIPT
nsresult
SetCSSProperty
(
dom
:
:
Element
&
aElement
nsAtom
&
aProperty
const
nsAString
&
aValue
bool
aSuppressTxn
=
false
)
;
MOZ_CAN_RUN_SCRIPT
nsresult
SetCSSPropertyPixels
(
dom
:
:
Element
&
aElement
nsAtom
&
aProperty
int32_t
aIntValue
)
;
MOZ_CAN_RUN_SCRIPT
nsresult
RemoveCSSProperty
(
dom
:
:
Element
&
aElement
nsAtom
&
aProperty
const
nsAString
&
aPropertyValue
bool
aSuppressTxn
=
false
)
;
static
nsresult
GetSpecifiedProperty
(
nsIContent
&
aContent
nsAtom
&
aCSSProperty
nsAString
&
aValue
)
;
static
nsresult
GetComputedProperty
(
nsIContent
&
aContent
nsAtom
&
aCSSProperty
nsAString
&
aValue
)
;
MOZ_CAN_RUN_SCRIPT
nsresult
RemoveCSSInlineStyle
(
nsINode
&
aNode
nsAtom
*
aProperty
const
nsAString
&
aPropertyValue
)
;
static
bool
IsCSSInvertible
(
nsAtom
&
aProperty
nsAtom
*
aAttribute
)
;
static
void
GetDefaultBackgroundColor
(
nsAString
&
aColor
)
;
static
void
GetDefaultLengthUnit
(
nsAString
&
aLengthUnit
)
;
static
nsresult
GetComputedCSSEquivalentToHTMLInlineStyleSet
(
nsIContent
&
aContent
nsAtom
*
aHTMLProperty
nsAtom
*
aAttribute
nsAString
&
aValue
)
{
return
GetCSSEquivalentToHTMLInlineStyleSetInternal
(
aContent
aHTMLProperty
aAttribute
aValue
StyleType
:
:
Computed
)
;
}
static
nsresult
GetSpecifiedCSSEquivalentToHTMLInlineStyleSet
(
nsIContent
&
aContent
nsAtom
*
aHTMLProperty
nsAtom
*
aAttribute
nsAString
&
aValue
)
{
return
GetCSSEquivalentToHTMLInlineStyleSetInternal
(
aContent
aHTMLProperty
aAttribute
aValue
StyleType
:
:
Specified
)
;
}
static
bool
IsComputedCSSEquivalentToHTMLInlineStyleSet
(
nsIContent
&
aContent
nsAtom
*
aHTMLProperty
nsAtom
*
aAttribute
nsAString
&
aValue
)
{
MOZ_ASSERT
(
aHTMLProperty
|
|
aAttribute
)
;
return
IsCSSEquivalentToHTMLInlineStyleSetInternal
(
aContent
aHTMLProperty
aAttribute
aValue
StyleType
:
:
Computed
)
;
}
static
bool
IsSpecifiedCSSEquivalentToHTMLInlineStyleSet
(
nsIContent
&
aContent
nsAtom
*
aHTMLProperty
nsAtom
*
aAttribute
nsAString
&
aValue
)
{
MOZ_ASSERT
(
aHTMLProperty
|
|
aAttribute
)
;
return
IsCSSEquivalentToHTMLInlineStyleSetInternal
(
aContent
aHTMLProperty
aAttribute
aValue
StyleType
:
:
Specified
)
;
}
static
bool
HaveComputedCSSEquivalentStyles
(
nsIContent
&
aContent
nsAtom
*
aHTMLProperty
nsAtom
*
aAttribute
)
{
MOZ_ASSERT
(
aHTMLProperty
|
|
aAttribute
)
;
return
HaveCSSEquivalentStylesInternal
(
aContent
aHTMLProperty
aAttribute
StyleType
:
:
Computed
)
;
}
static
bool
HaveSpecifiedCSSEquivalentStyles
(
nsIContent
&
aContent
nsAtom
*
aHTMLProperty
nsAtom
*
aAttribute
)
{
MOZ_ASSERT
(
aHTMLProperty
|
|
aAttribute
)
;
return
HaveCSSEquivalentStylesInternal
(
aContent
aHTMLProperty
aAttribute
StyleType
:
:
Specified
)
;
}
MOZ_CAN_RUN_SCRIPT
int32_t
SetCSSEquivalentToHTMLStyle
(
dom
:
:
Element
*
aElement
nsAtom
*
aProperty
nsAtom
*
aAttribute
const
nsAString
*
aValue
bool
aSuppressTransaction
)
;
MOZ_CAN_RUN_SCRIPT
nsresult
RemoveCSSEquivalentToHTMLStyle
(
dom
:
:
Element
*
aElement
nsAtom
*
aHTMLProperty
nsAtom
*
aAttribute
const
nsAString
*
aValue
bool
aSuppressTransaction
)
;
static
void
ParseLength
(
const
nsAString
&
aString
float
*
aValue
nsAtom
*
*
aUnit
)
;
void
SetCSSEnabled
(
bool
aIsCSSPrefChecked
)
;
bool
IsCSSPrefChecked
(
)
const
;
static
bool
ElementsSameStyle
(
dom
:
:
Element
*
aFirstNode
dom
:
:
Element
*
aSecondNode
)
;
static
nsresult
GetInlineStyles
(
dom
:
:
Element
*
aElement
nsICSSDeclaration
*
*
aCssDecl
uint32_t
*
aLength
)
;
public
:
static
already_AddRefed
<
nsComputedDOMStyle
>
GetComputedStyle
(
dom
:
:
Element
*
aElement
)
;
private
:
enum
class
StyleType
{
Specified
Computed
}
;
static
void
GetCSSPropertyAtom
(
nsCSSEditableProperty
aProperty
nsAtom
*
*
aAtom
)
;
static
void
BuildCSSDeclarations
(
nsTArray
<
nsAtom
*
>
&
aPropertyArray
nsTArray
<
nsString
>
&
cssValueArray
const
CSSEquivTable
*
aEquivTable
const
nsAString
*
aValue
bool
aGetOrRemoveRequest
)
;
static
void
GenerateCSSDeclarationsFromHTMLStyle
(
dom
:
:
Element
*
aNode
nsAtom
*
aHTMLProperty
nsAtom
*
aAttribute
const
nsAString
*
aValue
nsTArray
<
nsAtom
*
>
&
aPropertyArray
nsTArray
<
nsString
>
&
aValueArray
bool
aGetOrRemoveRequest
)
;
static
nsresult
GetComputedCSSInlinePropertyBase
(
nsIContent
&
aContent
nsAtom
&
aCSSProperty
nsAString
&
aValue
)
;
static
nsresult
GetSpecifiedCSSInlinePropertyBase
(
nsIContent
&
aContent
nsAtom
&
aCSSProperty
nsAString
&
aValue
)
;
static
nsresult
GetCSSEquivalentToHTMLInlineStyleSetInternal
(
nsIContent
&
aContent
nsAtom
*
aHTMLProperty
nsAtom
*
aAttribute
nsAString
&
aValue
StyleType
aStyleType
)
;
static
bool
IsCSSEquivalentToHTMLInlineStyleSetInternal
(
nsIContent
&
aContent
nsAtom
*
aHTMLProperty
nsAtom
*
aAttribute
nsAString
&
aValue
StyleType
aStyleType
)
;
static
bool
HaveCSSEquivalentStylesInternal
(
nsIContent
&
aContent
nsAtom
*
aHTMLProperty
nsAtom
*
aAttribute
StyleType
aStyleType
)
;
private
:
HTMLEditor
*
mHTMLEditor
;
bool
mIsCSSPrefChecked
;
}
;
#
define
NS_EDITOR_INDENT_INCREMENT_IN
0
.
4134f
#
define
NS_EDITOR_INDENT_INCREMENT_CM
1
.
05f
#
define
NS_EDITOR_INDENT_INCREMENT_MM
10
.
5f
#
define
NS_EDITOR_INDENT_INCREMENT_PT
29
.
76f
#
define
NS_EDITOR_INDENT_INCREMENT_PC
2
.
48f
#
define
NS_EDITOR_INDENT_INCREMENT_EM
3
#
define
NS_EDITOR_INDENT_INCREMENT_EX
6
#
define
NS_EDITOR_INDENT_INCREMENT_PX
40
#
define
NS_EDITOR_INDENT_INCREMENT_PERCENT
4
}
#
endif
