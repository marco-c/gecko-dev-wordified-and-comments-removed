#
include
"
TextEditUtils
.
h
"
#
include
"
mozilla
/
Assertions
.
h
"
#
include
"
mozilla
/
TextEditor
.
h
"
#
include
"
mozilla
/
dom
/
Element
.
h
"
#
include
"
nsAString
.
h
"
#
include
"
nsCOMPtr
.
h
"
#
include
"
nsCaseTreatment
.
h
"
#
include
"
nsDebug
.
h
"
#
include
"
nsEditor
.
h
"
#
include
"
nsError
.
h
"
#
include
"
nsGkAtoms
.
h
"
#
include
"
nsIDOMElement
.
h
"
#
include
"
nsIDOMNode
.
h
"
#
include
"
nsNameSpaceManager
.
h
"
#
include
"
nsLiteralString
.
h
"
#
include
"
nsString
.
h
"
namespace
mozilla
{
bool
TextEditUtils
:
:
IsBody
(
nsIDOMNode
*
aNode
)
{
return
nsEditor
:
:
NodeIsType
(
aNode
nsGkAtoms
:
:
body
)
;
}
bool
TextEditUtils
:
:
IsBreak
(
nsIDOMNode
*
aNode
)
{
return
nsEditor
:
:
NodeIsType
(
aNode
nsGkAtoms
:
:
br
)
;
}
bool
TextEditUtils
:
:
IsBreak
(
nsINode
*
aNode
)
{
MOZ_ASSERT
(
aNode
)
;
return
aNode
-
>
IsHTMLElement
(
nsGkAtoms
:
:
br
)
;
}
bool
TextEditUtils
:
:
IsMozBR
(
nsIDOMNode
*
aNode
)
{
MOZ_ASSERT
(
aNode
)
;
return
IsBreak
(
aNode
)
&
&
HasMozAttr
(
aNode
)
;
}
bool
TextEditUtils
:
:
IsMozBR
(
nsINode
*
aNode
)
{
MOZ_ASSERT
(
aNode
)
;
return
aNode
-
>
IsHTMLElement
(
nsGkAtoms
:
:
br
)
&
&
aNode
-
>
AsElement
(
)
-
>
AttrValueIs
(
kNameSpaceID_None
nsGkAtoms
:
:
type
NS_LITERAL_STRING
(
"
_moz
"
)
eIgnoreCase
)
;
}
bool
TextEditUtils
:
:
HasMozAttr
(
nsIDOMNode
*
aNode
)
{
MOZ_ASSERT
(
aNode
)
;
nsCOMPtr
<
nsIDOMElement
>
element
=
do_QueryInterface
(
aNode
)
;
if
(
!
element
)
{
return
false
;
}
nsAutoString
typeAttrVal
;
nsresult
rv
=
element
-
>
GetAttribute
(
NS_LITERAL_STRING
(
"
type
"
)
typeAttrVal
)
;
return
NS_SUCCEEDED
(
rv
)
&
&
typeAttrVal
.
LowerCaseEqualsLiteral
(
"
_moz
"
)
;
}
AutoEditInitRulesTrigger
:
:
AutoEditInitRulesTrigger
(
TextEditor
*
aTextEditor
nsresult
&
aResult
)
:
mTextEditor
(
aTextEditor
)
mResult
(
aResult
)
{
if
(
mTextEditor
)
{
mTextEditor
-
>
BeginEditorInit
(
)
;
}
}
AutoEditInitRulesTrigger
:
:
~
AutoEditInitRulesTrigger
(
)
{
if
(
mTextEditor
)
{
mResult
=
mTextEditor
-
>
EndEditorInit
(
)
;
}
}
}
