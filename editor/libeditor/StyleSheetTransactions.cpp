#
include
"
StyleSheetTransactions
.
h
"
#
include
<
stddef
.
h
>
#
include
"
nsAString
.
h
"
#
include
"
nsCOMPtr
.
h
"
#
include
"
mozilla
/
StyleSheet
.
h
"
#
include
"
mozilla
/
StyleSheetInlines
.
h
"
#
include
"
nsDebug
.
h
"
#
include
"
nsError
.
h
"
#
include
"
nsIDocument
.
h
"
#
include
"
nsIDocumentObserver
.
h
"
namespace
mozilla
{
static
void
AddStyleSheet
(
EditorBase
&
aEditor
StyleSheet
*
aSheet
)
{
nsCOMPtr
<
nsIDocument
>
doc
=
aEditor
.
GetDocument
(
)
;
if
(
doc
)
{
doc
-
>
BeginUpdate
(
UPDATE_STYLE
)
;
doc
-
>
AddStyleSheet
(
aSheet
)
;
doc
-
>
EndUpdate
(
UPDATE_STYLE
)
;
}
}
static
void
RemoveStyleSheet
(
EditorBase
&
aEditor
StyleSheet
*
aSheet
)
{
nsCOMPtr
<
nsIDocument
>
doc
=
aEditor
.
GetDocument
(
)
;
if
(
doc
)
{
doc
-
>
BeginUpdate
(
UPDATE_STYLE
)
;
doc
-
>
RemoveStyleSheet
(
aSheet
)
;
doc
-
>
EndUpdate
(
UPDATE_STYLE
)
;
}
}
AddStyleSheetTransaction
:
:
AddStyleSheetTransaction
(
EditorBase
&
aEditorBase
StyleSheet
*
aSheet
)
:
mEditorBase
(
&
aEditorBase
)
mSheet
(
aSheet
)
{
MOZ_ASSERT
(
aSheet
)
;
}
NS_IMPL_CYCLE_COLLECTION_INHERITED
(
AddStyleSheetTransaction
EditTransactionBase
mEditorBase
mSheet
)
NS_INTERFACE_MAP_BEGIN_CYCLE_COLLECTION
(
AddStyleSheetTransaction
)
NS_INTERFACE_MAP_END_INHERITING
(
EditTransactionBase
)
NS_IMETHODIMP
AddStyleSheetTransaction
:
:
DoTransaction
(
)
{
if
(
NS_WARN_IF
(
!
mEditorBase
)
|
|
NS_WARN_IF
(
!
mSheet
)
)
{
return
NS_ERROR_NOT_INITIALIZED
;
}
AddStyleSheet
(
*
mEditorBase
mSheet
)
;
return
NS_OK
;
}
NS_IMETHODIMP
AddStyleSheetTransaction
:
:
UndoTransaction
(
)
{
if
(
NS_WARN_IF
(
!
mEditorBase
)
|
|
NS_WARN_IF
(
!
mSheet
)
)
{
return
NS_ERROR_NOT_INITIALIZED
;
}
RemoveStyleSheet
(
*
mEditorBase
mSheet
)
;
return
NS_OK
;
}
NS_IMETHODIMP
AddStyleSheetTransaction
:
:
GetTxnDescription
(
nsAString
&
aString
)
{
aString
.
AssignLiteral
(
"
AddStyleSheetTransaction
"
)
;
return
NS_OK
;
}
RemoveStyleSheetTransaction
:
:
RemoveStyleSheetTransaction
(
EditorBase
&
aEditorBase
StyleSheet
*
aSheet
)
:
mEditorBase
(
&
aEditorBase
)
mSheet
(
aSheet
)
{
MOZ_ASSERT
(
aSheet
)
;
}
NS_IMPL_CYCLE_COLLECTION_INHERITED
(
RemoveStyleSheetTransaction
EditTransactionBase
mEditorBase
mSheet
)
NS_INTERFACE_MAP_BEGIN_CYCLE_COLLECTION
(
RemoveStyleSheetTransaction
)
NS_INTERFACE_MAP_END_INHERITING
(
EditTransactionBase
)
NS_IMETHODIMP
RemoveStyleSheetTransaction
:
:
DoTransaction
(
)
{
if
(
NS_WARN_IF
(
!
mEditorBase
)
|
|
NS_WARN_IF
(
!
mSheet
)
)
{
return
NS_ERROR_NOT_INITIALIZED
;
}
RemoveStyleSheet
(
*
mEditorBase
mSheet
)
;
return
NS_OK
;
}
NS_IMETHODIMP
RemoveStyleSheetTransaction
:
:
UndoTransaction
(
)
{
if
(
NS_WARN_IF
(
!
mEditorBase
)
|
|
NS_WARN_IF
(
!
mSheet
)
)
{
return
NS_ERROR_NOT_INITIALIZED
;
}
AddStyleSheet
(
*
mEditorBase
mSheet
)
;
return
NS_OK
;
}
NS_IMETHODIMP
RemoveStyleSheetTransaction
:
:
GetTxnDescription
(
nsAString
&
aString
)
{
aString
.
AssignLiteral
(
"
RemoveStyleSheetTransaction
"
)
;
return
NS_OK
;
}
}
