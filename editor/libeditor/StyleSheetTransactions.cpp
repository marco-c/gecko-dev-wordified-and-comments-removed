#
include
"
StyleSheetTransactions
.
h
"
#
include
<
stddef
.
h
>
#
include
"
nsAString
.
h
"
#
include
"
nsCOMPtr
.
h
"
#
include
"
mozilla
/
StyleSheet
.
h
"
#
include
"
mozilla
/
StyleSheetInlines
.
h
"
#
include
"
nsDebug
.
h
"
#
include
"
nsError
.
h
"
#
include
"
nsIDOMDocument
.
h
"
#
include
"
nsIDocument
.
h
"
#
include
"
nsIDocumentObserver
.
h
"
#
include
"
nsIEditor
.
h
"
namespace
mozilla
{
static
void
AddStyleSheet
(
nsIEditor
*
aEditor
StyleSheet
*
aSheet
)
{
nsCOMPtr
<
nsIDOMDocument
>
domDoc
;
aEditor
-
>
GetDocument
(
getter_AddRefs
(
domDoc
)
)
;
nsCOMPtr
<
nsIDocument
>
doc
=
do_QueryInterface
(
domDoc
)
;
if
(
doc
)
{
doc
-
>
BeginUpdate
(
UPDATE_STYLE
)
;
doc
-
>
AddStyleSheet
(
aSheet
)
;
doc
-
>
EndUpdate
(
UPDATE_STYLE
)
;
}
}
static
void
RemoveStyleSheet
(
nsIEditor
*
aEditor
StyleSheet
*
aSheet
)
{
nsCOMPtr
<
nsIDOMDocument
>
domDoc
;
aEditor
-
>
GetDocument
(
getter_AddRefs
(
domDoc
)
)
;
nsCOMPtr
<
nsIDocument
>
doc
=
do_QueryInterface
(
domDoc
)
;
if
(
doc
)
{
doc
-
>
BeginUpdate
(
UPDATE_STYLE
)
;
doc
-
>
RemoveStyleSheet
(
aSheet
)
;
doc
-
>
EndUpdate
(
UPDATE_STYLE
)
;
}
}
AddStyleSheetTransaction
:
:
AddStyleSheetTransaction
(
)
:
mEditor
(
nullptr
)
{
}
NS_IMPL_CYCLE_COLLECTION_INHERITED
(
AddStyleSheetTransaction
EditTransactionBase
mSheet
)
NS_INTERFACE_MAP_BEGIN_CYCLE_COLLECTION
(
AddStyleSheetTransaction
)
NS_INTERFACE_MAP_END_INHERITING
(
EditTransactionBase
)
NS_IMETHODIMP
AddStyleSheetTransaction
:
:
Init
(
nsIEditor
*
aEditor
StyleSheet
*
aSheet
)
{
NS_ENSURE_TRUE
(
aEditor
&
&
aSheet
NS_ERROR_INVALID_ARG
)
;
mEditor
=
aEditor
;
mSheet
=
aSheet
;
return
NS_OK
;
}
NS_IMETHODIMP
AddStyleSheetTransaction
:
:
DoTransaction
(
)
{
NS_ENSURE_TRUE
(
mEditor
&
&
mSheet
NS_ERROR_NOT_INITIALIZED
)
;
AddStyleSheet
(
mEditor
mSheet
)
;
return
NS_OK
;
}
NS_IMETHODIMP
AddStyleSheetTransaction
:
:
UndoTransaction
(
)
{
NS_ENSURE_TRUE
(
mEditor
&
&
mSheet
NS_ERROR_NOT_INITIALIZED
)
;
RemoveStyleSheet
(
mEditor
mSheet
)
;
return
NS_OK
;
}
NS_IMETHODIMP
AddStyleSheetTransaction
:
:
GetTxnDescription
(
nsAString
&
aString
)
{
aString
.
AssignLiteral
(
"
AddStyleSheetTransaction
"
)
;
return
NS_OK
;
}
RemoveStyleSheetTransaction
:
:
RemoveStyleSheetTransaction
(
)
:
mEditor
(
nullptr
)
{
}
NS_IMPL_CYCLE_COLLECTION_INHERITED
(
RemoveStyleSheetTransaction
EditTransactionBase
mSheet
)
NS_INTERFACE_MAP_BEGIN_CYCLE_COLLECTION
(
RemoveStyleSheetTransaction
)
NS_INTERFACE_MAP_END_INHERITING
(
EditTransactionBase
)
NS_IMETHODIMP
RemoveStyleSheetTransaction
:
:
Init
(
nsIEditor
*
aEditor
StyleSheet
*
aSheet
)
{
NS_ENSURE_TRUE
(
aEditor
&
&
aSheet
NS_ERROR_INVALID_ARG
)
;
mEditor
=
aEditor
;
mSheet
=
aSheet
;
return
NS_OK
;
}
NS_IMETHODIMP
RemoveStyleSheetTransaction
:
:
DoTransaction
(
)
{
NS_ENSURE_TRUE
(
mEditor
&
&
mSheet
NS_ERROR_NOT_INITIALIZED
)
;
RemoveStyleSheet
(
mEditor
mSheet
)
;
return
NS_OK
;
}
NS_IMETHODIMP
RemoveStyleSheetTransaction
:
:
UndoTransaction
(
)
{
NS_ENSURE_TRUE
(
mEditor
&
&
mSheet
NS_ERROR_NOT_INITIALIZED
)
;
AddStyleSheet
(
mEditor
mSheet
)
;
return
NS_OK
;
}
NS_IMETHODIMP
RemoveStyleSheetTransaction
:
:
GetTxnDescription
(
nsAString
&
aString
)
{
aString
.
AssignLiteral
(
"
RemoveStyleSheetTransaction
"
)
;
return
NS_OK
;
}
}
