#
ifndef
nsTransactionItem_h__
#
define
nsTransactionItem_h__
#
include
"
nsCOMPtr
.
h
"
#
include
"
nsCOMArray
.
h
"
#
include
"
nsCycleCollectionParticipant
.
h
"
#
include
"
nsISupportsImpl
.
h
"
#
include
"
nscore
.
h
"
class
nsITransaction
;
class
nsTransactionStack
;
namespace
mozilla
{
class
TransactionManager
;
}
class
nsTransactionItem
final
{
nsCOMArray
<
nsISupports
>
mData
;
nsCOMPtr
<
nsITransaction
>
mTransaction
;
nsTransactionStack
*
mUndoStack
;
nsTransactionStack
*
mRedoStack
;
public
:
explicit
nsTransactionItem
(
nsITransaction
*
aTransaction
)
;
NS_METHOD_
(
MozExternalRefCountType
)
AddRef
(
)
;
NS_METHOD_
(
MozExternalRefCountType
)
Release
(
)
;
NS_DECL_CYCLE_COLLECTION_NATIVE_CLASS
(
nsTransactionItem
)
nsresult
AddChild
(
nsTransactionItem
*
aTransactionItem
)
;
already_AddRefed
<
nsITransaction
>
GetTransaction
(
)
;
nsresult
GetIsBatch
(
bool
*
aIsBatch
)
;
nsresult
GetNumberOfChildren
(
int32_t
*
aNumChildren
)
;
nsresult
GetChild
(
int32_t
aIndex
nsTransactionItem
*
*
aChild
)
;
nsresult
DoTransaction
(
)
;
nsresult
UndoTransaction
(
mozilla
:
:
TransactionManager
*
aTransactionManager
)
;
nsresult
RedoTransaction
(
mozilla
:
:
TransactionManager
*
aTransactionManager
)
;
nsCOMArray
<
nsISupports
>
&
GetData
(
)
{
return
mData
;
}
private
:
nsresult
UndoChildren
(
mozilla
:
:
TransactionManager
*
aTransactionManager
)
;
nsresult
RedoChildren
(
mozilla
:
:
TransactionManager
*
aTransactionManager
)
;
nsresult
RecoverFromUndoError
(
mozilla
:
:
TransactionManager
*
aTransactionManager
)
;
nsresult
RecoverFromRedoError
(
mozilla
:
:
TransactionManager
*
aTransactionManager
)
;
nsresult
GetNumberOfUndoItems
(
int32_t
*
aNumItems
)
;
nsresult
GetNumberOfRedoItems
(
int32_t
*
aNumItems
)
;
void
CleanUp
(
)
;
protected
:
~
nsTransactionItem
(
)
;
nsCycleCollectingAutoRefCnt
mRefCnt
;
NS_DECL_OWNINGTHREAD
}
;
#
endif
