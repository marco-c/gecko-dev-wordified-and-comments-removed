"
use
strict
"
;
const
{
Services
}
=
ChromeUtils
.
import
(
"
resource
:
/
/
gre
/
modules
/
Services
.
jsm
"
)
;
var
EXPORTED_SYMBOLS
=
[
"
TestChild
"
]
;
class
TestChild
extends
JSWindowActorChild
{
constructor
(
)
{
super
(
)
;
}
receiveMessage
(
aMessage
)
{
switch
(
aMessage
.
name
)
{
case
"
toChild
"
:
aMessage
.
data
.
toChild
=
true
;
this
.
sendAsyncMessage
(
"
toParent
"
aMessage
.
data
)
;
break
;
case
"
asyncAdd
"
:
let
{
a
b
}
=
aMessage
.
data
;
return
new
Promise
(
resolve
=
>
{
resolve
(
{
result
:
a
+
b
}
)
;
}
)
;
case
"
error
"
:
return
Promise
.
reject
(
new
SyntaxError
(
aMessage
.
data
.
message
)
)
;
case
"
exception
"
:
return
Promise
.
reject
(
Components
.
Exception
(
aMessage
.
data
.
message
aMessage
.
data
.
result
)
)
;
case
"
done
"
:
this
.
done
(
aMessage
.
data
)
;
break
;
}
return
undefined
;
}
handleEvent
(
aEvent
)
{
this
.
sendAsyncMessage
(
"
event
"
{
type
:
aEvent
.
type
}
)
;
}
observe
(
subject
topic
data
)
{
switch
(
topic
)
{
case
"
audio
-
playback
"
:
this
.
done
(
{
subject
topic
data
}
)
;
break
;
default
:
this
.
lastObserved
=
{
subject
topic
data
}
;
break
;
}
}
show
(
)
{
return
"
TestChild
"
;
}
willDestroy
(
)
{
Services
.
obs
.
notifyObservers
(
this
"
test
-
js
-
window
-
actor
-
willdestroy
"
true
)
;
}
didDestroy
(
)
{
Services
.
obs
.
notifyObservers
(
this
"
test
-
js
-
window
-
actor
-
diddestroy
"
true
)
;
}
}
