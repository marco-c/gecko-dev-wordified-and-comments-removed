const
{
WebProgressChild
}
=
ChromeUtils
.
import
(
"
resource
:
/
/
gre
/
modules
/
WebProgressChild
.
jsm
"
)
;
this
.
WebProgress
=
new
WebProgressChild
(
this
)
;
this
.
beginSendingWebProgressEventsToParent
(
)
;
addEventListener
(
"
DOMTitleChanged
"
function
(
aEvent
)
{
if
(
!
aEvent
.
isTrusted
|
|
aEvent
.
target
.
defaultView
!
=
content
)
return
;
sendAsyncMessage
(
"
DOMTitleChanged
"
{
title
:
content
.
document
.
title
}
)
;
}
false
)
;
addEventListener
(
"
ImageContentLoaded
"
function
(
aEvent
)
{
if
(
content
.
document
instanceof
Ci
.
nsIImageDocument
)
{
let
req
=
content
.
document
.
imageRequest
;
if
(
!
req
.
image
)
return
;
sendAsyncMessage
(
"
ImageDocumentLoaded
"
{
width
:
req
.
image
.
width
height
:
req
.
image
.
height
}
)
;
}
}
false
)
;
var
outerWindowID
=
docShell
.
outerWindowID
;
var
browsingContextId
=
docShell
.
browsingContext
.
id
;
sendAsyncMessage
(
"
Browser
:
Init
"
{
outerWindowID
browsingContextId
}
)
;
