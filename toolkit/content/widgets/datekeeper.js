"
use
strict
"
;
function
DateKeeper
(
{
year
month
day
}
{
firstDayOfWeek
=
0
weekends
=
[
0
]
calViewSize
=
42
}
)
{
this
.
state
=
{
firstDayOfWeek
weekends
calViewSize
dateObj
:
new
Date
(
0
)
years
:
[
]
months
:
[
]
days
:
[
]
}
;
this
.
state
.
weekHeaders
=
this
.
_getWeekHeaders
(
firstDayOfWeek
)
;
this
.
_update
(
year
month
day
)
;
}
{
const
DAYS_IN_A_WEEK
=
7
MONTHS_IN_A_YEAR
=
12
YEAR_VIEW_SIZE
=
200
YEAR_BUFFER_SIZE
=
10
;
DateKeeper
.
prototype
=
{
set
(
{
year
=
this
.
state
.
year
month
=
this
.
state
.
month
day
=
this
.
state
.
day
}
)
{
this
.
_update
(
year
month
day
)
;
}
setValue
(
value
)
{
const
dateObj
=
new
Date
(
value
)
;
this
.
_update
(
dateObj
.
getUTCFullYear
(
)
dateObj
.
getUTCMonth
(
)
dateObj
.
getUTCDate
(
)
)
;
}
setMonth
(
month
)
{
const
lastDayOfMonth
=
this
.
_newUTCDate
(
this
.
state
.
year
month
+
1
0
)
.
getUTCDate
(
)
;
this
.
_update
(
this
.
state
.
year
month
Math
.
min
(
this
.
state
.
day
lastDayOfMonth
)
)
;
}
setYear
(
year
)
{
const
lastDayOfMonth
=
this
.
_newUTCDate
(
year
this
.
state
.
month
+
1
0
)
.
getUTCDate
(
)
;
this
.
_update
(
year
this
.
state
.
month
Math
.
min
(
this
.
state
.
day
lastDayOfMonth
)
)
;
}
setMonthByOffset
(
offset
)
{
const
lastDayOfMonth
=
this
.
_newUTCDate
(
this
.
state
.
year
this
.
state
.
month
+
offset
+
1
0
)
.
getUTCDate
(
)
;
this
.
_update
(
this
.
state
.
year
this
.
state
.
month
+
offset
Math
.
min
(
this
.
state
.
day
lastDayOfMonth
)
)
;
}
_update
(
year
month
day
)
{
this
.
state
.
dateObj
.
setUTCFullYear
(
year
month
day
)
;
this
.
state
.
year
=
this
.
state
.
dateObj
.
getUTCFullYear
(
)
;
this
.
state
.
month
=
this
.
state
.
dateObj
.
getUTCMonth
(
)
;
this
.
state
.
day
=
this
.
state
.
dateObj
.
getUTCDate
(
)
;
}
getMonths
(
)
{
let
months
=
[
]
;
for
(
let
i
=
0
;
i
<
MONTHS_IN_A_YEAR
;
i
+
+
)
{
months
.
push
(
{
value
:
i
enabled
:
true
}
)
;
}
return
months
;
}
getYears
(
)
{
let
years
=
[
]
;
const
firstItem
=
this
.
state
.
years
[
0
]
;
const
lastItem
=
this
.
state
.
years
[
this
.
state
.
years
.
length
-
1
]
;
const
currentYear
=
this
.
state
.
dateObj
.
getUTCFullYear
(
)
;
if
(
!
firstItem
|
|
!
lastItem
|
|
currentYear
<
=
firstItem
.
value
+
YEAR_BUFFER_SIZE
|
|
currentYear
>
=
lastItem
.
value
-
YEAR_BUFFER_SIZE
)
{
for
(
let
i
=
-
(
YEAR_VIEW_SIZE
/
2
)
;
i
<
YEAR_VIEW_SIZE
/
2
;
i
+
+
)
{
years
.
push
(
{
value
:
currentYear
+
i
enabled
:
true
}
)
;
}
this
.
state
.
years
=
years
;
}
return
this
.
state
.
years
;
}
getDays
(
)
{
let
firstDayOfMonth
=
this
.
_getFirstCalendarDate
(
this
.
state
.
dateObj
this
.
state
.
firstDayOfWeek
)
;
let
days
=
[
]
;
let
month
=
this
.
state
.
dateObj
.
getUTCMonth
(
)
;
for
(
let
i
=
0
;
i
<
this
.
state
.
calViewSize
;
i
+
+
)
{
let
dateObj
=
this
.
_newUTCDate
(
firstDayOfMonth
.
getUTCFullYear
(
)
firstDayOfMonth
.
getUTCMonth
(
)
firstDayOfMonth
.
getUTCDate
(
)
+
i
)
;
let
classNames
=
[
]
;
if
(
this
.
state
.
weekends
.
includes
(
dateObj
.
getUTCDay
(
)
)
)
{
classNames
.
push
(
"
weekend
"
)
;
}
if
(
month
!
=
dateObj
.
getUTCMonth
(
)
)
{
classNames
.
push
(
"
outside
"
)
;
}
days
.
push
(
{
dateValue
:
dateObj
.
getTime
(
)
textContent
:
dateObj
.
getUTCDate
(
)
classNames
}
)
;
}
return
days
;
}
_getWeekHeaders
(
firstDayOfWeek
)
{
let
headers
=
[
]
;
let
dayOfWeek
=
firstDayOfWeek
;
for
(
let
i
=
0
;
i
<
DAYS_IN_A_WEEK
;
i
+
+
)
{
headers
.
push
(
{
textContent
:
dayOfWeek
%
DAYS_IN_A_WEEK
classNames
:
this
.
state
.
weekends
.
includes
(
dayOfWeek
%
DAYS_IN_A_WEEK
)
?
[
"
weekend
"
]
:
[
]
}
)
;
dayOfWeek
+
+
;
}
return
headers
;
}
_getFirstCalendarDate
(
dateObj
firstDayOfWeek
)
{
const
daysOffset
=
1
-
DAYS_IN_A_WEEK
;
let
firstDayOfMonth
=
this
.
_newUTCDate
(
dateObj
.
getUTCFullYear
(
)
dateObj
.
getUTCMonth
(
)
)
;
let
dayOfWeek
=
firstDayOfMonth
.
getUTCDay
(
)
;
return
this
.
_newUTCDate
(
firstDayOfMonth
.
getUTCFullYear
(
)
firstDayOfMonth
.
getUTCMonth
(
)
firstDayOfWeek
=
=
dayOfWeek
?
daysOffset
:
(
firstDayOfWeek
-
dayOfWeek
+
daysOffset
)
%
DAYS_IN_A_WEEK
)
;
}
_newUTCDate
(
.
.
.
parts
)
{
return
new
Date
(
Date
.
UTC
(
.
.
.
parts
)
)
;
}
}
;
}
