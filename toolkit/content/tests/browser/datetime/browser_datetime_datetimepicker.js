"
use
strict
"
;
add_task
(
async
function
test_datetimepicker_date_clicked
(
)
{
await
SpecialPowers
.
pushPrefEnv
(
{
set
:
[
[
"
dom
.
forms
.
datetime
.
timepicker
"
true
]
]
}
)
;
info
(
"
When
a
calendar
day
is
clicked
value
is
set
and
picker
stays
open
"
)
;
const
inputValue
=
"
2016
-
12
-
15T06
:
00
"
;
const
firstDayOnCalendar
=
"
2016
-
11
-
27T06
:
00
"
;
await
helper
.
openPicker
(
data
:
text
/
html
<
input
id
=
"
datetime
"
type
=
"
datetime
-
local
"
value
=
"
{
inputValue
}
"
>
)
;
let
browser
=
helper
.
tab
.
linkedBrowser
;
Assert
.
equal
(
helper
.
panel
.
state
"
open
"
"
Panel
should
be
opened
"
)
;
let
promise
=
BrowserTestUtils
.
waitForContentEvent
(
browser
"
input
"
)
;
helper
.
click
(
helper
.
getElement
(
DAYS_VIEW
)
.
querySelector
(
"
td
"
)
)
;
await
promise
;
let
value
=
await
SpecialPowers
.
spawn
(
browser
[
]
(
)
=
>
{
return
content
.
document
.
querySelector
(
"
input
"
)
.
value
;
}
)
;
Assert
.
equal
(
value
firstDayOnCalendar
)
;
Assert
.
equal
(
helper
.
panel
.
state
"
open
"
"
Panel
should
be
opened
"
)
;
await
helper
.
tearDown
(
)
;
}
)
;
add_task
(
async
function
test_datetimepicker_time_clicked
(
)
{
info
(
"
When
a
time
is
picked
value
is
set
and
picker
stays
open
"
)
;
const
inputValue
=
"
2016
-
12
-
15T06
:
00
"
;
const
oneHourEarlier
=
"
2016
-
12
-
15T05
:
00
"
;
await
helper
.
openPicker
(
data
:
text
/
html
<
input
id
=
"
datetime
"
type
=
"
datetime
-
local
"
value
=
"
{
inputValue
}
"
>
)
;
let
browser
=
helper
.
tab
.
linkedBrowser
;
Assert
.
equal
(
helper
.
panel
.
state
"
open
"
"
Panel
should
be
opened
"
)
;
let
promise
=
BrowserTestUtils
.
waitForContentEvent
(
browser
"
input
"
)
;
helper
.
click
(
helper
.
getElement
(
TIMEPICKER
)
.
querySelector
(
"
.
spinner
-
container
.
prev
"
)
)
;
await
promise
;
let
value
=
await
SpecialPowers
.
spawn
(
browser
[
]
(
)
=
>
{
return
content
.
document
.
querySelector
(
"
input
"
)
.
value
;
}
)
;
Assert
.
equal
(
value
oneHourEarlier
)
;
Assert
.
equal
(
helper
.
panel
.
state
"
open
"
"
Panel
should
be
opened
"
)
;
await
helper
.
tearDown
(
)
;
}
)
;
