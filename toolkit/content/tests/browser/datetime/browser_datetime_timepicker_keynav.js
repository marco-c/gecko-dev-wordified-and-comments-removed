"
use
strict
"
;
add_setup
(
async
function
setPrefsReducedMotion
(
)
{
await
SpecialPowers
.
pushPrefEnv
(
{
set
:
[
[
"
ui
.
prefersReducedMotion
"
1
]
]
}
)
;
Assert
.
ok
(
matchMedia
(
"
(
prefers
-
reduced
-
motion
:
reduce
)
"
)
.
matches
"
The
reduce
motion
mode
is
active
"
)
;
await
SpecialPowers
.
pushPrefEnv
(
{
set
:
[
[
"
dom
.
forms
.
datetime
.
timepicker
"
true
]
]
}
)
;
}
)
;
add_task
(
async
function
test_datetime_panel_escape
(
)
{
info
(
"
Ensure
time
spinners
follow
arrow
key
bindings
appropriately
.
"
)
;
const
inputValue
=
"
01
:
01
"
;
await
helper
.
openPicker
(
data
:
text
/
html
<
input
type
=
"
time
"
value
=
"
{
inputValue
}
"
>
)
;
Assert
.
equal
(
helper
.
panel
.
state
"
open
"
"
Panel
should
be
opened
"
)
;
let
closed
=
helper
.
promisePickerClosed
(
)
;
info
(
"
Testing
general
keyboard
navigation
"
)
;
EventUtils
.
synthesizeKey
(
"
KEY_Escape
"
{
}
)
;
await
closed
;
Assert
.
equal
(
helper
.
panel
.
state
"
closed
"
"
Panel
should
be
closed
on
Escape
"
)
;
await
helper
.
tearDown
(
)
;
}
)
;
add_task
(
async
function
test_time_spinner_keyboard
(
)
{
info
(
"
Ensure
time
spinners
follow
arrow
key
bindings
appropriately
.
"
)
;
const
inputValue
=
"
01
:
01
"
;
await
helper
.
openPicker
(
data
:
text
/
html
<
input
type
=
"
time
"
value
=
"
{
inputValue
}
"
>
)
;
Assert
.
equal
(
helper
.
panel
.
state
"
open
"
"
Panel
should
be
opened
"
)
;
const
spinnerHour
=
helper
.
getElement
(
SPINNER_HOUR
)
;
const
spinnerMin
=
helper
.
getElement
(
SPINNER_MIN
)
;
const
spinnerTime
=
helper
.
getElement
(
SPINNER_TIME
)
;
Assert
.
ok
(
spinnerHour
.
matches
(
"
:
focus
"
)
The
keyboard
focus
is
placed
on
the
Hour
spinner
)
;
Assert
.
equal
(
spinnerHour
.
getAttribute
(
"
aria
-
valuenow
"
)
"
1
"
"
The
hour
spinner
is
ready
"
)
;
Assert
.
equal
(
spinnerMin
.
getAttribute
(
"
aria
-
valuenow
"
)
"
1
"
"
The
minute
spinner
is
ready
"
)
;
Assert
.
equal
(
spinnerTime
.
getAttribute
(
"
aria
-
valuenow
"
)
"
0
"
"
The
time
of
the
day
spinner
is
ready
"
)
;
info
(
"
Testing
Up
Arrow
key
behavior
of
the
Hour
Spinner
"
)
;
EventUtils
.
synthesizeKey
(
"
KEY_ArrowUp
"
{
}
)
;
await
BrowserTestUtils
.
waitForMutationCondition
(
spinnerHour
{
attributes
:
"
ariaValueNow
"
}
(
)
=
>
{
return
spinnerHour
.
ariaValueNow
=
=
"
0
"
;
}
Should
change
to
0
instead
got
{
helper
.
getElement
(
SPINNER_HOUR
)
.
ariaValueNow
}
)
;
Assert
.
equal
(
spinnerHour
.
getAttribute
(
"
aria
-
valuenow
"
)
"
0
"
"
Up
Arrow
selects
the
previous
hour
"
)
;
Assert
.
equal
(
spinnerMin
.
getAttribute
(
"
aria
-
valuenow
"
)
"
1
"
"
Up
Arrow
on
an
hour
spinner
does
not
update
the
minute
spinner
"
)
;
Assert
.
equal
(
spinnerTime
.
getAttribute
(
"
aria
-
valuenow
"
)
"
0
"
"
Up
Arrow
on
an
hour
spinner
does
not
update
the
time
of
the
day
spinner
"
)
;
info
(
"
Testing
Down
Arrow
key
behavior
of
the
Minute
Spinner
"
)
;
EventUtils
.
synthesizeKey
(
"
KEY_Tab
"
{
}
)
;
Assert
.
ok
(
spinnerMin
.
matches
(
"
:
focus
"
)
The
keyboard
focus
is
placed
on
the
minute
spinner
)
;
EventUtils
.
synthesizeKey
(
"
KEY_ArrowDown
"
{
}
)
;
await
BrowserTestUtils
.
waitForMutationCondition
(
spinnerMin
{
attributes
:
"
ariaValueNow
"
}
(
)
=
>
{
return
spinnerMin
.
ariaValueNow
=
=
"
2
"
;
}
Should
change
to
2
instead
got
{
helper
.
getElement
(
SPINNER_MIN
)
.
ariaValueNow
}
)
;
Assert
.
equal
(
spinnerHour
.
getAttribute
(
"
aria
-
valuenow
"
)
"
0
"
"
Down
Arrow
on
a
minute
spinner
does
not
update
the
hour
spinner
"
)
;
Assert
.
equal
(
spinnerMin
.
getAttribute
(
"
aria
-
valuenow
"
)
"
2
"
"
Down
Arrow
selects
the
next
minute
"
)
;
Assert
.
equal
(
spinnerTime
.
getAttribute
(
"
aria
-
valuenow
"
)
"
0
"
"
Down
Arrow
on
a
minute
spinner
does
not
update
the
time
of
the
day
spinner
"
)
;
info
(
"
Testing
Down
Arrow
key
behavior
of
the
Time
of
the
day
Spinner
"
)
;
EventUtils
.
synthesizeKey
(
"
KEY_ArrowRight
"
{
}
)
;
Assert
.
ok
(
spinnerTime
.
matches
(
"
:
focus
"
)
The
keyboard
focus
is
placed
on
the
AM
/
PM
spinner
)
;
EventUtils
.
synthesizeKey
(
"
KEY_ArrowDown
"
{
}
)
;
await
BrowserTestUtils
.
waitForMutationCondition
(
spinnerTime
{
attributes
:
"
ariaValueNow
"
}
(
)
=
>
{
return
spinnerTime
.
ariaValueNow
=
=
"
12
"
;
}
Should
change
to
12
instead
got
{
helper
.
getElement
(
SPINNER_TIME
)
.
ariaValueNow
}
)
;
await
BrowserTestUtils
.
waitForMutationCondition
(
spinnerHour
{
attributes
:
"
ariaValueNow
"
}
(
)
=
>
{
return
spinnerHour
.
ariaValueNow
=
=
"
12
"
;
}
Hour
should
change
to
12
instead
got
{
helper
.
getElement
(
SPINNER_HOUR
)
.
ariaValueNow
}
)
;
Assert
.
equal
(
spinnerHour
.
getAttribute
(
"
aria
-
valuenow
"
)
"
12
"
"
Down
Arrow
on
a
time
of
the
day
spinner
updates
the
hour
spinner
within
24
hr
"
)
;
Assert
.
equal
(
spinnerTime
.
getAttribute
(
"
aria
-
valuenow
"
)
"
12
"
"
Down
Arrow
on
a
time
of
the
day
selects
the
PM
in
the
spinner
"
)
;
info
(
"
Testing
Space
/
Enter
key
behavior
of
the
panel
"
)
;
let
closed
=
helper
.
promisePickerClosed
(
)
;
EventUtils
.
synthesizeKey
(
"
KEY_Enter
"
{
}
)
;
await
closed
;
Assert
.
equal
(
helper
.
panel
.
state
"
closed
"
"
Panel
should
be
closed
on
Enter
"
)
;
await
helper
.
tearDown
(
)
;
}
)
;
