Services
.
scriptloader
.
loadSubScript
(
"
chrome
:
/
/
mochikit
/
content
/
tests
/
SimpleTest
/
MockObjects
.
js
"
this
)
;
var
mockTransferCallback
;
function
MockTransfer
(
)
{
this
.
_downloadIsSuccessful
=
true
;
this
.
_whenSucceededPromise
=
Promise
.
withResolvers
(
)
;
}
MockTransfer
.
prototype
=
{
QueryInterface
:
ChromeUtils
.
generateQI
(
[
"
nsIWebProgressListener
"
"
nsIWebProgressListener2
"
"
nsITransfer
"
]
)
onStateChange
:
function
MTFC_onStateChange
(
aWebProgress
aRequest
aStateFlags
aStatus
)
{
if
(
!
Components
.
isSuccessCode
(
aStatus
)
)
{
this
.
_downloadIsSuccessful
=
false
;
}
if
(
aStateFlags
&
Ci
.
nsIWebProgressListener
.
STATE_STOP
&
&
aStateFlags
&
Ci
.
nsIWebProgressListener
.
STATE_IS_NETWORK
)
{
mockTransferCallback
(
this
.
_downloadIsSuccessful
)
;
this
.
_whenSucceededPromise
.
resolve
(
)
;
}
}
onProgressChange
(
)
{
}
onLocationChange
(
)
{
}
onStatusChange
:
function
MTFC_onStatusChange
(
aWebProgress
aRequest
aStatus
)
{
if
(
!
Components
.
isSuccessCode
(
aStatus
)
)
{
this
.
_downloadIsSuccessful
=
false
;
}
}
onSecurityChange
(
)
{
}
onContentBlockingEvent
(
)
{
}
onProgressChange64
(
)
{
}
onRefreshAttempted
(
)
{
}
init
(
)
{
}
initWithBrowsingContext
(
)
{
}
get
downloadPromise
(
)
{
return
Promise
.
resolve
(
{
whenSucceeded
:
(
)
=
>
this
.
_whenSucceededPromise
.
promise
}
)
;
}
setSha256Hash
(
)
{
}
setSignatureInfo
(
)
{
}
}
;
var
mockTransferRegisterer
=
new
MockObjectRegisterer
(
"
mozilla
.
org
/
transfer
;
1
"
MockTransfer
)
;
