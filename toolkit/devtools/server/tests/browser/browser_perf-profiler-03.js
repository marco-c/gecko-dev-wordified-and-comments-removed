const
{
PerformanceFront
}
=
require
(
"
devtools
/
server
/
actors
/
performance
"
)
;
const
{
sendProfilerCommand
PMM_isProfilerActive
PMM_stopProfiler
PMM_loadFrameScripts
}
=
require
(
"
devtools
/
toolkit
/
performance
/
process
-
communication
"
)
;
add_task
(
function
*
(
)
{
PMM_loadFrameScripts
(
gBrowser
)
;
let
ENTRIES
=
1000000
;
let
INTERVAL
=
1
;
let
FEATURES
=
[
"
js
"
]
;
yield
sendProfilerCommand
(
"
StartProfiler
"
[
ENTRIES
INTERVAL
FEATURES
FEATURES
.
length
]
)
;
ok
(
(
yield
PMM_isProfilerActive
(
)
)
"
The
built
-
in
profiler
module
should
still
be
active
.
"
)
;
yield
addTab
(
MAIN_DOMAIN
+
"
doc_perf
.
html
"
)
;
initDebuggerServer
(
)
;
let
client
=
new
DebuggerClient
(
DebuggerServer
.
connectPipe
(
)
)
;
let
form
=
yield
connectDebuggerClient
(
client
)
;
let
firstFront
=
PerformanceFront
(
client
form
)
;
yield
firstFront
.
connect
(
)
;
let
recording
=
yield
firstFront
.
startRecording
(
)
;
yield
addTab
(
MAIN_DOMAIN
+
"
doc_perf
.
html
"
)
;
let
client2
=
new
DebuggerClient
(
DebuggerServer
.
connectPipe
(
)
)
;
let
form2
=
yield
connectDebuggerClient
(
client2
)
;
let
secondFront
=
PerformanceFront
(
client2
form2
)
;
yield
secondFront
.
connect
(
)
;
yield
closeDebuggerClient
(
client2
)
;
ok
(
(
yield
PMM_isProfilerActive
(
)
)
"
The
built
-
in
profiler
module
should
still
be
active
.
"
)
;
yield
closeDebuggerClient
(
client
)
;
ok
(
!
(
yield
PMM_isProfilerActive
(
)
)
"
The
built
-
in
profiler
module
should
have
been
automatically
stopped
.
"
)
;
gBrowser
.
removeCurrentTab
(
)
;
gBrowser
.
removeCurrentTab
(
)
;
}
)
;
