#
include
"
gtest
/
gtest
.
h
"
#
include
"
nsCOMPtr
.
h
"
#
include
"
nsIFile
.
h
"
#
include
"
nsProfileLock
.
h
"
#
include
"
nsString
.
h
"
#
include
"
nsDirectoryServiceDefs
.
h
"
TEST
(
ProfileLock
BasicLock
)
{
char
tmpExt
[
]
=
"
profilebasiclocktest
"
;
nsProfileLock
myLock
;
nsresult
rv
;
nsCOMPtr
<
nsIFile
>
tmpDir
;
rv
=
NS_GetSpecialDirectory
(
NS_OS_TEMP_DIR
getter_AddRefs
(
tmpDir
)
)
;
ASSERT_EQ
(
NS_SUCCEEDED
(
rv
)
true
)
;
rv
=
tmpDir
-
>
AppendNative
(
nsCString
(
tmpExt
)
)
;
ASSERT_EQ
(
NS_SUCCEEDED
(
rv
)
true
)
;
rv
=
tmpDir
-
>
CreateUnique
(
nsIFile
:
:
DIRECTORY_TYPE
0700
)
;
ASSERT_EQ
(
NS_SUCCEEDED
(
rv
)
true
)
;
rv
=
myLock
.
Lock
(
tmpDir
nullptr
)
;
EXPECT_EQ
(
NS_SUCCEEDED
(
rv
)
true
)
;
myLock
.
Cleanup
(
)
;
}
