#
ifndef
ProfileUnlockerWin_h
#
define
ProfileUnlockerWin_h
#
include
<
windows
.
h
>
#
include
<
restartmanager
.
h
>
#
include
"
nsIProfileUnlocker
.
h
"
#
include
"
nsString
.
h
"
#
include
"
nsWindowsHelpers
.
h
"
namespace
mozilla
{
class
ProfileUnlockerWin
final
:
public
nsIProfileUnlocker
{
public
:
NS_DECL_ISUPPORTS
NS_DECL_NSIPROFILEUNLOCKER
explicit
ProfileUnlockerWin
(
const
nsAString
&
aFileName
)
;
nsresult
Init
(
)
;
DWORD
StartSession
(
DWORD
&
aHandle
)
;
void
EndSession
(
DWORD
aHandle
)
;
private
:
~
ProfileUnlockerWin
(
)
;
nsresult
TryToTerminate
(
RM_UNIQUE_PROCESS
&
aProcess
)
;
private
:
typedef
DWORD
(
WINAPI
*
RMSTARTSESSION
)
(
DWORD
*
DWORD
WCHAR
[
]
)
;
typedef
DWORD
(
WINAPI
*
RMREGISTERRESOURCES
)
(
DWORD
UINT
LPCWSTR
[
]
UINT
RM_UNIQUE_PROCESS
[
]
UINT
LPCWSTR
[
]
)
;
typedef
DWORD
(
WINAPI
*
RMGETLIST
)
(
DWORD
UINT
*
UINT
*
RM_PROCESS_INFO
[
]
LPDWORD
)
;
typedef
DWORD
(
WINAPI
*
RMENDSESSION
)
(
DWORD
)
;
private
:
nsModuleHandle
mRestartMgrModule
;
RMSTARTSESSION
mRmStartSession
;
RMREGISTERRESOURCES
mRmRegisterResources
;
RMGETLIST
mRmGetList
;
RMENDSESSION
mRmEndSession
;
nsString
mFileName
;
}
;
}
#
endif
