let
condition
=
{
skip_if
:
(
)
=
>
!
AppConstants
.
MOZ_BACKGROUNDTASKS
}
;
add_task
(
condition
async
(
)
=
>
{
writeProfilesIni
(
BACKGROUNDTASKS_PROFILE_DATA
)
;
const
bts
=
Cc
[
"
mozilla
.
org
/
backgroundtasks
;
1
"
]
.
getService
(
Ci
.
nsIBackgroundTasks
)
;
bts
.
overrideBackgroundTaskNameForTesting
(
"
ephemeral_profile
"
)
;
let
{
didCreate
}
=
selectStartupProfile
(
)
;
checkStartupReason
(
"
backgroundtask
-
ephemeral
"
)
;
Assert
.
equal
(
didCreate
true
"
Created
new
ephemeral
profile
"
)
;
let
profileData
=
readProfilesIni
(
)
;
Assert
.
deepEqual
(
BACKGROUNDTASKS_PROFILE_DATA
profileData
)
;
}
)
;
