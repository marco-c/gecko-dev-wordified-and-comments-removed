add_task
(
{
skip_if
:
(
)
=
>
!
AppConstants
.
MOZ_SELECTABLE_PROFILES
}
async
(
)
=
>
{
let
hash
=
xreDirProvider
.
getInstallHash
(
)
;
let
defaultProfile
=
makeRandomProfileDir
(
"
default
"
)
;
let
profilesIni
=
{
profiles
:
[
{
name
:
"
default
"
path
:
defaultProfile
.
leafName
default
:
true
}
]
installs
:
{
[
hash
]
:
{
default
:
defaultProfile
.
leafName
}
}
}
;
writeProfilesIni
(
profilesIni
)
;
let
service
=
getProfileService
(
)
;
checkProfileService
(
profilesIni
)
;
let
{
profile
}
=
selectStartupProfile
(
)
;
Assert
.
throws
(
(
)
=
>
(
profile
.
showProfileSelector
=
true
)
e
=
>
e
.
result
=
=
Cr
.
NS_ERROR_FAILURE
"
Cannot
set
ShowSelector
if
StoreID
is
missing
"
)
;
profile
.
storeID
=
"
12345678
"
;
profile
.
showProfileSelector
=
true
;
service
.
flush
(
)
;
profilesIni
.
profiles
[
0
]
.
storeID
=
"
12345678
"
;
profilesIni
.
profiles
[
0
]
.
showSelector
=
"
1
"
;
checkProfileService
(
profilesIni
)
;
profile
.
showProfileSelector
=
false
;
service
.
flush
(
)
;
profilesIni
.
profiles
[
0
]
.
showSelector
=
"
0
"
;
checkProfileService
(
profilesIni
)
;
profile
.
showProfileSelector
=
true
;
profile
.
storeID
=
null
;
service
.
flush
(
)
;
delete
profilesIni
.
profiles
[
0
]
.
storeID
;
delete
profilesIni
.
profiles
[
0
]
.
showSelector
;
checkProfileService
(
profilesIni
)
;
}
)
;
