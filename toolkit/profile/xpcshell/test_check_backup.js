add_task
(
async
(
)
=
>
{
let
hash
=
xreDirProvider
.
getInstallHash
(
)
;
let
profileData
=
{
options
:
{
startWithLastProfile
:
true
}
profiles
:
[
{
name
:
"
Profile1
"
path
:
"
Path1
"
}
{
name
:
"
Profile2
"
path
:
"
Path2
"
}
]
}
;
let
installs
=
{
[
hash
]
:
{
default
:
"
Path2
"
}
}
;
writeProfilesIni
(
profileData
)
;
writeInstallsIni
(
{
installs
}
)
;
let
{
profile
didCreate
}
=
selectStartupProfile
(
)
;
checkStartupReason
(
"
default
"
)
;
let
{
databaseVersion
profileCount
}
=
getTelemetryScalars
(
)
;
Assert
.
equal
(
databaseVersion
"
1
"
"
Old
database
file
was
present
at
startup
.
"
)
;
Assert
.
equal
(
profileCount
2
"
Should
be
two
profiles
.
"
)
;
profileData
.
installs
=
installs
;
checkProfileService
(
profileData
)
;
Assert
.
ok
(
!
didCreate
"
Should
not
have
created
a
new
profile
.
"
)
;
Assert
.
equal
(
profile
.
name
"
Profile2
"
"
Should
have
selected
the
right
profile
"
)
;
}
)
;
