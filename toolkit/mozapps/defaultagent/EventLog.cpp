#
include
"
EventLog
.
h
"
#
include
<
stdio
.
h
>
void
WriteEventLogError
(
HRESULT
hr
const
char
*
sourceFile
int
sourceLine
)
{
HANDLE
source
=
RegisterEventSourceW
(
nullptr
L
"
"
MOZ_APP_DISPLAYNAME
"
Default
Browser
Agent
"
)
;
if
(
!
source
)
{
return
;
}
wchar_t
errorStr
[
MAX_PATH
+
1
]
=
L
"
"
;
_snwprintf_s
(
errorStr
MAX_PATH
+
1
_TRUNCATE
L
"
0x
%
X
in
%
S
:
%
d
"
hr
sourceFile
sourceLine
)
;
const
wchar_t
*
stringsArray
[
]
=
{
errorStr
}
;
ReportEventW
(
source
EVENTLOG_ERROR_TYPE
0
hr
nullptr
1
0
stringsArray
nullptr
)
;
DeregisterEventSource
(
source
)
;
}
