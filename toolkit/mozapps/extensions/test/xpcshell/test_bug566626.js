var
addon1
=
{
id
:
"
addon1
tests
.
mozilla
.
org
"
version
:
"
1
.
0
"
name
:
"
Test
1
"
targetApplications
:
[
{
id
:
"
xpcshell
tests
.
mozilla
.
org
"
minVersion
:
"
1
"
maxVersion
:
"
1
"
}
]
}
;
const
profileDir
=
gProfD
.
clone
(
)
;
profileDir
.
append
(
"
extensions
"
)
;
var
gAddon
;
function
run_test
(
)
{
do_test_pending
(
)
;
createAppInfo
(
"
xpcshell
tests
.
mozilla
.
org
"
"
XPCShell
"
"
1
"
"
1
.
9
.
2
"
)
;
writeInstallRDFForExtension
(
addon1
profileDir
)
;
startupManager
(
)
;
run_test_1
(
)
;
}
function
run_test_1
(
)
{
var
count
=
0
;
AddonManager
.
getAddonByID
(
"
addon1
tests
.
mozilla
.
org
"
function
(
a1
)
{
Assert
.
notEqual
(
a1
null
)
;
Assert
.
equal
(
a1
.
name
"
Test
1
"
)
;
if
(
count
=
=
0
)
gAddon
=
a1
;
else
Assert
.
equal
(
a1
gAddon
)
;
count
+
+
;
if
(
count
=
=
4
)
run_test_2
(
)
;
}
)
;
AddonManager
.
getAddonByID
(
"
addon1
tests
.
mozilla
.
org
"
function
(
a1
)
{
Assert
.
notEqual
(
a1
null
)
;
Assert
.
equal
(
a1
.
name
"
Test
1
"
)
;
if
(
count
=
=
0
)
gAddon
=
a1
;
else
Assert
.
equal
(
a1
gAddon
)
;
count
+
+
;
if
(
count
=
=
4
)
run_test_2
(
)
;
}
)
;
executeSoon
(
function
(
)
{
AddonManager
.
getAddonByID
(
"
addon1
tests
.
mozilla
.
org
"
function
(
a1
)
{
Assert
.
notEqual
(
a1
null
)
;
Assert
.
equal
(
a1
.
name
"
Test
1
"
)
;
if
(
count
=
=
0
)
gAddon
=
a1
;
else
Assert
.
equal
(
a1
gAddon
)
;
count
+
+
;
if
(
count
=
=
4
)
run_test_2
(
)
;
}
)
;
}
)
;
executeSoon
(
function
(
)
{
executeSoon
(
function
(
)
{
AddonManager
.
getAddonByID
(
"
addon1
tests
.
mozilla
.
org
"
function
(
a1
)
{
Assert
.
notEqual
(
a1
null
)
;
Assert
.
equal
(
a1
.
name
"
Test
1
"
)
;
if
(
count
=
=
0
)
gAddon
=
a1
;
else
Assert
.
equal
(
a1
gAddon
)
;
count
+
+
;
if
(
count
=
=
4
)
run_test_2
(
)
;
}
)
;
}
)
;
}
)
;
}
function
run_test_2
(
)
{
AddonManager
.
getAddonByID
(
"
addon1
tests
.
mozilla
.
org
"
function
(
a1
)
{
Assert
.
notEqual
(
a1
null
)
;
Assert
.
equal
(
a1
.
name
"
Test
1
"
)
;
Assert
.
equal
(
a1
gAddon
)
;
executeSoon
(
do_test_finished
)
;
}
)
;
}
