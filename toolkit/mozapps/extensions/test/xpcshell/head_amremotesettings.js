ChromeUtils
.
defineESModuleGetters
(
this
{
RemoteSettings
:
"
resource
:
/
/
services
-
settings
/
remote
-
settings
.
sys
.
mjs
"
}
)
;
async
function
setAndEmitFakeRemoteSettingsData
(
data
expectClientInitialized
=
true
)
{
const
{
AMRemoteSettings
}
=
ChromeUtils
.
import
(
"
resource
:
/
/
gre
/
modules
/
AddonManager
.
jsm
"
)
;
let
client
;
if
(
expectClientInitialized
)
{
ok
(
AMRemoteSettings
.
client
"
Got
a
remote
settings
client
"
)
;
ok
(
AMRemoteSettings
.
onSync
"
Got
a
remote
settings
'
sync
'
event
handler
"
)
;
client
=
AMRemoteSettings
.
client
;
}
else
{
client
=
new
RemoteSettings
(
AMRemoteSettings
.
RS_COLLECTION
)
;
}
await
client
.
db
.
clear
(
)
;
if
(
data
.
length
)
{
await
client
.
db
.
importChanges
(
{
}
Date
.
now
(
)
data
)
;
}
await
client
.
emit
(
"
sync
"
{
data
:
{
}
}
)
;
}
