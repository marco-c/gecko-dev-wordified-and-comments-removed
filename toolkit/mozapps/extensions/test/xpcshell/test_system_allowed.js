BootstrapMonitor
.
init
(
)
;
var
distroDir
=
FileUtils
.
getDir
(
"
ProfD
"
[
"
sysfeatures
"
]
true
)
;
do_get_file
(
"
data
/
system_addons
/
system1_1
.
xpi
"
)
.
copyTo
(
distroDir
"
system1
tests
.
mozilla
.
org
.
xpi
"
)
;
do_get_file
(
"
data
/
system_addons
/
system2_1
.
xpi
"
)
.
copyTo
(
distroDir
"
system2
tests
.
mozilla
.
org
.
xpi
"
)
;
do_get_file
(
"
data
/
system_addons
/
system3_1
.
xpi
"
)
.
copyTo
(
distroDir
"
system3
tests
.
mozilla
.
org
.
xpi
"
)
;
registerDirectory
(
"
XREAppFeat
"
distroDir
)
;
createAppInfo
(
"
xpcshell
tests
.
mozilla
.
org
"
"
XPCShell
"
"
0
"
)
;
add_task
(
async
function
test_allowed_addons
(
)
{
let
validAddons
=
{
"
system
"
:
[
"
system1
tests
.
mozilla
.
org
"
"
system2
tests
.
mozilla
.
org
"
]
}
;
await
overrideBuiltIns
(
validAddons
)
;
await
promiseStartupManager
(
)
;
let
addon
=
await
AddonManager
.
getAddonByID
(
"
system1
tests
.
mozilla
.
org
"
)
;
notEqual
(
addon
null
)
;
addon
=
await
AddonManager
.
getAddonByID
(
"
system2
tests
.
mozilla
.
org
"
)
;
notEqual
(
addon
null
)
;
addon
=
await
AddonManager
.
getAddonByID
(
"
system3
tests
.
mozilla
.
org
"
)
;
do_check_eq
(
addon
null
)
;
equal
(
addon
null
)
;
validAddons
=
{
"
system
"
:
[
"
system3
tests
.
mozilla
.
org
"
]
}
;
await
overrideBuiltIns
(
validAddons
)
;
await
promiseRestartManager
(
)
;
addon
=
await
AddonManager
.
getAddonByID
(
"
system1
tests
.
mozilla
.
org
"
)
;
equal
(
addon
null
)
;
addon
=
await
AddonManager
.
getAddonByID
(
"
system2
tests
.
mozilla
.
org
"
)
;
equal
(
addon
null
)
;
addon
=
await
AddonManager
.
getAddonByID
(
"
system3
tests
.
mozilla
.
org
"
)
;
notEqual
(
addon
null
)
;
await
promiseShutdownManager
(
)
;
}
)
;
