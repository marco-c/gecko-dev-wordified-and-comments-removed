var
gCount
;
async
function
run_test
(
)
{
do_test_pending
(
)
;
createAppInfo
(
"
xpcshell
tests
.
mozilla
.
org
"
"
XPCShell
"
"
1
"
"
1
.
9
.
2
"
)
;
startupManager
(
)
;
let
list
=
await
AddonManager
.
getAddonsByTypes
(
null
)
;
gCount
=
list
.
length
;
executeSoon
(
run_test_1
)
;
}
async
function
run_test_1
(
)
{
restartManager
(
)
;
let
addons
=
await
AddonManager
.
getAddonsByTypes
(
null
)
;
Assert
.
equal
(
gCount
addons
.
length
)
;
let
pendingAddons
=
await
AddonManager
.
getAddonsWithOperationsByTypes
(
null
)
;
Assert
.
equal
(
0
pendingAddons
.
length
)
;
executeSoon
(
run_test_2
)
;
}
async
function
run_test_2
(
)
{
shutdownManager
(
)
;
startupManager
(
)
;
let
addons
=
await
AddonManager
.
getAddonsByTypes
(
null
)
;
Assert
.
equal
(
gCount
addons
.
length
)
;
executeSoon
(
run_test_3
)
;
}
async
function
run_test_3
(
)
{
restartManager
(
)
;
let
addons
=
await
AddonManager
.
getAddonsByTypes
(
null
)
;
Assert
.
equal
(
gCount
addons
.
length
)
;
do_test_finished
(
)
;
}
