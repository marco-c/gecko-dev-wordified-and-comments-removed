var
gCount
;
async
function
run_test
(
)
{
do_test_pending
(
)
;
createAppInfo
(
"
xpcshell
tests
.
mozilla
.
org
"
"
XPCShell
"
"
1
"
"
1
.
9
.
2
"
)
;
Services
.
prefs
.
setBoolPref
(
"
plugin
.
load_flash_only
"
false
)
;
Services
.
prefs
.
setBoolPref
(
"
security
.
turn_off_all_security_so_that_viruses_can_take_over_this_computer
"
true
)
;
await
promiseStartupManager
(
)
;
let
list
=
await
AddonManager
.
getAddonsByTypes
(
null
)
;
gCount
=
list
.
length
;
executeSoon
(
run_test_1
)
;
}
async
function
run_test_1
(
)
{
await
promiseRestartManager
(
)
;
let
addons
=
await
AddonManager
.
getAddonsByTypes
(
null
)
;
Assert
.
equal
(
gCount
addons
.
length
)
;
executeSoon
(
run_test_2
)
;
}
async
function
run_test_2
(
)
{
await
promiseShutdownManager
(
)
;
await
promiseStartupManager
(
)
;
let
addons
=
await
AddonManager
.
getAddonsByTypes
(
null
)
;
Assert
.
equal
(
gCount
addons
.
length
)
;
executeSoon
(
run_test_3
)
;
}
async
function
run_test_3
(
)
{
await
promiseRestartManager
(
)
;
let
addons
=
await
AddonManager
.
getAddonsByTypes
(
null
)
;
Assert
.
equal
(
gCount
addons
.
length
)
;
do_test_finished
(
)
;
}
