add_task
(
async
function
test
(
)
{
createAppInfo
(
"
xpcshell
tests
.
mozilla
.
org
"
"
XPCShell
"
"
1
"
"
1
.
9
.
2
"
)
;
await
promiseStartupManager
(
)
;
let
profileDir
=
OS
.
Constants
.
Path
.
profileDir
;
let
trashDir
=
OS
.
Path
.
join
(
profileDir
"
extensions
"
"
trash
"
)
;
let
testFile
=
OS
.
Path
.
join
(
trashDir
"
test
.
txt
"
)
;
await
OS
.
File
.
makeDir
(
trashDir
{
from
:
profileDir
ignoreExisting
:
true
}
)
;
let
trashDirExists
=
await
OS
.
File
.
exists
(
trashDir
)
;
ok
(
trashDirExists
"
trash
directory
should
have
been
created
"
)
;
let
file
=
await
OS
.
File
.
open
(
testFile
{
create
:
true
}
{
winShare
:
0
}
)
;
let
fileExists
=
await
OS
.
File
.
exists
(
testFile
)
;
ok
(
fileExists
"
test
.
txt
should
have
been
created
in
"
+
trashDir
)
;
await
promiseInstallWebExtension
(
{
}
)
;
fileExists
=
await
OS
.
File
.
exists
(
testFile
)
;
ok
(
fileExists
"
test
.
txt
should
still
exist
"
)
;
await
promiseShutdownManager
(
)
;
await
file
.
close
(
)
;
await
OS
.
File
.
remove
(
testFile
)
;
await
OS
.
File
.
removeDir
(
trashDir
)
;
}
)
;
