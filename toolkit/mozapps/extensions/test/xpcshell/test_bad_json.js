add_task
(
async
function
(
)
{
createAppInfo
(
"
xpcshell
tests
.
mozilla
.
org
"
"
XPCShell
"
"
1
"
"
1
.
9
.
2
"
)
;
await
promiseStartupManager
(
)
;
const
ID
=
"
addon
tests
.
mozilla
.
org
"
;
await
promiseInstallWebExtension
(
{
manifest
:
{
version
:
"
2
.
0
"
browser_specific_settings
:
{
gecko
:
{
id
:
ID
}
}
}
}
)
;
await
promiseShutdownManager
(
)
;
await
saveJSON
(
{
not
:
"
what
we
expect
to
find
"
}
gExtensionsJSON
.
path
)
;
await
promiseStartupManager
(
)
;
let
addon
=
await
AddonManager
.
getAddonByID
(
ID
)
;
Assert
.
equal
(
addon
.
id
ID
)
;
await
promiseShutdownManager
(
)
;
let
data
=
await
loadJSON
(
gExtensionsJSON
.
path
)
;
Assert
.
ok
(
"
schemaVersion
"
in
data
)
;
Assert
.
equal
(
data
.
addons
[
0
]
.
id
ID
)
;
}
)
;
