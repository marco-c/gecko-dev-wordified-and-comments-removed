var
addon1
=
{
id
:
"
addon1
tests
.
mozilla
.
org
"
version
:
"
2
.
0
"
name
:
"
Test
1
"
bootstrap
:
true
targetApplications
:
[
{
id
:
"
xpcshell
tests
.
mozilla
.
org
"
minVersion
:
"
1
"
maxVersion
:
"
1
"
}
]
}
;
const
profileDir
=
gProfD
.
clone
(
)
;
profileDir
.
append
(
"
extensions
"
)
;
async
function
run_test
(
)
{
do_test_pending
(
"
Bad
JSON
"
)
;
createAppInfo
(
"
xpcshell
tests
.
mozilla
.
org
"
"
XPCShell
"
"
1
"
"
1
.
9
.
2
"
)
;
writeInstallRDFForExtension
(
addon1
profileDir
)
;
startupManager
(
)
;
shutdownManager
(
)
;
await
saveJSON
(
{
not
:
"
what
we
expect
to
find
"
}
gExtensionsJSON
.
path
)
;
startupManager
(
false
)
;
AddonManager
.
getAddonsByIDs
(
[
addon1
.
id
]
callback_soon
(
after_db_rebuild
)
)
;
}
async
function
after_db_rebuild
(
[
a1
]
)
{
Assert
.
equal
(
a1
.
id
addon1
.
id
)
;
shutdownManager
(
)
;
let
data
=
await
loadJSON
(
gExtensionsJSON
.
path
)
;
Assert
.
ok
(
"
schemaVersion
"
in
data
)
;
Assert
.
equal
(
data
.
addons
[
0
]
.
id
addon1
.
id
)
;
do_test_finished
(
"
Bad
JSON
"
)
;
}
