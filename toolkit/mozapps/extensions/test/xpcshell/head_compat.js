const
MANIFEST
=
"
compat_manifest
.
json
"
;
AddonManager
.
addExternalExtensionLoader
(
{
name
:
"
compat
-
test
"
manifestFile
:
MANIFEST
async
loadManifest
(
pkg
)
{
ChromeUtils
.
import
(
"
resource
:
/
/
gre
/
modules
/
addons
/
XPIDatabase
.
jsm
"
)
;
let
addon
=
new
AddonInternal
(
)
;
let
manifest
=
JSON
.
parse
(
await
pkg
.
readString
(
MANIFEST
)
)
;
Object
.
assign
(
addon
manifest
)
;
return
addon
;
}
loadScope
(
addon
file
)
{
return
{
install
(
)
{
}
uninstall
(
)
{
}
startup
(
)
{
}
shutdonw
(
)
{
}
}
;
}
}
)
;
const
DEFAULTS
=
{
defaultLocale
:
{
}
locales
:
[
]
targetPlatforms
:
[
]
type
:
"
extension
"
version
:
"
1
.
0
"
}
;
function
createAddon
(
manifest
)
{
return
AddonTestUtils
.
createTempXPIFile
(
{
[
MANIFEST
]
:
Object
.
assign
(
{
}
DEFAULTS
manifest
)
}
)
;
}
