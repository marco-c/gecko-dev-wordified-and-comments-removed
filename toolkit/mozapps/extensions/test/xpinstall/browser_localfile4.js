function
test
(
)
{
SpecialPowers
.
pushPrefEnv
(
{
set
:
[
[
"
extensions
.
postDownloadThirdPartyPrompt
"
false
]
]
}
)
;
Harness
.
installBlockedCallback
=
allow_blocked
;
Harness
.
installsCompletedCallback
=
finish_test
;
Harness
.
setup
(
)
;
Services
.
prefs
.
setBoolPref
(
"
xpinstall
.
whitelist
.
fileRequest
"
false
)
;
var
cr
=
Cc
[
"
mozilla
.
org
/
chrome
/
chrome
-
registry
;
1
"
]
.
getService
(
Ci
.
nsIChromeRegistry
)
;
var
chromeroot
=
extractChromeRoot
(
gTestPath
)
;
var
xpipath
=
chromeroot
;
try
{
xpipath
=
cr
.
convertChromeURL
(
makeURI
(
chromeroot
)
)
.
spec
;
}
catch
(
ex
)
{
}
gBrowser
.
selectedTab
=
BrowserTestUtils
.
addTab
(
gBrowser
)
;
BrowserTestUtils
.
startLoadingURIString
(
gBrowser
xpipath
+
"
navigate
.
html
?
amosigned
.
xpi
"
)
;
}
function
allow_blocked
(
)
{
ok
(
true
"
Seen
blocked
"
)
;
return
false
;
}
function
finish_test
(
count
)
{
is
(
count
0
"
No
add
-
ons
should
have
been
installed
"
)
;
Services
.
prefs
.
clearUserPref
(
"
xpinstall
.
whitelist
.
fileRequest
"
)
;
gBrowser
.
removeCurrentTab
(
)
;
Harness
.
finish
(
)
;
}
