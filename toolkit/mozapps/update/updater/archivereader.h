#
ifndef
ArchiveReader_h__
#
define
ArchiveReader_h__
#
include
<
stdio
.
h
>
#
include
"
mar
.
h
"
#
ifdef
XP_WIN
#
include
<
windows
.
h
>
typedef
WCHAR
NS_tchar
;
#
else
typedef
char
NS_tchar
;
#
endif
class
ArchiveReader
{
public
:
ArchiveReader
(
)
=
default
;
~
ArchiveReader
(
)
{
Close
(
)
;
}
int
Open
(
const
NS_tchar
*
path
)
;
int
VerifySignature
(
)
;
int
VerifyProductInformation
(
const
char
*
MARChannelID
const
char
*
appVersion
)
;
void
Close
(
)
;
int
ExtractFile
(
const
char
*
item
const
NS_tchar
*
destination
)
;
int
ExtractFileToStream
(
const
char
*
item
FILE
*
fp
)
;
private
:
int
ExtractItemToStream
(
const
MarItem
*
item
FILE
*
fp
)
;
MarFile
*
mArchive
=
nullptr
;
uint8_t
*
mInBuf
=
nullptr
;
uint8_t
*
mOutBuf
=
nullptr
;
size_t
mInBufSize
=
262144
;
size_t
mOutBufSize
=
262144
;
}
;
#
endif
