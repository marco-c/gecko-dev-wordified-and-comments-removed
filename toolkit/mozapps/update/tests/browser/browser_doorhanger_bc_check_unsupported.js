"
use
strict
"
;
add_task
(
async
function
doorhanger_bc_check_unsupported
(
)
{
let
params
=
{
checkAttempts
:
1
queryString
:
"
&
unsupported
=
1
"
}
;
await
runDoorhangerUpdateTest
(
params
[
{
notificationId
:
"
update
-
unsupported
"
button
:
"
button
"
pageURLs
:
{
manual
:
gDetailsURL
}
}
async
function
doorhanger_unsupported_persist
(
)
{
await
TestUtils
.
waitForCondition
(
(
)
=
>
PanelUI
.
menuButton
.
hasAttribute
(
"
badge
-
status
"
)
"
Waiting
for
update
badge
"
undefined
200
)
.
catch
(
e
=
>
{
logTestInfo
(
e
)
;
}
)
;
is
(
PanelUI
.
notificationPanel
.
state
"
closed
"
"
The
window
'
s
doorhanger
is
closed
.
"
)
;
ok
(
PanelUI
.
menuButton
.
hasAttribute
(
"
badge
-
status
"
)
"
The
window
has
a
badge
.
"
)
;
is
(
PanelUI
.
menuButton
.
getAttribute
(
"
badge
-
status
"
)
"
update
-
unsupported
"
"
The
correct
badge
is
showing
for
the
background
window
"
)
;
UpdateListener
.
reset
(
)
;
is
(
PanelUI
.
notificationPanel
.
state
"
closed
"
"
The
window
'
s
doorhanger
is
closed
.
"
)
;
ok
(
!
PanelUI
.
menuButton
.
hasAttribute
(
"
badge
-
status
"
)
"
The
window
does
not
have
a
badge
.
"
)
;
UpdateListener
.
init
(
)
;
is
(
PanelUI
.
notificationPanel
.
state
"
closed
"
"
The
window
'
s
doorhanger
is
closed
.
"
)
;
ok
(
PanelUI
.
menuButton
.
hasAttribute
(
"
badge
-
status
"
)
"
The
window
has
a
badge
.
"
)
;
is
(
PanelUI
.
menuButton
.
getAttribute
(
"
badge
-
status
"
)
"
update
-
unsupported
"
"
The
correct
badge
is
showing
for
the
background
window
.
"
)
;
}
]
)
;
params
=
{
checkAttempts
:
1
queryString
:
"
&
invalidCompleteSize
=
1
&
promptWaitTime
=
0
"
}
;
await
runDoorhangerUpdateTest
(
params
[
{
notificationId
:
"
update
-
restart
"
button
:
"
secondaryButton
"
checkActiveUpdate
:
{
state
:
STATE_PENDING
}
}
async
function
doorhanger_unsupported_removed
(
)
{
let
unsupportedURL
=
Services
.
prefs
.
getCharPref
(
PREF_APP_UPDATE_UNSUPPORTED_URL
null
)
;
ok
(
!
unsupportedURL
"
The
"
+
PREF_APP_UPDATE_UNSUPPORTED_URL
+
"
preference
was
removed
.
"
)
;
}
]
)
;
}
)
;
