"
use
strict
"
;
add_task
(
async
function
telemetry_partial_applyFailure_complete_stageFailure
(
)
{
let
updateParams
=
"
"
;
await
runTelemetryUpdateTest
(
updateParams
"
update
-
downloaded
"
)
;
await
SpecialPowers
.
pushPrefEnv
(
{
set
:
[
[
PREF_APP_UPDATE_STAGING_ENABLED
true
]
]
}
)
;
await
setupTestUpdater
(
)
;
removeUpdateSettingsIni
(
)
;
writeStatusFile
(
STATE_FAILED_CRC_ERROR
)
;
testPostUpdateProcessing
(
)
;
checkTelemetryUpdatePhaseEmpty
(
true
)
;
await
waitForEvent
(
"
update
-
staged
"
)
;
let
expected
=
getTelemetryUpdatePhaseValues
(
{
forSession
:
true
noStagePartial
:
true
noApplyComplete
:
true
}
)
;
checkTelemetryUpdatePhases
(
expected
)
;
testPostUpdateProcessing
(
)
;
checkTelemetryUpdatePhaseEmpty
(
true
)
;
}
)
;
