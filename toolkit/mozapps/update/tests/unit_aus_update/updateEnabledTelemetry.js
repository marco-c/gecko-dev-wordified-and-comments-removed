"
use
strict
"
;
const
{
TelemetryEnvironment
}
=
ChromeUtils
.
importESModule
(
"
resource
:
/
/
gre
/
modules
/
TelemetryEnvironment
.
sys
.
mjs
"
)
;
add_task
(
async
function
telemetryEnvironmentUpdateEnabled
(
)
{
const
origSysinfo
=
Services
.
sysinfo
;
registerCleanupFunction
(
(
)
=
>
{
Services
.
sysinfo
=
origSysinfo
;
}
)
;
const
mockSysinfo
=
Object
.
create
(
origSysinfo
{
getProperty
:
{
configurable
:
true
enumerable
:
true
writable
:
false
value
:
prop
=
>
{
if
(
prop
=
=
"
isPackagedApp
"
)
{
return
true
;
}
return
origSysinfo
.
getProperty
(
prop
)
;
}
}
}
)
;
Services
.
sysinfo
=
mockSysinfo
;
const
environmentData
=
await
TelemetryEnvironment
.
onInitialized
(
)
;
Assert
.
equal
(
environmentData
.
settings
.
update
.
enabled
false
"
Update
should
not
be
reported
as
enabled
in
a
packaged
app
"
)
;
}
)
;
