const
WindowWatcher
=
{
openWindow
(
aParent
aUrl
aName
aFeatures
aArgs
)
{
do_throw
(
"
should
not
have
called
openWindow
!
"
)
;
}
getNewPrompter
(
aParent
)
{
do_throw
(
"
should
not
have
seen
getNewPrompter
!
"
)
;
}
QueryInterface
:
XPCOMUtils
.
generateQI
(
[
Ci
.
nsIWindowWatcher
]
)
}
;
function
run_test
(
)
{
setupTestCommon
(
)
;
debugDump
(
"
testing
nsIUpdatePrompt
notifications
should
not
be
seen
"
+
"
when
the
"
+
PREF_APP_UPDATE_SILENT
+
"
preference
is
true
"
)
;
Services
.
prefs
.
setBoolPref
(
PREF_APP_UPDATE_SILENT
true
)
;
let
windowWatcherCID
=
MockRegistrar
.
register
(
"
mozilla
.
org
/
embedcomp
/
window
-
watcher
;
1
"
WindowWatcher
)
;
do_register_cleanup
(
(
)
=
>
{
MockRegistrar
.
unregister
(
windowWatcherCID
)
;
}
)
;
standardInit
(
)
;
logTestInfo
(
"
testing
showUpdateAvailable
should
not
call
openWindow
"
)
;
let
patchProps
=
{
state
:
STATE_FAILED
}
;
let
patches
=
getLocalPatchString
(
patchProps
)
;
let
updates
=
getLocalUpdateString
(
{
}
patches
)
;
writeUpdatesToXMLFile
(
getLocalUpdatesXMLString
(
updates
)
true
)
;
writeStatusFile
(
STATE_FAILED
)
;
reloadUpdateManagerData
(
)
;
let
update
=
gUpdateManager
.
activeUpdate
;
gUP
.
showUpdateAvailable
(
update
)
;
Assert
.
ok
(
true
"
calling
showUpdateAvailable
should
not
attempt
to
open
a
window
"
)
;
logTestInfo
(
"
testing
showUpdateError
should
not
call
getNewPrompter
"
)
;
update
.
errorCode
=
WRITE_ERROR
;
gUP
.
showUpdateError
(
update
)
;
Assert
.
ok
(
true
"
calling
showUpdateError
should
not
attempt
to
open
a
window
"
)
;
gUpdateManager
.
cleanupActiveUpdate
(
)
;
do_execute_soon
(
waitForUpdateXMLFiles
)
;
}
function
waitForUpdateXMLFilesFinished
(
)
{
doTestFinish
(
)
;
}
