async
function
run_test
(
)
{
setupTestCommon
(
)
;
debugDump
(
"
testing
mar
mar
download
interrupted
recovery
"
)
;
Services
.
prefs
.
setIntPref
(
"
network
.
http
.
speculative
-
parallel
-
limit
"
6
)
;
registerCleanupFunction
(
(
)
=
>
{
Services
.
prefs
.
clearUserPref
(
"
network
.
http
.
speculative
-
parallel
-
limit
"
)
;
}
)
;
Services
.
prefs
.
setBoolPref
(
PREF_APP_UPDATE_STAGING_ENABLED
false
)
;
start_httpserver
(
)
;
setUpdateURL
(
gURLData
+
gHTTPHandlerPath
)
;
await
downloadUpdate
(
{
incrementalDownloadErrorType
:
0
expectedCheckResult
:
{
updateCount
:
1
}
}
)
;
stop_httpserver
(
doTestFinish
)
;
}
