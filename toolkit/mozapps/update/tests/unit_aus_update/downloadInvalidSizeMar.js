async
function
run_test
(
)
{
do_get_profile
(
)
;
setupTestCommon
(
)
;
debugDump
(
"
testing
mar
download
with
an
invalid
file
size
"
)
;
Services
.
prefs
.
setBoolPref
(
PREF_APP_UPDATE_STAGING_ENABLED
false
)
;
start_httpserver
(
)
;
setUpdateURL
(
gURLData
+
gHTTPHandlerPath
)
;
let
patchProps
=
{
size
:
"
1024000
"
}
;
let
patches
=
getRemotePatchString
(
patchProps
)
;
let
updates
=
getRemoteUpdateString
(
{
}
patches
)
;
gResponseBody
=
getRemoteUpdatesXMLString
(
updates
)
;
await
waitForUpdateCheck
(
true
{
updateCount
:
1
}
)
.
then
(
async
(
aArgs
)
=
>
{
await
waitForUpdateDownload
(
aArgs
.
updates
aArgs
.
updateCount
Cr
.
NS_ERROR_UNEXPECTED
)
;
}
)
;
await
waitForUpdateXMLFiles
(
)
;
stop_httpserver
(
doTestFinish
)
;
}
