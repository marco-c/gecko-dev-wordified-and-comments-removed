async
function
run_test
(
)
{
setupTestCommon
(
)
;
debugDump
(
"
testing
resuming
an
update
download
in
progress
for
the
same
"
+
"
version
of
the
application
on
startup
(
Bug
485624
)
"
)
;
let
patchProps
=
{
state
:
STATE_DOWNLOADING
}
;
let
patches
=
getLocalPatchString
(
patchProps
)
;
let
updateProps
=
{
appVersion
:
"
1
.
0
"
}
;
let
updates
=
getLocalUpdateString
(
updateProps
patches
)
;
writeUpdatesToXMLFile
(
getLocalUpdatesXMLString
(
updates
)
true
)
;
writeStatusFile
(
STATE_DOWNLOADING
)
;
await
standardInit
(
)
;
const
history
=
await
gUpdateManager
.
getHistory
(
)
;
Assert
.
equal
(
history
.
length
0
"
the
update
manager
updateCount
attribute
"
+
MSG_SHOULD_EQUAL
)
;
Assert
.
equal
(
(
await
gUpdateManager
.
getDownloadingUpdate
(
)
)
.
state
STATE_DOWNLOADING
"
the
update
manager
activeUpdate
state
attribute
"
+
MSG_SHOULD_EQUAL
)
;
await
gAUS
.
stopDownload
(
)
;
executeSoon
(
doTestFinish
)
;
}
