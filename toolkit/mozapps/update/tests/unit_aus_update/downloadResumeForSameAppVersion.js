function
run_test
(
)
{
setupTestCommon
(
)
;
debugDump
(
"
testing
resuming
an
update
download
in
progress
for
the
same
"
+
"
version
of
the
application
on
startup
(
Bug
485624
)
"
)
;
let
patchProps
=
{
state
:
STATE_DOWNLOADING
}
;
let
patches
=
getLocalPatchString
(
patchProps
)
;
let
updateProps
=
{
appVersion
:
"
1
.
0
"
}
;
let
updates
=
getLocalUpdateString
(
updateProps
patches
)
;
writeUpdatesToXMLFile
(
getLocalUpdatesXMLString
(
updates
)
true
)
;
writeStatusFile
(
STATE_DOWNLOADING
)
;
standardInit
(
)
;
Assert
.
equal
(
gUpdateManager
.
updateCount
0
"
the
update
manager
updateCount
attribute
"
+
MSG_SHOULD_EQUAL
)
;
Assert
.
equal
(
gUpdateManager
.
activeUpdate
.
state
STATE_DOWNLOADING
"
the
update
manager
activeUpdate
state
attribute
"
+
MSG_SHOULD_EQUAL
)
;
gAUS
.
pauseDownload
(
)
;
gUpdateManager
.
cleanupActiveUpdate
(
)
;
do_execute_soon
(
waitForUpdateXMLFiles
)
;
}
function
waitForUpdateXMLFilesFinished
(
)
{
do_execute_soon
(
doTestFinish
)
;
}
