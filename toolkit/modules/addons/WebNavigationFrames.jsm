"
use
strict
"
;
const
EXPORTED_SYMBOLS
=
[
"
WebNavigationFrames
"
]
;
var
Ci
=
Components
.
interfaces
;
function
getWindowId
(
window
)
{
return
window
.
QueryInterface
(
Ci
.
nsIInterfaceRequestor
)
.
getInterface
(
Ci
.
nsIDOMWindowUtils
)
.
outerWindowID
;
}
function
getParentWindowId
(
window
)
{
return
getWindowId
(
window
.
parent
)
;
}
function
docShellToWindow
(
docShell
)
{
return
docShell
.
QueryInterface
(
Ci
.
nsIInterfaceRequestor
)
.
getInterface
(
Ci
.
nsIDOMWindow
)
;
}
function
convertDocShellToFrameDetail
(
docShell
)
{
let
window
=
docShellToWindow
(
docShell
)
;
return
{
windowId
:
getWindowId
(
window
)
parentWindowId
:
getParentWindowId
(
window
)
url
:
window
.
location
.
href
}
;
}
function
*
iterateDocShellTree
(
docShell
)
{
let
docShellsEnum
=
docShell
.
getDocShellEnumerator
(
Ci
.
nsIDocShellTreeItem
.
typeContent
Ci
.
nsIDocShell
.
ENUMERATE_FORWARDS
)
;
while
(
docShellsEnum
.
hasMoreElements
(
)
)
{
yield
docShellsEnum
.
getNext
(
)
;
}
return
null
;
}
function
findFrame
(
windowId
rootDocShell
)
{
for
(
let
docShell
of
iterateDocShellTree
(
rootDocShell
)
)
{
if
(
windowId
=
=
getWindowId
(
docShellToWindow
(
docShell
)
)
)
{
return
convertDocShellToFrameDetail
(
docShell
)
;
}
}
return
null
;
}
var
WebNavigationFrames
=
{
getFrame
(
docShell
frameId
)
{
if
(
frameId
=
=
0
)
{
return
convertDocShellToFrameDetail
(
docShell
)
;
}
return
findFrame
(
frameId
docShell
)
;
}
getAllFrames
(
docShell
)
{
return
Array
.
from
(
iterateDocShellTree
(
docShell
)
convertDocShellToFrameDetail
)
;
}
getWindowId
getParentWindowId
}
;
