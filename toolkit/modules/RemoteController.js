function
RemoteController
(
browser
)
{
this
.
_browser
=
browser
;
this
.
_supportedCommands
=
{
}
;
}
RemoteController
.
prototype
=
{
QueryInterface
:
ChromeUtils
.
generateQI
(
[
Ci
.
nsIController
Ci
.
nsICommandController
]
)
isCommandEnabled
(
aCommand
)
{
return
this
.
_supportedCommands
[
aCommand
]
|
|
false
;
}
supportsCommand
(
aCommand
)
{
return
aCommand
in
this
.
_supportedCommands
;
}
doCommand
(
aCommand
)
{
this
.
_browser
.
messageManager
.
sendAsyncMessage
(
"
ControllerCommands
:
Do
"
aCommand
)
;
}
getCommandStateWithParams
(
aCommand
aCommandParams
)
{
throw
Cr
.
NS_ERROR_NOT_IMPLEMENTED
;
}
doCommandWithParams
(
aCommand
aCommandParams
)
{
let
cmd
=
{
cmd
:
aCommand
params
:
null
}
;
if
(
aCommand
=
=
"
cmd_lookUpDictionary
"
)
{
let
rect
=
this
.
_browser
.
getBoundingClientRect
(
)
;
let
scale
=
this
.
_browser
.
ownerGlobal
.
devicePixelRatio
;
cmd
.
params
=
{
x
:
{
type
:
"
long
"
value
:
aCommandParams
.
getLongValue
(
"
x
"
)
-
rect
.
left
*
scale
}
y
:
{
type
:
"
long
"
value
:
aCommandParams
.
getLongValue
(
"
y
"
)
-
rect
.
top
*
scale
}
}
;
}
else
{
throw
Cr
.
NS_ERROR_NOT_IMPLEMENTED
;
}
this
.
_browser
.
messageManager
.
sendAsyncMessage
(
"
ControllerCommands
:
DoWithParams
"
cmd
)
;
}
getSupportedCommands
(
)
{
throw
Cr
.
NS_ERROR_NOT_IMPLEMENTED
;
}
onEvent
(
)
{
}
enableDisableCommands
(
aAction
aEnabledCommands
aDisabledCommands
)
{
this
.
_supportedCommands
=
{
}
;
for
(
let
command
of
aEnabledCommands
)
{
this
.
_supportedCommands
[
command
]
=
true
;
}
for
(
let
command
of
aDisabledCommands
)
{
this
.
_supportedCommands
[
command
]
=
false
;
}
if
(
this
.
_browser
!
=
this
.
_browser
.
ownerDocument
.
activeElement
)
{
return
;
}
this
.
_browser
.
ownerGlobal
.
updateCommands
(
aAction
)
;
}
}
;
