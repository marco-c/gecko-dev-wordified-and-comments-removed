const
Ci
=
Components
.
interfaces
;
const
Cc
=
Components
.
classes
;
const
Cu
=
Components
.
utils
;
const
Cr
=
Components
.
results
;
ChromeUtils
.
import
(
"
resource
:
/
/
gre
/
modules
/
XPCOMUtils
.
jsm
"
)
;
function
RemoteController
(
browser
)
{
this
.
_browser
=
browser
;
this
.
_supportedCommands
=
{
}
;
}
RemoteController
.
prototype
=
{
QueryInterface
:
XPCOMUtils
.
generateQI
(
[
Ci
.
nsIController
Ci
.
nsICommandController
]
)
isCommandEnabled
(
aCommand
)
{
return
this
.
_supportedCommands
[
aCommand
]
|
|
false
;
}
supportsCommand
(
aCommand
)
{
return
aCommand
in
this
.
_supportedCommands
;
}
doCommand
(
aCommand
)
{
this
.
_browser
.
messageManager
.
sendAsyncMessage
(
"
ControllerCommands
:
Do
"
aCommand
)
;
}
getCommandStateWithParams
(
aCommand
aCommandParams
)
{
throw
Cr
.
NS_ERROR_NOT_IMPLEMENTED
;
}
doCommandWithParams
(
aCommand
aCommandParams
)
{
let
cmd
=
{
cmd
:
aCommand
params
:
null
}
;
if
(
aCommand
=
=
"
cmd_lookUpDictionary
"
)
{
let
rect
=
this
.
_browser
.
getBoundingClientRect
(
)
;
let
scale
=
this
.
_browser
.
ownerGlobal
.
devicePixelRatio
;
cmd
.
params
=
{
x
:
{
type
:
"
long
"
value
:
aCommandParams
.
getLongValue
(
"
x
"
)
-
rect
.
left
*
scale
}
y
:
{
type
:
"
long
"
value
:
aCommandParams
.
getLongValue
(
"
y
"
)
-
rect
.
top
*
scale
}
}
;
}
else
{
throw
Cr
.
NS_ERROR_NOT_IMPLEMENTED
;
}
this
.
_browser
.
messageManager
.
sendAsyncMessage
(
"
ControllerCommands
:
DoWithParams
"
cmd
)
;
}
getSupportedCommands
(
aCount
aCommands
)
{
throw
Cr
.
NS_ERROR_NOT_IMPLEMENTED
;
}
onEvent
(
)
{
}
enableDisableCommands
(
aAction
aEnabledLength
aEnabledCommands
aDisabledLength
aDisabledCommands
)
{
this
.
_supportedCommands
=
{
}
;
for
(
let
c
=
0
;
c
<
aEnabledLength
;
c
+
+
)
{
this
.
_supportedCommands
[
aEnabledCommands
[
c
]
]
=
true
;
}
for
(
let
c
=
0
;
c
<
aDisabledLength
;
c
+
+
)
{
this
.
_supportedCommands
[
aDisabledCommands
[
c
]
]
=
false
;
}
this
.
_browser
.
ownerGlobal
.
updateCommands
(
aAction
)
;
}
}
;
