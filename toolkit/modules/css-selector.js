"
use
strict
"
;
var
EXPORTED_SYMBOLS
=
[
"
findAllCssSelectors
"
"
findCssSelector
"
]
;
function
getRootBindingParent
(
node
)
{
let
doc
=
node
.
ownerDocument
;
if
(
!
doc
)
{
return
node
;
}
let
parent
;
while
(
(
parent
=
doc
.
getBindingParent
(
node
)
)
)
{
node
=
parent
;
}
return
node
;
}
function
getShadowRoot
(
node
)
{
let
doc
=
node
.
ownerDocument
;
if
(
!
doc
)
{
return
null
;
}
const
parent
=
doc
.
getBindingParent
(
node
)
;
const
shadowRoot
=
parent
&
&
parent
.
openOrClosedShadowRoot
;
if
(
shadowRoot
)
{
return
shadowRoot
;
}
return
null
;
}
function
positionInNodeList
(
element
nodeList
)
{
for
(
let
i
=
0
;
i
<
nodeList
.
length
;
i
+
+
)
{
if
(
element
=
=
=
nodeList
[
i
]
)
{
return
i
;
}
}
return
-
1
;
}
function
findNodeAndContainer
(
node
)
{
const
shadowRoot
=
getShadowRoot
(
node
)
;
if
(
shadowRoot
)
{
return
{
containingDocOrShadow
:
shadowRoot
node
}
;
}
const
bindingParent
=
getRootBindingParent
(
node
)
;
return
{
containingDocOrShadow
:
bindingParent
.
ownerDocument
node
:
bindingParent
}
;
}
const
findCssSelector
=
function
(
ele
)
{
const
{
node
containingDocOrShadow
}
=
findNodeAndContainer
(
ele
)
;
ele
=
node
;
if
(
!
containingDocOrShadow
|
|
!
containingDocOrShadow
.
contains
(
ele
)
)
{
return
"
"
;
}
let
cssEscape
=
ele
.
ownerGlobal
.
CSS
.
escape
;
if
(
ele
.
id
&
&
containingDocOrShadow
.
querySelectorAll
(
"
#
"
+
cssEscape
(
ele
.
id
)
)
.
length
=
=
=
1
)
{
return
"
#
"
+
cssEscape
(
ele
.
id
)
;
}
let
tagName
=
ele
.
localName
;
if
(
tagName
=
=
=
"
html
"
)
{
return
"
html
"
;
}
if
(
tagName
=
=
=
"
head
"
)
{
return
"
head
"
;
}
if
(
tagName
=
=
=
"
body
"
)
{
return
"
body
"
;
}
let
selector
index
matches
;
for
(
let
i
=
0
;
i
<
ele
.
classList
.
length
;
i
+
+
)
{
selector
=
"
.
"
+
cssEscape
(
ele
.
classList
.
item
(
i
)
)
;
matches
=
containingDocOrShadow
.
querySelectorAll
(
selector
)
;
if
(
matches
.
length
=
=
=
1
)
{
return
selector
;
}
selector
=
cssEscape
(
tagName
)
+
selector
;
matches
=
containingDocOrShadow
.
querySelectorAll
(
selector
)
;
if
(
matches
.
length
=
=
=
1
)
{
return
selector
;
}
index
=
positionInNodeList
(
ele
ele
.
parentNode
.
children
)
+
1
;
selector
=
selector
+
"
:
nth
-
child
(
"
+
index
+
"
)
"
;
matches
=
containingDocOrShadow
.
querySelectorAll
(
selector
)
;
if
(
matches
.
length
=
=
=
1
)
{
return
selector
;
}
}
index
=
positionInNodeList
(
ele
ele
.
parentNode
.
children
)
+
1
;
selector
=
cssEscape
(
tagName
)
+
"
:
nth
-
child
(
"
+
index
+
"
)
"
;
if
(
ele
.
parentNode
!
=
=
containingDocOrShadow
)
{
selector
=
findCssSelector
(
ele
.
parentNode
)
+
"
>
"
+
selector
;
}
return
selector
;
}
;
function
getSelectorParent
(
node
)
{
const
shadowRoot
=
getShadowRoot
(
node
)
;
if
(
shadowRoot
)
{
return
shadowRoot
.
host
;
}
return
node
.
ownerGlobal
.
frameElement
;
}
const
findAllCssSelectors
=
function
(
node
)
{
let
selectors
=
[
]
;
while
(
node
)
{
selectors
.
unshift
(
findCssSelector
(
node
)
)
;
node
=
getSelectorParent
(
node
)
;
}
return
selectors
;
}
;
