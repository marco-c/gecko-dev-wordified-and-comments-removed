"
use
strict
"
;
ChromeUtils
.
import
(
"
resource
:
/
/
gre
/
modules
/
PromiseMessage
.
jsm
"
this
)
;
const
url
=
"
http
:
/
/
example
.
org
/
tests
/
dom
/
manifest
/
test
/
resource
.
sjs
"
;
add_task
(
async
function
(
)
{
await
BrowserTestUtils
.
withNewTab
(
{
gBrowser
url
}
testPromiseMessageAPI
)
;
}
)
;
async
function
testPromiseMessageAPI
(
aBrowser
)
{
const
msgKey
=
"
DOM
:
WebManifest
:
hasManifestLink
"
;
const
mm
=
aBrowser
.
messageManager
;
const
id
=
"
this
should
not
change
"
;
const
foo
=
"
neitherShouldThis
"
;
const
data
=
{
id
foo
}
;
await
PromiseMessage
.
send
(
mm
msgKey
data
)
;
const
props
=
Object
.
getOwnPropertyNames
(
data
)
;
ok
(
props
.
length
=
=
=
2
"
There
should
only
be
2
props
"
)
;
ok
(
props
.
includes
(
"
id
"
)
"
Has
the
id
property
"
)
;
ok
(
props
.
includes
(
"
foo
"
)
"
Has
the
foo
property
"
)
;
is
(
data
.
id
id
"
The
id
prop
must
not
change
.
"
)
;
is
(
data
.
foo
foo
"
The
foo
prop
must
not
change
.
"
)
;
}
