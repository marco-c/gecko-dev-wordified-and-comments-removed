{
let
commonFile
=
do_get_file
(
"
.
.
/
head_common
.
js
"
false
)
;
let
uri
=
Services
.
io
.
newFileURI
(
commonFile
)
;
Services
.
scriptloader
.
loadSubScript
(
uri
.
spec
this
)
;
}
const
systemPrincipal
=
Services
.
scriptSecurityManager
.
getSystemPrincipal
(
)
;
function
checkFaviconDataForPage
(
aPageURI
aExpectedMimeType
aExpectedData
aCallback
)
{
PlacesUtils
.
favicons
.
getFaviconDataForPage
(
aPageURI
async
function
(
aURI
aDataLen
aData
aMimeType
)
{
Assert
.
equal
(
aExpectedMimeType
aMimeType
)
;
Assert
.
ok
(
compareArrays
(
aExpectedData
aData
)
)
;
await
check_guid_for_uri
(
aPageURI
)
;
aCallback
(
)
;
}
)
;
}
function
checkFaviconMissingForPage
(
aPageURI
aCallback
)
{
PlacesUtils
.
favicons
.
getFaviconURLForPage
(
aPageURI
function
(
aURI
aDataLen
aData
aMimeType
)
{
Assert
.
ok
(
aURI
=
=
=
null
)
;
aCallback
(
)
;
}
)
;
}
function
promiseFaviconMissingForPage
(
aPageURI
)
{
return
new
Promise
(
resolve
=
>
checkFaviconMissingForPage
(
aPageURI
resolve
)
)
;
}
function
promiseFaviconChanged
(
aExpectedPageURI
aExpectedFaviconURI
)
{
return
new
Promise
(
resolve
=
>
{
PlacesTestUtils
.
waitForNotification
(
"
favicon
-
changed
"
async
events
=
>
{
for
(
let
e
of
events
)
{
if
(
e
.
url
=
=
aExpectedPageURI
.
spec
)
{
Assert
.
equal
(
e
.
faviconUrl
aExpectedFaviconURI
.
spec
)
;
await
check_guid_for_uri
(
aExpectedPageURI
e
.
pageGuid
)
;
resolve
(
)
;
}
}
}
)
;
}
)
;
}
