"
use
strict
"
;
const
TEST_PAGE_URI
=
NetUtil
.
newURI
(
"
http
:
/
/
example
.
com
/
"
)
;
const
BOOKMARKED_PAGE_URI
=
NetUtil
.
newURI
(
"
http
:
/
/
example
.
com
/
bookmarked
"
)
;
add_task
(
async
function
test_expireAllFavicons
(
)
{
await
PlacesTestUtils
.
addVisits
(
{
uri
:
TEST_PAGE_URI
transition
:
TRANSITION_TYPED
}
)
;
await
setFaviconForPage
(
TEST_PAGE_URI
SMALLPNG_DATA_URI
)
;
await
PlacesUtils
.
bookmarks
.
insert
(
{
parentGuid
:
PlacesUtils
.
bookmarks
.
toolbarGuid
url
:
BOOKMARKED_PAGE_URI
title
:
"
Test
bookmark
"
}
)
;
await
setFaviconForPage
(
BOOKMARKED_PAGE_URI
SMALLPNG_DATA_URI
)
;
let
promise
=
promiseTopicObserved
(
PlacesUtils
.
TOPIC_FAVICONS_EXPIRED
)
;
PlacesUtils
.
favicons
.
expireAllFavicons
(
)
;
await
promise
;
await
promiseFaviconMissingForPage
(
TEST_PAGE_URI
)
;
await
promiseFaviconMissingForPage
(
BOOKMARKED_PAGE_URI
)
;
}
)
;
