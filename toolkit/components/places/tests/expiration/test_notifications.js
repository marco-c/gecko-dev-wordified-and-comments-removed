"
use
strict
"
;
var
gObserver
=
{
notifications
:
0
observe
(
aSubject
aTopic
aData
)
{
this
.
notifications
+
+
;
}
}
;
Services
.
obs
.
addObserver
(
gObserver
PlacesUtils
.
TOPIC_EXPIRATION_FINISHED
)
;
add_task
(
async
function
test_history_expirations_notify_just_once
(
)
{
setInterval
(
3600
)
;
promiseForceExpirationStep
(
1
)
;
await
new
Promise
(
resolve
=
>
{
do_timeout
(
2000
resolve
)
;
}
)
;
Assert
.
equal
(
gObserver
.
notifications
1
)
;
Services
.
obs
.
removeObserver
(
gObserver
PlacesUtils
.
TOPIC_EXPIRATION_FINISHED
)
;
}
)
;
