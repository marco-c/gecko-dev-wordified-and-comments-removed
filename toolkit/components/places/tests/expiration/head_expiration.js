var
{
Services
}
=
ChromeUtils
.
import
(
"
resource
:
/
/
gre
/
modules
/
Services
.
jsm
"
)
;
{
let
commonFile
=
do_get_file
(
"
.
.
/
head_common
.
js
"
false
)
;
let
uri
=
Services
.
io
.
newFileURI
(
commonFile
)
;
Services
.
scriptloader
.
loadSubScript
(
uri
.
spec
this
)
;
}
function
force_expiration_start
(
)
{
Cc
[
"
mozilla
.
org
/
places
/
expiration
;
1
"
]
.
getService
(
Ci
.
nsIObserver
)
.
observe
(
null
"
testing
-
mode
"
null
)
;
}
function
promiseForceExpirationStep
(
aLimit
)
{
let
promise
=
promiseTopicObserved
(
PlacesUtils
.
TOPIC_EXPIRATION_FINISHED
)
;
let
expire
=
Cc
[
"
mozilla
.
org
/
places
/
expiration
;
1
"
]
.
getService
(
Ci
.
nsIObserver
)
;
expire
.
observe
(
null
"
places
-
debug
-
start
-
expiration
"
aLimit
)
;
return
promise
;
}
function
setInterval
(
aNewInterval
)
{
Services
.
prefs
.
setIntPref
(
"
places
.
history
.
expiration
.
interval_seconds
"
aNewInterval
)
;
}
function
getInterval
(
)
{
return
Services
.
prefs
.
getIntPref
(
"
places
.
history
.
expiration
.
interval_seconds
"
)
;
}
function
clearInterval
(
)
{
try
{
Services
.
prefs
.
clearUserPref
(
"
places
.
history
.
expiration
.
interval_seconds
"
)
;
}
catch
(
ex
)
{
}
}
function
setMaxPages
(
aNewMaxPages
)
{
Services
.
prefs
.
setIntPref
(
"
places
.
history
.
expiration
.
max_pages
"
aNewMaxPages
)
;
}
function
getMaxPages
(
)
{
return
Services
.
prefs
.
getIntPref
(
"
places
.
history
.
expiration
.
max_pages
"
)
;
}
function
clearMaxPages
(
)
{
try
{
Services
.
prefs
.
clearUserPref
(
"
places
.
history
.
expiration
.
max_pages
"
)
;
}
catch
(
ex
)
{
}
}
function
setHistoryEnabled
(
aHistoryEnabled
)
{
Services
.
prefs
.
setBoolPref
(
"
places
.
history
.
enabled
"
aHistoryEnabled
)
;
}
function
getHistoryEnabled
(
)
{
return
Services
.
prefs
.
getBoolPref
(
"
places
.
history
.
enabled
"
)
;
}
function
clearHistoryEnabled
(
)
{
try
{
Services
.
prefs
.
clearUserPref
(
"
places
.
history
.
enabled
"
)
;
}
catch
(
ex
)
{
}
}
function
getExpirablePRTime
(
daysAgo
=
7
)
{
let
dateObj
=
new
Date
(
)
;
dateObj
.
setHours
(
0
)
;
dateObj
.
setMinutes
(
0
)
;
dateObj
.
setSeconds
(
0
)
;
dateObj
.
setMilliseconds
(
0
)
;
dateObj
=
new
Date
(
dateObj
.
getTime
(
)
-
(
daysAgo
+
1
)
*
86400000
)
;
return
dateObj
.
getTime
(
)
*
1000
;
}
