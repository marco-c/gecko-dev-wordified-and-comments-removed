add_task
(
async
function
(
)
{
await
createCorruptDb
(
"
places
.
sqlite
"
)
;
let
count
=
Services
.
telemetry
.
getHistogramById
(
"
PLACES_DATABASE_CORRUPTION_HANDLING_STAGE
"
)
.
snapshot
(
)
.
counts
[
3
]
;
Assert
.
equal
(
count
0
"
There
should
be
no
telemetry
"
)
;
Assert
.
equal
(
PlacesUtils
.
history
.
databaseStatus
PlacesUtils
.
history
.
DATABASE_STATUS_CORRUPT
)
;
count
=
Services
.
telemetry
.
getHistogramById
(
"
PLACES_DATABASE_CORRUPTION_HANDLING_STAGE
"
)
.
snapshot
(
)
.
counts
[
3
]
;
Assert
.
equal
(
count
1
"
Telemetry
should
have
been
added
"
)
;
}
)
;
