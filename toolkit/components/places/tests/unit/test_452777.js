add_task
(
async
function
test_undo_folder_remove_within_transaction
(
)
{
const
TITLE
=
"
test
folder
"
;
let
folder
=
await
PlacesUtils
.
bookmarks
.
insert
(
{
parentGuid
:
PlacesUtils
.
bookmarks
.
unfiledGuid
title
:
TITLE
type
:
PlacesUtils
.
bookmarks
.
TYPE_FOLDER
}
)
;
let
id
=
await
PlacesUtils
.
promiseItemId
(
folder
.
guid
)
;
await
PlacesUtils
.
bookmarks
.
insert
(
{
parentGuid
:
PlacesUtils
.
bookmarks
.
unfiledGuid
title
:
"
test
folder
2
"
type
:
PlacesUtils
.
bookmarks
.
TYPE_FOLDER
}
)
;
let
transaction
=
PlacesUtils
.
bookmarks
.
getRemoveFolderTransaction
(
id
)
;
transaction
.
doTransaction
(
)
;
PlacesUtils
.
bookmarks
.
addObserver
(
{
onItemAdded
(
aItemId
aFolder
aIndex
aItemType
aURI
aTitle
)
{
Assert
.
equal
(
aItemId
id
)
;
Assert
.
equal
(
aTitle
TITLE
)
;
}
}
)
;
transaction
.
undoTransaction
(
)
;
}
)
;
