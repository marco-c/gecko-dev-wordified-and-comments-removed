add_task
(
async
function
(
)
{
const
TEST_URI
=
NetUtil
.
newURI
(
"
http
:
/
/
example
.
com
/
"
)
;
let
bookmark
=
await
PlacesUtils
.
bookmarks
.
insert
(
{
parentGuid
:
PlacesUtils
.
bookmarks
.
unfiledGuid
url
:
TEST_URI
title
:
"
A
title
"
}
)
;
await
PlacesFrecencyRecalculator
.
recalculateAnyOutdatedFrecencies
(
)
;
Assert
.
ok
(
(
await
PlacesTestUtils
.
getDatabaseValue
(
"
moz_places
"
"
frecency
"
{
url
:
TEST_URI
}
)
)
>
0
)
;
await
PlacesUtils
.
bookmarks
.
remove
(
bookmark
.
guid
)
;
await
PlacesFrecencyRecalculator
.
recalculateAnyOutdatedFrecencies
(
)
;
Assert
.
equal
(
await
PlacesTestUtils
.
getDatabaseValue
(
"
moz_places
"
"
frecency
"
{
url
:
TEST_URI
}
)
0
)
;
await
PlacesTestUtils
.
addVisits
(
{
uri
:
TEST_URI
}
)
;
Assert
.
ok
(
(
await
PlacesTestUtils
.
getDatabaseValue
(
"
moz_places
"
"
frecency
"
{
url
:
TEST_URI
}
)
)
>
0
)
;
}
)
;
