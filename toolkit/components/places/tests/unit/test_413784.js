var
searchTerm
=
"
"
;
var
decoded
=
"
http
:
/
/
www
.
foobar
.
com
/
"
+
searchTerm
+
"
/
"
;
var
url
=
uri
(
decoded
)
;
function
AutoCompleteInput
(
aSearches
)
{
this
.
searches
=
aSearches
;
}
AutoCompleteInput
.
prototype
=
{
constructor
:
AutoCompleteInput
searches
:
null
minResultsForPopup
:
0
timeout
:
10
searchParam
:
"
"
textValue
:
"
"
disableAutoComplete
:
false
completeDefaultIndex
:
false
get
searchCount
(
)
{
return
this
.
searches
.
length
;
}
getSearchAt
(
aIndex
)
{
return
this
.
searches
[
aIndex
]
;
}
onSearchBegin
(
)
{
}
onSearchComplete
(
)
{
}
popupOpen
:
false
popup
:
{
setSelectedIndex
(
aIndex
)
{
}
invalidate
(
)
{
}
QueryInterface
(
iid
)
{
if
(
iid
.
equals
(
Ci
.
nsISupports
)
|
|
iid
.
equals
(
Ci
.
nsIAutoCompletePopup
)
)
return
this
;
throw
Components
.
results
.
NS_ERROR_NO_INTERFACE
;
}
}
QueryInterface
(
iid
)
{
if
(
iid
.
equals
(
Ci
.
nsISupports
)
|
|
iid
.
equals
(
Ci
.
nsIAutoCompleteInput
)
)
return
this
;
throw
Components
.
results
.
NS_ERROR_NO_INTERFACE
;
}
}
add_task
(
async
function
test_autocomplete_non_english
(
)
{
await
PlacesTestUtils
.
addVisits
(
url
)
;
var
controller
=
Components
.
classes
[
"
mozilla
.
org
/
autocomplete
/
controller
;
1
"
]
.
getService
(
Components
.
interfaces
.
nsIAutoCompleteController
)
;
var
input
=
new
AutoCompleteInput
(
[
"
unifiedcomplete
"
]
)
;
controller
.
input
=
input
;
return
new
Promise
(
resolve
=
>
{
var
numSearchesStarted
=
0
;
input
.
onSearchBegin
=
function
(
)
{
numSearchesStarted
+
+
;
do_check_eq
(
numSearchesStarted
1
)
;
}
;
input
.
onSearchComplete
=
function
(
)
{
do_check_eq
(
numSearchesStarted
1
)
;
do_check_eq
(
controller
.
searchStatus
Ci
.
nsIAutoCompleteController
.
STATUS_COMPLETE_MATCH
)
;
do_check_eq
(
controller
.
matchCount
1
)
;
do_check_eq
(
controller
.
getValueAt
(
0
)
url
.
spec
)
;
resolve
(
)
;
}
;
controller
.
startSearch
(
searchTerm
)
;
}
)
;
}
)
;
