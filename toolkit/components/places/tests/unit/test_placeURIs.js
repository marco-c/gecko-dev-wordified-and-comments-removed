try
{
var
histsvc
=
Cc
[
"
mozilla
.
org
/
browser
/
nav
-
history
-
service
;
1
"
]
.
getService
(
Ci
.
nsINavHistoryService
)
;
}
catch
(
ex
)
{
do_throw
(
"
Could
not
get
history
service
\
n
"
)
;
}
function
run_test
(
)
{
const
NHQO
=
Ci
.
nsINavHistoryQueryOptions
;
var
query
=
histsvc
.
getNewQuery
(
)
;
query
.
setFolders
(
[
PlacesUtils
.
bookmarks
.
placesRoot
]
1
)
;
Assert
.
equal
(
histsvc
.
queriesToQueryString
(
[
query
]
1
histsvc
.
getNewQueryOptions
(
)
)
"
place
:
folder
=
PLACES_ROOT
"
)
;
var
options
=
histsvc
.
getNewQueryOptions
(
)
;
options
.
sortingAnnotation
=
"
test
anno
"
;
options
.
sortingMode
=
NHQO
.
SORT_BY_ANNOTATION_DESCENDING
;
var
placeURI
=
"
place
:
folder
=
PLACES_ROOT
&
sort
=
"
+
NHQO
.
SORT_BY_ANNOTATION_DESCENDING
+
"
&
sortingAnnotation
=
test
%
20anno
"
;
Assert
.
equal
(
histsvc
.
queriesToQueryString
(
[
query
]
1
options
)
placeURI
)
;
options
=
{
}
;
histsvc
.
queryStringToQueries
(
placeURI
{
}
{
}
options
)
;
Assert
.
equal
(
options
.
value
.
sortingAnnotation
"
test
anno
"
)
;
Assert
.
equal
(
options
.
value
.
sortingMode
NHQO
.
SORT_BY_ANNOTATION_DESCENDING
)
;
}
