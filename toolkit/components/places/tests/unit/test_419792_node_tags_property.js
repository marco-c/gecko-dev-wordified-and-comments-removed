var
histsvc
=
Cc
[
"
mozilla
.
org
/
browser
/
nav
-
history
-
service
;
1
"
]
.
getService
(
Ci
.
nsINavHistoryService
)
;
var
tagssvc
=
Cc
[
"
mozilla
.
org
/
browser
/
tagging
-
service
;
1
"
]
.
getService
(
Ci
.
nsITaggingService
)
;
add_task
(
async
function
test_query_node_tags_property
(
)
{
var
options
=
histsvc
.
getNewQueryOptions
(
)
;
var
query
=
histsvc
.
getNewQuery
(
)
;
query
.
setFolders
(
[
PlacesUtils
.
toolbarFolderId
]
1
)
;
var
result
=
histsvc
.
executeQuery
(
query
options
)
;
var
toolbarNode
=
result
.
root
;
toolbarNode
.
containerOpen
=
true
;
var
bookmarkURI
=
uri
(
"
http
:
/
/
foo
.
com
"
)
;
let
bookmark
=
await
PlacesUtils
.
bookmarks
.
insert
(
{
parentGuid
:
PlacesUtils
.
bookmarks
.
toolbarGuid
title
:
"
"
url
:
bookmarkURI
}
)
;
var
node
=
toolbarNode
.
getChild
(
toolbarNode
.
childCount
-
1
)
;
do_check_eq
(
node
.
bookmarkGuid
bookmark
.
guid
)
;
do_check_eq
(
node
.
tags
null
)
;
tagssvc
.
tagURI
(
bookmarkURI
[
"
foo
"
]
)
;
do_check_eq
(
node
.
tags
"
foo
"
)
;
tagssvc
.
tagURI
(
bookmarkURI
[
"
bar
"
]
)
;
do_check_eq
(
node
.
tags
"
bar
foo
"
)
;
tagssvc
.
untagURI
(
bookmarkURI
null
)
;
do_check_eq
(
node
.
tags
null
)
;
toolbarNode
.
containerOpen
=
false
;
}
)
;
