var
bmsvc
=
Cc
[
"
mozilla
.
org
/
browser
/
nav
-
bookmarks
-
service
;
1
"
]
.
getService
(
Ci
.
nsINavBookmarksService
)
;
async
function
checkUris
(
aBookmarkId
aBookmarkedUri
aUnbookmarkedUri
)
{
let
bm
=
await
PlacesUtils
.
bookmarks
.
fetch
(
{
url
:
aBookmarkedUri
}
)
;
do_check_neq
(
bm
null
)
;
do_check_true
(
uri
(
bm
.
url
)
.
equals
(
aBookmarkedUri
)
)
;
do_check_true
(
bmsvc
.
getBookmarkURI
(
aBookmarkId
)
.
equals
(
aBookmarkedUri
)
)
;
bm
=
await
PlacesUtils
.
bookmarks
.
fetch
(
{
url
:
aUnbookmarkedUri
}
)
;
do_check_eq
(
bm
null
)
;
}
add_task
(
async
function
(
)
{
var
folderId
=
bmsvc
.
createFolder
(
bmsvc
.
toolbarFolder
"
test
"
bmsvc
.
DEFAULT_INDEX
)
;
var
uri1
=
uri
(
"
http
:
/
/
www
.
dogs
.
com
/
"
)
;
var
uri2
=
uri
(
"
http
:
/
/
www
.
cats
.
com
/
"
)
;
var
bookmarkId
=
bmsvc
.
insertBookmark
(
folderId
uri1
bmsvc
.
DEFAULT_INDEX
"
Dogs
"
)
;
await
checkUris
(
bookmarkId
uri1
uri2
)
;
bmsvc
.
changeBookmarkURI
(
bookmarkId
uri2
)
;
await
checkUris
(
bookmarkId
uri2
uri1
)
;
}
)
;
