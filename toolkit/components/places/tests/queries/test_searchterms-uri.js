var
testData
=
[
{
isInQuery
:
true
isVisit
:
true
isDetails
:
true
isPageAnnotation
:
true
uri
:
"
http
:
/
/
foo
.
com
/
"
annoName
:
"
moz
/
test
"
annoVal
:
"
val
"
lastVisit
:
lastweek
title
:
"
you
know
moz
is
cool
"
}
{
isInQuery
:
false
isVisit
:
true
isDetails
:
true
title
:
"
moz
"
uri
:
"
https
:
/
/
foo
.
com
/
"
lastVisit
:
today
}
{
isInQuery
:
false
isVisit
:
true
isDetails
:
true
title
:
"
m
o
z
"
uri
:
"
http
:
/
/
foo
.
com
/
wrongsearch
.
php
"
lastVisit
:
today
}
{
isInQuery
:
false
isVisit
:
true
isDetails
:
true
uri
:
"
http
:
/
/
mail
.
foo
.
com
/
yiihah
"
title
:
"
blahmoz
"
lastVisit
:
daybefore
}
{
isInQuery
:
false
isVisit
:
true
isDetails
:
true
uri
:
"
ftp
:
/
/
foo
.
com
/
ftp
"
lastVisit
:
lastweek
title
:
"
hugelongconfmozlagurationofwordswithasearchtermsinit
whoo
-
hoo
"
}
{
isInQuery
:
false
isVisit
:
true
isDetails
:
true
title
:
"
m
%
0o
%
0z
"
uri
:
"
http
:
/
/
foo
.
com
/
changeme1
.
htm
"
lastVisit
:
yesterday
}
{
isInQuery
:
false
isVisit
:
true
isDetails
:
true
title
:
"
m
oz
"
uri
:
"
http
:
/
/
foo
.
com
/
changeme2
.
htm
"
lastVisit
:
tomorrow
}
]
;
function
run_test
(
)
{
run_next_test
(
)
;
}
add_task
(
function
*
test_searchterms_uri
(
)
{
yield
task_populateDB
(
testData
)
;
var
query
=
PlacesUtils
.
history
.
getNewQuery
(
)
;
query
.
searchTerms
=
"
moz
"
;
query
.
uri
=
uri
(
"
http
:
/
/
foo
.
com
"
)
;
var
options
=
PlacesUtils
.
history
.
getNewQueryOptions
(
)
;
options
.
sortingMode
=
options
.
SORT_BY_DATE_ASCENDING
;
options
.
resultType
=
options
.
RESULTS_AS_URI
;
var
result
=
PlacesUtils
.
history
.
executeQuery
(
query
options
)
;
var
root
=
result
.
root
;
root
.
containerOpen
=
true
;
do_print
(
"
Number
of
items
in
result
set
:
"
+
root
.
childCount
)
;
for
(
var
i
=
0
;
i
<
root
.
childCount
;
+
+
i
)
{
do_print
(
"
result
:
"
+
root
.
getChild
(
i
)
.
uri
+
"
Title
:
"
+
root
.
getChild
(
i
)
.
title
)
;
}
compareArrayToResult
(
testData
root
)
;
do_print
(
"
change
title
"
)
;
var
change1
=
[
{
isDetails
:
true
uri
:
"
http
:
/
/
foo
.
com
/
"
title
:
"
mo
"
}
]
;
yield
task_populateDB
(
change1
)
;
do_check_false
(
isInResult
(
{
uri
:
"
http
:
/
/
foo
.
com
/
"
}
root
)
)
;
var
change2
=
[
{
isDetails
:
true
uri
:
"
http
:
/
/
foo
.
com
/
"
title
:
"
moz
"
}
]
;
yield
task_populateDB
(
change2
)
;
do_check_true
(
isInResult
(
{
uri
:
"
http
:
/
/
foo
.
com
/
"
}
root
)
)
;
root
.
containerOpen
=
false
;
}
)
;
