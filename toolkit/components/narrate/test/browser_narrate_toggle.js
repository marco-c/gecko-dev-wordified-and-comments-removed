"
use
strict
"
;
registerCleanupFunction
(
teardown
)
;
add_task
(
async
function
testToggleNarrate
(
)
{
setup
(
)
;
await
spawnInNewReaderTab
(
TEST_ARTICLE
async
function
(
)
{
let
=
content
.
document
.
querySelector
.
bind
(
content
.
document
)
;
await
NarrateTestUtils
.
waitForNarrateToggle
(
content
)
;
let
eventUtils
=
NarrateTestUtils
.
getEventUtils
(
content
)
;
NarrateTestUtils
.
isStoppedState
(
content
ok
)
;
(
NarrateTestUtils
.
TOGGLE
)
.
focus
(
)
;
eventUtils
.
synthesizeKey
(
"
n
"
{
}
content
)
;
let
promiseEvent
=
ContentTaskUtils
.
waitForEvent
(
content
"
paragraphstart
"
)
;
let
speechinfo
=
(
await
promiseEvent
)
.
detail
;
let
paragraph
=
speechinfo
.
paragraph
;
NarrateTestUtils
.
isStartedState
(
content
ok
)
;
promiseEvent
=
ContentTaskUtils
.
waitForEvent
(
content
"
paragraphstart
"
)
;
(
NarrateTestUtils
.
TOGGLE
)
.
focus
(
)
;
eventUtils
.
synthesizeKey
(
"
KEY_ArrowRight
"
{
}
content
)
;
speechinfo
=
(
await
promiseEvent
)
.
detail
;
isnot
(
speechinfo
.
paragraph
paragraph
"
next
paragraph
is
being
spoken
"
)
;
NarrateTestUtils
.
isStartedState
(
content
ok
)
;
promiseEvent
=
ContentTaskUtils
.
waitForEvent
(
content
"
paragraphstart
"
)
;
(
NarrateTestUtils
.
TOGGLE
)
.
focus
(
)
;
eventUtils
.
synthesizeKey
(
"
KEY_ArrowLeft
"
{
repeat
:
2
}
content
)
;
speechinfo
=
(
await
promiseEvent
)
.
detail
;
is
(
speechinfo
.
paragraph
paragraph
"
first
paragraph
being
spoken
"
)
;
NarrateTestUtils
.
isStartedState
(
content
ok
)
;
(
NarrateTestUtils
.
TOGGLE
)
.
focus
(
)
;
eventUtils
.
synthesizeKey
(
"
n
"
{
}
content
)
;
await
ContentTaskUtils
.
waitForCondition
(
(
)
=
>
!
(
NarrateTestUtils
.
STOP
)
"
transitioned
to
stopped
state
"
)
;
NarrateTestUtils
.
isStoppedState
(
content
ok
)
;
}
)
;
}
)
;
