"
use
strict
"
;
const
{
AppConstants
}
=
ChromeUtils
.
import
(
"
resource
:
/
/
gre
/
modules
/
AppConstants
.
jsm
"
)
;
const
{
OS
}
=
ChromeUtils
.
import
(
"
resource
:
/
/
gre
/
modules
/
osfile
.
jsm
"
)
;
function
run_test
(
)
{
do_get_profile
(
)
;
run_next_test
(
)
;
}
add_task
(
{
skip_if
:
(
)
=
>
!
AppConstants
.
MOZ_NEW_XULSTORE
}
async
function
test_create_old_datastore
(
)
{
const
path
=
OS
.
Path
.
join
(
OS
.
Constants
.
Path
.
profileDir
"
xulstore
.
json
"
)
;
const
xulstoreJSON
=
'
{
doc
:
{
id
:
{
attr
:
"
value
"
}
}
'
;
await
OS
.
File
.
writeAtomic
(
path
xulstoreJSON
)
;
}
)
;
add_task
(
{
skip_if
:
(
)
=
>
!
AppConstants
.
MOZ_NEW_XULSTORE
}
async
function
test_get_value
(
)
{
const
{
XULStore
}
=
ChromeUtils
.
import
(
"
resource
:
/
/
gre
/
modules
/
XULStore
.
jsm
"
)
;
Assert
.
equal
(
await
XULStore
.
getValue
(
"
doc
"
"
id
"
"
attr
"
)
"
"
)
;
}
)
;
