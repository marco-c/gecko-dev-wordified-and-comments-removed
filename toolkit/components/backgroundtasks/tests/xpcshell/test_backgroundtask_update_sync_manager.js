"
use
strict
"
;
add_task
(
async
function
test_backgroundtask_update_sync_manager
(
)
{
let
exitCode
=
await
do_backgroundtask
(
"
update_sync_manager
"
{
extraArgs
:
[
Services
.
dirsvc
.
get
(
"
XREExeF
"
Ci
.
nsIFile
)
.
path
]
}
)
;
Assert
.
equal
(
80
exitCode
"
Another
instance
is
running
"
)
;
let
file
=
do_get_profile
(
)
;
file
.
append
(
"
customExePath
"
)
;
file
.
append
(
"
customExe
"
)
;
exitCode
=
await
do_backgroundtask
(
"
update_sync_manager
"
{
extraArgs
:
[
file
.
path
]
}
)
;
Assert
.
equal
(
81
exitCode
"
No
other
instance
is
running
"
)
;
let
upperCaseFile
=
Cc
[
"
mozilla
.
org
/
file
/
local
;
1
"
]
.
createInstance
(
Ci
.
nsIFile
)
;
upperCaseFile
.
initWithPath
(
Services
.
dirsvc
.
get
(
"
XREExeF
"
Ci
.
nsIFile
)
.
path
.
toUpperCase
(
)
)
;
if
(
upperCaseFile
.
exists
(
)
)
{
exitCode
=
await
do_backgroundtask
(
"
update_sync_manager
"
{
extraArgs
:
[
upperCaseFile
.
path
]
}
)
;
Assert
.
equal
(
80
exitCode
"
Another
instance
is
running
"
)
;
}
}
)
;
