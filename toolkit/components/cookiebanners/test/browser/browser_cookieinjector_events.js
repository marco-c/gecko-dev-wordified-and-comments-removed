"
use
strict
"
;
const
{
SiteDataTestUtils
}
=
ChromeUtils
.
import
(
"
resource
:
/
/
testing
-
common
/
SiteDataTestUtils
.
jsm
"
)
;
add_setup
(
cookieInjectorTestSetup
)
;
add_task
(
async
function
test_events
(
)
{
let
tab
;
let
triggerFn
=
async
(
)
=
>
{
tab
=
await
BrowserTestUtils
.
openNewForegroundTab
(
gBrowser
TEST_ORIGIN_A
)
;
}
;
await
runEventTest
(
{
mode
:
Ci
.
nsICookieBannerService
.
MODE_REJECT
initFn
:
insertTestCookieRules
triggerFn
testURL
:
{
TEST_ORIGIN_A
}
/
}
)
;
BrowserTestUtils
.
removeTab
(
tab
)
;
ok
(
SiteDataTestUtils
.
hasCookies
(
TEST_ORIGIN_A
[
{
key
:
cookieConsent_
{
TEST_DOMAIN_A
}
_1
value
:
"
optOut1
"
}
{
key
:
cookieConsent_
{
TEST_DOMAIN_A
}
_2
value
:
"
optOut2
"
}
]
)
"
Should
set
opt
-
out
cookies
for
ORIGIN_A
"
)
;
ok
(
!
SiteDataTestUtils
.
hasCookies
(
TEST_ORIGIN_B
)
"
Should
not
set
any
cookies
for
ORIGIN_B
"
)
;
ok
(
!
SiteDataTestUtils
.
hasCookies
(
TEST_ORIGIN_C
)
"
Should
not
set
any
cookies
for
ORIGIN_C
"
)
;
await
SiteDataTestUtils
.
clear
(
)
;
}
)
;
