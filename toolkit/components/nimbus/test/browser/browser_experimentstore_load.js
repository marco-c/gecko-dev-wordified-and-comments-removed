"
use
strict
"
;
const
{
ExperimentStore
}
=
ChromeUtils
.
import
(
"
resource
:
/
/
nimbus
/
lib
/
ExperimentStore
.
jsm
"
)
;
ChromeUtils
.
defineModuleGetter
(
this
"
JSONFile
"
"
resource
:
/
/
gre
/
modules
/
JSONFile
.
jsm
"
)
;
function
getPath
(
)
{
const
profileDir
=
Services
.
dirsvc
.
get
(
"
ProfD
"
Ci
.
nsIFile
)
.
path
;
return
PathUtils
.
join
(
profileDir
"
ExperimentStoreData
.
json
"
)
;
}
add_task
(
async
function
test_loadFromFile
(
)
{
const
previousSession
=
new
JSONFile
(
{
path
:
getPath
(
)
}
)
;
await
previousSession
.
load
(
)
;
previousSession
.
data
.
test
=
true
;
previousSession
.
saveSoon
(
)
;
await
previousSession
.
finalize
(
)
;
const
store
=
new
ExperimentStore
(
)
;
await
store
.
init
(
)
;
Assert
.
ok
(
store
.
get
(
"
test
"
)
"
This
should
pass
if
the
correct
store
path
loaded
successfully
"
)
;
}
)
;
