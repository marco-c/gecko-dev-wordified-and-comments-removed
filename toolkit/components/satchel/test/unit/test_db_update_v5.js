add_task
(
async
function
(
)
{
let
destPath
=
await
copyToProfile
(
"
formhistory_v3
.
sqlite
"
"
formhistory
.
sqlite
"
)
;
Assert
.
equal
(
3
await
getDBSchemaVersion
(
destPath
)
)
;
await
FormHistory
.
count
(
{
}
)
;
Assert
.
equal
(
CURRENT_SCHEMA
await
getDBSchemaVersion
(
destPath
)
)
;
let
db
=
await
Sqlite
.
openConnection
(
{
path
:
destPath
}
)
;
try
{
Assert
.
ok
(
db
.
tableExists
(
"
moz_sources
"
)
)
;
Assert
.
ok
(
db
.
tableExists
(
"
moz_sources_to_history
"
)
)
;
}
finally
{
await
db
.
close
(
)
;
}
let
num
=
await
promiseCountEntries
(
"
name
-
A
"
"
value
-
A
"
)
;
Assert
.
ok
(
num
>
0
)
;
}
)
;
