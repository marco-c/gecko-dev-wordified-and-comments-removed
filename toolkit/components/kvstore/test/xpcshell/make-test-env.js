"
use
strict
"
;
const
{
KeyValueService
}
=
ChromeUtils
.
import
(
"
resource
:
/
/
gre
/
modules
/
kvstore
.
jsm
"
)
;
const
{
OS
}
=
ChromeUtils
.
import
(
"
resource
:
/
/
gre
/
modules
/
osfile
.
jsm
"
)
;
const
{
Services
}
=
ChromeUtils
.
import
(
"
resource
:
/
/
gre
/
modules
/
Services
.
jsm
"
)
;
(
async
function
(
)
{
const
currentDir
=
await
OS
.
File
.
getCurrentDirectory
(
)
;
const
testEnvDir
=
Services
.
appinfo
.
is64Bit
?
"
test
-
env
-
64
"
:
"
test
-
env
-
32
"
;
const
testEnvPath
=
OS
.
Path
.
join
(
currentDir
testEnvDir
)
;
await
OS
.
File
.
makeDir
(
testEnvPath
{
from
:
currentDir
}
)
;
const
database
=
await
KeyValueService
.
getOrCreate
(
testEnvPath
"
db
"
)
;
await
database
.
put
(
"
int
-
key
"
1234
)
;
await
database
.
put
(
"
double
-
key
"
56
.
78
)
;
await
database
.
put
(
"
string
-
key
"
"
H
llo
w
rld
!
"
)
;
await
database
.
put
(
"
bool
-
key
"
true
)
;
scriptDone
=
true
;
}
)
(
)
;
let
scriptDone
=
false
;
const
mainThread
=
Services
.
tm
.
currentThread
;
while
(
!
scriptDone
)
{
mainThread
.
processNextEvent
(
true
)
;
}
while
(
mainThread
.
hasPendingEvents
(
)
)
{
mainThread
.
processNextEvent
(
true
)
;
}
