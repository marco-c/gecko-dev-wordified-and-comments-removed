#
include
"
nsThreadUtils
.
h
"
#
include
"
mozilla
/
PerformanceUtils
.
h
"
#
include
"
mozilla
/
dom
/
DocGroup
.
h
"
#
include
"
mozilla
/
dom
/
TabChild
.
h
"
#
include
"
mozilla
/
dom
/
WorkerDebugger
.
h
"
#
include
"
mozilla
/
dom
/
WorkerDebuggerManager
.
h
"
using
namespace
mozilla
;
using
namespace
mozilla
:
:
dom
;
namespace
mozilla
{
void
CollectPerformanceInfo
(
nsTArray
<
PerformanceInfo
>
&
aMetrics
)
{
LinkedList
<
TabGroup
>
*
tabGroups
=
TabGroup
:
:
GetTabGroupList
(
)
;
if
(
tabGroups
)
{
for
(
TabGroup
*
tabGroup
=
tabGroups
-
>
getFirst
(
)
;
tabGroup
;
tabGroup
=
static_cast
<
LinkedListElement
<
TabGroup
>
*
>
(
tabGroup
)
-
>
getNext
(
)
)
{
for
(
auto
iter
=
tabGroup
-
>
Iter
(
)
;
!
iter
.
Done
(
)
;
iter
.
Next
(
)
)
{
DocGroup
*
docGroup
=
iter
.
Get
(
)
-
>
mDocGroup
;
aMetrics
.
AppendElement
(
docGroup
-
>
ReportPerformanceInfo
(
)
)
;
}
}
}
RefPtr
<
mozilla
:
:
dom
:
:
WorkerDebuggerManager
>
wdm
=
WorkerDebuggerManager
:
:
GetOrCreate
(
)
;
if
(
NS_WARN_IF
(
!
wdm
)
)
{
return
;
}
for
(
uint32_t
i
=
0
;
i
<
wdm
-
>
GetDebuggersLength
(
)
;
i
+
+
)
{
WorkerDebugger
*
debugger
=
wdm
-
>
GetDebuggerAt
(
i
)
;
aMetrics
.
AppendElement
(
debugger
-
>
ReportPerformanceInfo
(
)
)
;
}
}
}
