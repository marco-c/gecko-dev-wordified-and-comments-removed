"
use
strict
"
;
add_task
(
async
function
setup
(
)
{
useHttpServer
(
)
;
await
AddonTestUtils
.
promiseStartupManager
(
)
;
}
)
;
function
promiseDefaultNotification
(
)
{
return
SearchTestUtils
.
promiseSearchNotification
(
SearchUtils
.
MODIFIED_TYPE
.
DEFAULT
SearchUtils
.
TOPIC_ENGINE_MODIFIED
)
;
}
add_task
(
async
function
test_defaultEngine
(
)
{
let
search
=
Services
.
search
;
await
search
.
init
(
)
;
let
originalDefault
=
search
.
defaultEngine
;
let
[
engine1
engine2
]
=
await
addTestEngines
(
[
{
name
:
"
Test
search
engine
"
xmlFileName
:
"
engine
.
xml
"
}
{
name
:
"
A
second
test
engine
"
xmlFileName
:
"
engine2
.
xml
"
}
]
)
;
let
promise
=
promiseDefaultNotification
(
)
;
search
.
defaultEngine
=
engine1
;
Assert
.
equal
(
await
promise
engine1
)
;
Assert
.
equal
(
search
.
defaultEngine
engine1
)
;
promise
=
promiseDefaultNotification
(
)
;
search
.
defaultEngine
=
engine2
;
Assert
.
equal
(
await
promise
engine2
)
;
Assert
.
equal
(
search
.
defaultEngine
engine2
)
;
promise
=
promiseDefaultNotification
(
)
;
search
.
defaultEngine
=
engine1
;
Assert
.
equal
(
await
promise
engine1
)
;
Assert
.
equal
(
search
.
defaultEngine
engine1
)
;
engine1
.
hidden
=
true
;
Assert
.
equal
(
search
.
defaultEngine
originalDefault
)
;
await
search
.
moveEngine
(
engine2
0
)
;
originalDefault
.
hidden
=
true
;
Assert
.
equal
(
search
.
defaultEngine
engine2
)
;
promise
=
promiseDefaultNotification
(
)
;
search
.
defaultEngine
=
engine1
;
Assert
.
equal
(
await
promise
engine1
)
;
Assert
.
equal
(
search
.
defaultEngine
engine2
)
;
}
)
;
