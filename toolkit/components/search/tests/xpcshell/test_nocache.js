function
run_test
(
)
{
do_load_manifest
(
"
data
/
chrome
.
manifest
"
)
;
useHttpServer
(
)
;
run_next_test
(
)
;
}
add_task
(
async
function
test_nocache
(
)
{
let
search
=
Services
.
search
;
let
afterCachePromise
=
promiseAfterCache
(
)
;
await
search
.
init
(
)
;
await
afterCachePromise
;
let
cacheFile
=
gProfD
.
clone
(
)
;
cacheFile
.
append
(
CACHE_FILENAME
)
;
Assert
.
ok
(
cacheFile
.
exists
(
)
)
;
await
addTestEngines
(
[
{
name
:
"
Test
search
engine
"
xmlFileName
:
"
engine
.
xml
"
}
]
)
;
info
(
"
Engine
has
been
added
let
'
s
wait
for
the
cache
to
be
built
"
)
;
await
promiseAfterCache
(
)
;
info
(
"
Searching
test
engine
in
cache
"
)
;
let
cache
=
await
promiseCacheData
(
)
;
let
found
=
false
;
for
(
let
engine
of
cache
.
engines
)
{
if
(
engine
.
_shortName
=
=
"
test
-
search
-
engine
"
)
{
found
=
true
;
break
;
}
}
Assert
.
ok
(
found
)
;
}
)
;
