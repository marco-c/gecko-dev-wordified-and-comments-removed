"
use
strict
"
;
var
{
getAppInfo
}
=
ChromeUtils
.
import
(
"
resource
:
/
/
testing
-
common
/
AppInfo
.
jsm
"
)
;
var
cacheTemplate
appPluginsPath
profPlugins
;
add_task
(
async
function
setup
(
)
{
await
AddonTestUtils
.
promiseStartupManager
(
)
;
await
setupRemoteSettings
(
)
;
cacheTemplate
=
await
readJSONFile
(
do_get_file
(
"
data
/
search_ignorelist
.
json
"
)
)
;
cacheTemplate
.
buildID
=
getAppInfo
(
)
.
platformBuildID
;
await
promiseSaveCacheData
(
cacheTemplate
)
;
}
)
;
add_task
(
async
function
test_cache_rest
(
)
{
info
(
"
init
search
service
"
)
;
let
updatePromise
=
SearchTestUtils
.
promiseSearchNotification
(
"
settings
-
update
-
complete
"
)
;
let
result
=
await
Services
.
search
.
init
(
)
;
Assert
.
ok
(
Components
.
isSuccessCode
(
result
)
"
Search
service
should
be
successfully
initialized
"
)
;
await
updatePromise
;
const
engines
=
await
Services
.
search
.
getEngines
(
)
;
Assert
.
greater
(
engines
.
length
1
"
Should
have
more
than
one
engine
in
the
list
"
)
;
removeCacheFile
(
)
;
}
)
;
