"
use
strict
"
;
var
{
getAppInfo
}
=
ChromeUtils
.
importESModule
(
"
resource
:
/
/
testing
-
common
/
AppInfo
.
sys
.
mjs
"
)
;
var
settingsTemplate
;
add_setup
(
async
function
(
)
{
await
AddonTestUtils
.
promiseStartupManager
(
)
;
await
setupRemoteSettings
(
)
;
settingsTemplate
=
await
readJSONFile
(
do_get_file
(
"
data
/
search_ignorelist
.
json
"
)
)
;
settingsTemplate
.
buildID
=
getAppInfo
(
)
.
platformBuildID
;
await
promiseSaveSettingsData
(
settingsTemplate
)
;
}
)
;
add_task
(
async
function
test_settings_rest
(
)
{
info
(
"
init
search
service
"
)
;
let
updatePromise
=
SearchTestUtils
.
promiseSearchNotification
(
"
settings
-
update
-
complete
"
)
;
let
result
=
await
Services
.
search
.
init
(
)
;
Assert
.
ok
(
Components
.
isSuccessCode
(
result
)
"
Search
service
should
be
successfully
initialized
"
)
;
await
updatePromise
;
const
engines
=
await
Services
.
search
.
getEngines
(
)
;
Assert
.
greater
(
engines
.
length
1
"
Should
have
more
than
one
engine
in
the
list
"
)
;
removeSettingsFile
(
)
;
}
)
;
