add_setup
(
async
function
(
)
{
useHttpServer
(
)
;
}
)
;
add_task
(
async
function
test_nosettings
(
)
{
let
search
=
Services
.
search
;
let
afterSettingsPromise
=
promiseAfterSettings
(
)
;
await
search
.
init
(
)
;
await
afterSettingsPromise
;
let
settingsFile
=
do_get_profile
(
)
.
clone
(
)
;
settingsFile
.
append
(
SETTINGS_FILENAME
)
;
Assert
.
ok
(
settingsFile
.
exists
(
)
)
;
await
SearchTestUtils
.
installOpenSearchEngine
(
{
url
:
{
gHttpURL
}
/
opensearch
/
generic1
.
xml
}
)
;
info
(
"
Engine
has
been
added
let
'
s
wait
for
the
settings
to
be
built
"
)
;
await
promiseAfterSettings
(
)
;
info
(
"
Searching
test
engine
in
settings
"
)
;
let
settings
=
await
promiseSettingsData
(
)
;
let
found
=
false
;
for
(
let
engine
of
settings
.
engines
)
{
if
(
engine
.
_name
=
=
"
Test
search
engine
"
)
{
found
=
true
;
break
;
}
}
Assert
.
ok
(
found
)
;
}
)
;
