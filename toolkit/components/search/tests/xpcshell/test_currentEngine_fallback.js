add_task
(
async
function
test_fallbacks
(
)
{
Assert
.
ok
(
(
await
Services
.
search
.
getVisibleEngines
(
)
)
.
length
>
1
)
;
Assert
.
ok
(
Services
.
search
.
isInitialized
)
;
let
defaultEngine
=
await
Services
.
search
.
getDefault
(
)
;
await
Services
.
search
.
removeEngine
(
defaultEngine
)
;
Assert
.
notEqual
(
(
await
Services
.
search
.
getDefault
(
)
)
.
name
defaultEngine
.
name
)
;
Assert
.
ok
(
defaultEngine
.
hidden
)
;
for
(
let
engine
of
await
Services
.
search
.
getVisibleEngines
(
)
)
{
await
Services
.
search
.
removeEngine
(
engine
)
;
}
Assert
.
strictEqual
(
(
await
Services
.
search
.
getVisibleEngines
(
)
)
.
length
0
)
;
Assert
.
equal
(
(
await
Services
.
search
.
getDefault
(
)
)
.
name
defaultEngine
.
name
)
;
Assert
.
ok
(
!
defaultEngine
.
hidden
)
;
Assert
.
equal
(
(
await
Services
.
search
.
getVisibleEngines
(
)
)
.
length
1
)
;
}
)
;
