function
run_test
(
)
{
let
url
=
"
http
:
/
/
localhost
:
0
"
;
Services
.
prefs
.
setCharPref
(
"
browser
.
search
.
geoip
.
url
"
url
)
;
Services
.
search
.
init
(
(
)
=
>
{
try
{
Services
.
prefs
.
getCharPref
(
"
browser
.
search
.
countryCode
"
)
;
ok
(
false
"
not
expecting
countryCode
to
be
set
"
)
;
}
catch
(
ex
)
{
}
checkCountryResultTelemetry
(
TELEMETRY_RESULT_ENUM
.
ERROR
)
;
for
(
let
hid
of
[
"
SEARCH_SERVICE_COUNTRY_TIMEOUT
"
"
SEARCH_SERVICE_COUNTRY_FETCH_CAUSED_SYNC_INIT
"
]
)
{
let
histogram
=
Services
.
telemetry
.
getHistogramById
(
hid
)
;
let
snapshot
=
histogram
.
snapshot
(
)
;
deepEqual
(
snapshot
.
counts
[
1
0
0
]
)
;
}
do_test_finished
(
)
;
run_next_test
(
)
;
}
)
;
do_test_pending
(
)
;
}
