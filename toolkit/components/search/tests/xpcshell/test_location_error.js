add_task
(
async
function
setup
(
)
{
await
AddonTestUtils
.
promiseStartupManager
(
)
;
Services
.
prefs
.
setBoolPref
(
"
browser
.
search
.
geoSpecificDefaults
"
true
)
;
}
)
;
add_task
(
async
function
test_location_error
(
)
{
let
url
=
"
http
:
/
/
localhost
:
0
"
;
Services
.
prefs
.
setCharPref
(
"
geo
.
provider
-
country
.
network
.
url
"
url
)
;
await
Services
.
search
.
init
(
)
;
try
{
Services
.
prefs
.
getCharPref
(
"
browser
.
search
.
region
"
)
;
ok
(
false
"
not
expecting
region
to
be
set
"
)
;
}
catch
(
ex
)
{
}
checkCountryResultTelemetry
(
TELEMETRY_RESULT_ENUM
.
ERROR
)
;
}
)
;
