function
run_test
(
)
{
installTestEngine
(
)
;
do_get_file
(
"
data
/
metadata
.
json
"
)
.
copyTo
(
gProfD
"
search
-
metadata
.
json
"
)
;
run_next_test
(
)
;
}
add_task
(
async
function
test_sync_metadata_migration
(
)
{
do_check_false
(
Services
.
search
.
isInitialized
)
;
Services
.
search
.
getEngines
(
)
;
do_check_true
(
Services
.
search
.
isInitialized
)
;
await
promiseAfterCache
(
)
;
let
metadata
=
await
promiseEngineMetadata
(
)
;
do_check_eq
(
metadata
.
engine
.
order
1
)
;
do_check_eq
(
metadata
.
engine
.
alias
"
foo
"
)
;
metadata
=
await
promiseGlobalMetadata
(
)
;
do_check_eq
(
metadata
.
searchDefaultExpir
1471013469846
)
;
}
)
;
