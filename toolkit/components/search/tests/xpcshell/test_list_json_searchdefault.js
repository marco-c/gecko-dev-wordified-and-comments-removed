"
use
strict
"
;
function
run_test
(
)
{
Assert
.
ok
(
!
Services
.
search
.
isInitialized
"
search
isn
'
t
initialized
yet
"
)
;
run_next_test
(
)
;
}
add_task
(
async
function
test_searchDefaultEngineUS
(
)
{
Services
.
prefs
.
setCharPref
(
"
browser
.
search
.
region
"
"
US
"
)
;
await
asyncInit
(
)
;
Assert
.
ok
(
Services
.
search
.
isInitialized
"
search
initialized
"
)
;
Assert
.
equal
(
Services
.
search
.
currentEngine
.
name
getDefaultEngineName
(
true
)
"
expected
US
default
search
engine
"
)
;
Services
.
prefs
.
clearUserPref
(
"
browser
.
search
.
region
"
)
;
}
)
;
add_task
(
async
function
test_defaultEngineNamePref
(
)
{
let
defaultEngineName
=
getDefaultEngineName
(
)
;
Services
.
prefs
.
setCharPref
(
"
distribution
.
id
"
"
partner
-
test
"
)
;
Services
.
prefs
.
setCharPref
(
kDefaultenginenamePref
"
Bing
"
)
;
await
asyncReInit
(
)
;
Assert
.
equal
(
Services
.
search
.
currentEngine
.
name
defaultEngineName
"
expected
default
search
engine
after
pref
set
"
)
;
Services
.
prefs
.
clearUserPref
(
kDefaultenginenamePref
)
;
Services
.
prefs
.
clearUserPref
(
"
distribution
.
id
"
)
;
}
)
;
add_task
(
async
function
test_defaultEngineNameUserPrefUS
(
)
{
let
defaultEngineName
=
getDefaultEngineName
(
true
)
;
Services
.
prefs
.
setCharPref
(
"
distribution
.
id
"
"
partner
-
test
"
)
;
Services
.
prefs
.
setCharPref
(
"
browser
.
search
.
region
"
"
US
"
)
;
Services
.
prefs
.
setCharPref
(
kDefaultenginenamePref
"
Bing
"
)
;
await
asyncReInit
(
)
;
Assert
.
equal
(
Services
.
search
.
currentEngine
.
name
defaultEngineName
"
expected
US
default
search
engine
after
pref
set
"
)
;
Services
.
prefs
.
clearUserPref
(
kDefaultenginenamePref
)
;
Services
.
prefs
.
clearUserPref
(
"
browser
.
search
.
region
"
)
;
Services
.
prefs
.
clearUserPref
(
"
distribution
.
id
"
)
;
}
)
;
add_task
(
async
function
test_defaultEngineNameDefaultPrefUS
(
)
{
Services
.
prefs
.
setCharPref
(
"
distribution
.
id
"
"
partner
-
test
"
)
;
Services
.
prefs
.
setCharPref
(
"
browser
.
search
.
region
"
"
US
"
)
;
let
defaultBranch
=
Services
.
prefs
.
getDefaultBranch
(
null
)
;
defaultBranch
.
setCharPref
(
kDefaultenginenamePref
"
data
:
text
/
plain
browser
.
search
.
defaultenginename
=
Bing
"
)
;
await
asyncReInit
(
)
;
Assert
.
equal
(
Services
.
search
.
currentEngine
.
name
"
Bing
"
"
expected
new
default
search
engine
after
pref
set
"
)
;
Services
.
prefs
.
clearUserPref
(
"
browser
.
search
.
region
"
)
;
Services
.
prefs
.
clearUserPref
(
"
distribution
.
id
"
)
;
}
)
;
