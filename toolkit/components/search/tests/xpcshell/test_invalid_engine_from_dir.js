add_task
(
async
function
setup
(
)
{
await
AddonTestUtils
.
promiseStartupManager
(
)
;
}
)
;
add_task
(
async
function
test_invalid_engine_from_dir
(
)
{
Assert
.
ok
(
!
Services
.
search
.
isInitialized
)
;
let
engineFile
=
do_get_profile
(
)
.
clone
(
)
;
engineFile
.
append
(
"
searchplugins
"
)
;
engineFile
.
append
(
"
test
-
search
-
engine
.
xml
"
)
;
engineFile
.
parent
.
create
(
Ci
.
nsIFile
.
DIRECTORY_TYPE
FileUtils
.
PERMS_DIRECTORY
)
;
let
engineTemplateFile
=
do_get_file
(
"
data
/
invalid
-
engine
.
xml
"
)
;
engineTemplateFile
.
copyTo
(
engineFile
.
parent
"
test
-
search
-
engine
.
xml
"
)
;
await
Services
.
search
.
init
(
)
;
}
)
;
