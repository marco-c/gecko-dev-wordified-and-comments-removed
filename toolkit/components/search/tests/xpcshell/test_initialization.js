"
use
strict
"
;
const
CONFIG
=
[
{
webExtension
:
{
id
:
"
engine
search
.
mozilla
.
org
"
}
orderHint
:
30
appliesTo
:
[
{
included
:
{
everywhere
:
true
}
default
:
"
yes
"
}
]
}
]
;
add_task
(
async
function
test_initialization_delayed_addon_manager
(
)
{
let
stub
=
await
SearchTestUtils
.
useTestEngines
(
"
data
"
null
CONFIG
)
;
stub
.
callsFake
(
(
)
=
>
{
Services
.
tm
.
dispatchToMainThread
(
(
)
=
>
{
AddonTestUtils
.
promiseStartupManager
(
)
;
}
)
;
return
CONFIG
;
}
)
;
await
Services
.
search
.
init
(
)
;
Assert
.
equal
(
Services
.
search
.
defaultEngine
.
name
"
Test
search
engine
"
"
Test
engine
shouldn
'
t
be
the
default
anymore
"
)
;
}
)
;
