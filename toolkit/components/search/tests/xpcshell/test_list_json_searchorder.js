"
use
strict
"
;
add_task
(
async
function
setup
(
)
{
await
AddonTestUtils
.
promiseStartupManager
(
)
;
useTestEngineConfig
(
)
;
}
)
;
async
function
checkOrder
(
expectedOrder
)
{
await
asyncReInit
(
)
;
Assert
.
ok
(
Services
.
search
.
isInitialized
"
search
initialized
"
)
;
const
sortedEngines
=
await
Services
.
search
.
getEngines
(
)
;
Assert
.
deepEqual
(
sortedEngines
.
map
(
s
=
>
s
.
name
)
expectedOrder
"
Should
have
the
expected
engine
order
"
)
;
}
add_task
(
async
function
test_searchOrderJSON_no_separate_private
(
)
{
Services
.
prefs
.
setBoolPref
(
SearchUtils
.
BROWSER_SEARCH_PREF
+
"
separatePrivateDefault
"
false
)
;
if
(
Services
.
prefs
.
getBoolPref
(
SearchUtils
.
BROWSER_SEARCH_PREF
+
"
modernConfig
"
false
)
)
{
await
checkOrder
(
[
"
Test
search
engine
"
"
engine
-
pref
"
"
engine
-
resourceicon
"
"
engine
-
chromeicon
"
"
engine
-
rel
-
searchform
-
purpose
"
"
Test
search
engine
(
Reordered
)
"
]
)
;
}
else
{
await
checkOrder
(
[
"
Test
search
engine
"
"
engine
-
resourceicon
"
"
engine
-
chromeicon
"
"
engine
-
pref
"
"
engine
-
rel
-
searchform
-
purpose
"
"
Test
search
engine
(
Reordered
)
"
]
)
;
}
}
)
;
add_task
(
async
function
test_searchOrderJSON_separate_private
(
)
{
Services
.
prefs
.
setBoolPref
(
SearchUtils
.
BROWSER_SEARCH_PREF
+
"
separatePrivateDefault
"
true
)
;
await
checkOrder
(
[
"
Test
search
engine
"
"
engine
-
pref
"
"
engine
-
resourceicon
"
"
engine
-
chromeicon
"
"
engine
-
rel
-
searchform
-
purpose
"
"
Test
search
engine
(
Reordered
)
"
]
)
;
}
)
;
