"
use
strict
"
;
const
TOGGLE_STYLES_LEFT_EXPLAINER
=
{
rootID
:
"
pictureInPictureToggleExperiment
"
stages
:
{
hoverVideo
:
{
opacities
:
{
"
.
pip
-
small
"
:
0
.
0
"
.
pip
-
wrapper
"
:
0
.
8
"
.
pip
-
expanded
"
:
1
.
0
}
hidden
:
[
"
#
pictureInPictureToggleButton
"
"
.
pip
-
icon
-
label
>
.
pip
-
icon
"
]
}
hoverToggle
:
{
opacities
:
{
"
.
pip
-
small
"
:
0
.
0
"
.
pip
-
wrapper
"
:
1
.
0
"
.
pip
-
expanded
"
:
1
.
0
}
hidden
:
[
"
#
pictureInPictureToggleButton
"
"
.
pip
-
icon
-
label
>
.
pip
-
icon
"
]
}
}
}
;
const
TOGGLE_STYLES_RIGHT_EXPLAINER
=
{
rootID
:
"
pictureInPictureToggleExperiment
"
stages
:
{
hoverVideo
:
{
opacities
:
{
"
.
pip
-
small
"
:
0
.
0
"
.
pip
-
wrapper
"
:
0
.
8
"
.
pip
-
expanded
"
:
1
.
0
}
hidden
:
[
"
#
pictureInPictureToggleButton
"
"
.
pip
-
wrapper
>
.
pip
-
icon
"
]
}
hoverToggle
:
{
opacities
:
{
"
.
pip
-
small
"
:
0
.
0
"
.
pip
-
wrapper
"
:
1
.
0
"
.
pip
-
expanded
"
:
1
.
0
}
hidden
:
[
"
#
pictureInPictureToggleButton
"
"
.
pip
-
wrapper
>
.
pip
-
icon
"
]
}
}
}
;
const
TOGGLE_STYLES_LEFT_SMALL
=
{
rootID
:
"
pictureInPictureToggleExperiment
"
stages
:
{
hoverVideo
:
{
opacities
:
{
"
.
pip
-
wrapper
"
:
0
.
8
}
hidden
:
[
"
#
pictureInPictureToggleButton
"
"
.
pip
-
expanded
"
]
}
hoverToggle
:
{
opacities
:
{
"
.
pip
-
wrapper
"
:
1
.
0
}
hidden
:
[
"
#
pictureInPictureToggleButton
"
"
.
pip
-
expanded
"
]
}
}
}
;
const
TOGGLE_STYLES_RIGHT_SMALL
=
{
rootID
:
"
pictureInPictureToggleExperiment
"
stages
:
{
hoverVideo
:
{
opacities
:
{
"
.
pip
-
wrapper
"
:
0
.
8
}
hidden
:
[
"
#
pictureInPictureToggleButton
"
"
.
pip
-
expanded
"
]
}
hoverToggle
:
{
opacities
:
{
"
.
pip
-
wrapper
"
:
1
.
0
}
hidden
:
[
"
#
pictureInPictureToggleButton
"
"
.
pip
-
expanded
"
]
}
}
}
;
add_task
(
async
(
)
=
>
{
await
SpecialPowers
.
pushPrefEnv
(
{
set
:
[
[
"
media
.
videocontrols
.
picture
-
in
-
picture
.
video
-
toggle
.
mode
"
2
]
[
"
media
.
videocontrols
.
picture
-
in
-
picture
.
video
-
toggle
.
position
"
"
left
"
]
[
HAS_USED_PREF
false
]
]
}
)
;
await
testToggle
(
TEST_PAGE
{
"
with
-
controls
"
:
{
canToggle
:
true
toggleStyles
:
TOGGLE_STYLES_LEFT_EXPLAINER
}
}
)
;
Assert
.
ok
(
Services
.
prefs
.
getBoolPref
(
HAS_USED_PREF
false
)
"
Entered
has
-
used
mode
.
"
)
;
Services
.
prefs
.
clearUserPref
(
HAS_USED_PREF
)
;
await
testToggle
(
TEST_PAGE
{
"
no
-
controls
"
:
{
canToggle
:
true
toggleStyles
:
TOGGLE_STYLES_LEFT_EXPLAINER
}
}
)
;
Assert
.
ok
(
Services
.
prefs
.
getBoolPref
(
HAS_USED_PREF
false
)
"
Entered
has
-
used
mode
.
"
)
;
Services
.
prefs
.
clearUserPref
(
HAS_USED_PREF
)
;
await
SpecialPowers
.
pushPrefEnv
(
{
set
:
[
[
"
media
.
videocontrols
.
picture
-
in
-
picture
.
video
-
toggle
.
position
"
"
right
"
]
]
}
)
;
await
testToggle
(
TEST_PAGE
{
"
with
-
controls
"
:
{
canToggle
:
true
toggleStyles
:
TOGGLE_STYLES_RIGHT_EXPLAINER
}
}
)
;
Assert
.
ok
(
Services
.
prefs
.
getBoolPref
(
HAS_USED_PREF
false
)
"
Entered
has
-
used
mode
.
"
)
;
Services
.
prefs
.
clearUserPref
(
HAS_USED_PREF
)
;
await
testToggle
(
TEST_PAGE
{
"
no
-
controls
"
:
{
canToggle
:
true
toggleStyles
:
TOGGLE_STYLES_RIGHT_EXPLAINER
}
}
)
;
Assert
.
ok
(
Services
.
prefs
.
getBoolPref
(
HAS_USED_PREF
false
)
"
Entered
has
-
used
mode
.
"
)
;
Services
.
prefs
.
clearUserPref
(
HAS_USED_PREF
)
;
}
)
;
add_task
(
async
(
)
=
>
{
await
SpecialPowers
.
pushPrefEnv
(
{
set
:
[
[
"
media
.
videocontrols
.
picture
-
in
-
picture
.
video
-
toggle
.
mode
"
2
]
[
"
media
.
videocontrols
.
picture
-
in
-
picture
.
video
-
toggle
.
position
"
"
left
"
]
[
HAS_USED_PREF
true
]
]
}
)
;
await
testToggle
(
TEST_PAGE
{
"
with
-
controls
"
:
{
canToggle
:
true
toggleStyles
:
TOGGLE_STYLES_LEFT_SMALL
}
"
no
-
controls
"
:
{
canToggle
:
true
toggleStyles
:
TOGGLE_STYLES_LEFT_SMALL
}
}
)
;
await
SpecialPowers
.
pushPrefEnv
(
{
set
:
[
[
"
media
.
videocontrols
.
picture
-
in
-
picture
.
video
-
toggle
.
position
"
"
right
"
]
]
}
)
;
await
testToggle
(
TEST_PAGE
{
"
with
-
controls
"
:
{
canToggle
:
true
toggleStyles
:
TOGGLE_STYLES_LEFT_SMALL
}
"
no
-
controls
"
:
{
canToggle
:
true
toggleStyles
:
TOGGLE_STYLES_LEFT_SMALL
}
}
)
;
}
)
;
