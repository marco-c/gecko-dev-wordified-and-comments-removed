"
use
strict
"
;
add_task
(
async
(
)
=
>
{
const
PAGE
=
TEST_ROOT
+
"
test
-
page
.
html
"
;
await
testToggle
(
PAGE
{
inserted
:
{
canToggle
:
true
}
}
async
browser
=
>
{
await
SpecialPowers
.
spawn
(
browser
[
]
async
(
)
=
>
{
let
doc
=
content
.
document
;
let
preExistingVideos
=
doc
.
querySelectorAll
(
"
video
"
)
;
for
(
let
video
of
preExistingVideos
)
{
video
.
remove
(
)
;
}
let
newVideo
=
doc
.
createElement
(
"
video
"
)
;
const
{
ContentTaskUtils
}
=
ChromeUtils
.
import
(
"
resource
:
/
/
testing
-
common
/
ContentTaskUtils
.
jsm
"
)
;
let
ready
=
ContentTaskUtils
.
waitForEvent
(
newVideo
"
canplay
"
)
;
newVideo
.
src
=
"
test
-
video
.
mp4
"
;
newVideo
.
id
=
"
inserted
"
;
await
ready
;
doc
.
body
.
appendChild
(
newVideo
)
;
}
)
;
}
)
;
}
)
;
