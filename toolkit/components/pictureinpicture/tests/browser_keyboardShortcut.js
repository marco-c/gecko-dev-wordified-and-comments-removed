"
use
strict
"
;
add_task
(
async
function
test_pip_keyboard_shortcut
(
)
{
await
BrowserTestUtils
.
withNewTab
(
{
url
:
TEST_PAGE
gBrowser
}
async
browser
=
>
{
await
ensureVideosReady
(
browser
)
;
const
VIDEO_ID
=
"
with
-
controls
"
;
let
domWindowOpened
=
BrowserTestUtils
.
domWindowOpened
(
null
)
;
let
videoReady
=
SpecialPowers
.
spawn
(
browser
[
VIDEO_ID
]
async
videoID
=
>
{
let
video
=
content
.
document
.
getElementById
(
videoID
)
;
await
ContentTaskUtils
.
waitForCondition
(
(
)
=
>
{
return
video
.
isCloningElementVisually
;
}
"
Video
is
being
cloned
visually
.
"
)
;
}
)
;
EventUtils
.
synthesizeKey
(
"
]
"
{
accelKey
:
true
shiftKey
:
true
}
)
;
let
pipWin
=
await
domWindowOpened
;
await
BrowserTestUtils
.
waitForEvent
(
pipWin
"
load
"
)
;
await
videoReady
;
ok
(
pipWin
"
Got
Picture
-
in
-
Picture
window
.
"
)
;
try
{
await
assertShowingMessage
(
browser
VIDEO_ID
true
)
;
}
finally
{
let
uaWidgetUpdate
=
BrowserTestUtils
.
waitForContentEvent
(
browser
"
UAWidgetSetupOrChange
"
true
)
;
await
BrowserTestUtils
.
closeWindow
(
pipWin
)
;
await
uaWidgetUpdate
;
}
}
)
;
}
)
;
