"
use
strict
"
;
add_setup
(
async
function
(
)
{
await
SpecialPowers
.
pushPrefEnv
(
{
set
:
[
[
"
test
.
wait300msAfterTabSwitch
"
true
]
]
}
)
;
}
)
;
add_task
(
async
(
)
=
>
{
await
BrowserTestUtils
.
withNewTab
(
{
url
:
TEST_PAGE
gBrowser
}
async
browser
=
>
{
const
MESSAGE
=
"
PictureInPicture
:
Request
"
;
let
sawMessage
=
false
;
let
listener
=
(
)
=
>
{
sawMessage
=
true
;
}
;
browser
.
messageManager
.
addMessageListener
(
MESSAGE
listener
)
;
await
SpecialPowers
.
spawn
(
browser
[
]
async
(
)
=
>
{
content
.
wrappedJSObject
.
fireEvents
(
)
;
}
)
;
browser
.
messageManager
.
removeMessageListener
(
MESSAGE
listener
)
;
ok
(
!
sawMessage
"
Got
PictureInPicture
:
Request
message
unexpectedly
.
"
)
;
}
)
;
}
)
;
