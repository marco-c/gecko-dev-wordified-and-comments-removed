"
use
strict
"
;
var
EXPORTED_SYMBOLS
=
[
"
WindowsInstallsInfo
"
]
;
ChromeUtils
.
defineModuleGetter
(
this
"
Services
"
"
resource
:
/
/
gre
/
modules
/
Services
.
jsm
"
)
;
var
WindowsInstallsInfo
=
{
getInstallPaths
(
limit
=
1024
exclude
=
new
Set
(
)
)
{
const
lcExclude
=
new
Set
(
)
;
exclude
.
forEach
(
p
=
>
lcExclude
.
add
(
p
.
toLowerCase
(
)
)
)
;
function
collectValues
(
rootKey
wowFlag
subKey
set
)
{
const
key
=
Cc
[
"
mozilla
.
org
/
windows
-
registry
-
key
;
1
"
]
.
createInstance
(
Ci
.
nsIWindowsRegKey
)
;
try
{
key
.
open
(
rootKey
subKey
key
.
ACCESS_READ
|
wowFlag
)
;
}
catch
(
_e
)
{
return
;
}
const
valueCount
=
key
.
valueCount
;
try
{
for
(
let
i
=
0
;
i
<
valueCount
;
+
+
i
)
{
const
path
=
key
.
getValueName
(
i
)
.
toLowerCase
(
)
;
if
(
!
lcExclude
.
has
(
path
)
)
{
set
.
add
(
path
)
;
}
if
(
set
.
size
>
=
limit
)
{
break
;
}
}
}
finally
{
key
.
close
(
)
;
}
}
const
subKeyName
=
Software
\
\
Mozilla
\
\
{
Services
.
appinfo
.
name
}
\
\
TaskBarIDs
;
const
paths
=
new
Set
(
)
;
for
(
const
wowFlag
of
[
Ci
.
nsIWindowsRegKey
.
WOW64_32
Ci
.
nsIWindowsRegKey
.
WOW64_64
]
)
{
collectValues
(
Ci
.
nsIWindowsRegKey
.
ROOT_KEY_LOCAL_MACHINE
wowFlag
subKeyName
paths
)
;
if
(
paths
.
size
>
=
limit
)
{
break
;
}
}
if
(
paths
.
size
<
limit
)
{
collectValues
(
Ci
.
nsIWindowsRegKey
.
ROOT_KEY_CURRENT_USER
0
subKeyName
paths
)
;
}
return
paths
;
}
}
;
