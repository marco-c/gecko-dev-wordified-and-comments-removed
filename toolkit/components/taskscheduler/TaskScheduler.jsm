"
use
strict
"
;
var
EXPORTED_SYMBOLS
=
[
"
TaskScheduler
"
]
;
const
{
XPCOMUtils
}
=
ChromeUtils
.
import
(
"
resource
:
/
/
gre
/
modules
/
XPCOMUtils
.
jsm
"
)
;
const
lazy
=
{
}
;
XPCOMUtils
.
defineLazyModuleGetter
(
lazy
"
WinImpl
"
"
resource
:
/
/
gre
/
modules
/
TaskSchedulerWinImpl
.
jsm
"
"
_TaskSchedulerWinImpl
"
)
;
XPCOMUtils
.
defineLazyModuleGetter
(
lazy
"
MacOSImpl
"
"
resource
:
/
/
gre
/
modules
/
TaskSchedulerMacOSImpl
.
jsm
"
"
_TaskSchedulerMacOSImpl
"
)
;
XPCOMUtils
.
defineLazyGetter
(
lazy
"
gImpl
"
(
)
=
>
{
if
(
AppConstants
.
platform
=
=
"
win
"
)
{
return
lazy
.
WinImpl
;
}
if
(
AppConstants
.
platform
=
=
"
macosx
"
)
{
return
lazy
.
MacOSImpl
;
}
return
{
registerTask
(
)
{
}
deleteTask
(
)
{
}
deleteAllTasks
(
)
{
}
}
;
}
)
;
const
{
AppConstants
}
=
ChromeUtils
.
import
(
"
resource
:
/
/
gre
/
modules
/
AppConstants
.
jsm
"
)
;
var
TaskScheduler
=
{
MIN_INTERVAL_SECONDS
:
1800
async
registerTask
(
id
command
intervalSeconds
options
)
{
if
(
typeof
id
!
=
=
"
string
"
)
{
throw
new
Error
(
"
id
is
not
a
string
"
)
;
}
if
(
!
Number
.
isInteger
(
intervalSeconds
)
)
{
throw
new
Error
(
"
Interval
is
not
an
integer
"
)
;
}
if
(
intervalSeconds
<
this
.
MIN_INTERVAL_SECONDS
)
{
throw
new
Error
(
"
Interval
is
too
short
"
)
;
}
return
lazy
.
gImpl
.
registerTask
(
id
command
intervalSeconds
options
)
;
}
async
deleteTask
(
id
)
{
return
lazy
.
gImpl
.
deleteTask
(
id
)
;
}
async
deleteAllTasks
(
)
{
return
lazy
.
gImpl
.
deleteAllTasks
(
)
;
}
async
taskExists
(
id
)
{
return
lazy
.
gImpl
.
taskExists
(
id
)
;
}
}
;
