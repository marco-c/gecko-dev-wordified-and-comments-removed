"
use
strict
"
;
var
{
ExtensionError
}
=
ExtensionUtils
;
this
.
scripting
=
class
extends
ExtensionAPI
{
getAPI
(
context
)
{
return
{
scripting
:
{
executeScript
:
async
details
=
>
{
if
(
(
details
.
files
!
=
=
null
&
&
details
.
func
!
=
=
null
)
|
|
(
!
details
.
files
&
&
!
details
.
func
)
)
{
throw
new
ExtensionError
(
"
Exactly
one
of
files
and
func
must
be
specified
.
"
)
;
}
let
{
func
args
.
.
.
parentDetails
}
=
details
;
if
(
details
.
files
)
{
if
(
details
.
args
)
{
throw
new
ExtensionError
(
"
'
args
'
may
not
be
used
with
file
injections
.
"
)
;
}
}
else
{
try
{
const
serializedArgs
=
args
?
JSON
.
stringify
(
args
)
.
slice
(
1
-
1
)
:
"
"
;
parentDetails
.
codeToExecute
=
(
{
func
.
toString
(
)
}
)
(
{
serializedArgs
}
)
;
;
}
catch
(
e
)
{
throw
new
ExtensionError
(
"
Unserializable
arguments
.
"
)
;
}
}
return
context
.
childManager
.
callParentAsyncFunction
(
"
scripting
.
executeScriptInternal
"
[
parentDetails
]
)
;
}
}
}
;
}
}
;
