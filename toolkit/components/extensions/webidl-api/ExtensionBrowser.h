#
ifndef
mozilla_extensions_ExtensionBrowser_h
#
define
mozilla_extensions_ExtensionBrowser_h
#
include
"
nsCOMPtr
.
h
"
#
include
"
nsISupports
.
h
"
#
include
"
nsTHashMap
.
h
"
#
include
"
nsWrapperCache
.
h
"
#
include
"
mozilla
/
WeakPtr
.
h
"
#
include
"
xpcpublic
.
h
"
class
nsIGlobalObject
;
class
nsIURI
;
namespace
mozilla
{
class
ErrorResult
;
namespace
extensions
{
class
ExtensionAlarms
;
class
ExtensionBrowserSettings
;
class
ExtensionDns
;
class
ExtensionMockAPI
;
class
ExtensionPort
;
class
ExtensionProxy
;
class
ExtensionRuntime
;
class
ExtensionScripting
;
class
ExtensionTest
;
bool
ExtensionAPIAllowed
(
JSContext
*
aCx
JSObject
*
aGlobal
)
;
void
CreateAndDispatchInitWorkerContextRunnable
(
)
;
already_AddRefed
<
Runnable
>
CreateWorkerLoadedRunnable
(
const
uint64_t
aServiceWorkerDescriptorId
const
nsCOMPtr
<
nsIURI
>
&
aWorkerBaseURI
)
;
already_AddRefed
<
Runnable
>
CreateWorkerDestroyedRunnable
(
const
uint64_t
aServiceWorkerDescriptorId
const
nsCOMPtr
<
nsIURI
>
&
aWorkerBaseURI
)
;
class
ExtensionEventWakeupMap
final
:
public
nsTHashMap
<
nsStringHashKey
uint64_t
>
{
static
void
ToMapKey
(
const
nsAString
&
aAPINamespace
const
nsAString
&
aAPIName
nsAString
&
aResultMapKey
)
;
public
:
nsresult
IncrementListeners
(
const
nsAString
&
aAPINamespace
const
nsAString
&
aAPIName
)
;
nsresult
DecrementListeners
(
const
nsAString
&
aAPINamespace
const
nsAString
&
aAPIName
)
;
bool
HasListener
(
const
nsAString
&
aAPINamespace
const
nsAString
&
aAPIName
)
;
}
;
class
ExtensionBrowser
final
:
public
nsISupports
public
nsWrapperCache
{
public
:
explicit
ExtensionBrowser
(
nsIGlobalObject
*
aGlobal
)
;
void
SetLastError
(
JS
:
:
Handle
<
JS
:
:
Value
>
aLastError
)
;
void
GetLastError
(
JS
:
:
MutableHandle
<
JS
:
:
Value
>
aRetVal
)
;
bool
ClearLastError
(
)
;
nsresult
TrackWakeupEventListener
(
JSContext
*
aCx
const
nsString
&
aAPINamespace
const
nsString
&
aAPIName
)
;
nsresult
UntrackWakeupEventListener
(
JSContext
*
aCx
const
nsString
&
aAPINamespace
const
nsString
&
aAPIName
)
;
bool
HasWakeupEventListener
(
const
nsString
&
aAPINamespace
const
nsString
&
aAPIName
)
;
already_AddRefed
<
ExtensionPort
>
GetPort
(
JS
:
:
Handle
<
JS
:
:
Value
>
aDescriptorValue
ErrorResult
&
aRv
)
;
void
ForgetReleasedPort
(
const
nsAString
&
aPortId
)
;
JSObject
*
WrapObject
(
JSContext
*
aCx
JS
:
:
Handle
<
JSObject
*
>
aGivenProto
)
override
;
nsIGlobalObject
*
GetParentObject
(
)
const
;
ExtensionAlarms
*
GetExtensionAlarms
(
)
;
ExtensionBrowserSettings
*
GetExtensionBrowserSettings
(
)
;
ExtensionDns
*
GetExtensionDns
(
)
;
ExtensionMockAPI
*
GetExtensionMockAPI
(
)
;
ExtensionProxy
*
GetExtensionProxy
(
)
;
ExtensionRuntime
*
GetExtensionRuntime
(
)
;
ExtensionScripting
*
GetExtensionScripting
(
)
;
ExtensionTest
*
GetExtensionTest
(
)
;
NS_DECL_CYCLE_COLLECTING_ISUPPORTS
NS_DECL_CYCLE_COLLECTION_SCRIPT_HOLDER_CLASS
(
ExtensionBrowser
)
private
:
~
ExtensionBrowser
(
)
=
default
;
nsCOMPtr
<
nsIGlobalObject
>
mGlobal
;
JS
:
:
Heap
<
JS
:
:
Value
>
mLastError
;
bool
mCheckedLastError
;
nsTHashMap
<
nsStringHashKey
WeakPtr
<
ExtensionPort
>
>
mPortsLookup
;
ExtensionEventWakeupMap
mExpectedEventWakeupMap
;
RefPtr
<
ExtensionAlarms
>
mExtensionAlarms
;
RefPtr
<
ExtensionBrowserSettings
>
mExtensionBrowserSettings
;
RefPtr
<
ExtensionDns
>
mExtensionDns
;
RefPtr
<
ExtensionMockAPI
>
mExtensionMockAPI
;
RefPtr
<
ExtensionProxy
>
mExtensionProxy
;
RefPtr
<
ExtensionRuntime
>
mExtensionRuntime
;
RefPtr
<
ExtensionScripting
>
mExtensionScripting
;
RefPtr
<
ExtensionTest
>
mExtensionTest
;
}
;
}
}
#
endif
