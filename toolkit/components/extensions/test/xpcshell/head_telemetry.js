"
use
strict
"
;
XPCOMUtils
.
defineLazyModuleGetter
(
this
"
ContentTaskUtils
"
"
resource
:
/
/
testing
-
common
/
ContentTaskUtils
.
jsm
"
)
;
const
IS_OOP
=
Services
.
prefs
.
getBoolPref
(
"
extensions
.
webextensions
.
remote
"
)
;
function
arraySum
(
arr
)
{
return
arr
.
reduce
(
(
a
b
)
=
>
a
+
b
0
)
;
}
function
clearHistograms
(
)
{
Services
.
telemetry
.
snapshotHistograms
(
Ci
.
nsITelemetry
.
DATASET_RELEASE_CHANNEL_OPTIN
true
true
)
;
}
function
getSnapshots
(
process
)
{
return
Services
.
telemetry
.
snapshotHistograms
(
Ci
.
nsITelemetry
.
DATASET_RELEASE_CHANNEL_OPTIN
true
false
)
[
process
]
;
}
function
promiseTelemetryRecorded
(
id
process
expectedCount
)
{
let
condition
=
(
)
=
>
{
let
snapshot
=
Services
.
telemetry
.
snapshotHistograms
(
Ci
.
nsITelemetry
.
DATASET_RELEASE_CHANNEL_OPTIN
true
false
)
[
process
]
[
id
]
;
return
snapshot
&
&
arraySum
(
snapshot
.
counts
)
>
=
expectedCount
;
}
;
return
ContentTaskUtils
.
waitForCondition
(
condition
)
;
}
