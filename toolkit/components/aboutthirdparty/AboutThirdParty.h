#
ifndef
__AboutThirdParty_h__
#
define
__AboutThirdParty_h__
#
include
"
mozilla
/
MozPromise
.
h
"
#
include
"
nsIAboutThirdParty
.
h
"
#
include
"
nsTHashMap
.
h
"
namespace
mozilla
{
enum
class
KnownModuleType
:
uint32_t
{
Ime
=
0
IconOverlay
ContextMenuHandler
CopyHookHandler
DragDropHandler
PropertySheetHandler
DataHandler
DropHandler
IconHandler
InfotipHandler
PropertyHandler
Last
}
;
using
BackgroundThreadPromise
=
MozPromise
<
bool
nsresult
false
>
;
class
AboutThirdParty
final
:
public
nsIAboutThirdParty
{
enum
class
WorkerState
:
uint32_t
{
Init
Running
Done
}
;
Atomic
<
WorkerState
SequentiallyConsistent
>
mWorkerState
;
RefPtr
<
BackgroundThreadPromise
:
:
Private
>
mPromise
;
nsTHashMap
<
nsStringCaseInsensitiveHashKey
uint32_t
>
mKnownModules
;
~
AboutThirdParty
(
)
=
default
;
void
BackgroundThread
(
)
;
void
AddKnownModule
(
const
nsString
&
aPath
KnownModuleType
aType
)
;
public
:
static
already_AddRefed
<
AboutThirdParty
>
GetSingleton
(
)
;
AboutThirdParty
(
)
;
NS_DECL_THREADSAFE_ISUPPORTS
NS_DECL_NSIABOUTTHIRDPARTY
RefPtr
<
BackgroundThreadPromise
>
CollectSystemInfoAsync
(
)
;
}
;
}
#
endif
