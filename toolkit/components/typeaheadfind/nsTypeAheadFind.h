#
include
"
nsComponentManagerUtils
.
h
"
#
include
"
nsCycleCollectionParticipant
.
h
"
#
include
"
nsISelectionController
.
h
"
#
include
"
nsIDocShell
.
h
"
#
include
"
nsIObserver
.
h
"
#
include
"
nsUnicharUtils
.
h
"
#
include
"
nsIFind
.
h
"
#
include
"
nsIWebBrowserFind
.
h
"
#
include
"
nsWeakReference
.
h
"
#
include
"
nsITypeAheadFind
.
h
"
#
include
"
nsISound
.
h
"
class
nsPIDOMWindowInner
;
class
nsPresContext
;
class
nsRange
;
namespace
mozilla
{
class
PresShell
;
namespace
dom
{
class
Element
;
class
Selection
;
}
}
#
define
TYPEAHEADFIND_NOTFOUND_WAV_URL
"
chrome
:
/
/
global
/
content
/
notfound
.
wav
"
class
nsTypeAheadFind
:
public
nsITypeAheadFind
public
nsIObserver
public
nsSupportsWeakReference
{
public
:
nsTypeAheadFind
(
)
;
NS_DECL_CYCLE_COLLECTING_ISUPPORTS
NS_DECL_NSITYPEAHEADFIND
NS_DECL_NSIOBSERVER
NS_DECL_CYCLE_COLLECTION_CLASS_AMBIGUOUS
(
nsTypeAheadFind
nsITypeAheadFind
)
protected
:
virtual
~
nsTypeAheadFind
(
)
;
nsresult
PrefsReset
(
)
;
void
SaveFind
(
)
;
void
PlayNotFoundSound
(
)
;
nsresult
GetWebBrowserFind
(
nsIDocShell
*
aDocShell
nsIWebBrowserFind
*
*
aWebBrowserFind
)
;
nsresult
FindInternal
(
uint32_t
aMode
const
nsAString
&
aSearchString
bool
aLinksOnly
bool
aDontIterateFrames
uint16_t
*
aResult
)
;
void
RangeStartsInsideLink
(
nsRange
*
aRange
bool
*
aIsInsideLink
bool
*
aIsStartingLink
)
;
void
GetSelection
(
mozilla
:
:
PresShell
*
aPresShell
nsISelectionController
*
*
aSelCon
mozilla
:
:
dom
:
:
Selection
*
*
aDomSel
)
;
bool
IsRangeVisible
(
nsRange
*
aRange
bool
aMustBeVisible
bool
aGetTopVisibleLeaf
bool
*
aUsesIndependentSelection
)
;
bool
IsRangeRendered
(
nsRange
*
aRange
)
;
MOZ_CAN_RUN_SCRIPT_BOUNDARY
nsresult
FindItNow
(
uint32_t
aMode
bool
aIsLinksOnly
bool
aIsFirstVisiblePreferred
bool
aDontIterateFrames
uint16_t
*
aResult
)
;
nsresult
GetSearchContainers
(
nsISupports
*
aContainer
nsISelectionController
*
aSelectionController
bool
aIsFirstVisiblePreferred
bool
aFindPrev
mozilla
:
:
PresShell
*
*
aPresShell
nsPresContext
*
*
aPresContext
)
;
already_AddRefed
<
mozilla
:
:
dom
:
:
Document
>
GetDocument
(
)
;
void
ReleaseStrongMemberVariables
(
)
;
nsString
mTypeAheadBuffer
;
nsCString
mNotFoundSoundURL
;
bool
mStartLinksOnlyPref
;
bool
mCaretBrowsingOn
;
bool
mDidAddObservers
;
nsCOMPtr
<
mozilla
:
:
dom
:
:
Element
>
mFoundLink
;
nsCOMPtr
<
mozilla
:
:
dom
:
:
Element
>
mFoundEditable
;
RefPtr
<
nsRange
>
mFoundRange
;
nsCOMPtr
<
nsPIDOMWindowInner
>
mCurrentWindow
;
uint32_t
mLastFindLength
;
nsCOMPtr
<
nsISound
>
mSoundInterface
;
bool
mIsSoundInitialized
;
RefPtr
<
nsRange
>
mStartFindRange
;
RefPtr
<
nsRange
>
mSearchRange
;
RefPtr
<
nsRange
>
mStartPointRange
;
RefPtr
<
nsRange
>
mEndPointRange
;
nsCOMPtr
<
nsIFind
>
mFind
;
bool
mCaseSensitive
;
bool
mEntireWord
;
bool
mMatchDiacritics
;
bool
EnsureFind
(
)
{
if
(
mFind
)
{
return
true
;
}
mFind
=
do_CreateInstance
(
"
mozilla
.
org
/
embedcomp
/
rangefind
;
1
"
)
;
if
(
!
mFind
)
{
return
false
;
}
mFind
-
>
SetCaseSensitive
(
mCaseSensitive
)
;
mFind
-
>
SetEntireWord
(
mEntireWord
)
;
mFind
-
>
SetMatchDiacritics
(
mMatchDiacritics
)
;
return
true
;
}
nsCOMPtr
<
nsIWebBrowserFind
>
mWebBrowserFind
;
nsWeakPtr
mDocShell
;
nsWeakPtr
mDocument
;
nsWeakPtr
mSelectionController
;
}
;
