"
use
strict
"
;
add_task
(
async
function
test_PIN_FIREFOX_TO_TASKBAR
(
)
{
const
sandbox
=
sinon
.
createSandbox
(
)
;
let
shell
=
{
checkPinCurrentAppToTaskbar
(
)
{
}
QueryInterface
:
(
)
=
>
shell
get
shellService
(
)
{
return
this
;
}
isCurrentAppPinnedToTaskbarAsync
:
sandbox
.
stub
(
)
pinCurrentAppToTaskbar
:
sandbox
.
stub
(
)
}
;
shell
=
new
Proxy
(
shell
{
get
(
target
prop
)
{
return
(
prop
in
target
?
target
:
ShellService
)
[
prop
]
;
}
}
)
;
const
test
=
(
)
=
>
SMATestUtils
.
executeAndValidateAction
(
{
type
:
"
PIN_FIREFOX_TO_TASKBAR
"
}
{
ownerGlobal
:
{
getShellService
:
(
)
=
>
shell
}
}
)
;
await
test
(
)
;
Assert
.
equal
(
shell
.
pinCurrentAppToTaskbar
.
callCount
1
"
pinCurrentAppToTaskbar
was
called
by
the
action
"
)
;
shell
.
isCurrentAppPinnedToTaskbarAsync
.
resolves
(
true
)
;
await
test
(
)
;
Assert
.
equal
(
shell
.
pinCurrentAppToTaskbar
.
callCount
1
"
pinCurrentAppToTaskbar
was
not
called
by
the
action
"
)
;
shell
.
isCurrentAppPinnedToTaskbarAsync
.
resolves
(
false
)
;
await
test
(
)
;
Assert
.
equal
(
shell
.
pinCurrentAppToTaskbar
.
callCount
2
"
pinCurrentAppToTaskbar
was
called
again
by
the
action
"
)
;
}
)
;
