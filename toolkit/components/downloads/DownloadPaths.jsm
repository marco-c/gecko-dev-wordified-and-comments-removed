"
use
strict
"
;
var
EXPORTED_SYMBOLS
=
[
"
DownloadPaths
"
]
;
var
DownloadPaths
=
{
sanitize
(
leafName
{
compressWhitespaces
=
true
}
=
{
}
)
{
const
mimeSvc
=
Cc
[
"
mozilla
.
org
/
mime
;
1
"
]
.
getService
(
Ci
.
nsIMIMEService
)
;
let
flags
=
mimeSvc
.
VALIDATE_SANITIZE_ONLY
|
mimeSvc
.
VALIDATE_DONT_TRUNCATE
;
if
(
!
compressWhitespaces
)
{
flags
|
=
mimeSvc
.
VALIDATE_DONT_COLLAPSE_WHITESPACE
;
}
return
mimeSvc
.
validateFileNameForSaving
(
leafName
"
"
flags
)
;
}
createNiceUniqueFile
(
templateFile
)
{
let
curFile
=
templateFile
.
clone
(
)
.
QueryInterface
(
Ci
.
nsIFile
)
;
let
[
base
ext
]
=
DownloadPaths
.
splitBaseNameAndExtension
(
curFile
.
leafName
)
;
for
(
let
i
=
1
;
i
<
10000
&
&
curFile
.
exists
(
)
;
i
+
+
)
{
curFile
.
leafName
=
base
+
"
(
"
+
i
+
"
)
"
+
ext
;
}
curFile
.
createUnique
(
Ci
.
nsIFile
.
NORMAL_FILE_TYPE
0o644
)
;
return
curFile
;
}
splitBaseNameAndExtension
(
leafName
)
{
let
[
base
ext
]
=
/
(
.
*
?
)
(
\
.
[
A
-
Z0
-
9
]
{
1
3
}
\
.
(
?
:
gz
|
bz2
|
Z
)
|
\
.
[
^
.
]
*
)
?
/
i
.
exec
(
leafName
)
;
return
[
base
ext
|
|
"
"
]
;
}
}
;
