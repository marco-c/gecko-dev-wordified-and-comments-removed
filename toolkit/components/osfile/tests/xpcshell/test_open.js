"
use
strict
"
;
const
{
OS
}
=
ChromeUtils
.
import
(
"
resource
:
/
/
gre
/
modules
/
osfile
.
jsm
"
)
;
add_task
(
async
function
(
)
{
try
{
await
OS
.
File
.
open
(
OS
.
Path
.
join
(
"
.
"
"
This
file
does
not
exist
"
)
)
;
Assert
.
ok
(
false
"
File
opening
1
succeeded
(
it
should
fail
)
"
)
;
}
catch
(
err
)
{
if
(
err
instanceof
OS
.
File
.
Error
&
&
err
.
becauseNoSuchFile
)
{
info
(
"
File
opening
1
failed
"
+
err
)
;
}
else
{
throw
err
;
}
}
info
(
"
Attempting
to
open
a
file
with
wrong
arguments
"
)
;
try
{
let
fd
=
await
OS
.
File
.
open
(
1
2
3
)
;
Assert
.
ok
(
false
"
File
opening
2
succeeded
(
it
should
fail
)
"
+
fd
)
;
}
catch
(
err
)
{
info
(
"
File
opening
2
failed
"
+
err
)
;
Assert
.
equal
(
false
err
instanceof
OS
.
File
.
Error
"
File
opening
2
returned
something
that
is
not
a
file
error
"
)
;
Assert
.
ok
(
err
.
constructor
.
name
=
=
"
TypeError
"
"
File
opening
2
returned
a
TypeError
"
)
;
}
info
(
"
Attempting
to
open
a
file
correctly
"
)
;
let
openedFile
=
await
OS
.
File
.
open
(
OS
.
Path
.
join
(
do_get_cwd
(
)
.
path
"
test_open
.
js
"
)
)
;
info
(
"
File
opened
correctly
"
)
;
info
(
"
Attempting
to
close
a
file
correctly
"
)
;
await
openedFile
.
close
(
)
;
info
(
"
Attempting
to
close
a
file
again
"
)
;
await
openedFile
.
close
(
)
;
}
)
;
add_task
(
async
function
test_error_attributes
(
)
{
let
dir
=
OS
.
Path
.
join
(
do_get_profile
(
)
.
path
"
test_osfileErrorAttrs
"
)
;
let
fpath
=
OS
.
Path
.
join
(
dir
"
test_error_attributes
.
txt
"
)
;
try
{
await
OS
.
File
.
open
(
fpath
{
truncate
:
true
}
{
}
)
;
Assert
.
ok
(
false
"
Opening
path
suceeded
(
it
should
fail
)
"
+
fpath
)
;
}
catch
(
err
)
{
Assert
.
ok
(
err
instanceof
OS
.
File
.
Error
)
;
Assert
.
ok
(
err
.
becauseNoSuchFile
)
;
}
}
)
;
