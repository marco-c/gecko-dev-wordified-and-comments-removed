const
{
TelemetryUtils
}
=
ChromeUtils
.
importESModule
(
"
resource
:
/
/
gre
/
modules
/
TelemetryUtils
.
sys
.
mjs
"
)
;
const
{
UpdateUtils
}
=
ChromeUtils
.
importESModule
(
"
resource
:
/
/
gre
/
modules
/
UpdateUtils
.
sys
.
mjs
"
)
;
add_task
(
async
function
testUpdateChannelOverride
(
)
{
if
(
Services
.
prefs
.
prefHasDefaultValue
(
TelemetryUtils
.
Preferences
.
OverrideUpdateChannel
)
|
|
Services
.
prefs
.
prefHasUserValue
(
TelemetryUtils
.
Preferences
.
OverrideUpdateChannel
)
)
{
Services
.
prefs
.
setStringPref
(
TelemetryUtils
.
Preferences
.
OverrideUpdateChannel
"
"
)
;
}
Assert
.
equal
(
TelemetryUtils
.
getUpdateChannel
(
)
UpdateUtils
.
getUpdateChannel
(
false
)
"
The
telemetry
reported
channel
must
match
the
one
from
UpdateChannel
by
default
.
"
)
;
const
OVERRIDE_TEST_CHANNEL
=
"
nightly
-
test
"
;
Services
.
prefs
.
setStringPref
(
TelemetryUtils
.
Preferences
.
OverrideUpdateChannel
OVERRIDE_TEST_CHANNEL
)
;
Assert
.
equal
(
TelemetryUtils
.
getUpdateChannel
(
)
OVERRIDE_TEST_CHANNEL
"
The
telemetry
reported
channel
must
match
the
override
pref
when
pref
is
set
.
"
)
;
}
)
;
