const
{
Preferences
}
=
ChromeUtils
.
importESModule
(
"
resource
:
/
/
gre
/
modules
/
Preferences
.
sys
.
mjs
"
)
;
const
{
TelemetryUtils
}
=
ChromeUtils
.
import
(
"
resource
:
/
/
gre
/
modules
/
TelemetryUtils
.
jsm
"
)
;
const
{
UpdateUtils
}
=
ChromeUtils
.
importESModule
(
"
resource
:
/
/
gre
/
modules
/
UpdateUtils
.
sys
.
mjs
"
)
;
add_task
(
async
function
testUpdateChannelOverride
(
)
{
if
(
Preferences
.
has
(
TelemetryUtils
.
Preferences
.
OverrideUpdateChannel
)
)
{
Preferences
.
set
(
TelemetryUtils
.
Preferences
.
OverrideUpdateChannel
"
"
)
;
}
Assert
.
equal
(
TelemetryUtils
.
getUpdateChannel
(
)
UpdateUtils
.
getUpdateChannel
(
false
)
"
The
telemetry
reported
channel
must
match
the
one
from
UpdateChannel
by
default
.
"
)
;
const
OVERRIDE_TEST_CHANNEL
=
"
nightly
-
test
"
;
Preferences
.
set
(
TelemetryUtils
.
Preferences
.
OverrideUpdateChannel
OVERRIDE_TEST_CHANNEL
)
;
Assert
.
equal
(
TelemetryUtils
.
getUpdateChannel
(
)
OVERRIDE_TEST_CHANNEL
"
The
telemetry
reported
channel
must
match
the
override
pref
when
pref
is
set
.
"
)
;
}
)
;
