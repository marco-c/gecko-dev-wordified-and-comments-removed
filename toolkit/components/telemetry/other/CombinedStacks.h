#
ifndef
CombinedStacks_h__
#
define
CombinedStacks_h__
#
include
<
vector
>
#
include
"
ipc
/
IPCMessageUtils
.
h
"
#
include
"
ProcessedStack
.
h
"
class
JSObject
;
struct
JSContext
;
namespace
mozilla
{
namespace
Telemetry
{
class
CombinedStacks
{
public
:
explicit
CombinedStacks
(
)
;
explicit
CombinedStacks
(
size_t
aMaxStacksCount
)
;
CombinedStacks
(
CombinedStacks
&
&
)
=
default
;
CombinedStacks
&
operator
=
(
CombinedStacks
&
&
)
=
default
;
void
Swap
(
CombinedStacks
&
aOther
)
;
typedef
std
:
:
vector
<
Telemetry
:
:
ProcessedStack
:
:
Frame
>
Stack
;
const
Telemetry
:
:
ProcessedStack
:
:
Module
&
GetModule
(
unsigned
aIndex
)
const
;
size_t
GetModuleCount
(
)
const
;
const
Stack
&
GetStack
(
unsigned
aIndex
)
const
;
size_t
AddStack
(
const
Telemetry
:
:
ProcessedStack
&
aStack
)
;
void
AddStacks
(
const
CombinedStacks
&
aStacks
)
;
size_t
GetStackCount
(
)
const
;
size_t
SizeOfExcludingThis
(
)
const
;
void
RemoveStack
(
unsigned
aIndex
)
;
size_t
GetMaxStacksCount
(
)
const
;
void
Clear
(
)
;
private
:
std
:
:
vector
<
Telemetry
:
:
ProcessedStack
:
:
Module
>
mModules
;
std
:
:
vector
<
Stack
>
mStacks
;
size_t
mNextIndex
;
size_t
mMaxStacksCount
;
void
AddFrame
(
size_t
aStackIndex
const
ProcessedStack
:
:
Frame
&
aFrame
const
std
:
:
function
<
const
ProcessedStack
:
:
Module
&
(
int
)
>
&
aModuleGetter
)
;
friend
struct
:
:
IPC
:
:
ParamTraits
<
CombinedStacks
>
;
}
;
JSObject
*
CreateJSStackObject
(
JSContext
*
cx
const
CombinedStacks
&
stacks
)
;
}
}
namespace
IPC
{
template
<
>
struct
ParamTraits
<
mozilla
:
:
Telemetry
:
:
CombinedStacks
>
{
typedef
mozilla
:
:
Telemetry
:
:
CombinedStacks
paramType
;
static
void
Write
(
MessageWriter
*
aWriter
const
paramType
&
aParam
)
{
WriteParam
(
aWriter
aParam
.
mModules
)
;
WriteParam
(
aWriter
aParam
.
mStacks
)
;
WriteParam
(
aWriter
aParam
.
mNextIndex
)
;
WriteParam
(
aWriter
aParam
.
mMaxStacksCount
)
;
}
static
bool
Read
(
MessageReader
*
aReader
paramType
*
aResult
)
{
if
(
!
ReadParam
(
aReader
&
aResult
-
>
mModules
)
)
{
return
false
;
}
if
(
!
ReadParam
(
aReader
&
aResult
-
>
mStacks
)
)
{
return
false
;
}
if
(
!
ReadParam
(
aReader
&
aResult
-
>
mNextIndex
)
)
{
return
false
;
}
if
(
!
ReadParam
(
aReader
&
aResult
-
>
mMaxStacksCount
)
)
{
return
false
;
}
return
true
;
}
}
;
}
#
endif
