#
ifndef
mozilla_UntrustedModulesBackupService_h
#
define
mozilla_UntrustedModulesBackupService_h
#
include
"
mozilla
/
UntrustedModulesData
.
h
"
#
include
"
nsRefPtrHashtable
.
h
"
namespace
mozilla
{
struct
ProcessHashKey
{
GeckoProcessType
mType
;
DWORD
mPid
;
ProcessHashKey
(
GeckoProcessType
aType
DWORD
aPid
)
;
bool
operator
=
=
(
const
ProcessHashKey
&
aOther
)
const
;
PLDHashNumber
Hash
(
)
const
;
}
;
class
MOZ_HEAP_CLASS
UntrustedModulesDataContainer
final
{
~
UntrustedModulesDataContainer
(
)
=
default
;
public
:
UntrustedModulesData
mData
;
explicit
UntrustedModulesDataContainer
(
UntrustedModulesData
&
&
aData
)
:
mData
(
std
:
:
move
(
aData
)
)
{
}
NS_INLINE_DECL_THREADSAFE_REFCOUNTING
(
UntrustedModulesDataContainer
)
}
;
class
UntrustedModulesBackupData
:
public
nsRefPtrHashtable
<
nsGenericHashKey
<
ProcessHashKey
>
UntrustedModulesDataContainer
>
{
public
:
void
Add
(
UntrustedModulesData
&
&
aData
)
;
}
;
class
MOZ_HEAP_CLASS
UntrustedModulesBackupService
final
{
public
:
enum
class
BackupType
:
uint32_t
{
Staging
=
0
Settled
Count
}
;
NS_INLINE_DECL_THREADSAFE_REFCOUNTING
(
UntrustedModulesBackupService
)
static
UntrustedModulesBackupService
*
Get
(
)
;
void
Backup
(
BackupType
aType
UntrustedModulesData
&
&
aData
)
;
void
SettleAllStagingData
(
)
;
const
UntrustedModulesBackupData
&
Ref
(
BackupType
aType
)
const
;
private
:
UntrustedModulesBackupData
mBackup
[
static_cast
<
uint32_t
>
(
BackupType
:
:
Count
)
]
;
~
UntrustedModulesBackupService
(
)
=
default
;
}
;
}
#
endif
