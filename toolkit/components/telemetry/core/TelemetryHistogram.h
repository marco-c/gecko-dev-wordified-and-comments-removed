#
ifndef
TelemetryHistogram_h__
#
define
TelemetryHistogram_h__
#
include
"
mozilla
/
TelemetryComms
.
h
"
#
include
"
mozilla
/
TelemetryHistogramEnums
.
h
"
#
include
"
mozilla
/
TelemetryProcessEnums
.
h
"
#
include
"
nsXULAppAPI
.
h
"
#
include
"
TelemetryCommon
.
h
"
namespace
mozilla
{
class
JSONWriter
;
}
namespace
TelemetryHistogram
{
void
InitializeGlobalState
(
bool
canRecordBase
bool
canRecordExtended
)
;
void
DeInitializeGlobalState
(
)
;
#
ifdef
DEBUG
bool
GlobalStateHasBeenInitialized
(
)
;
#
endif
bool
CanRecordBase
(
)
;
void
SetCanRecordBase
(
bool
b
)
;
bool
CanRecordExtended
(
)
;
void
SetCanRecordExtended
(
bool
b
)
;
void
InitHistogramRecordingEnabled
(
)
;
void
SetHistogramRecordingEnabled
(
mozilla
:
:
Telemetry
:
:
HistogramID
aID
bool
aEnabled
)
;
nsresult
SetHistogramRecordingEnabled
(
const
nsACString
&
id
bool
aEnabled
)
;
void
Accumulate
(
mozilla
:
:
Telemetry
:
:
HistogramID
aHistogram
uint32_t
aSample
)
;
void
Accumulate
(
mozilla
:
:
Telemetry
:
:
HistogramID
aHistogram
const
nsTArray
<
uint32_t
>
&
aSamples
)
;
void
Accumulate
(
mozilla
:
:
Telemetry
:
:
HistogramID
aID
const
nsCString
&
aKey
uint32_t
aSample
)
;
void
Accumulate
(
mozilla
:
:
Telemetry
:
:
HistogramID
aID
const
nsCString
&
aKey
const
nsTArray
<
uint32_t
>
&
aSamples
)
;
nsresult
Accumulate
(
const
char
*
name
uint32_t
sample
)
;
nsresult
Accumulate
(
const
char
*
name
const
nsCString
&
key
uint32_t
sample
)
;
void
AccumulateCategorical
(
mozilla
:
:
Telemetry
:
:
HistogramID
aId
const
nsCString
&
aLabel
)
;
void
AccumulateCategorical
(
mozilla
:
:
Telemetry
:
:
HistogramID
aId
const
nsTArray
<
nsCString
>
&
aLabels
)
;
void
AccumulateChild
(
mozilla
:
:
Telemetry
:
:
ProcessID
aProcessType
const
nsTArray
<
mozilla
:
:
Telemetry
:
:
HistogramAccumulation
>
&
aAccumulations
)
;
void
AccumulateChildKeyed
(
mozilla
:
:
Telemetry
:
:
ProcessID
aProcessType
const
nsTArray
<
mozilla
:
:
Telemetry
:
:
KeyedHistogramAccumulation
>
&
aAccumulations
)
;
nsresult
GetAllStores
(
mozilla
:
:
Telemetry
:
:
Common
:
:
StringHashSet
&
set
)
;
nsresult
GetCategoricalHistogramLabels
(
JSContext
*
aCx
JS
:
:
MutableHandle
<
JS
:
:
Value
>
aResult
)
;
nsresult
GetHistogramById
(
const
nsACString
&
name
JSContext
*
cx
JS
:
:
MutableHandle
<
JS
:
:
Value
>
ret
)
;
nsresult
GetKeyedHistogramById
(
const
nsACString
&
name
JSContext
*
cx
JS
:
:
MutableHandle
<
JS
:
:
Value
>
ret
)
;
const
char
*
GetHistogramName
(
mozilla
:
:
Telemetry
:
:
HistogramID
id
)
;
nsresult
CreateHistogramSnapshots
(
JSContext
*
aCx
JS
:
:
MutableHandle
<
JS
:
:
Value
>
aResult
const
nsACString
&
aStore
unsigned
int
aDataset
bool
aClearSubsession
bool
aFilterTest
=
false
)
;
nsresult
GetKeyedHistogramSnapshots
(
JSContext
*
aCx
JS
:
:
MutableHandle
<
JS
:
:
Value
>
aResult
const
nsACString
&
aStore
unsigned
int
aDataset
bool
aClearSubsession
bool
aFilterTest
=
false
)
;
size_t
GetHistogramSizesOfIncludingThis
(
mozilla
:
:
MallocSizeOf
aMallocSizeOf
)
;
nsresult
SerializeHistograms
(
mozilla
:
:
JSONWriter
&
aWriter
)
;
nsresult
SerializeKeyedHistograms
(
mozilla
:
:
JSONWriter
&
aWriter
)
;
nsresult
DeserializeHistograms
(
JSContext
*
aCx
JS
:
:
Handle
<
JS
:
:
Value
>
aData
)
;
nsresult
DeserializeKeyedHistograms
(
JSContext
*
aCx
JS
:
:
Handle
<
JS
:
:
Value
>
aData
)
;
}
#
endif
