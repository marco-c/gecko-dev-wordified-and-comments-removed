const
{
TestInterface
TwoTestInterfaces
cloneInterface
swapTestInterfaces
}
=
ChromeUtils
.
importESModule
(
"
resource
:
/
/
gre
/
modules
/
RustUniffiBindingsTests
.
sys
.
mjs
"
)
;
const
interface
=
TestInterface
.
init
(
20
)
;
Assert
.
equal
(
interface
.
getValue
(
)
20
)
;
Assert
.
equal
(
cloneInterface
(
interface
)
.
getValue
(
)
20
)
;
const
two
=
new
TwoTestInterfaces
(
{
first
:
TestInterface
.
init
(
1
)
second
:
TestInterface
.
init
(
2
)
}
)
;
const
swapped
=
swapTestInterfaces
(
two
)
;
Assert
.
equal
(
swapped
.
first
.
getValue
(
)
2
)
;
Assert
.
equal
(
swapped
.
second
.
getValue
(
)
1
)
;
const
interface2
=
TestInterface
.
init
(
20
)
;
function
funcThatClonesInterface
(
interface
)
{
return
cloneInterface
(
interface
)
;
}
const
interface2Clone
=
funcThatClonesInterface
(
cloneInterface
(
interface
)
)
;
interface
.
getValue
(
)
;
Cu
.
forceGC
(
)
;
Cu
.
forceCC
(
)
;
Assert
.
equal
(
interface
.
refCount
(
)
2
)
;
