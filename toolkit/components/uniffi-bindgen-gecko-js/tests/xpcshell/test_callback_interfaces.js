const
{
invokeTestCallbackInterfaceNoop
invokeTestCallbackInterfaceGetValue
invokeTestCallbackInterfaceSetValue
TestCallbackInterface
UniffiSkipJsTypeCheck
UnitTestObjs
}
=
ChromeUtils
.
importESModule
(
"
moz
-
src
:
/
/
/
toolkit
/
components
/
uniffi
-
bindgen
-
gecko
-
js
/
tests
/
generated
/
RustUniffiBindingsTests
.
sys
.
mjs
"
)
;
class
Callback
extends
TestCallbackInterface
{
constructor
(
value
)
{
super
(
)
;
this
.
value
=
value
;
}
noop
(
)
{
}
getValue
(
)
{
return
this
.
value
;
}
setValue
(
value
)
{
this
.
value
=
value
;
}
}
const
cbi
=
new
Callback
(
42
)
;
Assert
.
equal
(
UnitTestObjs
.
uniffiCallbackHandlerUniffiBindingsTestsTestCallbackInterface
.
hasRegisteredCallbacks
(
)
false
)
;
invokeTestCallbackInterfaceNoop
(
cbi
)
;
Assert
.
equal
(
invokeTestCallbackInterfaceGetValue
(
cbi
)
42
)
;
invokeTestCallbackInterfaceSetValue
(
cbi
43
)
;
Assert
.
equal
(
invokeTestCallbackInterfaceGetValue
(
cbi
)
43
)
;
const
invalidU32Value
=
2
*
*
48
;
try
{
invokeTestCallbackInterfaceSetValue
(
cbi
invalidU32Value
)
;
}
catch
{
}
try
{
invokeTestCallbackInterfaceSetValue
(
cbi
new
UniffiSkipJsTypeCheck
(
invalidU32Value
)
)
;
}
catch
{
}
delete
cbi
;
do_test_pending
(
)
;
do_timeout
(
100
(
)
=
>
{
Assert
.
equal
(
UnitTestObjs
.
uniffiCallbackHandlerUniffiBindingsTestsTestCallbackInterface
.
hasRegisteredCallbacks
(
)
false
)
;
do_test_finished
(
)
;
}
)
;
