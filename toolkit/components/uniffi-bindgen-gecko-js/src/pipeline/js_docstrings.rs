use
super
:
:
*
;
pub
fn
pass
(
root
:
&
mut
Root
)
-
>
Result
<
(
)
>
{
root
.
visit_mut
(
|
module
:
&
mut
Module
|
{
module
.
js_docstring
=
format_docstring
(
module
.
docstring
.
as_ref
(
)
.
unwrap_or
(
&
module
.
name
)
)
;
}
)
;
root
.
visit_mut
(
|
func
:
&
mut
Function
|
{
func
.
js_docstring
=
format_docstring
(
func
.
docstring
.
as_ref
(
)
.
unwrap_or
(
&
func
.
name
)
)
;
}
)
;
root
.
visit_mut
(
|
meth
:
&
mut
Method
|
{
meth
.
js_docstring
=
format_docstring
(
meth
.
docstring
.
as_ref
(
)
.
unwrap_or
(
&
meth
.
name
)
)
;
}
)
;
root
.
visit_mut
(
|
cons
:
&
mut
Method
|
{
cons
.
js_docstring
=
format_docstring
(
cons
.
docstring
.
as_ref
(
)
.
unwrap_or
(
&
cons
.
name
)
)
;
}
)
;
root
.
visit_mut
(
|
rec
:
&
mut
Record
|
{
rec
.
js_docstring
=
format_docstring
(
rec
.
docstring
.
as_ref
(
)
.
unwrap_or
(
&
rec
.
name
)
)
;
}
)
;
root
.
visit_mut
(
|
en
:
&
mut
Enum
|
{
en
.
js_docstring
=
format_docstring
(
en
.
docstring
.
as_ref
(
)
.
unwrap_or
(
&
en
.
name
)
)
;
}
)
;
root
.
visit_mut
(
|
variant
:
&
mut
Variant
|
{
variant
.
js_docstring
=
format_docstring
(
variant
.
docstring
.
as_ref
(
)
.
unwrap_or
(
&
variant
.
name
)
)
;
}
)
;
root
.
visit_mut
(
|
field
:
&
mut
Field
|
{
field
.
js_docstring
=
format_docstring
(
field
.
docstring
.
as_ref
(
)
.
unwrap_or
(
&
field
.
name
)
)
;
}
)
;
root
.
visit_mut
(
|
int
:
&
mut
Interface
|
{
int
.
js_docstring
=
format_docstring
(
int
.
docstring
.
as_ref
(
)
.
unwrap_or
(
&
int
.
name
)
)
;
}
)
;
root
.
visit_mut
(
|
cbi
:
&
mut
CallbackInterface
|
{
cbi
.
js_docstring
=
format_docstring
(
cbi
.
docstring
.
as_ref
(
)
.
unwrap_or
(
&
cbi
.
name
)
)
;
}
)
;
root
.
visit_mut
(
|
custom
:
&
mut
CustomType
|
{
custom
.
js_docstring
=
format_docstring
(
custom
.
docstring
.
as_ref
(
)
.
unwrap_or
(
&
custom
.
name
)
)
;
}
)
;
root
.
visit_mut
(
|
field
:
&
mut
Field
|
{
field
.
js_docstring
=
format_docstring
(
field
.
docstring
.
as_ref
(
)
.
unwrap_or
(
&
field
.
name
)
)
;
}
)
;
Ok
(
(
)
)
}
fn
format_docstring
(
docstring
:
&
str
)
-
>
String
{
let
docstring
=
textwrap
:
:
dedent
(
docstring
)
;
let
docstring
=
docstring
.
replace
(
"
*
/
"
"
*
/
"
)
;
let
mut
output
=
String
:
:
default
(
)
;
output
.
push_str
(
"
/
*
*
\
n
"
)
;
for
line
in
docstring
.
split
(
'
\
n
'
)
{
output
.
push_str
(
"
*
"
)
;
output
.
push_str
(
line
)
;
output
.
push
(
'
\
n
'
)
;
}
output
.
push_str
(
"
*
/
"
)
;
output
}
