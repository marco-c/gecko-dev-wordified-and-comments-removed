use
crate
:
:
metrics
:
:
CommonMetricData
;
use
once_cell
:
:
sync
:
:
Lazy
;
use
std
:
:
collections
:
:
HashMap
;
use
std
:
:
sync
:
:
Mutex
;
#
[
derive
(
Debug
)
]
pub
struct
IPCPayload
{
}
#
[
derive
(
Debug
PartialEq
Eq
Hash
Clone
)
]
pub
struct
MetricId
{
category
:
String
name
:
String
}
impl
MetricId
{
pub
fn
new
(
meta
:
CommonMetricData
)
-
>
Self
{
Self
{
category
:
meta
.
category
name
:
meta
.
name
}
}
}
static
PAYLOAD
:
Lazy
<
Mutex
<
IPCPayload
>
>
=
Lazy
:
:
new
(
|
|
Mutex
:
:
new
(
IPCPayload
{
}
)
)
;
pub
fn
with_ipc_payload
<
F
R
>
(
f
:
F
)
-
>
R
where
F
:
FnOnce
(
&
mut
IPCPayload
)
-
>
R
{
let
mut
payload
=
PAYLOAD
.
lock
(
)
.
unwrap
(
)
;
f
(
&
mut
payload
)
}
pub
fn
need_ipc
(
)
-
>
bool
{
false
}
