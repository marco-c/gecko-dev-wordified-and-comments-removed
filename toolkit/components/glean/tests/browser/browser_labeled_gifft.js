"
use
strict
"
;
function
keyedScalarValue
(
aScalarName
)
{
let
snapshot
=
Services
.
telemetry
.
getSnapshotForKeyedScalars
(
)
;
return
"
parent
"
in
snapshot
?
snapshot
.
parent
[
aScalarName
]
:
undefined
;
}
add_task
(
async
(
)
=
>
{
Services
.
fog
.
testResetFOG
(
)
;
Services
.
telemetry
.
clearScalars
(
)
;
Assert
.
equal
(
undefined
Glean
.
testOnlyIpc
.
aLabeledCounter
.
a_label
.
testGetValue
(
)
"
New
labels
with
no
values
should
return
undefined
"
)
;
Glean
.
testOnlyIpc
.
aLabeledCounter
.
a_label
.
add
(
1
)
;
Glean
.
testOnlyIpc
.
aLabeledCounter
.
another_label
.
add
(
2
)
;
Assert
.
equal
(
1
Glean
.
testOnlyIpc
.
aLabeledCounter
.
a_label
.
testGetValue
(
)
)
;
Assert
.
equal
(
2
Glean
.
testOnlyIpc
.
aLabeledCounter
.
another_label
.
testGetValue
(
)
)
;
Assert
.
equal
(
undefined
Glean
.
testOnlyIpc
.
aLabeledCounter
.
__other__
.
testGetValue
(
)
)
;
Glean
.
testOnlyIpc
.
aLabeledCounter
[
"
1
"
.
repeat
(
72
)
]
.
add
(
3
)
;
Assert
.
throws
(
(
)
=
>
Glean
.
testOnlyIpc
.
aLabeledCounter
.
__other__
.
testGetValue
(
)
/
DataError
/
"
Can
'
t
get
the
value
when
you
'
re
error
'
d
"
)
;
let
value
=
keyedScalarValue
(
"
telemetry
.
test
.
another_mirror_for_labeled_counter
"
)
;
Assert
.
deepEqual
(
{
a_label
:
1
another_label
:
2
[
"
1
"
.
repeat
(
72
)
]
:
3
}
value
)
;
}
)
;
