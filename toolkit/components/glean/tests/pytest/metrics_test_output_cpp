#
ifndef
mozilla_GleanMetrics_h
#
define
mozilla_GleanMetrics_h
#
include
"
mozilla
/
JSONStringWriteFuncs
.
h
"
#
include
"
mozilla
/
glean
/
bindings
/
MetricTypes
.
h
"
namespace
mozilla
:
:
glean
{
namespace
test
{
constexpr
impl
:
:
BooleanMetric
boolean_metric
(
1
)
;
constexpr
impl
:
:
CounterMetric
counter_metric
(
2
)
;
constexpr
impl
:
:
CustomDistributionMetric
custom_distribution_metric
(
3
)
;
constexpr
impl
:
:
Labeled
<
impl
:
:
BooleanMetric
DynamicLabel
>
labeled_boolean_metric
(
4
)
;
enum
class
LabeledBooleanMetricLabelsLabel
:
uint16_t
{
eOneLabel
=
0
eTwoLabels
=
1
eThreeLabels
=
2
eFourLabels
=
3
eFiveLabels
=
4
eSixLabels
=
5
eSevenLabels
=
6
eEightLabels
=
7
eNineLabels
=
8
eTenLabels
=
9
e__Other__
}
;
constexpr
impl
:
:
Labeled
<
impl
:
:
BooleanMetric
LabeledBooleanMetricLabelsLabel
>
labeled_boolean_metric_labels
(
5
)
;
constexpr
impl
:
:
Labeled
<
impl
:
:
CounterMetric
DynamicLabel
>
labeled_counter_metric
(
6
)
;
enum
class
LabeledCounterMetricLabelsLabel
:
uint16_t
{
eOneLabel
=
0
eTwoLabels
=
1
e__Other__
}
;
constexpr
impl
:
:
Labeled
<
impl
:
:
CounterMetric
LabeledCounterMetricLabelsLabel
>
labeled_counter_metric_labels
(
7
)
;
constexpr
impl
:
:
Labeled
<
impl
:
:
StringMetric
DynamicLabel
>
labeled_string_metric
(
8
)
;
enum
class
LabeledStringMetricLabelsLabel
:
uint16_t
{
eOneLabel
=
0
eTwoLabels
=
1
e__Other__
}
;
constexpr
impl
:
:
Labeled
<
impl
:
:
StringMetric
LabeledStringMetricLabelsLabel
>
labeled_string_metric_labels
(
9
)
;
constexpr
impl
:
:
MemoryDistributionMetric
memory_distribution_metric
(
10
)
;
constexpr
impl
:
:
StringListMetric
string_list_metric
(
11
)
;
constexpr
impl
:
:
StringMetric
string_metric
(
12
)
;
constexpr
impl
:
:
TextMetric
text_metric
(
13
)
;
constexpr
impl
:
:
TimespanMetric
timespan_metric
(
14
)
;
constexpr
impl
:
:
TimingDistributionMetric
timing_distribution_metric
(
15
)
;
constexpr
impl
:
:
BooleanMetric
unordered_boolean_metric
(
16
)
;
constexpr
impl
:
:
Labeled
<
impl
:
:
BooleanMetric
DynamicLabel
>
unordered_labeled_boolean_metric
(
17
)
;
}
namespace
test_nested
{
struct
AnObjectObjectItem
{
Maybe
<
nsCString
>
colour
;
Maybe
<
int64_t
>
diameter
;
Maybe
<
int64_t
>
CamelCasedParameter
;
}
;
using
AnObjectObject
=
nsTArray
<
AnObjectObjectItem
>
;
constexpr
impl
:
:
ObjectMetric
<
AnObjectObject
struct
AnObjectObjectTag
>
an_object
(
18
)
;
constexpr
impl
:
:
DatetimeMetric
datetime_metric
(
19
)
;
constexpr
impl
:
:
EventMetric
<
NoExtraKeys
>
event_metric
(
20
)
;
struct
EventMetricWithExtraExtra
{
mozilla
:
:
Maybe
<
nsCString
>
anExtraKey
;
mozilla
:
:
Maybe
<
nsCString
>
anotherExtraKey
;
mozilla
:
:
Maybe
<
bool
>
boolExtra
;
mozilla
:
:
Maybe
<
uint32_t
>
quantityExtra
;
std
:
:
tuple
<
nsTArray
<
nsCString
>
nsTArray
<
nsCString
>
>
ToFfiExtra
(
)
const
{
nsTArray
<
nsCString
>
extraKeys
;
nsTArray
<
nsCString
>
extraValues
;
if
(
anExtraKey
)
{
extraKeys
.
AppendElement
(
)
-
>
AssignASCII
(
"
an_extra_key
"
)
;
extraValues
.
EmplaceBack
(
anExtraKey
.
value
(
)
)
;
}
if
(
anotherExtraKey
)
{
extraKeys
.
AppendElement
(
)
-
>
AssignASCII
(
"
another_extra_key
"
)
;
extraValues
.
EmplaceBack
(
anotherExtraKey
.
value
(
)
)
;
}
if
(
boolExtra
)
{
extraKeys
.
AppendElement
(
)
-
>
AssignASCII
(
"
bool_extra
"
)
;
extraValues
.
AppendElement
(
)
-
>
AssignASCII
(
boolExtra
.
value
(
)
?
"
true
"
:
"
false
"
)
;
}
if
(
quantityExtra
)
{
extraKeys
.
AppendElement
(
)
-
>
AssignASCII
(
"
quantity_extra
"
)
;
extraValues
.
AppendElement
(
)
-
>
AppendInt
(
quantityExtra
.
value
(
)
)
;
}
return
std
:
:
make_tuple
(
std
:
:
move
(
extraKeys
)
std
:
:
move
(
extraValues
)
)
;
}
}
;
constexpr
impl
:
:
EventMetric
<
EventMetricWithExtraExtra
>
event_metric_with_extra
(
21
)
;
constexpr
impl
:
:
DenominatorMetric
external_denominator
(
22
)
;
constexpr
impl
:
:
CounterMetric
optimizable_counter_metric
(
23
)
;
constexpr
impl
:
:
CounterMetric
optimizable_disabled_counter_metric
(
24
)
;
constexpr
impl
:
:
QuantityMetric
quantity_metric
(
25
)
;
constexpr
impl
:
:
RateMetric
rate_metric
(
26
)
;
constexpr
impl
:
:
NumeratorMetric
rate_with_external_denominator
(
27
)
;
constexpr
impl
:
:
UuidMetric
uuid_metric
(
28
)
;
}
template
<
>
inline
void
impl
:
:
ObjectMetric
<
test_nested
:
:
AnObjectObject
test_nested
:
:
AnObjectObjectTag
>
:
:
Set
(
const
test_nested
:
:
AnObjectObject
&
aObj
)
const
{
nsCString
json
;
JSONStringRefWriteFunc
writeFunc
(
json
)
;
JSONWriter
writer
(
writeFunc
JSONWriter
:
:
CollectionStyle
:
:
SingleLineStyle
)
;
writer
.
StartArrayElement
(
)
;
{
for
(
const
auto
&
aobjItem
:
aObj
)
{
writer
.
StartObjectElement
(
)
;
{
if
(
aobjItem
.
colour
.
isSome
(
)
)
{
writer
.
StringProperty
(
"
colour
"
*
(
aobjItem
.
colour
)
)
;
}
if
(
aobjItem
.
diameter
.
isSome
(
)
)
{
writer
.
IntProperty
(
"
diameter
"
*
(
aobjItem
.
diameter
)
)
;
}
if
(
aobjItem
.
CamelCasedParameter
.
isSome
(
)
)
{
writer
.
IntProperty
(
"
CamelCasedParameter
"
*
(
aobjItem
.
CamelCasedParameter
)
)
;
}
}
writer
.
EndObject
(
)
;
}
}
writer
.
EndArray
(
)
;
SetStr
(
json
)
;
}
namespace
test2
{
constexpr
impl
:
:
BooleanMetric
boolean_metric
(
29
)
;
constexpr
impl
:
:
CounterMetric
counter_metric
(
30
)
;
constexpr
impl
:
:
CustomDistributionMetric
custom_distribution_metric
(
31
)
;
constexpr
impl
:
:
Labeled
<
impl
:
:
BooleanMetric
DynamicLabel
>
labeled_boolean_metric
(
32
)
;
enum
class
LabeledBooleanMetricLabelsLabel
:
uint16_t
{
eOneLabel
=
0
eTwoLabels
=
1
eThreeLabels
=
2
eFourLabels
=
3
eFiveLabels
=
4
eSixLabels
=
5
eSevenLabels
=
6
eEightLabels
=
7
eNineLabels
=
8
eTenLabels
=
9
e__Other__
}
;
constexpr
impl
:
:
Labeled
<
impl
:
:
BooleanMetric
LabeledBooleanMetricLabelsLabel
>
labeled_boolean_metric_labels
(
33
)
;
constexpr
impl
:
:
Labeled
<
impl
:
:
CounterMetric
DynamicLabel
>
labeled_counter_metric
(
34
)
;
enum
class
LabeledCounterMetricLabelsLabel
:
uint16_t
{
eOneLabel
=
0
eTwoLabels
=
1
e__Other__
}
;
constexpr
impl
:
:
Labeled
<
impl
:
:
CounterMetric
LabeledCounterMetricLabelsLabel
>
labeled_counter_metric_labels
(
35
)
;
constexpr
impl
:
:
Labeled
<
impl
:
:
StringMetric
DynamicLabel
>
labeled_string_metric
(
36
)
;
enum
class
LabeledStringMetricLabelsLabel
:
uint16_t
{
eOneLabel
=
0
eTwoLabels
=
1
e__Other__
}
;
constexpr
impl
:
:
Labeled
<
impl
:
:
StringMetric
LabeledStringMetricLabelsLabel
>
labeled_string_metric_labels
(
37
)
;
constexpr
impl
:
:
MemoryDistributionMetric
memory_distribution_metric
(
38
)
;
constexpr
impl
:
:
StringListMetric
string_list_metric
(
39
)
;
constexpr
impl
:
:
StringMetric
string_metric
(
40
)
;
constexpr
impl
:
:
TextMetric
text_metric
(
41
)
;
constexpr
impl
:
:
TimespanMetric
timespan_metric
(
42
)
;
constexpr
impl
:
:
TimingDistributionMetric
timing_distribution_metric
(
43
)
;
constexpr
impl
:
:
BooleanMetric
unordered_boolean_metric
(
44
)
;
constexpr
impl
:
:
Labeled
<
impl
:
:
BooleanMetric
DynamicLabel
>
unordered_labeled_boolean_metric
(
45
)
;
}
namespace
test2_nested
{
struct
AnObjectObjectItem
{
Maybe
<
nsCString
>
colour
;
Maybe
<
int64_t
>
diameter
;
Maybe
<
int64_t
>
CamelCasedParameter
;
}
;
using
AnObjectObject
=
nsTArray
<
AnObjectObjectItem
>
;
constexpr
impl
:
:
ObjectMetric
<
AnObjectObject
struct
AnObjectObjectTag
>
an_object
(
46
)
;
constexpr
impl
:
:
DatetimeMetric
datetime_metric
(
47
)
;
constexpr
impl
:
:
EventMetric
<
NoExtraKeys
>
event_metric
(
48
)
;
struct
EventMetricWithExtraExtra
{
mozilla
:
:
Maybe
<
nsCString
>
anExtraKey
;
mozilla
:
:
Maybe
<
nsCString
>
anotherExtraKey
;
std
:
:
tuple
<
nsTArray
<
nsCString
>
nsTArray
<
nsCString
>
>
ToFfiExtra
(
)
const
{
nsTArray
<
nsCString
>
extraKeys
;
nsTArray
<
nsCString
>
extraValues
;
if
(
anExtraKey
)
{
extraKeys
.
AppendElement
(
)
-
>
AssignASCII
(
"
an_extra_key
"
)
;
extraValues
.
EmplaceBack
(
anExtraKey
.
value
(
)
)
;
}
if
(
anotherExtraKey
)
{
extraKeys
.
AppendElement
(
)
-
>
AssignASCII
(
"
another_extra_key
"
)
;
extraValues
.
EmplaceBack
(
anotherExtraKey
.
value
(
)
)
;
}
return
std
:
:
make_tuple
(
std
:
:
move
(
extraKeys
)
std
:
:
move
(
extraValues
)
)
;
}
}
;
constexpr
impl
:
:
EventMetric
<
EventMetricWithExtraExtra
>
event_metric_with_extra
(
49
)
;
constexpr
impl
:
:
CounterMetric
external_denominator
(
50
)
;
constexpr
impl
:
:
CounterMetric
optimizable_counter_metric
(
51
)
;
constexpr
impl
:
:
CounterMetric
optimizable_disabled_counter_metric
(
52
)
;
constexpr
impl
:
:
QuantityMetric
quantity_metric
(
53
)
;
constexpr
impl
:
:
RateMetric
rate_metric
(
54
)
;
constexpr
impl
:
:
NumeratorMetric
rate_with_external_denominator
(
55
)
;
constexpr
impl
:
:
UuidMetric
uuid_metric
(
56
)
;
}
template
<
>
inline
void
impl
:
:
ObjectMetric
<
test2_nested
:
:
AnObjectObject
test2_nested
:
:
AnObjectObjectTag
>
:
:
Set
(
const
test2_nested
:
:
AnObjectObject
&
aObj
)
const
{
nsCString
json
;
JSONStringRefWriteFunc
writeFunc
(
json
)
;
JSONWriter
writer
(
writeFunc
JSONWriter
:
:
CollectionStyle
:
:
SingleLineStyle
)
;
writer
.
StartArrayElement
(
)
;
{
for
(
const
auto
&
aobjItem
:
aObj
)
{
writer
.
StartObjectElement
(
)
;
{
if
(
aobjItem
.
colour
.
isSome
(
)
)
{
writer
.
StringProperty
(
"
colour
"
*
(
aobjItem
.
colour
)
)
;
}
if
(
aobjItem
.
diameter
.
isSome
(
)
)
{
writer
.
IntProperty
(
"
diameter
"
*
(
aobjItem
.
diameter
)
)
;
}
if
(
aobjItem
.
CamelCasedParameter
.
isSome
(
)
)
{
writer
.
IntProperty
(
"
CamelCasedParameter
"
*
(
aobjItem
.
CamelCasedParameter
)
)
;
}
}
writer
.
EndObject
(
)
;
}
}
writer
.
EndArray
(
)
;
SetStr
(
json
)
;
}
}
#
endif
