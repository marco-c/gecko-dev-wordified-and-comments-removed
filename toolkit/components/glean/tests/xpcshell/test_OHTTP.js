"
use
strict
"
;
add_setup
(
async
(
)
=
>
{
do_get_profile
(
)
;
PingServer
.
start
(
)
;
registerCleanupFunction
(
async
(
)
=
>
{
await
PingServer
.
stop
(
)
;
}
)
;
Services
.
prefs
.
setIntPref
(
"
telemetry
.
fog
.
test
.
localhost_port
"
PingServer
.
port
)
;
Services
.
fog
.
testResetFOG
(
)
;
}
)
;
add_task
(
async
(
)
=
>
{
PingServer
.
clearRequests
(
)
;
GleanPings
.
testOhttpPing
.
submit
(
)
;
let
ping
;
while
(
true
)
{
let
request
=
await
PingServer
.
promiseNextRequest
(
)
;
if
(
request
.
path
.
includes
(
"
test
-
ohttp
-
ping
"
)
)
{
ping
=
decodeRequestPayload
(
request
)
;
break
;
}
}
ok
(
!
(
"
client_info
"
in
ping
)
"
No
client_info
allowed
.
"
)
;
ok
(
!
(
"
ping_info
"
in
ping
)
"
No
ping_info
allowed
.
"
)
;
}
)
;
