#
include
"
gtest
/
gtest
.
h
"
#
include
"
mozilla
/
Preferences
.
h
"
#
include
"
nsString
.
h
"
using
mozilla
:
:
Preferences
;
extern
"
C
"
{
void
GTest_FOG_ExpectFailure
(
const
char
*
aMessage
)
{
EXPECT_STREQ
(
aMessage
"
"
)
;
}
nsresult
fog_init
(
)
;
nsresult
fog_submit_ping
(
const
nsACString
*
aPingName
)
;
}
TEST
(
FOG
FogInitDoesntCrash
)
{
ASSERT_EQ
(
NS_OK
fog_init
(
)
)
;
}
extern
"
C
"
void
Rust_MeasureInitializeTime
(
)
;
TEST
(
FOG
TestMeasureInitializeTime
)
{
Rust_MeasureInitializeTime
(
)
;
}
TEST
(
FOG
BuiltinPingsRegistered
)
{
Preferences
:
:
SetInt
(
"
telemetry
.
fog
.
test
.
localhost_port
"
-
1
)
;
nsAutoCString
metricsPingName
(
"
metrics
"
)
;
nsAutoCString
baselinePingName
(
"
baseline
"
)
;
nsAutoCString
eventsPingName
(
"
events
"
)
;
ASSERT_EQ
(
NS_OK
fog_submit_ping
(
&
metricsPingName
)
)
;
ASSERT_EQ
(
NS_ERROR_NO_CONTENT
fog_submit_ping
(
&
baselinePingName
)
)
;
ASSERT_EQ
(
NS_ERROR_NO_CONTENT
fog_submit_ping
(
&
eventsPingName
)
)
;
}
