#
include
"
FOGIPC
.
h
"
#
include
"
mozilla
/
AppShutdown
.
h
"
#
include
"
mozilla
/
ClearOnShutdown
.
h
"
#
include
"
nsThreadUtils
.
h
"
using
mozilla
:
:
AppShutdown
;
using
mozilla
:
:
RunOnShutdown
;
using
mozilla
:
:
ShutdownPhase
;
using
mozilla
:
:
glean
:
:
FlushFOGData
;
using
mozilla
:
:
glean
:
:
SendFOGData
;
using
mozilla
:
:
ipc
:
:
ByteBuf
;
extern
"
C
"
{
void
FOG_RegisterContentChildShutdown
(
)
{
if
(
AppShutdown
:
:
IsInOrBeyond
(
ShutdownPhase
:
:
AppShutdownConfirmed
)
)
{
return
;
}
RunOnShutdown
(
[
]
{
FlushFOGData
(
[
]
(
ByteBuf
&
&
aBuf
)
{
SendFOGData
(
std
:
:
move
(
aBuf
)
)
;
}
)
;
}
ShutdownPhase
:
:
AppShutdownConfirmed
)
;
}
int
FOG_GetProcessType
(
)
{
return
XRE_GetProcessType
(
)
;
}
void
FOG_IPCPayloadFull
(
)
{
NS_DispatchToMainThread
(
NS_NewRunnableFunction
(
"
FOG
IPC
Payload
getting
full
"
[
]
{
FlushFOGData
(
[
]
(
ByteBuf
&
&
aBuf
)
{
SendFOGData
(
std
:
:
move
(
aBuf
)
)
;
}
)
;
}
)
)
;
}
}
