#
ifndef
mozilla_StoragePrincipalHelper_h
#
define
mozilla_StoragePrincipalHelper_h
#
include
"
nsError
.
h
"
class
nsIChannel
;
class
nsILoadGroup
;
class
nsIPrincipal
;
namespace
mozilla
{
namespace
dom
{
class
Document
;
}
namespace
ipc
{
class
PrincipalInfo
;
}
class
OriginAttributes
;
class
StoragePrincipalHelper
final
{
public
:
static
nsresult
Create
(
nsIChannel
*
aChannel
nsIPrincipal
*
aPrincipal
bool
aForceIsolation
nsIPrincipal
*
*
aStoragePrincipal
)
;
static
nsresult
CreatePartitionedPrincipalForServiceWorker
(
nsIPrincipal
*
aPrincipal
nsICookieJarSettings
*
aCookieJarSettings
nsIPrincipal
*
*
aPartitionedPrincipal
)
;
static
nsresult
PrepareEffectiveStoragePrincipalOriginAttributes
(
nsIChannel
*
aChannel
OriginAttributes
&
aOriginAttributes
)
;
static
bool
VerifyValidStoragePrincipalInfoForPrincipalInfo
(
const
mozilla
:
:
ipc
:
:
PrincipalInfo
&
aStoragePrincipalInfo
const
mozilla
:
:
ipc
:
:
PrincipalInfo
&
aPrincipalInfo
)
;
enum
PrincipalType
{
eRegularPrincipal
eStorageAccessPrincipal
ePartitionedPrincipal
}
;
static
bool
GetOriginAttributes
(
nsIChannel
*
aChannel
OriginAttributes
&
aAttributes
PrincipalType
aPrincipalType
)
;
static
bool
GetRegularPrincipalOriginAttributes
(
dom
:
:
Document
*
aDocument
OriginAttributes
&
aAttributes
)
;
static
bool
GetRegularPrincipalOriginAttributes
(
nsILoadGroup
*
aLoadGroup
OriginAttributes
&
aAttributes
)
;
static
bool
GetOriginAttributesForNetworkState
(
nsIChannel
*
aChanel
OriginAttributes
&
aAttributes
)
;
static
void
GetOriginAttributesForNetworkState
(
dom
:
:
Document
*
aDocument
OriginAttributes
&
aAttributes
)
;
static
void
UpdateOriginAttributesForNetworkState
(
nsIURI
*
aFirstPartyURI
OriginAttributes
&
aAttributes
)
;
}
;
}
#
endif
