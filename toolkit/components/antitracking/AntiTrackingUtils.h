#
ifndef
mozilla_antitrackingutils_h
#
define
mozilla_antitrackingutils_h
#
include
"
mozilla
/
AlreadyAddRefed
.
h
"
#
include
"
nsStringFwd
.
h
"
#
include
"
ContentBlockingNotifier
.
h
"
class
nsPIDOMWindowInner
;
class
nsPIDOMWindowOuter
;
class
nsIChannel
;
class
nsIPermission
;
class
nsIPrincipal
;
class
nsIURI
;
namespace
mozilla
{
namespace
dom
{
class
BrowsingContext
;
class
CanonicalBrowsingContext
;
class
WindowGlobalParent
;
}
class
AntiTrackingUtils
final
{
public
:
static
already_AddRefed
<
nsPIDOMWindowInner
>
GetInnerWindow
(
dom
:
:
BrowsingContext
*
aBrowsingContext
)
;
static
already_AddRefed
<
nsPIDOMWindowOuter
>
GetTopWindow
(
nsPIDOMWindowInner
*
aWindow
)
;
static
already_AddRefed
<
nsIURI
>
MaybeGetDocumentURIBeingLoaded
(
nsIChannel
*
aChannel
)
;
static
void
CreateStoragePermissionKey
(
const
nsACString
&
aTrackingOrigin
nsACString
&
aPermissionKey
)
;
static
bool
CreateStoragePermissionKey
(
nsIPrincipal
*
aPrincipal
nsACString
&
aKey
)
;
static
bool
IsStorageAccessPermission
(
nsIPermission
*
aPermission
nsIPrincipal
*
aPrincipal
)
;
static
bool
CheckStoragePermission
(
nsIPrincipal
*
aPrincipal
const
nsAutoCString
&
aType
bool
aIsInPrivateBrowsing
uint32_t
*
aRejectedReason
uint32_t
aBlockedReason
)
;
static
bool
HasStoragePermissionInParent
(
nsIChannel
*
aChannel
)
;
static
uint64_t
GetTopLevelAntiTrackingWindowId
(
dom
:
:
BrowsingContext
*
aBrowsingContext
)
;
static
uint64_t
GetTopLevelStorageAreaWindowId
(
dom
:
:
BrowsingContext
*
aBrowsingContext
)
;
static
already_AddRefed
<
nsIPrincipal
>
GetPrincipal
(
dom
:
:
BrowsingContext
*
aBrowsingContext
)
;
static
bool
GetPrincipalAndTrackingOrigin
(
dom
:
:
BrowsingContext
*
aBrowsingContext
nsIPrincipal
*
*
aPrincipal
nsACString
&
aTrackingOrigin
)
;
static
bool
IsFirstLevelSubContext
(
dom
:
:
BrowsingContext
*
aBrowsingContext
)
;
static
uint32_t
GetCookieBehavior
(
dom
:
:
BrowsingContext
*
aBrowsingContext
)
;
static
already_AddRefed
<
dom
:
:
WindowGlobalParent
>
GetTopWindowExcludingExtensionAccessibleContentFrames
(
dom
:
:
CanonicalBrowsingContext
*
aBrowsingContext
nsIURI
*
aURIBeingLoaded
)
;
static
void
ComputeIsThirdPartyToTopWindow
(
nsIChannel
*
aChannel
)
;
static
bool
IsThirdPartyChannel
(
nsIChannel
*
aChannel
)
;
static
bool
IsThirdPartyWindow
(
nsPIDOMWindowInner
*
aWindow
nsIURI
*
aURI
)
;
static
nsCString
GrantedReasonToString
(
ContentBlockingNotifier
:
:
StorageAccessPermissionGrantedReason
aReason
)
;
}
;
}
#
endif
