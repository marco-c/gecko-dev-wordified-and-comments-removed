#
ifndef
mozilla_antitrackingservice_h
#
define
mozilla_antitrackingservice_h
#
include
"
nsString
.
h
"
#
include
"
mozilla
/
MozPromise
.
h
"
#
include
"
mozilla
/
RefPtr
.
h
"
#
define
USER_INTERACTION_PERM
"
storageAccessAPI
"
class
nsIChannel
;
class
nsIHttpChannel
;
class
nsIPermission
;
class
nsIPrincipal
;
class
nsIURI
;
class
nsPIDOMWindowInner
;
namespace
mozilla
{
class
AntiTrackingCommon
final
{
public
:
typedef
std
:
:
function
<
void
(
const
bool
&
)
>
FirstPartyStorageAccessGrantedForOriginResolver
;
static
bool
ShouldHonorContentBlockingCookieRestrictions
(
)
;
static
bool
IsFirstPartyStorageAccessGrantedFor
(
nsPIDOMWindowInner
*
a3rdPartyTrackingWindow
nsIURI
*
aURI
uint32_t
*
aRejectedReason
)
;
static
bool
MaybeIsFirstPartyStorageAccessGrantedFor
(
nsPIDOMWindowInner
*
aFirstPartyWindow
nsIURI
*
aURI
)
;
static
bool
IsFirstPartyStorageAccessGrantedFor
(
nsIHttpChannel
*
aChannel
nsIURI
*
aURI
uint32_t
*
aRejectedReason
)
;
static
bool
IsFirstPartyStorageAccessGrantedFor
(
nsIPrincipal
*
aPrincipal
)
;
enum
StorageAccessGrantedReason
{
eStorageAccessAPI
eHeuristic
}
;
typedef
MozPromise
<
bool
bool
false
>
StorageAccessGrantPromise
;
static
MOZ_MUST_USE
RefPtr
<
StorageAccessGrantPromise
>
AddFirstPartyStorageAccessGrantedFor
(
nsIPrincipal
*
aPrincipal
nsPIDOMWindowInner
*
aParentWindow
StorageAccessGrantedReason
aReason
)
;
static
bool
IsStorageAccessPermission
(
nsIPermission
*
aPermission
nsIPrincipal
*
aPrincipal
)
;
static
void
StoreUserInteractionFor
(
nsIPrincipal
*
aPrincipal
)
;
static
bool
HasUserInteraction
(
nsIPrincipal
*
aPrincipal
)
;
static
void
SaveFirstPartyStorageAccessGrantedForOriginOnParentProcess
(
nsIPrincipal
*
aPrincipal
const
nsCString
&
aParentOrigin
const
nsCString
&
aGrantedOrigin
FirstPartyStorageAccessGrantedForOriginResolver
&
&
aResolver
)
;
enum
ContentBlockingAllowListPurpose
{
eStorageChecks
eTrackingProtection
eTrackingAnnotations
}
;
static
nsresult
IsOnContentBlockingAllowList
(
nsIURI
*
aTopWinURI
bool
aIsPrivateBrowsing
ContentBlockingAllowListPurpose
aPurpose
bool
&
aIsAllowListed
)
;
static
void
NotifyRejection
(
nsIChannel
*
aChannel
uint32_t
aRejectedReason
)
;
static
void
NotifyRejection
(
nsPIDOMWindowInner
*
aWindow
uint32_t
aRejectedReason
)
;
}
;
}
#
endif
