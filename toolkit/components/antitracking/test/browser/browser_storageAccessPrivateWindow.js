ChromeUtils
.
import
(
"
resource
:
/
/
gre
/
modules
/
Services
.
jsm
"
)
;
AntiTracking
.
runTest
(
"
Storage
Access
API
called
in
a
private
window
"
async
_
=
>
{
let
dwu
=
SpecialPowers
.
getDOMWindowUtils
(
window
)
;
let
helper
=
dwu
.
setHandlingUserInput
(
true
)
;
let
p
;
let
threw
=
false
;
try
{
p
=
document
.
requestStorageAccess
(
)
;
}
catch
(
e
)
{
threw
=
true
;
}
finally
{
helper
.
destruct
(
)
;
}
ok
(
!
threw
"
requestStorageAccess
should
not
throw
"
)
;
threw
=
false
;
try
{
await
p
;
}
catch
(
e
)
{
threw
=
true
;
}
ok
(
threw
"
requestStorageAccess
shouldn
'
t
be
available
"
)
;
}
null
null
[
[
"
dom
.
storage_access
.
enabled
"
true
]
]
false
false
false
true
null
)
;
