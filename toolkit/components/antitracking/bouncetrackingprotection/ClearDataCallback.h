#
ifndef
mozilla_ClearDataCallback_h__
#
define
mozilla_ClearDataCallback_h__
#
include
"
BounceTrackingMapEntry
.
h
"
#
include
"
mozilla
/
MozPromise
.
h
"
#
include
"
mozilla
/
glean
/
bindings
/
GleanMetric
.
h
"
#
include
"
nsIClearDataService
.
h
"
#
include
"
nsIURIClassifier
.
h
"
namespace
mozilla
{
using
ClearDataMozPromise
=
MozPromise
<
RefPtr
<
BounceTrackingMapEntry
>
uint32_t
true
>
;
extern
LazyLogModule
gBounceTrackingProtectionLog
;
class
ClearDataCallback
final
:
public
nsIClearDataCallback
public
nsIUrlClassifierFeatureCallback
{
public
:
NS_DECL_ISUPPORTS
NS_DECL_NSICLEARDATACALLBACK
NS_DECL_NSIURLCLASSIFIERFEATURECALLBACK
explicit
ClearDataCallback
(
ClearDataMozPromise
:
:
Private
*
aPromise
const
OriginAttributes
&
aOriginAttributes
const
nsACString
&
aHost
PRTime
aBounceTime
)
;
private
:
virtual
~
ClearDataCallback
(
)
;
RefPtr
<
BounceTrackingMapEntry
>
mEntry
;
RefPtr
<
ClearDataMozPromise
:
:
Private
>
mPromise
;
void
RecordClearDurationTelemetry
(
)
;
glean
:
:
TimerId
mClearDurationTimer
;
void
RecordPurgeCountTelemetry
(
bool
aFailed
)
;
void
RecordURLClassifierTelemetry
(
)
;
void
RecordPurgeEventTelemetry
(
bool
aSuccess
)
;
}
;
}
#
endif
