"
use
strict
"
;
const
{
Services
}
=
ChromeUtils
.
import
(
"
resource
:
/
/
gre
/
modules
/
Services
.
jsm
"
)
;
const
PREF_STRIP_ENABLED
=
"
privacy
.
query_stripping
.
enabled
"
;
if
(
Services
.
appinfo
.
processType
=
=
Services
.
appinfo
.
PROCESS_TYPE_CONTENT
)
{
if
(
Services
.
prefs
.
getBoolPref
(
PREF_STRIP_ENABLED
)
)
{
let
urlQueryStrippingListService
=
Cc
[
"
mozilla
.
org
/
query
-
stripping
-
list
-
service
;
1
"
]
.
getService
(
Ci
.
nsIURLQueryStrippingListService
)
;
urlQueryStrippingListService
.
init
(
)
;
}
else
{
let
observer
=
(
subject
topic
data
)
=
>
{
if
(
topic
=
=
"
nsPref
:
changed
"
&
&
data
=
=
PREF_STRIP_ENABLED
&
&
Services
.
prefs
.
getBoolPref
(
PREF_STRIP_ENABLED
)
)
{
let
urlQueryStrippingListService
=
Cc
[
"
mozilla
.
org
/
query
-
stripping
-
list
-
service
;
1
"
]
.
getService
(
Ci
.
nsIURLQueryStrippingListService
)
;
urlQueryStrippingListService
.
init
(
)
;
Services
.
prefs
.
removeObserver
(
PREF_STRIP_ENABLED
observer
)
;
}
}
;
Services
.
prefs
.
addObserver
(
PREF_STRIP_ENABLED
observer
)
;
}
}
