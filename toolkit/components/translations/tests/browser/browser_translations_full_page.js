"
use
strict
"
;
add_task
(
async
function
test_full_page_translation
(
)
{
await
autoTranslatePage
(
{
page
:
SPANISH_PAGE_URL
languagePairs
:
[
{
fromLang
:
"
es
"
toLang
:
"
en
"
}
{
fromLang
:
"
en
"
toLang
:
"
es
"
}
]
contentEagerMode
:
true
runInPage
:
async
TranslationsTest
=
>
{
const
selectors
=
TranslationsTest
.
getSelectors
(
)
;
await
TranslationsTest
.
assertTranslationResult
(
"
The
main
title
gets
translated
.
"
selectors
.
getH1
"
DON
QUIJOTE
DE
LA
MANCHA
[
es
to
en
]
"
)
;
await
TranslationsTest
.
assertTranslationResult
(
"
The
last
paragraph
gets
translated
even
though
it
is
out
of
the
viewport
.
"
selectors
.
getLastParagraph
"
PUES
AUNQUE
MOV
IS
M
S
BRAZOS
QUE
LOS
DEL
GIGANTE
BRIAREO
ME
LO
HAB
IS
DE
PAGAR
.
[
es
to
en
]
"
)
;
selectors
.
getH1
(
)
.
innerText
=
"
Este
es
un
titulo
"
;
await
TranslationsTest
.
assertTranslationResult
(
"
Mutations
get
tracked
"
selectors
.
getH1
"
ESTE
ES
UN
TITULO
[
es
to
en
]
"
)
;
await
TranslationsTest
.
assertTranslationResult
(
"
Other
languages
do
not
get
translated
.
"
selectors
.
getHeader
"
The
following
is
an
excerpt
from
Don
Quijote
de
la
Mancha
which
is
in
the
public
domain
"
)
;
}
}
)
;
}
)
;
add_task
(
async
function
test_about_translations_enabled
(
)
{
const
{
appLocaleAsBCP47
}
=
Services
.
locale
;
if
(
!
appLocaleAsBCP47
.
startsWith
(
"
en
"
)
)
{
console
.
warn
(
"
This
test
assumes
to
be
running
in
an
'
en
'
app
locale
however
the
app
locale
"
+
is
set
to
{
appLocaleAsBCP47
}
.
Skipping
the
test
.
)
;
ok
(
true
"
Skipping
test
.
"
)
;
return
;
}
await
autoTranslatePage
(
{
page
:
ENGLISH_PAGE_URL
languagePairs
:
[
{
fromLang
:
"
es
"
toLang
:
"
en
"
}
{
fromLang
:
"
en
"
toLang
:
"
es
"
}
]
runInPage
:
async
(
)
=
>
{
const
{
document
}
=
content
;
for
(
let
i
=
0
;
i
<
5
;
i
+
+
)
{
const
timeout
=
10
;
info
(
"
Waiting
for
the
timeout
.
"
)
;
await
new
Promise
(
resolve
=
>
setTimeout
(
resolve
timeout
)
)
;
is
(
document
.
querySelector
(
"
h1
"
)
.
innerText
"
The
Wonderful
Wizard
of
Oz
"
by
L
.
Frank
Baum
The
page
remains
untranslated
after
{
(
i
+
1
)
*
timeout
}
ms
.
)
;
}
}
}
)
;
}
)
;
add_task
(
async
function
test_language_identification_for_page_translation
(
)
{
await
autoTranslatePage
(
{
page
:
NO_LANGUAGE_URL
languagePairs
:
[
{
fromLang
:
"
es
"
toLang
:
"
en
"
}
{
fromLang
:
"
en
"
toLang
:
"
es
"
}
]
contentEagerMode
:
true
runInPage
:
async
TranslationsTest
=
>
{
const
selectors
=
TranslationsTest
.
getSelectors
(
)
;
await
TranslationsTest
.
assertTranslationResult
(
"
The
main
title
gets
translated
.
"
selectors
.
getH1
"
DON
QUIJOTE
DE
LA
MANCHA
[
es
to
en
]
"
)
;
await
TranslationsTest
.
assertTranslationResult
(
"
The
last
paragraph
gets
translated
even
though
it
is
out
of
the
viewport
.
"
selectors
.
getLastParagraph
"
PUES
AUNQUE
MOV
IS
M
S
BRAZOS
QUE
LOS
DEL
GIGANTE
BRIAREO
ME
LO
HAB
IS
DE
PAGAR
.
[
es
to
en
]
"
)
;
selectors
.
getH1
(
)
.
innerText
=
"
Este
es
un
titulo
"
;
await
TranslationsTest
.
assertTranslationResult
(
"
Mutations
get
tracked
"
selectors
.
getH1
"
ESTE
ES
UN
TITULO
[
es
to
en
]
"
)
;
await
TranslationsTest
.
assertTranslationResult
(
"
Other
languages
do
not
get
translated
.
"
selectors
.
getHeader
"
The
following
is
an
excerpt
from
Don
Quijote
de
la
Mancha
which
is
in
the
public
domain
"
)
;
}
}
)
;
}
)
;
