#
include
"
mozilla
/
ClearOnShutdown
.
h
"
#
include
"
mozilla
/
StaticPtr
.
h
"
#
include
"
nsCOMPtr
.
h
"
#
include
"
Bits
.
h
"
namespace
{
extern
"
C
"
{
void
new_bits_service
(
nsIBits
*
*
result
)
;
}
static
mozilla
:
:
StaticRefPtr
<
nsIBits
>
sBitsService
;
}
already_AddRefed
<
nsIBits
>
GetBitsService
(
)
{
nsCOMPtr
<
nsIBits
>
bitsService
;
if
(
sBitsService
)
{
bitsService
=
sBitsService
;
}
else
{
new_bits_service
(
getter_AddRefs
(
bitsService
)
)
;
sBitsService
=
bitsService
;
mozilla
:
:
ClearOnShutdown
(
&
sBitsService
)
;
}
return
bitsService
.
forget
(
)
;
}
