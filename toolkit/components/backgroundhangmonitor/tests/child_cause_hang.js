const
{
Services
}
=
ChromeUtils
.
import
(
"
resource
:
/
/
gre
/
modules
/
Services
.
jsm
"
)
;
function
ensureProfilerInitialized
(
)
{
if
(
!
Services
.
profiler
.
CanProfile
(
)
)
{
return
false
;
}
let
features
=
[
"
stackwalk
"
]
;
Services
.
profiler
.
StartProfiler
(
1000
10
features
features
.
length
)
;
Services
.
profiler
.
StopProfiler
(
)
;
return
true
;
}
add_task
(
async
function
childCauseHang
(
)
{
if
(
!
ensureProfilerInitialized
(
)
)
{
return
;
}
executeSoon
(
(
)
=
>
{
let
startTime
=
Date
.
now
(
)
;
while
(
(
Date
.
now
(
)
-
startTime
)
<
2000
)
;
}
)
;
await
do_await_remote_message
(
"
bhr_hangs_detected
"
)
;
}
)
;
