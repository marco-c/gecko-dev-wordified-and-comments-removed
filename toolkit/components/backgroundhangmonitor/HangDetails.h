#
ifndef
mozilla_HangDetails_h
#
define
mozilla_HangDetails_h
#
include
<
utility
>
#
include
"
ipc
/
IPCMessageUtils
.
h
"
#
include
"
mozilla
/
HangAnnotations
.
h
"
#
include
"
mozilla
/
HangTypes
.
h
"
#
include
"
mozilla
/
ProcessedStack
.
h
"
#
include
"
mozilla
/
RefPtr
.
h
"
#
include
"
mozilla
/
Result
.
h
"
#
include
"
mozilla
/
TimeStamp
.
h
"
#
include
"
nsIFile
.
h
"
#
include
"
nsIHangDetails
.
h
"
#
include
"
nsTArray
.
h
"
namespace
mozilla
{
enum
class
PersistedToDisk
{
No
Yes
}
;
class
nsHangDetails
:
public
nsIHangDetails
{
public
:
NS_DECL_THREADSAFE_ISUPPORTS
NS_DECL_NSIHANGDETAILS
explicit
nsHangDetails
(
HangDetails
&
&
aDetails
PersistedToDisk
aPersistedToDisk
)
:
mDetails
(
std
:
:
move
(
aDetails
)
)
mPersistedToDisk
(
aPersistedToDisk
)
{
}
void
Submit
(
)
;
private
:
virtual
~
nsHangDetails
(
)
=
default
;
HangDetails
mDetails
;
PersistedToDisk
mPersistedToDisk
;
}
;
Result
<
Ok
nsresult
>
WriteHangDetailsToFile
(
HangDetails
&
aDetails
nsIFile
*
aFile
)
;
class
ProcessHangStackRunnable
final
:
public
Runnable
{
public
:
explicit
ProcessHangStackRunnable
(
HangDetails
&
&
aHangDetails
PersistedToDisk
aPersistedToDisk
)
:
Runnable
(
"
ProcessHangStackRunnable
"
)
mHangDetails
(
std
:
:
move
(
aHangDetails
)
)
mPersistedToDisk
(
aPersistedToDisk
)
{
}
NS_IMETHOD
Run
(
)
override
;
private
:
HangDetails
mHangDetails
;
PersistedToDisk
mPersistedToDisk
;
}
;
class
SubmitPersistedPermahangRunnable
final
:
public
Runnable
{
public
:
explicit
SubmitPersistedPermahangRunnable
(
nsIFile
*
aPermahangFile
)
:
Runnable
(
"
SubmitPersistedPermahangRunnable
"
)
mPermahangFile
(
aPermahangFile
)
{
}
NS_IMETHOD
Run
(
)
override
;
private
:
nsCOMPtr
<
nsIFile
>
mPermahangFile
;
}
;
}
#
endif
