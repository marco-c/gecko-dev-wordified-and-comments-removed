#
include
"
HashStore
.
h
"
#
include
"
LookupCacheV4
.
h
"
#
include
"
nsIFile
.
h
"
#
include
"
nsTArray
.
h
"
#
include
"
gtest
/
gtest
.
h
"
using
namespace
mozilla
;
using
namespace
mozilla
:
:
safebrowsing
;
namespace
mozilla
{
namespace
safebrowsing
{
class
Classifier
;
class
LookupCacheV4
;
}
}
typedef
nsCString
_Fragment
;
typedef
nsTArray
<
nsCString
>
_PrefixArray
;
template
<
typename
Function
>
void
RunTestInNewThread
(
Function
&
&
aFunction
)
;
nsresult
SyncApplyUpdates
(
Classifier
*
aClassifier
nsTArray
<
TableUpdate
*
>
*
aUpdates
)
;
already_AddRefed
<
nsIFile
>
GetFile
(
const
nsTArray
<
nsString
>
&
path
)
;
void
ApplyUpdate
(
nsTArray
<
TableUpdate
*
>
&
updates
)
;
void
ApplyUpdate
(
TableUpdate
*
update
)
;
void
PrefixArrayToPrefixStringMap
(
const
nsTArray
<
nsCString
>
&
prefixArray
PrefixStringMap
&
out
)
;
nsresult
PrefixArrayToAddPrefixArrayV2
(
const
nsTArray
<
nsCString
>
&
prefixArray
AddPrefixArray
&
out
)
;
nsCString
GeneratePrefix
(
const
nsCString
&
aFragment
uint8_t
aLength
)
;
void
CheckContent
(
LookupCacheV4
*
cache
PrefixStringMap
&
expected
)
;
template
<
typename
T
>
RefPtr
<
T
>
SetupLookupCache
(
const
_PrefixArray
&
prefixArray
)
;
