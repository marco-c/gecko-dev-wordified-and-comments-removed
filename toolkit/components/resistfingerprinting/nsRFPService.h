#
ifndef
__nsRFPService_h__
#
define
__nsRFPService_h__
#
include
"
mozilla
/
Atomics
.
h
"
#
include
"
nsIObserver
.
h
"
#
include
"
nsString
.
h
"
#
ifdef
XP_WIN
#
define
SPOOFED_UA_OS
"
Windows
NT
6
.
1
;
Win64
;
x64
"
#
define
SPOOFED_APPVERSION
"
5
.
0
(
Windows
)
"
#
define
SPOOFED_OSCPU
"
Windows
NT
6
.
1
;
Win64
;
x64
"
#
define
SPOOFED_PLATFORM
"
Win64
"
#
elif
defined
(
XP_MACOSX
)
#
define
SPOOFED_UA_OS
"
Macintosh
;
Intel
Mac
OS
X
10
.
13
"
#
define
SPOOFED_APPVERSION
"
5
.
0
(
Macintosh
)
"
#
define
SPOOFED_OSCPU
"
Intel
Mac
OS
X
10
.
13
"
#
define
SPOOFED_PLATFORM
"
MacIntel
"
#
elif
defined
(
MOZ_WIDGET_ANDROID
)
#
define
SPOOFED_UA_OS
"
Android
6
.
0
;
Mobile
"
#
define
SPOOFED_APPVERSION
"
5
.
0
(
Android
6
.
0
)
"
#
define
SPOOFED_OSCPU
"
Linux
armv7l
"
#
define
SPOOFED_PLATFORM
"
Linux
armv7l
"
#
else
#
define
SPOOFED_UA_OS
"
X11
;
Linux
x86_64
"
#
define
SPOOFED_APPVERSION
"
5
.
0
(
X11
)
"
#
define
SPOOFED_OSCPU
"
Linux
x86_64
"
#
define
SPOOFED_PLATFORM
"
Linux
x86_64
"
#
endif
#
define
SPOOFED_APPNAME
"
Netscape
"
#
define
LEGACY_BUILD_ID
"
20100101
"
namespace
mozilla
{
class
nsRFPService
final
:
public
nsIObserver
{
public
:
NS_DECL_ISUPPORTS
NS_DECL_NSIOBSERVER
static
nsRFPService
*
GetOrCreate
(
)
;
static
bool
IsResistFingerprintingEnabled
(
)
{
return
sPrivacyResistFingerprinting
;
}
static
bool
IsTimerPrecisionReductionEnabled
(
)
{
return
sPrivacyTimerPrecisionReduction
|
|
IsResistFingerprintingEnabled
(
)
;
}
static
double
ReduceTimePrecisionAsMSecs
(
double
aTime
)
;
static
double
ReduceTimePrecisionAsUSecs
(
double
aTime
)
;
static
double
ReduceTimePrecisionAsSecs
(
double
aTime
)
;
static
uint32_t
CalculateTargetVideoResolution
(
uint32_t
aVideoQuality
)
;
static
uint32_t
GetSpoofedTotalFrames
(
double
aTime
)
;
static
uint32_t
GetSpoofedDroppedFrames
(
double
aTime
uint32_t
aWidth
uint32_t
aHeight
)
;
static
uint32_t
GetSpoofedPresentedFrames
(
double
aTime
uint32_t
aWidth
uint32_t
aHeight
)
;
static
nsresult
GetSpoofedUserAgent
(
nsACString
&
userAgent
)
;
private
:
nsresult
Init
(
)
;
nsRFPService
(
)
{
}
~
nsRFPService
(
)
{
}
void
UpdateTimers
(
)
;
void
UpdateRFPPref
(
)
;
void
StartShutdown
(
)
;
static
Atomic
<
bool
ReleaseAcquire
>
sPrivacyResistFingerprinting
;
static
Atomic
<
bool
ReleaseAcquire
>
sPrivacyTimerPrecisionReduction
;
nsCString
mInitialTZValue
;
}
;
}
#
endif
