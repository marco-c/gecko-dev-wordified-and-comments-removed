#
ifndef
GOOGLE_PROTOBUF_UTIL_INTERNAL_PROTO_WRITER_H__
#
define
GOOGLE_PROTOBUF_UTIL_INTERNAL_PROTO_WRITER_H__
#
include
<
cstdint
>
#
include
<
deque
>
#
include
<
string
>
#
include
<
unordered_set
>
#
include
<
vector
>
#
include
<
google
/
protobuf
/
stubs
/
common
.
h
>
#
include
<
google
/
protobuf
/
type
.
pb
.
h
>
#
include
<
google
/
protobuf
/
io
/
coded_stream
.
h
>
#
include
<
google
/
protobuf
/
io
/
zero_copy_stream_impl
.
h
>
#
include
<
google
/
protobuf
/
descriptor
.
h
>
#
include
<
google
/
protobuf
/
stubs
/
bytestream
.
h
>
#
include
<
google
/
protobuf
/
stubs
/
status
.
h
>
#
include
<
google
/
protobuf
/
util
/
internal
/
datapiece
.
h
>
#
include
<
google
/
protobuf
/
util
/
internal
/
error_listener
.
h
>
#
include
<
google
/
protobuf
/
util
/
internal
/
structured_objectwriter
.
h
>
#
include
<
google
/
protobuf
/
util
/
internal
/
type_info
.
h
>
#
include
<
google
/
protobuf
/
util
/
type_resolver
.
h
>
#
include
<
google
/
protobuf
/
stubs
/
hash
.
h
>
#
include
<
google
/
protobuf
/
stubs
/
status
.
h
>
#
include
<
google
/
protobuf
/
port_def
.
inc
>
namespace
google
{
namespace
protobuf
{
namespace
util
{
namespace
converter
{
class
ObjectLocationTracker
;
class
PROTOBUF_EXPORT
ProtoWriter
:
public
StructuredObjectWriter
{
public
:
ProtoWriter
(
TypeResolver
*
type_resolver
const
google
:
:
protobuf
:
:
Type
&
type
strings
:
:
ByteSink
*
output
ErrorListener
*
listener
)
;
~
ProtoWriter
(
)
override
;
ProtoWriter
*
StartObject
(
StringPiece
name
)
override
;
ProtoWriter
*
EndObject
(
)
override
;
ProtoWriter
*
StartList
(
StringPiece
name
)
override
;
ProtoWriter
*
EndList
(
)
override
;
ProtoWriter
*
RenderBool
(
StringPiece
name
bool
value
)
override
{
return
RenderDataPiece
(
name
DataPiece
(
value
)
)
;
}
ProtoWriter
*
RenderInt32
(
StringPiece
name
int32_t
value
)
override
{
return
RenderDataPiece
(
name
DataPiece
(
value
)
)
;
}
ProtoWriter
*
RenderUint32
(
StringPiece
name
uint32_t
value
)
override
{
return
RenderDataPiece
(
name
DataPiece
(
value
)
)
;
}
ProtoWriter
*
RenderInt64
(
StringPiece
name
int64_t
value
)
override
{
return
RenderDataPiece
(
name
DataPiece
(
value
)
)
;
}
ProtoWriter
*
RenderUint64
(
StringPiece
name
uint64_t
value
)
override
{
return
RenderDataPiece
(
name
DataPiece
(
value
)
)
;
}
ProtoWriter
*
RenderDouble
(
StringPiece
name
double
value
)
override
{
return
RenderDataPiece
(
name
DataPiece
(
value
)
)
;
}
ProtoWriter
*
RenderFloat
(
StringPiece
name
float
value
)
override
{
return
RenderDataPiece
(
name
DataPiece
(
value
)
)
;
}
ProtoWriter
*
RenderString
(
StringPiece
name
StringPiece
value
)
override
{
return
RenderDataPiece
(
name
DataPiece
(
value
use_strict_base64_decoding
(
)
)
)
;
}
ProtoWriter
*
RenderBytes
(
StringPiece
name
StringPiece
value
)
override
{
return
RenderDataPiece
(
name
DataPiece
(
value
false
use_strict_base64_decoding
(
)
)
)
;
}
ProtoWriter
*
RenderNull
(
StringPiece
name
)
override
{
return
RenderDataPiece
(
name
DataPiece
:
:
NullData
(
)
)
;
}
virtual
ProtoWriter
*
RenderDataPiece
(
StringPiece
name
const
DataPiece
&
data
)
;
const
LocationTrackerInterface
&
location
(
)
{
return
element_
!
=
nullptr
?
*
element_
:
*
tracker_
;
}
bool
done
(
)
override
{
return
done_
;
}
io
:
:
CodedOutputStream
*
stream
(
)
{
return
stream_
.
get
(
)
;
}
void
IncrementInvalidDepth
(
)
{
+
+
invalid_depth_
;
}
void
DecrementInvalidDepth
(
)
{
-
-
invalid_depth_
;
}
int
invalid_depth
(
)
{
return
invalid_depth_
;
}
ErrorListener
*
listener
(
)
{
return
listener_
;
}
const
TypeInfo
*
typeinfo
(
)
{
return
typeinfo_
;
}
void
set_ignore_unknown_fields
(
bool
ignore_unknown_fields
)
{
ignore_unknown_fields_
=
ignore_unknown_fields
;
}
bool
ignore_unknown_fields
(
)
{
return
ignore_unknown_fields_
;
}
void
set_ignore_unknown_enum_values
(
bool
ignore_unknown_enum_values
)
{
ignore_unknown_enum_values_
=
ignore_unknown_enum_values
;
}
void
set_use_lower_camel_for_enums
(
bool
use_lower_camel_for_enums
)
{
use_lower_camel_for_enums_
=
use_lower_camel_for_enums
;
}
void
set_case_insensitive_enum_parsing
(
bool
case_insensitive_enum_parsing
)
{
case_insensitive_enum_parsing_
=
case_insensitive_enum_parsing
;
}
void
set_use_json_name_in_missing_fields
(
bool
use_json_name_in_missing_fields
)
{
use_json_name_in_missing_fields_
=
use_json_name_in_missing_fields
;
}
protected
:
class
PROTOBUF_EXPORT
ProtoElement
:
public
BaseElement
public
LocationTrackerInterface
{
public
:
ProtoElement
(
const
TypeInfo
*
typeinfo
const
google
:
:
protobuf
:
:
Type
&
type
ProtoWriter
*
enclosing
)
;
ProtoElement
(
ProtoElement
*
parent
const
google
:
:
protobuf
:
:
Field
*
field
const
google
:
:
protobuf
:
:
Type
&
type
bool
is_list
)
;
~
ProtoElement
(
)
override
{
}
ProtoElement
*
pop
(
)
;
const
google
:
:
protobuf
:
:
Field
*
parent_field
(
)
const
{
return
parent_field_
;
}
const
google
:
:
protobuf
:
:
Type
&
type
(
)
const
{
return
type_
;
}
void
RegisterField
(
const
google
:
:
protobuf
:
:
Field
*
field
)
;
std
:
:
string
ToString
(
)
const
override
;
ProtoElement
*
parent
(
)
const
override
{
return
static_cast
<
ProtoElement
*
>
(
BaseElement
:
:
parent
(
)
)
;
}
bool
IsOneofIndexTaken
(
int32_t
index
)
;
void
TakeOneofIndex
(
int32_t
index
)
;
bool
proto3
(
)
{
return
proto3_
;
}
private
:
ProtoWriter
*
ow_
;
const
google
:
:
protobuf
:
:
Field
*
parent_field_
;
const
TypeInfo
*
typeinfo_
;
bool
proto3_
;
const
google
:
:
protobuf
:
:
Type
&
type_
;
std
:
:
unordered_set
<
const
google
:
:
protobuf
:
:
Field
*
>
required_fields_
;
const
int
size_index_
;
int
array_index_
;
std
:
:
vector
<
bool
>
oneof_indices_
;
GOOGLE_DISALLOW_IMPLICIT_CONSTRUCTORS
(
ProtoElement
)
;
}
;
struct
SizeInfo
{
const
int
pos
;
int
size
;
}
;
ProtoWriter
(
const
TypeInfo
*
typeinfo
const
google
:
:
protobuf
:
:
Type
&
type
strings
:
:
ByteSink
*
output
ErrorListener
*
listener
)
;
ProtoElement
*
element
(
)
override
{
return
element_
.
get
(
)
;
}
void
InvalidName
(
StringPiece
unknown_name
StringPiece
message
)
;
void
InvalidValue
(
StringPiece
type_name
StringPiece
value
)
;
void
MissingField
(
StringPiece
missing_name
)
;
const
google
:
:
protobuf
:
:
Field
*
BeginNamed
(
StringPiece
name
bool
is_list
)
;
const
google
:
:
protobuf
:
:
Field
*
Lookup
(
StringPiece
name
)
;
const
google
:
:
protobuf
:
:
Type
*
LookupType
(
const
google
:
:
protobuf
:
:
Field
*
field
)
;
void
WriteRootMessage
(
)
;
void
WriteTag
(
const
google
:
:
protobuf
:
:
Field
&
field
)
;
bool
ValidOneof
(
const
google
:
:
protobuf
:
:
Field
&
field
StringPiece
unnormalized_name
)
;
bool
IsRepeated
(
const
google
:
:
protobuf
:
:
Field
&
field
)
;
ProtoWriter
*
StartObjectField
(
const
google
:
:
protobuf
:
:
Field
&
field
const
google
:
:
protobuf
:
:
Type
&
type
)
;
ProtoWriter
*
StartListField
(
const
google
:
:
protobuf
:
:
Field
&
field
const
google
:
:
protobuf
:
:
Type
&
type
)
;
ProtoWriter
*
RenderPrimitiveField
(
const
google
:
:
protobuf
:
:
Field
&
field
const
google
:
:
protobuf
:
:
Type
&
type
const
DataPiece
&
data
)
;
private
:
static
util
:
:
Status
WriteEnum
(
int
field_number
const
DataPiece
&
data
const
google
:
:
protobuf
:
:
Enum
*
enum_type
io
:
:
CodedOutputStream
*
stream
bool
use_lower_camel_for_enums
bool
case_insensitive_enum_parsing
bool
ignore_unknown_values
)
;
const
google
:
:
protobuf
:
:
Type
&
master_type_
;
const
TypeInfo
*
typeinfo_
;
bool
own_typeinfo_
;
bool
done_
;
bool
ignore_unknown_fields_
;
bool
ignore_unknown_enum_values_
;
bool
use_lower_camel_for_enums_
;
bool
case_insensitive_enum_parsing_
;
bool
use_json_name_in_missing_fields_
;
std
:
:
unique_ptr
<
ProtoElement
>
element_
;
std
:
:
deque
<
SizeInfo
>
size_insert_
;
strings
:
:
ByteSink
*
output_
;
std
:
:
string
buffer_
;
io
:
:
StringOutputStream
adapter_
;
std
:
:
unique_ptr
<
io
:
:
CodedOutputStream
>
stream_
;
ErrorListener
*
listener_
;
int
invalid_depth_
;
std
:
:
unique_ptr
<
LocationTrackerInterface
>
tracker_
;
GOOGLE_DISALLOW_IMPLICIT_CONSTRUCTORS
(
ProtoWriter
)
;
}
;
}
}
}
}
#
include
<
google
/
protobuf
/
port_undef
.
inc
>
#
endif
