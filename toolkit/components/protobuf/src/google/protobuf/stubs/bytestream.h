#
ifndef
GOOGLE_PROTOBUF_STUBS_BYTESTREAM_H_
#
define
GOOGLE_PROTOBUF_STUBS_BYTESTREAM_H_
#
include
<
stddef
.
h
>
#
include
<
string
>
#
include
<
google
/
protobuf
/
stubs
/
common
.
h
>
#
include
<
google
/
protobuf
/
stubs
/
stringpiece
.
h
>
class
CordByteSink
;
class
MemBlock
;
namespace
google
{
namespace
protobuf
{
namespace
strings
{
class
LIBPROTOBUF_EXPORT
ByteSink
{
public
:
ByteSink
(
)
{
}
virtual
~
ByteSink
(
)
{
}
virtual
void
Append
(
const
char
*
bytes
size_t
n
)
=
0
;
virtual
void
Flush
(
)
;
private
:
GOOGLE_DISALLOW_EVIL_CONSTRUCTORS
(
ByteSink
)
;
}
;
class
LIBPROTOBUF_EXPORT
ByteSource
{
public
:
ByteSource
(
)
{
}
virtual
~
ByteSource
(
)
{
}
virtual
size_t
Available
(
)
const
=
0
;
virtual
StringPiece
Peek
(
)
=
0
;
virtual
void
Skip
(
size_t
n
)
=
0
;
virtual
void
CopyTo
(
ByteSink
*
sink
size_t
n
)
;
private
:
GOOGLE_DISALLOW_EVIL_CONSTRUCTORS
(
ByteSource
)
;
}
;
class
LIBPROTOBUF_EXPORT
UncheckedArrayByteSink
:
public
ByteSink
{
public
:
explicit
UncheckedArrayByteSink
(
char
*
dest
)
:
dest_
(
dest
)
{
}
virtual
void
Append
(
const
char
*
data
size_t
n
)
;
char
*
CurrentDestination
(
)
const
{
return
dest_
;
}
private
:
char
*
dest_
;
GOOGLE_DISALLOW_EVIL_CONSTRUCTORS
(
UncheckedArrayByteSink
)
;
}
;
class
LIBPROTOBUF_EXPORT
CheckedArrayByteSink
:
public
ByteSink
{
public
:
CheckedArrayByteSink
(
char
*
outbuf
size_t
capacity
)
;
virtual
void
Append
(
const
char
*
bytes
size_t
n
)
;
size_t
NumberOfBytesWritten
(
)
const
{
return
size_
;
}
bool
Overflowed
(
)
const
{
return
overflowed_
;
}
private
:
char
*
outbuf_
;
const
size_t
capacity_
;
size_t
size_
;
bool
overflowed_
;
GOOGLE_DISALLOW_EVIL_CONSTRUCTORS
(
CheckedArrayByteSink
)
;
}
;
class
LIBPROTOBUF_EXPORT
GrowingArrayByteSink
:
public
strings
:
:
ByteSink
{
public
:
explicit
GrowingArrayByteSink
(
size_t
estimated_size
)
;
virtual
~
GrowingArrayByteSink
(
)
;
virtual
void
Append
(
const
char
*
bytes
size_t
n
)
;
char
*
GetBuffer
(
size_t
*
nbytes
)
;
private
:
void
Expand
(
size_t
amount
)
;
void
ShrinkToFit
(
)
;
size_t
capacity_
;
char
*
buf_
;
size_t
size_
;
GOOGLE_DISALLOW_EVIL_CONSTRUCTORS
(
GrowingArrayByteSink
)
;
}
;
class
LIBPROTOBUF_EXPORT
StringByteSink
:
public
ByteSink
{
public
:
explicit
StringByteSink
(
string
*
dest
)
:
dest_
(
dest
)
{
}
virtual
void
Append
(
const
char
*
data
size_t
n
)
;
private
:
string
*
dest_
;
GOOGLE_DISALLOW_EVIL_CONSTRUCTORS
(
StringByteSink
)
;
}
;
class
LIBPROTOBUF_EXPORT
NullByteSink
:
public
ByteSink
{
public
:
NullByteSink
(
)
{
}
virtual
void
Append
(
const
char
*
data
size_t
n
)
{
}
private
:
GOOGLE_DISALLOW_EVIL_CONSTRUCTORS
(
NullByteSink
)
;
}
;
class
LIBPROTOBUF_EXPORT
ArrayByteSource
:
public
ByteSource
{
public
:
explicit
ArrayByteSource
(
StringPiece
s
)
:
input_
(
s
)
{
}
virtual
size_t
Available
(
)
const
;
virtual
StringPiece
Peek
(
)
;
virtual
void
Skip
(
size_t
n
)
;
private
:
StringPiece
input_
;
GOOGLE_DISALLOW_EVIL_CONSTRUCTORS
(
ArrayByteSource
)
;
}
;
class
LIBPROTOBUF_EXPORT
LimitByteSource
:
public
ByteSource
{
public
:
LimitByteSource
(
ByteSource
*
source
size_t
limit
)
;
virtual
size_t
Available
(
)
const
;
virtual
StringPiece
Peek
(
)
;
virtual
void
Skip
(
size_t
n
)
;
virtual
void
CopyTo
(
ByteSink
*
sink
size_t
n
)
;
private
:
ByteSource
*
source_
;
size_t
limit_
;
}
;
}
}
}
#
endif
