#
ifndef
GOOGLE_PROTOBUF_MESSAGE_LITE_H__
#
define
GOOGLE_PROTOBUF_MESSAGE_LITE_H__
#
include
<
climits
>
#
include
<
string
>
#
include
<
google
/
protobuf
/
stubs
/
common
.
h
>
#
include
<
google
/
protobuf
/
stubs
/
logging
.
h
>
#
include
<
google
/
protobuf
/
io
/
coded_stream
.
h
>
#
include
<
google
/
protobuf
/
arena
.
h
>
#
include
<
google
/
protobuf
/
stubs
/
once
.
h
>
#
include
<
google
/
protobuf
/
port
.
h
>
#
include
<
google
/
protobuf
/
stubs
/
strutil
.
h
>
#
include
<
google
/
protobuf
/
port_def
.
inc
>
#
ifdef
SWIG
#
error
"
You
cannot
SWIG
proto
headers
"
#
endif
namespace
google
{
namespace
protobuf
{
template
<
typename
T
>
class
RepeatedPtrField
;
namespace
io
{
class
CodedInputStream
;
class
CodedOutputStream
;
class
ZeroCopyInputStream
;
class
ZeroCopyOutputStream
;
}
namespace
internal
{
class
ParseContext
;
class
RepeatedPtrFieldBase
;
class
WireFormatLite
;
class
WeakFieldMap
;
inline
int
ToCachedSize
(
size_t
size
)
{
return
static_cast
<
int
>
(
size
)
;
}
inline
size_t
FromIntSize
(
int
size
)
{
return
static_cast
<
unsigned
int
>
(
size
)
;
}
inline
int
ToIntSize
(
size_t
size
)
{
GOOGLE_DCHECK_LE
(
size
static_cast
<
size_t
>
(
INT_MAX
)
)
;
return
static_cast
<
int
>
(
size
)
;
}
template
<
typename
T
>
class
ExplicitlyConstructed
{
public
:
void
DefaultConstruct
(
)
{
new
(
&
union_
)
T
(
)
;
}
template
<
typename
.
.
.
Args
>
void
Construct
(
Args
&
&
.
.
.
args
)
{
new
(
&
union_
)
T
(
std
:
:
forward
<
Args
>
(
args
)
.
.
.
)
;
}
void
Destruct
(
)
{
get_mutable
(
)
-
>
~
T
(
)
;
}
constexpr
const
T
&
get
(
)
const
{
return
reinterpret_cast
<
const
T
&
>
(
union_
)
;
}
T
*
get_mutable
(
)
{
return
reinterpret_cast
<
T
*
>
(
&
union_
)
;
}
private
:
union
AlignedUnion
{
char
space
[
sizeof
(
T
)
]
;
int64
align_to_int64
;
void
*
align_to_ptr
;
}
union_
;
}
;
PROTOBUF_EXPORT
extern
ExplicitlyConstructed
<
std
:
:
string
>
fixed_address_empty_string
;
PROTOBUF_EXPORT
inline
const
std
:
:
string
&
GetEmptyStringAlreadyInited
(
)
{
return
fixed_address_empty_string
.
get
(
)
;
}
PROTOBUF_EXPORT
size_t
StringSpaceUsedExcludingSelfLong
(
const
std
:
:
string
&
str
)
;
}
class
PROTOBUF_EXPORT
MessageLite
{
public
:
inline
MessageLite
(
)
{
}
virtual
~
MessageLite
(
)
{
}
virtual
std
:
:
string
GetTypeName
(
)
const
=
0
;
virtual
MessageLite
*
New
(
)
const
=
0
;
virtual
MessageLite
*
New
(
Arena
*
arena
)
const
;
virtual
Arena
*
GetArena
(
)
const
{
return
NULL
;
}
virtual
void
*
GetMaybeArenaPointer
(
)
const
{
return
GetArena
(
)
;
}
virtual
void
Clear
(
)
=
0
;
virtual
bool
IsInitialized
(
)
const
=
0
;
virtual
std
:
:
string
InitializationErrorString
(
)
const
;
virtual
void
CheckTypeAndMergeFrom
(
const
MessageLite
&
other
)
=
0
;
std
:
:
string
DebugString
(
)
const
;
std
:
:
string
ShortDebugString
(
)
const
{
return
DebugString
(
)
;
}
std
:
:
string
Utf8DebugString
(
)
const
{
return
DebugString
(
)
;
}
bool
ParseFromCodedStream
(
io
:
:
CodedInputStream
*
input
)
;
bool
ParsePartialFromCodedStream
(
io
:
:
CodedInputStream
*
input
)
;
bool
ParseFromZeroCopyStream
(
io
:
:
ZeroCopyInputStream
*
input
)
;
bool
ParsePartialFromZeroCopyStream
(
io
:
:
ZeroCopyInputStream
*
input
)
;
bool
ParseFromFileDescriptor
(
int
file_descriptor
)
;
bool
ParsePartialFromFileDescriptor
(
int
file_descriptor
)
;
bool
ParseFromIstream
(
std
:
:
istream
*
input
)
;
bool
ParsePartialFromIstream
(
std
:
:
istream
*
input
)
;
bool
MergePartialFromBoundedZeroCopyStream
(
io
:
:
ZeroCopyInputStream
*
input
int
size
)
;
bool
MergeFromBoundedZeroCopyStream
(
io
:
:
ZeroCopyInputStream
*
input
int
size
)
;
bool
ParseFromBoundedZeroCopyStream
(
io
:
:
ZeroCopyInputStream
*
input
int
size
)
;
bool
ParsePartialFromBoundedZeroCopyStream
(
io
:
:
ZeroCopyInputStream
*
input
int
size
)
;
bool
ParseFromString
(
const
std
:
:
string
&
data
)
;
bool
ParsePartialFromString
(
const
std
:
:
string
&
data
)
;
bool
ParseFromArray
(
const
void
*
data
int
size
)
;
bool
ParsePartialFromArray
(
const
void
*
data
int
size
)
;
bool
MergeFromCodedStream
(
io
:
:
CodedInputStream
*
input
)
;
bool
MergePartialFromCodedStream
(
io
:
:
CodedInputStream
*
input
)
;
bool
MergeFromString
(
const
std
:
:
string
&
data
)
;
bool
SerializeToCodedStream
(
io
:
:
CodedOutputStream
*
output
)
const
;
bool
SerializePartialToCodedStream
(
io
:
:
CodedOutputStream
*
output
)
const
;
bool
SerializeToZeroCopyStream
(
io
:
:
ZeroCopyOutputStream
*
output
)
const
;
bool
SerializePartialToZeroCopyStream
(
io
:
:
ZeroCopyOutputStream
*
output
)
const
;
bool
SerializeToString
(
std
:
:
string
*
output
)
const
;
bool
SerializePartialToString
(
std
:
:
string
*
output
)
const
;
bool
SerializeToArray
(
void
*
data
int
size
)
const
;
bool
SerializePartialToArray
(
void
*
data
int
size
)
const
;
std
:
:
string
SerializeAsString
(
)
const
;
std
:
:
string
SerializePartialAsString
(
)
const
;
bool
SerializeToFileDescriptor
(
int
file_descriptor
)
const
;
bool
SerializePartialToFileDescriptor
(
int
file_descriptor
)
const
;
bool
SerializeToOstream
(
std
:
:
ostream
*
output
)
const
;
bool
SerializePartialToOstream
(
std
:
:
ostream
*
output
)
const
;
bool
AppendToString
(
std
:
:
string
*
output
)
const
;
bool
AppendPartialToString
(
std
:
:
string
*
output
)
const
;
virtual
size_t
ByteSizeLong
(
)
const
=
0
;
PROTOBUF_DEPRECATED_MSG
(
"
Please
use
ByteSizeLong
(
)
instead
"
)
int
ByteSize
(
)
const
{
return
internal
:
:
ToIntSize
(
ByteSizeLong
(
)
)
;
}
void
SerializeWithCachedSizes
(
io
:
:
CodedOutputStream
*
output
)
const
{
output
-
>
SetCur
(
_InternalSerialize
(
output
-
>
Cur
(
)
output
-
>
EpsCopy
(
)
)
)
;
}
uint8
*
SerializeWithCachedSizesToArray
(
uint8
*
target
)
const
;
virtual
int
GetCachedSize
(
)
const
=
0
;
virtual
const
char
*
_InternalParse
(
const
char
*
internal
:
:
ParseContext
*
)
{
return
nullptr
;
}
protected
:
template
<
typename
T
>
static
T
*
CreateMaybeMessage
(
Arena
*
arena
)
{
return
Arena
:
:
CreateMaybeMessage
<
T
>
(
arena
)
;
}
public
:
enum
ParseFlags
{
kMerge
=
0
kParse
=
1
kMergePartial
=
2
kParsePartial
=
3
kMergeWithAliasing
=
4
kParseWithAliasing
=
5
kMergePartialWithAliasing
=
6
kParsePartialWithAliasing
=
7
}
;
template
<
ParseFlags
flags
typename
T
>
bool
ParseFrom
(
const
T
&
input
)
;
virtual
uint8
*
_InternalSerialize
(
uint8
*
ptr
io
:
:
EpsCopyOutputStream
*
stream
)
const
=
0
;
private
:
virtual
const
void
*
InternalGetTable
(
)
const
{
return
NULL
;
}
friend
class
internal
:
:
WireFormatLite
;
friend
class
Message
;
friend
class
internal
:
:
WeakFieldMap
;
bool
IsInitializedWithErrors
(
)
const
{
if
(
IsInitialized
(
)
)
return
true
;
LogInitializationErrorMessage
(
)
;
return
false
;
}
void
LogInitializationErrorMessage
(
)
const
;
GOOGLE_DISALLOW_EVIL_CONSTRUCTORS
(
MessageLite
)
;
}
;
namespace
internal
{
template
<
bool
alias
>
bool
MergePartialFromImpl
(
StringPiece
input
MessageLite
*
msg
)
;
extern
template
bool
MergePartialFromImpl
<
false
>
(
StringPiece
input
MessageLite
*
msg
)
;
extern
template
bool
MergePartialFromImpl
<
true
>
(
StringPiece
input
MessageLite
*
msg
)
;
template
<
bool
alias
>
bool
MergePartialFromImpl
(
io
:
:
ZeroCopyInputStream
*
input
MessageLite
*
msg
)
;
extern
template
bool
MergePartialFromImpl
<
false
>
(
io
:
:
ZeroCopyInputStream
*
input
MessageLite
*
msg
)
;
extern
template
bool
MergePartialFromImpl
<
true
>
(
io
:
:
ZeroCopyInputStream
*
input
MessageLite
*
msg
)
;
struct
BoundedZCIS
{
io
:
:
ZeroCopyInputStream
*
zcis
;
int
limit
;
}
;
template
<
bool
alias
>
bool
MergePartialFromImpl
(
BoundedZCIS
input
MessageLite
*
msg
)
;
extern
template
bool
MergePartialFromImpl
<
false
>
(
BoundedZCIS
input
MessageLite
*
msg
)
;
extern
template
bool
MergePartialFromImpl
<
true
>
(
BoundedZCIS
input
MessageLite
*
msg
)
;
template
<
typename
T
>
struct
SourceWrapper
;
template
<
bool
alias
typename
T
>
bool
MergePartialFromImpl
(
const
SourceWrapper
<
T
>
&
input
MessageLite
*
msg
)
{
return
input
.
template
MergePartialInto
<
alias
>
(
msg
)
;
}
}
template
<
MessageLite
:
:
ParseFlags
flags
typename
T
>
bool
MessageLite
:
:
ParseFrom
(
const
T
&
input
)
{
if
(
flags
&
kParse
)
Clear
(
)
;
constexpr
bool
alias
=
flags
&
kMergeWithAliasing
;
bool
res
=
internal
:
:
MergePartialFromImpl
<
alias
>
(
input
this
)
;
return
res
&
&
(
(
flags
&
kMergePartial
)
|
|
IsInitializedWithErrors
(
)
)
;
}
PROTOBUF_EXPORT
void
ShutdownProtobufLibrary
(
)
;
namespace
internal
{
PROTOBUF_EXPORT
void
OnShutdown
(
void
(
*
func
)
(
)
)
;
PROTOBUF_EXPORT
void
OnShutdownRun
(
void
(
*
f
)
(
const
void
*
)
const
void
*
arg
)
;
template
<
typename
T
>
T
*
OnShutdownDelete
(
T
*
p
)
{
OnShutdownRun
(
[
]
(
const
void
*
pp
)
{
delete
static_cast
<
const
T
*
>
(
pp
)
;
}
p
)
;
return
p
;
}
}
}
}
#
include
<
google
/
protobuf
/
port_undef
.
inc
>
#
endif
