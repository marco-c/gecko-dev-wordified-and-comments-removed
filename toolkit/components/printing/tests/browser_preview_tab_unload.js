"
use
strict
"
;
add_task
(
async
function
test_print_preview_cleanup_on_browser_discard
(
)
{
let
tab
=
await
BrowserTestUtils
.
openNewForegroundTab
(
gBrowser
PrintHelper
.
defaultTestPageUrl
)
;
let
browser
=
tab
.
linkedBrowser
;
let
helper
=
new
PrintHelper
(
browser
)
;
PrintUtils
.
startPrintWindow
(
browser
.
browsingContext
)
;
await
helper
.
waitForDialog
(
)
;
let
tabDialogBox
=
gBrowser
.
getTabDialogBox
(
browser
)
;
Assert
.
greater
(
tabDialogBox
.
_tabDialogManager
.
_dialogs
.
length
0
"
Should
have
open
dialogs
"
)
;
const
otherTab
=
await
BrowserTestUtils
.
openNewForegroundTab
(
gBrowser
PrintHelper
.
defaultTestPageUrl
)
;
await
gBrowser
.
explicitUnloadTabs
(
[
tab
]
)
;
await
BrowserTestUtils
.
switchTab
(
gBrowser
tab
)
;
tabDialogBox
=
gBrowser
.
getTabDialogBox
(
browser
)
;
is
(
tabDialogBox
.
_tabDialogManager
.
_dialogs
.
length
0
"
Should
have
no
open
dialogs
"
)
;
BrowserTestUtils
.
removeTab
(
tab
)
;
BrowserTestUtils
.
removeTab
(
otherTab
)
;
}
)
;
