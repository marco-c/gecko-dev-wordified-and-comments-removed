"
use
strict
"
;
let
badPrinterName
=
"
Bad
"
;
let
otherPrinterName
=
"
Fallback
"
;
async
function
setupPrinters
(
helper
)
{
let
badPrinter
=
helper
.
addMockPrinter
(
{
name
:
badPrinterName
}
)
;
let
badPrinterInfo
=
await
badPrinter
.
printerInfo
;
badPrinterInfo
.
defaultSettings
.
printerName
=
"
"
;
helper
.
addMockPrinter
(
otherPrinterName
)
;
await
SpecialPowers
.
pushPrefEnv
(
{
set
:
[
[
"
print_printer
"
badPrinterName
]
]
}
)
;
}
add_task
(
async
function
testBadPrinterSettings
(
)
{
await
PrintHelper
.
withTestPage
(
async
helper
=
>
{
await
setupPrinters
(
helper
)
;
await
helper
.
startPrint
(
)
;
let
destinationPicker
=
helper
.
get
(
"
printer
-
picker
"
)
;
isnot
(
destinationPicker
.
value
badPrinterName
"
A
fallback
printer
is
selected
"
)
;
await
helper
.
closeDialog
(
)
;
}
)
;
}
)
;
