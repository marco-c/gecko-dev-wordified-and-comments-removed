const
{
Subprocess
}
=
ChromeUtils
.
importESModule
(
"
resource
:
/
/
gre
/
modules
/
Subprocess
.
sys
.
mjs
"
)
;
async
function
execRemote
(
args
)
{
let
process
=
await
Subprocess
.
call
(
{
command
:
Services
.
dirsvc
.
get
(
"
XREExeF
"
Ci
.
nsIFile
)
.
path
arguments
:
[
"
-
-
profile
"
PathUtils
.
profileDir
.
.
.
args
]
}
)
;
let
{
exitCode
}
=
await
process
.
wait
(
)
;
Assert
.
equal
(
exitCode
0
"
Should
have
exited
normally
"
)
;
}
add_task
(
async
function
test
(
)
{
let
newTabOpened
=
BrowserTestUtils
.
waitForNewTab
(
gBrowser
"
https
:
/
/
example
.
org
/
"
true
)
;
await
execRemote
(
[
"
https
:
/
/
example
.
org
/
"
]
)
;
Assert
.
ok
(
true
"
Successfully
sent
remote
message
"
)
;
let
newTab
=
await
newTabOpened
;
BrowserTestUtils
.
removeTab
(
newTab
)
;
let
newWinOpened
=
BrowserTestUtils
.
waitForNewWindow
(
)
;
await
execRemote
(
[
]
)
;
Assert
.
ok
(
true
"
Successfully
sent
remote
message
"
)
;
let
newWindow
=
await
newWinOpened
;
await
BrowserTestUtils
.
closeWindow
(
newWindow
)
;
}
)
;
