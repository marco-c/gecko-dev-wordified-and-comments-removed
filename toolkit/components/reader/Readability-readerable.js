var
REGEXPS
=
{
unlikelyCandidates
:
/
-
ad
-
|
ai2html
|
banner
|
breadcrumbs
|
combx
|
comment
|
community
|
cover
-
wrap
|
disqus
|
extra
|
footer
|
gdpr
|
header
|
legends
|
menu
|
related
|
remark
|
replies
|
rss
|
shoutbox
|
sidebar
|
skyscraper
|
social
|
sponsor
|
supplemental
|
ad
-
break
|
agegate
|
pagination
|
pager
|
popup
|
yom
-
remote
/
i
okMaybeItsACandidate
:
/
and
|
article
|
body
|
column
|
content
|
main
|
shadow
/
i
}
;
function
isNodeVisible
(
node
)
{
return
(
!
node
.
style
|
|
node
.
style
.
display
!
=
"
none
"
)
&
&
!
node
.
hasAttribute
(
"
hidden
"
)
&
&
(
!
node
.
hasAttribute
(
"
aria
-
hidden
"
)
|
|
node
.
getAttribute
(
"
aria
-
hidden
"
)
!
=
"
true
"
|
|
(
node
.
className
&
&
node
.
className
.
indexOf
&
&
node
.
className
.
indexOf
(
"
fallback
-
image
"
)
!
=
=
-
1
)
)
;
}
function
isProbablyReaderable
(
doc
isVisible
)
{
if
(
!
isVisible
)
{
isVisible
=
isNodeVisible
;
}
var
nodes
=
doc
.
querySelectorAll
(
"
p
pre
"
)
;
var
brNodes
=
doc
.
querySelectorAll
(
"
div
>
br
"
)
;
if
(
brNodes
.
length
)
{
var
set
=
new
Set
(
nodes
)
;
[
]
.
forEach
.
call
(
brNodes
function
(
node
)
{
set
.
add
(
node
.
parentNode
)
;
}
)
;
nodes
=
Array
.
from
(
set
)
;
}
var
score
=
0
;
return
[
]
.
some
.
call
(
nodes
function
(
node
)
{
if
(
!
isVisible
(
node
)
)
return
false
;
var
matchString
=
node
.
className
+
"
"
+
node
.
id
;
if
(
REGEXPS
.
unlikelyCandidates
.
test
(
matchString
)
&
&
!
REGEXPS
.
okMaybeItsACandidate
.
test
(
matchString
)
)
{
return
false
;
}
if
(
node
.
matches
(
"
li
p
"
)
)
{
return
false
;
}
var
textContentLength
=
node
.
textContent
.
trim
(
)
.
length
;
if
(
textContentLength
<
140
)
{
return
false
;
}
score
+
=
Math
.
sqrt
(
textContentLength
-
140
)
;
if
(
score
>
20
)
{
return
true
;
}
return
false
;
}
)
;
}
if
(
typeof
module
=
=
=
"
object
"
)
{
module
.
exports
=
isProbablyReaderable
;
}
