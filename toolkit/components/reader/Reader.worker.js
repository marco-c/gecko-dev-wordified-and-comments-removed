"
use
strict
"
;
importScripts
(
"
resource
:
/
/
gre
/
modules
/
workers
/
require
.
js
"
"
moz
-
src
:
/
/
/
toolkit
/
components
/
reader
/
readability
/
JSDOMParser
.
js
"
"
moz
-
src
:
/
/
/
toolkit
/
components
/
reader
/
readability
/
Readability
.
js
"
)
;
var
PromiseWorker
=
require
(
"
resource
:
/
/
gre
/
modules
/
workers
/
PromiseWorker
.
js
"
)
;
const
DEBUG
=
false
;
var
worker
=
new
PromiseWorker
.
AbstractWorker
(
)
;
worker
.
dispatch
=
function
(
method
args
=
[
]
)
{
return
Agent
[
method
]
(
.
.
.
args
)
;
}
;
worker
.
postMessage
=
function
(
result
.
.
.
transfers
)
{
self
.
postMessage
(
result
.
.
.
transfers
)
;
}
;
worker
.
close
=
function
(
)
{
self
.
close
(
)
;
}
;
worker
.
log
=
function
(
.
.
.
args
)
{
if
(
DEBUG
)
{
dump
(
"
ReaderWorker
:
"
+
args
.
join
(
"
"
)
+
"
\
n
"
)
;
}
}
;
self
.
addEventListener
(
"
message
"
msg
=
>
worker
.
handleMessage
(
msg
)
)
;
self
.
addEventListener
(
"
unhandledrejection
"
function
(
error
)
{
throw
error
.
reason
;
}
)
;
var
Agent
=
{
parseDocument
(
uri
serializedDoc
options
)
{
let
doc
=
new
JSDOMParser
(
)
.
parse
(
serializedDoc
uri
.
spec
)
;
return
new
Readability
(
doc
options
)
.
parse
(
)
;
}
}
;
