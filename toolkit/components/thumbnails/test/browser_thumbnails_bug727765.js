const
URL
=
"
http
:
/
/
mochi
.
test
:
8888
/
browser
/
toolkit
/
components
/
thumbnails
/
"
+
"
test
/
background_red_scroll
.
html
"
;
function
isRedThumbnailFuzz
(
r
g
b
expectedR
expectedB
expectedG
aFuzz
)
{
return
(
Math
.
abs
(
r
-
expectedR
)
<
=
aFuzz
&
&
Math
.
abs
(
g
-
expectedG
)
<
=
aFuzz
&
&
Math
.
abs
(
b
-
expectedB
)
<
=
aFuzz
)
;
}
function
*
runTests
(
)
{
yield
addTab
(
URL
)
;
yield
captureAndCheckColor
(
255
0
0
"
we
have
a
red
thumbnail
"
)
;
yield
whenFileExists
(
URL
)
;
yield
retrieveImageDataForURL
(
URL
function
(
aData
)
{
let
[
r
g
b
]
=
[
]
.
slice
.
call
(
aData
-
4
)
;
let
fuzz
=
2
;
var
message
=
"
Expected
red
thumbnail
rgb
(
255
0
0
)
got
"
+
r
+
"
"
+
g
+
"
"
+
b
;
ok
(
isRedThumbnailFuzz
(
r
g
b
255
0
0
fuzz
)
message
)
;
next
(
)
;
}
)
;
}
