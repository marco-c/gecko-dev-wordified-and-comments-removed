add_task
(
async
function
thumbnails_bg_no_cookies_stored
(
)
{
await
SpecialPowers
.
pushPrefEnv
(
{
set
:
[
[
"
privacy
.
usercontext
.
about_newtab_segregation
.
enabled
"
true
]
]
}
)
;
let
url
=
bgTestPageURL
(
{
setRedCookie
:
true
iframe
:
bgTestPageURL
(
{
setRedCookie
:
true
}
)
xhr
:
bgTestPageURL
(
{
setRedCookie
:
true
}
)
}
)
;
ok
(
!
thumbnailExists
(
url
)
"
Thumbnail
file
should
not
exist
before
capture
.
"
)
;
await
bgCapture
(
url
)
;
ok
(
thumbnailExists
(
url
)
"
Thumbnail
file
should
exist
after
capture
.
"
)
;
removeThumbnail
(
url
)
;
await
BrowserTestUtils
.
withNewTab
(
{
gBrowser
url
}
async
browser
=
>
{
await
SpecialPowers
.
spawn
(
browser
[
]
function
(
)
{
Assert
.
notEqual
(
content
.
document
.
documentElement
.
style
.
backgroundColor
"
rgb
(
255
0
0
)
"
"
The
page
shouldn
'
t
be
red
.
"
)
;
}
)
;
}
)
;
}
)
;
