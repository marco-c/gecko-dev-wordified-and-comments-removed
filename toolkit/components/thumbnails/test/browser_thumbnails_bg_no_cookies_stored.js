function
*
runTests
(
)
{
yield
SpecialPowers
.
pushPrefEnv
(
{
set
:
[
[
"
privacy
.
about_newtab_segragation
.
enabled
"
true
]
]
}
)
;
let
url
=
bgTestPageURL
(
{
setRedCookie
:
true
iframe
:
bgTestPageURL
(
{
setRedCookie
:
true
}
)
xhr
:
bgTestPageURL
(
{
setRedCookie
:
true
}
)
}
)
;
ok
(
!
thumbnailExists
(
url
)
"
Thumbnail
file
should
not
exist
before
capture
.
"
)
;
yield
bgCapture
(
url
)
;
ok
(
thumbnailExists
(
url
)
"
Thumbnail
file
should
exist
after
capture
.
"
)
;
removeThumbnail
(
url
)
;
let
tab
=
yield
BrowserTestUtils
.
openNewForegroundTab
(
gBrowser
url
)
;
let
browser
=
tab
.
linkedBrowser
;
yield
ContentTask
.
spawn
(
browser
null
function
(
)
{
Assert
.
notEqual
(
content
.
document
.
documentElement
.
style
.
backgroundColor
"
rgb
(
255
0
0
)
"
"
The
page
shouldn
'
t
be
red
.
"
)
;
}
)
;
gBrowser
.
removeTab
(
tab
)
;
}
