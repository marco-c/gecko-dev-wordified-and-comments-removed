add_task
(
async
function
thumbnails_bg_no_cookies_sent
(
)
{
let
url
=
bgTestPageURL
(
{
setGreenCookie
:
true
}
)
;
await
BrowserTestUtils
.
withNewTab
(
{
gBrowser
url
}
async
browser
=
>
{
await
SpecialPowers
.
spawn
(
browser
[
]
function
(
)
{
Assert
.
notEqual
(
content
.
document
.
documentElement
.
style
.
backgroundColor
"
rgb
(
0
255
0
)
"
"
The
page
shouldn
'
t
be
green
yet
.
"
)
;
}
)
;
browser
.
reload
(
)
;
await
BrowserTestUtils
.
browserLoaded
(
browser
)
;
await
SpecialPowers
.
spawn
(
browser
[
]
function
(
)
{
Assert
.
equal
(
content
.
document
.
documentElement
.
style
.
backgroundColor
"
rgb
(
0
255
0
)
"
"
The
page
should
be
green
now
.
"
)
;
}
)
;
await
bgCapture
(
url
)
;
ok
(
thumbnailExists
(
url
)
"
Thumbnail
file
should
exist
after
capture
.
"
)
;
let
[
r
g
b
]
=
await
retrieveImageDataForURL
(
url
)
;
isnot
(
[
r
g
b
]
.
toString
(
)
[
0
255
0
]
.
toString
(
)
"
The
captured
page
should
not
be
green
.
"
)
;
removeThumbnail
(
url
)
;
}
)
;
}
)
;
