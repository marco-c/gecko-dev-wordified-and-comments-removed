function
*
runTests
(
)
{
let
url
=
bgTestPageURL
(
{
setGreenCookie
:
true
}
)
;
let
tab
=
yield
BrowserTestUtils
.
openNewForegroundTab
(
gBrowser
url
)
;
let
browser
=
tab
.
linkedBrowser
;
yield
ContentTask
.
spawn
(
browser
null
function
(
)
{
Assert
.
notEqual
(
content
.
document
.
documentElement
.
style
.
backgroundColor
"
rgb
(
0
255
0
)
"
"
The
page
shouldn
'
t
be
green
yet
.
"
)
;
}
)
;
browser
.
reload
(
)
;
yield
BrowserTestUtils
.
browserLoaded
(
browser
)
;
yield
ContentTask
.
spawn
(
browser
null
function
(
)
{
Assert
.
equal
(
content
.
document
.
documentElement
.
style
.
backgroundColor
"
rgb
(
0
255
0
)
"
"
The
page
should
be
green
now
.
"
)
;
}
)
;
yield
bgCapture
(
url
)
;
ok
(
thumbnailExists
(
url
)
"
Thumbnail
file
should
exist
after
capture
.
"
)
;
retrieveImageDataForURL
(
url
function
(
[
r
g
b
]
)
{
isnot
(
[
r
g
b
]
.
toString
(
)
[
0
255
0
]
.
toString
(
)
"
The
captured
page
should
not
be
green
.
"
)
;
gBrowser
.
removeTab
(
tab
)
;
removeThumbnail
(
url
)
;
next
(
)
;
}
)
;
yield
true
;
}
