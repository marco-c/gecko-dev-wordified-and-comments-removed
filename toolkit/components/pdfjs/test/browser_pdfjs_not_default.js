add_task
(
async
function
test_pdfjs_not_default
(
)
{
var
oldAction
=
changeMimeHandler
(
Ci
.
nsIHandlerInfo
.
useSystemDefault
true
)
;
let
dirFileObj
=
getChromeDir
(
getResolvedURI
(
gTestPath
)
)
;
dirFileObj
.
append
(
"
file_pdfjs_test
.
pdf
"
)
;
let
tab
=
await
BrowserTestUtils
.
openNewForegroundTab
(
gBrowser
dirFileObj
.
path
)
;
await
getPdfjsActor
(
)
;
changeMimeHandler
(
oldAction
[
0
]
oldAction
[
1
]
)
;
await
waitForPdfJSClose
(
tab
.
linkedBrowser
true
)
;
}
)
;
function
getPdfjsActor
(
)
{
let
win
=
Services
.
wm
.
getMostRecentWindow
(
"
navigator
:
browser
"
)
;
let
selectedBrowser
=
win
.
gBrowser
.
selectedBrowser
;
return
selectedBrowser
.
browsingContext
.
currentWindowGlobal
.
getActor
(
"
Pdfjs
"
)
;
}
