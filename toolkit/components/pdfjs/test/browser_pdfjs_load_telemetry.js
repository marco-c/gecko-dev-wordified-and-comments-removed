const
RELATIVE_DIR
=
"
toolkit
/
components
/
pdfjs
/
test
/
"
;
const
TESTROOT
=
"
https
:
/
/
example
.
com
/
browser
/
"
+
RELATIVE_DIR
;
add_task
(
async
function
test
(
)
{
let
mimeService
=
Cc
[
"
mozilla
.
org
/
mime
;
1
"
]
.
getService
(
Ci
.
nsIMIMEService
)
;
let
handlerInfo
=
mimeService
.
getFromTypeAndExtension
(
"
application
/
pdf
"
"
pdf
"
)
;
is
(
handlerInfo
.
alwaysAskBeforeHandling
false
"
pdf
handler
defaults
to
always
-
ask
is
false
"
)
;
is
(
handlerInfo
.
preferredAction
Ci
.
nsIHandlerInfo
.
handleInternally
"
pdf
handler
defaults
to
internal
"
)
;
info
(
"
Pref
action
:
"
+
handlerInfo
.
preferredAction
)
;
await
BrowserTestUtils
.
withNewTab
(
{
gBrowser
url
:
"
about
:
blank
"
}
async
function
(
browser
)
{
Services
.
fog
.
testResetFOG
(
)
;
await
Services
.
fog
.
testFlushAllChildren
(
)
;
Assert
.
equal
(
Glean
.
pdfjs
.
timeToView
.
testGetValue
(
)
undefined
)
;
Assert
.
equal
(
Glean
.
pdfjs
.
used
.
testGetValue
(
)
|
|
0
0
)
;
await
waitForPdfJS
(
browser
TESTROOT
+
"
file_pdfjs_test
.
pdf
"
)
;
await
Services
.
fog
.
testFlushAllChildren
(
)
;
Assert
.
notStrictEqual
(
Glean
.
pdfjs
.
timeToView
.
testGetValue
(
)
.
sum
0
)
;
Assert
.
equal
(
Glean
.
pdfjs
.
used
.
testGetValue
(
)
1
)
;
await
waitForPdfJSClose
(
browser
)
;
}
)
;
}
)
;
