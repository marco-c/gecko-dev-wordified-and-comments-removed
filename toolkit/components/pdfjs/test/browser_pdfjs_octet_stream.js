"
use
strict
"
;
const
TESTROOT
=
getRootDirectory
(
gTestPath
)
.
replace
(
"
chrome
:
/
/
mochitests
/
content
/
"
"
http
:
/
/
mochi
.
test
:
8888
/
"
)
;
add_task
(
async
function
test_octet_stream_opens_pdfjs
(
)
{
await
SpecialPowers
.
pushPrefEnv
(
{
set
:
[
[
"
pdfjs
.
handleOctetStream
"
true
]
]
}
)
;
let
pdfURL
=
TESTROOT
+
"
file_pdfjs_object_stream
.
pdf
"
;
let
mimeService
=
Cc
[
"
mozilla
.
org
/
mime
;
1
"
]
.
getService
(
Ci
.
nsIMIMEService
)
;
let
handlerInfo
=
mimeService
.
getFromTypeAndExtension
(
"
application
/
pdf
"
"
pdf
"
)
;
is
(
handlerInfo
.
alwaysAskBeforeHandling
false
"
pdf
handler
defaults
to
always
-
ask
is
false
"
)
;
is
(
handlerInfo
.
preferredAction
Ci
.
nsIHandlerInfo
.
handleInternally
"
pdf
handler
defaults
to
internal
"
)
;
await
BrowserTestUtils
.
withNewTab
(
{
gBrowser
url
:
"
about
:
blank
"
}
async
function
(
newTabBrowser
)
{
await
waitForPdfJS
(
newTabBrowser
pdfURL
)
;
is
(
newTabBrowser
.
currentURI
.
spec
pdfURL
"
Should
load
pdfjs
"
)
;
}
)
;
}
)
;
