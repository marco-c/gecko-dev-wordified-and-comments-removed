#
include
"
updaterfileutils_osx
.
h
"
#
include
<
Cocoa
/
Cocoa
.
h
>
bool
IsRecursivelyWritable
(
const
char
*
aPath
)
{
NSAutoreleasePool
*
pool
=
[
[
NSAutoreleasePool
alloc
]
init
]
;
NSString
*
rootPath
=
[
NSString
stringWithUTF8String
:
aPath
]
;
NSFileManager
*
fileManager
=
[
NSFileManager
defaultManager
]
;
NSError
*
error
=
nil
;
NSArray
*
subPaths
=
[
fileManager
subpathsOfDirectoryAtPath
:
rootPath
error
:
&
error
]
;
NSMutableArray
*
paths
=
[
NSMutableArray
arrayWithCapacity
:
[
subPaths
count
]
+
1
]
;
[
paths
addObject
:
"
"
]
;
[
paths
addObjectsFromArray
:
subPaths
]
;
if
(
error
)
{
[
pool
drain
]
;
return
false
;
}
for
(
NSString
*
currPath
in
paths
)
{
NSString
*
child
=
[
rootPath
stringByAppendingPathComponent
:
currPath
]
;
NSDictionary
*
attributes
=
[
fileManager
attributesOfItemAtPath
:
child
error
:
&
error
]
;
if
(
error
)
{
[
pool
drain
]
;
return
false
;
}
if
(
[
attributes
fileType
]
!
=
NSFileTypeSymbolicLink
&
&
[
fileManager
isWritableFileAtPath
:
child
]
=
=
NO
)
{
[
pool
drain
]
;
return
false
;
}
}
[
pool
drain
]
;
return
true
;
}
