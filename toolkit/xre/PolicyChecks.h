#
ifndef
mozilla_PolicyChecks_h
#
define
mozilla_PolicyChecks_h
#
if
defined
(
XP_WIN
)
#
include
<
windows
.
h
>
#
include
"
mozilla
/
Maybe
.
h
"
#
define
POLICY_REGKEY_NAME
L
"
SOFTWARE
\
\
Policies
\
\
Mozilla
\
\
"
MOZ_APP_BASENAME
namespace
mozilla
{
inline
Maybe
<
bool
>
PolicyHasRegValueOfOne
(
HKEY
aKey
LPCWSTR
aName
)
{
{
DWORD
len
=
sizeof
(
DWORD
)
;
DWORD
value
;
LONG
ret
=
:
:
RegGetValueW
(
aKey
POLICY_REGKEY_NAME
aName
RRF_RT_DWORD
nullptr
&
value
&
len
)
;
if
(
ret
=
=
ERROR_SUCCESS
)
{
return
Some
(
value
=
=
1
)
;
}
}
{
ULONGLONG
value
;
DWORD
len
=
sizeof
(
ULONGLONG
)
;
LONG
ret
=
:
:
RegGetValueW
(
aKey
POLICY_REGKEY_NAME
aName
RRF_RT_QWORD
nullptr
&
value
&
len
)
;
if
(
ret
=
=
ERROR_SUCCESS
)
{
return
Some
(
value
=
=
1
)
;
}
}
return
Nothing
(
)
;
}
inline
bool
PolicyCheckBoolean
(
LPCWSTR
aPolicyName
)
{
Maybe
<
bool
>
localMachineResult
=
PolicyHasRegValueOfOne
(
HKEY_LOCAL_MACHINE
aPolicyName
)
;
if
(
localMachineResult
.
isSome
(
)
)
{
return
localMachineResult
.
value
(
)
;
}
Maybe
<
bool
>
currentUserResult
=
PolicyHasRegValueOfOne
(
HKEY_CURRENT_USER
aPolicyName
)
;
if
(
currentUserResult
.
isSome
(
)
)
{
return
currentUserResult
.
value
(
)
;
}
return
false
;
}
}
#
endif
#
endif
