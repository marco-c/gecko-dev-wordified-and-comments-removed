#
include
"
nsNativeAppSupportBase
.
h
"
#
include
"
nsNativeAppSupportWin
.
h
"
#
include
"
mozilla
/
CmdLineAndEnvUtils
.
h
"
#
include
"
mozilla
/
WindowsConsole
.
h
"
using
namespace
mozilla
;
class
nsNativeAppSupportWin
:
public
nsNativeAppSupportBase
{
public
:
void
CheckConsole
(
)
;
private
:
~
nsNativeAppSupportWin
(
)
{
}
}
;
void
nsNativeAppSupportWin
:
:
CheckConsole
(
)
{
if
(
CheckArg
(
gArgc
gArgv
"
attach
-
console
"
)
=
=
ARG_FOUND
)
{
UseParentConsole
(
)
;
}
if
(
CheckArg
(
gArgc
gArgv
"
console
"
)
=
=
ARG_FOUND
)
{
if
(
AllocConsole
(
)
)
{
if
(
_fileno
(
stdout
)
=
=
-
2
)
{
freopen
(
"
CONOUT
"
"
w
"
stdout
)
;
}
if
(
_fileno
(
stderr
)
=
=
-
2
)
{
freopen
(
"
CONOUT
"
"
w
"
stderr
)
;
}
if
(
_fileno
(
stdin
)
=
=
-
2
)
{
freopen
(
"
CONIN
"
"
r
"
stdin
)
;
}
}
}
}
nsresult
NS_CreateNativeAppSupport
(
nsINativeAppSupport
*
*
aResult
)
{
nsNativeAppSupportWin
*
pNative
=
new
nsNativeAppSupportWin
;
if
(
!
pNative
)
return
NS_ERROR_OUT_OF_MEMORY
;
pNative
-
>
CheckConsole
(
)
;
*
aResult
=
pNative
;
NS_ADDREF
(
*
aResult
)
;
return
NS_OK
;
}
