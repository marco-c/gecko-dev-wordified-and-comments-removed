#
ifndef
_nsXREDirProvider_h__
#
define
_nsXREDirProvider_h__
#
include
"
nsIDirectoryService
.
h
"
#
include
"
nsIProfileMigrator
.
h
"
#
include
"
nsIFile
.
h
"
#
include
"
nsIXREDirProvider
.
h
"
#
include
"
nsCOMPtr
.
h
"
#
include
"
nsCOMArray
.
h
"
#
include
"
mozilla
/
Attributes
.
h
"
#
define
NS_XREDIRPROVIDER_CID
\
{
\
0x5573967d
0xf6cf
0x4c63
{
\
0x8e
0x0e
0x9a
0xc0
0x6e
0x04
0xd6
0x2b
\
}
\
}
#
define
NS_XREDIRPROVIDER_CONTRACTID
"
mozilla
.
org
/
xre
/
directory
-
provider
;
1
"
class
nsXREDirProvider
final
:
public
nsIDirectoryServiceProvider2
public
nsIXREDirProvider
public
nsIProfileStartup
{
public
:
NS_IMETHOD
QueryInterface
(
REFNSIID
aIID
void
*
*
aInstancePtr
)
override
;
NS_IMETHOD_
(
MozExternalRefCountType
)
AddRef
(
void
)
override
;
NS_IMETHOD_
(
MozExternalRefCountType
)
Release
(
void
)
override
;
NS_DECL_NSIDIRECTORYSERVICEPROVIDER
NS_DECL_NSIDIRECTORYSERVICEPROVIDER2
NS_DECL_NSIXREDIRPROVIDER
NS_DECL_NSIPROFILESTARTUP
nsXREDirProvider
(
)
;
nsresult
Initialize
(
nsIFile
*
aXULAppDir
nsIFile
*
aGREDir
nsIDirectoryServiceProvider
*
aAppProvider
=
nullptr
)
;
~
nsXREDirProvider
(
)
;
static
already_AddRefed
<
nsXREDirProvider
>
GetSingleton
(
)
;
nsresult
GetUserProfilesRootDir
(
nsIFile
*
*
aResult
)
;
nsresult
GetUserProfilesLocalDir
(
nsIFile
*
*
aResult
)
;
nsresult
GetLegacyInstallHash
(
nsAString
&
aPathHash
)
;
nsresult
SetProfile
(
nsIFile
*
aProfileDir
nsIFile
*
aProfileLocalDir
)
;
void
InitializeUserPrefs
(
)
;
void
DoShutdown
(
)
;
static
nsresult
GetUserAppDataDirectory
(
nsIFile
*
*
aFile
)
{
return
GetUserDataDirectory
(
aFile
false
)
;
}
static
nsresult
GetUserLocalDataDirectory
(
nsIFile
*
*
aFile
)
{
return
GetUserDataDirectory
(
aFile
true
)
;
}
static
nsresult
GetUserDataDirectory
(
nsIFile
*
*
aFile
bool
aLocal
)
;
nsIFile
*
GetGREDir
(
)
{
return
mGREDir
;
}
nsIFile
*
GetGREBinDir
(
)
{
return
mGREBinDir
;
}
nsIFile
*
GetAppDir
(
)
{
if
(
mXULAppDir
)
return
mXULAppDir
;
return
mGREDir
;
}
nsresult
GetUpdateRootDir
(
nsIFile
*
*
aResult
bool
aGetOldLocation
=
false
)
;
nsresult
GetProfileStartupDir
(
nsIFile
*
*
aResult
)
;
nsresult
GetProfileDir
(
nsIFile
*
*
aResult
)
;
protected
:
nsresult
GetFilesInternal
(
const
char
*
aProperty
nsISimpleEnumerator
*
*
aResult
)
;
static
nsresult
GetUserDataDirectoryHome
(
nsIFile
*
*
aFile
bool
aLocal
)
;
static
nsresult
GetSysUserExtensionsDirectory
(
nsIFile
*
*
aFile
)
;
static
nsresult
GetSysUserExtensionsDevDirectory
(
nsIFile
*
*
aFile
)
;
#
if
defined
(
XP_UNIX
)
|
|
defined
(
XP_MACOSX
)
static
nsresult
GetSystemExtensionsDirectory
(
nsIFile
*
*
aFile
)
;
#
endif
static
nsresult
EnsureDirectoryExists
(
nsIFile
*
aDirectory
)
;
static
nsresult
AppendProfilePath
(
nsIFile
*
aFile
bool
aLocal
)
;
static
nsresult
AppendSysUserExtensionPath
(
nsIFile
*
aFile
)
;
static
nsresult
AppendSysUserExtensionsDevPath
(
nsIFile
*
aFile
)
;
static
inline
nsresult
AppendProfileString
(
nsIFile
*
aFile
const
char
*
aPath
)
;
#
if
defined
(
MOZ_SANDBOX
)
nsresult
LoadContentProcessTempDir
(
)
;
nsresult
LoadPluginProcessTempDir
(
)
;
#
endif
void
Append
(
nsIFile
*
aDirectory
)
;
nsCOMPtr
<
nsIDirectoryServiceProvider
>
mAppProvider
;
nsCOMPtr
<
nsIFile
>
mGREDir
;
nsCOMPtr
<
nsIFile
>
mGREBinDir
;
nsCOMPtr
<
nsIFile
>
mXULAppDir
;
nsCOMPtr
<
nsIFile
>
mProfileDir
;
nsCOMPtr
<
nsIFile
>
mProfileLocalDir
;
bool
mProfileNotified
;
bool
mPrefsInitialized
=
false
;
#
if
defined
(
MOZ_SANDBOX
)
nsCOMPtr
<
nsIFile
>
mContentTempDir
;
nsCOMPtr
<
nsIFile
>
mContentProcessSandboxTempDir
;
nsCOMPtr
<
nsIFile
>
mPluginTempDir
;
nsCOMPtr
<
nsIFile
>
mPluginProcessSandboxTempDir
;
#
endif
nsCOMArray
<
nsIFile
>
mAppBundleDirectories
;
private
:
static
nsresult
SetUserDataProfileDirectory
(
nsCOMPtr
<
nsIFile
>
&
aFile
bool
aLocal
)
;
}
;
#
endif
