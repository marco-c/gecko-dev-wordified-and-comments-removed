#
ifndef
mozilla_Bootstrap_h
#
define
mozilla_Bootstrap_h
#
include
"
mozilla
/
UniquePtr
.
h
"
#
include
"
nscore
.
h
"
#
include
"
nsXULAppAPI
.
h
"
#
ifdef
MOZ_WIDGET_ANDROID
#
include
"
jni
.
h
"
namespace
mozilla
{
struct
StaticXREAppData
;
}
extern
"
C
"
NS_EXPORT
void
GeckoStart
(
JNIEnv
*
aEnv
char
*
*
argv
int
argc
const
mozilla
:
:
StaticXREAppData
&
aAppData
)
;
#
endif
#
if
defined
(
XP_WIN
)
&
&
defined
(
MOZ_SANDBOX
)
namespace
sandbox
{
class
BrokerServices
;
}
#
endif
namespace
mozilla
{
struct
StaticXREAppData
;
#
if
defined
(
XP_WIN
)
&
&
defined
(
MOZ_SANDBOX
)
namespace
sandboxing
{
class
PermissionsService
;
}
#
endif
struct
BootstrapConfig
{
#
if
defined
(
XP_WIN
)
&
&
defined
(
MOZ_SANDBOX
)
sandbox
:
:
BrokerServices
*
sandboxBrokerServices
;
sandboxing
:
:
PermissionsService
*
sandboxPermissionsService
;
#
endif
const
StaticXREAppData
*
appData
;
const
char
*
appDataPath
;
}
;
class
Bootstrap
{
protected
:
Bootstrap
(
)
{
}
virtual
~
Bootstrap
(
)
{
}
virtual
void
Dispose
(
)
=
0
;
class
BootstrapDelete
{
public
:
constexpr
BootstrapDelete
(
)
{
}
void
operator
(
)
(
Bootstrap
*
aPtr
)
const
{
aPtr
-
>
Dispose
(
)
;
}
}
;
public
:
typedef
mozilla
:
:
UniquePtr
<
Bootstrap
BootstrapDelete
>
UniquePtr
;
virtual
void
NS_LogInit
(
)
=
0
;
virtual
void
NS_LogTerm
(
)
=
0
;
virtual
void
XRE_TelemetryAccumulate
(
int
aID
uint32_t
aSample
)
=
0
;
virtual
void
XRE_StartupTimelineRecord
(
int
aEvent
mozilla
:
:
TimeStamp
aWhen
)
=
0
;
virtual
int
XRE_main
(
int
argc
char
*
argv
[
]
const
BootstrapConfig
&
aConfig
)
=
0
;
virtual
void
XRE_StopLateWriteChecks
(
)
=
0
;
virtual
int
XRE_XPCShellMain
(
int
argc
char
*
*
argv
char
*
*
envp
const
XREShellData
*
aShellData
)
=
0
;
virtual
GeckoProcessType
XRE_GetProcessType
(
)
=
0
;
virtual
void
XRE_SetProcessType
(
const
char
*
aProcessTypeString
)
=
0
;
virtual
nsresult
XRE_InitChildProcess
(
int
argc
char
*
argv
[
]
const
XREChildData
*
aChildData
)
=
0
;
virtual
void
XRE_EnableSameExecutableForContentProc
(
)
=
0
;
#
ifdef
MOZ_WIDGET_ANDROID
virtual
void
GeckoStart
(
JNIEnv
*
aEnv
char
*
*
argv
int
argc
const
StaticXREAppData
&
aAppData
)
=
0
;
virtual
void
XRE_SetAndroidChildFds
(
JNIEnv
*
aEnv
const
XRE_AndroidChildFds
&
fds
)
=
0
;
#
ifdef
MOZ_PROFILE_GENERATE
virtual
void
XRE_WriteLLVMProfData
(
)
=
0
;
#
endif
#
endif
#
ifdef
LIBFUZZER
virtual
void
XRE_LibFuzzerSetDriver
(
LibFuzzerDriver
aDriver
)
=
0
;
#
endif
#
ifdef
MOZ_IPDL_TESTS
virtual
int
XRE_RunIPDLTest
(
int
argc
char
*
*
argv
)
=
0
;
#
endif
#
ifdef
MOZ_ENABLE_FORKSERVER
virtual
int
XRE_ForkServer
(
int
*
argc
char
*
*
*
argv
)
=
0
;
#
endif
}
;
enum
class
LibLoadingStrategy
{
NoReadAhead
ReadAhead
}
;
#
ifdef
XPCOM_GLUE
typedef
void
(
*
GetBootstrapType
)
(
Bootstrap
:
:
UniquePtr
&
)
;
Bootstrap
:
:
UniquePtr
GetBootstrap
(
const
char
*
aXPCOMFile
=
nullptr
LibLoadingStrategy
aLibLoadingStrategy
=
LibLoadingStrategy
:
:
NoReadAhead
)
;
#
else
extern
"
C
"
NS_EXPORT
void
NS_FROZENCALL
XRE_GetBootstrap
(
Bootstrap
:
:
UniquePtr
&
b
)
;
inline
Bootstrap
:
:
UniquePtr
GetBootstrap
(
const
char
*
aXPCOMFile
=
nullptr
)
{
Bootstrap
:
:
UniquePtr
bootstrap
;
XRE_GetBootstrap
(
bootstrap
)
;
return
bootstrap
;
}
#
endif
}
#
endif
