#
include
"
mozilla
/
WinDllServices
.
h
"
#
include
"
mozilla
/
ClearOnShutdown
.
h
"
#
include
"
mozilla
/
Services
.
h
"
#
include
"
nsIObserverService
.
h
"
#
include
"
nsString
.
h
"
namespace
mozilla
{
const
char
*
DllServices
:
:
kTopicDllLoadedMainThread
=
"
dll
-
loaded
-
main
-
thread
"
;
const
char
*
DllServices
:
:
kTopicDllLoadedNonMainThread
=
"
dll
-
loaded
-
non
-
main
-
thread
"
;
static
StaticRefPtr
<
DllServices
>
sInstance
;
DllServices
*
DllServices
:
:
Get
(
)
{
if
(
sInstance
)
{
return
sInstance
;
}
sInstance
=
new
DllServices
(
)
;
ClearOnShutdown
(
&
sInstance
)
;
return
sInstance
;
}
DllServices
:
:
DllServices
(
)
{
Enable
(
)
;
}
void
DllServices
:
:
NotifyDllLoad
(
const
bool
aIsMainThread
const
nsString
&
aDllName
)
{
const
char
*
topic
;
if
(
aIsMainThread
)
{
topic
=
kTopicDllLoadedMainThread
;
}
else
{
topic
=
kTopicDllLoadedNonMainThread
;
}
nsCOMPtr
<
nsIObserverService
>
obsServ
(
mozilla
:
:
services
:
:
GetObserverService
(
)
)
;
obsServ
-
>
NotifyObservers
(
nullptr
topic
aDllName
.
get
(
)
)
;
}
}
