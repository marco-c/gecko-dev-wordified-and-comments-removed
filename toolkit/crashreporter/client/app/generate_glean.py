import
shutil
import
sys
from
contextlib
import
redirect_stderr
redirect_stdout
from
io
import
StringIO
from
pathlib
import
Path
from
tempfile
import
TemporaryDirectory
def
main
(
output
*
paths
)
:
    
with
TemporaryDirectory
(
)
as
outdir
:
        
outdir_path
=
Path
(
outdir
)
        
translate_output
=
StringIO
(
)
        
with
redirect_stdout
(
translate_output
)
redirect_stderr
(
translate_output
)
:
            
from
glean_parser
.
translate
import
translate
            
result
=
translate
(
[
Path
(
p
)
for
p
in
paths
]
"
rust
"
outdir_path
)
        
if
result
!
=
0
:
            
print
(
translate_output
.
getvalue
(
)
)
            
sys
.
exit
(
result
)
        
glean_metrics_file
=
outdir_path
/
"
glean_metrics
.
rs
"
        
with
glean_metrics_file
.
open
(
)
as
glean_metrics
:
            
shutil
.
copyfileobj
(
glean_metrics
output
)
