use
crate
:
:
std
:
:
mock
;
mod
glean
;
pub
struct
CrashPing
<
'
a
>
{
pub
extra
:
&
'
a
serde_json
:
:
Value
pub
minidump_hash
:
Option
<
&
'
a
str
>
}
impl
CrashPing
<
'
_
>
{
pub
fn
send
(
&
self
)
{
if
mock
:
:
hook
(
true
"
enable_glean_pings
"
)
{
if
let
Err
(
e
)
=
self
.
send_glean
(
)
{
log
:
:
error
!
(
"
failed
to
send
glean
ping
:
{
e
:
#
}
"
)
;
}
}
}
fn
send_glean
(
&
self
)
-
>
anyhow
:
:
Result
<
(
)
>
{
glean
:
:
set_crash_ping_metrics
(
self
.
extra
self
.
minidump_hash
)
?
;
log
:
:
debug
!
(
"
submitting
Glean
crash
ping
"
)
;
crate
:
:
glean
:
:
crash
.
submit
(
Some
(
"
crash
"
)
)
;
Ok
(
(
)
)
}
}
