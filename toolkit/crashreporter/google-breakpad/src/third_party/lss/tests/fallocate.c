#
include
"
test_skel
.
h
"
int
main
(
int
argc
char
*
argv
[
]
)
{
int
fd
=
0
mode
=
0
;
loff_t
offset
=
0
len
=
0
;
fd
=
-
1
;
assert
(
sys_fallocate
(
fd
mode
offset
len
)
=
=
-
1
)
;
assert
(
errno
=
=
EBADF
)
;
char
filename
[
]
=
"
tempfile
.
XXXXXX
"
;
fd
=
mkstemp
(
filename
)
;
assert
(
fd
>
=
0
)
;
assert
(
sys_fallocate
(
fd
mode
offset
len
)
=
=
-
1
)
;
assert
(
errno
=
=
EINVAL
)
;
len
=
4096
;
assert
(
sys_fallocate
(
fd
mode
offset
len
)
=
=
0
)
;
offset
=
1llu
+
UINT32_MAX
;
assert
(
sys_fallocate
(
fd
mode
offset
len
)
=
=
0
)
;
#
if
defined
(
__NR_fstat64
)
struct
kernel_stat64
st
;
assert
(
sys_fstat64
(
fd
&
st
)
=
=
0
)
;
#
else
struct
kernel_stat
st
;
assert
(
sys_fstat
(
fd
&
st
)
=
=
0
)
;
#
endif
assert
(
st
.
st_size
=
=
offset
+
len
)
;
return
0
;
}
