use
std
:
:
path
:
:
Path
;
fn
main
(
)
{
set_generated_files
(
)
;
set_coverage_cfg
(
)
;
}
fn
set_generated_files
(
)
{
let
full_path
=
Path
:
:
new
(
env
!
(
"
CARGO_MANIFEST_DIR
"
)
)
;
let
relative_path
=
full_path
.
strip_prefix
(
mozbuild
:
:
TOPSRCDIR
)
.
expect
(
"
CARGO_MANIFEST_DIR
not
a
child
of
TOPSRCDIR
"
)
;
for
(
file
env
)
in
[
(
"
glean_metrics
.
rs
"
"
GLEAN_METRICS_FILE
"
)
(
"
conversions
.
rs
"
"
CONVERSIONS_FILE
"
)
]
{
let
objpath
=
mozbuild
:
:
TOPOBJDIR
.
join
(
relative_path
)
.
join
(
file
)
;
println
!
(
"
cargo
:
rustc
-
env
=
{
env
}
=
{
}
"
objpath
.
display
(
)
)
;
}
}
fn
set_coverage_cfg
(
)
{
println
!
(
"
cargo
:
rustc
-
check
-
cfg
=
cfg
(
ccov
)
"
)
;
if
mozbuild
:
:
config
:
:
MOZ_CODE_COVERAGE
{
println
!
(
"
cargo
:
rustc
-
cfg
=
ccov
"
)
;
}
}
