var
cwd
=
Services
.
dirsvc
.
get
(
"
CurWorkD
"
Ci
.
nsIFile
)
;
var
_tmpd
=
Cc
[
"
mozilla
.
org
/
file
/
local
;
1
"
]
.
createInstance
(
Ci
.
nsIFile
)
;
_tmpd
.
initWithPath
(
Services
.
env
.
get
(
"
XPCSHELL_TEST_TEMP_DIR
"
)
)
;
var
crashReporter
=
Services
.
appinfo
;
Services
.
appinfo
.
UpdateCrashEventsDir
(
)
;
var
processType
=
Services
.
appinfo
.
processType
;
if
(
processType
=
=
Ci
.
nsIXULRuntime
.
PROCESS_TYPE_DEFAULT
)
{
Services
.
appinfo
.
minidumpPath
=
_tmpd
;
}
var
protocolHandler
=
Services
.
io
.
getProtocolHandler
(
"
resource
"
)
.
QueryInterface
(
Ci
.
nsIResProtocolHandler
)
;
var
curDirURI
=
Services
.
io
.
newFileURI
(
cwd
)
;
protocolHandler
.
setSubstitution
(
"
test
"
curDirURI
)
;
const
{
CrashTestUtils
}
=
ChromeUtils
.
importESModule
(
"
resource
:
/
/
test
/
CrashTestUtils
.
sys
.
mjs
"
)
;
var
crashType
=
CrashTestUtils
.
CRASH_INVALID_POINTER_DEREF
;
var
shouldDelay
=
false
;
CrashTestUtils
.
enablePHC
(
)
;
