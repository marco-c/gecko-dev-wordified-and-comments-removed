if
(
shouldDelay
)
{
let
shouldCrashNow
=
false
;
let
tm
=
Components
.
classes
[
"
mozilla
.
org
/
thread
-
manager
;
1
"
]
.
getService
(
)
;
let
thr
=
tm
.
currentThread
;
thr
.
dispatch
(
{
run
:
(
)
=
>
{
shouldCrashNow
=
true
;
}
}
Components
.
interfaces
.
nsIThread
.
DISPATCH_NORMAL
)
;
tm
.
spinEventLoopUntil
(
(
)
=
>
shouldCrashNow
)
;
}
CrashTestUtils
.
crash
(
crashType
)
;
