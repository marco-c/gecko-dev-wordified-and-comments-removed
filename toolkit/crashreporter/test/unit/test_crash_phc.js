function
check
(
extra
kind
size
hasFreeStack
)
{
Assert
.
equal
(
extra
.
PHCKind
kind
)
;
Assert
.
ok
(
/
^
\
d
+
/
.
test
(
extra
.
PHCBaseAddress
)
)
;
Assert
.
equal
(
extra
.
PHCUsableSize
size
)
;
Assert
.
ok
(
/
^
(
\
d
+
)
*
\
d
+
/
.
test
(
extra
.
PHCAllocStack
)
)
;
if
(
hasFreeStack
)
{
Assert
.
ok
(
/
^
(
\
d
+
)
*
\
d
+
/
.
test
(
extra
.
PHCFreeStack
)
)
;
}
else
{
Assert
.
ok
(
!
extra
.
hasOwnProperty
(
"
PHCFreeStack
"
)
)
;
}
}
add_task
(
async
function
run_test
(
)
{
if
(
!
(
"
mozilla
.
org
/
toolkit
/
crash
-
reporter
;
1
"
in
Cc
)
)
{
dump
(
"
INFO
|
test_crash_phc
.
js
|
Can
'
t
test
crashreporter
in
a
non
-
libxul
build
.
\
n
"
)
;
return
;
}
await
do_crash
(
function
(
)
{
crashType
=
CrashTestUtils
.
CRASH_PHC_USE_AFTER_FREE
;
}
function
(
mdump
extra
)
{
check
(
extra
"
FreedPage
"
32
true
)
;
}
true
)
;
await
do_crash
(
function
(
)
{
crashType
=
CrashTestUtils
.
CRASH_PHC_DOUBLE_FREE
;
}
function
(
mdump
extra
)
{
check
(
extra
"
FreedPage
"
64
true
)
;
}
true
)
;
do_crash
(
function
(
)
{
crashType
=
CrashTestUtils
.
CRASH_PHC_BOUNDS_VIOLATION
;
}
function
(
mdump
extra
)
{
check
(
extra
"
GuardPage
"
96
false
)
;
}
true
)
;
}
)
;
