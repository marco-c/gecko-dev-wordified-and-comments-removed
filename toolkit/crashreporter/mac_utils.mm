#
include
<
Foundation
/
Foundation
.
h
>
#
include
"
mac_utils
.
h
"
#
include
"
nsXPCOM
.
h
"
#
include
"
mozilla
/
MacStringHelpers
.
h
"
#
include
"
mozilla
/
Unused
.
h
"
void
GetObjCExceptionInfo
(
void
*
inException
nsACString
&
outString
)
{
NSException
*
e
=
(
NSException
*
)
inException
;
NSString
*
name
=
[
e
name
]
;
NSString
*
reason
=
[
e
reason
]
;
NSArray
*
stackAddresses
=
[
e
callStackReturnAddresses
]
;
nsAutoString
nameStr
;
nsAutoString
reasonStr
;
mozilla
:
:
Unused
<
<
mozilla
:
:
CopyCocoaStringToXPCOMString
(
name
nameStr
)
;
mozilla
:
:
Unused
<
<
mozilla
:
:
CopyCocoaStringToXPCOMString
(
reason
reasonStr
)
;
outString
.
AssignLiteral
(
"
\
nObj
-
C
Exception
data
:
\
n
"
)
;
AppendUTF16toUTF8
(
nameStr
outString
)
;
outString
.
AppendLiteral
(
"
:
"
)
;
AppendUTF16toUTF8
(
reasonStr
outString
)
;
outString
.
AppendLiteral
(
"
\
n
\
nThrown
at
stack
:
\
n
"
)
;
for
(
NSNumber
*
address
in
stackAddresses
)
{
outString
.
AppendPrintf
(
"
0x
%
lx
\
n
"
[
address
unsignedIntegerValue
]
)
;
}
outString
.
AppendLiteral
(
"
\
n
"
)
;
}
