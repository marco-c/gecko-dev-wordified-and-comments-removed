#
ifndef
__nsWindow_h__
#
define
__nsWindow_h__
#
include
<
gdk
/
gdk
.
h
>
#
include
<
gtk
/
gtk
.
h
>
#
include
"
CompositorWidget
.
h
"
#
include
"
MozContainer
.
h
"
#
include
"
mozilla
/
EventForwards
.
h
"
#
include
"
mozilla
/
Maybe
.
h
"
#
include
"
mozilla
/
RefPtr
.
h
"
#
include
"
mozilla
/
TouchEvents
.
h
"
#
include
"
mozilla
/
UniquePtr
.
h
"
#
include
"
mozilla
/
widget
/
WindowSurface
.
h
"
#
include
"
mozilla
/
widget
/
WindowSurfaceProvider
.
h
"
#
include
"
nsBaseWidget
.
h
"
#
include
"
nsGkAtoms
.
h
"
#
include
"
nsIDragService
.
h
"
#
include
"
nsRefPtrHashtable
.
h
"
#
include
"
IMContextWrapper
.
h
"
#
ifdef
ACCESSIBILITY
#
include
"
mozilla
/
a11y
/
LocalAccessible
.
h
"
#
endif
#
ifdef
MOZ_X11
#
include
<
gdk
/
gdkx
.
h
>
#
include
"
X11UndefineNone
.
h
"
#
endif
#
ifdef
MOZ_WAYLAND
#
include
<
gdk
/
gdkwayland
.
h
>
#
include
"
base
/
thread
.
h
"
#
include
"
WaylandVsyncSource
.
h
"
#
include
"
nsClipboardWayland
.
h
"
#
endif
#
ifdef
MOZ_LOGGING
#
include
"
mozilla
/
Logging
.
h
"
#
include
"
nsTArray
.
h
"
#
include
"
Units
.
h
"
extern
mozilla
:
:
LazyLogModule
gWidgetLog
;
extern
mozilla
:
:
LazyLogModule
gWidgetDragLog
;
extern
mozilla
:
:
LazyLogModule
gWidgetPopupLog
;
#
define
LOG
(
args
)
\
MOZ_LOG
(
IsPopup
(
)
?
gWidgetPopupLog
:
gWidgetLog
\
mozilla
:
:
LogLevel
:
:
Debug
args
)
#
define
LOGW
(
args
)
MOZ_LOG
(
gWidgetLog
mozilla
:
:
LogLevel
:
:
Debug
args
)
#
define
LOGDRAG
(
args
)
MOZ_LOG
(
gWidgetDragLog
mozilla
:
:
LogLevel
:
:
Debug
args
)
#
define
LOG_POPUP
(
args
)
\
MOZ_LOG
(
gWidgetPopupLog
mozilla
:
:
LogLevel
:
:
Debug
args
)
#
define
LOG_ENABLED
(
)
\
(
MOZ_LOG_TEST
(
gWidgetPopupLog
mozilla
:
:
LogLevel
:
:
Debug
)
|
|
\
MOZ_LOG_TEST
(
gWidgetLog
mozilla
:
:
LogLevel
:
:
Debug
)
)
#
else
#
define
LOG
(
args
)
#
define
LOGW
(
args
)
#
define
LOGDRAG
(
args
)
#
define
LOG_POPUP
(
args
)
#
define
LOG_ENABLED
(
)
false
#
endif
#
ifdef
MOZ_WAYLAND
gboolean
WindowDragMotionHandler
(
GtkWidget
*
aWidget
GdkDragContext
*
aDragContext
RefPtr
<
DataOffer
>
aDataOffer
gint
aX
gint
aY
guint
aTime
)
;
gboolean
WindowDragDropHandler
(
GtkWidget
*
aWidget
GdkDragContext
*
aDragContext
RefPtr
<
DataOffer
>
aDataOffer
gint
aX
gint
aY
guint
aTime
)
;
void
WindowDragLeaveHandler
(
GtkWidget
*
aWidget
)
;
#
endif
class
gfxPattern
;
class
nsIFrame
;
#
if
!
GTK_CHECK_VERSION
(
3
18
0
)
struct
_GdkEventTouchpadPinch
;
typedef
struct
_GdkEventTouchpadPinch
GdkEventTouchpadPinch
;
#
endif
namespace
mozilla
{
class
TimeStamp
;
class
CurrentX11TimeGetter
;
}
class
nsWindow
final
:
public
nsBaseWidget
{
public
:
typedef
mozilla
:
:
gfx
:
:
DrawTarget
DrawTarget
;
typedef
mozilla
:
:
WidgetEventTime
WidgetEventTime
;
typedef
mozilla
:
:
WidgetKeyboardEvent
WidgetKeyboardEvent
;
typedef
mozilla
:
:
widget
:
:
PlatformCompositorWidgetDelegate
PlatformCompositorWidgetDelegate
;
nsWindow
(
)
;
static
void
ReleaseGlobals
(
)
;
NS_INLINE_DECL_REFCOUNTING_INHERITED
(
nsWindow
nsBaseWidget
)
void
CommonCreate
(
nsIWidget
*
aParent
bool
aListenForResizes
)
;
virtual
nsresult
DispatchEvent
(
mozilla
:
:
WidgetGUIEvent
*
aEvent
nsEventStatus
&
aStatus
)
override
;
virtual
void
OnDestroy
(
void
)
override
;
bool
AreBoundsSane
(
void
)
;
using
nsBaseWidget
:
:
Create
;
[
[
nodiscard
]
]
virtual
nsresult
Create
(
nsIWidget
*
aParent
nsNativeWidget
aNativeParent
const
LayoutDeviceIntRect
&
aRect
nsWidgetInitData
*
aInitData
)
override
;
virtual
void
Destroy
(
)
override
;
virtual
nsIWidget
*
GetParent
(
)
override
;
virtual
float
GetDPI
(
)
override
;
virtual
double
GetDefaultScaleInternal
(
)
override
;
mozilla
:
:
DesktopToLayoutDeviceScale
GetDesktopToDeviceScale
(
)
override
;
mozilla
:
:
DesktopToLayoutDeviceScale
GetDesktopToDeviceScaleByScreen
(
)
override
;
virtual
void
SetParent
(
nsIWidget
*
aNewParent
)
override
;
virtual
void
SetModal
(
bool
aModal
)
override
;
virtual
bool
IsVisible
(
)
const
override
;
virtual
void
ConstrainPosition
(
bool
aAllowSlop
int32_t
*
aX
int32_t
*
aY
)
override
;
virtual
void
SetSizeConstraints
(
const
SizeConstraints
&
aConstraints
)
override
;
virtual
void
LockAspectRatio
(
bool
aShouldLock
)
override
;
virtual
void
Move
(
double
aX
double
aY
)
override
;
virtual
void
Show
(
bool
aState
)
override
;
virtual
void
Resize
(
double
aWidth
double
aHeight
bool
aRepaint
)
override
;
virtual
void
Resize
(
double
aX
double
aY
double
aWidth
double
aHeight
bool
aRepaint
)
override
;
virtual
bool
IsEnabled
(
)
const
override
;
void
SetZIndex
(
int32_t
aZIndex
)
override
;
virtual
void
SetSizeMode
(
nsSizeMode
aMode
)
override
;
virtual
void
GetWorkspaceID
(
nsAString
&
workspaceID
)
override
;
virtual
void
MoveToWorkspace
(
const
nsAString
&
workspaceID
)
override
;
virtual
void
Enable
(
bool
aState
)
override
;
virtual
void
SetFocus
(
Raise
mozilla
:
:
dom
:
:
CallerType
aCallerType
)
override
;
virtual
LayoutDeviceIntRect
GetScreenBounds
(
)
override
;
virtual
LayoutDeviceIntRect
GetClientBounds
(
)
override
;
virtual
LayoutDeviceIntSize
GetClientSize
(
)
override
;
virtual
LayoutDeviceIntPoint
GetClientOffset
(
)
override
;
virtual
void
SetCursor
(
const
Cursor
&
)
override
;
virtual
void
Invalidate
(
const
LayoutDeviceIntRect
&
aRect
)
override
;
virtual
void
*
GetNativeData
(
uint32_t
aDataType
)
override
;
virtual
nsresult
SetTitle
(
const
nsAString
&
aTitle
)
override
;
virtual
void
SetIcon
(
const
nsAString
&
aIconSpec
)
override
;
virtual
void
SetWindowClass
(
const
nsAString
&
xulWinType
)
override
;
virtual
LayoutDeviceIntPoint
WidgetToScreenOffset
(
)
override
;
virtual
void
CaptureMouse
(
bool
aCapture
)
override
;
virtual
void
CaptureRollupEvents
(
nsIRollupListener
*
aListener
bool
aDoCapture
)
override
;
[
[
nodiscard
]
]
virtual
nsresult
GetAttention
(
int32_t
aCycleCount
)
override
;
virtual
nsresult
SetWindowClipRegion
(
const
nsTArray
<
LayoutDeviceIntRect
>
&
aRects
bool
aIntersectWithExisting
)
override
;
virtual
bool
HasPendingInputEvent
(
)
override
;
virtual
bool
PrepareForFullscreenTransition
(
nsISupports
*
*
aData
)
override
;
virtual
void
PerformFullscreenTransition
(
FullscreenTransitionStage
aStage
uint16_t
aDuration
nsISupports
*
aData
nsIRunnable
*
aCallback
)
override
;
virtual
already_AddRefed
<
nsIScreen
>
GetWidgetScreen
(
)
override
;
virtual
nsresult
MakeFullScreen
(
bool
aFullScreen
nsIScreen
*
aTargetScreen
=
nullptr
)
override
;
virtual
void
HideWindowChrome
(
bool
aShouldHide
)
override
;
static
guint32
GetLastUserInputTime
(
)
;
gint
ConvertBorderStyles
(
nsBorderStyle
aStyle
)
;
GdkRectangle
DevicePixelsToGdkRectRoundOut
(
LayoutDeviceIntRect
aRect
)
;
mozilla
:
:
widget
:
:
IMContextWrapper
*
GetIMContext
(
)
const
{
return
mIMContext
;
}
bool
DispatchCommandEvent
(
nsAtom
*
aCommand
)
;
bool
DispatchContentCommandEvent
(
mozilla
:
:
EventMessage
aMsg
)
;
gboolean
OnExposeEvent
(
cairo_t
*
cr
)
;
gboolean
OnConfigureEvent
(
GtkWidget
*
aWidget
GdkEventConfigure
*
aEvent
)
;
void
OnContainerUnrealize
(
)
;
void
OnSizeAllocate
(
GtkAllocation
*
aAllocation
)
;
void
OnDeleteEvent
(
)
;
void
OnEnterNotifyEvent
(
GdkEventCrossing
*
aEvent
)
;
void
OnLeaveNotifyEvent
(
GdkEventCrossing
*
aEvent
)
;
void
OnMotionNotifyEvent
(
GdkEventMotion
*
aEvent
)
;
void
OnButtonPressEvent
(
GdkEventButton
*
aEvent
)
;
void
OnButtonReleaseEvent
(
GdkEventButton
*
aEvent
)
;
void
OnContainerFocusInEvent
(
GdkEventFocus
*
aEvent
)
;
void
OnContainerFocusOutEvent
(
GdkEventFocus
*
aEvent
)
;
gboolean
OnKeyPressEvent
(
GdkEventKey
*
aEvent
)
;
gboolean
OnKeyReleaseEvent
(
GdkEventKey
*
aEvent
)
;
void
OnScrollEvent
(
GdkEventScroll
*
aEvent
)
;
void
OnWindowStateEvent
(
GtkWidget
*
aWidget
GdkEventWindowState
*
aEvent
)
;
void
OnDragDataReceivedEvent
(
GtkWidget
*
aWidget
GdkDragContext
*
aDragContext
gint
aX
gint
aY
GtkSelectionData
*
aSelectionData
guint
aInfo
guint
aTime
gpointer
aData
)
;
gboolean
OnPropertyNotifyEvent
(
GtkWidget
*
aWidget
GdkEventProperty
*
aEvent
)
;
gboolean
OnTouchEvent
(
GdkEventTouch
*
aEvent
)
;
gboolean
OnTouchpadPinchEvent
(
GdkEventTouchpadPinch
*
aEvent
)
;
void
UpdateTopLevelOpaqueRegion
(
)
;
virtual
already_AddRefed
<
mozilla
:
:
gfx
:
:
DrawTarget
>
StartRemoteDrawingInRegion
(
const
LayoutDeviceIntRegion
&
aInvalidRegion
mozilla
:
:
layers
:
:
BufferMode
*
aBufferMode
)
override
;
virtual
void
EndRemoteDrawingInRegion
(
mozilla
:
:
gfx
:
:
DrawTarget
*
aDrawTarget
const
LayoutDeviceIntRegion
&
aInvalidRegion
)
override
;
void
SetProgress
(
unsigned
long
progressPercent
)
;
RefPtr
<
mozilla
:
:
gfx
:
:
VsyncSource
>
GetVsyncSource
(
)
override
;
bool
SynchronouslyRepaintOnResize
(
)
override
;
void
OnDPIChanged
(
void
)
;
void
OnCheckResize
(
void
)
;
void
OnCompositedChanged
(
void
)
;
void
OnScaleChanged
(
)
;
void
DispatchResized
(
)
;
static
guint32
sLastButtonPressTime
;
[
[
nodiscard
]
]
virtual
nsresult
BeginResizeDrag
(
mozilla
:
:
WidgetGUIEvent
*
aEvent
int32_t
aHorizontal
int32_t
aVertical
)
override
;
MozContainer
*
GetMozContainer
(
)
{
return
mContainer
;
}
LayoutDeviceIntSize
GetMozContainerSize
(
)
;
GtkWidget
*
GetMozContainerWidget
(
)
;
GdkWindow
*
GetGdkWindow
(
)
{
return
mGdkWindow
;
}
GtkWidget
*
GetGtkWidget
(
)
{
return
mShell
;
}
nsIFrame
*
GetFrame
(
)
;
bool
IsDestroyed
(
)
{
return
mIsDestroyed
;
}
bool
IsPopup
(
)
;
bool
IsWaylandPopup
(
)
;
bool
IsPIPWindow
(
)
{
return
mIsPIPWindow
;
}
;
void
DispatchDragEvent
(
mozilla
:
:
EventMessage
aMsg
const
LayoutDeviceIntPoint
&
aRefPoint
guint
aTime
)
;
static
void
UpdateDragStatus
(
GdkDragContext
*
aDragContext
nsIDragService
*
aDragService
)
;
WidgetEventTime
GetWidgetEventTime
(
guint32
aEventTime
)
;
mozilla
:
:
TimeStamp
GetEventTimeStamp
(
guint32
aEventTime
)
;
mozilla
:
:
CurrentX11TimeGetter
*
GetCurrentTimeGetter
(
)
;
virtual
void
SetInputContext
(
const
InputContext
&
aContext
const
InputContextAction
&
aAction
)
override
;
virtual
InputContext
GetInputContext
(
)
override
;
virtual
TextEventDispatcherListener
*
GetNativeTextEventDispatcherListener
(
)
override
;
MOZ_CAN_RUN_SCRIPT
virtual
bool
GetEditCommands
(
NativeKeyBindingsType
aType
const
mozilla
:
:
WidgetKeyboardEvent
&
aEvent
nsTArray
<
mozilla
:
:
CommandInt
>
&
aCommands
)
override
;
void
ResizeTransparencyBitmap
(
)
;
void
ApplyTransparencyBitmap
(
)
;
void
ClearTransparencyBitmap
(
)
;
virtual
void
SetTransparencyMode
(
nsTransparencyMode
aMode
)
override
;
virtual
nsTransparencyMode
GetTransparencyMode
(
)
override
;
virtual
void
SetWindowMouseTransparent
(
bool
aIsTransparent
)
override
;
virtual
nsresult
ConfigureChildren
(
const
nsTArray
<
Configuration
>
&
aConfigurations
)
override
;
nsresult
UpdateTranslucentWindowAlphaInternal
(
const
nsIntRect
&
aRect
uint8_t
*
aAlphas
int32_t
aStride
)
;
void
UpdateTitlebarTransparencyBitmap
(
)
;
virtual
void
ReparentNativeWidget
(
nsIWidget
*
aNewParent
)
override
;
virtual
nsresult
SynthesizeNativeMouseEvent
(
LayoutDeviceIntPoint
aPoint
NativeMouseMessage
aNativeMessage
mozilla
:
:
MouseButton
aButton
nsIWidget
:
:
Modifiers
aModifierFlags
nsIObserver
*
aObserver
)
override
;
virtual
nsresult
SynthesizeNativeMouseMove
(
LayoutDeviceIntPoint
aPoint
nsIObserver
*
aObserver
)
override
{
return
SynthesizeNativeMouseEvent
(
aPoint
NativeMouseMessage
:
:
Move
mozilla
:
:
MouseButton
:
:
eNotPressed
nsIWidget
:
:
Modifiers
:
:
NO_MODIFIERS
aObserver
)
;
}
virtual
nsresult
SynthesizeNativeMouseScrollEvent
(
LayoutDeviceIntPoint
aPoint
uint32_t
aNativeMessage
double
aDeltaX
double
aDeltaY
double
aDeltaZ
uint32_t
aModifierFlags
uint32_t
aAdditionalFlags
nsIObserver
*
aObserver
)
override
;
virtual
nsresult
SynthesizeNativeTouchPoint
(
uint32_t
aPointerId
TouchPointerState
aPointerState
LayoutDeviceIntPoint
aPoint
double
aPointerPressure
uint32_t
aPointerOrientation
nsIObserver
*
aObserver
)
override
;
virtual
nsresult
SynthesizeNativeTouchPadPinch
(
TouchpadGesturePhase
aEventPhase
float
aScale
LayoutDeviceIntPoint
aPoint
int32_t
aModifierFlags
)
override
;
virtual
void
GetCompositorWidgetInitData
(
mozilla
:
:
widget
:
:
CompositorWidgetInitData
*
aInitData
)
override
;
virtual
nsresult
SetNonClientMargins
(
LayoutDeviceIntMargin
&
aMargins
)
override
;
void
SetDrawsInTitlebar
(
bool
aState
)
override
;
LayoutDeviceIntRect
GetTitlebarRect
(
)
;
virtual
void
UpdateWindowDraggingRegion
(
const
LayoutDeviceIntRegion
&
aRegion
)
override
;
gint
GdkCeiledScaleFactor
(
)
;
bool
UseFractionalScale
(
)
;
double
FractionalScaleFactor
(
)
;
gint
DevicePixelsToGdkCoordRoundUp
(
int
pixels
)
;
gint
DevicePixelsToGdkCoordRoundDown
(
int
pixels
)
;
GdkPoint
DevicePixelsToGdkPointRoundDown
(
LayoutDeviceIntPoint
point
)
;
GdkRectangle
DevicePixelsToGdkSizeRoundUp
(
LayoutDeviceIntSize
pixelSize
)
;
int
GdkCoordToDevicePixels
(
gint
coord
)
;
LayoutDeviceIntPoint
GdkPointToDevicePixels
(
GdkPoint
point
)
;
LayoutDeviceIntPoint
GdkEventCoordsToDevicePixels
(
gdouble
x
gdouble
y
)
;
LayoutDeviceIntRect
GdkRectToDevicePixels
(
GdkRectangle
rect
)
;
virtual
bool
WidgetTypeSupportsAcceleration
(
)
override
;
nsresult
SetSystemFont
(
const
nsCString
&
aFontName
)
override
;
nsresult
GetSystemFont
(
nsCString
&
aFontName
)
override
;
typedef
enum
{
GTK_DECORATION_SYSTEM
GTK_DECORATION_CLIENT
GTK_DECORATION_NONE
GTK_DECORATION_UNKNOWN
}
GtkWindowDecoration
;
static
GtkWindowDecoration
GetSystemGtkWindowDecoration
(
)
;
static
bool
HideTitlebarByDefault
(
)
;
static
bool
GetTopLevelWindowActiveState
(
nsIFrame
*
aFrame
)
;
static
bool
TitlebarUseShapeMask
(
)
;
bool
IsRemoteContent
(
)
{
return
HasRemoteContent
(
)
;
}
void
NativeMoveResizeWaylandPopupCallback
(
const
GdkRectangle
*
aFinalSize
bool
aFlippedX
bool
aFlippedY
)
;
static
bool
IsToplevelWindowTransparent
(
)
;
static
nsWindow
*
GetFocusedWindow
(
)
;
#
ifdef
MOZ_WAYLAND
bool
GetCSDDecorationOffset
(
int
*
aDx
int
*
aDy
)
;
void
SetEGLNativeWindowSize
(
const
LayoutDeviceIntSize
&
aEGLWindowSize
)
;
void
WaylandDragWorkaround
(
GdkEventButton
*
aEvent
)
;
wl_display
*
GetWaylandDisplay
(
)
;
virtual
void
CreateCompositorVsyncDispatcher
(
)
override
;
LayoutDeviceIntPoint
GetNativePointerLockCenter
(
)
{
return
mNativePointerLockCenter
;
}
virtual
void
SetNativePointerLockCenter
(
const
LayoutDeviceIntPoint
&
aLockCenter
)
override
;
virtual
void
LockNativePointer
(
)
override
;
virtual
void
UnlockNativePointer
(
)
override
;
virtual
nsRect
GetPreferredPopupRect
(
)
override
{
return
mPreferredPopupRect
;
}
;
virtual
void
FlushPreferredPopupRect
(
)
override
{
mPreferredPopupRect
=
nsRect
(
0
0
0
0
)
;
mPreferredPopupRectFlushed
=
true
;
}
;
#
endif
typedef
enum
{
COMPOSITOR_ENABLED
COMPOSITOR_PAUSED_INITIALLY
COMPOSITOR_PAUSED_MISSING_EGL_WINDOW
COMPOSITOR_PAUSED_FLICKERING
}
WindowCompositorState
;
void
ResumeCompositor
(
)
;
void
ResumeCompositorFromCompositorThread
(
)
;
void
PauseCompositor
(
)
;
bool
IsWaitingForCompositorResume
(
)
;
protected
:
virtual
~
nsWindow
(
)
;
void
DispatchActivateEvent
(
void
)
;
void
DispatchDeactivateEvent
(
void
)
;
void
MaybeDispatchResized
(
)
;
virtual
void
RegisterTouchWindow
(
)
override
;
virtual
bool
CompositorInitiallyPaused
(
)
override
{
#
ifdef
MOZ_WAYLAND
return
mCompositorState
=
=
COMPOSITOR_PAUSED_INITIALLY
;
#
else
return
false
;
#
endif
}
nsCOMPtr
<
nsIWidget
>
mParent
;
bool
mIsTopLevel
;
bool
mIsDestroyed
;
bool
mListenForResizes
;
bool
mNeedsDispatchResized
;
bool
mIsShown
;
bool
mNeedsShow
;
bool
mEnabled
;
bool
mCreated
;
bool
mHandleTouchEvent
;
bool
mIsDragPopup
;
nsPopupType
mPopupHint
;
bool
mWindowScaleFactorChanged
;
int
mWindowScaleFactor
;
bool
mCompositedScreen
;
bool
mIsAccelerated
;
private
:
void
UpdateAlpha
(
mozilla
:
:
gfx
:
:
SourceSurface
*
aSourceSurface
nsIntRect
aBoundsRect
)
;
void
NativeMoveResize
(
bool
aMoved
bool
aResized
)
;
void
NativeShow
(
bool
aAction
)
;
void
SetHasMappedToplevel
(
bool
aState
)
;
LayoutDeviceIntSize
GetSafeWindowSize
(
LayoutDeviceIntSize
aSize
)
;
void
EnsureGrabs
(
void
)
;
void
GrabPointer
(
guint32
aTime
)
;
void
ReleaseGrabs
(
void
)
;
void
UpdateClientOffsetFromFrameExtents
(
)
;
void
UpdateClientOffsetFromCSDWindow
(
)
;
void
DispatchContextMenuEventFromMouseEvent
(
uint16_t
domButton
GdkEventButton
*
aEvent
)
;
void
ResumeCompositorHiddenWindow
(
)
;
void
PauseCompositorHiddenWindow
(
)
;
void
WaylandStartVsync
(
)
;
void
WaylandStopVsync
(
)
;
void
DestroyChildWindows
(
)
;
GtkWidget
*
GetToplevelWidget
(
)
;
nsWindow
*
GetContainerWindow
(
)
;
void
SetUrgencyHint
(
GtkWidget
*
top_window
bool
state
)
;
void
SetDefaultIcon
(
void
)
;
void
SetWindowDecoration
(
nsBorderStyle
aStyle
)
;
void
InitButtonEvent
(
mozilla
:
:
WidgetMouseEvent
&
aEvent
GdkEventButton
*
aGdkEvent
)
;
bool
CheckForRollup
(
gdouble
aMouseX
gdouble
aMouseY
bool
aIsWheel
bool
aAlwaysRollup
)
;
void
CheckForRollupDuringGrab
(
)
{
CheckForRollup
(
0
0
false
true
)
;
}
bool
GetDragInfo
(
mozilla
:
:
WidgetMouseEvent
*
aMouseEvent
GdkWindow
*
*
aWindow
gint
*
aButton
gint
*
aRootX
gint
*
aRootY
)
;
nsIWidgetListener
*
GetListener
(
)
;
nsWindow
*
GetTransientForWindowIfPopup
(
)
;
bool
IsHandlingTouchSequence
(
GdkEventSequence
*
aSequence
)
;
void
ResizeInt
(
int
aX
int
aY
int
aWidth
int
aHeight
bool
aMove
bool
aRepaint
)
;
void
NativeMoveResizeWaylandPopup
(
bool
aMove
bool
aResize
)
;
bool
CheckResizerEdge
(
LayoutDeviceIntPoint
aPoint
GdkWindowEdge
&
aOutEdge
)
;
GtkTextDirection
GetTextDirection
(
)
;
void
AddCSDDecorationSize
(
int
*
aWidth
int
*
aHeight
)
;
nsCString
mGtkWindowAppName
;
nsCString
mGtkWindowRoleName
;
void
RefreshWindowClass
(
)
;
GtkWidget
*
mShell
;
MozContainer
*
mContainer
;
GdkWindow
*
mGdkWindow
;
bool
mWindowShouldStartDragging
;
PlatformCompositorWidgetDelegate
*
mCompositorWidgetDelegate
;
WindowCompositorState
mCompositorState
;
int
mCompositorPauseTimeoutID
;
uint32_t
mHasMappedToplevel
:
1
mRetryPointerGrab
:
1
;
nsSizeMode
mSizeState
;
float
mAspectRatio
;
float
mAspectRatioSaved
;
nsIntPoint
mClientOffset
;
guint32
mLastScrollEventTime
;
mozilla
:
:
ScreenCoord
mLastPinchEventSpan
;
bool
mPanInProgress
=
false
;
nsRefPtrHashtable
<
nsPtrHashKey
<
GdkEventSequence
>
mozilla
:
:
dom
:
:
Touch
>
mTouches
;
unsigned
int
mPendingConfigures
;
GtkWindowDecoration
mGtkWindowDecoration
;
bool
mDrawToContainer
;
bool
mDrawInTitlebar
;
bool
mTitlebarBackdropState
;
LayoutDeviceIntRegion
mDraggableRegion
;
bool
mIsPIPWindow
;
bool
mIsWaylandPanelWindow
;
bool
mAlwaysOnTop
;
static
GdkCursor
*
gsGtkCursorCache
[
eCursorCount
]
;
bool
mIsTransparent
;
gchar
*
mTransparencyBitmap
;
int32_t
mTransparencyBitmapWidth
;
int32_t
mTransparencyBitmapHeight
;
bool
mTransparencyBitmapForTitlebar
;
bool
mHasAlphaVisual
;
void
InitDragEvent
(
mozilla
:
:
WidgetDragEvent
&
aEvent
)
;
float
mLastMotionPressure
;
nsSizeMode
mLastSizeMode
;
bool
mBoundsAreValid
;
static
bool
DragInProgress
(
void
)
;
void
DispatchMissedButtonReleases
(
GdkEventCrossing
*
aGdkEvent
)
;
virtual
WindowRenderer
*
GetWindowRenderer
(
)
override
;
void
SetCompositorWidgetDelegate
(
CompositorWidgetDelegate
*
delegate
)
override
;
void
CleanLayerManagerRecursive
(
)
;
virtual
int32_t
RoundsWidgetCoordinatesTo
(
)
override
;
void
UpdateMozWindowActive
(
)
;
void
ForceTitlebarRedraw
(
)
;
bool
DoDrawTilebarCorners
(
)
;
bool
IsChromeWindowTitlebar
(
)
;
void
SetPopupWindowDecoration
(
bool
aShowOnTaskbar
)
;
void
ApplySizeConstraints
(
void
)
;
void
GetParentPosition
(
int
*
aX
int
*
aY
)
;
bool
WaylandPopupNeedsTrackInHierarchy
(
)
;
bool
WaylandPopupIsAnchored
(
)
;
bool
WaylandPopupIsMenu
(
)
;
bool
WaylandPopupIsContextMenu
(
)
;
bool
WaylandPopupIsPermanent
(
)
;
bool
IsWidgetOverflowWindow
(
)
;
void
RemovePopupFromHierarchyList
(
)
;
void
ShowWaylandWindow
(
)
;
void
HideWaylandWindow
(
)
;
void
HideWaylandPopupWindow
(
bool
aTemporaryHidden
bool
aRemoveFromPopupList
)
;
void
HideWaylandToplevelWindow
(
)
;
void
WaylandPopupHideTooltips
(
)
;
void
AppendPopupToHierarchyList
(
nsWindow
*
aToplevelWindow
)
;
void
WaylandPopupHierarchyHideTemporary
(
)
;
void
WaylandPopupHierarchyShowTemporaryHidden
(
)
;
void
WaylandPopupHierarchyCalculatePositions
(
)
;
bool
IsInPopupHierarchy
(
)
;
void
AddWindowToPopupHierarchy
(
)
;
void
UpdateWaylandPopupHierarchy
(
)
;
void
WaylandPopupHierarchyHideByLayout
(
nsTArray
<
nsIWidget
*
>
*
aLayoutWidgetHierarchy
)
;
void
WaylandPopupHierarchyValidateByLayout
(
nsTArray
<
nsIWidget
*
>
*
aLayoutWidgetHierarchy
)
;
void
CloseAllPopupsBeforeRemotePopup
(
)
;
void
WaylandPopupHideClosedPopups
(
)
;
void
WaylandPopupMove
(
)
;
bool
WaylandPopupRemoveNegativePosition
(
int
*
aX
=
nullptr
int
*
aY
=
nullptr
)
;
nsWindow
*
WaylandPopupGetTopmostWindow
(
)
;
bool
IsPopupInLayoutPopupChain
(
nsTArray
<
nsIWidget
*
>
*
aLayoutWidgetHierarchy
bool
aMustMatchParent
)
;
void
WaylandPopupMarkAsClosed
(
)
;
void
WaylandPopupRemoveClosedPopups
(
)
;
void
WaylandPopupSetDirectPosition
(
)
;
bool
WaylandPopupFitsParentWindow
(
GdkRectangle
*
aSize
)
;
nsWindow
*
WaylandPopupFindLast
(
nsWindow
*
aPopup
)
;
GtkWindow
*
GetCurrentTopmostWindow
(
)
;
nsCString
GetWindowNodeName
(
)
;
nsCString
GetPopupTypeName
(
)
;
bool
IsPopupDirectionRTL
(
)
;
#
ifdef
MOZ_LOGGING
void
LogPopupHierarchy
(
)
;
#
endif
bool
mPopupTrackInHierarchy
;
bool
mPopupTrackInHierarchyConfigured
;
bool
mHiddenPopupPositioned
;
GdkPoint
mPopupPosition
;
bool
mPopupAnchored
;
bool
mPopupContextMenu
;
GdkPoint
mRelativePopupPosition
;
GdkPoint
mRelativePopupOffset
;
bool
mPopupMatchesLayout
;
bool
mPopupChanged
;
bool
mPopupTemporaryHidden
;
bool
mPopupClosed
;
bool
mPopupUseMoveToRect
;
LayoutDeviceIntRect
mPopupLastAnchor
;
RefPtr
<
nsWindow
>
mWaylandToplevel
;
RefPtr
<
nsWindow
>
mWaylandPopupNext
;
RefPtr
<
nsWindow
>
mWaylandPopupPrev
;
nsRect
mPreferredPopupRect
;
bool
mPreferredPopupRectFlushed
;
bool
mWaitingForMoveToRectCallback
;
LayoutDeviceIntRect
mNewBoundsAfterMoveToRect
;
RefPtr
<
mozilla
:
:
widget
:
:
IMContextWrapper
>
mIMContext
;
mozilla
:
:
UniquePtr
<
mozilla
:
:
CurrentX11TimeGetter
>
mCurrentTimeGetter
;
static
GtkWindowDecoration
sGtkWindowDecoration
;
static
bool
sTransparentMainWindow
;
mozilla
:
:
widget
:
:
WindowSurfaceProvider
mSurfaceProvider
;
#
ifdef
ACCESSIBILITY
RefPtr
<
mozilla
:
:
a11y
:
:
LocalAccessible
>
mRootAccessible
;
void
CreateRootAccessible
(
)
;
void
DispatchEventToRootAccessible
(
uint32_t
aEventType
)
;
void
DispatchActivateEventAccessible
(
)
;
void
DispatchDeactivateEventAccessible
(
)
;
void
DispatchMaximizeEventAccessible
(
)
;
void
DispatchMinimizeEventAccessible
(
)
;
void
DispatchRestoreEventAccessible
(
)
;
#
endif
#
ifdef
MOZ_X11
typedef
enum
{
GTK_WIDGET_COMPOSIDED_DEFAULT
=
0
GTK_WIDGET_COMPOSIDED_DISABLED
=
1
GTK_WIDGET_COMPOSIDED_ENABLED
=
2
}
WindowComposeRequest
;
void
SetCompositorHint
(
WindowComposeRequest
aState
)
;
bool
ConfigureX11GLVisual
(
)
;
Window
mXWindow
;
Visual
*
mXVisual
;
int
mXDepth
;
#
endif
#
ifdef
MOZ_WAYLAND
RefPtr
<
mozilla
:
:
gfx
:
:
VsyncSource
>
mWaylandVsyncSource
;
LayoutDeviceIntPoint
mNativePointerLockCenter
;
zwp_locked_pointer_v1
*
mLockedPointer
;
zwp_relative_pointer_v1
*
mRelativePointer
;
#
endif
}
;
#
endif
