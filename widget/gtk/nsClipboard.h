#
ifndef
__nsClipboard_h_
#
define
__nsClipboard_h_
#
include
"
nsIClipboard
.
h
"
#
include
"
nsIObserver
.
h
"
#
include
"
nsIBinaryOutputStream
.
h
"
#
include
<
gtk
/
gtk
.
h
>
#
ifdef
MOZ_LOGGING
#
include
"
mozilla
/
Logging
.
h
"
#
include
"
nsTArray
.
h
"
#
include
"
Units
.
h
"
extern
mozilla
:
:
LazyLogModule
gClipboardLog
;
#
define
LOGCLIP
(
args
)
MOZ_LOG
(
gClipboardLog
mozilla
:
:
LogLevel
:
:
Debug
args
)
#
else
#
define
LOGCLIP
(
args
)
#
endif
class
nsRetrievalContext
{
public
:
virtual
const
char
*
GetClipboardData
(
const
char
*
aMimeType
int32_t
aWhichClipboard
uint32_t
*
aContentLength
)
=
0
;
virtual
const
char
*
GetClipboardText
(
int32_t
aWhichClipboard
)
=
0
;
virtual
void
ReleaseClipboardData
(
const
char
*
aClipboardData
)
=
0
;
virtual
GdkAtom
*
GetTargets
(
int32_t
aWhichClipboard
int
*
aTargetNum
)
=
0
;
virtual
bool
HasSelectionSupport
(
void
)
=
0
;
virtual
~
nsRetrievalContext
(
)
{
}
;
}
;
class
nsClipboard
:
public
nsIClipboard
public
nsIObserver
{
public
:
nsClipboard
(
)
;
NS_DECL_ISUPPORTS
NS_DECL_NSIOBSERVER
NS_DECL_NSICLIPBOARD
nsresult
Init
(
void
)
;
void
SelectionGetEvent
(
GtkClipboard
*
aGtkClipboard
GtkSelectionData
*
aSelectionData
)
;
void
SelectionClearEvent
(
GtkClipboard
*
aGtkClipboard
)
;
private
:
virtual
~
nsClipboard
(
)
;
nsresult
Store
(
void
)
;
nsITransferable
*
GetTransferable
(
int32_t
aWhichClipboard
)
;
void
SetTransferableData
(
nsITransferable
*
aTransferable
nsCString
&
aFlavor
const
char
*
aClipboardData
uint32_t
aClipboardDataLength
)
;
nsCOMPtr
<
nsIClipboardOwner
>
mSelectionOwner
;
nsCOMPtr
<
nsIClipboardOwner
>
mGlobalOwner
;
nsCOMPtr
<
nsITransferable
>
mSelectionTransferable
;
nsCOMPtr
<
nsITransferable
>
mGlobalTransferable
;
nsAutoPtr
<
nsRetrievalContext
>
mContext
;
}
;
extern
const
int
kClipboardTimeout
;
GdkAtom
GetSelectionAtom
(
int32_t
aWhichClipboard
)
;
int
GetGeckoClipboardType
(
GtkClipboard
*
aGtkClipboard
)
;
#
endif
