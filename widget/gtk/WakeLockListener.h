#
ifndef
__WakeLockListener_h__
#
define
__WakeLockListener_h__
#
include
<
unistd
.
h
>
#
include
"
mozilla
/
StaticPtr
.
h
"
#
include
"
nsHashKeys
.
h
"
#
include
"
nsClassHashtable
.
h
"
#
include
"
nsIDOMWakeLockListener
.
h
"
#
ifdef
MOZ_ENABLE_DBUS
#
include
"
mozilla
/
DBusHelpers
.
h
"
#
endif
class
WakeLockTopic
;
class
WakeLockListener
final
:
public
nsIDOMMozWakeLockListener
{
public
:
NS_DECL_ISUPPORTS
;
static
WakeLockListener
*
GetSingleton
(
bool
aCreate
=
true
)
;
static
void
Shutdown
(
)
;
virtual
nsresult
Callback
(
const
nsAString
&
topic
const
nsAString
&
state
)
override
;
private
:
WakeLockListener
(
)
;
~
WakeLockListener
(
)
=
default
;
bool
EnsureDBusConnection
(
)
;
static
mozilla
:
:
StaticRefPtr
<
WakeLockListener
>
sSingleton
;
#
ifdef
MOZ_ENABLE_DBUS
RefPtr
<
DBusConnection
>
mConnection
;
#
endif
nsClassHashtable
<
nsStringHashKey
WakeLockTopic
>
mTopics
;
}
;
#
endif
