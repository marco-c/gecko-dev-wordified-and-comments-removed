#
include
"
WaylandSurfaceLock
.
h
"
#
ifdef
MOZ_WAYLAND
#
include
"
WaylandSurface
.
h
"
#
endif
#
include
"
MozContainer
.
h
"
#
include
"
WidgetUtilsGtk
.
h
"
namespace
mozilla
:
:
widget
{
WaylandSurfaceLock
:
:
WaylandSurfaceLock
(
RefPtr
<
WaylandSurface
>
aWaylandSurface
bool
aForceCommit
)
{
#
ifdef
MOZ_WAYLAND
MOZ_DIAGNOSTIC_ASSERT
(
aWaylandSurface
)
;
mWaylandSurface
=
std
:
:
move
(
aWaylandSurface
)
;
mForceCommit
=
aForceCommit
;
if
(
GdkIsWaylandDisplay
(
)
)
{
mSurface
=
mWaylandSurface
-
>
Lock
(
this
)
;
}
#
endif
}
#
ifdef
MOZ_WAYLAND
void
WaylandSurfaceLock
:
:
Commit
(
)
{
if
(
GdkIsWaylandDisplay
(
)
)
{
mWaylandSurface
-
>
Commit
(
this
mForceCommit
false
)
;
}
}
#
endif
WaylandSurfaceLock
:
:
~
WaylandSurfaceLock
(
)
{
#
ifdef
MOZ_WAYLAND
if
(
GdkIsWaylandDisplay
(
)
)
{
Commit
(
)
;
mWaylandSurface
-
>
Unlock
(
&
mSurface
this
)
;
}
#
endif
}
WaylandSurface
*
WaylandSurfaceLock
:
:
GetWaylandSurface
(
)
const
{
#
ifdef
MOZ_WAYLAND
return
mWaylandSurface
.
get
(
)
;
#
else
return
nullptr
;
#
endif
}
}
