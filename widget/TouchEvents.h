#
ifndef
mozilla_TouchEvents_h__
#
define
mozilla_TouchEvents_h__
#
include
<
stdint
.
h
>
#
include
"
mozilla
/
dom
/
Touch
.
h
"
#
include
"
mozilla
/
MouseEvents
.
h
"
#
include
"
mozilla
/
RefPtr
.
h
"
#
include
"
nsTArray
.
h
"
namespace
mozilla
{
class
WidgetGestureNotifyEvent
:
public
WidgetGUIEvent
{
public
:
virtual
WidgetGestureNotifyEvent
*
AsGestureNotifyEvent
(
)
override
{
return
this
;
}
WidgetGestureNotifyEvent
(
bool
aIsTrusted
EventMessage
aMessage
nsIWidget
*
aWidget
const
WidgetEventTime
*
aTime
=
nullptr
)
:
WidgetGUIEvent
(
aIsTrusted
aMessage
aWidget
eGestureNotifyEventClass
aTime
)
mPanDirection
(
ePanNone
)
mDisplayPanFeedback
(
false
)
{
}
virtual
WidgetEvent
*
Duplicate
(
)
const
override
{
MOZ_ASSERT
(
mClass
=
=
eGestureNotifyEventClass
"
Duplicate
(
)
must
be
overridden
by
sub
class
"
)
;
WidgetGestureNotifyEvent
*
result
=
new
WidgetGestureNotifyEvent
(
false
mMessage
nullptr
this
)
;
result
-
>
AssignGestureNotifyEventData
(
*
this
true
)
;
result
-
>
mFlags
=
mFlags
;
return
result
;
}
typedef
int8_t
PanDirectionType
;
enum
PanDirection
:
PanDirectionType
{
ePanNone
ePanVertical
ePanHorizontal
ePanBoth
}
;
PanDirection
mPanDirection
;
bool
mDisplayPanFeedback
;
void
AssignGestureNotifyEventData
(
const
WidgetGestureNotifyEvent
&
aEvent
bool
aCopyTargets
)
{
AssignGUIEventData
(
aEvent
aCopyTargets
)
;
mPanDirection
=
aEvent
.
mPanDirection
;
mDisplayPanFeedback
=
aEvent
.
mDisplayPanFeedback
;
}
}
;
class
WidgetSimpleGestureEvent
:
public
WidgetMouseEventBase
{
public
:
virtual
WidgetSimpleGestureEvent
*
AsSimpleGestureEvent
(
)
override
{
return
this
;
}
WidgetSimpleGestureEvent
(
bool
aIsTrusted
EventMessage
aMessage
nsIWidget
*
aWidget
const
WidgetEventTime
*
aTime
=
nullptr
)
:
WidgetMouseEventBase
(
aIsTrusted
aMessage
aWidget
eSimpleGestureEventClass
aTime
)
mAllowedDirections
(
0
)
mDirection
(
0
)
mClickCount
(
0
)
mDelta
(
0
.
0
)
{
}
WidgetSimpleGestureEvent
(
const
WidgetSimpleGestureEvent
&
aOther
)
:
WidgetMouseEventBase
(
aOther
.
IsTrusted
(
)
aOther
.
mMessage
aOther
.
mWidget
eSimpleGestureEventClass
)
mAllowedDirections
(
aOther
.
mAllowedDirections
)
mDirection
(
aOther
.
mDirection
)
mClickCount
(
0
)
mDelta
(
aOther
.
mDelta
)
{
}
virtual
WidgetEvent
*
Duplicate
(
)
const
override
{
MOZ_ASSERT
(
mClass
=
=
eSimpleGestureEventClass
"
Duplicate
(
)
must
be
overridden
by
sub
class
"
)
;
WidgetSimpleGestureEvent
*
result
=
new
WidgetSimpleGestureEvent
(
false
mMessage
nullptr
this
)
;
result
-
>
AssignSimpleGestureEventData
(
*
this
true
)
;
result
-
>
mFlags
=
mFlags
;
return
result
;
}
uint32_t
mAllowedDirections
;
uint32_t
mDirection
;
uint32_t
mClickCount
;
double
mDelta
;
void
AssignSimpleGestureEventData
(
const
WidgetSimpleGestureEvent
&
aEvent
bool
aCopyTargets
)
{
AssignMouseEventBaseData
(
aEvent
aCopyTargets
)
;
mDirection
=
aEvent
.
mDirection
;
mDelta
=
aEvent
.
mDelta
;
mClickCount
=
aEvent
.
mClickCount
;
}
}
;
class
WidgetTouchEvent
final
:
public
WidgetInputEvent
{
public
:
typedef
nsTArray
<
RefPtr
<
mozilla
:
:
dom
:
:
Touch
>
>
TouchArray
;
typedef
AutoTArray
<
RefPtr
<
mozilla
:
:
dom
:
:
Touch
>
10
>
AutoTouchArray
;
typedef
AutoTouchArray
:
:
base_type
TouchArrayBase
;
WidgetTouchEvent
*
AsTouchEvent
(
)
override
{
return
this
;
}
MOZ_COUNTED_DEFAULT_CTOR
(
WidgetTouchEvent
)
WidgetTouchEvent
(
const
WidgetTouchEvent
&
aOther
)
:
WidgetInputEvent
(
aOther
.
IsTrusted
(
)
aOther
.
mMessage
aOther
.
mWidget
eTouchEventClass
)
{
MOZ_COUNT_CTOR
(
WidgetTouchEvent
)
;
mModifiers
=
aOther
.
mModifiers
;
mTimeStamp
=
aOther
.
mTimeStamp
;
mTouches
.
AppendElements
(
aOther
.
mTouches
)
;
mInputSource
=
aOther
.
mInputSource
;
mButton
=
aOther
.
mButton
;
mButtons
=
aOther
.
mButtons
;
mFlags
.
mCancelable
=
mMessage
!
=
eTouchCancel
;
mFlags
.
mHandledByAPZ
=
aOther
.
mFlags
.
mHandledByAPZ
;
}
WidgetTouchEvent
(
WidgetTouchEvent
&
&
aOther
)
:
WidgetInputEvent
(
std
:
:
move
(
aOther
)
)
{
MOZ_COUNT_CTOR
(
WidgetTouchEvent
)
;
mModifiers
=
aOther
.
mModifiers
;
mTimeStamp
=
aOther
.
mTimeStamp
;
mTouches
=
std
:
:
move
(
aOther
.
mTouches
)
;
mInputSource
=
aOther
.
mInputSource
;
mButton
=
aOther
.
mButton
;
mButtons
=
aOther
.
mButtons
;
mFlags
=
aOther
.
mFlags
;
}
WidgetTouchEvent
&
operator
=
(
WidgetTouchEvent
&
&
)
=
default
;
WidgetTouchEvent
(
bool
aIsTrusted
EventMessage
aMessage
nsIWidget
*
aWidget
const
WidgetEventTime
*
aTime
=
nullptr
)
:
WidgetInputEvent
(
aIsTrusted
aMessage
aWidget
eTouchEventClass
aTime
)
{
MOZ_COUNT_CTOR
(
WidgetTouchEvent
)
;
mFlags
.
mCancelable
=
mMessage
!
=
eTouchCancel
;
}
MOZ_COUNTED_DTOR_OVERRIDE
(
WidgetTouchEvent
)
WidgetEvent
*
Duplicate
(
)
const
override
{
MOZ_ASSERT
(
mClass
=
=
eTouchEventClass
"
Duplicate
(
)
must
be
overridden
by
sub
class
"
)
;
WidgetTouchEvent
*
result
=
new
WidgetTouchEvent
(
false
mMessage
nullptr
this
)
;
result
-
>
AssignTouchEventData
(
*
this
true
)
;
result
-
>
mFlags
=
mFlags
;
return
result
;
}
TouchArray
mTouches
;
uint16_t
mInputSource
=
5
;
int16_t
mButton
=
eNotPressed
;
int16_t
mButtons
=
0
;
void
AssignTouchEventData
(
const
WidgetTouchEvent
&
aEvent
bool
aCopyTargets
)
{
AssignInputEventData
(
aEvent
aCopyTargets
)
;
MOZ_ASSERT
(
mTouches
.
IsEmpty
(
)
)
;
mTouches
.
AppendElements
(
aEvent
.
mTouches
)
;
mInputSource
=
aEvent
.
mInputSource
;
}
}
;
}
#
endif
