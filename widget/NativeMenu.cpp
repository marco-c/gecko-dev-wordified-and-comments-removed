#
include
"
NativeMenu
.
h
"
#
include
"
mozilla
/
dom
/
Element
.
h
"
#
include
"
mozilla
/
dom
/
HTMLImageElement
.
h
"
#
include
"
mozilla
/
dom
/
ResponsiveImageSelector
.
h
"
#
include
"
mozilla
/
ComputedStyle
.
h
"
#
include
"
nsComputedDOMStyle
.
h
"
namespace
mozilla
:
:
widget
{
NativeMenuIcon
NativeMenu
:
:
GetIcon
(
dom
:
:
Element
&
aElement
)
{
RefPtr
img
=
dom
:
:
HTMLImageElement
:
:
FromNodeOrNull
(
aElement
.
GetFirstElementChild
(
)
)
;
if
(
!
img
)
{
return
{
}
;
}
if
(
RefPtr
uri
=
img
-
>
GetCurrentURI
(
)
)
{
return
{
std
:
:
move
(
uri
)
nullptr
}
;
}
if
(
auto
*
selector
=
img
-
>
GetResponsiveImageSelector
(
)
)
{
if
(
RefPtr
uri
=
selector
-
>
GetSelectedImageURL
(
)
)
{
return
{
std
:
:
move
(
uri
)
nullptr
}
;
}
}
RefPtr
<
const
ComputedStyle
>
style
=
nsComputedDOMStyle
:
:
GetComputedStyle
(
img
)
;
if
(
!
style
)
{
return
{
}
;
}
auto
items
=
style
-
>
StyleContent
(
)
-
>
NonAltContentItems
(
)
;
if
(
items
.
Length
(
)
!
=
1
|
|
!
items
[
0
]
.
IsImage
(
)
)
{
return
{
}
;
}
const
auto
*
url
=
items
[
0
]
.
AsImage
(
)
.
GetImageRequestURLValue
(
)
;
if
(
!
url
)
{
return
{
}
;
}
RefPtr
uri
=
url
-
>
GetURI
(
)
;
if
(
!
uri
)
{
return
{
}
;
}
return
{
std
:
:
move
(
uri
)
std
:
:
move
(
style
)
}
;
}
}
