#
ifndef
mozilla_jni_GeckoResultUtils_h
#
define
mozilla_jni_GeckoResultUtils_h
#
include
"
mozilla
/
java
/
GeckoResultNatives
.
h
"
#
include
"
mozilla
/
jni
/
Conversions
.
h
"
namespace
mozilla
{
namespace
jni
{
class
GeckoResultCallback
final
:
public
java
:
:
GeckoResult
:
:
GeckoCallback
:
:
Natives
<
GeckoResultCallback
>
{
public
:
typedef
java
:
:
GeckoResult
:
:
GeckoCallback
:
:
Natives
<
GeckoResultCallback
>
Base
;
typedef
std
:
:
function
<
void
(
mozilla
:
:
jni
:
:
Object
:
:
Param
)
>
OuterCallback
;
void
Call
(
mozilla
:
:
jni
:
:
Object
:
:
Param
aArg
)
{
mCallback
(
aArg
)
;
}
template
<
typename
ArgType
>
static
java
:
:
GeckoResult
:
:
GeckoCallback
:
:
LocalRef
CreateAndAttach
(
std
:
:
function
<
void
(
ArgType
)
>
&
&
aInnerCallback
)
{
auto
java
=
java
:
:
GeckoResult
:
:
GeckoCallback
:
:
New
(
)
;
OuterCallback
outerCallback
=
[
inner
{
std
:
:
move
(
aInnerCallback
)
}
]
(
mozilla
:
:
jni
:
:
Object
:
:
Param
aParam
)
{
ArgType
converted
=
Java2Native
<
ArgType
>
(
aParam
)
;
inner
(
converted
)
;
}
;
auto
native
=
MakeUnique
<
GeckoResultCallback
>
(
std
:
:
move
(
outerCallback
)
)
;
Base
:
:
AttachNative
(
java
std
:
:
move
(
native
)
)
;
return
java
;
}
explicit
GeckoResultCallback
(
OuterCallback
&
&
aCallback
)
:
mCallback
(
std
:
:
move
(
aCallback
)
)
{
}
private
:
OuterCallback
mCallback
;
}
;
}
}
#
endif
