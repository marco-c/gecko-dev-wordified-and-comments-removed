#
ifndef
GeckoSystemStateListener_h
#
define
GeckoSystemStateListener_h
#
include
"
mozilla
/
Assertions
.
h
"
#
include
"
mozilla
/
PresShell
.
h
"
#
include
"
mozilla
/
dom
/
Document
.
h
"
#
include
"
mozilla
/
java
/
GeckoSystemStateListenerNatives
.
h
"
#
include
"
nsIWindowMediator
.
h
"
#
include
"
nsPIDOMWindow
.
h
"
namespace
mozilla
{
class
GeckoSystemStateListener
final
:
public
java
:
:
GeckoSystemStateListener
:
:
Natives
<
GeckoSystemStateListener
>
{
GeckoSystemStateListener
(
)
=
delete
;
public
:
static
void
OnDeviceChanged
(
)
{
MOZ_ASSERT
(
NS_IsMainThread
(
)
)
;
nsCOMPtr
<
nsIWindowMediator
>
windowMediator
=
do_GetService
(
NS_WINDOWMEDIATOR_CONTRACTID
)
;
NS_ENSURE_TRUE_VOID
(
windowMediator
)
;
nsCOMPtr
<
nsISimpleEnumerator
>
windowEnumerator
;
windowMediator
-
>
GetEnumerator
(
nullptr
getter_AddRefs
(
windowEnumerator
)
)
;
NS_ENSURE_TRUE_VOID
(
windowEnumerator
)
;
bool
more
;
while
(
NS_SUCCEEDED
(
windowEnumerator
-
>
HasMoreElements
(
&
more
)
)
&
&
more
)
{
nsCOMPtr
<
nsISupports
>
elements
;
if
(
NS_FAILED
(
windowEnumerator
-
>
GetNext
(
getter_AddRefs
(
elements
)
)
)
)
{
break
;
}
if
(
nsCOMPtr
<
nsPIDOMWindowOuter
>
window
=
do_QueryInterface
(
elements
)
)
{
if
(
window
-
>
Closed
(
)
)
{
continue
;
}
if
(
dom
:
:
Document
*
doc
=
window
-
>
GetExtantDoc
(
)
)
{
if
(
PresShell
*
presShell
=
doc
-
>
GetPresShell
(
)
)
{
presShell
-
>
ThemeChanged
(
)
;
}
}
}
}
}
}
;
}
#
endif
