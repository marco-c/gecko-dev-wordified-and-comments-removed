#
include
"
HeadlessScreenHelper
.
h
"
#
include
"
prenv
.
h
"
#
include
"
mozilla
/
dom
/
DOMTypes
.
h
"
#
include
"
mozilla
/
RefPtr
.
h
"
#
include
"
nsTArray
.
h
"
namespace
mozilla
{
namespace
widget
{
LayoutDeviceIntRect
HeadlessScreenHelper
:
:
GetScreenRect
(
)
{
char
*
ev
=
PR_GetEnv
(
"
MOZ_HEADLESS_WIDTH
"
)
;
int
width
=
1366
;
if
(
ev
)
{
width
=
atoi
(
ev
)
;
}
ev
=
PR_GetEnv
(
"
MOZ_HEADLESS_HEIGHT
"
)
;
int
height
=
768
;
if
(
ev
)
{
height
=
atoi
(
ev
)
;
}
return
LayoutDeviceIntRect
(
0
0
width
height
)
;
}
HeadlessScreenHelper
:
:
HeadlessScreenHelper
(
)
{
AutoTArray
<
RefPtr
<
Screen
>
1
>
screenList
;
LayoutDeviceIntRect
rect
=
GetScreenRect
(
)
;
auto
ret
=
MakeRefPtr
<
Screen
>
(
rect
rect
24
24
0
DesktopToLayoutDeviceScale
(
)
CSSToLayoutDeviceScale
(
)
96
.
0f
Screen
:
:
IsPseudoDisplay
:
:
No
)
;
screenList
.
AppendElement
(
ret
.
forget
(
)
)
;
ScreenManager
:
:
Refresh
(
std
:
:
move
(
screenList
)
)
;
}
}
}
