#
include
"
nsMenuGroupOwnerX
.
h
"
#
include
"
nsMenuBarX
.
h
"
#
include
"
nsMenuX
.
h
"
#
include
"
nsMenuItemX
.
h
"
#
include
"
nsMenuUtilsX
.
h
"
#
include
"
nsCocoaUtils
.
h
"
#
include
"
nsCocoaWindow
.
h
"
#
include
"
nsCOMPtr
.
h
"
#
include
"
nsString
.
h
"
#
include
"
nsObjCExceptions
.
h
"
#
include
"
nsThreadUtils
.
h
"
#
include
"
mozilla
/
dom
/
Element
.
h
"
#
include
"
nsIWidget
.
h
"
#
include
"
mozilla
/
dom
/
Document
.
h
"
#
include
"
nsINode
.
h
"
using
namespace
mozilla
;
NS_IMPL_ISUPPORTS
(
nsMenuGroupOwnerX
nsIMutationObserver
)
nsMenuGroupOwnerX
:
:
nsMenuGroupOwnerX
(
)
:
mCurrentCommandID
(
eCommand_ID_Last
)
{
mInfoSet
=
[
[
NSMutableSet
setWithCapacity
:
10
]
retain
]
;
}
nsMenuGroupOwnerX
:
:
~
nsMenuGroupOwnerX
(
)
{
MOZ_ASSERT
(
mContentToObserverTable
.
Count
(
)
=
=
0
"
have
outstanding
mutation
observers
!
\
n
"
)
;
NSEnumerator
*
counter
=
[
mInfoSet
objectEnumerator
]
;
MenuItemInfo
*
info
;
while
(
(
info
=
(
MenuItemInfo
*
)
[
counter
nextObject
]
)
)
{
[
info
setMenuGroupOwner
:
nil
]
;
}
[
mInfoSet
release
]
;
}
nsresult
nsMenuGroupOwnerX
:
:
Create
(
mozilla
:
:
dom
:
:
Element
*
aContent
)
{
if
(
!
aContent
)
{
return
NS_ERROR_INVALID_ARG
;
}
mContent
=
aContent
;
return
NS_OK
;
}
void
nsMenuGroupOwnerX
:
:
CharacterDataWillChange
(
nsIContent
*
aContent
const
CharacterDataChangeInfo
&
)
{
}
void
nsMenuGroupOwnerX
:
:
CharacterDataChanged
(
nsIContent
*
aContent
const
CharacterDataChangeInfo
&
)
{
}
void
nsMenuGroupOwnerX
:
:
ContentAppended
(
nsIContent
*
aFirstNewContent
)
{
for
(
nsIContent
*
cur
=
aFirstNewContent
;
cur
;
cur
=
cur
-
>
GetNextSibling
(
)
)
{
ContentInserted
(
cur
)
;
}
}
void
nsMenuGroupOwnerX
:
:
NodeWillBeDestroyed
(
const
nsINode
*
aNode
)
{
}
void
nsMenuGroupOwnerX
:
:
AttributeWillChange
(
dom
:
:
Element
*
aContent
int32_t
aNameSpaceID
nsAtom
*
aAttribute
int32_t
aModType
)
{
}
void
nsMenuGroupOwnerX
:
:
NativeAnonymousChildListChange
(
nsIContent
*
aContent
bool
aIsRemove
)
{
}
void
nsMenuGroupOwnerX
:
:
AttributeChanged
(
dom
:
:
Element
*
aElement
int32_t
aNameSpaceID
nsAtom
*
aAttribute
int32_t
aModType
const
nsAttrValue
*
aOldValue
)
{
nsCOMPtr
<
nsIMutationObserver
>
kungFuDeathGrip
(
this
)
;
nsChangeObserver
*
obs
=
LookupContentChangeObserver
(
aElement
)
;
if
(
obs
)
{
obs
-
>
ObserveAttributeChanged
(
aElement
-
>
OwnerDoc
(
)
aElement
aAttribute
)
;
}
}
void
nsMenuGroupOwnerX
:
:
ContentRemoved
(
nsIContent
*
aChild
nsIContent
*
aPreviousSibling
)
{
nsIContent
*
container
=
aChild
-
>
GetParent
(
)
;
if
(
!
container
)
{
return
;
}
nsCOMPtr
<
nsIMutationObserver
>
kungFuDeathGrip
(
this
)
;
nsChangeObserver
*
obs
=
LookupContentChangeObserver
(
container
)
;
if
(
obs
)
{
obs
-
>
ObserveContentRemoved
(
aChild
-
>
OwnerDoc
(
)
container
aChild
aPreviousSibling
)
;
}
else
if
(
container
!
=
mContent
)
{
nsCOMPtr
<
nsIContent
>
parent
=
container
-
>
GetParent
(
)
;
if
(
parent
)
{
obs
=
LookupContentChangeObserver
(
parent
)
;
if
(
obs
)
{
obs
-
>
ObserveContentRemoved
(
aChild
-
>
OwnerDoc
(
)
aChild
-
>
GetParent
(
)
aChild
aPreviousSibling
)
;
}
}
}
}
void
nsMenuGroupOwnerX
:
:
ContentInserted
(
nsIContent
*
aChild
)
{
nsIContent
*
container
=
aChild
-
>
GetParent
(
)
;
if
(
!
container
)
{
return
;
}
nsCOMPtr
<
nsIMutationObserver
>
kungFuDeathGrip
(
this
)
;
nsChangeObserver
*
obs
=
LookupContentChangeObserver
(
container
)
;
if
(
obs
)
{
obs
-
>
ObserveContentInserted
(
aChild
-
>
OwnerDoc
(
)
container
aChild
)
;
}
else
if
(
container
!
=
mContent
)
{
nsCOMPtr
<
nsIContent
>
parent
=
container
-
>
GetParent
(
)
;
if
(
parent
)
{
obs
=
LookupContentChangeObserver
(
parent
)
;
if
(
obs
)
{
obs
-
>
ObserveContentInserted
(
aChild
-
>
OwnerDoc
(
)
container
aChild
)
;
}
}
}
}
void
nsMenuGroupOwnerX
:
:
ParentChainChanged
(
nsIContent
*
aContent
)
{
}
void
nsMenuGroupOwnerX
:
:
RegisterForContentChanges
(
nsIContent
*
aContent
nsChangeObserver
*
aMenuObject
)
{
if
(
!
mContentToObserverTable
.
Contains
(
aContent
)
)
{
aContent
-
>
AddMutationObserver
(
this
)
;
}
mContentToObserverTable
.
Put
(
aContent
aMenuObject
)
;
}
void
nsMenuGroupOwnerX
:
:
UnregisterForContentChanges
(
nsIContent
*
aContent
)
{
if
(
mContentToObserverTable
.
Contains
(
aContent
)
)
{
aContent
-
>
RemoveMutationObserver
(
this
)
;
}
mContentToObserverTable
.
Remove
(
aContent
)
;
}
nsChangeObserver
*
nsMenuGroupOwnerX
:
:
LookupContentChangeObserver
(
nsIContent
*
aContent
)
{
nsChangeObserver
*
result
;
if
(
mContentToObserverTable
.
Get
(
aContent
&
result
)
)
{
return
result
;
}
return
nullptr
;
}
uint32_t
nsMenuGroupOwnerX
:
:
RegisterForCommand
(
nsMenuItemX
*
inMenuItem
)
{
+
+
mCurrentCommandID
;
mCommandToMenuObjectTable
.
Put
(
mCurrentCommandID
inMenuItem
)
;
return
mCurrentCommandID
;
}
void
nsMenuGroupOwnerX
:
:
UnregisterCommand
(
uint32_t
inCommandID
)
{
mCommandToMenuObjectTable
.
Remove
(
inCommandID
)
;
}
nsMenuItemX
*
nsMenuGroupOwnerX
:
:
GetMenuItemForCommandID
(
uint32_t
inCommandID
)
{
nsMenuItemX
*
result
;
if
(
mCommandToMenuObjectTable
.
Get
(
inCommandID
&
result
)
)
{
return
result
;
}
return
nullptr
;
}
void
nsMenuGroupOwnerX
:
:
AddMenuItemInfoToSet
(
MenuItemInfo
*
info
)
{
[
mInfoSet
addObject
:
info
]
;
}
