#
ifndef
nsMenuBarX_h_
#
define
nsMenuBarX_h_
#
import
<
Cocoa
/
Cocoa
.
h
>
#
include
"
mozilla
/
UniquePtr
.
h
"
#
include
"
mozilla
/
WeakPtr
.
h
"
#
include
"
nsISupports
.
h
"
#
include
"
nsMenuParentX
.
h
"
#
include
"
nsMenuGroupOwnerX
.
h
"
#
include
"
nsChangeObserver
.
h
"
#
include
"
nsTArray
.
h
"
#
include
"
nsString
.
h
"
class
nsMenuBarX
;
class
nsMenuX
;
class
nsIWidget
;
class
nsIContent
;
namespace
mozilla
{
namespace
dom
{
class
Document
;
class
Element
;
}
}
interface
ApplicationMenuDelegate
:
NSObject
<
NSMenuDelegate
>
{
nsMenuBarX
*
mApplicationMenu
;
}
-
(
id
)
initWithApplicationMenu
:
(
nsMenuBarX
*
)
aApplicationMenu
;
end
interface
GeckoNSMenu
:
NSMenu
{
}
-
(
BOOL
)
performSuperKeyEquivalent
:
(
NSEvent
*
)
aEvent
;
end
interface
NativeMenuItemTarget
:
NSObject
{
}
-
(
IBAction
)
menuItemHit
:
(
id
)
aSender
;
end
interface
GeckoServicesNSMenuItem
:
NSMenuItem
{
}
-
(
id
)
target
;
-
(
SEL
)
action
;
-
(
void
)
_doNothing
:
(
id
)
aSender
;
end
interface
GeckoServicesNSMenu
:
NSMenu
{
}
-
(
void
)
addItem
:
(
NSMenuItem
*
)
aNewItem
;
-
(
NSMenuItem
*
)
addItemWithTitle
:
(
NSString
*
)
aString
action
:
(
SEL
)
aSelector
keyEquivalent
:
(
NSString
*
)
aKeyEquiv
;
-
(
void
)
insertItem
:
(
NSMenuItem
*
)
aNewItem
atIndex
:
(
NSInteger
)
aIndex
;
-
(
NSMenuItem
*
)
insertItemWithTitle
:
(
NSString
*
)
aString
action
:
(
SEL
)
aSelector
keyEquivalent
:
(
NSString
*
)
aKeyEquiv
atIndex
:
(
NSInteger
)
aIndex
;
-
(
void
)
_overrideClassOfMenuItem
:
(
NSMenuItem
*
)
aMenuItem
;
end
class
nsMenuBarX
:
public
nsMenuParentX
public
nsChangeObserver
public
mozilla
:
:
SupportsWeakPtr
{
public
:
explicit
nsMenuBarX
(
mozilla
:
:
dom
:
:
Element
*
aElement
)
;
NS_INLINE_DECL_REFCOUNTING
(
nsMenuBarX
)
static
NativeMenuItemTarget
*
sNativeEventTarget
;
static
nsMenuBarX
*
sLastGeckoMenuBarPainted
;
RefPtr
<
nsIContent
>
mAboutItemContent
;
RefPtr
<
nsIContent
>
mPrefItemContent
;
RefPtr
<
nsIContent
>
mAccountItemContent
;
RefPtr
<
nsIContent
>
mQuitItemContent
;
NS_DECL_CHANGEOBSERVER
nsMenuBarX
*
AsMenuBar
(
)
override
{
return
this
;
}
uint32_t
GetMenuCount
(
)
;
bool
MenuContainsAppMenu
(
)
;
nsMenuX
*
GetMenuAt
(
uint32_t
aIndex
)
;
nsMenuX
*
GetXULHelpMenu
(
)
;
void
SetSystemHelpMenu
(
)
;
nsresult
Paint
(
)
;
void
ForceUpdateNativeMenuAt
(
const
nsAString
&
aIndexString
)
;
void
ForceNativeMenuReload
(
)
;
static
void
ResetNativeApplicationMenu
(
)
;
void
SetNeedsRebuild
(
)
;
void
ApplicationMenuOpened
(
)
;
bool
PerformKeyEquivalent
(
NSEvent
*
aEvent
)
;
GeckoNSMenu
*
NativeNSMenu
(
)
{
return
mNativeMenu
;
}
void
MenuChildChangedVisibility
(
const
MenuChild
&
aChild
bool
aIsVisible
)
override
;
protected
:
virtual
~
nsMenuBarX
(
)
;
void
ConstructNativeMenus
(
)
;
void
ConstructFallbackNativeMenus
(
)
;
void
InsertMenuAtIndex
(
RefPtr
<
nsMenuX
>
&
&
aMenu
uint32_t
aIndex
)
;
void
RemoveMenuAtIndex
(
uint32_t
aIndex
)
;
RefPtr
<
mozilla
:
:
dom
:
:
Element
>
HideItem
(
mozilla
:
:
dom
:
:
Document
*
aDocument
const
nsAString
&
aID
)
;
void
AquifyMenuBar
(
)
;
NSMenuItem
*
CreateNativeAppMenuItem
(
nsMenuX
*
aMenu
const
nsAString
&
aNodeID
SEL
aAction
int
aTag
NativeMenuItemTarget
*
aTarget
)
;
void
CreateApplicationMenu
(
nsMenuX
*
aMenu
)
;
NSInteger
CalculateNativeInsertionPoint
(
nsMenuX
*
aChild
)
;
RefPtr
<
nsIContent
>
mContent
;
RefPtr
<
nsMenuGroupOwnerX
>
mMenuGroupOwner
;
nsTArray
<
RefPtr
<
nsMenuX
>
>
mMenuArray
;
GeckoNSMenu
*
mNativeMenu
;
bool
mNeedsRebuild
;
ApplicationMenuDelegate
*
mApplicationMenuDelegate
;
}
;
#
endif
