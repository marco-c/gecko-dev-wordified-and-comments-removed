#
include
"
KeyboardLayout
.
h
"
#
include
"
mozilla
/
TextEventDispatcher
.
h
"
#
include
"
mozilla
/
widget
/
IMEData
.
h
"
#
include
"
nsWindow
.
h
"
#
include
"
WinIMEHandler
.
h
"
#
include
"
WinTextEventDispatcherListener
.
h
"
namespace
mozilla
{
namespace
widget
{
StaticRefPtr
<
WinTextEventDispatcherListener
>
WinTextEventDispatcherListener
:
:
sInstance
;
WinTextEventDispatcherListener
*
WinTextEventDispatcherListener
:
:
GetInstance
(
)
{
if
(
!
sInstance
)
{
sInstance
=
new
WinTextEventDispatcherListener
(
)
;
}
return
sInstance
.
get
(
)
;
}
void
WinTextEventDispatcherListener
:
:
Shutdown
(
)
{
sInstance
=
nullptr
;
}
NS_IMPL_ISUPPORTS
(
WinTextEventDispatcherListener
TextEventDispatcherListener
nsISupportsWeakReference
)
WinTextEventDispatcherListener
:
:
WinTextEventDispatcherListener
(
)
{
}
WinTextEventDispatcherListener
:
:
~
WinTextEventDispatcherListener
(
)
{
}
NS_IMETHODIMP
WinTextEventDispatcherListener
:
:
NotifyIME
(
TextEventDispatcher
*
aTextEventDispatcher
const
IMENotification
&
aNotification
)
{
nsWindow
*
window
=
static_cast
<
nsWindow
*
>
(
aTextEventDispatcher
-
>
GetWidget
(
)
)
;
if
(
NS_WARN_IF
(
!
window
)
)
{
return
NS_ERROR_FAILURE
;
}
return
IMEHandler
:
:
NotifyIME
(
window
aNotification
)
;
}
NS_IMETHODIMP_
(
void
)
WinTextEventDispatcherListener
:
:
OnRemovedFrom
(
TextEventDispatcher
*
aTextEventDispatcher
)
{
}
NS_IMETHODIMP_
(
void
)
WinTextEventDispatcherListener
:
:
WillDispatchKeyboardEvent
(
TextEventDispatcher
*
aTextEventDispatcher
WidgetKeyboardEvent
&
aKeyboardEvent
uint32_t
aIndexOfKeypress
void
*
aData
)
{
static_cast
<
NativeKey
*
>
(
aData
)
-
>
WillDispatchKeyboardEvent
(
aKeyboardEvent
aIndexOfKeypress
)
;
}
}
}
