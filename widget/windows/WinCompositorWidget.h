#
ifndef
widget_windows_WinCompositorWidget_h
#
define
widget_windows_WinCompositorWidget_h
#
include
"
CompositorWidget
.
h
"
#
include
"
gfxASurface
.
h
"
#
include
"
mozilla
/
Atomics
.
h
"
#
include
"
mozilla
/
gfx
/
CriticalSection
.
h
"
#
include
"
mozilla
/
gfx
/
Point
.
h
"
#
include
"
mozilla
/
layers
/
LayersTypes
.
h
"
#
include
"
mozilla
/
Mutex
.
h
"
#
include
"
mozilla
/
widget
/
WinCompositorWindowThread
.
h
"
#
include
"
FxROutputHandler
.
h
"
#
include
"
nsIWidget
.
h
"
class
nsWindow
;
namespace
mozilla
{
namespace
widget
{
class
PlatformCompositorWidgetDelegate
:
public
CompositorWidgetDelegate
{
public
:
virtual
void
EnterPresentLock
(
)
=
0
;
virtual
void
LeavePresentLock
(
)
=
0
;
virtual
void
OnDestroyWindow
(
)
=
0
;
virtual
void
UpdateTransparency
(
nsTransparencyMode
aMode
)
=
0
;
virtual
void
ClearTransparentWindow
(
)
=
0
;
virtual
HDC
GetTransparentDC
(
)
const
=
0
;
virtual
void
SetParentWnd
(
const
HWND
aParentWnd
)
{
}
virtual
void
UpdateCompositorWnd
(
const
HWND
aCompositorWnd
const
HWND
aParentWnd
)
{
}
virtual
void
SetRootLayerTreeID
(
const
layers
:
:
LayersId
&
aRootLayerTreeId
)
{
}
PlatformCompositorWidgetDelegate
*
AsPlatformSpecificDelegate
(
)
override
{
return
this
;
}
}
;
class
WinCompositorWidgetInitData
;
class
WinCompositorWidget
:
public
CompositorWidget
public
PlatformCompositorWidgetDelegate
{
public
:
WinCompositorWidget
(
const
WinCompositorWidgetInitData
&
aInitData
const
layers
:
:
CompositorOptions
&
aOptions
)
;
~
WinCompositorWidget
(
)
override
;
uintptr_t
GetWidgetKey
(
)
override
;
WinCompositorWidget
*
AsWindows
(
)
override
{
return
this
;
}
CompositorWidgetDelegate
*
AsDelegate
(
)
override
{
return
this
;
}
virtual
bool
RedrawTransparentWindow
(
)
=
0
;
virtual
RefPtr
<
gfxASurface
>
EnsureTransparentSurface
(
)
=
0
;
HWND
GetHwnd
(
)
const
{
return
mCompositorWnds
.
mCompositorWnd
?
mCompositorWnds
.
mCompositorWnd
:
mWnd
;
}
HWND
GetCompositorHwnd
(
)
const
{
return
mCompositorWnds
.
mCompositorWnd
;
}
void
EnsureCompositorWindow
(
)
;
void
DestroyCompositorWindow
(
)
;
void
UpdateCompositorWndSizeIfNecessary
(
)
;
virtual
mozilla
:
:
Mutex
&
GetTransparentSurfaceLock
(
)
=
0
;
void
RequestFxrOutput
(
)
;
bool
HasFxrOutputHandler
(
)
const
{
return
mFxrHandler
!
=
nullptr
;
}
FxROutputHandler
*
GetFxrOutputHandler
(
)
const
{
return
mFxrHandler
.
get
(
)
;
}
virtual
bool
HasGlass
(
)
const
=
0
;
protected
:
bool
mSetParentCompleted
;
private
:
uintptr_t
mWidgetKey
;
HWND
mWnd
;
WinCompositorWnds
mCompositorWnds
;
LayoutDeviceIntSize
mLastCompositorWndSize
;
UniquePtr
<
FxROutputHandler
>
mFxrHandler
;
}
;
}
}
#
endif
