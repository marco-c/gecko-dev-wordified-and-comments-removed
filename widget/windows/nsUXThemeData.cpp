#
include
"
mozilla
/
ArrayUtils
.
h
"
#
include
"
mozilla
/
WindowsVersion
.
h
"
#
include
"
nsUXThemeData
.
h
"
#
include
"
nsDebug
.
h
"
#
include
"
nsToolkit
.
h
"
#
include
"
nsUXThemeConstants
.
h
"
#
include
"
gfxWindowsPlatform
.
h
"
using
namespace
mozilla
;
using
namespace
mozilla
:
:
widget
;
MOZ_RUNINIT
nsUXThemeData
:
:
ThemeHandle
nsUXThemeData
:
:
sThemes
[
eUXNumClasses
]
;
nsUXThemeData
:
:
ThemeHandle
:
:
~
ThemeHandle
(
)
{
Close
(
)
;
}
void
nsUXThemeData
:
:
ThemeHandle
:
:
OpenOnce
(
HWND
aWindow
LPCWSTR
aClassList
)
{
if
(
mHandle
.
isSome
(
)
)
{
return
;
}
mHandle
=
Some
(
OpenThemeData
(
aWindow
aClassList
)
)
;
}
void
nsUXThemeData
:
:
ThemeHandle
:
:
Close
(
)
{
if
(
mHandle
.
isNothing
(
)
)
{
return
;
}
if
(
HANDLE
rawHandle
=
mHandle
.
extract
(
)
)
{
CloseThemeData
(
rawHandle
)
;
}
}
nsUXThemeData
:
:
ThemeHandle
:
:
operator
HANDLE
(
)
{
return
mHandle
.
valueOr
(
nullptr
)
;
}
void
nsUXThemeData
:
:
Invalidate
(
)
{
for
(
auto
&
theme
:
sThemes
)
{
theme
.
Close
(
)
;
}
}
HANDLE
nsUXThemeData
:
:
GetTheme
(
nsUXThemeClass
cls
)
{
NS_ASSERTION
(
cls
<
eUXNumClasses
"
Invalid
theme
class
!
"
)
;
sThemes
[
cls
]
.
OpenOnce
(
nullptr
GetClassName
(
cls
)
)
;
return
sThemes
[
cls
]
;
}
const
wchar_t
*
nsUXThemeData
:
:
GetClassName
(
nsUXThemeClass
cls
)
{
switch
(
cls
)
{
case
eUXButton
:
return
L
"
Button
"
;
case
eUXEdit
:
return
L
"
Edit
"
;
case
eUXToolbar
:
return
L
"
Toolbar
"
;
case
eUXProgress
:
return
L
"
Progress
"
;
case
eUXTab
:
return
L
"
Tab
"
;
case
eUXTrackbar
:
return
L
"
Trackbar
"
;
case
eUXCombobox
:
return
L
"
Combobox
"
;
case
eUXListview
:
return
L
"
Listview
"
;
case
eUXMenu
:
return
L
"
Menu
"
;
default
:
MOZ_ASSERT_UNREACHABLE
(
"
unknown
uxtheme
class
"
)
;
return
L
"
"
;
}
}
bool
nsUXThemeData
:
:
sIsHighContrastOn
=
false
;
void
nsUXThemeData
:
:
UpdateNativeThemeInfo
(
)
{
HIGHCONTRAST
highContrastInfo
;
highContrastInfo
.
cbSize
=
sizeof
(
HIGHCONTRAST
)
;
sIsHighContrastOn
=
SystemParametersInfo
(
SPI_GETHIGHCONTRAST
0
&
highContrastInfo
0
)
&
&
highContrastInfo
.
dwFlags
&
HCF_HIGHCONTRASTON
;
}
