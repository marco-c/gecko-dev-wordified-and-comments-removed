#
ifndef
WIDGET_WINDOWS_WINDOWSSTMCPROVIDER_H_
#
define
WIDGET_WINDOWS_WINDOWSSTMCPROVIDER_H_
#
ifndef
__MINGW32__
#
include
<
functional
>
#
include
<
Windows
.
Media
.
h
>
#
include
<
wrl
.
h
>
#
include
"
mozilla
/
dom
/
MediaController
.
h
"
#
include
"
mozilla
/
dom
/
MediaControlKeySource
.
h
"
#
include
"
mozilla
/
Maybe
.
h
"
using
ISMTC
=
ABI
:
:
Windows
:
:
Media
:
:
ISystemMediaTransportControls
;
using
SMTCProperty
=
ABI
:
:
Windows
:
:
Media
:
:
SystemMediaTransportControlsProperty
;
using
ISMTCDisplayUpdater
=
ABI
:
:
Windows
:
:
Media
:
:
ISystemMediaTransportControlsDisplayUpdater
;
struct
SMTCControlAttributes
{
bool
mEnabled
;
bool
mPlayPauseEnabled
;
bool
mNextEnabled
;
bool
mPreviousEnabled
;
static
constexpr
SMTCControlAttributes
EnableAll
(
)
{
return
{
true
true
true
true
}
;
}
static
constexpr
SMTCControlAttributes
DisableAll
(
)
{
return
{
false
false
false
false
}
;
}
}
;
class
WindowsSMTCProvider
final
:
public
mozilla
:
:
dom
:
:
MediaControlKeySource
{
NS_INLINE_DECL_REFCOUNTING
(
WindowsSMTCProvider
override
)
public
:
WindowsSMTCProvider
(
)
;
bool
IsOpened
(
)
const
override
;
bool
Open
(
)
override
;
void
Close
(
)
override
;
void
SetPlaybackState
(
mozilla
:
:
dom
:
:
MediaSessionPlaybackState
aState
)
override
;
void
SetMediaMetadata
(
const
mozilla
:
:
dom
:
:
MediaMetadataBase
&
aMetadata
)
override
;
void
SetSupportedMediaKeys
(
const
MediaKeysArray
&
aSupportedKeys
)
override
{
}
private
:
~
WindowsSMTCProvider
(
)
;
void
UnregisterEvents
(
)
;
bool
RegisterEvents
(
)
;
void
OnButtonPressed
(
mozilla
:
:
dom
:
:
MediaControlKey
aKey
)
;
bool
InitDisplayAndControls
(
)
;
bool
SetControlAttributes
(
SMTCControlAttributes
aAttributes
)
;
bool
RefreshDisplay
(
)
;
bool
SetMusicMetadata
(
const
wchar_t
*
aArtist
const
wchar_t
*
aTitle
const
wchar_t
*
aAlbumArtist
)
;
bool
SetThumbnail
(
const
wchar_t
*
aUrl
)
;
bool
mInitialized
=
false
;
Microsoft
:
:
WRL
:
:
ComPtr
<
ISMTC
>
mControls
;
Microsoft
:
:
WRL
:
:
ComPtr
<
ISMTCDisplayUpdater
>
mDisplay
;
HWND
mWindow
;
EventRegistrationToken
mButtonPressedToken
;
}
;
#
endif
#
endif
