#
ifndef
WIDGET_WINDOWS_WINDOWSSTMCPROVIDER_H_
#
define
WIDGET_WINDOWS_WINDOWSSTMCPROVIDER_H_
#
ifndef
__MINGW32__
#
include
<
functional
>
#
include
<
Windows
.
Media
.
h
>
#
include
<
wrl
.
h
>
#
include
"
mozilla
\
dom
\
MediaController
.
h
"
#
include
"
mozilla
\
dom
\
MediaControlKeysEvent
.
h
"
#
include
"
mozilla
\
Maybe
.
h
"
using
ISMTC
=
ABI
:
:
Windows
:
:
Media
:
:
ISystemMediaTransportControls
;
using
SMTCProperty
=
ABI
:
:
Windows
:
:
Media
:
:
SystemMediaTransportControlsProperty
;
using
IMSTCDisplayUpdater
=
ABI
:
:
Windows
:
:
Media
:
:
ISystemMediaTransportControlsDisplayUpdater
;
struct
SMTCControlAttributes
{
bool
mEnabled
;
bool
mPlayPauseEnabled
;
bool
mNextEnabled
;
bool
mPreviousEnabled
;
static
constexpr
SMTCControlAttributes
EnableAll
(
)
{
return
{
true
true
true
true
}
;
}
static
constexpr
SMTCControlAttributes
DisableAll
(
)
{
return
{
false
false
false
false
}
;
}
}
;
class
WindowsSMTCProvider
final
:
public
mozilla
:
:
dom
:
:
MediaControlKeysEventSource
{
NS_INLINE_DECL_REFCOUNTING
(
WindowsSMTCProvider
override
)
public
:
WindowsSMTCProvider
(
)
;
bool
IsOpened
(
)
const
override
;
bool
Open
(
)
override
;
void
Close
(
)
override
;
bool
SetControlAttributes
(
SMTCControlAttributes
aAttributes
)
;
void
SetPlaybackState
(
mozilla
:
:
dom
:
:
PlaybackState
aState
)
override
;
bool
SetThumbnail
(
const
wchar_t
*
aUrl
)
;
bool
SetMusicMetadata
(
mozilla
:
:
Maybe
<
const
wchar_t
*
>
aArtist
const
wchar_t
*
aTitle
mozilla
:
:
Maybe
<
const
wchar_t
*
>
aAlbumArtist
)
;
private
:
~
WindowsSMTCProvider
(
)
;
void
UnregisterEvents
(
)
;
bool
RegisterEvents
(
)
;
bool
InitDisplayAndControls
(
)
;
void
OnButtonPressed
(
mozilla
:
:
dom
:
:
MediaControlKeysEvent
aEvent
)
;
bool
Update
(
)
;
bool
mInitialized
=
false
;
Microsoft
:
:
WRL
:
:
ComPtr
<
ISMTC
>
mControls
;
Microsoft
:
:
WRL
:
:
ComPtr
<
IMSTCDisplayUpdater
>
mDisplay
;
HWND
mWindow
;
EventRegistrationToken
mButtonPressedToken
;
}
;
#
endif
#
endif
