#
ifndef
__JumpListBuilder_h__
#
define
__JumpListBuilder_h__
#
include
<
windows
.
h
>
#
undef
NTDDI_VERSION
#
define
NTDDI_VERSION
NTDDI_WIN7
#
include
<
shobjidl
.
h
>
#
undef
LogSeverity
/
/
SetupAPI
.
h
#
defines
this
as
DWORD
#
include
"
nsString
.
h
"
#
include
"
nsIJumpListBuilder
.
h
"
#
include
"
nsIJumpListItem
.
h
"
#
include
"
JumpListItem
.
h
"
#
include
"
nsIObserver
.
h
"
#
include
"
nsTArray
.
h
"
#
include
"
mozilla
/
Attributes
.
h
"
#
include
"
mozilla
/
mscom
/
AgileReference
.
h
"
#
include
"
mozilla
/
ReentrantMonitor
.
h
"
namespace
mozilla
{
namespace
widget
{
namespace
detail
{
class
DoneCommitListBuildCallback
;
}
class
JumpListBuilder
:
public
nsIJumpListBuilder
public
nsIObserver
{
virtual
~
JumpListBuilder
(
)
;
public
:
NS_DECL_THREADSAFE_ISUPPORTS
NS_DECL_NSIJUMPLISTBUILDER
NS_DECL_NSIOBSERVER
JumpListBuilder
(
)
;
protected
:
static
Atomic
<
bool
>
sBuildingList
;
private
:
mscom
:
:
AgileReference
mJumpListMgr
;
uint32_t
mMaxItems
;
bool
mHasCommit
;
nsCOMPtr
<
nsIThread
>
mIOThread
;
ReentrantMonitor
mMonitor
;
bool
IsSeparator
(
nsCOMPtr
<
nsIJumpListItem
>
&
item
)
;
void
RemoveIconCacheAndGetJumplistShortcutURIs
(
IObjectArray
*
aObjArray
nsTArray
<
nsString
>
&
aURISpecs
)
;
void
DeleteIconFromDisk
(
const
nsAString
&
aPath
)
;
nsresult
RemoveIconCacheForAllItems
(
)
;
void
DoCommitListBuild
(
RefPtr
<
detail
:
:
DoneCommitListBuildCallback
>
aCallback
)
;
void
DoInitListBuild
(
RefPtr
<
dom
:
:
Promise
>
&
&
aPromise
)
;
friend
class
WinTaskbar
;
}
;
}
}
#
endif
