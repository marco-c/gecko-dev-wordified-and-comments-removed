"
use
strict
"
;
addRDMTask
(
null
async
function
(
)
{
const
NEW_WINDOW_URL
=
"
data
:
text
/
html
;
charset
=
utf
-
8
New
window
opened
via
window
.
open
"
;
const
newWindowPromise
=
BrowserTestUtils
.
waitForNewWindow
(
{
url
:
NEW_WINDOW_URL
}
)
;
window
.
open
(
NEW_WINDOW_URL
"
_blank
"
"
noopener
all
"
)
;
const
newWindow
=
await
newWindowPromise
;
ok
(
true
"
Got
new
window
"
)
;
info
(
"
Focus
new
window
"
)
;
newWindow
.
focus
(
)
;
info
(
"
Open
RDM
"
)
;
const
tab
=
newWindow
.
gBrowser
.
selectedTab
;
const
{
ui
}
=
await
openRDM
(
tab
)
;
await
waitForDeviceAndViewportState
(
ui
)
;
ok
(
ResponsiveUIManager
.
isActiveForTab
(
tab
)
"
ResponsiveUI
should
be
active
for
tab
when
the
window
is
closed
"
)
;
info
(
"
Close
the
new
window
"
)
;
const
offPromise
=
once
(
ResponsiveUIManager
"
off
"
)
;
await
BrowserTestUtils
.
closeWindow
(
newWindow
)
;
await
offPromise
;
}
{
onlyPrefAndTask
:
true
}
)
;
