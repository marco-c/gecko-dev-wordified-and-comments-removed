"
use
strict
"
;
const
MESSAGE_PREFIX
=
"
ResponsiveMode
:
"
;
const
REQUEST_DONE_SUFFIX
=
"
:
Done
"
;
function
on
(
mm
message
listener
)
{
mm
.
addMessageListener
(
MESSAGE_PREFIX
+
message
listener
)
;
}
exports
.
on
=
on
;
function
off
(
mm
message
listener
)
{
mm
.
removeMessageListener
(
MESSAGE_PREFIX
+
message
listener
)
;
}
exports
.
off
=
off
;
function
once
(
mm
message
)
{
return
new
Promise
(
resolve
=
>
{
on
(
mm
message
function
onMessage
(
{
data
}
)
{
off
(
mm
message
onMessage
)
;
resolve
(
data
)
;
}
)
;
}
)
;
}
exports
.
once
=
once
;
function
emit
(
mm
message
data
)
{
mm
.
sendAsyncMessage
(
MESSAGE_PREFIX
+
message
data
)
;
}
exports
.
emit
=
emit
;
function
request
(
mm
message
data
)
{
const
done
=
once
(
mm
message
+
REQUEST_DONE_SUFFIX
)
;
emit
(
mm
message
data
)
;
return
done
;
}
exports
.
request
=
request
;
