"
use
strict
"
;
const
{
FrontClassWithSpec
registerFront
}
=
require
(
"
devtools
/
shared
/
protocol
"
)
;
const
{
cssPropertiesSpec
}
=
require
(
"
devtools
/
shared
/
specs
/
css
-
properties
"
)
;
loader
.
lazyRequireGetter
(
this
"
cssColors
"
"
devtools
/
shared
/
css
/
color
-
db
"
true
)
;
loader
.
lazyRequireGetter
(
this
"
CSS_PROPERTIES_DB
"
"
devtools
/
shared
/
css
/
properties
-
db
"
true
)
;
loader
.
lazyRequireGetter
(
this
"
CSS_TYPES
"
"
devtools
/
shared
/
css
/
constants
"
true
)
;
var
NON_ASCII
=
"
[
^
\
\
x00
-
\
\
x7F
]
"
;
var
ESCAPE
=
"
\
\
\
\
[
^
\
n
\
r
]
"
;
var
FIRST_CHAR
=
[
"
[
_a
-
z
]
"
NON_ASCII
ESCAPE
]
.
join
(
"
|
"
)
;
var
TRAILING_CHAR
=
[
"
[
_a
-
z0
-
9
-
]
"
NON_ASCII
ESCAPE
]
.
join
(
"
|
"
)
;
var
IS_VARIABLE_TOKEN
=
new
RegExp
(
^
-
-
(
{
FIRST_CHAR
}
)
(
{
TRAILING_CHAR
}
)
*
"
i
"
)
;
class
CssPropertiesFront
extends
FrontClassWithSpec
(
cssPropertiesSpec
)
{
constructor
(
client
targetFront
)
{
super
(
client
targetFront
)
;
this
.
formAttributeName
=
"
cssPropertiesActor
"
;
}
async
initialize
(
)
{
const
db
=
await
super
.
getCSSDatabase
(
)
;
this
.
cssProperties
=
new
CssProperties
(
normalizeCssData
(
db
)
)
;
}
destroy
(
)
{
this
.
cssProperties
=
null
;
super
.
destroy
(
)
;
}
}
function
CssProperties
(
db
)
{
this
.
properties
=
db
.
properties
;
this
.
pseudoElements
=
db
.
pseudoElements
;
this
.
cssColor4ColorFunction
=
hasFeature
(
db
.
supportedFeature
"
css
-
color
-
4
-
color
-
function
"
)
;
this
.
isKnown
=
this
.
isKnown
.
bind
(
this
)
;
this
.
isInherited
=
this
.
isInherited
.
bind
(
this
)
;
this
.
supportsType
=
this
.
supportsType
.
bind
(
this
)
;
this
.
supportsCssColor4ColorFunction
=
this
.
supportsCssColor4ColorFunction
.
bind
(
this
)
;
}
CssProperties
.
prototype
=
{
isKnown
(
property
)
{
property
=
property
.
startsWith
(
"
-
-
"
)
?
property
:
property
.
toLowerCase
(
)
;
return
!
!
this
.
properties
[
property
]
|
|
isCssVariable
(
property
)
;
}
isInherited
(
property
)
{
return
(
(
this
.
properties
[
property
]
&
&
this
.
properties
[
property
]
.
isInherited
)
|
|
isCssVariable
(
property
)
)
;
}
supportsType
(
property
type
)
{
const
id
=
CSS_TYPES
[
type
]
;
return
(
this
.
properties
[
property
]
&
&
(
this
.
properties
[
property
]
.
supports
.
includes
(
type
)
|
|
this
.
properties
[
property
]
.
supports
.
includes
(
id
)
)
)
;
}
getValues
(
property
)
{
return
this
.
properties
[
property
]
?
this
.
properties
[
property
]
.
values
:
[
]
;
}
getNames
(
property
)
{
return
Object
.
keys
(
this
.
properties
)
;
}
getSubproperties
(
name
)
{
name
=
name
.
startsWith
(
"
-
-
"
)
?
name
:
name
.
toLowerCase
(
)
;
if
(
this
.
isKnown
(
name
)
)
{
if
(
this
.
properties
[
name
]
&
&
this
.
properties
[
name
]
.
subproperties
)
{
return
this
.
properties
[
name
]
.
subproperties
;
}
return
[
name
]
;
}
return
[
]
;
}
supportsCssColor4ColorFunction
(
)
{
return
this
.
cssColor4ColorFunction
;
}
}
;
function
isCssVariable
(
input
)
{
return
!
!
input
.
match
(
IS_VARIABLE_TOKEN
)
;
}
function
hasFeature
(
featureSet
feature
)
{
if
(
feature
in
featureSet
)
{
return
featureSet
[
feature
]
;
}
return
false
;
}
function
getClientCssProperties
(
)
{
return
new
CssProperties
(
normalizeCssData
(
CSS_PROPERTIES_DB
)
)
;
}
function
normalizeCssData
(
db
)
{
if
(
typeof
db
.
from
=
=
"
string
"
)
{
const
missingSupports
=
!
db
.
properties
.
color
.
supports
;
const
missingValues
=
!
db
.
properties
.
color
.
values
;
const
missingSubproperties
=
!
db
.
properties
.
background
.
subproperties
;
const
missingIsInherited
=
!
db
.
properties
.
font
.
isInherited
;
const
missingSomething
=
missingSupports
|
|
missingValues
|
|
missingSubproperties
|
|
missingIsInherited
;
if
(
missingSomething
)
{
for
(
const
name
in
db
.
properties
)
{
if
(
typeof
CSS_PROPERTIES_DB
.
properties
[
name
]
!
=
=
"
object
"
)
{
continue
;
}
if
(
missingSupports
)
{
db
.
properties
[
name
]
.
supports
=
CSS_PROPERTIES_DB
.
properties
[
name
]
.
supports
;
}
if
(
missingValues
)
{
db
.
properties
[
name
]
.
values
=
CSS_PROPERTIES_DB
.
properties
[
name
]
.
values
;
}
if
(
missingSubproperties
)
{
db
.
properties
[
name
]
.
subproperties
=
CSS_PROPERTIES_DB
.
properties
[
name
]
.
subproperties
;
}
if
(
missingIsInherited
)
{
db
.
properties
[
name
]
.
isInherited
=
CSS_PROPERTIES_DB
.
properties
[
name
]
.
isInherited
;
}
}
}
}
reattachCssColorValues
(
db
)
;
if
(
!
db
.
supportedFeature
)
{
db
.
supportedFeature
=
{
}
;
}
return
db
;
}
function
reattachCssColorValues
(
db
)
{
if
(
db
.
properties
.
color
.
values
[
0
]
=
=
=
"
COLOR
"
)
{
const
colors
=
Object
.
keys
(
cssColors
)
;
for
(
const
name
in
db
.
properties
)
{
const
property
=
db
.
properties
[
name
]
;
if
(
property
.
values
&
&
property
.
values
[
0
]
=
=
=
"
COLOR
"
)
{
property
.
values
.
shift
(
)
;
property
.
values
=
property
.
values
.
concat
(
colors
)
.
sort
(
)
;
}
}
}
}
module
.
exports
=
{
CssPropertiesFront
getClientCssProperties
isCssVariable
}
;
registerFront
(
CssPropertiesFront
)
;
