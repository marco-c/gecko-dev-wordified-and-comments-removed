"
use
strict
"
;
const
{
FrontClassWithSpec
registerFront
}
=
require
(
"
resource
:
/
/
devtools
/
shared
/
protocol
.
js
"
)
;
const
{
cssPropertiesSpec
}
=
require
(
"
resource
:
/
/
devtools
/
shared
/
specs
/
css
-
properties
.
js
"
)
;
loader
.
lazyRequireGetter
(
this
"
cssColors
"
"
resource
:
/
/
devtools
/
shared
/
css
/
color
-
db
.
js
"
true
)
;
loader
.
lazyRequireGetter
(
this
"
CSS_TYPES
"
"
resource
:
/
/
devtools
/
shared
/
css
/
constants
.
js
"
true
)
;
var
NON_ASCII
=
"
[
^
\
\
x00
-
\
\
x7F
]
"
;
var
ESCAPE
=
"
\
\
\
\
[
^
\
n
\
r
]
"
;
var
VALID_CHAR
=
[
"
[
_a
-
z0
-
9
-
]
"
NON_ASCII
ESCAPE
]
.
join
(
"
|
"
)
;
var
IS_VARIABLE_TOKEN
=
new
RegExp
(
^
-
-
(
{
VALID_CHAR
}
)
*
"
i
"
)
;
class
CssPropertiesFront
extends
FrontClassWithSpec
(
cssPropertiesSpec
)
{
constructor
(
client
targetFront
)
{
super
(
client
targetFront
)
;
this
.
formAttributeName
=
"
cssPropertiesActor
"
;
}
async
initialize
(
)
{
const
db
=
await
super
.
getCSSDatabase
(
)
;
this
.
cssProperties
=
new
CssProperties
(
normalizeCssData
(
db
)
)
;
}
destroy
(
)
{
this
.
cssProperties
=
null
;
super
.
destroy
(
)
;
}
}
function
CssProperties
(
db
)
{
this
.
properties
=
db
.
properties
;
this
.
isKnown
=
this
.
isKnown
.
bind
(
this
)
;
this
.
isInherited
=
this
.
isInherited
.
bind
(
this
)
;
this
.
supportsType
=
this
.
supportsType
.
bind
(
this
)
;
}
CssProperties
.
prototype
=
{
isKnown
(
property
)
{
property
=
property
.
startsWith
(
"
-
-
"
)
?
property
:
property
.
toLowerCase
(
)
;
return
!
!
this
.
properties
[
property
]
|
|
isCssVariable
(
property
)
;
}
isInherited
(
property
)
{
return
(
(
this
.
properties
[
property
]
&
&
this
.
properties
[
property
]
.
isInherited
)
|
|
isCssVariable
(
property
)
)
;
}
supportsType
(
property
type
)
{
const
id
=
CSS_TYPES
[
type
]
;
return
(
this
.
properties
[
property
]
&
&
(
this
.
properties
[
property
]
.
supports
.
includes
(
type
)
|
|
this
.
properties
[
property
]
.
supports
.
includes
(
id
)
)
)
;
}
getValues
(
property
)
{
return
this
.
properties
[
property
]
?
this
.
properties
[
property
]
.
values
:
[
]
;
}
getNames
(
property
)
{
return
Object
.
keys
(
this
.
properties
)
;
}
getSubproperties
(
name
)
{
name
=
name
.
startsWith
(
"
-
-
"
)
?
name
:
name
.
toLowerCase
(
)
;
if
(
this
.
isKnown
(
name
)
)
{
if
(
this
.
properties
[
name
]
&
&
this
.
properties
[
name
]
.
subproperties
)
{
return
this
.
properties
[
name
]
.
subproperties
;
}
return
[
name
]
;
}
return
[
]
;
}
}
;
function
isCssVariable
(
input
)
{
return
!
!
input
.
match
(
IS_VARIABLE_TOKEN
)
;
}
function
normalizeCssData
(
db
)
{
if
(
typeof
db
.
from
=
=
"
string
"
)
{
}
reattachCssColorValues
(
db
)
;
return
db
;
}
function
reattachCssColorValues
(
db
)
{
if
(
db
.
properties
.
color
.
values
[
0
]
=
=
=
"
COLOR
"
)
{
const
colors
=
Object
.
keys
(
cssColors
)
;
for
(
const
name
in
db
.
properties
)
{
const
property
=
db
.
properties
[
name
]
;
if
(
property
.
values
&
&
property
.
values
[
0
]
=
=
=
"
COLOR
"
)
{
property
.
values
.
shift
(
)
;
property
.
values
=
property
.
values
.
concat
(
colors
)
.
sort
(
)
;
}
}
}
}
module
.
exports
=
{
CssPropertiesFront
isCssVariable
CssProperties
normalizeCssData
}
;
registerFront
(
CssPropertiesFront
)
;
