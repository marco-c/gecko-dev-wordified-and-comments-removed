"
use
strict
"
;
add_task
(
async
function
(
)
{
await
pushPref
(
"
devtools
.
browsertoolbox
.
scope
"
"
everything
"
)
;
const
promises
=
[
]
;
for
(
let
i
=
0
;
i
<
5
;
i
+
+
)
{
info
(
"
Open
the
Browser
Console
"
)
;
promises
.
push
(
BrowserConsoleManager
.
toggleBrowserConsole
(
)
)
;
await
wait
(
i
*
100
)
;
info
(
"
Close
the
Browser
Console
"
)
;
promises
.
push
(
BrowserConsoleManager
.
closeBrowserConsole
(
)
)
;
await
wait
(
i
*
100
)
;
}
info
(
"
Wait
for
all
opening
/
closing
promises
"
)
;
await
Promise
.
allSettled
(
promises
)
;
let
hud
=
BrowserConsoleManager
.
getBrowserConsole
(
)
;
if
(
!
hud
)
{
info
(
"
Reopen
the
browser
console
a
last
time
"
)
;
hud
=
await
BrowserConsoleManager
.
toggleBrowserConsole
(
)
;
}
info
(
"
Log
a
message
and
ensure
it
is
visible
and
the
console
mostly
works
"
)
;
console
.
log
(
"
message
from
mochitest
"
)
;
await
checkUniqueMessageExists
(
hud
"
message
from
mochitest
"
"
.
console
-
api
"
)
;
await
clearOutput
(
hud
)
;
info
(
"
Ensure
closing
the
Browser
Console
at
the
end
of
the
test
"
)
;
await
BrowserConsoleManager
.
closeBrowserConsole
(
)
;
ok
(
!
BrowserConsoleManager
.
getBrowserConsole
(
)
"
No
browser
console
opened
at
the
end
of
test
"
)
;
}
)
;
