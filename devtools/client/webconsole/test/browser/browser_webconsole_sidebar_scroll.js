"
use
strict
"
;
const
TEST_URI
=
data
:
text
/
html
;
charset
=
utf8
<
!
DOCTYPE
html
>
Test
sidebar
scroll
;
add_task
(
async
function
(
)
{
await
pushPref
(
"
devtools
.
webconsole
.
sidebarToggle
"
true
)
;
const
isMacOS
=
Services
.
appinfo
.
OS
=
=
=
"
Darwin
"
;
const
hud
=
await
openNewTabAndConsole
(
TEST_URI
)
;
const
onMessage
=
waitForMessageByType
(
hud
"
Document
"
"
.
console
-
api
"
)
;
SpecialPowers
.
spawn
(
gBrowser
.
selectedBrowser
[
]
function
(
)
{
content
.
wrappedJSObject
.
console
.
log
(
content
.
wrappedJSObject
.
document
)
;
}
)
;
const
{
node
}
=
await
onMessage
;
const
object
=
node
.
querySelector
(
"
.
object
-
inspector
.
node
"
)
;
info
(
"
Ctrl
+
click
on
an
object
to
put
it
in
the
sidebar
"
)
;
const
onSidebarShown
=
waitFor
(
(
)
=
>
hud
.
ui
.
document
.
querySelector
(
"
.
sidebar
"
)
)
;
AccessibilityUtils
.
setEnv
(
{
focusableRule
:
false
interactiveRule
:
false
labelRule
:
false
}
)
;
EventUtils
.
sendMouseEvent
(
{
type
:
"
click
"
[
isMacOS
?
"
metaKey
"
:
"
ctrlKey
"
]
:
true
}
object
hud
.
ui
.
window
)
;
AccessibilityUtils
.
resetEnv
(
)
;
await
onSidebarShown
;
const
sidebarContents
=
hud
.
ui
.
document
.
querySelector
(
"
.
sidebar
-
contents
"
)
;
await
waitFor
(
(
)
=
>
sidebarContents
.
querySelectorAll
(
"
.
node
"
)
.
length
>
1
)
;
Assert
.
greater
(
sidebarContents
.
scrollHeight
sidebarContents
.
clientHeight
"
Sidebar
overflows
"
)
;
}
)
;
