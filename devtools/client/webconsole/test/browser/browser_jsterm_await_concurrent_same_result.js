"
use
strict
"
;
const
TEST_URI
=
"
data
:
text
/
html
;
charset
=
utf
-
8
Test
concurrent
top
-
level
await
expressions
returning
same
value
"
;
add_task
(
async
function
(
)
{
await
pushPref
(
"
devtools
.
webconsole
.
features
.
editor
"
true
)
;
await
pushPref
(
"
devtools
.
webconsole
.
input
.
editor
"
true
)
;
const
hud
=
await
openNewTabAndConsole
(
TEST_URI
)
;
setInputValue
(
hud
await
new
Promise
(
res
=
>
setTimeout
(
(
)
=
>
res
(
"
foo
"
)
5000
)
)
)
;
info
(
"
Evaluate
the
expression
3
times
in
a
row
"
)
;
const
executeButton
=
hud
.
ui
.
outputNode
.
querySelector
(
"
.
webconsole
-
editor
-
toolbar
-
executeButton
"
)
;
executeButton
.
click
(
)
;
executeButton
.
click
(
)
;
executeButton
.
click
(
)
;
await
waitFor
(
(
)
=
>
findMessages
(
hud
"
foo
"
"
.
result
"
)
.
length
=
=
=
3
"
Waiting
for
all
results
to
be
printed
in
console
"
1000
)
;
ok
(
true
"
There
are
as
many
results
as
commands
"
)
;
Services
.
prefs
.
clearUserPref
(
"
devtools
.
webconsole
.
features
.
editor
"
)
;
Services
.
prefs
.
clearUserPref
(
"
devtools
.
webconsole
.
input
.
editor
"
)
;
}
)
;
