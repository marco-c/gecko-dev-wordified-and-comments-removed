"
use
strict
"
;
const
TEST_URI
=
data
:
text
/
html
;
charset
=
utf8
<
!
DOCTYPE
html
>
<
p
>
test
page
<
/
p
>
;
add_task
(
async
function
(
)
{
const
hud
=
await
openNewTabAndConsole
(
TEST_URI
)
;
const
{
jsterm
}
=
hud
;
const
toolbox
=
gDevTools
.
getToolboxForTab
(
gBrowser
.
selectedTab
)
;
const
element
=
jsterm
.
node
.
querySelector
(
"
.
CodeMirror
-
wrap
"
)
;
const
menuPopup
=
await
openTextBoxContextMenu
(
toolbox
element
)
;
const
undoMenuItem
=
menuPopup
.
querySelector
(
"
#
editmenu
-
undo
"
)
;
await
waitUntil
(
(
)
=
>
!
!
undoMenuItem
.
getAttribute
(
"
label
"
)
)
;
is
(
undoMenuItem
.
getAttribute
(
"
label
"
)
"
Undo
"
"
Undo
is
visible
and
localized
"
)
;
}
)
;
async
function
openTextBoxContextMenu
(
toolbox
element
)
{
const
onConsoleMenuOpened
=
toolbox
.
once
(
"
menu
-
open
"
)
;
synthesizeContextMenuEvent
(
element
)
;
await
onConsoleMenuOpened
;
return
toolbox
.
getTextBoxContextMenu
(
)
;
}
