"
use
strict
"
;
const
TEST_URI
=
"
data
:
text
/
html
<
!
DOCTYPE
html
>
<
meta
charset
=
utf8
>
"
+
"
Test
copy
multiple
messages
to
clipboard
"
;
add_task
(
async
function
(
)
{
const
hud
=
await
openNewTabAndConsole
(
TEST_URI
)
;
const
messages
=
Array
.
from
(
{
length
:
10
}
(
_
i
)
=
>
Message
number
{
i
+
1
}
)
;
const
lastMessage
=
[
.
.
.
messages
]
.
pop
(
)
;
const
onMessage
=
waitForMessage
(
hud
lastMessage
)
;
SpecialPowers
.
spawn
(
gBrowser
.
selectedBrowser
[
messages
]
msgs
=
>
{
msgs
.
forEach
(
msg
=
>
content
.
wrappedJSObject
.
console
.
log
(
msg
)
)
;
}
)
;
const
{
node
}
=
await
onMessage
;
ok
(
node
"
Messages
were
logged
"
)
;
const
output
=
node
.
closest
(
"
.
webconsole
-
output
"
)
;
selectNode
(
hud
output
)
;
info
(
"
Wait
for
the
clipboard
to
contain
the
text
corresponding
to
all
the
messages
"
)
;
await
waitForClipboardPromise
(
(
)
=
>
{
output
.
ownerDocument
.
activeElement
.
blur
(
)
;
goDoCommand
(
"
cmd_copy
"
)
;
}
data
=
>
data
.
trim
(
)
=
=
=
messages
.
join
(
"
\
n
"
)
)
;
}
)
;
