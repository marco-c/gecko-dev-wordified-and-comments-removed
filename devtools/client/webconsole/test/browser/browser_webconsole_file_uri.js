"
use
strict
"
;
const
PREF
=
"
devtools
.
webconsole
.
persistlog
"
;
const
TEST_FILE
=
"
test
-
network
.
html
"
;
var
hud
;
add_task
(
async
function
(
)
{
Services
.
prefs
.
setBoolPref
(
PREF
true
)
;
const
jar
=
getJar
(
getRootDirectory
(
gTestPath
)
)
;
const
dir
=
jar
?
extractJarToTmp
(
jar
)
:
getChromeDir
(
getResolvedURI
(
gTestPath
)
)
;
dir
.
append
(
TEST_FILE
)
;
const
uri
=
Services
.
io
.
newFileURI
(
dir
)
;
const
remoteType
=
E10SUtils
.
getRemoteTypeForURI
(
uri
.
spec
gMultiProcessBrowser
gFissionBrowser
)
;
await
loadTab
(
"
about
:
blank
"
remoteType
)
;
hud
=
await
openConsole
(
)
;
await
clearOutput
(
hud
)
;
await
navigateTo
(
uri
.
spec
)
;
await
testMessages
(
)
;
Services
.
prefs
.
clearUserPref
(
PREF
)
;
hud
=
null
;
}
)
;
function
testMessages
(
)
{
return
waitForMessagesByType
(
{
webconsole
:
hud
messages
:
[
{
text
:
"
running
network
console
logging
tests
"
typeSelector
:
"
.
console
-
api
"
category
:
CATEGORY_WEBDEV
severity
:
SEVERITY_LOG
}
{
text
:
"
test
-
network
.
html
"
typeSelector
:
"
.
network
"
category
:
CATEGORY_NETWORK
severity
:
SEVERITY_LOG
}
{
text
:
"
test
-
image
.
png
"
typeSelector
:
"
.
network
"
category
:
CATEGORY_NETWORK
severity
:
SEVERITY_LOG
}
{
text
:
"
testscript
.
js
"
typeSelector
:
"
.
network
"
category
:
CATEGORY_NETWORK
severity
:
SEVERITY_LOG
}
]
}
)
;
}
