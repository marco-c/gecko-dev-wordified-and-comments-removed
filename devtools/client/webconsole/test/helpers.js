"
use
strict
"
;
const
reduxActions
=
require
(
"
devtools
/
client
/
webconsole
/
actions
/
index
"
)
;
const
{
configureStore
}
=
require
(
"
devtools
/
client
/
webconsole
/
store
"
)
;
const
{
IdGenerator
}
=
require
(
"
devtools
/
client
/
webconsole
/
utils
/
id
-
generator
"
)
;
const
{
stubPackets
}
=
require
(
"
devtools
/
client
/
webconsole
/
test
/
fixtures
/
stubs
/
index
"
)
;
const
{
getAllMessagesById
}
=
require
(
"
devtools
/
client
/
webconsole
/
selectors
/
messages
"
)
;
const
{
getPrefsService
}
=
require
(
"
devtools
/
client
/
webconsole
/
utils
/
prefs
"
)
;
const
prefsService
=
getPrefsService
(
{
}
)
;
const
{
PREFS
}
=
require
(
"
devtools
/
client
/
webconsole
/
constants
"
)
;
function
setupActions
(
)
{
const
wrappedActions
=
Object
.
assign
(
{
}
reduxActions
)
;
const
idGenerator
=
new
IdGenerator
(
)
;
wrappedActions
.
messagesAdd
=
(
packets
)
=
>
{
return
reduxActions
.
messagesAdd
(
packets
idGenerator
)
;
}
;
return
{
.
.
.
reduxActions
messagesAdd
:
packets
=
>
reduxActions
.
messagesAdd
(
packets
idGenerator
)
}
;
}
function
setupStore
(
input
=
[
]
{
storeOptions
actions
hud
}
=
{
}
)
{
if
(
!
hud
)
{
hud
=
{
proxy
:
{
releaseActor
:
(
)
=
>
{
}
}
}
;
}
const
store
=
configureStore
(
hud
storeOptions
)
;
const
messagesAdd
=
actions
?
actions
.
messagesAdd
:
reduxActions
.
messagesAdd
;
store
.
dispatch
(
messagesAdd
(
input
.
map
(
cmd
=
>
stubPackets
.
get
(
cmd
)
)
)
)
;
return
store
;
}
function
clonePacket
(
packet
)
{
return
JSON
.
parse
(
JSON
.
stringify
(
packet
)
)
;
}
function
getMessageAt
(
state
index
)
{
const
messages
=
getAllMessagesById
(
state
)
;
return
messages
.
get
(
[
.
.
.
messages
.
keys
(
)
]
[
index
]
)
;
}
function
getFirstMessage
(
state
)
{
return
getMessageAt
(
state
0
)
;
}
function
getLastMessage
(
state
)
{
const
lastIndex
=
getAllMessagesById
(
state
)
.
size
-
1
;
return
getMessageAt
(
state
lastIndex
)
;
}
function
getFiltersPrefs
(
)
{
return
Object
.
values
(
PREFS
.
FILTER
)
.
reduce
(
(
res
pref
)
=
>
{
res
[
pref
]
=
prefsService
.
getBoolPref
(
pref
)
;
return
res
;
}
{
}
)
;
}
function
clearPrefs
(
)
{
[
"
devtools
.
hud
.
loglimit
"
.
.
.
Object
.
values
(
PREFS
.
FILTER
)
.
.
.
Object
.
values
(
PREFS
.
UI
)
]
.
forEach
(
prefsService
.
clearUserPref
)
;
}
function
getPrivatePacket
(
key
)
{
const
packet
=
clonePacket
(
stubPackets
.
get
(
key
)
)
;
if
(
packet
.
message
)
{
packet
.
message
.
private
=
true
;
}
if
(
Object
.
getOwnPropertyNames
(
packet
)
.
includes
(
"
private
"
)
)
{
packet
.
private
=
true
;
}
return
packet
;
}
module
.
exports
=
{
clearPrefs
clonePacket
getFiltersPrefs
getFirstMessage
getLastMessage
getMessageAt
getPrivatePacket
prefsService
setupActions
setupStore
}
;
