"
use
strict
"
;
const
TEST_URI
=
"
http
:
/
/
example
.
com
/
browser
/
devtools
/
client
/
webconsole
/
"
+
"
test
/
test
-
console
.
html
"
;
add_task
(
function
*
(
)
{
let
{
browser
}
=
yield
loadTab
(
TEST_URI
)
;
let
hud
=
yield
openConsole
(
)
;
yield
testClosingAfterCompletion
(
hud
browser
)
;
}
)
;
function
testClosingAfterCompletion
(
hud
browser
)
{
let
deferred
=
promise
.
defer
(
)
;
let
errorWhileClosing
=
false
;
function
errorListener
(
)
{
errorWhileClosing
=
true
;
}
browser
.
addEventListener
(
"
error
"
errorListener
false
)
;
hud
.
jsterm
.
focus
(
)
;
gDevTools
.
once
(
"
toolbox
-
destroyed
"
function
(
)
{
browser
.
removeEventListener
(
"
error
"
errorListener
false
)
;
is
(
errorWhileClosing
false
"
no
error
while
closing
the
WebConsole
"
)
;
deferred
.
resolve
(
)
;
}
)
;
if
(
Services
.
appinfo
.
OS
=
=
"
Darwin
"
)
{
EventUtils
.
synthesizeKey
(
"
i
"
{
accelKey
:
true
altKey
:
true
}
)
;
}
else
{
EventUtils
.
synthesizeKey
(
"
i
"
{
accelKey
:
true
shiftKey
:
true
}
)
;
}
return
deferred
.
promise
;
}
