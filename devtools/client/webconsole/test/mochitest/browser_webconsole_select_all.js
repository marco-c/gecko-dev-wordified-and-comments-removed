"
use
strict
"
;
const
TEST_URI
=
"
http
:
/
/
example
.
com
/
"
;
add_task
(
async
function
testSelectAll
(
)
{
const
hud
=
await
openNewTabAndConsole
(
TEST_URI
)
;
await
testSelectionWhenMovingBetweenBoxes
(
hud
)
;
testBrowserMenuSelectAll
(
hud
)
;
await
testContextMenuSelectAll
(
hud
)
;
}
)
;
async
function
testSelectionWhenMovingBetweenBoxes
(
hud
)
{
const
jsterm
=
hud
.
jsterm
;
jsterm
.
clearOutput
(
)
;
await
jsterm
.
execute
(
"
1
+
2
"
)
;
await
waitFor
(
(
)
=
>
findMessage
(
hud
"
3
"
)
)
;
await
jsterm
.
execute
(
"
3
+
4
"
)
;
await
waitFor
(
(
)
=
>
findMessage
(
hud
"
7
"
)
)
;
await
jsterm
.
execute
(
"
5
+
6
"
)
;
await
waitFor
(
(
)
=
>
findMessage
(
hud
"
11
"
)
)
;
}
function
testBrowserMenuSelectAll
(
hud
)
{
const
{
ui
}
=
hud
;
const
outputContainer
=
ui
.
outputNode
.
querySelector
(
"
.
webconsole
-
output
"
)
;
is
(
outputContainer
.
childNodes
.
length
6
"
the
output
node
contains
the
expected
number
of
children
"
)
;
outputContainer
.
ownerDocument
.
activeElement
.
blur
(
)
;
goDoCommand
(
"
cmd_selectAll
"
)
;
checkMessagesSelected
(
outputContainer
)
;
hud
.
iframeWindow
.
getSelection
(
)
.
removeAllRanges
(
)
;
}
async
function
testContextMenuSelectAll
(
hud
)
{
const
{
ui
}
=
hud
;
const
outputContainer
=
ui
.
outputNode
.
querySelector
(
"
.
webconsole
-
output
"
)
;
const
contextMenu
=
await
openContextMenu
(
hud
outputContainer
)
;
const
selectAllItem
=
contextMenu
.
querySelector
(
"
#
console
-
menu
-
select
"
)
;
ok
(
selectAllItem
the
context
menu
on
the
output
node
has
a
"
Select
All
"
item
)
;
outputContainer
.
focus
(
)
;
selectAllItem
.
click
(
)
;
checkMessagesSelected
(
outputContainer
)
;
hud
.
iframeWindow
.
getSelection
(
)
.
removeAllRanges
(
)
;
}
function
checkMessagesSelected
(
outputContainer
)
{
const
selection
=
outputContainer
.
ownerDocument
.
getSelection
(
)
;
const
messages
=
outputContainer
.
querySelectorAll
(
"
.
message
"
)
;
for
(
const
message
of
messages
)
{
const
selected
=
selection
.
containsNode
(
message
)
;
ok
(
selected
Node
containing
text
"
{
message
.
textContent
}
"
was
selected
)
;
}
}
