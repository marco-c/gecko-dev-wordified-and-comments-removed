"
use
strict
"
;
const
PREFIX
=
"
content
-
"
;
const
HELPERS
=
[
"
_
"
"
"
"
"
"
0
"
"
x
"
"
cd
"
"
clear
"
"
clearHistory
"
"
copy
"
"
help
"
"
inspect
"
"
keys
"
"
pprint
"
"
screenshot
"
"
values
"
]
;
const
TEST_URI
=
data
:
text
/
html
<
meta
charset
=
utf8
>
<
script
>
const
helpers
=
{
JSON
.
stringify
(
HELPERS
)
}
;
for
(
const
helper
of
helpers
)
{
window
[
helper
]
=
(
)
=
>
"
{
PREFIX
}
"
+
helper
;
}
<
/
script
>
;
add_task
(
async
function
(
)
{
await
pushPref
(
"
devtools
.
webconsole
.
jsterm
.
codeMirror
"
false
)
;
await
performTests
(
)
;
await
pushPref
(
"
devtools
.
webconsole
.
jsterm
.
codeMirror
"
true
)
;
await
performTests
(
)
;
}
)
;
async
function
performTests
(
)
{
const
{
jsterm
}
=
await
openNewTabAndConsole
(
TEST_URI
)
;
const
{
autocompletePopup
}
=
jsterm
;
for
(
const
helper
of
HELPERS
)
{
await
jstermSetValueAndComplete
(
jsterm
helper
)
;
const
autocompleteItems
=
getPopupLabels
(
autocompletePopup
)
.
filter
(
l
=
>
l
=
=
=
helper
)
;
is
(
autocompleteItems
.
length
1
There
'
s
no
duplicated
"
{
helper
}
"
item
in
the
autocomplete
popup
)
;
const
msg
=
await
jsterm
.
execute
(
{
helper
}
(
)
)
;
ok
(
msg
.
textContent
.
includes
(
PREFIX
+
helper
)
output
is
correct
for
{
helper
}
(
)
)
;
}
}
function
getPopupLabels
(
popup
)
{
return
popup
.
getItems
(
)
.
map
(
item
=
>
item
.
label
)
;
}
