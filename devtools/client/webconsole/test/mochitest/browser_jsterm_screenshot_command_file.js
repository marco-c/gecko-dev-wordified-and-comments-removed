"
use
strict
"
;
const
TEST_URI
=
"
http
:
/
/
example
.
com
/
browser
/
devtools
/
client
/
webconsole
/
"
+
"
test
/
mochitest
/
test_jsterm_screenshot_command
.
html
"
;
const
FileUtils
=
(
ChromeUtils
.
import
(
"
resource
:
/
/
gre
/
modules
/
FileUtils
.
jsm
"
{
}
)
)
.
FileUtils
;
const
dpr
=
"
-
-
dpr
1
"
;
add_task
(
async
function
(
)
{
await
performTests
(
)
;
await
pushPref
(
"
devtools
.
webconsole
.
jsterm
.
codeMirror
"
true
)
;
await
performTests
(
)
;
}
)
;
async
function
performTests
(
)
{
await
addTab
(
TEST_URI
)
;
const
hud
=
await
openConsole
(
)
;
ok
(
hud
"
web
console
opened
"
)
;
await
testFile
(
hud
)
;
}
async
function
testFile
(
hud
)
{
const
file
=
FileUtils
.
getFile
(
"
TmpD
"
[
"
TestScreenshotFile
.
png
"
]
)
;
const
command
=
:
screenshot
{
file
.
path
}
{
dpr
}
;
const
onMessage
=
waitForMessage
(
hud
Saved
to
{
file
.
path
}
)
;
hud
.
jsterm
.
execute
(
command
)
;
await
onMessage
;
ok
(
file
.
exists
(
)
"
Screenshot
file
exists
"
)
;
if
(
file
.
exists
(
)
)
{
file
.
remove
(
false
)
;
}
}
