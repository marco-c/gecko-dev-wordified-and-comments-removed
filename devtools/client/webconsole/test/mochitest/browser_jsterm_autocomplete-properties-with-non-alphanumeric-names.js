"
use
strict
"
;
const
TEST_URI
=
"
data
:
text
/
html
;
charset
=
utf8
test
autocompletion
with
or
_
"
;
add_task
(
async
function
(
)
{
await
pushPref
(
"
devtools
.
webconsole
.
jsterm
.
codeMirror
"
false
)
;
await
performTests
(
)
;
await
pushPref
(
"
devtools
.
webconsole
.
jsterm
.
codeMirror
"
true
)
;
await
performTests
(
)
;
}
)
;
async
function
performTests
(
)
{
const
{
jsterm
}
=
await
openNewTabAndConsole
(
TEST_URI
)
;
await
jsterm
.
execute
(
"
var
testObject
=
{
aaab
:
'
'
aaac
:
'
'
}
"
)
;
await
testAutocomplete
(
jsterm
"
Object
.
__d
"
)
;
await
testAutocomplete
(
jsterm
"
testObject
.
a
"
)
;
await
testAutocomplete
(
jsterm
"
Object
.
__de
"
)
;
await
testAutocomplete
(
jsterm
"
testObject
.
aa
"
)
;
await
jsterm
.
execute
(
"
let
foobar
=
{
a
:
'
'
}
;
const
blargh
=
{
a
:
1
}
;
"
)
;
await
testAutocomplete
(
jsterm
"
foobar
"
)
;
await
testAutocomplete
(
jsterm
"
blargh
"
)
;
await
testAutocomplete
(
jsterm
"
foobar
.
a
"
)
;
await
testAutocomplete
(
jsterm
"
blargh
.
a
"
)
;
}
async
function
testAutocomplete
(
jsterm
inputString
)
{
jsterm
.
setInputValue
(
inputString
)
;
await
new
Promise
(
resolve
=
>
jsterm
.
complete
(
jsterm
.
COMPLETE_HINT_ONLY
resolve
)
)
;
const
popup
=
jsterm
.
autocompletePopup
;
ok
(
popup
.
itemCount
>
0
There
'
s
{
popup
.
itemCount
}
suggestions
for
'
{
inputString
}
'
)
;
}
