"
use
strict
"
;
if
(
typeof
define
=
=
=
"
undefined
"
)
{
require
(
"
amd
-
loader
"
)
;
}
const
{
createFactory
PropTypes
}
=
require
(
"
devtools
/
client
/
shared
/
vendor
/
react
"
)
;
const
{
ObjectClient
}
=
require
(
"
devtools
/
shared
/
client
/
main
"
)
;
const
{
MESSAGE_TYPE
JSTERM_COMMANDS
}
=
require
(
"
.
.
/
constants
"
)
;
const
actions
=
require
(
"
devtools
/
client
/
webconsole
/
new
-
console
-
output
/
actions
/
messages
"
)
;
const
reps
=
require
(
"
devtools
/
client
/
shared
/
components
/
reps
/
reps
"
)
;
const
{
REPS
MODE
}
=
reps
;
const
ObjectInspector
=
createFactory
(
reps
.
ObjectInspector
)
;
const
{
Grip
}
=
REPS
;
GripMessageBody
.
displayName
=
"
GripMessageBody
"
;
GripMessageBody
.
propTypes
=
{
grip
:
PropTypes
.
oneOfType
(
[
PropTypes
.
string
PropTypes
.
number
PropTypes
.
object
]
)
.
isRequired
serviceContainer
:
PropTypes
.
shape
(
{
createElement
:
PropTypes
.
func
.
isRequired
hudProxyClient
:
PropTypes
.
object
.
isRequired
}
)
userProvidedStyle
:
PropTypes
.
string
useQuotes
:
PropTypes
.
bool
escapeWhitespace
:
PropTypes
.
bool
loadedObjectProperties
:
PropTypes
.
object
type
:
PropTypes
.
string
helperType
:
PropTypes
.
string
}
;
GripMessageBody
.
defaultProps
=
{
mode
:
MODE
.
LONG
}
;
function
GripMessageBody
(
props
)
{
const
{
dispatch
messageId
grip
userProvidedStyle
serviceContainer
useQuotes
escapeWhitespace
mode
=
MODE
.
LONG
loadedObjectProperties
}
=
props
;
let
styleObject
;
if
(
userProvidedStyle
&
&
userProvidedStyle
!
=
=
"
"
)
{
styleObject
=
cleanupStyle
(
userProvidedStyle
serviceContainer
.
createElement
)
;
}
let
onDOMNodeMouseOver
;
let
onDOMNodeMouseOut
;
let
onInspectIconClick
;
if
(
serviceContainer
)
{
onDOMNodeMouseOver
=
serviceContainer
.
highlightDomElement
?
(
object
)
=
>
serviceContainer
.
highlightDomElement
(
object
)
:
null
;
onDOMNodeMouseOut
=
serviceContainer
.
unHighlightDomElement
;
onInspectIconClick
=
serviceContainer
.
openNodeInInspector
?
(
object
e
)
=
>
{
e
.
stopPropagation
(
)
;
serviceContainer
.
openNodeInInspector
(
object
)
;
}
:
null
;
}
const
objectInspectorProps
=
{
autoExpandDepth
:
shouldAutoExpandObjectInspector
(
props
)
?
1
:
0
mode
disabledFocus
:
true
roots
:
[
{
path
:
grip
.
actor
|
|
JSON
.
stringify
(
grip
)
contents
:
{
value
:
grip
}
}
]
getObjectProperties
:
actor
=
>
loadedObjectProperties
&
&
loadedObjectProperties
[
actor
]
loadObjectProperties
:
object
=
>
{
const
client
=
new
ObjectClient
(
serviceContainer
.
hudProxyClient
object
)
;
dispatch
(
actions
.
messageObjectPropertiesLoad
(
messageId
client
object
)
)
;
}
}
;
if
(
typeof
grip
=
=
=
"
string
"
|
|
grip
.
type
=
=
=
"
longString
"
)
{
Object
.
assign
(
objectInspectorProps
{
useQuotes
escapeWhitespace
style
:
styleObject
}
)
;
}
else
{
Object
.
assign
(
objectInspectorProps
{
onDOMNodeMouseOver
onDOMNodeMouseOut
onInspectIconClick
defaultRep
:
Grip
}
)
;
}
return
ObjectInspector
(
objectInspectorProps
)
;
}
const
allowedStylesRegex
=
new
RegExp
(
"
^
(
?
:
-
moz
-
)
?
(
?
:
background
|
border
|
box
|
clear
|
color
|
cursor
|
display
|
float
|
font
|
line
|
"
+
"
margin
|
padding
|
text
|
transition
|
outline
|
white
-
space
|
word
|
writing
|
"
+
"
(
?
:
min
-
|
max
-
)
?
width
|
(
?
:
min
-
|
max
-
)
?
height
)
"
)
;
const
forbiddenValuesRegexs
=
[
/
\
b
(
?
:
url
|
(
?
:
-
moz
-
)
?
element
)
[
\
s
(
'
"
]
+
/
gi
/
[
'
"
(
]
*
(
?
:
chrome
|
resource
|
about
|
app
|
data
|
https
?
|
ftp
|
file
)
:
+
\
/
*
/
gi
]
;
function
cleanupStyle
(
userProvidedStyle
createElement
)
{
let
dummy
=
createElement
(
"
div
"
)
;
dummy
.
style
=
userProvidedStyle
;
return
[
.
.
.
dummy
.
style
]
.
filter
(
name
=
>
{
return
allowedStylesRegex
.
test
(
name
)
&
&
!
forbiddenValuesRegexs
.
some
(
regex
=
>
regex
.
test
(
dummy
.
style
[
name
]
)
)
;
}
)
.
reduce
(
(
object
name
)
=
>
{
return
Object
.
assign
(
{
[
name
]
:
dummy
.
style
[
name
]
}
object
)
;
}
{
}
)
;
}
function
shouldAutoExpandObjectInspector
(
props
)
{
const
{
helperType
type
}
=
props
;
return
(
type
=
=
=
MESSAGE_TYPE
.
DIR
|
|
helperType
=
=
=
JSTERM_COMMANDS
.
INSPECT
)
;
}
module
.
exports
=
GripMessageBody
;
