"
use
strict
"
;
const
{
prepareMessage
}
=
require
(
"
devtools
/
client
/
webconsole
/
new
-
console
-
output
/
utils
/
messages
"
)
;
const
{
IdGenerator
}
=
require
(
"
devtools
/
client
/
webconsole
/
new
-
console
-
output
/
utils
/
id
-
generator
"
)
;
const
{
batchActions
}
=
require
(
"
devtools
/
client
/
shared
/
redux
/
middleware
/
debounce
"
)
;
const
{
MESSAGE_ADD
NETWORK_MESSAGE_UPDATE
MESSAGES_CLEAR
MESSAGE_OPEN
MESSAGE_CLOSE
MESSAGE_TYPE
MESSAGE_TABLE_RECEIVE
MESSAGE_OBJECT_PROPERTIES_RECEIVE
MESSAGE_OBJECT_ENTRIES_RECEIVE
}
=
require
(
"
.
.
/
constants
"
)
;
const
defaultIdGenerator
=
new
IdGenerator
(
)
;
function
messageAdd
(
packet
idGenerator
=
null
)
{
if
(
idGenerator
=
=
null
)
{
idGenerator
=
defaultIdGenerator
;
}
let
message
=
prepareMessage
(
packet
idGenerator
)
;
const
addMessageAction
=
{
type
:
MESSAGE_ADD
message
}
;
if
(
message
.
type
=
=
=
MESSAGE_TYPE
.
CLEAR
)
{
return
batchActions
(
[
messagesClear
(
)
addMessageAction
]
)
;
}
return
addMessageAction
;
}
function
messagesClear
(
)
{
return
{
type
:
MESSAGES_CLEAR
}
;
}
function
messageOpen
(
id
)
{
return
{
type
:
MESSAGE_OPEN
id
}
;
}
function
messageClose
(
id
)
{
return
{
type
:
MESSAGE_CLOSE
id
}
;
}
function
messageTableDataGet
(
id
client
dataType
)
{
return
(
dispatch
)
=
>
{
let
fetchObjectActorData
;
if
(
[
"
Map
"
"
WeakMap
"
"
Set
"
"
WeakSet
"
]
.
includes
(
dataType
)
)
{
fetchObjectActorData
=
(
cb
)
=
>
client
.
enumEntries
(
cb
)
;
}
else
{
fetchObjectActorData
=
(
cb
)
=
>
client
.
enumProperties
(
{
ignoreNonIndexedProperties
:
dataType
=
=
=
"
Array
"
}
cb
)
;
}
fetchObjectActorData
(
enumResponse
=
>
{
const
{
iterator
}
=
enumResponse
;
iterator
.
slice
(
0
iterator
.
count
sliceResponse
=
>
{
let
{
ownProperties
}
=
sliceResponse
;
dispatch
(
messageTableDataReceive
(
id
ownProperties
)
)
;
}
)
;
}
)
;
}
;
}
function
messageTableDataReceive
(
id
data
)
{
return
{
type
:
MESSAGE_TABLE_RECEIVE
id
data
}
;
}
function
networkMessageUpdate
(
packet
idGenerator
=
null
)
{
if
(
idGenerator
=
=
null
)
{
idGenerator
=
defaultIdGenerator
;
}
let
message
=
prepareMessage
(
packet
idGenerator
)
;
return
{
type
:
NETWORK_MESSAGE_UPDATE
message
}
;
}
function
messageObjectPropertiesLoad
(
id
client
grip
)
{
return
async
(
dispatch
)
=
>
{
const
response
=
await
client
.
getPrototypeAndProperties
(
)
;
dispatch
(
messageObjectPropertiesReceive
(
id
grip
.
actor
response
)
)
;
}
;
}
function
messageObjectEntriesLoad
(
id
client
grip
)
{
return
(
dispatch
)
=
>
{
client
.
enumEntries
(
enumResponse
=
>
{
const
{
iterator
}
=
enumResponse
;
iterator
.
slice
(
0
iterator
.
count
sliceResponse
=
>
{
dispatch
(
messageObjectEntriesReceive
(
id
grip
.
actor
sliceResponse
)
)
;
}
)
;
}
)
;
}
;
}
function
messageObjectPropertiesReceive
(
id
actor
properties
)
{
return
{
type
:
MESSAGE_OBJECT_PROPERTIES_RECEIVE
id
actor
properties
}
;
}
function
messageObjectEntriesReceive
(
id
actor
entries
)
{
return
{
type
:
MESSAGE_OBJECT_ENTRIES_RECEIVE
id
actor
entries
}
;
}
module
.
exports
=
{
messageAdd
messagesClear
messageOpen
messageClose
messageTableDataGet
networkMessageUpdate
messageObjectPropertiesLoad
messageObjectEntriesLoad
messageTableDataReceive
messageObjectPropertiesReceive
messageObjectEntriesReceive
}
;
