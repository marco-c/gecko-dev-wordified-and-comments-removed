"
use
strict
"
;
const
TEST_URI
=
"
http
:
/
/
example
.
com
/
browser
/
devtools
/
client
/
webconsole
/
"
+
"
new
-
console
-
output
/
test
/
mochitest
/
test
-
console
.
html
"
;
let
SHOULD_ENTER_MULTILINE
=
[
{
input
:
"
function
foo
(
)
{
"
}
{
input
:
"
var
a
=
1
"
}
{
input
:
"
var
a
=
1
;
"
shiftKey
:
true
}
{
input
:
"
function
foo
(
)
{
}
"
shiftKey
:
true
}
{
input
:
"
function
"
}
{
input
:
"
(
x
)
=
>
"
}
{
input
:
"
let
b
=
{
"
}
{
input
:
"
let
a
=
[
"
}
{
input
:
"
{
"
}
{
input
:
"
{
bob
:
3343
"
}
{
input
:
"
function
x
(
y
=
"
}
{
input
:
"
Array
.
from
(
"
}
{
input
:
"
{
2
}
"
shiftKey
:
true
}
]
;
let
SHOULD_EXECUTE
=
[
{
input
:
"
function
foo
(
)
{
}
"
}
{
input
:
"
var
a
=
1
;
"
}
{
input
:
"
function
foo
(
)
{
var
a
=
1
;
}
"
}
{
input
:
'
"
asdf
"
'
}
{
input
:
"
99
+
3
"
}
{
input
:
"
1
2
3
"
}
{
input
:
"
function
f
(
x
)
{
let
y
=
1
}
"
}
{
input
:
"
function
f
(
x
=
)
{
"
}
{
input
:
"
{
2
}
"
}
]
;
add_task
(
async
function
(
)
{
let
hud
=
await
openNewTabAndConsole
(
TEST_URI
)
;
let
{
inputNode
}
=
hud
.
jsterm
;
for
(
let
{
input
shiftKey
}
of
SHOULD_ENTER_MULTILINE
)
{
hud
.
jsterm
.
setInputValue
(
input
)
;
EventUtils
.
synthesizeKey
(
"
VK_RETURN
"
{
shiftKey
}
)
;
let
inputValue
=
hud
.
jsterm
.
getInputValue
(
)
;
is
(
inputNode
.
selectionStart
inputNode
.
selectionEnd
"
selection
is
collapsed
"
)
;
is
(
inputNode
.
selectionStart
inputValue
.
length
"
caret
at
end
of
multiline
input
"
)
;
let
inputWithNewline
=
input
+
"
\
n
"
;
is
(
inputValue
inputWithNewline
"
Input
value
is
correct
"
)
;
}
for
(
let
{
input
shiftKey
}
of
SHOULD_EXECUTE
)
{
hud
.
jsterm
.
setInputValue
(
input
)
;
EventUtils
.
synthesizeKey
(
"
VK_RETURN
"
{
shiftKey
}
)
;
await
waitFor
(
(
)
=
>
!
hud
.
jsterm
.
getInputValue
(
)
)
;
let
inputValue
=
hud
.
jsterm
.
getInputValue
(
)
;
is
(
inputNode
.
selectionStart
0
"
selection
starts
/
ends
at
0
"
)
;
is
(
inputNode
.
selectionEnd
0
"
selection
starts
/
ends
at
0
"
)
;
is
(
inputValue
"
"
"
Input
value
is
cleared
"
)
;
}
}
)
;
