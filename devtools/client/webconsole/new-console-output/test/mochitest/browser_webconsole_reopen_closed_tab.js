"
use
strict
"
;
const
TEST_URI
=
"
http
:
/
/
example
.
com
/
browser
/
devtools
/
client
/
webconsole
/
"
+
"
test
/
test
-
bug
-
597756
-
reopen
-
closed
-
tab
.
html
"
;
var
HUD
;
add_task
(
function
*
(
)
{
if
(
!
Services
.
appinfo
.
browserTabsRemoteAutostart
)
{
expectUncaughtException
(
)
;
}
let
{
browser
}
=
yield
loadTab
(
TEST_URI
)
;
HUD
=
yield
openConsole
(
)
;
if
(
!
Services
.
appinfo
.
browserTabsRemoteAutostart
)
{
expectUncaughtException
(
)
;
}
yield
reload
(
browser
)
;
yield
testMessages
(
)
;
yield
closeConsole
(
)
;
gBrowser
.
removeCurrentTab
(
)
;
if
(
!
Services
.
appinfo
.
browserTabsRemoteAutostart
)
{
expectUncaughtException
(
)
;
}
let
tab
=
yield
loadTab
(
TEST_URI
)
;
HUD
=
yield
openConsole
(
)
;
if
(
!
Services
.
appinfo
.
browserTabsRemoteAutostart
)
{
expectUncaughtException
(
)
;
}
yield
reload
(
tab
.
browser
)
;
yield
testMessages
(
)
;
HUD
=
null
;
}
)
;
function
reload
(
browser
)
{
let
loaded
=
loadBrowser
(
browser
)
;
browser
.
reload
(
)
;
return
loaded
;
}
function
testMessages
(
)
{
return
waitForMessages
(
{
webconsole
:
HUD
messages
:
[
{
name
:
"
error
message
displayed
"
text
:
"
fooBug597756_error
"
category
:
CATEGORY_JS
severity
:
SEVERITY_ERROR
}
]
}
)
;
}
