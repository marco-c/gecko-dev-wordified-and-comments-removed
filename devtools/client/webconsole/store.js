"
use
strict
"
;
const
{
FilterState
}
=
require
(
"
devtools
/
client
/
webconsole
/
reducers
/
filters
"
)
;
const
{
PrefState
}
=
require
(
"
devtools
/
client
/
webconsole
/
reducers
/
prefs
"
)
;
const
{
UiState
}
=
require
(
"
devtools
/
client
/
webconsole
/
reducers
/
ui
"
)
;
const
{
applyMiddleware
compose
createStore
}
=
require
(
"
devtools
/
client
/
shared
/
vendor
/
redux
"
)
;
const
{
PREFS
}
=
require
(
"
devtools
/
client
/
webconsole
/
constants
"
)
;
const
{
getPrefsService
}
=
require
(
"
devtools
/
client
/
webconsole
/
utils
/
prefs
"
)
;
const
{
reducers
}
=
require
(
"
devtools
/
client
/
webconsole
/
reducers
/
index
"
)
;
const
{
ignore
}
=
require
(
"
devtools
/
client
/
shared
/
redux
/
middleware
/
ignore
"
)
;
const
eventTelemetry
=
require
(
"
devtools
/
client
/
webconsole
/
middleware
/
event
-
telemetry
"
)
;
const
historyPersistence
=
require
(
"
devtools
/
client
/
webconsole
/
middleware
/
history
-
persistence
"
)
;
const
performanceMarker
=
require
(
"
devtools
/
client
/
webconsole
/
middleware
/
performance
-
marker
"
)
;
const
{
thunk
}
=
require
(
"
devtools
/
client
/
shared
/
redux
/
middleware
/
thunk
"
)
;
const
enableBatching
=
require
(
"
devtools
/
client
/
webconsole
/
enhancers
/
batching
"
)
;
const
enableActorReleaser
=
require
(
"
devtools
/
client
/
webconsole
/
enhancers
/
actor
-
releaser
"
)
;
const
ensureCSSErrorReportingEnabled
=
require
(
"
devtools
/
client
/
webconsole
/
enhancers
/
css
-
error
-
reporting
"
)
;
const
enableMessagesCacheClearing
=
require
(
"
devtools
/
client
/
webconsole
/
enhancers
/
message
-
cache
-
clearing
"
)
;
function
configureStore
(
webConsoleUI
options
=
{
}
)
{
const
prefsService
=
getPrefsService
(
webConsoleUI
)
;
const
{
getBoolPref
getIntPref
}
=
prefsService
;
const
logLimit
=
options
.
logLimit
|
|
Math
.
max
(
getIntPref
(
"
devtools
.
hud
.
loglimit
"
)
1
)
;
const
sidebarToggle
=
getBoolPref
(
PREFS
.
FEATURES
.
SIDEBAR_TOGGLE
)
;
const
autocomplete
=
getBoolPref
(
PREFS
.
FEATURES
.
AUTOCOMPLETE
)
;
const
eagerEvaluation
=
getBoolPref
(
PREFS
.
FEATURES
.
EAGER_EVALUATION
)
;
const
groupWarnings
=
getBoolPref
(
PREFS
.
FEATURES
.
GROUP_WARNINGS
)
;
const
historyCount
=
getIntPref
(
PREFS
.
UI
.
INPUT_HISTORY_COUNT
)
;
const
initialState
=
{
prefs
:
PrefState
(
{
logLimit
sidebarToggle
autocomplete
eagerEvaluation
historyCount
groupWarnings
}
)
filters
:
FilterState
(
{
error
:
getBoolPref
(
PREFS
.
FILTER
.
ERROR
)
warn
:
getBoolPref
(
PREFS
.
FILTER
.
WARN
)
info
:
getBoolPref
(
PREFS
.
FILTER
.
INFO
)
debug
:
getBoolPref
(
PREFS
.
FILTER
.
DEBUG
)
log
:
getBoolPref
(
PREFS
.
FILTER
.
LOG
)
css
:
getBoolPref
(
PREFS
.
FILTER
.
CSS
)
net
:
getBoolPref
(
PREFS
.
FILTER
.
NET
)
netxhr
:
getBoolPref
(
PREFS
.
FILTER
.
NETXHR
)
}
)
ui
:
UiState
(
{
networkMessageActiveTabId
:
"
headers
"
persistLogs
:
getBoolPref
(
PREFS
.
UI
.
PERSIST
)
showContentMessages
:
webConsoleUI
.
isBrowserConsole
|
|
webConsoleUI
.
isBrowserToolboxConsole
?
getBoolPref
(
PREFS
.
UI
.
CONTENT_MESSAGES
)
:
true
editor
:
getBoolPref
(
PREFS
.
UI
.
EDITOR
)
editorWidth
:
getIntPref
(
PREFS
.
UI
.
EDITOR_WIDTH
)
showEditorOnboarding
:
getBoolPref
(
PREFS
.
UI
.
EDITOR_ONBOARDING
)
timestampsVisible
:
getBoolPref
(
PREFS
.
UI
.
MESSAGE_TIMESTAMP
)
showEvaluationContextSelector
:
getBoolPref
(
PREFS
.
UI
.
CONTEXT_SELECTOR
)
enableNetworkMonitoring
:
webConsoleUI
.
isBrowserConsole
|
|
webConsoleUI
.
isBrowserToolboxConsole
?
getBoolPref
(
PREFS
.
UI
.
ENABLE_NETWORK_MONITORING
)
:
true
}
)
}
;
const
{
toolbox
}
=
options
.
thunkArgs
;
const
sessionId
=
(
toolbox
&
&
toolbox
.
sessionId
)
|
|
-
1
;
const
middleware
=
applyMiddleware
(
performanceMarker
(
sessionId
)
ignore
thunk
(
{
prefsService
.
.
.
options
.
thunkArgs
}
)
historyPersistence
.
bind
(
null
webConsoleUI
)
eventTelemetry
.
bind
(
null
options
.
telemetry
sessionId
)
)
;
return
createStore
(
createRootReducer
(
)
initialState
compose
(
middleware
enableActorReleaser
(
webConsoleUI
)
enableMessagesCacheClearing
(
webConsoleUI
)
ensureCSSErrorReportingEnabled
(
webConsoleUI
)
enableBatching
(
)
)
)
;
}
function
createRootReducer
(
)
{
return
function
rootReducer
(
state
action
)
{
const
newState
=
Object
.
entries
(
reducers
)
.
reduce
(
(
res
[
key
reducer
]
)
=
>
{
if
(
key
!
=
=
"
messages
"
&
&
key
!
=
=
"
history
"
)
{
res
[
key
]
=
reducer
(
state
[
key
]
action
)
;
}
return
res
;
}
{
}
)
;
newState
.
history
=
reducers
.
history
(
state
.
history
action
newState
.
prefs
)
;
newState
.
messages
=
reducers
.
messages
(
state
.
messages
action
newState
.
filters
newState
.
prefs
newState
.
ui
)
;
return
newState
;
}
;
}
module
.
exports
.
configureStore
=
configureStore
;
