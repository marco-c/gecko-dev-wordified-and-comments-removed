"
use
strict
"
;
const
{
MESSAGES_ADD
}
=
require
(
"
devtools
/
client
/
webconsole
/
constants
"
)
;
const
ChromeUtils
=
require
(
"
ChromeUtils
"
)
;
const
{
Cu
}
=
require
(
"
chrome
"
)
;
function
performanceMarkerMiddleware
(
store
)
{
return
next
=
>
action
=
>
{
const
shouldAddProfileMarker
=
action
.
type
=
=
=
MESSAGES_ADD
;
const
startTime
=
shouldAddProfileMarker
?
Cu
.
now
(
)
:
null
;
const
state
=
next
(
action
)
;
if
(
shouldAddProfileMarker
)
{
const
{
messages
}
=
action
;
const
totalMessageCount
=
store
.
getState
(
)
.
messages
.
messagesById
.
size
;
ChromeUtils
.
addProfilerMarker
(
"
WebconsoleAddMessages
"
startTime
{
messages
.
length
}
messages
handled
store
now
has
{
totalMessageCount
}
messages
)
;
}
return
state
;
}
;
}
module
.
exports
=
performanceMarkerMiddleware
;
