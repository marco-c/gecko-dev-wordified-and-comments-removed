"
use
strict
"
;
const
{
APPEND_TO_HISTORY
CLEAR_HISTORY
HISTORY_LOADED
UPDATE_HISTORY_PLACEHOLDER
HISTORY_BACK
HISTORY_FORWARD
}
=
require
(
"
devtools
/
client
/
webconsole
/
constants
"
)
;
function
getInitialState
(
)
{
return
{
entries
:
[
]
placeHolder
:
undefined
index
:
0
}
;
}
function
history
(
state
=
getInitialState
(
)
action
prefsState
)
{
switch
(
action
.
type
)
{
case
APPEND_TO_HISTORY
:
return
appendToHistory
(
state
prefsState
action
.
expression
)
;
case
CLEAR_HISTORY
:
return
clearHistory
(
state
)
;
case
HISTORY_LOADED
:
return
historyLoaded
(
state
action
.
entries
)
;
case
UPDATE_HISTORY_PLACEHOLDER
:
return
updatePlaceHolder
(
state
action
.
direction
action
.
expression
)
;
}
return
state
;
}
function
appendToHistory
(
state
prefsState
expression
)
{
state
=
{
.
.
.
state
}
;
state
.
entries
=
[
.
.
.
state
.
entries
]
;
if
(
expression
.
trim
(
)
!
=
state
.
entries
[
state
.
index
-
1
]
)
{
state
.
entries
[
state
.
index
+
+
]
=
expression
;
}
else
if
(
state
.
index
<
state
.
entries
.
length
)
{
state
.
entries
.
pop
(
)
;
}
state
.
placeHolder
=
state
.
entries
.
length
;
if
(
state
.
entries
.
length
>
prefsState
.
historyCount
)
{
state
.
entries
.
splice
(
0
state
.
entries
.
length
-
prefsState
.
historyCount
)
;
state
.
index
=
state
.
placeHolder
=
state
.
entries
.
length
;
}
return
state
;
}
function
clearHistory
(
state
)
{
return
getInitialState
(
)
;
}
function
historyLoaded
(
state
entries
)
{
const
newEntries
=
[
.
.
.
entries
.
.
.
state
.
entries
]
;
return
{
.
.
.
state
entries
:
newEntries
placeHolder
:
newEntries
.
length
index
:
newEntries
.
length
}
;
}
function
updatePlaceHolder
(
state
direction
expression
)
{
if
(
direction
=
=
HISTORY_BACK
)
{
if
(
state
.
placeHolder
<
=
0
)
{
return
state
;
}
state
=
{
.
.
.
state
}
;
if
(
state
.
placeHolder
=
=
state
.
index
)
{
state
.
entries
=
[
.
.
.
state
.
entries
]
;
state
.
entries
[
state
.
index
]
=
expression
|
|
"
"
;
}
state
.
placeHolder
-
-
;
}
else
if
(
direction
=
=
HISTORY_FORWARD
)
{
if
(
state
.
placeHolder
>
=
(
state
.
entries
.
length
-
1
)
)
{
return
state
;
}
state
=
{
.
.
.
state
placeHolder
:
state
.
placeHolder
+
1
}
;
}
return
state
;
}
exports
.
history
=
history
;
