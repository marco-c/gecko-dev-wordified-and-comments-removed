"
use
strict
"
;
const
{
RUNTIME_PREFERENCE
}
=
require
(
"
.
.
/
constants
"
)
;
const
PREF_TYPES
=
{
BOOL
:
"
BOOL
"
}
;
const
PREF_TO_TYPE
=
{
[
RUNTIME_PREFERENCE
.
CONNECTION_PROMPT
]
:
PREF_TYPES
.
BOOL
}
;
const
MAIN_ROOT_EVENTS
=
[
"
addonListChanged
"
"
processListChanged
"
"
serviceWorkerRegistrationListChanged
"
"
tabListChanged
"
"
workerListChanged
"
]
;
class
ClientWrapper
{
constructor
(
client
)
{
this
.
client
=
client
;
this
.
contentProcessFronts
=
[
]
;
}
addOneTimeListener
(
evt
listener
)
{
if
(
MAIN_ROOT_EVENTS
.
includes
(
evt
)
)
{
this
.
client
.
mainRoot
.
once
(
evt
listener
)
;
}
else
{
this
.
client
.
addOneTimeListener
(
evt
listener
)
;
}
}
addListener
(
evt
listener
)
{
if
(
MAIN_ROOT_EVENTS
.
includes
(
evt
)
)
{
this
.
client
.
mainRoot
.
on
(
evt
listener
)
;
}
else
{
this
.
client
.
addListener
(
evt
listener
)
;
}
}
removeListener
(
evt
listener
)
{
if
(
MAIN_ROOT_EVENTS
.
includes
(
evt
)
)
{
this
.
client
.
mainRoot
.
off
(
evt
listener
)
;
}
else
{
this
.
client
.
removeListener
(
evt
listener
)
;
}
}
onFront
(
typeName
listener
)
{
this
.
client
.
mainRoot
.
onFront
(
typeName
listener
)
;
}
async
getDeviceDescription
(
)
{
const
deviceFront
=
await
this
.
client
.
mainRoot
.
getFront
(
"
device
"
)
;
const
{
brandName
channel
deviceName
version
}
=
await
deviceFront
.
getDescription
(
)
;
return
{
channel
deviceName
name
:
brandName
version
}
;
}
async
setPreference
(
prefName
value
)
{
const
prefType
=
PREF_TO_TYPE
[
prefName
]
;
const
preferenceFront
=
await
this
.
client
.
mainRoot
.
getFront
(
"
preference
"
)
;
switch
(
prefType
)
{
case
PREF_TYPES
.
BOOL
:
return
preferenceFront
.
setBoolPref
(
prefName
value
)
;
default
:
throw
new
Error
(
"
Unsupported
preference
"
+
prefName
)
;
}
}
async
getPreference
(
prefName
)
{
const
prefType
=
PREF_TO_TYPE
[
prefName
]
;
const
preferenceFront
=
await
this
.
client
.
mainRoot
.
getFront
(
"
preference
"
)
;
switch
(
prefType
)
{
case
PREF_TYPES
.
BOOL
:
return
preferenceFront
.
getBoolPref
(
prefName
)
;
default
:
throw
new
Error
(
"
Unsupported
preference
:
"
+
prefName
)
;
}
}
async
listTabs
(
options
)
{
return
this
.
client
.
mainRoot
.
listTabs
(
options
)
;
}
async
listAddons
(
options
)
{
return
this
.
client
.
mainRoot
.
listAddons
(
options
)
;
}
async
getAddon
(
{
id
}
)
{
return
this
.
client
.
mainRoot
.
getAddon
(
{
id
}
)
;
}
async
getServiceWorkerFront
(
{
id
}
)
{
const
{
serviceWorkers
}
=
await
this
.
listWorkers
(
)
;
const
workerFronts
=
serviceWorkers
.
map
(
sw
=
>
sw
.
workerTargetFront
)
;
return
workerFronts
.
find
(
front
=
>
front
&
&
front
.
actorID
=
=
=
id
)
;
}
async
listWorkers
(
)
{
const
{
other
service
shared
}
=
await
this
.
client
.
mainRoot
.
listAllWorkers
(
)
;
return
{
otherWorkers
:
other
serviceWorkers
:
service
sharedWorkers
:
shared
}
;
}
async
request
(
options
)
{
return
this
.
client
.
request
(
options
)
;
}
async
close
(
)
{
return
this
.
client
.
close
(
)
;
}
}
exports
.
ClientWrapper
=
ClientWrapper
;
