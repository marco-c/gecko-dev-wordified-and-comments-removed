"
use
strict
"
;
loader
.
lazyRequireGetter
(
this
"
adbAddon
"
"
devtools
/
shared
/
adb
/
adb
-
addon
"
true
)
;
loader
.
lazyRequireGetter
(
this
"
ADB_ADDON_STATES
"
"
devtools
/
shared
/
adb
/
adb
-
addon
"
true
)
;
loader
.
lazyGetter
(
this
"
adbScanner
"
(
)
=
>
{
const
{
ADBScanner
}
=
require
(
"
devtools
/
shared
/
adb
/
adb
-
scanner
"
)
;
return
new
ADBScanner
(
)
;
}
)
;
function
_onAdbAddonUpdate
(
)
{
if
(
adbAddon
.
status
=
=
=
ADB_ADDON_STATES
.
INSTALLED
)
{
adbScanner
.
enable
(
)
;
}
else
{
adbScanner
.
disable
(
)
;
}
}
function
addUSBRuntimesObserver
(
listener
)
{
adbScanner
.
on
(
"
runtime
-
list
-
updated
"
listener
)
;
}
exports
.
addUSBRuntimesObserver
=
addUSBRuntimesObserver
;
function
disableUSBRuntimes
(
)
{
if
(
adbAddon
.
status
=
=
=
ADB_ADDON_STATES
.
INSTALLED
)
{
adbScanner
.
disable
(
)
;
}
adbAddon
.
off
(
"
update
"
_onAdbAddonUpdate
)
;
}
exports
.
disableUSBRuntimes
=
disableUSBRuntimes
;
async
function
enableUSBRuntimes
(
)
{
if
(
adbAddon
.
status
=
=
=
ADB_ADDON_STATES
.
INSTALLED
)
{
adbScanner
.
enable
(
)
;
}
adbAddon
.
on
(
"
update
"
_onAdbAddonUpdate
)
;
}
exports
.
enableUSBRuntimes
=
enableUSBRuntimes
;
function
getUSBRuntimes
(
)
{
return
adbScanner
.
listRuntimes
(
)
;
}
exports
.
getUSBRuntimes
=
getUSBRuntimes
;
function
removeUSBRuntimesObserver
(
listener
)
{
adbScanner
.
off
(
"
runtime
-
list
-
updated
"
listener
)
;
}
exports
.
removeUSBRuntimesObserver
=
removeUSBRuntimesObserver
;
