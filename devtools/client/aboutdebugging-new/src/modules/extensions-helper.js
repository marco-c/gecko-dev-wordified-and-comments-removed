"
use
strict
"
;
const
{
Cc
Ci
}
=
require
(
"
chrome
"
)
;
const
Services
=
require
(
"
Services
"
)
;
loader
.
lazyImporter
(
this
"
AddonManager
"
"
resource
:
/
/
gre
/
modules
/
AddonManager
.
jsm
"
)
;
loader
.
lazyRequireGetter
(
this
"
FileUtils
"
"
resource
:
/
/
gre
/
modules
/
FileUtils
.
jsm
"
true
)
;
const
{
PREFERENCES
}
=
require
(
"
.
.
/
constants
"
)
;
exports
.
uninstallAddon
=
async
function
(
addonID
)
{
const
addon
=
await
AddonManager
.
getAddonByID
(
addonID
)
;
return
addon
&
&
addon
.
uninstall
(
)
;
}
;
exports
.
parseFileUri
=
function
(
url
)
{
const
windowsRegex
=
/
^
file
:
\
/
\
/
\
/
(
[
a
-
zA
-
Z
]
:
\
/
.
*
)
/
;
if
(
windowsRegex
.
test
(
url
)
)
{
return
windowsRegex
.
exec
(
url
)
[
1
]
;
}
return
url
.
slice
(
"
file
:
/
/
"
.
length
)
;
}
;
exports
.
getExtensionUuid
=
function
(
extension
)
{
const
{
manifestURL
}
=
extension
;
return
manifestURL
?
/
moz
-
extension
:
\
/
\
/
(
[
^
/
]
*
)
/
.
exec
(
manifestURL
)
[
1
]
:
null
;
}
;
exports
.
openTemporaryExtension
=
function
(
win
message
)
{
return
new
Promise
(
resolve
=
>
{
const
fp
=
Cc
[
"
mozilla
.
org
/
filepicker
;
1
"
]
.
createInstance
(
Ci
.
nsIFilePicker
)
;
fp
.
init
(
win
message
Ci
.
nsIFilePicker
.
modeOpen
)
;
try
{
const
lastDirPath
=
Services
.
prefs
.
getCharPref
(
PREFERENCES
.
TEMPORARY_EXTENSION_PATH
"
"
)
;
const
lastDir
=
new
FileUtils
.
File
(
lastDirPath
)
;
fp
.
displayDirectory
=
lastDir
;
}
catch
(
e
)
{
}
fp
.
open
(
res
=
>
{
if
(
res
=
=
Ci
.
nsIFilePicker
.
returnCancel
|
|
!
fp
.
file
)
{
return
;
}
let
file
=
fp
.
file
;
if
(
!
file
.
isDirectory
(
)
&
&
!
file
.
leafName
.
endsWith
(
"
.
xpi
"
)
&
&
!
file
.
leafName
.
endsWith
(
"
.
zip
"
)
)
{
file
=
file
.
parent
;
}
Services
.
prefs
.
setCharPref
(
PREFERENCES
.
TEMPORARY_EXTENSION_PATH
file
.
path
)
;
resolve
(
file
)
;
}
)
;
}
)
;
}
;
