"
use
strict
"
;
const
{
DEBUG_TARGETS
REQUEST_EXTENSIONS_SUCCESS
}
=
require
(
"
.
.
/
constants
"
)
;
const
{
getExtensionUuid
parseFileUri
}
=
require
(
"
devtools
/
client
/
aboutdebugging
/
modules
/
addon
"
)
;
const
extensionComponentDataMiddleware
=
store
=
>
next
=
>
action
=
>
{
switch
(
action
.
type
)
{
case
REQUEST_EXTENSIONS_SUCCESS
:
{
action
.
installedExtensions
=
toComponentData
(
action
.
installedExtensions
)
;
action
.
temporaryExtensions
=
toComponentData
(
action
.
temporaryExtensions
)
;
break
;
}
}
return
next
(
action
)
;
}
;
function
getFilePath
(
extension
)
{
if
(
!
extension
.
temporarilyInstalled
|
|
!
extension
.
url
|
|
!
extension
.
url
.
startsWith
(
"
file
:
/
/
"
)
)
{
return
null
;
}
return
parseFileUri
(
extension
.
url
)
;
}
function
toComponentData
(
extensions
)
{
return
extensions
.
map
(
extension
=
>
{
const
type
=
DEBUG_TARGETS
.
EXTENSION
;
const
{
actor
iconURL
id
manifestURL
name
}
=
extension
;
const
icon
=
iconURL
|
|
"
chrome
:
/
/
mozapps
/
skin
/
extensions
/
extensionGeneric
.
svg
"
;
const
location
=
getFilePath
(
extension
)
;
const
uuid
=
getExtensionUuid
(
extension
)
;
return
{
name
icon
id
type
details
:
{
actor
location
manifestURL
uuid
}
}
;
}
)
;
}
module
.
exports
=
extensionComponentDataMiddleware
;
