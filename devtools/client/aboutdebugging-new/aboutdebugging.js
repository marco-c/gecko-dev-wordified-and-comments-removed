"
use
strict
"
;
const
Services
=
require
(
"
Services
"
)
;
const
{
bindActionCreators
}
=
require
(
"
devtools
/
client
/
shared
/
vendor
/
redux
"
)
;
const
{
createFactory
}
=
require
(
"
devtools
/
client
/
shared
/
vendor
/
react
"
)
;
const
{
render
unmountComponentAtNode
}
=
require
(
"
devtools
/
client
/
shared
/
vendor
/
react
-
dom
"
)
;
const
Provider
=
createFactory
(
require
(
"
devtools
/
client
/
shared
/
vendor
/
react
-
redux
"
)
.
Provider
)
;
const
actions
=
require
(
"
.
/
src
/
actions
/
index
"
)
;
const
{
configureStore
}
=
require
(
"
.
/
src
/
create
-
store
"
)
;
const
{
setDebugTargetCollapsibilities
}
=
require
(
"
.
/
src
/
modules
/
debug
-
target
-
collapsibilities
"
)
;
const
{
l10n
}
=
require
(
"
.
/
src
/
modules
/
l10n
"
)
;
const
{
addNetworkLocationsObserver
getNetworkLocations
removeNetworkLocationsObserver
}
=
require
(
"
.
/
src
/
modules
/
network
-
locations
"
)
;
const
{
addUSBRuntimesObserver
disableUSBRuntimes
enableUSBRuntimes
getUSBRuntimes
removeUSBRuntimesObserver
}
=
require
(
"
.
/
src
/
modules
/
usb
-
runtimes
"
)
;
loader
.
lazyRequireGetter
(
this
"
adbAddon
"
"
devtools
/
shared
/
adb
/
adb
-
addon
"
true
)
;
const
Router
=
createFactory
(
require
(
"
devtools
/
client
/
shared
/
vendor
/
react
-
router
-
dom
"
)
.
HashRouter
)
;
const
App
=
createFactory
(
require
(
"
.
/
src
/
components
/
App
"
)
)
;
const
AboutDebugging
=
{
async
init
(
)
{
if
(
!
Services
.
prefs
.
getBoolPref
(
"
devtools
.
enabled
"
true
)
)
{
window
.
location
=
"
about
:
devtools
?
reason
=
AboutDebugging
"
;
return
;
}
this
.
onAdbAddonUpdated
=
this
.
onAdbAddonUpdated
.
bind
(
this
)
;
this
.
onNetworkLocationsUpdated
=
this
.
onNetworkLocationsUpdated
.
bind
(
this
)
;
this
.
onUSBRuntimesUpdated
=
this
.
onUSBRuntimesUpdated
.
bind
(
this
)
;
this
.
store
=
configureStore
(
)
;
this
.
actions
=
bindActionCreators
(
actions
this
.
store
.
dispatch
)
;
await
l10n
.
init
(
)
;
render
(
Provider
(
{
store
:
this
.
store
}
Router
(
{
}
App
(
{
fluentBundles
:
l10n
.
getBundles
(
)
}
)
)
)
this
.
mount
)
;
this
.
actions
.
updateNetworkLocations
(
getNetworkLocations
(
)
)
;
addNetworkLocationsObserver
(
this
.
onNetworkLocationsUpdated
)
;
addUSBRuntimesObserver
(
this
.
onUSBRuntimesUpdated
)
;
await
enableUSBRuntimes
(
)
;
adbAddon
.
on
(
"
update
"
this
.
onAdbAddonUpdated
)
;
this
.
onAdbAddonUpdated
(
)
;
await
adbAddon
.
uninstallUnsupportedExtensions
(
)
;
}
onAdbAddonUpdated
(
)
{
this
.
actions
.
updateAdbAddonStatus
(
adbAddon
.
status
)
;
}
onNetworkLocationsUpdated
(
)
{
this
.
actions
.
updateNetworkLocations
(
getNetworkLocations
(
)
)
;
}
onUSBRuntimesUpdated
(
)
{
this
.
actions
.
updateUSBRuntimes
(
getUSBRuntimes
(
)
)
;
}
async
destroy
(
)
{
const
state
=
this
.
store
.
getState
(
)
;
l10n
.
destroy
(
)
;
const
currentRuntimeId
=
state
.
runtimes
.
selectedRuntimeId
;
if
(
currentRuntimeId
)
{
await
this
.
actions
.
unwatchRuntime
(
currentRuntimeId
)
;
}
this
.
actions
.
removeRuntimeListeners
(
)
;
removeNetworkLocationsObserver
(
this
.
onNetworkLocationsUpdated
)
;
removeUSBRuntimesObserver
(
this
.
onUSBRuntimesUpdated
)
;
disableUSBRuntimes
(
)
;
adbAddon
.
off
(
"
update
"
this
.
onAdbAddonUpdated
)
;
setDebugTargetCollapsibilities
(
state
.
ui
.
debugTargetCollapsibilities
)
;
unmountComponentAtNode
(
this
.
mount
)
;
}
get
mount
(
)
{
return
document
.
getElementById
(
"
mount
"
)
;
}
}
;
window
.
addEventListener
(
"
DOMContentLoaded
"
(
)
=
>
{
AboutDebugging
.
init
(
)
;
}
{
once
:
true
}
)
;
window
.
addEventListener
(
"
unload
"
(
)
=
>
{
AboutDebugging
.
destroy
(
)
;
}
{
once
:
true
}
)
;
window
.
AboutDebugging
=
AboutDebugging
;
