"
use
strict
"
;
function
setupTelemetryTest
(
)
{
Services
.
telemetry
.
clearEvents
(
)
;
const
OPTOUT
=
Ci
.
nsITelemetry
.
DATASET_RELEASE_CHANNEL_OPTOUT
;
const
snapshot
=
Services
.
telemetry
.
snapshotEvents
(
OPTOUT
true
)
;
ok
(
!
snapshot
.
parent
"
No
events
have
been
logged
for
the
main
process
"
)
;
}
function
getOpenEventSessionId
(
)
{
const
openEvents
=
readAboutDebuggingEvents
(
)
.
filter
(
e
=
>
e
.
method
=
=
=
"
open_adbg
"
)
;
ok
(
!
!
openEvents
[
0
]
"
Found
an
about
:
debugging
open
event
"
)
;
return
openEvents
[
0
]
.
extras
.
session_id
;
}
function
readAboutDebuggingEvents
(
)
{
const
OPTOUT
=
Ci
.
nsITelemetry
.
DATASET_RELEASE_CHANNEL_OPTOUT
;
const
snapshot
=
Services
.
telemetry
.
snapshotEvents
(
OPTOUT
true
)
;
const
parentEvents
=
snapshot
.
parent
|
|
[
]
;
return
parentEvents
.
map
(
_toEventObject
)
.
filter
(
e
=
>
e
.
object
=
=
=
"
aboutdebugging
"
)
;
}
function
_toEventObject
(
rawEvent
)
{
return
{
category
:
rawEvent
[
1
]
method
:
rawEvent
[
2
]
object
:
rawEvent
[
3
]
value
:
rawEvent
[
4
]
extras
:
rawEvent
[
5
]
}
;
}
