"
use
strict
"
;
Services
.
scriptloader
.
loadSubScript
(
CHROME_URL_ROOT
+
"
helper
-
collapsibilities
.
js
"
this
)
;
add_task
(
async
function
(
)
{
info
(
"
Force
all
debug
target
panes
to
be
expanded
"
)
;
prepareCollapsibilitiesTest
(
)
;
const
{
document
tab
window
}
=
await
openAboutDebugging
(
)
;
info
(
"
Show
about
:
devtools
-
toolbox
page
"
)
;
const
target
=
findDebugTargetByText
(
"
about
:
debugging
"
document
)
;
ok
(
target
"
about
:
debugging
tab
target
appeared
"
)
;
const
inspectButton
=
target
.
querySelector
(
"
.
js
-
debug
-
target
-
inspect
-
button
"
)
;
ok
(
inspectButton
"
Inspect
button
for
about
:
debugging
appeared
"
)
;
inspectButton
.
click
(
)
;
await
Promise
.
all
(
[
waitUntil
(
(
)
=
>
tab
.
nextElementSibling
)
waitForRequestsToSettle
(
window
.
AboutDebugging
.
store
)
gDevTools
.
once
(
"
toolbox
-
ready
"
)
]
)
;
info
(
"
Wait
for
about
:
devtools
-
toolbox
tab
will
be
selected
"
)
;
const
devtoolsTab
=
tab
.
nextElementSibling
;
await
waitUntil
(
(
)
=
>
gBrowser
.
selectedTab
=
=
=
devtoolsTab
)
;
info
(
"
Check
whether
the
menu
items
are
disabled
"
)
;
const
rootDocument
=
devtoolsTab
.
ownerDocument
;
await
assertMenusItems
(
rootDocument
false
)
;
info
(
"
Force
to
select
about
:
debugging
page
"
)
;
gBrowser
.
selectedTab
=
tab
;
info
(
"
Check
whether
the
menu
items
are
enabled
"
)
;
await
assertMenusItems
(
rootDocument
true
)
;
await
removeTab
(
devtoolsTab
)
;
await
waitForRequestsToSettle
(
window
.
AboutDebugging
.
store
)
;
await
removeTab
(
tab
)
;
}
)
;
async
function
assertMenusItems
(
rootDocument
shouldBeEnabled
)
{
const
menuItem
=
rootDocument
.
getElementById
(
"
menu_devToolbox
"
)
;
await
waitUntil
(
(
)
=
>
menuItem
.
hidden
=
=
=
!
shouldBeEnabled
)
;
assertMenuItem
(
rootDocument
"
menu_devToolbox
"
shouldBeEnabled
)
;
for
(
const
toolDefinition
of
gDevTools
.
getToolDefinitionArray
(
)
)
{
if
(
!
toolDefinition
.
inMenu
)
{
continue
;
}
assertMenuItem
(
rootDocument
"
menuitem_
"
+
toolDefinition
.
id
shouldBeEnabled
)
;
}
}
function
assertMenuItem
(
rootDocument
menuItemId
shouldBeEnabled
)
{
const
menuItem
=
rootDocument
.
getElementById
(
menuItemId
)
;
is
(
menuItem
.
hidden
!
shouldBeEnabled
"
hidden
"
attribute
of
menu
item
(
{
menuItemId
}
)
should
be
correct
)
;
}
