"
use
strict
"
;
const
BrowserLoaderModule
=
{
}
;
ChromeUtils
.
import
(
"
resource
:
/
/
devtools
/
client
/
shared
/
browser
-
loader
.
js
"
BrowserLoaderModule
)
;
const
{
require
}
=
BrowserLoaderModule
.
BrowserLoader
(
{
baseURI
:
"
resource
:
/
/
devtools
/
client
/
memory
/
"
window
}
)
;
const
Perf
=
require
(
"
devtools
/
client
/
performance
-
new
/
components
/
Perf
"
)
;
const
Services
=
require
(
"
Services
"
)
;
const
ReactDOM
=
require
(
"
devtools
/
client
/
shared
/
vendor
/
react
-
dom
"
)
;
const
React
=
require
(
"
devtools
/
client
/
shared
/
vendor
/
react
"
)
;
const
createStore
=
require
(
"
devtools
/
client
/
shared
/
redux
/
create
-
store
"
)
(
)
;
const
reducers
=
require
(
"
devtools
/
client
/
performance
-
new
/
store
/
reducers
"
)
;
const
actions
=
require
(
"
devtools
/
client
/
performance
-
new
/
store
/
actions
"
)
;
const
{
Provider
}
=
require
(
"
devtools
/
client
/
shared
/
vendor
/
react
-
redux
"
)
;
function
gInit
(
toolbox
perfFront
)
{
const
store
=
createStore
(
reducers
)
;
store
.
dispatch
(
actions
.
initializeStore
(
{
toolbox
perfFront
receiveProfile
:
profile
=
>
{
let
browser
=
top
.
gBrowser
;
if
(
!
browser
)
{
const
win
=
Services
.
wm
.
getMostRecentWindow
(
"
navigator
:
browser
"
)
;
if
(
!
win
)
{
throw
new
Error
(
"
No
browser
window
"
)
;
}
browser
=
win
.
gBrowser
;
Services
.
focus
.
activeWindow
=
win
;
}
const
tab
=
browser
.
addTab
(
"
https
:
/
/
perf
-
html
.
io
/
from
-
addon
"
)
;
browser
.
selectedTab
=
tab
;
const
mm
=
tab
.
linkedBrowser
.
messageManager
;
mm
.
loadFrameScript
(
"
chrome
:
/
/
devtools
/
content
/
performance
-
new
/
frame
-
script
.
js
"
false
)
;
mm
.
sendAsyncMessage
(
"
devtools
:
perf
-
html
-
transfer
-
profile
"
profile
)
;
}
}
)
)
;
ReactDOM
.
render
(
React
.
createElement
(
Provider
{
store
}
React
.
createElement
(
Perf
)
)
document
.
querySelector
(
"
#
root
"
)
)
;
}
function
gDestroy
(
)
{
ReactDOM
.
unmountComponentAtNode
(
document
.
querySelector
(
"
#
root
"
)
)
;
}
