"
use
strict
"
;
{
const
{
BrowserLoader
}
=
ChromeUtils
.
import
(
"
resource
:
/
/
devtools
/
client
/
shared
/
browser
-
loader
.
js
"
)
;
const
browserLoader
=
BrowserLoader
(
{
baseURI
:
"
resource
:
/
/
devtools
/
client
/
performance
-
new
/
popup
"
window
}
)
;
const
scope
=
this
;
scope
.
require
=
browserLoader
.
require
;
scope
.
loader
=
browserLoader
.
loader
;
}
const
{
getRecordingPreferencesFromBrowser
setRecordingPreferencesOnBrowser
getSymbolsFromThisBrowser
}
=
(
ChromeUtils
.
import
(
"
resource
:
/
/
devtools
/
client
/
performance
-
new
/
popup
/
background
.
jsm
.
js
"
)
)
;
const
{
receiveProfile
}
=
require
(
"
devtools
/
client
/
performance
-
new
/
browser
"
)
;
const
ReactDOM
=
require
(
"
devtools
/
client
/
shared
/
vendor
/
react
-
dom
"
)
;
const
React
=
require
(
"
devtools
/
client
/
shared
/
vendor
/
react
"
)
;
const
DevToolsAndPopup
=
React
.
createFactory
(
require
(
"
devtools
/
client
/
performance
-
new
/
components
/
DevToolsAndPopup
"
)
)
;
const
ProfilerEventHandling
=
React
.
createFactory
(
require
(
"
devtools
/
client
/
performance
-
new
/
components
/
ProfilerEventHandling
"
)
)
;
const
createStore
=
require
(
"
devtools
/
client
/
shared
/
redux
/
create
-
store
"
)
;
const
reducers
=
require
(
"
devtools
/
client
/
performance
-
new
/
store
/
reducers
"
)
;
const
actions
=
require
(
"
devtools
/
client
/
performance
-
new
/
store
/
actions
"
)
;
const
{
Provider
}
=
require
(
"
devtools
/
client
/
shared
/
vendor
/
react
-
redux
"
)
;
const
{
ActorReadyGeckoProfilerInterface
}
=
require
(
"
devtools
/
shared
/
performance
-
new
/
gecko
-
profiler
-
interface
"
)
;
{
const
popupWindow
=
(
window
)
;
document
.
documentElement
.
setAttribute
(
"
force
-
theme
"
popupWindow
.
gIsDarkMode
?
"
dark
"
:
"
light
"
)
;
}
document
.
addEventListener
(
"
DOMContentLoaded
"
(
)
=
>
{
gInit
(
)
;
}
)
;
async
function
gInit
(
)
{
const
store
=
createStore
(
reducers
)
;
const
perfFrontInterface
=
new
ActorReadyGeckoProfilerInterface
(
)
;
const
supportedFeatures
=
await
perfFrontInterface
.
getSupportedFeatures
(
)
;
store
.
dispatch
(
actions
.
initializeStore
(
{
perfFront
:
perfFrontInterface
receiveProfile
supportedFeatures
recordingPreferences
:
getRecordingPreferencesFromBrowser
(
)
setRecordingPreferences
:
setRecordingPreferencesOnBrowser
getSymbolTableGetter
:
(
)
=
>
getSymbolsFromThisBrowser
pageContext
:
"
popup
"
}
)
)
;
ReactDOM
.
render
(
React
.
createElement
(
Provider
{
store
}
React
.
createElement
(
React
.
Fragment
null
ProfilerEventHandling
(
)
DevToolsAndPopup
(
)
)
)
document
.
querySelector
(
"
#
root
"
)
)
;
window
.
addEventListener
(
"
unload
"
function
(
)
{
perfFrontInterface
.
destroy
(
)
;
}
)
;
resizeWindow
(
)
;
}
function
resizeWindow
(
)
{
window
.
requestAnimationFrame
(
(
)
=
>
{
const
anyWindow
=
window
;
const
{
gResizePopup
}
=
anyWindow
;
if
(
gResizePopup
)
{
gResizePopup
(
document
.
body
.
clientHeight
)
;
}
}
)
;
}
