"
use
strict
"
;
add_task
(
async
function
test
(
)
{
info
(
"
Test
the
states
of
the
profiler
button
e
.
g
.
inactive
active
and
capturing
.
"
)
;
await
setProfilerFrontendUrl
(
"
https
:
/
/
example
.
com
"
"
/
browser
/
devtools
/
client
/
performance
-
new
/
test
/
browser
/
fake
-
frontend
.
html
"
)
;
await
makeSureProfilerPopupIsEnabled
(
)
;
const
{
toggleProfiler
captureProfile
}
=
ChromeUtils
.
importESModule
(
"
resource
:
/
/
devtools
/
client
/
performance
-
new
/
shared
/
background
.
sys
.
mjs
"
)
;
const
button
=
document
.
getElementById
(
"
profiler
-
button
-
button
"
)
;
if
(
!
button
)
{
throw
new
Error
(
"
Could
not
find
the
profiler
button
.
"
)
;
}
info
(
"
The
profiler
button
starts
out
inactive
"
)
;
await
checkButtonState
(
button
{
tooltip
:
"
Record
a
performance
profile
"
active
:
false
paused
:
false
}
)
;
info
(
"
Toggling
the
profiler
turns
on
the
active
state
"
)
;
toggleProfiler
(
"
aboutprofiling
"
)
;
await
checkButtonState
(
button
{
tooltip
:
"
The
profiler
is
recording
a
profile
"
active
:
true
paused
:
false
}
)
;
info
(
"
Capturing
a
profile
makes
the
button
paused
"
)
;
captureProfile
(
"
aboutprofiling
"
)
;
await
checkButtonState
(
button
{
active
:
false
paused
:
true
}
)
;
await
waitUntil
(
(
)
=
>
!
button
.
classList
.
contains
(
"
profiler
-
paused
"
)
"
Waiting
until
the
profiler
is
no
longer
paused
"
)
;
await
checkButtonState
(
button
{
tooltip
:
"
Record
a
performance
profile
"
active
:
false
paused
:
false
}
)
;
await
checkTabLoadedProfile
(
{
initialTitle
:
"
Waiting
on
the
profile
"
successTitle
:
"
Profile
received
"
errorTitle
:
"
Error
"
}
)
;
}
)
;
async
function
checkButtonState
(
button
{
tooltip
active
paused
}
)
{
is
(
button
.
classList
.
contains
(
"
profiler
-
active
"
)
active
The
expected
profiler
button
active
state
is
:
{
active
}
)
;
is
(
button
.
classList
.
contains
(
"
profiler
-
paused
"
)
paused
The
expected
profiler
button
paused
state
is
:
{
paused
}
)
;
if
(
tooltip
)
{
await
getElementByTooltip
(
document
tooltip
)
;
}
}
