"
use
strict
"
;
add_task
(
async
function
test
(
)
{
info
(
"
Test
the
WebChannel
mechanism
that
it
changes
the
preset
to
firefox
-
platform
"
)
;
await
makeSureProfilerPopupIsDisabled
(
)
;
const
supportedFeatures
=
Services
.
profiler
.
GetFeatures
(
)
;
PrefsPresets
.
changePreset
(
"
aboutprofiling
"
"
web
-
developer
"
supportedFeatures
)
;
await
withAboutProfiling
(
async
document
=
>
{
const
webdevPreset
=
document
.
querySelector
(
"
input
[
value
=
web
-
developer
]
"
)
;
const
firefoxPreset
=
await
document
.
querySelector
(
"
input
[
value
=
firefox
-
platform
]
"
)
;
ok
(
webdevPreset
.
checked
"
By
default
the
Web
Developer
preset
is
checked
.
"
)
;
ok
(
!
firefoxPreset
.
checked
"
By
default
the
Firefox
Platform
preset
is
not
checked
.
"
)
;
await
withWebChannelTestDocument
(
async
_browser
=
>
{
await
waitForTabTitle
(
"
WebChannel
Page
Ready
"
)
;
await
waitForProfilerMenuButton
(
)
;
ok
(
true
"
The
profiler
menu
button
was
enabled
by
the
WebChannel
.
"
)
;
}
)
;
ok
(
!
webdevPreset
.
checked
"
Web
Developer
preset
should
not
be
checked
anymore
.
"
)
;
ok
(
firefoxPreset
.
checked
"
Firefox
Platform
preset
should
now
be
checked
after
enabling
the
popup
with
web
channel
.
"
)
;
}
)
;
}
)
;
