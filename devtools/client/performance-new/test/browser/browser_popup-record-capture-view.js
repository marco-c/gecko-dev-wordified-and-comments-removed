"
use
strict
"
;
const
FRONTEND_BASE_URL
=
"
http
:
/
/
example
.
com
/
browser
/
devtools
/
client
/
performance
-
new
/
test
/
browser
/
fake
-
frontend
.
html
"
;
add_task
(
async
function
test
(
)
{
info
(
"
Test
that
the
profiler
pop
-
up
correctly
opens
the
captured
profile
on
the
"
+
"
correct
frontend
view
by
adding
proper
view
query
string
"
)
;
await
setProfilerFrontendUrl
(
FRONTEND_BASE_URL
)
;
await
makeSureProfilerPopupIsEnabled
(
)
;
await
openPopupAndAssertUrlForPreset
(
{
preset
:
"
firefox
-
platform
"
expectedUrl
:
FRONTEND_BASE_URL
}
)
;
await
openPopupAndAssertUrlForPreset
(
{
preset
:
"
web
-
developer
"
expectedUrl
:
FRONTEND_BASE_URL
+
"
?
view
=
active
-
tab
"
}
)
;
}
)
;
async
function
openPopupAndAssertUrlForPreset
(
{
preset
expectedUrl
}
)
{
BackgroundJSM
.
changePreset
(
"
aboutprofiling
"
preset
[
]
)
;
await
openPopupAndEnsureCloses
(
window
async
(
)
=
>
{
{
const
button
=
await
getElementByLabel
(
document
"
Start
Recording
"
)
;
info
(
"
Click
the
button
to
start
recording
.
"
)
;
button
.
click
(
)
;
}
{
const
button
=
await
getElementByLabel
(
document
"
Capture
"
)
;
info
(
"
Click
the
button
to
capture
the
recording
.
"
)
;
button
.
click
(
)
;
}
info
(
"
If
the
profiler
successfully
captures
a
profile
it
will
create
a
new
"
+
"
tab
with
the
proper
view
query
string
depending
on
the
preset
.
"
)
;
await
waitForTabUrl
(
{
initialTitle
:
"
Waiting
on
the
profile
"
successTitle
:
"
Profile
received
"
errorTitle
:
"
Error
"
expectedUrl
}
)
;
}
)
;
}
