"
use
strict
"
;
const
FRONTEND_BASE_URL
=
"
http
:
/
/
example
.
com
/
browser
/
devtools
/
client
/
performance
-
new
/
test
/
browser
/
fake
-
frontend
.
html
"
;
add_task
(
async
function
test
(
)
{
info
(
"
Test
that
the
profiler
pop
-
up
correctly
opens
the
captured
profile
on
the
"
+
"
correct
frontend
view
by
adding
proper
view
query
string
"
)
;
BackgroundJSM
.
changePreset
(
"
aboutprofiling
"
"
web
-
developer
"
Services
.
profiler
.
GetFeatures
(
)
)
;
await
setProfilerFrontendUrl
(
FRONTEND_BASE_URL
)
;
await
makeSureProfilerPopupIsEnabled
(
)
;
await
openPopupAndAssertUrlForPreset
(
{
preset
:
"
Firefox
Platform
"
expectedUrl
:
FRONTEND_BASE_URL
}
)
;
await
openPopupAndAssertUrlForPreset
(
{
preset
:
"
Web
Developer
"
expectedUrl
:
FRONTEND_BASE_URL
+
"
?
view
=
active
-
tab
&
implementation
=
js
"
}
)
;
}
)
;
async
function
openPopupAndAssertUrlForPreset
(
{
preset
expectedUrl
}
)
{
await
openPopupAndEnsureCloses
(
window
async
(
)
=
>
{
{
const
presetsInPopup
=
document
.
getElementById
(
"
PanelUI
-
profiler
-
presets
"
)
;
presetsInPopup
.
menupopup
.
openPopup
(
)
;
presetsInPopup
.
menupopup
.
activateItem
(
await
getElementByLabel
(
presetsInPopup
preset
)
)
;
await
TestUtils
.
waitForCondition
(
(
)
=
>
presetsInPopup
.
label
=
=
=
preset
After
selecting
the
preset
in
the
popup
waiting
until
the
preset
is
changed
to
{
preset
}
in
the
popup
.
)
;
}
{
const
button
=
await
getElementByLabel
(
document
"
Start
Recording
"
)
;
info
(
"
Click
the
button
to
start
recording
.
"
)
;
button
.
click
(
)
;
}
{
const
button
=
await
getElementByLabel
(
document
"
Capture
"
)
;
info
(
"
Click
the
button
to
capture
the
recording
.
"
)
;
button
.
click
(
)
;
}
info
(
"
If
the
profiler
successfully
captures
a
profile
it
will
create
a
new
"
+
"
tab
with
the
proper
view
query
string
depending
on
the
preset
.
"
)
;
await
waitForTabUrl
(
{
initialTitle
:
"
Waiting
on
the
profile
"
successTitle
:
"
Profile
received
"
errorTitle
:
"
Error
"
expectedUrl
}
)
;
}
)
;
}
