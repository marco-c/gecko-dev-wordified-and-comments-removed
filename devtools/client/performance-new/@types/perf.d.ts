import
{
Reducer
as
ReduxReducer
Store
as
ReduxStore
}
from
"
devtools
/
client
/
shared
/
vendor
/
redux
"
;
export
interface
PanelWindow
{
gToolbox
?
:
any
;
gStore
?
:
Store
;
gInit
(
perfFront
:
PerfFront
pageContext
:
PageContext
)
:
void
;
gDestroy
(
)
:
void
;
gReportReady
?
(
)
:
void
;
gIsPanelDestroyed
?
:
boolean
;
}
export
interface
Target
{
client
:
any
;
}
export
interface
Toolbox
{
target
:
Target
;
}
type
MaybePromise
<
T
>
=
Promise
<
T
>
|
T
;
export
interface
PerfFront
{
startProfiler
:
(
options
:
RecordingStateFromPreferences
)
=
>
MaybePromise
<
boolean
>
;
getProfileAndStopProfiler
:
(
)
=
>
Promise
<
any
>
;
stopProfilerAndDiscardProfile
:
(
)
=
>
MaybePromise
<
void
>
;
getSymbolTable
:
(
path
:
string
breakpadId
:
string
)
=
>
Promise
<
[
number
[
]
number
[
]
number
[
]
]
>
;
isActive
:
(
)
=
>
MaybePromise
<
boolean
>
;
isSupportedPlatform
:
(
)
=
>
MaybePromise
<
boolean
>
;
isLockedForPrivateBrowsing
:
(
)
=
>
MaybePromise
<
boolean
>
;
on
:
(
type
:
string
listener
:
(
)
=
>
void
)
=
>
void
;
off
:
(
type
:
string
listener
:
(
)
=
>
void
)
=
>
void
;
destroy
:
(
)
=
>
void
getSupportedFeatures
:
(
)
=
>
MaybePromise
<
string
[
]
>
}
export
interface
PreferenceFront
{
clearUserPref
:
(
prefName
:
string
)
=
>
Promise
<
void
>
;
getStringPref
:
(
prefName
:
string
)
=
>
Promise
<
string
>
;
setStringPref
:
(
prefName
:
string
value
:
string
)
=
>
Promise
<
void
>
;
getCharPref
:
(
prefName
:
string
)
=
>
Promise
<
string
>
;
setCharPref
:
(
prefName
:
string
value
:
string
)
=
>
Promise
<
void
>
;
getIntPref
:
(
prefName
:
string
)
=
>
Promise
<
number
>
;
setIntPref
:
(
prefName
:
string
value
:
number
)
=
>
Promise
<
void
>
;
}
export
type
RecordingState
=
|
"
not
-
yet
-
known
"
|
"
available
-
to
-
record
"
|
"
request
-
to
-
start
-
recording
"
|
"
request
-
to
-
get
-
profile
-
and
-
stop
-
profiler
"
|
"
request
-
to
-
stop
-
profiler
"
|
"
recording
"
|
"
locked
-
by
-
private
-
browsing
"
;
export
type
PageContext
=
|
"
devtools
"
|
"
devtools
-
remote
"
|
"
aboutprofiling
"
|
"
aboutprofiling
-
remote
"
;
export
interface
State
{
recordingState
:
RecordingState
;
recordingUnexpectedlyStopped
:
boolean
;
isSupportedPlatform
:
boolean
;
interval
:
number
;
entries
:
number
;
features
:
string
[
]
;
threads
:
string
[
]
;
objdirs
:
string
[
]
;
presetName
:
string
;
initializedValues
:
InitializedValues
|
null
;
promptEnvRestart
:
null
|
string
}
export
type
Selector
<
T
>
=
(
state
:
State
)
=
>
T
;
export
type
ThunkDispatch
=
<
Returns
>
(
action
:
ThunkAction
<
Returns
>
)
=
>
Returns
;
export
type
PlainDispatch
=
(
action
:
Action
)
=
>
Action
;
export
type
GetState
=
(
)
=
>
State
;
export
type
SymbolTableAsTuple
=
[
Uint32Array
Uint32Array
Uint8Array
]
;
export
type
Dispatch
=
PlainDispatch
&
ThunkDispatch
;
export
type
ThunkAction
<
Returns
>
=
(
dispatch
:
Dispatch
getState
:
GetState
)
=
>
Returns
;
export
interface
Library
{
start
:
number
;
end
:
number
;
offset
:
number
;
name
:
string
;
path
:
string
;
debugName
:
string
;
debugPath
:
string
;
breakpadId
:
string
;
arch
:
string
;
}
export
interface
MinimallyTypedGeckoProfile
{
libs
:
Array
<
{
debugName
:
string
breakpadId
:
string
}
>
;
processes
:
Array
<
MinimallyTypedGeckoProfile
>
;
}
export
type
GetSymbolTableCallback
=
(
debugName
:
string
breakpadId
:
string
)
=
>
Promise
<
SymbolTableAsTuple
>
;
export
type
ReceiveProfile
=
(
geckoProfile
:
MinimallyTypedGeckoProfile
getSymbolTableCallback
:
GetSymbolTableCallback
)
=
>
void
;
export
type
SetRecordingPreferences
=
(
settings
:
RecordingStateFromPreferences
)
=
>
void
;
export
type
RestartBrowserWithEnvironmentVariable
=
(
envName
:
string
value
:
string
)
=
>
void
;
export
type
GetEnvironmentVariable
=
(
envName
:
string
)
=
>
string
;
export
type
GetActiveBrowsingContextID
=
(
)
=
>
number
;
interface
GeckoProfilerFrameScriptInterface
{
getProfile
:
(
)
=
>
Promise
<
MinimallyTypedGeckoProfile
>
;
getSymbolTable
:
GetSymbolTableCallback
;
}
export
interface
RecordingStateFromPreferences
{
presetName
:
string
;
entries
:
number
;
interval
:
number
;
features
:
string
[
]
;
threads
:
string
[
]
;
objdirs
:
string
[
]
;
duration
?
:
number
;
}
export
type
Reducer
<
S
>
=
(
state
:
S
|
undefined
action
:
Action
)
=
>
S
;
export
interface
InitializedValues
{
perfFront
:
PerfFront
;
receiveProfile
:
ReceiveProfile
;
setRecordingPreferences
:
SetRecordingPreferences
;
presets
:
Presets
;
pageContext
:
PageContext
;
getSymbolTableGetter
:
(
profile
:
MinimallyTypedGeckoProfile
)
=
>
GetSymbolTableCallback
;
supportedFeatures
:
string
[
]
openAboutProfiling
?
:
(
)
=
>
void
openRemoteDevTools
?
:
(
)
=
>
void
}
export
type
Store
=
ReduxStore
<
State
Action
>
;
export
type
Action
=
|
{
type
:
"
CHANGE_RECORDING_STATE
"
;
state
:
RecordingState
;
didRecordingUnexpectedlyStopped
:
boolean
;
}
|
{
type
:
"
REPORT_PROFILER_READY
"
;
isSupportedPlatform
:
boolean
;
recordingState
:
RecordingState
;
}
|
{
type
:
"
CHANGE_INTERVAL
"
;
interval
:
number
;
}
|
{
type
:
"
CHANGE_ENTRIES
"
;
entries
:
number
;
}
|
{
type
:
"
CHANGE_FEATURES
"
;
features
:
string
[
]
;
promptEnvRestart
:
string
|
null
}
|
{
type
:
"
CHANGE_THREADS
"
;
threads
:
string
[
]
;
}
|
{
type
:
"
CHANGE_OBJDIRS
"
;
objdirs
:
string
[
]
;
}
|
{
type
:
"
INITIALIZE_STORE
"
;
perfFront
:
PerfFront
;
receiveProfile
:
ReceiveProfile
;
setRecordingPreferences
:
SetRecordingPreferences
;
presets
:
Presets
;
pageContext
:
PageContext
;
openAboutProfiling
?
:
(
)
=
>
void
openRemoteDevTools
?
:
(
)
=
>
void
recordingSettingsFromPreferences
:
RecordingStateFromPreferences
;
getSymbolTableGetter
:
(
profile
:
MinimallyTypedGeckoProfile
)
=
>
GetSymbolTableCallback
;
supportedFeatures
:
string
[
]
;
}
|
{
type
:
"
CHANGE_PRESET
"
;
presetName
:
string
;
preset
:
PresetDefinition
|
undefined
;
}
;
export
interface
InitializeStoreValues
{
perfFront
:
PerfFront
;
receiveProfile
:
ReceiveProfile
;
setRecordingPreferences
:
SetRecordingPreferences
;
presets
:
Presets
;
pageContext
:
PageContext
;
recordingPreferences
:
RecordingStateFromPreferences
;
supportedFeatures
:
string
[
]
;
getSymbolTableGetter
:
(
profile
:
MinimallyTypedGeckoProfile
)
=
>
GetSymbolTableCallback
;
openAboutProfiling
?
:
(
)
=
>
void
;
openRemoteDevTools
?
:
(
)
=
>
void
;
}
export
type
PopupBackgroundFeatures
=
{
[
feature
:
string
]
:
boolean
}
;
export
interface
PopupBackgroundState
{
features
:
PopupBackgroundFeatures
;
buffersize
:
number
;
windowLength
:
number
;
interval
:
number
;
threads
:
string
;
}
export
interface
ContentFrameMessageManager
{
addMessageListener
:
(
event
:
string
listener
:
(
event
:
any
)
=
>
void
)
=
>
void
;
addEventListener
:
(
event
:
string
listener
:
(
event
:
any
)
=
>
void
)
=
>
void
;
sendAsyncMessage
:
(
name
:
string
data
:
any
)
=
>
void
;
}
export
interface
PerformancePref
{
Preset
:
"
devtools
.
performance
.
recording
.
preset
"
;
Entries
:
"
devtools
.
performance
.
recording
.
entries
"
;
Interval
:
"
devtools
.
performance
.
recording
.
interval
"
;
Features
:
"
devtools
.
performance
.
recording
.
features
"
;
Threads
:
"
devtools
.
performance
.
recording
.
threads
"
;
ObjDirs
:
"
devtools
.
performance
.
recording
.
objdirs
"
;
Duration
:
"
devtools
.
performance
.
recording
.
duration
"
;
UIBaseUrl
:
"
devtools
.
performance
.
recording
.
ui
-
base
-
url
"
;
UIBaseUrlPathPref
:
"
devtools
.
performance
.
recording
.
ui
-
base
-
url
-
path
"
;
PopupIntroDisplayed
:
"
devtools
.
performance
.
popup
.
intro
-
displayed
"
;
PopupFeatureFlag
:
"
devtools
.
performance
.
popup
.
feature
-
flag
"
;
}
export
interface
PopupWindow
extends
Window
{
gResizePopup
?
:
(
height
:
number
)
=
>
void
;
gIsDarkMode
?
:
boolean
;
}
export
type
NumberScaler
=
(
value
:
number
)
=
>
number
;
export
interface
ScaleFunctions
{
fromFractionToValue
:
NumberScaler
fromValueToFraction
:
NumberScaler
fromFractionToSingleDigitValue
:
NumberScaler
}
export
interface
PresetDefinition
{
label
:
string
;
description
:
string
;
entries
:
number
;
interval
:
number
;
features
:
string
[
]
;
threads
:
string
[
]
;
duration
:
number
;
}
export
interface
Presets
{
[
presetName
:
string
]
:
PresetDefinition
;
}
export
type
MessageFromFrontend
=
|
{
type
:
"
STATUS_QUERY
"
;
requestId
:
number
;
}
|
{
type
:
"
ENABLE_MENU_BUTTON
"
;
requestId
:
number
;
}
;
export
type
MessageToFrontend
=
|
{
type
:
"
STATUS_RESPONSE
"
;
menuButtonIsEnabled
:
boolean
;
requestId
:
number
;
}
|
{
type
:
"
ENABLE_MENU_BUTTON_DONE
"
;
requestId
:
number
;
}
export
class
ProfilerWebChannel
{
constructor
(
id
:
string
url
:
MockedExports
.
nsIURI
)
;
send
:
(
message
:
MessageToFrontend
target
:
MockedExports
.
WebChannelTarget
)
=
>
void
;
listen
:
(
handler
:
(
idle
:
string
message
:
MessageFromFrontend
target
:
MockedExports
.
WebChannelTarget
)
=
>
void
)
=
>
void
;
}
export
interface
FeatureDescription
{
name
:
string
value
:
string
title
:
string
recommended
?
:
boolean
experimental
?
:
boolean
disabledReason
?
:
string
}
