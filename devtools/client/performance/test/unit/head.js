"
use
strict
"
;
var
{
require
}
=
ChromeUtils
.
import
(
"
resource
:
/
/
devtools
/
shared
/
Loader
.
jsm
"
{
}
)
;
var
Services
=
require
(
"
Services
"
)
;
var
{
console
}
=
require
(
"
resource
:
/
/
gre
/
modules
/
Console
.
jsm
"
)
;
const
RecordingUtils
=
require
(
"
devtools
/
shared
/
performance
/
recording
-
utils
"
)
;
const
PLATFORM_DATA_PREF
=
"
devtools
.
performance
.
ui
.
show
-
platform
-
data
"
;
function
getFrameNodePath
(
root
path
)
{
let
calls
=
root
.
calls
;
let
foundNode
;
for
(
let
key
of
path
.
split
(
"
>
"
)
)
{
foundNode
=
calls
.
find
(
(
node
)
=
>
node
.
key
=
=
key
)
;
if
(
!
foundNode
)
{
break
;
}
calls
=
foundNode
.
calls
;
}
return
foundNode
;
}
function
synthesizeProfileForTest
(
samples
)
{
samples
.
unshift
(
{
time
:
0
frames
:
[
{
location
:
"
(
root
)
"
}
]
}
)
;
let
uniqueStacks
=
new
RecordingUtils
.
UniqueStacks
(
)
;
return
RecordingUtils
.
deflateThread
(
{
samples
:
samples
markers
:
[
]
}
uniqueStacks
)
;
}
