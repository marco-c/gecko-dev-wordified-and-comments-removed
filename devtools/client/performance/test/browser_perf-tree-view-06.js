"
use
strict
"
;
const
{
ThreadNode
}
=
require
(
"
devtools
/
client
/
performance
/
modules
/
logic
/
tree
-
model
"
)
;
const
{
CallView
}
=
require
(
"
devtools
/
client
/
performance
/
modules
/
widgets
/
tree
-
view
"
)
;
const
{
synthesizeProfile
}
=
require
(
"
devtools
/
client
/
performance
/
test
/
helpers
/
synth
-
utils
"
)
;
const
{
idleWait
waitUntil
}
=
require
(
"
devtools
/
client
/
performance
/
test
/
helpers
/
wait
-
utils
"
)
;
add_task
(
async
function
(
)
{
const
profile
=
synthesizeProfile
(
)
;
const
threadNode
=
new
ThreadNode
(
profile
.
threads
[
0
]
{
startTime
:
0
endTime
:
20
}
)
;
threadNode
.
calls
=
threadNode
.
calls
[
0
]
.
calls
;
const
treeRoot
=
new
CallView
(
{
frame
:
threadNode
}
)
;
const
container
=
document
.
createXULElement
(
"
vbox
"
)
;
treeRoot
.
attachTo
(
container
)
;
const
A
=
treeRoot
.
getChild
(
)
;
const
B
=
A
.
getChild
(
)
;
const
D
=
B
.
getChild
(
)
;
let
linkEvent
=
null
;
const
handler
=
e
=
>
{
linkEvent
=
e
;
}
;
treeRoot
.
on
(
"
link
"
handler
)
;
rightMousedown
(
D
.
target
.
querySelector
(
"
.
call
-
tree
-
url
"
)
)
;
await
idleWait
(
100
)
;
ok
(
!
linkEvent
"
The
link
event
not
fired
for
right
click
.
"
)
;
mousedown
(
D
.
target
.
querySelector
(
"
.
call
-
tree
-
url
"
)
)
;
await
waitUntil
(
(
)
=
>
linkEvent
)
;
is
(
linkEvent
D
"
The
link
event
target
is
correct
.
"
)
;
treeRoot
.
off
(
"
link
"
handler
)
;
}
)
;
