"
use
strict
"
;
const
{
CC
}
=
require
(
"
chrome
"
)
;
const
{
Task
}
=
require
(
"
devtools
/
shared
/
task
"
)
;
const
DevToolsUtils
=
require
(
"
devtools
/
shared
/
DevToolsUtils
"
)
;
const
{
once
observeOnce
}
=
require
(
"
devtools
/
client
/
performance
/
test
/
helpers
/
event
-
utils
"
)
;
exports
.
busyWait
=
function
(
time
)
{
dump
(
Busy
waiting
for
:
{
time
}
milliseconds
.
\
n
)
;
let
start
=
Date
.
now
(
)
;
let
stack
;
while
(
Date
.
now
(
)
-
start
<
time
)
{
stack
=
CC
.
stack
;
}
}
;
exports
.
idleWait
=
function
(
time
)
{
dump
(
Idly
waiting
for
:
{
time
}
milliseconds
.
\
n
)
;
return
DevToolsUtils
.
waitForTime
(
time
)
;
}
;
exports
.
waitUntil
=
function
*
(
predicate
interval
=
100
tries
=
100
)
{
for
(
let
i
=
1
;
i
<
=
tries
;
i
+
+
)
{
if
(
yield
Task
.
spawn
(
predicate
)
)
{
dump
(
Predicate
returned
true
after
{
i
}
tries
.
\
n
)
;
return
;
}
yield
exports
.
idleWait
(
interval
)
;
}
throw
new
Error
(
Predicate
returned
false
after
{
tries
}
tries
aborting
.
\
n
)
;
}
;
exports
.
waitForMozAfterPaint
=
function
(
window
)
{
return
once
(
window
"
MozAfterPaint
"
)
;
}
;
exports
.
waitForDelayedStartupFinished
=
function
(
window
)
{
return
observeOnce
(
"
browser
-
delayed
-
startup
-
finished
"
{
expectedSubject
:
window
}
)
;
}
;
