"
use
strict
"
;
const
{
gDevTools
}
=
require
(
"
devtools
/
client
/
framework
/
devtools
"
)
;
const
{
TargetFactory
}
=
require
(
"
devtools
/
client
/
framework
/
target
"
)
;
const
{
addTab
removeTab
}
=
require
(
"
devtools
/
client
/
performance
/
test
/
helpers
/
tab
-
utils
"
)
;
const
{
once
}
=
require
(
"
devtools
/
client
/
performance
/
test
/
helpers
/
event
-
utils
"
)
;
exports
.
initPanelInNewTab
=
async
function
(
{
tool
url
win
}
options
=
{
}
)
{
let
tab
=
await
addTab
(
{
url
win
}
options
)
;
return
exports
.
initPanelInTab
(
{
tool
tab
}
)
;
}
;
exports
.
initPanelInTab
=
async
function
(
{
tool
tab
}
)
{
dump
(
Initializing
a
{
tool
}
panel
.
\
n
)
;
let
target
=
TargetFactory
.
forTab
(
tab
)
;
await
target
.
makeRemote
(
)
;
let
toolbox
=
await
gDevTools
.
showToolbox
(
target
tool
)
;
await
toolbox
.
initPerformance
(
)
;
let
panel
=
toolbox
.
getCurrentPanel
(
)
;
return
{
target
toolbox
panel
}
;
}
;
exports
.
initPerformanceInNewTab
=
async
function
(
{
url
win
}
options
=
{
}
)
{
let
tab
=
await
addTab
(
{
url
win
}
options
)
;
return
exports
.
initPerformanceInTab
(
{
tab
}
)
;
}
;
exports
.
initPerformanceInTab
=
async
function
(
{
tab
}
)
{
return
exports
.
initPanelInTab
(
{
tool
:
"
performance
"
tab
:
tab
}
)
;
}
;
exports
.
initConsoleInNewTab
=
async
function
(
{
url
win
}
options
=
{
}
)
{
let
tab
=
await
addTab
(
{
url
win
}
options
)
;
return
exports
.
initConsoleInTab
(
{
tab
}
)
;
}
;
exports
.
initConsoleInTab
=
async
function
(
{
tab
}
)
{
let
{
target
toolbox
panel
}
=
await
exports
.
initPanelInTab
(
{
tool
:
"
webconsole
"
tab
:
tab
}
)
;
let
consoleMethod
=
async
function
(
method
label
event
)
{
let
recordingEventReceived
=
once
(
toolbox
.
performance
event
)
;
if
(
label
=
=
=
undefined
)
{
await
panel
.
hud
.
jsterm
.
execute
(
console
.
{
method
}
(
)
)
;
}
else
{
await
panel
.
hud
.
jsterm
.
execute
(
console
.
{
method
}
(
"
{
label
}
"
)
)
;
}
await
recordingEventReceived
;
}
;
let
profile
=
async
function
(
label
)
{
return
consoleMethod
(
"
profile
"
label
"
recording
-
started
"
)
;
}
;
let
profileEnd
=
async
function
(
label
)
{
return
consoleMethod
(
"
profileEnd
"
label
"
recording
-
stopped
"
)
;
}
;
return
{
target
toolbox
panel
console
:
{
profile
profileEnd
}
}
;
}
;
exports
.
teardownToolboxAndRemoveTab
=
async
function
(
panel
options
)
{
dump
(
"
Destroying
panel
.
\
n
"
)
;
let
tab
=
panel
.
target
.
tab
;
await
panel
.
toolbox
.
destroy
(
)
;
await
removeTab
(
tab
options
)
;
}
;
