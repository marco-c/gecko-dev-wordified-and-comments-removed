"
use
strict
"
;
const
{
SIMPLE_URL
}
=
require
(
"
devtools
/
client
/
performance
/
test
/
helpers
/
urls
"
)
;
const
{
UI_ENABLE_MEMORY_PREF
}
=
require
(
"
devtools
/
client
/
performance
/
test
/
helpers
/
prefs
"
)
;
const
{
initPerformanceInNewTab
teardownToolboxAndRemoveTab
}
=
require
(
"
devtools
/
client
/
performance
/
test
/
helpers
/
panel
-
utils
"
)
;
const
{
startRecording
stopRecording
}
=
require
(
"
devtools
/
client
/
performance
/
test
/
helpers
/
actions
"
)
;
add_task
(
async
function
(
)
{
startTelemetry
(
)
;
const
{
panel
}
=
await
initPerformanceInNewTab
(
{
url
:
SIMPLE_URL
win
:
window
}
)
;
Services
.
prefs
.
setBoolPref
(
UI_ENABLE_MEMORY_PREF
false
)
;
await
startRecording
(
panel
)
;
await
stopRecording
(
panel
)
;
Services
.
prefs
.
setBoolPref
(
UI_ENABLE_MEMORY_PREF
true
)
;
await
startRecording
(
panel
)
;
await
stopRecording
(
panel
)
;
checkResults
(
)
;
await
teardownToolboxAndRemoveTab
(
panel
)
;
}
)
;
function
checkResults
(
)
{
checkTelemetry
(
"
DEVTOOLS_PERFTOOLS_RECORDING_COUNT
"
"
"
[
2
0
0
]
"
array
"
)
;
checkTelemetry
(
"
DEVTOOLS_PERFTOOLS_RECORDING_DURATION_MS
"
"
"
null
"
hasentries
"
)
;
checkTelemetry
(
"
DEVTOOLS_PERFTOOLS_RECORDING_FEATURES_USED
"
"
withMarkers
"
[
0
2
0
]
"
array
"
)
;
checkTelemetry
(
"
DEVTOOLS_PERFTOOLS_RECORDING_FEATURES_USED
"
"
withMemory
"
[
1
1
0
]
"
array
"
)
;
checkTelemetry
(
"
DEVTOOLS_PERFTOOLS_RECORDING_FEATURES_USED
"
"
withAllocations
"
[
2
0
0
]
"
array
"
)
;
checkTelemetry
(
"
DEVTOOLS_PERFTOOLS_RECORDING_FEATURES_USED
"
"
withTicks
"
[
0
2
0
]
"
array
"
)
;
}
