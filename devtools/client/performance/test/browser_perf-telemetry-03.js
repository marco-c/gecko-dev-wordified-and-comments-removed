function
*
spawnTest
(
)
{
requestLongerTimeout
(
2
)
;
PMM_loadFrameScripts
(
gBrowser
)
;
let
{
panel
}
=
yield
initPerformance
(
SIMPLE_URL
)
;
let
{
EVENTS
PerformanceController
OverviewView
DetailsView
WaterfallView
JsCallTreeView
JsFlameGraphView
}
=
panel
.
panelWin
;
Services
.
prefs
.
setBoolPref
(
MEMORY_PREF
false
)
;
let
VIEWS
=
"
DEVTOOLS_PERFTOOLS_SELECTED_VIEW_MS
"
;
let
telemetry
=
PerformanceController
.
_telemetry
;
let
logs
=
telemetry
.
getLogs
(
)
;
yield
startRecording
(
panel
)
;
yield
stopRecording
(
panel
)
;
let
calltreeRendered
=
once
(
JsCallTreeView
EVENTS
.
JS_CALL_TREE_RENDERED
)
;
let
flamegraphRendered
=
once
(
JsFlameGraphView
EVENTS
.
JS_FLAMEGRAPH_RENDERED
)
;
DetailsView
.
selectView
(
"
js
-
calltree
"
)
;
yield
calltreeRendered
;
DetailsView
.
selectView
(
"
js
-
flamegraph
"
)
;
yield
flamegraphRendered
;
yield
teardown
(
panel
)
;
ok
(
logs
[
VIEWS
]
.
find
(
r
=
>
r
[
0
]
=
=
=
"
waterfall
"
&
&
typeof
r
[
1
]
=
=
=
"
number
"
)
{
VIEWS
}
for
waterfall
view
and
time
.
)
;
ok
(
logs
[
VIEWS
]
.
find
(
r
=
>
r
[
0
]
=
=
=
"
js
-
calltree
"
&
&
typeof
r
[
1
]
=
=
=
"
number
"
)
{
VIEWS
}
for
js
-
calltree
view
and
time
.
)
;
ok
(
logs
[
VIEWS
]
.
find
(
r
=
>
r
[
0
]
=
=
=
"
js
-
flamegraph
"
&
&
typeof
r
[
1
]
=
=
=
"
number
"
)
{
VIEWS
}
for
js
-
flamegraph
view
and
time
.
)
;
finish
(
)
;
}
;
