"
use
strict
"
;
const
{
L10N
}
=
require
(
"
.
/
utils
/
l10n
"
)
;
class
Picker
{
constructor
(
panel
)
{
this
.
_panel
=
panel
;
this
.
isPicking
=
false
;
this
.
onPickerAccessibleHovered
=
this
.
onPickerAccessibleHovered
.
bind
(
this
)
;
this
.
onPickerAccessiblePicked
=
this
.
onPickerAccessiblePicked
.
bind
(
this
)
;
this
.
onPickerAccessiblePreviewed
=
this
.
onPickerAccessiblePreviewed
.
bind
(
this
)
;
this
.
onPickerAccessibleCanceled
=
this
.
onPickerAccessibleCanceled
.
bind
(
this
)
;
}
get
toolbox
(
)
{
return
this
.
_panel
.
_toolbox
;
}
get
walker
(
)
{
return
this
.
_panel
.
_walker
;
}
get
pickerButton
(
)
{
return
this
.
toolbox
.
pickerButton
;
}
get
_telemetry
(
)
{
return
this
.
_panel
.
_telemetry
;
}
release
(
)
{
this
.
_panel
=
null
;
}
emit
(
event
data
)
{
this
.
toolbox
.
emit
(
event
data
)
;
}
select
(
accessible
)
{
this
.
_panel
.
selectAccessible
(
accessible
)
;
}
highlight
(
accessible
)
{
this
.
_panel
.
highlightAccessible
(
accessible
)
;
}
getStr
(
key
)
{
return
L10N
.
getStr
(
key
)
;
}
updateButton
(
)
{
this
.
pickerButton
.
description
=
this
.
getStr
(
"
accessibility
.
pick
"
)
;
this
.
pickerButton
.
className
=
"
accessibility
"
;
this
.
pickerButton
.
disabled
=
!
this
.
_panel
.
_front
.
enabled
;
if
(
!
this
.
_panel
.
_front
.
enabled
&
&
this
.
isPicking
)
{
this
.
cancel
(
)
;
}
}
onPickerAccessibleHovered
(
accessible
)
{
if
(
accessible
)
{
this
.
emit
(
"
picker
-
accessible
-
hovered
"
accessible
)
;
this
.
highlight
(
accessible
)
;
}
}
onPickerAccessiblePicked
(
accessible
)
{
if
(
accessible
)
{
this
.
select
(
accessible
)
;
}
this
.
stop
(
)
;
}
onPickerAccessiblePreviewed
(
accessible
)
{
if
(
accessible
)
{
this
.
select
(
accessible
)
;
}
}
onPickerAccessibleCanceled
(
)
{
this
.
cancel
(
)
;
this
.
emit
(
"
picker
-
accessible
-
canceled
"
)
;
}
async
cancel
(
)
{
await
this
.
stop
(
)
;
}
async
stop
(
)
{
if
(
!
this
.
isPicking
)
{
return
;
}
this
.
isPicking
=
false
;
this
.
pickerButton
.
isChecked
=
false
;
await
this
.
walker
.
cancelPick
(
)
;
this
.
_telemetry
.
toolClosed
(
"
accessibilityPickerUsed
"
)
;
this
.
walker
.
off
(
"
picker
-
accessible
-
hovered
"
this
.
onPickerAccessibleHovered
)
;
this
.
walker
.
off
(
"
picker
-
accessible
-
picked
"
this
.
onPickerAccessiblePicked
)
;
this
.
walker
.
off
(
"
picker
-
accessible
-
previewed
"
this
.
onPickerAccessiblePreviewed
)
;
this
.
walker
.
off
(
"
picker
-
accessible
-
canceled
"
this
.
onPickerAccessibleCanceled
)
;
this
.
emit
(
"
picker
-
stopped
"
)
;
}
async
start
(
doFocus
=
true
)
{
if
(
this
.
isPicking
)
{
return
;
}
this
.
isPicking
=
true
;
this
.
pickerButton
.
isChecked
=
true
;
this
.
walker
.
on
(
"
picker
-
accessible
-
hovered
"
this
.
onPickerAccessibleHovered
)
;
this
.
walker
.
on
(
"
picker
-
accessible
-
picked
"
this
.
onPickerAccessiblePicked
)
;
this
.
walker
.
on
(
"
picker
-
accessible
-
previewed
"
this
.
onPickerAccessiblePreviewed
)
;
this
.
walker
.
on
(
"
picker
-
accessible
-
canceled
"
this
.
onPickerAccessibleCanceled
)
;
await
this
.
walker
.
pick
(
doFocus
)
;
this
.
_telemetry
.
toolOpened
(
"
accessibilityPickerUsed
"
)
;
this
.
emit
(
"
picker
-
started
"
)
;
}
toggle
(
doFocus
)
{
if
(
this
.
isPicking
)
{
return
this
.
cancel
(
)
;
}
return
this
.
start
(
doFocus
)
;
}
}
exports
.
Picker
=
Picker
;
