"
use
strict
"
;
const
{
AccessibilityProxy
}
=
require
(
"
devtools
/
client
/
accessibility
/
accessibility
-
proxy
"
)
;
class
AccessibilityStartup
{
constructor
(
toolbox
)
{
this
.
toolbox
=
toolbox
;
this
.
_updateToolHighlight
=
this
.
_updateToolHighlight
.
bind
(
this
)
;
this
.
initAccessibility
(
)
;
}
initAccessibility
(
)
{
if
(
!
this
.
_initAccessibility
)
{
this
.
_initAccessibility
=
async
function
(
)
{
await
Promise
.
race
(
[
this
.
toolbox
.
isOpen
this
.
toolbox
.
once
(
"
accessibility
-
init
"
)
]
)
;
this
.
accessibilityProxy
=
new
AccessibilityProxy
(
this
.
toolbox
)
;
const
initialized
=
await
Promise
.
race
(
[
this
.
accessibilityProxy
.
initialize
(
)
this
.
toolbox
.
target
.
once
(
"
close
"
)
]
)
;
if
(
!
initialized
)
{
return
;
}
this
.
_updateToolHighlight
(
)
;
this
.
accessibilityProxy
.
startListeningForLifecycleEvents
(
{
init
:
this
.
_updateToolHighlight
shutdown
:
this
.
_updateToolHighlight
}
)
;
}
.
bind
(
this
)
(
)
;
}
return
this
.
_initAccessibility
;
}
destroyAccessibility
(
)
{
if
(
this
.
_destroyingAccessibility
)
{
return
this
.
_destroyingAccessibility
;
}
this
.
_destroyingAccessibility
=
async
function
(
)
{
if
(
!
this
.
accessibilityProxy
)
{
return
;
}
await
this
.
_initAccessibility
;
this
.
accessibilityProxy
.
stopListeningForLifecycleEvents
(
{
init
:
this
.
_updateToolHighlight
shutdown
:
this
.
_updateToolHighlight
}
)
;
this
.
accessibilityProxy
.
destroy
(
)
;
this
.
accessibilityProxy
=
null
;
}
.
bind
(
this
)
(
)
;
return
this
.
_destroyingAccessibility
;
}
async
_updateToolHighlight
(
)
{
if
(
this
.
accessibilityProxy
.
supports
.
autoInit
)
{
return
;
}
const
isHighlighted
=
await
this
.
toolbox
.
isToolHighlighted
(
"
accessibility
"
)
;
if
(
this
.
accessibilityProxy
.
enabled
&
&
!
isHighlighted
)
{
this
.
toolbox
.
highlightTool
(
"
accessibility
"
)
;
}
else
if
(
!
this
.
accessibilityProxy
.
enabled
&
&
isHighlighted
)
{
this
.
toolbox
.
unhighlightTool
(
"
accessibility
"
)
;
}
}
async
destroy
(
)
{
await
this
.
destroyAccessibility
(
)
;
this
.
toolbox
=
null
;
}
}
exports
.
AccessibilityStartup
=
AccessibilityStartup
;
