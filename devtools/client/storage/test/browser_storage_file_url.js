"
use
strict
"
;
add_task
(
async
function
(
)
{
const
TESTPAGE
=
"
storage
-
file
-
url
.
html
"
;
const
testPath
=
getResolvedURI
(
gTestPath
)
;
const
dir
=
getChromeDir
(
testPath
)
;
dir
.
append
(
TESTPAGE
)
;
const
uriString
=
Services
.
io
.
newFileURI
(
dir
)
.
spec
;
await
openTabAndSetupStorage
(
uriString
)
;
const
browser
=
gBrowser
.
selectedBrowser
;
const
actualPath
=
await
ContentTask
.
spawn
(
browser
null
(
)
=
>
{
return
content
.
document
.
location
.
href
;
}
)
;
const
cookiePath
=
actualPath
.
substr
(
0
actualPath
.
lastIndexOf
(
"
/
"
)
+
1
)
.
replace
(
/
file
:
\
/
\
/
/
g
"
"
)
;
await
checkState
(
[
[
[
"
cookies
"
actualPath
]
[
getCookieId
(
"
test1
"
"
"
cookiePath
)
getCookieId
(
"
test2
"
"
"
cookiePath
)
]
]
[
[
"
indexedDB
"
actualPath
"
MyDatabase
(
default
)
"
"
MyObjectStore
"
]
[
12345
54321
67890
98765
]
]
[
[
"
localStorage
"
actualPath
]
[
"
test3
"
"
test4
"
]
]
[
[
"
sessionStorage
"
actualPath
]
[
"
test5
"
"
test6
"
]
]
]
)
;
await
finishTests
(
)
;
}
)
;
