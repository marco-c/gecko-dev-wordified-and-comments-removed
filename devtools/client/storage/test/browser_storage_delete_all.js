"
use
strict
"
;
add_task
(
function
*
(
)
{
yield
openTabAndSetupStorage
(
MAIN_DOMAIN
+
"
storage
-
listings
.
html
"
)
;
let
contextMenu
=
gPanelWindow
.
document
.
getElementById
(
"
storage
-
table
-
popup
"
)
;
let
menuDeleteAllItem
=
contextMenu
.
querySelector
(
"
#
storage
-
table
-
popup
-
delete
-
all
"
)
;
info
(
"
test
state
before
delete
"
)
;
const
beforeState
=
[
[
[
"
localStorage
"
"
http
:
/
/
test1
.
example
.
org
"
]
[
"
ls1
"
"
ls2
"
]
]
[
[
"
localStorage
"
"
http
:
/
/
sectest1
.
example
.
org
"
]
[
"
iframe
-
u
-
ls1
"
]
]
[
[
"
localStorage
"
"
https
:
/
/
sectest1
.
example
.
org
"
]
[
"
iframe
-
s
-
ls1
"
]
]
[
[
"
sessionStorage
"
"
http
:
/
/
test1
.
example
.
org
"
]
[
"
ss1
"
]
]
[
[
"
sessionStorage
"
"
http
:
/
/
sectest1
.
example
.
org
"
]
[
"
iframe
-
u
-
ss1
"
"
iframe
-
u
-
ss2
"
]
]
[
[
"
sessionStorage
"
"
https
:
/
/
sectest1
.
example
.
org
"
]
[
"
iframe
-
s
-
ss1
"
]
]
[
[
"
indexedDB
"
"
http
:
/
/
test1
.
example
.
org
"
"
idb1
"
"
obj1
"
]
[
1
2
3
]
]
[
[
"
Cache
"
"
http
:
/
/
test1
.
example
.
org
"
"
plop
"
]
[
MAIN_DOMAIN
+
"
404_cached_file
.
js
"
MAIN_DOMAIN
+
"
browser_storage_basic
.
js
"
]
]
]
;
yield
checkState
(
beforeState
)
;
info
(
"
do
the
delete
"
)
;
const
deleteHosts
=
[
[
[
"
localStorage
"
"
https
:
/
/
sectest1
.
example
.
org
"
]
"
iframe
-
s
-
ls1
"
"
name
"
]
[
[
"
sessionStorage
"
"
https
:
/
/
sectest1
.
example
.
org
"
]
"
iframe
-
s
-
ss1
"
"
name
"
]
[
[
"
indexedDB
"
"
http
:
/
/
test1
.
example
.
org
"
"
idb1
"
"
obj1
"
]
1
"
name
"
]
[
[
"
Cache
"
"
http
:
/
/
test1
.
example
.
org
"
"
plop
"
]
MAIN_DOMAIN
+
"
404_cached_file
.
js
"
"
url
"
]
]
;
for
(
let
[
store
rowName
cellToClick
]
of
deleteHosts
)
{
let
storeName
=
store
.
join
(
"
>
"
)
;
yield
selectTreeItem
(
store
)
;
let
eventWait
=
gUI
.
once
(
"
store
-
objects
-
cleared
"
)
;
let
cell
=
getRowCells
(
rowName
)
[
cellToClick
]
;
yield
waitForContextMenu
(
contextMenu
cell
(
)
=
>
{
info
(
Opened
context
menu
in
{
storeName
}
row
'
{
rowName
}
'
)
;
menuDeleteAllItem
.
click
(
)
;
}
)
;
yield
eventWait
;
}
info
(
"
test
state
after
delete
"
)
;
const
afterState
=
[
[
[
"
localStorage
"
"
http
:
/
/
test1
.
example
.
org
"
]
[
"
ls1
"
"
ls2
"
]
]
[
[
"
localStorage
"
"
http
:
/
/
sectest1
.
example
.
org
"
]
[
"
iframe
-
u
-
ls1
"
]
]
[
[
"
localStorage
"
"
https
:
/
/
sectest1
.
example
.
org
"
]
[
]
]
[
[
"
sessionStorage
"
"
http
:
/
/
test1
.
example
.
org
"
]
[
"
ss1
"
]
]
[
[
"
sessionStorage
"
"
http
:
/
/
sectest1
.
example
.
org
"
]
[
"
iframe
-
u
-
ss1
"
"
iframe
-
u
-
ss2
"
]
]
[
[
"
sessionStorage
"
"
https
:
/
/
sectest1
.
example
.
org
"
]
[
]
]
[
[
"
indexedDB
"
"
http
:
/
/
test1
.
example
.
org
"
"
idb1
"
"
obj1
"
]
[
]
]
[
[
"
Cache
"
"
http
:
/
/
test1
.
example
.
org
"
"
plop
"
]
[
]
]
]
;
yield
checkState
(
afterState
)
;
yield
finishTests
(
)
;
}
)
;
