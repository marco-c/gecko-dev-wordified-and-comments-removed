"
use
strict
"
;
const
{
createElement
createFactory
}
=
require
(
"
devtools
/
client
/
shared
/
vendor
/
react
"
)
;
const
EventEmitter
=
require
(
"
devtools
/
shared
/
event
-
emitter
"
)
;
const
{
Provider
}
=
require
(
"
devtools
/
client
/
shared
/
vendor
/
react
-
redux
"
)
;
const
ExtensionSidebarComponent
=
createFactory
(
require
(
"
.
/
components
/
ExtensionSidebar
"
)
)
;
const
{
updateExtensionPage
updateObjectTreeView
updateObjectValueGripView
removeExtensionSidebar
}
=
require
(
"
.
/
actions
/
sidebar
"
)
;
class
ExtensionSidebar
{
constructor
(
inspector
{
id
title
}
)
{
EventEmitter
.
decorate
(
this
)
;
this
.
inspector
=
inspector
;
this
.
store
=
inspector
.
store
;
this
.
id
=
id
;
this
.
title
=
title
;
this
.
destroyed
=
false
;
}
get
provider
(
)
{
if
(
!
this
.
_provider
)
{
this
.
_provider
=
createElement
(
Provider
{
store
:
this
.
store
key
:
this
.
id
title
:
this
.
title
}
ExtensionSidebarComponent
(
{
id
:
this
.
id
onExtensionPageMount
:
containerEl
=
>
{
this
.
emit
(
"
extension
-
page
-
mount
"
containerEl
)
;
}
onExtensionPageUnmount
:
containerEl
=
>
{
this
.
emit
(
"
extension
-
page
-
unmount
"
containerEl
)
;
}
serviceContainer
:
{
highlightDomElement
:
async
(
grip
options
=
{
}
)
=
>
{
const
nodeFront
=
await
this
.
inspector
.
inspectorFront
.
getNodeFrontFromNodeGrip
(
grip
)
;
return
nodeFront
.
highlighterFront
.
highlight
(
nodeFront
options
)
;
}
unHighlightDomElement
:
async
grip
=
>
{
const
nodeFront
=
await
this
.
inspector
.
inspectorFront
.
getNodeFrontFromNodeGrip
(
grip
)
;
return
nodeFront
.
highlighterFront
.
unhighlight
(
)
;
}
openNodeInInspector
:
async
grip
=
>
{
const
nodeFront
=
await
this
.
inspector
.
inspectFront
.
getNodeFrontFromNodeGrip
(
grip
)
;
const
onInspectorUpdated
=
this
.
inspector
.
once
(
"
inspector
-
updated
"
)
;
const
onNodeFrontSet
=
this
.
inspector
.
toolbox
.
selection
.
setNodeFront
(
nodeFront
{
reason
:
"
inspector
-
extension
-
sidebar
"
}
)
;
return
Promise
.
all
(
[
onNodeFrontSet
onInspectorUpdated
]
)
;
}
}
}
)
)
;
}
return
this
.
_provider
;
}
destroy
(
)
{
if
(
this
.
destroyed
)
{
throw
new
Error
(
ExtensionSidebar
instances
cannot
be
destroyed
more
than
once
)
;
}
this
.
store
.
dispatch
(
removeExtensionSidebar
(
this
.
id
)
)
;
this
.
inspector
=
null
;
this
.
store
=
null
;
this
.
_provider
=
null
;
this
.
destroyed
=
true
;
}
setObject
(
object
)
{
if
(
this
.
removed
)
{
throw
new
Error
(
"
Unable
to
set
an
object
preview
on
a
removed
ExtensionSidebar
"
)
;
}
this
.
store
.
dispatch
(
updateObjectTreeView
(
this
.
id
object
)
)
;
}
setObjectValueGrip
(
objectValueGrip
rootTitle
)
{
if
(
this
.
removed
)
{
throw
new
Error
(
"
Unable
to
set
an
object
preview
on
a
removed
ExtensionSidebar
"
)
;
}
this
.
store
.
dispatch
(
updateObjectValueGripView
(
this
.
id
objectValueGrip
rootTitle
)
)
;
}
setExtensionPage
(
iframeURL
)
{
if
(
this
.
removed
)
{
throw
new
Error
(
"
Unable
to
set
an
object
preview
on
a
removed
ExtensionSidebar
"
)
;
}
this
.
store
.
dispatch
(
updateExtensionPage
(
this
.
id
iframeURL
)
)
;
}
}
module
.
exports
=
ExtensionSidebar
;
