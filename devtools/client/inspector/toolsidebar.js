"
use
strict
"
;
const
EventEmitter
=
require
(
"
devtools
/
shared
/
event
-
emitter
"
)
;
function
ToolSidebar
(
tabbox
panel
uid
options
=
{
}
)
{
EventEmitter
.
decorate
(
this
)
;
this
.
_tabbox
=
tabbox
;
this
.
_uid
=
uid
;
this
.
_panelDoc
=
this
.
_tabbox
.
ownerDocument
;
this
.
_toolPanel
=
panel
;
this
.
_options
=
options
;
if
(
!
options
.
disableTelemetry
)
{
this
.
_telemetry
=
this
.
_toolPanel
.
telemetry
;
}
this
.
_tabs
=
[
]
;
if
(
this
.
_options
.
hideTabstripe
)
{
this
.
_tabbox
.
setAttribute
(
"
hidetabs
"
"
true
"
)
;
}
this
.
render
(
)
;
this
.
_toolPanel
.
emit
(
"
sidebar
-
created
"
this
)
;
}
exports
.
ToolSidebar
=
ToolSidebar
;
ToolSidebar
.
prototype
=
{
TABPANEL_ID_PREFIX
:
"
sidebar
-
panel
-
"
get
React
(
)
{
return
this
.
_toolPanel
.
React
;
}
get
ReactDOM
(
)
{
return
this
.
_toolPanel
.
ReactDOM
;
}
get
browserRequire
(
)
{
return
this
.
_toolPanel
.
browserRequire
;
}
get
InspectorTabPanel
(
)
{
return
this
.
_toolPanel
.
InspectorTabPanel
;
}
get
TabBar
(
)
{
return
this
.
_toolPanel
.
TabBar
;
}
render
(
)
{
const
sidebar
=
this
.
TabBar
(
{
menuDocument
:
this
.
_toolPanel
.
_toolbox
.
doc
showAllTabsMenu
:
true
allTabsMenuButtonTooltip
:
this
.
_options
.
allTabsMenuButtonTooltip
sidebarToggleButton
:
this
.
_options
.
sidebarToggleButton
onSelect
:
this
.
handleSelectionChange
.
bind
(
this
)
}
)
;
this
.
_tabbar
=
this
.
ReactDOM
.
render
(
sidebar
this
.
_tabbox
)
;
}
addAllQueuedTabs
(
)
{
this
.
_tabbar
.
addAllQueuedTabs
(
)
;
}
addTab
(
id
title
panel
selected
index
)
{
this
.
_tabbar
.
addTab
(
id
title
selected
panel
null
index
)
;
this
.
emit
(
"
new
-
tab
-
registered
"
id
)
;
}
addExistingTab
(
id
title
selected
index
)
{
const
panel
=
this
.
InspectorTabPanel
(
{
id
idPrefix
:
this
.
TABPANEL_ID_PREFIX
key
:
id
title
}
)
;
this
.
addTab
(
id
title
panel
selected
index
)
;
}
queueTab
(
id
title
panel
selected
index
)
{
this
.
_tabbar
.
queueTab
(
id
title
selected
panel
null
index
)
;
this
.
emit
(
"
new
-
tab
-
registered
"
id
)
;
}
queueExistingTab
(
id
title
selected
index
)
{
const
panel
=
this
.
InspectorTabPanel
(
{
id
idPrefix
:
this
.
TABPANEL_ID_PREFIX
key
:
id
title
}
)
;
this
.
queueTab
(
id
title
panel
selected
index
)
;
}
removeTab
(
tabId
tabPanelId
)
{
this
.
_tabbar
.
removeTab
(
tabId
)
;
this
.
emit
(
"
tab
-
unregistered
"
tabId
)
;
}
toggleTab
(
isVisible
id
)
{
this
.
_tabbar
.
toggleTab
(
id
isVisible
)
;
}
select
(
id
)
{
this
.
_tabbar
.
select
(
id
)
;
}
getCurrentTabID
(
)
{
return
this
.
_currentTool
;
}
getTabPanel
(
id
)
{
return
this
.
_panelDoc
.
querySelector
(
"
#
"
+
this
.
TABPANEL_ID_PREFIX
+
id
+
"
#
"
+
id
)
;
}
handleSelectionChange
(
id
)
{
if
(
this
.
_destroyed
)
{
return
;
}
const
previousTool
=
this
.
_currentTool
;
if
(
previousTool
)
{
this
.
emit
(
previousTool
+
"
-
unselected
"
)
;
}
this
.
_currentTool
=
id
;
this
.
updateTelemetryOnChange
(
id
previousTool
)
;
this
.
emit
(
this
.
_currentTool
+
"
-
selected
"
)
;
this
.
emit
(
"
select
"
this
.
_currentTool
)
;
}
updateTelemetryOnChange
(
currentToolId
previousToolId
)
{
if
(
currentToolId
=
=
=
previousToolId
|
|
!
this
.
_telemetry
)
{
return
;
}
const
sessionId
=
this
.
_toolPanel
.
_toolbox
.
sessionId
;
currentToolId
=
this
.
getTelemetryPanelNameOrOther
(
currentToolId
)
;
if
(
previousToolId
)
{
previousToolId
=
this
.
getTelemetryPanelNameOrOther
(
previousToolId
)
;
this
.
_telemetry
.
toolClosed
(
previousToolId
sessionId
this
)
;
this
.
_telemetry
.
recordEvent
(
"
sidepanel_changed
"
"
inspector
"
null
{
oldpanel
:
previousToolId
newpanel
:
currentToolId
os
:
this
.
_telemetry
.
osNameAndVersion
session_id
:
sessionId
}
)
;
}
this
.
_telemetry
.
toolOpened
(
currentToolId
sessionId
this
)
;
}
getTelemetryPanelNameOrOther
(
id
)
{
if
(
!
this
.
_toolNames
)
{
const
ids
=
this
.
_tabbar
.
state
.
tabs
.
map
(
(
{
id
:
toolId
}
)
=
>
{
return
toolId
.
includes
(
"
-
"
)
?
"
other
"
:
toolId
;
}
)
;
this
.
_toolNames
=
new
Set
(
ids
)
;
}
if
(
!
this
.
_toolNames
.
has
(
id
)
)
{
return
"
other
"
;
}
return
id
;
}
show
(
id
)
{
this
.
_tabbox
.
hidden
=
false
;
if
(
id
)
{
this
.
select
(
id
)
;
}
this
.
emit
(
"
show
"
)
;
}
hide
(
)
{
this
.
_tabbox
.
hidden
=
true
;
this
.
emit
(
"
hide
"
)
;
}
destroy
(
)
{
if
(
this
.
_destroyed
)
{
return
;
}
this
.
_destroyed
=
true
;
this
.
emit
(
"
destroy
"
)
;
if
(
this
.
_currentTool
&
&
this
.
_telemetry
)
{
const
sessionId
=
this
.
_toolPanel
.
_toolbox
.
sessionId
;
this
.
_telemetry
.
toolClosed
(
this
.
_currentTool
sessionId
this
)
;
}
this
.
_toolPanel
.
emit
(
"
sidebar
-
destroyed
"
this
)
;
this
.
ReactDOM
.
unmountComponentAtNode
(
this
.
_tabbox
)
;
this
.
_tabs
=
null
;
this
.
_tabbox
=
null
;
this
.
_telemetry
=
null
;
this
.
_panelDoc
=
null
;
this
.
_toolPanel
=
null
;
}
}
;
