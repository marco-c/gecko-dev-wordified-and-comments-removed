"
use
strict
"
;
Services
.
scriptloader
.
loadSubScript
(
"
chrome
:
/
/
mochitests
/
content
/
browser
/
devtools
/
client
/
inspector
/
test
/
head
.
js
"
this
)
;
Services
.
prefs
.
setIntPref
(
"
devtools
.
toolbox
.
footer
.
height
"
350
)
;
registerCleanupFunction
(
(
)
=
>
{
Services
.
prefs
.
clearUserPref
(
"
devtools
.
toolbox
.
footer
.
height
"
)
;
}
)
;
function
getNode
(
nodeOrSelector
)
{
return
typeof
nodeOrSelector
=
=
=
"
string
"
?
content
.
document
.
querySelector
(
nodeOrSelector
)
:
nodeOrSelector
;
}
function
selectAndHighlightNode
(
nodeOrSelector
inspector
)
{
info
(
"
Highlighting
and
selecting
the
node
"
+
nodeOrSelector
)
;
let
node
=
getNode
(
nodeOrSelector
)
;
let
updated
=
inspector
.
toolbox
.
once
(
"
highlighter
-
ready
"
)
;
inspector
.
selection
.
setNode
(
node
"
test
-
highlight
"
)
;
return
updated
;
}
function
hasSideBarTab
(
inspector
id
)
{
return
!
!
inspector
.
sidebar
.
getWindowForTab
(
id
)
;
}
var
openLayoutView
=
Task
.
async
(
function
*
(
)
{
let
{
toolbox
inspector
}
=
yield
openInspector
(
)
;
function
mockHighlighter
(
{
highlighter
}
)
{
highlighter
.
showBoxModel
=
function
(
nodeFront
options
)
{
return
promise
.
resolve
(
)
;
}
;
highlighter
.
hideBoxModel
=
function
(
)
{
return
promise
.
resolve
(
)
;
}
;
}
mockHighlighter
(
toolbox
)
;
if
(
!
hasSideBarTab
(
inspector
"
layoutview
"
)
)
{
info
(
"
Waiting
for
the
layoutview
sidebar
to
be
ready
"
)
;
yield
inspector
.
sidebar
.
once
(
"
layoutview
-
ready
"
)
;
}
info
(
"
Selecting
the
layoutview
sidebar
"
)
;
inspector
.
sidebar
.
select
(
"
layoutview
"
)
;
return
{
toolbox
:
toolbox
inspector
:
inspector
view
:
inspector
.
sidebar
.
getWindowForTab
(
"
layoutview
"
)
[
"
layoutview
"
]
}
;
}
)
;
function
waitForUpdate
(
inspector
)
{
return
inspector
.
once
(
"
layoutview
-
updated
"
)
;
}
var
TESTS
=
[
]
;
function
addTest
(
message
func
)
{
TESTS
.
push
(
[
message
Task
.
async
(
func
)
]
)
;
}
var
runTests
=
Task
.
async
(
function
*
(
.
.
.
args
)
{
for
(
let
[
message
test
]
of
TESTS
)
{
info
(
"
Running
new
test
case
:
"
+
message
)
;
yield
test
.
apply
(
null
args
)
;
}
}
)
;
