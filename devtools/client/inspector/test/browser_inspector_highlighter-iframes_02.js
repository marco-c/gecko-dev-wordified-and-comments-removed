"
use
strict
"
;
const
TEST_URI
=
"
data
:
text
/
html
;
charset
=
utf
-
8
"
+
"
<
div
id
=
\
"
outer
\
"
>
<
/
div
>
"
+
"
<
iframe
style
=
'
margin
:
100px
'
src
=
'
data
:
text
/
html
"
+
"
<
div
id
=
\
"
inner
\
"
>
Look
I
am
here
!
<
/
div
>
'
>
"
;
add_task
(
function
*
(
)
{
info
(
"
Enable
command
-
button
-
frames
preference
setting
"
)
;
Services
.
prefs
.
setBoolPref
(
"
devtools
.
command
-
button
-
frames
.
enabled
"
true
)
;
let
{
inspector
toolbox
testActor
}
=
yield
openInspectorForURL
(
TEST_URI
)
;
info
(
"
Switch
to
the
iframe
context
.
"
)
;
yield
switchToFrameContext
(
1
toolbox
inspector
)
;
info
(
"
Check
navigation
was
successful
.
"
)
;
let
hasOuterNode
=
yield
testActor
.
hasNode
(
"
#
outer
"
)
;
ok
(
!
hasOuterNode
"
Check
testActor
has
no
access
to
outer
element
"
)
;
let
hasTestNode
=
yield
testActor
.
hasNode
(
"
#
inner
"
)
;
ok
(
hasTestNode
"
Check
testActor
has
access
to
inner
element
"
)
;
info
(
"
Check
highlighting
is
correct
after
switching
iframe
context
"
)
;
yield
selectAndHighlightNode
(
"
#
inner
"
inspector
)
;
let
isHighlightCorrect
=
yield
testActor
.
assertHighlightedNode
(
"
#
inner
"
)
;
ok
(
isHighlightCorrect
"
The
selected
node
is
properly
highlighted
.
"
)
;
info
(
"
Cleanup
command
-
button
-
frames
preferences
.
"
)
;
Services
.
prefs
.
clearUserPref
(
"
devtools
.
command
-
button
-
frames
.
enabled
"
)
;
}
)
;
function
*
switchToFrameContext
(
frameIndex
toolbox
inspector
)
{
let
frameListBtn
=
toolbox
.
doc
.
getElementById
(
"
command
-
button
-
frames
"
)
;
let
frameBtns
=
frameListBtn
.
firstChild
.
querySelectorAll
(
"
[
data
-
window
-
id
]
"
)
;
info
(
"
Select
the
iframe
in
the
frame
list
.
"
)
;
let
newRoot
=
inspector
.
once
(
"
new
-
root
"
)
;
frameBtns
[
frameIndex
]
.
click
(
)
;
yield
newRoot
;
yield
inspector
.
once
(
"
inspector
-
updated
"
)
;
info
(
"
Navigation
to
the
iframe
is
done
.
"
)
;
}
