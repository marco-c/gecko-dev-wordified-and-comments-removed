"
use
strict
"
;
const
TEST_URL
=
data
:
text
/
html
;
charset
=
utf
-
8
+
encodeURIComponent
(
<
!
DOCTYPE
html
>
<
html
lang
=
"
en
"
>
<
body
>
<
div
id
=
outsideframe
>
<
/
div
>
<
script
type
=
"
text
/
javascript
"
>
const
iframe
=
document
.
createElement
(
"
iframe
"
)
;
iframe
.
src
=
"
about
:
blank
"
;
iframe
.
addEventListener
(
'
load
'
(
)
=
>
{
iframe
.
contentDocument
.
write
(
'
<
div
id
=
inframe
>
inframe
<
/
div
>
'
)
;
}
true
)
;
document
.
body
.
appendChild
(
iframe
)
;
<
/
script
>
<
/
body
>
<
/
html
>
)
;
add_task
(
async
function
(
)
{
const
loadingTab
=
BrowserTestUtils
.
addTab
(
gBrowser
TEST_URL
)
;
gBrowser
.
selectedTab
=
loadingTab
;
info
(
"
Wait
for
the
loading
iframe
to
be
ready
to
test
"
)
;
await
TestUtils
.
waitForCondition
(
async
(
)
=
>
{
try
{
return
await
ContentTask
.
spawn
(
gBrowser
.
selectedBrowser
{
}
(
)
=
>
{
const
iframe
=
content
.
document
.
querySelector
(
"
iframe
"
)
;
return
(
iframe
?
.
contentDocument
.
readyState
=
=
=
"
loading
"
&
&
iframe
.
contentDocument
.
getElementById
(
"
inframe
"
)
)
;
}
)
;
}
catch
(
e
)
{
return
false
;
}
}
)
;
const
{
inspector
}
=
await
openInspector
(
)
;
info
(
"
Check
the
markup
view
displays
the
loading
iframe
successfully
"
)
;
await
assertMarkupViewAsTree
(
body
div
id
=
"
outsideframe
"
script
!
ignore
-
children
iframe
#
document
html
head
body
div
id
=
"
inframe
"
"
body
"
inspector
)
;
}
)
;
