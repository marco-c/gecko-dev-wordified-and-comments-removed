"
use
strict
"
;
const
TEST_URL
=
URL_ROOT
+
"
doc_inspector_highlighter_cssshapes_iframe
.
html
"
;
const
HIGHLIGHTER_TYPE
=
"
ShapesHighlighter
"
;
add_task
(
async
function
(
)
{
const
env
=
await
openInspectorForURL
(
TEST_URL
)
;
const
helper
=
await
getHighlighterHelperFor
(
HIGHLIGHTER_TYPE
)
(
env
)
;
const
{
inspector
}
=
env
;
const
view
=
selectRuleView
(
inspector
)
;
const
highlighters
=
view
.
highlighters
;
const
config
=
{
inspector
view
highlighters
helper
}
;
await
testPolygonIframeMovePoint
(
config
)
;
}
)
;
async
function
testPolygonIframeMovePoint
(
config
)
{
const
{
inspector
view
helper
}
=
config
;
const
selector
=
"
#
polygon
"
;
const
property
=
"
clip
-
path
"
;
info
(
Turn
on
shapes
highlighter
for
{
selector
}
)
;
const
highlightedNode
=
await
getNodeFrontInFrames
(
[
"
#
frame
"
selector
]
inspector
)
;
await
selectNode
(
highlightedNode
inspector
)
;
await
toggleShapesHighlighter
(
view
selector
property
true
)
;
const
{
mouse
}
=
helper
;
let
onRuleViewChanged
=
waitForNEvents
(
view
"
ruleview
-
changed
"
2
)
;
info
(
"
Moving
polygon
point
visible
in
iframe
"
)
;
await
mouse
.
down
(
10
10
)
;
await
mouse
.
move
(
20
20
)
;
await
mouse
.
up
(
)
;
await
reflowContentPage
(
)
;
await
onRuleViewChanged
;
let
computedStyle
=
await
highlightedNode
.
inspectorFront
.
pageStyle
.
getComputed
(
highlightedNode
)
;
let
definition
=
computedStyle
[
"
clip
-
path
"
]
.
value
;
ok
(
definition
.
includes
(
"
10px
1
.
25
%
"
)
"
Point
moved
to
10px
1
.
25
%
"
)
;
onRuleViewChanged
=
waitForNEvents
(
view
"
ruleview
-
changed
"
2
)
;
info
(
"
Moving
polygon
point
not
visible
in
iframe
"
)
;
await
mouse
.
down
(
110
410
)
;
await
mouse
.
move
(
120
420
)
;
await
mouse
.
up
(
)
;
await
reflowContentPage
(
)
;
await
onRuleViewChanged
;
computedStyle
=
await
highlightedNode
.
inspectorFront
.
pageStyle
.
getComputed
(
highlightedNode
)
;
definition
=
computedStyle
[
"
clip
-
path
"
]
.
value
;
ok
(
definition
.
includes
(
"
110px
51
.
25
%
"
)
"
Point
moved
to
110px
51
.
25
%
"
)
;
info
(
Turn
off
shapes
highlighter
for
{
selector
}
)
;
await
toggleShapesHighlighter
(
view
selector
property
false
)
;
}
