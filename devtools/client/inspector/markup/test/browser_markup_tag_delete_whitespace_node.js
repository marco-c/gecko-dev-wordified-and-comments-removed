"
use
strict
"
;
const
HTML
=
<
div
>
<
p
id
=
"
container
"
>
<
span
id
=
"
before
-
whitespace
"
>
1
<
/
span
>
<
span
id
=
"
after
-
whitespace
"
>
2
<
/
span
>
<
/
p
>
<
/
div
>
;
const
TEST_URL
=
"
data
:
text
/
html
;
charset
=
utf
-
8
"
+
encodeURIComponent
(
HTML
)
;
add_task
(
async
function
deleteNodeAfterWhitespace
(
)
{
const
{
inspector
}
=
await
openInspectorForURL
(
TEST_URL
)
;
info
(
"
Test
deleting
a
node
that
will
modify
the
whitespace
nodes
rendered
in
the
"
+
"
markup
view
.
"
)
;
await
selectAndFocusNode
(
"
#
after
-
whitespace
"
inspector
)
;
await
deleteCurrentSelection
(
inspector
)
;
const
parentNodeFront
=
await
inspector
.
selection
.
nodeFront
.
parentNode
(
)
;
const
nodeFront
=
await
getNodeFront
(
"
#
container
"
inspector
)
;
is
(
parentNodeFront
nodeFront
"
Selection
is
as
expected
after
deletion
"
)
;
info
(
"
Check
that
the
node
was
really
removed
"
)
;
let
node
=
await
getNodeFront
(
"
#
after
-
whitespace
"
inspector
)
;
ok
(
!
node
"
The
node
can
'
t
be
found
in
the
page
anymore
"
)
;
info
(
"
Undo
the
deletion
to
restore
the
original
markup
"
)
;
await
undoChange
(
inspector
)
;
node
=
await
getNodeFront
(
"
#
after
-
whitespace
"
inspector
)
;
ok
(
node
"
The
node
is
back
"
)
;
info
(
"
Test
deleting
the
node
before
the
whitespace
and
performing
an
undo
preserves
"
+
"
the
node
order
"
)
;
await
selectAndFocusNode
(
"
#
before
-
whitespace
"
inspector
)
;
await
deleteCurrentSelection
(
inspector
)
;
info
(
"
Undo
the
deletion
to
restore
the
original
markup
"
)
;
await
undoChange
(
inspector
)
;
node
=
await
getNodeFront
(
"
#
before
-
whitespace
"
inspector
)
;
ok
(
node
"
The
node
is
back
"
)
;
const
nextSibling
=
await
getNodeFront
(
"
#
before
-
whitespace
+
*
"
inspector
)
;
const
afterWhitespace
=
await
getNodeFront
(
"
#
after
-
whitespace
"
inspector
)
;
is
(
nextSibling
afterWhitespace
"
Order
has
been
preserved
after
restoring
the
node
"
)
;
}
)
;
async
function
selectAndFocusNode
(
selector
inspector
)
{
info
(
Select
node
{
selector
}
and
make
sure
it
is
focused
)
;
await
selectNode
(
selector
inspector
)
;
await
clickContainer
(
selector
inspector
)
;
}
async
function
deleteCurrentSelection
(
inspector
)
{
info
(
"
Delete
the
node
with
the
delete
key
"
)
;
const
mutated
=
inspector
.
once
(
"
markupmutation
"
)
;
EventUtils
.
sendKey
(
"
delete
"
inspector
.
panelWin
)
;
await
Promise
.
all
(
[
mutated
inspector
.
once
(
"
inspector
-
updated
"
)
]
)
;
}
