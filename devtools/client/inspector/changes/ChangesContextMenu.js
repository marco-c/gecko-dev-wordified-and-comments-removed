"
use
strict
"
;
loader
.
lazyRequireGetter
(
this
"
Menu
"
"
devtools
/
client
/
framework
/
menu
"
)
;
loader
.
lazyRequireGetter
(
this
"
MenuItem
"
"
devtools
/
client
/
framework
/
menu
-
item
"
)
;
loader
.
lazyRequireGetter
(
this
"
clipboardHelper
"
"
devtools
/
shared
/
platform
/
clipboard
"
)
;
const
{
getStr
}
=
require
(
"
.
/
utils
/
l10n
"
)
;
class
ChangesContextMenu
{
constructor
(
view
)
{
this
.
view
=
view
;
this
.
inspector
=
this
.
view
.
inspector
;
this
.
document
=
this
.
view
.
document
;
this
.
panel
=
this
.
document
.
getElementById
(
"
sidebar
-
panel
-
changes
"
)
;
this
.
window
=
this
.
document
.
defaultView
;
this
.
_onCopy
=
this
.
_onCopy
.
bind
(
this
)
;
this
.
_onSelectAll
=
this
.
_onSelectAll
.
bind
(
this
)
;
}
show
(
event
)
{
this
.
_openMenu
(
{
target
:
event
.
explicitOriginalTarget
screenX
:
event
.
screenX
screenY
:
event
.
screenY
}
)
;
}
_openMenu
(
{
target
screenX
=
0
screenY
=
0
}
=
{
}
)
{
this
.
window
.
focus
(
)
;
const
menu
=
new
Menu
(
)
;
const
menuitemCopy
=
new
MenuItem
(
{
label
:
getStr
(
"
changes
.
contextmenu
.
copy
"
)
accesskey
:
getStr
(
"
changes
.
contextmenu
.
copy
.
accessKey
"
)
click
:
this
.
_onCopy
disabled
:
!
this
.
_hasTextSelected
(
)
}
)
;
menu
.
append
(
menuitemCopy
)
;
const
menuitemSelectAll
=
new
MenuItem
(
{
label
:
getStr
(
"
changes
.
contextmenu
.
selectAll
"
)
accesskey
:
getStr
(
"
changes
.
contextmenu
.
selectAll
.
accessKey
"
)
click
:
this
.
_onSelectAll
}
)
;
menu
.
append
(
menuitemSelectAll
)
;
menu
.
popup
(
screenX
screenY
this
.
inspector
.
toolbox
)
;
return
menu
;
}
_hasTextSelected
(
)
{
const
selection
=
this
.
window
.
getSelection
(
)
;
return
selection
.
toString
(
)
&
&
!
selection
.
isCollapsed
;
}
_onSelectAll
(
)
{
const
selection
=
this
.
window
.
getSelection
(
)
;
selection
.
selectAllChildren
(
this
.
panel
)
;
}
_onCopy
(
)
{
const
text
=
this
.
window
.
getSelection
(
)
.
toString
(
)
;
clipboardHelper
.
copyString
(
text
)
;
this
.
view
.
onContextMenuCopy
(
)
;
}
destroy
(
)
{
this
.
inspector
=
null
;
this
.
panel
=
null
;
this
.
view
=
null
;
this
.
window
=
null
;
}
}
module
.
exports
=
ChangesContextMenu
;
