"
use
strict
"
;
function
getChangesTree
(
state
filter
=
{
}
)
{
const
{
sourceIds
:
sourceIdsFilter
=
[
]
ruleIds
:
rulesIdsFilter
=
[
]
}
=
filter
;
function
expandRuleChildren
(
ruleId
rule
rules
visitedRules
)
{
if
(
visitedRules
.
has
(
ruleId
)
)
{
return
null
;
}
visitedRules
.
add
(
ruleId
)
;
return
{
.
.
.
rule
children
:
rule
.
children
.
map
(
childRuleId
=
>
expandRuleChildren
(
childRuleId
rules
[
childRuleId
]
rules
visitedRules
)
)
}
;
}
return
Object
.
entries
(
state
)
.
filter
(
(
[
sourceId
source
]
)
=
>
{
if
(
sourceIdsFilter
.
length
)
{
return
sourceIdsFilter
.
includes
(
sourceId
)
;
}
return
true
;
}
)
.
reduce
(
(
sourcesObj
[
sourceId
source
]
)
=
>
{
const
{
rules
}
=
source
;
const
visitedRules
=
new
Set
(
)
;
sourcesObj
[
sourceId
]
=
{
.
.
.
source
rules
:
Object
.
entries
(
rules
)
.
filter
(
(
[
ruleId
rule
]
)
=
>
{
if
(
rulesIdsFilter
.
length
)
{
return
rulesIdsFilter
.
includes
(
ruleId
)
;
}
return
true
;
}
)
.
reduce
(
(
rulesObj
[
ruleId
rule
]
)
=
>
{
const
expandedRule
=
expandRuleChildren
(
ruleId
rule
rules
visitedRules
)
;
if
(
expandedRule
!
=
=
null
)
{
rulesObj
[
ruleId
]
=
expandedRule
;
}
return
rulesObj
;
}
{
}
)
}
;
return
sourcesObj
;
}
{
}
)
;
}
module
.
exports
=
{
getChangesTree
}
;
