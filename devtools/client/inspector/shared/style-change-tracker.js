"
use
strict
"
;
const
EventEmitter
=
require
(
"
devtools
/
shared
/
event
-
emitter
"
)
;
const
WalkerEventListener
=
require
(
"
.
/
walker
-
event
-
listener
"
)
;
class
InspectorStyleChangeTracker
{
constructor
(
inspector
)
{
this
.
selection
=
inspector
.
selection
;
this
.
onMutations
=
this
.
onMutations
.
bind
(
this
)
;
this
.
onResized
=
this
.
onResized
.
bind
(
this
)
;
this
.
walkerEventListener
=
new
WalkerEventListener
(
inspector
{
mutations
:
this
.
onMutations
resize
:
this
.
onResized
}
)
;
EventEmitter
.
decorate
(
this
)
;
}
destroy
(
)
{
this
.
walkerEventListener
.
destroy
(
)
;
this
.
walkerEventListener
=
null
;
this
.
selection
=
null
;
}
onMutations
(
mutations
)
{
const
canMutationImpactCurrentStyles
=
(
{
type
target
:
mutationTarget
}
)
=
>
{
if
(
type
!
=
=
"
attributes
"
)
{
return
false
;
}
const
currentNode
=
this
.
selection
.
nodeFront
;
if
(
mutationTarget
=
=
=
currentNode
)
{
return
true
;
}
let
parent
=
currentNode
.
parentNode
(
)
;
const
siblings
=
parent
.
treeChildren
(
)
;
if
(
siblings
.
includes
(
mutationTarget
)
)
{
return
true
;
}
while
(
parent
)
{
if
(
mutationTarget
=
=
=
parent
)
{
return
true
;
}
parent
=
parent
.
parentNode
(
)
;
}
return
false
;
}
;
for
(
const
mutation
of
mutations
)
{
if
(
canMutationImpactCurrentStyles
(
mutation
)
)
{
this
.
emit
(
"
style
-
changed
"
)
;
break
;
}
}
}
onResized
(
)
{
this
.
emit
(
"
style
-
changed
"
)
;
}
}
module
.
exports
=
InspectorStyleChangeTracker
;
