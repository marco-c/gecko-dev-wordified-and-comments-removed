"
use
strict
"
;
const
TEST_URI_HTML
=
TEST_URL_ROOT
+
"
doc_content_stylesheet
.
html
"
;
const
TEST_URI_AUTHOR
=
TEST_URL_ROOT
+
"
doc_author
-
sheet
.
html
"
;
const
TEST_URI_XUL
=
TEST_URL_ROOT
+
"
doc_content_stylesheet
.
xul
"
;
const
XUL_URI
=
Cc
[
"
mozilla
.
org
/
network
/
io
-
service
;
1
"
]
.
getService
(
Ci
.
nsIIOService
)
.
newURI
(
TEST_URI_XUL
null
null
)
;
var
ssm
=
Components
.
classes
[
"
mozilla
.
org
/
scriptsecuritymanager
;
1
"
]
.
getService
(
Ci
.
nsIScriptSecurityManager
)
;
const
XUL_PRINCIPAL
=
ssm
.
createCodebasePrincipal
(
XUL_URI
{
}
)
;
add_task
(
function
*
(
)
{
requestLongerTimeout
(
2
)
;
info
(
"
Checking
stylesheets
on
HTML
document
"
)
;
yield
addTab
(
TEST_URI_HTML
)
;
let
target
=
getNode
(
"
#
target
"
)
;
let
{
inspector
}
=
yield
openRuleView
(
)
;
yield
selectNode
(
"
#
target
"
inspector
)
;
info
(
"
Checking
stylesheets
"
)
;
yield
checkSheets
(
target
)
;
info
(
"
Checking
authored
stylesheets
"
)
;
yield
addTab
(
TEST_URI_AUTHOR
)
;
(
{
inspector
}
=
yield
openRuleView
(
)
)
;
target
=
getNode
(
"
#
target
"
)
;
yield
selectNode
(
"
#
target
"
inspector
)
;
yield
checkSheets
(
target
)
;
info
(
"
Checking
stylesheets
on
XUL
document
"
)
;
info
(
"
Allowing
XUL
content
"
)
;
allowXUL
(
)
;
yield
addTab
(
TEST_URI_XUL
)
;
(
{
inspector
}
=
yield
openRuleView
(
)
)
;
target
=
getNode
(
"
#
target
"
)
;
yield
selectNode
(
"
#
target
"
inspector
)
;
yield
checkSheets
(
target
)
;
info
(
"
Disallowing
XUL
content
"
)
;
disallowXUL
(
)
;
}
)
;
function
allowXUL
(
)
{
Cc
[
"
mozilla
.
org
/
permissionmanager
;
1
"
]
.
getService
(
Ci
.
nsIPermissionManager
)
.
addFromPrincipal
(
XUL_PRINCIPAL
"
allowXULXBL
"
Ci
.
nsIPermissionManager
.
ALLOW_ACTION
)
;
}
function
disallowXUL
(
)
{
Cc
[
"
mozilla
.
org
/
permissionmanager
;
1
"
]
.
getService
(
Ci
.
nsIPermissionManager
)
.
addFromPrincipal
(
XUL_PRINCIPAL
"
allowXULXBL
"
Ci
.
nsIPermissionManager
.
DENY_ACTION
)
;
}
function
*
checkSheets
(
target
)
{
let
sheets
=
yield
executeInContent
(
"
Test
:
GetStyleSheetsInfoForNode
"
{
}
{
target
}
)
;
for
(
let
sheet
of
sheets
)
{
if
(
!
sheet
.
href
|
|
/
doc_content_stylesheet_
/
.
test
(
sheet
.
href
)
|
|
/
^
data
:
.
*
seagreen
/
.
test
(
sheet
.
href
)
)
{
ok
(
sheet
.
isContentSheet
sheet
.
href
+
"
identified
as
content
stylesheet
"
)
;
}
else
{
ok
(
!
sheet
.
isContentSheet
sheet
.
href
+
"
identified
as
non
-
content
stylesheet
"
)
;
}
}
}
