"
use
strict
"
;
const
PREF_RX
=
new
RegExp
(
"
^
*
pref
\
\
(
\
"
devtools
"
)
;
module
.
exports
=
function
(
content
)
{
this
.
cacheable
&
&
this
.
cacheable
(
)
;
let
isDevtools
=
this
.
request
.
endsWith
(
"
/
devtools
.
js
"
)
;
const
ifMap
=
{
"
#
if
MOZ_UPDATE_CHANNEL
=
=
beta
"
:
false
"
#
if
defined
(
NIGHTLY_BUILD
)
"
:
false
"
#
ifdef
NIGHTLY_BUILD
"
:
false
"
#
ifdef
MOZ_DEV_EDITION
"
:
false
"
#
ifdef
RELEASE_OR_BETA
"
:
true
"
#
ifdef
RELEASE_BUILD
"
:
true
}
;
let
lines
=
content
.
split
(
"
\
n
"
)
;
let
ignoring
=
false
;
let
newLines
=
[
]
;
let
continuation
=
false
;
for
(
let
line
of
lines
)
{
if
(
line
.
startsWith
(
"
sticky_pref
"
)
)
{
line
=
line
.
slice
(
7
)
;
}
if
(
isDevtools
)
{
if
(
line
.
startsWith
(
"
#
if
"
)
)
{
if
(
!
(
line
in
ifMap
)
)
{
throw
new
Error
(
"
missing
line
in
ifMap
:
"
+
line
)
;
}
ignoring
=
!
ifMap
[
line
]
;
}
else
if
(
line
.
startsWith
(
"
#
else
"
)
)
{
ignoring
=
!
ignoring
;
}
}
if
(
continuation
|
|
(
!
ignoring
&
&
PREF_RX
.
test
(
line
)
)
)
{
newLines
.
push
(
line
)
;
continuation
=
!
/
\
)
;
/
.
test
(
line
)
;
}
}
return
newLines
.
join
(
"
\
n
"
)
;
}
;
