"
use
strict
"
;
const
{
PureComponent
}
=
require
(
"
devtools
/
client
/
shared
/
vendor
/
react
"
)
;
const
PropTypes
=
require
(
"
devtools
/
client
/
shared
/
vendor
/
react
-
prop
-
types
"
)
;
const
dom
=
require
(
"
devtools
/
client
/
shared
/
vendor
/
react
-
dom
-
factories
"
)
;
const
{
SummaryGraphHelper
toPathString
}
=
require
(
"
.
.
/
.
.
/
utils
/
graph
-
helper
"
)
;
class
NegativePath
extends
PureComponent
{
static
get
propTypes
(
)
{
return
{
animation
:
PropTypes
.
object
.
isRequired
className
:
PropTypes
.
string
.
isRequired
durationPerPixel
:
PropTypes
.
number
.
isRequired
keyframes
:
PropTypes
.
object
.
isRequired
simulateAnimation
:
PropTypes
.
func
.
isRequired
totalDuration
:
PropTypes
.
number
.
isRequired
}
;
}
render
(
)
{
const
{
animation
className
durationPerPixel
keyframes
simulateAnimation
totalDuration
}
=
this
.
props
;
const
{
state
}
=
animation
;
const
effectTiming
=
Object
.
assign
(
{
}
state
{
fill
:
"
both
"
iterations
:
state
.
iterationCount
?
state
.
iterationCount
:
Infinity
}
)
;
const
frames
=
keyframes
.
map
(
keyframe
=
>
{
return
{
opacity
:
keyframe
.
offset
offset
:
keyframe
.
offset
easing
:
keyframe
.
easing
}
;
}
)
;
const
simulatedAnimation
=
simulateAnimation
(
frames
effectTiming
true
)
;
const
simulatedElement
=
simulatedAnimation
.
effect
.
target
;
const
win
=
simulatedElement
.
ownerGlobal
;
simulatedElement
.
style
.
opacity
=
0
;
const
getValueFunc
=
time
=
>
{
simulatedAnimation
.
currentTime
=
time
;
return
win
.
getComputedStyle
(
simulatedElement
)
.
opacity
;
}
;
const
toPathStringFunc
=
segments
=
>
{
const
firstSegment
=
segments
[
0
]
;
let
pathString
=
M
{
firstSegment
.
x
}
0
;
pathString
+
=
toPathString
(
segments
)
;
const
lastSegment
=
segments
[
segments
.
length
-
1
]
;
pathString
+
=
L
{
lastSegment
.
x
}
0
Z
;
return
pathString
;
}
;
const
helper
=
new
SummaryGraphHelper
(
state
keyframes
totalDuration
durationPerPixel
getValueFunc
toPathStringFunc
)
;
const
offset
=
state
.
previousStartTime
?
state
.
previousStartTime
:
0
;
return
dom
.
g
(
{
className
transform
:
translate
(
{
offset
}
)
}
this
.
renderGraph
(
state
helper
)
)
;
}
}
module
.
exports
=
NegativePath
;
