"
use
strict
"
;
const
{
getStr
}
=
require
(
"
resource
:
/
/
devtools
/
client
/
inspector
/
fonts
/
utils
/
l10n
.
js
"
)
;
const
{
parseFontVariationAxes
}
=
require
(
"
resource
:
/
/
devtools
/
client
/
inspector
/
fonts
/
utils
/
font
-
utils
.
js
"
)
;
const
{
APPLY_FONT_VARIATION_INSTANCE
RESET_EDITOR
SET_FONT_EDITOR_DISABLED
UPDATE_AXIS_VALUE
UPDATE_EDITOR_STATE
UPDATE_PROPERTY_VALUE
UPDATE_WARNING_MESSAGE
}
=
require
(
"
resource
:
/
/
devtools
/
client
/
inspector
/
fonts
/
actions
/
index
.
js
"
)
;
const
CUSTOM_INSTANCE_NAME
=
getStr
(
"
fontinspector
.
customInstanceName
"
)
;
const
INITIAL_STATE
=
{
axes
:
{
}
customInstanceValues
:
[
]
disabled
:
false
fonts
:
[
]
instance
:
{
name
:
CUSTOM_INSTANCE_NAME
values
:
[
]
}
properties
:
{
}
id
:
"
"
warning
:
getStr
(
"
fontinspector
.
noFontsUsedOnCurrentElement
"
)
}
;
const
reducers
=
{
[
APPLY_FONT_VARIATION_INSTANCE
]
(
state
{
name
values
}
)
{
const
newState
=
{
.
.
.
state
}
;
newState
.
instance
.
name
=
name
;
newState
.
instance
.
values
=
values
;
if
(
Array
.
isArray
(
values
)
&
&
values
.
length
)
{
newState
.
axes
=
values
.
reduce
(
(
acc
value
)
=
>
{
acc
[
value
.
axis
]
=
value
.
value
;
return
acc
;
}
{
}
)
;
}
return
newState
;
}
[
RESET_EDITOR
]
(
)
{
return
{
.
.
.
INITIAL_STATE
}
;
}
[
UPDATE_AXIS_VALUE
]
(
state
{
axis
value
}
)
{
const
newState
=
{
.
.
.
state
}
;
newState
.
axes
[
axis
]
=
value
;
newState
.
customInstanceValues
=
Object
.
keys
(
state
.
axes
)
.
map
(
axisName
=
>
{
return
{
axis
:
[
axisName
]
value
:
state
.
axes
[
axisName
]
}
;
}
)
;
newState
.
instance
.
name
=
CUSTOM_INSTANCE_NAME
;
return
newState
;
}
[
SET_FONT_EDITOR_DISABLED
]
(
state
{
disabled
}
)
{
return
{
.
.
.
state
disabled
}
;
}
[
UPDATE_EDITOR_STATE
]
(
state
{
fonts
properties
id
}
)
{
const
axes
=
parseFontVariationAxes
(
properties
[
"
font
-
variation
-
settings
"
]
)
;
const
weight
=
properties
[
"
font
-
weight
"
]
;
if
(
axes
.
wght
=
=
=
undefined
&
&
parseFloat
(
weight
)
.
toString
(
)
=
=
=
weight
.
toString
(
)
)
{
axes
.
wght
=
parseFloat
(
weight
)
;
}
const
stretch
=
properties
[
"
font
-
stretch
"
]
;
const
match
=
stretch
.
trim
(
)
.
match
(
/
^
(
\
d
+
(
.
\
d
+
)
?
)
%
/
)
;
if
(
axes
.
wdth
=
=
=
undefined
&
&
match
&
&
match
[
1
]
)
{
axes
.
wdth
=
parseFloat
(
match
[
1
]
)
;
}
const
style
=
properties
[
"
font
-
style
"
]
;
const
obliqueMatch
=
style
.
trim
(
)
.
match
(
/
^
oblique
(
?
:
\
s
*
(
\
d
+
(
.
\
d
+
)
?
)
deg
)
?
/
)
;
if
(
axes
.
slnt
=
=
=
undefined
&
&
obliqueMatch
)
{
if
(
obliqueMatch
[
1
]
)
{
axes
.
slnt
=
-
parseFloat
(
obliqueMatch
[
1
]
)
;
}
else
{
axes
.
slnt
=
-
14
;
}
}
if
(
axes
.
ital
=
=
=
undefined
)
{
if
(
style
=
=
=
"
normal
"
)
{
axes
.
ital
=
0
;
}
else
if
(
style
=
=
=
"
italic
"
)
{
axes
.
ital
=
1
;
}
}
return
{
.
.
.
state
axes
fonts
properties
id
}
;
}
[
UPDATE_PROPERTY_VALUE
]
(
state
{
property
value
}
)
{
const
newState
=
{
.
.
.
state
}
;
newState
.
properties
[
property
]
=
value
;
return
newState
;
}
[
UPDATE_WARNING_MESSAGE
]
(
state
{
warning
}
)
{
return
{
.
.
.
state
warning
}
;
}
}
;
module
.
exports
=
function
(
state
=
INITIAL_STATE
action
)
{
const
reducer
=
reducers
[
action
.
type
]
;
if
(
!
reducer
)
{
return
state
;
}
return
reducer
(
state
action
)
;
}
;
