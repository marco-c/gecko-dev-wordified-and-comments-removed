"
use
strict
"
;
requestLongerTimeout
(
2
)
;
const
{
getTheme
setTheme
}
=
require
(
"
devtools
/
client
/
shared
/
theme
"
)
;
const
TEST_URI
=
URL_ROOT
+
"
browser_fontinspector
.
html
"
;
const
originalTheme
=
getTheme
(
)
;
registerCleanupFunction
(
(
)
=
>
{
info
(
Restoring
theme
to
'
{
originalTheme
}
.
)
;
setTheme
(
originalTheme
)
;
}
)
;
add_task
(
async
function
(
)
{
await
pushPref
(
"
devtools
.
inspector
.
fonteditor
.
enabled
"
true
)
;
const
{
inspector
view
}
=
await
openFontInspectorForURL
(
TEST_URI
)
;
const
viewDoc
=
view
.
document
;
await
selectNode
(
"
.
normal
-
text
"
inspector
)
;
await
expandOtherFontsAccordion
(
viewDoc
)
;
const
otherFontsEls
=
getOtherFontsEls
(
viewDoc
)
;
const
fontEl
=
otherFontsEls
[
0
]
;
const
originalURI
=
fontEl
.
querySelector
(
"
.
font
-
preview
"
)
.
src
;
const
newTheme
=
originalTheme
=
=
=
"
light
"
?
"
dark
"
:
"
light
"
;
info
(
Original
theme
was
'
{
originalTheme
}
'
.
)
;
await
setThemeAndWaitForUpdate
(
newTheme
inspector
)
;
isnot
(
fontEl
.
querySelector
(
"
.
font
-
preview
"
)
.
src
originalURI
"
The
preview
image
changed
with
the
theme
.
"
)
;
await
setThemeAndWaitForUpdate
(
originalTheme
inspector
)
;
is
(
fontEl
.
querySelector
(
"
.
font
-
preview
"
)
.
src
originalURI
"
The
preview
image
is
correct
after
the
original
theme
was
restored
.
"
)
;
}
)
;
async
function
setThemeAndWaitForUpdate
(
theme
inspector
)
{
const
onUpdated
=
inspector
.
once
(
"
fontinspector
-
updated
"
)
;
info
(
Setting
theme
to
'
{
theme
}
'
.
)
;
setTheme
(
theme
)
;
info
(
"
Waiting
for
font
-
inspector
to
update
.
"
)
;
await
onUpdated
;
}
