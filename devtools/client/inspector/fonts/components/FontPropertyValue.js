"
use
strict
"
;
const
{
PureComponent
}
=
require
(
"
devtools
/
client
/
shared
/
vendor
/
react
"
)
;
const
dom
=
require
(
"
devtools
/
client
/
shared
/
vendor
/
react
-
dom
-
factories
"
)
;
const
PropTypes
=
require
(
"
devtools
/
client
/
shared
/
vendor
/
react
-
prop
-
types
"
)
;
const
{
KeyCodes
}
=
require
(
"
devtools
/
client
/
shared
/
keycodes
"
)
;
const
AUTOINCREMENT_DELAY
=
1000
;
class
FontPropertyValue
extends
PureComponent
{
static
get
propTypes
(
)
{
return
{
autoIncrement
:
PropTypes
.
bool
className
:
PropTypes
.
string
defaultValue
:
PropTypes
.
oneOfType
(
[
PropTypes
.
string
PropTypes
.
number
]
)
label
:
PropTypes
.
string
.
isRequired
min
:
PropTypes
.
number
.
isRequired
max
:
PropTypes
.
number
.
isRequired
name
:
PropTypes
.
string
.
isRequired
onChange
:
PropTypes
.
func
.
isRequired
step
:
PropTypes
.
number
unit
:
PropTypes
.
oneOfType
(
[
PropTypes
.
string
null
]
)
unitOptions
:
PropTypes
.
array
value
:
PropTypes
.
number
}
;
}
static
get
defaultProps
(
)
{
return
{
autoIncrement
:
false
className
:
"
"
step
:
1
unitOptions
:
[
]
}
;
}
constructor
(
props
)
{
super
(
props
)
;
this
.
interval
=
null
;
this
.
state
=
{
interactive
:
false
initialValue
:
this
.
props
.
value
value
:
this
.
props
.
value
}
;
this
.
autoIncrement
=
this
.
autoIncrement
.
bind
(
this
)
;
this
.
onBlur
=
this
.
onBlur
.
bind
(
this
)
;
this
.
onChange
=
this
.
onChange
.
bind
(
this
)
;
this
.
onFocus
=
this
.
onFocus
.
bind
(
this
)
;
this
.
onKeyDown
=
this
.
onKeyDown
.
bind
(
this
)
;
this
.
onKeyUp
=
this
.
onKeyUp
.
bind
(
this
)
;
this
.
onMouseDown
=
this
.
onMouseDown
.
bind
(
this
)
;
this
.
onMouseMove
=
this
.
onMouseMove
.
bind
(
this
)
;
this
.
onMouseUp
=
this
.
onMouseUp
.
bind
(
this
)
;
this
.
onUnitChange
=
this
.
onUnitChange
.
bind
(
this
)
;
this
.
stopAutoIncrement
=
this
.
stopAutoIncrement
.
bind
(
this
)
;
}
componentDidUpdate
(
prevProps
prevState
)
{
if
(
prevState
.
interactive
&
&
!
this
.
state
.
interactive
)
{
this
.
stopAutoIncrement
(
)
;
}
}
componentWillUnmount
(
)
{
this
.
stopAutoIncrement
(
)
;
}
autoIncrement
(
)
{
const
value
=
this
.
props
.
value
+
this
.
props
.
step
*
10
;
this
.
updateValue
(
value
)
;
}
isAtUpperBound
(
value
)
{
return
value
>
=
Math
.
floor
(
this
.
props
.
max
)
;
}
isValueValid
(
value
)
{
const
{
autoIncrement
min
max
}
=
this
.
props
;
if
(
typeof
value
!
=
=
"
number
"
|
|
isNaN
(
value
)
)
{
return
false
;
}
if
(
min
!
=
=
undefined
&
&
value
<
min
)
{
return
false
;
}
if
(
max
!
=
=
undefined
&
&
value
>
this
.
props
.
max
&
&
!
autoIncrement
)
{
return
false
;
}
return
true
;
}
onBlur
(
)
{
const
isValid
=
this
.
isValueValid
(
this
.
state
.
value
)
;
let
value
;
if
(
isValid
)
{
value
=
this
.
state
.
value
;
}
else
if
(
this
.
state
.
value
!
=
=
null
)
{
value
=
Math
.
max
(
this
.
props
.
min
Math
.
min
(
this
.
state
.
value
this
.
props
.
max
)
)
;
}
else
{
value
=
this
.
state
.
initialValue
;
}
this
.
updateValue
(
value
)
;
this
.
toggleInteractiveState
(
false
)
;
}
onChange
(
e
)
{
const
regex
=
/
^
[
0
-
9
]
+
(
.
[
0
-
9
]
+
)
?
/
;
let
string
=
e
.
target
.
value
.
trim
(
)
;
if
(
e
.
target
.
validity
.
badInput
)
{
return
;
}
if
(
string
.
charAt
(
0
)
=
=
=
"
.
"
&
&
string
.
length
>
1
)
{
string
=
"
0
"
+
string
;
e
.
target
.
value
=
string
;
}
if
(
string
=
=
=
"
"
)
{
this
.
setState
(
(
prevState
)
=
>
{
return
{
.
.
.
prevState
value
:
null
}
;
}
)
;
return
;
}
if
(
!
regex
.
test
(
string
)
)
{
return
;
}
const
value
=
parseFloat
(
string
)
;
this
.
updateValue
(
value
)
;
}
onFocus
(
e
)
{
if
(
e
.
target
.
type
=
=
=
"
number
"
)
{
e
.
target
.
select
(
)
;
}
this
.
setState
(
(
prevState
)
=
>
{
return
{
.
.
.
prevState
interactive
:
true
initialValue
:
this
.
props
.
value
}
;
}
)
;
}
onKeyDown
(
e
)
{
if
(
this
.
isAtUpperBound
(
this
.
props
.
value
)
&
&
e
.
keyCode
=
=
=
KeyCodes
.
DOM_VK_UP
|
|
e
.
keyCode
=
=
=
KeyCodes
.
DOM_VK_RIGHT
)
{
this
.
startAutoIncrement
(
)
;
}
}
onKeyUp
(
e
)
{
if
(
e
.
keyCode
=
=
=
KeyCodes
.
DOM_VK_UP
|
|
e
.
keyCode
=
=
=
KeyCodes
.
DOM_VK_RIGHT
)
{
this
.
stopAutoIncrement
(
)
;
}
}
onUnitChange
(
e
)
{
this
.
props
.
onChange
(
this
.
props
.
name
this
.
props
.
value
this
.
props
.
unit
e
.
target
.
value
)
;
this
.
setState
(
(
prevState
)
=
>
{
return
{
.
.
.
prevState
value
:
null
}
;
}
)
;
}
onMouseDown
(
)
{
this
.
toggleInteractiveState
(
true
)
;
}
onMouseMove
(
e
)
{
if
(
this
.
state
.
interactive
&
&
e
.
buttons
)
{
this
.
isAtUpperBound
(
this
.
props
.
value
)
?
this
.
startAutoIncrement
(
)
:
this
.
stopAutoIncrement
(
)
;
}
}
onMouseUp
(
)
{
this
.
stopAutoIncrement
(
)
;
this
.
toggleInteractiveState
(
false
)
;
}
startAutoIncrement
(
)
{
if
(
!
this
.
props
.
autoIncrement
|
|
this
.
interval
)
{
return
;
}
this
.
interval
=
setInterval
(
this
.
autoIncrement
AUTOINCREMENT_DELAY
)
;
}
stopAutoIncrement
(
)
{
clearInterval
(
this
.
interval
)
;
this
.
interval
=
null
;
}
toggleInteractiveState
(
isInteractive
)
{
this
.
setState
(
(
prevState
)
=
>
{
return
{
.
.
.
prevState
interactive
:
isInteractive
}
;
}
)
;
}
updateValue
(
value
)
{
if
(
this
.
isValueValid
(
value
)
)
{
this
.
props
.
onChange
(
this
.
props
.
name
value
this
.
props
.
unit
)
;
}
this
.
setState
(
(
prevState
)
=
>
{
return
{
.
.
.
prevState
value
}
;
}
)
;
}
renderUnitSelect
(
)
{
if
(
!
this
.
props
.
unitOptions
.
length
)
{
return
null
;
}
const
options
=
this
.
props
.
unitOptions
.
includes
(
this
.
props
.
unit
)
?
this
.
props
.
unitOptions
:
this
.
props
.
unitOptions
.
concat
(
[
this
.
props
.
unit
]
)
;
return
dom
.
select
(
{
className
:
"
font
-
value
-
select
"
onChange
:
this
.
onUnitChange
}
options
.
map
(
unit
=
>
{
return
dom
.
option
(
{
selected
:
unit
=
=
=
this
.
props
.
unit
value
:
unit
}
unit
)
;
}
)
)
;
}
render
(
)
{
if
(
this
.
props
.
min
=
=
=
this
.
props
.
max
)
{
return
null
;
}
const
propsValue
=
this
.
props
.
value
!
=
=
null
?
this
.
props
.
value
:
this
.
props
.
defaultValue
;
const
defaults
=
{
min
:
this
.
props
.
min
max
:
this
.
props
.
max
onBlur
:
this
.
onBlur
onChange
:
this
.
onChange
onFocus
:
this
.
onFocus
step
:
this
.
props
.
step
value
:
this
.
state
.
interactive
?
this
.
state
.
value
:
propsValue
}
;
const
range
=
dom
.
input
(
{
.
.
.
defaults
onKeyDown
:
this
.
onKeyDown
onKeyUp
:
this
.
onKeyUp
onMouseDown
:
this
.
onMouseDown
onMouseMove
:
this
.
onMouseMove
onMouseUp
:
this
.
onMouseUp
className
:
"
font
-
value
-
slider
"
name
:
this
.
props
.
name
title
:
this
.
props
.
label
type
:
"
range
"
}
)
;
const
input
=
dom
.
input
(
{
.
.
.
defaults
max
:
this
.
props
.
autoIncrement
?
null
:
this
.
props
.
max
name
:
this
.
props
.
name
className
:
"
font
-
value
-
input
"
type
:
"
number
"
}
)
;
return
dom
.
label
(
{
className
:
font
-
control
{
this
.
props
.
className
}
}
dom
.
span
(
{
className
:
"
font
-
control
-
label
"
}
this
.
props
.
label
)
dom
.
div
(
{
className
:
"
font
-
control
-
input
"
}
range
input
this
.
renderUnitSelect
(
)
)
)
;
}
}
module
.
exports
=
FontPropertyValue
;
