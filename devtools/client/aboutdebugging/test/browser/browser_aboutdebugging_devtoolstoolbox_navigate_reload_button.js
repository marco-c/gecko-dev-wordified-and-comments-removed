"
use
strict
"
;
function
clickReload
(
devtoolsDocument
)
{
devtoolsDocument
.
querySelector
(
"
.
qa
-
reload
-
button
"
)
.
click
(
)
;
}
add_task
(
async
function
(
)
{
const
debug_tab
=
await
addTab
(
"
about
:
home
"
)
;
const
{
document
tab
window
}
=
await
openAboutDebugging
(
)
;
info
(
"
Inspecting
a
new
tab
in
This
Firefox
"
)
;
await
selectThisFirefoxPage
(
document
window
.
AboutDebugging
.
store
)
;
const
{
devtoolsDocument
devtoolsTab
devtoolsWindow
}
=
await
openAboutDevtoolsToolbox
(
document
tab
window
"
about
:
home
"
)
;
info
(
"
Clicking
reload
button
and
waiting
for
requests
to
complete
"
)
;
const
toolbox
=
getToolbox
(
devtoolsWindow
)
;
const
{
onDomCompleteResource
}
=
await
waitForNextTopLevelDomCompleteResource
(
toolbox
.
commands
)
;
const
refreshes
=
Promise
.
all
(
[
onDomCompleteResource
toolbox
.
commands
.
client
.
waitForRequestsToSettle
(
)
waitForAboutDebuggingRequests
(
window
.
AboutDebugging
.
store
)
]
)
;
const
waitForLoadedPanelsReload
=
await
watchForLoadedPanelsReload
(
toolbox
)
;
clickReload
(
devtoolsDocument
)
;
await
refreshes
;
await
waitForLoadedPanelsReload
(
)
;
ok
(
true
"
Clicked
refresh
;
both
page
and
devtools
reloaded
"
)
;
await
closeAboutDevtoolsToolbox
(
document
devtoolsTab
window
)
;
info
(
"
Remove
the
debugged
tab
"
)
;
await
removeTab
(
debug_tab
)
;
await
waitUntil
(
(
)
=
>
!
findDebugTargetByText
(
"
about
:
home
"
document
)
)
;
await
waitForAboutDebuggingRequests
(
window
.
AboutDebugging
.
store
)
;
info
(
"
Remove
the
about
:
debugging
tab
.
"
)
;
await
removeTab
(
tab
)
;
}
)
;
