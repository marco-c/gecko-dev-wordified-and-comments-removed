"
use
strict
"
;
const
NEW_TAB_TITLE
=
"
PAGE
2
"
;
const
TAB_URL
=
"
data
:
text
/
html
<
title
>
PAGE
<
/
title
>
"
;
const
NEW_TAB_URL
=
data
:
text
/
html
<
title
>
{
NEW_TAB_TITLE
}
<
/
title
>
;
add_task
(
async
function
(
)
{
const
{
document
tab
window
}
=
await
openAboutDebugging
(
)
;
info
(
"
Open
a
new
background
tab
.
"
)
;
const
debug_tab
=
await
addTab
(
TAB_URL
{
background
:
true
}
)
;
await
selectThisFirefoxPage
(
document
window
.
AboutDebugging
.
store
)
;
const
devToolsToolbox
=
await
openAboutDevtoolsToolbox
(
document
tab
window
"
PAGE
"
)
;
const
{
devtoolsDocument
devtoolsTab
devtoolsWindow
}
=
devToolsToolbox
;
const
urlInput
=
devtoolsDocument
.
querySelector
(
"
.
devtools
-
textinput
"
)
;
await
synthesizeUrlKeyInput
(
devToolsToolbox
urlInput
NEW_TAB_URL
)
;
info
(
"
Test
that
the
debug
target
navigated
to
the
specified
URL
.
"
)
;
const
toolbox
=
getToolbox
(
devtoolsWindow
)
;
await
waitUntil
(
(
)
=
>
toolbox
.
target
.
url
=
=
=
NEW_TAB_URL
&
&
debug_tab
.
linkedBrowser
.
currentURI
.
spec
=
=
=
NEW_TAB_URL
)
;
ok
(
true
"
Target
navigated
.
"
)
;
ok
(
toolbox
.
target
.
title
.
includes
(
NEW_TAB_TITLE
)
"
Target
'
s
title
updated
.
"
)
;
is
(
urlInput
.
value
NEW_TAB_URL
"
Input
url
updated
.
"
)
;
info
(
"
Remove
the
about
:
debugging
tab
.
"
)
;
await
removeTab
(
tab
)
;
info
(
"
Remove
the
about
:
devtools
-
toolbox
tab
.
"
)
;
await
removeTab
(
devtoolsTab
)
;
info
(
"
Remove
the
background
tab
"
)
;
await
removeTab
(
debug_tab
)
;
}
)
;
async
function
synthesizeUrlKeyInput
(
toolbox
inputEl
url
)
{
const
{
devtoolsDocument
devtoolsWindow
}
=
toolbox
;
info
(
"
Wait
for
URL
input
to
be
focused
.
"
)
;
const
onInputFocused
=
waitUntil
(
(
)
=
>
devtoolsDocument
.
activeElement
=
=
=
inputEl
)
;
inputEl
.
focus
(
)
;
await
onInputFocused
;
info
(
"
Synthesize
entering
URL
into
text
field
"
)
;
const
onInputChange
=
waitUntil
(
(
)
=
>
inputEl
.
value
=
=
=
url
)
;
for
(
const
key
of
NEW_TAB_URL
.
split
(
"
"
)
)
{
EventUtils
.
synthesizeKey
(
key
{
}
devtoolsWindow
)
;
}
await
onInputChange
;
info
(
"
Submit
URL
to
navigate
to
"
)
;
EventUtils
.
synthesizeKey
(
"
KEY_Enter
"
)
;
}
