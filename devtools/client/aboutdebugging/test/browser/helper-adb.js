"
use
strict
"
;
async
function
checkAdbNotRunning
(
)
{
info
(
"
Check
if
ADB
is
already
running
before
the
test
starts
"
)
;
const
{
check
}
=
require
(
"
resource
:
/
/
devtools
/
client
/
shared
/
remote
-
debugging
/
adb
/
adb
-
running
-
checker
.
js
"
)
;
const
isAdbAlreadyRunning
=
await
check
(
)
;
if
(
isAdbAlreadyRunning
)
{
throw
new
Error
(
"
The
ADB
process
is
already
running
on
this
machine
it
should
be
"
+
"
stopped
before
running
this
test
"
)
;
}
}
async
function
waitForAdbStart
(
)
{
info
(
"
Wait
for
ADB
to
start
"
)
;
const
{
adbProcess
}
=
require
(
"
resource
:
/
/
devtools
/
client
/
shared
/
remote
-
debugging
/
adb
/
adb
-
process
.
js
"
)
;
const
{
check
}
=
require
(
"
resource
:
/
/
devtools
/
client
/
shared
/
remote
-
debugging
/
adb
/
adb
-
running
-
checker
.
js
"
)
;
return
asyncWaitUntil
(
async
(
)
=
>
{
const
isProcessReady
=
adbProcess
.
ready
;
const
isRunning
=
await
check
(
)
;
return
isProcessReady
&
&
isRunning
;
}
)
;
}
async
function
stopAdbProcess
(
)
{
info
(
"
Attempt
to
stop
ADB
"
)
;
const
{
adbProcess
}
=
require
(
"
resource
:
/
/
devtools
/
client
/
shared
/
remote
-
debugging
/
adb
/
adb
-
process
.
js
"
)
;
await
adbProcess
.
stop
(
)
;
info
(
"
Wait
for
ADB
to
stop
"
)
;
const
{
check
}
=
require
(
"
resource
:
/
/
devtools
/
client
/
shared
/
remote
-
debugging
/
adb
/
adb
-
running
-
checker
.
js
"
)
;
return
asyncWaitUntil
(
async
(
)
=
>
{
const
isProcessReady
=
adbProcess
.
ready
;
const
isRunning
=
await
check
(
)
;
return
!
isProcessReady
&
&
!
isRunning
;
}
)
;
}
