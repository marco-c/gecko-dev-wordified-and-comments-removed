"
use
strict
"
;
const
ADDON_ID
=
"
test
-
devtools
mozilla
.
org
"
;
const
ADDON_NAME
=
"
test
-
devtools
"
;
add_task
(
function
*
(
)
{
let
{
tab
document
}
=
yield
openAboutDebugging
(
"
addons
"
)
;
yield
waitForInitialAddonList
(
document
)
;
yield
installAddon
(
{
document
path
:
"
addons
/
unpacked
/
install
.
rdf
"
name
:
ADDON_NAME
}
)
;
yield
uninstallAddon
(
{
document
id
:
ADDON_ID
name
:
ADDON_NAME
}
)
;
yield
closeAboutDebugging
(
tab
)
;
}
)
;
add_task
(
function
*
(
)
{
let
{
tab
document
window
}
=
yield
openAboutDebugging
(
"
addons
"
)
;
yield
waitForInitialAddonList
(
document
)
;
let
top
=
document
.
querySelector
(
"
.
addons
-
top
"
)
;
let
promise
=
waitForMutation
(
top
{
childList
:
true
}
)
;
let
MockFilePicker
=
SpecialPowers
.
MockFilePicker
;
MockFilePicker
.
init
(
window
)
;
let
file
=
getSupportsFile
(
"
addons
/
bad
/
manifest
.
json
"
)
;
MockFilePicker
.
setFiles
(
[
file
.
file
]
)
;
document
.
getElementById
(
"
load
-
addon
-
from
-
file
"
)
.
click
(
)
;
yield
promise
;
let
err
=
document
.
querySelector
(
"
.
addons
-
install
-
error
"
)
;
isnot
(
err
null
"
Addon
install
error
message
appeared
"
)
;
yield
closeAboutDebugging
(
tab
)
;
}
)
;
