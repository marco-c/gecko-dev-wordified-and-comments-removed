"
use
strict
"
;
const
{
Task
}
=
require
(
"
devtools
/
shared
/
task
"
)
;
loader
.
lazyRequireGetter
(
this
"
gDevTools
"
"
devtools
/
client
/
framework
/
devtools
"
true
)
;
loader
.
lazyRequireGetter
(
this
"
TargetFactory
"
"
devtools
/
client
/
framework
/
target
"
true
)
;
loader
.
lazyRequireGetter
(
this
"
Toolbox
"
"
devtools
/
client
/
framework
/
toolbox
"
true
)
;
exports
.
debugWorker
=
function
(
client
workerActor
)
{
client
.
attachWorker
(
workerActor
(
response
workerClient
)
=
>
{
let
workerTarget
=
TargetFactory
.
forWorker
(
workerClient
)
;
gDevTools
.
showToolbox
(
workerTarget
"
jsdebugger
"
Toolbox
.
HostType
.
WINDOW
)
.
then
(
toolbox
=
>
{
toolbox
.
once
(
"
destroy
"
(
)
=
>
workerClient
.
detach
(
)
)
;
}
)
;
}
)
;
}
;
exports
.
getWorkerForms
=
Task
.
async
(
function
*
(
client
)
{
let
registrations
=
[
]
;
let
workers
=
[
]
;
try
{
(
{
registrations
}
=
yield
client
.
mainRoot
.
listServiceWorkerRegistrations
(
)
)
;
(
{
workers
}
=
yield
client
.
mainRoot
.
listWorkers
(
)
)
;
let
{
processes
}
=
yield
client
.
mainRoot
.
listProcesses
(
)
;
for
(
let
process
of
processes
)
{
if
(
process
.
parent
)
{
continue
;
}
let
{
form
}
=
yield
client
.
getProcess
(
process
.
id
)
;
let
processActor
=
form
.
actor
;
let
response
=
yield
client
.
request
(
{
to
:
processActor
type
:
"
listWorkers
"
}
)
;
workers
=
workers
.
concat
(
response
.
workers
)
;
}
}
catch
(
e
)
{
}
return
{
registrations
workers
}
;
}
)
;
