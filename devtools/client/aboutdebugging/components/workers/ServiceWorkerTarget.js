"
use
strict
"
;
const
{
Component
}
=
require
(
"
devtools
/
client
/
shared
/
vendor
/
react
"
)
;
const
PropTypes
=
require
(
"
devtools
/
client
/
shared
/
vendor
/
react
-
prop
-
types
"
)
;
const
dom
=
require
(
"
devtools
/
client
/
shared
/
vendor
/
react
-
dom
-
factories
"
)
;
const
Services
=
require
(
"
Services
"
)
;
loader
.
lazyRequireGetter
(
this
"
DebuggerClient
"
"
devtools
/
shared
/
client
/
debugger
-
client
"
true
)
;
loader
.
lazyRequireGetter
(
this
"
gDevToolsBrowser
"
"
devtools
/
client
/
framework
/
devtools
-
browser
"
true
)
;
const
Strings
=
Services
.
strings
.
createBundle
(
"
chrome
:
/
/
devtools
/
locale
/
aboutdebugging
.
properties
"
)
;
class
ServiceWorkerTarget
extends
Component
{
static
get
propTypes
(
)
{
return
{
client
:
PropTypes
.
instanceOf
(
DebuggerClient
)
.
isRequired
debugDisabled
:
PropTypes
.
bool
target
:
PropTypes
.
shape
(
{
active
:
PropTypes
.
bool
fetch
:
PropTypes
.
bool
.
isRequired
icon
:
PropTypes
.
string
name
:
PropTypes
.
string
.
isRequired
url
:
PropTypes
.
string
scope
:
PropTypes
.
string
.
isRequired
registrationFront
:
PropTypes
.
object
workerTargetFront
:
PropTypes
.
object
}
)
.
isRequired
}
;
}
constructor
(
props
)
{
super
(
props
)
;
this
.
state
=
{
pushSubscription
:
null
}
;
this
.
debug
=
this
.
debug
.
bind
(
this
)
;
this
.
push
=
this
.
push
.
bind
(
this
)
;
this
.
start
=
this
.
start
.
bind
(
this
)
;
this
.
unregister
=
this
.
unregister
.
bind
(
this
)
;
this
.
updatePushSubscription
=
this
.
updatePushSubscription
.
bind
(
this
)
;
this
.
isRunning
=
this
.
isRunning
.
bind
(
this
)
;
this
.
isActive
=
this
.
isActive
.
bind
(
this
)
;
this
.
getServiceWorkerStatus
=
this
.
getServiceWorkerStatus
.
bind
(
this
)
;
this
.
renderButtons
=
this
.
renderButtons
.
bind
(
this
)
;
this
.
renderUnregisterLink
=
this
.
renderUnregisterLink
.
bind
(
this
)
;
}
componentDidMount
(
)
{
this
.
updatePushSubscription
(
)
;
}
componentDidUpdate
(
oldProps
oldState
)
{
this
.
updatePushSubscription
(
)
;
}
debug
(
)
{
if
(
!
this
.
isRunning
(
)
)
{
return
;
}
const
{
workerTargetFront
}
=
this
.
props
.
target
;
gDevToolsBrowser
.
openWorkerToolbox
(
workerTargetFront
)
;
}
push
(
)
{
if
(
!
this
.
isActive
(
)
|
|
!
this
.
isRunning
(
)
)
{
return
;
}
const
{
workerTargetFront
}
=
this
.
props
.
target
;
workerTargetFront
.
push
(
)
;
}
start
(
)
{
if
(
!
this
.
isActive
(
)
|
|
this
.
isRunning
(
)
)
{
return
;
}
const
{
registrationFront
}
=
this
.
props
.
target
;
registrationFront
.
start
(
)
;
}
unregister
(
)
{
const
{
registrationFront
}
=
this
.
props
.
target
;
registrationFront
.
unregister
(
)
;
}
async
updatePushSubscription
(
)
{
const
{
registrationFront
}
=
this
.
props
.
target
;
if
(
!
registrationFront
)
{
return
;
}
try
{
const
subscription
=
await
registrationFront
.
getPushSubscription
(
)
;
this
.
setState
(
{
pushSubscription
:
subscription
}
)
;
}
catch
(
e
)
{
}
}
isRunning
(
)
{
return
!
!
this
.
props
.
target
.
workerTargetFront
;
}
isActive
(
)
{
return
this
.
props
.
target
.
active
;
}
getServiceWorkerStatus
(
)
{
if
(
this
.
isActive
(
)
&
&
this
.
isRunning
(
)
)
{
return
"
running
"
;
}
else
if
(
this
.
isActive
(
)
)
{
return
"
stopped
"
;
}
return
"
registering
"
;
}
renderButtons
(
)
{
const
pushButton
=
dom
.
button
(
{
className
:
"
push
-
button
"
onClick
:
this
.
push
disabled
:
this
.
props
.
debugDisabled
}
Strings
.
GetStringFromName
(
"
push
"
)
)
;
const
debugButton
=
dom
.
button
(
{
className
:
"
debug
-
button
"
onClick
:
this
.
debug
disabled
:
this
.
props
.
debugDisabled
}
Strings
.
GetStringFromName
(
"
debug
"
)
)
;
const
startButton
=
dom
.
button
(
{
className
:
"
start
-
button
"
onClick
:
this
.
start
disabled
:
this
.
props
.
debugDisabled
}
Strings
.
GetStringFromName
(
"
start
"
)
)
;
if
(
this
.
isRunning
(
)
)
{
if
(
this
.
isActive
(
)
)
{
return
[
pushButton
debugButton
]
;
}
return
debugButton
;
}
return
startButton
;
}
renderUnregisterLink
(
)
{
if
(
!
this
.
isActive
(
)
)
{
return
null
;
}
return
dom
.
a
(
{
onClick
:
this
.
unregister
className
:
"
unregister
-
link
"
}
Strings
.
GetStringFromName
(
"
unregister
"
)
)
;
}
render
(
)
{
const
{
target
}
=
this
.
props
;
const
{
pushSubscription
}
=
this
.
state
;
const
status
=
this
.
getServiceWorkerStatus
(
)
;
const
fetch
=
target
.
fetch
?
Strings
.
GetStringFromName
(
"
listeningForFetchEvents
"
)
:
Strings
.
GetStringFromName
(
"
notListeningForFetchEvents
"
)
;
return
dom
.
div
(
{
className
:
"
target
-
container
"
}
dom
.
img
(
{
className
:
"
target
-
icon
"
role
:
"
presentation
"
src
:
target
.
icon
}
)
dom
.
span
(
{
className
:
target
-
status
target
-
status
-
{
status
}
}
Strings
.
GetStringFromName
(
status
)
)
dom
.
div
(
{
className
:
"
target
"
}
dom
.
div
(
{
className
:
"
target
-
name
"
title
:
target
.
name
}
target
.
name
)
dom
.
ul
(
{
className
:
"
target
-
details
"
}
pushSubscription
?
dom
.
li
(
{
className
:
"
target
-
detail
"
}
dom
.
strong
(
null
Strings
.
GetStringFromName
(
"
pushService
"
)
)
dom
.
span
(
{
className
:
"
service
-
worker
-
push
-
url
"
title
:
pushSubscription
.
endpoint
}
pushSubscription
.
endpoint
)
)
:
null
dom
.
li
(
{
className
:
"
target
-
detail
"
}
dom
.
strong
(
null
Strings
.
GetStringFromName
(
"
fetch
"
)
)
dom
.
span
(
{
className
:
"
service
-
worker
-
fetch
-
flag
"
title
:
fetch
}
fetch
)
)
dom
.
li
(
{
className
:
"
target
-
detail
"
}
dom
.
strong
(
null
Strings
.
GetStringFromName
(
"
scope
"
)
)
dom
.
span
(
{
className
:
"
service
-
worker
-
scope
"
title
:
target
.
scope
}
target
.
scope
)
this
.
renderUnregisterLink
(
)
)
)
)
this
.
renderButtons
(
)
)
;
}
}
module
.
exports
=
ServiceWorkerTarget
;
