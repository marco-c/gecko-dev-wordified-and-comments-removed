"
use
strict
"
;
const
{
Component
}
=
require
(
"
devtools
/
client
/
shared
/
vendor
/
react
"
)
;
const
{
findDOMNode
}
=
require
(
"
devtools
/
client
/
shared
/
vendor
/
react
-
dom
"
)
;
const
PropTypes
=
require
(
"
devtools
/
client
/
shared
/
vendor
/
react
-
prop
-
types
"
)
;
const
dom
=
require
(
"
devtools
/
client
/
shared
/
vendor
/
react
-
dom
-
factories
"
)
;
const
{
L10N
}
=
require
(
"
devtools
/
client
/
netmonitor
/
src
/
utils
/
l10n
"
)
;
loader
.
lazyRequireGetter
(
this
"
HarMenuUtils
"
"
devtools
/
client
/
netmonitor
/
src
/
har
/
har
-
menu
-
utils
"
true
)
;
const
{
div
}
=
dom
;
const
DROP_HAR_FILES
=
L10N
.
getStr
(
"
netmonitor
.
label
.
dropHarFiles
"
)
;
class
DropHarHandler
extends
Component
{
static
get
propTypes
(
)
{
return
{
actions
:
PropTypes
.
object
.
isRequired
children
:
PropTypes
.
element
.
isRequired
openSplitConsole
:
PropTypes
.
func
}
;
}
constructor
(
props
)
{
super
(
props
)
;
this
.
onDragEnter
=
this
.
onDragEnter
.
bind
(
this
)
;
this
.
onDragOver
=
this
.
onDragOver
.
bind
(
this
)
;
this
.
onDragExit
=
this
.
onDragExit
.
bind
(
this
)
;
this
.
onDrop
=
this
.
onDrop
.
bind
(
this
)
;
}
onDragEnter
(
event
)
{
event
.
preventDefault
(
)
;
if
(
event
.
dataTransfer
.
files
.
length
=
=
=
0
)
{
return
;
}
startDragging
(
findDOMNode
(
this
)
)
;
}
onDragExit
(
event
)
{
event
.
preventDefault
(
)
;
stopDragging
(
findDOMNode
(
this
)
)
;
}
onDragOver
(
event
)
{
event
.
preventDefault
(
)
;
event
.
dataTransfer
.
dropEffect
=
"
copy
"
;
}
onDrop
(
event
)
{
event
.
preventDefault
(
)
;
stopDragging
(
findDOMNode
(
this
)
)
;
const
files
=
event
.
dataTransfer
.
files
;
if
(
!
files
)
{
return
;
}
const
{
actions
openSplitConsole
}
=
this
.
props
;
if
(
files
.
length
)
{
const
file
=
files
[
0
]
;
readFile
(
file
)
.
then
(
har
=
>
{
if
(
har
)
{
HarMenuUtils
.
appendPreview
(
har
actions
openSplitConsole
)
;
}
}
)
;
}
}
render
(
)
{
return
div
(
{
onDragEnter
:
this
.
onDragEnter
onDragOver
:
this
.
onDragOver
onDragExit
:
this
.
onDragExit
onDrop
:
this
.
onDrop
}
this
.
props
.
children
div
(
{
className
:
"
dropHarFiles
"
}
div
(
{
}
DROP_HAR_FILES
)
)
)
;
}
}
function
readFile
(
file
)
{
return
new
Promise
(
resolve
=
>
{
const
fileReader
=
new
FileReader
(
)
;
fileReader
.
onloadend
=
(
)
=
>
{
resolve
(
fileReader
.
result
)
;
}
;
fileReader
.
readAsText
(
file
)
;
}
)
;
}
function
startDragging
(
node
)
{
node
.
setAttribute
(
"
dragging
"
"
true
"
)
;
}
function
stopDragging
(
node
)
{
node
.
removeAttribute
(
"
dragging
"
)
;
}
module
.
exports
=
DropHarHandler
;
