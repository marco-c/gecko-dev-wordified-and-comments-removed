"
use
strict
"
;
var
netMonitorHead
=
"
chrome
:
/
/
mochitests
/
content
/
browser
/
devtools
/
client
/
netmonitor
/
test
/
head
.
js
"
;
Services
.
scriptloader
.
loadSubScript
(
netMonitorHead
this
)
;
const
HAR_EXAMPLE_URL
=
"
https
:
/
/
example
.
com
/
browser
/
devtools
/
client
/
netmonitor
/
src
/
har
/
test
/
"
;
async
function
copyAllAsHARWithContextMenu
(
monitor
{
asString
=
false
}
=
{
}
)
{
const
{
HarMenuUtils
}
=
monitor
.
panelWin
.
windowRequire
(
"
devtools
/
client
/
netmonitor
/
src
/
har
/
har
-
menu
-
utils
"
)
;
info
(
"
Open
the
context
menu
on
the
first
visible
request
.
"
)
;
const
firstRequest
=
monitor
.
panelWin
.
document
.
querySelectorAll
(
"
.
request
-
list
-
item
"
)
[
0
]
;
EventUtils
.
sendMouseEvent
(
{
type
:
"
mousedown
"
}
firstRequest
)
;
EventUtils
.
sendMouseEvent
(
{
type
:
"
contextmenu
"
}
firstRequest
)
;
info
(
"
Trigger
Copy
All
As
HAR
from
the
context
menu
"
)
;
const
onHarCopyDone
=
HarMenuUtils
.
once
(
"
copy
-
all
-
as
-
har
-
done
"
)
;
await
selectContextMenuItem
(
monitor
"
request
-
list
-
context
-
copy
-
all
-
as
-
har
"
)
;
const
jsonString
=
await
onHarCopyDone
;
if
(
asString
)
{
return
jsonString
;
}
return
JSON
.
parse
(
jsonString
)
;
}
