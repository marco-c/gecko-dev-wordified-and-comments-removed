"
use
strict
"
;
const
{
createSelector
}
=
require
(
"
devtools
/
client
/
shared
/
vendor
/
reselect
"
)
;
const
{
REQUESTS_WATERFALL
}
=
require
(
"
devtools
/
client
/
netmonitor
/
src
/
constants
"
)
;
const
EPSILON
=
0
.
001
;
const
getWaterfallScale
=
createSelector
(
state
=
>
state
.
requests
.
firstStartedMs
state
=
>
state
.
requests
.
lastEndedMs
state
=
>
state
.
timingMarkers
.
firstDocumentDOMContentLoadedTimestamp
state
=
>
state
.
timingMarkers
.
firstDocumentLoadTimestamp
state
=
>
state
.
ui
.
waterfallWidth
(
firstStartedMs
lastEndedMs
firstDocumentDOMContentLoadedTimestamp
firstDocumentLoadTimestamp
waterfallWidth
)
=
>
{
if
(
firstStartedMs
=
=
=
+
Infinity
|
|
waterfallWidth
=
=
=
null
)
{
return
null
;
}
const
lastEventMs
=
Math
.
max
(
lastEndedMs
firstDocumentDOMContentLoadedTimestamp
firstDocumentLoadTimestamp
)
;
const
longestWidth
=
lastEventMs
-
firstStartedMs
;
return
Math
.
min
(
Math
.
max
(
(
waterfallWidth
-
REQUESTS_WATERFALL
.
LABEL_WIDTH
-
20
)
/
longestWidth
EPSILON
)
1
)
;
}
)
;
function
getVisibleColumns
(
columns
)
{
return
Object
.
entries
(
columns
)
.
filter
(
(
[
_
shown
]
)
=
>
shown
)
;
}
const
getColumns
=
createSelector
(
state
=
>
state
.
ui
state
=
>
state
.
search
(
ui
search
)
=
>
{
if
(
(
(
ui
.
networkDetailsOpen
|
|
search
.
panelOpen
)
&
&
getVisibleColumns
(
ui
.
columns
)
.
length
=
=
=
1
&
&
ui
.
columns
.
waterfall
)
|
|
(
!
ui
.
networkDetailsOpen
&
&
!
search
.
panelOpen
)
)
{
return
ui
.
columns
;
}
const
columns
=
{
.
.
.
ui
.
columns
}
;
delete
columns
.
waterfall
;
return
columns
;
}
)
;
module
.
exports
=
{
getColumns
getVisibleColumns
getWaterfallScale
}
;
