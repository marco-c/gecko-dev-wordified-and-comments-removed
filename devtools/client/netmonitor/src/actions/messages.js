"
use
strict
"
;
const
{
MSG_ADD
MSG_SELECT
MSG_OPEN_DETAILS
MSG_CLEAR
MSG_TOGGLE_FILTER_TYPE
MSG_TOGGLE_CONTROL
MSG_SET_FILTER_TEXT
MSG_TOGGLE_COLUMN
MSG_RESET_COLUMNS
MSG_CLOSE_CONNECTION
}
=
require
(
"
devtools
/
client
/
netmonitor
/
src
/
constants
"
)
;
const
{
getDisplayedMessages
}
=
require
(
"
devtools
/
client
/
netmonitor
/
src
/
selectors
/
index
"
)
;
const
PAGE_SIZE_ITEM_COUNT_RATIO
=
5
;
function
addMessage
(
httpChannelId
data
batch
)
{
return
{
type
:
MSG_ADD
httpChannelId
data
meta
:
{
batch
}
}
;
}
function
selectMessage
(
message
)
{
return
{
type
:
MSG_SELECT
open
:
true
message
}
;
}
function
openMessageDetails
(
open
)
{
return
{
type
:
MSG_OPEN_DETAILS
open
}
;
}
function
clearMessages
(
)
{
return
{
type
:
MSG_CLEAR
}
;
}
function
toggleMessageFilterType
(
filter
)
{
return
{
type
:
MSG_TOGGLE_FILTER_TYPE
filter
}
;
}
function
toggleControlFrames
(
)
{
return
{
type
:
MSG_TOGGLE_CONTROL
}
;
}
function
setMessageFilterText
(
text
)
{
return
{
type
:
MSG_SET_FILTER_TEXT
text
}
;
}
function
resetMessageColumns
(
)
{
return
{
type
:
MSG_RESET_COLUMNS
}
;
}
function
toggleMessageColumn
(
column
)
{
return
{
type
:
MSG_TOGGLE_COLUMN
column
}
;
}
function
closeConnection
(
httpChannelId
wasClean
code
reason
)
{
return
{
type
:
MSG_CLOSE_CONNECTION
httpChannelId
wasClean
code
reason
}
;
}
function
selectMessageDelta
(
delta
)
{
return
(
{
dispatch
getState
}
)
=
>
{
const
state
=
getState
(
)
;
const
messages
=
getDisplayedMessages
(
state
)
;
if
(
messages
.
length
=
=
=
0
)
{
return
;
}
const
selIndex
=
messages
.
findIndex
(
r
=
>
r
=
=
=
state
.
messages
.
selectedMessage
)
;
if
(
delta
=
=
=
"
PAGE_DOWN
"
)
{
delta
=
Math
.
ceil
(
messages
.
length
/
PAGE_SIZE_ITEM_COUNT_RATIO
)
;
}
else
if
(
delta
=
=
=
"
PAGE_UP
"
)
{
delta
=
-
Math
.
ceil
(
messages
.
length
/
PAGE_SIZE_ITEM_COUNT_RATIO
)
;
}
const
newIndex
=
Math
.
min
(
Math
.
max
(
0
selIndex
+
delta
)
messages
.
length
-
1
)
;
const
newItem
=
messages
[
newIndex
]
;
dispatch
(
selectMessage
(
newItem
)
)
;
}
;
}
module
.
exports
=
{
addMessage
clearMessages
closeConnection
openMessageDetails
resetMessageColumns
selectMessage
selectMessageDelta
setMessageFilterText
toggleControlFrames
toggleMessageColumn
toggleMessageFilterType
}
;
