"
use
strict
"
;
const
{
OPEN_ACTION_BAR
SELECT_ACTION_BAR_TAB
PANELS
RIGHT_CLICK_REQUEST
PRESELECT_REQUEST
}
=
require
(
"
devtools
/
client
/
netmonitor
/
src
/
constants
"
)
;
const
{
selectRequest
}
=
require
(
"
devtools
/
client
/
netmonitor
/
src
/
actions
/
selection
"
)
;
const
{
openNetworkDetails
}
=
require
(
"
devtools
/
client
/
netmonitor
/
src
/
actions
/
ui
"
)
;
const
{
getRequestById
getRequestByChannelId
}
=
require
(
"
devtools
/
client
/
netmonitor
/
src
/
selectors
/
index
"
)
;
const
{
fetchNetworkUpdatePacket
}
=
require
(
"
devtools
/
client
/
netmonitor
/
src
/
utils
/
request
-
utils
"
)
;
function
openHTTPCustomRequest
(
isOpen
)
{
return
(
{
dispatch
getState
}
)
=
>
{
dispatch
(
{
type
:
OPEN_ACTION_BAR
open
:
isOpen
}
)
;
dispatch
(
{
type
:
SELECT_ACTION_BAR_TAB
id
:
PANELS
.
HTTP_CUSTOM_REQUEST
}
)
;
}
;
}
function
toggleHTTPCustomRequestPanel
(
)
{
return
(
{
dispatch
getState
}
)
=
>
{
const
state
=
getState
(
)
;
const
shouldClose
=
state
.
ui
.
networkActionOpen
&
&
state
.
ui
.
selectedActionBarTabId
=
=
=
PANELS
.
HTTP_CUSTOM_REQUEST
;
dispatch
(
{
type
:
OPEN_ACTION_BAR
open
:
!
shouldClose
}
)
;
dispatch
(
{
type
:
RIGHT_CLICK_REQUEST
id
:
null
}
)
;
dispatch
(
{
type
:
SELECT_ACTION_BAR_TAB
id
:
PANELS
.
HTTP_CUSTOM_REQUEST
}
)
;
}
;
}
function
sendHTTPCustomRequest
(
connector
request
)
{
return
async
(
{
dispatch
getState
}
)
=
>
{
if
(
!
request
)
{
return
;
}
if
(
request
.
requestHeadersAvailable
|
|
request
.
requestPostDataAvailable
)
{
await
fetchNetworkUpdatePacket
(
connector
.
requestData
request
[
"
requestHeaders
"
"
requestPostData
"
]
)
;
request
=
getRequestById
(
getState
(
)
request
.
id
)
;
}
const
data
=
{
cause
:
request
.
cause
|
|
{
}
url
:
request
.
url
method
:
request
.
method
httpVersion
:
request
.
httpVersion
}
;
if
(
request
.
requestHeaders
)
{
data
.
headers
=
request
.
requestHeaders
.
headers
;
}
if
(
request
.
requestPostData
)
{
data
.
body
=
request
.
requestPostData
.
postData
?
.
text
;
}
const
{
channelId
}
=
await
connector
.
sendHTTPRequest
(
data
)
;
const
newRequest
=
getRequestByChannelId
(
getState
(
)
channelId
)
;
if
(
newRequest
)
{
await
dispatch
(
selectRequest
(
newRequest
.
id
)
)
;
}
else
{
await
dispatch
(
{
type
:
PRESELECT_REQUEST
id
:
channelId
}
)
;
}
dispatch
(
openNetworkDetails
(
true
)
)
;
}
;
}
module
.
exports
=
{
openHTTPCustomRequest
toggleHTTPCustomRequestPanel
sendHTTPCustomRequest
}
;
