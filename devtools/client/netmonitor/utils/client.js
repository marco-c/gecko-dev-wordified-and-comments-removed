"
use
strict
"
;
const
Services
=
require
(
"
Services
"
)
;
const
Actions
=
require
(
"
.
.
/
actions
/
index
"
)
;
const
{
EVENTS
}
=
require
(
"
.
.
/
constants
"
)
;
let
activeConsole
;
function
navigated
(
type
)
{
window
.
emit
(
EVENTS
.
TARGET_DID_NAVIGATE
)
;
}
function
willNavigate
(
type
)
{
if
(
!
Services
.
prefs
.
getBoolPref
(
"
devtools
.
webconsole
.
persistlog
"
)
)
{
gStore
.
dispatch
(
Actions
.
batchReset
(
)
)
;
gStore
.
dispatch
(
Actions
.
clearRequests
(
)
)
;
}
else
{
gStore
.
dispatch
(
Actions
.
clearTimingMarkers
(
)
)
;
}
window
.
emit
(
EVENTS
.
TARGET_WILL_NAVIGATE
)
;
}
function
onFirefoxConnect
(
tabTarget
)
{
activeConsole
=
tabTarget
.
activeConsole
;
tabTarget
.
on
(
"
navigate
"
navigated
)
;
tabTarget
.
on
(
"
will
-
navigate
"
willNavigate
)
;
}
function
onFirefoxDisconnect
(
tabTarget
)
{
activeConsole
=
null
;
tabTarget
.
off
(
"
navigate
"
navigated
)
;
tabTarget
.
off
(
"
will
-
navigate
"
willNavigate
)
;
}
function
getWebConsoleClient
(
)
{
return
activeConsole
;
}
function
getLongString
(
stringGrip
)
{
if
(
typeof
stringGrip
=
=
=
"
string
"
)
{
return
Promise
.
resolve
(
stringGrip
)
;
}
return
activeConsole
.
getString
(
stringGrip
)
;
}
module
.
exports
=
{
getLongString
getWebConsoleClient
onFirefoxConnect
onFirefoxDisconnect
}
;
