"
use
strict
"
;
add_task
(
function
*
(
)
{
let
{
tab
monitor
}
=
yield
initNetMonitor
(
CORS_URL
)
;
let
{
RequestsMenu
}
=
monitor
.
panelWin
.
NetMonitorView
;
RequestsMenu
.
lazyUpdate
=
false
;
let
wait
=
waitForNetworkEvents
(
monitor
1
1
)
;
info
(
"
Performing
a
CORS
request
"
)
;
let
requestUrl
=
"
http
:
/
/
test1
.
example
.
com
"
+
CORS_SJS_PATH
;
yield
ContentTask
.
spawn
(
tab
.
linkedBrowser
requestUrl
function
*
(
url
)
{
content
.
wrappedJSObject
.
performRequests
(
url
"
triggering
/
preflight
"
"
post
-
data
"
)
;
}
)
;
info
(
"
Waiting
until
the
requests
appear
in
netmonitor
"
)
;
yield
wait
;
info
(
"
Checking
the
preflight
and
flight
methods
"
)
;
[
"
OPTIONS
"
"
POST
"
]
.
forEach
(
(
method
i
)
=
>
{
verifyRequestItemTarget
(
RequestsMenu
RequestsMenu
.
getItemAtIndex
(
i
)
method
requestUrl
)
;
}
)
;
yield
teardown
(
monitor
)
;
}
)
;
