"
use
strict
"
;
XPCOMUtils
.
defineLazyGetter
(
this
"
NetworkHelper
"
function
(
)
{
return
require
(
"
devtools
/
shared
/
webconsole
/
network
-
helper
"
)
;
}
)
;
const
{
VariablesView
}
=
require
(
"
resource
:
/
/
devtools
/
client
/
shared
/
widgets
/
VariablesView
.
jsm
"
)
;
const
{
VariablesViewController
}
=
require
(
"
resource
:
/
/
devtools
/
client
/
shared
/
widgets
/
VariablesViewController
.
jsm
"
)
;
const
{
ToolSidebar
}
=
require
(
"
devtools
/
client
/
framework
/
sidebar
"
)
;
const
{
testing
:
isTesting
}
=
require
(
"
devtools
/
shared
/
flags
"
)
;
const
{
ViewHelpers
Heritage
}
=
require
(
"
devtools
/
client
/
shared
/
widgets
/
view
-
helpers
"
)
;
const
{
PluralForm
}
=
require
(
"
devtools
/
shared
/
plural
-
form
"
)
;
const
{
Filters
}
=
require
(
"
.
/
filter
-
predicates
"
)
;
const
{
getFormDataSections
formDataURI
getUriHostPort
}
=
require
(
"
.
/
request
-
utils
"
)
;
const
{
L10N
}
=
require
(
"
.
/
l10n
"
)
;
const
{
RequestsMenuView
}
=
require
(
"
.
/
requests
-
menu
-
view
"
)
;
const
{
CustomRequestView
}
=
require
(
"
.
/
custom
-
request
-
view
"
)
;
const
{
ToolbarView
}
=
require
(
"
.
/
toolbar
-
view
"
)
;
const
{
configureStore
}
=
require
(
"
.
/
store
"
)
;
const
Actions
=
require
(
"
.
/
actions
/
index
"
)
;
var
gStore
=
configureStore
(
)
;
const
WDA_DEFAULT_VERIFY_INTERVAL
=
50
;
const
WDA_DEFAULT_GIVE_UP_TIMEOUT
=
isTesting
?
45000
:
2000
;
const
SOURCE_SYNTAX_HIGHLIGHT_MAX_FILE_SIZE
=
102400
;
const
REQUEST_TIME_DECIMALS
=
2
;
const
HEADERS_SIZE_DECIMALS
=
3
;
const
CONTENT_SIZE_DECIMALS
=
2
;
const
CONTENT_MIME_TYPE_MAPPINGS
=
{
"
/
ecmascript
"
:
Editor
.
modes
.
js
"
/
javascript
"
:
Editor
.
modes
.
js
"
/
x
-
javascript
"
:
Editor
.
modes
.
js
"
/
html
"
:
Editor
.
modes
.
html
"
/
xhtml
"
:
Editor
.
modes
.
html
"
/
xml
"
:
Editor
.
modes
.
html
"
/
atom
"
:
Editor
.
modes
.
html
"
/
soap
"
:
Editor
.
modes
.
html
"
/
vnd
.
mpeg
.
dash
.
mpd
"
:
Editor
.
modes
.
html
"
/
rdf
"
:
Editor
.
modes
.
css
"
/
rss
"
:
Editor
.
modes
.
css
"
/
css
"
:
Editor
.
modes
.
css
}
;
const
DEFAULT_EDITOR_CONFIG
=
{
mode
:
Editor
.
modes
.
text
readOnly
:
true
lineNumbers
:
true
}
;
const
GENERIC_VARIABLES_VIEW_SETTINGS
=
{
lazyEmpty
:
true
lazyEmptyDelay
:
10
searchEnabled
:
true
editableValueTooltip
:
"
"
editableNameTooltip
:
"
"
preventDisableOnChange
:
true
preventDescriptorModifiers
:
true
eval
:
(
)
=
>
{
}
}
;
const
NETWORK_ANALYSIS_PIE_CHART_DIAMETER
=
200
;
var
NetMonitorView
=
{
initialize
:
function
(
)
{
this
.
_initializePanes
(
)
;
this
.
Toolbar
.
initialize
(
gStore
)
;
this
.
RequestsMenu
.
initialize
(
gStore
)
;
this
.
NetworkDetails
.
initialize
(
)
;
this
.
CustomRequest
.
initialize
(
)
;
}
destroy
:
function
(
)
{
this
.
_isDestroyed
=
true
;
this
.
Toolbar
.
destroy
(
)
;
this
.
RequestsMenu
.
destroy
(
)
;
this
.
NetworkDetails
.
destroy
(
)
;
this
.
CustomRequest
.
destroy
(
)
;
this
.
_destroyPanes
(
)
;
}
_initializePanes
:
function
(
)
{
dumpn
(
"
Initializing
the
NetMonitorView
panes
"
)
;
this
.
_body
=
(
"
#
body
"
)
;
this
.
_detailsPane
=
(
"
#
details
-
pane
"
)
;
this
.
_detailsPaneToggleButton
=
(
"
#
details
-
pane
-
toggle
"
)
;
this
.
_collapsePaneString
=
L10N
.
getStr
(
"
collapseDetailsPane
"
)
;
this
.
_expandPaneString
=
L10N
.
getStr
(
"
expandDetailsPane
"
)
;
this
.
_detailsPane
.
setAttribute
(
"
width
"
Prefs
.
networkDetailsWidth
)
;
this
.
_detailsPane
.
setAttribute
(
"
height
"
Prefs
.
networkDetailsHeight
)
;
this
.
toggleDetailsPane
(
{
visible
:
false
}
)
;
if
(
!
Prefs
.
statistics
)
{
(
"
#
request
-
menu
-
context
-
perf
"
)
.
hidden
=
true
;
(
"
#
notice
-
perf
-
message
"
)
.
hidden
=
true
;
(
"
#
requests
-
menu
-
network
-
summary
-
button
"
)
.
hidden
=
true
;
}
}
_destroyPanes
:
Task
.
async
(
function
*
(
)
{
dumpn
(
"
Destroying
the
NetMonitorView
panes
"
)
;
Prefs
.
networkDetailsWidth
=
this
.
_detailsPane
.
getAttribute
(
"
width
"
)
;
Prefs
.
networkDetailsHeight
=
this
.
_detailsPane
.
getAttribute
(
"
height
"
)
;
this
.
_detailsPane
=
null
;
this
.
_detailsPaneToggleButton
=
null
;
for
(
let
p
of
this
.
_editorPromises
.
values
(
)
)
{
let
editor
=
yield
p
;
editor
.
destroy
(
)
;
}
}
)
get
detailsPaneHidden
(
)
{
return
this
.
_detailsPane
.
classList
.
contains
(
"
pane
-
collapsed
"
)
;
}
toggleDetailsPane
:
function
(
flags
tabIndex
)
{
let
pane
=
this
.
_detailsPane
;
let
button
=
this
.
_detailsPaneToggleButton
;
ViewHelpers
.
togglePane
(
flags
pane
)
;
if
(
flags
.
visible
)
{
this
.
_body
.
classList
.
remove
(
"
pane
-
collapsed
"
)
;
button
.
classList
.
remove
(
"
pane
-
collapsed
"
)
;
button
.
setAttribute
(
"
tooltiptext
"
this
.
_collapsePaneString
)
;
}
else
{
this
.
_body
.
classList
.
add
(
"
pane
-
collapsed
"
)
;
button
.
classList
.
add
(
"
pane
-
collapsed
"
)
;
button
.
setAttribute
(
"
tooltiptext
"
this
.
_expandPaneString
)
;
}
if
(
tabIndex
!
=
=
undefined
)
{
(
"
#
event
-
details
-
pane
"
)
.
selectedIndex
=
tabIndex
;
}
}
get
currentFrontendMode
(
)
{
if
(
!
this
.
_body
.
selectedPanel
)
{
return
null
;
}
return
this
.
_body
.
selectedPanel
.
id
;
}
toggleFrontendMode
:
function
(
)
{
if
(
this
.
currentFrontendMode
!
=
"
network
-
inspector
-
view
"
)
{
this
.
showNetworkInspectorView
(
)
;
}
else
{
this
.
showNetworkStatisticsView
(
)
;
}
}
showNetworkInspectorView
:
function
(
)
{
this
.
_body
.
selectedPanel
=
(
"
#
network
-
inspector
-
view
"
)
;
this
.
RequestsMenu
.
_flushWaterfallViews
(
true
)
;
}
showNetworkStatisticsView
:
function
(
)
{
this
.
_body
.
selectedPanel
=
(
"
#
network
-
statistics
-
view
"
)
;
let
controller
=
NetMonitorController
;
let
requestsView
=
this
.
RequestsMenu
;
let
statisticsView
=
this
.
PerformanceStatistics
;
Task
.
spawn
(
function
*
(
)
{
statisticsView
.
displayPlaceholderCharts
(
)
;
yield
controller
.
triggerActivity
(
ACTIVITY_TYPE
.
RELOAD
.
WITH_CACHE_ENABLED
)
;
try
{
yield
whenDataAvailable
(
requestsView
.
attachments
[
"
responseHeaders
"
"
status
"
"
contentSize
"
"
mimeType
"
"
totalTime
"
]
)
;
}
catch
(
ex
)
{
console
.
error
(
ex
)
;
}
statisticsView
.
createPrimedCacheChart
(
requestsView
.
items
)
;
statisticsView
.
createEmptyCacheChart
(
requestsView
.
items
)
;
}
)
;
}
reloadPage
:
function
(
)
{
NetMonitorController
.
triggerActivity
(
ACTIVITY_TYPE
.
RELOAD
.
WITH_CACHE_DEFAULT
)
;
}
editor
:
function
(
id
)
{
dumpn
(
"
Getting
a
NetMonitorView
editor
:
"
+
id
)
;
if
(
this
.
_editorPromises
.
has
(
id
)
)
{
return
this
.
_editorPromises
.
get
(
id
)
;
}
let
deferred
=
promise
.
defer
(
)
;
this
.
_editorPromises
.
set
(
id
deferred
.
promise
)
;
let
editor
=
new
Editor
(
DEFAULT_EDITOR_CONFIG
)
;
editor
.
appendTo
(
(
id
)
)
.
then
(
(
)
=
>
deferred
.
resolve
(
editor
)
)
;
return
deferred
.
promise
;
}
_body
:
null
_detailsPane
:
null
_detailsPaneToggleButton
:
null
_collapsePaneString
:
"
"
_expandPaneString
:
"
"
_editorPromises
:
new
Map
(
)
}
;
function
SidebarView
(
)
{
dumpn
(
"
SidebarView
was
instantiated
"
)
;
}
SidebarView
.
prototype
=
{
toggle
:
function
(
visibleFlag
)
{
NetMonitorView
.
toggleDetailsPane
(
{
visible
:
visibleFlag
}
)
;
NetMonitorView
.
RequestsMenu
.
_flushWaterfallViews
(
true
)
;
}
populate
:
Task
.
async
(
function
*
(
data
)
{
let
isCustom
=
data
.
isCustom
;
let
view
=
isCustom
?
NetMonitorView
.
CustomRequest
:
NetMonitorView
.
NetworkDetails
;
yield
view
.
populate
(
data
)
;
(
"
#
details
-
pane
"
)
.
selectedIndex
=
isCustom
?
0
:
1
;
window
.
emit
(
EVENTS
.
SIDEBAR_POPULATED
)
;
}
)
}
;
function
NetworkDetailsView
(
)
{
dumpn
(
"
NetworkDetailsView
was
instantiated
"
)
;
EventEmitter
.
decorate
(
this
)
;
this
.
_onTabSelect
=
this
.
_onTabSelect
.
bind
(
this
)
;
}
NetworkDetailsView
.
prototype
=
{
_viewState
:
{
updating
:
[
]
dirty
:
[
]
latestData
:
null
}
initialize
:
function
(
)
{
dumpn
(
"
Initializing
the
NetworkDetailsView
"
)
;
this
.
widget
=
(
"
#
event
-
details
-
pane
"
)
;
this
.
sidebar
=
new
ToolSidebar
(
this
.
widget
this
"
netmonitor
"
{
disableTelemetry
:
true
showAllTabsMenu
:
true
}
)
;
this
.
_headers
=
new
VariablesView
(
(
"
#
all
-
headers
"
)
Heritage
.
extend
(
GENERIC_VARIABLES_VIEW_SETTINGS
{
emptyText
:
L10N
.
getStr
(
"
headersEmptyText
"
)
searchPlaceholder
:
L10N
.
getStr
(
"
headersFilterText
"
)
}
)
)
;
this
.
_cookies
=
new
VariablesView
(
(
"
#
all
-
cookies
"
)
Heritage
.
extend
(
GENERIC_VARIABLES_VIEW_SETTINGS
{
emptyText
:
L10N
.
getStr
(
"
cookiesEmptyText
"
)
searchPlaceholder
:
L10N
.
getStr
(
"
cookiesFilterText
"
)
}
)
)
;
this
.
_params
=
new
VariablesView
(
(
"
#
request
-
params
"
)
Heritage
.
extend
(
GENERIC_VARIABLES_VIEW_SETTINGS
{
emptyText
:
L10N
.
getStr
(
"
paramsEmptyText
"
)
searchPlaceholder
:
L10N
.
getStr
(
"
paramsFilterText
"
)
}
)
)
;
this
.
_json
=
new
VariablesView
(
(
"
#
response
-
content
-
json
"
)
Heritage
.
extend
(
GENERIC_VARIABLES_VIEW_SETTINGS
{
onlyEnumVisible
:
true
searchPlaceholder
:
L10N
.
getStr
(
"
jsonFilterText
"
)
}
)
)
;
VariablesViewController
.
attach
(
this
.
_json
)
;
this
.
_paramsQueryString
=
L10N
.
getStr
(
"
paramsQueryString
"
)
;
this
.
_paramsFormData
=
L10N
.
getStr
(
"
paramsFormData
"
)
;
this
.
_paramsPostPayload
=
L10N
.
getStr
(
"
paramsPostPayload
"
)
;
this
.
_requestHeaders
=
L10N
.
getStr
(
"
requestHeaders
"
)
;
this
.
_requestHeadersFromUpload
=
L10N
.
getStr
(
"
requestHeadersFromUpload
"
)
;
this
.
_responseHeaders
=
L10N
.
getStr
(
"
responseHeaders
"
)
;
this
.
_requestCookies
=
L10N
.
getStr
(
"
requestCookies
"
)
;
this
.
_responseCookies
=
L10N
.
getStr
(
"
responseCookies
"
)
;
(
"
tabpanels
"
this
.
widget
)
.
addEventListener
(
"
select
"
this
.
_onTabSelect
)
;
}
destroy
:
function
(
)
{
dumpn
(
"
Destroying
the
NetworkDetailsView
"
)
;
this
.
sidebar
.
destroy
(
)
;
(
"
tabpanels
"
this
.
widget
)
.
removeEventListener
(
"
select
"
this
.
_onTabSelect
)
;
}
populate
:
function
(
data
)
{
(
"
#
request
-
params
-
box
"
)
.
setAttribute
(
"
flex
"
"
1
"
)
;
(
"
#
request
-
params
-
box
"
)
.
hidden
=
false
;
(
"
#
request
-
post
-
data
-
textarea
-
box
"
)
.
hidden
=
true
;
(
"
#
response
-
content
-
info
-
header
"
)
.
hidden
=
true
;
(
"
#
response
-
content
-
json
-
box
"
)
.
hidden
=
true
;
(
"
#
response
-
content
-
textarea
-
box
"
)
.
hidden
=
true
;
(
"
#
raw
-
headers
"
)
.
hidden
=
true
;
(
"
#
response
-
content
-
image
-
box
"
)
.
hidden
=
true
;
let
isHtml
=
Filters
.
html
(
data
)
;
this
.
sidebar
.
toggleTab
(
isHtml
"
preview
-
tab
"
)
;
let
hasSecurityInfo
=
data
.
securityState
&
&
data
.
securityState
!
=
=
"
insecure
"
;
this
.
sidebar
.
toggleTab
(
hasSecurityInfo
"
security
-
tab
"
)
;
if
(
!
isHtml
&
&
this
.
widget
.
selectedPanel
=
=
=
(
"
#
preview
-
tabpanel
"
)
|
|
!
hasSecurityInfo
&
&
this
.
widget
.
selectedPanel
=
=
=
(
"
#
security
-
tabpanel
"
)
)
{
this
.
widget
.
selectedIndex
=
0
;
}
this
.
_headers
.
empty
(
)
;
this
.
_cookies
.
empty
(
)
;
this
.
_params
.
empty
(
)
;
this
.
_json
.
empty
(
)
;
this
.
_dataSrc
=
{
src
:
data
populated
:
[
]
}
;
this
.
_onTabSelect
(
)
;
window
.
emit
(
EVENTS
.
NETWORKDETAILSVIEW_POPULATED
)
;
return
promise
.
resolve
(
)
;
}
_onTabSelect
:
function
(
)
{
let
{
src
populated
}
=
this
.
_dataSrc
|
|
{
}
;
let
tab
=
this
.
widget
.
selectedIndex
;
let
view
=
this
;
if
(
!
src
|
|
populated
[
tab
]
)
{
return
;
}
let
viewState
=
this
.
_viewState
;
if
(
viewState
.
updating
[
tab
]
)
{
viewState
.
dirty
[
tab
]
=
true
;
viewState
.
latestData
=
src
;
return
;
}
Task
.
spawn
(
function
*
(
)
{
viewState
.
updating
[
tab
]
=
true
;
switch
(
tab
)
{
case
0
:
yield
view
.
_setSummary
(
src
)
;
yield
view
.
_setResponseHeaders
(
src
.
responseHeaders
)
;
yield
view
.
_setRequestHeaders
(
src
.
requestHeaders
src
.
requestHeadersFromUploadStream
)
;
break
;
case
1
:
yield
view
.
_setResponseCookies
(
src
.
responseCookies
)
;
yield
view
.
_setRequestCookies
(
src
.
requestCookies
)
;
break
;
case
2
:
yield
view
.
_setRequestGetParams
(
src
.
url
)
;
yield
view
.
_setRequestPostParams
(
src
.
requestHeaders
src
.
requestHeadersFromUploadStream
src
.
requestPostData
)
;
break
;
case
3
:
yield
view
.
_setResponseBody
(
src
.
url
src
.
responseContent
)
;
break
;
case
4
:
yield
view
.
_setTimingsInformation
(
src
.
eventTimings
)
;
break
;
case
5
:
yield
view
.
_setSecurityInfo
(
src
.
securityInfo
src
.
url
)
;
break
;
case
6
:
yield
view
.
_setHtmlPreview
(
src
.
responseContent
)
;
break
;
}
viewState
.
updating
[
tab
]
=
false
;
}
)
.
then
(
(
)
=
>
{
if
(
tab
=
=
this
.
widget
.
selectedIndex
)
{
if
(
viewState
.
dirty
[
tab
]
)
{
viewState
.
dirty
[
tab
]
=
false
;
view
.
populate
(
viewState
.
latestData
)
;
}
else
{
populated
[
tab
]
=
true
;
window
.
emit
(
EVENTS
.
TAB_UPDATED
)
;
if
(
NetMonitorController
.
isConnected
(
)
)
{
NetMonitorView
.
RequestsMenu
.
ensureSelectedItemIsVisible
(
)
;
}
}
}
else
if
(
viewState
.
dirty
[
tab
]
)
{
viewState
.
dirty
[
tab
]
=
false
;
}
}
e
=
>
console
.
error
(
e
)
)
;
}
_setSummary
:
function
(
data
)
{
if
(
data
.
url
)
{
let
unicodeUrl
=
NetworkHelper
.
convertToUnicode
(
unescape
(
data
.
url
)
)
;
(
"
#
headers
-
summary
-
url
-
value
"
)
.
setAttribute
(
"
value
"
unicodeUrl
)
;
(
"
#
headers
-
summary
-
url
-
value
"
)
.
setAttribute
(
"
tooltiptext
"
unicodeUrl
)
;
(
"
#
headers
-
summary
-
url
"
)
.
removeAttribute
(
"
hidden
"
)
;
}
else
{
(
"
#
headers
-
summary
-
url
"
)
.
setAttribute
(
"
hidden
"
"
true
"
)
;
}
if
(
data
.
method
)
{
(
"
#
headers
-
summary
-
method
-
value
"
)
.
setAttribute
(
"
value
"
data
.
method
)
;
(
"
#
headers
-
summary
-
method
"
)
.
removeAttribute
(
"
hidden
"
)
;
}
else
{
(
"
#
headers
-
summary
-
method
"
)
.
setAttribute
(
"
hidden
"
"
true
"
)
;
}
if
(
data
.
remoteAddress
)
{
let
address
=
data
.
remoteAddress
;
if
(
address
.
indexOf
(
"
:
"
)
!
=
-
1
)
{
address
=
[
{
address
}
]
;
}
if
(
data
.
remotePort
)
{
address
+
=
:
{
data
.
remotePort
}
;
}
(
"
#
headers
-
summary
-
address
-
value
"
)
.
setAttribute
(
"
value
"
address
)
;
(
"
#
headers
-
summary
-
address
-
value
"
)
.
setAttribute
(
"
tooltiptext
"
address
)
;
(
"
#
headers
-
summary
-
address
"
)
.
removeAttribute
(
"
hidden
"
)
;
}
else
{
(
"
#
headers
-
summary
-
address
"
)
.
setAttribute
(
"
hidden
"
"
true
"
)
;
}
if
(
data
.
status
)
{
let
code
;
if
(
data
.
fromCache
)
{
code
=
"
cached
"
;
}
else
if
(
data
.
fromServiceWorker
)
{
code
=
"
service
worker
"
;
}
else
{
code
=
data
.
status
;
}
(
"
#
headers
-
summary
-
status
-
circle
"
)
.
setAttribute
(
"
code
"
code
)
;
(
"
#
headers
-
summary
-
status
-
value
"
)
.
setAttribute
(
"
value
"
data
.
status
+
"
"
+
data
.
statusText
)
;
(
"
#
headers
-
summary
-
status
"
)
.
removeAttribute
(
"
hidden
"
)
;
}
else
{
(
"
#
headers
-
summary
-
status
"
)
.
setAttribute
(
"
hidden
"
"
true
"
)
;
}
if
(
data
.
httpVersion
)
{
(
"
#
headers
-
summary
-
version
-
value
"
)
.
setAttribute
(
"
value
"
data
.
httpVersion
)
;
(
"
#
headers
-
summary
-
version
"
)
.
removeAttribute
(
"
hidden
"
)
;
}
else
{
(
"
#
headers
-
summary
-
version
"
)
.
setAttribute
(
"
hidden
"
"
true
"
)
;
}
}
_setRequestHeaders
:
Task
.
async
(
function
*
(
headers
uploadHeaders
)
{
if
(
headers
&
&
headers
.
headers
.
length
)
{
yield
this
.
_addHeaders
(
this
.
_requestHeaders
headers
)
;
}
if
(
uploadHeaders
&
&
uploadHeaders
.
headers
.
length
)
{
yield
this
.
_addHeaders
(
this
.
_requestHeadersFromUpload
uploadHeaders
)
;
}
}
)
_setResponseHeaders
:
Task
.
async
(
function
*
(
response
)
{
if
(
response
&
&
response
.
headers
.
length
)
{
response
.
headers
.
sort
(
(
a
b
)
=
>
a
.
name
>
b
.
name
)
;
yield
this
.
_addHeaders
(
this
.
_responseHeaders
response
)
;
}
}
)
_addHeaders
:
Task
.
async
(
function
*
(
name
response
)
{
let
kb
=
response
.
headersSize
/
1024
;
let
size
=
L10N
.
numberWithDecimals
(
kb
HEADERS_SIZE_DECIMALS
)
;
let
text
=
L10N
.
getFormatStr
(
"
networkMenu
.
sizeKB
"
size
)
;
let
headersScope
=
this
.
_headers
.
addScope
(
name
+
"
(
"
+
text
+
"
)
"
)
;
headersScope
.
expanded
=
true
;
for
(
let
header
of
response
.
headers
)
{
let
headerVar
=
headersScope
.
addItem
(
header
.
name
{
}
{
relaxed
:
true
}
)
;
let
headerValue
=
yield
gNetwork
.
getString
(
header
.
value
)
;
headerVar
.
setGrip
(
headerValue
)
;
}
}
)
_setRequestCookies
:
Task
.
async
(
function
*
(
response
)
{
if
(
response
&
&
response
.
cookies
.
length
)
{
response
.
cookies
.
sort
(
(
a
b
)
=
>
a
.
name
>
b
.
name
)
;
yield
this
.
_addCookies
(
this
.
_requestCookies
response
)
;
}
}
)
_setResponseCookies
:
Task
.
async
(
function
*
(
response
)
{
if
(
response
&
&
response
.
cookies
.
length
)
{
yield
this
.
_addCookies
(
this
.
_responseCookies
response
)
;
}
}
)
_addCookies
:
Task
.
async
(
function
*
(
name
response
)
{
let
cookiesScope
=
this
.
_cookies
.
addScope
(
name
)
;
cookiesScope
.
expanded
=
true
;
for
(
let
cookie
of
response
.
cookies
)
{
let
cookieVar
=
cookiesScope
.
addItem
(
cookie
.
name
{
}
{
relaxed
:
true
}
)
;
let
cookieValue
=
yield
gNetwork
.
getString
(
cookie
.
value
)
;
cookieVar
.
setGrip
(
cookieValue
)
;
let
cookieProps
=
Object
.
keys
(
cookie
)
;
if
(
cookieProps
.
length
=
=
2
)
{
continue
;
}
let
rawObject
=
Object
.
create
(
null
)
;
let
otherProps
=
cookieProps
.
filter
(
e
=
>
e
!
=
"
name
"
&
&
e
!
=
"
value
"
)
;
for
(
let
prop
of
otherProps
)
{
rawObject
[
prop
]
=
cookie
[
prop
]
;
}
cookieVar
.
populate
(
rawObject
)
;
cookieVar
.
twisty
=
true
;
cookieVar
.
expanded
=
true
;
}
}
)
_setRequestGetParams
:
function
(
url
)
{
let
query
=
NetworkHelper
.
nsIURL
(
url
)
.
query
;
if
(
query
)
{
this
.
_addParams
(
this
.
_paramsQueryString
query
)
;
}
}
_setRequestPostParams
:
Task
.
async
(
function
*
(
headers
uploadHeaders
postData
)
{
if
(
!
headers
|
|
!
uploadHeaders
|
|
!
postData
)
{
return
;
}
let
formDataSections
=
yield
getFormDataSections
(
headers
uploadHeaders
postData
gNetwork
.
getString
.
bind
(
gNetwork
)
)
;
this
.
_params
.
onlyEnumVisible
=
false
;
if
(
formDataSections
.
length
>
0
)
{
formDataSections
.
forEach
(
section
=
>
{
this
.
_addParams
(
this
.
_paramsFormData
section
)
;
}
)
;
}
else
{
let
postDataLongString
=
postData
.
postData
.
text
;
let
text
=
yield
gNetwork
.
getString
(
postDataLongString
)
;
let
jsonVal
=
null
;
try
{
jsonVal
=
JSON
.
parse
(
text
)
;
}
catch
(
ex
)
{
}
if
(
jsonVal
)
{
this
.
_params
.
onlyEnumVisible
=
true
;
let
jsonScopeName
=
L10N
.
getStr
(
"
jsonScopeName
"
)
;
let
jsonScope
=
this
.
_params
.
addScope
(
jsonScopeName
)
;
jsonScope
.
expanded
=
true
;
let
jsonItem
=
jsonScope
.
addItem
(
"
"
{
enumerable
:
true
}
)
;
jsonItem
.
populate
(
jsonVal
{
sorted
:
true
}
)
;
}
else
{
(
"
#
request
-
params
-
box
"
)
.
removeAttribute
(
"
flex
"
)
;
let
paramsScope
=
this
.
_params
.
addScope
(
this
.
_paramsPostPayload
)
;
paramsScope
.
expanded
=
true
;
paramsScope
.
locked
=
true
;
(
"
#
request
-
post
-
data
-
textarea
-
box
"
)
.
hidden
=
false
;
let
editor
=
yield
NetMonitorView
.
editor
(
"
#
request
-
post
-
data
-
textarea
"
)
;
editor
.
setMode
(
Editor
.
modes
.
text
)
;
editor
.
setText
(
text
)
;
}
}
window
.
emit
(
EVENTS
.
REQUEST_POST_PARAMS_DISPLAYED
)
;
}
)
_addParams
:
function
(
name
queryString
)
{
let
paramsArray
=
NetworkHelper
.
parseQueryString
(
queryString
)
;
if
(
!
paramsArray
)
{
return
;
}
let
paramsScope
=
this
.
_params
.
addScope
(
name
)
;
paramsScope
.
expanded
=
true
;
for
(
let
param
of
paramsArray
)
{
let
paramVar
=
paramsScope
.
addItem
(
param
.
name
{
}
{
relaxed
:
true
}
)
;
paramVar
.
setGrip
(
param
.
value
)
;
}
}
_setResponseBody
:
Task
.
async
(
function
*
(
url
response
)
{
if
(
!
response
)
{
return
;
}
let
{
mimeType
text
encoding
}
=
response
.
content
;
let
responseBody
=
yield
gNetwork
.
getString
(
text
)
;
let
jsonMimeType
jsonObject
jsonObjectParseError
;
try
{
jsonMimeType
=
/
\
bjson
/
.
test
(
mimeType
)
;
jsonObject
=
JSON
.
parse
(
responseBody
)
;
}
catch
(
e
)
{
jsonObjectParseError
=
e
;
}
if
(
jsonMimeType
|
|
jsonObject
)
{
let
jsonpRegex
=
/
^
\
s
*
(
[
\
w
]
+
)
\
s
*
\
(
\
s
*
(
[
^
]
*
)
\
s
*
\
)
\
s
*
;
?
\
s
*
/
;
let
[
_
callbackPadding
jsonpString
]
=
responseBody
.
match
(
jsonpRegex
)
|
|
[
]
;
if
(
callbackPadding
&
&
jsonpString
)
{
try
{
jsonObject
=
JSON
.
parse
(
jsonpString
)
;
}
catch
(
e
)
{
jsonObjectParseError
=
e
;
}
}
if
(
jsonObject
)
{
(
"
#
response
-
content
-
json
-
box
"
)
.
hidden
=
false
;
let
jsonScopeName
=
callbackPadding
?
L10N
.
getFormatStr
(
"
jsonpScopeName
"
callbackPadding
)
:
L10N
.
getStr
(
"
jsonScopeName
"
)
;
let
jsonVar
=
{
label
:
jsonScopeName
rawObject
:
jsonObject
}
;
yield
this
.
_json
.
controller
.
setSingleVariable
(
jsonVar
)
.
expanded
;
}
else
{
(
"
#
response
-
content
-
textarea
-
box
"
)
.
hidden
=
false
;
let
infoHeader
=
(
"
#
response
-
content
-
info
-
header
"
)
;
infoHeader
.
setAttribute
(
"
value
"
jsonObjectParseError
)
;
infoHeader
.
setAttribute
(
"
tooltiptext
"
jsonObjectParseError
)
;
infoHeader
.
hidden
=
false
;
let
editor
=
yield
NetMonitorView
.
editor
(
"
#
response
-
content
-
textarea
"
)
;
editor
.
setMode
(
Editor
.
modes
.
js
)
;
editor
.
setText
(
responseBody
)
;
}
}
else
if
(
mimeType
.
includes
(
"
image
/
"
)
)
{
(
"
#
response
-
content
-
image
-
box
"
)
.
setAttribute
(
"
align
"
"
center
"
)
;
(
"
#
response
-
content
-
image
-
box
"
)
.
setAttribute
(
"
pack
"
"
center
"
)
;
(
"
#
response
-
content
-
image
-
box
"
)
.
hidden
=
false
;
(
"
#
response
-
content
-
image
"
)
.
src
=
formDataURI
(
mimeType
encoding
responseBody
)
;
(
"
#
response
-
content
-
image
-
name
-
value
"
)
.
setAttribute
(
"
value
"
NetworkHelper
.
nsIURL
(
url
)
.
fileName
)
;
(
"
#
response
-
content
-
image
-
mime
-
value
"
)
.
setAttribute
(
"
value
"
mimeType
)
;
(
"
#
response
-
content
-
image
"
)
.
onload
=
e
=
>
{
let
{
width
height
}
=
e
.
target
.
getBoundingClientRect
(
)
;
let
dimensions
=
(
width
-
2
)
+
"
\
u00D7
"
+
(
height
-
2
)
;
(
"
#
response
-
content
-
image
-
dimensions
-
value
"
)
.
setAttribute
(
"
value
"
dimensions
)
;
}
;
}
else
{
(
"
#
response
-
content
-
textarea
-
box
"
)
.
hidden
=
false
;
let
editor
=
yield
NetMonitorView
.
editor
(
"
#
response
-
content
-
textarea
"
)
;
editor
.
setMode
(
Editor
.
modes
.
text
)
;
editor
.
setText
(
responseBody
)
;
if
(
responseBody
.
length
<
SOURCE_SYNTAX_HIGHLIGHT_MAX_FILE_SIZE
)
{
let
mapping
=
Object
.
keys
(
CONTENT_MIME_TYPE_MAPPINGS
)
.
find
(
key
=
>
{
return
mimeType
.
includes
(
key
)
;
}
)
;
if
(
mapping
)
{
editor
.
setMode
(
CONTENT_MIME_TYPE_MAPPINGS
[
mapping
]
)
;
}
}
}
window
.
emit
(
EVENTS
.
RESPONSE_BODY_DISPLAYED
)
;
}
)
_setTimingsInformation
:
function
(
response
)
{
if
(
!
response
)
{
return
;
}
let
{
blocked
dns
connect
send
wait
receive
}
=
response
.
timings
;
let
tabboxWidth
=
(
"
#
details
-
pane
"
)
.
getAttribute
(
"
width
"
)
;
let
availableWidth
=
tabboxWidth
/
2
;
let
scale
=
(
response
.
totalTime
>
0
?
Math
.
max
(
availableWidth
/
response
.
totalTime
0
)
:
0
)
;
(
"
#
timings
-
summary
-
blocked
.
requests
-
menu
-
timings
-
box
"
)
.
setAttribute
(
"
width
"
blocked
*
scale
)
;
(
"
#
timings
-
summary
-
blocked
.
requests
-
menu
-
timings
-
total
"
)
.
setAttribute
(
"
value
"
L10N
.
getFormatStr
(
"
networkMenu
.
totalMS
"
blocked
)
)
;
(
"
#
timings
-
summary
-
dns
.
requests
-
menu
-
timings
-
box
"
)
.
setAttribute
(
"
width
"
dns
*
scale
)
;
(
"
#
timings
-
summary
-
dns
.
requests
-
menu
-
timings
-
total
"
)
.
setAttribute
(
"
value
"
L10N
.
getFormatStr
(
"
networkMenu
.
totalMS
"
dns
)
)
;
(
"
#
timings
-
summary
-
connect
.
requests
-
menu
-
timings
-
box
"
)
.
setAttribute
(
"
width
"
connect
*
scale
)
;
(
"
#
timings
-
summary
-
connect
.
requests
-
menu
-
timings
-
total
"
)
.
setAttribute
(
"
value
"
L10N
.
getFormatStr
(
"
networkMenu
.
totalMS
"
connect
)
)
;
(
"
#
timings
-
summary
-
send
.
requests
-
menu
-
timings
-
box
"
)
.
setAttribute
(
"
width
"
send
*
scale
)
;
(
"
#
timings
-
summary
-
send
.
requests
-
menu
-
timings
-
total
"
)
.
setAttribute
(
"
value
"
L10N
.
getFormatStr
(
"
networkMenu
.
totalMS
"
send
)
)
;
(
"
#
timings
-
summary
-
wait
.
requests
-
menu
-
timings
-
box
"
)
.
setAttribute
(
"
width
"
wait
*
scale
)
;
(
"
#
timings
-
summary
-
wait
.
requests
-
menu
-
timings
-
total
"
)
.
setAttribute
(
"
value
"
L10N
.
getFormatStr
(
"
networkMenu
.
totalMS
"
wait
)
)
;
(
"
#
timings
-
summary
-
receive
.
requests
-
menu
-
timings
-
box
"
)
.
setAttribute
(
"
width
"
receive
*
scale
)
;
(
"
#
timings
-
summary
-
receive
.
requests
-
menu
-
timings
-
total
"
)
.
setAttribute
(
"
value
"
L10N
.
getFormatStr
(
"
networkMenu
.
totalMS
"
receive
)
)
;
(
"
#
timings
-
summary
-
dns
.
requests
-
menu
-
timings
-
box
"
)
.
style
.
transform
=
"
translateX
(
"
+
(
scale
*
blocked
)
+
"
px
)
"
;
(
"
#
timings
-
summary
-
connect
.
requests
-
menu
-
timings
-
box
"
)
.
style
.
transform
=
"
translateX
(
"
+
(
scale
*
(
blocked
+
dns
)
)
+
"
px
)
"
;
(
"
#
timings
-
summary
-
send
.
requests
-
menu
-
timings
-
box
"
)
.
style
.
transform
=
"
translateX
(
"
+
(
scale
*
(
blocked
+
dns
+
connect
)
)
+
"
px
)
"
;
(
"
#
timings
-
summary
-
wait
.
requests
-
menu
-
timings
-
box
"
)
.
style
.
transform
=
"
translateX
(
"
+
(
scale
*
(
blocked
+
dns
+
connect
+
send
)
)
+
"
px
)
"
;
(
"
#
timings
-
summary
-
receive
.
requests
-
menu
-
timings
-
box
"
)
.
style
.
transform
=
"
translateX
(
"
+
(
scale
*
(
blocked
+
dns
+
connect
+
send
+
wait
)
)
+
"
px
)
"
;
(
"
#
timings
-
summary
-
dns
.
requests
-
menu
-
timings
-
total
"
)
.
style
.
transform
=
"
translateX
(
"
+
(
scale
*
blocked
)
+
"
px
)
"
;
(
"
#
timings
-
summary
-
connect
.
requests
-
menu
-
timings
-
total
"
)
.
style
.
transform
=
"
translateX
(
"
+
(
scale
*
(
blocked
+
dns
)
)
+
"
px
)
"
;
(
"
#
timings
-
summary
-
send
.
requests
-
menu
-
timings
-
total
"
)
.
style
.
transform
=
"
translateX
(
"
+
(
scale
*
(
blocked
+
dns
+
connect
)
)
+
"
px
)
"
;
(
"
#
timings
-
summary
-
wait
.
requests
-
menu
-
timings
-
total
"
)
.
style
.
transform
=
"
translateX
(
"
+
(
scale
*
(
blocked
+
dns
+
connect
+
send
)
)
+
"
px
)
"
;
(
"
#
timings
-
summary
-
receive
.
requests
-
menu
-
timings
-
total
"
)
.
style
.
transform
=
"
translateX
(
"
+
(
scale
*
(
blocked
+
dns
+
connect
+
send
+
wait
)
)
+
"
px
)
"
;
}
_setHtmlPreview
:
Task
.
async
(
function
*
(
response
)
{
if
(
!
response
)
{
return
promise
.
resolve
(
)
;
}
let
{
text
}
=
response
.
content
;
let
responseBody
=
yield
gNetwork
.
getString
(
text
)
;
let
iframe
=
(
"
#
response
-
preview
"
)
;
iframe
.
contentDocument
.
docShell
.
allowJavascript
=
false
;
iframe
.
contentDocument
.
documentElement
.
innerHTML
=
responseBody
;
window
.
emit
(
EVENTS
.
RESPONSE_HTML_PREVIEW_DISPLAYED
)
;
return
undefined
;
}
)
_setSecurityInfo
:
Task
.
async
(
function
*
(
securityInfo
url
)
{
if
(
!
securityInfo
)
{
return
;
}
function
setValue
(
selector
value
)
{
let
label
=
(
selector
)
;
if
(
!
value
)
{
label
.
setAttribute
(
"
value
"
L10N
.
getStr
(
"
netmonitor
.
security
.
notAvailable
"
)
)
;
label
.
setAttribute
(
"
tooltiptext
"
label
.
getAttribute
(
"
value
"
)
)
;
}
else
{
label
.
setAttribute
(
"
value
"
value
)
;
label
.
setAttribute
(
"
tooltiptext
"
value
)
;
}
}
let
errorbox
=
(
"
#
security
-
error
"
)
;
let
infobox
=
(
"
#
security
-
information
"
)
;
if
(
securityInfo
.
state
=
=
=
"
secure
"
|
|
securityInfo
.
state
=
=
=
"
weak
"
)
{
infobox
.
hidden
=
false
;
errorbox
.
hidden
=
true
;
let
cipher
=
(
"
#
security
-
warning
-
cipher
"
)
;
if
(
securityInfo
.
state
=
=
=
"
weak
"
)
{
cipher
.
hidden
=
securityInfo
.
weaknessReasons
.
indexOf
(
"
cipher
"
)
=
=
=
-
1
;
}
else
{
cipher
.
hidden
=
true
;
}
let
enabledLabel
=
L10N
.
getStr
(
"
netmonitor
.
security
.
enabled
"
)
;
let
disabledLabel
=
L10N
.
getStr
(
"
netmonitor
.
security
.
disabled
"
)
;
setValue
(
"
#
security
-
protocol
-
version
-
value
"
securityInfo
.
protocolVersion
)
;
setValue
(
"
#
security
-
ciphersuite
-
value
"
securityInfo
.
cipherSuite
)
;
let
domain
=
getUriHostPort
(
url
)
;
let
hostHeader
=
L10N
.
getFormatStr
(
"
netmonitor
.
security
.
hostHeader
"
domain
)
;
setValue
(
"
#
security
-
info
-
host
-
header
"
hostHeader
)
;
setValue
(
"
#
security
-
http
-
strict
-
transport
-
security
-
value
"
securityInfo
.
hsts
?
enabledLabel
:
disabledLabel
)
;
setValue
(
"
#
security
-
public
-
key
-
pinning
-
value
"
securityInfo
.
hpkp
?
enabledLabel
:
disabledLabel
)
;
let
cert
=
securityInfo
.
cert
;
setValue
(
"
#
security
-
cert
-
subject
-
cn
"
cert
.
subject
.
commonName
)
;
setValue
(
"
#
security
-
cert
-
subject
-
o
"
cert
.
subject
.
organization
)
;
setValue
(
"
#
security
-
cert
-
subject
-
ou
"
cert
.
subject
.
organizationalUnit
)
;
setValue
(
"
#
security
-
cert
-
issuer
-
cn
"
cert
.
issuer
.
commonName
)
;
setValue
(
"
#
security
-
cert
-
issuer
-
o
"
cert
.
issuer
.
organization
)
;
setValue
(
"
#
security
-
cert
-
issuer
-
ou
"
cert
.
issuer
.
organizationalUnit
)
;
setValue
(
"
#
security
-
cert
-
validity
-
begins
"
cert
.
validity
.
start
)
;
setValue
(
"
#
security
-
cert
-
validity
-
expires
"
cert
.
validity
.
end
)
;
setValue
(
"
#
security
-
cert
-
sha1
-
fingerprint
"
cert
.
fingerprint
.
sha1
)
;
setValue
(
"
#
security
-
cert
-
sha256
-
fingerprint
"
cert
.
fingerprint
.
sha256
)
;
}
else
{
infobox
.
hidden
=
true
;
errorbox
.
hidden
=
false
;
let
plain
=
new
DOMParser
(
)
.
parseFromString
(
securityInfo
.
errorMessage
"
text
/
html
"
)
;
setValue
(
"
#
security
-
error
-
message
"
plain
.
body
.
textContent
)
;
}
}
)
_dataSrc
:
null
_headers
:
null
_cookies
:
null
_params
:
null
_json
:
null
_paramsQueryString
:
"
"
_paramsFormData
:
"
"
_paramsPostPayload
:
"
"
_requestHeaders
:
"
"
_responseHeaders
:
"
"
_requestCookies
:
"
"
_responseCookies
:
"
"
}
;
function
PerformanceStatisticsView
(
)
{
}
PerformanceStatisticsView
.
prototype
=
{
displayPlaceholderCharts
:
function
(
)
{
this
.
_createChart
(
{
id
:
"
#
primed
-
cache
-
chart
"
title
:
"
charts
.
cacheEnabled
"
}
)
;
this
.
_createChart
(
{
id
:
"
#
empty
-
cache
-
chart
"
title
:
"
charts
.
cacheDisabled
"
}
)
;
window
.
emit
(
EVENTS
.
PLACEHOLDER_CHARTS_DISPLAYED
)
;
}
createPrimedCacheChart
:
function
(
items
)
{
this
.
_createChart
(
{
id
:
"
#
primed
-
cache
-
chart
"
title
:
"
charts
.
cacheEnabled
"
data
:
this
.
_sanitizeChartDataSource
(
items
)
strings
:
this
.
_commonChartStrings
totals
:
this
.
_commonChartTotals
sorted
:
true
}
)
;
window
.
emit
(
EVENTS
.
PRIMED_CACHE_CHART_DISPLAYED
)
;
}
createEmptyCacheChart
:
function
(
items
)
{
this
.
_createChart
(
{
id
:
"
#
empty
-
cache
-
chart
"
title
:
"
charts
.
cacheDisabled
"
data
:
this
.
_sanitizeChartDataSource
(
items
true
)
strings
:
this
.
_commonChartStrings
totals
:
this
.
_commonChartTotals
sorted
:
true
}
)
;
window
.
emit
(
EVENTS
.
EMPTY_CACHE_CHART_DISPLAYED
)
;
}
_commonChartStrings
:
{
size
:
value
=
>
{
let
string
=
L10N
.
numberWithDecimals
(
value
/
1024
CONTENT_SIZE_DECIMALS
)
;
return
L10N
.
getFormatStr
(
"
charts
.
sizeKB
"
string
)
;
}
time
:
value
=
>
{
let
string
=
L10N
.
numberWithDecimals
(
value
/
1000
REQUEST_TIME_DECIMALS
)
;
return
L10N
.
getFormatStr
(
"
charts
.
totalS
"
string
)
;
}
}
_commonChartTotals
:
{
size
:
total
=
>
{
let
string
=
L10N
.
numberWithDecimals
(
total
/
1024
CONTENT_SIZE_DECIMALS
)
;
return
L10N
.
getFormatStr
(
"
charts
.
totalSize
"
string
)
;
}
time
:
total
=
>
{
let
seconds
=
total
/
1000
;
let
string
=
L10N
.
numberWithDecimals
(
seconds
REQUEST_TIME_DECIMALS
)
;
return
PluralForm
.
get
(
seconds
L10N
.
getStr
(
"
charts
.
totalSeconds
"
)
)
.
replace
(
"
#
1
"
string
)
;
}
cached
:
total
=
>
{
return
L10N
.
getFormatStr
(
"
charts
.
totalCached
"
total
)
;
}
count
:
total
=
>
{
return
L10N
.
getFormatStr
(
"
charts
.
totalCount
"
total
)
;
}
}
_createChart
:
function
(
{
id
title
data
strings
totals
sorted
}
)
{
let
container
=
(
id
)
;
while
(
container
.
hasChildNodes
(
)
)
{
container
.
firstChild
.
remove
(
)
;
}
let
chart
=
Chart
.
PieTable
(
document
{
diameter
:
NETWORK_ANALYSIS_PIE_CHART_DIAMETER
title
:
L10N
.
getStr
(
title
)
data
:
data
strings
:
strings
totals
:
totals
sorted
:
sorted
}
)
;
chart
.
on
(
"
click
"
(
_
item
)
=
>
{
gStore
.
dispatch
(
Actions
.
enableFilterOnly
(
item
.
label
)
)
;
NetMonitorView
.
showNetworkInspectorView
(
)
;
}
)
;
container
.
appendChild
(
chart
.
node
)
;
}
_sanitizeChartDataSource
:
function
(
items
emptyCache
)
{
let
data
=
[
"
html
"
"
css
"
"
js
"
"
xhr
"
"
fonts
"
"
images
"
"
media
"
"
flash
"
"
ws
"
"
other
"
]
.
map
(
e
=
>
(
{
cached
:
0
count
:
0
label
:
e
size
:
0
time
:
0
}
)
)
;
for
(
let
requestItem
of
items
)
{
let
details
=
requestItem
.
attachment
;
let
type
;
if
(
Filters
.
html
(
details
)
)
{
type
=
0
;
}
else
if
(
Filters
.
css
(
details
)
)
{
type
=
1
;
}
else
if
(
Filters
.
js
(
details
)
)
{
type
=
2
;
}
else
if
(
Filters
.
fonts
(
details
)
)
{
type
=
4
;
}
else
if
(
Filters
.
images
(
details
)
)
{
type
=
5
;
}
else
if
(
Filters
.
media
(
details
)
)
{
type
=
6
;
}
else
if
(
Filters
.
flash
(
details
)
)
{
type
=
7
;
}
else
if
(
Filters
.
ws
(
details
)
)
{
type
=
8
;
}
else
if
(
Filters
.
xhr
(
details
)
)
{
type
=
3
;
}
else
{
type
=
9
;
}
if
(
emptyCache
|
|
!
responseIsFresh
(
details
)
)
{
data
[
type
]
.
time
+
=
details
.
totalTime
|
|
0
;
data
[
type
]
.
size
+
=
details
.
contentSize
|
|
0
;
}
else
{
data
[
type
]
.
cached
+
+
;
}
data
[
type
]
.
count
+
+
;
}
return
data
.
filter
(
e
=
>
e
.
count
>
0
)
;
}
}
;
var
=
(
selector
target
=
document
)
=
>
target
.
querySelector
(
selector
)
;
var
all
=
(
selector
target
=
document
)
=
>
target
.
querySelectorAll
(
selector
)
;
function
responseIsFresh
(
{
responseHeaders
status
}
)
{
if
(
status
!
=
304
|
|
!
responseHeaders
)
{
return
false
;
}
let
list
=
responseHeaders
.
headers
;
let
cacheControl
=
list
.
filter
(
e
=
>
{
return
e
.
name
.
toLowerCase
(
)
=
=
"
cache
-
control
"
;
}
)
[
0
]
;
let
expires
=
list
.
filter
(
e
=
>
e
.
name
.
toLowerCase
(
)
=
=
"
expires
"
)
[
0
]
;
if
(
cacheControl
)
{
let
maxAgeMatch
=
cacheControl
.
value
.
match
(
/
s
-
maxage
\
s
*
=
\
s
*
(
\
d
+
)
/
)
|
|
cacheControl
.
value
.
match
(
/
max
-
age
\
s
*
=
\
s
*
(
\
d
+
)
/
)
;
if
(
maxAgeMatch
&
&
maxAgeMatch
.
pop
(
)
>
0
)
{
return
true
;
}
}
if
(
expires
&
&
Date
.
parse
(
expires
.
value
)
)
{
return
true
;
}
return
false
;
}
function
whenDataAvailable
(
dataStore
mandatoryFields
)
{
let
deferred
=
promise
.
defer
(
)
;
let
interval
=
setInterval
(
(
)
=
>
{
if
(
dataStore
.
every
(
item
=
>
{
return
mandatoryFields
.
every
(
field
=
>
field
in
item
)
;
}
)
)
{
clearInterval
(
interval
)
;
clearTimeout
(
timer
)
;
deferred
.
resolve
(
)
;
}
}
WDA_DEFAULT_VERIFY_INTERVAL
)
;
let
timer
=
setTimeout
(
(
)
=
>
{
clearInterval
(
interval
)
;
deferred
.
reject
(
new
Error
(
"
Timed
out
while
waiting
for
data
"
)
)
;
}
WDA_DEFAULT_GIVE_UP_TIMEOUT
)
;
return
deferred
.
promise
;
}
NetMonitorView
.
Toolbar
=
new
ToolbarView
(
)
;
NetMonitorView
.
RequestsMenu
=
new
RequestsMenuView
(
)
;
NetMonitorView
.
Sidebar
=
new
SidebarView
(
)
;
NetMonitorView
.
CustomRequest
=
new
CustomRequestView
(
)
;
NetMonitorView
.
NetworkDetails
=
new
NetworkDetailsView
(
)
;
NetMonitorView
.
PerformanceStatistics
=
new
PerformanceStatisticsView
(
)
;
