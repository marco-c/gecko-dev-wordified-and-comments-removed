import
{
clearDocuments
}
from
"
.
.
/
utils
/
editor
"
;
import
sourceQueue
from
"
.
.
/
utils
/
source
-
queue
"
;
import
{
getSources
}
from
"
.
.
/
reducers
/
sources
"
;
import
{
waitForMs
}
from
"
.
.
/
utils
/
utils
"
;
import
{
newSources
}
from
"
.
/
sources
"
;
import
{
updateWorkers
}
from
"
.
/
debuggee
"
;
import
{
clearASTs
clearSymbols
clearScopes
clearSources
}
from
"
.
.
/
workers
/
parser
"
;
import
{
clearWasmStates
}
from
"
.
.
/
utils
/
wasm
"
;
import
type
{
Action
ThunkArgs
}
from
"
.
/
types
"
;
export
function
willNavigate
(
event
:
Object
)
{
return
async
function
(
{
dispatch
getState
client
sourceMaps
}
:
ThunkArgs
)
{
await
sourceMaps
.
clearSourceMaps
(
)
;
clearWasmStates
(
)
;
clearDocuments
(
)
;
clearSymbols
(
)
;
clearASTs
(
)
;
clearScopes
(
)
;
clearSources
(
)
;
dispatch
(
navigate
(
event
.
url
)
)
;
}
;
}
export
function
navigate
(
url
:
string
)
:
Action
{
sourceQueue
.
clear
(
)
;
return
{
type
:
"
NAVIGATE
"
url
}
;
}
export
function
connect
(
url
:
string
canRewind
:
boolean
)
{
return
async
function
(
{
dispatch
}
:
ThunkArgs
)
{
await
dispatch
(
updateWorkers
(
)
)
;
dispatch
(
(
{
type
:
"
CONNECT
"
url
canRewind
}
:
Action
)
)
;
}
;
}
export
function
navigated
(
)
{
return
async
function
(
{
dispatch
getState
client
}
:
ThunkArgs
)
{
await
waitForMs
(
100
)
;
if
(
Object
.
keys
(
getSources
(
getState
(
)
)
)
.
length
=
=
0
)
{
const
sources
=
await
client
.
fetchSources
(
)
;
dispatch
(
newSources
(
sources
)
)
;
}
}
;
}
