export
const
Task
=
{
async
:
function
(
task
:
any
)
{
return
function
(
)
{
return
Task
.
spawn
(
task
this
arguments
)
;
}
;
}
spawn
:
function
(
task
:
any
scope
:
any
args
:
any
)
:
Promise
<
any
>
{
return
new
Promise
(
function
(
resolve
reject
)
{
const
iterator
=
task
.
apply
(
scope
args
)
;
const
callNext
=
lastValue
=
>
{
const
iteration
=
iterator
.
next
(
lastValue
)
;
Promise
.
resolve
(
iteration
.
value
)
.
then
(
value
=
>
{
if
(
iteration
.
done
)
{
resolve
(
value
)
;
}
else
{
callNext
(
value
)
;
}
}
)
.
catch
(
error
=
>
{
reject
(
error
)
;
iterator
.
throw
(
error
)
;
}
)
;
}
;
callNext
(
undefined
)
;
}
)
;
}
}
;
