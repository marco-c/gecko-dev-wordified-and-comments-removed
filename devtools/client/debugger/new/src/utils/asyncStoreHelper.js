import
{
asyncStorage
}
from
"
devtools
-
modules
"
;
export
function
asyncStoreHelper
(
root
:
string
mappings
:
Object
)
{
let
store
:
any
=
{
}
;
function
getMappingKey
(
key
)
{
return
Array
.
isArray
(
mappings
[
key
]
)
?
mappings
[
key
]
[
0
]
:
mappings
[
key
]
;
}
function
getMappingDefaultValue
(
key
)
{
return
Array
.
isArray
(
mappings
[
key
]
)
?
mappings
[
key
]
[
1
]
:
null
;
}
Object
.
keys
(
mappings
)
.
map
(
key
=
>
Object
.
defineProperty
(
store
key
{
async
get
(
)
{
const
value
=
await
asyncStorage
.
getItem
(
{
root
}
.
{
getMappingKey
(
key
)
}
)
;
return
value
|
|
getMappingDefaultValue
(
key
)
;
}
set
(
value
)
{
return
asyncStorage
.
setItem
(
{
root
}
.
{
getMappingKey
(
key
)
}
value
)
;
}
}
)
)
;
store
=
new
Proxy
(
store
{
set
:
function
(
target
property
value
receiver
)
{
if
(
!
mappings
.
hasOwnProperty
(
property
)
)
{
throw
new
Error
(
AsyncStore
:
{
property
}
is
not
defined
in
mappings
)
;
}
Reflect
.
set
(
.
.
.
arguments
)
;
return
true
;
}
}
)
;
return
(
store
:
{
[
Keys
<
typeof
mappings
>
]
:
any
}
)
;
}
