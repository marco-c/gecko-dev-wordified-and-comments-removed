function
networkRequest
(
url
opts
)
{
const
UNSUPPORTED_PROTOCOLS
=
[
"
chrome
:
/
/
"
"
resource
:
/
/
"
]
;
if
(
UNSUPPORTED_PROTOCOLS
.
some
(
protocol
=
>
url
.
startsWith
(
protocol
)
)
)
{
return
Promise
.
reject
(
unsupported
protocol
for
sourcemap
request
{
url
}
)
;
}
return
fetch
(
url
{
cache
:
opts
.
loadFromCache
?
"
default
"
:
"
no
-
cache
"
}
)
.
then
(
res
=
>
{
if
(
res
.
status
>
=
200
&
&
res
.
status
<
300
)
{
if
(
res
.
headers
.
get
(
"
Content
-
Type
"
)
=
=
=
"
application
/
wasm
"
)
{
return
res
.
arrayBuffer
(
)
.
then
(
buffer
=
>
(
{
content
:
buffer
isDwarf
:
true
}
)
)
;
}
return
res
.
text
(
)
.
then
(
text
=
>
(
{
content
:
text
}
)
)
;
}
return
Promise
.
reject
(
request
failed
with
status
{
res
.
status
}
)
;
}
)
;
}
module
.
exports
=
{
networkRequest
}
;
