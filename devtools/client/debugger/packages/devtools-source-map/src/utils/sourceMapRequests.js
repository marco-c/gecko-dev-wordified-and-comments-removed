const
{
generatedToOriginalId
}
=
require
(
"
.
"
)
;
const
sourceMapRequests
=
new
Map
(
)
;
function
clearSourceMaps
(
)
{
for
(
const
[
metadataPromise
]
of
sourceMapRequests
)
{
metadataPromise
.
then
(
metadata
=
>
{
if
(
metadata
)
{
metadata
.
map
.
destroy
(
)
;
}
}
(
)
=
>
{
}
)
;
}
sourceMapRequests
.
clear
(
)
;
}
function
getSourceMapWithMetadata
(
generatedSourceId
:
string
)
:
?
Promise
<
?
{
map
:
SourceMapConsumer
urlsById
:
Map
<
SourceId
url
>
sources
:
Array
<
{
id
:
SourceId
url
:
string
}
>
}
>
{
return
sourceMapRequests
.
get
(
generatedSourceId
)
;
}
function
getSourceMap
(
generatedSourceId
:
string
)
:
?
Promise
<
?
SourceMapConsumer
>
{
const
request
=
getSourceMapWithMetadata
(
generatedSourceId
)
;
if
(
!
request
)
{
return
null
;
}
return
request
.
then
(
result
=
>
(
result
?
result
.
map
:
null
)
)
;
}
function
setSourceMap
(
generatedId
:
string
request
)
{
sourceMapRequests
.
set
(
generatedId
request
.
then
(
map
=
>
{
if
(
!
map
|
|
!
map
.
sources
)
{
return
null
;
}
const
urlsById
=
new
Map
(
)
;
const
sources
=
[
]
;
for
(
const
url
of
map
.
sources
)
{
const
id
=
generatedToOriginalId
(
generatedId
url
)
;
urlsById
.
set
(
id
url
)
;
sources
.
push
(
{
id
url
}
)
;
}
return
{
map
urlsById
sources
}
;
}
)
)
;
}
module
.
exports
=
{
clearSourceMaps
getSourceMapWithMetadata
getSourceMap
setSourceMap
}
;
