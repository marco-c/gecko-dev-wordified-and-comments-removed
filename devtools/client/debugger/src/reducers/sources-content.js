import
{
pending
fulfilled
rejected
}
from
"
.
.
/
utils
/
async
-
value
"
;
export
function
initialSourcesContentState
(
)
{
return
{
mutableTextContentMap
:
new
Map
(
)
epoch
:
1
}
;
}
function
update
(
state
=
initialSourcesContentState
(
)
action
)
{
switch
(
action
.
type
)
{
case
"
LOAD_SOURCE_TEXT
"
:
return
updateSourceTextContent
(
state
action
)
;
case
"
NAVIGATE
"
:
return
{
.
.
.
initialSourcesContentState
(
)
epoch
:
state
.
epoch
+
1
}
;
}
return
state
;
}
function
updateSourceTextContent
(
state
action
)
{
if
(
action
.
epoch
!
=
=
state
.
epoch
)
{
return
state
;
}
let
content
;
if
(
action
.
status
=
=
=
"
start
"
)
{
content
=
pending
(
)
;
}
else
if
(
action
.
status
=
=
=
"
error
"
)
{
content
=
rejected
(
action
.
error
)
;
}
else
if
(
typeof
action
.
value
.
text
=
=
=
"
string
"
)
{
content
=
fulfilled
(
{
type
:
"
text
"
value
:
action
.
value
.
text
contentType
:
action
.
value
.
contentType
}
)
;
}
else
{
content
=
fulfilled
(
{
type
:
"
wasm
"
value
:
action
.
value
.
text
}
)
;
}
state
.
mutableTextContentMap
.
set
(
action
.
sourceId
content
)
;
return
{
.
.
.
state
}
;
}
export
default
update
;
