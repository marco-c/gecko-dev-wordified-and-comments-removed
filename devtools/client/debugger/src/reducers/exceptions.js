export
function
initialExceptionsState
(
)
{
return
{
mutableExceptionsMap
:
new
Map
(
)
}
;
}
function
update
(
state
=
initialExceptionsState
(
)
action
)
{
switch
(
action
.
type
)
{
case
"
ADD_EXCEPTION
"
:
return
updateExceptions
(
state
action
)
;
case
"
REMOVE_SOURCES
"
:
{
return
removeExceptionsForSourceActors
(
state
action
.
actors
)
;
}
}
return
state
;
}
function
updateExceptions
(
state
action
)
{
const
{
mutableExceptionsMap
}
=
state
;
const
{
exception
}
=
action
;
const
{
sourceActorId
}
=
exception
;
let
exceptions
=
mutableExceptionsMap
.
get
(
sourceActorId
)
;
if
(
!
exceptions
)
{
exceptions
=
[
]
;
mutableExceptionsMap
.
set
(
sourceActorId
exceptions
)
;
}
else
if
(
exceptions
.
some
(
(
{
lineNumber
columnNumber
}
)
=
>
{
return
(
lineNumber
=
=
exception
.
lineNumber
&
&
columnNumber
=
=
exception
.
columnNumber
)
;
}
)
)
{
return
state
;
}
exceptions
.
push
(
exception
)
;
return
{
.
.
.
state
}
;
}
function
removeExceptionsForSourceActors
(
state
sourceActors
)
{
const
{
mutableExceptionsMap
}
=
state
;
const
sizeBefore
=
mutableExceptionsMap
.
size
;
for
(
const
sourceActor
of
sourceActors
)
{
mutableExceptionsMap
.
delete
(
sourceActor
.
id
)
;
}
return
mutableExceptionsMap
.
size
!
=
sizeBefore
?
{
.
.
.
state
}
:
state
;
}
export
default
update
;
