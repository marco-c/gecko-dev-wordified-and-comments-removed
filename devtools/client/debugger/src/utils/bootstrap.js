import
React
from
"
devtools
/
client
/
shared
/
vendor
/
react
"
;
import
{
bindActionCreators
combineReducers
}
from
"
devtools
/
client
/
shared
/
vendor
/
redux
"
;
import
ReactDOM
from
"
devtools
/
client
/
shared
/
vendor
/
react
-
dom
"
;
const
{
Provider
}
=
require
(
"
resource
:
/
/
devtools
/
client
/
shared
/
vendor
/
react
-
redux
.
js
"
)
;
import
ToolboxProvider
from
"
devtools
/
client
/
framework
/
store
-
provider
"
;
import
flags
from
"
devtools
/
shared
/
flags
"
;
const
{
registerStoreObserver
}
=
require
(
"
resource
:
/
/
devtools
/
client
/
shared
/
redux
/
subscriber
.
js
"
)
;
const
{
AppConstants
}
=
ChromeUtils
.
importESModule
(
"
resource
:
/
/
gre
/
modules
/
AppConstants
.
sys
.
mjs
"
)
;
import
{
SearchDispatcher
}
from
"
.
.
/
workers
/
search
/
index
"
;
import
{
PrettyPrintDispatcher
}
from
"
.
.
/
workers
/
pretty
-
print
/
index
"
;
import
configureStore
from
"
.
.
/
actions
/
utils
/
create
-
store
"
;
import
reducers
from
"
.
.
/
reducers
/
index
"
;
import
*
as
selectors
from
"
.
.
/
selectors
/
index
"
;
import
App
from
"
.
.
/
components
/
App
"
;
import
{
asyncStore
prefs
}
from
"
.
/
prefs
"
;
const
{
sanitizeBreakpoints
}
=
require
(
"
resource
:
/
/
devtools
/
client
/
shared
/
thread
-
utils
.
js
"
)
;
const
{
visibilityHandlerStore
}
=
require
(
"
resource
:
/
/
devtools
/
client
/
shared
/
redux
/
visibilityHandlerStore
.
js
"
)
;
let
gWorkers
;
export
function
bootstrapStore
(
client
workers
panel
initialState
)
{
const
debugJsModules
=
AppConstants
.
DEBUG_JS_MODULES
=
=
"
1
"
;
const
createStore
=
configureStore
(
{
log
:
prefs
.
logging
|
|
flags
.
testing
timing
:
debugJsModules
thunkArgs
:
{
client
.
.
.
workers
panel
}
}
)
;
let
store
=
createStore
(
combineReducers
(
reducers
)
initialState
)
;
store
=
visibilityHandlerStore
(
store
)
;
registerStoreObserver
(
store
updatePrefs
)
;
const
actions
=
bindActionCreators
(
require
(
"
.
.
/
actions
/
index
"
)
.
default
store
.
dispatch
)
;
return
{
store
actions
selectors
}
;
}
export
function
bootstrapWorkers
(
panelWorkers
)
{
gWorkers
=
{
prettyPrintWorker
:
new
PrettyPrintDispatcher
(
)
searchWorker
:
new
SearchDispatcher
(
)
}
;
return
{
.
.
.
panelWorkers
.
.
.
gWorkers
}
;
}
export
function
teardownWorkers
(
)
{
gWorkers
.
prettyPrintWorker
.
stop
(
)
;
gWorkers
.
searchWorker
.
stop
(
)
;
}
export
function
bootstrapApp
(
store
toolboxStore
appComponentAttributes
=
{
}
)
{
const
mount
=
getMountElement
(
)
;
if
(
!
mount
)
{
return
;
}
ReactDOM
.
render
(
React
.
createElement
(
Provider
{
store
}
React
.
createElement
(
ToolboxProvider
{
store
:
toolboxStore
}
React
.
createElement
(
App
appComponentAttributes
)
)
)
mount
)
;
}
function
getMountElement
(
)
{
return
document
.
querySelector
(
"
#
mount
"
)
;
}
export
function
unmountRoot
(
)
{
ReactDOM
.
unmountComponentAtNode
(
getMountElement
(
)
)
;
}
function
updatePrefs
(
state
oldState
)
{
const
hasChanged
=
selector
=
>
selector
(
oldState
)
&
&
selector
(
oldState
)
!
=
=
selector
(
state
)
;
if
(
hasChanged
(
selectors
.
getPendingBreakpoints
)
)
{
asyncStore
.
pendingBreakpoints
=
sanitizeBreakpoints
(
selectors
.
getPendingBreakpoints
(
state
)
)
;
}
if
(
oldState
.
eventListenerBreakpoints
&
&
oldState
.
eventListenerBreakpoints
!
=
=
state
.
eventListenerBreakpoints
)
{
asyncStore
.
eventListenerBreakpoints
=
state
.
eventListenerBreakpoints
;
}
if
(
hasChanged
(
selectors
.
getOpenedURLs
)
)
{
asyncStore
.
openedURLs
=
selectors
.
getOpenedURLs
(
state
)
;
}
if
(
hasChanged
(
selectors
.
getPrettyPrintedURLs
)
)
{
asyncStore
.
prettyPrintedURLs
=
Array
.
from
(
selectors
.
getPrettyPrintedURLs
(
state
)
)
;
}
if
(
hasChanged
(
selectors
.
getXHRBreakpoints
)
)
{
asyncStore
.
xhrBreakpoints
=
selectors
.
getXHRBreakpoints
(
state
)
;
}
if
(
hasChanged
(
selectors
.
getBlackBoxRanges
)
)
{
asyncStore
.
blackboxedRanges
=
selectors
.
getBlackBoxRanges
(
state
)
;
}
if
(
hasChanged
(
selectors
.
getMainThreadProjectDirectoryRoots
)
)
{
asyncStore
.
directoryRoots
=
selectors
.
getMainThreadProjectDirectoryRoots
(
state
)
;
}
}
