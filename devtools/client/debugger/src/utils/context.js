import
type
{
ThreadId
}
from
"
.
.
/
types
"
;
import
type
{
State
}
from
"
.
.
/
reducers
/
types
"
;
import
{
getThreadContext
}
from
"
.
.
/
selectors
"
;
export
type
NavigateContext
=
{
|
+
navigateCounter
:
number
|
}
;
export
type
ThreadContext
=
{
|
+
navigateCounter
:
number
+
thread
:
ThreadId
+
pauseCounter
:
number
+
isPaused
:
boolean
|
}
;
export
type
Context
=
NavigateContext
|
ThreadContext
;
export
class
ContextError
extends
Error
{
}
export
function
validateNavigateContext
(
state
:
State
cx
:
Context
)
:
void
{
const
newcx
=
getThreadContext
(
state
)
;
if
(
newcx
.
navigateCounter
!
=
cx
.
navigateCounter
)
{
throw
new
ContextError
(
"
Page
has
navigated
"
)
;
}
}
export
function
validateThreadContext
(
state
:
State
cx
:
ThreadContext
)
:
void
{
const
newcx
=
getThreadContext
(
state
)
;
if
(
cx
.
thread
!
=
newcx
.
thread
)
{
throw
new
ContextError
(
"
Current
thread
has
changed
"
)
;
}
if
(
cx
.
pauseCounter
!
=
newcx
.
pauseCounter
)
{
throw
new
ContextError
(
"
Current
thread
has
paused
or
resumed
"
)
;
}
}
export
function
validateContext
(
state
:
State
cx
:
Context
)
:
void
{
validateNavigateContext
(
state
cx
)
;
if
(
"
thread
"
in
cx
)
{
validateThreadContext
(
state
(
cx
:
any
)
)
;
}
}
export
function
isValidThreadContext
(
state
:
State
cx
:
ThreadContext
)
:
boolean
{
const
newcx
=
getThreadContext
(
state
)
;
return
cx
.
thread
=
=
newcx
.
thread
&
&
cx
.
pauseCounter
=
=
newcx
.
pauseCounter
;
}
