import
React
{
PureComponent
}
from
"
react
"
;
import
ReactDOM
from
"
react
-
dom
"
;
import
actions
from
"
.
.
/
.
.
/
actions
"
;
import
assert
from
"
.
.
/
.
.
/
utils
/
assert
"
;
import
{
connect
}
from
"
.
.
/
.
.
/
utils
/
connect
"
;
import
InlinePreview
from
"
.
/
InlinePreview
"
;
import
type
{
Preview
}
from
"
.
.
/
.
.
/
types
"
;
type
Props
=
{
editor
:
Object
line
:
number
previews
:
Array
<
Preview
>
openElementInInspector
:
typeof
actions
.
openElementInInspectorCommand
highlightDomElement
:
typeof
actions
.
highlightDomElement
unHighlightDomElement
:
typeof
actions
.
unHighlightDomElement
}
;
import
"
.
/
InlinePreview
.
css
"
;
class
InlinePreviewRow
extends
PureComponent
<
Props
>
{
bookmark
:
Object
;
widgetNode
:
Object
;
componentDidMount
(
)
{
this
.
updatePreviewWidget
(
this
.
props
null
)
;
}
componentDidUpdate
(
prevProps
:
Props
)
{
this
.
updatePreviewWidget
(
this
.
props
prevProps
)
;
}
componentWillUnmount
(
)
{
this
.
updatePreviewWidget
(
null
this
.
props
)
;
}
updatePreviewWidget
(
props
:
Props
|
null
prevProps
:
Props
|
null
)
{
if
(
this
.
bookmark
&
&
prevProps
&
&
(
!
props
|
|
prevProps
.
editor
!
=
=
props
.
editor
|
|
prevProps
.
line
!
=
=
props
.
line
)
)
{
this
.
bookmark
.
clear
(
)
;
this
.
bookmark
=
null
;
this
.
widgetNode
=
null
;
}
if
(
!
props
)
{
return
assert
(
!
this
.
bookmark
"
Inline
Preview
widget
shouldn
'
t
be
present
.
"
)
;
}
const
{
editor
line
previews
openElementInInspector
highlightDomElement
unHighlightDomElement
}
=
props
;
if
(
!
this
.
bookmark
)
{
this
.
widgetNode
=
document
.
createElement
(
"
div
"
)
;
this
.
widgetNode
.
classList
.
add
(
"
inline
-
preview
"
)
;
}
ReactDOM
.
render
(
<
React
.
Fragment
>
{
previews
.
map
(
(
preview
:
Preview
)
=
>
(
<
InlinePreview
line
=
{
line
}
variable
=
{
preview
.
name
}
value
=
{
preview
.
value
}
openElementInInspector
=
{
openElementInInspector
}
highlightDomElement
=
{
highlightDomElement
}
unHighlightDomElement
=
{
unHighlightDomElement
}
/
>
)
)
}
<
/
React
.
Fragment
>
this
.
widgetNode
)
;
this
.
bookmark
=
editor
.
codeMirror
.
setBookmark
(
{
line
ch
:
Infinity
}
this
.
widgetNode
)
;
}
render
(
)
{
return
null
;
}
}
export
default
connect
(
(
)
=
>
(
{
}
)
{
openElementInInspector
:
actions
.
openElementInInspectorCommand
highlightDomElement
:
actions
.
highlightDomElement
unHighlightDomElement
:
actions
.
unHighlightDomElement
}
)
(
InlinePreviewRow
)
;
