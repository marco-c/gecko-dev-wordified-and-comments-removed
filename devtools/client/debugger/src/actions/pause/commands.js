import
{
getSelectedFrame
getThreadContext
getCurrentThread
getIsCurrentThreadPaused
}
from
"
.
.
/
.
.
/
selectors
"
;
import
{
PROMISE
}
from
"
.
.
/
utils
/
middleware
/
promise
"
;
import
{
evaluateExpressions
}
from
"
.
.
/
expressions
"
;
import
{
selectLocation
}
from
"
.
.
/
sources
"
;
import
{
fetchScopes
}
from
"
.
/
fetchScopes
"
;
import
{
fetchFrames
}
from
"
.
/
fetchFrames
"
;
import
{
recordEvent
}
from
"
.
.
/
.
.
/
utils
/
telemetry
"
;
import
assert
from
"
.
.
/
.
.
/
utils
/
assert
"
;
export
function
selectThread
(
cx
thread
)
{
return
async
(
{
dispatch
getState
client
}
)
=
>
{
if
(
getCurrentThread
(
getState
(
)
)
=
=
=
thread
)
{
return
;
}
dispatch
(
{
cx
type
:
"
SELECT_THREAD
"
thread
}
)
;
const
threadcx
=
getThreadContext
(
getState
(
)
)
;
assert
(
threadcx
.
thread
=
=
thread
"
Thread
mismatch
"
)
;
const
serverRequests
=
[
]
;
serverRequests
.
push
(
dispatch
(
evaluateExpressions
(
threadcx
)
)
)
;
const
frame
=
getSelectedFrame
(
getState
(
)
thread
)
;
if
(
frame
)
{
serverRequests
.
push
(
dispatch
(
selectLocation
(
threadcx
frame
.
location
)
)
)
;
serverRequests
.
push
(
dispatch
(
fetchFrames
(
threadcx
)
)
)
;
serverRequests
.
push
(
dispatch
(
fetchScopes
(
threadcx
)
)
)
;
}
await
Promise
.
all
(
serverRequests
)
;
}
;
}
export
function
command
(
type
)
{
return
async
(
{
dispatch
getState
client
}
)
=
>
{
if
(
!
type
)
{
return
null
;
}
const
thread
=
getCurrentThread
(
getState
(
)
)
;
const
frame
=
getSelectedFrame
(
getState
(
)
thread
)
;
return
dispatch
(
{
type
:
"
COMMAND
"
command
:
type
thread
[
PROMISE
]
:
client
[
type
]
(
thread
frame
?
.
id
)
}
)
;
}
;
}
export
function
stepIn
(
)
{
return
(
{
dispatch
getState
}
)
=
>
{
if
(
!
getIsCurrentThreadPaused
(
getState
(
)
)
)
{
return
null
;
}
return
dispatch
(
command
(
"
stepIn
"
)
)
;
}
;
}
export
function
stepOver
(
)
{
return
(
{
dispatch
getState
}
)
=
>
{
if
(
!
getIsCurrentThreadPaused
(
getState
(
)
)
)
{
return
null
;
}
return
dispatch
(
command
(
"
stepOver
"
)
)
;
}
;
}
export
function
stepOut
(
)
{
return
(
{
dispatch
getState
}
)
=
>
{
if
(
!
getIsCurrentThreadPaused
(
getState
(
)
)
)
{
return
null
;
}
return
dispatch
(
command
(
"
stepOut
"
)
)
;
}
;
}
export
function
resume
(
)
{
return
(
{
dispatch
getState
}
)
=
>
{
if
(
!
getIsCurrentThreadPaused
(
getState
(
)
)
)
{
return
null
;
}
recordEvent
(
"
continue
"
)
;
return
dispatch
(
command
(
"
resume
"
)
)
;
}
;
}
export
function
restart
(
cx
frame
)
{
return
async
(
{
dispatch
getState
client
}
)
=
>
{
if
(
!
getIsCurrentThreadPaused
(
getState
(
)
)
)
{
return
null
;
}
return
dispatch
(
{
type
:
"
COMMAND
"
command
:
"
restart
"
thread
:
cx
.
thread
[
PROMISE
]
:
client
.
restart
(
cx
.
thread
frame
.
id
)
}
)
;
}
;
}
