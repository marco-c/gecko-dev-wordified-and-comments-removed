import
{
getSelectedSource
getSelectedFrame
getCanRewind
getClosestBreakpointPosition
getBreakpoint
}
from
"
.
.
/
.
.
/
selectors
"
;
import
{
addHiddenBreakpoint
}
from
"
.
.
/
breakpoints
"
;
import
{
setBreakpointPositions
}
from
"
.
.
/
breakpoints
/
breakpointPositions
"
;
import
{
resume
rewind
}
from
"
.
/
commands
"
;
import
type
{
ThunkArgs
}
from
"
.
.
/
types
"
;
import
type
{
ThreadContext
SourceLocation
}
from
"
.
.
/
.
.
/
types
"
;
export
function
continueToHere
(
cx
:
ThreadContext
location
:
SourceLocation
)
{
return
async
function
(
{
dispatch
getState
}
:
ThunkArgs
)
{
const
{
line
column
sourceId
}
=
location
;
const
selectedSource
=
getSelectedSource
(
getState
(
)
)
;
const
selectedFrame
=
getSelectedFrame
(
getState
(
)
cx
.
thread
)
;
if
(
!
selectedFrame
|
|
!
selectedSource
)
{
return
;
}
const
debugLine
=
selectedFrame
.
location
.
line
;
if
(
!
column
&
&
debugLine
=
=
line
)
{
return
;
}
await
dispatch
(
setBreakpointPositions
(
{
cx
sourceId
line
}
)
)
;
const
position
=
getClosestBreakpointPosition
(
getState
(
)
location
)
;
if
(
column
&
&
!
position
)
{
return
;
}
const
pauseLocation
=
column
&
&
position
?
position
.
location
:
location
;
const
action
=
getCanRewind
(
getState
(
)
)
&
&
line
<
debugLine
?
rewind
:
resume
;
if
(
!
getBreakpoint
(
getState
(
)
pauseLocation
)
)
{
await
dispatch
(
addHiddenBreakpoint
(
cx
{
sourceId
:
selectedSource
.
id
line
:
pauseLocation
.
line
column
:
pauseLocation
.
column
}
)
)
;
}
dispatch
(
action
(
cx
)
)
;
}
;
}
