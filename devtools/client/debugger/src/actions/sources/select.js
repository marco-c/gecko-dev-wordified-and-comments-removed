import
{
isOriginalId
}
from
"
devtools
/
client
/
shared
/
source
-
map
-
loader
/
index
"
;
import
{
setSymbols
}
from
"
.
/
symbols
"
;
import
{
setInScopeLines
}
from
"
.
.
/
ast
"
;
import
{
closeActiveSearch
updateActiveFileSearch
}
from
"
.
.
/
ui
"
;
import
{
togglePrettyPrint
}
from
"
.
/
prettyPrint
"
;
import
{
addTab
closeTab
}
from
"
.
.
/
tabs
"
;
import
{
loadSourceText
}
from
"
.
/
loadSourceText
"
;
import
{
mapDisplayNames
}
from
"
.
.
/
pause
"
;
import
{
setBreakableLines
}
from
"
.
"
;
import
{
prefs
}
from
"
.
.
/
.
.
/
utils
/
prefs
"
;
import
{
isMinified
}
from
"
.
.
/
.
.
/
utils
/
source
"
;
import
{
createLocation
}
from
"
.
.
/
.
.
/
utils
/
location
"
;
import
{
getRelatedMapLocation
}
from
"
.
.
/
.
.
/
utils
/
source
-
maps
"
;
import
{
getSource
getSourceActor
getFirstSourceActorForGeneratedSource
getSourceByURL
getPrettySource
getActiveSearch
getSelectedLocation
getSelectedSource
canPrettyPrintSource
getIsCurrentThreadPaused
getLocationSource
getSourceTextContent
tabExists
}
from
"
.
.
/
.
.
/
selectors
"
;
export
const
setSelectedLocation
=
(
cx
source
location
)
=
>
(
{
type
:
"
SET_SELECTED_LOCATION
"
cx
source
location
}
)
;
export
const
setPendingSelectedLocation
=
(
cx
url
options
)
=
>
(
{
type
:
"
SET_PENDING_SELECTED_LOCATION
"
cx
url
line
:
options
?
.
line
column
:
options
?
.
column
}
)
;
export
const
clearSelectedLocation
=
cx
=
>
(
{
type
:
"
CLEAR_SELECTED_LOCATION
"
cx
}
)
;
export
function
selectSourceURL
(
cx
url
options
)
{
return
async
(
{
dispatch
getState
sourceMaps
}
)
=
>
{
const
source
=
getSourceByURL
(
getState
(
)
url
)
;
if
(
!
source
)
{
return
dispatch
(
setPendingSelectedLocation
(
cx
url
options
)
)
;
}
const
location
=
createLocation
(
{
.
.
.
options
sourceId
:
source
.
id
}
)
;
return
dispatch
(
selectLocation
(
cx
location
)
)
;
}
;
}
export
function
selectSource
(
cx
sourceId
sourceActorId
location
=
{
}
)
{
return
async
(
{
dispatch
}
)
=
>
{
location
=
createLocation
(
{
.
.
.
location
sourceId
sourceActorId
}
)
;
return
dispatch
(
selectSpecificLocation
(
cx
location
)
)
;
}
;
}
export
function
selectLocation
(
cx
location
{
keepContext
=
true
}
=
{
}
)
{
return
async
(
{
dispatch
getState
sourceMaps
client
}
)
=
>
{
const
currentSource
=
getSelectedSource
(
getState
(
)
)
;
if
(
!
client
)
{
return
;
}
let
source
=
getLocationSource
(
getState
(
)
location
)
;
if
(
!
source
)
{
dispatch
(
clearSelectedLocation
(
cx
)
)
;
return
;
}
const
activeSearch
=
getActiveSearch
(
getState
(
)
)
;
if
(
activeSearch
&
&
activeSearch
!
=
=
"
file
"
)
{
dispatch
(
closeActiveSearch
(
)
)
;
}
const
selectedSource
=
getSelectedSource
(
getState
(
)
)
;
if
(
keepContext
&
&
selectedSource
&
&
selectedSource
.
isOriginal
!
=
isOriginalId
(
location
.
sourceId
)
)
{
location
=
await
getRelatedMapLocation
(
getState
(
)
sourceMaps
location
)
;
source
=
getLocationSource
(
getState
(
)
location
)
;
}
if
(
!
tabExists
(
getState
(
)
source
.
id
)
)
{
dispatch
(
addTab
(
source
)
)
;
}
let
sourceActor
;
if
(
!
location
.
sourceActorId
)
{
sourceActor
=
getFirstSourceActorForGeneratedSource
(
getState
(
)
source
.
id
)
;
location
.
sourceActorId
=
sourceActor
?
sourceActor
.
actor
:
null
;
}
else
{
sourceActor
=
getSourceActor
(
getState
(
)
location
.
sourceActorId
)
;
}
dispatch
(
setSelectedLocation
(
cx
source
location
)
)
;
await
dispatch
(
loadSourceText
(
cx
source
sourceActor
)
)
;
await
dispatch
(
setBreakableLines
(
cx
source
.
id
)
)
;
const
loadedSource
=
getSource
(
getState
(
)
source
.
id
)
;
if
(
!
loadedSource
)
{
return
;
}
const
sourceTextContent
=
getSourceTextContent
(
getState
(
)
location
)
;
if
(
keepContext
&
&
prefs
.
autoPrettyPrint
&
&
!
getPrettySource
(
getState
(
)
loadedSource
.
id
)
&
&
canPrettyPrintSource
(
getState
(
)
location
)
&
&
isMinified
(
source
sourceTextContent
)
)
{
await
dispatch
(
togglePrettyPrint
(
cx
loadedSource
.
id
)
)
;
dispatch
(
closeTab
(
cx
loadedSource
)
)
;
}
await
dispatch
(
setSymbols
(
{
cx
source
:
loadedSource
sourceActor
}
)
)
;
dispatch
(
setInScopeLines
(
cx
)
)
;
if
(
getIsCurrentThreadPaused
(
getState
(
)
)
)
{
await
dispatch
(
mapDisplayNames
(
cx
)
)
;
}
const
newSource
=
getSelectedSource
(
getState
(
)
)
;
if
(
currentSource
&
&
currentSource
!
=
=
newSource
)
{
dispatch
(
updateActiveFileSearch
(
cx
)
)
;
}
}
;
}
export
function
selectSpecificLocation
(
cx
location
)
{
return
selectLocation
(
cx
location
{
keepContext
:
false
}
)
;
}
export
function
jumpToMappedLocation
(
cx
location
)
{
return
async
function
(
{
dispatch
getState
client
sourceMaps
}
)
{
if
(
!
client
)
{
return
null
;
}
const
pairedLocation
=
await
getRelatedMapLocation
(
getState
(
)
sourceMaps
location
)
;
return
dispatch
(
selectSpecificLocation
(
cx
pairedLocation
)
)
;
}
;
}
export
function
jumpToMappedSelectedLocation
(
cx
)
{
return
async
function
(
{
dispatch
getState
}
)
{
const
location
=
getSelectedLocation
(
getState
(
)
)
;
if
(
!
location
)
{
return
;
}
await
dispatch
(
jumpToMappedLocation
(
cx
location
)
)
;
}
;
}
