"
use
strict
"
;
const
IFRAME_TEST_COM_URI
=
http
:
/
/
example
.
com
/
document
-
builder
.
sjs
?
html
=
+
encodeURI
(
<
script
>
debugger
;
<
/
script
>
)
;
const
IFRAME_TEST_URI
=
http
:
/
/
example
.
org
/
document
-
builder
.
sjs
?
html
=
<
iframe
src
=
"
{
encodeURI
(
IFRAME_TEST_COM_URI
)
}
"
>
<
/
iframe
>
<
body
>
;
add_task
(
async
function
(
)
{
info
(
"
Test
a
debugger
statement
from
the
top
level
document
"
)
;
const
toolbox
=
await
initPane
(
"
doc
-
debugger
-
statements
.
html
"
"
webconsole
"
)
;
info
(
"
Execute
a
debugger
statement
"
)
;
const
pausedRun
=
SpecialPowers
.
spawn
(
gBrowser
.
selectedBrowser
[
]
function
(
)
{
content
.
wrappedJSObject
.
test
(
)
;
}
)
;
const
dbg
=
await
assertDebuggerIsHighlightedAndPaused
(
toolbox
)
;
const
source
=
findSource
(
dbg
"
doc
-
debugger
-
statements
.
html
"
)
;
await
assertPausedAtSourceAndLine
(
dbg
source
.
id
16
)
;
await
resume
(
dbg
)
;
info
(
"
Wait
for
the
paused
code
to
complete
after
resume
"
)
;
await
pausedRun
;
ok
(
!
toolbox
.
isHighlighted
(
"
jsdebugger
"
)
"
Debugger
is
no
longer
highlighted
after
resume
"
)
;
}
)
;
add_task
(
async
function
(
)
{
info
(
"
Test
a
debugger
statement
from
an
iframe
"
)
;
const
toolbox
=
await
openNewTabAndToolbox
(
IFRAME_TEST_URI
"
webconsole
"
)
;
info
(
"
Reload
the
test
page
which
will
trigger
the
debugger
statement
in
the
iframe
"
)
;
const
pausedReload
=
refreshTab
(
)
;
const
dbg
=
await
assertDebuggerIsHighlightedAndPaused
(
toolbox
)
;
const
source
=
findSource
(
dbg
IFRAME_TEST_COM_URI
)
;
await
assertPausedAtSourceAndLine
(
dbg
source
.
id
1
)
;
await
resume
(
dbg
)
;
info
(
"
Wait
for
the
paused
code
to
complete
after
resume
"
)
;
await
pausedReload
;
ok
(
!
toolbox
.
isHighlighted
(
"
jsdebugger
"
)
"
Debugger
is
no
longer
highlighted
after
resume
"
)
;
}
)
;
async
function
assertDebuggerIsHighlightedAndPaused
(
toolbox
)
{
info
(
"
Wait
for
the
debugger
to
be
automatically
selected
on
pause
"
)
;
await
waitUntil
(
(
)
=
>
toolbox
.
currentToolId
=
=
"
jsdebugger
"
)
;
ok
(
true
"
Debugger
selected
"
)
;
await
toolbox
.
getPanelWhenReady
(
"
jsdebugger
"
)
;
const
dbg
=
createDebuggerContext
(
toolbox
)
;
await
waitForPaused
(
dbg
)
;
ok
(
toolbox
.
isHighlighted
(
"
jsdebugger
"
)
"
Debugger
is
highlighted
"
)
;
return
dbg
;
}
