"
use
strict
"
;
const
testServer
=
createVersionizedHttpTestServer
(
"
.
.
/
examples
/
sourcemaps
-
reload
-
uncompressed
"
)
;
const
TEST_URL
=
testServer
.
urlFor
(
"
index
.
html
"
)
;
add_task
(
async
function
(
)
{
const
dbg
=
await
initDebuggerWithAbsoluteURL
(
"
about
:
blank
"
)
;
await
navigateToAbsoluteURL
(
dbg
TEST_URL
.
.
.
INTEGRATION_TEST_PAGE_SOURCES
)
;
info
(
"
Wait
for
all
sources
to
be
displayed
in
the
source
tree
"
)
;
let
displayedSources
;
await
waitFor
(
(
)
=
>
{
displayedSources
=
dbg
.
selectors
.
getDisplayedSourcesList
(
)
;
return
displayedSources
.
length
=
=
INTEGRATION_TEST_PAGE_SOURCES
.
length
;
}
"
Got
the
expected
number
of
sources
from
the
selectors
"
)
;
const
uniqueUrls
=
new
Set
(
)
;
for
(
const
source
of
displayedSources
)
{
info
(
Opening
'
{
source
.
url
}
'
)
;
await
selectSource
(
dbg
source
)
;
uniqueUrls
.
add
(
source
.
url
)
;
}
is
(
countTabs
(
dbg
)
uniqueUrls
.
size
"
Got
a
tab
for
each
distinct
source
URL
"
)
;
invokeInTab
(
"
breakInEval
"
)
;
await
waitFor
(
(
)
=
>
countTabs
(
dbg
)
=
=
uniqueUrls
.
size
+
1
"
Wait
for
the
tab
for
the
new
evaled
source
"
)
;
await
resume
(
dbg
)
;
invokeInTab
(
"
breakInEval
"
)
;
await
waitFor
(
(
)
=
>
countTabs
(
dbg
)
=
=
uniqueUrls
.
size
+
2
"
Wait
for
yet
another
tab
for
the
second
evaled
source
"
)
;
await
resume
(
dbg
)
;
await
reload
(
dbg
.
.
.
INTEGRATION_TEST_PAGE_SOURCES
)
;
await
waitFor
(
(
)
=
>
countTabs
(
dbg
)
=
=
uniqueUrls
.
size
"
Wait
for
tab
count
to
be
fully
restored
"
)
;
is
(
countTabs
(
dbg
)
uniqueUrls
.
size
"
Still
get
the
same
number
of
tabs
after
reload
"
)
;
await
selectSource
(
dbg
"
query
.
js
?
x
=
1
"
)
;
dbg
.
panel
.
panelWin
.
focus
(
)
;
info
(
"
Open
the
current
active
tab
context
menu
"
)
;
const
waitForOpen
=
waitForContextMenu
(
dbg
)
;
rightClickElement
(
dbg
"
activeTab
"
)
;
await
waitForOpen
;
info
(
"
Trigger
copy
to
source
context
menu
"
)
;
await
waitForClipboardPromise
(
(
)
=
>
selectContextMenuItem
(
dbg
#
node
-
menu
-
copy
-
source
)
function
query
(
)
{
console
.
log
(
"
query
x
=
1
"
)
;
}
\
n
)
;
displayedSources
=
dbg
.
selectors
.
getDisplayedSourcesList
(
)
;
for
(
const
source
of
displayedSources
)
{
info
(
Closing
'
{
source
.
url
}
'
)
;
await
closeTab
(
dbg
source
)
;
}
is
(
countTabs
(
dbg
)
0
"
All
tabs
are
closed
"
)
;
}
)
;
