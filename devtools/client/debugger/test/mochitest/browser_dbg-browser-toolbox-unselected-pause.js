"
use
strict
"
;
requestLongerTimeout
(
4
)
;
Services
.
scriptloader
.
loadSubScript
(
"
chrome
:
/
/
mochitests
/
content
/
browser
/
devtools
/
client
/
framework
/
browser
-
toolbox
/
test
/
helpers
-
browser
-
toolbox
.
js
"
this
)
;
add_task
(
async
function
(
)
{
await
pushPref
(
"
devtools
.
browsertoolbox
.
fission
"
true
)
;
await
pushPref
(
"
devtools
.
browsertoolbox
.
panel
"
"
webconsole
"
)
;
const
ToolboxTask
=
await
initBrowserToolboxTask
(
)
;
await
ToolboxTask
.
importFunctions
(
{
createDebuggerContext
waitUntil
waitForPaused
isPaused
waitForState
waitForSelectedSource
waitForLoadedScopes
waitForElement
findElement
getSelector
findElementWithSelector
}
)
;
await
ToolboxTask
.
spawn
(
JSON
.
stringify
(
selectors
)
async
(
_selectors
)
=
>
{
this
.
selectors
=
_selectors
;
}
)
;
addTab
(
"
data
:
text
/
html
<
script
>
debugger
;
<
/
script
>
"
)
;
await
ToolboxTask
.
spawn
(
null
async
(
)
=
>
{
await
waitUntil
(
(
)
=
>
gToolbox
.
currentToolId
=
=
"
jsdebugger
"
)
;
}
)
;
ok
(
true
"
Debugger
selected
"
)
;
await
ToolboxTask
.
spawn
(
null
async
(
)
=
>
{
await
gToolbox
.
getPanelWhenReady
(
"
jsdebugger
"
)
;
const
dbg
=
createDebuggerContext
(
gToolbox
)
;
await
waitForPaused
(
dbg
)
;
if
(
!
gToolbox
.
isHighlighted
(
"
jsdebugger
"
)
)
{
throw
new
Error
(
"
Debugger
not
highlighted
"
)
;
}
}
)
;
ok
(
true
"
Paused
in
new
tab
"
)
;
await
ToolboxTask
.
destroy
(
)
;
}
)
;
