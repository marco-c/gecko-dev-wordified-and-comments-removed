const
TAB_URL
=
EXAMPLE_URL
+
"
doc_pretty
-
print
.
html
"
;
function
test
(
)
{
let
options
=
{
source
:
"
code_ugly
.
js
"
line
:
2
}
;
initDebugger
(
TAB_URL
options
)
.
then
(
(
[
aTab
aPanel
]
)
=
>
{
const
gTab
=
aTab
;
const
gPanel
=
aPanel
;
const
gDebugger
=
gPanel
.
panelWin
;
const
gSearchBox
=
gDebugger
.
DebuggerView
.
Filtering
.
_searchbox
;
Task
.
spawn
(
function
*
(
)
{
let
popupShown
=
promise
.
defer
(
)
;
once
(
gDebugger
"
popupshown
"
)
.
then
(
(
)
=
>
{
ok
(
isCaretPos
(
gPanel
2
10
)
"
The
bar
function
'
s
non
-
pretty
-
printed
location
should
be
shown
.
"
)
;
popupShown
.
resolve
(
)
;
}
)
;
setText
(
gSearchBox
"
bar
"
)
;
yield
popupShown
.
promise
;
const
finished
=
waitForSourceShown
(
gPanel
"
code_ugly
.
js
"
)
;
gDebugger
.
document
.
getElementById
(
"
pretty
-
print
"
)
.
click
(
)
;
yield
finished
;
popupShown
=
promise
.
defer
(
)
;
once
(
gDebugger
"
popupshown
"
)
.
then
(
(
)
=
>
{
ok
(
isCaretPos
(
gPanel
6
10
)
"
The
bar
function
'
s
pretty
printed
location
should
be
shown
.
"
)
;
popupShown
.
resolve
(
)
;
}
)
;
setText
(
gSearchBox
"
bar
"
)
;
yield
popupShown
.
promise
;
resumeDebuggerThenCloseAndFinish
(
gPanel
)
;
}
)
;
}
)
;
}
