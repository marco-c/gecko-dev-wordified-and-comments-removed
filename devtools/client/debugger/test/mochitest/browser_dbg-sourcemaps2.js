"
use
strict
"
;
requestLongerTimeout
(
2
)
;
add_task
(
async
function
(
)
{
const
dbg
=
await
initDebugger
(
"
doc
-
sourcemaps2
.
html
"
"
main
.
js
"
"
main
.
min
.
js
"
)
;
const
{
selectors
:
{
getBreakpoint
getBreakpointCount
}
}
=
dbg
;
ok
(
true
"
Original
sources
exist
"
)
;
const
mainSrc
=
findSource
(
dbg
"
main
.
js
"
)
;
await
selectSource
(
dbg
mainSrc
)
;
await
addBreakpoint
(
dbg
mainSrc
4
3
)
;
is
(
getBreakpointCount
(
)
1
"
One
breakpoint
exists
"
)
;
ok
(
getBreakpoint
(
createLocation
(
{
source
:
mainSrc
line
:
4
column
:
2
}
)
)
"
Breakpoint
has
correct
line
"
)
;
await
assertBreakpoint
(
dbg
4
)
;
invokeInTab
(
"
logMessage
"
)
;
await
waitForPausedInOriginalFileAndToggleMapScopes
(
dbg
)
;
await
assertPausedAtSourceAndLine
(
dbg
mainSrc
.
id
4
)
;
let
sourceMapLink
=
findElement
(
dbg
"
mappedSourceLink
"
)
;
is
(
sourceMapLink
.
textContent
"
To
main
.
min
.
js
"
"
Sourcemap
link
in
original
source
refers
to
the
bundle
"
)
;
await
selectSource
(
dbg
"
main
.
min
.
js
"
)
;
sourceMapLink
=
await
waitFor
(
(
)
=
>
findElement
(
dbg
"
mappedSourceLink
"
)
)
;
is
(
sourceMapLink
.
textContent
"
From
main
.
js
"
"
Sourcemap
link
in
bundle
refers
to
the
original
source
"
)
;
}
)
;
