"
use
strict
"
;
add_task
(
async
function
(
)
{
const
dbg
=
await
initDebugger
(
"
doc
-
scripts
.
html
"
"
simple2
.
js
"
)
;
await
selectSource
(
dbg
"
simple2
.
js
"
)
;
info
(
"
Set
condition
x
=
=
=
1
in
the
foo
function
and
pause
"
)
;
await
setConditionalBreakpoint
(
dbg
5
"
x
=
=
=
1
"
)
;
invokeInTab
(
"
foo
"
1
)
;
await
waitForPaused
(
dbg
)
;
ok
(
true
"
Conditional
breakpoint
was
hit
"
)
;
await
resume
(
dbg
)
;
await
removeBreakpoint
(
dbg
findSource
(
dbg
"
simple2
.
js
"
)
.
id
5
)
;
info
(
"
Set
condition
x
=
=
=
2
in
the
foo
function
and
do
not
pause
"
)
;
await
setConditionalBreakpoint
(
dbg
5
"
x
=
=
2
"
)
;
invokeInTab
(
"
foo
"
1
)
;
await
wait
(
500
)
;
assertNotPaused
(
dbg
)
;
await
removeBreakpoint
(
dbg
findSource
(
dbg
"
simple2
.
js
"
)
.
id
5
)
;
info
(
"
Set
condition
foo
(
(
syntax
error
)
and
pause
on
the
exception
"
)
;
await
setConditionalBreakpoint
(
dbg
5
"
foo
(
"
)
;
invokeInTab
(
"
main
"
)
;
await
waitForPaused
(
dbg
)
;
let
whyPaused
=
dbg
.
win
.
document
.
querySelector
(
"
.
why
-
paused
"
)
.
innerText
;
is
(
whyPaused
"
Error
with
conditional
breakpoint
\
nexpected
expression
got
end
of
script
"
)
;
await
resume
(
dbg
)
;
assertNotPaused
(
dbg
)
;
info
(
"
Retrigger
the
same
breakpoint
with
pause
on
exception
enabled
and
ensure
it
still
reports
the
exception
and
only
once
"
)
;
await
togglePauseOnExceptions
(
dbg
true
false
)
;
invokeInTab
(
"
main
"
)
;
await
waitForPaused
(
dbg
)
;
whyPaused
=
dbg
.
win
.
document
.
querySelector
(
"
.
why
-
paused
"
)
.
innerText
;
is
(
whyPaused
"
Error
with
conditional
breakpoint
\
nexpected
expression
got
end
of
script
"
)
;
await
resume
(
dbg
)
;
await
wait
(
500
)
;
assertNotPaused
(
dbg
)
;
await
removeBreakpoint
(
dbg
findSource
(
dbg
"
simple2
.
js
"
)
.
id
5
)
;
}
)
;
async
function
setConditionalBreakpoint
(
dbg
index
condition
)
{
const
{
addConditionItem
editConditionItem
}
=
selectors
;
const
selector
=
{
addConditionItem
}
{
editConditionItem
}
;
rightClickElement
(
dbg
"
gutterElement
"
index
)
;
await
waitForContextMenu
(
dbg
)
;
selectContextMenuItem
(
dbg
selector
)
;
const
dispatched
=
waitForDispatch
(
dbg
.
store
"
SET_BREAKPOINT
"
)
;
typeInPanel
(
dbg
condition
)
;
await
dispatched
;
await
waitForCondition
(
dbg
condition
)
;
}
