"
use
strict
"
;
add_task
(
async
function
testTracingWorker
(
)
{
await
pushPref
(
"
devtools
.
debugger
.
features
.
javascript
-
tracing
"
true
)
;
await
pushPref
(
"
dom
.
worker
.
console
.
dispatch_events_to_main_thread
"
false
)
;
const
dbg
=
await
initDebugger
(
"
doc
-
scripts
.
html
"
)
;
await
toggleJsTracerMenuItem
(
dbg
"
#
jstracer
-
menu
-
item
-
console
"
)
;
info
(
"
Instantiate
a
worker
"
)
;
await
SpecialPowers
.
spawn
(
gBrowser
.
selectedBrowser
[
]
async
function
(
)
{
content
.
worker
=
new
content
.
Worker
(
"
simple
-
worker
.
js
"
)
;
}
)
;
await
waitFor
(
(
)
=
>
findAllElements
(
dbg
"
threadsPaneItems
"
)
.
length
=
=
2
"
Wait
for
the
two
threads
to
be
displayed
in
the
thread
pane
"
)
;
const
threadsEl
=
findAllElements
(
dbg
"
threadsPaneItems
"
)
;
is
(
threadsEl
.
length
2
"
There
are
two
threads
in
the
thread
panel
"
)
;
info
(
"
Enable
tracing
on
all
threads
"
)
;
await
toggleJsTracer
(
dbg
.
toolbox
)
;
await
hasConsoleMessage
(
dbg
"
setIntervalCallback
"
)
;
await
hasConsoleMessage
(
dbg
"
timer
"
)
;
await
SpecialPowers
.
spawn
(
gBrowser
.
selectedBrowser
[
]
async
function
(
)
{
content
.
worker
.
postMessage
(
"
foo
"
)
;
}
)
;
await
hasConsoleMessage
(
dbg
"
DOM
|
global
.
message
"
)
;
await
hasConsoleMessage
(
dbg
"
onmessage
"
)
;
await
dbg
.
toolbox
.
closeToolbox
(
)
;
}
)
;
