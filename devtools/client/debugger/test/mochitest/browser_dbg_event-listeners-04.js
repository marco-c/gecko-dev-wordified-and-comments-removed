const
TAB_URL
=
EXAMPLE_URL
+
"
doc_event
-
listeners
-
01
.
html
"
;
function
test
(
)
{
Task
.
spawn
(
function
*
(
)
{
let
tab
=
yield
addTab
(
TAB_URL
)
;
let
tabs
=
require
(
'
sdk
/
tabs
'
)
;
let
sdkTab
=
[
.
.
.
tabs
]
.
find
(
tab
=
>
tab
.
url
=
=
=
TAB_URL
)
;
ok
(
sdkTab
"
Add
-
on
SDK
found
the
loaded
tab
.
"
)
;
info
(
"
Attaching
an
event
handler
via
add
-
on
sdk
content
scripts
.
"
)
;
let
worker
=
sdkTab
.
attach
(
{
contentScript
:
"
document
.
body
.
addEventListener
(
'
click
'
e
=
>
alert
(
e
)
)
"
onError
:
ok
.
bind
(
this
false
)
}
)
;
let
[
panel
win
]
=
yield
initDebugger
(
tab
)
;
let
dbg
=
panel
.
panelWin
;
let
controller
=
dbg
.
DebuggerController
;
let
constants
=
dbg
.
require
(
'
.
/
content
/
constants
'
)
;
let
actions
=
dbg
.
require
(
'
.
/
content
/
actions
/
event
-
listeners
'
)
;
let
fetched
=
waitForDispatch
(
panel
constants
.
FETCH_EVENT_LISTENERS
)
;
info
(
"
Scheduling
event
listener
fetch
.
"
)
;
controller
.
dispatch
(
actions
.
fetchEventListeners
(
)
)
;
info
(
"
Waiting
for
updated
event
listeners
to
arrive
.
"
)
;
yield
fetched
;
ok
(
true
"
The
listener
update
did
not
hang
.
"
)
;
closeDebuggerAndFinish
(
panel
)
;
}
)
;
}
