add_task
(
async
function
(
)
{
const
{
target
panel
}
=
await
initWebAudioEditor
(
DESTROY_NODES_URL
)
;
const
{
panelWin
}
=
panel
;
const
{
gFront
gAudioNodes
}
=
panelWin
;
const
started
=
once
(
gFront
"
start
-
context
"
)
;
const
events
=
Promise
.
all
(
[
getNSpread
(
gAudioNodes
"
add
"
13
)
waitForGraphRendered
(
panelWin
13
2
)
]
)
;
reload
(
target
)
;
const
[
created
]
=
await
events
;
const
actorIDs
=
created
.
map
(
ev
=
>
ev
[
0
]
.
id
)
;
await
clickGraphNode
(
panelWin
actorIDs
[
5
]
)
;
const
destroyed
=
getN
(
gAudioNodes
"
remove
"
10
)
;
forceNodeCollection
(
)
;
await
Promise
.
all
(
[
destroyed
waitForGraphRendered
(
panelWin
3
2
)
]
)
;
is
(
panelWin
.
gAudioNodes
.
length
3
"
All
nodes
should
be
GC
'
d
except
one
gain
osc
and
dest
node
.
"
)
;
ok
(
findGraphNode
(
panelWin
actorIDs
[
0
]
)
"
dest
should
be
in
graph
"
)
;
ok
(
findGraphNode
(
panelWin
actorIDs
[
1
]
)
"
osc
should
be
in
graph
"
)
;
ok
(
findGraphNode
(
panelWin
actorIDs
[
2
]
)
"
gain
should
be
in
graph
"
)
;
const
{
nodes
edges
}
=
countGraphObjects
(
panelWin
)
;
is
(
nodes
3
"
Only
3
nodes
rendered
in
graph
.
"
)
;
is
(
edges
2
"
Only
2
edges
rendered
in
graph
.
"
)
;
ok
(
isVisible
(
(
"
#
web
-
audio
-
editor
-
details
-
pane
-
empty
"
)
)
"
InspectorView
empty
message
should
show
if
the
currently
selected
node
gets
collected
.
"
)
;
await
teardown
(
target
)
;
}
)
;
