"
use
strict
"
;
const
throttlingProfiles
=
require
(
"
devtools
/
client
/
shared
/
components
/
throttling
/
profiles
"
)
;
const
TEST_URL
=
"
data
:
text
/
html
;
charset
=
utf
-
8
Network
throttling
test
"
;
addRDMTask
(
TEST_URL
async
function
(
{
ui
manager
}
)
{
const
{
store
}
=
ui
.
toolWindow
;
await
waitUntilState
(
store
state
=
>
state
.
viewports
.
length
=
=
1
)
;
testNetworkThrottlingSelectorLabel
(
ui
"
No
throttling
"
)
;
await
testNetworkThrottlingState
(
ui
null
)
;
await
testThrottlingProfile
(
ui
"
Wi
-
Fi
"
)
;
await
testThrottlingProfile
(
ui
"
Regular
3G
"
)
;
await
selectNetworkThrottling
(
ui
"
No
throttling
"
)
;
testNetworkThrottlingSelectorLabel
(
ui
"
No
throttling
"
)
;
await
testNetworkThrottlingState
(
ui
null
)
;
}
)
;
function
testNetworkThrottlingSelectorLabel
(
ui
expected
)
{
const
selector
=
"
#
network
-
throttling
-
selector
"
;
const
select
=
ui
.
toolWindow
.
document
.
querySelector
(
selector
)
;
is
(
select
.
selectedOptions
[
0
]
.
textContent
expected
Select
label
should
be
changed
to
{
expected
}
)
;
}
var
testNetworkThrottlingState
=
async
function
(
ui
expected
)
{
const
state
=
await
ui
.
emulationFront
.
getNetworkThrottling
(
)
;
Assert
.
deepEqual
(
state
expected
"
Network
throttling
state
should
be
"
+
JSON
.
stringify
(
expected
null
2
)
)
;
}
;
var
testThrottlingProfile
=
async
function
(
ui
profile
)
{
await
selectNetworkThrottling
(
ui
profile
)
;
testNetworkThrottlingSelectorLabel
(
ui
profile
)
;
const
data
=
throttlingProfiles
.
find
(
(
{
id
}
)
=
>
id
=
=
profile
)
;
const
{
download
upload
latency
}
=
data
;
await
testNetworkThrottlingState
(
ui
{
downloadThroughput
:
download
uploadThroughput
:
upload
latency
}
)
;
}
;
