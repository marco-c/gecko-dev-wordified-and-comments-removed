"
use
strict
"
;
Services
.
scriptloader
.
loadSubScript
(
"
chrome
:
/
/
mochitests
/
content
/
browser
/
devtools
/
client
/
framework
/
test
/
shared
-
head
.
js
"
this
)
;
Services
.
scriptloader
.
loadSubScript
(
"
chrome
:
/
/
mochitests
/
content
/
browser
/
devtools
/
client
/
framework
/
test
/
shared
-
redux
-
head
.
js
"
this
)
;
const
TEST_URI_ROOT
=
"
http
:
/
/
example
.
com
/
browser
/
devtools
/
client
/
responsive
.
html
/
test
/
browser
/
"
;
DevToolsUtils
.
testing
=
true
;
Services
.
prefs
.
setCharPref
(
"
devtools
.
devices
.
url
"
TEST_URI_ROOT
+
"
devices
.
json
"
)
;
Services
.
prefs
.
setBoolPref
(
"
devtools
.
responsive
.
html
.
enabled
"
true
)
;
registerCleanupFunction
(
(
)
=
>
{
DevToolsUtils
.
testing
=
false
;
Services
.
prefs
.
clearUserPref
(
"
devtools
.
devices
.
url
"
)
;
Services
.
prefs
.
clearUserPref
(
"
devtools
.
responsive
.
html
.
enabled
"
)
;
}
)
;
const
{
ResponsiveUIManager
}
=
Cu
.
import
(
"
resource
:
/
/
devtools
/
client
/
responsivedesign
/
responsivedesign
.
jsm
"
{
}
)
;
var
openRDM
=
Task
.
async
(
function
*
(
tab
)
{
info
(
"
Opening
responsive
design
mode
"
)
;
let
manager
=
ResponsiveUIManager
;
let
ui
=
yield
manager
.
openIfNeeded
(
window
tab
)
;
info
(
"
Responsive
design
mode
opened
"
)
;
return
{
ui
manager
}
;
}
)
;
var
closeRDM
=
Task
.
async
(
function
*
(
tab
)
{
info
(
"
Closing
responsive
design
mode
"
)
;
let
manager
=
ResponsiveUIManager
;
manager
.
closeIfNeeded
(
window
tab
)
;
info
(
"
Responsive
design
mode
closed
"
)
;
}
)
;
function
addRDMTask
(
url
generator
)
{
add_task
(
function
*
(
)
{
const
tab
=
yield
addTab
(
url
)
;
const
results
=
yield
openRDM
(
tab
)
;
try
{
yield
*
generator
(
results
)
;
}
catch
(
err
)
{
ok
(
false
"
Got
an
error
:
"
+
DevToolsUtils
.
safeErrorString
(
err
)
)
;
}
yield
closeRDM
(
tab
)
;
yield
removeTab
(
tab
)
;
}
)
;
}
var
waitForFrameLoad
=
Task
.
async
(
function
*
(
frame
targetURL
)
{
let
window
=
frame
.
contentWindow
;
if
(
(
window
.
document
.
readyState
=
=
"
complete
"
|
|
window
.
document
.
readyState
=
=
"
interactive
"
)
&
&
window
.
location
.
href
=
=
targetURL
)
{
return
;
}
yield
once
(
frame
"
load
"
)
;
}
)
;
