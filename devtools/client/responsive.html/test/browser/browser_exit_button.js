"
use
strict
"
;
const
TEST_URL
=
"
data
:
text
/
html
;
charset
=
utf
-
8
"
;
addRDMTask
(
TEST_URL
function
*
(
.
.
.
args
)
{
yield
testExitButton
(
.
.
.
args
)
;
}
)
;
add_task
(
function
*
(
)
{
let
tab
=
yield
addTab
(
TEST_URL
)
;
let
{
ui
manager
}
=
yield
openRDM
(
tab
)
;
yield
waitBootstrap
(
ui
)
;
let
waitTabIsDetached
=
Promise
.
all
(
[
once
(
tab
"
TabClose
"
)
once
(
tab
.
linkedBrowser
"
SwapDocShells
"
)
]
)
;
let
newWindow
=
gBrowser
.
replaceTabWithWindow
(
tab
)
;
yield
waitTabIsDetached
;
tab
=
newWindow
.
gBrowser
.
tabs
[
0
]
;
ok
(
!
manager
.
isActiveForTab
(
tab
)
"
Responsive
Design
Mode
is
not
active
for
the
tab
"
)
;
yield
testExitButton
(
yield
openRDM
(
tab
)
)
;
yield
BrowserTestUtils
.
closeWindow
(
newWindow
)
;
}
)
;
function
*
waitBootstrap
(
ui
)
{
let
{
toolWindow
tab
}
=
ui
;
let
{
store
}
=
toolWindow
;
let
url
=
String
(
tab
.
linkedBrowser
.
currentURI
.
spec
)
;
yield
waitUntilState
(
store
state
=
>
state
.
viewports
.
length
=
=
1
)
;
yield
waitForFrameLoad
(
ui
url
)
;
}
function
*
testExitButton
(
{
ui
manager
}
)
{
yield
waitBootstrap
(
ui
)
;
let
exitButton
=
ui
.
toolWindow
.
document
.
getElementById
(
"
global
-
exit
-
button
"
)
;
ok
(
manager
.
isActiveForTab
(
ui
.
tab
)
"
Responsive
Design
Mode
active
for
the
tab
"
)
;
exitButton
.
click
(
)
;
yield
once
(
manager
"
off
"
)
;
ok
(
!
manager
.
isActiveForTab
(
ui
.
tab
)
"
Responsive
Design
Mode
is
not
active
for
the
tab
"
)
;
}
