"
use
strict
"
;
const
Services
=
require
(
"
Services
"
)
;
loader
.
lazyGetter
(
this
"
GetStringFromName
"
(
)
=
>
{
let
bundle
=
Services
.
strings
.
createBundle
(
"
chrome
:
/
/
devtools
/
locale
/
inspector
.
properties
"
)
;
return
key
=
>
{
return
bundle
.
GetStringFromName
(
key
)
;
}
;
}
)
;
const
XHTML_NS
=
"
http
:
/
/
www
.
w3
.
org
/
1999
/
xhtml
"
;
const
MAX_DIMENSION
=
200
;
const
CONTAINER_MIN_WIDTH
=
100
;
const
LABEL_HEIGHT
=
20
;
const
IMAGE_PADDING
=
4
;
function
getImageDimensions
(
doc
imageUrl
)
{
return
new
Promise
(
resolve
=
>
{
let
imgObj
=
new
doc
.
defaultView
.
Image
(
)
;
imgObj
.
onload
=
(
)
=
>
{
imgObj
.
onload
=
null
;
let
{
naturalWidth
naturalHeight
}
=
imgObj
;
resolve
(
{
naturalWidth
naturalHeight
}
)
;
}
;
imgObj
.
src
=
imageUrl
;
}
)
;
}
function
setImageTooltip
(
tooltip
doc
imageUrl
options
)
{
let
{
naturalWidth
naturalHeight
hideDimensionLabel
maxDim
}
=
options
;
maxDim
=
maxDim
|
|
MAX_DIMENSION
;
let
imgHeight
=
naturalHeight
;
let
imgWidth
=
naturalWidth
;
if
(
imgHeight
>
maxDim
|
|
imgWidth
>
maxDim
)
{
let
scale
=
maxDim
/
Math
.
max
(
imgHeight
imgWidth
)
;
imgHeight
=
Math
.
floor
(
scale
*
naturalHeight
)
;
imgWidth
=
Math
.
ceil
(
scale
*
naturalWidth
)
;
}
let
div
=
doc
.
createElementNS
(
XHTML_NS
"
div
"
)
;
div
.
style
.
cssText
=
height
:
100
%
;
min
-
width
:
100px
;
display
:
flex
;
flex
-
direction
:
column
;
text
-
align
:
center
;
;
let
html
=
<
div
style
=
"
flex
:
1
;
display
:
flex
;
padding
:
{
IMAGE_PADDING
}
px
;
align
-
items
:
center
;
justify
-
content
:
center
;
min
-
height
:
1px
;
"
>
<
img
style
=
"
height
:
{
imgHeight
}
px
;
max
-
height
:
100
%
;
"
src
=
"
{
imageUrl
}
"
/
>
<
/
div
>
;
if
(
!
hideDimensionLabel
)
{
let
label
=
naturalWidth
+
"
\
u00D7
"
+
naturalHeight
;
html
+
=
<
div
style
=
"
height
:
{
LABEL_HEIGHT
}
px
;
text
-
align
:
center
;
"
>
<
span
class
=
"
theme
-
comment
devtools
-
tooltip
-
caption
"
>
{
label
}
<
/
span
>
<
/
div
>
;
}
div
.
innerHTML
=
html
;
let
height
=
imgHeight
+
2
*
IMAGE_PADDING
;
if
(
!
hideDimensionLabel
)
{
height
+
=
LABEL_HEIGHT
;
}
let
width
=
Math
.
max
(
CONTAINER_MIN_WIDTH
imgWidth
+
2
*
IMAGE_PADDING
)
;
tooltip
.
setContent
(
div
width
height
)
;
}
function
setBrokenImageTooltip
(
tooltip
doc
)
{
let
div
=
doc
.
createElementNS
(
XHTML_NS
"
div
"
)
;
div
.
style
.
cssText
=
box
-
sizing
:
border
-
box
;
height
:
100
%
;
text
-
align
:
center
;
line
-
height
:
30px
;
;
let
message
=
GetStringFromName
(
"
previewTooltip
.
image
.
brokenImage
"
)
;
div
.
textContent
=
message
;
tooltip
.
setContent
(
div
150
30
)
;
}
module
.
exports
.
getImageDimensions
=
getImageDimensions
;
module
.
exports
.
setImageTooltip
=
setImageTooltip
;
module
.
exports
.
setBrokenImageTooltip
=
setBrokenImageTooltip
;
