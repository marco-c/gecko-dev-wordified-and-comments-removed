"
use
strict
"
;
add_task
(
async
function
(
)
{
const
tab
=
gBrowser
.
selectedTab
;
const
toolbox
=
await
gDevTools
.
showToolboxForTab
(
tab
)
;
const
doc
=
toolbox
.
doc
;
const
root
=
doc
.
documentElement
;
const
platform
=
root
.
getAttribute
(
"
platform
"
)
;
const
expectedPlatform
=
getPlatform
(
)
;
is
(
platform
expectedPlatform
"
:
root
[
platform
]
is
correct
"
)
;
const
theme
=
Services
.
prefs
.
getCharPref
(
"
devtools
.
theme
"
)
;
const
className
=
"
theme
-
"
+
theme
;
ok
(
root
.
classList
.
contains
(
className
)
"
:
root
has
"
+
className
+
"
class
(
current
theme
)
"
)
;
const
sheetsIterator
=
doc
.
evaluate
(
"
processing
-
instruction
(
'
xml
-
stylesheet
'
)
"
doc
null
XPathResult
.
ANY_TYPE
null
)
;
const
sheetsInDOM
=
[
]
;
let
sheet
;
while
(
(
sheet
=
sheetsIterator
.
iterateNext
(
)
)
)
{
sheetsInDOM
.
push
(
sheet
.
data
)
;
}
const
sheetsFromTheme
=
gDevTools
.
getThemeDefinition
(
theme
)
.
stylesheets
;
info
(
"
Checking
for
existence
of
"
+
sheetsInDOM
.
length
+
"
sheets
"
)
;
for
(
const
themeSheet
of
sheetsFromTheme
)
{
ok
(
sheetsInDOM
.
some
(
s
=
>
s
.
includes
(
themeSheet
)
)
"
There
is
a
stylesheet
for
"
+
themeSheet
)
;
}
await
toolbox
.
destroy
(
)
;
}
)
;
function
getPlatform
(
)
{
const
{
OS
}
=
Services
.
appinfo
;
if
(
OS
=
=
"
WINNT
"
)
{
return
"
win
"
;
}
else
if
(
OS
=
=
"
Darwin
"
)
{
return
"
mac
"
;
}
return
"
linux
"
;
}
