"
use
strict
"
;
const
Babel
=
require
(
"
.
/
babel
"
)
;
const
fs
=
require
(
"
fs
"
)
;
const
_path
=
require
(
"
path
"
)
;
const
defaultPlugins
=
[
"
transform
-
flow
-
strip
-
types
"
"
proposal
-
class
-
properties
"
"
transform
-
react
-
jsx
"
]
;
function
transform
(
filePath
)
{
const
plugins
=
filePath
.
includes
(
"
devtools
/
client
/
debugger
"
)
?
require
(
"
.
/
build
-
debugger
"
)
(
filePath
)
:
defaultPlugins
;
const
doc
=
fs
.
readFileSync
(
filePath
"
utf8
"
)
;
let
out
;
try
{
out
=
Babel
.
transform
(
doc
{
plugins
}
)
;
}
catch
(
err
)
{
throw
new
Error
(
=
=
=
=
=
=
=
=
=
=
=
=
=
=
=
=
=
=
=
=
=
=
=
=
NODE
COMPILATION
ERROR
!
File
:
{
filePath
}
Stack
:
{
err
.
stack
}
=
=
=
=
=
=
=
=
=
=
=
=
=
=
=
=
=
=
=
=
=
=
=
=
)
;
}
return
out
.
code
;
}
function
mkdirs
(
filePath
)
{
if
(
fs
.
existsSync
(
filePath
)
)
{
return
;
}
mkdirs
(
_path
.
dirname
(
filePath
)
)
;
try
{
fs
.
mkdirSync
(
filePath
)
;
}
catch
(
err
)
{
if
(
err
.
code
!
=
"
EEXIST
"
)
{
throw
err
;
}
}
}
if
(
false
)
{
const
code
=
transform
(
"
devtools
/
client
/
debugger
/
src
/
utils
/
prefs
.
js
"
)
;
console
.
log
(
code
.
slice
(
0
1500
)
)
;
}
else
{
const
deps
=
[
__filename
_path
.
resolve
(
__dirname
"
babel
.
js
"
)
]
;
const
outputDir
=
process
.
argv
[
process
.
argv
.
length
-
1
]
;
mkdirs
(
outputDir
)
;
for
(
let
i
=
2
;
i
<
process
.
argv
.
length
-
1
;
i
+
+
)
{
const
srcPath
=
process
.
argv
[
i
]
;
const
code
=
transform
(
srcPath
)
;
const
fullPath
=
_path
.
join
(
outputDir
_path
.
basename
(
srcPath
)
)
;
fs
.
writeFileSync
(
fullPath
code
)
;
deps
.
push
(
srcPath
)
;
}
console
.
log
(
deps
.
map
(
file
=
>
"
dep
:
"
+
file
)
.
join
(
"
\
n
"
)
)
;
}
