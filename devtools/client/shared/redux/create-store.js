"
use
strict
"
;
const
{
combineReducers
createStore
applyMiddleware
}
=
require
(
"
devtools
/
client
/
shared
/
vendor
/
redux
"
)
;
const
{
thunk
}
=
require
(
"
devtools
/
client
/
shared
/
redux
/
middleware
/
thunk
"
)
;
const
{
waitUntilService
}
=
require
(
"
devtools
/
client
/
shared
/
redux
/
middleware
/
wait
-
service
"
)
;
const
{
task
}
=
require
(
"
devtools
/
client
/
shared
/
redux
/
middleware
/
task
"
)
;
const
{
promise
}
=
require
(
"
devtools
/
client
/
shared
/
redux
/
middleware
/
promise
"
)
;
const
flags
=
require
(
"
devtools
/
shared
/
flags
"
)
;
loader
.
lazyRequireGetter
(
this
"
log
"
"
devtools
/
client
/
shared
/
redux
/
middleware
/
log
"
true
)
;
const
createStoreWithMiddleware
=
(
opts
=
{
}
)
=
>
{
const
middleware
=
[
]
;
if
(
opts
.
enableTaskMiddleware
)
{
middleware
.
push
(
task
)
;
}
middleware
.
push
(
thunk
(
opts
.
thunkOptions
)
promise
waitUntilService
)
;
if
(
opts
.
middleware
)
{
opts
.
middleware
.
forEach
(
fn
=
>
middleware
.
push
(
fn
)
)
;
}
if
(
opts
.
log
)
{
middleware
.
push
(
log
)
;
}
return
applyMiddleware
(
.
.
.
middleware
)
(
createStore
)
;
}
;
module
.
exports
=
(
reducers
{
shouldLog
=
false
initialState
=
undefined
thunkOptions
enableTaskMiddleware
=
false
}
=
{
}
)
=
>
{
const
reducer
=
typeof
reducers
=
=
=
"
function
"
?
reducers
:
combineReducers
(
reducers
)
;
const
store
=
createStoreWithMiddleware
(
{
enableTaskMiddleware
log
:
flags
.
testing
&
&
shouldLog
thunkOptions
}
)
(
reducer
initialState
)
;
return
store
;
}
;
