"
use
strict
"
;
exports
.
viewSourceInStyleEditor
=
async
function
(
toolbox
stylesheetResourceOrGeneratedURL
generatedLine
generatedColumn
)
{
const
originalPanelId
=
toolbox
.
currentToolId
;
try
{
const
panel
=
await
toolbox
.
selectTool
(
"
styleeditor
"
"
view
-
source
"
{
stylesheetToSelect
:
{
stylesheet
:
stylesheetResourceOrGeneratedURL
line
:
generatedLine
column
:
generatedColumn
}
}
)
;
let
stylesheetResource
;
if
(
typeof
stylesheetResourceOrGeneratedURL
=
=
=
"
string
"
)
{
stylesheetResource
=
panel
.
getStylesheetResourceForGeneratedURL
(
stylesheetResourceOrGeneratedURL
)
;
}
else
{
stylesheetResource
=
stylesheetResourceOrGeneratedURL
;
}
const
originalLocation
=
stylesheetResource
?
await
getOriginalLocation
(
toolbox
stylesheetResource
.
resourceId
generatedLine
generatedColumn
)
:
null
;
if
(
originalLocation
)
{
await
panel
.
selectOriginalSheet
(
originalLocation
.
sourceId
originalLocation
.
line
originalLocation
.
column
)
;
return
true
;
}
if
(
stylesheetResource
)
{
await
panel
.
selectStyleSheet
(
stylesheetResource
generatedLine
generatedColumn
)
;
return
true
;
}
}
catch
(
e
)
{
console
.
error
(
"
Failed
to
view
source
in
style
editor
"
e
)
;
}
exports
.
viewSource
(
toolbox
typeof
stylesheetResourceOrGeneratedURL
=
=
=
"
string
"
?
stylesheetResourceOrGeneratedURL
:
stylesheetResourceOrGeneratedURL
.
href
|
|
stylesheetResourceOrGeneratedURL
.
nodeHref
generatedLine
)
;
await
toolbox
.
selectTool
(
originalPanelId
)
;
return
false
;
}
;
exports
.
viewSourceInDebugger
=
async
function
(
toolbox
generatedURL
generatedLine
generatedColumn
sourceActorId
reason
=
"
unknown
"
)
{
const
location
=
await
getViewSourceInDebuggerLocation
(
toolbox
generatedURL
generatedLine
generatedColumn
sourceActorId
)
;
if
(
location
)
{
const
{
id
line
column
}
=
location
;
const
dbg
=
await
toolbox
.
selectTool
(
"
jsdebugger
"
reason
)
;
try
{
await
dbg
.
selectSource
(
id
sourceActorId
line
column
)
;
return
true
;
}
catch
(
err
)
{
console
.
error
(
"
Failed
to
view
source
in
debugger
"
err
)
;
}
}
exports
.
viewSource
(
toolbox
generatedURL
generatedLine
)
;
return
false
;
}
;
async
function
getViewSourceInDebuggerLocation
(
toolbox
generatedURL
generatedLine
generatedColumn
sourceActorId
)
{
const
dbg
=
await
toolbox
.
loadTool
(
"
jsdebugger
"
)
;
const
generatedSource
=
sourceActorId
?
dbg
.
getSourceByActorId
(
sourceActorId
)
:
dbg
.
getSourceByURL
(
generatedURL
)
;
if
(
!
generatedSource
|
|
dbg
.
getSourceActorsForSource
(
generatedSource
.
id
)
.
length
=
=
=
0
)
{
return
null
;
}
const
generatedLocation
=
{
id
:
generatedSource
.
id
line
:
generatedLine
column
:
generatedColumn
}
;
const
originalLocation
=
await
getOriginalLocation
(
toolbox
generatedLocation
.
id
generatedLocation
.
line
generatedLocation
.
column
)
;
if
(
!
originalLocation
)
{
return
generatedLocation
;
}
const
originalSource
=
dbg
.
getLocationSource
(
originalLocation
)
;
if
(
!
originalSource
)
{
return
generatedLocation
;
}
return
{
id
:
originalSource
.
id
line
:
originalLocation
.
line
column
:
originalLocation
.
column
}
;
}
async
function
getOriginalLocation
(
toolbox
generatedID
generatedLine
generatedColumn
)
{
if
(
typeof
generatedLine
!
=
=
"
number
"
)
{
return
null
;
}
let
originalLocation
=
null
;
try
{
originalLocation
=
await
toolbox
.
sourceMapLoader
.
getOriginalLocation
(
{
sourceId
:
generatedID
line
:
generatedLine
column
:
generatedColumn
}
)
;
if
(
originalLocation
&
&
originalLocation
.
sourceId
=
=
=
generatedID
)
{
originalLocation
=
null
;
}
}
catch
(
err
)
{
console
.
error
(
"
Failed
to
resolve
sourcemapped
location
for
the
given
source
location
"
{
generatedID
generatedLine
generatedColumn
}
err
)
;
}
return
originalLocation
;
}
exports
.
viewSource
=
async
function
(
toolbox
sourceURL
sourceLine
)
{
const
utils
=
toolbox
.
gViewSourceUtils
;
utils
.
viewSource
(
{
URL
:
sourceURL
lineNumber
:
sourceLine
|
|
-
1
}
)
;
}
;
