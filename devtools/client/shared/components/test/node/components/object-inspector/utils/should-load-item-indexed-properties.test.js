const
Utils
=
require
(
"
devtools
/
client
/
shared
/
components
/
object
-
inspector
/
utils
/
index
"
)
;
const
{
createNode
createGetterNode
createSetterNode
getChildren
makeNodesForEntries
nodeIsDefaultProperties
}
=
Utils
.
node
;
const
{
shouldLoadItemIndexedProperties
}
=
Utils
.
loadProperties
;
const
GripEntryRep
=
require
(
"
devtools
/
client
/
shared
/
components
/
reps
/
reps
/
grip
-
entry
"
)
;
const
accessorStubs
=
require
(
"
devtools
/
client
/
shared
/
components
/
test
/
node
/
stubs
/
reps
/
accessor
"
)
;
const
gripMapStubs
=
require
(
"
devtools
/
client
/
shared
/
components
/
test
/
node
/
stubs
/
reps
/
grip
-
map
"
)
;
const
gripArrayStubs
=
require
(
"
devtools
/
client
/
shared
/
components
/
test
/
node
/
stubs
/
reps
/
grip
-
array
"
)
;
const
gripStubs
=
require
(
"
devtools
/
client
/
shared
/
components
/
test
/
node
/
stubs
/
reps
/
grip
"
)
;
const
windowStubs
=
require
(
"
devtools
/
client
/
shared
/
components
/
test
/
node
/
stubs
/
reps
/
window
"
)
;
describe
(
"
shouldLoadItemIndexedProperties
"
(
)
=
>
{
it
(
"
returns
true
for
an
array
"
(
)
=
>
{
const
node
=
createNode
(
{
name
:
"
root
"
contents
:
{
value
:
gripArrayStubs
.
get
(
"
testMaxProps
"
)
}
}
)
;
expect
(
shouldLoadItemIndexedProperties
(
node
)
)
.
toBeTruthy
(
)
;
}
)
;
it
(
"
returns
false
for
an
already
loaded
item
"
(
)
=
>
{
const
node
=
createNode
(
{
name
:
"
root
"
contents
:
{
value
:
gripArrayStubs
.
get
(
"
testMaxProps
"
)
}
}
)
;
const
loadedProperties
=
new
Map
(
[
[
node
.
path
true
]
]
)
;
expect
(
shouldLoadItemIndexedProperties
(
node
loadedProperties
)
)
.
toBeFalsy
(
)
;
}
)
;
it
(
"
returns
false
for
an
array
node
with
buckets
"
(
)
=
>
{
const
node
=
createNode
(
{
name
:
"
root
"
contents
:
{
value
:
gripArrayStubs
.
get
(
"
Array
(
234
)
"
)
}
}
)
;
expect
(
shouldLoadItemIndexedProperties
(
node
)
)
.
toBeFalsy
(
)
;
}
)
;
it
(
"
returns
true
for
an
array
bucket
node
"
(
)
=
>
{
const
node
=
createNode
(
{
name
:
"
root
"
contents
:
{
value
:
gripArrayStubs
.
get
(
"
Array
(
234
)
"
)
}
}
)
;
const
bucketNodes
=
getChildren
(
{
item
:
node
loadedProperties
:
new
Map
(
[
[
node
.
path
true
]
]
)
}
)
;
expect
(
bucketNodes
[
0
]
.
name
)
.
toBe
(
"
[
0
99
]
"
)
;
expect
(
shouldLoadItemIndexedProperties
(
bucketNodes
[
0
]
)
)
.
toBeTruthy
(
)
;
}
)
;
it
(
"
returns
false
for
an
array
bucket
node
with
sub
-
buckets
"
(
)
=
>
{
const
node
=
createNode
(
{
name
:
"
root
"
contents
:
{
value
:
gripArrayStubs
.
get
(
"
Array
(
23456
)
"
)
}
}
)
;
const
bucketNodes
=
getChildren
(
{
item
:
node
loadedProperties
:
new
Map
(
[
[
node
.
path
true
]
]
)
}
)
;
expect
(
bucketNodes
[
0
]
.
name
)
.
toBe
(
"
[
0
999
]
"
)
;
expect
(
shouldLoadItemIndexedProperties
(
bucketNodes
[
0
]
)
)
.
toBeFalsy
(
)
;
}
)
;
it
(
"
returns
true
for
an
array
sub
-
bucket
node
"
(
)
=
>
{
const
node
=
createNode
(
{
name
:
"
root
"
contents
:
{
value
:
gripArrayStubs
.
get
(
"
Array
(
23456
)
"
)
}
}
)
;
const
bucketNodes
=
getChildren
(
{
item
:
node
loadedProperties
:
new
Map
(
[
[
node
.
path
true
]
]
)
}
)
;
expect
(
bucketNodes
[
0
]
.
name
)
.
toBe
(
"
[
0
999
]
"
)
;
const
subBucketNodes
=
getChildren
(
{
item
:
bucketNodes
[
0
]
loadedProperties
:
new
Map
(
[
[
bucketNodes
[
0
]
.
path
true
]
]
)
}
)
;
expect
(
subBucketNodes
[
0
]
.
name
)
.
toBe
(
"
[
0
99
]
"
)
;
expect
(
shouldLoadItemIndexedProperties
(
subBucketNodes
[
0
]
)
)
.
toBeTruthy
(
)
;
}
)
;
it
(
"
returns
false
for
an
entries
node
"
(
)
=
>
{
const
mapStubNode
=
createNode
(
{
name
:
"
map
"
contents
:
{
value
:
gripMapStubs
.
get
(
"
20
-
entries
Map
"
)
}
}
)
;
const
entriesNode
=
makeNodesForEntries
(
mapStubNode
)
;
expect
(
shouldLoadItemIndexedProperties
(
entriesNode
)
)
.
toBeFalsy
(
)
;
}
)
;
it
(
"
returns
true
for
an
Object
"
(
)
=
>
{
const
node
=
createNode
(
{
name
:
"
root
"
contents
:
{
value
:
gripStubs
.
get
(
"
testMaxProps
"
)
}
}
)
;
expect
(
shouldLoadItemIndexedProperties
(
node
)
)
.
toBeTruthy
(
)
;
}
)
;
it
(
"
returns
true
for
a
Map
"
(
)
=
>
{
const
node
=
createNode
(
{
name
:
"
root
"
contents
:
{
value
:
gripMapStubs
.
get
(
"
20
-
entries
Map
"
)
}
}
)
;
expect
(
shouldLoadItemIndexedProperties
(
node
)
)
.
toBeTruthy
(
)
;
}
)
;
it
(
"
returns
true
for
a
Set
"
(
)
=
>
{
const
node
=
createNode
(
{
name
:
"
root
"
contents
:
{
value
:
gripArrayStubs
.
get
(
"
new
Set
(
[
1
2
3
4
]
)
"
)
}
}
)
;
expect
(
shouldLoadItemIndexedProperties
(
node
)
)
.
toBeTruthy
(
)
;
}
)
;
it
(
"
returns
true
for
a
Window
"
(
)
=
>
{
const
node
=
createNode
(
{
name
:
"
root
"
contents
:
{
value
:
windowStubs
.
get
(
"
Window
"
)
.
_grip
}
}
)
;
expect
(
shouldLoadItemIndexedProperties
(
node
)
)
.
toBeTruthy
(
)
;
}
)
;
it
(
"
returns
false
for
a
<
default
properties
>
node
"
(
)
=
>
{
const
windowNode
=
createNode
(
{
name
:
"
root
"
contents
:
{
value
:
windowStubs
.
get
(
"
Window
"
)
.
_grip
}
}
)
;
const
loadedProperties
=
new
Map
(
[
[
windowNode
.
path
{
ownProperties
:
{
foo
:
{
value
:
"
bar
"
}
location
:
{
value
:
"
a
"
}
}
}
]
]
)
;
const
[
defaultPropertiesNode
]
=
getChildren
(
{
item
:
windowNode
loadedProperties
}
)
;
expect
(
nodeIsDefaultProperties
(
defaultPropertiesNode
)
)
.
toBe
(
true
)
;
expect
(
shouldLoadItemIndexedProperties
(
defaultPropertiesNode
)
)
.
toBeFalsy
(
)
;
}
)
;
it
(
"
returns
false
for
a
MapEntry
node
"
(
)
=
>
{
const
node
=
GripEntryRep
.
createGripMapEntry
(
"
key
"
"
value
"
)
;
expect
(
shouldLoadItemIndexedProperties
(
node
)
)
.
toBeFalsy
(
)
;
}
)
;
it
(
"
returns
false
for
a
Proxy
node
"
(
)
=
>
{
const
node
=
createNode
(
{
name
:
"
root
"
contents
:
{
value
:
gripStubs
.
get
(
"
testProxy
"
)
}
}
)
;
expect
(
shouldLoadItemIndexedProperties
(
node
)
)
.
toBeFalsy
(
)
;
}
)
;
it
(
"
returns
true
for
a
Proxy
target
node
"
(
)
=
>
{
const
proxyNode
=
createNode
(
{
name
:
"
root
"
contents
:
{
value
:
gripStubs
.
get
(
"
testProxy
"
)
}
}
)
;
const
loadedProperties
=
new
Map
(
[
[
proxyNode
.
path
gripStubs
.
get
(
"
testProxySlots
"
)
]
]
)
;
const
[
targetNode
]
=
getChildren
(
{
item
:
proxyNode
loadedProperties
}
)
;
expect
(
targetNode
.
name
)
.
toBe
(
"
<
target
>
"
)
;
expect
(
shouldLoadItemIndexedProperties
(
targetNode
)
)
.
toBeTruthy
(
)
;
}
)
;
it
(
"
returns
false
for
an
accessor
node
"
(
)
=
>
{
const
accessorNode
=
createNode
(
{
name
:
"
root
"
contents
:
{
value
:
accessorStubs
.
get
(
"
getter
"
)
}
}
)
;
expect
(
shouldLoadItemIndexedProperties
(
accessorNode
)
)
.
toBeFalsy
(
)
;
}
)
;
it
(
"
returns
true
for
an
accessor
<
get
>
node
"
(
)
=
>
{
const
getNode
=
createGetterNode
(
{
name
:
"
root
"
property
:
accessorStubs
.
get
(
"
getter
"
)
}
)
;
expect
(
getNode
.
name
)
.
toBe
(
"
<
get
root
(
)
>
"
)
;
expect
(
shouldLoadItemIndexedProperties
(
getNode
)
)
.
toBeTruthy
(
)
;
}
)
;
it
(
"
returns
true
for
an
accessor
<
set
>
node
"
(
)
=
>
{
const
setNode
=
createSetterNode
(
{
name
:
"
root
"
property
:
accessorStubs
.
get
(
"
setter
"
)
}
)
;
expect
(
setNode
.
name
)
.
toBe
(
"
<
set
root
(
)
>
"
)
;
expect
(
shouldLoadItemIndexedProperties
(
setNode
)
)
.
toBeTruthy
(
)
;
}
)
;
it
(
"
returns
false
for
a
primitive
node
"
(
)
=
>
{
const
node
=
createNode
(
{
name
:
"
root
"
contents
:
{
value
:
42
}
}
)
;
expect
(
shouldLoadItemIndexedProperties
(
node
)
)
.
toBeFalsy
(
)
;
}
)
;
}
)
;
