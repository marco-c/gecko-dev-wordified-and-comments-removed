"
use
strict
"
;
const
{
Component
}
=
require
(
"
devtools
/
client
/
shared
/
vendor
/
react
"
)
;
const
dom
=
require
(
"
devtools
/
client
/
shared
/
vendor
/
react
-
dom
-
factories
"
)
;
const
PropTypes
=
require
(
"
devtools
/
client
/
shared
/
vendor
/
react
-
prop
-
types
"
)
;
class
SearchBoxAutocompletePopup
extends
Component
{
static
get
propTypes
(
)
{
return
{
autocompleteProvider
:
PropTypes
.
func
.
isRequired
filter
:
PropTypes
.
string
.
isRequired
onItemSelected
:
PropTypes
.
func
.
isRequired
}
;
}
constructor
(
props
context
)
{
super
(
props
context
)
;
this
.
state
=
this
.
computeState
(
props
)
;
this
.
computeState
=
this
.
computeState
.
bind
(
this
)
;
this
.
jumpToTop
=
this
.
jumpToTop
.
bind
(
this
)
;
this
.
jumpToBottom
=
this
.
jumpToBottom
.
bind
(
this
)
;
this
.
jumpBy
=
this
.
jumpBy
.
bind
(
this
)
;
this
.
select
=
this
.
select
.
bind
(
this
)
;
this
.
onMouseDown
=
this
.
onMouseDown
.
bind
(
this
)
;
}
UNSAFE_componentWillReceiveProps
(
nextProps
)
{
if
(
this
.
props
.
filter
=
=
=
nextProps
.
filter
)
{
return
;
}
this
.
setState
(
this
.
computeState
(
nextProps
)
)
;
}
componentDidUpdate
(
)
{
if
(
this
.
refs
.
selected
)
{
this
.
refs
.
selected
.
scrollIntoView
(
false
)
;
}
}
computeState
(
{
autocompleteProvider
filter
}
)
{
const
list
=
autocompleteProvider
(
filter
)
;
const
selectedIndex
=
list
.
length
>
0
?
0
:
-
1
;
return
{
list
selectedIndex
}
;
}
jumpToTop
(
)
{
this
.
setState
(
{
selectedIndex
:
0
}
)
;
}
jumpToBottom
(
)
{
this
.
setState
(
{
selectedIndex
:
this
.
state
.
list
.
length
-
1
}
)
;
}
jumpBy
(
increment
=
1
)
{
const
{
list
selectedIndex
}
=
this
.
state
;
let
nextIndex
=
selectedIndex
+
increment
;
if
(
increment
>
0
)
{
nextIndex
=
nextIndex
>
list
.
length
-
1
?
0
:
nextIndex
;
}
else
if
(
increment
<
0
)
{
nextIndex
=
nextIndex
<
0
?
list
.
length
-
1
:
nextIndex
;
}
this
.
setState
(
{
selectedIndex
:
nextIndex
}
)
;
}
select
(
)
{
if
(
this
.
refs
.
selected
)
{
this
.
props
.
onItemSelected
(
this
.
refs
.
selected
.
dataset
.
value
)
;
}
}
onMouseDown
(
e
)
{
e
.
preventDefault
(
)
;
this
.
setState
(
{
selectedIndex
:
Number
(
e
.
target
.
dataset
.
index
)
}
this
.
select
)
;
}
render
(
)
{
const
{
list
}
=
this
.
state
;
return
(
list
.
length
>
0
&
&
dom
.
div
(
{
className
:
"
devtools
-
autocomplete
-
popup
devtools
-
monospace
"
}
dom
.
ul
(
{
className
:
"
devtools
-
autocomplete
-
listbox
"
}
list
.
map
(
(
item
i
)
=
>
{
const
isSelected
=
this
.
state
.
selectedIndex
=
=
i
;
const
itemClassList
=
[
"
autocomplete
-
item
"
]
;
if
(
isSelected
)
{
itemClassList
.
push
(
"
autocomplete
-
selected
"
)
;
}
return
dom
.
li
(
{
key
:
i
"
data
-
index
"
:
i
"
data
-
value
"
:
item
.
value
className
:
itemClassList
.
join
(
"
"
)
ref
:
isSelected
?
"
selected
"
:
null
onMouseDown
:
this
.
onMouseDown
}
item
.
displayValue
)
;
}
)
)
)
)
;
}
}
module
.
exports
=
SearchBoxAutocompletePopup
;
