"
use
strict
"
;
const
{
Component
createFactory
}
=
require
(
"
devtools
/
client
/
shared
/
vendor
/
react
"
)
;
const
PropTypes
=
require
(
"
devtools
/
client
/
shared
/
vendor
/
react
-
prop
-
types
"
)
;
const
dom
=
require
(
"
devtools
/
client
/
shared
/
vendor
/
react
-
dom
-
factories
"
)
;
const
{
LocalizationHelper
}
=
require
(
"
devtools
/
shared
/
l10n
"
)
;
const
l10n
=
new
LocalizationHelper
(
"
devtools
/
client
/
locales
/
components
.
properties
"
)
;
const
{
div
span
button
}
=
dom
;
loader
.
lazyGetter
(
this
"
MDNLink
"
function
(
)
{
return
createFactory
(
require
(
"
devtools
/
client
/
shared
/
components
/
MdnLink
"
)
)
;
}
)
;
const
PriorityLevels
=
{
PRIORITY_INFO_LOW
:
1
PRIORITY_INFO_MEDIUM
:
2
PRIORITY_INFO_HIGH
:
3
PRIORITY_NEW
:
4
PRIORITY_WARNING_LOW
:
5
PRIORITY_WARNING_MEDIUM
:
6
PRIORITY_WARNING_HIGH
:
7
PRIORITY_CRITICAL_LOW
:
8
PRIORITY_CRITICAL_MEDIUM
:
9
PRIORITY_CRITICAL_HIGH
:
10
PRIORITY_CRITICAL_BLOCK
:
11
}
;
class
NotificationBox
extends
Component
{
static
get
propTypes
(
)
{
return
{
id
:
PropTypes
.
string
notifications
:
PropTypes
.
instanceOf
(
Map
)
closeButtonTooltip
:
PropTypes
.
string
wrapping
:
PropTypes
.
bool
displayBorderTop
:
PropTypes
.
bool
displayBorderBottom
:
PropTypes
.
bool
displayCloseButton
:
PropTypes
.
bool
}
;
}
static
get
defaultProps
(
)
{
return
{
closeButtonTooltip
:
l10n
.
getStr
(
"
notificationBox
.
closeTooltip
"
)
displayBorderTop
:
false
displayBorderBottom
:
true
displayCloseButton
:
true
}
;
}
constructor
(
props
)
{
super
(
props
)
;
this
.
state
=
{
notifications
:
new
Map
(
)
}
;
this
.
appendNotification
=
this
.
appendNotification
.
bind
(
this
)
;
this
.
removeNotification
=
this
.
removeNotification
.
bind
(
this
)
;
this
.
getNotificationWithValue
=
this
.
getNotificationWithValue
.
bind
(
this
)
;
this
.
getCurrentNotification
=
this
.
getCurrentNotification
.
bind
(
this
)
;
this
.
close
=
this
.
close
.
bind
(
this
)
;
this
.
renderButton
=
this
.
renderButton
.
bind
(
this
)
;
this
.
renderNotification
=
this
.
renderNotification
.
bind
(
this
)
;
}
appendNotification
(
label
value
image
priority
buttons
=
[
]
eventCallback
)
{
const
newState
=
appendNotification
(
this
.
state
{
label
value
image
priority
buttons
eventCallback
}
)
;
this
.
setState
(
newState
)
;
}
removeNotification
(
notification
)
{
if
(
notification
)
{
this
.
close
(
this
.
state
.
notifications
.
get
(
notification
.
value
)
)
;
}
}
getNotificationWithValue
(
value
)
{
const
notification
=
this
.
state
.
notifications
.
get
(
value
)
;
if
(
!
notification
)
{
return
null
;
}
return
Object
.
assign
(
{
}
notification
{
close
:
(
)
=
>
{
this
.
close
(
notification
)
;
}
}
)
;
}
getCurrentNotification
(
)
{
return
getHighestPriorityNotification
(
this
.
state
.
notifications
)
;
}
close
(
notification
)
{
if
(
!
notification
)
{
return
;
}
if
(
notification
.
eventCallback
)
{
notification
.
eventCallback
(
"
removed
"
)
;
}
if
(
!
this
.
state
.
notifications
.
get
(
notification
.
value
)
)
{
return
;
}
const
newNotifications
=
new
Map
(
this
.
state
.
notifications
)
;
newNotifications
.
delete
(
notification
.
value
)
;
this
.
setState
(
{
notifications
:
newNotifications
}
)
;
}
renderButton
(
props
notification
)
{
if
(
props
.
mdnUrl
!
=
null
)
{
return
MDNLink
(
{
url
:
props
.
mdnUrl
title
:
props
.
label
}
)
;
}
const
onClick
=
event
=
>
{
if
(
props
.
callback
)
{
const
result
=
props
.
callback
(
this
props
event
.
target
)
;
if
(
!
result
)
{
this
.
close
(
notification
)
;
}
event
.
stopPropagation
(
)
;
}
}
;
return
button
(
{
key
:
props
.
label
className
:
"
notificationButton
"
accesskey
:
props
.
accesskey
onClick
:
onClick
}
props
.
label
)
;
}
renderNotification
(
notification
)
{
return
div
(
{
key
:
notification
.
value
className
:
"
notification
"
"
data
-
key
"
:
notification
.
value
"
data
-
type
"
:
notification
.
type
}
div
(
{
className
:
"
notificationInner
"
}
div
(
{
className
:
"
messageImage
"
"
data
-
type
"
:
notification
.
type
}
)
span
(
{
className
:
"
messageText
"
title
:
notification
.
label
}
notification
.
label
)
notification
.
buttons
.
map
(
props
=
>
this
.
renderButton
(
props
notification
)
)
this
.
props
.
displayCloseButton
?
button
(
{
className
:
"
messageCloseButton
"
title
:
this
.
props
.
closeButtonTooltip
onClick
:
this
.
close
.
bind
(
this
notification
)
}
)
:
null
)
)
;
}
render
(
)
{
const
notifications
=
this
.
props
.
notifications
|
|
this
.
state
.
notifications
;
const
notification
=
getHighestPriorityNotification
(
notifications
)
;
const
content
=
notification
?
this
.
renderNotification
(
notification
)
:
null
;
const
classNames
=
[
"
notificationbox
"
]
;
if
(
this
.
props
.
wrapping
)
{
classNames
.
push
(
"
wrapping
"
)
;
}
if
(
this
.
props
.
displayBorderBottom
)
{
classNames
.
push
(
"
border
-
bottom
"
)
;
}
if
(
this
.
props
.
displayBorderTop
)
{
classNames
.
push
(
"
border
-
top
"
)
;
}
return
div
(
{
className
:
classNames
.
join
(
"
"
)
id
:
this
.
props
.
id
}
content
)
;
}
}
function
appendNotification
(
state
props
)
{
const
{
label
value
image
priority
buttons
eventCallback
}
=
props
;
if
(
priority
<
PriorityLevels
.
PRIORITY_INFO_LOW
|
|
priority
>
PriorityLevels
.
PRIORITY_CRITICAL_BLOCK
)
{
throw
new
Error
(
"
Invalid
notification
priority
"
+
priority
)
;
}
if
(
image
)
{
throw
new
Error
(
"
Custom
image
URL
is
not
supported
yet
"
)
;
}
let
type
=
"
warning
"
;
if
(
priority
=
=
PriorityLevels
.
PRIORITY_NEW
)
{
type
=
"
new
"
;
}
else
if
(
priority
>
=
PriorityLevels
.
PRIORITY_CRITICAL_LOW
)
{
type
=
"
critical
"
;
}
else
if
(
priority
<
=
PriorityLevels
.
PRIORITY_INFO_HIGH
)
{
type
=
"
info
"
;
}
if
(
!
state
.
notifications
)
{
state
.
notifications
=
new
Map
(
)
;
}
const
notifications
=
new
Map
(
state
.
notifications
)
;
notifications
.
set
(
value
{
label
value
image
priority
type
buttons
:
Array
.
isArray
(
buttons
)
?
buttons
:
[
]
eventCallback
}
)
;
return
{
notifications
}
;
}
function
getNotificationWithValue
(
notifications
value
)
{
return
notifications
?
notifications
.
get
(
value
)
:
null
;
}
function
removeNotificationWithValue
(
notifications
value
)
{
const
newNotifications
=
new
Map
(
notifications
)
;
newNotifications
.
delete
(
value
)
;
return
{
notifications
:
newNotifications
}
;
}
function
getHighestPriorityNotification
(
notifications
)
{
if
(
!
notifications
)
{
return
null
;
}
let
currentNotification
=
null
;
for
(
const
[
notification
]
of
notifications
)
{
if
(
!
currentNotification
|
|
notification
.
priority
>
currentNotification
.
priority
)
{
currentNotification
=
notification
;
}
}
return
currentNotification
;
}
module
.
exports
.
NotificationBox
=
NotificationBox
;
module
.
exports
.
PriorityLevels
=
PriorityLevels
;
module
.
exports
.
appendNotification
=
appendNotification
;
module
.
exports
.
getNotificationWithValue
=
getNotificationWithValue
;
module
.
exports
.
removeNotificationWithValue
=
removeNotificationWithValue
;
