"
use
strict
"
;
async
function
networkRequest
(
url
opts
)
{
const
supportedProtocols
=
[
"
http
:
"
"
https
:
"
"
data
:
"
]
;
const
ADDITIONAL_PROTOCOLS
=
[
"
chrome
:
"
"
file
:
"
"
moz
-
extension
:
"
]
;
for
(
const
protocol
of
ADDITIONAL_PROTOCOLS
)
{
if
(
opts
.
sourceMapBaseURL
?
.
startsWith
(
protocol
)
)
{
supportedProtocols
.
push
(
protocol
)
;
}
}
if
(
supportedProtocols
.
every
(
protocol
=
>
!
url
.
startsWith
(
protocol
)
)
)
{
throw
new
Error
(
unsupported
protocol
for
sourcemap
request
{
url
}
)
;
}
const
response
=
await
fetch
(
url
{
cache
:
opts
.
loadFromCache
?
"
default
"
:
"
no
-
cache
"
redirect
:
opts
.
allowRedirects
?
"
follow
"
:
"
error
"
}
)
;
if
(
response
.
ok
)
{
if
(
response
.
headers
.
get
(
"
Content
-
Type
"
)
=
=
=
"
application
/
wasm
"
)
{
const
buffer
=
await
response
.
arrayBuffer
(
)
;
return
{
content
:
buffer
isDwarf
:
true
}
;
}
const
text
=
await
response
.
text
(
)
;
return
{
content
:
text
}
;
}
throw
new
Error
(
request
failed
with
status
{
response
.
status
}
)
;
}
module
.
exports
=
{
networkRequest
}
;
