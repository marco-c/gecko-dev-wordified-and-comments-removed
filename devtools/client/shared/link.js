"
use
strict
"
;
const
{
gDevTools
}
=
require
(
"
devtools
/
client
/
framework
/
devtools
"
)
;
const
{
TabDescriptorFactory
}
=
require
(
"
devtools
/
client
/
framework
/
tab
-
descriptor
-
factory
"
)
;
function
_getTopWindow
(
)
{
let
win
=
Services
.
wm
.
getMostRecentWindow
(
gDevTools
.
chromeWindowType
)
;
if
(
win
?
.
openWebLinkIn
&
&
win
?
.
openTrustedLinkIn
)
{
return
win
;
}
win
=
Services
.
wm
.
getMostRecentWindow
(
null
)
;
if
(
win
?
.
openWebLinkIn
&
&
win
?
.
openTrustedLinkIn
)
{
return
win
;
}
return
null
;
}
exports
.
openDocLink
=
async
function
(
url
options
)
{
const
top
=
_getTopWindow
(
)
;
if
(
!
top
)
{
return
;
}
top
.
openWebLinkIn
(
url
"
tab
"
options
)
;
}
;
exports
.
openContentLink
=
async
function
(
url
options
=
{
}
)
{
const
top
=
_getTopWindow
(
)
;
if
(
!
top
)
{
return
;
}
if
(
!
options
.
triggeringPrincipal
&
&
top
.
gBrowser
)
{
const
tab
=
top
.
gBrowser
.
selectedTab
;
if
(
TabDescriptorFactory
.
isKnownTab
(
tab
)
)
{
options
.
triggeringPrincipal
=
tab
.
linkedBrowser
.
contentPrincipal
;
options
.
csp
=
tab
.
linkedBrowser
.
csp
;
}
}
top
.
openWebLinkIn
(
url
"
tab
"
options
)
;
}
;
exports
.
openTrustedLink
=
async
function
(
url
options
)
{
const
top
=
_getTopWindow
(
)
;
if
(
!
top
)
{
return
;
}
top
.
openTrustedLinkIn
(
url
"
tab
"
options
)
;
}
;
