"
use
strict
"
;
const
asyncStoreHelper
=
require
(
"
resource
:
/
/
devtools
/
client
/
shared
/
async
-
store
-
helper
.
js
"
)
;
const
{
validateBreakpointLocation
}
=
ChromeUtils
.
importESModule
(
"
resource
:
/
/
devtools
/
shared
/
validate
-
breakpoint
.
sys
.
mjs
"
{
global
:
"
contextual
"
}
)
;
const
asyncStore
=
asyncStoreHelper
(
"
debugger
"
{
pendingBreakpoints
:
[
"
pending
-
breakpoints
"
{
}
]
openedURLs
:
[
"
openedURLs
"
[
]
]
prettyPrintedURLs
:
[
"
pretty
-
printed
-
urls
"
[
]
]
xhrBreakpoints
:
[
"
xhr
-
breakpoints
"
[
]
]
eventListenerBreakpoints
:
[
"
event
-
listener
-
breakpoints
"
undefined
]
blackboxedRanges
:
[
"
blackboxedRanges
"
{
}
]
directoryRoots
:
[
"
directory
-
roots
"
{
}
]
}
)
;
exports
.
asyncStore
=
asyncStore
;
exports
.
getThreadOptions
=
async
function
(
)
{
return
{
shouldPauseOnDebuggerStatement
:
Services
.
prefs
.
getBoolPref
(
"
devtools
.
debugger
.
pause
-
on
-
debugger
-
statement
"
)
pauseOnExceptions
:
Services
.
prefs
.
getBoolPref
(
"
devtools
.
debugger
.
pause
-
on
-
exceptions
"
)
ignoreCaughtExceptions
:
Services
.
prefs
.
getBoolPref
(
"
devtools
.
debugger
.
ignore
-
caught
-
exceptions
"
)
shouldIncludeSavedFrames
:
Services
.
prefs
.
getBoolPref
(
"
devtools
.
debugger
.
features
.
async
-
captured
-
stacks
"
)
shouldIncludeAsyncLiveFrames
:
Services
.
prefs
.
getBoolPref
(
"
devtools
.
debugger
.
features
.
async
-
live
-
stacks
"
)
skipBreakpoints
:
Services
.
prefs
.
getBoolPref
(
"
devtools
.
debugger
.
skip
-
pausing
"
)
logEventBreakpoints
:
Services
.
prefs
.
getBoolPref
(
"
devtools
.
debugger
.
log
-
event
-
breakpoints
"
)
observeAsmJS
:
true
breakpoints
:
sanitizeBreakpoints
(
await
asyncStore
.
pendingBreakpoints
)
eventBreakpoints
:
(
(
await
asyncStore
.
eventListenerBreakpoints
)
|
|
{
}
)
.
active
|
|
[
]
}
;
}
;
function
sanitizeBreakpoints
(
breakpoints
)
{
if
(
typeof
breakpoints
!
=
"
object
"
)
{
return
{
}
;
}
const
validBreakpoints
=
{
}
;
for
(
const
key
in
breakpoints
)
{
const
bp
=
breakpoints
[
key
]
;
try
{
if
(
!
bp
)
{
throw
new
Error
(
"
Undefined
breakpoint
"
)
;
}
validateBreakpointLocation
(
bp
.
generatedLocation
)
;
validateBreakpointLocation
(
bp
.
location
)
;
validBreakpoints
[
key
]
=
bp
;
}
catch
(
e
)
{
console
.
error
(
"
Ignore
invalid
breakpoint
from
debugger
store
"
bp
e
.
message
)
;
}
}
return
validBreakpoints
;
}
exports
.
sanitizeBreakpoints
=
sanitizeBreakpoints
;
