"
use
strict
"
;
const
{
LocalizationHelper
}
=
require
(
"
devtools
/
client
/
shared
/
l10n
"
)
;
const
l10n
=
new
LocalizationHelper
(
"
chrome
:
/
/
devtools
/
locale
/
components
.
properties
"
)
;
const
UNKNOWN_SOURCE_STRING
=
l10n
.
getStr
(
"
frame
.
unknownSource
"
)
;
const
CHAR_CODE_A
=
"
a
"
.
charCodeAt
(
0
)
;
const
CHAR_CODE_C
=
"
c
"
.
charCodeAt
(
0
)
;
const
CHAR_CODE_D
=
"
d
"
.
charCodeAt
(
0
)
;
const
CHAR_CODE_E
=
"
e
"
.
charCodeAt
(
0
)
;
const
CHAR_CODE_F
=
"
f
"
.
charCodeAt
(
0
)
;
const
CHAR_CODE_H
=
"
h
"
.
charCodeAt
(
0
)
;
const
CHAR_CODE_I
=
"
i
"
.
charCodeAt
(
0
)
;
const
CHAR_CODE_J
=
"
j
"
.
charCodeAt
(
0
)
;
const
CHAR_CODE_L
=
"
l
"
.
charCodeAt
(
0
)
;
const
CHAR_CODE_M
=
"
m
"
.
charCodeAt
(
0
)
;
const
CHAR_CODE_O
=
"
o
"
.
charCodeAt
(
0
)
;
const
CHAR_CODE_P
=
"
p
"
.
charCodeAt
(
0
)
;
const
CHAR_CODE_R
=
"
r
"
.
charCodeAt
(
0
)
;
const
CHAR_CODE_S
=
"
s
"
.
charCodeAt
(
0
)
;
const
CHAR_CODE_T
=
"
t
"
.
charCodeAt
(
0
)
;
const
CHAR_CODE_U
=
"
u
"
.
charCodeAt
(
0
)
;
const
CHAR_CODE_COLON
=
"
:
"
.
charCodeAt
(
0
)
;
const
CHAR_CODE_SLASH
=
"
/
"
.
charCodeAt
(
0
)
;
const
CHAR_CODE_CAP_S
=
"
S
"
.
charCodeAt
(
0
)
;
const
gURLStore
=
new
Map
(
)
;
const
gSourceNamesStore
=
new
Map
(
)
;
function
parseURL
(
location
)
{
let
url
=
gURLStore
.
get
(
location
)
;
if
(
url
!
=
=
void
0
)
{
return
url
;
}
try
{
url
=
new
URL
(
location
)
;
url
=
{
href
:
url
.
href
protocol
:
url
.
protocol
host
:
url
.
host
hostname
:
url
.
hostname
port
:
url
.
port
|
|
null
pathname
:
url
.
pathname
search
:
url
.
search
hash
:
url
.
hash
username
:
url
.
username
password
:
url
.
password
origin
:
url
.
origin
}
;
let
isChrome
=
isChromeScheme
(
location
)
;
url
.
fileName
=
url
.
pathname
?
(
url
.
pathname
.
slice
(
url
.
pathname
.
lastIndexOf
(
"
/
"
)
+
1
)
|
|
"
/
"
)
:
"
/
"
;
if
(
isChrome
)
{
url
.
hostname
=
null
;
url
.
host
=
null
;
}
gURLStore
.
set
(
location
url
)
;
return
url
;
}
catch
(
e
)
{
gURLStore
.
set
(
location
null
)
;
return
null
;
}
}
function
getSourceNames
(
source
)
{
let
data
=
gSourceNamesStore
.
get
(
source
)
;
if
(
data
)
{
return
data
;
}
let
short
long
host
;
const
sourceStr
=
source
?
String
(
source
)
:
"
"
;
if
(
isDataScheme
(
sourceStr
)
)
{
let
commaIndex
=
sourceStr
.
indexOf
(
"
"
)
;
if
(
commaIndex
>
-
1
)
{
short
=
data
:
{
sourceStr
.
substring
(
commaIndex
+
1
)
}
.
slice
(
0
100
)
;
let
result
=
{
short
long
:
sourceStr
}
;
gSourceNamesStore
.
set
(
source
result
)
;
return
result
;
}
}
if
(
isScratchpadScheme
(
sourceStr
)
)
{
let
result
=
{
short
:
sourceStr
long
:
sourceStr
}
;
gSourceNamesStore
.
set
(
source
result
)
;
return
result
;
}
const
parsedUrl
=
parseURL
(
sourceStr
)
;
if
(
!
parsedUrl
)
{
long
=
sourceStr
;
short
=
sourceStr
.
slice
(
0
100
)
;
}
else
{
host
=
parsedUrl
.
host
;
long
=
parsedUrl
.
href
;
if
(
parsedUrl
.
hash
)
{
long
=
long
.
replace
(
parsedUrl
.
hash
"
"
)
;
}
if
(
parsedUrl
.
search
)
{
long
=
long
.
replace
(
parsedUrl
.
search
"
"
)
;
}
short
=
parsedUrl
.
fileName
;
if
(
short
=
=
=
"
/
"
&
&
parsedUrl
.
pathname
!
=
=
"
/
"
)
{
short
=
parseURL
(
long
.
replace
(
/
\
/
/
"
"
)
)
.
fileName
;
}
}
if
(
!
short
)
{
if
(
!
long
)
{
long
=
UNKNOWN_SOURCE_STRING
;
}
short
=
long
.
slice
(
0
100
)
;
}
let
result
=
{
short
long
host
}
;
gSourceNamesStore
.
set
(
source
result
)
;
return
result
;
}
function
isColonSlashSlash
(
location
i
=
0
)
{
return
location
.
charCodeAt
(
+
+
i
)
=
=
=
CHAR_CODE_COLON
&
&
location
.
charCodeAt
(
+
+
i
)
=
=
=
CHAR_CODE_SLASH
&
&
location
.
charCodeAt
(
+
+
i
)
=
=
=
CHAR_CODE_SLASH
;
}
function
isScratchpadScheme
(
location
i
=
0
)
{
return
location
.
charCodeAt
(
i
)
=
=
=
CHAR_CODE_CAP_S
&
&
location
.
charCodeAt
(
+
+
i
)
=
=
=
CHAR_CODE_C
&
&
location
.
charCodeAt
(
+
+
i
)
=
=
=
CHAR_CODE_R
&
&
location
.
charCodeAt
(
+
+
i
)
=
=
=
CHAR_CODE_A
&
&
location
.
charCodeAt
(
+
+
i
)
=
=
=
CHAR_CODE_T
&
&
location
.
charCodeAt
(
+
+
i
)
=
=
=
CHAR_CODE_C
&
&
location
.
charCodeAt
(
+
+
i
)
=
=
=
CHAR_CODE_H
&
&
location
.
charCodeAt
(
+
+
i
)
=
=
=
CHAR_CODE_P
&
&
location
.
charCodeAt
(
+
+
i
)
=
=
=
CHAR_CODE_A
&
&
location
.
charCodeAt
(
+
+
i
)
=
=
=
CHAR_CODE_D
&
&
location
.
charCodeAt
(
+
+
i
)
=
=
=
CHAR_CODE_SLASH
;
}
function
isDataScheme
(
location
i
=
0
)
{
return
location
.
charCodeAt
(
i
)
=
=
=
CHAR_CODE_D
&
&
location
.
charCodeAt
(
+
+
i
)
=
=
=
CHAR_CODE_A
&
&
location
.
charCodeAt
(
+
+
i
)
=
=
=
CHAR_CODE_T
&
&
location
.
charCodeAt
(
+
+
i
)
=
=
=
CHAR_CODE_A
&
&
location
.
charCodeAt
(
+
+
i
)
=
=
=
CHAR_CODE_COLON
;
}
function
isContentScheme
(
location
i
=
0
)
{
let
firstChar
=
location
.
charCodeAt
(
i
)
;
switch
(
firstChar
)
{
case
CHAR_CODE_H
:
if
(
location
.
charCodeAt
(
+
+
i
)
=
=
=
CHAR_CODE_T
&
&
location
.
charCodeAt
(
+
+
i
)
=
=
=
CHAR_CODE_T
&
&
location
.
charCodeAt
(
+
+
i
)
=
=
=
CHAR_CODE_P
)
{
if
(
location
.
charCodeAt
(
i
+
1
)
=
=
=
CHAR_CODE_S
)
{
+
+
i
;
}
return
isColonSlashSlash
(
location
i
)
;
}
return
false
;
case
CHAR_CODE_F
:
if
(
location
.
charCodeAt
(
+
+
i
)
=
=
=
CHAR_CODE_I
&
&
location
.
charCodeAt
(
+
+
i
)
=
=
=
CHAR_CODE_L
&
&
location
.
charCodeAt
(
+
+
i
)
=
=
=
CHAR_CODE_E
)
{
return
isColonSlashSlash
(
location
i
)
;
}
return
false
;
case
CHAR_CODE_A
:
if
(
location
.
charCodeAt
(
+
+
i
)
=
=
CHAR_CODE_P
&
&
location
.
charCodeAt
(
+
+
i
)
=
=
CHAR_CODE_P
)
{
return
isColonSlashSlash
(
location
i
)
;
}
return
false
;
default
:
return
false
;
}
}
function
isChromeScheme
(
location
i
=
0
)
{
let
firstChar
=
location
.
charCodeAt
(
i
)
;
switch
(
firstChar
)
{
case
CHAR_CODE_C
:
if
(
location
.
charCodeAt
(
+
+
i
)
=
=
=
CHAR_CODE_H
&
&
location
.
charCodeAt
(
+
+
i
)
=
=
=
CHAR_CODE_R
&
&
location
.
charCodeAt
(
+
+
i
)
=
=
=
CHAR_CODE_O
&
&
location
.
charCodeAt
(
+
+
i
)
=
=
=
CHAR_CODE_M
&
&
location
.
charCodeAt
(
+
+
i
)
=
=
=
CHAR_CODE_E
)
{
return
isColonSlashSlash
(
location
i
)
;
}
return
false
;
case
CHAR_CODE_R
:
if
(
location
.
charCodeAt
(
+
+
i
)
=
=
=
CHAR_CODE_E
&
&
location
.
charCodeAt
(
+
+
i
)
=
=
=
CHAR_CODE_S
&
&
location
.
charCodeAt
(
+
+
i
)
=
=
=
CHAR_CODE_O
&
&
location
.
charCodeAt
(
+
+
i
)
=
=
=
CHAR_CODE_U
&
&
location
.
charCodeAt
(
+
+
i
)
=
=
=
CHAR_CODE_R
&
&
location
.
charCodeAt
(
+
+
i
)
=
=
=
CHAR_CODE_C
&
&
location
.
charCodeAt
(
+
+
i
)
=
=
=
CHAR_CODE_E
)
{
return
isColonSlashSlash
(
location
i
)
;
}
return
false
;
case
CHAR_CODE_J
:
if
(
location
.
charCodeAt
(
+
+
i
)
=
=
=
CHAR_CODE_A
&
&
location
.
charCodeAt
(
+
+
i
)
=
=
=
CHAR_CODE_R
&
&
location
.
charCodeAt
(
+
+
i
)
=
=
=
CHAR_CODE_COLON
&
&
location
.
charCodeAt
(
+
+
i
)
=
=
=
CHAR_CODE_F
&
&
location
.
charCodeAt
(
+
+
i
)
=
=
=
CHAR_CODE_I
&
&
location
.
charCodeAt
(
+
+
i
)
=
=
=
CHAR_CODE_L
&
&
location
.
charCodeAt
(
+
+
i
)
=
=
=
CHAR_CODE_E
)
{
return
isColonSlashSlash
(
location
i
)
;
}
return
false
;
default
:
return
false
;
}
}
function
getSourceMappedFile
(
source
)
{
if
(
source
.
lastIndexOf
(
"
/
"
)
>
=
0
)
{
source
=
source
.
slice
(
source
.
lastIndexOf
(
"
/
"
)
+
1
)
;
}
else
if
(
source
.
lastIndexOf
(
"
\
\
"
)
>
=
0
)
{
source
=
source
.
slice
(
source
.
lastIndexOf
(
"
\
\
"
)
+
1
)
;
}
return
source
;
}
exports
.
parseURL
=
parseURL
;
exports
.
getSourceNames
=
getSourceNames
;
exports
.
isScratchpadScheme
=
isScratchpadScheme
;
exports
.
isChromeScheme
=
isChromeScheme
;
exports
.
isContentScheme
=
isContentScheme
;
exports
.
isDataScheme
=
isDataScheme
;
exports
.
getSourceMappedFile
=
getSourceMappedFile
;
