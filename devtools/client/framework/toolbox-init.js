"
use
strict
"
;
const
href
=
window
.
location
.
href
.
replace
(
"
about
:
"
"
http
:
/
/
"
)
;
const
url
=
new
window
.
URL
(
href
)
;
if
(
url
.
search
.
length
>
1
)
{
const
{
require
}
=
ChromeUtils
.
import
(
"
resource
:
/
/
devtools
/
shared
/
Loader
.
jsm
"
)
;
const
{
gDevTools
}
=
require
(
"
devtools
/
client
/
framework
/
devtools
"
)
;
const
{
targetFromURL
}
=
require
(
"
devtools
/
client
/
framework
/
target
-
from
-
url
"
)
;
const
{
Toolbox
}
=
require
(
"
devtools
/
client
/
framework
/
toolbox
"
)
;
const
{
TargetFactory
}
=
require
(
"
devtools
/
client
/
framework
/
target
"
)
;
const
{
DebuggerServer
}
=
require
(
"
devtools
/
server
/
main
"
)
;
const
{
DebuggerClient
}
=
require
(
"
devtools
/
shared
/
client
/
debugger
-
client
"
)
;
let
host
=
window
.
windowUtils
.
containerElement
;
if
(
!
host
)
{
host
=
{
contentWindow
:
window
contentDocument
:
document
setAttribute
(
)
{
}
ownerDocument
:
document
addEventListener
(
)
{
}
}
;
}
const
tool
=
url
.
searchParams
.
get
(
"
tool
"
)
;
(
async
function
(
)
{
let
target
;
if
(
url
.
searchParams
.
has
(
"
target
"
)
)
{
let
iframe
=
host
.
wrappedJSObject
?
host
.
wrappedJSObject
.
target
:
host
.
target
;
if
(
!
iframe
)
{
throw
new
Error
(
"
Unable
to
find
the
targeted
iframe
to
debug
"
)
;
}
iframe
=
XPCNativeWrapper
(
iframe
)
;
const
tab
=
{
linkedBrowser
:
iframe
}
;
DebuggerServer
.
init
(
)
;
DebuggerServer
.
registerAllActors
(
)
;
const
client
=
new
DebuggerClient
(
DebuggerServer
.
connectPipe
(
)
)
;
await
client
.
connect
(
)
;
const
front
=
await
client
.
mainRoot
.
getTab
(
{
tab
}
)
;
target
=
await
TargetFactory
.
forRemoteTab
(
{
client
activeTab
:
front
chrome
:
false
}
)
;
}
else
{
target
=
await
targetFromURL
(
url
)
;
}
const
options
=
{
customIframe
:
host
}
;
await
gDevTools
.
showToolbox
(
target
tool
Toolbox
.
HostType
.
PAGE
options
)
;
}
)
(
)
.
catch
(
error
=
>
{
console
.
error
(
"
Exception
while
loading
the
toolbox
"
error
)
;
}
)
;
}
