"
use
strict
"
;
const
{
Component
createFactory
}
=
require
(
"
devtools
/
client
/
shared
/
vendor
/
react
"
)
;
const
ToolboxToolbar
=
createFactory
(
require
(
"
devtools
/
client
/
framework
/
components
/
toolbox
-
toolbar
"
)
)
;
const
ELEMENT_PICKER_ID
=
"
command
-
button
-
pick
"
;
class
ToolboxController
extends
Component
{
constructor
(
props
context
)
{
super
(
props
context
)
;
this
.
state
=
{
focusedButton
:
ELEMENT_PICKER_ID
toolboxButtons
:
[
]
currentToolId
:
null
highlightedTools
:
new
Set
(
)
panelDefinitions
:
[
]
hostTypes
:
[
]
areDockOptionsEnabled
:
true
canCloseToolbox
:
true
canRender
:
false
buttonIds
:
[
]
checkedButtonsUpdated
:
(
)
=
>
{
this
.
forceUpdate
(
)
;
}
}
;
this
.
setFocusedButton
=
this
.
setFocusedButton
.
bind
(
this
)
;
this
.
setToolboxButtons
=
this
.
setToolboxButtons
.
bind
(
this
)
;
this
.
setCurrentToolId
=
this
.
setCurrentToolId
.
bind
(
this
)
;
this
.
highlightTool
=
this
.
highlightTool
.
bind
(
this
)
;
this
.
unhighlightTool
=
this
.
unhighlightTool
.
bind
(
this
)
;
this
.
setHostTypes
=
this
.
setHostTypes
.
bind
(
this
)
;
this
.
setDockOptionsEnabled
=
this
.
setDockOptionsEnabled
.
bind
(
this
)
;
this
.
setCanCloseToolbox
=
this
.
setCanCloseToolbox
.
bind
(
this
)
;
this
.
setCanRender
=
this
.
setCanRender
.
bind
(
this
)
;
this
.
setPanelDefinitions
=
this
.
setPanelDefinitions
.
bind
(
this
)
;
this
.
updateButtonIds
=
this
.
updateButtonIds
.
bind
(
this
)
;
this
.
updateFocusedButton
=
this
.
updateFocusedButton
.
bind
(
this
)
;
}
shouldComponentUpdate
(
)
{
return
this
.
state
.
canRender
;
}
componentWillUnmount
(
)
{
this
.
state
.
toolboxButtons
.
forEach
(
button
=
>
{
button
.
off
(
"
updatechecked
"
this
.
state
.
checkedButtonsUpdated
)
;
}
)
;
}
updateButtonIds
(
)
{
const
{
toolboxButtons
panelDefinitions
canCloseToolbox
}
=
this
.
state
;
this
.
setState
(
{
buttonIds
:
[
.
.
.
toolboxButtons
.
filter
(
btn
=
>
btn
.
isInStartContainer
)
.
map
(
(
{
id
}
)
=
>
id
)
.
.
.
panelDefinitions
.
map
(
(
{
id
}
)
=
>
id
)
.
.
.
toolboxButtons
.
filter
(
btn
=
>
!
btn
.
isInStartContainer
)
.
map
(
(
{
id
}
)
=
>
id
)
canCloseToolbox
?
"
toolbox
-
close
"
:
null
]
.
filter
(
id
=
>
id
)
}
)
;
this
.
updateFocusedButton
(
)
;
}
updateFocusedButton
(
)
{
this
.
setFocusedButton
(
this
.
state
.
focusedButton
)
;
}
setFocusedButton
(
focusedButton
)
{
const
{
buttonIds
}
=
this
.
state
;
focusedButton
=
focusedButton
&
&
buttonIds
.
includes
(
focusedButton
)
?
focusedButton
:
buttonIds
[
0
]
;
if
(
this
.
state
.
focusedButton
!
=
=
focusedButton
)
{
this
.
setState
(
{
focusedButton
}
)
;
}
}
setCurrentToolId
(
currentToolId
)
{
this
.
setState
(
{
currentToolId
}
(
)
=
>
{
this
.
setFocusedButton
(
currentToolId
)
;
}
)
;
}
setCanRender
(
)
{
this
.
setState
(
{
canRender
:
true
}
this
.
updateButtonIds
)
;
}
highlightTool
(
highlightedTool
)
{
let
{
highlightedTools
}
=
this
.
state
;
highlightedTools
.
add
(
highlightedTool
)
;
this
.
setState
(
{
highlightedTools
}
)
;
}
unhighlightTool
(
id
)
{
let
{
highlightedTools
}
=
this
.
state
;
if
(
highlightedTools
.
has
(
id
)
)
{
highlightedTools
.
delete
(
id
)
;
this
.
setState
(
{
highlightedTools
}
)
;
}
}
setDockOptionsEnabled
(
areDockOptionsEnabled
)
{
this
.
setState
(
{
areDockOptionsEnabled
}
)
;
}
setHostTypes
(
hostTypes
)
{
this
.
setState
(
{
hostTypes
}
)
;
}
setCanCloseToolbox
(
canCloseToolbox
)
{
this
.
setState
(
{
canCloseToolbox
}
this
.
updateButtonIds
)
;
}
setPanelDefinitions
(
panelDefinitions
)
{
this
.
setState
(
{
panelDefinitions
}
this
.
updateButtonIds
)
;
}
get
panelDefinitions
(
)
{
return
this
.
state
.
panelDefinitions
;
}
setToolboxButtons
(
toolboxButtons
)
{
this
.
state
.
toolboxButtons
.
forEach
(
button
=
>
{
button
.
off
(
"
updatechecked
"
this
.
state
.
checkedButtonsUpdated
)
;
}
)
;
toolboxButtons
.
forEach
(
button
=
>
{
button
.
on
(
"
updatechecked
"
this
.
state
.
checkedButtonsUpdated
)
;
}
)
;
this
.
setState
(
{
toolboxButtons
}
this
.
updateButtonIds
)
;
}
render
(
)
{
return
ToolboxToolbar
(
Object
.
assign
(
{
}
this
.
props
this
.
state
)
)
;
}
}
module
.
exports
=
ToolboxController
;
