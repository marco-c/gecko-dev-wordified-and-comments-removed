const
TEST_URL
=
"
data
:
text
/
html
test
for
opening
toolbox
in
different
hosts
"
;
var
{
Toolbox
}
=
require
(
"
devtools
/
client
/
framework
/
toolbox
"
)
;
var
toolbox
tab1
tab2
;
function
test
(
)
{
addTab
(
TEST_URL
)
.
then
(
async
(
tab
)
=
>
{
tab2
=
BrowserTestUtils
.
addTab
(
gBrowser
)
;
const
target
=
await
TargetFactory
.
forTab
(
tab
)
;
gDevTools
.
showToolbox
(
target
)
.
then
(
testBottomHost
console
.
error
)
.
catch
(
console
.
error
)
;
}
)
;
}
function
testBottomHost
(
aToolbox
)
{
toolbox
=
aToolbox
;
gBrowser
.
selectedTab
=
tab2
;
executeSoon
(
function
(
)
{
is
(
gBrowser
.
selectedTab
tab2
"
Correct
tab
is
selected
before
calling
raise
"
)
;
toolbox
.
raise
(
)
;
executeSoon
(
function
(
)
{
is
(
gBrowser
.
selectedTab
tab1
"
Correct
tab
was
selected
after
calling
raise
"
)
;
toolbox
.
switchHost
(
Toolbox
.
HostType
.
WINDOW
)
.
then
(
testWindowHost
)
.
catch
(
console
.
error
)
;
}
)
;
}
)
;
}
function
testWindowHost
(
)
{
window
.
addEventListener
(
"
focus
"
onFocus
true
)
;
const
onToolboxFocus
=
(
)
=
>
{
toolbox
.
win
.
parent
.
removeEventListener
(
"
focus
"
onToolboxFocus
true
)
;
info
(
"
focusing
main
window
.
"
)
;
window
.
focus
(
)
;
}
;
toolbox
.
win
.
parent
.
addEventListener
(
"
focus
"
onToolboxFocus
true
)
;
}
function
onFocus
(
)
{
info
(
"
Main
window
is
focused
before
calling
toolbox
.
raise
(
)
"
)
;
window
.
removeEventListener
(
"
focus
"
onFocus
true
)
;
const
onToolboxFocusAgain
=
(
)
=
>
{
toolbox
.
win
.
parent
.
removeEventListener
(
"
focus
"
onToolboxFocusAgain
)
;
ok
(
true
"
Toolbox
window
is
the
focused
window
after
calling
toolbox
.
raise
(
)
"
)
;
cleanup
(
)
;
}
;
toolbox
.
win
.
parent
.
addEventListener
(
"
focus
"
onToolboxFocusAgain
)
;
toolbox
.
raise
(
)
;
}
function
cleanup
(
)
{
Services
.
prefs
.
setCharPref
(
"
devtools
.
toolbox
.
host
"
Toolbox
.
HostType
.
BOTTOM
)
;
toolbox
.
destroy
(
)
.
then
(
function
(
)
{
toolbox
=
null
;
gBrowser
.
removeCurrentTab
(
)
;
gBrowser
.
removeCurrentTab
(
)
;
finish
(
)
;
}
)
;
}
