const
{
Toolbox
}
=
require
(
"
devtools
/
client
/
framework
/
toolbox
"
)
;
add_task
(
async
function
(
)
{
const
iframe
=
document
.
createXULElement
(
"
browser
"
)
;
iframe
.
setAttribute
(
"
type
"
"
content
"
)
;
document
.
documentElement
.
appendChild
(
iframe
)
;
let
onLoad
=
once
(
iframe
"
load
"
true
)
;
iframe
.
setAttribute
(
"
src
"
"
data
:
text
/
html
document
to
debug
"
)
;
await
onLoad
;
is
(
iframe
.
contentWindow
.
document
.
body
.
innerHTML
"
document
to
debug
"
)
;
const
toolboxIframe
=
document
.
createXULElement
(
"
iframe
"
)
;
document
.
documentElement
.
appendChild
(
toolboxIframe
)
;
toolboxIframe
.
target
=
iframe
;
const
onToolboxReady
=
gDevTools
.
once
(
"
toolbox
-
ready
"
)
;
onLoad
=
once
(
toolboxIframe
"
load
"
true
)
;
toolboxIframe
.
setAttribute
(
"
src
"
"
about
:
devtools
-
toolbox
?
target
"
)
;
await
onLoad
;
info
(
"
Waiting
for
toolbox
-
ready
"
)
;
const
toolbox
=
await
onToolboxReady
;
is
(
toolbox
.
hostType
Toolbox
.
HostType
.
PAGE
"
Host
type
of
this
toolbox
shuld
be
Toolbox
.
HostType
.
PAGE
"
)
;
const
onToolboxDestroyed
=
gDevTools
.
once
(
"
toolbox
-
destroyed
"
)
;
const
onTabDetached
=
toolbox
.
target
.
once
(
"
tabDetached
"
)
;
info
(
"
Removing
the
iframes
"
)
;
toolboxIframe
.
remove
(
)
;
info
(
"
Waiting
for
toolbox
-
destroyed
"
)
;
await
onToolboxDestroyed
;
info
(
"
Toolbox
destroyed
"
)
;
await
onTabDetached
;
iframe
.
remove
(
)
;
}
)
;
