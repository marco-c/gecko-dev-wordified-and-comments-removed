"
use
strict
"
;
const
{
DevToolsClient
}
=
require
(
"
devtools
/
client
/
devtools
-
client
"
)
;
const
{
DevToolsServer
}
=
require
(
"
devtools
/
server
/
devtools
-
server
"
)
;
add_task
(
async
(
)
=
>
{
await
pushPref
(
"
dom
.
ipc
.
processPrelaunch
.
enabled
"
false
)
;
await
pushPref
(
"
dom
.
ipc
.
keepProcessesAlive
.
web
"
1
)
;
DevToolsServer
.
init
(
)
;
DevToolsServer
.
registerAllActors
(
)
;
DevToolsServer
.
allowChromeProcess
=
true
;
const
transport
=
DevToolsServer
.
connectPipe
(
)
;
const
client
=
new
DevToolsClient
(
transport
)
;
await
client
.
connect
(
)
;
const
tab
=
await
BrowserTestUtils
.
openNewForegroundTab
(
{
gBrowser
url
:
"
data
:
text
/
html
foo
"
forceNewProcess
:
true
}
)
;
const
{
osPid
}
=
tab
.
linkedBrowser
.
browsingContext
.
currentWindowGlobal
;
const
descriptor
=
await
client
.
mainRoot
.
getProcess
(
osPid
)
;
ok
(
descriptor
"
Got
the
process
descriptor
"
)
;
is
(
descriptor
.
id
osPid
"
descriptor
id
is
the
PID
"
)
;
is
(
descriptor
.
isParent
false
"
isParent
is
false
for
content
processes
"
)
;
await
descriptor
.
getTarget
(
)
;
const
onDestroyed
=
descriptor
.
once
(
"
descriptor
-
destroyed
"
)
;
BrowserTestUtils
.
removeTab
(
tab
)
;
info
(
"
Wait
for
descriptor
destruction
"
)
;
await
onDestroyed
;
await
client
.
close
(
)
;
}
)
;
