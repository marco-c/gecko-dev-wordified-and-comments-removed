"
use
strict
"
;
add_task
(
async
(
)
=
>
{
await
pushPref
(
"
dom
.
ipc
.
processPrelaunch
.
enabled
"
false
)
;
await
pushPref
(
"
dom
.
ipc
.
keepProcessesAlive
.
web
"
1
)
;
const
tab
=
await
BrowserTestUtils
.
openNewForegroundTab
(
{
gBrowser
url
:
"
data
:
text
/
html
foo
"
forceNewProcess
:
true
}
)
;
const
{
osPid
}
=
tab
.
linkedBrowser
.
browsingContext
.
currentWindowGlobal
;
const
commands
=
await
CommandsFactory
.
forProcess
(
osPid
)
;
const
descriptor
=
commands
.
descriptorFront
;
ok
(
descriptor
"
Got
the
process
descriptor
"
)
;
is
(
descriptor
.
id
osPid
"
descriptor
id
is
the
PID
"
)
;
is
(
descriptor
.
isParentProcessDescriptor
false
"
isParentProcessDescriptor
is
false
for
content
processes
"
)
;
await
descriptor
.
getTarget
(
)
;
const
onDestroyed
=
descriptor
.
once
(
"
descriptor
-
destroyed
"
)
;
BrowserTestUtils
.
removeTab
(
tab
)
;
info
(
"
Wait
for
descriptor
destruction
"
)
;
await
onDestroyed
;
await
commands
.
destroy
(
)
;
}
)
;
