"
use
strict
"
;
const
{
DevToolsServer
}
=
require
(
"
resource
:
/
/
devtools
/
server
/
devtools
-
server
.
js
"
)
;
requestLongerTimeout
(
2
)
;
function
runTools
(
tab
)
{
return
(
async
function
(
)
{
let
toolbox
;
const
toolIds
=
await
getSupportedToolIds
(
tab
)
;
for
(
const
toolId
of
toolIds
)
{
info
(
"
About
to
open
"
+
toolId
)
;
toolbox
=
await
gDevTools
.
showToolboxForTab
(
tab
{
toolId
hostType
:
"
window
"
}
)
;
ok
(
toolbox
"
toolbox
exists
for
"
+
toolId
)
;
is
(
toolbox
.
currentToolId
toolId
"
currentToolId
should
be
"
+
toolId
)
;
const
panel
=
toolbox
.
getCurrentPanel
(
)
;
ok
(
panel
toolId
+
"
panel
has
been
registered
in
the
toolbox
"
)
;
}
const
client
=
toolbox
.
commands
.
client
;
await
toolbox
.
destroy
(
)
;
return
client
;
}
)
(
)
;
}
function
test
(
)
{
(
async
function
(
)
{
toggleAllTools
(
true
)
;
const
tab
=
await
addTab
(
"
about
:
blank
"
)
;
const
client
=
await
runTools
(
tab
)
;
const
rootFronts
=
[
.
.
.
client
.
mainRoot
.
fronts
.
values
(
)
]
;
for
(
const
pool
of
client
.
__pools
)
{
if
(
!
pool
.
__poolMap
)
{
continue
;
}
if
(
rootFronts
.
includes
(
pool
)
)
{
continue
;
}
for
(
const
actor
of
pool
.
__poolMap
.
keys
(
)
)
{
if
(
actor
=
=
"
root
"
)
{
continue
;
}
ok
(
false
"
Front
for
"
+
actor
+
"
still
held
in
pool
!
"
)
;
}
}
gBrowser
.
removeCurrentTab
(
)
;
DevToolsServer
.
destroy
(
)
;
toggleAllTools
(
false
)
;
finish
(
)
;
}
)
(
)
;
}
