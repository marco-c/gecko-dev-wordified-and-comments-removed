const
TEST_URL
=
data
:
text
/
html
<
script
>
window
.
someInlineSource
{
Date
.
now
(
)
}
=
(
)
=
>
{
}
<
/
script
>
;
add_task
(
async
function
(
)
{
await
pushPref
(
"
devtools
.
browsertoolbox
.
scope
"
"
everything
"
)
;
const
commands
=
await
CommandsFactory
.
forMainProcess
(
{
enableWindowGlobalThreadActors
:
true
}
)
;
await
commands
.
targetCommand
.
startListening
(
)
;
await
addTab
(
TEST_URL
)
;
const
sources
=
[
]
;
await
commands
.
resourceCommand
.
watchResources
(
[
commands
.
resourceCommand
.
TYPES
.
SOURCE
]
{
onAvailable
(
resources
)
{
sources
.
push
(
.
.
.
resources
)
;
}
}
)
;
const
sourceForTab
=
sources
.
filter
(
s
=
>
s
.
url
=
=
TEST_URL
)
.
map
(
s
=
>
s
.
targetFront
.
targetType
)
;
is
(
sourceForTab
.
length
2
"
We
should
get
two
source
matching
the
tab
url
.
One
for
the
content
process
target
and
another
copy
for
the
window
global
target
"
)
;
ok
(
sourceForTab
.
includes
(
"
process
"
)
"
We
got
a
source
from
the
content
process
target
"
)
;
ok
(
sourceForTab
.
includes
(
"
frame
"
)
"
We
got
a
source
from
the
window
global
target
"
)
;
await
commands
.
destroy
(
)
;
}
)
;
