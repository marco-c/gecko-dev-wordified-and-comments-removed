const
{
PromiseTestUtils
}
=
ChromeUtils
.
import
(
"
resource
:
/
/
testing
-
common
/
PromiseTestUtils
.
jsm
"
)
;
PromiseTestUtils
.
allowMatchingRejectionsGlobally
(
/
File
closed
/
)
;
requestLongerTimeout
(
4
)
;
add_task
(
async
function
(
)
{
const
ToolboxTask
=
await
initBrowserToolboxTask
(
)
;
await
ToolboxTask
.
importFunctions
(
{
clickMeatballItem
}
)
;
is
(
getPseudoLocale
(
)
"
"
"
Starts
out
as
empty
"
)
;
await
ToolboxTask
.
spawn
(
null
(
)
=
>
clickMeatballItem
(
"
accented
"
)
)
;
is
(
getPseudoLocale
(
)
"
accented
"
"
Enabled
the
accented
pseudo
-
locale
"
)
;
await
ToolboxTask
.
spawn
(
null
(
)
=
>
clickMeatballItem
(
"
accented
"
)
)
;
is
(
getPseudoLocale
(
)
"
"
"
Disabled
the
accented
pseudo
-
locale
.
"
)
;
await
ToolboxTask
.
spawn
(
null
(
)
=
>
clickMeatballItem
(
"
bidi
"
)
)
;
is
(
getPseudoLocale
(
)
"
bidi
"
"
Enabled
the
bidi
pseudo
-
locale
.
"
)
;
await
ToolboxTask
.
spawn
(
null
(
)
=
>
clickMeatballItem
(
"
bidi
"
)
)
;
is
(
getPseudoLocale
(
)
"
"
"
Disabled
the
bidi
pseudo
-
locale
.
"
)
;
await
ToolboxTask
.
spawn
(
null
(
)
=
>
clickMeatballItem
(
"
bidi
"
)
)
;
is
(
getPseudoLocale
(
)
"
bidi
"
"
Enabled
the
bidi
before
closing
.
"
)
;
await
ToolboxTask
.
destroy
(
)
;
is
(
getPseudoLocale
(
)
"
"
"
After
closing
the
pseudo
-
locale
is
disabled
.
"
)
;
}
)
;
function
getPseudoLocale
(
)
{
return
Services
.
prefs
.
getCharPref
(
"
intl
.
l10n
.
pseudo
"
)
;
}
function
clickMeatballItem
(
type
)
{
return
new
Promise
(
resolve
=
>
{
dump
(
Opening
the
meatball
menu
in
the
browser
toolbox
.
\
n
)
;
gToolbox
.
doc
.
getElementById
(
"
toolbox
-
meatball
-
menu
-
button
"
)
.
click
(
)
;
gToolbox
.
doc
.
addEventListener
(
"
popupshown
"
async
(
)
=
>
{
const
menuItem
=
gToolbox
.
doc
.
getElementById
(
"
toolbox
-
meatball
-
menu
-
pseudo
-
locale
-
"
+
type
)
;
dump
(
Clicking
the
meatball
menu
item
:
"
{
type
}
"
.
\
n
)
;
menuItem
.
click
(
)
;
await
gToolbox
.
getPseudoLocale
(
)
;
resolve
(
)
;
}
{
once
:
true
}
)
;
}
)
;
}
