const
{
PromiseTestUtils
}
=
ChromeUtils
.
importESModule
(
"
resource
:
/
/
testing
-
common
/
PromiseTestUtils
.
sys
.
mjs
"
)
;
PromiseTestUtils
.
allowMatchingRejectionsGlobally
(
/
File
closed
/
)
;
requestLongerTimeout
(
4
)
;
add_task
(
async
function
(
)
{
const
env
=
Cc
[
"
mozilla
.
org
/
process
/
environment
;
1
"
]
.
getService
(
Ci
.
nsIEnvironment
)
;
env
.
set
(
"
MOZ_TEST_PROCESS_UPDATES
"
"
1
"
)
;
const
ToolboxTask
=
await
initBrowserToolboxTask
(
)
;
await
ToolboxTask
.
importFunctions
(
{
}
)
;
let
result
=
await
ToolboxTask
.
spawn
(
null
async
(
)
=
>
{
const
env
=
Cc
[
"
mozilla
.
org
/
process
/
environment
;
1
"
]
.
getService
(
Ci
.
nsIEnvironment
)
;
const
result
=
{
exists
:
env
.
exists
(
"
MOZ_TEST_PROCESS_UPDATES
"
)
get
:
env
.
get
(
"
MOZ_TEST_PROCESS_UPDATES
"
)
}
;
console
.
log
(
"
result
"
result
)
;
return
JSON
.
stringify
(
result
)
;
}
)
;
result
=
JSON
.
parse
(
result
)
;
ok
(
result
.
exists
"
MOZ_TEST_PROCESS_UPDATES
exists
in
subprocess
"
)
;
is
(
result
.
get
"
ShouldNotProcessUpdates
(
)
:
DevToolsLaunching
"
"
MOZ_TEST_PROCESS_UPDATES
is
correct
in
subprocess
"
)
;
await
ToolboxTask
.
destroy
(
)
;
}
)
;
