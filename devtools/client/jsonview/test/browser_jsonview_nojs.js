"
use
strict
"
;
add_task
(
async
function
(
)
{
info
(
"
Test
JSON
without
JavaScript
started
.
"
)
;
const
oldPref
=
Services
.
prefs
.
getBoolPref
(
"
javascript
.
enabled
"
)
;
Services
.
prefs
.
setBoolPref
(
"
javascript
.
enabled
"
false
)
;
const
TEST_JSON_URL
=
"
data
:
application
/
json
[
1
2
3
]
"
;
await
addJsonViewTab
(
TEST_JSON_URL
{
appReadyState
:
"
uninitialized
"
}
)
;
info
(
"
Checking
visible
text
contents
.
"
)
;
const
text
=
await
SpecialPowers
.
spawn
(
gBrowser
.
selectedBrowser
[
]
(
)
=
>
{
const
element
=
content
.
document
.
querySelector
(
"
html
"
)
;
return
element
?
element
.
innerText
:
null
;
}
)
;
is
(
text
"
[
1
2
3
]
"
"
The
raw
source
should
be
visible
.
"
)
;
Services
.
prefs
.
setBoolPref
(
"
javascript
.
enabled
"
oldPref
)
;
}
)
;
