"
use
strict
"
;
const
TEST_JSON_URL
=
URL_ROOT
+
"
array_json
.
json
"
;
const
EXPAND_THRESHOLD
=
100
*
1024
;
add_task
(
async
function
(
)
{
info
(
"
Test
expand
/
collapse
JSON
started
"
)
;
await
addJsonViewTab
(
TEST_JSON_URL
)
;
const
browser
=
gBrowser
.
selectedBrowser
;
const
countBefore
=
await
getElementCount
(
"
.
treeRow
"
)
;
ok
(
countBefore
=
=
6
"
There
must
be
six
rows
"
)
;
let
selector
=
"
.
jsonPanelBox
.
toolbar
button
.
collapse
"
;
await
BrowserTestUtils
.
synthesizeMouseAtCenter
(
selector
{
}
browser
)
;
let
countAfter
=
await
getElementCount
(
"
.
treeRow
"
)
;
ok
(
countAfter
=
=
3
"
There
must
be
three
rows
"
)
;
selector
=
"
.
jsonPanelBox
.
toolbar
button
.
expand
"
;
await
BrowserTestUtils
.
synthesizeMouseAtCenter
(
selector
{
}
browser
)
;
countAfter
=
await
getElementCount
(
"
.
treeRow
"
)
;
ok
(
countAfter
=
=
6
"
There
must
be
six
expanded
rows
"
)
;
const
json
=
JSON
.
stringify
(
{
data
:
Array
(
1e5
)
.
fill
(
)
.
map
(
x
=
>
"
hoot
"
)
status
:
"
ok
"
}
)
;
ok
(
json
.
length
>
EXPAND_THRESHOLD
"
The
generated
JSON
must
be
larger
than
100kB
"
)
;
await
addJsonViewTab
(
"
data
:
application
/
json
"
+
json
)
;
ok
(
document
.
querySelector
(
selector
)
=
=
null
"
The
Expand
All
button
must
be
gone
"
)
;
}
)
;
