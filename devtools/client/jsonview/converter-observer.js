"
use
strict
"
;
const
Cu
=
Components
.
utils
;
const
Cc
=
Components
.
classes
;
const
Ci
=
Components
.
interfaces
;
const
{
XPCOMUtils
}
=
Cu
.
import
(
"
resource
:
/
/
gre
/
modules
/
XPCOMUtils
.
jsm
"
{
}
)
;
const
{
Services
}
=
Cu
.
import
(
"
resource
:
/
/
gre
/
modules
/
Services
.
jsm
"
{
}
)
;
const
{
devtools
}
=
Cu
.
import
(
"
resource
:
/
/
gre
/
modules
/
devtools
/
shared
/
Loader
.
jsm
"
{
}
)
;
XPCOMUtils
.
defineLazyGetter
(
this
"
JsonViewService
"
function
(
)
{
const
{
JsonViewService
}
=
devtools
.
require
(
"
devtools
/
client
/
jsonview
/
converter
-
child
"
)
;
return
JsonViewService
;
}
)
;
XPCOMUtils
.
defineLazyGetter
(
this
"
JsonViewSniffer
"
function
(
)
{
const
{
JsonViewSniffer
}
=
devtools
.
require
(
"
devtools
/
client
/
jsonview
/
converter
-
sniffer
"
)
;
return
JsonViewSniffer
;
}
)
;
const
JSON_VIEW_PREF
=
"
devtools
.
jsonview
.
enabled
"
;
function
ConverterObserver
(
)
{
}
ConverterObserver
.
prototype
=
{
initialize
:
function
(
)
{
if
(
this
.
isEnabled
(
)
)
{
this
.
register
(
)
;
}
Services
.
prefs
.
addObserver
(
JSON_VIEW_PREF
this
false
)
;
Services
.
obs
.
addObserver
(
this
"
xpcom
-
shutdown
"
false
)
;
}
observe
:
function
(
subject
topic
data
)
{
switch
(
topic
)
{
case
"
xpcom
-
shutdown
"
:
this
.
onShutdown
(
)
;
break
;
case
"
nsPref
:
changed
"
:
this
.
onPrefChanged
(
)
;
break
;
}
;
}
onShutdown
:
function
(
)
{
Services
.
prefs
.
removeObserver
(
JSON_VIEW_PREF
observer
)
;
Services
.
obs
.
removeObserver
(
observer
"
xpcom
-
shutdown
"
)
;
}
onPrefChanged
:
function
(
)
{
if
(
this
.
isEnabled
(
)
)
{
this
.
register
(
)
;
}
else
{
this
.
unregister
(
)
;
}
}
register
:
function
(
)
{
JsonViewSniffer
.
register
(
)
;
JsonViewService
.
register
(
)
;
}
unregister
:
function
(
)
{
JsonViewSniffer
.
unregister
(
)
;
JsonViewService
.
unregister
(
)
;
}
isEnabled
:
function
(
)
{
return
Services
.
prefs
.
getBoolPref
(
JSON_VIEW_PREF
)
;
}
}
;
var
observer
=
new
ConverterObserver
(
)
;
observer
.
initialize
(
)
;
