"
use
strict
"
;
define
(
function
(
require
exports
module
)
{
const
{
render
}
=
require
(
"
devtools
/
client
/
shared
/
vendor
/
react
-
dom
"
)
;
const
{
createFactories
}
=
require
(
"
devtools
/
client
/
shared
/
react
-
utils
"
)
;
const
{
MainTabbedArea
}
=
createFactories
(
require
(
"
.
/
components
/
MainTabbedArea
"
)
)
;
const
TreeViewClass
=
require
(
"
devtools
/
client
/
shared
/
components
/
tree
/
TreeView
"
)
;
const
json
=
document
.
getElementById
(
"
json
"
)
;
const
AUTO_EXPAND_MAX_SIZE
=
100
*
1024
;
const
AUTO_EXPAND_MAX_LEVEL
=
7
;
let
prettyURL
;
let
input
=
{
jsonText
:
json
.
textContent
jsonPretty
:
null
headers
:
JSONView
.
headers
tabActive
:
0
prettified
:
false
}
;
if
(
input
.
jsonText
.
startsWith
(
"
\
ufeff
"
)
)
{
input
.
jsonText
=
input
.
jsonText
.
slice
(
1
)
;
}
try
{
input
.
json
=
JSON
.
parse
(
input
.
jsonText
)
;
}
catch
(
err
)
{
input
.
json
=
err
;
}
if
(
!
(
input
.
json
instanceof
Error
)
&
&
input
.
jsonText
.
length
<
=
AUTO_EXPAND_MAX_SIZE
)
{
input
.
expandedNodes
=
TreeViewClass
.
getExpandedNodes
(
input
.
json
{
maxLevel
:
AUTO_EXPAND_MAX_LEVEL
}
)
;
}
else
{
input
.
expandedNodes
=
new
Set
(
)
;
}
json
.
remove
(
)
;
input
.
actions
=
{
onCopyJson
:
function
(
)
{
dispatchEvent
(
"
copy
"
input
.
prettified
?
input
.
jsonPretty
:
input
.
jsonText
)
;
}
onSaveJson
:
function
(
)
{
if
(
input
.
prettified
&
&
!
prettyURL
)
{
prettyURL
=
URL
.
createObjectURL
(
new
window
.
Blob
(
[
input
.
jsonPretty
]
)
)
;
}
dispatchEvent
(
"
save
"
input
.
prettified
?
prettyURL
:
null
)
;
}
onCopyHeaders
:
function
(
)
{
dispatchEvent
(
"
copy
-
headers
"
input
.
headers
)
;
}
onSearch
:
function
(
value
)
{
theApp
.
setState
(
{
searchFilter
:
value
}
)
;
}
onPrettify
:
function
(
data
)
{
if
(
input
.
json
instanceof
Error
)
{
return
;
}
if
(
input
.
prettified
)
{
theApp
.
setState
(
{
jsonText
:
input
.
jsonText
}
)
;
}
else
{
if
(
!
input
.
jsonPretty
)
{
input
.
jsonPretty
=
JSON
.
stringify
(
input
.
json
null
"
"
)
;
}
theApp
.
setState
(
{
jsonText
:
input
.
jsonPretty
}
)
;
}
input
.
prettified
=
!
input
.
prettified
;
}
}
;
function
dispatchEvent
(
type
value
)
{
let
data
=
{
detail
:
{
type
value
}
}
;
let
contentMessageEvent
=
new
CustomEvent
(
"
contentMessage
"
data
)
;
window
.
dispatchEvent
(
contentMessageEvent
)
;
}
let
content
=
document
.
getElementById
(
"
content
"
)
;
let
theApp
=
render
(
MainTabbedArea
(
input
)
content
)
;
let
event
=
new
CustomEvent
(
"
JSONViewInitialized
"
{
}
)
;
JSONView
.
initialized
=
true
;
window
.
dispatchEvent
(
event
)
;
}
)
;
