"
use
strict
"
;
const
{
Cu
}
=
require
(
"
chrome
"
)
;
const
Services
=
require
(
"
Services
"
)
;
const
{
XPCOMUtils
}
=
Cu
.
import
(
"
resource
:
/
/
gre
/
modules
/
XPCOMUtils
.
jsm
"
{
}
)
;
XPCOMUtils
.
defineLazyGetter
(
this
"
JsonViewUtils
"
function
(
)
{
return
require
(
"
devtools
/
client
/
jsonview
/
utils
"
)
;
}
)
;
var
JsonView
=
{
initialize
:
function
(
)
{
Services
.
ppmm
.
loadProcessScript
(
"
resource
:
/
/
devtools
/
client
/
jsonview
/
converter
-
observer
.
js
"
true
)
;
this
.
onSaveListener
=
this
.
onSave
.
bind
(
this
)
;
Services
.
ppmm
.
addMessageListener
(
"
devtools
:
jsonview
:
save
"
this
.
onSaveListener
)
;
}
destroy
:
function
(
)
{
Services
.
ppmm
.
removeMessageListener
(
"
devtools
:
jsonview
:
save
"
this
.
onSaveListener
)
;
}
onSave
:
function
(
message
)
{
JsonViewUtils
.
getTargetFile
(
file
=
>
{
if
(
file
)
{
JsonViewUtils
.
saveToFile
(
file
message
.
data
)
;
}
}
)
;
}
}
;
module
.
exports
.
JsonView
=
JsonView
;
