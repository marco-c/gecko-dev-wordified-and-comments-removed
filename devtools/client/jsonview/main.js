"
use
strict
"
;
const
{
Cu
Ci
Cc
}
=
require
(
"
chrome
"
)
;
const
JsonViewUtils
=
require
(
"
devtools
/
client
/
jsonview
/
utils
"
)
;
const
{
Services
}
=
Cu
.
import
(
"
resource
:
/
/
gre
/
modules
/
Services
.
jsm
"
{
}
)
;
const
{
makeInfallible
}
=
require
(
"
devtools
/
shared
/
DevToolsUtils
"
)
;
var
JsonView
=
{
initialize
:
makeInfallible
(
function
(
)
{
Services
.
ppmm
.
loadProcessScript
(
"
resource
:
/
/
/
modules
/
devtools
/
client
/
jsonview
/
converter
-
observer
.
js
"
true
)
;
this
.
onSaveListener
=
this
.
onSave
.
bind
(
this
)
;
Services
.
ppmm
.
addMessageListener
(
"
devtools
:
jsonview
:
save
"
this
.
onSaveListener
)
;
}
)
destroy
:
makeInfallible
(
function
(
)
{
Services
.
ppmm
.
removeMessageListener
(
"
devtools
:
jsonview
:
save
"
this
.
onSaveListener
)
;
}
)
onSave
:
function
(
message
)
{
let
value
=
message
.
data
;
let
file
=
JsonViewUtils
.
getTargetFile
(
)
;
if
(
file
)
{
JsonViewUtils
.
saveToFile
(
file
value
)
;
}
}
}
;
module
.
exports
.
JsonView
=
JsonView
;
