"
use
strict
"
;
const
TESTCASE_URI
=
TEST_BASE_HTTP
+
"
many
-
media
-
rules
-
sourcemaps
/
index
.
html
"
;
const
EVENTS_DELAY
=
2000
;
const
MAX_EVENTS
=
10
;
add_task
(
async
function
(
)
{
const
{
toolbox
ui
}
=
await
openStyleEditorForURL
(
TESTCASE_URI
)
;
const
win
=
toolbox
.
win
.
parent
;
const
originalWidth
=
win
.
outerWidth
;
const
originalHeight
=
win
.
outerHeight
;
if
(
originalWidth
<
500
)
{
info
(
"
Window
is
too
small
for
the
test
resize
it
to
>
800px
width
"
)
;
const
onMediaListChanged
=
waitForManyEvents
(
ui
EVENTS_DELAY
)
;
await
resizeWindow
(
800
ui
win
)
;
info
(
"
Wait
for
at
-
rules
-
list
-
changed
events
to
settle
"
)
;
await
onMediaListChanged
;
}
info
(
"
Resize
the
window
to
stop
matching
media
queries
and
trigger
the
UI
updates
"
)
;
const
onMediaListChanged
=
waitForManyEvents
(
ui
win
EVENTS_DELAY
)
;
await
resizeWindow
(
400
ui
win
)
;
const
eventsCount
=
await
onMediaListChanged
;
Assert
.
less
(
eventsCount
MAX_EVENTS
Too
many
events
fired
(
expected
less
than
{
MAX_EVENTS
}
got
{
eventsCount
}
)
)
;
win
.
resizeTo
(
originalWidth
originalHeight
)
;
}
)
;
async
function
resizeWindow
(
width
ui
win
)
{
const
onResize
=
once
(
win
"
resize
"
)
;
win
.
resizeTo
(
width
win
.
outerHeight
)
;
info
(
"
Wait
for
window
resize
event
"
)
;
await
onResize
;
}
