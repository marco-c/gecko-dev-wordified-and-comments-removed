"
use
strict
"
;
const
{
dumpn
}
=
require
(
"
devtools
/
shared
/
DevToolsUtils
"
)
;
const
{
ConnectionManager
}
=
require
(
"
devtools
/
shared
/
client
/
connection
-
manager
"
)
;
const
{
runCommand
}
=
require
(
"
.
/
run
-
command
"
)
;
const
forwardPort
=
function
(
localPort
devicePort
)
{
dumpn
(
"
forwardPort
"
+
localPort
+
"
-
-
"
+
devicePort
)
;
return
runCommand
(
"
host
:
forward
:
"
+
localPort
+
"
;
"
+
devicePort
)
.
then
(
function
onSuccess
(
data
)
{
return
data
;
}
)
;
}
;
const
prepareTCPConnection
=
async
function
(
socketPath
)
{
const
port
=
ConnectionManager
.
getFreeTCPPort
(
)
;
const
local
=
tcp
:
{
port
}
;
const
remote
=
socketPath
.
startsWith
(
"
"
)
?
localabstract
:
{
socketPath
.
substring
(
1
)
}
:
localfilesystem
:
{
socketPath
}
;
await
forwardPort
(
local
remote
)
;
return
port
;
}
;
exports
.
prepareTCPConnection
=
prepareTCPConnection
;
