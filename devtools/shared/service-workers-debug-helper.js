"
use
strict
"
;
const
Services
=
require
(
"
Services
"
)
;
const
{
XPCOMUtils
}
=
require
(
"
resource
:
/
/
gre
/
modules
/
XPCOMUtils
.
jsm
"
)
;
XPCOMUtils
.
defineLazyServiceGetter
(
this
"
swm
"
"
mozilla
.
org
/
serviceworkers
/
manager
;
1
"
"
nsIServiceWorkerManager
"
)
;
const
PROCESS_COUNT_PREF
=
"
dom
.
ipc
.
processCount
"
;
const
MULTI_OPTOUT_PREF
=
"
dom
.
ipc
.
multiOptOut
"
;
function
addDebugServiceWorkersListener
(
listener
)
{
Services
.
prefs
.
addObserver
(
PROCESS_COUNT_PREF
listener
)
;
Services
.
prefs
.
addObserver
(
MULTI_OPTOUT_PREF
listener
)
;
}
function
removeDebugServiceWorkersListener
(
listener
)
{
Services
.
prefs
.
removeObserver
(
PROCESS_COUNT_PREF
listener
)
;
Services
.
prefs
.
removeObserver
(
MULTI_OPTOUT_PREF
listener
)
;
}
function
canDebugServiceWorkers
(
)
{
const
isE10s
=
Services
.
appinfo
.
browserTabsRemoteAutostart
;
const
processCount
=
Services
.
appinfo
.
maxWebProcessCount
;
const
multiE10s
=
isE10s
&
&
processCount
>
1
;
const
isNewSWImplementation
=
swm
.
isParentInterceptEnabled
(
)
;
return
isNewSWImplementation
|
|
!
multiE10s
;
}
module
.
exports
=
{
addDebugServiceWorkersListener
canDebugServiceWorkers
removeDebugServiceWorkersListener
}
;
