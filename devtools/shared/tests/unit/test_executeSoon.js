"
use
strict
"
;
var
{
executeSoon
}
=
require
(
"
devtools
/
shared
/
DevToolsUtils
"
)
;
var
defer
=
require
(
"
devtools
/
shared
/
defer
"
)
;
var
Services
=
require
(
"
Services
"
)
;
var
asyncStackEnabled
=
Services
.
prefs
.
getBoolPref
(
"
javascript
.
options
.
asyncstack
"
)
;
do_register_cleanup
(
(
)
=
>
{
Services
.
prefs
.
setBoolPref
(
"
javascript
.
options
.
asyncstack
"
asyncStackEnabled
)
;
}
)
;
add_task
(
function
*
(
)
{
Services
.
prefs
.
setBoolPref
(
"
javascript
.
options
.
asyncstack
"
true
)
;
yield
waitForTick
(
)
;
let
stack
=
Components
.
stack
;
while
(
stack
)
{
do_print
(
stack
.
name
)
;
if
(
stack
.
name
=
=
"
waitForTick
"
)
{
ok
(
true
"
Complete
stack
"
)
;
return
;
}
stack
=
stack
.
asyncCaller
|
|
stack
.
caller
;
}
ok
(
false
"
Incomplete
stack
"
)
;
}
)
;
function
waitForTick
(
)
{
let
deferred
=
defer
(
)
;
executeSoon
(
deferred
.
resolve
)
;
return
deferred
.
promise
;
}
