"
use
strict
"
;
const
ResourceCommand
=
require
(
"
devtools
/
shared
/
commands
/
resource
/
resource
-
command
"
)
;
module
.
exports
=
async
function
(
{
targetFront
onAvailable
}
)
{
if
(
!
targetFront
.
getTrait
(
"
isBrowsingContext
"
)
)
{
return
;
}
const
eventSourceFront
=
await
targetFront
.
getFront
(
"
eventSource
"
)
;
eventSourceFront
.
startListening
(
)
;
eventSourceFront
.
on
(
"
eventSourceConnectionClosed
"
httpChannelId
=
>
{
const
resource
=
createResource
(
"
eventSourceConnectionClosed
"
{
httpChannelId
}
)
;
onAvailable
(
[
resource
]
)
;
}
)
;
eventSourceFront
.
on
(
"
eventReceived
"
(
httpChannelId
data
)
=
>
{
const
resource
=
createResource
(
"
eventReceived
"
{
httpChannelId
data
}
)
;
onAvailable
(
[
resource
]
)
;
}
)
;
}
;
function
createResource
(
messageType
eventParams
)
{
return
{
resourceType
:
ResourceCommand
.
TYPES
.
SERVER_SENT_EVENT
messageType
.
.
.
eventParams
}
;
}
