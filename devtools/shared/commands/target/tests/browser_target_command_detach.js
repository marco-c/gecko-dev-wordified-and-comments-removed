"
use
strict
"
;
const
TEST_URL
=
"
data
:
text
/
html
test
-
page
"
;
add_task
(
async
function
(
)
{
info
(
"
#
#
#
Test
detaching
the
top
target
"
)
;
const
tab
=
await
addTab
(
TEST_URL
)
;
info
(
"
Create
a
first
commands
which
will
destroy
its
top
target
"
)
;
const
commands
=
await
CommandsFactory
.
forRemoteTab
(
tab
.
linkedBrowser
.
browserId
)
;
const
targetCommand
=
commands
.
targetCommand
;
await
targetCommand
.
startListening
(
)
;
info
(
"
Call
any
target
front
method
to
ensure
it
works
fine
"
)
;
await
targetCommand
.
targetFront
.
focus
(
)
;
await
targetCommand
.
stopListening
(
)
;
info
(
"
Now
create
a
second
commands
after
destroy
to
see
if
we
can
spawn
a
new
functional
target
"
)
;
const
secondCommands
=
await
CommandsFactory
.
forRemoteTab
(
tab
.
linkedBrowser
.
browserId
{
client
:
commands
.
client
}
)
;
const
secondTargetCommand
=
secondCommands
.
targetCommand
;
await
secondTargetCommand
.
startListening
(
)
;
info
(
"
Call
any
target
front
method
to
ensure
it
works
fine
"
)
;
await
secondTargetCommand
.
targetFront
.
focus
(
)
;
BrowserTestUtils
.
removeTab
(
tab
)
;
info
(
"
Close
the
two
commands
"
)
;
await
commands
.
destroy
(
)
;
await
secondCommands
.
destroy
(
)
;
}
)
;
