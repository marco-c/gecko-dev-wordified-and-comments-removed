"
use
strict
"
;
const
Commands
=
{
inspectedWindowCommand
:
"
devtools
/
shared
/
commands
/
inspected
-
window
/
inspected
-
window
-
command
"
inspectorCommand
:
"
devtools
/
shared
/
commands
/
inspector
/
inspector
-
command
"
networkCommand
:
"
devtools
/
shared
/
commands
/
network
/
network
-
command
"
objectCommand
:
"
devtools
/
shared
/
commands
/
object
/
object
-
command
"
resourceCommand
:
"
devtools
/
shared
/
commands
/
resource
/
resource
-
command
"
rootResourceCommand
:
"
devtools
/
shared
/
commands
/
root
-
resource
/
root
-
resource
-
command
"
scriptCommand
:
"
devtools
/
shared
/
commands
/
script
/
script
-
command
"
targetCommand
:
"
devtools
/
shared
/
commands
/
target
/
target
-
command
"
targetConfigurationCommand
:
"
devtools
/
shared
/
commands
/
target
-
configuration
/
target
-
configuration
-
command
"
threadConfigurationCommand
:
"
devtools
/
shared
/
commands
/
thread
-
configuration
/
thread
-
configuration
-
command
"
tracerCommand
:
"
devtools
/
shared
/
commands
/
tracer
/
tracer
-
command
"
}
;
async
function
createCommandsDictionary
(
descriptorFront
enableWindowGlobalThreadActors
)
{
let
watcherFront
;
const
supportsWatcher
=
descriptorFront
.
traits
?
.
watcher
;
if
(
supportsWatcher
)
{
watcherFront
=
await
descriptorFront
.
getWatcher
(
{
enableWindowGlobalThreadActors
}
)
;
}
const
{
client
}
=
descriptorFront
;
const
allInstantiatedCommands
=
new
Set
(
)
;
const
dictionary
=
{
client
descriptorFront
watcherFront
waitForRequestsToSettle
(
options
)
{
return
descriptorFront
.
client
.
waitForRequestsToSettle
(
options
)
;
}
shouldCloseClient
:
true
async
destroy
(
)
{
descriptorFront
.
off
(
"
descriptor
-
destroyed
"
this
.
destroy
)
;
for
(
const
command
of
allInstantiatedCommands
)
{
if
(
typeof
command
.
destroy
=
=
"
function
"
)
{
command
.
destroy
(
)
;
}
}
allInstantiatedCommands
.
clear
(
)
;
if
(
!
descriptorFront
.
isDestroyed
(
)
)
{
await
descriptorFront
.
destroy
(
)
;
}
if
(
this
.
shouldCloseClient
)
{
await
client
.
close
(
)
;
}
}
}
;
dictionary
.
destroy
=
dictionary
.
destroy
.
bind
(
dictionary
)
;
descriptorFront
.
on
(
"
descriptor
-
destroyed
"
dictionary
.
destroy
)
;
for
(
const
name
in
Commands
)
{
loader
.
lazyGetter
(
dictionary
name
(
)
=
>
{
const
Constructor
=
require
(
Commands
[
name
]
)
;
const
command
=
new
Constructor
(
{
commands
:
dictionary
descriptorFront
watcherFront
}
)
;
allInstantiatedCommands
.
add
(
command
)
;
return
command
;
}
)
;
}
return
dictionary
;
}
exports
.
createCommandsDictionary
=
createCommandsDictionary
;
