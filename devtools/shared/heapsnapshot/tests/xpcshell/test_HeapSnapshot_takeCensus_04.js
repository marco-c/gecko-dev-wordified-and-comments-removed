"
use
strict
"
;
function
run_test
(
)
{
const
g
=
newGlobal
(
)
;
const
dbg
=
new
Debugger
(
g
)
;
g
.
eval
(
function
withAllocationMarkerOnStack
(
f
)
{
(
function
(
)
{
var
onStack
=
allocationMarker
(
)
;
f
(
)
;
}
(
)
)
;
}
)
;
equal
(
"
AllocationMarker
"
in
saveHeapSnapshotAndTakeCensus
(
dbg
)
.
objects
false
"
There
shouldn
'
t
exist
any
allocation
markers
in
the
census
.
"
)
;
let
allocationMarkerCount
;
g
.
withAllocationMarkerOnStack
(
(
)
=
>
{
const
census
=
saveHeapSnapshotAndTakeCensus
(
dbg
)
;
allocationMarkerCount
=
census
.
objects
.
AllocationMarker
.
count
;
}
)
;
equal
(
allocationMarkerCount
1
"
Should
have
one
allocation
marker
in
the
census
because
there
"
+
"
was
one
on
the
stack
.
"
)
;
do_test_finished
(
)
;
}
