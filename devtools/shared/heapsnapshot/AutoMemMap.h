#
ifndef
mozilla_devtools_AutoMemMap_h
#
define
mozilla_devtools_AutoMemMap_h
#
include
<
prio
.
h
>
#
include
"
mozilla
/
Assertions
.
h
"
#
include
"
mozilla
/
Attributes
.
h
"
namespace
mozilla
{
namespace
devtools
{
class
MOZ_RAII
AutoMemMap
{
PRFileInfo64
fileInfo
;
PRFileDesc
*
fd
;
PRFileMap
*
fileMap
;
void
*
addr
;
AutoMemMap
(
const
AutoMemMap
&
aOther
)
=
delete
;
void
operator
=
(
const
AutoMemMap
&
aOther
)
=
delete
;
public
:
explicit
AutoMemMap
(
)
:
fileInfo
(
)
fd
(
nullptr
)
fileMap
(
nullptr
)
addr
(
nullptr
)
{
}
;
~
AutoMemMap
(
)
;
nsresult
init
(
const
char
*
filePath
int
flags
=
PR_RDONLY
int
mode
=
0
PRFileMapProtect
prot
=
PR_PROT_READONLY
)
;
uint32_t
size
(
)
const
{
MOZ_ASSERT
(
fileInfo
.
size
<
=
UINT32_MAX
"
Should
only
call
size
(
)
if
init
(
)
succeeded
.
"
)
;
return
uint32_t
(
fileInfo
.
size
)
;
}
void
*
address
(
)
{
MOZ_ASSERT
(
addr
)
;
return
addr
;
}
const
void
*
address
(
)
const
{
MOZ_ASSERT
(
addr
)
;
return
addr
;
}
}
;
}
}
#
endif
