"
use
strict
"
;
const
Services
=
require
(
"
Services
"
)
;
module
.
exports
=
async
function
(
{
targetList
targetType
targetFront
isTopLevel
onAvailable
}
)
{
const
isContentToolbox
=
targetList
.
targetFront
.
isLocalTab
;
const
listenForFrames
=
isContentToolbox
&
&
Services
.
prefs
.
getBoolPref
(
"
devtools
.
contenttoolbox
.
fission
"
)
;
const
isAllowed
=
isTopLevel
|
|
targetType
=
=
=
targetList
.
TYPES
.
PROCESS
|
|
(
targetType
=
=
=
targetList
.
TYPES
.
FRAME
&
&
listenForFrames
)
;
if
(
!
isAllowed
)
{
return
;
}
const
webConsoleFront
=
await
targetFront
.
getFront
(
"
console
"
)
;
await
webConsoleFront
.
startListeners
(
[
"
ConsoleAPI
"
]
)
;
const
{
messages
}
=
await
webConsoleFront
.
getCachedMessages
(
[
"
ConsoleAPI
"
]
)
;
messages
.
map
(
message
=
>
(
{
message
}
)
)
.
forEach
(
onAvailable
)
;
webConsoleFront
.
on
(
"
consoleAPICall
"
onAvailable
)
;
}
;
