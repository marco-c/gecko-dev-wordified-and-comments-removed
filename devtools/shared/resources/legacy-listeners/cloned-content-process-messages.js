"
use
strict
"
;
const
{
ResourceWatcher
}
=
require
(
"
devtools
/
shared
/
resources
/
resource
-
watcher
"
)
;
const
Services
=
require
(
"
Services
"
)
;
module
.
exports
=
async
function
(
{
targetCommand
targetFront
onAvailable
}
)
{
const
browserToolboxFissionSupport
=
Services
.
prefs
.
getBoolPref
(
"
devtools
.
browsertoolbox
.
fission
"
false
)
;
const
acceptTarget
=
targetFront
.
isParentProcess
&
&
!
targetFront
.
isAddon
&
&
!
browserToolboxFissionSupport
;
if
(
!
acceptTarget
)
{
return
;
}
const
webConsoleFront
=
await
targetFront
.
getFront
(
"
console
"
)
;
if
(
webConsoleFront
.
isDestroyed
(
)
)
{
return
;
}
await
webConsoleFront
.
startListeners
(
[
"
ContentProcessMessages
"
]
)
;
webConsoleFront
.
on
(
"
consoleAPICall
"
packet
=
>
{
if
(
!
packet
.
clonedFromContentProcess
)
{
return
;
}
packet
.
resourceType
=
ResourceWatcher
.
TYPES
.
CONSOLE_MESSAGE
;
onAvailable
(
[
packet
]
)
;
}
)
;
}
;
