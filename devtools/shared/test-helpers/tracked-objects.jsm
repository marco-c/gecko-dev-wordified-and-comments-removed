"
use
strict
"
;
var
EXPORTED_SYMBOLS
=
[
"
track
"
"
getAllNodeIds
"
]
;
const
{
Services
}
=
ChromeUtils
.
import
(
"
resource
:
/
/
gre
/
modules
/
Services
.
jsm
"
)
;
const
objects
=
[
]
;
function
track
(
obj
)
{
if
(
Services
.
appinfo
.
processType
!
=
Ci
.
nsIXULRuntime
.
PROCESS_TYPE_DEFAULT
)
{
throw
new
Error
(
"
For
now
this
API
only
works
from
the
parent
process
"
)
;
}
objects
.
push
(
Cu
.
getWeakReference
(
obj
)
)
;
}
function
getAllNodeIds
(
)
{
return
(
objects
.
map
(
weak
=
>
weak
.
get
(
)
)
.
filter
(
obj
=
>
!
!
obj
)
.
map
(
ChromeUtils
.
getObjectNodeId
)
)
;
}
