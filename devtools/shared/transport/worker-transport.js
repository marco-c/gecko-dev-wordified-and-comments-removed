"
use
strict
"
;
class
MainThreadWorkerDebuggerTransport
{
constructor
(
dbg
id
)
{
this
.
_dbg
=
dbg
;
this
.
_id
=
id
;
this
.
_dbgListener
=
{
onMessage
:
this
.
_onMessage
.
bind
(
this
)
}
;
}
ready
(
)
{
this
.
_dbg
.
addListener
(
this
.
_dbgListener
)
;
}
close
(
)
{
if
(
this
.
_dbgListener
)
{
this
.
_dbg
.
removeListener
(
this
.
_dbgListener
)
;
}
this
.
_dbgListener
=
null
;
this
.
hooks
?
.
onTransportClosed
(
)
;
}
send
(
packet
)
{
this
.
_dbg
.
postMessage
(
JSON
.
stringify
(
{
type
:
"
message
"
id
:
this
.
_id
message
:
packet
}
)
)
;
}
startBulkSend
(
)
{
throw
new
Error
(
"
Can
'
t
send
bulk
data
from
worker
threads
!
"
)
;
}
_onMessage
(
message
)
{
const
packet
=
JSON
.
parse
(
message
)
;
if
(
packet
.
type
!
=
=
"
message
"
|
|
packet
.
id
!
=
=
this
.
_id
|
|
!
this
.
hooks
)
{
return
;
}
this
.
hooks
.
onPacket
(
packet
.
message
)
;
}
}
exports
.
MainThreadWorkerDebuggerTransport
=
MainThreadWorkerDebuggerTransport
;
function
WorkerThreadWorkerDebuggerTransport
(
scope
id
)
{
this
.
_scope
=
scope
;
this
.
_id
=
id
;
this
.
_onMessage
=
this
.
_onMessage
.
bind
(
this
)
;
}
WorkerThreadWorkerDebuggerTransport
.
prototype
=
{
constructor
:
WorkerThreadWorkerDebuggerTransport
ready
(
)
{
this
.
_scope
.
addEventListener
(
"
message
"
this
.
_onMessage
)
;
}
close
(
)
{
this
.
_scope
.
removeEventListener
(
"
message
"
this
.
_onMessage
)
;
this
.
hooks
?
.
onTransportClosed
(
)
;
}
send
(
packet
)
{
this
.
_scope
.
postMessage
(
JSON
.
stringify
(
{
type
:
"
message
"
id
:
this
.
_id
message
:
packet
}
)
)
;
}
startBulkSend
(
)
{
throw
new
Error
(
"
Can
'
t
send
bulk
data
from
worker
threads
!
"
)
;
}
_onMessage
(
event
)
{
const
packet
=
JSON
.
parse
(
event
.
data
)
;
if
(
packet
.
type
!
=
=
"
message
"
|
|
packet
.
id
!
=
=
this
.
_id
)
{
return
;
}
if
(
this
.
hooks
)
{
this
.
hooks
.
onPacket
(
packet
.
message
)
;
}
}
}
;
exports
.
WorkerThreadWorkerDebuggerTransport
=
WorkerThreadWorkerDebuggerTransport
;
