"
use
strict
"
;
const
{
Cc
Ci
}
=
require
(
"
chrome
"
)
;
loader
.
lazyRequireGetter
(
this
"
Services
"
)
;
loader
.
lazyRequireGetter
(
this
"
promise
"
)
;
loader
.
lazyRequireGetter
(
this
"
defer
"
"
devtools
/
shared
/
defer
"
)
;
loader
.
lazyRequireGetter
(
this
"
DebuggerServer
"
"
devtools
/
server
/
main
"
true
)
;
loader
.
lazyRequireGetter
(
this
"
AppConstants
"
"
resource
:
/
/
gre
/
modules
/
AppConstants
.
jsm
"
true
)
;
loader
.
lazyGetter
(
this
"
screenManager
"
(
)
=
>
{
return
Cc
[
"
mozilla
.
org
/
gfx
/
screenmanager
;
1
"
]
.
getService
(
Ci
.
nsIScreenManager
)
;
}
)
;
loader
.
lazyGetter
(
this
"
hostname
"
(
)
=
>
{
try
{
return
Cc
[
"
mozilla
.
org
/
network
/
dns
-
service
;
1
"
]
.
getService
(
Ci
.
nsIDNSService
)
.
myHostName
;
}
catch
(
e
)
{
return
"
"
;
}
}
)
;
loader
.
lazyGetter
(
this
"
endianness
"
(
)
=
>
{
if
(
(
new
Uint32Array
(
(
new
Uint8Array
(
[
1
2
3
4
]
)
)
.
buffer
)
)
[
0
]
=
=
=
0x04030201
)
{
return
"
LE
"
;
}
return
"
BE
"
;
}
)
;
const
APP_MAP
=
{
"
{
ec8030f7
-
c20a
-
464f
-
9b0e
-
13a3a9e97384
}
"
:
"
firefox
"
"
{
3550f703
-
e582
-
4d05
-
9a08
-
453d09bdfdc6
}
"
:
"
thunderbird
"
"
{
92650c4d
-
4b8e
-
4d2a
-
b7eb
-
24ecf4f6b63a
}
"
:
"
seamonkey
"
"
{
718e30fb
-
e89b
-
41dd
-
9da7
-
e25a45638b28
}
"
:
"
sunbird
"
"
{
aa3c5121
-
dab2
-
40e2
-
81ca
-
7ea25febc110
}
"
:
"
mobile
/
android
"
}
;
var
CACHED_INFO
=
null
;
async
function
getSystemInfo
(
)
{
if
(
CACHED_INFO
)
{
return
CACHED_INFO
;
}
const
appInfo
=
Services
.
appinfo
;
const
win
=
Services
.
wm
.
getMostRecentWindow
(
DebuggerServer
.
chromeWindowType
)
;
const
[
processor
compiler
]
=
appInfo
.
XPCOMABI
.
split
(
"
-
"
)
;
let
dpi
useragent
width
height
physicalWidth
physicalHeight
brandName
;
const
appid
=
appInfo
.
ID
;
const
apptype
=
APP_MAP
[
appid
]
;
const
geckoVersion
=
appInfo
.
platformVersion
;
const
hardware
=
"
unknown
"
;
let
version
=
"
unknown
"
;
const
os
=
appInfo
.
OS
;
version
=
appInfo
.
version
;
const
bundle
=
Services
.
strings
.
createBundle
(
"
chrome
:
/
/
branding
/
locale
/
brand
.
properties
"
)
;
if
(
bundle
)
{
brandName
=
bundle
.
GetStringFromName
(
"
brandFullName
"
)
;
}
else
{
brandName
=
null
;
}
if
(
win
)
{
const
utils
=
win
.
windowUtils
;
dpi
=
utils
.
displayDPI
;
useragent
=
win
.
navigator
.
userAgent
;
width
=
win
.
screen
.
width
;
height
=
win
.
screen
.
height
;
physicalWidth
=
win
.
screen
.
width
*
win
.
devicePixelRatio
;
physicalHeight
=
win
.
screen
.
height
*
win
.
devicePixelRatio
;
}
const
info
=
{
appid
apptype
vendor
:
appInfo
.
vendor
name
:
appInfo
.
name
version
appbuildid
:
appInfo
.
appBuildID
platformbuildid
:
appInfo
.
platformBuildID
geckobuildid
:
appInfo
.
platformBuildID
platformversion
:
geckoVersion
geckoversion
:
geckoVersion
locale
:
Services
.
locale
.
getAppLocaleAsLangTag
(
)
endianness
:
endianness
hostname
:
hostname
os
platform
:
os
hardware
arch
:
processor
processor
compiler
profile
:
getProfileLocation
(
)
channel
:
AppConstants
.
MOZ_UPDATE_CHANNEL
dpi
useragent
width
height
physicalWidth
physicalHeight
brandName
}
;
CACHED_INFO
=
info
;
return
info
;
}
function
getProfileLocation
(
)
{
try
{
const
profd
=
Services
.
dirsvc
.
get
(
"
ProfD
"
Ci
.
nsIFile
)
;
const
profservice
=
Cc
[
"
mozilla
.
org
/
toolkit
/
profile
-
service
;
1
"
]
.
getService
(
Ci
.
nsIToolkitProfileService
)
;
for
(
const
profile
of
profservice
.
profiles
)
{
if
(
profile
.
rootDir
.
path
=
=
profd
.
path
)
{
return
profile
.
name
;
}
}
return
profd
.
leafName
;
}
catch
(
e
)
{
return
"
"
;
}
}
function
getScreenDimensions
(
)
{
const
width
=
{
}
;
const
height
=
{
}
;
screenManager
.
primaryScreen
.
GetRect
(
{
}
{
}
width
height
)
;
const
dims
=
width
.
value
+
"
x
"
+
height
.
value
;
if
(
width
.
value
<
800
|
|
height
.
value
<
600
)
{
return
0
;
}
if
(
dims
=
=
=
"
800x600
"
)
{
return
1
;
}
if
(
dims
=
=
=
"
1024x768
"
)
{
return
2
;
}
if
(
dims
=
=
=
"
1280x800
"
)
{
return
3
;
}
if
(
dims
=
=
=
"
1280x1024
"
)
{
return
4
;
}
if
(
dims
=
=
=
"
1366x768
"
)
{
return
5
;
}
if
(
dims
=
=
=
"
1440x900
"
)
{
return
6
;
}
if
(
dims
=
=
=
"
1920x1080
"
)
{
return
7
;
}
if
(
dims
=
=
=
"
2560
1440
"
)
{
return
8
;
}
if
(
dims
=
=
=
"
2560
1600
"
)
{
return
9
;
}
if
(
dims
=
=
=
"
2880x1800
"
)
{
return
10
;
}
if
(
width
.
value
>
2880
|
|
height
.
value
>
1800
)
{
return
12
;
}
return
11
;
}
function
getSetting
(
name
)
{
const
deferred
=
defer
(
)
;
if
(
"
mozilla
.
org
/
settingsService
;
1
"
in
Cc
)
{
let
settingsService
;
try
{
settingsService
=
Cc
[
"
mozilla
.
org
/
settingsService
;
1
"
]
.
getService
(
Ci
.
nsISettingsService
)
;
}
catch
(
e
)
{
return
promise
.
reject
(
e
)
;
}
settingsService
.
createLock
(
)
.
get
(
name
{
handle
:
(
_
value
)
=
>
deferred
.
resolve
(
value
)
handleError
:
(
error
)
=
>
deferred
.
reject
(
error
)
}
)
;
}
else
{
deferred
.
reject
(
new
Error
(
"
No
settings
service
"
)
)
;
}
return
deferred
.
promise
;
}
exports
.
getSystemInfo
=
getSystemInfo
;
exports
.
getSetting
=
getSetting
;
exports
.
getScreenDimensions
=
getScreenDimensions
;
