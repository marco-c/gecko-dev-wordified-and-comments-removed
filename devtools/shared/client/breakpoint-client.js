"
use
strict
"
;
const
promise
=
require
(
"
devtools
/
shared
/
deprecated
-
sync
-
thenables
"
)
;
const
eventSource
=
require
(
"
devtools
/
shared
/
client
/
event
-
source
"
)
;
const
{
DebuggerClient
}
=
require
(
"
devtools
/
shared
/
client
/
debugger
-
client
"
)
;
function
BreakpointClient
(
client
sourceClient
actor
location
condition
)
{
this
.
_client
=
client
;
this
.
_actor
=
actor
;
this
.
location
=
location
;
this
.
location
.
actor
=
sourceClient
.
actor
;
this
.
location
.
url
=
sourceClient
.
url
;
this
.
source
=
sourceClient
;
this
.
request
=
this
.
_client
.
request
;
if
(
condition
)
{
this
.
condition
=
condition
;
}
}
BreakpointClient
.
prototype
=
{
_actor
:
null
get
actor
(
)
{
return
this
.
_actor
;
}
get
_transport
(
)
{
return
this
.
_client
.
_transport
;
}
remove
:
DebuggerClient
.
requester
(
{
type
:
"
delete
"
}
)
hasCondition
:
function
(
)
{
const
root
=
this
.
_client
.
mainRoot
;
if
(
root
.
traits
.
conditionalBreakpoints
)
{
return
"
condition
"
in
this
;
}
return
"
conditionalExpression
"
in
this
;
}
getCondition
:
function
(
)
{
const
root
=
this
.
_client
.
mainRoot
;
if
(
root
.
traits
.
conditionalBreakpoints
)
{
return
this
.
condition
;
}
return
this
.
conditionalExpression
;
}
setCondition
:
function
(
gThreadClient
condition
)
{
const
root
=
this
.
_client
.
mainRoot
;
const
deferred
=
promise
.
defer
(
)
;
if
(
root
.
traits
.
conditionalBreakpoints
)
{
const
info
=
{
line
:
this
.
location
.
line
column
:
this
.
location
.
column
condition
:
condition
}
;
this
.
remove
(
response
=
>
{
if
(
response
&
&
response
.
error
)
{
deferred
.
reject
(
response
)
;
return
;
}
deferred
.
resolve
(
this
.
source
.
setBreakpoint
(
info
)
.
then
(
(
[
newBreakpoint
]
)
=
>
{
return
newBreakpoint
;
}
)
)
;
}
)
;
}
else
{
if
(
condition
=
=
=
"
"
)
{
delete
this
.
conditionalExpression
;
}
else
{
this
.
conditionalExpression
=
condition
;
}
deferred
.
resolve
(
this
)
;
}
return
deferred
.
promise
;
}
}
;
eventSource
(
BreakpointClient
.
prototype
)
;
module
.
exports
=
BreakpointClient
;
