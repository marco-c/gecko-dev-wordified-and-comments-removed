"
use
strict
"
;
function
throttle
(
func
wait
scope
)
{
let
args
result
;
let
timeout
=
null
;
let
previous
=
0
;
const
later
=
function
(
)
{
previous
=
Date
.
now
(
)
;
timeout
=
null
;
result
=
func
.
apply
(
scope
args
)
;
args
=
null
;
}
;
const
throttledFunction
=
function
(
)
{
const
now
=
Date
.
now
(
)
;
const
remaining
=
wait
-
(
now
-
previous
)
;
args
=
arguments
;
if
(
remaining
<
=
0
)
{
if
(
!
isWorker
)
{
clearTimeout
(
timeout
)
;
}
timeout
=
null
;
previous
=
now
;
result
=
func
.
apply
(
scope
args
)
;
args
=
null
;
}
else
if
(
!
timeout
)
{
if
(
isWorker
)
{
setImmediate
(
later
)
;
timeout
=
true
;
}
else
{
timeout
=
setTimeout
(
later
remaining
)
;
}
}
return
result
;
}
;
function
cancel
(
)
{
if
(
timeout
)
{
if
(
!
isWorker
)
{
clearTimeout
(
timeout
)
;
}
timeout
=
null
;
}
previous
=
0
;
args
=
undefined
;
result
=
undefined
;
}
function
flush
(
)
{
if
(
!
timeout
)
{
return
result
;
}
previous
=
0
;
return
throttledFunction
(
)
;
}
throttledFunction
.
cancel
=
cancel
;
throttledFunction
.
flush
=
flush
;
return
throttledFunction
;
}
exports
.
throttle
=
throttle
;
