"
use
strict
"
;
Services
.
scriptloader
.
loadSubScript
(
"
chrome
:
/
/
mochitests
/
content
/
browser
/
devtools
/
server
/
tests
/
browser
/
storage
-
helpers
.
js
"
this
)
;
add_task
(
async
function
(
)
{
await
pushPref
(
"
devtools
.
chrome
.
enabled
"
true
)
;
await
pushPref
(
"
devtools
.
debugger
.
remote
-
enabled
"
true
)
;
const
{
target
front
}
=
await
openTabAndSetupStorage
(
MAIN_DOMAIN
+
"
storage
-
updates
.
html
"
)
;
await
createIndexedDB
(
)
;
await
testInternalDBs
(
front
)
;
await
clearStorage
(
)
;
forceCollections
(
)
;
await
target
.
destroy
(
)
;
forceCollections
(
)
;
DebuggerServer
.
destroy
(
)
;
forceCollections
(
)
;
}
)
;
async
function
createIndexedDB
(
)
{
const
request
=
indexedDB
.
open
(
"
MyDatabase
"
1
)
;
request
.
onupgradeneeded
=
function
(
)
{
const
db
=
request
.
result
;
const
store
=
db
.
createObjectStore
(
"
MyObjectStore
"
{
keyPath
:
"
id
"
}
)
;
store
.
createIndex
(
"
NameIndex
"
[
"
name
.
last
"
"
name
.
first
"
]
)
;
}
;
await
undefined
;
}
async
function
testInternalDBs
(
front
)
{
const
data
=
await
front
.
listStores
(
)
;
const
hosts
=
data
.
indexedDB
.
hosts
;
ok
(
!
hosts
.
chrome
indexedDB
hosts
doesn
'
t
contain
"
chrome
"
)
;
}
