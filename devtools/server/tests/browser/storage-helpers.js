"
use
strict
"
;
function
*
openTabAndSetupStorage
(
url
)
{
let
content
=
yield
addTab
(
url
)
;
yield
ContentTask
.
spawn
(
gBrowser
.
selectedBrowser
null
function
*
(
)
{
function
getAllWindows
(
baseWindow
)
{
let
windows
=
new
Set
(
)
;
let
_getAllWindows
=
function
(
win
)
{
windows
.
add
(
win
.
wrappedJSObject
)
;
for
(
let
i
=
0
;
i
<
win
.
length
;
i
+
+
)
{
_getAllWindows
(
win
[
i
]
)
;
}
}
;
_getAllWindows
(
baseWindow
)
;
return
windows
;
}
let
windows
=
getAllWindows
(
content
)
;
for
(
let
win
of
windows
)
{
if
(
win
.
setup
)
{
yield
win
.
setup
(
)
;
}
}
}
)
;
}
function
*
clearStorage
(
)
{
yield
ContentTask
.
spawn
(
gBrowser
.
selectedBrowser
null
function
*
(
)
{
function
getAllWindows
(
baseWindow
)
{
let
windows
=
new
Set
(
)
;
let
_getAllWindows
=
function
(
win
)
{
windows
.
add
(
win
.
wrappedJSObject
)
;
for
(
let
i
=
0
;
i
<
win
.
length
;
i
+
+
)
{
_getAllWindows
(
win
[
i
]
)
;
}
}
;
_getAllWindows
(
baseWindow
)
;
return
windows
;
}
let
windows
=
getAllWindows
(
content
)
;
for
(
let
win
of
windows
)
{
if
(
win
.
clear
)
{
yield
win
.
clear
(
)
;
}
}
}
)
;
}
