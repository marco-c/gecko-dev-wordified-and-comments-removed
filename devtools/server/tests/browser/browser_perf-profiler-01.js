"
use
strict
"
;
const
{
pmmIsProfilerActive
pmmLoadFrameScripts
}
=
require
(
"
devtools
/
client
/
performance
/
test
/
helpers
/
profiler
-
mm
-
utils
"
)
;
add_task
(
async
function
(
)
{
const
target
=
await
addTabTarget
(
MAIN_DOMAIN
+
"
doc_perf
.
html
"
)
;
const
front
=
target
.
getFront
(
"
performance
"
)
;
await
front
.
connect
(
)
;
pmmLoadFrameScripts
(
gBrowser
)
;
ok
(
!
(
await
pmmIsProfilerActive
(
)
)
"
The
built
-
in
profiler
module
should
not
have
been
automatically
started
.
"
)
;
let
rec
=
await
front
.
startRecording
(
)
;
await
front
.
stopRecording
(
rec
)
;
ok
(
(
await
pmmIsProfilerActive
(
)
)
"
The
built
-
in
profiler
module
should
still
be
active
(
1
)
.
"
)
;
rec
=
await
front
.
startRecording
(
)
;
await
front
.
stopRecording
(
rec
)
;
ok
(
(
await
pmmIsProfilerActive
(
)
)
"
The
built
-
in
profiler
module
should
still
be
active
(
2
)
.
"
)
;
await
front
.
destroy
(
)
;
await
target
.
destroy
(
)
;
ok
(
!
(
await
pmmIsProfilerActive
(
)
)
"
The
built
-
in
profiler
module
should
no
longer
be
active
.
"
)
;
gBrowser
.
removeCurrentTab
(
)
;
}
)
;
