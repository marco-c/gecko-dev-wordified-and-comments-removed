"
use
strict
"
;
const
{
TimelineFront
}
=
require
(
"
devtools
/
shared
/
fronts
/
timeline
"
)
;
add_task
(
async
function
(
)
{
await
addTab
(
MAIN_DOMAIN
+
"
timeline
-
iframe
-
parent
.
html
"
)
;
initDebuggerServer
(
)
;
const
client
=
new
DebuggerClient
(
DebuggerServer
.
connectPipe
(
)
)
;
const
form
=
await
connectDebuggerClient
(
client
)
;
const
front
=
TimelineFront
(
client
form
)
;
info
(
"
Start
timeline
marker
recording
"
)
;
await
front
.
start
(
{
withMarkers
:
true
}
)
;
for
(
let
i
=
0
;
i
<
3
;
i
+
+
)
{
await
wait
(
300
)
;
const
markers
=
await
once
(
front
"
markers
"
)
;
ok
(
markers
.
length
"
Markers
were
received
for
operations
in
the
child
frame
"
)
;
}
info
(
"
Stop
timeline
marker
recording
"
)
;
await
front
.
stop
(
)
;
await
client
.
close
(
)
;
gBrowser
.
removeCurrentTab
(
)
;
}
)
;
function
wait
(
ms
)
{
return
new
Promise
(
resolve
=
>
setTimeout
(
resolve
ms
)
)
;
}
