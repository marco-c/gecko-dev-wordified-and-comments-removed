"
use
strict
"
;
const
TEST_URI
=
"
data
:
text
/
html
<
title
>
Test
getFontPreviewData
<
/
title
>
"
;
add_task
(
async
function
(
)
{
await
addTab
(
TEST_URI
)
;
await
SpecialPowers
.
spawn
(
gBrowser
.
selectedBrowser
[
]
async
function
(
)
{
const
{
require
}
=
ChromeUtils
.
import
(
"
resource
:
/
/
devtools
/
shared
/
Loader
.
jsm
"
)
;
const
{
getFontPreviewData
}
=
require
(
"
devtools
/
server
/
actors
/
utils
/
style
-
utils
"
)
;
const
font
=
Services
.
appinfo
.
OS
=
=
=
"
WINNT
"
?
"
Arial
"
:
"
Liberation
Sans
"
;
let
fontPreviewData
=
getFontPreviewData
(
font
content
.
document
)
;
ok
(
fontPreviewData
?
.
dataURL
"
Returned
a
font
preview
with
a
valid
dataURL
"
)
;
const
image
=
content
.
document
.
createElement
(
"
img
"
)
;
let
imageLoaded
=
new
Promise
(
loaded
=
>
image
.
addEventListener
(
"
load
"
loaded
{
once
:
true
}
)
)
;
image
.
src
=
fontPreviewData
.
dataURL
;
await
imageLoaded
;
const
{
naturalWidth
:
widthImage1
naturalHeight
:
heightImage1
}
=
image
;
ok
(
widthImage1
>
0
"
Preview
width
is
greater
than
0
"
)
;
ok
(
heightImage1
>
0
"
Preview
height
is
greater
than
0
"
)
;
fontPreviewData
=
getFontPreviewData
(
font
content
.
document
{
previewText
:
"
Abcdef
"
}
)
;
ok
(
fontPreviewData
?
.
dataURL
"
Returned
a
font
preview
with
a
valid
dataURL
"
)
;
imageLoaded
=
new
Promise
(
loaded
=
>
image
.
addEventListener
(
"
load
"
loaded
{
once
:
true
}
)
)
;
image
.
src
=
fontPreviewData
.
dataURL
;
await
imageLoaded
;
const
{
naturalWidth
:
widthImage2
naturalHeight
:
heightImage2
}
=
image
;
ok
(
widthImage2
>
widthImage1
"
Preview
width
is
greater
than
with
default
parameters
"
)
;
ok
(
heightImage2
=
=
=
heightImage1
"
Preview
height
is
the
same
as
with
default
parameters
"
)
;
fontPreviewData
=
getFontPreviewData
(
font
content
.
document
{
previewFontSize
:
20
}
)
;
ok
(
fontPreviewData
?
.
dataURL
"
Returned
a
font
preview
with
a
valid
dataURL
"
)
;
imageLoaded
=
new
Promise
(
loaded
=
>
image
.
addEventListener
(
"
load
"
loaded
{
once
:
true
}
)
)
;
image
.
src
=
fontPreviewData
.
dataURL
;
await
imageLoaded
;
const
{
naturalWidth
:
widthImage3
naturalHeight
:
heightImage3
}
=
image
;
ok
(
widthImage3
<
widthImage1
"
Preview
width
is
smaller
than
with
default
parameters
"
)
;
ok
(
heightImage3
<
heightImage1
"
Preview
height
is
smaller
than
with
default
parameters
"
)
;
fontPreviewData
=
getFontPreviewData
(
font
content
.
document
{
previewText
:
"
Abc
\
ndef
"
}
)
;
ok
(
fontPreviewData
?
.
dataURL
"
Returned
a
font
preview
with
a
valid
dataURL
"
)
;
imageLoaded
=
new
Promise
(
loaded
=
>
image
.
addEventListener
(
"
load
"
loaded
{
once
:
true
}
)
)
;
image
.
src
=
fontPreviewData
.
dataURL
;
await
imageLoaded
;
const
{
naturalWidth
:
widthImage4
naturalHeight
:
heightImage4
}
=
image
;
ok
(
widthImage4
=
=
=
widthImage1
"
Preview
width
is
the
same
as
with
default
parameters
"
)
;
ok
(
heightImage4
>
heightImage1
"
Preview
height
is
greater
than
with
default
parameters
"
)
;
}
)
;
}
)
;
