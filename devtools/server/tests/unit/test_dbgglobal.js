"
use
strict
"
;
function
run_test
(
)
{
check_except
(
function
(
)
{
DebuggerServer
.
createListener
(
)
;
}
)
;
check_except
(
DebuggerServer
.
closeAllListeners
)
;
check_except
(
DebuggerServer
.
connectPipe
)
;
DebuggerServer
.
init
(
)
;
check_except
(
DebuggerServer
.
closeAllListeners
)
;
check_except
(
DebuggerServer
.
connectPipe
)
;
DebuggerServer
.
registerModule
(
"
xpcshell
-
test
/
testactors
"
)
;
DebuggerServer
.
createListener
(
)
;
DebuggerServer
.
closeAllListeners
(
)
;
let
client1
=
DebuggerServer
.
connectPipe
(
)
;
client1
.
hooks
=
{
onPacket
:
function
(
packet1
)
{
do_check_eq
(
packet1
.
from
"
root
"
)
;
do_check_eq
(
packet1
.
applicationType
"
xpcshell
-
tests
"
)
;
let
client2
=
DebuggerServer
.
connectPipe
(
)
;
client2
.
hooks
=
{
onPacket
:
function
(
packet2
)
{
do_check_eq
(
packet2
.
from
"
root
"
)
;
do_check_neq
(
packet1
.
testConnectionPrefix
packet2
.
testConnectionPrefix
)
;
client2
.
close
(
)
;
}
onClosed
:
function
(
result
)
{
client1
.
close
(
)
;
}
}
;
client2
.
ready
(
)
;
}
onClosed
:
function
(
result
)
{
do_test_finished
(
)
;
}
}
;
client1
.
ready
(
)
;
do_test_pending
(
)
;
}
