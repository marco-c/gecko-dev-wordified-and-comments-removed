"
use
strict
"
;
const
{
getDeviceFront
}
=
require
(
"
devtools
/
shared
/
fronts
/
device
"
)
;
add_task
(
async
function
(
)
{
const
testFile
=
do_get_file
(
"
xpcshell_debugging_script
.
js
"
)
;
let
testResumed
=
false
;
const
DebuggerServer
=
_setupDebuggerServer
(
[
testFile
.
path
]
(
)
=
>
{
testResumed
=
true
;
}
)
;
const
transport
=
DebuggerServer
.
connectPipe
(
)
;
const
client
=
new
DebuggerClient
(
transport
)
;
await
client
.
connect
(
)
;
const
rootForm
=
await
client
.
mainRoot
.
getRoot
(
)
;
const
deviceFront
=
await
getDeviceFront
(
client
rootForm
)
;
const
desc
=
await
deviceFront
.
getDescription
(
)
;
equal
(
desc
.
geckobuildid
Services
.
appinfo
.
platformBuildID
"
device
actor
works
"
)
;
const
response
=
await
client
.
getProcess
(
)
;
const
actor
=
response
.
form
.
actor
;
const
[
tabClient
]
=
await
client
.
attachTab
(
actor
)
;
const
[
threadClient
]
=
await
tabClient
.
attachThread
(
null
)
;
const
onResumed
=
new
Promise
(
resolve
=
>
{
threadClient
.
addOneTimeListener
(
"
paused
"
(
event
packet
)
=
>
{
equal
(
packet
.
why
.
type
"
breakpoint
"
"
yay
-
hit
the
breakpoint
at
the
first
line
in
our
script
"
)
;
threadClient
.
addOneTimeListener
(
"
paused
"
(
event
packet
)
=
>
{
equal
(
packet
.
why
.
type
"
debuggerStatement
"
"
yay
-
hit
the
'
debugger
'
statement
in
our
script
"
)
;
threadClient
.
resume
(
resolve
)
;
}
)
;
threadClient
.
resume
(
)
;
}
)
;
}
)
;
threadClient
.
resume
(
(
)
=
>
{
ok
(
testResumed
)
;
load
(
testFile
.
path
)
;
}
)
;
await
onResumed
;
finishClient
(
client
)
;
}
)
;
