"
use
strict
"
;
const
nsIInterfaceRequestor
=
Components
.
interfaces
.
nsIInterfaceRequestor
;
const
nsIDOMWindowUtils
=
Components
.
interfaces
.
nsIDOMWindowUtils
;
window
.
onload
=
function
(
)
{
SimpleTest
.
waitForExplicitFinish
(
)
;
let
iframe
=
document
.
createElement
(
"
iframe
"
)
;
iframe
.
src
=
"
http
:
/
/
mochi
.
test
:
8888
/
chrome
/
devtools
/
server
/
tests
/
mochitest
/
suspendTimeouts_content
.
html
"
;
iframe
.
onload
=
iframe_onload_handler
;
document
.
body
.
appendChild
(
iframe
)
;
function
iframe_onload_handler
(
)
{
const
content
=
iframe
.
contentWindow
.
wrappedJSObject
;
const
windowUtils
=
iframe
.
contentWindow
.
QueryInterface
(
nsIInterfaceRequestor
)
.
getInterface
(
nsIDOMWindowUtils
)
;
content
.
suspendTimeouts
=
function
(
)
{
SimpleTest
.
info
(
"
test_suspendTimeouts
"
"
calling
suspendTimeouts
"
)
;
windowUtils
.
suspendTimeouts
(
)
;
}
;
content
.
resumeTimeouts
=
function
(
)
{
windowUtils
.
resumeTimeouts
(
)
;
SimpleTest
.
info
(
"
test_suspendTimeouts
"
"
resumeTimeouts
called
"
)
;
}
;
content
.
info
=
function
(
message
)
{
SimpleTest
.
info
(
"
suspendTimeouts_content
.
js
"
message
)
;
}
;
content
.
ok
=
SimpleTest
.
ok
;
content
.
finish
=
finish
;
SimpleTest
.
info
(
"
Disappointed
with
National
Tautology
Day
?
Well
it
is
what
it
is
.
"
)
;
const
workerPort
=
content
.
create_channel
(
)
;
workerPort
.
onmessage
=
handle_worker_echo
;
content
.
start_worker
(
)
;
function
handle_worker_echo
(
{
data
}
)
{
info
(
mochitest
received
message
from
worker
:
{
data
}
)
;
setTimeout
(
(
)
=
>
{
content
.
resume_timeouts
(
)
;
}
1000
)
;
}
function
finish
(
message
)
{
SimpleTest
.
info
(
"
suspendTimeouts_content
.
js
"
"
called
finish
"
)
;
SimpleTest
.
finish
(
)
;
}
}
}
;
