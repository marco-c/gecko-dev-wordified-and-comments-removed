"
use
strict
"
;
const
worker
=
new
Worker
(
"
suspendTimeouts_worker
.
js
"
)
;
worker
.
onerror
=
error
=
>
{
const
message
=
error
from
worker
:
{
error
.
filename
}
:
{
error
.
lineno
}
:
{
error
.
message
}
;
throw
new
Error
(
message
)
;
}
;
function
create_channel
(
)
{
const
{
port1
port2
}
=
new
MessageChannel
(
)
;
info
(
sending
port
to
worker
)
;
worker
.
postMessage
(
{
mochitestPort
:
port1
}
[
port1
]
)
;
return
port2
;
}
function
start_worker
(
)
{
worker
.
onmessage
=
handle_echo
;
suspendTimeouts
(
)
;
worker
.
postMessage
(
"
HALLOOOOOO
"
)
;
info
(
posted
message
to
worker
)
;
}
var
resumeTimeouts_has_returned
=
false
;
function
resume_timeouts
(
)
{
resumeTimeouts
(
)
;
resumeTimeouts_has_returned
=
true
;
}
function
handle_echo
(
{
data
}
)
{
ok
(
resumeTimeouts_has_returned
"
worker
message
delivered
from
main
event
loop
"
)
;
finish
(
)
;
}
