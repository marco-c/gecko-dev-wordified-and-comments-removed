"
use
strict
"
;
const
{
require
}
=
ChromeUtils
.
import
(
"
resource
:
/
/
devtools
/
shared
/
Loader
.
jsm
"
)
;
const
{
DevToolsServer
}
=
require
(
"
devtools
/
server
/
devtools
-
server
"
)
;
const
{
TabDescriptorFactory
}
=
require
(
"
devtools
/
client
/
framework
/
tab
-
descriptor
-
factory
"
)
;
const
Services
=
require
(
"
Services
"
)
;
Services
.
prefs
.
setBoolPref
(
"
devtools
.
debugger
.
log
"
true
)
;
SimpleTest
.
registerCleanupFunction
(
function
(
)
{
Services
.
prefs
.
clearUserPref
(
"
devtools
.
debugger
.
log
"
)
;
}
)
;
if
(
!
DevToolsServer
.
initialized
)
{
DevToolsServer
.
init
(
)
;
DevToolsServer
.
registerAllActors
(
)
;
SimpleTest
.
registerCleanupFunction
(
function
(
)
{
DevToolsServer
.
destroy
(
)
;
}
)
;
}
async
function
attachURL
(
url
)
{
const
tab
=
await
addTab
(
url
)
;
const
descriptor
=
await
TabDescriptorFactory
.
createDescriptorForTab
(
tab
)
;
const
target
=
await
descriptor
.
getTarget
(
)
;
await
target
.
attach
(
)
;
const
webConsoleFront
=
await
target
.
getFront
(
"
console
"
)
;
return
{
webConsoleFront
}
;
}
async
function
addTab
(
url
)
{
const
{
gBrowser
}
=
Services
.
wm
.
getMostRecentWindow
(
"
navigator
:
browser
"
)
;
const
{
BrowserTestUtils
}
=
require
(
"
resource
:
/
/
testing
-
common
/
BrowserTestUtils
.
jsm
"
)
;
const
tab
=
(
gBrowser
.
selectedTab
=
BrowserTestUtils
.
addTab
(
gBrowser
url
)
)
;
await
BrowserTestUtils
.
browserLoaded
(
tab
.
linkedBrowser
)
;
return
tab
;
}
