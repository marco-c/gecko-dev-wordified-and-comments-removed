"
use
strict
"
;
var
protocol
=
require
(
"
devtools
/
shared
/
protocol
"
)
;
const
{
arrayBufferSpec
}
=
require
(
"
devtools
/
shared
/
specs
/
array
-
buffer
"
)
;
const
ArrayBufferActor
=
protocol
.
ActorClassWithSpec
(
arrayBufferSpec
{
initialize
:
function
(
conn
buffer
)
{
protocol
.
Actor
.
prototype
.
initialize
.
call
(
this
conn
)
;
this
.
buffer
=
buffer
;
this
.
bufferLength
=
buffer
.
byteLength
;
}
rawValue
:
function
(
)
{
return
this
.
buffer
;
}
form
:
function
(
)
{
return
{
typeName
:
this
.
typeName
length
:
this
.
bufferLength
actor
:
this
.
actorID
}
;
}
slice
(
start
count
)
{
const
slice
=
new
Uint8Array
(
this
.
buffer
start
count
)
;
const
parts
=
[
]
;
let
offset
=
0
;
const
PortionSize
=
0x6000
;
while
(
offset
+
PortionSize
<
count
)
{
parts
.
push
(
btoa
(
String
.
fromCharCode
.
apply
(
null
slice
.
subarray
(
offset
offset
+
PortionSize
)
)
)
)
;
offset
+
=
PortionSize
;
}
parts
.
push
(
btoa
(
String
.
fromCharCode
.
apply
(
null
slice
.
subarray
(
offset
count
)
)
)
)
;
return
{
"
from
"
:
this
.
actorID
"
encoded
"
:
parts
.
join
(
"
"
)
}
;
}
}
)
;
module
.
exports
=
{
ArrayBufferActor
}
;
