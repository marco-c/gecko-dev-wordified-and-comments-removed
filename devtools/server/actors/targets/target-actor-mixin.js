"
use
strict
"
;
const
{
ActorClassWithSpec
}
=
require
(
"
resource
:
/
/
devtools
/
shared
/
protocol
.
js
"
)
;
loader
.
lazyRequireGetter
(
this
"
SessionDataProcessors
"
"
devtools
/
server
/
actors
/
targets
/
session
-
data
-
processors
/
index
"
true
)
;
loader
.
lazyRequireGetter
(
this
"
StyleSheetsManager
"
"
devtools
/
server
/
actors
/
utils
/
stylesheets
-
manager
"
true
)
;
module
.
exports
=
function
(
targetType
targetActorSpec
implementation
)
{
const
proto
=
{
targetType
async
addSessionDataEntry
(
type
entries
isDocumentCreation
=
false
)
{
const
processor
=
SessionDataProcessors
[
type
]
;
if
(
processor
)
{
await
processor
.
addSessionDataEntry
(
this
entries
isDocumentCreation
)
;
}
}
removeSessionDataEntry
(
type
entries
)
{
const
processor
=
SessionDataProcessors
[
type
]
;
if
(
processor
)
{
processor
.
removeSessionDataEntry
(
this
entries
)
;
}
}
notifyResources
(
updateType
resources
)
{
if
(
resources
.
length
=
=
=
0
|
|
this
.
isDestroyed
(
)
)
{
return
;
}
if
(
this
.
devtoolsSpawnedBrowsingContextForWebExtension
)
{
this
.
overrideResourceBrowsingContextForWebExtension
(
resources
)
;
}
this
.
emit
(
resource
-
{
updateType
}
-
form
resources
)
;
}
overrideResourceBrowsingContextForWebExtension
(
resources
)
{
const
browsingContextID
=
this
.
devtoolsSpawnedBrowsingContextForWebExtension
.
id
;
resources
.
forEach
(
resource
=
>
(
resource
.
browsingContextID
=
browsingContextID
)
)
;
}
getStyleSheetManager
(
)
{
if
(
!
this
.
_styleSheetManager
)
{
this
.
_styleSheetManager
=
new
StyleSheetsManager
(
this
)
;
}
return
this
.
_styleSheetManager
;
}
}
;
Object
.
defineProperties
(
proto
Object
.
getOwnPropertyDescriptors
(
implementation
)
)
;
proto
.
initialize
=
function
(
)
{
if
(
typeof
implementation
.
initialize
=
=
"
function
"
)
{
implementation
.
initialize
.
apply
(
this
arguments
)
;
}
}
;
proto
.
destroy
=
function
(
)
{
if
(
this
.
_styleSheetManager
)
{
this
.
_styleSheetManager
.
destroy
(
)
;
this
.
_styleSheetManager
=
null
;
}
if
(
typeof
implementation
.
destroy
=
=
"
function
"
)
{
implementation
.
destroy
.
apply
(
this
arguments
)
;
}
}
;
return
ActorClassWithSpec
(
targetActorSpec
proto
)
;
}
;
