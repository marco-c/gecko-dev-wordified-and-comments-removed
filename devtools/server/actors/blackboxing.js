"
use
strict
"
;
const
{
Actor
}
=
require
(
"
resource
:
/
/
devtools
/
shared
/
protocol
.
js
"
)
;
const
{
blackboxingSpec
}
=
require
(
"
resource
:
/
/
devtools
/
shared
/
specs
/
blackboxing
.
js
"
)
;
const
{
SessionDataHelpers
}
=
ChromeUtils
.
importESModule
(
"
resource
:
/
/
devtools
/
server
/
actors
/
watcher
/
SessionDataHelpers
.
sys
.
mjs
"
{
global
:
"
contextual
"
}
)
;
const
{
SUPPORTED_DATA
}
=
SessionDataHelpers
;
const
{
BLACKBOXING
}
=
SUPPORTED_DATA
;
class
BlackboxingActor
extends
Actor
{
constructor
(
watcherActor
)
{
super
(
watcherActor
.
conn
blackboxingSpec
)
;
this
.
watcherActor
=
watcherActor
;
}
blackbox
(
url
ranges
)
{
if
(
!
ranges
.
length
)
{
return
this
.
watcherActor
.
addOrSetDataEntry
(
BLACKBOXING
[
{
url
range
:
null
}
]
"
add
"
)
;
}
return
this
.
watcherActor
.
addOrSetDataEntry
(
BLACKBOXING
ranges
.
map
(
range
=
>
{
return
{
url
range
}
;
}
)
"
add
"
)
;
}
unblackbox
(
url
ranges
)
{
if
(
!
ranges
.
length
)
{
const
existingRanges
=
(
this
.
watcherActor
.
getSessionDataForType
(
BLACKBOXING
)
|
|
[
]
)
.
filter
(
entry
=
>
entry
.
url
=
=
url
)
;
return
this
.
watcherActor
.
removeDataEntry
(
BLACKBOXING
existingRanges
)
;
}
return
this
.
watcherActor
.
removeDataEntry
(
BLACKBOXING
ranges
.
map
(
range
=
>
{
return
{
url
range
}
;
}
)
)
;
}
}
exports
.
BlackboxingActor
=
BlackboxingActor
;
