"
use
strict
"
;
const
{
TYPES
:
{
JSTRACER_STATE
}
}
=
require
(
"
resource
:
/
/
devtools
/
server
/
actors
/
resources
/
index
.
js
"
)
;
const
{
addTracingListener
removeTracingListener
}
=
require
(
"
resource
:
/
/
devtools
/
server
/
tracer
/
tracer
.
jsm
"
)
;
const
{
LOG_METHODS
}
=
require
(
"
resource
:
/
/
devtools
/
server
/
actors
/
tracer
.
js
"
)
;
const
Targets
=
require
(
"
resource
:
/
/
devtools
/
server
/
actors
/
targets
/
index
.
js
"
)
;
class
TracingStateWatcher
{
async
watch
(
targetActor
{
onAvailable
}
)
{
if
(
targetActor
.
targetType
=
=
Targets
.
TYPES
.
PROCESS
)
{
return
;
}
this
.
targetActor
=
targetActor
;
this
.
onAvailable
=
onAvailable
;
this
.
tracingListener
=
{
onTracingToggled
:
this
.
onTracingToggled
.
bind
(
this
)
}
;
addTracingListener
(
this
.
tracingListener
)
;
}
destroy
(
)
{
if
(
!
this
.
tracingListener
)
{
return
;
}
removeTracingListener
(
this
.
tracingListener
)
;
}
onTracingToggled
(
enabled
reason
)
{
const
tracerActor
=
this
.
targetActor
.
getTargetScopedActor
(
"
tracer
"
)
;
const
logMethod
=
tracerActor
?
.
getLogMethod
(
)
;
if
(
!
logMethod
)
{
return
;
}
this
.
onAvailable
(
[
{
resourceType
:
JSTRACER_STATE
enabled
logMethod
profile
:
logMethod
=
=
LOG_METHODS
.
PROFILER
&
&
!
enabled
?
tracerActor
.
getProfile
(
)
:
undefined
timeStamp
:
ChromeUtils
.
dateNow
(
)
reason
}
]
)
;
}
}
module
.
exports
=
TracingStateWatcher
;
