"
use
strict
"
;
const
{
TYPES
:
{
DOCUMENT_EVENT
}
}
=
require
(
"
devtools
/
server
/
actors
/
resources
/
index
"
)
;
const
{
DocumentEventsListener
}
=
require
(
"
devtools
/
server
/
actors
/
webconsole
/
listeners
/
document
-
events
"
)
;
class
DocumentEventWatcher
{
#
abortController
=
new
AbortController
(
)
;
async
watch
(
targetActor
{
onAvailable
}
)
{
if
(
isWorker
)
{
return
;
}
const
onDocumentEvent
=
(
name
{
time
isFrameSwitching
hasNativeConsoleAPI
newURI
}
=
{
}
)
=
>
{
if
(
name
=
=
"
will
-
navigate
"
&
&
!
isFrameSwitching
)
{
return
;
}
onAvailable
(
[
{
resourceType
:
DOCUMENT_EVENT
name
time
isFrameSwitching
title
:
name
=
=
=
"
dom
-
interactive
"
?
targetActor
.
title
:
undefined
url
:
name
=
=
=
"
dom
-
loading
"
|
|
name
=
=
=
"
dom
-
interactive
"
?
targetActor
.
url
:
undefined
newURI
:
name
=
=
=
"
will
-
navigate
"
?
newURI
:
null
hasNativeConsoleAPI
:
name
=
=
"
dom
-
complete
"
?
hasNativeConsoleAPI
:
null
}
]
)
;
}
;
this
.
listener
=
new
DocumentEventsListener
(
targetActor
)
;
this
.
listener
.
on
(
"
will
-
navigate
"
data
=
>
onDocumentEvent
(
"
will
-
navigate
"
data
)
{
signal
:
this
.
#
abortController
.
signal
}
)
;
this
.
listener
.
on
(
"
dom
-
loading
"
data
=
>
onDocumentEvent
(
"
dom
-
loading
"
data
)
{
signal
:
this
.
#
abortController
.
signal
}
)
;
this
.
listener
.
on
(
"
dom
-
interactive
"
data
=
>
onDocumentEvent
(
"
dom
-
interactive
"
data
)
{
signal
:
this
.
#
abortController
.
signal
}
)
;
this
.
listener
.
on
(
"
dom
-
complete
"
data
=
>
onDocumentEvent
(
"
dom
-
complete
"
data
)
{
signal
:
this
.
#
abortController
.
signal
}
)
;
this
.
listener
.
listen
(
)
;
}
destroy
(
)
{
this
.
#
abortController
.
abort
(
)
;
if
(
this
.
listener
)
{
this
.
listener
.
destroy
(
)
;
}
}
}
module
.
exports
=
DocumentEventWatcher
;
