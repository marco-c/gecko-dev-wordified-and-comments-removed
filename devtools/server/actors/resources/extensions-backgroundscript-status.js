"
use
strict
"
;
const
Services
=
require
(
"
Services
"
)
;
const
{
TYPES
:
{
EXTENSIONS_BGSCRIPT_STATUS
}
}
=
require
(
"
devtools
/
server
/
actors
/
resources
/
index
"
)
;
class
ExtensionsBackgroundScriptStatusWatcher
{
async
watch
(
rootActor
{
onAvailable
}
)
{
this
.
rootActor
=
rootActor
;
this
.
onAvailable
=
onAvailable
;
Services
.
obs
.
addObserver
(
this
"
extension
:
background
-
script
-
status
"
)
;
}
observe
(
subject
topic
data
)
{
switch
(
topic
)
{
case
"
extension
:
background
-
script
-
status
"
:
{
const
{
addonId
isRunning
}
=
subject
.
wrappedJSObject
;
this
.
onBackgroundScriptStatus
(
addonId
isRunning
)
;
break
;
}
}
}
onBackgroundScriptStatus
(
addonId
isRunning
)
{
this
.
onAvailable
(
[
{
resourceType
:
EXTENSIONS_BGSCRIPT_STATUS
payload
:
{
addonId
isRunning
}
}
]
)
;
}
destroy
(
)
{
if
(
this
.
onAvailable
)
{
this
.
onAvailable
=
null
;
Services
.
obs
.
removeObserver
(
this
"
extension
:
background
-
script
-
status
"
)
;
}
}
}
module
.
exports
=
ExtensionsBackgroundScriptStatusWatcher
;
