"
use
strict
"
;
const
protocol
=
require
(
"
devtools
/
shared
/
protocol
"
)
;
const
{
ActorClassWithSpec
Actor
}
=
protocol
;
const
{
actorBridgeWithSpec
}
=
require
(
"
devtools
/
server
/
actors
/
common
"
)
;
const
{
perfSpec
}
=
require
(
"
devtools
/
shared
/
specs
/
perf
"
)
;
const
{
ActorReadyGeckoProfilerInterface
}
=
require
(
"
devtools
/
shared
/
performance
-
new
/
gecko
-
profiler
-
interface
"
)
;
function
_bridgeEvents
(
actor
names
)
{
for
(
const
name
of
names
)
{
actor
.
bridge
.
on
(
name
(
.
.
.
args
)
=
>
actor
.
emit
(
name
.
.
.
args
)
)
;
}
}
exports
.
PerfActor
=
ActorClassWithSpec
(
perfSpec
{
initialize
:
function
(
conn
targetActor
)
{
Actor
.
prototype
.
initialize
.
call
(
this
conn
)
;
this
.
bridge
=
new
ActorReadyGeckoProfilerInterface
(
)
;
_bridgeEvents
(
this
[
"
profile
-
locked
-
by
-
private
-
browsing
"
"
profile
-
unlocked
-
from
-
private
-
browsing
"
"
profiler
-
started
"
"
profiler
-
stopped
"
]
)
;
}
destroy
:
function
(
conn
)
{
Actor
.
prototype
.
destroy
.
call
(
this
conn
)
;
this
.
bridge
.
destroy
(
)
;
}
startProfiler
:
actorBridgeWithSpec
(
"
startProfiler
"
)
stopProfilerAndDiscardProfile
:
actorBridgeWithSpec
(
"
stopProfilerAndDiscardProfile
"
)
getSymbolTable
:
actorBridgeWithSpec
(
"
getSymbolTable
"
)
getProfileAndStopProfiler
:
actorBridgeWithSpec
(
"
getProfileAndStopProfiler
"
)
isActive
:
actorBridgeWithSpec
(
"
isActive
"
)
isSupportedPlatform
:
actorBridgeWithSpec
(
"
isSupportedPlatform
"
)
isLockedForPrivateBrowsing
:
actorBridgeWithSpec
(
"
isLockedForPrivateBrowsing
"
)
getSupportedFeatures
:
actorBridgeWithSpec
(
"
getSupportedFeatures
"
)
}
)
;
