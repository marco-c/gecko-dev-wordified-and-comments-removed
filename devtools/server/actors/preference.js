"
use
strict
"
;
const
{
Actor
}
=
require
(
"
resource
:
/
/
devtools
/
shared
/
protocol
.
js
"
)
;
const
{
preferenceSpec
}
=
require
(
"
resource
:
/
/
devtools
/
shared
/
specs
/
preference
.
js
"
)
;
const
{
PREF_STRING
PREF_INT
PREF_BOOL
}
=
Services
.
prefs
;
function
ensurePrefType
(
name
expectedType
)
{
const
type
=
Services
.
prefs
.
getPrefType
(
name
)
;
if
(
type
!
=
=
expectedType
)
{
throw
new
Error
(
preference
is
not
of
the
right
type
:
{
name
}
)
;
}
}
class
PreferenceActor
extends
Actor
{
constructor
(
conn
)
{
super
(
conn
preferenceSpec
)
;
}
getTraits
(
)
{
return
{
}
;
}
getBoolPref
(
name
)
{
ensurePrefType
(
name
PREF_BOOL
)
;
return
Services
.
prefs
.
getBoolPref
(
name
)
;
}
getCharPref
(
name
)
{
ensurePrefType
(
name
PREF_STRING
)
;
return
Services
.
prefs
.
getCharPref
(
name
)
;
}
getIntPref
(
name
)
{
ensurePrefType
(
name
PREF_INT
)
;
return
Services
.
prefs
.
getIntPref
(
name
)
;
}
getAllPrefs
(
)
{
const
prefs
=
{
}
;
Services
.
prefs
.
getChildList
(
"
"
)
.
forEach
(
function
(
name
)
{
try
{
let
value
;
switch
(
Services
.
prefs
.
getPrefType
(
name
)
)
{
case
PREF_STRING
:
value
=
Services
.
prefs
.
getCharPref
(
name
)
;
break
;
case
PREF_INT
:
value
=
Services
.
prefs
.
getIntPref
(
name
)
;
break
;
case
PREF_BOOL
:
value
=
Services
.
prefs
.
getBoolPref
(
name
)
;
break
;
default
:
}
prefs
[
name
]
=
{
value
hasUserValue
:
Services
.
prefs
.
prefHasUserValue
(
name
)
}
;
}
catch
(
e
)
{
}
}
)
;
return
prefs
;
}
setBoolPref
(
name
value
)
{
Services
.
prefs
.
setBoolPref
(
name
value
)
;
Services
.
prefs
.
savePrefFile
(
null
)
;
}
setCharPref
(
name
value
)
{
Services
.
prefs
.
setCharPref
(
name
value
)
;
Services
.
prefs
.
savePrefFile
(
null
)
;
}
setIntPref
(
name
value
)
{
Services
.
prefs
.
setIntPref
(
name
value
)
;
Services
.
prefs
.
savePrefFile
(
null
)
;
}
clearUserPref
(
name
)
{
Services
.
prefs
.
clearUserPref
(
name
)
;
Services
.
prefs
.
savePrefFile
(
null
)
;
}
}
exports
.
PreferenceActor
=
PreferenceActor
;
