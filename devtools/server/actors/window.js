"
use
strict
"
;
const
{
Ci
}
=
require
(
"
chrome
"
)
;
const
Services
=
require
(
"
Services
"
)
;
const
{
TabActor
}
=
require
(
"
.
/
tab
"
)
;
const
{
extend
}
=
require
(
"
devtools
/
shared
/
extend
"
)
;
const
{
ActorClassWithSpec
Actor
}
=
require
(
"
devtools
/
shared
/
protocol
"
)
;
const
{
tabSpec
}
=
require
(
"
devtools
/
shared
/
specs
/
tab
"
)
;
const
windowPrototype
=
extend
(
{
}
TabActor
.
prototype
)
;
windowPrototype
.
initialize
=
function
(
connection
window
)
{
Actor
.
prototype
.
initialize
.
call
(
this
connection
)
;
TabActor
.
call
(
this
connection
)
;
const
docShell
=
window
.
QueryInterface
(
Ci
.
nsIInterfaceRequestor
)
.
getInterface
(
Ci
.
nsIDocShell
)
;
Object
.
defineProperty
(
this
"
docShell
"
{
value
:
docShell
configurable
:
true
}
)
;
}
;
windowPrototype
.
isRootActor
=
true
;
windowPrototype
.
observe
=
function
(
subject
topic
data
)
{
TabActor
.
prototype
.
observe
.
call
(
this
subject
topic
data
)
;
if
(
!
this
.
attached
)
{
return
;
}
if
(
topic
=
=
"
chrome
-
webnavigation
-
destroy
"
)
{
this
.
_onDocShellDestroy
(
subject
)
;
}
}
;
windowPrototype
.
_attach
=
function
(
)
{
if
(
this
.
attached
)
{
return
false
;
}
TabActor
.
prototype
.
_attach
.
call
(
this
)
;
if
(
this
.
docShell
.
itemType
=
=
Ci
.
nsIDocShellTreeItem
.
typeChrome
)
{
Services
.
obs
.
addObserver
(
this
"
chrome
-
webnavigation
-
destroy
"
)
;
}
return
true
;
}
;
windowPrototype
.
_detach
=
function
(
)
{
if
(
!
this
.
attached
)
{
return
false
;
}
if
(
this
.
docShell
.
itemType
=
=
Ci
.
nsIDocShellTreeItem
.
typeChrome
)
{
Services
.
obs
.
removeObserver
(
this
"
chrome
-
webnavigation
-
destroy
"
)
;
}
TabActor
.
prototype
.
_detach
.
call
(
this
)
;
return
true
;
}
;
exports
.
WindowActor
=
ActorClassWithSpec
(
tabSpec
windowPrototype
)
;
