"
use
strict
"
;
const
{
Actor
}
=
require
(
"
resource
:
/
/
devtools
/
shared
/
protocol
.
js
"
)
;
const
{
environmentSpec
}
=
require
(
"
resource
:
/
/
devtools
/
shared
/
specs
/
environment
.
js
"
)
;
class
EnvironmentActor
extends
Actor
{
constructor
(
environment
threadActor
)
{
super
(
threadActor
.
conn
environmentSpec
)
;
this
.
obj
=
environment
;
this
.
threadActor
=
threadActor
;
}
destroy
(
)
{
this
.
obj
.
actor
=
null
;
super
.
destroy
(
)
;
}
form
(
)
{
const
form
=
{
actor
:
this
.
actorID
}
;
if
(
this
.
obj
.
type
=
=
"
declarative
"
)
{
form
.
type
=
this
.
obj
.
calleeScript
?
"
function
"
:
"
block
"
;
}
else
{
form
.
type
=
this
.
obj
.
type
;
}
form
.
scopeKind
=
this
.
obj
.
scopeKind
;
if
(
this
.
obj
.
parent
)
{
form
.
parent
=
this
.
threadActor
.
createEnvironmentActor
(
this
.
obj
.
parent
this
.
threadActor
)
.
form
(
)
;
}
if
(
this
.
obj
.
type
=
=
"
object
"
|
|
this
.
obj
.
type
=
=
"
with
"
)
{
form
.
object
=
this
.
threadActor
.
createValueGrip
(
this
.
obj
.
object
)
;
}
if
(
this
.
obj
.
calleeScript
)
{
form
.
function
=
{
displayName
:
this
.
obj
.
calleeScript
.
displayName
}
;
}
if
(
this
.
obj
.
type
=
=
"
declarative
"
)
{
form
.
bindings
=
this
.
bindings
(
)
;
}
return
form
;
}
bindings
(
)
{
const
bindings
=
{
arguments
:
[
]
variables
:
Object
.
create
(
null
)
}
;
if
(
typeof
this
.
obj
.
getVariable
!
=
"
function
"
)
{
return
bindings
;
}
let
parameterNames
;
if
(
this
.
obj
.
calleeScript
)
{
parameterNames
=
this
.
obj
.
calleeScript
.
parameterNames
;
}
else
{
parameterNames
=
[
]
;
}
for
(
const
name
of
parameterNames
)
{
const
arg
=
Object
.
create
(
null
)
;
const
value
=
this
.
obj
.
getVariable
(
name
)
;
const
desc
=
{
value
configurable
:
false
writable
:
!
value
?
.
optimizedOut
enumerable
:
true
}
;
const
descForm
=
{
enumerable
:
true
configurable
:
desc
.
configurable
}
;
if
(
"
value
"
in
desc
)
{
descForm
.
value
=
this
.
threadActor
.
createValueGrip
(
desc
.
value
)
;
descForm
.
writable
=
desc
.
writable
;
}
else
{
descForm
.
get
=
this
.
threadActor
.
createValueGrip
(
desc
.
get
)
;
descForm
.
set
=
this
.
threadActor
.
createValueGrip
(
desc
.
set
)
;
}
arg
[
name
]
=
descForm
;
bindings
.
arguments
.
push
(
arg
)
;
}
for
(
const
name
of
this
.
obj
.
names
(
)
)
{
if
(
bindings
.
arguments
.
some
(
function
exists
(
element
)
{
return
!
!
element
[
name
]
;
}
)
)
{
continue
;
}
const
value
=
this
.
obj
.
getVariable
(
name
)
;
const
desc
=
{
value
configurable
:
false
writable
:
!
(
value
&
&
(
value
.
optimizedOut
|
|
value
.
uninitialized
|
|
value
.
missingArguments
)
)
enumerable
:
true
}
;
const
descForm
=
{
enumerable
:
true
configurable
:
desc
.
configurable
}
;
if
(
"
value
"
in
desc
)
{
descForm
.
value
=
this
.
threadActor
.
createValueGrip
(
desc
.
value
)
;
descForm
.
writable
=
desc
.
writable
;
}
else
{
descForm
.
get
=
this
.
threadActor
.
createValueGrip
(
desc
.
get
|
|
undefined
)
;
descForm
.
set
=
this
.
threadActor
.
createValueGrip
(
desc
.
set
|
|
undefined
)
;
}
bindings
.
variables
[
name
]
=
descForm
;
}
return
bindings
;
}
}
exports
.
EnvironmentActor
=
EnvironmentActor
;
