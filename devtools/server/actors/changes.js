"
use
strict
"
;
const
protocol
=
require
(
"
devtools
/
shared
/
protocol
"
)
;
const
{
changesSpec
}
=
require
(
"
devtools
/
shared
/
specs
/
changes
"
)
;
const
TrackChangeEmitter
=
require
(
"
devtools
/
server
/
actors
/
utils
/
track
-
change
-
emitter
"
)
;
const
ChangesActor
=
protocol
.
ActorClassWithSpec
(
changesSpec
{
initialize
(
conn
targetActor
)
{
protocol
.
Actor
.
prototype
.
initialize
.
call
(
this
conn
)
;
this
.
targetActor
=
targetActor
;
this
.
onTrackChange
=
this
.
pushChange
.
bind
(
this
)
;
this
.
onWillNavigate
=
this
.
onWillNavigate
.
bind
(
this
)
;
TrackChangeEmitter
.
on
(
"
track
-
change
"
this
.
onTrackChange
)
;
this
.
targetActor
.
on
(
"
will
-
navigate
"
this
.
onWillNavigate
)
;
this
.
changes
=
[
]
;
}
destroy
(
)
{
this
.
clearChanges
(
)
;
this
.
targetActor
.
off
(
"
will
-
navigate
"
this
.
onWillNavigate
)
;
TrackChangeEmitter
.
off
(
"
track
-
change
"
this
.
onTrackChange
)
;
protocol
.
Actor
.
prototype
.
destroy
.
call
(
this
)
;
}
start
(
)
{
}
changeCount
(
)
{
return
this
.
changes
.
length
;
}
change
(
index
)
{
if
(
index
>
=
0
&
&
index
<
this
.
changes
.
length
)
{
return
Object
.
assign
(
{
}
this
.
changes
[
index
]
)
;
}
return
undefined
;
}
allChanges
(
)
{
this
.
_changesHaveBeenRequested
=
true
;
return
this
.
changes
.
slice
(
)
;
}
onWillNavigate
(
eventData
)
{
if
(
eventData
.
isTopLevel
)
{
this
.
clearChanges
(
)
;
}
}
pushChange
(
change
)
{
this
.
changes
.
push
(
change
)
;
if
(
this
.
_changesHaveBeenRequested
)
{
this
.
emit
(
"
add
-
change
"
change
)
;
}
}
popChange
(
)
{
const
change
=
this
.
changes
.
pop
(
)
;
if
(
this
.
_changesHaveBeenRequested
)
{
this
.
emit
(
"
remove
-
change
"
change
)
;
}
return
change
;
}
clearChanges
(
)
{
this
.
changes
.
length
=
0
;
if
(
this
.
_changesHaveBeenRequested
)
{
this
.
emit
(
"
clear
-
changes
"
)
;
}
}
}
)
;
exports
.
ChangesActor
=
ChangesActor
;
