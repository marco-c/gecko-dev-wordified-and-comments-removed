"
use
strict
"
;
const
Targets
=
require
(
"
devtools
/
server
/
actors
/
targets
/
index
"
)
;
const
Resources
=
require
(
"
devtools
/
server
/
actors
/
resources
/
index
"
)
;
const
SESSION_TYPES
=
{
ALL
:
"
all
"
BROWSER_ELEMENT
:
"
browser
-
element
"
CONTENT_PROCESS
:
"
content
-
process
"
WEBEXTENSION
:
"
webextension
"
WORKER
:
"
worker
"
}
;
function
createBrowserSessionContext
(
config
)
{
const
type
=
SESSION_TYPES
.
ALL
;
return
{
type
isServerTargetSwitchingEnabled
:
false
supportedTargets
:
getWatcherSupportedTargets
(
type
{
isBrowserToolboxFission
:
config
.
isBrowserToolboxFission
}
)
supportedResources
:
getWatcherSupportedResources
(
type
{
isBrowserToolboxFission
:
config
.
isBrowserToolboxFission
}
)
}
;
}
function
createBrowserElementSessionContext
(
browserElement
config
)
{
const
type
=
SESSION_TYPES
.
BROWSER_ELEMENT
;
return
{
type
browserId
:
browserElement
.
browserId
isServerTargetSwitchingEnabled
:
config
.
isServerTargetSwitchingEnabled
isPopupDebuggingEnabled
:
config
.
isPopupDebuggingEnabled
supportedTargets
:
getWatcherSupportedTargets
(
type
)
supportedResources
:
getWatcherSupportedResources
(
type
)
}
;
}
function
createWebExtensionSessionContext
(
{
addonId
browsingContextID
innerWindowId
}
config
)
{
const
type
=
SESSION_TYPES
.
WEBEXTENSION
;
return
{
type
addonId
addonBrowsingContextID
:
browsingContextID
addonInnerWindowId
:
innerWindowId
isServerTargetSwitchingEnabled
:
config
.
isServerTargetSwitchingEnabled
supportedTargets
:
getWatcherSupportedTargets
(
type
)
supportedResources
:
getWatcherSupportedResources
(
type
)
}
;
}
function
createContentProcessSessionContext
(
)
{
const
type
=
SESSION_TYPES
.
CONTENT_PROCESS
;
return
{
type
supportedTargets
:
getWatcherSupportedTargets
(
type
)
supportedResources
:
getWatcherSupportedResources
(
type
)
}
;
}
function
createWorkerSessionContext
(
)
{
const
type
=
SESSION_TYPES
.
WORKER
;
return
{
type
supportedTargets
:
getWatcherSupportedTargets
(
type
)
supportedResources
:
getWatcherSupportedResources
(
type
)
}
;
}
function
getWatcherSupportedTargets
(
type
{
isBrowserToolboxFission
}
=
{
}
)
{
if
(
type
=
=
SESSION_TYPES
.
ALL
&
&
!
isBrowserToolboxFission
)
{
return
{
}
;
}
return
{
[
Targets
.
TYPES
.
FRAME
]
:
true
[
Targets
.
TYPES
.
PROCESS
]
:
true
[
Targets
.
TYPES
.
WORKER
]
:
type
=
=
SESSION_TYPES
.
BROWSER_ELEMENT
|
|
type
=
=
SESSION_TYPES
.
WEBEXTENSION
}
;
}
function
getWatcherSupportedResources
(
type
{
isBrowserToolboxFission
}
=
{
}
)
{
if
(
type
=
=
SESSION_TYPES
.
ALL
&
&
!
isBrowserToolboxFission
)
{
return
{
}
;
}
const
isTabOrWebExtensionToolbox
=
type
=
=
SESSION_TYPES
.
BROWSER_ELEMENT
|
|
type
=
=
SESSION_TYPES
.
WEBEXTENSION
;
return
{
[
Resources
.
TYPES
.
CONSOLE_MESSAGE
]
:
true
[
Resources
.
TYPES
.
CSS_CHANGE
]
:
isTabOrWebExtensionToolbox
[
Resources
.
TYPES
.
CSS_MESSAGE
]
:
true
[
Resources
.
TYPES
.
DOCUMENT_EVENT
]
:
isTabOrWebExtensionToolbox
[
Resources
.
TYPES
.
CACHE_STORAGE
]
:
isTabOrWebExtensionToolbox
[
Resources
.
TYPES
.
COOKIE
]
:
isTabOrWebExtensionToolbox
[
Resources
.
TYPES
.
ERROR_MESSAGE
]
:
true
[
Resources
.
TYPES
.
INDEXED_DB
]
:
isTabOrWebExtensionToolbox
[
Resources
.
TYPES
.
LOCAL_STORAGE
]
:
isTabOrWebExtensionToolbox
[
Resources
.
TYPES
.
SESSION_STORAGE
]
:
isTabOrWebExtensionToolbox
[
Resources
.
TYPES
.
PLATFORM_MESSAGE
]
:
true
[
Resources
.
TYPES
.
NETWORK_EVENT
]
:
true
[
Resources
.
TYPES
.
NETWORK_EVENT_STACKTRACE
]
:
true
[
Resources
.
TYPES
.
REFLOW
]
:
true
[
Resources
.
TYPES
.
STYLESHEET
]
:
true
[
Resources
.
TYPES
.
SOURCE
]
:
true
[
Resources
.
TYPES
.
THREAD_STATE
]
:
isTabOrWebExtensionToolbox
[
Resources
.
TYPES
.
SERVER_SENT_EVENT
]
:
isTabOrWebExtensionToolbox
[
Resources
.
TYPES
.
WEBSOCKET
]
:
isTabOrWebExtensionToolbox
}
;
}
module
.
exports
=
{
createBrowserSessionContext
createBrowserElementSessionContext
createWebExtensionSessionContext
createContentProcessSessionContext
createWorkerSessionContext
}
;
