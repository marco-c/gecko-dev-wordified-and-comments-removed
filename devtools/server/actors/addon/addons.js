"
use
strict
"
;
const
{
Actor
}
=
require
(
"
resource
:
/
/
devtools
/
shared
/
protocol
.
js
"
)
;
const
{
addonsSpec
}
=
require
(
"
resource
:
/
/
devtools
/
shared
/
specs
/
addon
/
addons
.
js
"
)
;
const
{
AddonManager
}
=
ChromeUtils
.
importESModule
(
"
resource
:
/
/
gre
/
modules
/
AddonManager
.
sys
.
mjs
"
{
global
:
"
shared
"
}
)
;
const
{
FileUtils
}
=
ChromeUtils
.
importESModule
(
"
resource
:
/
/
gre
/
modules
/
FileUtils
.
sys
.
mjs
"
{
global
:
"
contextual
"
}
)
;
class
AddonsActor
extends
Actor
{
constructor
(
conn
)
{
super
(
conn
addonsSpec
)
;
}
async
installTemporaryAddon
(
addonPath
openDevTools
)
{
let
addonFile
;
let
addon
;
try
{
addonFile
=
new
FileUtils
.
File
(
addonPath
)
;
addon
=
await
AddonManager
.
installTemporaryAddon
(
addonFile
)
;
}
catch
(
error
)
{
let
msg
=
{
error
}
;
if
(
error
.
additionalErrors
?
.
length
)
{
msg
+
=
\
n
{
error
.
additionalErrors
.
join
(
"
\
n
"
)
}
;
}
throw
new
Error
(
Could
not
install
add
-
on
at
'
{
addonPath
}
'
:
{
msg
}
)
;
}
Services
.
obs
.
notifyObservers
(
null
"
devtools
-
installed
-
addon
"
addon
.
id
)
;
if
(
openDevTools
)
{
const
loader
=
ChromeUtils
.
importESModule
(
"
resource
:
/
/
devtools
/
shared
/
loader
/
Loader
.
sys
.
mjs
"
{
global
:
"
shared
"
}
)
;
const
{
gDevTools
}
=
loader
.
require
(
"
resource
:
/
/
devtools
/
client
/
framework
/
devtools
.
js
"
)
;
gDevTools
.
showToolboxForWebExtension
(
addon
.
id
)
;
}
return
{
id
:
addon
.
id
actor
:
false
}
;
}
async
uninstallAddon
(
addonId
)
{
const
addon
=
await
AddonManager
.
getAddonByID
(
addonId
)
;
if
(
!
addon
?
.
temporarilyInstalled
)
{
throw
new
Error
(
Could
not
uninstall
add
-
on
"
{
addonId
}
"
)
;
}
await
addon
.
uninstall
(
)
;
}
}
exports
.
AddonsActor
=
AddonsActor
;
