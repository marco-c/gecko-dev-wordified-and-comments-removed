"
use
strict
"
;
const
InspectorUtils
=
require
(
"
InspectorUtils
"
)
;
const
MAX_TEXT_RANGES
=
100
;
class
FontsHighlighter
{
constructor
(
highlighterEnv
)
{
this
.
env
=
highlighterEnv
;
}
destroy
(
)
{
this
.
hide
(
)
;
this
.
env
=
this
.
currentNode
=
null
;
}
get
currentNodeDocument
(
)
{
if
(
!
this
.
currentNode
)
{
return
this
.
env
.
document
;
}
if
(
this
.
currentNode
.
nodeType
=
=
=
this
.
currentNode
.
DOCUMENT_NODE
)
{
return
this
.
currentNode
;
}
return
this
.
currentNode
.
ownerDocument
;
}
show
(
node
options
)
{
this
.
currentNode
=
node
;
let
doc
=
this
.
currentNodeDocument
;
let
searchRange
=
doc
.
createRange
(
)
;
searchRange
.
selectNodeContents
(
node
)
;
let
fonts
=
InspectorUtils
.
getUsedFontFaces
(
searchRange
MAX_TEXT_RANGES
)
;
let
matchingFonts
=
fonts
.
filter
(
f
=
>
f
.
CSSFamilyName
=
=
=
options
.
CSSFamilyName
&
&
f
.
name
=
=
=
options
.
name
)
;
if
(
!
matchingFonts
.
length
)
{
return
;
}
let
selection
=
doc
.
defaultView
.
getSelection
(
)
;
selection
.
removeAllRanges
(
)
;
for
(
let
matchingFont
of
matchingFonts
)
{
for
(
let
range
of
matchingFont
.
ranges
)
{
selection
.
addRange
(
range
)
;
}
}
}
hide
(
)
{
if
(
!
this
.
currentNode
)
{
return
;
}
let
doc
=
this
.
currentNodeDocument
;
let
selection
=
doc
.
defaultView
.
getSelection
(
)
;
selection
.
removeAllRanges
(
)
;
}
}
exports
.
FontsHighlighter
=
FontsHighlighter
;
