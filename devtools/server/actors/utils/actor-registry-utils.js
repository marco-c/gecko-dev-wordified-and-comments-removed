"
use
strict
"
;
var
{
Cu
CC
Ci
Cc
}
=
require
(
"
chrome
"
)
;
const
{
DebuggerServer
}
=
require
(
"
devtools
/
server
/
main
"
)
;
const
promise
=
require
(
"
promise
"
)
;
exports
.
registerActor
=
function
(
sourceText
fileName
options
)
{
exports
.
registerActorInCurrentProcess
(
sourceText
fileName
options
)
;
return
DebuggerServer
.
setupInChild
(
{
module
:
"
devtools
/
server
/
actors
/
utils
/
actor
-
registry
-
utils
"
setupChild
:
"
registerActorInCurrentProcess
"
args
:
[
sourceText
fileName
options
]
waitForEval
:
true
}
)
;
}
;
exports
.
registerActorInCurrentProcess
=
function
(
sourceText
fileName
options
)
{
const
principal
=
CC
(
"
mozilla
.
org
/
systemprincipal
;
1
"
"
nsIPrincipal
"
)
(
)
;
const
sandbox
=
Cu
.
Sandbox
(
principal
)
;
sandbox
.
exports
=
{
}
;
sandbox
.
require
=
require
;
Cu
.
evalInSandbox
(
sourceText
sandbox
"
1
.
8
"
fileName
1
)
;
let
{
prefix
constructor
type
}
=
options
;
if
(
type
.
global
&
&
!
DebuggerServer
.
globalActorFactories
.
hasOwnProperty
(
prefix
)
)
{
DebuggerServer
.
addGlobalActor
(
{
constructorName
:
constructor
constructorFun
:
sandbox
[
constructor
]
}
prefix
)
;
}
if
(
type
.
tab
&
&
!
DebuggerServer
.
tabActorFactories
.
hasOwnProperty
(
prefix
)
)
{
DebuggerServer
.
addTabActor
(
{
constructorName
:
constructor
constructorFun
:
sandbox
[
constructor
]
}
prefix
)
;
}
}
;
exports
.
unregisterActor
=
function
(
options
)
{
exports
.
unregisterActorInCurrentProcess
(
options
)
;
DebuggerServer
.
setupInChild
(
{
module
:
"
devtools
/
server
/
actors
/
utils
/
actor
-
registry
-
utils
"
setupChild
:
"
unregisterActorInCurrentProcess
"
args
:
[
options
]
}
)
;
}
;
exports
.
unregisterActorInCurrentProcess
=
function
(
options
)
{
if
(
options
.
tab
)
{
DebuggerServer
.
removeTabActor
(
options
)
;
}
if
(
options
.
global
)
{
DebuggerServer
.
removeGlobalActor
(
options
)
;
}
}
;
