#
include
"
nsGfxRadioControlFrame
.
h
"
#
include
"
gfx2DGlue
.
h
"
#
include
"
gfxUtils
.
h
"
#
include
"
mozilla
/
gfx
/
2D
.
h
"
#
include
"
mozilla
/
gfx
/
PathHelpers
.
h
"
#
include
"
nsLayoutUtils
.
h
"
#
include
"
nsRenderingContext
.
h
"
#
include
"
nsDisplayList
.
h
"
using
namespace
mozilla
;
using
namespace
mozilla
:
:
gfx
;
nsIFrame
*
NS_NewGfxRadioControlFrame
(
nsIPresShell
*
aPresShell
nsStyleContext
*
aContext
)
{
return
new
(
aPresShell
)
nsGfxRadioControlFrame
(
aContext
)
;
}
NS_IMPL_FRAMEARENA_HELPERS
(
nsGfxRadioControlFrame
)
nsGfxRadioControlFrame
:
:
nsGfxRadioControlFrame
(
nsStyleContext
*
aContext
)
:
nsFormControlFrame
(
aContext
)
{
}
nsGfxRadioControlFrame
:
:
~
nsGfxRadioControlFrame
(
)
{
}
#
ifdef
ACCESSIBILITY
a11y
:
:
AccType
nsGfxRadioControlFrame
:
:
AccessibleType
(
)
{
return
a11y
:
:
eHTMLRadioButtonType
;
}
#
endif
#
ifdef
ANDROID
#
include
"
mozilla
/
widget
/
AndroidColors
.
h
"
static
void
PaintRadioBorder
(
nsIFrame
*
aFrame
DrawTarget
*
aDrawTarget
const
nsRect
&
aDirtyRect
nsPoint
aPt
)
{
nsRect
rect
(
aPt
aFrame
-
>
GetSize
(
)
)
;
rect
.
Deflate
(
aFrame
-
>
GetUsedBorderAndPadding
(
)
)
;
Rect
devPxRect
=
ToRect
(
nsLayoutUtils
:
:
RectToGfxRect
(
rect
aFrame
-
>
PresContext
(
)
-
>
AppUnitsPerDevPixel
(
)
)
)
;
RefPtr
<
PathBuilder
>
builder
=
aDrawTarget
-
>
CreatePathBuilder
(
)
;
AppendEllipseToPath
(
builder
devPxRect
.
Center
(
)
devPxRect
.
Size
(
)
)
;
RefPtr
<
Path
>
ellipse
=
builder
-
>
Finish
(
)
;
aDrawTarget
-
>
Stroke
(
ellipse
mozilla
:
:
widget
:
:
sAndroidBorderColor
)
;
}
static
void
PaintCheckedRadioButton
(
nsIFrame
*
aFrame
DrawTarget
*
aDrawTarget
const
nsRect
&
aDirtyRect
nsPoint
aPt
)
{
nsRect
rect
(
aPt
aFrame
-
>
GetSize
(
)
)
;
rect
.
Deflate
(
aFrame
-
>
GetUsedBorderAndPadding
(
)
)
;
rect
.
Deflate
(
nsPresContext
:
:
CSSPixelsToAppUnits
(
2
)
nsPresContext
:
:
CSSPixelsToAppUnits
(
2
)
)
;
Rect
devPxRect
=
ToRect
(
nsLayoutUtils
:
:
RectToGfxRect
(
rect
aFrame
-
>
PresContext
(
)
-
>
AppUnitsPerDevPixel
(
)
)
)
;
RefPtr
<
PathBuilder
>
builder
=
aDrawTarget
-
>
CreatePathBuilder
(
)
;
AppendEllipseToPath
(
builder
devPxRect
.
Center
(
)
devPxRect
.
Size
(
)
)
;
RefPtr
<
Path
>
ellipse
=
builder
-
>
Finish
(
)
;
aDrawTarget
-
>
Fill
(
ellipse
mozilla
:
:
widget
:
:
sAndroidCheckColor
)
;
}
void
nsGfxRadioControlFrame
:
:
BuildDisplayList
(
nsDisplayListBuilder
*
aBuilder
const
nsRect
&
aDirtyRect
const
nsDisplayListSet
&
aLists
)
{
nsFormControlFrame
:
:
BuildDisplayList
(
aBuilder
aDirtyRect
aLists
)
;
if
(
!
IsVisibleForPainting
(
aBuilder
)
)
{
return
;
}
if
(
IsThemed
(
)
)
{
return
;
}
if
(
StyleDisplay
(
)
-
>
mAppearance
!
=
NS_THEME_RADIO
)
{
return
;
}
aLists
.
Content
(
)
-
>
AppendNewToTop
(
new
(
aBuilder
)
nsDisplayGeneric
(
aBuilder
this
PaintRadioBorder
"
RadioBorder
"
nsDisplayItem
:
:
TYPE_RADIOBUTTON_BORDER
)
)
;
bool
checked
=
true
;
GetCurrentCheckState
(
&
checked
)
;
if
(
checked
)
{
aLists
.
Content
(
)
-
>
AppendNewToTop
(
new
(
aBuilder
)
nsDisplayGeneric
(
aBuilder
this
PaintCheckedRadioButton
"
CheckedRadioButton
"
nsDisplayItem
:
:
TYPE_CHECKED_RADIOBUTTON
)
)
;
}
}
#
endif
