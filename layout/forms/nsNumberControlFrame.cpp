#
include
"
nsNumberControlFrame
.
h
"
#
include
"
mozilla
/
BasicEvents
.
h
"
#
include
"
mozilla
/
EventStates
.
h
"
#
include
"
mozilla
/
FloatingPoint
.
h
"
#
include
"
mozilla
/
PresShell
.
h
"
#
include
"
HTMLInputElement
.
h
"
#
include
"
nsGkAtoms
.
h
"
#
include
"
nsNameSpaceManager
.
h
"
#
include
"
nsStyleConsts
.
h
"
#
include
"
nsContentUtils
.
h
"
#
include
"
nsContentCreatorFunctions
.
h
"
#
include
"
nsCSSPseudoElements
.
h
"
#
ifdef
ACCESSIBILITY
#
include
"
mozilla
/
a11y
/
AccTypes
.
h
"
#
endif
using
namespace
mozilla
;
using
namespace
mozilla
:
:
dom
;
nsIFrame
*
NS_NewNumberControlFrame
(
PresShell
*
aPresShell
ComputedStyle
*
aStyle
)
{
return
new
(
aPresShell
)
nsNumberControlFrame
(
aStyle
aPresShell
-
>
GetPresContext
(
)
)
;
}
NS_IMPL_FRAMEARENA_HELPERS
(
nsNumberControlFrame
)
NS_QUERYFRAME_HEAD
(
nsNumberControlFrame
)
NS_QUERYFRAME_ENTRY
(
nsNumberControlFrame
)
NS_QUERYFRAME_TAIL_INHERITING
(
nsTextControlFrame
)
nsNumberControlFrame
:
:
nsNumberControlFrame
(
ComputedStyle
*
aStyle
nsPresContext
*
aPresContext
)
:
nsTextControlFrame
(
aStyle
aPresContext
kClassID
)
{
}
void
nsNumberControlFrame
:
:
DestroyFrom
(
nsIFrame
*
aDestructRoot
PostDestroyData
&
aPostDestroyData
)
{
aPostDestroyData
.
AddAnonymousContent
(
mSpinBox
.
forget
(
)
)
;
nsTextControlFrame
:
:
DestroyFrom
(
aDestructRoot
aPostDestroyData
)
;
}
nsresult
nsNumberControlFrame
:
:
CreateAnonymousContent
(
nsTArray
<
ContentInfo
>
&
aElements
)
{
if
(
StyleDisplay
(
)
-
>
EffectiveAppearance
(
)
!
=
StyleAppearance
:
:
Textfield
)
{
mSpinBox
=
MakeAnonElement
(
PseudoStyleType
:
:
mozNumberSpinBox
)
;
mSpinUp
=
MakeAnonElement
(
PseudoStyleType
:
:
mozNumberSpinUp
mSpinBox
)
;
mSpinDown
=
MakeAnonElement
(
PseudoStyleType
:
:
mozNumberSpinDown
mSpinBox
)
;
aElements
.
AppendElement
(
mSpinBox
)
;
}
nsTextControlFrame
:
:
CreateAnonymousContent
(
aElements
)
;
return
NS_OK
;
}
nsNumberControlFrame
*
nsNumberControlFrame
:
:
GetNumberControlFrameForSpinButton
(
nsIFrame
*
aFrame
)
{
nsIContent
*
content
=
aFrame
-
>
GetContent
(
)
;
auto
*
nacHost
=
content
-
>
GetClosestNativeAnonymousSubtreeRootParent
(
)
;
if
(
!
nacHost
)
{
return
nullptr
;
}
auto
*
input
=
HTMLInputElement
:
:
FromNode
(
nacHost
)
;
if
(
!
input
|
|
input
-
>
ControlType
(
)
!
=
NS_FORM_INPUT_NUMBER
)
{
return
nullptr
;
}
return
do_QueryFrame
(
input
-
>
GetPrimaryFrame
(
)
)
;
}
int32_t
nsNumberControlFrame
:
:
GetSpinButtonForPointerEvent
(
WidgetGUIEvent
*
aEvent
)
const
{
MOZ_ASSERT
(
aEvent
-
>
mClass
=
=
eMouseEventClass
"
Unexpected
event
type
"
)
;
if
(
!
mSpinBox
)
{
return
eSpinButtonNone
;
}
if
(
aEvent
-
>
mOriginalTarget
=
=
mSpinUp
)
{
return
eSpinButtonUp
;
}
if
(
aEvent
-
>
mOriginalTarget
=
=
mSpinDown
)
{
return
eSpinButtonDown
;
}
if
(
aEvent
-
>
mOriginalTarget
=
=
mSpinBox
)
{
LayoutDeviceIntPoint
absPoint
=
aEvent
-
>
mRefPoint
;
nsPoint
point
=
nsLayoutUtils
:
:
GetEventCoordinatesRelativeTo
(
aEvent
absPoint
RelativeTo
{
mSpinBox
-
>
GetPrimaryFrame
(
)
}
)
;
if
(
point
!
=
nsPoint
(
NS_UNCONSTRAINEDSIZE
NS_UNCONSTRAINEDSIZE
)
)
{
if
(
point
.
y
<
mSpinBox
-
>
GetPrimaryFrame
(
)
-
>
GetSize
(
)
.
height
/
2
)
{
return
eSpinButtonUp
;
}
return
eSpinButtonDown
;
}
}
return
eSpinButtonNone
;
}
void
nsNumberControlFrame
:
:
SpinnerStateChanged
(
)
const
{
MOZ_ASSERT
(
mSpinUp
&
&
mSpinDown
"
We
should
not
be
called
when
we
have
no
spinner
"
)
;
nsIFrame
*
spinUpFrame
=
mSpinUp
-
>
GetPrimaryFrame
(
)
;
if
(
spinUpFrame
&
&
spinUpFrame
-
>
IsThemed
(
)
)
{
spinUpFrame
-
>
InvalidateFrame
(
)
;
}
nsIFrame
*
spinDownFrame
=
mSpinDown
-
>
GetPrimaryFrame
(
)
;
if
(
spinDownFrame
&
&
spinDownFrame
-
>
IsThemed
(
)
)
{
spinDownFrame
-
>
InvalidateFrame
(
)
;
}
}
bool
nsNumberControlFrame
:
:
SpinnerUpButtonIsDepressed
(
)
const
{
return
HTMLInputElement
:
:
FromNode
(
mContent
)
-
>
NumberSpinnerUpButtonIsDepressed
(
)
;
}
bool
nsNumberControlFrame
:
:
SpinnerDownButtonIsDepressed
(
)
const
{
return
HTMLInputElement
:
:
FromNode
(
mContent
)
-
>
NumberSpinnerDownButtonIsDepressed
(
)
;
}
void
nsNumberControlFrame
:
:
AppendAnonymousContentTo
(
nsTArray
<
nsIContent
*
>
&
aElements
uint32_t
aFilter
)
{
if
(
mSpinBox
)
{
aElements
.
AppendElement
(
mSpinBox
)
;
}
nsTextControlFrame
:
:
AppendAnonymousContentTo
(
aElements
aFilter
)
;
}
#
ifdef
ACCESSIBILITY
a11y
:
:
AccType
nsNumberControlFrame
:
:
AccessibleType
(
)
{
return
a11y
:
:
eHTMLSpinnerType
;
}
#
endif
