#
ifndef
nsComboboxControlFrame_h___
#
define
nsComboboxControlFrame_h___
#
ifdef
DEBUG_evaughan
#
endif
#
ifdef
DEBUG_rods
#
endif
#
define
NS_SKIP_NOTIFY_INDEX
-
2
#
include
"
mozilla
/
Attributes
.
h
"
#
include
"
nsBlockFrame
.
h
"
#
include
"
nsIFormControlFrame
.
h
"
#
include
"
nsIAnonymousContentCreator
.
h
"
#
include
"
nsISelectControlFrame
.
h
"
#
include
"
nsIRollupListener
.
h
"
#
include
"
nsThreadUtils
.
h
"
class
nsComboboxDisplayFrame
;
class
nsTextNode
;
namespace
mozilla
{
class
PresShell
;
class
HTMLSelectEventListener
;
namespace
dom
{
class
HTMLSelectElement
;
}
namespace
gfx
{
class
DrawTarget
;
}
}
class
nsComboboxControlFrame
final
:
public
nsBlockFrame
public
nsIFormControlFrame
public
nsIAnonymousContentCreator
public
nsISelectControlFrame
{
using
DrawTarget
=
mozilla
:
:
gfx
:
:
DrawTarget
;
using
Element
=
mozilla
:
:
dom
:
:
Element
;
public
:
friend
nsComboboxControlFrame
*
NS_NewComboboxControlFrame
(
mozilla
:
:
PresShell
*
aPresShell
ComputedStyle
*
aStyle
nsFrameState
aFlags
)
;
friend
class
nsComboboxDisplayFrame
;
explicit
nsComboboxControlFrame
(
ComputedStyle
*
aStyle
nsPresContext
*
aPresContext
)
;
~
nsComboboxControlFrame
(
)
;
NS_DECL_QUERYFRAME
NS_DECL_FRAMEARENA_HELPERS
(
nsComboboxControlFrame
)
nsresult
CreateAnonymousContent
(
nsTArray
<
ContentInfo
>
&
aElements
)
final
;
void
AppendAnonymousContentTo
(
nsTArray
<
nsIContent
*
>
&
aElements
uint32_t
aFilter
)
final
;
nsIContent
*
GetDisplayNode
(
)
const
;
nsIFrame
*
CreateFrameForDisplayNode
(
)
;
#
ifdef
ACCESSIBILITY
mozilla
:
:
a11y
:
:
AccType
AccessibleType
(
)
final
;
#
endif
nscoord
GetMinISize
(
gfxContext
*
aRenderingContext
)
final
;
nscoord
GetPrefISize
(
gfxContext
*
aRenderingContext
)
final
;
void
Reflow
(
nsPresContext
*
aCX
ReflowOutput
&
aDesiredSize
const
ReflowInput
&
aReflowInput
nsReflowStatus
&
aStatus
)
final
;
MOZ_CAN_RUN_SCRIPT_BOUNDARY
nsresult
HandleEvent
(
nsPresContext
*
aPresContext
mozilla
:
:
WidgetGUIEvent
*
aEvent
nsEventStatus
*
aEventStatus
)
final
;
void
BuildDisplayList
(
nsDisplayListBuilder
*
aBuilder
const
nsDisplayListSet
&
aLists
)
final
;
void
PaintFocus
(
DrawTarget
&
aDrawTarget
nsPoint
aPt
)
;
bool
IsFrameOfType
(
uint32_t
aFlags
)
const
final
{
return
nsBlockFrame
:
:
IsFrameOfType
(
aFlags
&
~
(
nsIFrame
:
:
eReplaced
|
nsIFrame
:
:
eReplacedContainsBlock
)
)
;
}
void
Init
(
nsIContent
*
aContent
nsContainerFrame
*
aParent
nsIFrame
*
aPrevInFlow
)
final
;
#
ifdef
DEBUG_FRAME_DUMP
nsresult
GetFrameName
(
nsAString
&
aResult
)
const
final
;
#
endif
void
Destroy
(
DestroyContext
&
)
final
;
void
SetInitialChildList
(
ChildListID
aListID
nsFrameList
&
&
aChildList
)
final
;
const
nsFrameList
&
GetChildList
(
ChildListID
aListID
)
const
final
;
void
GetChildLists
(
nsTArray
<
ChildList
>
*
aLists
)
const
final
;
nsContainerFrame
*
GetContentInsertionFrame
(
)
final
;
void
AppendDirectlyOwnedAnonBoxes
(
nsTArray
<
OwnedAnonBox
>
&
aResult
)
final
;
nsresult
SetFormProperty
(
nsAtom
*
aName
const
nsAString
&
aValue
)
final
{
return
NS_OK
;
}
MOZ_CAN_RUN_SCRIPT_BOUNDARY
void
SetFocus
(
bool
aOn
bool
aRepaint
)
final
;
void
GetAvailableDropdownSpace
(
mozilla
:
:
WritingMode
aWM
nscoord
*
aBefore
nscoord
*
aAfter
mozilla
:
:
LogicalPoint
*
aTranslation
)
;
int32_t
GetIndexOfDisplayArea
(
)
;
nsresult
RedisplaySelectedText
(
)
;
int32_t
UpdateRecentIndex
(
int32_t
aIndex
)
;
bool
IsDroppedDown
(
)
const
;
NS_IMETHOD
AddOption
(
int32_t
index
)
final
;
NS_IMETHOD
RemoveOption
(
int32_t
index
)
final
;
NS_IMETHOD
DoneAddingChildren
(
bool
aIsDone
)
final
;
NS_IMETHOD
OnOptionSelected
(
int32_t
aIndex
bool
aSelected
)
final
;
NS_IMETHOD_
(
void
)
OnSetSelectedIndex
(
int32_t
aOldIndex
int32_t
aNewIndex
)
final
;
int32_t
CharCountOfLargestOptionForInflation
(
)
const
;
protected
:
friend
class
RedisplayTextEvent
;
friend
class
nsAsyncResize
;
friend
class
nsResizeDropdownAtFinalPosition
;
bool
HasDropDownButton
(
)
const
;
nscoord
DropDownButtonISize
(
)
;
enum
DropDownPositionState
{
eDropDownPositionSuppressed
eDropDownPositionPendingResize
eDropDownPositionFinal
}
;
DropDownPositionState
AbsolutelyPositionDropDown
(
)
;
nscoord
GetLongestOptionISize
(
gfxContext
*
)
const
;
nscoord
GetIntrinsicISize
(
gfxContext
*
aRenderingContext
mozilla
:
:
IntrinsicISizeType
aType
)
;
class
RedisplayTextEvent
:
public
mozilla
:
:
Runnable
{
public
:
NS_DECL_NSIRUNNABLE
explicit
RedisplayTextEvent
(
nsComboboxControlFrame
*
c
)
:
mozilla
:
:
Runnable
(
"
nsComboboxControlFrame
:
:
RedisplayTextEvent
"
)
mControlFrame
(
c
)
{
}
void
Revoke
(
)
{
mControlFrame
=
nullptr
;
}
private
:
nsComboboxControlFrame
*
mControlFrame
;
}
;
void
CheckFireOnChange
(
)
;
void
FireValueChangeEvent
(
)
;
nsresult
RedisplayText
(
)
;
void
HandleRedisplayTextEvent
(
)
;
void
ActuallyDisplayText
(
bool
aNotify
)
;
nsPoint
GetCSSTransformTranslation
(
)
;
mozilla
:
:
dom
:
:
HTMLSelectElement
&
Select
(
)
const
;
void
GetOptionText
(
uint32_t
aIndex
nsAString
&
aText
)
const
;
RefPtr
<
nsTextNode
>
mDisplayContent
;
RefPtr
<
Element
>
mButtonContent
;
nsContainerFrame
*
mDisplayFrame
;
nsIFrame
*
mButtonFrame
;
nscoord
mDisplayISize
;
nscoord
mMaxDisplayISize
;
nsRevocableEventPtr
<
RedisplayTextEvent
>
mRedisplayTextEvent
;
int32_t
mRecentSelectedIndex
;
int32_t
mDisplayedIndex
;
nsString
mDisplayedOptionTextOrPreview
;
RefPtr
<
mozilla
:
:
HTMLSelectEventListener
>
mEventListener
;
bool
mInRedisplayText
;
bool
mIsOpenInParentProcess
;
static
nsComboboxControlFrame
*
sFocused
;
#
ifdef
DO_REFLOW_COUNTER
int32_t
mReflowId
;
#
endif
}
;
#
endif
