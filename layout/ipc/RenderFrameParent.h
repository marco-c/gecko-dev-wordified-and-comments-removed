#
ifndef
mozilla_layout_RenderFrameParent_h
#
define
mozilla_layout_RenderFrameParent_h
#
include
"
mozilla
/
Attributes
.
h
"
#
include
<
map
>
#
include
"
mozilla
/
layers
/
APZUtils
.
h
"
#
include
"
mozilla
/
layers
/
CompositorOptions
.
h
"
#
include
"
mozilla
/
layers
/
LayersTypes
.
h
"
#
include
"
mozilla
/
layout
/
PRenderFrameParent
.
h
"
#
include
"
nsDisplayList
.
h
"
class
nsFrameLoader
;
class
nsSubDocumentFrame
;
namespace
mozilla
{
class
InputEvent
;
namespace
layers
{
class
AsyncDragMetrics
;
class
TargetConfig
;
struct
TextureFactoryIdentifier
;
struct
ScrollableLayerGuid
;
}
namespace
layout
{
class
RenderFrameParent
:
public
PRenderFrameParent
{
typedef
mozilla
:
:
layers
:
:
AsyncDragMetrics
AsyncDragMetrics
;
typedef
mozilla
:
:
layers
:
:
FrameMetrics
FrameMetrics
;
typedef
mozilla
:
:
layers
:
:
CompositorOptions
CompositorOptions
;
typedef
mozilla
:
:
layers
:
:
ContainerLayer
ContainerLayer
;
typedef
mozilla
:
:
layers
:
:
Layer
Layer
;
typedef
mozilla
:
:
layers
:
:
LayerManager
LayerManager
;
typedef
mozilla
:
:
layers
:
:
TargetConfig
TargetConfig
;
typedef
mozilla
:
:
ContainerLayerParameters
ContainerLayerParameters
;
typedef
mozilla
:
:
layers
:
:
TextureFactoryIdentifier
TextureFactoryIdentifier
;
typedef
mozilla
:
:
layers
:
:
ScrollableLayerGuid
ScrollableLayerGuid
;
typedef
mozilla
:
:
layers
:
:
TouchBehaviorFlags
TouchBehaviorFlags
;
typedef
mozilla
:
:
layers
:
:
ZoomConstraints
ZoomConstraints
;
typedef
FrameMetrics
:
:
ViewID
ViewID
;
public
:
explicit
RenderFrameParent
(
nsFrameLoader
*
aFrameLoader
)
;
virtual
~
RenderFrameParent
(
)
;
bool
Init
(
nsFrameLoader
*
aFrameLoader
)
;
bool
IsInitted
(
)
;
void
Destroy
(
)
;
void
BuildDisplayList
(
nsDisplayListBuilder
*
aBuilder
nsSubDocumentFrame
*
aFrame
const
nsDisplayListSet
&
aLists
)
;
already_AddRefed
<
Layer
>
BuildLayer
(
nsDisplayListBuilder
*
aBuilder
nsIFrame
*
aFrame
LayerManager
*
aManager
nsDisplayItem
*
aItem
const
ContainerLayerParameters
&
aContainerParameters
)
;
void
OwnerContentChanged
(
nsIContent
*
aContent
)
;
bool
HitTest
(
const
nsRect
&
aRect
)
;
void
GetTextureFactoryIdentifier
(
TextureFactoryIdentifier
*
aTextureFactoryIdentifier
)
;
inline
uint64_t
GetLayersId
(
)
const
{
return
mLayersId
;
}
inline
bool
IsLayersConnected
(
)
const
{
return
mLayersConnected
;
}
inline
CompositorOptions
GetCompositorOptions
(
)
const
{
return
mCompositorOptions
;
}
void
TakeFocusForClickFromTap
(
)
;
void
EnsureLayersConnected
(
CompositorOptions
*
aCompositorOptions
)
;
LayerManager
*
AttachLayerManager
(
)
;
protected
:
void
ActorDestroy
(
ActorDestroyReason
why
)
override
;
virtual
mozilla
:
:
ipc
:
:
IPCResult
RecvNotifyCompositorTransaction
(
)
override
;
private
:
void
TriggerRepaint
(
)
;
void
DispatchEventForPanZoomController
(
const
InputEvent
&
aEvent
)
;
uint64_t
mLayersId
;
bool
mLayersConnected
;
CompositorOptions
mCompositorOptions
;
RefPtr
<
nsFrameLoader
>
mFrameLoader
;
RefPtr
<
ContainerLayer
>
mContainer
;
RefPtr
<
LayerManager
>
mLayerManager
;
bool
mFrameLoaderDestroyed
;
bool
mAsyncPanZoomEnabled
;
bool
mInitted
;
}
;
}
}
class
nsDisplayRemote
:
public
nsDisplayItem
{
typedef
mozilla
:
:
layout
:
:
RenderFrameParent
RenderFrameParent
;
public
:
nsDisplayRemote
(
nsDisplayListBuilder
*
aBuilder
nsSubDocumentFrame
*
aFrame
RenderFrameParent
*
aRemoteFrame
)
;
virtual
LayerState
GetLayerState
(
nsDisplayListBuilder
*
aBuilder
LayerManager
*
aManager
const
ContainerLayerParameters
&
aParameters
)
override
{
return
mozilla
:
:
LAYER_ACTIVE_FORCE
;
}
virtual
already_AddRefed
<
Layer
>
BuildLayer
(
nsDisplayListBuilder
*
aBuilder
LayerManager
*
aManager
const
ContainerLayerParameters
&
aContainerParameters
)
override
;
virtual
bool
CreateWebRenderCommands
(
mozilla
:
:
wr
:
:
DisplayListBuilder
&
aBuilder
const
StackingContextHelper
&
aSc
nsTArray
<
WebRenderParentCommand
>
&
aParentCommands
mozilla
:
:
layers
:
:
WebRenderLayerManager
*
aManager
nsDisplayListBuilder
*
aDisplayListBuilder
)
override
;
virtual
bool
UpdateScrollData
(
mozilla
:
:
layers
:
:
WebRenderScrollData
*
aData
mozilla
:
:
layers
:
:
WebRenderLayerScrollData
*
aLayerData
)
override
;
uint64_t
GetRemoteLayersId
(
)
const
;
NS_DISPLAY_DECL_NAME
(
"
Remote
"
TYPE_REMOTE
)
private
:
RenderFrameParent
*
mRemoteFrame
;
mozilla
:
:
layers
:
:
EventRegionsOverride
mEventRegionsOverride
;
}
;
#
endif
