#
ifndef
mozilla_CachedInheritingStyles_h
#
define
mozilla_CachedInheritingStyles_h
#
include
"
nsAtom
.
h
"
#
include
"
nsTArray
.
h
"
class
nsWindowSizes
;
namespace
mozilla
{
class
ServoStyleContext
;
class
CachedInheritingStyles
{
public
:
void
Insert
(
ServoStyleContext
*
aStyle
)
;
ServoStyleContext
*
Lookup
(
nsAtom
*
aPseudoTag
)
const
;
CachedInheritingStyles
(
)
:
mBits
(
0
)
{
}
~
CachedInheritingStyles
(
)
{
if
(
IsIndirect
(
)
)
{
delete
AsIndirect
(
)
;
}
else
if
(
!
IsEmpty
(
)
)
{
RefPtr
<
ServoStyleContext
>
ref
=
dont_AddRef
(
AsDirect
(
)
)
;
}
}
void
AddSizeOfIncludingThis
(
nsWindowSizes
&
aSizes
size_t
*
aCVsSize
)
const
;
private
:
typedef
AutoTArray
<
RefPtr
<
ServoStyleContext
>
4
>
IndirectCache
;
bool
IsEmpty
(
)
const
{
return
!
mBits
;
}
bool
IsIndirect
(
)
const
{
return
(
mBits
&
1
)
;
}
ServoStyleContext
*
AsDirect
(
)
const
{
MOZ_ASSERT
(
!
IsIndirect
(
)
)
;
return
reinterpret_cast
<
ServoStyleContext
*
>
(
mBits
)
;
}
IndirectCache
*
AsIndirect
(
)
const
{
MOZ_ASSERT
(
IsIndirect
(
)
)
;
return
reinterpret_cast
<
IndirectCache
*
>
(
mBits
&
~
1
)
;
}
uintptr_t
mBits
;
}
;
}
#
endif
