#
ifndef
mozilla_PostTraversalTask_h
#
define
mozilla_PostTraversalTask_h
#
include
"
nscore
.
h
"
namespace
mozilla
{
class
ServoStyleSet
;
namespace
dom
{
class
FontFace
;
class
FontFaceSet
;
}
namespace
fontlist
{
struct
Family
;
}
}
class
gfxUserFontEntry
;
namespace
mozilla
{
class
PostTraversalTask
{
public
:
static
PostTraversalTask
ResolveFontFaceLoadedPromise
(
dom
:
:
FontFace
*
aFontFace
)
{
auto
task
=
PostTraversalTask
(
Type
:
:
ResolveFontFaceLoadedPromise
)
;
task
.
mTarget
=
aFontFace
;
return
task
;
}
static
PostTraversalTask
RejectFontFaceLoadedPromise
(
dom
:
:
FontFace
*
aFontFace
nsresult
aResult
)
{
auto
task
=
PostTraversalTask
(
Type
:
:
ResolveFontFaceLoadedPromise
)
;
task
.
mTarget
=
aFontFace
;
task
.
mResult
=
aResult
;
return
task
;
}
static
PostTraversalTask
DispatchLoadingEventAndReplaceReadyPromise
(
dom
:
:
FontFaceSet
*
aFontFaceSet
)
{
auto
task
=
PostTraversalTask
(
Type
:
:
DispatchLoadingEventAndReplaceReadyPromise
)
;
task
.
mTarget
=
aFontFaceSet
;
return
task
;
}
static
PostTraversalTask
DispatchFontFaceSetCheckLoadingFinishedAfterDelay
(
dom
:
:
FontFaceSet
*
aFontFaceSet
)
{
auto
task
=
PostTraversalTask
(
Type
:
:
DispatchFontFaceSetCheckLoadingFinishedAfterDelay
)
;
task
.
mTarget
=
aFontFaceSet
;
return
task
;
}
static
PostTraversalTask
LoadFontEntry
(
gfxUserFontEntry
*
aFontEntry
)
{
auto
task
=
PostTraversalTask
(
Type
:
:
LoadFontEntry
)
;
task
.
mTarget
=
aFontEntry
;
return
task
;
}
static
PostTraversalTask
InitializeFamily
(
fontlist
:
:
Family
*
aFamily
)
{
auto
task
=
PostTraversalTask
(
Type
:
:
InitializeFamily
)
;
task
.
mTarget
=
aFamily
;
return
task
;
}
static
PostTraversalTask
FontInfoUpdate
(
ServoStyleSet
*
aSet
)
{
auto
task
=
PostTraversalTask
(
Type
:
:
FontInfoUpdate
)
;
task
.
mTarget
=
aSet
;
return
task
;
}
void
Run
(
)
;
private
:
enum
class
Type
{
ResolveFontFaceLoadedPromise
RejectFontFaceLoadedPromise
DispatchLoadingEventAndReplaceReadyPromise
DispatchFontFaceSetCheckLoadingFinishedAfterDelay
LoadFontEntry
InitializeFamily
FontInfoUpdate
}
;
explicit
PostTraversalTask
(
Type
aType
)
:
mType
(
aType
)
mTarget
(
nullptr
)
mResult
(
NS_OK
)
{
}
Type
mType
;
void
*
mTarget
;
nsresult
mResult
;
}
;
}
#
endif
