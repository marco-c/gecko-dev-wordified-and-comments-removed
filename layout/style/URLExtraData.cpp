#
include
"
mozilla
/
URLExtraData
.
h
"
#
include
"
mozilla
/
NullPrincipal
.
h
"
#
include
"
nsAboutProtocolUtils
.
h
"
#
include
"
ReferrerInfo
.
h
"
namespace
mozilla
{
StaticRefPtr
<
URLExtraData
>
URLExtraData
:
:
sDummy
;
StaticRefPtr
<
URLExtraData
>
URLExtraData
:
:
sDummyChrome
;
void
URLExtraData
:
:
Init
(
)
{
RefPtr
<
nsIURI
>
baseURI
=
NullPrincipal
:
:
CreateURI
(
)
;
nsCOMPtr
<
nsIReferrerInfo
>
referrerInfo
=
new
dom
:
:
ReferrerInfo
(
nullptr
)
;
sDummy
=
new
URLExtraData
(
do_AddRef
(
baseURI
)
do_AddRef
(
referrerInfo
)
NullPrincipal
:
:
CreateWithoutOriginAttributes
(
)
)
;
sDummyChrome
=
new
URLExtraData
(
baseURI
.
forget
(
)
referrerInfo
.
forget
(
)
NullPrincipal
:
:
CreateWithoutOriginAttributes
(
)
)
;
sDummyChrome
-
>
mChromeRulesEnabled
=
true
;
}
static
bool
IsPrivilegedAboutURIForCSS
(
nsIURI
*
aURI
)
{
#
ifdef
MOZ_THUNDERBIRD
if
(
!
aURI
-
>
SchemeIs
(
"
about
"
)
)
{
return
false
;
}
nsAutoCString
name
;
if
(
NS_WARN_IF
(
NS_FAILED
(
NS_GetAboutModuleName
(
aURI
name
)
)
)
)
{
return
false
;
}
return
name
.
EqualsLiteral
(
"
3pane
"
)
|
|
name
.
EqualsLiteral
(
"
addressbook
"
)
;
#
else
return
false
;
#
endif
}
bool
URLExtraData
:
:
ChromeRulesEnabled
(
nsIURI
*
aURI
)
{
if
(
!
aURI
)
{
return
false
;
}
return
aURI
-
>
SchemeIs
(
"
chrome
"
)
|
|
aURI
-
>
SchemeIs
(
"
resource
"
)
|
|
IsPrivilegedAboutURIForCSS
(
aURI
)
;
}
void
URLExtraData
:
:
Shutdown
(
)
{
sDummy
=
nullptr
;
sDummyChrome
=
nullptr
;
}
URLExtraData
:
:
~
URLExtraData
(
)
=
default
;
StaticRefPtr
<
URLExtraData
>
URLExtraData
:
:
sShared
[
size_t
(
UserAgentStyleSheetID
:
:
Count
)
]
;
}
