#
ifndef
mozilla_css_StyleRule_h__
#
define
mozilla_css_StyleRule_h__
#
include
"
mozilla
/
Attributes
.
h
"
#
include
"
mozilla
/
BindingStyleRule
.
h
"
#
include
"
mozilla
/
MemoryReporting
.
h
"
#
include
"
mozilla
/
StyleSetHandle
.
h
"
#
include
"
mozilla
/
UniquePtr
.
h
"
#
include
"
nsString
.
h
"
#
include
"
nsCOMPtr
.
h
"
#
include
"
nsCSSPseudoElements
.
h
"
#
include
"
nsIStyleRule
.
h
"
class
nsAtom
;
struct
nsCSSSelectorList
;
namespace
mozilla
{
enum
class
CSSPseudoClassType
:
uint8_t
;
class
CSSStyleSheet
;
}
struct
nsAtomList
{
public
:
explicit
nsAtomList
(
nsAtom
*
aAtom
)
;
explicit
nsAtomList
(
const
nsString
&
aAtomValue
)
;
~
nsAtomList
(
void
)
;
nsAtomList
*
Clone
(
)
const
{
return
Clone
(
true
)
;
}
size_t
SizeOfIncludingThis
(
mozilla
:
:
MallocSizeOf
aMallocSizeOf
)
const
;
RefPtr
<
nsAtom
>
mAtom
;
nsAtomList
*
mNext
;
private
:
nsAtomList
*
Clone
(
bool
aDeep
)
const
;
nsAtomList
(
const
nsAtomList
&
aCopy
)
=
delete
;
nsAtomList
&
operator
=
(
const
nsAtomList
&
aCopy
)
=
delete
;
}
;
struct
nsPseudoClassList
{
public
:
typedef
mozilla
:
:
CSSPseudoClassType
CSSPseudoClassType
;
explicit
nsPseudoClassList
(
CSSPseudoClassType
aType
)
;
nsPseudoClassList
(
CSSPseudoClassType
aType
const
char16_t
*
aString
)
;
nsPseudoClassList
(
CSSPseudoClassType
aType
const
int32_t
*
aIntPair
)
;
nsPseudoClassList
(
CSSPseudoClassType
aType
nsCSSSelectorList
*
aSelectorList
)
;
~
nsPseudoClassList
(
void
)
;
nsPseudoClassList
*
Clone
(
)
const
{
return
Clone
(
true
)
;
}
size_t
SizeOfIncludingThis
(
mozilla
:
:
MallocSizeOf
aMallocSizeOf
)
const
;
union
{
void
*
mMemory
;
char16_t
*
mString
;
int32_t
*
mNumbers
;
nsCSSSelectorList
*
mSelectors
;
}
u
;
CSSPseudoClassType
mType
;
nsPseudoClassList
*
mNext
;
private
:
nsPseudoClassList
*
Clone
(
bool
aDeep
)
const
;
nsPseudoClassList
(
const
nsPseudoClassList
&
aCopy
)
=
delete
;
nsPseudoClassList
&
operator
=
(
const
nsPseudoClassList
&
aCopy
)
=
delete
;
}
;
#
define
NS_ATTR_FUNC_SET
0
/
/
[
attr
]
#
define
NS_ATTR_FUNC_EQUALS
1
/
/
[
attr
=
value
]
#
define
NS_ATTR_FUNC_INCLUDES
2
/
/
[
attr
~
=
value
]
(
space
separated
)
#
define
NS_ATTR_FUNC_DASHMATCH
3
/
/
[
attr
|
=
value
]
(
'
-
'
truncated
)
#
define
NS_ATTR_FUNC_BEGINSMATCH
4
/
/
[
attr
^
=
value
]
(
begins
with
)
#
define
NS_ATTR_FUNC_ENDSMATCH
5
/
/
[
attr
=
value
]
(
ends
with
)
#
define
NS_ATTR_FUNC_CONTAINSMATCH
6
/
/
[
attr
*
=
value
]
(
contains
substring
)
struct
nsAttrSelector
{
public
:
enum
class
ValueCaseSensitivity
:
uint8_t
{
CaseSensitive
CaseInsensitive
CaseInsensitiveInHTML
}
;
nsAttrSelector
(
int32_t
aNameSpace
const
nsString
&
aAttr
)
;
nsAttrSelector
(
int32_t
aNameSpace
const
nsString
&
aAttr
uint8_t
aFunction
const
nsString
&
aValue
ValueCaseSensitivity
aValueCaseSensitivity
)
;
nsAttrSelector
(
int32_t
aNameSpace
nsAtom
*
aLowercaseAttr
nsAtom
*
aCasedAttr
uint8_t
aFunction
const
nsString
&
aValue
ValueCaseSensitivity
aValueCaseSensitivity
)
;
~
nsAttrSelector
(
void
)
;
nsAttrSelector
*
Clone
(
)
const
{
return
Clone
(
true
)
;
}
size_t
SizeOfIncludingThis
(
mozilla
:
:
MallocSizeOf
aMallocSizeOf
)
const
;
bool
IsValueCaseSensitive
(
bool
aInHTML
)
const
{
return
mValueCaseSensitivity
=
=
ValueCaseSensitivity
:
:
CaseSensitive
|
|
(
!
aInHTML
&
&
mValueCaseSensitivity
=
=
ValueCaseSensitivity
:
:
CaseInsensitiveInHTML
)
;
}
nsString
mValue
;
nsAttrSelector
*
mNext
;
RefPtr
<
nsAtom
>
mLowercaseAttr
;
RefPtr
<
nsAtom
>
mCasedAttr
;
int32_t
mNameSpace
;
uint8_t
mFunction
;
ValueCaseSensitivity
mValueCaseSensitivity
;
private
:
nsAttrSelector
*
Clone
(
bool
aDeep
)
const
;
nsAttrSelector
(
const
nsAttrSelector
&
aCopy
)
=
delete
;
nsAttrSelector
&
operator
=
(
const
nsAttrSelector
&
aCopy
)
=
delete
;
}
;
struct
nsCSSSelector
{
public
:
typedef
mozilla
:
:
CSSPseudoClassType
CSSPseudoClassType
;
nsCSSSelector
(
void
)
;
~
nsCSSSelector
(
void
)
;
nsCSSSelector
*
Clone
(
)
const
{
return
Clone
(
true
true
)
;
}
void
Reset
(
void
)
;
void
SetNameSpace
(
int32_t
aNameSpace
)
;
void
SetTag
(
const
nsString
&
aTag
)
;
void
AddID
(
const
nsString
&
aID
)
;
void
AddClass
(
const
nsString
&
aClass
)
;
void
AddPseudoClass
(
CSSPseudoClassType
aType
)
;
void
AddPseudoClass
(
CSSPseudoClassType
aType
const
char16_t
*
aString
)
;
void
AddPseudoClass
(
CSSPseudoClassType
aType
const
int32_t
*
aIntPair
)
;
void
AddPseudoClass
(
CSSPseudoClassType
aType
nsCSSSelectorList
*
aSelectorList
)
;
void
AddAttribute
(
int32_t
aNameSpace
const
nsString
&
aAttr
)
;
void
AddAttribute
(
int32_t
aNameSpace
const
nsString
&
aAttr
uint8_t
aFunc
const
nsString
&
aValue
nsAttrSelector
:
:
ValueCaseSensitivity
aValueCaseSensitivity
)
;
void
SetOperator
(
char16_t
aOperator
)
;
inline
bool
HasTagSelector
(
)
const
{
return
!
!
mCasedTag
;
}
inline
bool
IsPseudoElement
(
)
const
{
return
mLowercaseTag
&
&
!
mCasedTag
;
}
int32_t
CalcWeight
(
)
const
;
void
ToString
(
nsAString
&
aString
mozilla
:
:
CSSStyleSheet
*
aSheet
bool
aAppend
=
false
)
const
;
bool
IsRestrictedSelector
(
)
const
{
return
PseudoType
(
)
=
=
mozilla
:
:
CSSPseudoElementType
:
:
NotPseudo
;
}
#
ifdef
DEBUG
nsCString
RestrictedSelectorToString
(
)
const
;
#
endif
private
:
void
AddPseudoClassInternal
(
nsPseudoClassList
*
aPseudoClass
)
;
nsCSSSelector
*
Clone
(
bool
aDeepNext
bool
aDeepNegations
)
const
;
void
AppendToStringWithoutCombinators
(
nsAString
&
aString
mozilla
:
:
CSSStyleSheet
*
aSheet
bool
aUseStandardNamespacePrefixes
)
const
;
void
AppendToStringWithoutCombinatorsOrNegations
(
nsAString
&
aString
mozilla
:
:
CSSStyleSheet
*
aSheet
bool
aIsNegated
bool
aUseStandardNamespacePrefixes
)
const
;
bool
CanBeNamespaced
(
bool
aIsNegated
)
const
;
int32_t
CalcWeightWithoutNegations
(
)
const
;
public
:
mozilla
:
:
CSSPseudoElementType
PseudoType
(
)
const
{
return
mPseudoType
;
}
void
SetPseudoType
(
mozilla
:
:
CSSPseudoElementType
aType
)
{
mPseudoType
=
aType
;
}
size_t
SizeOfIncludingThis
(
mozilla
:
:
MallocSizeOf
aMallocSizeOf
)
const
;
RefPtr
<
nsAtom
>
mLowercaseTag
;
RefPtr
<
nsAtom
>
mCasedTag
;
nsAtomList
*
mIDList
;
nsAtomList
*
mClassList
;
nsPseudoClassList
*
mPseudoClassList
;
nsAttrSelector
*
mAttrList
;
nsCSSSelector
*
mNegations
;
nsCSSSelector
*
mNext
;
int32_t
mNameSpace
;
char16_t
mOperator
;
private
:
mozilla
:
:
CSSPseudoElementType
mPseudoType
;
nsCSSSelector
(
const
nsCSSSelector
&
aCopy
)
=
delete
;
nsCSSSelector
&
operator
=
(
const
nsCSSSelector
&
aCopy
)
=
delete
;
}
;
namespace
mozilla
{
namespace
css
{
class
StyleRule
;
}
}
struct
nsCSSSelectorList
{
nsCSSSelectorList
(
void
)
;
~
nsCSSSelectorList
(
void
)
;
nsCSSSelector
*
AddSelector
(
char16_t
aOperator
)
;
void
RemoveRightmostSelector
(
)
;
void
ToString
(
nsAString
&
aResult
mozilla
:
:
CSSStyleSheet
*
aSheet
)
;
nsCSSSelectorList
*
Clone
(
)
const
{
return
Clone
(
true
)
;
}
size_t
SizeOfIncludingThis
(
mozilla
:
:
MallocSizeOf
aMallocSizeOf
)
const
;
nsCSSSelector
*
mSelectors
;
int32_t
mWeight
;
nsCSSSelectorList
*
mNext
;
protected
:
friend
class
mozilla
:
:
css
:
:
StyleRule
;
nsCSSSelectorList
*
Clone
(
bool
aDeep
)
const
;
private
:
nsCSSSelectorList
(
const
nsCSSSelectorList
&
aCopy
)
=
delete
;
nsCSSSelectorList
&
operator
=
(
const
nsCSSSelectorList
&
aCopy
)
=
delete
;
}
;
#
define
NS_CSS_STYLE_RULE_IMPL_CID
\
{
0x464bab7a
0x2fce
0x4f30
\
{
0xab
0x44
0xb7
0xa5
0xf3
0xaa
0xe5
0x7d
}
}
class
DOMCSSDeclarationImpl
;
namespace
mozilla
{
namespace
css
{
class
Declaration
;
class
StyleRule
final
:
public
BindingStyleRule
{
public
:
StyleRule
(
nsCSSSelectorList
*
aSelector
Declaration
*
aDeclaration
uint32_t
aLineNumber
uint32_t
aColumnNumber
)
;
private
:
StyleRule
(
const
StyleRule
&
aCopy
)
;
public
:
NS_DECLARE_STATIC_IID_ACCESSOR
(
NS_CSS_STYLE_RULE_IMPL_CID
)
NS_DECL_ISUPPORTS_INHERITED
NS_DECL_CYCLE_COLLECTION_SCRIPT_HOLDER_CLASS_INHERITED
(
StyleRule
Rule
)
bool
IsCCLeaf
(
)
const
override
;
uint32_t
GetSelectorCount
(
)
override
;
nsresult
GetSelectorText
(
uint32_t
aSelectorIndex
nsAString
&
aText
)
override
;
nsresult
GetSpecificity
(
uint32_t
aSelectorIndex
uint64_t
*
aSpecificity
)
override
;
nsresult
SelectorMatchesElement
(
dom
:
:
Element
*
aElement
uint32_t
aSelectorIndex
const
nsAString
&
aPseudo
bool
*
aMatches
)
override
;
mozilla
:
:
NotNull
<
DeclarationBlock
*
>
GetDeclarationBlock
(
)
const
override
;
uint16_t
Type
(
)
const
override
;
void
GetCssText
(
nsAString
&
aCssText
)
const
override
;
void
GetSelectorText
(
nsAString
&
aSelectorText
)
final
;
void
SetSelectorText
(
const
nsAString
&
aSelectorText
)
final
;
nsICSSDeclaration
*
Style
(
)
override
;
nsCSSSelectorList
*
Selector
(
)
{
return
mSelector
;
}
Declaration
*
GetDeclaration
(
)
const
{
return
mDeclaration
;
}
void
SetDeclaration
(
Declaration
*
aDecl
)
;
int32_t
GetType
(
)
const
override
;
#
ifdef
MOZ_OLD_STYLE
CSSStyleSheet
*
GetStyleSheet
(
)
const
{
StyleSheet
*
sheet
=
Rule
:
:
GetStyleSheet
(
)
;
return
sheet
?
sheet
-
>
AsGecko
(
)
:
nullptr
;
}
#
endif
already_AddRefed
<
Rule
>
Clone
(
)
const
override
;
#
ifdef
DEBUG
void
List
(
FILE
*
out
=
stdout
int32_t
aIndent
=
0
)
const
override
;
#
endif
size_t
SizeOfIncludingThis
(
mozilla
:
:
MallocSizeOf
aMallocSizeOf
)
const
override
;
private
:
~
StyleRule
(
)
;
void
DropReferences
(
)
;
nsCSSSelectorList
*
GetSelectorAtIndex
(
uint32_t
aIndex
ErrorResult
&
rv
)
;
private
:
nsCSSSelectorList
*
mSelector
;
RefPtr
<
Declaration
>
mDeclaration
;
UniquePtr
<
DOMCSSDeclarationImpl
>
mDOMDeclaration
;
private
:
StyleRule
&
operator
=
(
const
StyleRule
&
aCopy
)
=
delete
;
}
;
NS_DEFINE_STATIC_IID_ACCESSOR
(
StyleRule
NS_CSS_STYLE_RULE_IMPL_CID
)
}
}
#
endif
