#
ifndef
nsComputedDOMStyle_h__
#
define
nsComputedDOMStyle_h__
#
include
"
mozilla
/
Attributes
.
h
"
#
include
"
mozilla
/
StyleComplexColor
.
h
"
#
include
"
mozilla
/
UniquePtr
.
h
"
#
include
"
mozilla
/
dom
/
Element
.
h
"
#
include
"
nsCOMPtr
.
h
"
#
include
"
nsContentUtils
.
h
"
#
include
"
nscore
.
h
"
#
include
"
nsDOMCSSDeclaration
.
h
"
#
include
"
mozilla
/
ComputedStyle
.
h
"
#
include
"
nsIWeakReferenceUtils
.
h
"
#
include
"
mozilla
/
gfx
/
Types
.
h
"
#
include
"
nsCoord
.
h
"
#
include
"
nsColor
.
h
"
#
include
"
nsStyleStruct
.
h
"
#
include
"
mozilla
/
WritingModes
.
h
"
namespace
mozilla
{
namespace
dom
{
class
DocGroup
;
class
Element
;
}
struct
ComputedGridTrackInfo
;
}
struct
ComputedStyleMap
;
struct
nsCSSKTableEntry
;
class
nsIFrame
;
class
nsIPresShell
;
class
nsDOMCSSValueList
;
struct
nsMargin
;
class
nsROCSSPrimitiveValue
;
class
nsStyleCoord
;
struct
nsStyleFilter
;
class
nsStyleGradient
;
struct
nsStyleImage
;
class
nsStyleSides
;
class
nsComputedDOMStyle
final
:
public
nsDOMCSSDeclaration
public
nsStubMutationObserver
{
private
:
using
KTableEntry
=
nsCSSKTableEntry
;
using
CSSValue
=
mozilla
:
:
dom
:
:
CSSValue
;
using
StyleGeometryBox
=
mozilla
:
:
StyleGeometryBox
;
using
Element
=
mozilla
:
:
dom
:
:
Element
;
using
Document
=
mozilla
:
:
dom
:
:
Document
;
using
StyleFlexBasis
=
mozilla
:
:
StyleFlexBasis
;
using
StyleSize
=
mozilla
:
:
StyleSize
;
using
StyleMaxSize
=
mozilla
:
:
StyleMaxSize
;
using
LengthPercentage
=
mozilla
:
:
LengthPercentage
;
using
LengthPercentageOrAuto
=
mozilla
:
:
LengthPercentageOrAuto
;
using
StyleExtremumLength
=
mozilla
:
:
StyleExtremumLength
;
using
ComputedStyle
=
mozilla
:
:
ComputedStyle
;
public
:
NS_DECL_CYCLE_COLLECTING_ISUPPORTS
NS_DECL_CYCLE_COLLECTION_SKIPPABLE_SCRIPT_HOLDER_CLASS_AMBIGUOUS
(
nsComputedDOMStyle
nsICSSDeclaration
)
NS_DECL_NSIDOMCSSSTYLEDECLARATION_HELPER
nsresult
GetPropertyValue
(
const
nsCSSPropertyID
aPropID
nsAString
&
aValue
)
override
;
nsresult
SetPropertyValue
(
const
nsCSSPropertyID
aPropID
const
nsAString
&
aValue
nsIPrincipal
*
aSubjectPrincipal
)
override
;
void
IndexedGetter
(
uint32_t
aIndex
bool
&
aFound
nsAString
&
aPropName
)
final
;
enum
StyleType
{
eDefaultOnly
eAll
}
;
nsComputedDOMStyle
(
Element
*
aElement
const
nsAString
&
aPseudoElt
Document
*
aDocument
StyleType
aStyleType
)
;
nsINode
*
GetParentObject
(
)
override
{
return
mElement
;
}
static
already_AddRefed
<
ComputedStyle
>
GetComputedStyle
(
Element
*
aElement
nsAtom
*
aPseudo
StyleType
aStyleType
=
eAll
)
;
static
already_AddRefed
<
ComputedStyle
>
GetComputedStyleNoFlush
(
Element
*
aElement
nsAtom
*
aPseudo
StyleType
aStyleType
=
eAll
)
{
return
DoGetComputedStyleNoFlush
(
aElement
aPseudo
nsContentUtils
:
:
GetPresShellForContent
(
aElement
)
aStyleType
)
;
}
static
already_AddRefed
<
ComputedStyle
>
GetUnanimatedComputedStyleNoFlush
(
Element
*
aElement
nsAtom
*
aPseudo
)
;
void
SetExposeVisitedStyle
(
bool
aExpose
)
{
NS_ASSERTION
(
aExpose
!
=
mExposeVisitedStyle
"
should
always
be
changing
"
)
;
mExposeVisitedStyle
=
aExpose
;
}
void
GetCSSImageURLs
(
const
nsAString
&
aPropertyName
nsTArray
<
nsString
>
&
aImageURLs
mozilla
:
:
ErrorResult
&
aRv
)
final
;
mozilla
:
:
DeclarationBlock
*
GetOrCreateCSSDeclaration
(
Operation
aOperation
mozilla
:
:
DeclarationBlock
*
*
aCreated
)
final
;
virtual
nsresult
SetCSSDeclaration
(
mozilla
:
:
DeclarationBlock
*
mozilla
:
:
MutationClosureData
*
)
override
;
virtual
mozilla
:
:
dom
:
:
Document
*
DocToUpdate
(
)
override
;
nsDOMCSSDeclaration
:
:
ParsingEnvironment
GetParsingEnvironment
(
nsIPrincipal
*
aSubjectPrincipal
)
const
final
;
static
already_AddRefed
<
nsROCSSPrimitiveValue
>
MatrixToCSSValue
(
const
mozilla
:
:
gfx
:
:
Matrix4x4
&
aMatrix
)
;
static
void
SetToRGBAColor
(
nsROCSSPrimitiveValue
*
aValue
nscolor
aColor
)
;
static
void
RegisterPrefChangeCallbacks
(
)
;
static
void
UnregisterPrefChangeCallbacks
(
)
;
NS_DECL_NSIMUTATIONOBSERVER_PARENTCHAINCHANGED
private
:
virtual
~
nsComputedDOMStyle
(
)
;
void
AssertFlushedPendingReflows
(
)
{
NS_ASSERTION
(
mFlushedPendingReflows
"
property
getter
should
have
been
marked
layout
-
dependent
"
)
;
}
nsMargin
GetAdjustedValuesForBoxSizing
(
)
;
void
UpdateCurrentStyleSources
(
bool
aNeedsLayoutFlush
)
;
void
ClearCurrentStyleSources
(
)
;
void
ClearComputedStyle
(
)
;
void
SetResolvedComputedStyle
(
RefPtr
<
ComputedStyle
>
&
&
aContext
uint64_t
aGeneration
)
;
void
SetFrameComputedStyle
(
ComputedStyle
*
aStyle
uint64_t
aGeneration
)
;
static
already_AddRefed
<
ComputedStyle
>
DoGetComputedStyleNoFlush
(
Element
*
aElement
nsAtom
*
aPseudo
nsIPresShell
*
aPresShell
StyleType
aStyleType
)
;
#
define
STYLE_STRUCT
(
name_
)
\
const
nsStyle
#
#
name_
*
Style
#
#
name_
(
)
{
\
return
mComputedStyle
-
>
Style
#
#
name_
(
)
;
\
}
#
include
"
nsStyleStructList
.
h
"
#
undef
STYLE_STRUCT
typedef
bool
(
nsComputedDOMStyle
:
:
*
PercentageBaseGetter
)
(
nscoord
&
)
;
already_AddRefed
<
CSSValue
>
GetOffsetWidthFor
(
mozilla
:
:
Side
)
;
already_AddRefed
<
CSSValue
>
GetAbsoluteOffset
(
mozilla
:
:
Side
)
;
nscoord
GetUsedAbsoluteOffset
(
mozilla
:
:
Side
)
;
already_AddRefed
<
CSSValue
>
GetNonStaticPositionOffset
(
mozilla
:
:
Side
aSide
bool
aResolveAuto
PercentageBaseGetter
aWidthGetter
PercentageBaseGetter
aHeightGetter
)
;
already_AddRefed
<
CSSValue
>
GetStaticOffset
(
mozilla
:
:
Side
aSide
)
;
already_AddRefed
<
CSSValue
>
GetPaddingWidthFor
(
mozilla
:
:
Side
aSide
)
;
already_AddRefed
<
CSSValue
>
GetBorderStyleFor
(
mozilla
:
:
Side
aSide
)
;
already_AddRefed
<
CSSValue
>
GetBorderWidthFor
(
mozilla
:
:
Side
aSide
)
;
already_AddRefed
<
CSSValue
>
GetBorderColorFor
(
mozilla
:
:
Side
aSide
)
;
already_AddRefed
<
CSSValue
>
GetMarginWidthFor
(
mozilla
:
:
Side
aSide
)
;
already_AddRefed
<
CSSValue
>
GetFallbackValue
(
const
nsStyleSVGPaint
*
aPaint
)
;
already_AddRefed
<
CSSValue
>
GetSVGPaintFor
(
bool
aFill
)
;
already_AddRefed
<
CSSValue
>
GetTransformValue
(
nsCSSValueSharedList
*
aSpecifiedTransform
)
;
void
AppendGridLineNames
(
nsString
&
aResult
const
nsTArray
<
nsString
>
&
aLineNames
)
;
void
AppendGridLineNames
(
nsDOMCSSValueList
*
aValueList
const
nsTArray
<
nsString
>
&
aLineNames
bool
aSuppressEmptyList
=
true
)
;
void
AppendGridLineNames
(
nsDOMCSSValueList
*
aValueList
const
nsTArray
<
nsString
>
&
aLineNames1
const
nsTArray
<
nsString
>
&
aLineNames2
)
;
already_AddRefed
<
CSSValue
>
GetGridTrackSize
(
const
nsStyleCoord
&
aMinSize
const
nsStyleCoord
&
aMaxSize
)
;
already_AddRefed
<
CSSValue
>
GetGridTemplateColumnsRows
(
const
nsStyleGridTemplate
&
aTrackList
const
mozilla
:
:
ComputedGridTrackInfo
*
aTrackInfo
)
;
already_AddRefed
<
CSSValue
>
GetGridLine
(
const
nsStyleGridLine
&
aGridLine
)
;
bool
GetLineHeightCoord
(
nscoord
&
aCoord
)
;
already_AddRefed
<
CSSValue
>
GetCSSShadowArray
(
nsCSSShadowArray
*
aArray
bool
aIsBoxShadow
)
;
void
GetCSSGradientString
(
const
nsStyleGradient
*
aGradient
nsAString
&
aString
)
;
void
GetImageRectString
(
nsIURI
*
aURI
const
nsStyleSides
&
aCropRect
nsString
&
aString
)
;
already_AddRefed
<
CSSValue
>
GetScrollSnapPoints
(
const
nsStyleCoord
&
aCoord
)
;
bool
ShouldHonorMinSizeAutoInAxis
(
mozilla
:
:
PhysicalAxis
aAxis
)
;
already_AddRefed
<
CSSValue
>
DoGetBoxFlex
(
)
;
already_AddRefed
<
CSSValue
>
DoGetWidth
(
)
;
already_AddRefed
<
CSSValue
>
DoGetHeight
(
)
;
already_AddRefed
<
CSSValue
>
DoGetMaxHeight
(
)
;
already_AddRefed
<
CSSValue
>
DoGetMaxWidth
(
)
;
already_AddRefed
<
CSSValue
>
DoGetMinHeight
(
)
;
already_AddRefed
<
CSSValue
>
DoGetMinWidth
(
)
;
already_AddRefed
<
CSSValue
>
DoGetLeft
(
)
;
already_AddRefed
<
CSSValue
>
DoGetTop
(
)
;
already_AddRefed
<
CSSValue
>
DoGetRight
(
)
;
already_AddRefed
<
CSSValue
>
DoGetBottom
(
)
;
already_AddRefed
<
CSSValue
>
DoGetColor
(
)
;
already_AddRefed
<
CSSValue
>
DoGetOsxFontSmoothing
(
)
;
already_AddRefed
<
CSSValue
>
DoGetGridAutoFlow
(
)
;
already_AddRefed
<
CSSValue
>
DoGetGridAutoColumns
(
)
;
already_AddRefed
<
CSSValue
>
DoGetGridAutoRows
(
)
;
already_AddRefed
<
CSSValue
>
DoGetGridTemplateAreas
(
)
;
already_AddRefed
<
CSSValue
>
DoGetGridTemplateColumns
(
)
;
already_AddRefed
<
CSSValue
>
DoGetGridTemplateRows
(
)
;
already_AddRefed
<
CSSValue
>
DoGetGridColumnStart
(
)
;
already_AddRefed
<
CSSValue
>
DoGetGridColumnEnd
(
)
;
already_AddRefed
<
CSSValue
>
DoGetGridRowStart
(
)
;
already_AddRefed
<
CSSValue
>
DoGetGridRowEnd
(
)
;
already_AddRefed
<
CSSValue
>
DoGetImageLayerPosition
(
const
nsStyleImageLayers
&
aLayers
)
;
already_AddRefed
<
CSSValue
>
DoGetMask
(
)
;
already_AddRefed
<
CSSValue
>
DoGetPaddingTop
(
)
;
already_AddRefed
<
CSSValue
>
DoGetPaddingBottom
(
)
;
already_AddRefed
<
CSSValue
>
DoGetPaddingLeft
(
)
;
already_AddRefed
<
CSSValue
>
DoGetPaddingRight
(
)
;
already_AddRefed
<
CSSValue
>
DoGetBorderSpacing
(
)
;
already_AddRefed
<
CSSValue
>
DoGetVerticalAlign
(
)
;
already_AddRefed
<
CSSValue
>
DoGetBorderTopWidth
(
)
;
already_AddRefed
<
CSSValue
>
DoGetBorderBottomWidth
(
)
;
already_AddRefed
<
CSSValue
>
DoGetBorderLeftWidth
(
)
;
already_AddRefed
<
CSSValue
>
DoGetBorderRightWidth
(
)
;
already_AddRefed
<
CSSValue
>
DoGetBorderImageWidth
(
)
;
already_AddRefed
<
CSSValue
>
DoGetBoxShadow
(
)
;
already_AddRefed
<
CSSValue
>
DoGetMarginTopWidth
(
)
;
already_AddRefed
<
CSSValue
>
DoGetMarginBottomWidth
(
)
;
already_AddRefed
<
CSSValue
>
DoGetMarginLeftWidth
(
)
;
already_AddRefed
<
CSSValue
>
DoGetMarginRightWidth
(
)
;
already_AddRefed
<
CSSValue
>
DoGetOutlineWidth
(
)
;
already_AddRefed
<
CSSValue
>
DoGetInitialLetter
(
)
;
already_AddRefed
<
CSSValue
>
DoGetLineHeight
(
)
;
already_AddRefed
<
CSSValue
>
DoGetTextDecoration
(
)
;
already_AddRefed
<
CSSValue
>
DoGetTextDecorationColor
(
)
;
already_AddRefed
<
CSSValue
>
DoGetTextDecorationLine
(
)
;
already_AddRefed
<
CSSValue
>
DoGetTextDecorationStyle
(
)
;
already_AddRefed
<
CSSValue
>
DoGetTextEmphasisPosition
(
)
;
already_AddRefed
<
CSSValue
>
DoGetTextEmphasisStyle
(
)
;
already_AddRefed
<
CSSValue
>
DoGetTextOverflow
(
)
;
already_AddRefed
<
CSSValue
>
DoGetTextShadow
(
)
;
already_AddRefed
<
CSSValue
>
DoGetWebkitTextStrokeWidth
(
)
;
already_AddRefed
<
CSSValue
>
DoGetBinding
(
)
;
already_AddRefed
<
CSSValue
>
DoGetDisplay
(
)
;
already_AddRefed
<
CSSValue
>
DoGetContain
(
)
;
already_AddRefed
<
CSSValue
>
DoGetWillChange
(
)
;
already_AddRefed
<
CSSValue
>
DoGetTouchAction
(
)
;
already_AddRefed
<
CSSValue
>
DoGetTransform
(
)
;
already_AddRefed
<
CSSValue
>
DoGetTransformOrigin
(
)
;
already_AddRefed
<
CSSValue
>
DoGetPerspectiveOrigin
(
)
;
already_AddRefed
<
CSSValue
>
DoGetScrollSnapPointsX
(
)
;
already_AddRefed
<
CSSValue
>
DoGetScrollSnapPointsY
(
)
;
already_AddRefed
<
CSSValue
>
DoGetScrollbarColor
(
)
;
already_AddRefed
<
CSSValue
>
DoGetCaretColor
(
)
;
already_AddRefed
<
CSSValue
>
DoGetForceBrokenImageIcon
(
)
;
already_AddRefed
<
CSSValue
>
DoGetColumnCount
(
)
;
already_AddRefed
<
CSSValue
>
DoGetColumnWidth
(
)
;
already_AddRefed
<
CSSValue
>
DoGetColumnRuleWidth
(
)
;
already_AddRefed
<
CSSValue
>
DoGetTransitionProperty
(
)
;
already_AddRefed
<
CSSValue
>
DoGetTransitionDuration
(
)
;
already_AddRefed
<
CSSValue
>
DoGetTransitionDelay
(
)
;
already_AddRefed
<
CSSValue
>
DoGetAnimationName
(
)
;
already_AddRefed
<
CSSValue
>
DoGetAnimationDuration
(
)
;
already_AddRefed
<
CSSValue
>
DoGetAnimationDelay
(
)
;
already_AddRefed
<
CSSValue
>
DoGetAnimationIterationCount
(
)
;
already_AddRefed
<
CSSValue
>
DoGetFlexBasis
(
)
;
already_AddRefed
<
CSSValue
>
DoGetFlexGrow
(
)
;
already_AddRefed
<
CSSValue
>
DoGetFlexShrink
(
)
;
already_AddRefed
<
CSSValue
>
DoGetColumnGap
(
)
;
already_AddRefed
<
CSSValue
>
DoGetRowGap
(
)
;
already_AddRefed
<
CSSValue
>
DoGetFill
(
)
;
already_AddRefed
<
CSSValue
>
DoGetStroke
(
)
;
already_AddRefed
<
CSSValue
>
DoGetMarkerEnd
(
)
;
already_AddRefed
<
CSSValue
>
DoGetMarkerMid
(
)
;
already_AddRefed
<
CSSValue
>
DoGetMarkerStart
(
)
;
already_AddRefed
<
CSSValue
>
DoGetFilter
(
)
;
already_AddRefed
<
CSSValue
>
DoGetPaintOrder
(
)
;
already_AddRefed
<
CSSValue
>
DummyGetter
(
)
;
void
SetValueFromComplexColor
(
nsROCSSPrimitiveValue
*
aValue
const
mozilla
:
:
StyleComplexColor
&
aColor
)
;
void
SetValueToPosition
(
const
mozilla
:
:
Position
&
aPosition
nsDOMCSSValueList
*
aValueList
)
;
void
SetValueToURLValue
(
const
mozilla
:
:
css
:
:
URLValue
*
aURL
nsROCSSPrimitiveValue
*
aValue
)
;
void
SetValueToSize
(
nsROCSSPrimitiveValue
*
aValue
const
mozilla
:
:
StyleSize
&
nscoord
aMinAppUnits
=
nscoord_MIN
nscoord
aMaxAppUnits
=
nscoord_MAX
)
;
void
SetValueToLengthPercentageOrAuto
(
nsROCSSPrimitiveValue
*
aValue
const
LengthPercentageOrAuto
&
bool
aClampNegativeCalc
)
;
void
SetValueToLengthPercentage
(
nsROCSSPrimitiveValue
*
aValue
const
LengthPercentage
&
bool
aClampNegativeCalc
nscoord
aMinAppUnits
=
nscoord_MIN
nscoord
aMaxAppUnits
=
nscoord_MAX
)
;
void
SetValueToMaxSize
(
nsROCSSPrimitiveValue
*
aValue
const
StyleMaxSize
&
)
;
void
SetValueToExtremumLength
(
nsROCSSPrimitiveValue
*
aValue
StyleExtremumLength
)
;
void
SetValueToCoord
(
nsROCSSPrimitiveValue
*
aValue
const
nsStyleCoord
&
aCoord
bool
aClampNegativeCalc
PercentageBaseGetter
aPercentageBaseGetter
=
nullptr
const
KTableEntry
aTable
[
]
=
nullptr
nscoord
aMinAppUnits
=
nscoord_MIN
nscoord
aMaxAppUnits
=
nscoord_MAX
)
;
nscoord
StyleCoordToNSCoord
(
const
LengthPercentage
&
aCoord
PercentageBaseGetter
aPercentageBaseGetter
nscoord
aDefaultValue
bool
aClampNegativeCalc
)
;
template
<
typename
LengthPercentageLike
>
nscoord
StyleCoordToNSCoord
(
const
LengthPercentageLike
&
aCoord
PercentageBaseGetter
aPercentageBaseGetter
nscoord
aDefaultValue
bool
aClampNegativeCalc
)
{
if
(
aCoord
.
IsLengthPercentage
(
)
)
{
return
StyleCoordToNSCoord
(
aCoord
.
AsLengthPercentage
(
)
aPercentageBaseGetter
aDefaultValue
aClampNegativeCalc
)
;
}
return
aDefaultValue
;
}
void
AppendFourSideCoordValues
(
nsDOMCSSValueList
*
aList
const
nsStyleSides
&
aValues
)
;
bool
GetCBContentWidth
(
nscoord
&
aWidth
)
;
bool
GetCBContentHeight
(
nscoord
&
aHeight
)
;
bool
GetCBPaddingRectWidth
(
nscoord
&
aWidth
)
;
bool
GetCBPaddingRectHeight
(
nscoord
&
aHeight
)
;
bool
GetScrollFrameContentWidth
(
nscoord
&
aWidth
)
;
bool
GetScrollFrameContentHeight
(
nscoord
&
aHeight
)
;
bool
GetFrameBorderRectWidth
(
nscoord
&
aWidth
)
;
bool
GetFrameBorderRectHeight
(
nscoord
&
aHeight
)
;
void
SetCssTextToCoord
(
nsAString
&
aCssText
const
nsStyleCoord
&
aCoord
bool
aClampNegativeCalc
)
;
already_AddRefed
<
CSSValue
>
CreatePrimitiveValueForStyleFilter
(
const
nsStyleFilter
&
aStyleFilter
)
;
template
<
typename
ReferenceBox
>
already_AddRefed
<
CSSValue
>
CreatePrimitiveValueForShapeSource
(
const
mozilla
:
:
UniquePtr
<
mozilla
:
:
StyleBasicShape
>
&
aStyleBasicShape
ReferenceBox
aReferenceBox
const
KTableEntry
aBoxKeywordTable
[
]
)
;
already_AddRefed
<
CSSValue
>
CreatePrimitiveValueForBasicShape
(
const
mozilla
:
:
UniquePtr
<
mozilla
:
:
StyleBasicShape
>
&
aStyleBasicShape
)
;
void
BoxValuesToString
(
nsAString
&
aString
const
nsTArray
<
nsStyleCoord
>
&
aBoxValues
bool
aClampNegativeCalc
)
;
void
BasicShapeRadiiToString
(
nsAString
&
aCssText
const
mozilla
:
:
BorderRadius
&
)
;
bool
NeedsToFlush
(
Document
*
)
const
;
static
ComputedStyleMap
*
GetComputedStyleMap
(
)
;
nsWeakPtr
mDocumentWeak
;
RefPtr
<
Element
>
mElement
;
RefPtr
<
ComputedStyle
>
mComputedStyle
;
RefPtr
<
nsAtom
>
mPseudo
;
nsIFrame
*
mOuterFrame
;
nsIFrame
*
mInnerFrame
;
nsIPresShell
*
mPresShell
;
StyleType
mStyleType
;
uint64_t
mComputedStyleGeneration
=
0
;
uint32_t
mPresShellId
=
0
;
bool
mExposeVisitedStyle
;
bool
mResolvedComputedStyle
;
#
ifdef
DEBUG
bool
mFlushedPendingReflows
;
#
endif
friend
struct
ComputedStyleMap
;
}
;
already_AddRefed
<
nsComputedDOMStyle
>
NS_NewComputedDOMStyle
(
mozilla
:
:
dom
:
:
Element
*
aElement
const
nsAString
&
aPseudoElt
mozilla
:
:
dom
:
:
Document
*
aDocument
nsComputedDOMStyle
:
:
StyleType
aStyleType
=
nsComputedDOMStyle
:
:
eAll
)
;
#
endif
