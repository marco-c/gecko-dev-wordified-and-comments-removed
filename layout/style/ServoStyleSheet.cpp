#
include
"
mozilla
/
ServoStyleSheet
.
h
"
#
include
"
mozilla
/
StyleBackendType
.
h
"
namespace
mozilla
{
ServoStyleSheet
:
:
ServoStyleSheet
(
css
:
:
SheetParsingMode
aParsingMode
CORSMode
aCORSMode
net
:
:
ReferrerPolicy
aReferrerPolicy
const
dom
:
:
SRIMetadata
&
aIntegrity
)
:
StyleSheet
(
StyleBackendType
:
:
Servo
aParsingMode
)
mSheetInfo
(
aCORSMode
aReferrerPolicy
aIntegrity
)
{
}
ServoStyleSheet
:
:
~
ServoStyleSheet
(
)
{
DropSheet
(
)
;
}
bool
ServoStyleSheet
:
:
HasRules
(
)
const
{
return
mSheet
&
&
Servo_StyleSheet_HasRules
(
mSheet
)
;
}
void
ServoStyleSheet
:
:
SetOwningDocument
(
nsIDocument
*
aDocument
)
{
mDocument
=
aDocument
;
}
ServoStyleSheet
*
ServoStyleSheet
:
:
GetParentSheet
(
)
const
{
MOZ_CRASH
(
"
stylo
:
not
implemented
"
)
;
}
void
ServoStyleSheet
:
:
AppendStyleSheet
(
ServoStyleSheet
*
aSheet
)
{
MOZ_CRASH
(
"
stylo
:
not
implemented
"
)
;
}
nsresult
ServoStyleSheet
:
:
ParseSheet
(
const
nsAString
&
aInput
nsIURI
*
aSheetURI
nsIURI
*
aBaseURI
nsIPrincipal
*
aSheetPrincipal
uint32_t
aLineNumber
)
{
DropSheet
(
)
;
RefPtr
<
ThreadSafeURIHolder
>
base
=
new
ThreadSafeURIHolder
(
aBaseURI
)
;
RefPtr
<
ThreadSafeURIHolder
>
referrer
=
new
ThreadSafeURIHolder
(
aSheetURI
)
;
RefPtr
<
ThreadSafePrincipalHolder
>
principal
=
new
ThreadSafePrincipalHolder
(
aSheetPrincipal
)
;
nsCString
baseString
;
nsresult
rv
=
aBaseURI
-
>
GetSpec
(
baseString
)
;
NS_ENSURE_SUCCESS
(
rv
rv
)
;
NS_ConvertUTF16toUTF8
input
(
aInput
)
;
mSheet
=
Servo_StyleSheet_FromUTF8Bytes
(
reinterpret_cast
<
const
uint8_t
*
>
(
input
.
get
(
)
)
input
.
Length
(
)
mParsingMode
reinterpret_cast
<
const
uint8_t
*
>
(
baseString
.
get
(
)
)
baseString
.
Length
(
)
base
referrer
principal
)
.
Consume
(
)
;
return
NS_OK
;
}
void
ServoStyleSheet
:
:
DropSheet
(
)
{
mSheet
=
nullptr
;
}
size_t
ServoStyleSheet
:
:
SizeOfIncludingThis
(
MallocSizeOf
aMallocSizeOf
)
const
{
MOZ_CRASH
(
"
stylo
:
not
implemented
"
)
;
}
#
ifdef
DEBUG
void
ServoStyleSheet
:
:
List
(
FILE
*
aOut
int32_t
aIndex
)
const
{
MOZ_CRASH
(
"
stylo
:
not
implemented
"
)
;
}
#
endif
}
