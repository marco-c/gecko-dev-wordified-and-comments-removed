#
include
"
mozilla
/
dom
/
CSSMozDocumentRule
.
h
"
#
include
"
mozilla
/
dom
/
CSSMozDocumentRuleBinding
.
h
"
#
include
"
nsContentUtils
.
h
"
namespace
mozilla
{
namespace
dom
{
using
namespace
mozilla
:
:
css
;
JSObject
*
CSSMozDocumentRule
:
:
WrapObject
(
JSContext
*
aCx
JS
:
:
Handle
<
JSObject
*
>
aGivenProto
)
{
return
CSSMozDocumentRuleBinding
:
:
Wrap
(
aCx
this
aGivenProto
)
;
}
bool
CSSMozDocumentRule
:
:
Match
(
nsIDocument
*
aDoc
nsIURI
*
aDocURI
const
nsACString
&
aDocURISpec
const
nsACString
&
aPattern
URLMatchingFunction
aUrlMatchingFunction
)
{
switch
(
aUrlMatchingFunction
)
{
case
URLMatchingFunction
:
:
eURL
:
{
if
(
aDocURISpec
=
=
aPattern
)
{
return
true
;
}
}
break
;
case
URLMatchingFunction
:
:
eURLPrefix
:
{
if
(
StringBeginsWith
(
aDocURISpec
aPattern
)
)
{
return
true
;
}
}
break
;
case
URLMatchingFunction
:
:
eDomain
:
{
nsAutoCString
host
;
if
(
aDocURI
)
{
aDocURI
-
>
GetHost
(
host
)
;
}
int32_t
lenDiff
=
host
.
Length
(
)
-
aPattern
.
Length
(
)
;
if
(
lenDiff
=
=
0
)
{
if
(
host
=
=
aPattern
)
{
return
true
;
}
}
else
{
if
(
StringEndsWith
(
host
aPattern
)
&
&
host
.
CharAt
(
lenDiff
-
1
)
=
=
'
.
'
)
{
return
true
;
}
}
}
break
;
case
URLMatchingFunction
:
:
eRegExp
:
{
NS_ConvertUTF8toUTF16
spec
(
aDocURISpec
)
;
NS_ConvertUTF8toUTF16
regex
(
aPattern
)
;
if
(
nsContentUtils
:
:
IsPatternMatching
(
spec
regex
aDoc
)
)
{
return
true
;
}
}
break
;
}
return
false
;
}
}
}
