#
include
"
ServoCSSParser
.
h
"
#
include
"
mozilla
/
ServoBindings
.
h
"
#
include
"
mozilla
/
ServoStyleSet
.
h
"
#
include
"
mozilla
/
dom
/
Document
.
h
"
using
namespace
mozilla
;
using
namespace
mozilla
:
:
dom
;
bool
ServoCSSParser
:
:
IsValidCSSColor
(
const
nsACString
&
aValue
)
{
return
Servo_IsValidCSSColor
(
&
aValue
)
;
}
bool
ServoCSSParser
:
:
ComputeColor
(
ServoStyleSet
*
aStyleSet
nscolor
aCurrentColor
const
nsACString
&
aValue
nscolor
*
aResultColor
bool
*
aWasCurrentColor
css
:
:
Loader
*
aLoader
)
{
return
Servo_ComputeColor
(
aStyleSet
?
aStyleSet
-
>
RawSet
(
)
:
nullptr
aCurrentColor
&
aValue
aResultColor
aWasCurrentColor
aLoader
)
;
}
already_AddRefed
<
RawServoDeclarationBlock
>
ServoCSSParser
:
:
ParseProperty
(
nsCSSPropertyID
aProperty
const
nsAString
&
aValue
const
ParsingEnvironment
&
aParsingEnvironment
ParsingMode
aParsingMode
)
{
NS_ConvertUTF16toUTF8
value
(
aValue
)
;
return
Servo_ParseProperty
(
aProperty
&
value
aParsingEnvironment
.
mUrlExtraData
aParsingMode
aParsingEnvironment
.
mCompatMode
aParsingEnvironment
.
mLoader
aParsingEnvironment
.
mRuleType
)
.
Consume
(
)
;
}
bool
ServoCSSParser
:
:
ParseEasing
(
const
nsAString
&
aValue
nsTimingFunction
&
aResult
)
{
return
Servo_ParseEasing
(
&
aValue
&
aResult
)
;
}
bool
ServoCSSParser
:
:
ParseTransformIntoMatrix
(
const
nsACString
&
aValue
bool
&
aContains3DTransform
gfx
:
:
Matrix4x4
&
aResult
)
{
return
Servo_ParseTransformIntoMatrix
(
&
aValue
&
aContains3DTransform
&
aResult
.
components
)
;
}
bool
ServoCSSParser
:
:
ParseFontShorthandForMatching
(
const
nsAString
&
aValue
URLExtraData
*
aUrl
RefPtr
<
SharedFontList
>
&
aList
StyleComputedFontStyleDescriptor
&
aStyle
float
&
aStretch
float
&
aWeight
)
{
return
Servo_ParseFontShorthandForMatching
(
&
aValue
aUrl
&
aList
&
aStyle
&
aStretch
&
aWeight
)
;
}
already_AddRefed
<
URLExtraData
>
ServoCSSParser
:
:
GetURLExtraData
(
Document
*
aDocument
)
{
MOZ_ASSERT
(
aDocument
)
;
nsCOMPtr
<
nsIReferrerInfo
>
referrerInfo
=
ReferrerInfo
:
:
CreateForInternalCSSResources
(
aDocument
)
;
RefPtr
<
URLExtraData
>
url
=
new
URLExtraData
(
aDocument
-
>
GetDocumentURI
(
)
referrerInfo
aDocument
-
>
NodePrincipal
(
)
)
;
return
url
.
forget
(
)
;
}
ServoCSSParser
:
:
ParsingEnvironment
ServoCSSParser
:
:
GetParsingEnvironment
(
Document
*
aDocument
)
{
return
{
GetURLExtraData
(
aDocument
)
aDocument
-
>
GetCompatibilityMode
(
)
aDocument
-
>
CSSLoader
(
)
}
;
}
