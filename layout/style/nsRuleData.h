#
ifndef
nsRuleData_h_
#
define
nsRuleData_h_
#
include
"
mozilla
/
CSSVariableDeclarations
.
h
"
#
include
"
mozilla
/
GenericSpecifiedValues
.
h
"
#
include
"
mozilla
/
RuleNodeCacheConditions
.
h
"
#
include
"
mozilla
/
SheetType
.
h
"
#
include
"
nsAutoPtr
.
h
"
#
include
"
nsCSSProps
.
h
"
#
include
"
nsCSSValue
.
h
"
#
include
"
nsStyleStructFwd
.
h
"
class
nsPresContext
;
class
nsStyleContext
;
struct
nsRuleData
;
typedef
void
(
*
nsPostResolveFunc
)
(
void
*
aStyleStruct
nsRuleData
*
aData
)
;
struct
nsRuleData
final
:
GenericSpecifiedValues
{
const
uint32_t
mSIDs
;
mozilla
:
:
RuleNodeCacheConditions
mConditions
;
bool
mIsImportantRule
;
mozilla
:
:
SheetType
mLevel
;
nsPresContext
*
const
mPresContext
;
nsStyleContext
*
const
mStyleContext
;
nsCSSValue
*
const
mValueStorage
;
size_t
mValueOffsets
[
nsStyleStructID_Length
]
;
nsAutoPtr
<
mozilla
:
:
CSSVariableDeclarations
>
mVariables
;
nsRuleData
(
uint32_t
aSIDs
nsCSSValue
*
aValueStorage
nsPresContext
*
aContext
nsStyleContext
*
aStyleContext
)
;
#
ifdef
DEBUG
~
nsRuleData
(
)
;
#
else
~
nsRuleData
(
)
{
}
#
endif
nsCSSValue
*
ValueFor
(
nsCSSPropertyID
aProperty
)
{
MOZ_ASSERT
(
aProperty
<
eCSSProperty_COUNT_no_shorthands
"
invalid
or
shorthand
property
"
)
;
nsStyleStructID
sid
=
nsCSSProps
:
:
kSIDTable
[
aProperty
]
;
size_t
indexInStruct
=
nsCSSProps
:
:
PropertyIndexInStruct
(
aProperty
)
;
MOZ_ASSERT
(
mSIDs
&
(
1
<
<
sid
)
"
calling
nsRuleData
:
:
ValueFor
on
property
not
in
mSIDs
"
)
;
MOZ_ASSERT
(
indexInStruct
!
=
size_t
(
-
1
)
"
logical
property
"
)
;
return
mValueStorage
+
mValueOffsets
[
sid
]
+
indexInStruct
;
}
const
nsCSSValue
*
ValueFor
(
nsCSSPropertyID
aProperty
)
const
{
return
const_cast
<
nsRuleData
*
>
(
this
)
-
>
ValueFor
(
aProperty
)
;
}
#
define
CSS_PROP_PUBLIC_OR_PRIVATE
(
publicname_
privatename_
)
privatename_
#
define
CSS_PROP
(
name_
id_
method_
flags_
pref_
parsevariant_
\
kwtable_
stylestruct_
stylestructoffset_
animtype_
)
\
nsCSSValue
*
ValueFor
#
#
method_
(
)
{
\
MOZ_ASSERT
(
mSIDs
&
NS_STYLE_INHERIT_BIT
(
stylestruct_
)
\
"
Calling
nsRuleData
:
:
ValueFor
"
#
method_
"
without
"
\
"
NS_STYLE_INHERIT_BIT
(
"
#
stylestruct_
"
in
mSIDs
.
"
)
;
\
nsStyleStructID
sid
=
eStyleStruct_
#
#
stylestruct_
;
\
size_t
indexInStruct
=
\
nsCSSProps
:
:
PropertyIndexInStruct
(
eCSSProperty_
#
#
id_
)
;
\
MOZ_ASSERT
(
indexInStruct
!
=
size_t
(
-
1
)
\
"
logical
property
"
)
;
\
return
mValueStorage
+
mValueOffsets
[
sid
]
+
indexInStruct
;
\
}
\
const
nsCSSValue
*
ValueFor
#
#
method_
(
)
const
{
\
return
const_cast
<
nsRuleData
*
>
(
this
)
-
>
ValueFor
#
#
method_
(
)
;
\
}
#
define
CSS_PROP_LIST_EXCLUDE_LOGICAL
#
include
"
nsCSSPropList
.
h
"
#
undef
CSS_PROP_LIST_EXCLUDE_LOGICAL
#
undef
CSS_PROP
#
undef
CSS_PROP_PUBLIC_OR_PRIVATE
bool
PropertyIsSet
(
nsCSSPropertyID
aId
)
override
{
return
ValueFor
(
aId
)
-
>
GetUnit
(
)
!
=
eCSSUnit_Null
;
}
nsRuleData
*
AsRuleData
(
)
override
{
return
this
;
}
private
:
inline
size_t
GetPoisonOffset
(
)
;
}
;
#
endif
