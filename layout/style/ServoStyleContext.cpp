#
include
"
mozilla
/
ServoStyleContext
.
h
"
#
include
"
nsCSSAnonBoxes
.
h
"
#
include
"
nsStyleConsts
.
h
"
#
include
"
nsStyleStruct
.
h
"
#
include
"
nsPresContext
.
h
"
#
include
"
nsCSSRuleProcessor
.
h
"
#
include
"
mozilla
/
dom
/
HTMLBodyElement
.
h
"
#
include
"
mozilla
/
ServoBindings
.
h
"
namespace
mozilla
{
ServoStyleContext
:
:
ServoStyleContext
(
nsPresContext
*
aPresContext
nsIAtom
*
aPseudoTag
CSSPseudoElementType
aPseudoType
ServoComputedDataForgotten
aComputedValues
)
:
nsStyleContext
(
aPseudoTag
aPseudoType
)
mPresContext
(
aPresContext
)
mSource
(
aComputedValues
)
{
AddStyleBit
(
Servo_ComputedValues_GetStyleBits
(
this
)
)
;
MOZ_ASSERT
(
ComputedData
(
)
)
;
}
ServoStyleContext
*
ServoStyleContext
:
:
GetCachedInheritingAnonBoxStyle
(
nsIAtom
*
aAnonBox
)
const
{
MOZ_ASSERT
(
nsCSSAnonBoxes
:
:
IsInheritingAnonBox
(
aAnonBox
)
)
;
if
(
IsInheritingAnonBox
(
)
)
{
return
nullptr
;
}
auto
*
current
=
mNextInheritingAnonBoxStyle
.
get
(
)
;
while
(
current
&
&
current
-
>
GetPseudo
(
)
!
=
aAnonBox
)
{
current
=
current
-
>
mNextInheritingAnonBoxStyle
.
get
(
)
;
}
return
current
;
}
ServoStyleContext
*
ServoStyleContext
:
:
GetCachedLazyPseudoStyle
(
CSSPseudoElementType
aPseudo
)
const
{
MOZ_ASSERT
(
aPseudo
!
=
CSSPseudoElementType
:
:
NotPseudo
&
&
aPseudo
!
=
CSSPseudoElementType
:
:
InheritingAnonBox
&
&
aPseudo
!
=
CSSPseudoElementType
:
:
NonInheritingAnonBox
)
;
MOZ_ASSERT
(
!
IsLazilyCascadedPseudoElement
(
)
"
Lazy
pseudos
can
'
t
inherit
lazy
pseudos
"
)
;
if
(
nsCSSPseudoElements
:
:
PseudoElementSupportsUserActionState
(
aPseudo
)
)
{
return
nullptr
;
}
auto
*
current
=
mNextLazyPseudoStyle
.
get
(
)
;
while
(
current
&
&
current
-
>
GetPseudoType
(
)
!
=
aPseudo
)
{
current
=
current
-
>
mNextLazyPseudoStyle
.
get
(
)
;
}
return
current
;
}
}
