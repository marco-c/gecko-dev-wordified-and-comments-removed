#
ifndef
nsStyleStructInlines_h_
#
define
nsStyleStructInlines_h_
#
include
"
nsIFrame
.
h
"
#
include
"
nsStyleStruct
.
h
"
#
include
"
nsIContent
.
h
"
#
include
"
nsTextFrame
.
h
"
#
include
"
nsSVGUtils
.
h
"
inline
void
nsStyleImage
:
:
EnsureCachedBIData
(
)
const
{
if
(
!
mCachedBIData
)
{
const_cast
<
nsStyleImage
*
>
(
this
)
-
>
mCachedBIData
=
mozilla
:
:
MakeUnique
<
CachedBorderImageData
>
(
)
;
}
}
inline
void
nsStyleImage
:
:
SetSubImage
(
uint8_t
aIndex
imgIContainer
*
aSubImage
)
const
{
EnsureCachedBIData
(
)
;
mCachedBIData
-
>
SetSubImage
(
aIndex
aSubImage
)
;
}
inline
imgIContainer
*
nsStyleImage
:
:
GetSubImage
(
uint8_t
aIndex
)
const
{
return
(
mCachedBIData
)
?
mCachedBIData
-
>
GetSubImage
(
aIndex
)
:
nullptr
;
}
bool
nsStyleText
:
:
NewlineIsSignificant
(
const
nsTextFrame
*
aContextFrame
)
const
{
NS_ASSERTION
(
aContextFrame
-
>
StyleText
(
)
=
=
this
"
unexpected
aContextFrame
"
)
;
return
NewlineIsSignificantStyle
(
)
&
&
!
aContextFrame
-
>
ShouldSuppressLineBreak
(
)
&
&
!
aContextFrame
-
>
Style
(
)
-
>
IsTextCombined
(
)
;
}
bool
nsStyleText
:
:
WhiteSpaceCanWrap
(
const
nsIFrame
*
aContextFrame
)
const
{
NS_ASSERTION
(
aContextFrame
-
>
StyleText
(
)
=
=
this
"
unexpected
aContextFrame
"
)
;
return
WhiteSpaceCanWrapStyle
(
)
&
&
!
nsSVGUtils
:
:
IsInSVGTextSubtree
(
aContextFrame
)
&
&
!
aContextFrame
-
>
Style
(
)
-
>
IsTextCombined
(
)
;
}
bool
nsStyleText
:
:
WordCanWrap
(
const
nsIFrame
*
aContextFrame
)
const
{
NS_ASSERTION
(
aContextFrame
-
>
StyleText
(
)
=
=
this
"
unexpected
aContextFrame
"
)
;
return
WordCanWrapStyle
(
)
&
&
!
nsSVGUtils
:
:
IsInSVGTextSubtree
(
aContextFrame
)
;
}
bool
nsStyleDisplay
:
:
IsBlockOutside
(
const
nsIFrame
*
aContextFrame
)
const
{
NS_ASSERTION
(
aContextFrame
-
>
StyleDisplay
(
)
=
=
this
"
unexpected
aContextFrame
"
)
;
if
(
nsSVGUtils
:
:
IsInSVGTextSubtree
(
aContextFrame
)
)
{
return
aContextFrame
-
>
IsBlockFrame
(
)
;
}
return
IsBlockOutsideStyle
(
)
;
}
bool
nsStyleDisplay
:
:
IsInlineOutside
(
const
nsIFrame
*
aContextFrame
)
const
{
NS_ASSERTION
(
aContextFrame
-
>
StyleDisplay
(
)
=
=
this
"
unexpected
aContextFrame
"
)
;
if
(
nsSVGUtils
:
:
IsInSVGTextSubtree
(
aContextFrame
)
)
{
return
!
aContextFrame
-
>
IsBlockFrame
(
)
;
}
return
IsInlineOutsideStyle
(
)
;
}
mozilla
:
:
StyleDisplay
nsStyleDisplay
:
:
GetDisplay
(
const
nsIFrame
*
aContextFrame
)
const
{
NS_ASSERTION
(
aContextFrame
-
>
StyleDisplay
(
)
=
=
this
"
unexpected
aContextFrame
"
)
;
if
(
nsSVGUtils
:
:
IsInSVGTextSubtree
(
aContextFrame
)
&
&
mDisplay
!
=
mozilla
:
:
StyleDisplay
:
:
None
)
{
return
aContextFrame
-
>
IsBlockFrame
(
)
?
mozilla
:
:
StyleDisplay
:
:
Block
:
mozilla
:
:
StyleDisplay
:
:
Inline
;
}
return
mDisplay
;
}
bool
nsStyleDisplay
:
:
IsFloating
(
const
nsIFrame
*
aContextFrame
)
const
{
NS_ASSERTION
(
aContextFrame
-
>
StyleDisplay
(
)
=
=
this
"
unexpected
aContextFrame
"
)
;
return
IsFloatingStyle
(
)
&
&
!
nsSVGUtils
:
:
IsInSVGTextSubtree
(
aContextFrame
)
;
}
bool
nsStyleDisplay
:
:
HasTransform
(
const
nsIFrame
*
aContextFrame
)
const
{
NS_ASSERTION
(
aContextFrame
-
>
StyleDisplay
(
)
=
=
this
"
unexpected
aContextFrame
"
)
;
return
HasTransformStyle
(
)
&
&
aContextFrame
-
>
IsFrameOfType
(
nsIFrame
:
:
eSupportsCSSTransforms
)
;
}
bool
nsStyleDisplay
:
:
HasPerspective
(
const
nsIFrame
*
aContextFrame
)
const
{
MOZ_ASSERT
(
aContextFrame
-
>
StyleDisplay
(
)
=
=
this
"
unexpected
aContextFrame
"
)
;
return
HasPerspectiveStyle
(
)
&
&
aContextFrame
-
>
IsFrameOfType
(
nsIFrame
:
:
eSupportsCSSTransforms
)
;
}
bool
nsStyleDisplay
:
:
IsFixedPosContainingBlockForNonSVGTextFrames
(
const
mozilla
:
:
ComputedStyle
&
aStyle
)
const
{
NS_ASSERTION
(
aStyle
.
StyleDisplay
(
)
=
=
this
"
unexpected
aStyle
"
)
;
if
(
mWillChange
.
bits
&
mozilla
:
:
StyleWillChangeBits_FIXPOS_CB
)
{
return
true
;
}
return
aStyle
.
StyleEffects
(
)
-
>
HasFilters
(
)
|
|
aStyle
.
StyleEffects
(
)
-
>
HasBackdropFilters
(
)
;
}
bool
nsStyleDisplay
:
:
IsFixedPosContainingBlockForContainLayoutAndPaintSupportingFrames
(
)
const
{
return
IsContainPaint
(
)
|
|
IsContainLayout
(
)
;
}
bool
nsStyleDisplay
:
:
IsFixedPosContainingBlockForTransformSupportingFrames
(
)
const
{
return
HasTransformStyle
(
)
|
|
HasPerspectiveStyle
(
)
;
}
bool
nsStyleDisplay
:
:
IsFixedPosContainingBlock
(
const
nsIFrame
*
aContextFrame
)
const
{
mozilla
:
:
ComputedStyle
*
style
=
aContextFrame
-
>
Style
(
)
;
NS_ASSERTION
(
style
-
>
StyleDisplay
(
)
=
=
this
"
unexpected
aContextFrame
"
)
;
if
(
!
IsFixedPosContainingBlockForNonSVGTextFrames
(
*
style
)
&
&
(
!
IsFixedPosContainingBlockForContainLayoutAndPaintSupportingFrames
(
)
|
|
!
aContextFrame
-
>
IsFrameOfType
(
nsIFrame
:
:
eSupportsContainLayoutAndPaint
)
)
&
&
(
!
IsFixedPosContainingBlockForTransformSupportingFrames
(
)
|
|
!
aContextFrame
-
>
IsFrameOfType
(
nsIFrame
:
:
eSupportsCSSTransforms
)
)
)
{
return
false
;
}
if
(
nsSVGUtils
:
:
IsInSVGTextSubtree
(
aContextFrame
)
)
{
return
false
;
}
MOZ_ASSERT
(
IsAbsPosContainingBlock
(
aContextFrame
)
"
Any
fixed
-
pos
CB
should
also
be
an
abs
-
pos
CB
"
)
;
return
true
;
}
bool
nsStyleDisplay
:
:
IsAbsPosContainingBlockForNonSVGTextFrames
(
)
const
{
return
IsAbsolutelyPositionedStyle
(
)
|
|
IsRelativelyPositionedStyle
(
)
|
|
(
mWillChange
.
bits
&
mozilla
:
:
StyleWillChangeBits_ABSPOS_CB
)
;
}
bool
nsStyleDisplay
:
:
IsAbsPosContainingBlock
(
const
nsIFrame
*
aContextFrame
)
const
{
mozilla
:
:
ComputedStyle
*
style
=
aContextFrame
-
>
Style
(
)
;
NS_ASSERTION
(
style
-
>
StyleDisplay
(
)
=
=
this
"
unexpected
aContextFrame
"
)
;
if
(
!
IsAbsPosContainingBlockForNonSVGTextFrames
(
)
&
&
!
IsFixedPosContainingBlockForNonSVGTextFrames
(
*
style
)
&
&
(
!
IsFixedPosContainingBlockForContainLayoutAndPaintSupportingFrames
(
)
|
|
!
aContextFrame
-
>
IsFrameOfType
(
nsIFrame
:
:
eSupportsContainLayoutAndPaint
)
)
&
&
(
!
IsFixedPosContainingBlockForTransformSupportingFrames
(
)
|
|
!
aContextFrame
-
>
IsFrameOfType
(
nsIFrame
:
:
eSupportsCSSTransforms
)
)
)
{
return
false
;
}
return
!
nsSVGUtils
:
:
IsInSVGTextSubtree
(
aContextFrame
)
;
}
bool
nsStyleDisplay
:
:
IsRelativelyPositioned
(
const
nsIFrame
*
aContextFrame
)
const
{
NS_ASSERTION
(
aContextFrame
-
>
StyleDisplay
(
)
=
=
this
"
unexpected
aContextFrame
"
)
;
return
IsRelativelyPositionedStyle
(
)
&
&
!
nsSVGUtils
:
:
IsInSVGTextSubtree
(
aContextFrame
)
;
}
bool
nsStyleDisplay
:
:
IsStickyPositioned
(
const
nsIFrame
*
aContextFrame
)
const
{
NS_ASSERTION
(
aContextFrame
-
>
StyleDisplay
(
)
=
=
this
"
unexpected
aContextFrame
"
)
;
return
IsStickyPositionedStyle
(
)
&
&
!
nsSVGUtils
:
:
IsInSVGTextSubtree
(
aContextFrame
)
;
}
bool
nsStyleDisplay
:
:
IsAbsolutelyPositioned
(
const
nsIFrame
*
aContextFrame
)
const
{
NS_ASSERTION
(
aContextFrame
-
>
StyleDisplay
(
)
=
=
this
"
unexpected
aContextFrame
"
)
;
return
IsAbsolutelyPositionedStyle
(
)
&
&
!
nsSVGUtils
:
:
IsInSVGTextSubtree
(
aContextFrame
)
;
}
uint8_t
nsStyleUI
:
:
GetEffectivePointerEvents
(
nsIFrame
*
aFrame
)
const
{
if
(
aFrame
-
>
GetContent
(
)
&
&
!
aFrame
-
>
GetContent
(
)
-
>
GetParent
(
)
)
{
return
NS_STYLE_POINTER_EVENTS_AUTO
;
}
return
mPointerEvents
;
}
bool
nsStyleBackground
:
:
HasLocalBackground
(
)
const
{
NS_FOR_VISIBLE_IMAGE_LAYERS_BACK_TO_FRONT
(
i
mImage
)
{
const
nsStyleImageLayers
:
:
Layer
&
layer
=
mImage
.
mLayers
[
i
]
;
if
(
!
layer
.
mImage
.
IsEmpty
(
)
&
&
layer
.
mAttachment
=
=
mozilla
:
:
StyleImageLayerAttachment
:
:
Local
)
{
return
true
;
}
}
return
false
;
}
#
endif
