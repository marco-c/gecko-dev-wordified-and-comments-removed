#
ifndef
MOZILLA_SVGCONTEXT_H_
#
define
MOZILLA_SVGCONTEXT_H_
#
include
"
mozilla
/
Maybe
.
h
"
#
include
"
mozilla
/
SVGContextPaint
.
h
"
#
include
"
SVGPreserveAspectRatio
.
h
"
#
include
"
Units
.
h
"
class
nsIFrame
;
namespace
mozilla
{
class
SVGImageContext
{
public
:
SVGImageContext
(
)
:
mGlobalOpacity
(
1
.
0
)
mIsPaintingSVGImageElement
(
false
)
{
}
explicit
SVGImageContext
(
const
Maybe
<
CSSIntSize
>
&
aViewportSize
const
Maybe
<
SVGPreserveAspectRatio
>
&
aPreserveAspectRatio
=
Nothing
(
)
gfxFloat
aOpacity
=
1
.
0
bool
aIsPaintingSVGImageElement
=
false
)
:
mViewportSize
(
aViewportSize
)
mPreserveAspectRatio
(
aPreserveAspectRatio
)
mGlobalOpacity
(
aOpacity
)
mIsPaintingSVGImageElement
(
aIsPaintingSVGImageElement
)
{
}
static
void
MaybeInitAndStoreContextPaint
(
Maybe
<
SVGImageContext
>
&
aContext
nsIFrame
*
aFromFrame
imgIContainer
*
aImgContainer
)
;
const
Maybe
<
CSSIntSize
>
&
GetViewportSize
(
)
const
{
return
mViewportSize
;
}
void
SetViewportSize
(
const
Maybe
<
CSSIntSize
>
&
aSize
)
{
mViewportSize
=
aSize
;
}
const
Maybe
<
SVGPreserveAspectRatio
>
&
GetPreserveAspectRatio
(
)
const
{
return
mPreserveAspectRatio
;
}
void
SetPreserveAspectRatio
(
const
Maybe
<
SVGPreserveAspectRatio
>
&
aPAR
)
{
mPreserveAspectRatio
=
aPAR
;
}
gfxFloat
GetGlobalOpacity
(
)
const
{
return
mGlobalOpacity
;
}
const
SVGEmbeddingContextPaint
*
GetContextPaint
(
)
const
{
return
mContextPaint
.
get
(
)
;
}
bool
IsPaintingForSVGImageElement
(
)
const
{
return
mIsPaintingSVGImageElement
;
}
bool
operator
=
=
(
const
SVGImageContext
&
aOther
)
const
{
bool
contextPaintIsEqual
=
(
mContextPaint
=
=
aOther
.
mContextPaint
)
|
|
(
mContextPaint
&
&
aOther
.
mContextPaint
&
&
*
mContextPaint
=
=
*
aOther
.
mContextPaint
)
;
return
contextPaintIsEqual
&
&
mViewportSize
=
=
aOther
.
mViewportSize
&
&
mPreserveAspectRatio
=
=
aOther
.
mPreserveAspectRatio
&
&
mGlobalOpacity
=
=
aOther
.
mGlobalOpacity
&
&
mIsPaintingSVGImageElement
=
=
aOther
.
mIsPaintingSVGImageElement
;
}
bool
operator
!
=
(
const
SVGImageContext
&
aOther
)
const
{
return
!
(
*
this
=
=
aOther
)
;
}
uint32_t
Hash
(
)
const
{
uint32_t
hash
=
0
;
if
(
mContextPaint
)
{
hash
=
HashGeneric
(
hash
mContextPaint
-
>
Hash
(
)
)
;
}
return
HashGeneric
(
hash
mViewportSize
.
map
(
HashSize
)
.
valueOr
(
0
)
mPreserveAspectRatio
.
map
(
HashPAR
)
.
valueOr
(
0
)
HashBytes
(
&
mGlobalOpacity
sizeof
(
mGlobalOpacity
)
)
mIsPaintingSVGImageElement
)
;
}
private
:
static
uint32_t
HashSize
(
const
CSSIntSize
&
aSize
)
{
return
HashGeneric
(
aSize
.
width
aSize
.
height
)
;
}
static
uint32_t
HashPAR
(
const
SVGPreserveAspectRatio
&
aPAR
)
{
return
aPAR
.
Hash
(
)
;
}
RefPtr
<
SVGEmbeddingContextPaint
>
mContextPaint
;
Maybe
<
CSSIntSize
>
mViewportSize
;
Maybe
<
SVGPreserveAspectRatio
>
mPreserveAspectRatio
;
gfxFloat
mGlobalOpacity
;
bool
mIsPaintingSVGImageElement
;
}
;
}
#
endif
