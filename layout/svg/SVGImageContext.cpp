#
include
"
SVGImageContext
.
h
"
#
include
"
gfxUtils
.
h
"
#
include
"
mozilla
/
Preferences
.
h
"
#
include
"
nsIFrame
.
h
"
#
include
"
nsPresContext
.
h
"
namespace
mozilla
{
bool
SVGImageContext
:
:
MaybeStoreContextPaint
(
nsIFrame
*
aFromFrame
)
{
static
bool
sEnabledForContent
=
false
;
static
bool
sEnabledForContentCached
=
false
;
if
(
!
sEnabledForContentCached
)
{
Preferences
:
:
AddBoolVarCache
(
&
sEnabledForContent
"
svg
.
context
-
properties
.
content
.
enabled
"
false
)
;
sEnabledForContentCached
=
true
;
}
if
(
!
sEnabledForContent
&
&
!
aFromFrame
-
>
PresContext
(
)
-
>
IsChrome
(
)
)
{
return
false
;
}
bool
haveContextPaint
=
false
;
RefPtr
<
SVGEmbeddingContextPaint
>
contextPaint
=
new
SVGEmbeddingContextPaint
(
)
;
const
nsStyleSVG
*
style
=
aFromFrame
-
>
StyleSVG
(
)
;
if
(
style
-
>
mFill
.
Type
(
)
=
=
eStyleSVGPaintType_Color
)
{
haveContextPaint
=
true
;
contextPaint
-
>
SetFill
(
style
-
>
mFill
.
GetColor
(
)
)
;
}
if
(
style
-
>
mStroke
.
Type
(
)
=
=
eStyleSVGPaintType_Color
)
{
haveContextPaint
=
true
;
contextPaint
-
>
SetStroke
(
style
-
>
mStroke
.
GetColor
(
)
)
;
}
if
(
haveContextPaint
)
{
mContextPaint
=
contextPaint
.
forget
(
)
;
}
return
mContextPaint
!
=
nullptr
;
}
}
