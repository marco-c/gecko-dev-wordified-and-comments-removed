#
include
"
SVGImageContext
.
h
"
#
include
"
gfxUtils
.
h
"
#
include
"
mozilla
/
Preferences
.
h
"
#
include
"
nsIFrame
.
h
"
#
include
"
nsPresContext
.
h
"
#
include
"
nsStyleStruct
.
h
"
namespace
mozilla
{
void
SVGImageContext
:
:
MaybeStoreContextPaint
(
Maybe
<
SVGImageContext
>
&
aContext
nsIFrame
*
aFromFrame
imgIContainer
*
aImgContainer
)
{
return
MaybeStoreContextPaint
(
aContext
aFromFrame
-
>
Style
(
)
aImgContainer
)
;
}
void
SVGImageContext
:
:
MaybeStoreContextPaint
(
Maybe
<
SVGImageContext
>
&
aContext
ComputedStyle
*
aFromComputedStyle
imgIContainer
*
aImgContainer
)
{
const
nsStyleSVG
*
style
=
aFromComputedStyle
-
>
StyleSVG
(
)
;
if
(
!
style
-
>
ExposesContextProperties
(
)
)
{
return
;
}
if
(
aImgContainer
-
>
GetType
(
)
!
=
imgIContainer
:
:
TYPE_VECTOR
)
{
return
;
}
bool
haveContextPaint
=
false
;
RefPtr
<
SVGEmbeddingContextPaint
>
contextPaint
=
new
SVGEmbeddingContextPaint
(
)
;
if
(
(
style
-
>
mMozContextProperties
.
bits
&
StyleContextPropertyBits_FILL
)
&
&
style
-
>
mFill
.
kind
.
IsColor
(
)
)
{
haveContextPaint
=
true
;
contextPaint
-
>
SetFill
(
style
-
>
mFill
.
kind
.
AsColor
(
)
.
CalcColor
(
*
aFromComputedStyle
)
)
;
}
if
(
(
style
-
>
mMozContextProperties
.
bits
&
StyleContextPropertyBits_STROKE
)
&
&
style
-
>
mStroke
.
kind
.
IsColor
(
)
)
{
haveContextPaint
=
true
;
contextPaint
-
>
SetStroke
(
style
-
>
mStroke
.
kind
.
AsColor
(
)
.
CalcColor
(
*
aFromComputedStyle
)
)
;
}
if
(
style
-
>
mMozContextProperties
.
bits
&
StyleContextPropertyBits_FILL_OPACITY
)
{
haveContextPaint
=
true
;
contextPaint
-
>
SetFillOpacity
(
style
-
>
mFillOpacity
)
;
}
if
(
style
-
>
mMozContextProperties
.
bits
&
StyleContextPropertyBits_STROKE_OPACITY
)
{
haveContextPaint
=
true
;
contextPaint
-
>
SetStrokeOpacity
(
style
-
>
mStrokeOpacity
)
;
}
if
(
haveContextPaint
)
{
if
(
!
aContext
)
{
aContext
.
emplace
(
)
;
}
aContext
-
>
mContextPaint
=
contextPaint
.
forget
(
)
;
}
}
}
