#
ifndef
mozilla_ServoStyleRuleMap_h
#
define
mozilla_ServoStyleRuleMap_h
#
include
"
mozilla
/
css
/
Rule
.
h
"
#
include
"
mozilla
/
StyleSheet
.
h
"
#
include
"
nsTHashMap
.
h
"
struct
StyleLockedStyleRule
;
namespace
mozilla
{
class
ServoCSSRuleList
;
class
ServoStyleSet
;
namespace
css
{
class
Rule
;
}
namespace
dom
{
class
ShadowRoot
;
}
class
ServoStyleRuleMap
final
{
public
:
ServoStyleRuleMap
(
)
=
default
;
void
EnsureTable
(
ServoStyleSet
&
)
;
void
EnsureTable
(
dom
:
:
ShadowRoot
&
)
;
css
:
:
Rule
*
Lookup
(
const
StyleLockedDeclarationBlock
*
aDecls
)
const
{
return
mTable
.
Get
(
aDecls
)
;
}
void
SheetAdded
(
StyleSheet
&
)
;
void
SheetRemoved
(
StyleSheet
&
)
;
void
SheetCloned
(
StyleSheet
&
)
;
void
RuleAdded
(
StyleSheet
&
aStyleSheet
css
:
:
Rule
&
)
;
void
RuleRemoved
(
StyleSheet
&
aStyleSheet
css
:
:
Rule
&
)
;
void
RuleDeclarationsChanged
(
css
:
:
Rule
&
const
StyleLockedDeclarationBlock
*
aOld
const
StyleLockedDeclarationBlock
*
aNew
)
;
size_t
SizeOfIncludingThis
(
MallocSizeOf
aMallocSizeOf
)
const
;
~
ServoStyleRuleMap
(
)
=
default
;
private
:
bool
IsEmpty
(
)
const
{
return
mTable
.
IsEmpty
(
)
;
}
void
FillTableFromRule
(
css
:
:
Rule
&
)
;
void
FillTableFromRuleList
(
ServoCSSRuleList
&
)
;
void
FillTableFromStyleSheet
(
StyleSheet
&
)
;
using
Hashtable
=
nsTHashMap
<
nsPtrHashKey
<
const
StyleLockedDeclarationBlock
>
WeakPtr
<
css
:
:
Rule
>
>
;
Hashtable
mTable
;
}
;
}
#
endif
