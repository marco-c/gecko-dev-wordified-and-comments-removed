#
ifndef
nsTextPaintStyle_h__
#
define
nsTextPaintStyle_h__
#
include
"
mozilla
/
Attributes
.
h
"
#
include
"
mozilla
/
ComputedStyle
.
h
"
#
include
"
mozilla
/
Span
.
h
"
#
include
"
nsAtom
.
h
"
#
include
"
nsISelectionController
.
h
"
#
include
"
nsTHashMap
.
h
"
class
nsTextFrame
;
class
nsPresContext
;
namespace
mozilla
{
enum
class
StyleTextDecorationStyle
:
uint8_t
;
}
class
MOZ_STACK_CLASS
nsTextPaintStyle
{
using
ComputedStyle
=
mozilla
:
:
ComputedStyle
;
using
SelectionType
=
mozilla
:
:
SelectionType
;
using
StyleTextDecorationStyle
=
mozilla
:
:
StyleTextDecorationStyle
;
using
StyleSimpleShadow
=
mozilla
:
:
StyleSimpleShadow
;
public
:
explicit
nsTextPaintStyle
(
nsTextFrame
*
aFrame
)
;
void
SetResolveColors
(
bool
aResolveColors
)
{
mResolveColors
=
aResolveColors
;
}
nscolor
GetTextColor
(
)
;
nscolor
GetWebkitTextStrokeColor
(
)
;
float
GetWebkitTextStrokeWidth
(
)
;
bool
GetSelectionColors
(
nscolor
*
aForeColor
nscolor
*
aBackColor
)
;
void
GetHighlightColors
(
nscolor
*
aForeColor
nscolor
*
aBackColor
)
;
bool
GetCustomHighlightColors
(
const
nsAtom
*
aHighlightName
nscolor
*
aForeColor
nscolor
*
aBackColor
)
;
void
GetURLSecondaryColor
(
nscolor
*
aForeColor
)
;
void
GetIMESelectionColors
(
int32_t
aIndex
nscolor
*
aForeColor
nscolor
*
aBackColor
)
;
bool
GetSelectionUnderlineForPaint
(
int32_t
aIndex
nscolor
*
aLineColor
float
*
aRelativeSize
StyleTextDecorationStyle
*
aStyle
)
;
static
bool
GetSelectionUnderline
(
nsIFrame
*
int32_t
aIndex
nscolor
*
aLineColor
float
*
aRelativeSize
StyleTextDecorationStyle
*
aStyle
)
;
bool
GetSelectionShadow
(
mozilla
:
:
Span
<
const
StyleSimpleShadow
>
*
aShadows
)
;
nsPresContext
*
PresContext
(
)
const
{
return
mPresContext
;
}
enum
{
eIndexRawInput
=
0
eIndexSelRawText
eIndexConvText
eIndexSelConvText
eIndexSpellChecker
}
;
static
int32_t
GetUnderlineStyleIndexForSelectionType
(
SelectionType
aSelectionType
)
{
switch
(
aSelectionType
)
{
case
SelectionType
:
:
eIMERawClause
:
return
eIndexRawInput
;
case
SelectionType
:
:
eIMESelectedRawClause
:
return
eIndexSelRawText
;
case
SelectionType
:
:
eIMEConvertedClause
:
return
eIndexConvText
;
case
SelectionType
:
:
eIMESelectedClause
:
return
eIndexSelConvText
;
case
SelectionType
:
:
eSpellCheck
:
return
eIndexSpellChecker
;
default
:
NS_WARNING
(
"
non
-
IME
selection
type
"
)
;
return
eIndexRawInput
;
}
}
nscolor
GetSystemFieldForegroundColor
(
)
;
nscolor
GetSystemFieldBackgroundColor
(
)
;
protected
:
nsTextFrame
*
mFrame
;
nsPresContext
*
mPresContext
;
bool
mInitCommonColors
;
bool
mInitSelectionColorsAndShadow
;
bool
mResolveColors
;
nscolor
mSelectionTextColor
;
nscolor
mSelectionBGColor
;
RefPtr
<
ComputedStyle
>
mSelectionPseudoStyle
;
nsTHashMap
<
RefPtr
<
const
nsAtom
>
RefPtr
<
ComputedStyle
>
>
mCustomHighlightPseudoStyles
;
int32_t
mSufficientContrast
;
nscolor
mFrameBackgroundColor
;
nscolor
mSystemFieldForegroundColor
;
nscolor
mSystemFieldBackgroundColor
;
struct
nsSelectionStyle
{
bool
mInit
;
nscolor
mTextColor
;
nscolor
mBGColor
;
nscolor
mUnderlineColor
;
StyleTextDecorationStyle
mUnderlineStyle
;
float
mUnderlineRelativeSize
;
}
;
nsSelectionStyle
mSelectionStyle
[
5
]
;
void
InitCommonColors
(
)
;
bool
InitSelectionColorsAndShadow
(
)
;
nsSelectionStyle
*
GetSelectionStyle
(
int32_t
aIndex
)
;
void
InitSelectionStyle
(
int32_t
aIndex
)
;
bool
EnsureSufficientContrast
(
nscolor
*
aForeColor
nscolor
*
aBackColor
)
;
nscolor
GetResolvedForeColor
(
nscolor
aColor
nscolor
aDefaultForeColor
nscolor
aBackColor
)
;
}
;
#
endif
