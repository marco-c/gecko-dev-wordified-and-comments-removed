#
ifndef
mozilla_layout_ScrollAnimationPhysics_h_
#
define
mozilla_layout_ScrollAnimationPhysics_h_
#
include
"
mozilla
/
TimeStamp
.
h
"
#
include
"
nsPoint
.
h
"
#
include
"
nsSMILKeySpline
.
h
"
namespace
mozilla
{
struct
ScrollAnimationPhysicsSettings
{
int32_t
mMinMS
;
int32_t
mMaxMS
;
double
mIntervalRatio
;
}
;
class
ScrollAnimationPhysics
{
public
:
typedef
mozilla
:
:
TimeStamp
TimeStamp
;
typedef
mozilla
:
:
TimeDuration
TimeDuration
;
explicit
ScrollAnimationPhysics
(
nsPoint
aStartPos
const
ScrollAnimationPhysicsSettings
&
aSettings
)
;
void
Update
(
TimeStamp
aTime
nsPoint
aDestination
const
nsSize
&
aCurrentVelocity
)
;
nsSize
VelocityAt
(
TimeStamp
aTime
)
;
nsPoint
PositionAt
(
TimeStamp
aTime
)
;
bool
IsFinished
(
TimeStamp
aTime
)
{
return
aTime
>
mStartTime
+
mDuration
;
}
protected
:
double
ProgressAt
(
TimeStamp
aTime
)
const
{
return
clamped
(
(
aTime
-
mStartTime
)
/
mDuration
0
.
0
1
.
0
)
;
}
nscoord
VelocityComponent
(
double
aTimeProgress
const
nsSMILKeySpline
&
aTimingFunction
nscoord
aStart
nscoord
aDestination
)
const
;
TimeDuration
ComputeDuration
(
TimeStamp
aTime
)
;
void
InitTimingFunction
(
nsSMILKeySpline
&
aTimingFunction
nscoord
aCurrentPos
nscoord
aCurrentVelocity
nscoord
aDestination
)
;
void
InitializeHistory
(
TimeStamp
aTime
)
;
ScrollAnimationPhysicsSettings
mSettings
;
TimeStamp
mPrevEventTime
[
3
]
;
TimeStamp
mStartTime
;
nsPoint
mStartPos
;
nsPoint
mDestination
;
TimeDuration
mDuration
;
nsSMILKeySpline
mTimingFunctionX
;
nsSMILKeySpline
mTimingFunctionY
;
bool
mIsFirstIteration
;
}
;
static
inline
double
ComputeAcceleratedWheelDelta
(
double
aDelta
int32_t
aCounter
int32_t
aFactor
)
{
if
(
!
aDelta
)
{
return
aDelta
;
}
return
(
aDelta
*
aCounter
*
double
(
aFactor
)
/
10
)
;
}
static
const
uint32_t
kScrollSeriesTimeoutMs
=
80
;
}
#
endif
