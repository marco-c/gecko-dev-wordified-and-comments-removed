#
ifndef
nsIScrollFrame_h___
#
define
nsIScrollFrame_h___
#
include
"
nsCoord
.
h
"
#
include
"
DisplayItemClip
.
h
"
#
include
"
mozilla
/
Maybe
.
h
"
#
include
"
mozilla
/
ScrollStyles
.
h
"
#
include
"
mozilla
/
gfx
/
Point
.
h
"
#
include
"
nsIScrollbarMediator
.
h
"
#
include
"
Units
.
h
"
#
include
"
FrameMetrics
.
h
"
#
define
NS_DEFAULT_VERTICAL_SCROLL_DISTANCE
3
#
define
NS_DEFAULT_HORIZONTAL_SCROLL_DISTANCE
5
class
gfxContext
;
class
nsBoxLayoutState
;
class
nsIScrollPositionListener
;
class
nsIFrame
;
class
nsPresContext
;
class
nsIContent
;
class
nsAtom
;
class
nsDisplayListBuilder
;
namespace
mozilla
{
struct
ContainerLayerParameters
;
namespace
layers
{
struct
ScrollMetadata
;
class
Layer
;
class
LayerManager
;
}
namespace
layout
{
class
ScrollAnchorContainer
;
}
}
class
nsIScrollableFrame
:
public
nsIScrollbarMediator
{
public
:
typedef
mozilla
:
:
CSSIntPoint
CSSIntPoint
;
typedef
mozilla
:
:
ContainerLayerParameters
ContainerLayerParameters
;
typedef
mozilla
:
:
layers
:
:
ScrollSnapInfo
ScrollSnapInfo
;
typedef
mozilla
:
:
layout
:
:
ScrollAnchorContainer
ScrollAnchorContainer
;
NS_DECL_QUERYFRAME_TARGET
(
nsIScrollableFrame
)
virtual
nsIFrame
*
GetScrolledFrame
(
)
const
=
0
;
virtual
mozilla
:
:
ScrollStyles
GetScrollStyles
(
)
const
=
0
;
enum
{
HORIZONTAL
=
0x01
VERTICAL
=
0x02
}
;
virtual
uint32_t
GetScrollbarVisibility
(
)
const
=
0
;
uint32_t
GetPerceivedScrollingDirections
(
)
const
;
virtual
nsMargin
GetActualScrollbarSizes
(
)
const
=
0
;
virtual
nsMargin
GetDesiredScrollbarSizes
(
nsBoxLayoutState
*
aState
)
=
0
;
virtual
nsMargin
GetDesiredScrollbarSizes
(
nsPresContext
*
aPresContext
gfxContext
*
aRC
)
=
0
;
virtual
nscoord
GetNondisappearingScrollbarWidth
(
nsPresContext
*
aPresContext
gfxContext
*
aRC
mozilla
:
:
WritingMode
aWM
)
=
0
;
virtual
nsSize
GetLayoutSize
(
)
const
=
0
;
virtual
nsRect
GetScrolledRect
(
)
const
=
0
;
virtual
nsRect
GetScrollPortRect
(
)
const
=
0
;
virtual
nsPoint
GetScrollPosition
(
)
const
=
0
;
virtual
nsPoint
GetLogicalScrollPosition
(
)
const
=
0
;
virtual
nsPoint
GetApzScrollPosition
(
)
const
=
0
;
virtual
nsRect
GetScrollRange
(
)
const
=
0
;
virtual
nsSize
GetVisualViewportSize
(
)
const
=
0
;
virtual
nsPoint
GetVisualViewportOffset
(
)
const
=
0
;
virtual
nsSize
GetLineScrollAmount
(
)
const
=
0
;
virtual
nsSize
GetPageScrollAmount
(
)
const
=
0
;
enum
ScrollMode
{
INSTANT
SMOOTH
SMOOTH_MSD
NORMAL
}
;
enum
ScrollMomentum
{
NOT_MOMENTUM
SYNTHESIZED_MOMENTUM_EVENT
}
;
virtual
void
ScrollTo
(
nsPoint
aScrollPosition
ScrollMode
aMode
const
nsRect
*
aRange
=
nullptr
nsIScrollbarMediator
:
:
ScrollSnapMode
aSnap
=
nsIScrollbarMediator
:
:
DISABLE_SNAP
)
=
0
;
virtual
void
ScrollToCSSPixels
(
const
CSSIntPoint
&
aScrollPosition
nsIScrollableFrame
:
:
ScrollMode
aMode
=
nsIScrollableFrame
:
:
INSTANT
nsAtom
*
aOrigin
=
nullptr
)
=
0
;
virtual
void
ScrollToCSSPixelsApproximate
(
const
mozilla
:
:
CSSPoint
&
aScrollPosition
nsAtom
*
aOrigin
=
nullptr
)
=
0
;
virtual
CSSIntPoint
GetScrollPositionCSSPixels
(
)
=
0
;
enum
ScrollUnit
{
DEVICE_PIXELS
LINES
PAGES
WHOLE
}
;
virtual
void
ScrollBy
(
nsIntPoint
aDelta
ScrollUnit
aUnit
ScrollMode
aMode
nsIntPoint
*
aOverflow
=
nullptr
nsAtom
*
aOrigin
=
nullptr
ScrollMomentum
aMomentum
=
NOT_MOMENTUM
nsIScrollbarMediator
:
:
ScrollSnapMode
aSnap
=
nsIScrollbarMediator
:
:
DISABLE_SNAP
)
=
0
;
virtual
void
ScrollByCSSPixels
(
const
CSSIntPoint
&
aDelta
nsIScrollableFrame
:
:
ScrollMode
aMode
=
nsIScrollableFrame
:
:
INSTANT
nsAtom
*
aOrigin
=
nullptr
)
=
0
;
virtual
void
ScrollSnap
(
)
=
0
;
virtual
void
ScrollToRestoredPosition
(
)
=
0
;
virtual
void
AddScrollPositionListener
(
nsIScrollPositionListener
*
aListener
)
=
0
;
virtual
void
RemoveScrollPositionListener
(
nsIScrollPositionListener
*
aListener
)
=
0
;
virtual
void
CurPosAttributeChanged
(
nsIContent
*
aChild
)
=
0
;
NS_IMETHOD
PostScrolledAreaEventForCurrentArea
(
)
=
0
;
virtual
bool
IsScrollingActive
(
nsDisplayListBuilder
*
aBuilder
)
=
0
;
virtual
bool
IsMaybeAsynchronouslyScrolled
(
)
=
0
;
virtual
bool
IsMaybeScrollingActive
(
)
const
=
0
;
virtual
bool
IsProcessingAsyncScroll
(
)
=
0
;
virtual
void
ResetScrollPositionForLayerPixelAlignment
(
)
=
0
;
virtual
bool
DidHistoryRestore
(
)
const
=
0
;
virtual
void
ClearDidHistoryRestore
(
)
=
0
;
virtual
void
MarkEverScrolled
(
)
=
0
;
virtual
bool
IsRectNearlyVisible
(
const
nsRect
&
aRect
)
=
0
;
virtual
nsRect
ExpandRectToNearlyVisible
(
const
nsRect
&
aRect
)
const
=
0
;
virtual
nsAtom
*
LastScrollOrigin
(
)
=
0
;
virtual
nsAtom
*
LastSmoothScrollOrigin
(
)
=
0
;
virtual
uint32_t
CurrentScrollGeneration
(
)
=
0
;
virtual
nsPoint
LastScrollDestination
(
)
=
0
;
virtual
void
ResetScrollInfoIfGeneration
(
uint32_t
aGeneration
)
=
0
;
virtual
bool
WantAsyncScroll
(
)
const
=
0
;
virtual
mozilla
:
:
Maybe
<
mozilla
:
:
layers
:
:
ScrollMetadata
>
ComputeScrollMetadata
(
mozilla
:
:
layers
:
:
LayerManager
*
aLayerManager
const
nsIFrame
*
aContainerReferenceFrame
const
mozilla
:
:
Maybe
<
ContainerLayerParameters
>
&
aParameters
const
mozilla
:
:
DisplayItemClip
*
aClip
)
const
=
0
;
virtual
void
ClipLayerToDisplayPort
(
mozilla
:
:
layers
:
:
Layer
*
aLayer
const
mozilla
:
:
DisplayItemClip
*
aClip
const
ContainerLayerParameters
&
aParameters
)
const
=
0
;
virtual
void
MarkScrollbarsDirtyForReflow
(
)
const
=
0
;
virtual
void
SetTransformingByAPZ
(
bool
aTransforming
)
=
0
;
virtual
bool
IsTransformingByAPZ
(
)
const
=
0
;
virtual
void
SetScrollableByAPZ
(
bool
aScrollable
)
=
0
;
virtual
void
SetZoomableByAPZ
(
bool
aZoomable
)
=
0
;
virtual
void
SetHasOutOfFlowContentInsideFilter
(
)
=
0
;
virtual
bool
UsesContainerScrolling
(
)
const
=
0
;
virtual
bool
DecideScrollableLayer
(
nsDisplayListBuilder
*
aBuilder
nsRect
*
aVisibleRect
nsRect
*
aDirtyRect
bool
aSetBase
)
=
0
;
virtual
void
NotifyApzTransaction
(
)
=
0
;
virtual
void
NotifyApproximateFrameVisibilityUpdate
(
bool
aIgnoreDisplayPort
)
=
0
;
virtual
bool
GetDisplayPortAtLastApproximateFrameVisibilityUpdate
(
nsRect
*
aDisplayPort
)
=
0
;
virtual
void
TriggerDisplayPortExpiration
(
)
=
0
;
virtual
ScrollSnapInfo
GetScrollSnapInfo
(
)
const
=
0
;
virtual
bool
DragScroll
(
mozilla
:
:
WidgetEvent
*
aEvent
)
=
0
;
virtual
void
AsyncScrollbarDragInitiated
(
uint64_t
aDragBlockId
mozilla
:
:
layers
:
:
ScrollDirection
aDirection
)
=
0
;
virtual
void
AsyncScrollbarDragRejected
(
)
=
0
;
virtual
bool
IsRootScrollFrameOfDocument
(
)
const
=
0
;
virtual
const
ScrollAnchorContainer
*
Anchor
(
)
const
=
0
;
virtual
ScrollAnchorContainer
*
Anchor
(
)
=
0
;
virtual
bool
SmoothScrollVisual
(
const
nsPoint
&
aVisualViewportOffset
mozilla
:
:
layers
:
:
FrameMetrics
:
:
ScrollOffsetUpdateType
aUpdateType
)
=
0
;
}
;
#
endif
