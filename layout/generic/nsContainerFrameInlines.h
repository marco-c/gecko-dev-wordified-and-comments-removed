#
ifndef
nsContainerFrameInlines_h___
#
define
nsContainerFrameInlines_h___
#
include
"
nsContainerFrame
.
h
"
namespace
mozilla
{
namespace
detail
{
static
nscoord
GetCoord
(
const
LengthPercentage
&
aCoord
nscoord
aIfNotCoord
)
{
if
(
aCoord
.
ConvertsToLength
(
)
)
{
return
aCoord
.
ToLength
(
)
;
}
return
aIfNotCoord
;
}
static
nscoord
GetCoord
(
const
LengthPercentageOrAuto
&
aCoord
nscoord
aIfNotCoord
)
{
if
(
aCoord
.
IsAuto
(
)
)
{
return
aIfNotCoord
;
}
return
GetCoord
(
aCoord
.
AsLengthPercentage
(
)
aIfNotCoord
)
;
}
}
}
template
<
typename
ISizeData
typename
F
>
void
nsContainerFrame
:
:
DoInlineIntrinsicISize
(
ISizeData
*
aData
F
&
aHandleChildren
)
{
using
namespace
mozilla
;
using
mozilla
:
:
detail
:
:
GetCoord
;
if
(
GetPrevInFlow
(
)
)
return
;
WritingMode
wm
=
GetWritingMode
(
)
;
Side
startSide
=
wm
.
PhysicalSideForInlineAxis
(
eLogicalEdgeStart
)
;
Side
endSide
=
wm
.
PhysicalSideForInlineAxis
(
eLogicalEdgeEnd
)
;
const
nsStylePadding
*
stylePadding
=
StylePadding
(
)
;
const
nsStyleBorder
*
styleBorder
=
StyleBorder
(
)
;
const
nsStyleMargin
*
styleMargin
=
StyleMargin
(
)
;
nscoord
clonePBM
=
0
;
const
bool
sliceBreak
=
styleBorder
-
>
mBoxDecorationBreak
=
=
StyleBoxDecorationBreak
:
:
Slice
;
if
(
!
GetPrevContinuation
(
)
|
|
MOZ_UNLIKELY
(
!
sliceBreak
)
)
{
nscoord
startPBM
=
std
:
:
max
(
GetCoord
(
stylePadding
-
>
mPadding
.
Get
(
startSide
)
0
)
0
)
+
styleBorder
-
>
GetComputedBorderWidth
(
startSide
)
+
GetCoord
(
styleMargin
-
>
mMargin
.
Get
(
startSide
)
0
)
;
if
(
MOZ_LIKELY
(
sliceBreak
)
)
{
aData
-
>
mCurrentLine
+
=
startPBM
;
}
else
{
clonePBM
=
startPBM
;
}
}
nscoord
endPBM
=
std
:
:
max
(
GetCoord
(
stylePadding
-
>
mPadding
.
Get
(
endSide
)
0
)
0
)
+
styleBorder
-
>
GetComputedBorderWidth
(
endSide
)
+
GetCoord
(
styleMargin
-
>
mMargin
.
Get
(
endSide
)
0
)
;
if
(
MOZ_UNLIKELY
(
!
sliceBreak
)
)
{
clonePBM
+
=
endPBM
;
aData
-
>
mCurrentLine
+
=
clonePBM
;
}
const
nsLineList_iterator
*
savedLine
=
aData
-
>
mLine
;
nsIFrame
*
const
savedLineContainer
=
aData
-
>
LineContainer
(
)
;
nsContainerFrame
*
lastInFlow
;
for
(
nsContainerFrame
*
nif
=
this
;
nif
;
nif
=
static_cast
<
nsContainerFrame
*
>
(
nif
-
>
GetNextInFlow
(
)
)
)
{
if
(
aData
-
>
mCurrentLine
=
=
0
)
{
aData
-
>
mCurrentLine
=
clonePBM
;
}
aHandleChildren
(
nif
aData
)
;
aData
-
>
mLine
=
nullptr
;
aData
-
>
SetLineContainer
(
nullptr
)
;
lastInFlow
=
nif
;
}
aData
-
>
mLine
=
savedLine
;
aData
-
>
SetLineContainer
(
savedLineContainer
)
;
if
(
MOZ_LIKELY
(
!
lastInFlow
-
>
GetNextContinuation
(
)
&
&
sliceBreak
)
)
{
aData
-
>
mCurrentLine
+
=
endPBM
;
}
}
#
endif
