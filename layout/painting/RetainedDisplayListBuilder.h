#
ifndef
RETAINEDDISPLAYLISTBUILDER_H_
#
define
RETAINEDDISPLAYLISTBUILDER_H_
#
include
"
nsDisplayList
.
h
"
#
include
"
mozilla
/
Maybe
.
h
"
namespace
mozilla
{
class
DisplayListChecker
;
}
struct
RetainedDisplayListBuilder
{
RetainedDisplayListBuilder
(
nsIFrame
*
aReferenceFrame
nsDisplayListBuilderMode
aMode
bool
aBuildCaret
)
:
mBuilder
(
aReferenceFrame
aMode
aBuildCaret
true
)
{
}
~
RetainedDisplayListBuilder
(
)
{
mList
.
DeleteAll
(
&
mBuilder
)
;
}
nsDisplayListBuilder
*
Builder
(
)
{
return
&
mBuilder
;
}
nsDisplayList
*
List
(
)
{
return
&
mList
;
}
enum
class
PartialUpdateResult
{
Failed
NoChange
Updated
}
;
PartialUpdateResult
AttemptPartialUpdate
(
nscolor
aBackstop
mozilla
:
:
DisplayListChecker
*
aChecker
)
;
void
ClearFramesWithProps
(
)
;
NS_DECLARE_FRAME_PROPERTY_DELETABLE
(
Cached
RetainedDisplayListBuilder
)
private
:
bool
PreProcessDisplayList
(
RetainedDisplayList
*
aList
AnimatedGeometryRoot
*
aAGR
uint32_t
aCallerKey
=
0
uint32_t
aNestingDepth
=
0
)
;
bool
MergeDisplayLists
(
nsDisplayList
*
aNewList
RetainedDisplayList
*
aOldList
RetainedDisplayList
*
aOutList
mozilla
:
:
Maybe
<
const
mozilla
:
:
ActiveScrolledRoot
*
>
&
aOutContainerASR
uint32_t
aOuterKey
=
0
)
;
bool
ComputeRebuildRegion
(
nsTArray
<
nsIFrame
*
>
&
aModifiedFrames
nsRect
*
aOutDirty
AnimatedGeometryRoot
*
*
aOutModifiedAGR
nsTArray
<
nsIFrame
*
>
&
aOutFramesWithProps
)
;
bool
ProcessFrame
(
nsIFrame
*
aFrame
nsDisplayListBuilder
&
aBuilder
nsIFrame
*
aStopAtFrame
nsTArray
<
nsIFrame
*
>
&
aOutFramesWithProps
const
bool
aStopAtStackingContext
nsRect
*
aOutDirty
AnimatedGeometryRoot
*
*
aOutModifiedAGR
)
;
void
IncrementSubDocPresShellPaintCount
(
nsDisplayItem
*
aItem
)
;
friend
class
MergeState
;
nsDisplayListBuilder
mBuilder
;
RetainedDisplayList
mList
;
WeakFrame
mPreviousCaret
;
}
;
#
endif
