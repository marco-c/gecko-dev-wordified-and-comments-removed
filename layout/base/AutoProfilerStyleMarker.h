#
ifndef
mozilla_AutoProfilerStyleMarker_h
#
define
mozilla_AutoProfilerStyleMarker_h
#
include
"
mozilla
/
Attributes
.
h
"
#
include
"
mozilla
/
ServoTraversalStatistics
.
h
"
#
include
"
mozilla
/
TimeStamp
.
h
"
#
include
"
GeckoProfiler
.
h
"
#
include
"
ProfilerMarkerPayload
.
h
"
namespace
mozilla
{
class
MOZ_RAII
AutoProfilerStyleMarker
{
public
:
explicit
AutoProfilerStyleMarker
(
UniqueProfilerBacktrace
aCause
const
Maybe
<
nsID
>
&
aDocShellId
const
Maybe
<
uint32_t
>
&
aDocShellHistoryId
)
:
mActive
(
profiler_is_active
(
)
)
mStartTime
(
TimeStamp
:
:
Now
(
)
)
mCause
(
std
:
:
move
(
aCause
)
)
mDocShellId
(
aDocShellId
)
mDocShellHistoryId
(
aDocShellHistoryId
)
{
if
(
!
mActive
)
{
return
;
}
MOZ_ASSERT
(
!
ServoTraversalStatistics
:
:
sActive
"
Nested
AutoProfilerStyleMarker
"
)
;
ServoTraversalStatistics
:
:
sSingleton
=
ServoTraversalStatistics
(
)
;
ServoTraversalStatistics
:
:
sActive
=
true
;
}
~
AutoProfilerStyleMarker
(
)
{
if
(
!
mActive
)
{
return
;
}
ServoTraversalStatistics
:
:
sActive
=
false
;
profiler_add_marker
(
"
Styles
"
JS
:
:
ProfilingCategoryPair
:
:
LAYOUT
MakeUnique
<
StyleMarkerPayload
>
(
mStartTime
TimeStamp
:
:
Now
(
)
std
:
:
move
(
mCause
)
ServoTraversalStatistics
:
:
sSingleton
mDocShellId
mDocShellHistoryId
)
)
;
}
private
:
bool
mActive
;
TimeStamp
mStartTime
;
UniqueProfilerBacktrace
mCause
;
Maybe
<
nsID
>
mDocShellId
;
Maybe
<
uint32_t
>
mDocShellHistoryId
;
}
;
}
#
endif
