#
include
"
mozilla
/
PresShell
.
h
"
#
include
"
mozilla
/
ViewportUtils
.
h
"
#
include
"
mozilla
/
layers
/
APZCCallbackHelper
.
h
"
#
include
"
mozilla
/
layers
/
ScrollableLayerGuid
.
h
"
#
include
"
nsIContent
.
h
"
#
include
"
nsLayoutUtils
.
h
"
namespace
mozilla
{
using
layers
:
:
APZCCallbackHelper
;
using
layers
:
:
ScrollableLayerGuid
;
CSSToCSSMatrix4x4
ViewportUtils
:
:
GetCallbackTransform
(
ScrollableLayerGuid
:
:
ViewID
aScrollId
)
{
if
(
aScrollId
=
=
ScrollableLayerGuid
:
:
NULL_SCROLL_ID
)
{
return
{
}
;
}
nsCOMPtr
<
nsIContent
>
content
=
nsLayoutUtils
:
:
FindContentFor
(
aScrollId
)
;
if
(
!
content
)
{
return
{
}
;
}
float
resolution
=
1
.
0f
;
if
(
PresShell
*
presShell
=
APZCCallbackHelper
:
:
GetRootContentDocumentPresShellForContent
(
content
)
)
{
resolution
=
presShell
-
>
GetResolution
(
)
;
}
CSSPoint
transform
=
nsLayoutUtils
:
:
GetCumulativeApzCallbackTransform
(
content
-
>
GetPrimaryFrame
(
)
)
;
return
mozilla
:
:
CSSToCSSMatrix4x4
:
:
Scaling
(
1
/
resolution
1
/
resolution
1
)
.
PostTranslate
(
transform
.
x
transform
.
y
0
)
;
}
}
