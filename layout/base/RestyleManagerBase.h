#
ifndef
mozilla_RestyleManagerBase_h
#
define
mozilla_RestyleManagerBase_h
#
include
"
mozilla
/
OverflowChangedTracker
.
h
"
#
include
"
nsChangeHint
.
h
"
#
include
"
nsPresContext
.
h
"
class
nsCString
;
class
nsCSSFrameConstructor
;
class
nsStyleChangeList
;
namespace
mozilla
{
class
EventStates
;
class
RestyleManager
;
class
ServoRestyleManager
;
namespace
dom
{
class
Element
;
}
class
RestyleManagerBase
{
protected
:
explicit
RestyleManagerBase
(
nsPresContext
*
aPresContext
)
;
public
:
typedef
mozilla
:
:
dom
:
:
Element
Element
;
uint32_t
GetRestyleGeneration
(
)
const
{
return
mRestyleGeneration
;
}
uint32_t
GetHoverGeneration
(
)
const
{
return
mHoverGeneration
;
}
bool
ObservingRefreshDriver
(
)
const
{
return
mObservingRefreshDriver
;
}
void
SetObservingRefreshDriver
(
bool
aObserving
)
{
mObservingRefreshDriver
=
aObserving
;
}
void
Disconnect
(
)
{
mPresContext
=
nullptr
;
}
static
nsCString
RestyleHintToString
(
nsRestyleHint
aHint
)
;
#
ifdef
DEBUG
static
nsCString
ChangeHintToString
(
nsChangeHint
aHint
)
;
void
DebugVerifyStyleTree
(
nsIFrame
*
aFrame
)
;
#
endif
void
FlushOverflowChangedTracker
(
)
{
mOverflowChangedTracker
.
Flush
(
)
;
}
void
NotifyDestroyingFrame
(
nsIFrame
*
aFrame
)
{
mOverflowChangedTracker
.
RemoveFrame
(
aFrame
)
;
}
nsresult
ProcessRestyledFrames
(
nsStyleChangeList
&
aChangeList
)
;
bool
IsInStyleRefresh
(
)
const
{
return
mInStyleRefresh
;
}
protected
:
void
ContentStateChangedInternal
(
Element
*
aElement
EventStates
aStateMask
nsChangeHint
*
aOutChangeHint
nsRestyleHint
*
aOutRestyleHint
)
;
bool
IsDisconnected
(
)
{
return
mPresContext
=
=
nullptr
;
}
void
IncrementHoverGeneration
(
)
{
+
+
mHoverGeneration
;
}
void
IncrementRestyleGeneration
(
)
{
if
(
+
+
mRestyleGeneration
=
=
0
)
{
+
+
mRestyleGeneration
;
}
}
nsPresContext
*
PresContext
(
)
const
{
MOZ_ASSERT
(
mPresContext
)
;
return
mPresContext
;
}
nsCSSFrameConstructor
*
FrameConstructor
(
)
const
{
return
PresContext
(
)
-
>
FrameConstructor
(
)
;
}
inline
bool
IsGecko
(
)
const
{
return
!
IsServo
(
)
;
}
inline
bool
IsServo
(
)
const
{
#
ifdef
MOZ_STYLO
return
PresContext
(
)
-
>
StyleSet
(
)
-
>
IsServo
(
)
;
#
else
return
false
;
#
endif
}
private
:
nsPresContext
*
mPresContext
;
uint32_t
mRestyleGeneration
;
uint32_t
mHoverGeneration
;
bool
mObservingRefreshDriver
;
protected
:
bool
mInStyleRefresh
;
OverflowChangedTracker
mOverflowChangedTracker
;
void
PostRestyleEventInternal
(
bool
aForLazyConstruction
)
;
static
nsIFrame
*
GetNearestAncestorFrame
(
nsIContent
*
aContent
)
;
static
nsIFrame
*
GetNextBlockInInlineSibling
(
FramePropertyTable
*
aPropTable
nsIFrame
*
aFrame
)
;
static
nsIFrame
*
GetNextContinuationWithSameStyle
(
nsIFrame
*
aFrame
nsStyleContext
*
aOldStyleContext
bool
*
aHaveMoreContinuations
=
nullptr
)
;
}
;
}
#
endif
