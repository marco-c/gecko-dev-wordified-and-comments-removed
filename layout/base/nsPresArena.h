#
ifndef
nsPresArena_h___
#
define
nsPresArena_h___
#
include
"
mozilla
/
ArenaAllocator
.
h
"
#
include
"
mozilla
/
ArenaObjectID
.
h
"
#
include
"
mozilla
/
Assertions
.
h
"
#
include
"
mozilla
/
MemoryChecking
.
h
"
#
include
"
mozilla
/
MemoryReporting
.
h
"
#
include
<
stdint
.
h
>
#
include
"
nscore
.
h
"
#
include
"
nsDataHashtable
.
h
"
#
include
"
nsHashKeys
.
h
"
#
include
"
nsTArray
.
h
"
#
include
"
nsTHashtable
.
h
"
class
nsWindowSizes
;
template
<
size_t
ArenaSize
>
class
nsPresArena
{
public
:
nsPresArena
(
)
=
default
;
~
nsPresArena
(
)
;
void
*
AllocateByFrameID
(
nsQueryFrame
:
:
FrameIID
aID
size_t
aSize
)
{
return
Allocate
(
aID
aSize
)
;
}
void
FreeByFrameID
(
nsQueryFrame
:
:
FrameIID
aID
void
*
aPtr
)
{
Free
(
aID
aPtr
)
;
}
void
*
AllocateByObjectID
(
mozilla
:
:
ArenaObjectID
aID
size_t
aSize
)
{
return
Allocate
(
aID
aSize
)
;
}
void
FreeByObjectID
(
mozilla
:
:
ArenaObjectID
aID
void
*
aPtr
)
{
Free
(
aID
aPtr
)
;
}
void
*
AllocateByCustomID
(
uint32_t
aID
size_t
aSize
)
{
return
Allocate
(
aID
aSize
)
;
}
void
FreeByCustomID
(
uint32_t
aID
void
*
ptr
)
{
Free
(
aID
ptr
)
;
}
void
AddSizeOfExcludingThis
(
nsWindowSizes
&
size_t
nsWindowSizes
:
:
*
aArenaSize
)
const
;
void
Check
(
)
{
mPool
.
Check
(
)
;
}
private
:
void
*
Allocate
(
uint32_t
aCode
size_t
aSize
)
;
void
Free
(
uint32_t
aCode
void
*
aPtr
)
;
class
FreeList
{
public
:
nsTArray
<
void
*
>
mEntries
;
size_t
mEntrySize
;
size_t
mEntriesEverAllocated
;
FreeList
(
)
:
mEntrySize
(
0
)
mEntriesEverAllocated
(
0
)
{
}
size_t
SizeOfExcludingThis
(
mozilla
:
:
MallocSizeOf
aMallocSizeOf
)
const
{
return
mEntries
.
ShallowSizeOfExcludingThis
(
aMallocSizeOf
)
;
}
}
;
FreeList
mFreeLists
[
mozilla
:
:
eArenaObjectID_COUNT
]
;
mozilla
:
:
ArenaAllocator
<
ArenaSize
8
>
mPool
;
}
;
#
endif
