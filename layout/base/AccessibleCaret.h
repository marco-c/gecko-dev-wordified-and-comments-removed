#
ifndef
AccessibleCaret_h__
#
define
AccessibleCaret_h__
#
include
"
mozilla
/
Attributes
.
h
"
#
include
"
mozilla
/
dom
/
AnonymousContent
.
h
"
#
include
"
mozilla
/
dom
/
Element
.
h
"
#
include
"
nsCOMPtr
.
h
"
#
include
"
nsIDOMEventListener
.
h
"
#
include
"
nsISupportsBase
.
h
"
#
include
"
nsISupportsImpl
.
h
"
#
include
"
nsRect
.
h
"
#
include
"
mozilla
/
RefPtr
.
h
"
#
include
"
nsString
.
h
"
class
nsIDocument
;
class
nsIFrame
;
class
nsIPresShell
;
struct
nsPoint
;
namespace
mozilla
{
class
AccessibleCaret
{
public
:
explicit
AccessibleCaret
(
nsIPresShell
*
aPresShell
)
;
virtual
~
AccessibleCaret
(
)
;
enum
class
Appearance
:
uint8_t
{
None
Normal
NormalNotShown
Left
Right
}
;
friend
std
:
:
ostream
&
operator
<
<
(
std
:
:
ostream
&
aStream
const
Appearance
&
aAppearance
)
;
Appearance
GetAppearance
(
)
const
{
return
mAppearance
;
}
virtual
void
SetAppearance
(
Appearance
aAppearance
)
;
bool
IsLogicallyVisible
(
)
const
{
return
mAppearance
!
=
Appearance
:
:
None
;
}
bool
IsVisuallyVisible
(
)
const
{
return
(
mAppearance
!
=
Appearance
:
:
None
)
&
&
(
mAppearance
!
=
Appearance
:
:
NormalNotShown
)
;
}
virtual
void
SetSelectionBarEnabled
(
bool
aEnabled
)
;
enum
class
PositionChangedResult
:
uint8_t
{
NotChanged
Changed
Invisible
}
;
friend
std
:
:
ostream
&
operator
<
<
(
std
:
:
ostream
&
aStream
const
PositionChangedResult
&
aResult
)
;
virtual
PositionChangedResult
SetPosition
(
nsIFrame
*
aFrame
int32_t
aOffset
)
;
bool
Intersects
(
const
AccessibleCaret
&
aCaret
)
const
;
bool
Contains
(
const
nsPoint
&
aPoint
)
const
;
nsPoint
LogicalPosition
(
)
const
{
return
mImaginaryCaretRect
.
Center
(
)
;
}
dom
:
:
Element
*
CaretElement
(
)
const
{
return
mCaretElementHolder
-
>
GetContentNode
(
)
;
}
protected
:
void
SetCaretElementStyle
(
const
nsRect
&
aRect
float
aZoomLevel
)
;
void
SetSelectionBarElementStyle
(
const
nsRect
&
aRect
float
aZoomLevel
)
;
float
GetZoomLevel
(
)
;
dom
:
:
Element
*
CaretImageElement
(
)
const
{
return
CaretElement
(
)
-
>
GetFirstElementChild
(
)
;
}
dom
:
:
Element
*
SelectionBarElement
(
)
const
{
return
CaretElement
(
)
-
>
GetLastElementChild
(
)
;
}
nsIFrame
*
RootFrame
(
)
const
{
return
mPresShell
-
>
GetRootFrame
(
)
;
}
nsIFrame
*
CustomContentContainerFrame
(
)
const
;
static
nsString
AppearanceString
(
Appearance
aAppearance
)
;
already_AddRefed
<
dom
:
:
Element
>
CreateCaretElement
(
nsIDocument
*
aDocument
)
const
;
void
InjectCaretElement
(
nsIDocument
*
aDocument
)
;
void
RemoveCaretElement
(
nsIDocument
*
aDocument
)
;
static
nsPoint
CaretElementPosition
(
const
nsRect
&
aRect
)
{
return
aRect
.
TopLeft
(
)
+
nsPoint
(
aRect
.
width
/
2
0
)
;
}
class
DummyTouchListener
final
:
public
nsIDOMEventListener
{
public
:
NS_DECL_ISUPPORTS
NS_IMETHOD
HandleEvent
(
nsIDOMEvent
*
aEvent
)
override
{
return
NS_OK
;
}
private
:
virtual
~
DummyTouchListener
(
)
{
}
;
}
;
Appearance
mAppearance
=
Appearance
:
:
None
;
bool
mSelectionBarEnabled
=
false
;
nsIPresShell
*
MOZ_NON_OWNING_REF
const
mPresShell
=
nullptr
;
RefPtr
<
dom
:
:
AnonymousContent
>
mCaretElementHolder
;
nsRect
mImaginaryCaretRect
;
float
mZoomLevel
=
0
.
0f
;
RefPtr
<
DummyTouchListener
>
mDummyTouchListener
{
new
DummyTouchListener
(
)
}
;
static
float
sWidth
;
static
float
sHeight
;
static
float
sMarginLeft
;
static
float
sBarWidth
;
}
;
std
:
:
ostream
&
operator
<
<
(
std
:
:
ostream
&
aStream
const
AccessibleCaret
:
:
Appearance
&
aAppearance
)
;
std
:
:
ostream
&
operator
<
<
(
std
:
:
ostream
&
aStream
const
AccessibleCaret
:
:
PositionChangedResult
&
aResult
)
;
}
#
endif
