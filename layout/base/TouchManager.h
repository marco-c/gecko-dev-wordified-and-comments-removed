#
ifndef
TouchManager_h_
#
define
TouchManager_h_
#
include
"
mozilla
/
BasicEvents
.
h
"
#
include
"
mozilla
/
dom
/
Touch
.
h
"
#
include
"
mozilla
/
TouchEvents
.
h
"
#
include
"
nsRefPtrHashtable
.
h
"
namespace
mozilla
{
class
PresShell
;
class
TouchManager
{
public
:
static
void
InitializeStatics
(
)
;
static
void
ReleaseStatics
(
)
;
void
Init
(
PresShell
*
aPresShell
dom
:
:
Document
*
aDocument
)
;
void
Destroy
(
)
;
static
nsIFrame
*
SetupTarget
(
WidgetTouchEvent
*
aEvent
nsIFrame
*
aFrame
)
;
static
nsIFrame
*
SuppressInvalidPointsAndGetTargetedFrame
(
WidgetTouchEvent
*
aEvent
)
;
bool
PreHandleEvent
(
mozilla
:
:
WidgetEvent
*
aEvent
nsEventStatus
*
aStatus
bool
&
aTouchIsNew
nsCOMPtr
<
nsIContent
>
&
aCurrentEventContent
)
;
static
already_AddRefed
<
nsIContent
>
GetAnyCapturedTouchTarget
(
)
;
static
bool
HasCapturedTouch
(
int32_t
aId
)
;
static
already_AddRefed
<
dom
:
:
Touch
>
GetCapturedTouch
(
int32_t
aId
)
;
static
bool
ShouldConvertTouchToPointer
(
const
dom
:
:
Touch
*
aTouch
const
WidgetTouchEvent
*
aEvent
)
;
private
:
void
EvictTouches
(
)
;
static
void
EvictTouchPoint
(
RefPtr
<
dom
:
:
Touch
>
&
aTouch
dom
:
:
Document
*
aLimitToDocument
=
nullptr
)
;
static
void
AppendToTouchList
(
WidgetTouchEvent
:
:
TouchArray
*
aTouchList
)
;
RefPtr
<
PresShell
>
mPresShell
;
RefPtr
<
dom
:
:
Document
>
mDocument
;
struct
TouchInfo
{
RefPtr
<
mozilla
:
:
dom
:
:
Touch
>
mTouch
;
nsCOMPtr
<
nsIContent
>
mNonAnonymousTarget
;
bool
mConvertToPointer
;
}
;
static
nsDataHashtable
<
nsUint32HashKey
TouchInfo
>
*
sCaptureTouchList
;
}
;
}
#
endif
