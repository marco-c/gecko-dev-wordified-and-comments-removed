#
ifndef
nsChangeHint_h___
#
define
nsChangeHint_h___
#
include
"
mozilla
/
Types
.
h
"
#
include
"
nsDebug
.
h
"
#
include
"
nsTArray
.
h
"
enum
nsChangeHint
:
uint32_t
{
nsChangeHint_Empty
=
0
nsChangeHint_RepaintFrame
=
1
<
<
0
nsChangeHint_NeedReflow
=
1
<
<
1
nsChangeHint_ClearAncestorIntrinsics
=
1
<
<
2
nsChangeHint_ClearDescendantIntrinsics
=
1
<
<
3
nsChangeHint_NeedDirtyReflow
=
1
<
<
4
nsChangeHint_SyncFrameView
=
1
<
<
5
nsChangeHint_UpdateCursor
=
1
<
<
6
nsChangeHint_UpdateEffects
=
1
<
<
7
nsChangeHint_UpdateOpacityLayer
=
1
<
<
8
nsChangeHint_UpdateTransformLayer
=
1
<
<
9
nsChangeHint_ReconstructFrame
=
1
<
<
10
nsChangeHint_UpdateOverflow
=
1
<
<
11
nsChangeHint_UpdateSubtreeOverflow
=
1
<
<
12
nsChangeHint_UpdatePostTransformOverflow
=
1
<
<
13
nsChangeHint_UpdateParentOverflow
=
1
<
<
14
nsChangeHint_ChildrenOnlyTransform
=
1
<
<
15
nsChangeHint_RecomputePosition
=
1
<
<
16
nsChangeHint_UpdateContainingBlock
=
1
<
<
17
nsChangeHint_BorderStyleNoneChange
=
1
<
<
18
nsChangeHint_UpdateTextPath
=
1
<
<
19
nsChangeHint_SchedulePaint
=
1
<
<
20
nsChangeHint_NeutralChange
=
1
<
<
21
nsChangeHint_InvalidateRenderingObservers
=
1
<
<
22
nsChangeHint_ReflowChangesSizeOrPosition
=
1
<
<
23
nsChangeHint_UpdateComputedBSize
=
1
<
<
24
nsChangeHint_UpdateUsesOpacity
=
1
<
<
25
nsChangeHint_UpdateBackgroundPosition
=
1
<
<
26
nsChangeHint_AddOrRemoveTransform
=
1
<
<
27
nsChangeHint_CSSOverflowChange
=
1
<
<
28
nsChangeHint_UpdateWidgetProperties
=
1
<
<
29
nsChangeHint_UpdateTableCellSpans
=
1
<
<
30
nsChangeHint_VisibilityChange
=
1u
<
<
31
nsChangeHint_AllHints
=
uint32_t
(
(
1ull
<
<
32
)
-
1
)
}
;
inline
void
operator
<
(
nsChangeHint
s1
nsChangeHint
s2
)
{
}
inline
void
operator
>
(
nsChangeHint
s1
nsChangeHint
s2
)
{
}
inline
void
operator
!
=
(
nsChangeHint
s1
nsChangeHint
s2
)
{
}
inline
void
operator
=
=
(
nsChangeHint
s1
nsChangeHint
s2
)
{
}
inline
void
operator
<
=
(
nsChangeHint
s1
nsChangeHint
s2
)
{
}
inline
void
operator
>
=
(
nsChangeHint
s1
nsChangeHint
s2
)
{
}
inline
bool
NS_IsHintSubset
(
nsChangeHint
aSubset
nsChangeHint
aSuperSet
)
{
return
(
aSubset
&
aSuperSet
)
=
=
aSubset
;
}
typedef
decltype
(
nsChangeHint
(
0
)
+
nsChangeHint
(
0
)
)
nsChangeHint_size_t
;
inline
nsChangeHint
constexpr
operator
|
(
nsChangeHint
aLeft
nsChangeHint
aRight
)
{
return
nsChangeHint
(
nsChangeHint_size_t
(
aLeft
)
|
nsChangeHint_size_t
(
aRight
)
)
;
}
inline
nsChangeHint
constexpr
operator
&
(
nsChangeHint
aLeft
nsChangeHint
aRight
)
{
return
nsChangeHint
(
nsChangeHint_size_t
(
aLeft
)
&
nsChangeHint_size_t
(
aRight
)
)
;
}
inline
nsChangeHint
&
operator
|
=
(
nsChangeHint
&
aLeft
nsChangeHint
aRight
)
{
return
aLeft
=
aLeft
|
aRight
;
}
inline
nsChangeHint
&
operator
&
=
(
nsChangeHint
&
aLeft
nsChangeHint
aRight
)
{
return
aLeft
=
aLeft
&
aRight
;
}
inline
nsChangeHint
constexpr
operator
~
(
nsChangeHint
aArg
)
{
return
nsChangeHint
(
~
nsChangeHint_size_t
(
aArg
)
)
;
}
inline
nsChangeHint
constexpr
operator
^
(
nsChangeHint
aLeft
nsChangeHint
aRight
)
{
return
nsChangeHint
(
nsChangeHint_size_t
(
aLeft
)
^
nsChangeHint_size_t
(
aRight
)
)
;
}
inline
nsChangeHint
operator
^
=
(
nsChangeHint
&
aLeft
nsChangeHint
aRight
)
{
return
aLeft
=
aLeft
^
aRight
;
}
#
define
nsChangeHint_Hints_AlwaysHandledForDescendants
(
\
nsChangeHint_ClearDescendantIntrinsics
|
\
nsChangeHint_NeedDirtyReflow
|
\
nsChangeHint_NeutralChange
|
\
nsChangeHint_ReconstructFrame
|
\
nsChangeHint_RepaintFrame
|
\
nsChangeHint_SchedulePaint
|
\
nsChangeHint_SyncFrameView
|
\
nsChangeHint_UpdateCursor
|
\
nsChangeHint_UpdateSubtreeOverflow
|
\
nsChangeHint_UpdateTextPath
|
\
nsChangeHint_VisibilityChange
\
)
#
define
nsChangeHint_Hints_NeverHandledForDescendants
(
\
nsChangeHint_BorderStyleNoneChange
|
\
nsChangeHint_ChildrenOnlyTransform
|
\
nsChangeHint_CSSOverflowChange
|
\
nsChangeHint_InvalidateRenderingObservers
|
\
nsChangeHint_RecomputePosition
|
\
nsChangeHint_UpdateBackgroundPosition
|
\
nsChangeHint_UpdateComputedBSize
|
\
nsChangeHint_UpdateContainingBlock
|
\
nsChangeHint_UpdateEffects
|
\
nsChangeHint_UpdateOpacityLayer
|
\
nsChangeHint_UpdateOverflow
|
\
nsChangeHint_UpdateParentOverflow
|
\
nsChangeHint_UpdatePostTransformOverflow
|
\
nsChangeHint_UpdateTableCellSpans
|
\
nsChangeHint_UpdateTransformLayer
|
\
nsChangeHint_UpdateUsesOpacity
|
\
nsChangeHint_AddOrRemoveTransform
|
\
nsChangeHint_UpdateWidgetProperties
\
)
#
define
nsChangeHint_Hints_SometimesHandledForDescendants
(
\
nsChangeHint_ClearAncestorIntrinsics
|
\
nsChangeHint_NeedReflow
|
\
nsChangeHint_ReflowChangesSizeOrPosition
\
)
static_assert
(
!
(
nsChangeHint_Hints_AlwaysHandledForDescendants
&
nsChangeHint_Hints_NeverHandledForDescendants
)
&
&
!
(
nsChangeHint_Hints_AlwaysHandledForDescendants
&
nsChangeHint_Hints_SometimesHandledForDescendants
)
&
&
!
(
nsChangeHint_Hints_NeverHandledForDescendants
&
nsChangeHint_Hints_SometimesHandledForDescendants
)
&
&
!
(
nsChangeHint_AllHints
^
nsChangeHint_Hints_AlwaysHandledForDescendants
^
nsChangeHint_Hints_NeverHandledForDescendants
^
nsChangeHint_Hints_SometimesHandledForDescendants
)
"
change
hints
must
be
present
in
exactly
one
of
"
"
nsChangeHint_Hints_
{
Always
Never
Sometimes
}
"
"
HandledForDescendants
"
)
;
#
define
nsChangeHint_Hints_NotHandledForDescendants
(
\
nsChangeHint_Hints_NeverHandledForDescendants
|
\
nsChangeHint_Hints_SometimesHandledForDescendants
\
)
#
define
NS_STYLE_HINT_VISUAL
\
nsChangeHint
(
nsChangeHint_RepaintFrame
|
nsChangeHint_SyncFrameView
|
\
nsChangeHint_SchedulePaint
)
#
define
nsChangeHint_AllReflowHints
\
nsChangeHint
(
nsChangeHint_NeedReflow
|
\
nsChangeHint_ReflowChangesSizeOrPosition
|
\
nsChangeHint_ClearAncestorIntrinsics
|
\
nsChangeHint_ClearDescendantIntrinsics
|
\
nsChangeHint_NeedDirtyReflow
)
#
define
nsChangeHint_ReflowHintsForISizeChange
\
nsChangeHint
(
nsChangeHint_AllReflowHints
&
\
~
(
nsChangeHint_ClearDescendantIntrinsics
|
\
nsChangeHint_NeedDirtyReflow
)
)
#
define
nsChangeHint_ReflowHintsForBSizeChange
\
nsChangeHint
(
(
nsChangeHint_AllReflowHints
|
\
nsChangeHint_UpdateComputedBSize
)
&
\
~
(
nsChangeHint_ClearDescendantIntrinsics
|
\
nsChangeHint_NeedDirtyReflow
)
)
#
define
nsChangeHint_ReflowHintsForFloatAreaChange
\
nsChangeHint
(
nsChangeHint_AllReflowHints
&
\
~
(
nsChangeHint_ClearDescendantIntrinsics
|
\
nsChangeHint_NeedDirtyReflow
)
)
#
define
NS_STYLE_HINT_REFLOW
\
nsChangeHint
(
NS_STYLE_HINT_VISUAL
|
nsChangeHint_AllReflowHints
)
#
define
nsChangeHint_Hints_CanIgnoreIfNotVisible
\
nsChangeHint
(
NS_STYLE_HINT_VISUAL
|
\
nsChangeHint_NeutralChange
|
\
nsChangeHint_UpdateOpacityLayer
|
\
nsChangeHint_AddOrRemoveTransform
|
\
nsChangeHint_UpdateContainingBlock
|
\
nsChangeHint_UpdateOverflow
|
\
nsChangeHint_UpdatePostTransformOverflow
|
\
nsChangeHint_UpdateTransformLayer
|
\
nsChangeHint_UpdateUsesOpacity
|
\
nsChangeHint_VisibilityChange
)
#
define
nsChangeHint_ComprehensiveAddOrRemoveTransform
\
nsChangeHint
(
nsChangeHint_UpdateContainingBlock
|
\
nsChangeHint_AddOrRemoveTransform
|
\
nsChangeHint_UpdateOverflow
|
\
nsChangeHint_RepaintFrame
)
inline
nsChangeHint
NS_HintsNotHandledForDescendantsIn
(
nsChangeHint
aChangeHint
)
{
nsChangeHint
result
=
aChangeHint
&
nsChangeHint_Hints_NeverHandledForDescendants
;
if
(
!
NS_IsHintSubset
(
nsChangeHint_NeedDirtyReflow
aChangeHint
)
)
{
if
(
NS_IsHintSubset
(
nsChangeHint_NeedReflow
aChangeHint
)
)
{
result
|
=
nsChangeHint_NeedReflow
;
}
if
(
NS_IsHintSubset
(
nsChangeHint_ReflowChangesSizeOrPosition
aChangeHint
)
)
{
result
|
=
nsChangeHint_ReflowChangesSizeOrPosition
;
}
}
if
(
!
NS_IsHintSubset
(
nsChangeHint_ClearDescendantIntrinsics
aChangeHint
)
&
&
NS_IsHintSubset
(
nsChangeHint_ClearAncestorIntrinsics
aChangeHint
)
)
{
result
|
=
nsChangeHint_ClearAncestorIntrinsics
;
}
MOZ_ASSERT
(
NS_IsHintSubset
(
result
nsChangeHint_Hints_NotHandledForDescendants
)
"
something
is
inconsistent
"
)
;
return
result
;
}
inline
nsChangeHint
NS_HintsHandledForDescendantsIn
(
nsChangeHint
aChangeHint
)
{
return
aChangeHint
&
~
NS_HintsNotHandledForDescendantsIn
(
aChangeHint
)
;
}
inline
nsChangeHint
NS_RemoveSubsumedHints
(
nsChangeHint
aOurChange
nsChangeHint
aHintsHandled
)
{
nsChangeHint
result
=
aOurChange
&
~
NS_HintsHandledForDescendantsIn
(
aHintsHandled
)
;
if
(
result
&
(
nsChangeHint_ClearAncestorIntrinsics
|
nsChangeHint_ClearDescendantIntrinsics
|
nsChangeHint_NeedDirtyReflow
|
nsChangeHint_ReflowChangesSizeOrPosition
|
nsChangeHint_UpdateComputedBSize
)
)
{
result
|
=
nsChangeHint_NeedReflow
;
}
if
(
result
&
(
nsChangeHint_ClearDescendantIntrinsics
)
)
{
MOZ_ASSERT
(
result
&
nsChangeHint_ClearAncestorIntrinsics
)
;
result
|
=
nsChangeHint_NeedDirtyReflow
;
}
return
result
;
}
enum
nsRestyleHint
:
uint32_t
{
eRestyle_Self
=
1
<
<
0
eRestyle_SomeDescendants
=
1
<
<
1
eRestyle_Subtree
=
1
<
<
2
eRestyle_LaterSiblings
=
1
<
<
3
eRestyle_CSSTransitions
=
1
<
<
4
eRestyle_CSSAnimations
=
1
<
<
5
eRestyle_StyleAttribute
=
1
<
<
6
eRestyle_StyleAttribute_Animations
=
1
<
<
7
eRestyle_Force
=
1
<
<
8
eRestyle_ForceDescendants
=
1
<
<
9
eRestyle_AllHintsWithAnimations
=
eRestyle_CSSTransitions
|
eRestyle_CSSAnimations
|
eRestyle_StyleAttribute_Animations
}
;
typedef
decltype
(
nsRestyleHint
(
0
)
+
nsRestyleHint
(
0
)
)
nsRestyleHint_size_t
;
inline
constexpr
nsRestyleHint
operator
|
(
nsRestyleHint
aLeft
nsRestyleHint
aRight
)
{
return
nsRestyleHint
(
nsRestyleHint_size_t
(
aLeft
)
|
nsRestyleHint_size_t
(
aRight
)
)
;
}
inline
constexpr
nsRestyleHint
operator
&
(
nsRestyleHint
aLeft
nsRestyleHint
aRight
)
{
return
nsRestyleHint
(
nsRestyleHint_size_t
(
aLeft
)
&
nsRestyleHint_size_t
(
aRight
)
)
;
}
inline
nsRestyleHint
&
operator
|
=
(
nsRestyleHint
&
aLeft
nsRestyleHint
aRight
)
{
return
aLeft
=
aLeft
|
aRight
;
}
inline
nsRestyleHint
&
operator
&
=
(
nsRestyleHint
&
aLeft
nsRestyleHint
aRight
)
{
return
aLeft
=
aLeft
&
aRight
;
}
inline
constexpr
nsRestyleHint
operator
~
(
nsRestyleHint
aArg
)
{
return
nsRestyleHint
(
~
nsRestyleHint_size_t
(
aArg
)
)
;
}
inline
constexpr
nsRestyleHint
operator
^
(
nsRestyleHint
aLeft
nsRestyleHint
aRight
)
{
return
nsRestyleHint
(
nsRestyleHint_size_t
(
aLeft
)
^
nsRestyleHint_size_t
(
aRight
)
)
;
}
inline
nsRestyleHint
operator
^
=
(
nsRestyleHint
&
aLeft
nsRestyleHint
aRight
)
{
return
aLeft
=
aLeft
^
aRight
;
}
#
endif
