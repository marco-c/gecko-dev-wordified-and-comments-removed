import
mozunit
import
pytest
pytest
.
fixture
def
parse
(
get_reftest
normalize
)
:
    
output
=
pytest
.
importorskip
(
"
output
"
)
    
reftest
options
=
get_reftest
(
tests
=
[
"
dummy
"
]
)
    
reftest
.
_populate_logger
(
options
)
    
reftest
.
outputHandler
=
output
.
OutputHandler
(
        
reftest
.
log
options
.
utilityPath
options
.
symbolsPath
    
)
    
def
resolve
(
path
)
:
        
path
=
normalize
(
path
)
        
return
f
"
file
:
/
/
{
path
}
"
    
def
inner
(
*
manifests
)
:
        
assert
len
(
manifests
)
>
0
        
manifests
=
{
m
:
(
None
"
id
"
)
for
m
in
map
(
resolve
manifests
)
}
        
return
reftest
.
getActiveTests
(
manifests
options
)
    
return
inner
def
test_parse_test_types
(
parse
)
:
    
tests
=
parse
(
"
types
.
list
"
)
    
assert
tests
[
0
]
[
"
type
"
]
=
=
"
=
=
"
    
assert
tests
[
1
]
[
"
type
"
]
=
=
"
!
=
"
    
assert
tests
[
2
]
[
"
type
"
]
=
=
"
load
"
    
assert
tests
[
3
]
[
"
type
"
]
=
=
"
script
"
    
assert
tests
[
4
]
[
"
type
"
]
=
=
"
print
"
def
test_parse_failure_type_interactions
(
parse
)
:
    
"
"
"
Tests
interactions
between
skip
and
fails
.
"
"
"
    
tests
=
parse
(
"
failure
-
type
-
interactions
.
list
"
)
    
for
t
in
tests
:
        
if
"
skip
"
in
t
[
"
name
"
]
:
            
assert
t
[
"
skip
"
]
        
else
:
            
assert
not
t
[
"
skip
"
]
        
if
"
fails
"
in
t
[
"
name
"
]
:
            
assert
t
[
"
expected
"
]
=
=
1
        
else
:
            
assert
t
[
"
expected
"
]
=
=
0
def
test_parse_invalid_manifests
(
parse
)
:
    
with
pytest
.
raises
(
SystemExit
)
:
        
parse
(
"
invalid
-
defaults
.
list
"
)
    
with
pytest
.
raises
(
SystemExit
)
:
        
parse
(
"
invalid
-
defaults
-
include
.
list
"
)
    
with
pytest
.
raises
(
SystemExit
)
:
        
parse
(
"
invalid
-
include
.
list
"
)
if
__name__
=
=
"
__main__
"
:
    
mozunit
.
main
(
)
