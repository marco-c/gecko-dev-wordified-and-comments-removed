from
__future__
import
absolute_import
from
__future__
import
print_function
import
buildconfig
import
mozpack
.
path
as
mozpath
import
os
import
shlex
import
subprocess
def
main
(
output
input_asm
ffi_h
ffi_config_h
defines
includes
)
:
    
defines
=
shlex
.
split
(
defines
)
    
includes
=
shlex
.
split
(
includes
)
    
cpp
=
buildconfig
.
substs
[
'
CPP
'
]
+
[
'
-
EP
'
]
+
[
'
-
TC
'
]
    
input_asm
=
mozpath
.
relpath
(
input_asm
os
.
getcwd
(
)
)
    
args
=
cpp
+
defines
+
includes
+
[
input_asm
]
    
print
(
'
'
.
join
(
args
)
)
    
preprocessed
=
subprocess
.
check_output
(
args
)
    
output
.
write
(
preprocessed
)
