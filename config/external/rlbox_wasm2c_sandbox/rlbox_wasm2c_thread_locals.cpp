#
ifdef
MOZ_USING_WASM_SANDBOXING
#
include
"
mozilla
/
Assertions
.
h
"
#
include
"
mozilla
/
mozalloc_oom
.
h
"
#
include
"
mozilla
/
rlbox
/
rlbox_config
.
h
"
#
include
"
mozilla
/
rlbox
/
rlbox_wasm2c_tls
.
hpp
"
#
include
"
wasm
-
rt
.
h
"
#
ifndef
WASM_RT_GROW_FAILED_CRASH
#
include
"
nsExceptionHandler
.
h
"
#
endif
RLBOX_WASM2C_SANDBOX_STATIC_VARIABLES
(
)
;
extern
"
C
"
{
void
moz_wasm2c_trap_handler
(
wasm_rt_trap_t
code
)
{
MOZ_CRASH_UNSAFE_PRINTF
(
"
wasm2c
crash
:
%
s
"
wasm_rt_strerror
(
code
)
)
;
}
void
moz_wasm2c_memgrow_failed
(
)
{
#
ifdef
WASM_RT_GROW_FAILED_CRASH
MOZ_CRASH
(
"
wasm2c
memory
grow
failed
"
)
;
#
else
CrashReporter
:
:
AnnotateCrashReport
(
CrashReporter
:
:
Annotation
:
:
WasmLibrarySandboxMallocFailed
true
)
;
#
endif
}
void
w2c_env_mozalloc_handle_oom
(
void
*
ctx
uint32_t
size
)
{
mozalloc_handle_oom
(
size
)
;
}
}
#
endif
