const
{
Async
}
=
ChromeUtils
.
importESModule
(
"
resource
:
/
/
services
-
common
/
async
.
sys
.
mjs
"
)
;
function
run_test
(
)
{
_
(
"
Chain
a
few
async
methods
making
sure
the
'
this
'
object
is
correct
.
"
)
;
let
methods
=
{
save
(
x
callback
)
{
this
.
x
=
x
;
callback
(
x
)
;
}
addX
(
x
callback
)
{
callback
(
x
+
this
.
x
)
;
}
double
(
x
callback
)
{
callback
(
x
*
2
)
;
}
neg
(
x
callback
)
{
callback
(
-
x
)
;
}
}
;
methods
.
chain
=
Async
.
chain
;
methods
.
chain
(
methods
.
save
methods
.
addX
methods
.
addX
methods
.
neg
methods
.
addX
methods
.
double
methods
.
addX
methods
.
save
)
(
1
)
;
Assert
.
equal
(
methods
.
x
-
3
)
;
}
