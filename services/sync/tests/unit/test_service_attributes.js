const
{
Service
}
=
ChromeUtils
.
import
(
"
resource
:
/
/
services
-
sync
/
service
.
js
"
)
;
const
{
FakeGUIDService
}
=
ChromeUtils
.
import
(
"
resource
:
/
/
testing
-
common
/
services
/
sync
/
fakeservices
.
js
"
)
;
add_task
(
async
function
test_urls
(
)
{
_
(
"
URL
related
Service
properties
correspond
to
preference
settings
.
"
)
;
try
{
Assert
.
equal
(
Service
.
clusterURL
"
"
)
;
Assert
.
ok
(
!
Service
.
userBaseURL
)
;
Assert
.
equal
(
Service
.
infoURL
undefined
)
;
Assert
.
equal
(
Service
.
storageURL
undefined
)
;
Assert
.
equal
(
Service
.
metaURL
undefined
)
;
_
(
"
The
'
clusterURL
'
attribute
updates
preferences
and
cached
URLs
.
"
)
;
Assert
.
equal
(
Service
.
infoURL
undefined
)
;
Assert
.
ok
(
!
Service
.
userBaseURL
)
;
Assert
.
equal
(
Service
.
storageURL
undefined
)
;
Assert
.
equal
(
Service
.
metaURL
undefined
)
;
Service
.
clusterURL
=
"
http
:
/
/
weave
.
cluster
/
1
.
1
/
johndoe
/
"
;
Assert
.
equal
(
Service
.
userBaseURL
"
http
:
/
/
weave
.
cluster
/
1
.
1
/
johndoe
/
"
)
;
Assert
.
equal
(
Service
.
infoURL
"
http
:
/
/
weave
.
cluster
/
1
.
1
/
johndoe
/
info
/
collections
"
)
;
Assert
.
equal
(
Service
.
storageURL
"
http
:
/
/
weave
.
cluster
/
1
.
1
/
johndoe
/
storage
/
"
)
;
Assert
.
equal
(
Service
.
metaURL
"
http
:
/
/
weave
.
cluster
/
1
.
1
/
johndoe
/
storage
/
meta
/
global
"
)
;
}
finally
{
Svc
.
Prefs
.
resetBranch
(
"
"
)
;
}
}
)
;
add_test
(
function
test_syncID
(
)
{
_
(
"
Service
.
syncID
is
auto
-
generated
corresponds
to
preference
.
"
)
;
new
FakeGUIDService
(
)
;
try
{
Assert
.
equal
(
Svc
.
Prefs
.
get
(
"
client
.
syncID
"
)
undefined
)
;
Assert
.
equal
(
Service
.
syncID
"
fake
-
guid
-
00
"
)
;
Assert
.
equal
(
Svc
.
Prefs
.
get
(
"
client
.
syncID
"
)
"
fake
-
guid
-
00
"
)
;
Svc
.
Prefs
.
set
(
"
client
.
syncID
"
Utils
.
makeGUID
(
)
)
;
Assert
.
equal
(
Svc
.
Prefs
.
get
(
"
client
.
syncID
"
)
"
fake
-
guid
-
01
"
)
;
Assert
.
equal
(
Service
.
syncID
"
fake
-
guid
-
01
"
)
;
}
finally
{
Svc
.
Prefs
.
resetBranch
(
"
"
)
;
new
FakeGUIDService
(
)
;
run_next_test
(
)
;
}
}
)
;
add_test
(
function
test_locked
(
)
{
_
(
"
The
'
locked
'
attribute
can
be
toggled
with
lock
(
)
and
unlock
(
)
"
)
;
Assert
.
equal
(
Service
.
locked
false
)
;
Assert
.
equal
(
Service
.
lock
(
)
true
)
;
Assert
.
equal
(
Service
.
locked
true
)
;
Assert
.
equal
(
Service
.
lock
(
)
false
)
;
Service
.
unlock
(
)
;
Assert
.
equal
(
Service
.
locked
false
)
;
run_next_test
(
)
;
}
)
;
