"
use
strict
"
;
var
EXPORTED_SYMBOLS
=
[
"
initializeIdentityWithTokenServerResponse
"
]
;
const
{
Log
}
=
ChromeUtils
.
import
(
"
resource
:
/
/
gre
/
modules
/
Log
.
jsm
"
)
;
const
{
Weave
}
=
ChromeUtils
.
import
(
"
resource
:
/
/
services
-
sync
/
main
.
js
"
)
;
const
{
SyncAuthManager
}
=
ChromeUtils
.
import
(
"
resource
:
/
/
services
-
sync
/
sync_auth
.
js
"
)
;
const
{
TokenServerClient
}
=
ChromeUtils
.
import
(
"
resource
:
/
/
services
-
common
/
tokenserverclient
.
js
"
)
;
const
{
configureFxAccountIdentity
}
=
ChromeUtils
.
import
(
"
resource
:
/
/
testing
-
common
/
services
/
sync
/
utils
.
js
"
)
;
var
initializeIdentityWithTokenServerResponse
=
function
(
response
)
{
let
requestLog
=
Log
.
repository
.
getLogger
(
"
testing
.
mock
-
rest
"
)
;
if
(
!
requestLog
.
appenders
.
length
)
{
requestLog
.
addAppender
(
new
Log
.
DumpAppender
(
)
)
;
requestLog
.
level
=
Log
.
Level
.
Trace
;
}
function
MockRESTRequest
(
url
)
{
}
MockRESTRequest
.
prototype
=
{
_log
:
requestLog
setHeader
(
)
{
}
async
get
(
)
{
this
.
response
=
response
;
return
response
;
}
}
;
function
MockTSC
(
)
{
}
MockTSC
.
prototype
=
new
TokenServerClient
(
)
;
MockTSC
.
prototype
.
constructor
=
MockTSC
;
MockTSC
.
prototype
.
newRESTRequest
=
function
(
url
)
{
return
new
MockRESTRequest
(
url
)
;
}
;
MockTSC
.
prototype
.
observerPrefix
=
"
weave
:
service
"
;
Weave
.
Status
.
__authManager
=
Weave
.
Service
.
identity
=
new
SyncAuthManager
(
)
;
let
syncAuthManager
=
Weave
.
Service
.
identity
;
if
(
!
(
syncAuthManager
instanceof
SyncAuthManager
)
)
{
throw
new
Error
(
"
sync
isn
'
t
configured
to
use
sync_auth
"
)
;
}
let
mockTSC
=
new
MockTSC
(
)
;
configureFxAccountIdentity
(
syncAuthManager
)
;
syncAuthManager
.
_tokenServerClient
=
mockTSC
;
}
;
