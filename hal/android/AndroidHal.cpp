#
include
"
Hal
.
h
"
#
include
"
HalImpl
.
h
"
#
include
"
WindowIdentifier
.
h
"
#
include
"
AndroidBridge
.
h
"
#
include
"
mozilla
/
dom
/
network
/
Constants
.
h
"
#
include
"
mozilla
/
java
/
GeckoAppShellWrappers
.
h
"
#
include
"
mozilla
/
java
/
GeckoRuntimeWrappers
.
h
"
#
include
"
mozilla
/
widget
/
ScreenManager
.
h
"
#
include
"
nsPIDOMWindow
.
h
"
using
namespace
mozilla
:
:
dom
;
using
namespace
mozilla
:
:
hal
;
namespace
java
=
mozilla
:
:
java
;
namespace
mozilla
{
namespace
hal_impl
{
void
Vibrate
(
const
nsTArray
<
uint32_t
>
&
pattern
WindowIdentifier
&
&
)
{
bool
allZero
=
true
;
for
(
uint32_t
i
=
0
;
i
<
pattern
.
Length
(
)
;
i
+
+
)
{
if
(
pattern
[
i
]
!
=
0
)
{
allZero
=
false
;
break
;
}
}
if
(
allZero
)
{
hal_impl
:
:
CancelVibrate
(
WindowIdentifier
(
)
)
;
return
;
}
AndroidBridge
*
b
=
AndroidBridge
:
:
Bridge
(
)
;
if
(
!
b
)
{
return
;
}
b
-
>
Vibrate
(
pattern
)
;
}
void
CancelVibrate
(
WindowIdentifier
&
&
)
{
java
:
:
GeckoAppShell
:
:
CancelVibrate
(
)
;
}
void
EnableBatteryNotifications
(
)
{
java
:
:
GeckoAppShell
:
:
EnableBatteryNotifications
(
)
;
}
void
DisableBatteryNotifications
(
)
{
java
:
:
GeckoAppShell
:
:
DisableBatteryNotifications
(
)
;
}
void
GetCurrentBatteryInformation
(
hal
:
:
BatteryInformation
*
aBatteryInfo
)
{
AndroidBridge
:
:
Bridge
(
)
-
>
GetCurrentBatteryInformation
(
aBatteryInfo
)
;
}
void
EnableNetworkNotifications
(
)
{
java
:
:
GeckoAppShell
:
:
EnableNetworkNotifications
(
)
;
}
void
DisableNetworkNotifications
(
)
{
java
:
:
GeckoAppShell
:
:
DisableNetworkNotifications
(
)
;
}
void
GetCurrentNetworkInformation
(
hal
:
:
NetworkInformation
*
aNetworkInfo
)
{
AndroidBridge
:
:
Bridge
(
)
-
>
GetCurrentNetworkInformation
(
aNetworkInfo
)
;
}
void
EnableScreenConfigurationNotifications
(
)
{
java
:
:
GeckoAppShell
:
:
EnableScreenOrientationNotifications
(
)
;
}
void
DisableScreenConfigurationNotifications
(
)
{
java
:
:
GeckoAppShell
:
:
DisableScreenOrientationNotifications
(
)
;
}
void
GetCurrentScreenConfiguration
(
ScreenConfiguration
*
aScreenConfiguration
)
{
AndroidBridge
*
bridge
=
AndroidBridge
:
:
Bridge
(
)
;
if
(
!
bridge
)
{
return
;
}
RefPtr
<
widget
:
:
Screen
>
screen
=
widget
:
:
ScreenManager
:
:
GetSingleton
(
)
.
GetPrimaryScreen
(
)
;
*
aScreenConfiguration
=
screen
-
>
ToScreenConfiguration
(
)
;
aScreenConfiguration
-
>
orientation
(
)
=
static_cast
<
hal
:
:
ScreenOrientation
>
(
bridge
-
>
GetScreenOrientation
(
)
)
;
aScreenConfiguration
-
>
angle
(
)
=
bridge
-
>
GetScreenAngle
(
)
;
}
RefPtr
<
MozPromise
<
bool
bool
false
>
>
LockScreenOrientation
(
const
hal
:
:
ScreenOrientation
&
aOrientation
)
{
switch
(
aOrientation
)
{
case
eScreenOrientation_PortraitPrimary
:
case
eScreenOrientation_PortraitSecondary
:
case
eScreenOrientation_PortraitPrimary
|
eScreenOrientation_PortraitSecondary
:
case
eScreenOrientation_LandscapePrimary
:
case
eScreenOrientation_LandscapeSecondary
:
case
eScreenOrientation_LandscapePrimary
|
eScreenOrientation_LandscapeSecondary
:
case
eScreenOrientation_PortraitPrimary
|
eScreenOrientation_PortraitSecondary
|
eScreenOrientation_LandscapePrimary
|
eScreenOrientation_LandscapeSecondary
:
case
eScreenOrientation_Default
:
{
java
:
:
GeckoRuntime
:
:
LocalRef
runtime
=
java
:
:
GeckoRuntime
:
:
GetInstance
(
)
;
if
(
runtime
!
=
NULL
)
{
auto
result
=
runtime
-
>
LockScreenOrientation
(
aOrientation
)
;
auto
geckoResult
=
java
:
:
GeckoResult
:
:
LocalRef
(
std
:
:
move
(
result
)
)
;
return
geckoResult
?
MozPromise
<
bool
bool
false
>
:
:
FromGeckoResult
(
geckoResult
)
:
MozPromise
<
bool
bool
false
>
:
:
CreateAndReject
(
false
__func__
)
;
}
else
{
return
MozPromise
<
bool
bool
false
>
:
:
CreateAndReject
(
false
__func__
)
;
}
}
default
:
NS_WARNING
(
"
Unsupported
screen
orientation
type
"
)
;
return
MozPromise
<
bool
bool
false
>
:
:
CreateAndReject
(
false
__func__
)
;
}
}
void
UnlockScreenOrientation
(
)
{
java
:
:
GeckoRuntime
:
:
LocalRef
runtime
=
java
:
:
GeckoRuntime
:
:
GetInstance
(
)
;
if
(
runtime
!
=
NULL
)
{
runtime
-
>
UnlockScreenOrientation
(
)
;
}
}
}
}
