#
include
"
nsImageModule
.
h
"
#
include
"
mozilla
/
ModuleUtils
.
h
"
#
include
"
DecodePool
.
h
"
#
include
"
ImageFactory
.
h
"
#
include
"
ShutdownTracker
.
h
"
#
include
"
SurfaceCache
.
h
"
#
include
"
gfxPrefs
.
h
"
#
include
"
imgLoader
.
h
"
using
namespace
mozilla
:
:
image
;
static
bool
sInitialized
=
false
;
nsresult
mozilla
:
:
image
:
:
EnsureModuleInitialized
(
)
{
MOZ_ASSERT
(
NS_IsMainThread
(
)
)
;
if
(
sInitialized
)
{
return
NS_OK
;
}
gfxPrefs
:
:
GetSingleton
(
)
;
mozilla
:
:
image
:
:
ShutdownTracker
:
:
Initialize
(
)
;
mozilla
:
:
image
:
:
ImageFactory
:
:
Initialize
(
)
;
mozilla
:
:
image
:
:
DecodePool
:
:
Initialize
(
)
;
mozilla
:
:
image
:
:
SurfaceCache
:
:
Initialize
(
)
;
imgLoader
:
:
GlobalInit
(
)
;
sInitialized
=
true
;
return
NS_OK
;
}
void
mozilla
:
:
image
:
:
ShutdownModule
(
)
{
if
(
!
sInitialized
)
{
return
;
}
imgLoader
:
:
Shutdown
(
)
;
mozilla
:
:
image
:
:
SurfaceCache
:
:
Shutdown
(
)
;
sInitialized
=
false
;
}
