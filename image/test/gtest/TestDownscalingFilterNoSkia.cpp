#
include
"
gtest
/
gtest
.
h
"
#
include
"
mozilla
/
gfx
/
2D
.
h
"
#
include
"
Decoder
.
h
"
#
include
"
DecoderFactory
.
h
"
#
include
"
SourceBuffer
.
h
"
#
include
"
SurfacePipe
.
h
"
#
define
DownscalingFilter
DownscalingFilterNoSkia
#
ifdef
MOZ_ENABLE_SKIA
#
undef
MOZ_ENABLE_SKIA
#
include
"
Common
.
h
"
#
include
"
DownscalingFilter
.
h
"
#
define
MOZ_ENABLE_SKIA
#
else
#
include
"
Common
.
h
"
#
include
"
DownscalingFilter
.
h
"
#
endif
#
undef
DownscalingFilter
using
namespace
mozilla
;
using
namespace
mozilla
:
:
gfx
;
using
namespace
mozilla
:
:
image
;
TEST
(
ImageDownscalingFilter
NoSkia
)
{
RefPtr
<
image
:
:
Decoder
>
decoder
=
CreateTrivialDecoder
(
)
;
ASSERT_TRUE
(
bool
(
decoder
)
)
;
AssertConfiguringPipelineFails
(
decoder
DownscalingConfig
{
IntSize
(
100
100
)
SurfaceFormat
:
:
OS_RGBA
}
SurfaceConfig
{
decoder
IntSize
(
50
50
)
SurfaceFormat
:
:
OS_RGBA
false
}
)
;
}
