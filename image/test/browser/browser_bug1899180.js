add_task
(
async
function
test
(
)
{
function
httpURL
(
filename
)
{
let
chromeURL
=
getRootDirectory
(
gTestPath
)
+
filename
;
return
chromeURL
.
replace
(
"
chrome
:
/
/
mochitests
/
content
/
"
"
http
:
/
/
mochi
.
test
:
8888
/
"
)
;
}
let
win
=
await
BrowserTestUtils
.
openNewBrowserWindow
(
{
private
:
true
}
)
;
let
tab
=
(
win
.
gBrowser
.
selectedTab
=
BrowserTestUtils
.
addTab
(
win
.
gBrowser
"
about
:
blank
"
)
)
;
await
BrowserTestUtils
.
browserLoaded
(
tab
.
linkedBrowser
)
;
const
pageUrl
=
httpURL
(
"
helper1899180
.
html
"
)
;
BrowserTestUtils
.
startLoadingURIString
(
tab
.
linkedBrowser
pageUrl
)
;
await
BrowserTestUtils
.
browserLoaded
(
tab
.
linkedBrowser
)
;
await
new
Promise
(
resolve
=
>
{
waitForFocus
(
resolve
win
)
;
}
)
;
await
new
Promise
(
r
=
>
requestAnimationFrame
(
r
)
)
;
await
new
Promise
(
r
=
>
requestAnimationFrame
(
r
)
)
;
await
BrowserTestUtils
.
closeWindow
(
win
)
;
win
=
null
;
tab
=
null
;
ok
(
true
"
we
got
here
and
didn
'
t
crash
/
assert
"
)
;
}
)
;
