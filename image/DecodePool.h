#
ifndef
mozilla_image_DecodePool_h
#
define
mozilla_image_DecodePool_h
#
include
"
mozilla
/
Mutex
.
h
"
#
include
"
mozilla
/
StaticPtr
.
h
"
#
include
"
nsCOMArray
.
h
"
#
include
"
nsCOMPtr
.
h
"
#
include
"
nsIEventTarget
.
h
"
#
include
"
nsIObserver
.
h
"
#
include
"
mozilla
/
RefPtr
.
h
"
class
nsIThread
;
class
nsIThreadPool
;
namespace
mozilla
{
namespace
image
{
class
Decoder
;
class
DecodePoolImpl
;
class
IDecodingTask
;
class
DecodePool
:
public
nsIObserver
{
public
:
NS_DECL_THREADSAFE_ISUPPORTS
NS_DECL_NSIOBSERVER
static
void
Initialize
(
)
;
static
DecodePool
*
Singleton
(
)
;
static
uint32_t
NumberOfCores
(
)
;
void
AsyncRun
(
IDecodingTask
*
aTask
)
;
bool
SyncRunIfPreferred
(
IDecodingTask
*
aTask
)
;
void
SyncRunIfPossible
(
IDecodingTask
*
aTask
)
;
already_AddRefed
<
nsIEventTarget
>
GetIOEventTarget
(
)
;
private
:
friend
class
DecodePoolWorker
;
DecodePool
(
)
;
virtual
~
DecodePool
(
)
;
static
StaticRefPtr
<
DecodePool
>
sSingleton
;
static
uint32_t
sNumCores
;
RefPtr
<
DecodePoolImpl
>
mImpl
;
Mutex
mMutex
;
nsTArray
<
nsCOMPtr
<
nsIThread
>
>
mThreads
;
nsCOMPtr
<
nsIThread
>
mIOThread
;
}
;
}
}
#
endif
