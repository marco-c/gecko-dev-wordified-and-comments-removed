var
MANIFESTS
=
[
do_get_file
(
"
data
/
test_bug848297
.
manifest
"
)
]
;
Components
.
utils
.
import
(
"
resource
:
/
/
gre
/
modules
/
XPCOMUtils
.
jsm
"
)
;
Components
.
utils
.
import
(
"
resource
:
/
/
gre
/
modules
/
Services
.
jsm
"
)
;
registerManifests
(
MANIFESTS
)
;
var
chromeReg
=
Cc
[
"
mozilla
.
org
/
chrome
/
chrome
-
registry
;
1
"
]
.
getService
(
Ci
.
nsIXULChromeRegistry
)
.
QueryInterface
(
Ci
.
nsIToolkitChromeRegistry
)
;
chromeReg
.
checkForNewChrome
(
)
;
function
enum_to_array
(
strings
)
{
let
rv
=
[
]
;
while
(
strings
.
hasMore
(
)
)
{
rv
.
push
(
strings
.
getNext
(
)
)
;
}
rv
.
sort
(
)
;
return
rv
;
}
function
run_test
(
)
{
Services
.
locale
.
setRequestedLocales
(
[
"
de
"
]
)
;
Assert
.
equal
(
chromeReg
.
getSelectedLocale
(
"
basepack
"
)
"
en
-
US
"
)
;
Assert
.
equal
(
chromeReg
.
getSelectedLocale
(
"
overpack
"
)
"
de
"
)
;
Assert
.
deepEqual
(
enum_to_array
(
chromeReg
.
getLocalesForPackage
(
"
basepack
"
)
)
[
"
en
-
US
"
"
fr
"
]
)
;
Services
.
prefs
.
setCharPref
(
"
chrome
.
override_package
.
basepack
"
"
overpack
"
)
;
Assert
.
equal
(
chromeReg
.
getSelectedLocale
(
"
basepack
"
)
"
de
"
)
;
Assert
.
deepEqual
(
enum_to_array
(
chromeReg
.
getLocalesForPackage
(
"
basepack
"
)
)
[
"
de
"
"
en
-
US
"
]
)
;
}
