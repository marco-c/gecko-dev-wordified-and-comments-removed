"
use
strict
"
;
var
EXPORTED_SYMBOLS
=
[
"
Security
"
]
;
const
{
Domain
}
=
ChromeUtils
.
import
(
"
chrome
:
/
/
remote
/
content
/
domains
/
Domain
.
jsm
"
)
;
const
{
Preferences
}
=
ChromeUtils
.
import
(
"
resource
:
/
/
gre
/
modules
/
Preferences
.
jsm
"
)
;
const
{
XPCOMUtils
}
=
ChromeUtils
.
import
(
"
resource
:
/
/
gre
/
modules
/
XPCOMUtils
.
jsm
"
)
;
XPCOMUtils
.
defineLazyServiceGetters
(
this
{
sss
:
[
"
mozilla
.
org
/
ssservice
;
1
"
"
nsISiteSecurityService
"
]
certOverrideService
:
[
"
mozilla
.
org
/
security
/
certoverride
;
1
"
"
nsICertOverrideService
"
]
}
)
;
const
CERT_PINNING_ENFORCEMENT_PREF
=
"
security
.
cert_pinning
.
enforcement_level
"
;
const
HSTS_PRELOAD_LIST_PREF
=
"
network
.
stricttransportsecurity
.
preloadlist
"
;
class
Security
extends
Domain
{
destructor
(
)
{
this
.
setIgnoreCertificateErrors
(
{
ignore
:
false
}
)
;
}
setIgnoreCertificateErrors
(
{
ignore
}
)
{
if
(
ignore
)
{
Preferences
.
set
(
HSTS_PRELOAD_LIST_PREF
false
)
;
Preferences
.
set
(
CERT_PINNING_ENFORCEMENT_PREF
0
)
;
}
else
{
Preferences
.
reset
(
HSTS_PRELOAD_LIST_PREF
)
;
Preferences
.
reset
(
CERT_PINNING_ENFORCEMENT_PREF
)
;
sss
.
clearAll
(
)
;
sss
.
clearPreloads
(
)
;
}
certOverrideService
.
setDisableAllSecurityChecksAndLetAttackersInterceptMyData
(
ignore
)
;
}
}
