"
use
strict
"
;
var
EXPORTED_SYMBOLS
=
[
"
Input
"
]
;
const
{
Services
}
=
ChromeUtils
.
import
(
"
resource
:
/
/
gre
/
modules
/
Services
.
jsm
"
)
;
const
{
Domain
}
=
ChromeUtils
.
import
(
"
chrome
:
/
/
remote
/
content
/
domains
/
Domain
.
jsm
"
)
;
class
Input
extends
Domain
{
async
dispatchKeyEvent
(
options
)
{
const
{
key
modifiers
type
windowsVirtualKeyCode
}
=
options
;
let
domType
;
if
(
type
=
=
"
keyDown
"
|
|
type
=
=
"
rawKeyDown
"
)
{
domType
=
"
keydown
"
;
}
else
if
(
type
=
=
"
keyUp
"
|
|
type
=
=
"
char
"
)
{
domType
=
"
keyup
"
;
}
else
{
throw
new
Error
(
Unknown
key
event
type
{
type
}
)
;
}
const
{
browser
}
=
this
.
session
.
target
;
const
browserWindow
=
browser
.
ownerGlobal
;
const
EventUtils
=
this
.
_getEventUtils
(
browserWindow
)
;
const
onEvent
=
new
Promise
(
r
=
>
{
browserWindow
.
addEventListener
(
domType
r
{
mozSystemGroup
:
true
once
:
true
}
)
;
}
)
;
if
(
type
=
=
"
char
"
)
{
EventUtils
.
synthesizeKey
(
key
{
}
browserWindow
)
;
}
else
{
const
eventUtilsKey
=
key
.
length
=
=
1
?
key
:
"
KEY_
"
+
key
;
EventUtils
.
synthesizeKey
(
eventUtilsKey
{
keyCode
:
windowsVirtualKeyCode
type
:
domType
altKey
:
!
!
(
modifiers
&
1
)
ctrlKey
:
!
!
(
modifiers
&
2
)
metaKey
:
!
!
(
modifiers
&
4
)
shiftKey
:
!
!
(
modifiers
&
8
)
}
browserWindow
)
;
}
await
onEvent
;
}
_getEventUtils
(
win
)
{
if
(
!
this
.
_eventUtils
)
{
this
.
_eventUtils
=
{
window
:
win
parent
:
win
_EU_Ci
:
Ci
_EU_Cc
:
Cc
}
;
Services
.
scriptloader
.
loadSubScript
(
"
chrome
:
/
/
remote
/
content
/
external
/
EventUtils
.
js
"
this
.
_eventUtils
)
;
}
return
this
.
_eventUtils
;
}
}
