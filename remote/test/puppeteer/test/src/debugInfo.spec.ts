import
expect
from
'
expect
'
;
import
{
getTestState
setupTestBrowserHooks
}
from
'
.
/
mocha
-
utils
.
js
'
;
describe
(
'
DebugInfo
'
function
(
)
{
setupTestBrowserHooks
(
)
;
describe
(
'
Browser
.
debugInfo
'
function
(
)
{
it
(
'
should
work
'
async
(
)
=
>
{
const
{
page
browser
}
=
await
getTestState
(
)
;
for
(
let
i
=
0
;
i
<
5
;
i
+
+
)
{
if
(
!
browser
.
debugInfo
.
pendingProtocolErrors
.
length
)
{
break
;
}
await
new
Promise
(
resolve
=
>
{
return
setTimeout
(
resolve
200
)
;
}
)
;
}
expect
(
browser
.
debugInfo
.
pendingProtocolErrors
)
.
toHaveLength
(
0
)
;
const
promise
=
page
.
evaluate
(
(
)
=
>
{
return
new
Promise
(
resolve
=
>
{
window
.
resolve
=
resolve
;
}
)
;
}
)
;
try
{
expect
(
browser
.
debugInfo
.
pendingProtocolErrors
)
.
toHaveLength
(
1
)
;
}
finally
{
await
page
.
evaluate
(
(
)
=
>
{
window
.
resolve
(
)
;
}
)
;
}
await
promise
;
expect
(
browser
.
debugInfo
.
pendingProtocolErrors
)
.
toHaveLength
(
0
)
;
}
)
;
}
)
;
}
)
;
