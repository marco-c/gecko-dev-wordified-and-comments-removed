import
{
homedir
}
from
'
os
'
;
import
{
join
}
from
'
path
'
;
import
{
cosmiconfigSync
}
from
'
cosmiconfig
'
;
import
{
Configuration
Product
}
from
'
puppeteer
-
core
'
;
function
isSupportedProduct
(
product
:
unknown
)
:
product
is
Product
{
switch
(
product
)
{
case
'
chrome
'
:
case
'
firefox
'
:
return
true
;
default
:
return
false
;
}
}
export
const
getConfiguration
=
(
)
:
Configuration
=
>
{
const
result
=
cosmiconfigSync
(
'
puppeteer
'
)
.
search
(
)
;
const
configuration
:
Configuration
=
result
?
result
.
config
:
{
}
;
configuration
.
defaultProduct
=
(
process
.
env
[
'
PUPPETEER_PRODUCT
'
]
?
?
process
.
env
[
'
npm_config_puppeteer_product
'
]
?
?
process
.
env
[
'
npm_package_config_puppeteer_product
'
]
?
?
configuration
.
defaultProduct
?
?
'
chrome
'
)
as
Product
;
configuration
.
executablePath
=
process
.
env
[
'
PUPPETEER_EXECUTABLE_PATH
'
]
?
?
process
.
env
[
'
npm_config_puppeteer_executable_path
'
]
?
?
process
.
env
[
'
npm_package_config_puppeteer_executable_path
'
]
?
?
configuration
.
executablePath
;
if
(
configuration
.
executablePath
)
{
configuration
.
skipDownload
=
true
;
}
configuration
.
skipDownload
=
Boolean
(
process
.
env
[
'
PUPPETEER_SKIP_DOWNLOAD
'
]
?
?
process
.
env
[
'
npm_config_puppeteer_skip_download
'
]
?
?
process
.
env
[
'
npm_package_config_puppeteer_skip_download
'
]
?
?
configuration
.
skipDownload
)
;
if
(
!
configuration
.
skipDownload
)
{
configuration
.
browserRevision
=
process
.
env
[
'
PUPPETEER_BROWSER_REVISION
'
]
?
?
process
.
env
[
'
npm_config_puppeteer_browser_revision
'
]
?
?
process
.
env
[
'
npm_package_config_puppeteer_browser_revision
'
]
?
?
configuration
.
browserRevision
;
configuration
.
downloadHost
=
process
.
env
[
'
PUPPETEER_DOWNLOAD_HOST
'
]
?
?
process
.
env
[
'
npm_config_puppeteer_download_host
'
]
?
?
process
.
env
[
'
npm_package_config_puppeteer_download_host
'
]
?
?
configuration
.
downloadHost
;
configuration
.
downloadPath
=
process
.
env
[
'
PUPPETEER_DOWNLOAD_PATH
'
]
?
?
process
.
env
[
'
npm_config_puppeteer_download_path
'
]
?
?
process
.
env
[
'
npm_package_config_puppeteer_download_path
'
]
?
?
configuration
.
downloadPath
;
}
configuration
.
cacheDirectory
=
process
.
env
[
'
PUPPETEER_CACHE_DIR
'
]
?
?
process
.
env
[
'
npm_config_puppeteer_cache_dir
'
]
?
?
process
.
env
[
'
npm_package_config_puppeteer_cache_dir
'
]
?
?
configuration
.
cacheDirectory
?
?
join
(
homedir
(
)
'
.
cache
'
'
puppeteer
'
)
;
configuration
.
temporaryDirectory
=
process
.
env
[
'
PUPPETEER_TMP_DIR
'
]
?
?
process
.
env
[
'
npm_config_puppeteer_tmp_dir
'
]
?
?
process
.
env
[
'
npm_package_config_puppeteer_tmp_dir
'
]
?
?
configuration
.
temporaryDirectory
;
configuration
.
experiments
?
?
=
{
}
;
configuration
.
logLevel
=
(
process
.
env
[
'
PUPPETEER_LOGLEVEL
'
]
?
?
process
.
env
[
'
npm_config_LOGLEVEL
'
]
?
?
process
.
env
[
'
npm_package_config_LOGLEVEL
'
]
?
?
configuration
.
logLevel
)
as
'
silent
'
|
'
error
'
|
'
warn
'
;
if
(
!
isSupportedProduct
(
configuration
.
defaultProduct
)
)
{
throw
new
Error
(
Unsupported
product
{
configuration
.
defaultProduct
}
)
;
}
return
configuration
;
}
;
