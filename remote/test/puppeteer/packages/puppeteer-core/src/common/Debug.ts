import
type
Debug
from
'
debug
'
;
import
{
isNode
}
from
'
.
.
/
environment
.
js
'
;
declare
global
{
var
__PUPPETEER_DEBUG
:
string
;
}
let
debugModule
:
typeof
Debug
|
null
=
null
;
export
async
function
importDebug
(
)
:
Promise
<
typeof
Debug
>
{
if
(
!
debugModule
)
{
debugModule
=
(
await
import
(
'
debug
'
)
)
.
default
;
}
return
debugModule
;
}
export
const
debug
=
(
prefix
:
string
)
:
(
(
.
.
.
args
:
unknown
[
]
)
=
>
void
)
=
>
{
if
(
isNode
)
{
return
async
(
.
.
.
logArgs
:
unknown
[
]
)
=
>
{
if
(
captureLogs
)
{
capturedLogs
.
push
(
prefix
+
logArgs
)
;
}
(
await
importDebug
(
)
)
(
prefix
)
(
logArgs
)
;
}
;
}
return
(
.
.
.
logArgs
:
unknown
[
]
)
:
void
=
>
{
const
debugLevel
=
(
globalThis
as
any
)
.
__PUPPETEER_DEBUG
;
if
(
!
debugLevel
)
{
return
;
}
const
everythingShouldBeLogged
=
debugLevel
=
=
=
'
*
'
;
const
prefixMatchesDebugLevel
=
everythingShouldBeLogged
|
|
(
debugLevel
.
endsWith
(
'
*
'
)
?
prefix
.
startsWith
(
debugLevel
)
:
prefix
=
=
=
debugLevel
)
;
if
(
!
prefixMatchesDebugLevel
)
{
return
;
}
console
.
log
(
{
prefix
}
:
.
.
.
logArgs
)
;
}
;
}
;
let
capturedLogs
:
string
[
]
=
[
]
;
let
captureLogs
=
false
;
export
function
setLogCapture
(
value
:
boolean
)
:
void
{
capturedLogs
=
[
]
;
captureLogs
=
value
;
}
export
function
getCapturedLogs
(
)
:
string
[
]
{
return
capturedLogs
;
}
