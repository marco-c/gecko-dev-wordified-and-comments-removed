"
use
strict
"
;
const
TEST_URI
=
"
data
:
text
/
html
;
charset
=
utf
-
8
default
-
test
-
page
"
;
add_task
(
async
function
(
)
{
const
RemoteAgent
=
Cc
[
"
mozilla
.
org
/
remote
/
agent
"
]
.
getService
(
Ci
.
nsISupports
)
.
wrappedJSObject
;
RemoteAgent
.
tabs
.
start
(
)
;
RemoteAgent
.
listen
(
Services
.
io
.
newURI
(
"
http
:
/
/
localhost
:
9222
"
)
)
;
const
CDP
=
await
getCDP
(
)
;
const
tab
=
gBrowser
.
addTab
(
TEST_URI
{
skipAnimation
:
true
triggeringPrincipal
:
Services
.
scriptSecurityManager
.
getSystemPrincipal
(
)
}
)
;
await
BrowserTestUtils
.
browserLoaded
(
tab
.
linkedBrowser
)
;
let
targets
=
await
getTargets
(
CDP
)
;
ok
(
targets
.
some
(
target
=
>
target
.
url
=
=
TEST_URI
)
"
Found
the
tab
in
target
list
"
)
;
BrowserTestUtils
.
removeTab
(
tab
)
;
targets
=
await
getTargets
(
CDP
)
;
ok
(
!
targets
.
some
(
target
=
>
target
.
url
=
=
TEST_URI
)
"
Tab
has
been
removed
from
the
target
list
"
)
;
await
RemoteAgent
.
close
(
)
;
}
)
;
