"
use
strict
"
;
const
TEST_URL
=
toDataURL
(
"
default
-
test
-
page
"
)
;
add_task
(
async
function
(
)
{
await
RemoteAgent
.
listen
(
Services
.
io
.
newURI
(
"
http
:
/
/
localhost
:
9222
"
)
)
;
const
CDP
=
await
getCDP
(
)
;
const
tab
=
gBrowser
.
addTab
(
TEST_URL
{
skipAnimation
:
true
triggeringPrincipal
:
Services
.
scriptSecurityManager
.
getSystemPrincipal
(
)
}
)
;
await
BrowserTestUtils
.
browserLoaded
(
tab
.
linkedBrowser
)
;
let
targets
=
await
getTargets
(
CDP
)
;
ok
(
targets
.
some
(
target
=
>
target
.
url
=
=
TEST_URL
)
"
Found
the
tab
in
target
list
"
)
;
BrowserTestUtils
.
removeTab
(
tab
)
;
targets
=
await
getTargets
(
CDP
)
;
ok
(
!
targets
.
some
(
target
=
>
target
.
url
=
=
TEST_URL
)
"
Tab
has
been
removed
from
the
target
list
"
)
;
await
RemoteAgent
.
close
(
)
;
}
)
;
