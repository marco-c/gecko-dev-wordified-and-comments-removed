"
use
strict
"
;
add_task
(
async
function
(
)
{
const
{
client
tab
}
=
await
setup
(
)
;
const
{
Page
}
=
client
;
info
(
"
Enable
the
page
domain
"
)
;
await
Page
.
enable
(
)
;
info
(
"
Create
a
confirm
dialog
to
open
"
)
;
const
{
message
type
}
=
await
createConfirmDialog
(
Page
)
;
is
(
type
"
confirm
"
"
dialog
event
contains
the
correct
type
"
)
;
is
(
message
"
confirm
-
1234
?
"
"
dialog
event
contains
the
correct
text
"
)
;
info
(
"
Accept
the
dialog
"
)
;
await
Page
.
handleJavaScriptDialog
(
{
accept
:
true
}
)
;
let
isConfirmed
=
await
getContentProperty
(
"
isConfirmed
"
)
;
ok
(
isConfirmed
"
The
confirm
dialog
was
accepted
"
)
;
await
createConfirmDialog
(
Page
)
;
info
(
"
Trigger
another
confirm
in
the
test
page
"
)
;
info
(
"
Reject
the
dialog
"
)
;
await
Page
.
handleJavaScriptDialog
(
{
accept
:
false
}
)
;
isConfirmed
=
await
getContentProperty
(
"
isConfirmed
"
)
;
ok
(
!
isConfirmed
"
The
confirm
dialog
was
rejected
"
)
;
await
client
.
close
(
)
;
ok
(
true
"
The
client
is
closed
"
)
;
BrowserTestUtils
.
removeTab
(
tab
)
;
}
)
;
function
createConfirmDialog
(
Page
)
{
const
onDialogOpen
=
Page
.
javascriptDialogOpening
(
)
;
info
(
"
Trigger
a
confirm
in
the
test
page
"
)
;
ContentTask
.
spawn
(
gBrowser
.
selectedBrowser
null
(
)
=
>
{
content
.
isConfirmed
=
content
.
confirm
(
"
confirm
-
1234
?
"
)
;
}
)
;
return
onDialogOpen
;
}
