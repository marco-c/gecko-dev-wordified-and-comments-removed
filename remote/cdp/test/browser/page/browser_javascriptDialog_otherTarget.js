"
use
strict
"
;
const
{
PromptTestUtils
}
=
ChromeUtils
.
import
(
"
resource
:
/
/
testing
-
common
/
PromptTestUtils
.
jsm
"
)
;
add_task
(
async
function
(
{
client
}
)
{
const
{
Page
}
=
client
;
info
(
"
Enable
the
page
domain
"
)
;
await
Page
.
enable
(
)
;
Page
.
javascriptDialogOpening
(
(
)
=
>
{
ok
(
false
"
Should
never
receive
this
event
"
)
;
}
)
;
info
(
"
Open
another
tab
"
)
;
const
otherTab
=
await
BrowserTestUtils
.
openNewForegroundTab
(
gBrowser
toDataURL
(
"
test
-
page
"
)
)
;
is
(
gBrowser
.
selectedTab
otherTab
"
Selected
tab
is
now
the
new
tab
"
)
;
let
onOtherPageDialog
=
PromptTestUtils
.
handleNextPrompt
(
gBrowser
.
selectedBrowser
{
modalType
:
Services
.
prompt
.
MODAL_TYPE_CONTENT
promptType
:
"
alert
"
}
{
buttonNumClick
:
0
}
)
;
info
(
"
Trigger
an
alert
in
the
second
page
"
)
;
SpecialPowers
.
spawn
(
gBrowser
.
selectedBrowser
[
]
(
)
=
>
{
content
.
alert
(
"
test
"
)
;
}
)
;
info
(
"
Wait
for
the
alert
to
be
detected
and
closed
"
)
;
await
onOtherPageDialog
;
info
(
"
Call
bringToFront
on
the
test
page
to
make
sure
we
received
"
)
;
await
Page
.
bringToFront
(
)
;
BrowserTestUtils
.
removeTab
(
otherTab
)
;
}
)
;
