"
use
strict
"
;
var
EXPORTED_SYMBOLS
=
[
"
WebDriverNewSessionHandler
"
]
;
const
{
XPCOMUtils
}
=
ChromeUtils
.
import
(
"
resource
:
/
/
gre
/
modules
/
XPCOMUtils
.
jsm
"
)
;
XPCOMUtils
.
defineLazyModuleGetters
(
this
{
WebDriverBiDiConnection
:
"
chrome
:
/
/
remote
/
content
/
webdriver
-
bidi
/
WebDriverBiDiConnection
.
jsm
"
WebSocketHandshake
:
"
chrome
:
/
/
remote
/
content
/
server
/
WebSocketHandshake
.
jsm
"
}
)
;
class
WebDriverNewSessionHandler
{
constructor
(
webDriverBiDi
)
{
this
.
webDriverBiDi
=
webDriverBiDi
;
}
async
handle
(
request
response
)
{
const
webSocket
=
await
WebSocketHandshake
.
upgrade
(
request
response
)
;
const
conn
=
new
WebDriverBiDiConnection
(
webSocket
response
.
_connection
)
;
this
.
webDriverBiDi
.
addSessionlessConnection
(
conn
)
;
}
get
QueryInterface
(
)
{
return
ChromeUtils
.
generateQI
(
[
"
nsIHttpRequestHandler
"
]
)
;
}
}
