#
include
"
nsHtml5AtomTable
.
h
"
#
include
"
nsThreadUtils
.
h
"
nsHtml5AtomTable
:
:
nsHtml5AtomTable
(
)
:
mRecentlyUsedParserAtoms
{
}
{
#
ifdef
DEBUG
mPermittedLookupEventTarget
=
mozilla
:
:
GetCurrentThreadSerialEventTarget
(
)
;
#
endif
}
nsHtml5AtomTable
:
:
~
nsHtml5AtomTable
(
)
{
}
nsAtom
*
nsHtml5AtomTable
:
:
GetAtom
(
const
nsAString
&
aKey
)
{
#
ifdef
DEBUG
MOZ_ASSERT
(
mPermittedLookupEventTarget
-
>
IsOnCurrentThread
(
)
)
;
#
endif
uint32_t
index
=
mozilla
:
:
HashString
(
aKey
)
%
RECENTLY_USED_PARSER_ATOMS_SIZE
;
if
(
nsAtom
*
atom
=
mRecentlyUsedParserAtoms
[
index
]
)
{
if
(
atom
-
>
Equals
(
aKey
)
)
{
return
atom
;
}
}
RefPtr
<
nsAtom
>
atom
=
NS_Atomize
(
aKey
)
;
nsAtom
*
ret
=
atom
.
get
(
)
;
mRecentlyUsedParserAtoms
[
index
]
=
std
:
:
move
(
atom
)
;
return
ret
;
}
