#
ifndef
mozilla_ipc_ProcessChild_h
#
define
mozilla_ipc_ProcessChild_h
#
include
"
Endpoint
.
h
"
#
include
"
base
/
message_loop
.
h
"
#
include
"
base
/
process
.
h
"
#
include
"
chrome
/
common
/
child_process
.
h
"
#
include
"
mozilla
/
ipc
/
ProcessUtils
.
h
"
namespace
mozilla
{
namespace
ipc
{
class
ProcessChild
:
public
ChildProcess
{
protected
:
typedef
base
:
:
ProcessId
ProcessId
;
public
:
explicit
ProcessChild
(
IPC
:
:
Channel
:
:
ChannelHandle
aClientChannel
ProcessId
aParentPid
const
nsID
&
aMessageChannelId
)
;
ProcessChild
(
const
ProcessChild
&
)
=
delete
;
ProcessChild
&
operator
=
(
const
ProcessChild
&
)
=
delete
;
virtual
~
ProcessChild
(
)
;
virtual
bool
Init
(
int
aArgc
char
*
aArgv
[
]
)
=
0
;
static
void
AddPlatformBuildID
(
geckoargs
:
:
ChildProcessArgs
&
aExtraArgs
)
;
static
bool
InitPrefs
(
int
aArgc
char
*
aArgv
[
]
)
;
virtual
void
CleanUp
(
)
{
}
static
MessageLoop
*
message_loop
(
)
{
return
gProcessChild
-
>
mUILoop
;
}
static
void
NotifiedImpendingShutdown
(
)
;
static
bool
ExpectingShutdown
(
)
;
static
void
AppendToIPCShutdownStateAnnotation
(
const
nsCString
&
aStr
)
{
StaticMutexAutoLock
lock
(
gIPCShutdownStateLock
)
;
gIPCShutdownStateAnnotation
.
Append
(
"
-
"
_ns
)
;
gIPCShutdownStateAnnotation
.
Append
(
aStr
)
;
}
static
void
QuickExit
(
)
;
protected
:
static
ProcessChild
*
current
(
)
{
return
gProcessChild
;
}
ProcessId
ParentPid
(
)
{
return
mParentPid
;
}
UntypedEndpoint
TakeInitialEndpoint
(
)
;
private
:
static
ProcessChild
*
gProcessChild
;
static
StaticMutex
gIPCShutdownStateLock
;
static
nsCString
gIPCShutdownStateAnnotation
MOZ_GUARDED_BY
(
gIPCShutdownStateLock
)
;
MessageLoop
*
mUILoop
;
ProcessId
mParentPid
;
nsID
mMessageChannelId
;
}
;
}
}
#
endif
