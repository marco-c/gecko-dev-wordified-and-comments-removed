#
include
"
gtest
/
gtest
.
h
"
#
include
"
mozilla
/
gtest
/
MozHelpers
.
h
"
#
include
"
mozilla
/
ipc
/
UtilityProcessSandboxing
.
h
"
using
namespace
mozilla
;
using
namespace
mozilla
:
:
ipc
;
TEST
(
UtilityProcessSandboxing
ParseNoEnvVar
)
{
EXPECT_TRUE
(
IsUtilitySandboxEnabled
(
"
"
SandboxingKind
:
:
COUNT
)
)
;
}
TEST
(
UtilityProcessSandboxing
ParseEnvVar_DisableAll
)
{
EXPECT_FALSE
(
IsUtilitySandboxEnabled
(
"
1
"
SandboxingKind
:
:
COUNT
)
)
;
}
TEST
(
UtilityProcessSandboxing
ParseEnvVar_DontDisableAll
)
{
EXPECT_TRUE
(
IsUtilitySandboxEnabled
(
"
0
"
SandboxingKind
:
:
COUNT
)
)
;
}
TEST
(
UtilityProcessSandboxing
ParseEnvVar_DisableGenericOnly
)
{
EXPECT_FALSE
(
IsUtilitySandboxEnabled
(
"
utility
:
0
"
SandboxingKind
:
:
GENERIC_UTILITY
)
)
;
EXPECT_TRUE
(
IsUtilitySandboxEnabled
(
"
utility
:
0
"
SandboxingKind
:
:
COUNT
)
)
;
}
TEST
(
UtilityProcessSandboxing
ParseEnvVar_DisableGenericOnly_Multiples
)
{
EXPECT_FALSE
(
IsUtilitySandboxEnabled
(
"
utility
:
1
utility
:
0
utility
:
2
"
SandboxingKind
:
:
GENERIC_UTILITY
)
)
;
EXPECT_TRUE
(
IsUtilitySandboxEnabled
(
"
utility
:
2
utility
:
0
utility
:
3
"
SandboxingKind
:
:
COUNT
)
)
;
}
