#
ifndef
mozilla_ipc_backgroundutils_h__
#
define
mozilla_ipc_backgroundutils_h__
#
include
"
ipc
/
IPCMessageUtils
.
h
"
#
include
"
mozilla
/
Attributes
.
h
"
#
include
"
mozilla
/
OriginAttributes
.
h
"
#
include
"
nsCOMPtr
.
h
"
#
include
"
nscore
.
h
"
class
nsIContentSecurityPolicy
;
class
nsILoadInfo
;
class
nsINode
;
class
nsIPrincipal
;
class
nsIRedirectHistoryEntry
;
namespace
IPC
{
namespace
detail
{
template
<
class
ParamType
>
struct
OriginAttributesParamTraits
{
typedef
ParamType
paramType
;
static
void
Write
(
Message
*
aMsg
const
paramType
&
aParam
)
{
nsAutoCString
suffix
;
aParam
.
CreateSuffix
(
suffix
)
;
WriteParam
(
aMsg
suffix
)
;
}
static
bool
Read
(
const
Message
*
aMsg
PickleIterator
*
aIter
paramType
*
aResult
)
{
nsAutoCString
suffix
;
return
ReadParam
(
aMsg
aIter
&
suffix
)
&
&
aResult
-
>
PopulateFromSuffix
(
suffix
)
;
}
}
;
}
template
<
>
struct
ParamTraits
<
mozilla
:
:
OriginAttributes
>
:
public
detail
:
:
OriginAttributesParamTraits
<
mozilla
:
:
OriginAttributes
>
{
}
;
}
namespace
mozilla
{
namespace
dom
{
class
Document
;
}
namespace
net
{
class
ChildLoadInfoForwarderArgs
;
class
LoadInfoArgs
;
class
LoadInfo
;
class
ParentLoadInfoForwarderArgs
;
class
RedirectHistoryEntryInfo
;
}
namespace
ipc
{
class
ContentSecurityPolicy
;
class
CSPInfo
;
class
PrincipalInfo
;
Result
<
nsCOMPtr
<
nsIPrincipal
>
nsresult
>
PrincipalInfoToPrincipal
(
const
PrincipalInfo
&
aPrincipalInfo
)
;
nsresult
PrincipalToPrincipalInfo
(
nsIPrincipal
*
aPrincipal
PrincipalInfo
*
aPrincipalInfo
bool
aSkipBaseDomain
=
false
)
;
already_AddRefed
<
nsIContentSecurityPolicy
>
CSPInfoToCSP
(
const
CSPInfo
&
aCSPInfo
mozilla
:
:
dom
:
:
Document
*
aRequestingDoc
nsresult
*
aOptionalResult
=
nullptr
)
;
nsresult
CSPToCSPInfo
(
nsIContentSecurityPolicy
*
aCSP
CSPInfo
*
aCSPInfo
)
;
bool
IsPrincipalInfoPrivate
(
const
PrincipalInfo
&
aPrincipalInfo
)
;
already_AddRefed
<
nsIRedirectHistoryEntry
>
RHEntryInfoToRHEntry
(
const
mozilla
:
:
net
:
:
RedirectHistoryEntryInfo
&
aRHEntryInfo
)
;
nsresult
RHEntryToRHEntryInfo
(
nsIRedirectHistoryEntry
*
aRHEntry
mozilla
:
:
net
:
:
RedirectHistoryEntryInfo
*
aRHEntryInfo
)
;
nsresult
LoadInfoToLoadInfoArgs
(
nsILoadInfo
*
aLoadInfo
Maybe
<
mozilla
:
:
net
:
:
LoadInfoArgs
>
*
outOptionalLoadInfoArgs
)
;
nsresult
LoadInfoArgsToLoadInfo
(
const
Maybe
<
mozilla
:
:
net
:
:
LoadInfoArgs
>
&
aOptionalLoadInfoArgs
nsILoadInfo
*
*
outLoadInfo
)
;
nsresult
LoadInfoArgsToLoadInfo
(
const
Maybe
<
mozilla
:
:
net
:
:
LoadInfoArgs
>
&
aOptionalLoadInfoArgs
nsINode
*
aCspToInheritLoadingContext
nsILoadInfo
*
*
outLoadInfo
)
;
nsresult
LoadInfoArgsToLoadInfo
(
const
Maybe
<
net
:
:
LoadInfoArgs
>
&
aOptionalLoadInfoArgs
mozilla
:
:
net
:
:
LoadInfo
*
*
outLoadInfo
)
;
nsresult
LoadInfoArgsToLoadInfo
(
const
Maybe
<
net
:
:
LoadInfoArgs
>
&
aOptionalLoadInfoArgs
nsINode
*
aCspToInheritLoadingContext
mozilla
:
:
net
:
:
LoadInfo
*
*
outLoadInfo
)
;
void
LoadInfoToParentLoadInfoForwarder
(
nsILoadInfo
*
aLoadInfo
mozilla
:
:
net
:
:
ParentLoadInfoForwarderArgs
*
aForwarderArgsOut
)
;
nsresult
MergeParentLoadInfoForwarder
(
mozilla
:
:
net
:
:
ParentLoadInfoForwarderArgs
const
&
aForwarderArgs
nsILoadInfo
*
aLoadInfo
)
;
void
LoadInfoToChildLoadInfoForwarder
(
nsILoadInfo
*
aLoadInfo
mozilla
:
:
net
:
:
ChildLoadInfoForwarderArgs
*
aForwarderArgsOut
)
;
nsresult
MergeChildLoadInfoForwarder
(
const
mozilla
:
:
net
:
:
ChildLoadInfoForwarderArgs
&
aForwardArgs
nsILoadInfo
*
aLoadInfo
)
;
}
}
#
endif
