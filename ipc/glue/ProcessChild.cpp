#
include
"
mozilla
/
ipc
/
ProcessChild
.
h
"
#
include
"
nsDebug
.
h
"
#
ifdef
XP_WIN
#
include
<
stdlib
.
h
>
#
else
#
include
<
unistd
.
h
>
#
endif
#
include
"
mozilla
/
AppShutdown
.
h
"
#
include
"
mozilla
/
ipc
/
IOThreadChild
.
h
"
namespace
mozilla
{
namespace
ipc
{
ProcessChild
*
ProcessChild
:
:
gProcessChild
;
static
Atomic
<
bool
>
sExpectingShutdown
(
false
)
;
ProcessChild
:
:
ProcessChild
(
ProcessId
aParentPid
)
:
ChildProcess
(
new
IOThreadChild
(
)
)
mUILoop
(
MessageLoop
:
:
current
(
)
)
mParentPid
(
aParentPid
)
{
MOZ_ASSERT
(
mUILoop
"
UILoop
should
be
created
by
now
"
)
;
MOZ_ASSERT
(
!
gProcessChild
"
should
only
be
one
ProcessChild
"
)
;
gProcessChild
=
this
;
}
ProcessChild
:
:
~
ProcessChild
(
)
{
gProcessChild
=
nullptr
;
}
void
ProcessChild
:
:
NotifyImpendingShutdown
(
)
{
sExpectingShutdown
=
true
;
}
bool
ProcessChild
:
:
ExpectingShutdown
(
)
{
return
sExpectingShutdown
;
}
void
ProcessChild
:
:
QuickExit
(
)
{
AppShutdown
:
:
DoImmediateExit
(
)
;
}
}
}
