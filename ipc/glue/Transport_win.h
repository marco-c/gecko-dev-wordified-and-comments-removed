#
ifndef
mozilla_ipc_Transport_win_h
#
define
mozilla_ipc_Transport_win_h
1
#
include
<
string
>
#
include
"
base
/
process
.
h
"
#
include
"
ipc
/
IPCMessageUtils
.
h
"
#
include
"
nsWindowsHelpers
.
h
"
#
include
"
nsXULAppAPI
.
h
"
#
include
"
mozilla
/
UniquePtrExtensions
.
h
"
namespace
mozilla
{
namespace
ipc
{
struct
TransportDescriptor
{
std
:
:
wstring
mPipeName
;
HANDLE
mServerPipeHandle
;
base
:
:
ProcessId
mDestinationProcessId
;
}
;
}
}
namespace
IPC
{
template
<
>
struct
ParamTraits
<
mozilla
:
:
ipc
:
:
TransportDescriptor
>
{
typedef
mozilla
:
:
ipc
:
:
TransportDescriptor
paramType
;
static
void
Write
(
Message
*
aMsg
const
paramType
&
aParam
)
{
WriteParam
(
aMsg
aParam
.
mPipeName
)
;
WriteParam
(
aMsg
mozilla
:
:
UniqueFileHandle
(
aParam
.
mServerPipeHandle
)
)
;
WriteParam
(
aMsg
aParam
.
mDestinationProcessId
)
;
}
static
bool
Read
(
const
Message
*
aMsg
PickleIterator
*
aIter
paramType
*
aResult
)
{
mozilla
:
:
UniqueFileHandle
serverPipeHandle
;
bool
r
=
(
ReadParam
(
aMsg
aIter
&
aResult
-
>
mPipeName
)
&
&
ReadParam
(
aMsg
aIter
&
serverPipeHandle
)
&
&
ReadParam
(
aMsg
aIter
&
aResult
-
>
mDestinationProcessId
)
)
;
if
(
!
r
)
{
return
r
;
}
if
(
serverPipeHandle
)
{
aResult
-
>
mServerPipeHandle
=
serverPipeHandle
.
release
(
)
;
}
else
{
aResult
-
>
mServerPipeHandle
=
INVALID_HANDLE_VALUE
;
}
return
true
;
}
}
;
}
#
endif
