#
include
<
windows
.
h
>
#
include
"
mozilla
/
ipc
/
SharedMemory
.
h
"
namespace
mozilla
{
namespace
ipc
{
void
SharedMemory
:
:
SystemProtect
(
char
*
aAddr
size_t
aSize
int
aRights
)
{
if
(
!
SystemProtectFallible
(
aAddr
aSize
aRights
)
)
{
MOZ_CRASH
(
"
can
'
t
VirtualProtect
(
)
"
)
;
}
}
bool
SharedMemory
:
:
SystemProtectFallible
(
char
*
aAddr
size_t
aSize
int
aRights
)
{
DWORD
flags
;
if
(
(
aRights
&
RightsRead
)
&
&
(
aRights
&
RightsWrite
)
)
flags
=
PAGE_READWRITE
;
else
if
(
aRights
&
RightsRead
)
flags
=
PAGE_READONLY
;
else
flags
=
PAGE_NOACCESS
;
DWORD
oldflags
;
return
VirtualProtect
(
aAddr
aSize
flags
&
oldflags
)
;
}
size_t
SharedMemory
:
:
SystemPageSize
(
)
{
SYSTEM_INFO
si
;
GetSystemInfo
(
&
si
)
;
return
si
.
dwPageSize
;
}
}
}
