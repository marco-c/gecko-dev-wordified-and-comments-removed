#
ifndef
CHROME_COMMON_CHILD_PROCESS_HOST_H_
#
define
CHROME_COMMON_CHILD_PROCESS_HOST_H_
#
include
"
build
/
build_config
.
h
"
#
include
<
list
>
#
include
"
base
/
basictypes
.
h
"
#
include
"
chrome
/
common
/
ipc_channel
.
h
"
#
include
"
mozilla
/
UniquePtr
.
h
"
namespace
mozilla
{
namespace
ipc
{
class
FileDescriptor
;
}
}
class
ChildProcessHost
:
public
IPC
:
:
Channel
:
:
Listener
{
public
:
virtual
~
ChildProcessHost
(
)
;
using
ChannelId
=
IPC
:
:
Channel
:
:
ChannelId
;
protected
:
explicit
ChildProcessHost
(
)
;
virtual
bool
CanShutdown
(
)
=
0
;
bool
CreateChannel
(
)
;
virtual
void
OnMessageReceived
(
IPC
:
:
Message
&
&
msg
)
override
{
}
virtual
void
OnChannelConnected
(
base
:
:
ProcessId
peer_pid
)
override
{
}
virtual
void
OnChannelError
(
)
override
{
}
bool
opening_channel
(
)
{
return
opening_channel_
;
}
const
ChannelId
&
channel_id
(
)
{
return
channel_id_
;
}
IPC
:
:
Channel
*
channelp
(
)
const
{
return
channel_
.
get
(
)
;
}
mozilla
:
:
UniquePtr
<
IPC
:
:
Channel
>
TakeChannel
(
)
{
return
std
:
:
move
(
channel_
)
;
}
private
:
class
ListenerHook
:
public
IPC
:
:
Channel
:
:
Listener
{
public
:
explicit
ListenerHook
(
ChildProcessHost
*
host
)
;
virtual
void
OnMessageReceived
(
IPC
:
:
Message
&
&
msg
)
override
;
virtual
void
OnChannelConnected
(
base
:
:
ProcessId
peer_pid
)
override
;
virtual
void
OnChannelError
(
)
override
;
virtual
void
GetQueuedMessages
(
std
:
:
queue
<
IPC
:
:
Message
>
&
queue
)
override
;
private
:
ChildProcessHost
*
host_
;
}
;
ListenerHook
listener_
;
bool
opening_channel_
;
mozilla
:
:
UniquePtr
<
IPC
:
:
Channel
>
channel_
;
ChannelId
channel_id_
;
}
;
#
endif
