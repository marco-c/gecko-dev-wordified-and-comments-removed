#
include
"
chrome
/
common
/
child_thread
.
h
"
#
include
"
chrome
/
common
/
child_process
.
h
"
ChildThread
:
:
ChildThread
(
Thread
:
:
Options
options
)
:
Thread
(
"
IPC
I
/
O
Child
"
)
owner_loop_
(
MessageLoop
:
:
current
(
)
)
options_
(
options
)
{
DCHECK
(
owner_loop_
)
;
channel_name_
=
IPC
:
:
Channel
:
:
ChannelIDForCurrentProcess
(
)
;
}
ChildThread
:
:
~
ChildThread
(
)
{
}
bool
ChildThread
:
:
Run
(
)
{
bool
r
=
StartWithOptions
(
options_
)
;
return
r
;
}
void
ChildThread
:
:
OnChannelError
(
)
{
RefPtr
<
mozilla
:
:
Runnable
>
task
=
new
MessageLoop
:
:
QuitTask
(
)
;
owner_loop_
-
>
PostTask
(
task
.
forget
(
)
)
;
}
void
ChildThread
:
:
OnMessageReceived
(
IPC
:
:
Message
&
&
msg
)
{
}
ChildThread
*
ChildThread
:
:
current
(
)
{
return
ChildProcess
:
:
current
(
)
-
>
child_thread
(
)
;
}
void
ChildThread
:
:
Init
(
)
{
channel_
=
mozilla
:
:
MakeUnique
<
IPC
:
:
Channel
>
(
channel_name_
IPC
:
:
Channel
:
:
MODE_CLIENT
this
)
;
}
void
ChildThread
:
:
CleanUp
(
)
{
channel_
=
nullptr
;
}
