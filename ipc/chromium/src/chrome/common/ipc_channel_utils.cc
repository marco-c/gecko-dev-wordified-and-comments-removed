#
include
"
chrome
/
common
/
ipc_channel_utils
.
h
"
#
include
"
GeckoProfiler
.
h
"
#
include
"
chrome
/
common
/
ipc_message
.
h
"
namespace
IPC
{
void
AddIPCProfilerMarker
(
const
Message
&
aMessage
int32_t
aOtherPid
mozilla
:
:
ipc
:
:
MessageDirection
aDirection
mozilla
:
:
ipc
:
:
MessagePhase
aPhase
)
{
#
ifdef
MOZ_GECKO_PROFILER
if
(
aMessage
.
routing_id
(
)
!
=
MSG_ROUTING_NONE
&
&
profiler_feature_active
(
ProfilerFeature
:
:
IPCMessages
)
)
{
if
(
aOtherPid
=
=
-
1
)
{
DLOG
(
WARNING
)
<
<
"
Unable
to
record
IPC
profile
marker
other
PID
not
set
"
;
return
;
}
if
(
profiler_is_locked_on_current_thread
(
)
)
{
return
;
}
const
mozilla
:
:
TimeStamp
now
=
mozilla
:
:
TimeStamp
:
:
NowUnfuzzed
(
)
;
PROFILER_MARKER
(
"
IPC
"
IPC
mozilla
:
:
MarkerTiming
:
:
InstantAt
(
now
)
IPCMarker
now
now
aOtherPid
aMessage
.
seqno
(
)
aMessage
.
type
(
)
mozilla
:
:
ipc
:
:
UnknownSide
aDirection
aPhase
aMessage
.
is_sync
(
)
)
;
}
#
endif
}
}
