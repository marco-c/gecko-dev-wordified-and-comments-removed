#
ifndef
BASE_LOCK_H_
#
define
BASE_LOCK_H_
#
include
"
base
/
basictypes
.
h
"
#
include
"
base
/
lock_impl
.
h
"
#
include
"
base
/
platform_thread
.
h
"
class
Lock
{
public
:
Lock
(
)
=
default
;
~
Lock
(
)
=
default
;
void
Acquire
(
)
{
lock_
.
Lock
(
)
;
}
void
Release
(
)
{
lock_
.
Unlock
(
)
;
}
bool
Try
(
)
{
return
lock_
.
Try
(
)
;
}
void
AssertAcquired
(
)
const
{
}
static
bool
HandlesMultipleThreadPriorities
(
)
{
#
if
defined
(
XP_UNIX
)
return
base
:
:
internal
:
:
LockImpl
:
:
PriorityInheritanceAvailable
(
)
;
#
else
return
true
;
#
endif
}
friend
class
ConditionVariable
;
private
:
:
:
base
:
:
internal
:
:
LockImpl
lock_
;
DISALLOW_COPY_AND_ASSIGN
(
Lock
)
;
}
;
class
AutoLock
{
public
:
struct
AlreadyAcquired
{
}
;
explicit
AutoLock
(
Lock
&
lock
)
:
lock_
(
lock
)
{
lock_
.
Acquire
(
)
;
}
AutoLock
(
Lock
&
lock
const
AlreadyAcquired
&
)
:
lock_
(
lock
)
{
lock_
.
AssertAcquired
(
)
;
}
~
AutoLock
(
)
{
lock_
.
AssertAcquired
(
)
;
lock_
.
Release
(
)
;
}
private
:
Lock
&
lock_
;
DISALLOW_COPY_AND_ASSIGN
(
AutoLock
)
;
}
;
class
AutoUnlock
{
public
:
explicit
AutoUnlock
(
Lock
&
lock
)
:
lock_
(
lock
)
{
lock_
.
AssertAcquired
(
)
;
lock_
.
Release
(
)
;
}
~
AutoUnlock
(
)
{
lock_
.
Acquire
(
)
;
}
private
:
Lock
&
lock_
;
DISALLOW_COPY_AND_ASSIGN
(
AutoUnlock
)
;
}
;
#
endif
