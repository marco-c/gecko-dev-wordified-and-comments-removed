#
ifndef
mozilla_mscom_ProxyStream_h
#
define
mozilla_mscom_ProxyStream_h
#
include
"
ipc
/
IPCMessageUtils
.
h
"
#
include
"
mozilla
/
mscom
/
Ptr
.
h
"
#
include
"
mozilla
/
RefPtr
.
h
"
#
include
"
mozilla
/
TypedEnumBits
.
h
"
#
include
"
mozilla
/
UniquePtr
.
h
"
namespace
mozilla
{
namespace
mscom
{
enum
class
ProxyStreamFlags
:
uint32_t
{
eDefault
=
0
ePreservable
=
1
}
;
MOZ_MAKE_ENUM_CLASS_BITWISE_OPERATORS
(
ProxyStreamFlags
)
;
class
ProxyStream
final
{
public
:
ProxyStream
(
)
;
ProxyStream
(
REFIID
aIID
IUnknown
*
aObject
ProxyStreamFlags
aFlags
=
ProxyStreamFlags
:
:
eDefault
)
;
ProxyStream
(
REFIID
aIID
const
BYTE
*
aInitBuf
const
int
aInitBufSize
)
;
~
ProxyStream
(
)
;
ProxyStream
(
const
ProxyStream
&
aOther
)
=
delete
;
ProxyStream
&
operator
=
(
const
ProxyStream
&
aOther
)
=
delete
;
ProxyStream
(
ProxyStream
&
&
aOther
)
;
ProxyStream
&
operator
=
(
ProxyStream
&
&
aOther
)
;
inline
bool
IsValid
(
)
const
{
return
!
(
mUnmarshaledProxy
&
&
mStream
)
;
}
bool
GetInterface
(
void
*
*
aOutInterface
)
;
const
BYTE
*
GetBuffer
(
int
&
aReturnedBufSize
)
const
;
PreservedStreamPtr
GetPreservedStream
(
)
;
bool
operator
=
=
(
const
ProxyStream
&
aOther
)
const
{
return
this
=
=
&
aOther
;
}
private
:
static
already_AddRefed
<
IStream
>
InitStream
(
const
BYTE
*
aInitBuf
const
UINT
aInitBufSize
)
;
private
:
RefPtr
<
IStream
>
mStream
;
BYTE
*
mGlobalLockedBuf
;
HGLOBAL
mHGlobal
;
int
mBufSize
;
ProxyUniquePtr
<
IUnknown
>
mUnmarshaledProxy
;
bool
mPreserveStream
;
}
;
}
}
#
endif
