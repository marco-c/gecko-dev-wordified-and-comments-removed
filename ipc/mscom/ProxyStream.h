#
ifndef
mozilla_mscom_ProxyStream_h
#
define
mozilla_mscom_ProxyStream_h
#
include
"
ipc
/
IPCMessageUtils
.
h
"
#
include
"
mozilla
/
mscom
/
Ptr
.
h
"
#
include
"
mozilla
/
RefPtr
.
h
"
#
include
"
mozilla
/
UniquePtr
.
h
"
namespace
mozilla
{
namespace
mscom
{
class
ProxyStream
final
{
public
:
ProxyStream
(
)
;
ProxyStream
(
REFIID
aIID
IUnknown
*
aObject
)
;
ProxyStream
(
const
BYTE
*
aInitBuf
const
int
aInitBufSize
)
;
~
ProxyStream
(
)
;
ProxyStream
(
const
ProxyStream
&
aOther
)
=
delete
;
ProxyStream
&
operator
=
(
const
ProxyStream
&
aOther
)
=
delete
;
ProxyStream
(
ProxyStream
&
&
aOther
)
;
ProxyStream
&
operator
=
(
ProxyStream
&
&
aOther
)
;
inline
bool
IsValid
(
)
const
{
return
!
(
mStream
&
&
mUnmarshaledProxy
)
;
}
bool
GetInterface
(
REFIID
aIID
void
*
*
aOutInterface
)
const
;
const
BYTE
*
GetBuffer
(
int
&
aReturnedBufSize
)
const
;
bool
operator
=
=
(
const
ProxyStream
&
aOther
)
const
{
return
this
=
=
&
aOther
;
}
private
:
static
already_AddRefed
<
IStream
>
InitStream
(
const
BYTE
*
aInitBuf
const
UINT
aInitBufSize
)
;
private
:
RefPtr
<
IStream
>
mStream
;
BYTE
*
mGlobalLockedBuf
;
HGLOBAL
mHGlobal
;
int
mBufSize
;
ProxyUniquePtr
<
IUnknown
>
mUnmarshaledProxy
;
HRESULT
mUnmarshalResult
;
}
;
}
}
#
endif
