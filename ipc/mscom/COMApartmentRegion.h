#
ifndef
mozilla_mscom_COMApartmentRegion_h
#
define
mozilla_mscom_COMApartmentRegion_h
#
include
"
mozilla
/
Assertions
.
h
"
#
include
"
mozilla
/
Attributes
.
h
"
#
include
<
objbase
.
h
>
namespace
mozilla
{
namespace
mscom
{
template
<
COINIT
T
>
class
MOZ_NON_TEMPORARY_CLASS
COMApartmentRegion
{
public
:
COMApartmentRegion
(
)
:
mInitResult
(
:
:
CoInitializeEx
(
nullptr
T
)
)
{
MOZ_ASSERT
(
IsValid
(
)
)
;
}
~
COMApartmentRegion
(
)
{
if
(
IsValid
(
)
)
{
:
:
CoUninitialize
(
)
;
}
}
bool
IsValidOutermost
(
)
const
{
return
mInitResult
=
=
S_OK
;
}
bool
IsValid
(
)
const
{
return
SUCCEEDED
(
mInitResult
)
;
}
HRESULT
GetHResult
(
)
const
{
return
mInitResult
;
}
private
:
COMApartmentRegion
(
const
COMApartmentRegion
&
)
=
delete
;
COMApartmentRegion
&
operator
=
(
const
COMApartmentRegion
&
)
=
delete
;
COMApartmentRegion
(
COMApartmentRegion
&
&
)
=
delete
;
COMApartmentRegion
&
operator
=
(
COMApartmentRegion
&
&
)
=
delete
;
HRESULT
mInitResult
;
}
;
typedef
COMApartmentRegion
<
COINIT_APARTMENTTHREADED
>
STARegion
;
typedef
COMApartmentRegion
<
COINIT_MULTITHREADED
>
MTARegion
;
}
}
#
endif
