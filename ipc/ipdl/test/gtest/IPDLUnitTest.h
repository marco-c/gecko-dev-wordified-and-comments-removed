#
ifndef
mozilla__ipdltest_IPDLUnitTest_h
#
define
mozilla__ipdltest_IPDLUnitTest_h
#
include
"
mozilla
/
_ipdltest
/
IPDLUnitTestChild
.
h
"
#
include
"
mozilla
/
_ipdltest
/
IPDLUnitTestParent
.
h
"
#
include
"
mozilla
/
ipc
/
ProtocolUtils
.
h
"
namespace
mozilla
:
:
_ipdltest
{
const
char
*
RegisterAllocChildActor
(
const
char
*
aName
mozilla
:
:
ipc
:
:
IToplevelProtocol
*
(
*
aFunc
)
(
)
)
;
class
IPDLTestHelper
{
public
:
enum
class
TestMode
{
SameProcess
CrossProcess
}
;
void
TestWrapper
(
)
;
virtual
const
char
*
GetName
(
)
=
0
;
virtual
ipc
:
:
IToplevelProtocol
*
GetActor
(
)
=
0
;
virtual
TestMode
GetTestMode
(
)
=
0
;
virtual
void
TestBody
(
)
=
0
;
}
;
#
define
IPDL_TEST_CLASS_NAME_
(
actorname
)
IPDL_TEST_
#
#
actorname
#
define
IPDL_TEST_HEAD_
(
actorname
)
\
class
IPDL_TEST_CLASS_NAME_
(
actorname
)
\
:
public
:
:
mozilla
:
:
_ipdltest
:
:
IPDLTestHelper
{
\
public
:
\
explicit
IPDL_TEST_CLASS_NAME_
(
actorname
)
(
TestMode
aTestMode
)
\
:
mTestMode
(
aTestMode
)
mActor
(
new
actorname
#
#
Parent
)
{
}
\
\
private
:
\
void
TestBody
(
)
override
;
\
const
char
*
GetName
(
)
override
{
return
sName
;
}
\
actorname
#
#
Parent
*
GetActor
(
)
override
{
return
mActor
;
}
\
TestMode
GetTestMode
(
)
override
{
return
mTestMode
;
}
\
\
const
TestMode
mTestMode
;
\
actorname
#
#
Parent
*
mActor
;
\
static
const
char
*
sName
;
\
}
;
\
const
char
*
IPDL_TEST_CLASS_NAME_
(
actorname
)
:
:
sName
=
\
:
:
mozilla
:
:
_ipdltest
:
:
RegisterAllocChildActor
(
\
#
actorname
[
]
(
)
-
>
:
:
mozilla
:
:
ipc
:
:
IToplevelProtocol
*
{
\
return
new
actorname
#
#
Child
;
\
}
)
;
#
define
IPDL_TEST_DECL_
(
testgroup
actorname
mode
)
\
TEST
(
testgroup
actorname
)
\
{
\
IPDL_TEST_CLASS_NAME_
(
actorname
)
{
\
:
:
mozilla
:
:
_ipdltest
:
:
IPDLTestHelper
:
:
TestMode
:
:
mode
}
\
.
TestWrapper
(
)
;
\
}
#
define
IPDL_TEST_BODY_SEGUE_
(
actorname
)
\
void
IPDL_TEST_CLASS_NAME_
(
actorname
)
:
:
TestBody
(
)
#
define
IPDL_TEST
(
actorname
)
\
IPDL_TEST_HEAD_
(
actorname
)
\
IPDL_TEST_DECL_
(
IPDLTest_CrossProcess
actorname
CrossProcess
)
\
IPDL_TEST_DECL_
(
IPDLTest_CrossThread
actorname
SameProcess
)
\
IPDL_TEST_BODY_SEGUE_
(
actorname
)
}
#
endif
