#
ifndef
mozilla_TimeStamp_windows_h
#
define
mozilla_TimeStamp_windows_h
#
include
"
mozilla
/
Types
.
h
"
namespace
mozilla
{
#
define
ms2mt
(
x
)
(
(
x
)
*
mozilla
:
:
GetQueryPerformanceFrequencyPerSec
(
)
)
#
define
mt2ms
(
x
)
(
(
x
)
/
mozilla
:
:
GetQueryPerformanceFrequencyPerSec
(
)
)
#
define
mt2ms_f
(
x
)
(
double
(
x
)
/
mozilla
:
:
GetQueryPerformanceFrequencyPerSec
(
)
)
MFBT_API
uint64_t
GetQueryPerformanceFrequencyPerSec
(
)
;
class
TimeStamp
;
class
TimeStampValue
;
TimeStampValue
NowInternal
(
bool
aHighResolution
)
;
class
TimeStampValue
{
friend
TimeStampValue
NowInternal
(
bool
)
;
friend
bool
IsCanonicalTimeStamp
(
TimeStampValue
)
;
friend
struct
IPC
:
:
ParamTraits
<
mozilla
:
:
TimeStampValue
>
;
friend
class
TimeStamp
;
uint64_t
mGTC
;
uint64_t
mQPC
;
bool
mIsNull
;
bool
mHasQPC
;
MFBT_API
TimeStampValue
(
uint64_t
aGTC
uint64_t
aQPC
bool
aHasQPC
)
;
MFBT_API
uint64_t
CheckQPC
(
const
TimeStampValue
&
aOther
)
const
;
struct
_SomethingVeryRandomHere
;
constexpr
MOZ_IMPLICIT
TimeStampValue
(
_SomethingVeryRandomHere
*
aNullValue
)
:
mGTC
(
0
)
mQPC
(
0
)
mIsNull
(
true
)
mHasQPC
(
false
)
{
}
public
:
MFBT_API
uint64_t
operator
-
(
const
TimeStampValue
&
aOther
)
const
;
TimeStampValue
operator
+
(
const
int64_t
aOther
)
const
{
return
TimeStampValue
(
mGTC
+
aOther
mQPC
+
aOther
mHasQPC
)
;
}
TimeStampValue
operator
-
(
const
int64_t
aOther
)
const
{
return
TimeStampValue
(
mGTC
-
aOther
mQPC
-
aOther
mHasQPC
)
;
}
MFBT_API
TimeStampValue
&
operator
+
=
(
const
int64_t
aOther
)
;
MFBT_API
TimeStampValue
&
operator
-
=
(
const
int64_t
aOther
)
;
constexpr
bool
operator
<
(
const
TimeStampValue
&
aOther
)
const
{
return
mHasQPC
&
&
aOther
.
mHasQPC
?
mQPC
<
aOther
.
mQPC
:
mGTC
<
aOther
.
mGTC
;
}
constexpr
bool
operator
>
(
const
TimeStampValue
&
aOther
)
const
{
return
mHasQPC
&
&
aOther
.
mHasQPC
?
mQPC
>
aOther
.
mQPC
:
mGTC
>
aOther
.
mGTC
;
}
constexpr
bool
operator
<
=
(
const
TimeStampValue
&
aOther
)
const
{
return
mHasQPC
&
&
aOther
.
mHasQPC
?
mQPC
<
=
aOther
.
mQPC
:
mGTC
<
=
aOther
.
mGTC
;
}
constexpr
bool
operator
>
=
(
const
TimeStampValue
&
aOther
)
const
{
return
mHasQPC
&
&
aOther
.
mHasQPC
?
mQPC
>
=
aOther
.
mQPC
:
mGTC
>
=
aOther
.
mGTC
;
}
constexpr
bool
operator
=
=
(
const
TimeStampValue
&
aOther
)
const
{
return
mHasQPC
&
&
aOther
.
mHasQPC
?
mQPC
=
=
aOther
.
mQPC
:
mGTC
=
=
aOther
.
mGTC
;
}
constexpr
bool
operator
!
=
(
const
TimeStampValue
&
aOther
)
const
{
return
mHasQPC
&
&
aOther
.
mHasQPC
?
mQPC
!
=
aOther
.
mQPC
:
mGTC
!
=
aOther
.
mGTC
;
}
constexpr
bool
IsNull
(
)
const
{
return
mIsNull
;
}
#
if
defined
(
DEBUG
)
uint64_t
GTC
(
)
const
{
return
mGTC
;
}
uint64_t
QPC
(
)
const
{
return
mQPC
;
}
bool
HasQPC
(
)
const
{
return
mHasQPC
;
}
#
endif
}
;
}
#
endif
