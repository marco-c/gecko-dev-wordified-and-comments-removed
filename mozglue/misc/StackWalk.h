#
ifndef
mozilla_StackWalk_h
#
define
mozilla_StackWalk_h
#
include
"
mozilla
/
Types
.
h
"
#
include
<
stdint
.
h
>
typedef
void
(
*
MozWalkStackCallback
)
(
uint32_t
aFrameNumber
void
*
aPC
void
*
aSP
void
*
aClosure
)
;
MFBT_API
void
MozStackWalk
(
MozWalkStackCallback
aCallback
uint32_t
aSkipFrames
uint32_t
aMaxFrames
void
*
aClosure
)
;
#
if
defined
(
_WIN32
)
&
&
(
defined
(
_M_IX86
)
|
|
defined
(
_M_AMD64
)
|
|
\
defined
(
_M_IA64
)
|
|
defined
(
_M_ARM64
)
)
#
include
<
windows
.
h
>
#
define
MOZ_STACKWALK_SUPPORTS_WINDOWS
1
MFBT_API
void
MozStackWalkThread
(
MozWalkStackCallback
aCallback
uint32_t
aMaxFrames
void
*
aClosure
HANDLE
aThread
CONTEXT
*
aContext
)
;
#
else
#
define
MOZ_STACKWALK_SUPPORTS_WINDOWS
0
#
endif
typedef
struct
{
char
library
[
256
]
;
ptrdiff_t
loffset
;
char
filename
[
256
]
;
unsigned
long
lineno
;
char
function
[
256
]
;
ptrdiff_t
foffset
;
}
MozCodeAddressDetails
;
MFBT_API
bool
MozDescribeCodeAddress
(
void
*
aPC
MozCodeAddressDetails
*
aDetails
)
;
MFBT_API
void
MozFormatCodeAddress
(
char
*
aBuffer
uint32_t
aBufferSize
uint32_t
aFrameNumber
const
void
*
aPC
const
char
*
aFunction
const
char
*
aLibrary
ptrdiff_t
aLOffset
const
char
*
aFileName
uint32_t
aLineNo
)
;
MFBT_API
void
MozFormatCodeAddressDetails
(
char
*
aBuffer
uint32_t
aBufferSize
uint32_t
aFrameNumber
void
*
aPC
const
MozCodeAddressDetails
*
aDetails
)
;
namespace
mozilla
{
MFBT_API
void
FramePointerStackWalk
(
MozWalkStackCallback
aCallback
uint32_t
aMaxFrames
void
*
aClosure
void
*
*
aBp
void
*
aStackEnd
)
;
#
if
defined
(
XP_LINUX
)
|
|
defined
(
XP_FREEBSD
)
MFBT_API
void
DemangleSymbol
(
const
char
*
aSymbol
char
*
aBuffer
int
aBufLen
)
;
#
endif
}
#
endif
