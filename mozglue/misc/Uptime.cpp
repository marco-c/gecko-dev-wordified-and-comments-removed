#
include
"
Uptime
.
h
"
#
include
"
mozilla
/
Now
.
h
"
using
namespace
mozilla
;
namespace
{
static
Maybe
<
uint64_t
>
mStartExcludingSuspendMs
;
static
Maybe
<
uint64_t
>
mStartIncludingSuspendMs
;
}
;
namespace
mozilla
{
void
InitializeUptime
(
)
{
MOZ_RELEASE_ASSERT
(
mStartIncludingSuspendMs
.
isNothing
(
)
&
&
mStartExcludingSuspendMs
.
isNothing
(
)
"
Must
not
be
called
more
than
once
"
)
;
mStartIncludingSuspendMs
=
NowIncludingSuspendMs
(
)
;
mStartExcludingSuspendMs
=
NowExcludingSuspendMs
(
)
;
}
Maybe
<
uint64_t
>
ProcessUptimeMs
(
)
{
if
(
!
mStartIncludingSuspendMs
)
{
return
Nothing
(
)
;
}
Maybe
<
uint64_t
>
maybeNow
=
NowIncludingSuspendMs
(
)
;
if
(
!
maybeNow
)
{
return
Nothing
(
)
;
}
return
Some
(
maybeNow
.
value
(
)
-
mStartIncludingSuspendMs
.
value
(
)
)
;
}
Maybe
<
uint64_t
>
ProcessUptimeExcludingSuspendMs
(
)
{
if
(
!
mStartExcludingSuspendMs
)
{
return
Nothing
(
)
;
}
Maybe
<
uint64_t
>
maybeNow
=
NowExcludingSuspendMs
(
)
;
if
(
!
maybeNow
)
{
return
Nothing
(
)
;
}
return
Some
(
maybeNow
.
value
(
)
-
mStartExcludingSuspendMs
.
value
(
)
)
;
}
}
;
