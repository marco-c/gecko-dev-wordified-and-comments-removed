#
include
"
mozilla
/
Assertions
.
h
"
#
include
"
mozilla
/
DebugOnly
.
h
"
#
include
"
mozilla
/
PlatformMutex
.
h
"
#
include
<
windows
.
h
>
#
include
"
MutexPlatformData_windows
.
h
"
mozilla
:
:
detail
:
:
MutexImpl
:
:
MutexImpl
(
recordreplay
:
:
Behavior
aRecorded
)
{
InitializeSRWLock
(
&
platformData
(
)
-
>
lock
)
;
}
mozilla
:
:
detail
:
:
MutexImpl
:
:
~
MutexImpl
(
)
{
}
void
mozilla
:
:
detail
:
:
MutexImpl
:
:
lock
(
)
{
AcquireSRWLockExclusive
(
&
platformData
(
)
-
>
lock
)
;
}
bool
mozilla
:
:
detail
:
:
MutexImpl
:
:
tryLock
(
)
{
return
mutexTryLock
(
)
;
}
bool
mozilla
:
:
detail
:
:
MutexImpl
:
:
mutexTryLock
(
)
{
return
!
!
TryAcquireSRWLockExclusive
(
&
platformData
(
)
-
>
lock
)
;
}
void
mozilla
:
:
detail
:
:
MutexImpl
:
:
unlock
(
)
{
ReleaseSRWLockExclusive
(
&
platformData
(
)
-
>
lock
)
;
}
mozilla
:
:
detail
:
:
MutexImpl
:
:
PlatformData
*
mozilla
:
:
detail
:
:
MutexImpl
:
:
platformData
(
)
{
static_assert
(
sizeof
(
platformData_
)
>
=
sizeof
(
PlatformData
)
"
platformData_
is
too
small
"
)
;
return
reinterpret_cast
<
PlatformData
*
>
(
platformData_
)
;
}
