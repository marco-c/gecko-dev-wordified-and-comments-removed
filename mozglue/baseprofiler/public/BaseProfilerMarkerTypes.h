#
ifndef
BaseProfilerMarkerTypes_h
#
define
BaseProfilerMarkerTypes_h
#
include
"
mozilla
/
BaseProfilerMarkers
.
h
"
#
ifdef
MOZ_GECKO_PROFILER
namespace
mozilla
:
:
baseprofiler
:
:
markers
{
struct
Tracing
{
static
constexpr
Span
<
const
char
>
MarkerTypeName
(
)
{
return
MakeStringSpan
(
"
tracing
"
)
;
}
static
void
StreamJSONMarkerData
(
JSONWriter
&
aWriter
const
ProfilerString8View
&
aCategory
)
{
if
(
aCategory
.
Length
(
)
!
=
0
)
{
aWriter
.
StringProperty
(
"
category
"
aCategory
)
;
}
}
}
;
struct
FileIO
{
static
constexpr
Span
<
const
char
>
MarkerTypeName
(
)
{
return
MakeStringSpan
(
"
FileIO
"
)
;
}
static
void
StreamJSONMarkerData
(
JSONWriter
&
aWriter
const
ProfilerString8View
&
aOperation
const
ProfilerString8View
&
aSource
const
ProfilerString8View
&
aFilename
MarkerThreadId
aOperationThreadId
)
{
aWriter
.
StringProperty
(
"
operation
"
aOperation
)
;
aWriter
.
StringProperty
(
"
source
"
aSource
)
;
if
(
aFilename
.
Length
(
)
!
=
0
)
{
aWriter
.
StringProperty
(
"
filename
"
aFilename
)
;
}
if
(
!
aOperationThreadId
.
IsUnspecified
(
)
)
{
aWriter
.
IntProperty
(
"
threadId
"
aOperationThreadId
.
ThreadId
(
)
)
;
}
}
}
;
struct
UserTimingMark
{
static
constexpr
Span
<
const
char
>
MarkerTypeName
(
)
{
return
MakeStringSpan
(
"
UserTiming
"
)
;
}
static
void
StreamJSONMarkerData
(
JSONWriter
&
aWriter
const
ProfilerString8View
&
aName
)
{
aWriter
.
StringProperty
(
"
name
"
aName
)
;
aWriter
.
StringProperty
(
"
entryType
"
"
mark
"
)
;
aWriter
.
NullProperty
(
"
startMark
"
)
;
aWriter
.
NullProperty
(
"
endMark
"
)
;
}
}
;
struct
UserTimingMeasure
{
static
constexpr
Span
<
const
char
>
MarkerTypeName
(
)
{
return
MakeStringSpan
(
"
UserTiming
"
)
;
}
static
void
StreamJSONMarkerData
(
JSONWriter
&
aWriter
const
ProfilerString8View
&
aName
const
Maybe
<
ProfilerString8View
>
&
aStartMark
const
Maybe
<
ProfilerString8View
>
&
aEndMark
)
{
aWriter
.
StringProperty
(
"
name
"
aName
)
;
aWriter
.
StringProperty
(
"
entryType
"
"
measure
"
)
;
if
(
aStartMark
.
isSome
(
)
)
{
aWriter
.
StringProperty
(
"
startMark
"
*
aStartMark
)
;
}
else
{
aWriter
.
NullProperty
(
"
startMark
"
)
;
}
if
(
aEndMark
.
isSome
(
)
)
{
aWriter
.
StringProperty
(
"
endMark
"
*
aEndMark
)
;
}
else
{
aWriter
.
NullProperty
(
"
endMark
"
)
;
}
}
}
;
struct
Hang
{
static
constexpr
Span
<
const
char
>
MarkerTypeName
(
)
{
return
MakeStringSpan
(
"
BHR
-
detected
hang
"
)
;
}
static
void
StreamJSONMarkerData
(
JSONWriter
&
aWriter
)
{
}
}
;
struct
LongTask
{
static
constexpr
Span
<
const
char
>
MarkerTypeName
(
)
{
return
MakeStringSpan
(
"
MainThreadLongTask
"
)
;
}
static
void
StreamJSONMarkerData
(
JSONWriter
&
aWriter
)
{
aWriter
.
StringProperty
(
"
category
"
"
LongTask
"
)
;
}
}
;
struct
Log
{
static
constexpr
Span
<
const
char
>
MarkerTypeName
(
)
{
return
MakeStringSpan
(
"
Log
"
)
;
}
static
void
StreamJSONMarkerData
(
JSONWriter
&
aWriter
const
ProfilerString8View
&
aModule
const
ProfilerString8View
&
aText
)
{
aWriter
.
StringProperty
(
"
module
"
aModule
)
;
aWriter
.
StringProperty
(
"
name
"
aText
)
;
}
}
;
struct
MediaSample
{
static
constexpr
Span
<
const
char
>
MarkerTypeName
(
)
{
return
MakeStringSpan
(
"
MediaSample
"
)
;
}
static
void
StreamJSONMarkerData
(
JSONWriter
&
aWriter
int64_t
aSampleStartTimeUs
int64_t
aSampleEndTimeUs
)
{
aWriter
.
IntProperty
(
"
sampleStartTimeUs
"
aSampleStartTimeUs
)
;
aWriter
.
IntProperty
(
"
sampleEndTimeUs
"
aSampleEndTimeUs
)
;
}
}
;
}
#
endif
#
endif
