#
include
"
BaseProfilingStack
.
h
"
#
include
<
algorithm
>
#
include
"
mozilla
/
IntegerRange
.
h
"
#
include
"
mozilla
/
UniquePtr
.
h
"
#
include
"
mozilla
/
UniquePtrExtensions
.
h
"
#
include
"
BaseProfiler
.
h
"
namespace
mozilla
{
namespace
baseprofiler
{
ProfilingStack
:
:
~
ProfilingStack
(
)
{
MOZ_RELEASE_ASSERT
(
stackPointer
=
=
0
)
;
delete
[
]
frames
;
}
void
ProfilingStack
:
:
ensureCapacitySlow
(
)
{
MOZ_ASSERT
(
stackPointer
>
=
capacity
)
;
const
uint32_t
kInitialCapacity
=
128
;
uint32_t
sp
=
stackPointer
;
auto
newCapacity
=
std
:
:
max
(
sp
+
1
capacity
?
capacity
*
2
:
kInitialCapacity
)
;
auto
*
newFrames
=
new
ProfilingStackFrame
[
newCapacity
]
;
for
(
auto
i
:
IntegerRange
(
capacity
)
)
{
newFrames
[
i
]
=
frames
[
i
]
;
}
ProfilingStackFrame
*
oldFrames
=
frames
;
frames
=
newFrames
;
capacity
=
newCapacity
;
delete
[
]
oldFrames
;
}
}
}
