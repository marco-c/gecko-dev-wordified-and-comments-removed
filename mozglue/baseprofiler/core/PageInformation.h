#
ifndef
PageInformation_h
#
define
PageInformation_h
#
include
"
mozilla
/
Atomics
.
h
"
#
include
"
mozilla
/
Maybe
.
h
"
#
include
"
mozilla
/
MemoryReporting
.
h
"
#
include
<
string
>
class
SpliceableJSONWriter
;
class
PageInformation
final
{
public
:
PageInformation
(
const
std
:
:
string
&
aDocShellId
uint32_t
aDocShellHistoryId
const
std
:
:
string
&
aUrl
bool
aIsSubFrame
)
;
MFBT_API
void
AddRef
(
)
const
{
+
+
mRefCnt
;
}
MFBT_API
void
Release
(
)
const
{
MOZ_ASSERT
(
int32_t
(
mRefCnt
)
>
0
)
;
if
(
-
-
mRefCnt
)
{
delete
this
;
}
}
size_t
SizeOfIncludingThis
(
mozilla
:
:
MallocSizeOf
aMallocSizeOf
)
const
;
bool
Equals
(
PageInformation
*
aOtherDocShellInfo
)
;
void
StreamJSON
(
SpliceableJSONWriter
&
aWriter
)
;
uint32_t
DocShellHistoryId
(
)
{
return
mDocShellHistoryId
;
}
const
std
:
:
string
&
DocShellId
(
)
{
return
mDocShellId
;
}
const
std
:
:
string
&
Url
(
)
{
return
mUrl
;
}
bool
IsSubFrame
(
)
{
return
mIsSubFrame
;
}
mozilla
:
:
Maybe
<
uint64_t
>
BufferPositionWhenUnregistered
(
)
{
return
mBufferPositionWhenUnregistered
;
}
void
NotifyUnregistered
(
uint64_t
aBufferPosition
)
{
mBufferPositionWhenUnregistered
=
mozilla
:
:
Some
(
aBufferPosition
)
;
}
private
:
const
std
:
:
string
mDocShellId
;
const
uint32_t
mDocShellHistoryId
;
const
std
:
:
string
mUrl
;
const
bool
mIsSubFrame
;
mozilla
:
:
Maybe
<
uint64_t
>
mBufferPositionWhenUnregistered
;
mutable
mozilla
:
:
Atomic
<
int32_t
mozilla
:
:
MemoryOrdering
:
:
ReleaseAcquire
mozilla
:
:
recordreplay
:
:
Behavior
:
:
DontPreserve
>
mRefCnt
;
}
;
#
endif
