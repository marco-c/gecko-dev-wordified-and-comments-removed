#
include
<
cstdio
>
#
include
<
unistd
.
h
>
#
include
"
Zip
.
h
"
#
include
"
mozilla
/
RefPtr
.
h
"
#
include
"
gtest
/
gtest
.
h
"
Logging
Logging
:
:
Singleton
;
extern
const
unsigned
char
TEST_ZIP
[
]
;
extern
const
unsigned
int
TEST_ZIP_SIZE
;
const
char
*
test_entries
[
]
=
{
"
baz
"
"
foo
"
"
bar
"
"
qux
"
}
;
extern
const
unsigned
char
NO_CENTRAL_DIR_ZIP
[
]
;
extern
const
unsigned
int
NO_CENTRAL_DIR_ZIP_SIZE
;
const
char
*
no_central_dir_entries
[
]
=
{
"
a
"
"
b
"
"
c
"
"
d
"
}
;
TEST
(
Zip
TestZip
)
{
Zip
:
:
Stream
s
;
RefPtr
<
Zip
>
z
=
Zip
:
:
Create
(
(
void
*
)
TEST_ZIP
TEST_ZIP_SIZE
)
;
for
(
auto
&
entry
:
test_entries
)
{
ASSERT_TRUE
(
z
-
>
GetStream
(
entry
&
s
)
)
<
<
"
Could
not
get
entry
\
"
"
<
<
entry
<
<
"
\
"
"
;
}
}
TEST
(
Zip
NoCentralDir
)
{
Zip
:
:
Stream
s
;
RefPtr
<
Zip
>
z
=
Zip
:
:
Create
(
(
void
*
)
NO_CENTRAL_DIR_ZIP
NO_CENTRAL_DIR_ZIP_SIZE
)
;
for
(
auto
&
entry
:
no_central_dir_entries
)
{
ASSERT_TRUE
(
z
-
>
GetStream
(
entry
&
s
)
)
<
<
"
Could
not
get
entry
\
"
"
<
<
entry
<
<
"
\
"
"
;
}
}
