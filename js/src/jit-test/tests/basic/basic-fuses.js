function
intact
(
name
)
{
let
state
=
getFuseState
(
)
;
if
(
!
(
name
in
state
)
)
{
throw
"
No
such
fuse
"
+
name
;
}
return
state
[
name
]
.
intact
}
g
=
newGlobal
(
)
;
g
.
evaluate
(
intact
.
toString
(
)
)
g
.
evaluate
(
"
delete
Array
.
prototype
[
Symbol
.
iterator
]
"
)
g
.
evaluate
(
assertEq
(
intact
(
"
ArrayPrototypeIteratorFuse
"
)
false
)
)
function
testRealmChange
(
)
{
let
g
=
newGlobal
(
)
;
g
.
evaluate
(
intact
.
toString
(
)
)
let
rdel
=
g
.
evaluate
(
"
function
del
(
o
)
{
delete
o
.
prototype
[
Symbol
.
iterator
]
}
;
del
"
)
g
.
evaluate
(
assertEq
(
intact
(
"
ArrayPrototypeIteratorFuse
"
)
true
)
)
;
let
g2
=
newGlobal
(
)
;
g2
.
evaluate
(
intact
.
toString
(
)
)
g2
.
rdel
=
rdel
;
g2
.
evaluate
(
rdel
(
Array
)
)
;
g
.
evaluate
(
assertEq
(
intact
(
"
ArrayPrototypeIteratorFuse
"
)
true
)
)
;
g2
.
evaluate
(
assertEq
(
intact
(
"
ArrayPrototypeIteratorFuse
"
)
false
)
)
;
}
testRealmChange
(
)
;
