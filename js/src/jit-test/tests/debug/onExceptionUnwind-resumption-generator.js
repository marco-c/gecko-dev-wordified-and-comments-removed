load
(
libdir
+
"
asserts
.
js
"
)
;
var
g
=
newGlobal
(
)
;
var
dbg
=
Debugger
(
g
)
;
g
.
eval
(
function
*
f
(
)
{
e
;
}
)
;
var
currentFrame
;
var
uncaughtException
;
dbg
.
uncaughtExceptionHook
=
function
(
e
)
{
uncaughtException
=
e
;
return
{
return
:
currentFrame
.
eval
(
"
(
{
done
:
true
value
:
'
uncaught
'
}
)
"
)
.
return
}
;
}
;
function
testUncaughtException
(
)
{
uncaughtException
=
undefined
;
var
obj
=
g
.
eval
(
f
(
)
.
next
(
)
)
;
assertEq
(
obj
.
done
true
)
;
assertEq
(
obj
.
value
'
uncaught
'
)
;
assertEq
(
uncaughtException
instanceof
TypeError
true
)
;
}
dbg
.
onExceptionUnwind
=
function
(
frame
)
{
return
undefined
;
}
;
assertThrowsInstanceOf
(
(
)
=
>
g
.
eval
(
f
(
)
.
next
(
)
;
)
g
.
ReferenceError
)
;
dbg
.
onExceptionUnwind
=
function
(
frame
)
{
currentFrame
=
frame
;
return
{
return
:
"
foo
"
}
;
}
;
testUncaughtException
(
)
;
dbg
.
onExceptionUnwind
=
function
(
frame
)
{
currentFrame
=
frame
;
return
{
return
:
frame
.
eval
(
"
(
{
}
)
"
)
.
return
}
;
}
;
testUncaughtException
(
)
;
dbg
.
onExceptionUnwind
=
function
(
frame
)
{
currentFrame
=
frame
;
return
{
return
:
frame
.
eval
(
"
(
{
value
:
10
}
)
"
)
.
return
}
;
}
;
testUncaughtException
(
)
;
dbg
.
onExceptionUnwind
=
function
(
frame
)
{
currentFrame
=
frame
;
return
{
return
:
frame
.
eval
(
"
(
{
done
:
true
}
)
"
)
.
return
}
;
}
;
testUncaughtException
(
)
;
dbg
.
onExceptionUnwind
=
function
(
frame
)
{
currentFrame
=
frame
;
return
{
return
:
frame
.
eval
(
"
(
{
done
:
10
value
:
10
}
)
"
)
.
return
}
;
}
;
testUncaughtException
(
)
;
dbg
.
onExceptionUnwind
=
function
(
frame
)
{
currentFrame
=
frame
;
return
{
return
:
frame
.
eval
(
"
(
{
get
done
(
)
{
return
true
;
}
value
:
10
}
)
"
)
.
return
}
;
}
;
testUncaughtException
(
)
;
dbg
.
onExceptionUnwind
=
function
(
frame
)
{
currentFrame
=
frame
;
return
{
return
:
frame
.
eval
(
"
(
{
done
:
true
get
value
(
)
{
return
10
;
}
}
)
"
)
.
return
}
;
}
;
testUncaughtException
(
)
;
dbg
.
onExceptionUnwind
=
function
(
frame
)
{
currentFrame
=
frame
;
return
{
return
:
frame
.
eval
(
"
new
Proxy
(
{
done
:
true
value
:
10
}
{
}
)
"
)
.
return
}
;
}
;
testUncaughtException
(
)
;
dbg
.
onExceptionUnwind
=
function
(
frame
)
{
currentFrame
=
frame
;
return
{
return
:
frame
.
eval
(
"
(
{
done
:
true
value
:
10
}
)
"
)
.
return
}
;
}
;
var
obj
=
g
.
eval
(
f
(
)
.
next
(
)
)
;
assertEq
(
obj
.
done
true
)
;
assertEq
(
obj
.
value
10
)
;
