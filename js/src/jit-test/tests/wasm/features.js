let
release_or_beta
=
getBuildConfiguration
(
"
release_or_beta
"
)
;
let
nightly
=
!
release_or_beta
;
let
nightlyOnlyFeatures
=
[
]
;
for
(
let
[
name
enabled
test
]
of
nightlyOnlyFeatures
)
{
if
(
enabled
)
{
assertEq
(
nightly
true
{
name
}
must
be
enabled
only
on
nightly
)
;
wasmEvalText
(
test
)
;
}
else
{
assertErrorMessage
(
(
)
=
>
wasmEvalText
(
test
)
WebAssembly
.
CompileError
/
.
/
)
;
}
}
let
releasedFeaturesMaybeDisabledAnyway
=
[
[
'
simd
'
wasmSimdEnabled
(
)
(
module
(
func
(
result
v128
)
i32
.
const
0
i8x16
.
splat
)
)
]
[
'
relaxed
-
simd
'
wasmRelaxedSimdEnabled
(
)
(
module
(
func
(
result
v128
)
unreachable
i16x8
.
relaxed_laneselect
)
)
]
]
;
for
(
let
[
name
enabled
test
]
of
releasedFeaturesMaybeDisabledAnyway
)
{
if
(
release_or_beta
)
{
if
(
enabled
)
{
wasmEvalText
(
test
)
;
}
else
{
assertErrorMessage
(
(
)
=
>
wasmEvalText
(
test
)
WebAssembly
.
CompileError
/
.
/
)
;
}
}
}
let
releasedFeatures
=
[
[
'
threads
'
wasmThreadsEnabled
(
)
(
module
(
memory
1
1
shared
)
)
]
[
'
branch
-
hinting
'
wasmBranchHintingEnabled
(
)
(
func
i32
.
const
0
(
metadata
.
code
.
branch_hint
"
\
\
00
"
)
if
end
)
]
]
;
for
(
let
[
name
enabled
test
options
]
of
releasedFeatures
)
{
if
(
release_or_beta
)
{
assertEq
(
enabled
true
{
name
}
must
be
enabled
on
release
and
beta
)
;
wasmEvalText
(
test
{
}
options
)
;
}
}
