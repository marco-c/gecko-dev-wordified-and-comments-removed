load
(
libdir
+
"
wasm
.
js
"
)
;
if
(
!
wasmIsSupported
(
)
)
quit
(
)
;
function
mismatchError
(
actual
expect
)
{
var
str
=
"
type
mismatch
:
expression
has
type
"
+
actual
+
"
but
expected
"
+
expect
;
return
RegExp
(
str
)
;
}
function
testLoad
(
type
ext
base
offset
align
expect
)
{
assertEq
(
wasmEvalText
(
'
(
module
'
+
'
(
memory
0x10000
'
+
'
(
segment
0
"
\
\
00
\
\
01
\
\
02
\
\
03
\
\
04
\
\
05
\
\
06
\
\
07
\
\
08
\
\
09
\
\
0a
\
\
0b
\
\
0c
\
\
0d
\
\
0e
\
\
0f
"
)
'
+
'
(
segment
16
"
\
\
f0
\
\
f1
\
\
f2
\
\
f3
\
\
f4
\
\
f5
\
\
f6
\
\
f7
\
\
f8
\
\
f9
\
\
fa
\
\
fb
\
\
fc
\
\
fd
\
\
fe
\
\
ff
"
)
'
+
'
)
'
+
'
(
func
(
param
i32
)
(
result
'
+
type
+
'
)
'
+
'
(
'
+
type
+
'
.
load
'
+
ext
+
'
offset
=
'
+
offset
+
'
'
+
(
align
!
=
0
?
'
align
=
'
+
align
:
'
'
)
+
'
(
get_local
0
)
'
+
'
)
'
+
'
)
(
export
"
"
0
)
)
'
)
(
base
)
expect
)
;
}
function
testStore
(
type
ext
base
offset
align
value
)
{
assertEq
(
wasmEvalText
(
'
(
module
'
+
'
(
memory
0x10000
'
+
'
(
segment
0
"
\
\
00
\
\
01
\
\
02
\
\
03
\
\
04
\
\
05
\
\
06
\
\
07
\
\
08
\
\
09
\
\
0a
\
\
0b
\
\
0c
\
\
0d
\
\
0e
\
\
0f
"
)
'
+
'
(
segment
16
"
\
\
f0
\
\
f1
\
\
f2
\
\
f3
\
\
f4
\
\
f5
\
\
f6
\
\
f7
\
\
f8
\
\
f9
\
\
fa
\
\
fb
\
\
fc
\
\
fd
\
\
fe
\
\
ff
"
)
'
+
'
)
'
+
'
(
func
(
param
i32
)
(
param
'
+
type
+
'
)
(
result
'
+
type
+
'
)
'
+
'
(
'
+
type
+
'
.
store
'
+
ext
+
'
offset
=
'
+
offset
+
'
'
+
(
align
!
=
0
?
'
align
=
'
+
align
:
'
'
)
+
'
(
get_local
0
)
'
+
'
(
get_local
1
)
'
+
'
)
'
+
'
)
(
export
"
"
0
)
)
'
)
(
base
value
)
value
)
;
}
function
testLoadError
(
type
ext
base
offset
align
errorMsg
)
{
assertErrorMessage
(
(
)
=
>
wasmEvalText
(
'
(
module
'
+
'
(
memory
0x10000
'
+
'
(
segment
0
"
\
\
00
\
\
01
\
\
02
\
\
03
\
\
04
\
\
05
\
\
06
\
\
07
\
\
08
\
\
09
\
\
0a
\
\
0b
\
\
0c
\
\
0d
\
\
0e
\
\
0f
"
)
'
+
'
(
segment
16
"
\
\
f0
\
\
f1
\
\
f2
\
\
f3
\
\
f4
\
\
f5
\
\
f6
\
\
f7
\
\
f8
\
\
f9
\
\
fa
\
\
fb
\
\
fc
\
\
fd
\
\
fe
\
\
ff
"
)
'
+
'
)
'
+
'
(
func
(
param
i32
)
(
result
'
+
type
+
'
)
'
+
'
(
'
+
type
+
'
.
load
'
+
ext
+
'
offset
=
'
+
offset
+
'
'
+
(
align
!
=
0
?
'
align
=
'
+
align
:
'
'
)
+
'
(
get_local
0
)
'
+
'
)
'
+
'
)
(
export
"
"
0
)
)
'
)
Error
errorMsg
)
;
}
function
testStoreError
(
type
ext
base
offset
align
errorMsg
)
{
assertErrorMessage
(
(
)
=
>
wasmEvalText
(
'
(
module
'
+
'
(
memory
0x10000
'
+
'
(
segment
0
"
\
\
00
\
\
01
\
\
02
\
\
03
\
\
04
\
\
05
\
\
06
\
\
07
\
\
08
\
\
09
\
\
0a
\
\
0b
\
\
0c
\
\
0d
\
\
0e
\
\
0f
"
)
'
+
'
(
segment
16
"
\
\
f0
\
\
f1
\
\
f2
\
\
f3
\
\
f4
\
\
f5
\
\
f6
\
\
f7
\
\
f8
\
\
f9
\
\
fa
\
\
fb
\
\
fc
\
\
fd
\
\
fe
\
\
ff
"
)
'
+
'
)
'
+
'
(
func
(
param
i32
)
(
param
'
+
type
+
'
)
(
result
'
+
type
+
'
)
'
+
'
(
'
+
type
+
'
.
store
'
+
ext
+
'
offset
=
'
+
offset
+
'
'
+
(
align
!
=
0
?
'
align
=
'
+
align
:
'
'
)
+
'
(
get_local
0
)
'
+
'
(
get_local
1
)
'
+
'
)
'
+
'
)
(
export
"
"
0
)
)
'
)
Error
errorMsg
)
;
}
testLoad
(
'
i32
'
'
'
0
0
0
0x03020100
)
;
testLoad
(
'
f32
'
'
'
0
0
0
3
.
820471434542632e
-
37
)
;
testLoad
(
'
f64
'
'
'
0
0
0
7
.
949928895127363e
-
275
)
;
testLoad
(
'
i32
'
'
8_s
'
16
0
0
-
0x10
)
;
testLoad
(
'
i32
'
'
8_u
'
16
0
0
0xf0
)
;
testLoad
(
'
i32
'
'
16_s
'
16
0
0
-
0xe10
)
;
testLoad
(
'
i32
'
'
16_u
'
16
0
0
0xf1f0
)
;
testStore
(
'
i32
'
'
'
0
0
0
-
0x3f3e2c2c
)
;
testStore
(
'
f32
'
'
'
0
0
0
0
.
01234566979110241
)
;
testStore
(
'
f64
'
'
'
0
0
0
0
.
89012345
)
;
testStore
(
'
i32
'
'
8
'
0
0
0
0x23
)
;
testStore
(
'
i32
'
'
16
'
0
0
0
0x2345
)
;
testLoadError
(
'
i32
'
'
'
0
0
3
/
memory
access
alignment
must
be
a
power
of
two
/
)
;
testStoreError
(
'
i32
'
'
'
0
0
3
/
memory
access
alignment
must
be
a
power
of
two
/
)
;
