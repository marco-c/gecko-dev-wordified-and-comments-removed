wasmValidateText
(
(
module
{
(
rec
(
type
(
func
)
)
)
.
repeat
(
1_000_000
)
}
)
)
;
wasmFailValidateText
(
(
module
{
(
rec
(
type
(
func
)
)
)
.
repeat
(
1_000_001
)
}
)
/
too
many
/
)
;
wasmValidateText
(
(
module
(
rec
{
(
type
(
func
)
)
.
repeat
(
1_000_000
)
}
)
)
)
;
wasmValidateText
(
(
module
(
rec
{
(
type
(
func
)
)
.
repeat
(
500_000
)
}
)
(
rec
{
(
type
(
func
)
)
.
repeat
(
500_000
)
}
)
)
)
;
wasmFailValidateText
(
(
module
(
rec
{
(
type
(
func
)
)
.
repeat
(
1_000_001
)
}
)
)
/
too
many
/
)
;
wasmFailValidateText
(
(
module
(
rec
{
(
type
(
func
)
)
.
repeat
(
500_000
)
}
)
(
rec
{
(
type
(
func
)
)
.
repeat
(
500_001
)
}
)
)
/
too
many
/
)
;
function
testSubtypingModule
(
depth
)
{
let
types
=
'
(
type
(
sub
(
func
)
)
)
'
;
for
(
let
i
=
1
;
i
<
=
depth
;
i
+
+
)
{
types
+
=
(
type
(
sub
{
i
-
1
}
(
func
)
)
)
;
}
return
(
module
{
types
}
)
;
}
wasmValidateText
(
testSubtypingModule
(
63
)
)
;
wasmFailValidateText
(
testSubtypingModule
(
64
)
/
too
deep
/
)
;
wasmFailValidateText
(
(
module
(
type
(
struct
{
'
(
field
i64
)
'
.
repeat
(
10_001
)
}
)
)
)
/
too
many
/
)
;
{
let
{
makeLargeStructDefault
makeLargeStruct
}
=
wasmEvalText
(
(
module
(
type
s
(
struct
{
'
(
field
i64
)
'
.
repeat
(
10_000
)
}
)
)
(
func
(
export
"
makeLargeStructDefault
"
)
(
result
anyref
)
struct
.
new_default
s
)
(
func
(
export
"
makeLargeStruct
"
)
(
result
anyref
)
{
'
i64
.
const
0
'
.
repeat
(
10_000
)
}
struct
.
new
s
)
)
)
.
exports
;
let
largeStructDefault
=
makeLargeStructDefault
(
)
;
let
largeStruct
=
makeLargeStruct
(
)
;
}
wasmFailValidateText
(
(
module
(
type
a
(
array
i32
)
)
(
func
array
.
new_fixed
a
10001
)
)
/
too
many
/
)
;
