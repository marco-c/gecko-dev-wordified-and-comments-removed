function
wasmCompile
(
text
)
{
return
new
WebAssembly
.
Module
(
wasmTextToBinary
(
text
)
)
;
}
assertErrorMessage
(
(
)
=
>
wasmCompile
(
(
module
(
type
box
(
struct
(
field
x
i32
)
)
)
(
func
(
export
"
f
"
)
(
param
(
ref
null
box
)
)
(
unreachable
)
)
)
)
WebAssembly
.
CompileError
/
cannot
expose
indexed
reference
type
/
)
;
assertEq
(
typeof
wasmCompile
(
(
module
(
func
(
export
"
f
"
)
(
param
externref
)
(
unreachable
)
)
)
)
"
object
"
)
;
assertErrorMessage
(
(
)
=
>
wasmCompile
(
(
module
(
type
box
(
struct
(
field
x
i32
)
)
)
(
func
(
export
"
f
"
)
(
result
(
ref
null
box
)
)
(
ref
.
null
opt
box
)
)
)
)
WebAssembly
.
CompileError
/
cannot
expose
indexed
reference
type
/
)
;
assertEq
(
typeof
wasmCompile
(
(
module
(
func
(
export
"
f
"
)
(
result
externref
)
(
ref
.
null
extern
)
)
)
)
"
object
"
)
;
assertErrorMessage
(
(
)
=
>
wasmCompile
(
(
module
(
type
box
(
struct
(
field
x
i32
)
)
)
(
import
"
m
"
"
f
"
(
func
(
param
(
ref
null
box
)
)
)
)
)
)
WebAssembly
.
CompileError
/
cannot
expose
indexed
reference
type
/
)
;
assertEq
(
typeof
wasmCompile
(
(
module
(
import
"
m
"
"
f
"
(
func
(
param
externref
)
)
)
)
)
"
object
"
)
;
assertErrorMessage
(
(
)
=
>
wasmCompile
(
(
module
(
type
box
(
struct
(
field
x
i32
)
)
)
(
import
"
m
"
"
f
"
(
func
(
param
i32
)
(
result
(
ref
null
box
)
)
)
)
)
)
WebAssembly
.
CompileError
/
cannot
expose
indexed
reference
type
/
)
;
assertEq
(
typeof
wasmCompile
(
(
module
(
import
"
m
"
"
f
"
(
func
(
param
i32
)
(
result
externref
)
)
)
)
)
"
object
"
)
;
assertErrorMessage
(
(
)
=
>
wasmCompile
(
(
module
(
type
box
(
struct
(
field
val
i32
)
)
)
(
import
"
m
"
"
g
"
(
global
(
mut
(
ref
null
box
)
)
)
)
)
)
WebAssembly
.
CompileError
/
cannot
expose
indexed
reference
type
/
)
;
assertErrorMessage
(
(
)
=
>
wasmCompile
(
(
module
(
type
box
(
struct
(
field
val
i32
)
)
)
(
import
"
m
"
"
g
"
(
global
(
ref
null
box
)
)
)
)
)
WebAssembly
.
CompileError
/
cannot
expose
indexed
reference
type
/
)
;
assertEq
(
typeof
wasmCompile
(
(
module
(
import
"
m
"
"
g
"
(
global
(
mut
externref
)
)
)
)
)
"
object
"
)
;
assertEq
(
typeof
wasmCompile
(
(
module
(
import
"
m
"
"
g
"
(
global
externref
)
)
)
)
"
object
"
)
;
assertErrorMessage
(
(
)
=
>
wasmCompile
(
(
module
(
type
box
(
struct
(
field
val
i32
)
)
)
(
global
boxg
(
export
"
box
"
)
(
mut
(
ref
null
box
)
)
(
ref
.
null
opt
box
)
)
)
)
WebAssembly
.
CompileError
/
cannot
expose
indexed
reference
type
/
)
;
assertErrorMessage
(
(
)
=
>
wasmCompile
(
(
module
(
type
box
(
struct
(
field
val
i32
)
)
)
(
global
boxg
(
export
"
box
"
)
(
ref
null
box
)
(
ref
.
null
opt
box
)
)
)
)
WebAssembly
.
CompileError
/
cannot
expose
indexed
reference
type
/
)
;
assertEq
(
typeof
wasmCompile
(
(
module
(
global
boxg
(
export
"
box
"
)
(
mut
externref
)
(
ref
.
null
extern
)
)
)
)
"
object
"
)
;
assertEq
(
typeof
wasmCompile
(
(
module
(
global
boxg
(
export
"
box
"
)
externref
(
ref
.
null
extern
)
)
)
)
"
object
"
)
;
assertErrorMessage
(
(
)
=
>
wasmCompile
(
(
module
(
type
box
(
struct
(
field
val
i32
)
)
)
(
table
(
export
"
tbl
"
)
1
funcref
)
(
elem
(
i32
.
const
0
)
f1
)
(
func
f1
(
param
(
ref
null
box
)
)
(
unreachable
)
)
)
)
WebAssembly
.
CompileError
/
cannot
expose
indexed
reference
type
/
)
;
assertErrorMessage
(
(
)
=
>
wasmCompile
(
(
module
(
type
box
(
struct
(
field
val
i32
)
)
)
(
table
(
export
"
tbl
"
)
1
funcref
)
(
elem
(
i32
.
const
0
)
f1
)
(
func
f1
(
result
(
ref
null
box
)
)
(
ref
.
null
opt
box
)
)
)
)
WebAssembly
.
CompileError
/
cannot
expose
indexed
reference
type
/
)
;
assertEq
(
typeof
wasmCompile
(
(
module
(
table
(
export
"
tbl
"
)
1
funcref
)
(
elem
(
i32
.
const
0
)
f1
)
(
func
f1
(
param
externref
)
(
unreachable
)
)
)
)
"
object
"
)
;
assertEq
(
typeof
wasmCompile
(
(
module
(
table
(
export
"
tbl
"
)
1
funcref
)
(
elem
(
i32
.
const
0
)
f1
)
(
func
f1
(
result
externref
)
(
ref
.
null
extern
)
)
)
)
"
object
"
)
;
assertErrorMessage
(
(
)
=
>
wasmCompile
(
(
module
(
type
box
(
struct
(
field
val
i32
)
)
)
(
import
"
m
"
"
tbl
"
(
table
1
funcref
)
)
(
elem
(
i32
.
const
0
)
f1
)
(
func
f1
(
param
(
ref
null
box
)
)
(
unreachable
)
)
)
)
WebAssembly
.
CompileError
/
cannot
expose
indexed
reference
type
/
)
;
assertErrorMessage
(
(
)
=
>
wasmCompile
(
(
module
(
type
box
(
struct
(
field
val
i32
)
)
)
(
import
"
m
"
"
tbl
"
(
table
1
funcref
)
)
(
elem
(
i32
.
const
0
)
f1
)
(
func
f1
(
result
(
ref
null
box
)
)
(
ref
.
null
opt
box
)
)
)
)
WebAssembly
.
CompileError
/
cannot
expose
indexed
reference
type
/
)
;
assertEq
(
typeof
wasmCompile
(
(
module
(
import
"
m
"
"
tbl
"
(
table
1
funcref
)
)
(
elem
(
i32
.
const
0
)
f1
)
(
func
f1
(
param
externref
)
(
unreachable
)
)
)
)
"
object
"
)
;
assertEq
(
typeof
wasmCompile
(
(
module
(
import
"
m
"
"
tbl
"
(
table
1
funcref
)
)
(
elem
(
i32
.
const
0
)
f1
)
(
func
f1
(
result
externref
)
(
ref
.
null
extern
)
)
)
)
"
object
"
)
;
assertErrorMessage
(
(
)
=
>
wasmCompile
(
(
module
(
type
box
(
struct
(
field
val
i32
)
)
)
(
type
fn
(
func
(
param
(
ref
null
box
)
)
)
)
(
table
(
export
"
tbl
"
)
1
funcref
)
(
func
(
param
i32
)
(
call_indirect
(
type
fn
)
(
ref
.
null
opt
box
)
(
local
.
get
0
)
)
)
)
)
WebAssembly
.
CompileError
/
cannot
expose
indexed
reference
type
/
)
;
assertErrorMessage
(
(
)
=
>
wasmCompile
(
(
module
(
type
box
(
struct
(
field
val
i32
)
)
)
(
type
fn
(
func
(
result
(
ref
null
box
)
)
)
)
(
table
(
export
"
tbl
"
)
1
funcref
)
(
func
(
param
i32
)
(
result
(
ref
null
box
)
)
(
call_indirect
(
type
fn
)
(
local
.
get
0
)
)
)
)
)
WebAssembly
.
CompileError
/
cannot
expose
indexed
reference
type
/
)
;
assertEq
(
typeof
wasmCompile
(
(
module
(
type
fn
(
func
(
param
externref
)
)
)
(
table
(
export
"
tbl
"
)
1
funcref
)
(
func
(
param
i32
)
(
call_indirect
(
type
fn
)
(
ref
.
null
extern
)
(
local
.
get
0
)
)
)
)
)
"
object
"
)
;
assertEq
(
typeof
wasmCompile
(
(
module
(
type
fn
(
func
(
result
externref
)
)
)
(
table
(
export
"
tbl
"
)
1
funcref
)
(
func
(
param
i32
)
(
result
externref
)
(
call_indirect
(
type
fn
)
(
local
.
get
0
)
)
)
)
)
"
object
"
)
;
assertErrorMessage
(
(
)
=
>
wasmCompile
(
(
module
(
type
box
(
struct
(
field
val
i32
)
)
)
(
type
fn
(
func
(
param
(
ref
null
box
)
)
)
)
(
import
"
m
"
"
tbl
"
(
table
1
funcref
)
)
(
func
(
param
i32
)
(
call_indirect
(
type
fn
)
(
ref
.
null
opt
box
)
(
local
.
get
0
)
)
)
)
)
WebAssembly
.
CompileError
/
cannot
expose
indexed
reference
type
/
)
;
assertErrorMessage
(
(
)
=
>
wasmCompile
(
(
module
(
type
box
(
struct
(
field
val
i32
)
)
)
(
type
fn
(
func
(
result
(
ref
null
box
)
)
)
)
(
import
"
m
"
"
tbl
"
(
table
1
funcref
)
)
(
func
(
param
i32
)
(
result
(
ref
null
box
)
)
(
call_indirect
(
type
fn
)
(
local
.
get
0
)
)
)
)
)
WebAssembly
.
CompileError
/
cannot
expose
indexed
reference
type
/
)
;
assertEq
(
typeof
wasmCompile
(
(
module
(
type
fn
(
func
(
param
externref
)
)
)
(
import
"
m
"
"
tbl
"
(
table
1
funcref
)
)
(
func
(
param
i32
)
(
call_indirect
(
type
fn
)
(
ref
.
null
extern
)
(
local
.
get
0
)
)
)
)
)
"
object
"
)
;
assertEq
(
typeof
wasmCompile
(
(
module
(
type
fn
(
func
(
result
externref
)
)
)
(
import
"
m
"
"
tbl
"
(
table
1
funcref
)
)
(
func
(
param
i32
)
(
result
externref
)
(
call_indirect
(
type
fn
)
(
local
.
get
0
)
)
)
)
)
"
object
"
)
;
{
let
m
=
wasmCompile
(
(
module
(
type
box
(
struct
(
field
val
i32
)
)
)
(
type
fn
(
func
(
param
(
ref
null
box
)
)
(
result
i32
)
)
)
(
table
1
funcref
)
(
elem
(
i32
.
const
0
)
f1
)
(
func
f1
(
param
(
ref
null
box
)
)
(
result
i32
)
(
i32
.
const
37
)
)
(
func
(
export
"
f
"
)
(
param
i32
)
(
result
i32
)
(
call_indirect
(
type
fn
)
(
ref
.
null
opt
box
)
(
local
.
get
0
)
)
)
)
)
;
let
i
=
new
WebAssembly
.
Instance
(
m
)
.
exports
;
assertEq
(
i
.
f
(
0
)
37
)
;
}
