gczeal
(
0
)
;
let
s
=
Symbol
(
)
;
addMarkObservers
(
[
s
]
)
;
let
other
=
newGlobal
(
{
newCompartment
:
true
}
)
;
gc
(
)
;
let
index
=
getAtomMarkIndex
(
s
)
;
assertEq
(
getAtomMarkColor
(
this
index
)
'
black
'
)
;
assertEq
(
getAtomMarkColor
(
other
index
)
'
white
'
)
;
assertEq
(
getMarks
(
)
[
0
]
'
black
'
)
;
other
.
s
=
s
;
assertEq
(
getAtomMarkColor
(
other
index
)
'
black
'
)
;
grayRoot
(
)
.
push
(
s
)
;
other
.
s
=
undefined
;
s
=
undefined
;
gc
(
)
;
assertEq
(
getAtomMarkColor
(
this
index
)
'
gray
'
)
;
assertEq
(
getAtomMarkColor
(
other
index
)
'
gray
'
)
;
assertEq
(
getMarks
(
)
[
0
]
'
gray
'
)
;
grayRoot
(
)
.
length
=
0
;
gc
(
)
;
assertEq
(
getAtomMarkColor
(
this
index
)
'
white
'
)
;
assertEq
(
getAtomMarkColor
(
other
index
)
'
white
'
)
;
assertEq
(
getMarks
(
)
[
0
]
'
dead
'
)
;
