#
ifndef
shell_ModuleLoader_h
#
define
shell_ModuleLoader_h
#
include
"
builtin
/
ModuleObject
.
h
"
#
include
"
js
/
RootingAPI
.
h
"
namespace
js
{
namespace
shell
{
class
ModuleLoader
{
public
:
bool
init
(
JSContext
*
cx
HandleString
loadPath
)
;
bool
loadRootModule
(
JSContext
*
cx
HandleString
path
)
;
bool
registerTestModule
(
JSContext
*
cx
HandleObject
moduleRequest
Handle
<
ModuleObject
*
>
module
)
;
void
clearModules
(
JSContext
*
cx
)
;
private
:
static
bool
LoadImportedModule
(
JSContext
*
cx
JS
:
:
Handle
<
JSScript
*
>
referrer
HandleObject
moduleRequest
HandleValue
hostDefined
HandleValue
payload
)
;
static
bool
GetImportMetaProperties
(
JSContext
*
cx
HandleValue
privateValue
HandleObject
metaObject
)
;
static
bool
ImportMetaResolve
(
JSContext
*
cx
unsigned
argc
Value
*
vp
)
;
static
bool
DynamicImportDelayFulfilled
(
JSContext
*
cx
unsigned
argc
Value
*
vp
)
;
static
bool
DynamicImportDelayRejected
(
JSContext
*
cx
unsigned
argc
Value
*
vp
)
;
bool
loadAndExecute
(
JSContext
*
cx
HandleString
path
HandleObject
moduleRequestArg
MutableHandleValue
rval
)
;
bool
loadAndExecute
(
JSContext
*
cx
HandleObject
module
MutableHandleValue
rval
)
;
static
bool
LoadResolved
(
JSContext
*
cx
HandleValue
hostDefined
)
;
static
bool
LoadRejected
(
JSContext
*
cx
HandleValue
hostDefined
HandleValue
error
)
;
bool
loadImportedModule
(
JSContext
*
cx
HandleScript
referrer
HandleObject
moduleRequest
HandleValue
payload
)
;
bool
populateImportMeta
(
JSContext
*
cx
HandleValue
privateValue
HandleObject
metaObject
)
;
bool
importMetaResolve
(
JSContext
*
cx
JS
:
:
Handle
<
JS
:
:
Value
>
referencingPrivate
JS
:
:
Handle
<
JSString
*
>
specifier
JS
:
:
MutableHandle
<
JSString
*
>
urlOut
)
;
bool
dynamicImport
(
JSContext
*
cx
HandleScript
referrer
HandleObject
moduleRequest
HandleValue
payload
)
;
bool
doDynamicImport
(
JSContext
*
cx
HandleScript
referrer
HandleObject
moduleRequest
HandleValue
payload
)
;
JSObject
*
loadAndParse
(
JSContext
*
cx
HandleString
path
HandleObject
moduleRequestArg
)
;
bool
lookupModuleInRegistry
(
JSContext
*
cx
JS
:
:
ModuleType
moduleType
HandleString
path
MutableHandleObject
moduleOut
)
;
bool
addModuleToRegistry
(
JSContext
*
cx
JS
:
:
ModuleType
moduleType
HandleString
path
HandleObject
module
)
;
JSLinearString
*
resolve
(
JSContext
*
cx
HandleObject
moduleRequestArg
HandleScript
referrer
)
;
JSLinearString
*
resolve
(
JSContext
*
cx
HandleString
specifier
HandleValue
referencingInfo
)
;
bool
getScriptPath
(
JSContext
*
cx
HandleValue
privateValue
MutableHandle
<
JSLinearString
*
>
pathOut
)
;
JSLinearString
*
normalizePath
(
JSContext
*
cx
Handle
<
JSLinearString
*
>
path
)
;
JSObject
*
getOrCreateModuleRegistry
(
JSContext
*
cx
JS
:
:
ModuleType
moduleType
)
;
JSString
*
fetchSource
(
JSContext
*
cx
Handle
<
JSLinearString
*
>
path
)
;
JSAtom
*
loadPathStr
=
nullptr
;
JSAtom
*
pathSeparatorStr
=
nullptr
;
enum
{
ModulePrivateSlot
=
0
SlotCount
}
;
static
const
uint32_t
ImportMetaResolveNumArgs
=
1
;
static
const
uint32_t
ImportMetaResolveSpecifierArg
=
0
;
}
JS_HAZ_NON_GC_POINTER
;
}
}
#
endif
