#
ifndef
frontend_AbstractScopePtr_h
#
define
frontend_AbstractScopePtr_h
#
include
"
mozilla
/
Maybe
.
h
"
#
include
"
mozilla
/
Variant
.
h
"
#
include
"
frontend
/
TypedIndex
.
h
"
#
include
"
gc
/
Barrier
.
h
"
#
include
"
gc
/
Rooting
.
h
"
#
include
"
gc
/
Tracer
.
h
"
#
include
"
vm
/
Scope
.
h
"
#
include
"
vm
/
ScopeKind
.
h
"
namespace
js
{
class
Scope
;
class
GlobalScope
;
class
EvalScope
;
struct
MemberInitializers
;
class
GCMarker
;
namespace
frontend
{
struct
CompilationState
;
struct
CompilationGCOutput
;
class
ScopeStencil
;
}
class
ScopeIndex
:
public
frontend
:
:
TypedIndex
<
Scope
>
{
using
Base
=
frontend
:
:
TypedIndex
<
Scope
>
;
using
Base
:
:
Base
;
static
constexpr
uint32_t
InvalidIndex
=
UINT32_MAX
;
public
:
static
constexpr
ScopeIndex
invalid
(
)
{
return
ScopeIndex
(
InvalidIndex
)
;
}
bool
isValid
(
)
const
{
return
index
!
=
InvalidIndex
;
}
}
;
class
AbstractScopePtr
{
private
:
ScopeIndex
index_
;
frontend
:
:
CompilationState
&
compilationState_
;
public
:
friend
class
js
:
:
Scope
;
AbstractScopePtr
(
frontend
:
:
CompilationState
&
compilationState
ScopeIndex
index
)
:
index_
(
index
)
compilationState_
(
compilationState
)
{
}
static
AbstractScopePtr
compilationEnclosingScope
(
frontend
:
:
CompilationState
&
compilationState
)
{
return
AbstractScopePtr
(
compilationState
ScopeIndex
:
:
invalid
(
)
)
;
}
private
:
bool
isScopeStencil
(
)
const
{
return
index_
.
isValid
(
)
;
}
frontend
:
:
ScopeStencil
&
scopeData
(
)
const
;
public
:
template
<
typename
T
>
bool
is
(
)
const
{
static_assert
(
std
:
:
is_base_of_v
<
Scope
T
>
"
Trying
to
ask
about
non
-
Scope
type
"
)
;
return
kind
(
)
=
=
T
:
:
classScopeKind_
;
}
ScopeKind
kind
(
)
const
;
AbstractScopePtr
enclosing
(
)
const
;
bool
hasEnvironment
(
)
const
;
bool
isArrow
(
)
const
;
#
ifdef
DEBUG
bool
hasNonSyntacticScopeOnChain
(
)
const
;
#
endif
}
;
template
<
>
inline
bool
AbstractScopePtr
:
:
is
<
GlobalScope
>
(
)
const
{
return
kind
(
)
=
=
ScopeKind
:
:
Global
|
|
kind
(
)
=
=
ScopeKind
:
:
NonSyntactic
;
}
template
<
>
inline
bool
AbstractScopePtr
:
:
is
<
EvalScope
>
(
)
const
{
return
kind
(
)
=
=
ScopeKind
:
:
Eval
|
|
kind
(
)
=
=
ScopeKind
:
:
StrictEval
;
}
}
#
endif
