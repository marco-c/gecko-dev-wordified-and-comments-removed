#
ifndef
frontend_IfEmitter_h
#
define
frontend_IfEmitter_h
#
include
"
mozilla
/
Attributes
.
h
"
#
include
"
mozilla
/
Maybe
.
h
"
#
include
<
stdint
.
h
>
#
include
"
frontend
/
JumpList
.
h
"
#
include
"
frontend
/
SourceNotes
.
h
"
#
include
"
frontend
/
TDZCheckCache
.
h
"
namespace
js
{
namespace
frontend
{
struct
BytecodeEmitter
;
class
MOZ_STACK_CLASS
IfEmitter
{
public
:
enum
class
Kind
{
MayContainLexicalAccessInBranch
NoLexicalAccessInBranch
}
;
private
:
BytecodeEmitter
*
bce_
;
JumpList
jumpAroundThen_
;
JumpList
jumpsAroundElse_
;
int32_t
thenDepth_
;
Kind
kind_
;
mozilla
:
:
Maybe
<
TDZCheckCache
>
tdzCache_
;
#
ifdef
DEBUG
int32_t
pushed_
;
bool
calculatedPushed_
;
enum
class
State
{
Start
Then
Cond
ThenElse
Else
ElseIf
End
}
;
State
state_
;
#
endif
protected
:
IfEmitter
(
BytecodeEmitter
*
bce
Kind
kind
)
;
public
:
explicit
IfEmitter
(
BytecodeEmitter
*
bce
)
;
MOZ_MUST_USE
bool
emitThen
(
)
;
MOZ_MUST_USE
bool
emitCond
(
)
;
MOZ_MUST_USE
bool
emitThenElse
(
)
;
MOZ_MUST_USE
bool
emitElse
(
)
;
MOZ_MUST_USE
bool
emitElseIf
(
)
;
MOZ_MUST_USE
bool
emitEnd
(
)
;
#
ifdef
DEBUG
int32_t
pushed
(
)
const
{
return
pushed_
;
}
int32_t
popped
(
)
const
{
return
-
pushed_
;
}
#
endif
private
:
MOZ_MUST_USE
bool
emitIfInternal
(
SrcNoteType
type
)
;
void
calculateOrCheckPushed
(
)
;
MOZ_MUST_USE
bool
emitElseInternal
(
)
;
}
;
class
MOZ_STACK_CLASS
InternalIfEmitter
:
public
IfEmitter
{
public
:
explicit
InternalIfEmitter
(
BytecodeEmitter
*
bce
)
;
}
;
}
}
#
endif
