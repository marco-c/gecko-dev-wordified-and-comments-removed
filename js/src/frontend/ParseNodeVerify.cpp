#
include
"
frontend
/
ParseNodeVerify
.
h
"
#
include
"
frontend
/
ParseNodeVisitor
.
h
"
#
include
"
js
/
Stack
.
h
"
using
namespace
js
;
#
ifdef
DEBUG
namespace
js
{
namespace
frontend
{
class
ParseNodeVerifier
:
public
ParseNodeVisitor
<
ParseNodeVerifier
>
{
using
Base
=
ParseNodeVisitor
<
ParseNodeVerifier
>
;
const
LifoAlloc
&
alloc_
;
public
:
ParseNodeVerifier
(
ErrorContext
*
ec
JS
:
:
NativeStackLimit
stackLimit
const
LifoAlloc
&
alloc
)
:
Base
(
ec
stackLimit
)
alloc_
(
alloc
)
{
}
[
[
nodiscard
]
]
bool
visit
(
ParseNode
*
pn
)
{
JS_PARSE_NODE_ASSERT
(
alloc_
.
contains
(
pn
)
"
start
of
parse
node
is
in
alloc
"
)
;
JS_PARSE_NODE_ASSERT
(
alloc_
.
contains
(
(
unsigned
char
*
)
pn
+
pn
-
>
size
(
)
)
"
end
of
parse
node
is
in
alloc
"
)
;
if
(
pn
-
>
is
<
ListNode
>
(
)
)
{
pn
-
>
as
<
ListNode
>
(
)
.
checkConsistency
(
)
;
}
return
Base
:
:
visit
(
pn
)
;
}
}
;
}
}
bool
frontend
:
:
CheckParseTree
(
ErrorContext
*
ec
JS
:
:
NativeStackLimit
stackLimit
const
LifoAlloc
&
alloc
ParseNode
*
pn
)
{
ParseNodeVerifier
verifier
(
ec
stackLimit
alloc
)
;
return
verifier
.
visit
(
pn
)
;
}
#
endif
