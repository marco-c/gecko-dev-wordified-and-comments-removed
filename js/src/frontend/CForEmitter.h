#
ifndef
frontend_CForEmitter_h
#
define
frontend_CForEmitter_h
#
include
"
mozilla
/
Attributes
.
h
"
#
include
"
mozilla
/
Maybe
.
h
"
#
include
<
stdint
.
h
>
#
include
"
frontend
/
BytecodeControlStructures
.
h
"
#
include
"
frontend
/
BytecodeOffset
.
h
"
#
include
"
frontend
/
TDZCheckCache
.
h
"
namespace
js
{
namespace
frontend
{
struct
BytecodeEmitter
;
class
EmitterScope
;
class
MOZ_STACK_CLASS
CForEmitter
{
public
:
enum
class
Cond
{
Missing
Present
}
;
enum
class
Update
{
Missing
Present
}
;
private
:
BytecodeEmitter
*
bce_
;
unsigned
noteIndex_
=
0
;
BytecodeOffset
condOffset_
;
BytecodeOffset
biasedTop_
;
Cond
cond_
=
Cond
:
:
Missing
;
Update
update_
=
Update
:
:
Missing
;
mozilla
:
:
Maybe
<
LoopControl
>
loopInfo_
;
const
EmitterScope
*
headLexicalEmitterScopeForLet_
;
mozilla
:
:
Maybe
<
TDZCheckCache
>
tdzCache_
;
#
ifdef
DEBUG
enum
class
State
{
Start
Init
Body
Update
Cond
End
}
;
State
state_
=
State
:
:
Start
;
#
endif
public
:
CForEmitter
(
BytecodeEmitter
*
bce
const
EmitterScope
*
headLexicalEmitterScopeForLet
)
;
MOZ_MUST_USE
bool
emitInit
(
const
mozilla
:
:
Maybe
<
uint32_t
>
&
initPos
)
;
MOZ_MUST_USE
bool
emitBody
(
Cond
cond
const
mozilla
:
:
Maybe
<
uint32_t
>
&
bodyPos
)
;
MOZ_MUST_USE
bool
emitUpdate
(
Update
update
const
mozilla
:
:
Maybe
<
uint32_t
>
&
updatePos
)
;
MOZ_MUST_USE
bool
emitCond
(
const
mozilla
:
:
Maybe
<
uint32_t
>
&
forPos
const
mozilla
:
:
Maybe
<
uint32_t
>
&
condPos
const
mozilla
:
:
Maybe
<
uint32_t
>
&
endPos
)
;
MOZ_MUST_USE
bool
emitEnd
(
)
;
}
;
}
}
#
endif
