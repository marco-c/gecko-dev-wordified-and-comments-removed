#
ifndef
frontend_BytecodeCompiler_h
#
define
frontend_BytecodeCompiler_h
#
include
"
mozilla
/
Maybe
.
h
"
#
include
"
NamespaceImports
.
h
"
#
include
"
vm
/
Scope
.
h
"
#
include
"
vm
/
String
.
h
"
#
include
"
vm
/
TraceLogging
.
h
"
class
JSLinearString
;
namespace
js
{
class
LazyScript
;
class
LifoAlloc
;
class
ModuleObject
;
class
ScriptSourceObject
;
struct
SourceCompressionTask
;
namespace
frontend
{
class
TokenStream
;
class
FunctionBox
;
class
ParseNode
;
JSScript
*
CompileGlobalScript
(
JSContext
*
cx
LifoAlloc
&
alloc
ScopeKind
scopeKind
const
ReadOnlyCompileOptions
&
options
SourceBufferHolder
&
srcBuf
SourceCompressionTask
*
extraSct
=
nullptr
ScriptSourceObject
*
*
sourceObjectOut
=
nullptr
)
;
JSScript
*
CompileEvalScript
(
JSContext
*
cx
LifoAlloc
&
alloc
HandleObject
scopeChain
HandleScope
enclosingScope
const
ReadOnlyCompileOptions
&
options
SourceBufferHolder
&
srcBuf
SourceCompressionTask
*
extraSct
=
nullptr
ScriptSourceObject
*
*
sourceObjectOut
=
nullptr
)
;
ModuleObject
*
CompileModule
(
JSContext
*
cx
const
ReadOnlyCompileOptions
&
options
SourceBufferHolder
&
srcBuf
)
;
ModuleObject
*
CompileModule
(
JSContext
*
cx
const
ReadOnlyCompileOptions
&
options
SourceBufferHolder
&
srcBuf
LifoAlloc
&
alloc
ScriptSourceObject
*
*
sourceObjectOut
=
nullptr
)
;
MOZ_MUST_USE
bool
CompileLazyFunction
(
JSContext
*
cx
Handle
<
LazyScript
*
>
lazy
const
char16_t
*
chars
size_t
length
)
;
MOZ_MUST_USE
bool
CompileStandaloneFunction
(
JSContext
*
cx
MutableHandleFunction
fun
const
ReadOnlyCompileOptions
&
options
JS
:
:
SourceBufferHolder
&
srcBuf
const
mozilla
:
:
Maybe
<
uint32_t
>
&
parameterListEnd
HandleScope
enclosingScope
=
nullptr
)
;
MOZ_MUST_USE
bool
CompileStandaloneGenerator
(
JSContext
*
cx
MutableHandleFunction
fun
const
ReadOnlyCompileOptions
&
options
JS
:
:
SourceBufferHolder
&
srcBuf
const
mozilla
:
:
Maybe
<
uint32_t
>
&
parameterListEnd
)
;
MOZ_MUST_USE
bool
CompileStandaloneAsyncFunction
(
JSContext
*
cx
MutableHandleFunction
fun
const
ReadOnlyCompileOptions
&
options
JS
:
:
SourceBufferHolder
&
srcBuf
const
mozilla
:
:
Maybe
<
uint32_t
>
&
parameterListEnd
)
;
MOZ_MUST_USE
bool
CompileAsyncFunctionBody
(
JSContext
*
cx
MutableHandleFunction
fun
const
ReadOnlyCompileOptions
&
options
Handle
<
PropertyNameVector
>
formals
JS
:
:
SourceBufferHolder
&
srcBuf
)
;
ScriptSourceObject
*
CreateScriptSourceObject
(
JSContext
*
cx
const
ReadOnlyCompileOptions
&
options
const
mozilla
:
:
Maybe
<
uint32_t
>
&
parameterListEnd
=
mozilla
:
:
Nothing
(
)
)
;
bool
IsIdentifier
(
JSLinearString
*
str
)
;
bool
IsIdentifier
(
const
char16_t
*
chars
size_t
length
)
;
bool
IsKeyword
(
JSLinearString
*
str
)
;
void
TraceParser
(
JSTracer
*
trc
JS
:
:
AutoGCRooter
*
parser
)
;
class
MOZ_STACK_CLASS
AutoFrontendTraceLog
{
#
ifdef
JS_TRACE_LOGGING
TraceLoggerThread
*
logger_
;
mozilla
:
:
Maybe
<
TraceLoggerEvent
>
frontendEvent_
;
mozilla
:
:
Maybe
<
AutoTraceLog
>
frontendLog_
;
mozilla
:
:
Maybe
<
AutoTraceLog
>
typeLog_
;
#
endif
public
:
AutoFrontendTraceLog
(
JSContext
*
cx
const
TraceLoggerTextId
id
const
char
*
filename
size_t
line
size_t
column
)
;
AutoFrontendTraceLog
(
JSContext
*
cx
const
TraceLoggerTextId
id
const
TokenStream
&
tokenStream
)
;
AutoFrontendTraceLog
(
JSContext
*
cx
const
TraceLoggerTextId
id
const
TokenStream
&
tokenStream
FunctionBox
*
funbox
)
;
AutoFrontendTraceLog
(
JSContext
*
cx
const
TraceLoggerTextId
id
const
TokenStream
&
tokenStream
ParseNode
*
pn
)
;
}
;
}
}
#
endif
