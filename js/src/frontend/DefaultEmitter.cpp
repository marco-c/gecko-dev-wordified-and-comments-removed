#
include
"
frontend
/
DefaultEmitter
.
h
"
#
include
"
mozilla
/
Assertions
.
h
"
#
include
"
frontend
/
BytecodeEmitter
.
h
"
#
include
"
vm
/
Opcodes
.
h
"
using
namespace
js
;
using
namespace
js
:
:
frontend
;
using
mozilla
:
:
Nothing
;
DefaultEmitter
:
:
DefaultEmitter
(
BytecodeEmitter
*
bce
)
:
bce_
(
bce
)
{
}
bool
DefaultEmitter
:
:
prepareForDefault
(
)
{
MOZ_ASSERT
(
state_
=
=
State
:
:
Start
)
;
ifUndefined_
.
emplace
(
bce_
)
;
if
(
!
ifUndefined_
-
>
emitIf
(
Nothing
(
)
)
)
{
return
false
;
}
if
(
!
bce_
-
>
emit1
(
JSOp
:
:
Dup
)
)
{
return
false
;
}
ConstantCompareOperand
operand
(
ConstantCompareOperand
:
:
EncodedType
:
:
Undefined
)
;
if
(
!
bce_
-
>
emitUint16Operand
(
JSOp
:
:
StrictConstantEq
operand
.
rawValue
(
)
)
)
{
return
false
;
}
if
(
!
ifUndefined_
-
>
emitThen
(
)
)
{
return
false
;
}
if
(
!
bce_
-
>
emit1
(
JSOp
:
:
Pop
)
)
{
return
false
;
}
#
ifdef
DEBUG
state_
=
State
:
:
Default
;
#
endif
return
true
;
}
bool
DefaultEmitter
:
:
emitEnd
(
)
{
MOZ_ASSERT
(
state_
=
=
State
:
:
Default
)
;
if
(
!
ifUndefined_
-
>
emitEnd
(
)
)
{
return
false
;
}
ifUndefined_
.
reset
(
)
;
#
ifdef
DEBUG
state_
=
State
:
:
End
;
#
endif
return
true
;
}
