#
ifndef
frontend_FunctionCreationData_h
#
define
frontend_FunctionCreationData_h
#
include
"
frontend
/
ParseNode
.
h
"
#
include
"
gc
/
AllocKind
.
h
"
#
include
"
gc
/
Rooting
.
h
"
#
include
"
vm
/
JSFunction
.
h
"
#
include
"
vm
/
JSScript
.
h
"
namespace
js
{
namespace
frontend
{
struct
LazyScriptCreationData
{
frontend
:
:
AtomVector
closedOverBindings
;
FunctionBoxVector
innerFunctionBoxes
;
bool
strict
=
false
;
mozilla
:
:
Maybe
<
FieldInitializers
>
fieldInitializers
;
explicit
LazyScriptCreationData
(
JSContext
*
cx
)
:
innerFunctionBoxes
(
cx
)
{
}
bool
init
(
JSContext
*
cx
const
frontend
:
:
AtomVector
&
COB
FunctionBoxVector
&
innerBoxes
bool
isStrict
)
{
strict
=
isStrict
;
if
(
!
innerFunctionBoxes
.
appendAll
(
innerBoxes
)
)
{
return
false
;
}
if
(
!
closedOverBindings
.
appendAll
(
COB
)
)
{
ReportOutOfMemory
(
cx
)
;
return
false
;
}
return
true
;
}
bool
create
(
JSContext
*
cx
FunctionBox
*
funbox
HandleScriptSourceObject
sourceObject
)
;
}
;
struct
FunctionCreationData
{
FunctionCreationData
(
HandleAtom
atom
FunctionSyntaxKind
kind
GeneratorKind
generatorKind
FunctionAsyncKind
asyncKind
bool
isSelfHosting
=
false
bool
inFunctionBox
=
false
)
;
FunctionCreationData
(
const
FunctionCreationData
&
data
)
:
atom
(
data
.
atom
)
kind
(
data
.
kind
)
generatorKind
(
data
.
generatorKind
)
asyncKind
(
data
.
asyncKind
)
allocKind
(
data
.
allocKind
)
flags
(
data
.
flags
)
isSelfHosting
(
data
.
isSelfHosting
)
lazyScriptData
(
mozilla
:
:
Nothing
(
)
)
{
MOZ_RELEASE_ASSERT
(
!
data
.
lazyScriptData
)
;
}
FunctionCreationData
(
FunctionCreationData
&
&
data
)
=
default
;
JSAtom
*
atom
=
nullptr
;
FunctionSyntaxKind
kind
=
FunctionSyntaxKind
:
:
Expression
;
GeneratorKind
generatorKind
=
GeneratorKind
:
:
NotGenerator
;
FunctionAsyncKind
asyncKind
=
FunctionAsyncKind
:
:
SyncFunction
;
gc
:
:
AllocKind
allocKind
=
gc
:
:
AllocKind
:
:
FUNCTION
;
FunctionFlags
flags
=
{
}
;
bool
isSelfHosting
=
false
;
mozilla
:
:
Maybe
<
LazyScriptCreationData
>
lazyScriptData
;
HandleAtom
getAtom
(
JSContext
*
cx
)
const
;
void
trace
(
JSTracer
*
trc
)
{
TraceNullableRoot
(
trc
&
atom
"
FunctionCreationData
atom
"
)
;
}
}
;
}
}
#
endif
