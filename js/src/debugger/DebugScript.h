#
ifndef
dbg_DebugScript_h
#
define
dbg_DebugScript_h
#
include
<
stddef
.
h
>
#
include
<
stddef
.
h
>
#
include
<
stdint
.
h
>
#
include
"
jsapi
.
h
"
#
include
"
jstypes
.
h
"
namespace
JS
{
class
JS_PUBLIC_API
Realm
;
}
namespace
js
{
class
JSBreakpointSite
;
class
Debugger
;
class
DebugScript
{
friend
class
DebugAPI
;
uint32_t
generatorObserverCount
;
uint32_t
stepperCount
;
uint32_t
numSites
;
JSBreakpointSite
*
breakpoints
[
1
]
;
bool
needed
(
)
const
{
return
generatorObserverCount
>
0
|
|
stepperCount
>
0
|
|
numSites
>
0
;
}
static
size_t
allocSize
(
size_t
codeLength
)
{
return
offsetof
(
DebugScript
breakpoints
)
+
codeLength
*
sizeof
(
JSBreakpointSite
*
)
;
}
void
trace
(
JSTracer
*
trc
JSScript
*
owner
)
;
void
delete_
(
JSFreeOp
*
fop
JSScript
*
owner
)
;
static
DebugScript
*
get
(
JSScript
*
script
)
;
static
DebugScript
*
getOrCreate
(
JSContext
*
cx
JSScript
*
script
)
;
public
:
static
JSBreakpointSite
*
getBreakpointSite
(
JSScript
*
script
jsbytecode
*
pc
)
;
static
JSBreakpointSite
*
getOrCreateBreakpointSite
(
JSContext
*
cx
JSScript
*
script
jsbytecode
*
pc
)
;
static
void
destroyBreakpointSite
(
JSFreeOp
*
fop
JSScript
*
script
jsbytecode
*
pc
)
;
static
void
clearBreakpointsIn
(
JSFreeOp
*
fop
JS
:
:
Realm
*
realm
Debugger
*
dbg
JSObject
*
handler
)
;
static
void
clearBreakpointsIn
(
JSFreeOp
*
fop
JSScript
*
script
Debugger
*
dbg
JSObject
*
handler
)
;
#
ifdef
DEBUG
static
uint32_t
getStepperCount
(
JSScript
*
script
)
;
#
endif
static
MOZ_MUST_USE
bool
incrementStepperCount
(
JSContext
*
cx
JSScript
*
script
)
;
static
void
decrementStepperCount
(
JSFreeOp
*
fop
JSScript
*
script
)
;
static
MOZ_MUST_USE
bool
incrementGeneratorObserverCount
(
JSContext
*
cx
JSScript
*
script
)
;
static
void
decrementGeneratorObserverCount
(
JSFreeOp
*
fop
JSScript
*
script
)
;
}
;
}
#
endif
