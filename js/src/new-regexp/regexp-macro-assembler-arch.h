#
ifndef
RegexpMacroAssemblerArch_h
#
define
RegexpMacroAssemblerArch_h
#
include
"
jit
/
MacroAssembler
.
h
"
#
include
"
new
-
regexp
/
regexp
-
macro
-
assembler
.
h
"
namespace
v8
{
namespace
internal
{
class
SMRegExpMacroAssembler
final
:
public
NativeRegExpMacroAssembler
{
public
:
SMRegExpMacroAssembler
(
JSContext
*
cx
Isolate
*
isolate
js
:
:
jit
:
:
StackMacroAssembler
&
masm
Zone
*
zone
Mode
mode
uint32_t
num_capture_registers
)
;
virtual
~
SMRegExpMacroAssembler
(
)
{
}
virtual
int
stack_limit_slack
(
)
;
virtual
IrregexpImplementation
Implementation
(
)
;
virtual
bool
Succeed
(
)
;
virtual
void
Fail
(
)
;
virtual
void
AdvanceCurrentPosition
(
int
by
)
;
virtual
void
PopCurrentPosition
(
)
;
virtual
void
PushCurrentPosition
(
)
;
virtual
void
Backtrack
(
)
;
virtual
void
Bind
(
Label
*
label
)
;
virtual
void
GoTo
(
Label
*
label
)
;
virtual
void
PushBacktrack
(
Label
*
label
)
;
virtual
void
CheckCharacter
(
uint32_t
c
Label
*
on_equal
)
;
virtual
void
CheckNotCharacter
(
uint32_t
c
Label
*
on_not_equal
)
;
virtual
void
CheckCharacterGT
(
uc16
limit
Label
*
on_greater
)
;
virtual
void
CheckCharacterLT
(
uc16
limit
Label
*
on_less
)
;
virtual
void
CheckCharacterAfterAnd
(
uint32_t
c
uint32_t
mask
Label
*
on_equal
)
;
virtual
void
CheckNotCharacterAfterAnd
(
uint32_t
c
uint32_t
mask
Label
*
on_not_equal
)
;
virtual
void
CheckNotCharacterAfterMinusAnd
(
uc16
c
uc16
minus
uc16
mask
Label
*
on_not_equal
)
;
virtual
void
CheckGreedyLoop
(
Label
*
on_tos_equals_current_position
)
;
virtual
void
CheckCharacterInRange
(
uc16
from
uc16
to
Label
*
on_in_range
)
;
virtual
void
CheckCharacterNotInRange
(
uc16
from
uc16
to
Label
*
on_not_in_range
)
;
private
:
void
Push
(
js
:
:
jit
:
:
Register
value
)
;
void
Pop
(
js
:
:
jit
:
:
Register
target
)
;
void
CheckAtStartImpl
(
int
cp_offset
Label
*
on_cond
js
:
:
jit
:
:
Assembler
:
:
Condition
cond
)
;
void
CheckCharacterImpl
(
js
:
:
jit
:
:
Imm32
c
Label
*
on_cond
js
:
:
jit
:
:
Assembler
:
:
Condition
cond
)
;
void
CheckCharacterAfterAndImpl
(
uint32_t
c
uint32_t
and_with
Label
*
on_cond
bool
negate
)
;
void
CheckCharacterInRangeImpl
(
uc16
from
uc16
to
Label
*
on_cond
js
:
:
jit
:
:
Assembler
:
:
Condition
cond
)
;
void
JumpOrBacktrack
(
Label
*
to
)
;
inline
js
:
:
jit
:
:
Label
*
LabelOrBacktrack
(
Label
*
to
)
{
return
to
?
to
-
>
inner
(
)
:
&
backtrack_label_
;
}
void
CheckBacktrackStackLimit
(
)
;
inline
int
char_size
(
)
{
return
static_cast
<
int
>
(
mode_
)
;
}
inline
js
:
:
jit
:
:
Scale
factor
(
)
{
return
mode_
=
=
UC16
?
js
:
:
jit
:
:
TimesTwo
:
js
:
:
jit
:
:
TimesOne
;
}
JSContext
*
cx_
;
js
:
:
jit
:
:
StackMacroAssembler
&
masm_
;
js
:
:
jit
:
:
Register
current_character_
;
js
:
:
jit
:
:
Register
current_position_
;
js
:
:
jit
:
:
Register
input_end_pointer_
;
js
:
:
jit
:
:
Register
backtrack_stack_pointer_
;
js
:
:
jit
:
:
Register
temp0_
temp1_
temp2_
;
js
:
:
jit
:
:
Label
entry_label_
;
js
:
:
jit
:
:
Label
start_label_
;
js
:
:
jit
:
:
Label
backtrack_label_
;
js
:
:
jit
:
:
Label
success_label_
;
js
:
:
jit
:
:
Label
exit_label_
;
js
:
:
jit
:
:
Label
stack_overflow_label_
;
js
:
:
jit
:
:
Label
exit_with_exception_label_
;
Mode
mode_
;
int
num_registers_
;
int
num_capture_registers_
;
js
:
:
jit
:
:
LiveGeneralRegisterSet
savedRegisters_
;
}
;
}
}
#
endif
