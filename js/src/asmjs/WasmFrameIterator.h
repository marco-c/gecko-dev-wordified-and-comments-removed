#
ifndef
wasm_frame_iterator_h
#
define
wasm_frame_iterator_h
#
include
"
js
/
ProfilingFrameIterator
.
h
"
class
JSAtom
;
namespace
js
{
class
WasmActivation
;
namespace
jit
{
class
MacroAssembler
;
class
Label
;
}
namespace
wasm
{
class
CallSite
;
class
CodeRange
;
class
Module
;
struct
CallThunk
;
struct
FuncOffsets
;
struct
ProfilingOffsets
;
class
FrameIterator
{
JSContext
*
cx_
;
const
Module
*
module_
;
const
CallSite
*
callsite_
;
const
CodeRange
*
codeRange_
;
uint8_t
*
fp_
;
void
settle
(
)
;
public
:
explicit
FrameIterator
(
)
;
explicit
FrameIterator
(
const
WasmActivation
&
activation
)
;
void
operator
+
+
(
)
;
bool
done
(
)
const
{
return
!
fp_
;
}
JSAtom
*
functionDisplayAtom
(
)
const
;
unsigned
lineOrBytecode
(
)
const
;
}
;
enum
class
ExitReason
:
uint32_t
{
None
ImportJit
ImportInterp
Error
Native
}
;
class
ProfilingFrameIterator
{
const
Module
*
module_
;
const
CodeRange
*
codeRange_
;
uint8_t
*
callerFP_
;
void
*
callerPC_
;
void
*
stackAddress_
;
ExitReason
exitReason_
;
void
initFromFP
(
const
WasmActivation
&
activation
)
;
public
:
ProfilingFrameIterator
(
)
;
explicit
ProfilingFrameIterator
(
const
WasmActivation
&
activation
)
;
ProfilingFrameIterator
(
const
WasmActivation
&
activation
const
JS
:
:
ProfilingFrameIterator
:
:
RegisterState
&
state
)
;
void
operator
+
+
(
)
;
bool
done
(
)
const
{
return
!
codeRange_
;
}
void
*
stackAddress
(
)
const
{
MOZ_ASSERT
(
!
done
(
)
)
;
return
stackAddress_
;
}
const
char
*
label
(
)
const
;
}
;
void
GenerateExitPrologue
(
jit
:
:
MacroAssembler
&
masm
unsigned
framePushed
ExitReason
reason
ProfilingOffsets
*
offsets
)
;
void
GenerateExitEpilogue
(
jit
:
:
MacroAssembler
&
masm
unsigned
framePushed
ExitReason
reason
ProfilingOffsets
*
offsets
)
;
void
GenerateFunctionPrologue
(
jit
:
:
MacroAssembler
&
masm
unsigned
framePushed
FuncOffsets
*
offsets
)
;
void
GenerateFunctionEpilogue
(
jit
:
:
MacroAssembler
&
masm
unsigned
framePushed
FuncOffsets
*
offsets
)
;
void
EnableProfilingPrologue
(
const
Module
&
module
const
CallSite
&
callSite
bool
enabled
)
;
void
EnableProfilingThunk
(
const
Module
&
module
const
CallThunk
&
callThunk
bool
enabled
)
;
void
EnableProfilingEpilogue
(
const
Module
&
module
const
CodeRange
&
codeRange
bool
enabled
)
;
}
}
#
endif
