#
ifndef
wasm_compartment_h
#
define
wasm_compartment_h
#
include
"
asmjs
/
WasmJS
.
h
"
namespace
js
{
class
WasmActivation
;
namespace
wasm
{
class
Compartment
{
using
InstanceObjectSet
=
GCHashSet
<
ReadBarriered
<
WasmInstanceObject
*
>
MovableCellHasher
<
ReadBarriered
<
WasmInstanceObject
*
>
>
SystemAllocPolicy
>
;
using
WeakInstanceObjectSet
=
JS
:
:
WeakCache
<
InstanceObjectSet
>
;
WeakInstanceObjectSet
instances_
;
size_t
activationCount_
;
bool
profilingEnabled_
;
friend
class
js
:
:
WasmActivation
;
public
:
explicit
Compartment
(
Zone
*
zone
)
;
~
Compartment
(
)
;
void
trace
(
JSTracer
*
trc
)
;
bool
registerInstance
(
JSContext
*
cx
HandleWasmInstanceObject
instanceObj
)
;
const
WeakInstanceObjectSet
&
instances
(
)
const
{
return
instances_
;
}
bool
ensureProfilingState
(
JSContext
*
cx
)
;
void
addSizeOfExcludingThis
(
mozilla
:
:
MallocSizeOf
mallocSizeOf
size_t
*
compartmentTables
)
;
}
;
}
}
#
endif
