#
include
"
asmjs
/
WasmTable
.
h
"
#
include
"
jscntxt
.
h
"
using
namespace
js
;
using
namespace
js
:
:
wasm
;
SharedTable
Table
:
:
create
(
JSContext
*
cx
const
TableDesc
&
desc
)
{
SharedTable
table
=
cx
-
>
new_
<
Table
>
(
)
;
if
(
!
table
)
return
nullptr
;
table
-
>
array_
.
reset
(
cx
-
>
pod_calloc
<
void
*
>
(
desc
.
initial
)
)
;
if
(
!
table
-
>
array_
)
return
nullptr
;
table
-
>
kind_
=
desc
.
kind
;
table
-
>
length_
=
desc
.
initial
;
table
-
>
initialized_
=
false
;
return
table
;
}
void
Table
:
:
init
(
const
CodeSegment
&
codeSegment
)
{
MOZ_ASSERT
(
!
initialized
(
)
)
;
for
(
uint32_t
i
=
0
;
i
<
length_
;
i
+
+
)
{
MOZ_ASSERT
(
!
array_
.
get
(
)
[
i
]
)
;
array_
.
get
(
)
[
i
]
=
codeSegment
.
badIndirectCallCode
(
)
;
}
initialized_
=
true
;
}
size_t
Table
:
:
sizeOfExcludingThis
(
MallocSizeOf
mallocSizeOf
)
const
{
return
mallocSizeOf
(
array_
.
get
(
)
)
;
}
