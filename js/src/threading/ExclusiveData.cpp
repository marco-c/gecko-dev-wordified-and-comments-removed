#
include
"
threading
/
ExclusiveData
.
h
"
namespace
js
{
mozilla
:
:
Maybe
<
detail
:
:
ExclusiveDataBase
>
detail
:
:
ExclusiveDataBase
:
:
Create
(
)
{
auto
lock
=
PR_NewLock
(
)
;
if
(
!
lock
)
return
mozilla
:
:
Nothing
(
)
;
return
mozilla
:
:
Some
(
detail
:
:
ExclusiveDataBase
(
lock
)
)
;
}
detail
:
:
ExclusiveDataBase
:
:
~
ExclusiveDataBase
(
)
{
if
(
lock_
)
PR_DestroyLock
(
lock_
)
;
}
void
detail
:
:
ExclusiveDataBase
:
:
acquire
(
)
const
{
PR_Lock
(
lock_
)
;
}
void
detail
:
:
ExclusiveDataBase
:
:
release
(
)
const
{
MOZ_RELEASE_ASSERT
(
PR_Unlock
(
lock_
)
=
=
PR_SUCCESS
)
;
}
}
