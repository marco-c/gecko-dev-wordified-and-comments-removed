#
include
"
mozilla
/
Assertions
.
h
"
#
include
"
mozilla
/
DebugOnly
.
h
"
#
include
"
jswin
.
h
"
#
include
"
threading
/
Mutex
.
h
"
#
include
"
threading
/
windows
/
MutexPlatformData
.
h
"
js
:
:
detail
:
:
MutexImpl
:
:
MutexImpl
(
)
{
const
static
DWORD
LockSpinCount
=
1500
;
BOOL
r
=
InitializeCriticalSectionEx
(
&
platformData
(
)
-
>
criticalSection
LockSpinCount
CRITICAL_SECTION_NO_DEBUG_INFO
)
;
MOZ_RELEASE_ASSERT
(
r
)
;
}
js
:
:
detail
:
:
MutexImpl
:
:
~
MutexImpl
(
)
{
DeleteCriticalSection
(
&
platformData
(
)
-
>
criticalSection
)
;
}
void
js
:
:
detail
:
:
MutexImpl
:
:
lock
(
)
{
EnterCriticalSection
(
&
platformData
(
)
-
>
criticalSection
)
;
}
void
js
:
:
detail
:
:
MutexImpl
:
:
unlock
(
)
{
LeaveCriticalSection
(
&
platformData
(
)
-
>
criticalSection
)
;
}
js
:
:
detail
:
:
MutexImpl
:
:
PlatformData
*
js
:
:
detail
:
:
MutexImpl
:
:
platformData
(
)
{
static_assert
(
sizeof
(
platformData_
)
>
=
sizeof
(
PlatformData
)
"
platformData_
is
too
small
"
)
;
return
reinterpret_cast
<
PlatformData
*
>
(
platformData_
)
;
}
