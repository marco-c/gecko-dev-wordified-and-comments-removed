#
include
"
js
/
AllocPolicy
.
h
"
#
include
"
vm
/
ErrorContext
.
h
"
#
include
"
vm
/
JSContext
.
h
"
using
namespace
js
;
void
*
TempAllocPolicy
:
:
onOutOfMemory
(
arena_id_t
arenaId
AllocFunction
allocFunc
size_t
nbytes
void
*
reallocPtr
)
{
void
*
result
;
if
(
hasJSContext
(
)
)
{
result
=
cx
(
)
-
>
onOutOfMemory
(
allocFunc
arenaId
nbytes
reallocPtr
)
;
}
else
{
result
=
fc
(
)
-
>
onOutOfMemory
(
allocFunc
arenaId
nbytes
reallocPtr
)
;
}
return
result
;
}
#
ifdef
DEBUG
void
TempAllocPolicy
:
:
assertNotJSContextOnHelperThread
(
)
const
{
MOZ_ASSERT
(
!
(
hasJSContext
(
)
&
&
cx
(
)
&
&
cx
(
)
-
>
isHelperThreadContext
(
)
)
)
;
}
#
endif
void
TempAllocPolicy
:
:
reportAllocOverflow
(
)
const
{
if
(
hasJSContext
(
)
)
{
ReportAllocationOverflow
(
cx
(
)
)
;
}
else
{
ReportAllocationOverflow
(
fc
(
)
)
;
}
}
