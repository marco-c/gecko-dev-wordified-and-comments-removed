#
ifndef
jit_GraphSpewer_h
#
define
jit_GraphSpewer_h
#
ifdef
JS_JITSPEW
#
include
<
stdio
.
h
>
#
include
"
js
/
TypeDecls
.
h
"
#
include
"
vm
/
JSONPrinter
.
h
"
#
include
"
wasm
/
WasmTypeDef
.
h
"
namespace
js
{
namespace
jit
{
class
BacktrackingAllocator
;
class
MDefinition
;
class
MIRGraph
;
class
MResumePoint
;
class
LNode
;
class
GraphSpewer
:
JSONPrinter
{
private
:
const
wasm
:
:
CodeMetadata
*
wasmCodeMeta_
;
void
beginPass
(
const
char
*
pass
)
;
void
spewMDef
(
MDefinition
*
def
)
;
void
spewMResumePoint
(
MResumePoint
*
rp
)
;
void
spewMIR
(
MIRGraph
*
mir
)
;
void
spewLIns
(
LNode
*
ins
)
;
void
spewLIR
(
MIRGraph
*
mir
)
;
void
spewRanges
(
BacktrackingAllocator
*
regalloc
)
;
void
endPass
(
)
;
public
:
explicit
GraphSpewer
(
GenericPrinter
&
out
const
wasm
:
:
CodeMetadata
*
wasmCodeMeta
=
nullptr
)
:
JSONPrinter
(
out
)
wasmCodeMeta_
(
wasmCodeMeta
)
{
}
void
beginFunction
(
JSScript
*
script
)
;
void
beginWasmFunction
(
unsigned
funcIndex
)
;
void
beginAnonFunction
(
)
;
void
spewPass
(
const
char
*
pass
MIRGraph
*
graph
BacktrackingAllocator
*
ra
=
nullptr
)
;
void
endFunction
(
)
;
}
;
using
UniqueGraphSpewer
=
UniquePtr
<
GraphSpewer
>
;
}
}
#
endif
#
endif
