#
ifndef
jit_arm64_CodeGenerator_arm64_h
#
define
jit_arm64_CodeGenerator_arm64_h
#
include
"
jit
/
arm64
/
Assembler
-
arm64
.
h
"
#
include
"
jit
/
shared
/
CodeGenerator
-
shared
.
h
"
namespace
js
{
namespace
jit
{
class
CodeGeneratorARM64
;
class
OutOfLineBailout
;
class
OutOfLineTableSwitch
;
using
OutOfLineWasmTruncateCheck
=
OutOfLineWasmTruncateCheckBase
<
CodeGeneratorARM64
>
;
class
CodeGeneratorARM64
:
public
CodeGeneratorShared
{
friend
class
MoveResolverARM64
;
protected
:
CodeGeneratorARM64
(
MIRGenerator
*
gen
LIRGraph
*
graph
MacroAssembler
*
masm
)
;
NonAssertingLabel
deoptLabel_
;
MoveOperand
toMoveOperand
(
const
LAllocation
a
)
const
;
void
bailoutIf
(
Assembler
:
:
Condition
condition
LSnapshot
*
snapshot
)
;
void
bailoutFrom
(
Label
*
label
LSnapshot
*
snapshot
)
;
void
bailout
(
LSnapshot
*
snapshot
)
;
template
<
typename
T1
typename
T2
>
void
bailoutCmpPtr
(
Assembler
:
:
Condition
c
T1
lhs
T2
rhs
LSnapshot
*
snapshot
)
{
masm
.
cmpPtr
(
lhs
rhs
)
;
return
bailoutIf
(
c
snapshot
)
;
}
void
bailoutTestPtr
(
Assembler
:
:
Condition
c
Register
lhs
Register
rhs
LSnapshot
*
snapshot
)
{
masm
.
testPtr
(
lhs
rhs
)
;
return
bailoutIf
(
c
snapshot
)
;
}
template
<
typename
T1
typename
T2
>
void
bailoutCmp32
(
Assembler
:
:
Condition
c
T1
lhs
T2
rhs
LSnapshot
*
snapshot
)
{
masm
.
cmp32
(
lhs
rhs
)
;
return
bailoutIf
(
c
snapshot
)
;
}
template
<
typename
T1
typename
T2
>
void
bailoutTest32
(
Assembler
:
:
Condition
c
T1
lhs
T2
rhs
LSnapshot
*
snapshot
)
{
masm
.
test32
(
lhs
rhs
)
;
return
bailoutIf
(
c
snapshot
)
;
}
void
bailoutIfFalseBool
(
Register
reg
LSnapshot
*
snapshot
)
{
masm
.
test32
(
reg
Imm32
(
0xFF
)
)
;
return
bailoutIf
(
Assembler
:
:
Zero
snapshot
)
;
}
bool
generateOutOfLineCode
(
)
;
void
emitBranch
(
Assembler
:
:
Condition
cond
MBasicBlock
*
ifTrue
MBasicBlock
*
ifFalse
)
;
void
emitTableSwitchDispatch
(
MTableSwitch
*
mir
Register
index
Register
base
)
;
void
emitBigIntPtrDiv
(
LBigIntPtrDiv
*
ins
Register
dividend
Register
divisor
Register
output
)
;
void
emitBigIntPtrMod
(
LBigIntPtrMod
*
ins
Register
dividend
Register
divisor
Register
output
)
;
void
emitSimpleBinaryI64
(
LInstructionHelper
<
INT64_PIECES
2
*
INT64_PIECES
0
>
*
lir
JSOp
op
)
;
ValueOperand
ToValue
(
LInstruction
*
ins
size_t
pos
)
;
ValueOperand
ToTempValue
(
LInstruction
*
ins
size_t
pos
)
;
void
generateInvalidateEpilogue
(
)
;
public
:
void
visitOutOfLineBailout
(
OutOfLineBailout
*
ool
)
;
void
visitOutOfLineTableSwitch
(
OutOfLineTableSwitch
*
ool
)
;
void
visitOutOfLineWasmTruncateCheck
(
OutOfLineWasmTruncateCheck
*
ool
)
;
}
;
using
CodeGeneratorSpecific
=
CodeGeneratorARM64
;
class
OutOfLineBailout
:
public
OutOfLineCodeBase
<
CodeGeneratorARM64
>
{
protected
:
LSnapshot
*
snapshot_
;
public
:
explicit
OutOfLineBailout
(
LSnapshot
*
snapshot
)
:
snapshot_
(
snapshot
)
{
}
void
accept
(
CodeGeneratorARM64
*
codegen
)
override
;
LSnapshot
*
snapshot
(
)
const
{
return
snapshot_
;
}
}
;
}
}
#
endif
