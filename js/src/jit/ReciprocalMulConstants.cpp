#
include
"
jit
/
ReciprocalMulConstants
.
h
"
using
namespace
js
:
:
jit
;
ReciprocalMulConstants
ReciprocalMulConstants
:
:
computeDivisionConstants
(
uint32_t
d
int
maxLog
)
{
MOZ_ASSERT
(
maxLog
>
=
2
&
&
maxLog
<
=
32
)
;
MOZ_ASSERT
(
d
<
(
uint64_t
(
1
)
<
<
maxLog
)
&
&
(
d
&
(
d
-
1
)
)
!
=
0
)
;
int32_t
p
=
32
;
while
(
(
uint64_t
(
1
)
<
<
(
p
-
maxLog
)
)
+
(
UINT64_MAX
>
>
(
64
-
p
)
)
%
d
+
1
<
d
)
{
p
+
+
;
}
ReciprocalMulConstants
rmc
;
rmc
.
multiplier
=
(
UINT64_MAX
>
>
(
64
-
p
)
)
/
d
+
1
;
rmc
.
shiftAmount
=
p
-
32
;
return
rmc
;
}
