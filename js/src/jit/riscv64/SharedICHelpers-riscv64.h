#
ifndef
jit_riscv64_SharedICHelpers_riscv64_h
#
define
jit_riscv64_SharedICHelpers_riscv64_h
#
include
"
jit
/
BaselineIC
.
h
"
#
include
"
jit
/
JitFrames
.
h
"
#
include
"
jit
/
MacroAssembler
.
h
"
#
include
"
jit
/
SharedICRegisters
.
h
"
namespace
js
{
namespace
jit
{
static
const
size_t
ICStackValueOffset
=
0
;
inline
void
EmitRestoreTailCallReg
(
MacroAssembler
&
masm
)
{
}
inline
void
EmitRepushTailCallReg
(
MacroAssembler
&
masm
)
{
}
inline
void
EmitCallIC
(
MacroAssembler
&
masm
CodeOffset
*
callOffset
)
{
masm
.
loadPtr
(
Address
(
ICStubReg
ICStub
:
:
offsetOfStubCode
(
)
)
R2
.
scratchReg
(
)
)
;
masm
.
call
(
R2
.
scratchReg
(
)
)
;
*
callOffset
=
CodeOffset
(
masm
.
currentOffset
(
)
)
;
}
inline
void
EmitReturnFromIC
(
MacroAssembler
&
masm
)
{
masm
.
branch
(
ra
)
;
}
inline
void
EmitBaselineLeaveStubFrame
(
MacroAssembler
&
masm
)
{
masm
.
loadPtr
(
Address
(
FramePointer
BaselineStubFrameLayout
:
:
ICStubOffsetFromFP
)
ICStubReg
)
;
masm
.
movePtr
(
FramePointer
StackPointer
)
;
masm
.
Pop
(
FramePointer
)
;
masm
.
Pop
(
ICTailCallReg
)
;
{
UseScratchRegisterScope
temps
(
&
masm
)
;
Register
scratch2
=
temps
.
Acquire
(
)
;
masm
.
Pop
(
scratch2
)
;
}
masm
.
checkStackAlignment
(
)
;
}
inline
void
EmitStubGuardFailure
(
MacroAssembler
&
masm
)
{
masm
.
loadPtr
(
Address
(
ICStubReg
ICCacheIRStub
:
:
offsetOfNext
(
)
)
ICStubReg
)
;
MOZ_ASSERT
(
ICTailCallReg
=
=
ra
)
;
masm
.
jump
(
Address
(
ICStubReg
ICStub
:
:
offsetOfStubCode
(
)
)
)
;
}
template
<
typename
AddrType
>
inline
void
EmitPreBarrier
(
MacroAssembler
&
masm
const
AddrType
&
addr
MIRType
type
)
{
masm
.
push
(
ra
)
;
masm
.
guardedCallPreBarrier
(
addr
type
)
;
masm
.
pop
(
ra
)
;
}
}
}
#
endif
