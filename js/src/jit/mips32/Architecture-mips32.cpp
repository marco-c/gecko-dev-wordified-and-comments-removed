#
include
"
jit
/
mips32
/
Architecture
-
mips32
.
h
"
#
include
"
jit
/
RegisterSets
.
h
"
namespace
js
{
namespace
jit
{
FloatRegisters
:
:
Code
FloatRegisters
:
:
FromName
(
const
char
*
name
)
{
for
(
size_t
i
=
0
;
i
<
Total
;
i
+
+
)
{
if
(
strcmp
(
GetName
(
i
)
name
)
=
=
0
)
return
Code
(
i
)
;
}
return
Invalid
;
}
FloatRegister
FloatRegister
:
:
doubleOverlay
(
unsigned
int
which
)
const
{
MOZ_ASSERT
(
!
isInvalid
(
)
)
;
if
(
kind_
!
=
Double
)
return
FloatRegister
(
code_
&
~
1
Double
)
;
return
*
this
;
}
FloatRegister
FloatRegister
:
:
singleOverlay
(
unsigned
int
which
)
const
{
MOZ_ASSERT
(
!
isInvalid
(
)
)
;
if
(
kind_
=
=
Double
)
{
MOZ_ASSERT
(
code_
%
2
=
=
0
)
;
MOZ_ASSERT
(
which
<
2
)
;
return
FloatRegister
(
code_
+
which
Single
)
;
}
MOZ_ASSERT
(
which
=
=
0
)
;
return
FloatRegister
(
code_
Single
)
;
}
FloatRegisterSet
FloatRegister
:
:
ReduceSetForPush
(
const
FloatRegisterSet
&
s
)
{
LiveFloatRegisterSet
mod
;
for
(
FloatRegisterIterator
iter
(
s
)
;
iter
.
more
(
)
;
iter
+
+
)
{
if
(
(
*
iter
)
.
isSingle
(
)
)
{
mod
.
addUnchecked
(
(
*
iter
)
.
doubleOverlay
(
)
)
;
}
else
{
mod
.
addUnchecked
(
*
iter
)
;
}
}
return
mod
.
set
(
)
;
}
uint32_t
FloatRegister
:
:
GetPushSizeInBytes
(
const
FloatRegisterSet
&
s
)
{
FloatRegisterSet
ss
=
s
.
reduceSetForPush
(
)
;
uint64_t
bits
=
ss
.
bits
(
)
;
MOZ_ASSERT
(
(
bits
&
0xffffffff
)
=
=
0
)
;
uint32_t
ret
=
mozilla
:
:
CountPopulation32
(
bits
>
>
32
)
*
sizeof
(
double
)
;
return
ret
;
}
uint32_t
FloatRegister
:
:
getRegisterDumpOffsetInBytes
(
)
{
if
(
isSingle
(
)
)
return
id
(
)
*
sizeof
(
float
)
;
if
(
isDouble
(
)
)
return
id
(
)
*
sizeof
(
double
)
;
MOZ_CRASH
(
)
;
}
}
}
