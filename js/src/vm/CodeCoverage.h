#
ifndef
vm_CodeCoverage_h
#
define
vm_CodeCoverage_h
#
include
"
mozilla
/
Vector
.
h
"
#
include
"
ds
/
LifoAlloc
.
h
"
#
include
"
vm
/
Printer
.
h
"
struct
JSCompartment
;
class
JSScript
;
namespace
js
{
namespace
coverage
{
class
LCovCompartment
;
class
LCovSource
{
public
:
explicit
LCovSource
(
LifoAlloc
*
alloc
)
;
bool
writeTopLevelScript
(
JSScript
*
script
)
;
void
exportInto
(
GenericPrinter
&
out
)
const
;
private
:
bool
writeSourceFilename
(
LSprinter
&
out
JSScript
*
script
)
;
bool
writeScriptName
(
LSprinter
&
out
JSScript
*
script
)
;
bool
writeScript
(
JSScript
*
script
)
;
private
:
LSprinter
outSF_
;
LSprinter
outFN_
;
LSprinter
outFNDA_
;
size_t
numFunctionsFound_
;
size_t
numFunctionsHit_
;
LSprinter
outBRDA_
;
size_t
numBranchesFound_
;
size_t
numBranchesHit_
;
LSprinter
outDA_
;
size_t
numLinesInstrumented_
;
size_t
numLinesHit_
;
}
;
class
LCovCompartment
{
public
:
LCovCompartment
(
)
;
void
collectCodeCoverageInfo
(
JSCompartment
*
comp
JSScript
*
topLevel
)
;
void
exportInto
(
GenericPrinter
&
out
)
const
;
private
:
bool
writeCompartmentName
(
JSCompartment
*
comp
)
;
private
:
typedef
Vector
<
LCovSource
16
LifoAllocPolicy
<
Fallible
>
>
LCovSourceVector
;
LifoAlloc
alloc_
;
LSprinter
outTN_
;
LCovSourceVector
*
sources_
;
}
;
}
}
#
endif
