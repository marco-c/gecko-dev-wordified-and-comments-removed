#
include
"
vm
/
PlainObject
-
inl
.
h
"
#
include
"
mozilla
/
Assertions
.
h
"
#
include
"
jspubtd
.
h
"
#
include
"
gc
/
AllocKind
.
h
"
#
include
"
vm
/
JSContext
.
h
"
#
include
"
vm
/
JSFunction
.
h
"
#
include
"
vm
/
JSObject
.
h
"
#
include
"
vm
/
ObjectGroup
.
h
"
#
include
"
vm
/
TaggedProto
.
h
"
#
include
"
vm
/
JSObject
-
inl
.
h
"
using
JS
:
:
Handle
;
using
JS
:
:
Rooted
;
using
js
:
:
PlainObject
;
PlainObject
*
js
:
:
CreateThisForFunction
(
JSContext
*
cx
Handle
<
JSFunction
*
>
callee
Handle
<
JSObject
*
>
newTarget
NewObjectKind
newKind
)
{
MOZ_ASSERT
(
cx
-
>
realm
(
)
=
=
callee
-
>
realm
(
)
)
;
MOZ_ASSERT
(
!
callee
-
>
constructorNeedsUninitializedThis
(
)
)
;
Rooted
<
JSObject
*
>
proto
(
cx
)
;
if
(
!
GetPrototypeFromConstructor
(
cx
newTarget
JSProto_Object
&
proto
)
)
{
return
nullptr
;
}
PlainObject
*
res
;
if
(
proto
)
{
Rooted
<
ObjectGroup
*
>
group
(
cx
ObjectGroup
:
:
defaultNewGroup
(
cx
&
PlainObject
:
:
class_
TaggedProto
(
proto
)
)
)
;
if
(
!
group
)
{
return
nullptr
;
}
js
:
:
gc
:
:
AllocKind
allocKind
=
NewObjectGCKind
(
)
;
res
=
NewObjectWithGroup
<
PlainObject
>
(
cx
group
allocKind
newKind
)
;
}
else
{
res
=
NewBuiltinClassInstanceWithKind
<
PlainObject
>
(
cx
newKind
)
;
}
MOZ_ASSERT_IF
(
res
res
-
>
nonCCWRealm
(
)
=
=
callee
-
>
realm
(
)
)
;
return
res
;
}
