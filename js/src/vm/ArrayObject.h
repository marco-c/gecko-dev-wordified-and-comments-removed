#
ifndef
vm_ArrayObject_h
#
define
vm_ArrayObject_h
#
include
"
vm
/
NativeObject
.
h
"
namespace
js
{
class
AutoSetNewObjectMetadata
;
class
ArrayObject
:
public
NativeObject
{
public
:
static
const
uint32_t
EagerAllocationMaxLength
=
(
1
<
<
16
)
-
ObjectElements
:
:
VALUES_PER_HEADER
-
1
;
static
const
JSClass
class_
;
bool
lengthIsWritable
(
)
const
{
return
!
getElementsHeader
(
)
-
>
hasNonwritableArrayLength
(
)
;
}
uint32_t
length
(
)
const
{
return
getElementsHeader
(
)
-
>
length
;
}
void
setNonWritableLength
(
JSContext
*
cx
)
{
shrinkCapacityToInitializedLength
(
cx
)
;
getElementsHeader
(
)
-
>
setNonwritableArrayLength
(
)
;
}
void
setLength
(
uint32_t
length
)
{
MOZ_ASSERT
(
lengthIsWritable
(
)
)
;
MOZ_ASSERT_IF
(
length
!
=
getElementsHeader
(
)
-
>
length
!
denseElementsAreFrozen
(
)
)
;
getElementsHeader
(
)
-
>
length
=
length
;
}
inline
DenseElementResult
addDenseElementNoLengthChange
(
JSContext
*
cx
uint32_t
index
const
Value
&
val
)
;
static
MOZ_ALWAYS_INLINE
ArrayObject
*
create
(
JSContext
*
cx
gc
:
:
AllocKind
kind
gc
:
:
Heap
heap
Handle
<
SharedShape
*
>
shape
uint32_t
length
uint32_t
slotSpan
AutoSetNewObjectMetadata
&
metadata
gc
:
:
AllocSite
*
site
=
nullptr
)
;
}
;
}
#
endif
