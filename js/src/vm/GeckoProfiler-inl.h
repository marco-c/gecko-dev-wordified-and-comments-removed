#
ifndef
vm_GeckoProfiler_inl_h
#
define
vm_GeckoProfiler_inl_h
#
include
"
vm
/
GeckoProfiler
.
h
"
#
include
"
jscntxt
.
h
"
#
include
"
vm
/
Runtime
.
h
"
namespace
js
{
inline
void
GeckoProfilerThread
:
:
updatePC
(
JSContext
*
cx
JSScript
*
script
jsbytecode
*
pc
)
{
if
(
!
cx
-
>
runtime
(
)
-
>
geckoProfiler
(
)
.
enabled
(
)
)
return
;
uint32_t
sp
=
pseudoStack_
-
>
stackPointer
;
if
(
sp
-
1
<
PseudoStack
:
:
MaxEntries
)
{
MOZ_ASSERT
(
sp
>
0
)
;
MOZ_ASSERT
(
pseudoStack_
-
>
entries
[
sp
-
1
]
.
rawScript
(
)
=
=
script
)
;
pseudoStack_
-
>
entries
[
sp
-
1
]
.
setPC
(
pc
)
;
}
}
class
MOZ_RAII
AutoSuppressProfilerSampling
{
public
:
explicit
AutoSuppressProfilerSampling
(
JSContext
*
cx
MOZ_GUARD_OBJECT_NOTIFIER_PARAM
)
;
~
AutoSuppressProfilerSampling
(
)
;
private
:
JSContext
*
cx_
;
bool
previouslyEnabled_
;
JSRuntime
:
:
AutoProhibitActiveContextChange
prohibitContextChange_
;
MOZ_DECL_USE_GUARD_OBJECT_NOTIFIER
}
;
}
#
endif
