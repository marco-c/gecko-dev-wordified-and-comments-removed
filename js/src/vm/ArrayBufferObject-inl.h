#
ifndef
vm_ArrayBufferObject_inl_h
#
define
vm_ArrayBufferObject_inl_h
#
include
"
vm
/
ArrayBufferObject
.
h
"
#
include
"
js
/
Value
.
h
"
#
include
"
vm
/
SharedArrayObject
.
h
"
#
include
"
vm
/
SharedMem
.
h
"
namespace
js
{
inline
SharedMem
<
uint8_t
*
>
ArrayBufferObjectMaybeShared
:
:
dataPointerEither
(
)
{
ArrayBufferObjectMaybeShared
*
buf
=
this
;
if
(
buf
-
>
is
<
ArrayBufferObject
>
(
)
)
return
buf
-
>
as
<
ArrayBufferObject
>
(
)
.
dataPointerShared
(
)
;
return
buf
-
>
as
<
SharedArrayBufferObject
>
(
)
.
dataPointerShared
(
)
;
}
inline
bool
ArrayBufferObjectMaybeShared
:
:
isDetached
(
)
const
{
if
(
this
-
>
is
<
ArrayBufferObject
>
(
)
)
return
this
-
>
as
<
ArrayBufferObject
>
(
)
.
isDetached
(
)
;
return
false
;
}
inline
uint32_t
AnyArrayBufferByteLength
(
const
ArrayBufferObjectMaybeShared
*
buf
)
{
if
(
buf
-
>
is
<
ArrayBufferObject
>
(
)
)
return
buf
-
>
as
<
ArrayBufferObject
>
(
)
.
byteLength
(
)
;
return
buf
-
>
as
<
SharedArrayBufferObject
>
(
)
.
byteLength
(
)
;
}
inline
size_t
WasmArrayBufferMappedSize
(
const
ArrayBufferObjectMaybeShared
*
buf
)
{
if
(
buf
-
>
is
<
ArrayBufferObject
>
(
)
)
return
buf
-
>
as
<
ArrayBufferObject
>
(
)
.
wasmMappedSize
(
)
;
#
ifdef
WASM_HUGE_MEMORY
return
wasm
:
:
HugeMappedSize
;
#
else
return
buf
-
>
as
<
SharedArrayBufferObject
>
(
)
.
byteLength
(
)
;
#
endif
}
inline
mozilla
:
:
Maybe
<
uint32_t
>
WasmArrayBufferMaxSize
(
const
ArrayBufferObjectMaybeShared
*
buf
)
{
if
(
buf
-
>
is
<
ArrayBufferObject
>
(
)
)
return
buf
-
>
as
<
ArrayBufferObject
>
(
)
.
wasmMaxSize
(
)
;
return
mozilla
:
:
Some
(
buf
-
>
as
<
SharedArrayBufferObject
>
(
)
.
byteLength
(
)
)
;
}
inline
bool
AnyArrayBufferIsPreparedForAsmJS
(
const
ArrayBufferObjectMaybeShared
*
buf
)
{
if
(
buf
-
>
is
<
ArrayBufferObject
>
(
)
)
return
buf
-
>
as
<
ArrayBufferObject
>
(
)
.
isPreparedForAsmJS
(
)
;
return
buf
-
>
as
<
SharedArrayBufferObject
>
(
)
.
isPreparedForAsmJS
(
)
;
}
inline
ArrayBufferObjectMaybeShared
&
AsAnyArrayBuffer
(
HandleValue
val
)
{
if
(
val
.
toObject
(
)
.
is
<
ArrayBufferObject
>
(
)
)
return
val
.
toObject
(
)
.
as
<
ArrayBufferObject
>
(
)
;
return
val
.
toObject
(
)
.
as
<
SharedArrayBufferObject
>
(
)
;
}
}
#
endif
