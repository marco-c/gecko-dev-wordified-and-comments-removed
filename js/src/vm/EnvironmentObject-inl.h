#
ifndef
vm_EnvironmentObject_inl_h
#
define
vm_EnvironmentObject_inl_h
#
include
"
vm
/
EnvironmentObject
.
h
"
#
include
"
vm
/
JSObject
-
inl
.
h
"
#
include
"
vm
/
TypeInference
-
inl
.
h
"
namespace
js
{
inline
LexicalEnvironmentObject
&
NearestEnclosingExtensibleLexicalEnvironment
(
JSObject
*
env
)
{
MOZ_ASSERT
(
env
)
;
while
(
!
IsExtensibleLexicalEnvironment
(
env
)
)
{
env
=
env
-
>
enclosingEnvironment
(
)
;
MOZ_ASSERT
(
env
)
;
}
return
env
-
>
as
<
LexicalEnvironmentObject
>
(
)
;
}
inline
JSObject
&
GetVariablesObject
(
JSObject
*
envChain
)
{
while
(
!
envChain
-
>
isQualifiedVarObj
(
)
)
{
envChain
=
envChain
-
>
enclosingEnvironment
(
)
;
}
MOZ_ASSERT
(
envChain
)
;
return
*
envChain
;
}
inline
const
Value
&
EnvironmentObject
:
:
aliasedBinding
(
EnvironmentCoordinate
ec
)
{
MOZ_ASSERT
(
!
IsExtensibleLexicalEnvironment
(
this
)
)
;
MOZ_ASSERT
(
nonExtensibleIsFixedSlot
(
ec
)
=
=
NativeObject
:
:
isFixedSlot
(
ec
.
slot
(
)
)
)
;
return
getSlot
(
ec
.
slot
(
)
)
;
}
inline
void
EnvironmentObject
:
:
setAliasedBinding
(
JSContext
*
cx
uint32_t
slot
const
Value
&
v
)
{
MOZ_ASSERT
(
!
isSingleton
(
)
)
;
setSlot
(
slot
v
)
;
}
inline
void
EnvironmentObject
:
:
setAliasedBinding
(
JSContext
*
cx
EnvironmentCoordinate
ec
const
Value
&
v
)
{
MOZ_ASSERT
(
!
IsExtensibleLexicalEnvironment
(
this
)
)
;
MOZ_ASSERT
(
nonExtensibleIsFixedSlot
(
ec
)
=
=
NativeObject
:
:
isFixedSlot
(
ec
.
slot
(
)
)
)
;
setAliasedBinding
(
cx
ec
.
slot
(
)
v
)
;
}
inline
void
EnvironmentObject
:
:
setAliasedBinding
(
JSContext
*
cx
const
BindingIter
&
bi
const
Value
&
v
)
{
MOZ_ASSERT
(
bi
.
location
(
)
.
kind
(
)
=
=
BindingLocation
:
:
Kind
:
:
Environment
)
;
setAliasedBinding
(
cx
bi
.
location
(
)
.
slot
(
)
v
)
;
}
inline
void
CallObject
:
:
setAliasedFormalFromArguments
(
const
Value
&
argsValue
const
Value
&
v
)
{
setSlot
(
ArgumentsObject
:
:
SlotFromMagicScopeSlotValue
(
argsValue
)
v
)
;
}
}
inline
JSObject
*
JSObject
:
:
enclosingEnvironment
(
)
const
{
if
(
is
<
js
:
:
EnvironmentObject
>
(
)
)
{
return
&
as
<
js
:
:
EnvironmentObject
>
(
)
.
enclosingEnvironment
(
)
;
}
if
(
is
<
js
:
:
DebugEnvironmentProxy
>
(
)
)
{
return
&
as
<
js
:
:
DebugEnvironmentProxy
>
(
)
.
enclosingEnvironment
(
)
;
}
if
(
is
<
js
:
:
GlobalObject
>
(
)
)
{
return
nullptr
;
}
MOZ_ASSERT_IF
(
is
<
JSFunction
>
(
)
as
<
JSFunction
>
(
)
.
isInterpreted
(
)
)
;
return
&
nonCCWGlobal
(
)
;
}
#
endif
