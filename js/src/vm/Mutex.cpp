#
include
"
vm
/
Mutex
.
h
"
namespace
js
{
mozilla
:
:
Maybe
<
detail
:
:
MutexBase
>
detail
:
:
MutexBase
:
:
Create
(
)
{
auto
lock
=
PR_NewLock
(
)
;
if
(
!
lock
)
return
mozilla
:
:
Nothing
(
)
;
return
mozilla
:
:
Some
(
detail
:
:
MutexBase
(
lock
)
)
;
}
detail
:
:
MutexBase
:
:
~
MutexBase
(
)
{
if
(
lock_
)
PR_DestroyLock
(
lock_
)
;
}
void
detail
:
:
MutexBase
:
:
acquire
(
)
const
{
PR_Lock
(
lock_
)
;
}
void
detail
:
:
MutexBase
:
:
release
(
)
const
{
MOZ_RELEASE_ASSERT
(
PR_Unlock
(
lock_
)
=
=
PR_SUCCESS
)
;
}
}
