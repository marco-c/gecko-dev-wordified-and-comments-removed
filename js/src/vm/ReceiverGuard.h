#
ifndef
vm_ReceiverGuard_h
#
define
vm_ReceiverGuard_h
#
include
"
vm
/
Shape
.
h
"
namespace
js
{
class
HeapReceiverGuard
;
class
ReceiverGuard
{
public
:
ObjectGroup
*
group
;
Shape
*
shape
;
ReceiverGuard
(
)
:
group
(
nullptr
)
shape
(
nullptr
)
{
}
inline
MOZ_IMPLICIT
ReceiverGuard
(
const
HeapReceiverGuard
&
guard
)
;
explicit
MOZ_ALWAYS_INLINE
ReceiverGuard
(
JSObject
*
obj
)
;
MOZ_ALWAYS_INLINE
ReceiverGuard
(
ObjectGroup
*
group
Shape
*
shape
)
;
bool
operator
=
=
(
const
ReceiverGuard
&
other
)
const
{
return
group
=
=
other
.
group
&
&
shape
=
=
other
.
shape
;
}
bool
operator
!
=
(
const
ReceiverGuard
&
other
)
const
{
return
!
(
*
this
=
=
other
)
;
}
uintptr_t
hash
(
)
const
{
return
(
uintptr_t
(
group
)
>
>
3
)
^
(
uintptr_t
(
shape
)
>
>
3
)
;
}
}
;
class
HeapReceiverGuard
{
GCPtrObjectGroup
group_
;
GCPtrShape
shape_
;
public
:
explicit
HeapReceiverGuard
(
const
ReceiverGuard
&
guard
)
:
group_
(
guard
.
group
)
shape_
(
guard
.
shape
)
{
}
void
init
(
const
ReceiverGuard
&
other
)
{
group_
.
init
(
other
.
group
)
;
shape_
.
init
(
other
.
shape
)
;
}
void
trace
(
JSTracer
*
trc
)
;
Shape
*
shape
(
)
const
{
return
shape_
;
}
ObjectGroup
*
group
(
)
const
{
return
group_
;
}
}
;
inline
ReceiverGuard
:
:
ReceiverGuard
(
const
HeapReceiverGuard
&
guard
)
:
group
(
guard
.
group
(
)
)
shape
(
guard
.
shape
(
)
)
{
}
}
#
endif
