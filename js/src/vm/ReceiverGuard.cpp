#
include
"
vm
/
ReceiverGuard
.
h
"
#
include
"
builtin
/
TypedObject
.
h
"
#
include
"
vm
/
UnboxedObject
.
h
"
#
include
"
jsobjinlines
.
h
"
using
namespace
js
;
ReceiverGuard
:
:
ReceiverGuard
(
JSObject
*
obj
)
:
group
(
nullptr
)
shape
(
nullptr
)
{
if
(
obj
)
{
if
(
obj
-
>
is
<
UnboxedPlainObject
>
(
)
)
{
group
=
obj
-
>
group
(
)
;
if
(
UnboxedExpandoObject
*
expando
=
obj
-
>
as
<
UnboxedPlainObject
>
(
)
.
maybeExpando
(
)
)
shape
=
expando
-
>
lastProperty
(
)
;
}
else
if
(
obj
-
>
is
<
UnboxedArrayObject
>
(
)
|
|
obj
-
>
is
<
TypedObject
>
(
)
)
{
group
=
obj
-
>
group
(
)
;
}
else
{
shape
=
obj
-
>
maybeShape
(
)
;
}
}
}
ReceiverGuard
:
:
ReceiverGuard
(
ObjectGroup
*
group
Shape
*
shape
)
:
group
(
group
)
shape
(
shape
)
{
if
(
group
)
{
const
Class
*
clasp
=
group
-
>
clasp
(
)
;
if
(
clasp
=
=
&
UnboxedPlainObject
:
:
class_
)
{
}
else
if
(
clasp
=
=
&
UnboxedArrayObject
:
:
class_
|
|
IsTypedObjectClass
(
clasp
)
)
{
this
-
>
shape
=
nullptr
;
}
else
{
this
-
>
group
=
nullptr
;
}
}
}
void
HeapReceiverGuard
:
:
trace
(
JSTracer
*
trc
)
{
TraceNullableEdge
(
trc
&
shape_
"
receiver_guard_shape
"
)
;
TraceNullableEdge
(
trc
&
group_
"
receiver_guard_group
"
)
;
}
