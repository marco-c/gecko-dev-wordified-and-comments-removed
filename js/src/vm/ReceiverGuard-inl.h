#
ifndef
vm_ReceiverGuard_inl_h
#
define
vm_ReceiverGuard_inl_h
#
include
"
vm
/
ReceiverGuard
.
h
"
#
include
"
builtin
/
TypedObject
.
h
"
#
include
"
vm
/
JSObject
.
h
"
namespace
js
{
MOZ_ALWAYS_INLINE
ReceiverGuard
:
:
ReceiverGuard
(
JSObject
*
obj
)
:
group_
(
nullptr
)
shape_
(
nullptr
)
{
if
(
obj
-
>
isNative
(
)
|
|
IsProxy
(
obj
)
)
{
shape_
=
obj
-
>
shape
(
)
;
return
;
}
MOZ_ASSERT
(
obj
-
>
is
<
TypedObject
>
(
)
)
;
group_
=
obj
-
>
group
(
)
;
}
MOZ_ALWAYS_INLINE
ReceiverGuard
:
:
ReceiverGuard
(
ObjectGroup
*
group
Shape
*
shape
)
:
group_
(
group
)
shape_
(
shape
)
{
if
(
group_
)
{
const
Class
*
clasp
=
group_
-
>
clasp
(
)
;
if
(
IsTypedObjectClass
(
clasp
)
)
{
this
-
>
shape_
=
nullptr
;
}
else
{
this
-
>
group_
=
nullptr
;
}
}
MOZ_ASSERT_IF
(
group_
|
|
shape_
!
!
group_
!
=
!
!
shape_
)
;
}
}
#
endif
