#
ifndef
vm_SavedFrame_h
#
define
vm_SavedFrame_h
namespace
js
{
class
SavedFrame
:
public
NativeObject
{
friend
class
SavedStacks
;
public
:
static
const
Class
class_
;
static
const
JSPropertySpec
protoAccessors
[
]
;
static
const
JSFunctionSpec
protoFunctions
[
]
;
static
const
JSFunctionSpec
staticFunctions
[
]
;
static
bool
construct
(
JSContext
*
cx
unsigned
argc
Value
*
vp
)
;
static
bool
sourceProperty
(
JSContext
*
cx
unsigned
argc
Value
*
vp
)
;
static
bool
lineProperty
(
JSContext
*
cx
unsigned
argc
Value
*
vp
)
;
static
bool
columnProperty
(
JSContext
*
cx
unsigned
argc
Value
*
vp
)
;
static
bool
functionDisplayNameProperty
(
JSContext
*
cx
unsigned
argc
Value
*
vp
)
;
static
bool
asyncCauseProperty
(
JSContext
*
cx
unsigned
argc
Value
*
vp
)
;
static
bool
asyncParentProperty
(
JSContext
*
cx
unsigned
argc
Value
*
vp
)
;
static
bool
parentProperty
(
JSContext
*
cx
unsigned
argc
Value
*
vp
)
;
static
bool
toStringMethod
(
JSContext
*
cx
unsigned
argc
Value
*
vp
)
;
static
void
finalize
(
FreeOp
*
fop
JSObject
*
obj
)
;
JSAtom
*
getSource
(
)
;
uint32_t
getLine
(
)
;
uint32_t
getColumn
(
)
;
JSAtom
*
getFunctionDisplayName
(
)
;
JSAtom
*
getAsyncCause
(
)
;
SavedFrame
*
getParent
(
)
;
JSPrincipals
*
getPrincipals
(
)
;
bool
isSelfHosted
(
)
;
static
bool
isSavedFrameAndNotProto
(
JSObject
&
obj
)
{
return
obj
.
is
<
SavedFrame
>
(
)
&
&
!
obj
.
as
<
SavedFrame
>
(
)
.
getReservedSlot
(
JSSLOT_SOURCE
)
.
isNull
(
)
;
}
struct
Lookup
;
struct
HashPolicy
;
typedef
HashSet
<
js
:
:
ReadBarriered
<
SavedFrame
*
>
HashPolicy
SystemAllocPolicy
>
Set
;
class
AutoLookupVector
;
class
MOZ_STACK_CLASS
HandleLookup
{
friend
class
AutoLookupVector
;
Lookup
&
lookup
;
explicit
HandleLookup
(
Lookup
&
lookup
)
:
lookup
(
lookup
)
{
}
public
:
inline
Lookup
&
get
(
)
{
return
lookup
;
}
inline
Lookup
*
operator
-
>
(
)
{
return
&
lookup
;
}
}
;
private
:
static
bool
finishSavedFrameInit
(
JSContext
*
cx
HandleObject
ctor
HandleObject
proto
)
;
void
initFromLookup
(
HandleLookup
lookup
)
;
enum
{
JSSLOT_SOURCE
JSSLOT_LINE
JSSLOT_COLUMN
JSSLOT_FUNCTIONDISPLAYNAME
JSSLOT_ASYNCCAUSE
JSSLOT_PARENT
JSSLOT_PRINCIPALS
JSSLOT_PRIVATE_PARENT
JSSLOT_COUNT
}
;
bool
parentMoved
(
)
;
void
updatePrivateParent
(
)
;
static
bool
checkThis
(
JSContext
*
cx
CallArgs
&
args
const
char
*
fnName
MutableHandleObject
frame
)
;
}
;
struct
SavedFrame
:
:
HashPolicy
{
typedef
SavedFrame
:
:
Lookup
Lookup
;
typedef
PointerHasher
<
SavedFrame
*
3
>
SavedFramePtrHasher
;
typedef
PointerHasher
<
JSPrincipals
*
3
>
JSPrincipalsPtrHasher
;
static
HashNumber
hash
(
const
Lookup
&
lookup
)
;
static
bool
match
(
SavedFrame
*
existing
const
Lookup
&
lookup
)
;
typedef
ReadBarriered
<
SavedFrame
*
>
Key
;
static
void
rekey
(
Key
&
key
const
Key
&
newKey
)
;
}
;
inline
void
AssertObjectIsSavedFrameOrWrapper
(
JSContext
*
cx
HandleObject
stack
)
;
}
#
endif
