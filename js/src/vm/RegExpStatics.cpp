#
include
"
vm
/
RegExpStatics
.
h
"
#
include
"
gc
/
FreeOp
.
h
"
#
include
"
vm
/
RegExpStaticsObject
.
h
"
#
include
"
vm
/
NativeObject
-
inl
.
h
"
using
namespace
js
;
static
void
resc_finalize
(
FreeOp
*
fop
JSObject
*
obj
)
{
MOZ_ASSERT
(
fop
-
>
onActiveCooperatingThread
(
)
)
;
RegExpStatics
*
res
=
static_cast
<
RegExpStatics
*
>
(
obj
-
>
as
<
RegExpStaticsObject
>
(
)
.
getPrivate
(
)
)
;
fop
-
>
delete_
(
res
)
;
}
static
void
resc_trace
(
JSTracer
*
trc
JSObject
*
obj
)
{
void
*
pdata
=
obj
-
>
as
<
RegExpStaticsObject
>
(
)
.
getPrivate
(
)
;
if
(
pdata
)
static_cast
<
RegExpStatics
*
>
(
pdata
)
-
>
trace
(
trc
)
;
}
static
const
ClassOps
RegExpStaticsObjectClassOps
=
{
nullptr
nullptr
nullptr
nullptr
nullptr
nullptr
resc_finalize
nullptr
nullptr
nullptr
resc_trace
}
;
const
Class
RegExpStaticsObject
:
:
class_
=
{
"
RegExpStatics
"
JSCLASS_HAS_PRIVATE
|
JSCLASS_FOREGROUND_FINALIZE
&
RegExpStaticsObjectClassOps
}
;
RegExpStaticsObject
*
RegExpStatics
:
:
create
(
JSContext
*
cx
Handle
<
GlobalObject
*
>
parent
)
{
RegExpStaticsObject
*
obj
=
NewObjectWithGivenProto
<
RegExpStaticsObject
>
(
cx
nullptr
)
;
if
(
!
obj
)
return
nullptr
;
RegExpStatics
*
res
=
cx
-
>
new_
<
RegExpStatics
>
(
)
;
if
(
!
res
)
return
nullptr
;
obj
-
>
setPrivate
(
static_cast
<
void
*
>
(
res
)
)
;
return
obj
;
}
bool
RegExpStatics
:
:
executeLazy
(
JSContext
*
cx
)
{
if
(
!
pendingLazyEvaluation
)
return
true
;
MOZ_ASSERT
(
lazySource
)
;
MOZ_ASSERT
(
matchesInput
)
;
MOZ_ASSERT
(
lazyIndex
!
=
size_t
(
-
1
)
)
;
RootedAtom
source
(
cx
lazySource
)
;
RootedRegExpShared
shared
(
cx
cx
-
>
zone
(
)
-
>
regExps
.
get
(
cx
source
lazyFlags
)
)
;
if
(
!
shared
)
return
false
;
RootedLinearString
input
(
cx
matchesInput
)
;
RegExpRunStatus
status
=
RegExpShared
:
:
execute
(
cx
&
shared
input
lazyIndex
&
this
-
>
matches
nullptr
)
;
if
(
status
=
=
RegExpRunStatus_Error
)
return
false
;
MOZ_ASSERT
(
status
=
=
RegExpRunStatus_Success
)
;
pendingLazyEvaluation
=
false
;
lazySource
=
nullptr
;
lazyIndex
=
size_t
(
-
1
)
;
return
true
;
}
