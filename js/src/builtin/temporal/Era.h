#
ifndef
builtin_temporal_Era_h
#
define
builtin_temporal_Era_h
#
include
"
mozilla
/
Assertions
.
h
"
#
include
"
mozilla
/
MathAlgorithms
.
h
"
#
include
<
initializer_list
>
#
include
<
stddef
.
h
>
#
include
<
stdint
.
h
>
#
include
<
string_view
>
#
include
"
jstypes
.
h
"
#
include
"
builtin
/
temporal
/
Calendar
.
h
"
namespace
js
:
:
temporal
{
enum
class
EraCode
{
Standard
Inverse
Meiji
Taisho
Showa
Heisei
Reiwa
}
;
namespace
eras
{
inline
constexpr
auto
Standard
=
{
EraCode
:
:
Standard
}
;
inline
constexpr
auto
StandardInverse
=
{
EraCode
:
:
Standard
EraCode
:
:
Inverse
}
;
inline
constexpr
auto
Japanese
=
{
EraCode
:
:
Standard
EraCode
:
:
Inverse
EraCode
:
:
Meiji
EraCode
:
:
Taisho
EraCode
:
:
Showa
EraCode
:
:
Heisei
EraCode
:
:
Reiwa
}
;
namespace
names
{
using
namespace
std
:
:
literals
;
inline
constexpr
auto
Empty
=
{
"
"
sv
}
;
inline
constexpr
auto
Gregorian
=
{
"
ce
"
sv
"
ad
"
sv
}
;
inline
constexpr
auto
GregorianInverse
=
{
"
bce
"
sv
"
bc
"
sv
}
;
inline
constexpr
auto
Islamic
=
{
"
ah
"
sv
}
;
inline
constexpr
auto
IslamicInverse
=
{
"
bh
"
sv
}
;
inline
constexpr
auto
JapaneseMeiji
=
{
"
meiji
"
sv
}
;
inline
constexpr
auto
JapaneseTaisho
=
{
"
taisho
"
sv
}
;
inline
constexpr
auto
JapaneseShowa
=
{
"
showa
"
sv
}
;
inline
constexpr
auto
JapaneseHeisei
=
{
"
heisei
"
sv
}
;
inline
constexpr
auto
JapaneseReiwa
=
{
"
reiwa
"
sv
}
;
inline
constexpr
auto
ROC
=
{
"
roc
"
sv
"
minguo
"
sv
}
;
inline
constexpr
auto
ROCInverse
=
{
"
broc
"
sv
"
before
-
roc
"
sv
"
minguo
-
qian
"
sv
}
;
}
}
constexpr
auto
&
CalendarEras
(
CalendarId
id
)
{
switch
(
id
)
{
case
CalendarId
:
:
ISO8601
:
case
CalendarId
:
:
Buddhist
:
case
CalendarId
:
:
Chinese
:
case
CalendarId
:
:
Coptic
:
case
CalendarId
:
:
Dangi
:
case
CalendarId
:
:
Ethiopian
:
case
CalendarId
:
:
EthiopianAmeteAlem
:
case
CalendarId
:
:
Hebrew
:
case
CalendarId
:
:
Indian
:
case
CalendarId
:
:
Persian
:
return
eras
:
:
Standard
;
case
CalendarId
:
:
Gregorian
:
case
CalendarId
:
:
Islamic
:
case
CalendarId
:
:
IslamicCivil
:
case
CalendarId
:
:
IslamicRGSA
:
case
CalendarId
:
:
IslamicTabular
:
case
CalendarId
:
:
IslamicUmmAlQura
:
case
CalendarId
:
:
ROC
:
return
eras
:
:
StandardInverse
;
case
CalendarId
:
:
Japanese
:
return
eras
:
:
Japanese
;
}
MOZ_CRASH
(
"
invalid
calendar
id
"
)
;
}
constexpr
bool
CalendarEraRelevant
(
CalendarId
calendar
)
{
return
CalendarEras
(
calendar
)
.
size
(
)
>
1
;
}
constexpr
auto
&
CalendarEraNames
(
CalendarId
calendar
EraCode
era
)
{
switch
(
calendar
)
{
case
CalendarId
:
:
ISO8601
:
case
CalendarId
:
:
Buddhist
:
case
CalendarId
:
:
Chinese
:
case
CalendarId
:
:
Coptic
:
case
CalendarId
:
:
Dangi
:
case
CalendarId
:
:
Ethiopian
:
case
CalendarId
:
:
EthiopianAmeteAlem
:
case
CalendarId
:
:
Hebrew
:
case
CalendarId
:
:
Indian
:
case
CalendarId
:
:
Persian
:
return
eras
:
:
names
:
:
Empty
;
case
CalendarId
:
:
Gregorian
:
{
MOZ_ASSERT
(
era
=
=
EraCode
:
:
Standard
|
|
era
=
=
EraCode
:
:
Inverse
)
;
return
era
=
=
EraCode
:
:
Standard
?
eras
:
:
names
:
:
Gregorian
:
eras
:
:
names
:
:
GregorianInverse
;
}
case
CalendarId
:
:
Islamic
:
case
CalendarId
:
:
IslamicCivil
:
case
CalendarId
:
:
IslamicRGSA
:
case
CalendarId
:
:
IslamicTabular
:
case
CalendarId
:
:
IslamicUmmAlQura
:
{
MOZ_ASSERT
(
era
=
=
EraCode
:
:
Standard
|
|
era
=
=
EraCode
:
:
Inverse
)
;
return
era
=
=
EraCode
:
:
Standard
?
eras
:
:
names
:
:
Islamic
:
eras
:
:
names
:
:
IslamicInverse
;
}
case
CalendarId
:
:
Japanese
:
{
switch
(
era
)
{
case
EraCode
:
:
Standard
:
return
eras
:
:
names
:
:
Gregorian
;
case
EraCode
:
:
Inverse
:
return
eras
:
:
names
:
:
GregorianInverse
;
case
EraCode
:
:
Meiji
:
return
eras
:
:
names
:
:
JapaneseMeiji
;
case
EraCode
:
:
Taisho
:
return
eras
:
:
names
:
:
JapaneseTaisho
;
case
EraCode
:
:
Showa
:
return
eras
:
:
names
:
:
JapaneseShowa
;
case
EraCode
:
:
Heisei
:
return
eras
:
:
names
:
:
JapaneseHeisei
;
case
EraCode
:
:
Reiwa
:
return
eras
:
:
names
:
:
JapaneseReiwa
;
}
break
;
}
case
CalendarId
:
:
ROC
:
{
MOZ_ASSERT
(
era
=
=
EraCode
:
:
Standard
|
|
era
=
=
EraCode
:
:
Inverse
)
;
return
era
=
=
EraCode
:
:
Standard
?
eras
:
:
names
:
:
ROC
:
eras
:
:
names
:
:
ROCInverse
;
}
}
MOZ_CRASH
(
"
invalid
era
"
)
;
}
constexpr
auto
CalendarEraName
(
CalendarId
calendar
EraCode
era
)
{
auto
&
names
=
CalendarEraNames
(
calendar
era
)
;
MOZ_ASSERT
(
names
.
size
(
)
>
0
)
;
return
*
names
.
begin
(
)
;
}
constexpr
bool
CalendarEraStartsAtYearBoundary
(
CalendarId
id
)
{
switch
(
id
)
{
case
CalendarId
:
:
ISO8601
:
case
CalendarId
:
:
Buddhist
:
case
CalendarId
:
:
Chinese
:
case
CalendarId
:
:
Coptic
:
case
CalendarId
:
:
Dangi
:
case
CalendarId
:
:
Ethiopian
:
case
CalendarId
:
:
EthiopianAmeteAlem
:
case
CalendarId
:
:
Hebrew
:
case
CalendarId
:
:
Indian
:
case
CalendarId
:
:
Persian
:
return
true
;
case
CalendarId
:
:
Gregorian
:
case
CalendarId
:
:
Islamic
:
case
CalendarId
:
:
IslamicCivil
:
case
CalendarId
:
:
IslamicRGSA
:
case
CalendarId
:
:
IslamicTabular
:
case
CalendarId
:
:
IslamicUmmAlQura
:
case
CalendarId
:
:
ROC
:
return
true
;
case
CalendarId
:
:
Japanese
:
return
false
;
}
MOZ_CRASH
(
"
invalid
calendar
id
"
)
;
}
constexpr
bool
CalendarEraStartsAtYearBoundary
(
CalendarId
id
EraCode
era
)
{
MOZ_ASSERT_IF
(
id
!
=
CalendarId
:
:
Japanese
CalendarEraStartsAtYearBoundary
(
id
)
)
;
return
era
=
=
EraCode
:
:
Standard
|
|
era
=
=
EraCode
:
:
Inverse
;
}
struct
EraYear
{
EraCode
era
=
EraCode
:
:
Standard
;
int32_t
year
=
0
;
}
;
constexpr
EraYear
CalendarEraYear
(
CalendarId
id
int32_t
year
)
{
if
(
year
>
0
|
|
!
CalendarEraRelevant
(
id
)
)
{
return
EraYear
{
EraCode
:
:
Standard
year
}
;
}
return
EraYear
{
EraCode
:
:
Inverse
int32_t
(
mozilla
:
:
Abs
(
year
)
+
1
)
}
;
}
}
#
endif
