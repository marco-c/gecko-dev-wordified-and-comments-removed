#
include
"
mozilla
/
Assertions
.
h
"
#
include
"
mozilla
/
EnumSet
.
h
"
#
include
<
initializer_list
>
#
include
<
stddef
.
h
>
#
include
<
stdint
.
h
>
#
include
<
string_view
>
#
include
<
utility
>
#
include
"
jstypes
.
h
"
#
include
"
builtin
/
temporal
/
Calendar
.
h
"
#
include
"
builtin
/
temporal
/
Crash
.
h
"
namespace
js
:
:
temporal
{
class
MonthCode
final
{
public
:
enum
class
Code
{
Invalid
=
0
M01
=
1
M02
M03
M04
M05
M06
M07
M08
M09
M10
M11
M12
M13
M01L
M02L
M03L
M04L
M05L
M06L
M07L
M08L
M09L
M10L
M11L
M12L
}
;
private
:
static
constexpr
int32_t
toLeapMonth
=
static_cast
<
int32_t
>
(
Code
:
:
M01L
)
-
static_cast
<
int32_t
>
(
Code
:
:
M01
)
;
Code
code_
=
Code
:
:
Invalid
;
public
:
constexpr
MonthCode
(
)
=
default
;
constexpr
explicit
MonthCode
(
Code
code
)
:
code_
(
code
)
{
}
constexpr
explicit
MonthCode
(
int32_t
month
bool
isLeapMonth
=
false
)
{
MOZ_ASSERT
(
1
<
=
month
&
&
month
<
=
13
)
;
MOZ_ASSERT_IF
(
isLeapMonth
1
<
=
month
&
&
month
<
=
12
)
;
code_
=
static_cast
<
Code
>
(
month
+
(
isLeapMonth
?
toLeapMonth
:
0
)
)
;
}
constexpr
bool
operator
=
=
(
const
MonthCode
&
other
)
const
{
return
other
.
code_
=
=
code_
;
}
constexpr
bool
operator
!
=
(
const
MonthCode
&
other
)
const
{
return
!
(
*
this
=
=
other
)
;
}
constexpr
auto
code
(
)
const
{
return
code_
;
}
constexpr
int32_t
ordinal
(
)
const
{
int32_t
ordinal
=
static_cast
<
int32_t
>
(
code_
)
;
if
(
isLeapMonth
(
)
)
{
ordinal
-
=
toLeapMonth
;
}
return
ordinal
;
}
constexpr
bool
isLeapMonth
(
)
const
{
return
code_
>
=
Code
:
:
M01L
;
}
constexpr
explicit
operator
std
:
:
string_view
(
)
const
{
constexpr
const
char
*
name
=
"
M01L
"
"
M02L
"
"
M03L
"
"
M04L
"
"
M05L
"
"
M06L
"
"
M07L
"
"
M08L
"
"
M09L
"
"
M10L
"
"
M11L
"
"
M12L
"
"
M13
"
;
size_t
index
=
(
ordinal
(
)
-
1
)
*
4
;
size_t
length
=
3
+
isLeapMonth
(
)
;
return
{
name
+
index
length
}
;
}
constexpr
static
auto
maxNonLeapMonth
(
)
{
return
MonthCode
{
Code
:
:
M13
}
;
}
constexpr
static
auto
maxLeapMonth
(
)
{
return
MonthCode
{
Code
:
:
M12L
}
;
}
}
;
class
MonthCodes
final
{
mozilla
:
:
EnumSet
<
MonthCode
:
:
Code
>
monthCodes_
{
}
;
public
:
constexpr
explicit
MonthCodes
(
std
:
:
initializer_list
<
MonthCode
>
list
)
{
for
(
auto
value
:
{
MonthCode
:
:
Code
:
:
M01
MonthCode
:
:
Code
:
:
M02
MonthCode
:
:
Code
:
:
M03
MonthCode
:
:
Code
:
:
M04
MonthCode
:
:
Code
:
:
M05
MonthCode
:
:
Code
:
:
M06
MonthCode
:
:
Code
:
:
M07
MonthCode
:
:
Code
:
:
M08
MonthCode
:
:
Code
:
:
M09
MonthCode
:
:
Code
:
:
M10
MonthCode
:
:
Code
:
:
M11
MonthCode
:
:
Code
:
:
M12
}
)
{
monthCodes_
+
=
value
;
}
for
(
auto
value
:
list
)
{
monthCodes_
+
=
value
.
code
(
)
;
}
}
bool
contains
(
MonthCode
monthCode
)
const
{
return
monthCodes_
.
contains
(
monthCode
.
code
(
)
)
;
}
bool
contains
(
const
MonthCodes
&
monthCodes
)
const
{
return
monthCodes_
.
contains
(
monthCodes
.
monthCodes_
)
;
}
}
;
namespace
monthcodes
{
inline
constexpr
auto
ISO8601
=
MonthCodes
{
}
;
inline
constexpr
auto
ChineseOrDangi
=
MonthCodes
{
MonthCode
{
1
true
}
MonthCode
{
2
true
}
MonthCode
{
3
true
}
MonthCode
{
4
true
}
MonthCode
{
5
true
}
MonthCode
{
6
true
}
MonthCode
{
7
true
}
MonthCode
{
8
true
}
MonthCode
{
9
true
}
MonthCode
{
10
true
}
MonthCode
{
11
true
}
MonthCode
{
12
true
}
}
;
inline
constexpr
auto
CopticOrEthiopian
=
MonthCodes
{
MonthCode
{
13
}
}
;
inline
constexpr
auto
Hebrew
=
MonthCodes
{
MonthCode
{
5
true
}
}
;
}
constexpr
auto
&
CalendarMonthCodes
(
CalendarId
id
)
{
switch
(
id
)
{
case
CalendarId
:
:
ISO8601
:
return
monthcodes
:
:
ISO8601
;
#
if
defined
(
MOZ_ICU4X
)
case
CalendarId
:
:
Buddhist
:
case
CalendarId
:
:
Gregorian
:
case
CalendarId
:
:
Indian
:
case
CalendarId
:
:
Islamic
:
case
CalendarId
:
:
IslamicCivil
:
case
CalendarId
:
:
IslamicRGSA
:
case
CalendarId
:
:
IslamicTabular
:
case
CalendarId
:
:
IslamicUmmAlQura
:
case
CalendarId
:
:
Persian
:
case
CalendarId
:
:
Japanese
:
case
CalendarId
:
:
ROC
:
return
monthcodes
:
:
ISO8601
;
case
CalendarId
:
:
Chinese
:
case
CalendarId
:
:
Dangi
:
return
monthcodes
:
:
ChineseOrDangi
;
case
CalendarId
:
:
Coptic
:
case
CalendarId
:
:
Ethiopian
:
case
CalendarId
:
:
EthiopianAmeteAlem
:
return
monthcodes
:
:
CopticOrEthiopian
;
case
CalendarId
:
:
Hebrew
:
return
monthcodes
:
:
Hebrew
;
#
endif
}
JS_CONSTEXPR_CRASH
(
"
invalid
calendar
id
"
)
;
}
constexpr
bool
CalendarHasLeapMonths
(
CalendarId
id
)
{
switch
(
id
)
{
case
CalendarId
:
:
ISO8601
:
return
false
;
#
if
defined
(
MOZ_ICU4X
)
case
CalendarId
:
:
Buddhist
:
case
CalendarId
:
:
Coptic
:
case
CalendarId
:
:
Ethiopian
:
case
CalendarId
:
:
EthiopianAmeteAlem
:
case
CalendarId
:
:
Gregorian
:
case
CalendarId
:
:
Indian
:
case
CalendarId
:
:
Islamic
:
case
CalendarId
:
:
IslamicCivil
:
case
CalendarId
:
:
IslamicRGSA
:
case
CalendarId
:
:
IslamicTabular
:
case
CalendarId
:
:
IslamicUmmAlQura
:
case
CalendarId
:
:
Japanese
:
case
CalendarId
:
:
Persian
:
case
CalendarId
:
:
ROC
:
return
false
;
case
CalendarId
:
:
Chinese
:
case
CalendarId
:
:
Dangi
:
case
CalendarId
:
:
Hebrew
:
return
true
;
#
endif
}
JS_CONSTEXPR_CRASH
(
"
invalid
calendar
id
"
)
;
}
}
