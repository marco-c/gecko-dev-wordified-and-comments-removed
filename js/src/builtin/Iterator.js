function
IteratorIdentity
(
)
{
return
this
;
}
function
IteratorNext
(
iteratorRecord
value
)
{
const
result
=
arguments
.
length
<
2
?
callContentFunction
(
iteratorRecord
.
nextMethod
iteratorRecord
.
iterator
)
:
callContentFunction
(
iteratorRecord
.
nextMethod
iteratorRecord
.
iterator
value
)
;
if
(
!
IsObject
(
result
)
)
{
ThrowTypeError
(
JSMSG_OBJECT_REQUIRED
result
)
;
}
return
result
;
}
function
IteratorClose
(
iteratorRecord
value
)
{
const
iterator
=
iteratorRecord
.
iterator
;
const
returnMethod
=
iterator
.
return
;
if
(
returnMethod
!
=
=
undefined
&
&
returnMethod
!
=
=
null
)
{
const
result
=
callContentFunction
(
returnMethod
iterator
)
;
if
(
!
IsObject
(
result
)
)
{
ThrowTypeError
(
JSMSG_OBJECT_REQUIRED
DecompileArg
(
0
result
)
)
;
}
}
return
value
;
}
function
GetIteratorSync
(
obj
)
{
var
method
=
GetMethod
(
obj
GetBuiltinSymbol
(
"
iterator
"
)
)
var
iterator
=
callContentFunction
(
method
obj
)
;
if
(
!
IsObject
(
iterator
)
)
{
ThrowTypeError
(
JSMSG_NOT_ITERABLE
obj
=
=
=
null
?
"
null
"
:
typeof
obj
)
;
}
var
nextMethod
=
iterator
.
next
;
var
iteratorRecord
=
{
iterator
nextMethod
done
:
false
}
;
return
iteratorRecord
;
}
function
GetIteratorDirect
(
obj
)
{
if
(
!
IsObject
(
obj
)
)
{
ThrowTypeError
(
JSMSG_OBJECT_REQUIRED
DecompileArg
(
0
obj
)
)
;
}
const
nextMethod
=
obj
.
next
;
if
(
!
IsCallable
(
nextMethod
)
)
{
ThrowTypeError
(
JSMSG_NOT_FUNCTION
DecompileArg
(
0
nextMethod
)
)
;
}
return
{
iterator
:
obj
nextMethod
done
:
false
}
;
}
function
GetIteratorDirectWrapper
(
obj
)
{
if
(
!
IsObject
(
obj
)
)
{
ThrowTypeError
(
JSMSG_OBJECT_REQUIRED
obj
)
;
}
const
nextMethod
=
obj
.
next
;
if
(
!
IsCallable
(
nextMethod
)
)
{
ThrowTypeError
(
JSMSG_NOT_FUNCTION
nextMethod
)
;
}
return
{
[
GetBuiltinSymbol
(
"
iterator
"
)
]
:
function
IteratorMethod
(
)
{
return
this
;
}
next
(
value
)
{
return
callContentFunction
(
nextMethod
obj
value
)
;
}
return
(
value
)
{
const
returnMethod
=
obj
.
return
;
if
(
returnMethod
!
=
=
undefined
&
&
returnMethod
!
=
=
null
)
{
return
callContentFunction
(
returnMethod
obj
value
)
;
}
return
{
done
:
true
value
}
;
}
}
;
}
function
IteratorStep
(
iteratorRecord
value
)
{
let
result
;
if
(
arguments
.
length
=
=
=
2
)
{
result
=
callContentFunction
(
iteratorRecord
.
nextMethod
iteratorRecord
.
iterator
value
)
;
}
else
{
result
=
callContentFunction
(
iteratorRecord
.
nextMethod
iteratorRecord
.
iterator
)
;
}
if
(
!
IsObject
(
result
)
)
{
ThrowTypeError
(
JSMSG_OBJECT_REQUIRED
DecompileArg
(
0
result
)
)
;
}
return
result
.
done
?
false
:
result
;
}
function
IteratorFrom
(
O
)
{
const
usingIterator
=
O
[
GetBuiltinSymbol
(
"
iterator
"
)
]
;
let
iteratorRecord
;
if
(
usingIterator
!
=
=
undefined
&
&
usingIterator
!
=
=
null
)
{
const
iterator
=
callContentFunction
(
usingIterator
O
)
;
iteratorRecord
=
GetIteratorDirect
(
iterator
)
;
if
(
iteratorRecord
.
iterator
instanceof
GetBuiltinConstructor
(
"
Iterator
"
)
)
{
return
iteratorRecord
.
iterator
;
}
}
else
{
iteratorRecord
=
GetIteratorDirect
(
O
)
;
}
const
wrapper
=
NewWrapForValidIterator
(
)
;
UnsafeSetReservedSlot
(
wrapper
ITERATED_SLOT
iteratorRecord
)
;
return
wrapper
;
}
function
WrapForValidIteratorNext
(
value
)
{
let
O
=
this
;
if
(
!
IsObject
(
O
)
|
|
(
O
=
GuardToWrapForValidIterator
(
O
)
)
=
=
=
null
)
{
if
(
arguments
.
length
=
=
=
0
)
{
return
callFunction
(
CallWrapForValidIteratorMethodIfWrapped
this
"
WrapForValidIteratorNext
"
)
;
}
return
callFunction
(
CallWrapForValidIteratorMethodIfWrapped
this
value
"
WrapForValidIteratorNext
"
)
;
}
const
iterated
=
UnsafeGetReservedSlot
(
O
ITERATED_SLOT
)
;
let
result
;
if
(
arguments
.
length
=
=
=
0
)
{
result
=
callContentFunction
(
iterated
.
nextMethod
iterated
.
iterator
)
;
}
else
{
result
=
callContentFunction
(
iterated
.
nextMethod
iterated
.
iterator
value
)
;
}
if
(
!
IsObject
(
result
)
)
{
ThrowTypeError
(
JSMSG_OBJECT_REQUIRED
DecompileArg
(
0
result
)
)
;
}
return
result
;
}
function
WrapForValidIteratorReturn
(
value
)
{
let
O
=
this
;
if
(
!
IsObject
(
O
)
|
|
(
O
=
GuardToWrapForValidIterator
(
O
)
)
=
=
=
null
)
{
return
callFunction
(
CallWrapForValidIteratorMethodIfWrapped
this
value
"
WrapForValidIteratorReturn
"
)
;
}
const
iterated
=
UnsafeGetReservedSlot
(
O
ITERATED_SLOT
)
;
const
iterator
=
iterated
.
iterator
;
const
returnMethod
=
iterator
.
return
;
if
(
returnMethod
!
=
=
undefined
&
&
returnMethod
!
=
=
null
)
{
let
innerResult
=
callContentFunction
(
returnMethod
iterator
)
;
if
(
!
IsObject
(
innerResult
)
)
{
ThrowTypeError
(
JSMSG_OBJECT_REQUIRED
DecompileArg
(
0
innerResult
)
)
;
}
}
return
{
done
:
true
value
}
;
}
function
WrapForValidIteratorThrow
(
value
)
{
let
O
=
this
;
if
(
!
IsObject
(
O
)
|
|
(
O
=
GuardToWrapForValidIterator
(
O
)
)
=
=
=
null
)
{
return
callFunction
(
CallWrapForValidIteratorMethodIfWrapped
this
value
"
WrapForValidIteratorThrow
"
)
;
}
const
iterated
=
UnsafeGetReservedSlot
(
O
ITERATED_SLOT
)
;
const
iterator
=
iterated
.
iterator
;
const
throwMethod
=
iterator
.
throw
;
if
(
throwMethod
=
=
=
undefined
|
|
throwMethod
=
=
=
null
)
{
throw
value
;
}
return
callContentFunction
(
throwMethod
iterator
value
)
;
}
function
IteratorHelperNext
(
value
)
{
let
O
=
this
;
if
(
!
IsObject
(
O
)
|
|
(
O
=
GuardToIteratorHelper
(
O
)
)
=
=
=
null
)
{
return
callFunction
(
CallIteratorHelperMethodIfWrapped
this
value
"
IteratorHelperNext
"
)
;
}
const
generator
=
UnsafeGetReservedSlot
(
O
ITERATOR_HELPER_GENERATOR_SLOT
)
;
return
callContentFunction
(
GeneratorNext
generator
value
)
;
}
function
IteratorHelperReturn
(
value
)
{
let
O
=
this
;
if
(
!
IsObject
(
O
)
|
|
(
O
=
GuardToIteratorHelper
(
O
)
)
=
=
=
null
)
{
return
callFunction
(
CallIteratorHelperMethodIfWrapped
this
value
"
IteratorHelperReturn
"
)
;
}
const
generator
=
UnsafeGetReservedSlot
(
O
ITERATOR_HELPER_GENERATOR_SLOT
)
;
return
callContentFunction
(
GeneratorReturn
generator
value
)
;
}
function
IteratorHelperThrow
(
value
)
{
let
O
=
this
;
if
(
!
IsObject
(
O
)
|
|
(
O
=
GuardToIteratorHelper
(
O
)
)
=
=
=
null
)
{
return
callFunction
(
CallIteratorHelperMethodIfWrapped
this
value
"
IteratorHelperThrow
"
)
;
}
const
generator
=
UnsafeGetReservedSlot
(
O
ITERATOR_HELPER_GENERATOR_SLOT
)
;
return
callContentFunction
(
GeneratorThrow
generator
value
)
;
}
function
IteratorMap
(
mapper
)
{
const
iterated
=
GetIteratorDirect
(
this
)
;
if
(
!
IsCallable
(
mapper
)
)
{
ThrowTypeError
(
JSMSG_NOT_FUNCTION
DecompileArg
(
0
mapper
)
)
;
}
const
iteratorHelper
=
NewIteratorHelper
(
)
;
const
generator
=
IteratorMapGenerator
(
iterated
mapper
)
;
callContentFunction
(
GeneratorNext
generator
)
;
UnsafeSetReservedSlot
(
iteratorHelper
ITERATOR_HELPER_GENERATOR_SLOT
generator
)
;
return
iteratorHelper
;
}
function
*
IteratorMapGenerator
(
iterated
mapper
)
{
let
lastValue
;
let
needClose
=
true
;
try
{
yield
;
needClose
=
false
;
for
(
let
next
=
IteratorStep
(
iterated
lastValue
)
;
next
;
next
=
IteratorStep
(
iterated
lastValue
)
)
{
const
value
=
next
.
value
;
needClose
=
true
;
lastValue
=
yield
callContentFunction
(
mapper
undefined
value
)
;
needClose
=
false
;
}
}
finally
{
if
(
needClose
)
{
IteratorClose
(
iterated
)
;
}
}
}
function
IteratorFilter
(
filterer
)
{
const
iterated
=
GetIteratorDirect
(
this
)
;
if
(
!
IsCallable
(
filterer
)
)
{
ThrowTypeError
(
JSMSG_NOT_FUNCTION
DecompileArg
(
0
filterer
)
)
;
}
const
iteratorHelper
=
NewIteratorHelper
(
)
;
const
generator
=
IteratorFilterGenerator
(
iterated
filterer
)
;
callContentFunction
(
GeneratorNext
generator
)
;
UnsafeSetReservedSlot
(
iteratorHelper
ITERATOR_HELPER_GENERATOR_SLOT
generator
)
;
return
iteratorHelper
;
}
function
*
IteratorFilterGenerator
(
iterated
filterer
)
{
let
lastValue
;
let
needClose
=
true
;
try
{
yield
;
needClose
=
false
;
for
(
let
next
=
IteratorStep
(
iterated
lastValue
)
;
next
;
next
=
IteratorStep
(
iterated
lastValue
)
)
{
const
value
=
next
.
value
;
needClose
=
true
;
if
(
callContentFunction
(
filterer
undefined
value
)
)
{
lastValue
=
yield
value
;
}
needClose
=
false
;
}
}
finally
{
if
(
needClose
)
{
IteratorClose
(
iterated
)
;
}
}
}
function
IteratorTake
(
limit
)
{
const
iterated
=
GetIteratorDirect
(
this
)
;
const
remaining
=
ToInteger
(
limit
)
;
if
(
remaining
<
0
)
{
ThrowRangeError
(
JSMSG_NEGATIVE_LIMIT
)
;
}
const
iteratorHelper
=
NewIteratorHelper
(
)
;
const
generator
=
IteratorTakeGenerator
(
iterated
remaining
)
;
callContentFunction
(
GeneratorNext
generator
)
;
UnsafeSetReservedSlot
(
iteratorHelper
ITERATOR_HELPER_GENERATOR_SLOT
generator
)
;
return
iteratorHelper
;
}
function
*
IteratorTakeGenerator
(
iterated
remaining
)
{
let
lastValue
;
let
needClose
=
true
;
try
{
yield
;
needClose
=
false
;
for
(
;
remaining
>
0
;
remaining
-
-
)
{
const
next
=
IteratorStep
(
iterated
lastValue
)
;
if
(
!
next
)
{
return
;
}
const
value
=
next
.
value
;
needClose
=
true
;
lastValue
=
yield
value
;
needClose
=
false
;
}
}
finally
{
if
(
needClose
)
{
IteratorClose
(
iterated
)
;
}
}
IteratorClose
(
iterated
)
;
}
function
IteratorDrop
(
limit
)
{
const
iterated
=
GetIteratorDirect
(
this
)
;
const
remaining
=
ToInteger
(
limit
)
;
if
(
remaining
<
0
)
{
ThrowRangeError
(
JSMSG_NEGATIVE_LIMIT
)
;
}
const
iteratorHelper
=
NewIteratorHelper
(
)
;
const
generator
=
IteratorDropGenerator
(
iterated
remaining
)
;
callContentFunction
(
GeneratorNext
generator
)
;
UnsafeSetReservedSlot
(
iteratorHelper
ITERATOR_HELPER_GENERATOR_SLOT
generator
)
;
return
iteratorHelper
;
}
function
*
IteratorDropGenerator
(
iterated
remaining
)
{
let
needClose
=
true
;
try
{
yield
;
needClose
=
false
;
for
(
;
remaining
>
0
;
remaining
-
-
)
{
if
(
!
IteratorStep
(
iterated
)
)
{
return
;
}
}
let
lastValue
;
for
(
let
next
=
IteratorStep
(
iterated
lastValue
)
;
next
;
next
=
IteratorStep
(
iterated
lastValue
)
)
{
const
value
=
next
.
value
;
needClose
=
true
;
lastValue
=
yield
value
;
needClose
=
false
;
}
}
finally
{
if
(
needClose
)
{
IteratorClose
(
iterated
)
;
}
}
}
function
IteratorAsIndexedPairs
(
)
{
const
iterated
=
GetIteratorDirect
(
this
)
;
const
iteratorHelper
=
NewIteratorHelper
(
)
;
const
generator
=
IteratorAsIndexedPairsGenerator
(
iterated
)
;
callContentFunction
(
GeneratorNext
generator
)
;
UnsafeSetReservedSlot
(
iteratorHelper
ITERATOR_HELPER_GENERATOR_SLOT
generator
)
;
return
iteratorHelper
;
}
function
*
IteratorAsIndexedPairsGenerator
(
iterated
)
{
let
lastValue
;
let
needClose
=
true
;
try
{
yield
;
needClose
=
false
;
for
(
let
next
=
IteratorStep
(
iterated
lastValue
)
index
=
0
;
next
;
next
=
IteratorStep
(
iterated
lastValue
)
index
+
+
)
{
const
value
=
next
.
value
;
needClose
=
true
;
lastValue
=
yield
[
index
value
]
;
needClose
=
false
;
}
}
finally
{
if
(
needClose
)
{
IteratorClose
(
iterated
)
;
}
}
}
function
IteratorFlatMap
(
mapper
)
{
const
iterated
=
GetIteratorDirect
(
this
)
;
if
(
!
IsCallable
(
mapper
)
)
{
ThrowTypeError
(
JSMSG_NOT_FUNCTION
DecompileArg
(
0
mapper
)
)
;
}
const
iteratorHelper
=
NewIteratorHelper
(
)
;
const
generator
=
IteratorFlatMapGenerator
(
iterated
mapper
)
;
callContentFunction
(
GeneratorNext
generator
)
;
UnsafeSetReservedSlot
(
iteratorHelper
ITERATOR_HELPER_GENERATOR_SLOT
generator
)
;
return
iteratorHelper
;
}
function
*
IteratorFlatMapGenerator
(
iterated
mapper
)
{
let
needClose
=
true
;
try
{
yield
;
needClose
=
false
;
for
(
let
next
=
IteratorStep
(
iterated
)
;
next
;
next
=
IteratorStep
(
iterated
)
)
{
const
value
=
next
.
value
;
needClose
=
true
;
const
mapped
=
callContentFunction
(
mapper
undefined
value
)
;
for
(
const
innerValue
of
allowContentIter
(
mapped
)
)
{
yield
innerValue
;
}
needClose
=
false
;
}
}
finally
{
if
(
needClose
)
{
IteratorClose
(
iterated
)
;
}
}
}
function
IteratorReduce
(
reducer
)
{
const
iterated
=
GetIteratorDirectWrapper
(
this
)
;
if
(
!
IsCallable
(
reducer
)
)
{
ThrowTypeError
(
JSMSG_NOT_FUNCTION
DecompileArg
(
0
reducer
)
)
;
}
let
accumulator
;
if
(
arguments
.
length
=
=
=
1
)
{
const
next
=
callContentFunction
(
iterated
.
next
iterated
)
;
if
(
!
IsObject
(
next
)
)
{
ThrowTypeError
(
JSMSG_OBJECT_REQUIRED
DecompileArg
(
0
next
)
)
;
}
if
(
next
.
done
)
{
ThrowTypeError
(
JSMSG_EMPTY_ITERATOR_REDUCE
)
;
}
accumulator
=
next
.
value
;
}
else
{
accumulator
=
arguments
[
1
]
;
}
for
(
const
value
of
allowContentIter
(
iterated
)
)
{
accumulator
=
callContentFunction
(
reducer
undefined
accumulator
value
)
;
}
return
accumulator
;
}
function
IteratorToArray
(
)
{
const
iterated
=
{
[
GetBuiltinSymbol
(
"
iterator
"
)
]
:
(
)
=
>
this
}
;
return
[
.
.
.
allowContentIter
(
iterated
)
]
;
}
function
IteratorForEach
(
fn
)
{
const
iterated
=
GetIteratorDirectWrapper
(
this
)
;
if
(
!
IsCallable
(
fn
)
)
{
ThrowTypeError
(
JSMSG_NOT_FUNCTION
DecompileArg
(
0
fn
)
)
;
}
for
(
const
value
of
allowContentIter
(
iterated
)
)
{
callContentFunction
(
fn
undefined
value
)
;
}
}
function
IteratorSome
(
fn
)
{
const
iterated
=
GetIteratorDirectWrapper
(
this
)
;
if
(
!
IsCallable
(
fn
)
)
{
ThrowTypeError
(
JSMSG_NOT_FUNCTION
DecompileArg
(
0
fn
)
)
;
}
for
(
const
value
of
allowContentIter
(
iterated
)
)
{
if
(
callContentFunction
(
fn
undefined
value
)
)
{
return
true
;
}
}
return
false
;
}
function
IteratorEvery
(
fn
)
{
const
iterated
=
GetIteratorDirectWrapper
(
this
)
;
if
(
!
IsCallable
(
fn
)
)
{
ThrowTypeError
(
JSMSG_NOT_FUNCTION
DecompileArg
(
0
fn
)
)
;
}
for
(
const
value
of
allowContentIter
(
iterated
)
)
{
if
(
!
callContentFunction
(
fn
undefined
value
)
)
{
return
false
;
}
}
return
true
;
}
function
IteratorFind
(
fn
)
{
const
iterated
=
GetIteratorDirectWrapper
(
this
)
;
if
(
!
IsCallable
(
fn
)
)
{
ThrowTypeError
(
JSMSG_NOT_FUNCTION
DecompileArg
(
0
fn
)
)
;
}
for
(
const
value
of
allowContentIter
(
iterated
)
)
{
if
(
callContentFunction
(
fn
undefined
value
)
)
{
return
value
;
}
}
}
