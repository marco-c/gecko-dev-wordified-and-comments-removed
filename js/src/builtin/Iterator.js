function
IteratorIdentity
(
)
{
return
this
;
}
function
GetIteratorDirect
(
obj
)
{
if
(
!
IsObject
(
obj
)
)
ThrowTypeError
(
JSMSG_OBJECT_REQUIRED
DecompileArg
(
0
obj
)
)
;
const
nextMethod
=
obj
.
next
;
if
(
!
IsCallable
(
nextMethod
)
)
ThrowTypeError
(
JSMSG_NOT_FUNCTION
DecompileArg
(
0
nextMethod
)
)
;
return
{
iterator
:
obj
nextMethod
done
:
false
}
;
}
function
IteratorFrom
(
O
)
{
const
usingIterator
=
O
[
std_iterator
]
;
let
iteratorRecord
;
if
(
usingIterator
!
=
=
undefined
&
&
usingIterator
!
=
=
null
)
{
const
iterator
=
callContentFunction
(
usingIterator
O
)
;
iteratorRecord
=
GetIteratorDirect
(
iterator
)
;
if
(
iteratorRecord
.
iterator
instanceof
GetBuiltinConstructor
(
"
Iterator
"
)
)
return
iteratorRecord
.
iterator
;
}
else
{
iteratorRecord
=
GetIteratorDirect
(
O
)
;
}
const
wrapper
=
NewWrapForValidIterator
(
)
;
UnsafeSetReservedSlot
(
wrapper
ITERATED_SLOT
iteratorRecord
)
;
return
wrapper
;
}
function
WrapForValidIteratorNext
(
value
)
{
let
O
;
if
(
!
IsObject
(
this
)
|
|
(
O
=
GuardToWrapForValidIterator
(
this
)
)
=
=
=
null
)
ThrowTypeError
(
JSMSG_OBJECT_REQUIRED
DecompileArg
(
0
O
)
)
;
const
iterated
=
UnsafeGetReservedSlot
(
O
ITERATED_SLOT
)
;
let
result
;
if
(
arguments
.
length
=
=
=
0
)
{
result
=
callContentFunction
(
iterated
.
nextMethod
iterated
.
iterator
)
;
}
else
{
result
=
callContentFunction
(
iterated
.
nextMethod
iterated
.
iterator
value
)
;
}
if
(
!
IsObject
(
result
)
)
ThrowTypeError
(
JSMSG_OBJECT_REQUIRED
DecompileArg
(
0
result
)
)
;
return
result
;
}
function
WrapForValidIteratorReturn
(
value
)
{
let
O
;
if
(
!
IsObject
(
this
)
|
|
(
O
=
GuardToWrapForValidIterator
(
this
)
)
=
=
=
null
)
ThrowTypeError
(
JSMSG_OBJECT_REQUIRED
DecompileArg
(
0
O
)
)
;
const
iterated
=
UnsafeGetReservedSlot
(
O
ITERATED_SLOT
)
;
const
iterator
=
iterated
.
iterator
;
const
returnMethod
=
iterator
.
return
;
if
(
returnMethod
!
=
=
undefined
&
&
returnMethod
!
=
=
null
)
{
let
innerResult
=
callContentFunction
(
returnMethod
iterator
)
;
if
(
!
IsObject
(
innerResult
)
)
ThrowTypeError
(
JSMSG_OBJECT_REQUIRED
DecompileArg
(
0
innerResult
)
)
;
}
return
{
done
:
true
value
}
;
}
function
WrapForValidIteratorThrow
(
value
)
{
let
O
;
if
(
!
IsObject
(
this
)
|
|
(
O
=
GuardToWrapForValidIterator
(
this
)
)
=
=
=
null
)
ThrowTypeError
(
JSMSG_OBJECT_REQUIRED
DecompileArg
(
0
O
)
)
;
const
iterated
=
UnsafeGetReservedSlot
(
O
ITERATED_SLOT
)
;
const
iterator
=
iterated
.
iterator
;
const
throwMethod
=
iterator
.
throw
;
if
(
throwMethod
=
=
=
undefined
|
|
throwMethod
=
=
=
null
)
{
throw
value
;
}
return
callContentFunction
(
throwMethod
iterator
value
)
;
}
