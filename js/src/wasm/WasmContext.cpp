#
include
"
wasm
/
WasmContext
.
h
"
#
include
"
js
/
friend
/
StackLimits
.
h
"
#
include
"
vm
/
JSContext
.
h
"
using
namespace
js
:
:
wasm
;
Context
:
:
Context
(
)
:
triedToInstallSignalHandlers
(
false
)
haveSignalHandlers
(
false
)
stackLimit
(
JS
:
:
NativeStackLimitMin
)
#
ifdef
ENABLE_WASM_JSPI
onSuspendableStack
(
0
)
suspendableStacksCount
(
0
)
#
endif
{
}
void
Context
:
:
initStackLimit
(
JSContext
*
cx
)
{
stackLimit
=
cx
-
>
jitStackLimitNoInterrupt
;
}
#
ifdef
ENABLE_WASM_JSPI
void
Context
:
:
enterSuspendableStack
(
JS
:
:
NativeStackLimit
newStackLimit
)
{
MOZ_ASSERT
(
onSuspendableStack
=
=
0
)
;
onSuspendableStack
=
1
;
stackLimit
=
newStackLimit
;
}
void
Context
:
:
leaveSuspendableStack
(
JSContext
*
cx
)
{
MOZ_ASSERT
(
onSuspendableStack
!
=
0
)
;
onSuspendableStack
=
0
;
initStackLimit
(
cx
)
;
}
#
endif
#
ifdef
ENABLE_WASM_JSPI
bool
js
:
:
IsSuspendableStackActive
(
JSContext
*
cx
)
{
return
cx
-
>
wasm
(
)
.
onSuspendableStack
!
=
0
;
}
JS
:
:
NativeStackLimit
js
:
:
GetSuspendableStackLimit
(
JSContext
*
cx
)
{
MOZ_ASSERT
(
IsSuspendableStackActive
(
cx
)
)
;
return
cx
-
>
wasm
(
)
.
stackLimit
;
}
#
endif
