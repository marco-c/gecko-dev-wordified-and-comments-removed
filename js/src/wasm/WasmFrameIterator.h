#
ifndef
wasm_frame_iterator_h
#
define
wasm_frame_iterator_h
#
include
"
js
/
ProfilingFrameIterator
.
h
"
class
JSAtom
;
namespace
js
{
class
WasmActivation
;
namespace
jit
{
class
MacroAssembler
;
}
namespace
wasm
{
class
CallSite
;
class
Code
;
class
CodeRange
;
class
SigIdDesc
;
struct
CallThunk
;
struct
FuncOffsets
;
struct
ProfilingOffsets
;
struct
TrapOffset
;
class
FrameIterator
{
const
WasmActivation
*
activation_
;
const
Code
*
code_
;
const
CallSite
*
callsite_
;
const
CodeRange
*
codeRange_
;
uint8_t
*
fp_
;
uint8_t
*
pc_
;
bool
missingFrameMessage_
;
void
settle
(
)
;
public
:
explicit
FrameIterator
(
)
;
explicit
FrameIterator
(
const
WasmActivation
&
activation
)
;
void
operator
+
+
(
)
;
bool
done
(
)
const
;
const
char
*
filename
(
)
const
;
const
char16_t
*
displayURL
(
)
const
;
bool
mutedErrors
(
)
const
;
JSAtom
*
functionDisplayAtom
(
)
const
;
unsigned
lineOrBytecode
(
)
const
;
inline
void
*
fp
(
)
const
{
return
fp_
;
}
inline
uint8_t
*
pc
(
)
const
{
return
pc_
;
}
}
;
enum
class
ExitReason
:
uint32_t
{
None
ImportJit
ImportInterp
Native
Trap
}
;
class
ProfilingFrameIterator
{
const
WasmActivation
*
activation_
;
const
Code
*
code_
;
const
CodeRange
*
codeRange_
;
uint8_t
*
callerFP_
;
void
*
callerPC_
;
void
*
stackAddress_
;
ExitReason
exitReason_
;
void
initFromFP
(
)
;
public
:
ProfilingFrameIterator
(
)
;
explicit
ProfilingFrameIterator
(
const
WasmActivation
&
activation
)
;
ProfilingFrameIterator
(
const
WasmActivation
&
activation
const
JS
:
:
ProfilingFrameIterator
:
:
RegisterState
&
state
)
;
void
operator
+
+
(
)
;
bool
done
(
)
const
{
return
!
codeRange_
;
}
void
*
stackAddress
(
)
const
{
MOZ_ASSERT
(
!
done
(
)
)
;
return
stackAddress_
;
}
const
char
*
label
(
)
const
;
}
;
void
GenerateExitPrologue
(
jit
:
:
MacroAssembler
&
masm
unsigned
framePushed
ExitReason
reason
ProfilingOffsets
*
offsets
)
;
void
GenerateExitEpilogue
(
jit
:
:
MacroAssembler
&
masm
unsigned
framePushed
ExitReason
reason
ProfilingOffsets
*
offsets
)
;
void
GenerateFunctionPrologue
(
jit
:
:
MacroAssembler
&
masm
unsigned
framePushed
const
SigIdDesc
&
sigId
const
TrapOffset
&
trapOffset
FuncOffsets
*
offsets
)
;
void
GenerateFunctionEpilogue
(
jit
:
:
MacroAssembler
&
masm
unsigned
framePushed
FuncOffsets
*
offsets
)
;
void
ToggleProfiling
(
const
Code
&
code
const
CallSite
&
callSite
bool
enabled
)
;
void
ToggleProfiling
(
const
Code
&
code
const
CallThunk
&
callThunk
bool
enabled
)
;
void
ToggleProfiling
(
const
Code
&
code
const
CodeRange
&
codeRange
bool
enabled
)
;
}
}
#
endif
