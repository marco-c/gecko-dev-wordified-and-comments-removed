#
include
"
wasm
/
WasmTextUtils
.
h
"
#
include
"
util
/
StringBuffer
.
h
"
#
include
"
wasm
/
WasmTypes
.
h
"
using
namespace
js
;
using
namespace
jit
;
using
namespace
wasm
;
using
mozilla
:
:
IsNaN
;
template
<
size_t
base
>
bool
wasm
:
:
RenderInBase
(
StringBuffer
&
sb
uint64_t
num
)
{
uint64_t
n
=
num
;
uint64_t
pow
=
1
;
while
(
n
)
{
pow
*
=
base
;
n
/
=
base
;
}
pow
/
=
base
;
n
=
num
;
while
(
pow
)
{
if
(
!
sb
.
append
(
"
0123456789abcdef
"
[
n
/
pow
]
)
)
return
false
;
n
-
=
(
n
/
pow
)
*
pow
;
pow
/
=
base
;
}
return
true
;
}
template
bool
wasm
:
:
RenderInBase
<
10
>
(
StringBuffer
&
sb
uint64_t
num
)
;
template
<
class
T
>
bool
wasm
:
:
RenderNaN
(
StringBuffer
&
sb
T
num
)
{
typedef
typename
mozilla
:
:
SelectTrait
<
T
>
Traits
;
typedef
typename
Traits
:
:
Bits
Bits
;
MOZ_ASSERT
(
IsNaN
(
num
)
)
;
Bits
bits
=
mozilla
:
:
BitwiseCast
<
Bits
>
(
num
)
;
if
(
(
bits
&
Traits
:
:
kSignBit
)
&
&
!
sb
.
append
(
"
-
"
)
)
return
false
;
if
(
!
sb
.
append
(
"
nan
"
)
)
return
false
;
Bits
payload
=
bits
&
Traits
:
:
kSignificandBits
;
if
(
payload
=
=
(
(
Traits
:
:
kSignificandBits
+
1
)
>
>
1
)
)
return
true
;
return
sb
.
append
(
"
:
0x
"
)
&
&
RenderInBase
<
16
>
(
sb
payload
)
;
}
template
MOZ_MUST_USE
bool
wasm
:
:
RenderNaN
(
StringBuffer
&
b
float
num
)
;
template
MOZ_MUST_USE
bool
wasm
:
:
RenderNaN
(
StringBuffer
&
b
double
num
)
;
