#
ifndef
wasm_context_h
#
define
wasm_context_h
#
ifdef
ENABLE_WASM_JSPI
#
include
"
mozilla
/
DoublyLinkedList
.
h
"
#
include
"
gc
/
Barrier
.
h
"
#
endif
#
include
"
js
/
NativeStackLimits
.
h
"
namespace
js
:
:
wasm
{
#
ifdef
ENABLE_WASM_JSPI
class
SuspenderObject
;
class
SuspenderObjectData
;
class
SuspenderContext
{
private
:
HeapPtr
<
SuspenderObject
*
>
activeSuspender_
;
mozilla
:
:
DoublyLinkedList
<
SuspenderObjectData
>
suspendedStacks_
;
public
:
SuspenderContext
(
)
;
~
SuspenderContext
(
)
;
SuspenderObject
*
activeSuspender
(
)
;
void
setActiveSuspender
(
SuspenderObject
*
obj
)
;
void
trace
(
JSTracer
*
trc
)
;
void
traceRoots
(
JSTracer
*
trc
)
;
friend
class
SuspenderObject
;
}
;
#
endif
class
Context
{
public
:
Context
(
)
;
static
constexpr
size_t
offsetOfStackLimit
(
)
{
return
offsetof
(
Context
stackLimit
)
;
}
#
ifdef
ENABLE_WASM_JSPI
static
constexpr
size_t
offsetOfOnSuspendableStack
(
)
{
return
offsetof
(
Context
onSuspendableStack
)
;
}
#
endif
void
initStackLimit
(
JSContext
*
cx
)
;
#
ifdef
ENABLE_WASM_JSPI
void
enterSuspendableStack
(
JS
:
:
NativeStackLimit
newStackLimit
)
;
void
leaveSuspendableStack
(
JSContext
*
cx
)
;
#
endif
bool
triedToInstallSignalHandlers
;
bool
haveSignalHandlers
;
JS
:
:
NativeStackLimit
stackLimit
;
#
ifdef
ENABLE_WASM_JSPI
int32_t
onSuspendableStack
;
mozilla
:
:
Atomic
<
uint32_t
>
suspendableStacksCount
;
SuspenderContext
promiseIntegration
;
#
endif
}
;
}
#
endif
