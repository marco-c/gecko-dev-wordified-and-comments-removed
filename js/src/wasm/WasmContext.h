#
ifndef
wasm_context_h
#
define
wasm_context_h
#
include
"
mozilla
/
DoublyLinkedList
.
h
"
namespace
js
:
:
wasm
{
#
ifdef
ENABLE_WASM_JSPI
class
SuspenderObject
;
class
SuspenderObjectData
;
class
SuspenderContext
{
private
:
HeapPtr
<
SuspenderObject
*
>
activeSuspender_
;
mozilla
:
:
DoublyLinkedList
<
SuspenderObjectData
>
suspendedStacks_
;
public
:
SuspenderContext
(
)
;
~
SuspenderContext
(
)
;
SuspenderObject
*
activeSuspender
(
)
;
void
setActiveSuspender
(
SuspenderObject
*
obj
)
;
void
trace
(
JSTracer
*
trc
)
;
void
traceRoots
(
JSTracer
*
trc
)
;
friend
class
SuspenderObject
;
}
;
#
endif
class
Context
{
public
:
Context
(
)
:
triedToInstallSignalHandlers
(
false
)
haveSignalHandlers
(
false
)
#
ifdef
ENABLE_WASM_JSPI
suspendableStackLimit
(
JS
:
:
NativeStackLimitMin
)
suspendableStacksCount
(
0
)
#
endif
{
}
bool
triedToInstallSignalHandlers
;
bool
haveSignalHandlers
;
#
ifdef
ENABLE_WASM_JSPI
JS
:
:
NativeStackLimit
suspendableStackLimit
;
mozilla
:
:
Atomic
<
uint32_t
>
suspendableStacksCount
;
SuspenderContext
promiseIntegration
;
#
endif
}
;
}
#
endif
