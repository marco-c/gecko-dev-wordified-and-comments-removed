#
ifndef
asmjs_wasm_baseline_compile_h
#
define
asmjs_wasm_baseline_compile_h
#
include
"
wasm
/
WasmGenerator
.
h
"
namespace
js
{
namespace
wasm
{
bool
BaselineCanCompile
(
)
;
MOZ_MUST_USE
bool
BaselineCompileFunctions
(
const
ModuleEnvironment
&
env
LifoAlloc
&
lifo
const
FuncCompileInputVector
&
inputs
CompiledCode
*
code
UniqueChars
*
error
)
;
class
BaseLocalIter
{
private
:
using
ConstValTypeRange
=
mozilla
:
:
Range
<
const
ValType
>
;
const
ValTypeVector
&
locals_
;
const
ArgTypeVector
&
args_
;
jit
:
:
ABIArgIter
<
ArgTypeVector
>
argsIter_
;
size_t
index_
;
int32_t
frameSize_
;
int32_t
nextFrameSize_
;
int32_t
frameOffset_
;
int32_t
stackResultPointerOffset_
;
jit
:
:
MIRType
mirType_
;
bool
done_
;
void
settle
(
)
;
int32_t
pushLocal
(
size_t
nbytes
)
;
public
:
BaseLocalIter
(
const
ValTypeVector
&
locals
const
ArgTypeVector
&
args
bool
debugEnabled
)
;
void
operator
+
+
(
int
)
;
bool
done
(
)
const
{
return
done_
;
}
jit
:
:
MIRType
mirType
(
)
const
{
MOZ_ASSERT
(
!
done_
)
;
return
mirType_
;
}
int32_t
frameOffset
(
)
const
{
MOZ_ASSERT
(
!
done_
)
;
MOZ_ASSERT
(
frameOffset_
!
=
INT32_MAX
)
;
return
frameOffset_
;
}
size_t
index
(
)
const
{
MOZ_ASSERT
(
!
done_
)
;
return
index_
;
}
int32_t
frameSize
(
)
const
{
return
frameSize_
;
}
int32_t
stackResultPointerOffset
(
)
const
{
MOZ_ASSERT
(
args_
.
hasSyntheticStackResultPointerArg
(
)
)
;
MOZ_ASSERT
(
stackResultPointerOffset_
!
=
INT32_MAX
)
;
return
stackResultPointerOffset_
;
}
#
ifdef
DEBUG
bool
isArg
(
)
const
{
MOZ_ASSERT
(
!
done_
)
;
return
!
argsIter_
.
done
(
)
;
}
#
endif
}
;
#
ifdef
DEBUG
bool
IsValidStackMapKey
(
bool
debugEnabled
const
uint8_t
*
nextPC
)
;
#
endif
}
}
#
endif
