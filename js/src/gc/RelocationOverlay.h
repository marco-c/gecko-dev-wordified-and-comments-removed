#
ifndef
gc_RelocationOverlay_h
#
define
gc_RelocationOverlay_h
#
include
"
mozilla
/
Assertions
.
h
"
#
include
<
stdint
.
h
>
#
include
"
gc
/
Cell
.
h
"
namespace
js
{
namespace
gc
{
class
RelocationOverlay
:
public
Cell
{
uintptr_t
dataWithTag_
;
RelocationOverlay
*
next_
;
public
:
static
const
RelocationOverlay
*
fromCell
(
const
Cell
*
cell
)
{
return
static_cast
<
const
RelocationOverlay
*
>
(
cell
)
;
}
static
RelocationOverlay
*
fromCell
(
Cell
*
cell
)
{
return
static_cast
<
RelocationOverlay
*
>
(
cell
)
;
}
Cell
*
forwardingAddress
(
)
const
{
MOZ_ASSERT
(
isForwarded
(
)
)
;
uintptr_t
newLocation
=
dataWithTag_
&
~
CellHeader
:
:
RESERVED_MASK
;
return
reinterpret_cast
<
Cell
*
>
(
newLocation
)
;
}
void
forwardTo
(
Cell
*
cell
)
;
RelocationOverlay
*
&
nextRef
(
)
{
MOZ_ASSERT
(
isForwarded
(
)
)
;
return
next_
;
}
RelocationOverlay
*
next
(
)
const
{
MOZ_ASSERT
(
isForwarded
(
)
)
;
return
next_
;
}
}
;
}
}
#
endif
