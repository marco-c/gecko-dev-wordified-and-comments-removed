#
include
"
jscntxt
.
h
"
#
include
"
jsfriendapi
.
h
"
#
include
"
vm
/
Runtime
.
h
"
using
js
:
:
gc
:
:
Cell
;
mozilla
:
:
Atomic
<
uint32_t
mozilla
:
:
Relaxed
>
MemProfiler
:
:
sActiveProfilerCount
;
NativeProfiler
*
MemProfiler
:
:
sNativeProfiler
;
GCHeapProfiler
*
MemProfiler
:
:
GetGCHeapProfiler
(
void
*
addr
)
{
JSRuntime
*
runtime
=
reinterpret_cast
<
Cell
*
>
(
addr
)
-
>
runtimeFromAnyThread
(
)
;
return
runtime
-
>
gc
.
mMemProfiler
.
mGCHeapProfiler
;
}
GCHeapProfiler
*
MemProfiler
:
:
GetGCHeapProfiler
(
JSRuntime
*
runtime
)
{
return
runtime
-
>
gc
.
mMemProfiler
.
mGCHeapProfiler
;
}
JS_FRIEND_API
(
MemProfiler
*
)
MemProfiler
:
:
GetMemProfiler
(
JSContext
*
context
)
{
return
&
context
-
>
runtime
(
)
-
>
gc
.
mMemProfiler
;
}
JS_FRIEND_API
(
void
)
MemProfiler
:
:
start
(
GCHeapProfiler
*
aGCHeapProfiler
)
{
ReleaseAllJITCode
(
mRuntime
-
>
defaultFreeOp
(
)
)
;
mGCHeapProfiler
=
aGCHeapProfiler
;
sActiveProfilerCount
+
+
;
}
JS_FRIEND_API
(
void
)
MemProfiler
:
:
stop
(
)
{
sActiveProfilerCount
-
-
;
mGCHeapProfiler
=
nullptr
;
}
