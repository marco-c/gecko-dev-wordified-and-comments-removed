#
include
"
mozilla
/
Utf8
.
h
"
#
include
"
jsfriendapi
.
h
"
#
include
"
js
/
CompilationAndEvaluation
.
h
"
#
include
"
js
/
SourceText
.
h
"
#
include
"
jsapi
-
tests
/
tests
.
h
"
#
include
"
util
/
Text
.
h
"
using
namespace
js
;
BEGIN_TEST
(
test_functionBinding
)
{
RootedFunction
fun
(
cx
)
;
JS
:
:
CompileOptions
options
(
cx
)
;
options
.
setFileAndLine
(
__FILE__
__LINE__
)
;
JS
:
:
RootedObjectVector
emptyScopeChain
(
cx
)
;
{
static
const
char
s1chars
[
]
=
"
return
(
typeof
s1
)
=
=
'
undefined
'
;
"
;
JS
:
:
SourceText
<
mozilla
:
:
Utf8Unit
>
srcBuf
;
CHECK
(
srcBuf
.
init
(
cx
s1chars
js_strlen
(
s1chars
)
JS
:
:
SourceOwnership
:
:
Borrowed
)
)
;
fun
=
JS
:
:
CompileFunction
(
cx
emptyScopeChain
options
"
s1
"
0
nullptr
srcBuf
)
;
CHECK
(
fun
)
;
}
JS
:
:
RootedValueVector
args
(
cx
)
;
RootedValue
rval
(
cx
)
;
CHECK
(
JS
:
:
Call
(
cx
UndefinedHandleValue
fun
args
&
rval
)
)
;
CHECK
(
rval
.
isBoolean
(
)
)
;
CHECK
(
rval
.
toBoolean
(
)
)
;
{
static
const
char
s2chars
[
]
=
"
return
(
typeof
anonymous
)
=
=
'
undefined
'
;
"
;
JS
:
:
SourceText
<
mozilla
:
:
Utf8Unit
>
srcBuf
;
CHECK
(
srcBuf
.
init
(
cx
s2chars
js_strlen
(
s2chars
)
JS
:
:
SourceOwnership
:
:
Borrowed
)
)
;
fun
=
JS
:
:
CompileFunction
(
cx
emptyScopeChain
options
"
s2
"
0
nullptr
srcBuf
)
;
CHECK
(
fun
)
;
}
CHECK
(
JS
:
:
Call
(
cx
UndefinedHandleValue
fun
args
&
rval
)
)
;
CHECK
(
rval
.
isBoolean
(
)
)
;
CHECK
(
rval
.
toBoolean
(
)
)
;
{
static
const
char
s3chars
[
]
=
"
return
(
typeof
anonymous
)
=
=
'
undefined
'
;
"
;
JS
:
:
SourceText
<
mozilla
:
:
Utf8Unit
>
srcBuf
;
CHECK
(
srcBuf
.
init
(
cx
s3chars
js_strlen
(
s3chars
)
JS
:
:
SourceOwnership
:
:
Borrowed
)
)
;
fun
=
JS
:
:
CompileFunction
(
cx
emptyScopeChain
options
nullptr
0
nullptr
srcBuf
)
;
CHECK
(
fun
)
;
}
CHECK
(
JS
:
:
Call
(
cx
UndefinedHandleValue
fun
args
&
rval
)
)
;
CHECK
(
rval
.
isBoolean
(
)
)
;
CHECK
(
rval
.
toBoolean
(
)
)
;
return
true
;
}
END_TEST
(
test_functionBinding
)
