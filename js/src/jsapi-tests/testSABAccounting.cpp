#
include
"
builtin
/
TestingFunctions
.
h
"
#
include
"
js
/
SharedArrayBuffer
.
h
"
#
include
"
jsapi
-
tests
/
tests
.
h
"
BEGIN_TEST
(
testSABAccounting
)
{
JS
:
:
PrepareForFullGC
(
cx
)
;
NonIncrementalGC
(
cx
JS
:
:
GCOptions
:
:
Shrink
JS
:
:
GCReason
:
:
API
)
;
CHECK
(
!
JS
:
:
ContainsSharedArrayBuffer
(
cx
)
)
;
JS
:
:
RootedObject
obj
(
cx
)
obj2
(
cx
)
;
CHECK
(
obj
=
JS
:
:
NewSharedArrayBuffer
(
cx
4096
)
)
;
CHECK
(
JS
:
:
ContainsSharedArrayBuffer
(
cx
)
)
;
CHECK
(
obj2
=
JS
:
:
NewSharedArrayBuffer
(
cx
4096
)
)
;
CHECK
(
JS
:
:
ContainsSharedArrayBuffer
(
cx
)
)
;
obj
=
nullptr
;
obj2
=
nullptr
;
JS
:
:
PrepareForFullGC
(
cx
)
;
NonIncrementalGC
(
cx
JS
:
:
GCOptions
:
:
Shrink
JS
:
:
GCReason
:
:
API
)
;
CHECK
(
!
JS
:
:
ContainsSharedArrayBuffer
(
cx
)
)
;
return
true
;
}
END_TEST
(
testSABAccounting
)
