#
include
"
js
/
CompilationAndEvaluation
.
h
"
#
include
"
js
/
MemoryFunctions
.
h
"
#
include
"
jsapi
-
tests
/
tests
.
h
"
#
include
"
vm
/
JSScript
.
h
"
BEGIN_TEST
(
testBug795104
)
{
JS
:
:
RealmBehaviorsRef
(
cx
-
>
realm
(
)
)
.
setDiscardSource
(
true
)
;
const
size_t
strLen
=
60002
;
char
*
s
=
static_cast
<
char
*
>
(
JS_malloc
(
cx
strLen
)
)
;
CHECK
(
s
)
;
s
[
0
]
=
'
"
'
;
memset
(
s
+
1
'
x
'
strLen
-
2
)
;
s
[
strLen
-
1
]
=
'
"
'
;
JS
:
:
CompileOptions
opts
(
cx
)
;
opts
.
setNoScriptRval
(
true
)
;
JS
:
:
RootedValue
unused
(
cx
)
;
CHECK
(
JS
:
:
EvaluateUtf8
(
cx
opts
s
strLen
&
unused
)
)
;
JS
:
:
RootedFunction
fun
(
cx
)
;
JS
:
:
AutoObjectVector
emptyScopeChain
(
cx
)
;
opts
.
setNoScriptRval
(
false
)
;
CHECK
(
JS
:
:
CompileFunctionUtf8
(
cx
emptyScopeChain
opts
"
f
"
0
nullptr
s
strLen
&
fun
)
)
;
CHECK
(
fun
)
;
JS_free
(
cx
s
)
;
return
true
;
}
END_TEST
(
testBug795104
)
