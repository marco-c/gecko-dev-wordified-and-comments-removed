#
include
"
mozilla
/
ArrayUtils
.
h
"
#
include
"
mozilla
/
Utf8
.
h
"
#
include
"
jsapi
.
h
"
#
include
"
js
/
CompilationAndEvaluation
.
h
"
#
include
"
js
/
SourceText
.
h
"
#
include
"
jsapi
-
tests
/
tests
.
h
"
static
const
char
code
[
]
=
"
xx
=
1
;
\
n
\
\
n
\
try
{
\
n
\
debugger
;
\
n
\
\
n
\
xx
+
=
1
;
\
n
\
}
\
n
\
catch
(
e
)
\
n
\
{
\
n
\
xx
+
=
1
;
\
n
\
}
\
n
\
/
/
sourceMappingURL
=
http
:
/
/
example
.
com
/
path
/
to
/
source
-
map
.
json
"
;
BEGIN_TEST
(
testScriptInfo
)
{
unsigned
startLine
=
1000
;
JS
:
:
CompileOptions
options
(
cx
)
;
options
.
setFileAndLine
(
__FILE__
startLine
)
;
JS
:
:
SourceText
<
mozilla
:
:
Utf8Unit
>
srcBuf
;
CHECK
(
srcBuf
.
init
(
cx
code
mozilla
:
:
ArrayLength
(
code
)
-
1
JS
:
:
SourceOwnership
:
:
Borrowed
)
)
;
JS
:
:
RootedScript
script
(
cx
JS
:
:
Compile
(
cx
options
srcBuf
)
)
;
CHECK
(
script
)
;
CHECK_EQUAL
(
JS_GetScriptBaseLineNumber
(
cx
script
)
startLine
)
;
CHECK
(
strcmp
(
JS_GetScriptFilename
(
script
)
__FILE__
)
=
=
0
)
;
return
true
;
}
static
bool
CharsMatch
(
const
char16_t
*
p
const
char
*
q
)
{
while
(
*
q
)
{
if
(
*
p
+
+
!
=
*
q
+
+
)
{
return
false
;
}
}
return
true
;
}
END_TEST
(
testScriptInfo
)
