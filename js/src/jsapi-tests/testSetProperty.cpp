#
include
"
js
/
Object
.
h
"
#
include
"
js
/
PropertyAndElement
.
h
"
#
include
"
jsapi
-
tests
/
tests
.
h
"
BEGIN_TEST
(
testSetProperty_InheritedGlobalSetter
)
{
MOZ_RELEASE_ASSERT
(
!
JS
:
:
GetClass
(
global
)
-
>
getResolve
(
)
)
;
CHECK
(
JS
:
:
InitRealmStandardClasses
(
cx
)
)
;
CHECK
(
JS_DefineProperty
(
cx
global
"
HOTLOOP
"
8
0
)
)
;
EXEC
(
"
var
n
=
0
;
\
n
"
"
var
global
=
this
;
\
n
"
"
function
f
(
)
{
n
+
+
;
}
\
n
"
"
Object
.
defineProperty
(
Object
.
prototype
'
x
'
{
set
:
f
}
)
;
\
n
"
"
for
(
var
i
=
0
;
i
<
HOTLOOP
;
i
+
+
)
\
n
"
"
global
.
x
=
i
;
\
n
"
)
;
EXEC
(
"
if
(
n
!
=
HOTLOOP
)
\
n
"
"
throw
'
FAIL
'
;
\
n
"
)
;
return
true
;
}
const
JSClass
*
getGlobalClass
(
void
)
override
{
static
const
JSClassOps
noResolveGlobalClassOps
=
{
nullptr
nullptr
nullptr
nullptr
nullptr
nullptr
nullptr
nullptr
nullptr
nullptr
JS_GlobalObjectTraceHook
}
;
static
const
JSClass
noResolveGlobalClass
=
{
"
testSetProperty_InheritedGlobalSetter_noResolveGlobalClass
"
JSCLASS_GLOBAL_FLAGS
&
noResolveGlobalClassOps
}
;
return
&
noResolveGlobalClass
;
}
END_TEST
(
testSetProperty_InheritedGlobalSetter
)
