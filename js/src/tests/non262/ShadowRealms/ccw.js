var
g
=
newGlobal
(
{
newCompartment
:
true
}
)
;
var
sr
=
g
.
evaluate
(
new
ShadowRealm
(
)
)
;
ShadowRealm
.
prototype
.
evaluate
.
call
(
sr
"
var
x
=
10
"
)
;
assertEq
(
sr
.
evaluate
(
"
x
"
)
10
)
;
var
wrappedf
=
ShadowRealm
.
prototype
.
evaluate
.
call
(
sr
"
function
f
(
)
{
return
10
;
}
;
f
"
)
;
assertEq
(
wrappedf
(
)
10
)
;
var
evaluate_from_other_realm
=
g
.
evaluate
(
'
ShadowRealm
.
prototype
.
evaluate
'
)
;
var
wrappedb
=
evaluate_from_other_realm
.
call
(
sr
"
function
b
(
)
{
return
12
;
}
;
b
"
)
;
assertEq
(
wrappedb
(
)
12
)
;
nukeAllCCWs
(
)
assertThrowsInstanceOf
(
(
)
=
>
wrappedf
(
)
TypeError
)
;
assertThrowsInstanceOf
(
(
)
=
>
wrappedb
(
)
TypeError
)
;
if
(
typeof
reportCompare
=
=
=
'
function
'
)
reportCompare
(
true
true
)
;
