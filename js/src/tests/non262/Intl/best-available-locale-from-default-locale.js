if
(
typeof
getDefaultLocale
=
=
=
"
undefined
"
)
{
var
getDefaultLocale
=
SpecialPowers
.
Cu
.
getJSTestingFunctions
(
)
.
getDefaultLocale
;
}
if
(
typeof
setDefaultLocale
=
=
=
"
undefined
"
)
{
var
setDefaultLocale
=
SpecialPowers
.
Cu
.
getJSTestingFunctions
(
)
.
setDefaultLocale
;
}
let
defaultLocale
=
null
;
function
withLocale
(
locale
fn
)
{
if
(
defaultLocale
=
=
=
null
)
defaultLocale
=
getDefaultLocale
(
)
;
setDefaultLocale
(
locale
)
;
try
{
fn
(
)
;
}
finally
{
setDefaultLocale
(
defaultLocale
)
;
}
}
const
supported
=
Intl
.
Collator
.
supportedLocalesOf
(
"
de
"
)
;
assertEq
(
supported
.
length
1
)
;
assertEq
(
supported
[
0
]
"
de
"
)
;
withLocale
(
"
de
"
(
)
=
>
{
assertEq
(
new
Intl
.
Collator
(
)
.
resolvedOptions
(
)
.
locale
"
de
"
)
;
assertEq
(
new
Intl
.
Collator
(
"
de
"
)
.
resolvedOptions
(
)
.
locale
"
de
"
)
;
assertEq
(
new
Intl
.
Collator
(
"
de
-
ZA
"
)
.
resolvedOptions
(
)
.
locale
"
de
"
)
;
assertEq
(
new
Intl
.
Collator
(
"
de
-
ZA
-
x
-
private
"
)
.
resolvedOptions
(
)
.
locale
"
de
"
)
;
}
)
;
withLocale
(
"
de
-
ZA
-
x
-
private
"
(
)
=
>
{
assertEq
(
new
Intl
.
Collator
(
)
.
resolvedOptions
(
)
.
locale
"
de
-
ZA
-
x
-
private
"
)
;
assertEq
(
new
Intl
.
Collator
(
"
de
"
)
.
resolvedOptions
(
)
.
locale
"
de
"
)
;
assertEq
(
new
Intl
.
Collator
(
"
de
-
ZA
"
)
.
resolvedOptions
(
)
.
locale
"
de
-
ZA
"
)
;
assertEq
(
new
Intl
.
Collator
(
"
de
-
ZA
-
x
-
private
"
)
.
resolvedOptions
(
)
.
locale
"
de
-
ZA
-
x
-
private
"
)
;
}
)
;
if
(
typeof
reportCompare
=
=
=
"
function
"
)
reportCompare
(
0
0
)
;
