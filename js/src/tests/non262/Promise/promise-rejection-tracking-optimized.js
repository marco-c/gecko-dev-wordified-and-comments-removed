const
UNHANDLED
=
0
;
const
HANDLED
=
1
;
let
rejections
=
new
Map
(
)
;
function
rejectionTracker
(
promise
state
)
{
rejections
.
set
(
promise
state
)
;
}
setPromiseRejectionTrackerCallback
(
rejectionTracker
)
;
Promise
.
resolve
(
)
.
then
(
(
)
=
>
{
throw
1
;
}
)
;
drainJobQueue
(
)
;
assertEq
(
rejections
.
size
1
)
;
let
[
[
promise
state
]
]
=
rejections
;
assertEq
(
state
UNHANDLED
)
;
let
exc
;
promise
.
catch
(
x
=
>
{
exc
=
x
;
}
)
;
drainJobQueue
(
)
;
assertEq
(
rejections
.
get
(
promise
)
HANDLED
)
;
assertEq
(
exc
1
)
;
if
(
this
.
reportCompare
)
{
reportCompare
(
true
true
)
;
}
