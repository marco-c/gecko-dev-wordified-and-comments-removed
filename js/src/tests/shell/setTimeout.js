let
firstCalled
=
false
;
setTimeout
(
(
)
=
>
firstCalled
=
true
0
)
;
setTimeout
(
(
)
=
>
assertEq
(
firstCalled
true
)
0
)
;
drainJobQueue
(
)
;
assertEq
(
firstCalled
true
)
;
let
drainedQueue
=
false
;
setTimeout
(
(
)
=
>
assertEq
(
drainedQueue
true
)
)
;
Promise
.
resolve
(
)
.
then
(
)
.
then
(
(
)
=
>
drainedQueue
=
true
)
;
drainJobQueue
(
)
;
assertEq
(
drainedQueue
true
)
;
let
g
=
newGlobal
(
{
newCompartment
:
true
}
)
;
assertThrowsInstanceOf
(
(
)
=
>
g
.
setTimeout
(
(
)
=
>
{
}
)
g
.
Error
)
;
reportCompare
(
true
true
)
;
