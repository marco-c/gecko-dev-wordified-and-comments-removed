function
checkTimeZoneArithmetic
(
shiftInstant
shiftNs
realTimeZoneName
shiftWallTime
)
{
if
(
typeof
globalThis
.
Intl
=
=
=
"
undefined
"
)
return
;
const
tz
=
TemporalHelpers
.
oneShiftTimeZone
(
shiftInstant
shiftNs
)
;
const
realTz
=
new
Temporal
.
TimeZone
(
realTimeZoneName
)
;
assert
.
sameValue
(
tz
.
getOffsetNanosecondsFor
(
shiftInstant
)
realTz
.
getOffsetNanosecondsFor
(
shiftInstant
)
'
offset
at
shift
instant
'
)
;
const
minus1
=
shiftInstant
.
subtract
(
{
hours
:
1
}
)
;
assert
.
sameValue
(
tz
.
getOffsetNanosecondsFor
(
minus1
)
realTz
.
getOffsetNanosecondsFor
(
minus1
)
'
offset
at
1
hour
before
shift
'
)
;
const
plus1
=
shiftInstant
.
add
(
{
hours
:
1
}
)
;
assert
.
sameValue
(
tz
.
getOffsetNanosecondsFor
(
plus1
)
realTz
.
getOffsetNanosecondsFor
(
plus1
)
'
offset
at
1
hour
after
shift
'
)
;
assert
.
compareArray
(
tz
.
getPossibleInstantsFor
(
shiftWallTime
)
.
map
(
(
i
)
=
>
i
.
epochNanoseconds
)
realTz
.
getPossibleInstantsFor
(
shiftWallTime
)
.
map
(
(
i
)
=
>
i
.
epochNanoseconds
)
'
possible
instants
for
wall
time
'
)
;
const
before1
=
shiftWallTime
.
subtract
(
{
hours
:
1
}
)
;
assert
.
compareArray
(
tz
.
getPossibleInstantsFor
(
before1
)
.
map
(
(
i
)
=
>
i
.
epochNanoseconds
)
realTz
.
getPossibleInstantsFor
(
before1
)
.
map
(
(
i
)
=
>
i
.
epochNanoseconds
)
'
possible
instants
for
1
hour
before
wall
time
'
)
;
const
after1
=
shiftWallTime
.
add
(
{
hours
:
1
}
)
;
assert
.
compareArray
(
tz
.
getPossibleInstantsFor
(
after1
)
.
map
(
(
i
)
=
>
i
.
epochNanoseconds
)
realTz
.
getPossibleInstantsFor
(
after1
)
.
map
(
(
i
)
=
>
i
.
epochNanoseconds
)
'
possible
instants
for
1
hour
after
wall
time
'
)
;
}
checkTimeZoneArithmetic
(
new
Temporal
.
Instant
(
1616893200000000000n
)
3600e9
'
Europe
/
London
'
new
Temporal
.
PlainDateTime
(
2021
3
28
1
)
)
;
checkTimeZoneArithmetic
(
new
Temporal
.
Instant
(
1635642000000000000n
)
-
3600e9
'
Atlantic
/
Azores
'
new
Temporal
.
PlainDateTime
(
2021
10
31
1
)
)
;
checkTimeZoneArithmetic
(
new
Temporal
.
Instant
(
0n
)
0
'
UTC
'
new
Temporal
.
PlainDateTime
(
1970
1
1
)
)
;
reportCompare
(
0
0
)
;
