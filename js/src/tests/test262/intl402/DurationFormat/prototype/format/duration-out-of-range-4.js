const
df
=
new
Intl
.
DurationFormat
(
)
;
const
duration
=
{
milliseconds
:
4503599627370497_000
microseconds
:
4503599627370495_000000
}
;
let
durationSecondsNaive
=
Math
.
trunc
(
duration
.
milliseconds
/
1e3
+
duration
.
microseconds
/
1e6
)
;
assert
.
sameValue
(
Number
.
isSafeInteger
(
durationSecondsNaive
)
false
"
Naive
approach
incorrectly
computes
duration
seconds
as
out
-
of
-
range
"
)
;
let
durationSecondsExact
=
Number
(
BigInt
(
duration
.
milliseconds
)
/
1_000n
)
+
Number
(
BigInt
(
duration
.
microseconds
)
/
1_000_000n
)
+
Math
.
trunc
(
(
(
duration
.
milliseconds
%
1e3
)
*
1e3
+
(
duration
.
microseconds
%
1e6
)
)
/
1e6
)
;
assert
.
sameValue
(
Number
.
isSafeInteger
(
Number
(
durationSecondsExact
)
)
true
"
Exact
approach
correctly
computes
duration
seconds
as
in
-
range
"
)
;
assert
.
sameValue
(
typeof
df
.
format
(
duration
)
"
string
"
Duration
"
{
JSON
.
stringify
(
duration
)
}
"
doesn
'
t
throw
)
;
reportCompare
(
0
0
)
;
