asyncTest
(
async
function
(
)
{
let
values
=
[
]
;
async
function
TestAsyncDisposalWithSyncMethodReturningAPromise
(
)
{
let
stack
=
new
AsyncDisposableStack
(
)
;
const
neverResolves
=
Promise
.
withResolvers
(
)
.
promise
;
stack
.
use
(
{
[
Symbol
.
dispose
]
(
)
{
return
neverResolves
}
}
)
;
await
stack
.
disposeAsync
(
)
;
values
.
push
(
42
)
;
await
using
x
=
{
[
Symbol
.
dispose
]
:
(
)
=
>
neverResolves
}
;
values
.
push
(
43
)
;
}
;
await
TestAsyncDisposalWithSyncMethodReturningAPromise
(
)
;
assert
.
compareArray
(
values
[
42
43
]
)
;
}
)
;
