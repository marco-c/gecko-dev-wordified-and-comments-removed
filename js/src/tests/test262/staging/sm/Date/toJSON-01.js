var
called
;
var
dateToJSON
=
Date
.
prototype
.
toJSON
;
assert
.
sameValue
(
Date
.
prototype
.
hasOwnProperty
(
"
toJSON
"
)
true
)
;
assert
.
sameValue
(
typeof
dateToJSON
"
function
"
)
;
var
invalidDate
=
new
Date
(
)
;
invalidDate
.
setTime
(
NaN
)
;
assert
.
sameValue
(
JSON
.
stringify
(
{
p
:
invalidDate
}
)
'
{
"
p
"
:
null
}
'
)
;
assert
.
sameValue
(
dateToJSON
.
length
1
)
;
assert
.
throws
(
TypeError
function
(
)
{
dateToJSON
.
call
(
null
)
;
}
"
ToObject
throws
TypeError
for
null
"
)
;
assert
.
throws
(
TypeError
function
(
)
{
dateToJSON
.
call
(
undefined
)
;
}
"
ToObject
throws
TypeError
for
undefined
"
)
;
try
{
var
r
=
dateToJSON
.
call
(
{
get
valueOf
(
)
{
throw
17
;
}
}
)
;
throw
new
Error
(
"
didn
'
t
throw
returned
:
"
+
r
)
;
}
catch
(
e
)
{
assert
.
sameValue
(
e
17
"
bad
exception
:
"
+
e
)
;
}
called
=
false
;
assert
.
sameValue
(
dateToJSON
.
call
(
{
valueOf
:
null
toString
:
function
(
)
{
called
=
true
;
return
12
;
}
toISOString
:
function
(
)
{
return
"
ohai
"
;
}
}
)
"
ohai
"
)
;
assert
.
sameValue
(
called
true
)
;
called
=
false
;
assert
.
sameValue
(
dateToJSON
.
call
(
{
valueOf
:
function
(
)
{
called
=
true
;
return
42
;
}
toISOString
:
function
(
)
{
return
null
;
}
}
)
null
)
;
assert
.
sameValue
(
called
true
)
;
try
{
called
=
false
;
dateToJSON
.
call
(
{
valueOf
:
function
(
)
{
called
=
true
;
return
{
}
;
}
get
toString
(
)
{
throw
42
;
}
}
)
;
}
catch
(
e
)
{
assert
.
sameValue
(
called
true
)
;
assert
.
sameValue
(
e
42
"
bad
exception
:
"
+
e
)
;
}
called
=
false
;
assert
.
sameValue
(
dateToJSON
.
call
(
{
valueOf
:
function
(
)
{
called
=
true
;
return
{
}
;
}
get
toString
(
)
{
return
function
(
)
{
return
8675309
;
}
;
}
toISOString
:
function
(
)
{
return
true
;
}
}
)
true
)
;
assert
.
sameValue
(
called
true
)
;
var
asserted
=
false
;
called
=
false
;
assert
.
sameValue
(
dateToJSON
.
call
(
{
valueOf
:
function
(
)
{
called
=
true
;
return
{
}
;
}
get
toString
(
)
{
assert
.
sameValue
(
called
true
)
;
asserted
=
true
;
return
function
(
)
{
return
8675309
;
}
;
}
toISOString
:
function
(
)
{
return
NaN
;
}
}
)
NaN
)
;
assert
.
sameValue
(
asserted
true
)
;
assert
.
throws
(
TypeError
function
(
)
{
var
r
=
dateToJSON
.
call
(
{
valueOf
:
null
toString
:
null
get
toISOString
(
)
{
throw
new
Error
(
"
shouldn
'
t
have
been
gotten
"
)
;
}
}
)
;
}
)
;
assert
.
sameValue
(
dateToJSON
.
call
(
{
valueOf
:
function
(
)
{
return
Infinity
;
}
}
)
null
)
;
assert
.
sameValue
(
dateToJSON
.
call
(
{
valueOf
:
function
(
)
{
return
-
Infinity
;
}
}
)
null
)
;
assert
.
sameValue
(
dateToJSON
.
call
(
{
valueOf
:
function
(
)
{
return
NaN
;
}
}
)
null
)
;
assert
.
sameValue
(
dateToJSON
.
call
(
{
valueOf
:
function
(
)
{
return
Infinity
;
}
toISOString
:
function
(
)
{
return
{
}
;
}
}
)
null
)
;
assert
.
sameValue
(
dateToJSON
.
call
(
{
valueOf
:
function
(
)
{
return
-
Infinity
;
}
toISOString
:
function
(
)
{
return
[
]
;
}
}
)
null
)
;
assert
.
sameValue
(
dateToJSON
.
call
(
{
valueOf
:
function
(
)
{
return
NaN
;
}
toISOString
:
function
(
)
{
return
undefined
;
}
}
)
null
)
;
try
{
var
r
=
dateToJSON
.
call
(
{
get
toISOString
(
)
{
throw
42
;
}
}
)
;
throw
new
Error
(
"
didn
'
t
throw
returned
:
"
+
r
)
;
}
catch
(
e
)
{
assert
.
sameValue
(
e
42
"
bad
exception
:
"
+
e
)
;
}
assert
.
throws
(
TypeError
function
(
)
{
dateToJSON
.
call
(
{
toISOString
:
null
}
)
;
}
)
;
assert
.
throws
(
TypeError
function
(
)
{
dateToJSON
.
call
(
{
toISOString
:
undefined
}
)
;
}
)
;
assert
.
throws
(
TypeError
function
(
)
{
dateToJSON
.
call
(
{
toISOString
:
"
oogabooga
"
}
)
;
}
)
;
assert
.
throws
(
TypeError
function
(
)
{
dateToJSON
.
call
(
{
toISOString
:
Math
.
PI
}
)
;
}
)
;
var
o
=
{
toISOString
:
function
(
a
)
{
called
=
true
;
assert
.
sameValue
(
this
o
)
;
assert
.
sameValue
(
a
undefined
)
;
assert
.
sameValue
(
arguments
.
length
0
)
;
return
obj
;
}
}
;
var
obj
=
{
}
;
called
=
false
;
assert
.
sameValue
(
dateToJSON
.
call
(
o
)
obj
"
should
have
gotten
obj
back
"
)
;
assert
.
sameValue
(
called
true
)
;
reportCompare
(
0
0
)
;
