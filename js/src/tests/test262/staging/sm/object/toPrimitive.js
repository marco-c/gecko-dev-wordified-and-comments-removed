var
expectedThis
expectedHint
;
var
obj
=
{
[
Symbol
.
toPrimitive
]
(
hint
.
.
.
rest
)
{
assert
.
sameValue
(
this
expectedThis
)
;
assert
.
sameValue
(
hint
expectedHint
)
;
assert
.
sameValue
(
rest
.
length
0
)
;
return
2015
;
}
}
;
expectedThis
=
obj
;
expectedHint
=
"
string
"
;
assert
.
sameValue
(
String
(
obj
)
"
2015
"
)
;
expectedHint
=
"
number
"
;
assert
.
sameValue
(
Number
(
obj
)
2015
)
;
var
proxy
=
new
Proxy
(
obj
{
}
)
;
expectedThis
=
proxy
;
expectedHint
=
"
default
"
;
assert
.
sameValue
(
"
ES
"
+
proxy
"
ES2015
"
)
;
proxy
=
new
Proxy
(
Object
.
create
(
proxy
)
{
}
)
;
expectedThis
=
proxy
;
expectedHint
=
"
default
"
;
assert
.
sameValue
(
"
ES
"
+
(
proxy
+
1
)
"
ES2016
"
)
;
var
ok
=
true
;
for
(
var
constructor
of
[
Boolean
Number
String
Symbol
]
)
{
constructor
.
prototype
[
Symbol
.
toPrimitive
]
=
function
(
)
{
ok
=
false
;
throw
"
FAIL
"
;
}
;
}
assert
.
sameValue
(
Number
(
true
)
1
)
;
assert
.
sameValue
(
Number
(
77
.
7
)
77
.
7
)
;
assert
.
sameValue
(
Number
(
"
123
"
)
123
)
;
assertThrowsInstanceOf
(
(
)
=
>
Number
(
Symbol
.
iterator
)
TypeError
)
;
assert
.
sameValue
(
String
(
true
)
"
true
"
)
;
assert
.
sameValue
(
String
(
77
.
7
)
"
77
.
7
"
)
;
assert
.
sameValue
(
String
(
"
123
"
)
"
123
"
)
;
assert
.
sameValue
(
String
(
Symbol
.
iterator
)
"
Symbol
(
Symbol
.
iterator
)
"
)
;
assert
.
sameValue
(
ok
true
)
;
delete
Symbol
.
prototype
[
Symbol
.
toPrimitive
]
;
var
sym
=
Symbol
(
"
ok
"
)
;
assertThrowsInstanceOf
(
(
)
=
>
{
sym
}
TypeError
)
;
assertThrowsInstanceOf
(
(
)
=
>
Number
(
sym
)
TypeError
)
;
assertThrowsInstanceOf
(
(
)
=
>
"
"
+
sym
TypeError
)
;
obj
=
Object
(
sym
)
;
assert
.
sameValue
(
String
(
obj
)
"
Symbol
(
ok
)
"
)
;
assert
.
sameValue
(
{
obj
}
"
Symbol
(
ok
)
"
)
;
delete
Symbol
.
prototype
.
valueOf
;
delete
Object
.
prototype
.
valueOf
;
assert
.
sameValue
(
Number
(
obj
)
NaN
)
;
Symbol
.
prototype
.
toString
=
function
(
)
{
return
"
2060
"
;
}
;
assert
.
sameValue
(
Number
(
obj
)
2060
)
;
var
d
=
new
Date
;
assert
.
sameValue
(
0
+
d
0
+
d
.
toString
(
)
)
;
delete
Date
.
prototype
[
Symbol
.
toPrimitive
]
;
assert
.
sameValue
(
0
+
d
0
+
d
.
valueOf
(
)
)
;
var
log
=
[
]
;
function
doGet
(
target
propertyName
receiver
)
{
log
.
push
(
propertyName
)
;
}
var
handler
=
new
Proxy
(
{
}
{
get
(
target
trapName
receiver
)
{
if
(
trapName
!
=
=
"
get
"
)
throw
FAIL
:
system
tried
to
access
handler
method
:
{
String
(
trapName
)
}
;
return
doGet
;
}
}
)
;
proxy
=
new
Proxy
(
Object
.
create
(
null
)
handler
)
;
assertThrowsInstanceOf
(
(
)
=
>
proxy
=
=
0
TypeError
)
;
assert
.
deepEqual
(
log
[
Symbol
.
toPrimitive
"
valueOf
"
"
toString
"
]
)
;
reportCompare
(
0
0
)
;
