assert
.
throws
(
TypeError
(
)
=
>
{
let
buffer
=
new
ArrayBuffer
(
32
)
;
let
array
=
new
Int32Array
(
buffer
)
;
262
.
detachArrayBuffer
(
buffer
)
;
array
.
sort
(
)
;
}
)
;
{
let
detached
=
false
;
let
ta
=
new
Int32Array
(
3
)
;
ta
.
sort
(
function
(
a
b
)
{
if
(
!
detached
)
{
detached
=
true
;
262
.
detachArrayBuffer
(
ta
.
buffer
)
;
}
return
a
-
b
;
}
)
;
assert
.
sameValue
(
detached
true
)
;
}
let
otherGlobal
=
262
.
createRealm
(
)
.
global
;
{
let
ta
=
new
Int32Array
(
3
)
;
otherGlobal
.
Int32Array
.
prototype
.
sort
.
call
(
ta
function
(
a
b
)
{
return
a
-
b
;
}
)
;
}
{
let
detached
=
false
;
let
ta
=
new
Int32Array
(
3
)
;
otherGlobal
.
Int32Array
.
prototype
.
sort
.
call
(
ta
function
(
a
b
)
{
if
(
!
detached
)
{
detached
=
true
;
262
.
detachArrayBuffer
(
ta
.
buffer
)
;
}
return
a
-
b
;
}
)
;
assert
.
sameValue
(
detached
true
)
;
}
assert
.
throws
(
TypeError
(
)
=
>
{
let
array
=
[
4
3
2
1
]
;
Int32Array
.
prototype
.
sort
.
call
(
array
)
;
}
)
;
assert
.
throws
(
TypeError
(
)
=
>
{
Int32Array
.
prototype
.
sort
.
call
(
{
a
:
1
b
:
2
}
)
;
}
)
;
assert
.
throws
(
TypeError
(
)
=
>
{
Int32Array
.
prototype
.
sort
.
call
(
Int32Array
.
prototype
)
;
}
)
;
assert
.
throws
(
TypeError
(
)
=
>
{
let
buf
=
new
ArrayBuffer
(
32
)
;
Int32Array
.
prototype
.
sort
.
call
(
buf
)
;
}
)
;
function
badComparator
(
x
y
)
{
if
(
x
=
=
99
&
&
y
=
=
99
)
throw
new
TypeError
;
return
x
-
y
;
}
assert
.
throws
(
TypeError
(
)
=
>
{
let
array
=
new
Uint8Array
(
[
99
99
99
99
]
)
;
array
.
sort
(
badComparator
)
;
}
)
;
assert
.
throws
(
TypeError
(
)
=
>
{
let
array
=
new
Uint8Array
(
[
1
99
2
99
]
)
;
array
.
sort
(
badComparator
)
;
}
)
;
reportCompare
(
0
0
)
;
