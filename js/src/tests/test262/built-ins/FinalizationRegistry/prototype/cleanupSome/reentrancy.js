var
called
=
0
;
var
endOfCall
=
0
;
var
finalizationRegistry
=
new
FinalizationRegistry
(
function
(
)
{
}
)
;
function
callback
(
holding
)
{
called
+
=
1
;
if
(
called
=
=
=
1
)
{
var
nestedCallbackRan
=
false
;
finalizationRegistry
.
cleanupSome
(
(
)
=
>
{
nestedCallbackRan
=
true
}
)
;
assert
.
sameValue
(
nestedCallbackRan
true
)
;
}
endOfCall
+
=
1
;
}
function
emptyCells
(
)
{
var
o1
=
{
}
;
var
o2
=
{
}
;
finalizationRegistry
.
register
(
o1
'
holdings
1
'
)
;
finalizationRegistry
.
register
(
o2
'
holdings
2
'
)
;
var
prom
=
asyncGC
(
o1
)
;
o1
=
null
;
return
prom
;
}
emptyCells
(
)
.
then
(
function
(
)
{
finalizationRegistry
.
cleanupSome
(
callback
)
;
assert
.
sameValue
(
called
1
'
callback
was
called
'
)
;
assert
.
sameValue
(
endOfCall
1
'
callback
finished
'
)
;
}
)
.
then
(
DONE
resolveAsyncGC
)
;
