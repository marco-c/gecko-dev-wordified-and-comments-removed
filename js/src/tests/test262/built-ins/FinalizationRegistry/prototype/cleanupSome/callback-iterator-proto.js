var
IteratorPrototype
=
Object
.
getPrototypeOf
(
Object
.
getPrototypeOf
(
[
]
[
Symbol
.
iterator
]
(
)
)
)
;
var
FinalizationRegistryCleanupIteratorPrototype
;
var
called
=
0
;
var
cleanupCallbackCalled
=
0
;
function
callback
(
iterator
)
{
called
+
=
1
;
FinalizationRegistryCleanupIteratorPrototype
=
Object
.
getPrototypeOf
(
iterator
)
;
}
var
finalizationRegistry
=
new
FinalizationRegistry
(
function
(
)
{
cleanupCallbackCalled
+
=
1
;
}
)
;
async
function
register
(
)
{
var
target
=
{
}
;
finalizationRegistry
.
register
(
target
)
;
var
prom
=
asyncGC
(
target
)
;
target
=
null
;
assert
.
sameValue
(
called
0
)
;
return
prom
;
}
register
(
)
.
then
(
function
(
)
{
cleanupCallbackCalled
=
0
;
finalizationRegistry
.
cleanupSome
(
callback
)
;
assert
.
sameValue
(
called
1
)
;
var
proto
=
Object
.
getPrototypeOf
(
FinalizationRegistryCleanupIteratorPrototype
)
;
assert
.
sameValue
(
proto
IteratorPrototype
'
[
[
Prototype
]
]
internal
slot
whose
value
is
the
intrinsic
object
%
IteratorPrototype
%
'
)
;
assert
.
sameValue
(
cleanupCallbackCalled
0
'
if
a
callback
is
given
do
not
call
cleanupCallback
'
)
;
}
)
.
then
(
DONE
resolveAsyncGC
)
;
