var
createBadPromise
=
false
;
var
object
=
{
}
;
class
P
extends
Promise
{
constructor
(
executor
)
{
if
(
createBadPromise
)
{
executor
(
function
(
v
)
{
assert
.
sameValue
(
v
object
)
;
DONE
(
)
;
}
function
(
e
)
{
DONE
(
e
)
;
}
)
;
return
object
;
}
return
super
(
executor
)
;
}
}
var
p
=
P
.
resolve
(
object
)
;
createBadPromise
=
true
;
var
q
=
p
.
then
(
)
;
createBadPromise
=
false
;
assert
.
sameValue
(
q
object
"
then
(
)
returns
object
"
)
;
