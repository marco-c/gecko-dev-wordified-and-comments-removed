const
calls
=
[
]
;
const
duration
=
Temporal
.
Duration
.
from
(
{
days
:
1
}
)
;
function
createRelativeTo
(
count
)
{
const
dayLengthNs
=
86400000000000n
;
const
dayInstant
=
new
Temporal
.
Instant
(
dayLengthNs
)
;
const
substitutions
=
[
]
;
const
timeZone
=
new
Temporal
.
TimeZone
(
"
UTC
"
)
;
TemporalHelpers
.
substituteMethod
(
timeZone
"
getPossibleInstantsFor
"
substitutions
)
;
substitutions
.
length
=
count
;
let
i
=
0
;
for
(
i
=
0
;
i
<
substitutions
.
length
;
i
+
+
)
{
substitutions
[
i
]
=
[
dayInstant
]
;
}
TemporalHelpers
.
observeMethod
(
calls
timeZone
"
getPossibleInstantsFor
"
)
;
return
new
Temporal
.
ZonedDateTime
(
0n
timeZone
)
;
}
let
zdt
=
createRelativeTo
(
50
)
;
calls
.
splice
(
0
)
;
duration
.
add
(
duration
{
relativeTo
:
zdt
}
)
;
assert
.
sameValue
(
calls
.
length
50
+
1
"
Expected
duration
.
add
to
call
getPossibleInstantsFor
correct
number
of
times
"
)
;
zdt
=
createRelativeTo
(
100
)
;
calls
.
splice
(
0
)
;
duration
.
add
(
duration
{
relativeTo
:
zdt
}
)
;
assert
.
sameValue
(
calls
.
length
100
+
1
"
Expected
duration
.
add
to
call
getPossibleInstantsFor
correct
number
of
times
"
)
;
zdt
=
createRelativeTo
(
107
)
;
assert
.
throws
(
RangeError
(
)
=
>
duration
.
add
(
duration
{
relativeTo
:
zdt
}
)
"
107
-
2
days
>
2
ns
"
)
;
reportCompare
(
0
0
)
;
