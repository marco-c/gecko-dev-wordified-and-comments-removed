var
called
=
0
;
var
searchValue
=
/
.
/
g
;
Object
.
defineProperty
(
searchValue
Symbol
.
replace
{
value
:
function
(
O
replaceValue
)
{
assert
.
sameValue
(
this
searchValue
)
;
assert
.
sameValue
(
O
poison
'
first
arg
is
the
this
value
of
replaceAll
'
)
;
assert
.
sameValue
(
replaceValue
poison
'
second
arg
is
the
replaceValue
'
)
;
assert
.
sameValue
(
arguments
.
length
2
)
;
called
+
=
1
;
return
'
return
from
searchValue
'
;
}
}
)
;
Object
.
defineProperty
(
searchValue
'
toString
'
{
value
:
function
(
)
{
throw
'
Should
not
call
toString
on
searchValue
'
;
}
}
)
;
var
poisoned
=
0
;
var
poison
=
{
toString
(
)
{
poisoned
+
=
1
;
throw
'
Should
not
call
toString
on
this
/
replaceValue
'
;
}
}
;
var
returned
=
'
'
.
replaceAll
.
call
(
poison
searchValue
poison
)
;
assert
.
sameValue
(
returned
'
return
from
searchValue
'
)
;
assert
.
sameValue
(
called
1
)
;
assert
.
sameValue
(
poisoned
0
)
;
reportCompare
(
0
0
)
;
