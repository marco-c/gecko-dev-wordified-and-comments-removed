if
(
typeof
newGlobal
=
=
=
"
function
"
)
{
var
otherGlobal
=
newGlobal
(
)
;
function
taintLengthProperty
(
obj
)
{
Object
.
defineProperty
(
obj
"
length
"
{
get
(
)
{
assertEq
(
true
false
)
;
}
}
)
;
}
for
(
var
TA
of
anyTypedArrayConstructors
)
{
var
target
=
new
TA
(
4
)
;
var
source
=
new
otherGlobal
[
TA
.
name
]
(
[
10
20
]
)
;
taintLengthProperty
(
source
)
;
assertEqArray
(
target
[
0
0
0
0
]
)
;
target
.
set
(
source
1
)
;
assertEqArray
(
target
[
0
10
20
0
]
)
;
}
if
(
typeof
detachArrayBuffer
=
=
=
"
function
"
)
{
for
(
var
TA
of
typedArrayConstructors
)
{
var
target
=
new
TA
(
4
)
;
var
source
=
new
otherGlobal
[
TA
.
name
]
(
1
)
;
taintLengthProperty
(
source
)
;
otherGlobal
.
detachArrayBuffer
(
source
.
buffer
)
;
assertThrowsInstanceOf
(
(
)
=
>
target
.
set
(
source
)
TypeError
)
;
var
source
=
new
otherGlobal
[
TA
.
name
]
(
1
)
;
taintLengthProperty
(
source
)
;
var
offset
=
{
valueOf
(
)
{
otherGlobal
.
detachArrayBuffer
(
source
.
buffer
)
;
return
0
;
}
}
;
assertThrowsInstanceOf
(
(
)
=
>
target
.
set
(
source
offset
)
TypeError
)
;
}
for
(
var
TA
of
typedArrayConstructors
)
{
var
target
=
new
TA
(
4
)
;
var
source
=
new
TA
(
new
otherGlobal
.
ArrayBuffer
(
1
*
TA
.
BYTES_PER_ELEMENT
)
)
;
taintLengthProperty
(
source
)
;
otherGlobal
.
detachArrayBuffer
(
source
.
buffer
)
;
assertThrowsInstanceOf
(
(
)
=
>
target
.
set
(
source
)
TypeError
)
;
var
source
=
new
TA
(
new
otherGlobal
.
ArrayBuffer
(
1
*
TA
.
BYTES_PER_ELEMENT
)
)
;
taintLengthProperty
(
source
)
;
var
offset
=
{
valueOf
(
)
{
otherGlobal
.
detachArrayBuffer
(
source
.
buffer
)
;
return
0
;
}
}
;
assertThrowsInstanceOf
(
(
)
=
>
target
.
set
(
source
offset
)
TypeError
)
;
}
}
}
if
(
typeof
reportCompare
=
=
=
"
function
"
)
reportCompare
(
true
true
)
;
