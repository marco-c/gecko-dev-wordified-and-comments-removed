extern
crate
arbitrary
;
extern
crate
wasm_smith
;
use
arbitrary
:
:
{
Arbitrary
Unstructured
}
;
use
wasm_smith
:
:
{
Config
Module
}
;
use
std
:
:
ptr
;
#
[
derive
(
Arbitrary
Debug
)
]
struct
SpiderMonkeyConfig
;
impl
Config
for
SpiderMonkeyConfig
{
fn
bulk_memory_enabled
(
&
self
)
-
>
bool
{
true
}
fn
reference_types_enabled
(
&
self
)
-
>
bool
{
true
}
fn
relaxed_simd_enabled
(
&
self
)
-
>
bool
{
true
}
fn
exceptions_enabled
(
&
self
)
-
>
bool
{
true
}
fn
memory64_enabled
(
&
self
)
-
>
bool
{
true
}
fn
simd_enabled
(
&
self
)
-
>
bool
{
true
}
fn
tail_call_enabled
(
&
self
)
-
>
bool
{
true
}
fn
threads_enabled
(
&
self
)
-
>
bool
{
true
}
}
#
[
no_mangle
]
pub
unsafe
extern
"
C
"
fn
gluesmith
(
data
:
*
mut
u8
len
:
usize
out
:
*
mut
u8
maxlen
:
usize
)
-
>
usize
{
let
buf
:
&
[
u8
]
=
std
:
:
slice
:
:
from_raw_parts
(
data
len
)
;
let
mut
u
=
Unstructured
:
:
new
(
buf
)
;
let
module
=
match
Module
:
:
new
(
SpiderMonkeyConfig
{
}
&
mut
u
)
{
Ok
(
m
)
=
>
m
Err
(
_e
)
=
>
return
0
}
;
let
wasm_bytes
=
module
.
to_bytes
(
)
;
let
src_len
=
wasm_bytes
.
len
(
)
;
if
src_len
>
maxlen
{
return
0
;
}
let
src_ptr
=
wasm_bytes
.
as_ptr
(
)
;
ptr
:
:
copy_nonoverlapping
(
src_ptr
out
src_len
)
;
return
src_len
;
}
