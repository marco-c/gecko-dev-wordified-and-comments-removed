#
ifndef
js_OffThreadScriptCompilation_h
#
define
js_OffThreadScriptCompilation_h
#
include
"
mozilla
/
Range
.
h
"
#
include
"
mozilla
/
Utf8
.
h
"
#
include
"
mozilla
/
Vector
.
h
"
#
include
<
stddef
.
h
>
#
include
"
jstypes
.
h
"
#
include
"
js
/
BinASTFormat
.
h
"
#
include
"
js
/
CompileOptions
.
h
"
#
include
"
js
/
GCVector
.
h
"
#
include
"
js
/
Transcoding
.
h
"
struct
JS_PUBLIC_API
JSContext
;
class
JS_PUBLIC_API
JSScript
;
namespace
JS
{
template
<
typename
UnitT
>
class
SourceText
;
}
namespace
JS
{
class
OffThreadToken
;
using
OffThreadCompileCallback
=
void
(
*
)
(
OffThreadToken
*
token
void
*
callbackData
)
;
extern
JS_PUBLIC_API
bool
CanCompileOffThread
(
JSContext
*
cx
const
ReadOnlyCompileOptions
&
options
size_t
length
)
;
extern
JS_PUBLIC_API
bool
CompileOffThread
(
JSContext
*
cx
const
ReadOnlyCompileOptions
&
options
SourceText
<
char16_t
>
&
srcBuf
OffThreadCompileCallback
callback
void
*
callbackData
)
;
extern
JS_PUBLIC_API
bool
CompileOffThread
(
JSContext
*
cx
const
ReadOnlyCompileOptions
&
options
SourceText
<
mozilla
:
:
Utf8Unit
>
&
srcBuf
OffThreadCompileCallback
callback
void
*
callbackData
)
;
extern
JS_PUBLIC_API
JSScript
*
FinishOffThreadScript
(
JSContext
*
cx
OffThreadToken
*
token
)
;
extern
JS_PUBLIC_API
void
CancelOffThreadScript
(
JSContext
*
cx
OffThreadToken
*
token
)
;
extern
JS_PUBLIC_API
bool
CompileOffThreadModule
(
JSContext
*
cx
const
ReadOnlyCompileOptions
&
options
SourceText
<
char16_t
>
&
srcBuf
OffThreadCompileCallback
callback
void
*
callbackData
)
;
extern
JS_PUBLIC_API
bool
CompileOffThreadModule
(
JSContext
*
cx
const
ReadOnlyCompileOptions
&
options
SourceText
<
mozilla
:
:
Utf8Unit
>
&
srcBuf
OffThreadCompileCallback
callback
void
*
callbackData
)
;
extern
JS_PUBLIC_API
JSObject
*
FinishOffThreadModule
(
JSContext
*
cx
OffThreadToken
*
token
)
;
extern
JS_PUBLIC_API
void
CancelOffThreadModule
(
JSContext
*
cx
OffThreadToken
*
token
)
;
extern
JS_PUBLIC_API
bool
CanDecodeOffThread
(
JSContext
*
cx
const
ReadOnlyCompileOptions
&
options
size_t
length
)
;
extern
JS_PUBLIC_API
bool
DecodeOffThreadScript
(
JSContext
*
cx
const
ReadOnlyCompileOptions
&
options
mozilla
:
:
Vector
<
uint8_t
>
&
buffer
size_t
cursor
OffThreadCompileCallback
callback
void
*
callbackData
)
;
extern
JS_PUBLIC_API
bool
DecodeOffThreadScript
(
JSContext
*
cx
const
ReadOnlyCompileOptions
&
options
const
mozilla
:
:
Range
<
uint8_t
>
&
range
OffThreadCompileCallback
callback
void
*
callbackData
)
;
extern
JS_PUBLIC_API
JSScript
*
FinishOffThreadScriptDecoder
(
JSContext
*
cx
OffThreadToken
*
token
)
;
extern
JS_PUBLIC_API
void
CancelOffThreadScriptDecoder
(
JSContext
*
cx
OffThreadToken
*
token
)
;
extern
JS_PUBLIC_API
bool
DecodeMultiOffThreadScripts
(
JSContext
*
cx
const
ReadOnlyCompileOptions
&
options
mozilla
:
:
Vector
<
TranscodeSource
>
&
sources
OffThreadCompileCallback
callback
void
*
callbackData
)
;
extern
JS_PUBLIC_API
bool
FinishMultiOffThreadScriptsDecoder
(
JSContext
*
cx
OffThreadToken
*
token
MutableHandle
<
GCVector
<
JSScript
*
>
>
scripts
)
;
extern
JS_PUBLIC_API
void
CancelMultiOffThreadScriptsDecoder
(
JSContext
*
cx
OffThreadToken
*
token
)
;
#
if
defined
(
JS_BUILD_BINAST
)
extern
JS_PUBLIC_API
bool
CanDecodeBinASTOffThread
(
JSContext
*
cx
const
ReadOnlyCompileOptions
&
options
size_t
length
)
;
extern
JS_PUBLIC_API
bool
DecodeBinASTOffThread
(
JSContext
*
cx
const
ReadOnlyCompileOptions
&
options
const
uint8_t
*
buf
size_t
length
JS
:
:
BinASTFormat
format
OffThreadCompileCallback
callback
void
*
callbackData
)
;
extern
JS_PUBLIC_API
JSScript
*
FinishOffThreadBinASTDecode
(
JSContext
*
cx
OffThreadToken
*
token
)
;
#
endif
}
#
endif
