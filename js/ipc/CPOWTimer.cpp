#
include
"
jsfriendapi
.
h
"
#
include
"
nsContentUtils
.
h
"
#
include
"
CPOWTimer
.
h
"
#
include
"
jsapi
.
h
"
CPOWTimer
:
:
CPOWTimer
(
JSContext
*
cx
MOZ_GUARD_OBJECT_NOTIFIER_PARAM_IN_IMPL
)
:
cx_
(
nullptr
)
startInterval_
(
0
)
{
MOZ_GUARD_OBJECT_NOTIFIER_INIT
;
JSRuntime
*
runtime
=
JS_GetRuntime
(
cx
)
;
if
(
!
js
:
:
GetStopwatchIsMonitoringCPOW
(
runtime
)
)
return
;
cx_
=
cx
;
startInterval_
=
JS_Now
(
)
;
}
CPOWTimer
:
:
~
CPOWTimer
(
)
{
if
(
!
cx_
)
{
return
;
}
JSRuntime
*
runtime
=
JS_GetRuntime
(
cx_
)
;
if
(
!
js
:
:
GetStopwatchIsMonitoringCPOW
(
runtime
)
)
{
return
;
}
const
int64_t
endInterval
=
JS_Now
(
)
;
if
(
endInterval
<
=
startInterval_
)
{
return
;
}
js
:
:
AddCPOWPerformanceDelta
(
runtime
endInterval
-
startInterval_
)
;
}
