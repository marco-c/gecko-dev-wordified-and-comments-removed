#
include
<
stdio
.
h
>
#
include
"
mozilla
/
Bootstrap
.
h
"
#
include
"
XREShellData
.
h
"
#
include
"
nsXULAppAPI
.
h
"
#
ifdef
XP_MACOSX
#
include
"
xpcshellMacUtils
.
h
"
#
endif
#
ifdef
XP_WIN
#
include
"
mozilla
/
WindowsDllBlocklist
.
h
"
#
include
<
windows
.
h
>
#
include
<
shlobj
.
h
>
#
define
XRE_WANT_ENVIRON
#
include
"
nsWindowsWMain
.
cpp
"
#
ifdef
MOZ_SANDBOX
#
include
"
mozilla
/
sandboxing
/
SandboxInitialization
.
h
"
#
endif
#
endif
#
ifdef
MOZ_WIDGET_GTK
#
include
<
gtk
/
gtk
.
h
>
#
endif
#
include
"
BaseProfiler
.
h
"
#
ifdef
LIBFUZZER
#
include
"
FuzzerDefs
.
h
"
#
endif
int
main
(
int
argc
char
*
*
argv
char
*
*
envp
)
{
#
ifdef
MOZ_WIDGET_GTK
gtk_parse_args
(
&
argc
&
argv
)
;
#
endif
#
ifdef
XP_MACOSX
InitAutoreleasePool
(
)
;
#
endif
setbuf
(
stdout
nullptr
)
;
#
ifdef
HAS_DLL_BLOCKLIST
DllBlocklist_Initialize
(
)
;
#
endif
char
aLocal
;
mozilla
:
:
baseprofiler
:
:
profiler_init
(
&
aLocal
)
;
XREShellData
shellData
;
#
if
defined
(
XP_WIN
)
&
&
defined
(
MOZ_SANDBOX
)
shellData
.
sandboxBrokerServices
=
mozilla
:
:
sandboxing
:
:
GetInitializedBrokerServices
(
)
;
#
endif
auto
bootstrapResult
=
mozilla
:
:
GetBootstrap
(
)
;
if
(
bootstrapResult
.
isErr
(
)
)
{
return
2
;
}
mozilla
:
:
Bootstrap
:
:
UniquePtr
bootstrap
=
bootstrapResult
.
unwrap
(
)
;
#
ifdef
LIBFUZZER
shellData
.
fuzzerDriver
=
fuzzer
:
:
FuzzerDriver
;
#
endif
int
result
=
bootstrap
-
>
XRE_XPCShellMain
(
argc
argv
envp
&
shellData
)
;
mozilla
:
:
baseprofiler
:
:
profiler_shutdown
(
)
;
#
if
defined
(
DEBUG
)
&
&
defined
(
HAS_DLL_BLOCKLIST
)
DllBlocklist_Shutdown
(
)
;
#
endif
#
ifdef
XP_MACOSX
FinishAutoreleasePool
(
)
;
#
endif
return
result
;
}
