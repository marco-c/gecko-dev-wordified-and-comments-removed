#
ifndef
__AccessCheck_h__
#
define
__AccessCheck_h__
#
include
"
js
/
Id
.
h
"
#
include
"
js
/
Wrapper
.
h
"
#
include
"
nsString
.
h
"
class
nsIPrincipal
;
namespace
xpc
{
class
AccessCheck
{
public
:
static
bool
subsumes
(
JSObject
*
a
JSObject
*
b
)
;
static
bool
wrapperSubsumes
(
JSObject
*
wrapper
)
;
static
bool
subsumesConsideringDomain
(
JS
:
:
Compartment
*
a
JS
:
:
Compartment
*
b
)
;
static
bool
subsumesConsideringDomainIgnoringFPD
(
JS
:
:
Compartment
*
a
JS
:
:
Compartment
*
b
)
;
static
bool
isChrome
(
JS
:
:
Compartment
*
compartment
)
;
static
bool
isChrome
(
JSObject
*
obj
)
;
static
bool
checkPassToPrivilegedCode
(
JSContext
*
cx
JS
:
:
HandleObject
wrapper
JS
:
:
HandleValue
value
)
;
static
bool
checkPassToPrivilegedCode
(
JSContext
*
cx
JS
:
:
HandleObject
wrapper
const
JS
:
:
CallArgs
&
args
)
;
static
void
reportCrossOriginDenial
(
JSContext
*
cx
JS
:
:
HandleId
id
const
nsACString
&
accessType
)
;
}
;
bool
IsCrossOriginAccessibleObject
(
JSObject
*
obj
)
;
struct
Policy
{
static
bool
checkCall
(
JSContext
*
cx
JS
:
:
HandleObject
wrapper
const
JS
:
:
CallArgs
&
args
)
{
MOZ_CRASH
(
"
As
a
rule
filtering
wrappers
are
non
-
callable
"
)
;
}
}
;
struct
Opaque
:
public
Policy
{
static
bool
check
(
JSContext
*
cx
JSObject
*
wrapper
jsid
id
js
:
:
Wrapper
:
:
Action
act
)
{
return
false
;
}
static
bool
deny
(
JSContext
*
cx
js
:
:
Wrapper
:
:
Action
act
JS
:
:
HandleId
id
bool
mayThrow
)
{
return
false
;
}
static
bool
allowNativeCall
(
JSContext
*
cx
JS
:
:
IsAcceptableThis
test
JS
:
:
NativeImpl
impl
)
{
return
false
;
}
}
;
struct
OpaqueWithCall
:
public
Policy
{
static
bool
check
(
JSContext
*
cx
JSObject
*
wrapper
jsid
id
js
:
:
Wrapper
:
:
Action
act
)
{
return
act
=
=
js
:
:
Wrapper
:
:
CALL
;
}
static
bool
deny
(
JSContext
*
cx
js
:
:
Wrapper
:
:
Action
act
JS
:
:
HandleId
id
bool
mayThrow
)
{
return
false
;
}
static
bool
allowNativeCall
(
JSContext
*
cx
JS
:
:
IsAcceptableThis
test
JS
:
:
NativeImpl
impl
)
{
return
false
;
}
static
bool
checkCall
(
JSContext
*
cx
JS
:
:
HandleObject
wrapper
const
JS
:
:
CallArgs
&
args
)
{
return
AccessCheck
:
:
checkPassToPrivilegedCode
(
cx
wrapper
args
)
;
}
}
;
struct
OpaqueWithSilentFailing
:
public
Policy
{
static
bool
check
(
JSContext
*
cx
JS
:
:
HandleObject
wrapper
JS
:
:
HandleId
id
js
:
:
Wrapper
:
:
Action
act
)
{
return
false
;
}
static
bool
deny
(
JSContext
*
cx
js
:
:
Wrapper
:
:
Action
act
JS
:
:
HandleId
id
bool
mayThrow
)
;
static
bool
allowNativeCall
(
JSContext
*
cx
JS
:
:
IsAcceptableThis
test
JS
:
:
NativeImpl
impl
)
{
return
false
;
}
}
;
}
#
endif
