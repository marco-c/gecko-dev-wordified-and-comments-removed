function
run_test
(
)
{
try
{
var
nullWeak
=
Cu
.
getWeakReference
(
null
)
;
Assert
.
ok
(
nullWeak
.
get
(
)
=
=
=
null
)
;
}
catch
(
e
)
{
Assert
.
ok
(
false
)
;
}
var
obj
=
{
num
:
5
str
:
'
foo
'
}
;
var
weak
=
Cu
.
getWeakReference
(
obj
)
;
Assert
.
ok
(
weak
.
get
(
)
=
=
=
obj
)
;
Assert
.
ok
(
weak
.
get
(
)
.
num
=
=
5
)
;
Assert
.
ok
(
weak
.
get
(
)
.
str
=
=
'
foo
'
)
;
Cu
.
forceGC
(
)
;
Assert
.
ok
(
weak
.
get
(
)
=
=
=
obj
)
;
Assert
.
ok
(
weak
.
get
(
)
.
num
=
=
5
)
;
Assert
.
ok
(
weak
.
get
(
)
.
str
=
=
'
foo
'
)
;
obj
=
{
num
:
6
str
:
'
foo2
'
}
;
var
weak2
=
Cu
.
getWeakReference
(
obj
)
;
Assert
.
ok
(
weak2
.
get
(
)
=
=
=
obj
)
;
Cu
.
forceGC
(
)
;
Assert
.
ok
(
weak
.
get
(
)
=
=
=
null
)
;
}
