function
run_test
(
)
{
registerXPCTestComponents
(
)
;
registerAppManifest
(
do_get_file
(
'
.
.
/
components
/
js
/
xpctest
.
manifest
'
)
)
;
test_component_readwrite
(
"
mozilla
.
org
/
js
/
xpc
/
test
/
native
/
ObjectReadWrite
;
1
"
)
;
test_component_readwrite
(
"
mozilla
.
org
/
js
/
xpc
/
test
/
js
/
ObjectReadWrite
;
1
"
)
;
test_component_readonly
(
"
mozilla
.
org
/
js
/
xpc
/
test
/
native
/
ObjectReadOnly
;
1
"
)
;
test_component_readonly
(
"
mozilla
.
org
/
js
/
xpc
/
test
/
js
/
ObjectReadOnly
;
1
"
)
;
}
function
test_component_readwrite
(
contractid
)
{
var
o
=
Cc
[
contractid
]
.
createInstance
(
Ci
[
"
nsIXPCTestObjectReadWrite
"
]
)
;
Assert
.
equal
(
"
XPConnect
Read
-
Writable
String
"
o
.
stringProperty
)
;
Assert
.
equal
(
true
o
.
booleanProperty
)
;
Assert
.
equal
(
32767
o
.
shortProperty
)
;
Assert
.
equal
(
2147483647
o
.
longProperty
)
;
Assert
.
ok
(
5
.
25
<
o
.
floatProperty
&
&
5
.
75
>
o
.
floatProperty
)
;
Assert
.
equal
(
"
X
"
o
.
charProperty
)
;
Assert
.
equal
(
-
1
o
.
timeProperty
)
;
o
.
stringProperty
=
"
another
string
"
;
o
.
booleanProperty
=
false
;
o
.
shortProperty
=
-
12345
;
o
.
longProperty
=
1234567890
;
o
.
floatProperty
=
10
.
2
;
o
.
charProperty
=
"
Z
"
;
o
.
timeProperty
=
1
;
Assert
.
equal
(
"
another
string
"
o
.
stringProperty
)
;
Assert
.
equal
(
false
o
.
booleanProperty
)
;
Assert
.
equal
(
-
12345
o
.
shortProperty
)
;
Assert
.
equal
(
1234567890
o
.
longProperty
)
;
Assert
.
ok
(
10
.
15
<
o
.
floatProperty
&
&
10
.
25
>
o
.
floatProperty
)
;
Assert
.
equal
(
"
Z
"
o
.
charProperty
)
;
Assert
.
equal
(
1
o
.
timeProperty
)
;
function
SetAndTestBooleanProperty
(
newValue
expectedValue
)
{
o
.
booleanProperty
=
newValue
;
Assert
.
equal
(
expectedValue
o
.
booleanProperty
)
;
}
;
SetAndTestBooleanProperty
(
false
false
)
;
SetAndTestBooleanProperty
(
1
true
)
;
SetAndTestBooleanProperty
(
null
false
)
;
SetAndTestBooleanProperty
(
"
A
"
true
)
;
SetAndTestBooleanProperty
(
undefined
false
)
;
SetAndTestBooleanProperty
(
[
]
true
)
;
SetAndTestBooleanProperty
(
{
}
true
)
;
}
function
test_component_readonly
(
contractid
)
{
var
o
=
Cc
[
contractid
]
.
createInstance
(
Ci
[
"
nsIXPCTestObjectReadOnly
"
]
)
;
Assert
.
equal
(
"
XPConnect
Read
-
Only
String
"
o
.
strReadOnly
)
;
Assert
.
equal
(
true
o
.
boolReadOnly
)
;
Assert
.
equal
(
32767
o
.
shortReadOnly
)
;
Assert
.
equal
(
2147483647
o
.
longReadOnly
)
;
Assert
.
ok
(
5
.
25
<
o
.
floatReadOnly
&
&
5
.
75
>
o
.
floatReadOnly
)
;
Assert
.
equal
(
"
X
"
o
.
charReadOnly
)
;
Assert
.
equal
(
-
1
o
.
timeReadOnly
)
;
}
