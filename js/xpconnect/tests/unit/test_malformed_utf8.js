const
gPrefs
=
Cc
[
"
mozilla
.
org
/
preferences
-
service
;
1
"
]
.
getService
(
Ci
.
nsIPrefBranch
)
;
const
tests
=
[
[
"
\
xC2
"
"
\
uFFFD
"
"
\
xC3
\
x82
"
]
[
"
\
xDF
"
"
\
uFFFD
"
"
\
xC3
\
x9F
"
]
[
"
\
xE0
\
xA0
"
"
\
uFFFD
"
"
\
xC3
\
xA0
\
xC2
\
xA0
"
]
[
"
\
xF0
\
x90
\
x80
"
"
\
uFFFD
"
"
\
xC3
\
xB0
\
xC2
\
x90
\
xC2
\
x80
"
]
[
"
\
xC2
"
"
\
uFFFD
"
"
\
xC3
\
x82
"
]
[
"
\
xDF
"
"
\
uFFFD
"
"
\
xC3
\
x9F
"
]
[
"
\
xE0
\
xA0
"
"
\
uFFFD
"
"
\
xC3
\
xA0
\
xC2
\
xA0
"
]
[
"
\
xF0
\
x90
\
x80
"
"
\
uFFFD
"
"
\
xC3
\
xB0
\
xC2
\
x90
\
xC2
\
x80
"
]
[
"
\
x80
"
"
\
uFFFD
"
"
\
xC2
\
x80
"
]
[
"
\
xBF
"
"
\
uFFFD
"
"
\
xC2
\
xBF
"
]
[
"
\
xA0
\
x80
"
"
\
uFFFD
\
uFFFD
"
"
\
xC2
\
xA0
\
xC2
\
x80
"
]
[
"
\
x8F
\
x80
\
x80
"
"
\
uFFFD
\
uFFFD
\
uFFFD
"
"
\
xC2
\
x8F
\
xC2
\
x80
\
xC2
\
x80
"
]
]
;
add_task
(
function
testLatin1ToLatin1
(
)
{
for
(
const
[
input
]
of
tests
)
{
gPrefs
.
setCharPref
(
"
test
.
malformed_utf8_data
"
input
)
;
const
result
=
gPrefs
.
getCharPref
(
"
test
.
malformed_utf8_data
"
)
;
Assert
.
equal
(
result
input
)
;
}
}
)
;
add_task
(
function
testLatin1ToUTF8
(
)
{
for
(
const
[
input
expected
]
of
tests
)
{
gPrefs
.
setCharPref
(
"
test
.
malformed_utf8_data
"
input
)
;
const
result
=
gPrefs
.
getStringPref
(
"
test
.
malformed_utf8_data
"
)
;
Assert
.
equal
(
result
expected
)
;
}
}
)
;
add_task
(
function
testUTF8ToLatin1
(
)
{
for
(
const
[
input
expected
]
of
tests
)
{
gPrefs
.
setStringPref
(
"
test
.
malformed_utf8_data
"
input
)
;
const
result
=
gPrefs
.
getCharPref
(
"
test
.
malformed_utf8_data
"
)
;
Assert
.
equal
(
result
expected
)
;
}
}
)
;
add_task
(
function
testUTF8ToUTF8
(
)
{
for
(
const
[
input
]
of
tests
)
{
gPrefs
.
setStringPref
(
"
test
.
malformed_utf8_data
"
input
)
;
const
result
=
gPrefs
.
getStringPref
(
"
test
.
malformed_utf8_data
"
)
;
Assert
.
equal
(
result
input
)
;
}
}
)
;
