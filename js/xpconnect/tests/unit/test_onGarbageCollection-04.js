ChromeUtils
.
import
(
"
resource
:
/
/
gre
/
modules
/
Services
.
jsm
"
)
;
Services
.
prefs
.
setBoolPref
(
"
security
.
allow_eval_with_system_principal
"
true
)
;
registerCleanupFunction
(
(
)
=
>
{
Services
.
prefs
.
clearUserPref
(
"
security
.
allow_eval_with_system_principal
"
)
;
}
)
;
function
run_test
(
)
{
do_test_pending
(
)
;
const
debuggeree
=
newGlobal
(
)
;
const
debuggee
=
debuggeree
.
debuggee
=
newGlobal
(
)
;
debuggeree
.
eval
(
var
dbg
=
new
Debugger
(
this
.
debuggee
)
;
var
fired
=
0
;
dbg
.
memory
.
onGarbageCollection
=
_
=
>
{
fired
+
+
;
gc
(
this
)
;
}
;
)
;
const
dbg
=
new
Debugger
(
debuggeree
)
;
let
fired
=
0
;
dbg
.
memory
.
onGarbageCollection
=
_
=
>
{
fired
+
+
;
}
;
debuggee
.
eval
(
gc
(
this
)
)
;
executeSoon
(
(
)
=
>
{
executeSoon
(
(
)
=
>
{
ok
(
debuggeree
.
fired
>
=
1
)
;
ok
(
fired
>
=
1
)
;
debuggeree
.
dbg
.
enabled
=
dbg
.
enabled
=
false
;
do_test_finished
(
)
;
}
)
;
}
)
;
}
