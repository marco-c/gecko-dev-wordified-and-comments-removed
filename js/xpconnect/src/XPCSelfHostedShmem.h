#
ifndef
xpcselfhostedshmem_h___
#
define
xpcselfhostedshmem_h___
#
include
"
mozilla
/
UniquePtr
.
h
"
#
include
"
mozilla
/
UniquePtrExtensions
.
h
"
#
include
"
mozilla
/
RefPtr
.
h
"
#
include
"
mozilla
/
Span
.
h
"
#
include
"
mozilla
/
StaticPtr
.
h
"
#
include
"
mozilla
/
ipc
/
SharedMemoryHandle
.
h
"
#
include
"
mozilla
/
ipc
/
SharedMemoryMapping
.
h
"
#
include
"
nsIMemoryReporter
.
h
"
#
include
"
nsIObserver
.
h
"
#
include
"
nsIThread
.
h
"
namespace
xpc
{
class
SelfHostedShmem
final
:
public
nsIMemoryReporter
{
public
:
NS_DECL_THREADSAFE_ISUPPORTS
NS_DECL_NSIMEMORYREPORTER
using
ContentType
=
mozilla
:
:
Span
<
const
uint8_t
>
;
static
SelfHostedShmem
&
GetSingleton
(
)
;
static
void
SetSelfHostedUseSharedMemory
(
bool
aSelfHostedUseSharedMemory
)
{
sSelfHostedUseSharedMemory
=
aSelfHostedUseSharedMemory
;
}
static
bool
SelfHostedUseSharedMemory
(
)
{
return
sSelfHostedUseSharedMemory
;
}
void
InitFromParent
(
ContentType
aXdr
)
;
[
[
nodiscard
]
]
bool
InitFromChild
(
mozilla
:
:
ipc
:
:
ReadOnlySharedMemoryHandle
aHandle
)
;
ContentType
Content
(
)
const
;
const
mozilla
:
:
ipc
:
:
ReadOnlySharedMemoryHandle
&
Handle
(
)
const
;
void
InitMemoryReporter
(
)
;
static
void
Shutdown
(
)
;
private
:
SelfHostedShmem
(
)
=
default
;
~
SelfHostedShmem
(
)
=
default
;
static
bool
sSelfHostedUseSharedMemory
;
static
mozilla
:
:
StaticRefPtr
<
SelfHostedShmem
>
sSelfHostedXdr
;
mozilla
:
:
ipc
:
:
ReadOnlySharedMemoryHandle
mHandle
;
mozilla
:
:
ipc
:
:
ReadOnlySharedMemoryMapping
mMem
;
}
;
}
#
endif
