#
ifndef
xpcselfhostedshmem_h___
#
define
xpcselfhostedshmem_h___
#
include
"
mozilla
/
UniquePtr
.
h
"
#
include
"
mozilla
/
UniquePtrExtensions
.
h
"
#
include
"
mozilla
/
RefPtr
.
h
"
#
include
"
mozilla
/
Span
.
h
"
#
include
"
mozilla
/
StaticPtr
.
h
"
#
include
"
mozilla
/
ipc
/
SharedMemory
.
h
"
#
include
"
nsIMemoryReporter
.
h
"
#
include
"
nsIObserver
.
h
"
#
include
"
nsIThread
.
h
"
namespace
xpc
{
class
SelfHostedShmem
final
:
public
nsIMemoryReporter
{
public
:
NS_DECL_THREADSAFE_ISUPPORTS
NS_DECL_NSIMEMORYREPORTER
using
ContentType
=
mozilla
:
:
Span
<
const
uint8_t
>
;
static
SelfHostedShmem
&
GetSingleton
(
)
;
void
InitFromParent
(
ContentType
aXdr
)
;
[
[
nodiscard
]
]
bool
InitFromChild
(
mozilla
:
:
ipc
:
:
SharedMemoryHandle
aHandle
size_t
aLen
)
;
ContentType
Content
(
)
const
;
const
mozilla
:
:
ipc
:
:
SharedMemoryHandle
&
Handle
(
)
const
;
void
InitMemoryReporter
(
)
;
static
void
Shutdown
(
)
;
private
:
SelfHostedShmem
(
)
=
default
;
~
SelfHostedShmem
(
)
=
default
;
static
mozilla
:
:
StaticRefPtr
<
SelfHostedShmem
>
sSelfHostedXdr
;
mozilla
:
:
ipc
:
:
SharedMemoryHandle
mHandle
;
RefPtr
<
mozilla
:
:
ipc
:
:
SharedMemory
>
mMem
;
size_t
mLen
=
0
;
}
;
}
#
endif
