#
include
"
xpcprivate
.
h
"
#
include
"
XPCWrapper
.
h
"
#
include
"
nsDOMJSUtils
.
h
"
#
include
"
nsNullPrincipal
.
h
"
#
include
"
mozilla
/
dom
/
BindingUtils
.
h
"
using
namespace
mozilla
;
using
namespace
JS
;
using
namespace
xpc
;
XPCJSContextStack
:
:
~
XPCJSContextStack
(
)
{
if
(
mSafeJSContext
)
{
mSafeJSContext
=
nullptr
;
}
}
JSContext
*
XPCJSContextStack
:
:
GetSafeJSContext
(
)
{
MOZ_ASSERT
(
mSafeJSContext
)
;
return
mSafeJSContext
;
}
void
XPCJSContextStack
:
:
InitSafeJSContext
(
)
{
MOZ_ASSERT
(
!
mSafeJSContext
)
;
mSafeJSContext
=
JS_GetContext
(
mRuntime
-
>
Runtime
(
)
)
;
if
(
!
JS
:
:
InitSelfHostedCode
(
mSafeJSContext
)
)
MOZ_CRASH
(
"
InitSelfHostedCode
failed
"
)
;
if
(
!
mRuntime
-
>
JSContextInitialized
(
mSafeJSContext
)
)
MOZ_CRASH
(
"
JSContextCreated
failed
"
)
;
}
