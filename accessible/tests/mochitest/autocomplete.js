const
nsISupports
=
Components
.
interfaces
.
nsISupports
;
const
nsIAutoCompleteResult
=
Components
.
interfaces
.
nsIAutoCompleteResult
;
const
nsIAutoCompleteSearch
=
Components
.
interfaces
.
nsIAutoCompleteSearch
;
const
nsIFactory
=
Components
.
interfaces
.
nsIFactory
;
const
nsIUUIDGenerator
=
Components
.
interfaces
.
nsIUUIDGenerator
;
const
nsIComponentRegistrar
=
Components
.
interfaces
.
nsIComponentRegistrar
;
var
gDefaultAutoCompleteSearch
=
null
;
function
initAutoComplete
(
aValues
aComments
)
{
var
allResults
=
new
ResultsHeap
(
aValues
aComments
)
;
gDefaultAutoCompleteSearch
=
new
AutoCompleteSearch
(
"
test
-
a11y
-
search
"
allResults
)
;
registerAutoCompleteSearch
(
gDefaultAutoCompleteSearch
"
Accessibility
Test
AutoCompleteSearch
"
)
;
}
function
shutdownAutoComplete
(
)
{
unregisterAutoCompleteSearch
(
gDefaultAutoCompleteSearch
)
;
gDefaultAutoCompleteSearch
.
cid
=
null
;
gDefaultAutoCompleteSearch
=
null
;
}
function
registerAutoCompleteSearch
(
aSearch
aDescription
)
{
var
name
=
"
mozilla
.
org
/
autocomplete
/
search
;
1
?
name
=
"
+
aSearch
.
name
;
var
uuidGenerator
=
Components
.
classes
[
"
mozilla
.
org
/
uuid
-
generator
;
1
"
]
.
getService
(
nsIUUIDGenerator
)
;
var
cid
=
uuidGenerator
.
generateUUID
(
)
;
var
componentManager
=
Components
.
manager
.
QueryInterface
(
nsIComponentRegistrar
)
;
componentManager
.
registerFactory
(
cid
aDescription
name
aSearch
)
;
aSearch
.
cid
=
cid
;
}
function
unregisterAutoCompleteSearch
(
aSearch
)
{
var
componentManager
=
Components
.
manager
.
QueryInterface
(
nsIComponentRegistrar
)
;
componentManager
.
unregisterFactory
(
aSearch
.
cid
aSearch
)
;
}
function
ResultsHeap
(
aValues
aComments
)
{
this
.
values
=
aValues
;
this
.
comments
=
aComments
;
}
ResultsHeap
.
prototype
=
{
constructor
:
ResultsHeap
getAutoCompleteResultFor
(
aSearchString
)
{
var
values
=
[
]
comments
=
[
]
;
for
(
var
idx
=
0
;
idx
<
this
.
values
.
length
;
idx
+
+
)
{
if
(
this
.
values
[
idx
]
.
includes
(
aSearchString
)
)
{
values
.
push
(
this
.
values
[
idx
]
)
;
comments
.
push
(
this
.
comments
[
idx
]
)
;
}
}
return
new
AutoCompleteResult
(
values
comments
)
;
}
}
;
function
AutoCompleteSearch
(
aName
aAllResults
)
{
this
.
name
=
aName
;
this
.
allResults
=
aAllResults
;
}
AutoCompleteSearch
.
prototype
=
{
constructor
:
AutoCompleteSearch
startSearch
(
aSearchString
aSearchParam
aPreviousResult
aListener
)
{
var
result
=
this
.
allResults
.
getAutoCompleteResultFor
(
aSearchString
)
;
aListener
.
onSearchResult
(
this
result
)
;
}
stopSearch
(
)
{
}
QueryInterface
(
iid
)
{
if
(
iid
.
equals
(
nsISupports
)
|
|
iid
.
equals
(
nsIFactory
)
|
|
iid
.
equals
(
nsIAutoCompleteSearch
)
)
return
this
;
throw
Components
.
results
.
NS_ERROR_NO_INTERFACE
;
}
createInstance
(
outer
iid
)
{
return
this
.
QueryInterface
(
iid
)
;
}
name
:
null
allResults
:
null
}
;
function
AutoCompleteResult
(
aValues
aComments
)
{
this
.
values
=
aValues
;
this
.
comments
=
aComments
;
if
(
this
.
values
.
length
>
0
)
this
.
searchResult
=
nsIAutoCompleteResult
.
RESULT_SUCCESS
;
else
this
.
searchResult
=
nsIAutoCompleteResult
.
NOMATCH
;
}
AutoCompleteResult
.
prototype
=
{
constructor
:
AutoCompleteResult
searchString
:
"
"
searchResult
:
null
defaultIndex
:
0
get
matchCount
(
)
{
return
this
.
values
.
length
;
}
getValueAt
(
aIndex
)
{
return
this
.
values
[
aIndex
]
;
}
getLabelAt
(
aIndex
)
{
return
this
.
getValueAt
(
aIndex
)
;
}
getCommentAt
(
aIndex
)
{
return
this
.
comments
[
aIndex
]
;
}
getStyleAt
(
aIndex
)
{
return
null
;
}
getImageAt
(
aIndex
)
{
return
"
"
;
}
getFinalCompleteValueAt
(
aIndex
)
{
return
this
.
getValueAt
(
aIndex
)
;
}
removeValueAt
(
aRowIndex
aRemoveFromDb
)
{
}
QueryInterface
(
iid
)
{
if
(
iid
.
equals
(
nsISupports
)
|
|
iid
.
equals
(
nsIAutoCompleteResult
)
)
return
this
;
throw
Components
.
results
.
NS_ERROR_NO_INTERFACE
;
}
values
:
null
comments
:
null
}
;
