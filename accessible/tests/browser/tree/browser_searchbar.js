"
use
strict
"
;
loadScripts
(
{
name
:
"
role
.
js
"
dir
:
MOCHITESTS_DIR
}
)
;
add_task
(
async
function
test_searchbar_a11y_tree
(
)
{
await
SpecialPowers
.
pushPrefEnv
(
{
set
:
[
[
"
browser
.
search
.
widget
.
inNavBar
"
true
]
]
}
)
;
await
new
Promise
(
resolve
=
>
setTimeout
(
resolve
100
)
)
;
let
searchbar
=
await
TestUtils
.
waitForCondition
(
(
)
=
>
document
.
getElementById
(
"
searchbar
"
)
"
wait
for
search
bar
to
appear
"
)
;
let
popup
=
document
.
getElementById
(
"
PopupSearchAutoComplete
"
)
;
let
promise
=
Promise
.
all
(
[
BrowserTestUtils
.
waitForEvent
(
popup
"
popupshown
"
false
)
waitForEvent
(
EVENT_SHOW
popup
)
]
)
;
searchbar
.
textbox
.
openPopup
(
)
;
await
promise
;
let
TREE
=
{
role
:
ROLE_EDITCOMBOBOX
children
:
[
{
role
:
ROLE_ENTRY
children
:
[
]
}
{
role
:
ROLE_COMBOBOX_LIST
children
:
[
]
}
{
role
:
ROLE_GROUPING
}
]
}
;
testAccessibleTree
(
searchbar
TREE
)
;
promise
=
Promise
.
all
(
[
BrowserTestUtils
.
waitForEvent
(
popup
"
popuphidden
"
false
)
waitForEvent
(
EVENT_HIDE
popup
)
]
)
;
searchbar
.
textbox
.
closePopup
(
)
;
await
promise
;
TREE
=
{
role
:
ROLE_EDITCOMBOBOX
children
:
[
{
role
:
ROLE_ENTRY
children
:
[
]
}
{
role
:
ROLE_COMBOBOX_LIST
children
:
[
]
}
]
}
;
testAccessibleTree
(
searchbar
TREE
)
;
}
)
;
