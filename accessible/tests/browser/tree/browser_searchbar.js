"
use
strict
"
;
loadScripts
(
{
name
:
"
role
.
js
"
dir
:
MOCHITESTS_DIR
}
)
;
const
{
CustomizableUITestUtils
}
=
ChromeUtils
.
importESModule
(
"
resource
:
/
/
testing
-
common
/
CustomizableUITestUtils
.
sys
.
mjs
"
)
;
let
gCUITestUtils
=
new
CustomizableUITestUtils
(
window
)
;
add_setup
(
async
function
(
)
{
await
SpecialPowers
.
pushPrefEnv
(
{
set
:
[
[
"
browser
.
search
.
widget
.
new
"
false
]
]
}
)
;
}
)
;
add_task
(
async
function
test_searchbar_a11y_tree
(
)
{
let
searchbar
=
await
gCUITestUtils
.
addSearchBar
(
)
;
let
popup
=
document
.
getElementById
(
"
PopupSearchAutoComplete
"
)
;
let
promise
=
Promise
.
all
(
[
BrowserTestUtils
.
waitForEvent
(
popup
"
popupshown
"
false
)
waitForEvent
(
EVENT_SHOW
popup
)
]
)
;
searchbar
.
textbox
.
openPopup
(
)
;
await
promise
;
let
TREE
=
{
role
:
ROLE_EDITCOMBOBOX
children
:
[
{
role
:
ROLE_BUTTONMENU
children
:
[
]
}
{
role
:
ROLE_SEARCHBOX
children
:
[
]
}
{
role
:
ROLE_COMBOBOX_LIST
children
:
[
]
}
{
role
:
ROLE_GROUPING
}
]
}
;
testAccessibleTree
(
searchbar
TREE
)
;
promise
=
Promise
.
all
(
[
BrowserTestUtils
.
waitForEvent
(
popup
"
popuphidden
"
false
)
waitForEvent
(
EVENT_HIDE
popup
)
]
)
;
searchbar
.
textbox
.
closePopup
(
)
;
await
promise
;
TREE
=
{
role
:
ROLE_EDITCOMBOBOX
children
:
[
{
role
:
ROLE_BUTTONMENU
children
:
[
]
}
{
role
:
ROLE_SEARCHBOX
children
:
[
]
}
{
role
:
ROLE_COMBOBOX_LIST
children
:
[
]
}
]
}
;
testAccessibleTree
(
searchbar
TREE
)
;
}
)
;
