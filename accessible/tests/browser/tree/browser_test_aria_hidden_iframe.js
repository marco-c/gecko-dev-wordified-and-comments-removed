"
use
strict
"
;
loadScripts
(
{
name
:
"
role
.
js
"
dir
:
MOCHITESTS_DIR
}
)
;
addAccessibleTask
(
hello
world
async
function
testIframeRootDocument
(
browser
)
{
info
(
"
Loading
iframe
document
"
)
;
const
HIDDEN_IFRAME_URI
=
"
data
:
text
/
html
<
html
id
=
'
new_html
'
aria
-
hidden
=
'
true
'
>
<
body
id
=
'
iframeBody
'
>
<
u
>
hello
world
<
/
u
>
<
/
body
>
<
/
html
>
"
;
const
loaded
=
waitForEvent
(
EVENT_DOCUMENT_LOAD_COMPLETE
"
iframeBody
"
)
;
await
SpecialPowers
.
spawn
(
browser
[
DEFAULT_IFRAME_ID
HIDDEN_IFRAME_URI
]
(
_id
_uri
)
=
>
{
content
.
document
.
getElementById
(
_id
)
.
src
=
_uri
;
}
)
;
await
loaded
;
const
tree
=
{
INTERNAL_FRAME
:
[
{
DOCUMENT
:
[
]
}
]
}
;
const
root
=
getRootAccessible
(
document
)
;
const
iframeDoc
=
findAccessibleChildByID
(
root
DEFAULT_IFRAME_ID
)
;
testAccessibleTree
(
iframeDoc
tree
)
;
}
{
chrome
:
false
topLevel
:
false
iframe
:
true
remoteIframe
:
true
}
)
;
addAccessibleTask
(
<
p
id
=
"
content
"
>
I
am
some
content
in
a
document
<
/
p
>
async
function
testIframeDocument
(
browser
docAcc
topLevel
)
{
const
originalTree
=
{
DOCUMENT
:
[
{
INTERNAL_FRAME
:
[
{
DOCUMENT
:
[
]
}
]
}
]
}
;
testAccessibleTree
(
topLevel
originalTree
)
;
}
{
chrome
:
false
topLevel
:
false
iframe
:
true
remoteIframe
:
true
iframeDocBodyAttrs
:
{
"
aria
-
hidden
"
:
"
true
"
}
}
)
;
addAccessibleTask
(
<
p
id
=
"
content
"
>
I
am
some
content
in
a
document
<
/
p
>
async
function
testIframeDocumentMutation
(
browser
docAcc
topLevel
)
{
const
originalTree
=
{
DOCUMENT
:
[
{
INTERNAL_FRAME
:
[
{
DOCUMENT
:
[
{
PARAGRAPH
:
[
{
TEXT_LEAF
:
[
]
}
]
}
]
}
]
}
]
}
;
testAccessibleTree
(
topLevel
originalTree
)
;
info
(
"
Adding
aria
-
hidden
=
true
to
content
doc
"
)
;
await
contentSpawnMutation
(
browser
{
expected
:
[
[
EVENT_REORDER
docAcc
]
]
}
function
(
)
{
const
b
=
content
.
document
.
body
;
b
.
setAttribute
(
"
aria
-
hidden
"
"
true
"
)
;
}
)
;
const
newTree
=
{
DOCUMENT
:
[
{
INTERNAL_FRAME
:
[
{
DOCUMENT
:
[
]
}
]
}
]
}
;
testAccessibleTree
(
topLevel
newTree
)
;
}
{
chrome
:
false
topLevel
:
false
iframe
:
true
remoteIframe
:
true
}
)
;
