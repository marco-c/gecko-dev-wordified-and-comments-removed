"
use
strict
"
;
const
{
UrlbarTestUtils
}
=
ChromeUtils
.
import
(
"
resource
:
/
/
testing
-
common
/
UrlbarTestUtils
.
jsm
"
)
;
add_task
(
async
function
testAutocompleteRichResult
(
)
{
let
tab
=
await
openNewTab
(
"
data
:
text
/
html
;
charset
=
utf
-
8
"
)
;
let
accService
=
await
initAccessibilityService
(
)
;
info
(
"
Opening
the
URL
bar
and
entering
a
key
to
show
the
urlbar
panel
"
)
;
await
UrlbarTestUtils
.
promiseAutocompleteResultPopup
(
{
window
waitForFocus
value
:
"
a
"
}
)
;
info
(
"
Waiting
for
accessibility
to
be
created
for
the
richlistbox
"
)
;
let
resultsView
;
resultsView
=
gURLBar
.
view
.
panel
.
querySelector
(
"
#
urlbarView
-
results
"
)
;
await
BrowserTestUtils
.
waitForCondition
(
(
)
=
>
accService
.
getAccessibleFor
(
resultsView
)
)
;
info
(
"
Confirming
that
the
special
case
is
handled
in
XULListboxAccessible
"
)
;
let
accessible
=
accService
.
getAccessibleFor
(
resultsView
)
;
is
(
accessible
.
role
ROLE_COMBOBOX_LIST
"
Right
role
"
)
;
BrowserTestUtils
.
removeTab
(
tab
)
;
}
)
;
registerCleanupFunction
(
async
function
(
)
{
await
shutdownAccessibilityService
(
)
;
}
)
;
