"
use
strict
"
;
loadScripts
(
{
name
:
"
role
.
js
"
dir
:
MOCHITESTS_DIR
}
)
;
addAccessibleTask
(
async
(
browser
accDoc
)
=
>
{
let
evt
=
waitForMacEvent
(
"
AXLoadComplete
"
(
iface
data
)
=
>
{
return
iface
.
getAttributeValue
(
"
AXDescription
"
)
=
=
"
webarea
test
"
;
}
)
;
await
SpecialPowers
.
spawn
(
browser
[
]
(
)
=
>
{
content
.
location
=
"
data
:
text
/
html
<
title
>
webarea
test
<
/
title
>
"
;
}
)
;
let
doc
=
await
evt
;
is
(
doc
.
getAttributeValue
(
"
AXRole
"
)
"
AXWebArea
"
"
document
has
AXWebArea
role
"
)
;
is
(
doc
.
getAttributeValue
(
"
AXValue
"
)
"
"
"
document
has
no
AXValue
"
)
;
is
(
doc
.
getAttributeValue
(
"
AXTitle
"
)
null
"
document
has
no
AXTitle
"
)
;
is
(
doc
.
getAttributeValue
(
"
AXLoaded
"
)
1
"
document
has
finished
loading
"
)
;
}
)
;
addAccessibleTask
(
<
title
>
webarea
test
<
/
title
>
async
(
browser
accDoc
)
=
>
{
let
eventPromise
=
Promise
.
race
(
[
waitForMacEvent
(
"
AXLayoutComplete
"
(
iface
data
)
=
>
{
return
iface
.
getAttributeValue
(
"
AXDescription
"
)
=
=
"
iframe
document
"
;
}
)
waitForMacEvent
(
"
AXLoadComplete
"
(
iface
data
)
=
>
{
return
iface
.
getAttributeValue
(
"
AXDescription
"
)
=
=
"
webarea
test
"
;
}
)
]
)
;
await
SpecialPowers
.
spawn
(
browser
[
]
(
)
=
>
{
const
iframe
=
content
.
document
.
createElement
(
"
iframe
"
)
;
iframe
.
src
=
"
data
:
text
/
html
<
title
>
iframe
document
<
/
title
>
hello
world
"
;
content
.
document
.
body
.
appendChild
(
iframe
)
;
}
)
;
let
doc
=
await
eventPromise
;
if
(
doc
.
getAttributeValue
(
"
AXTitle
"
)
)
{
doc
=
doc
.
getAttributeValue
(
"
AXChildren
"
)
[
0
]
;
}
is
(
doc
.
getAttributeValue
(
"
AXRole
"
)
"
AXWebArea
"
"
iframe
document
has
AXWebArea
role
"
)
;
is
(
doc
.
getAttributeValue
(
"
AXValue
"
)
"
"
"
iframe
document
has
no
AXValue
"
)
;
is
(
doc
.
getAttributeValue
(
"
AXTitle
"
)
null
"
iframe
document
has
no
AXTitle
"
)
;
is
(
doc
.
getAttributeValue
(
"
AXDescription
"
)
"
iframe
document
"
"
test
has
correct
label
"
)
;
is
(
doc
.
getAttributeValue
(
"
AXLoaded
"
)
1
"
iframe
document
has
finished
loading
"
)
;
}
)
;
