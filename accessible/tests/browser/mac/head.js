"
use
strict
"
;
Services
.
scriptloader
.
loadSubScript
(
"
chrome
:
/
/
mochitests
/
content
/
browser
/
accessible
/
tests
/
browser
/
shared
-
head
.
js
"
this
)
;
loadScripts
(
{
name
:
"
common
.
js
"
dir
:
MOCHITESTS_DIR
}
{
name
:
"
promisified
-
events
.
js
"
dir
:
MOCHITESTS_DIR
}
)
;
function
getNativeInterface
(
accDoc
id
)
{
return
findAccessibleChildByID
(
accDoc
id
)
.
nativeInterface
.
QueryInterface
(
Ci
.
nsIAccessibleMacInterface
)
;
}
function
waitForMacEvent
(
notificationType
filter
)
{
return
new
Promise
(
resolve
=
>
{
let
eventObserver
=
{
observe
(
subject
topic
data
)
{
let
macIface
=
subject
.
QueryInterface
(
Ci
.
nsIAccessibleMacInterface
)
;
if
(
data
=
=
=
notificationType
&
&
(
!
filter
|
|
filter
(
macIface
)
)
)
{
Services
.
obs
.
removeObserver
(
this
"
accessible
-
mac
-
event
"
)
;
resolve
(
macIface
)
;
}
}
}
;
Services
.
obs
.
addObserver
(
eventObserver
"
accessible
-
mac
-
event
"
)
;
}
)
;
}
function
NSRange
(
location
length
)
{
return
{
valueType
:
"
NSRange
"
value
:
[
location
length
]
}
;
}
