"
use
strict
"
;
loadScripts
(
{
name
:
"
role
.
js
"
dir
:
MOCHITESTS_DIR
}
{
name
:
"
states
.
js
"
dir
:
MOCHITESTS_DIR
}
)
;
addAccessibleTask
(
<
a
id
=
"
one
"
href
=
"
%
23
"
aria
-
current
=
"
page
"
>
One
<
/
a
>
<
a
id
=
"
two
"
href
=
"
%
23
"
>
Two
<
/
a
>
async
(
browser
accDoc
)
=
>
{
let
one
=
getNativeInterface
(
accDoc
"
one
"
)
;
let
two
=
getNativeInterface
(
accDoc
"
two
"
)
;
is
(
one
.
getAttributeValue
(
"
AXARIACurrent
"
)
"
page
"
"
Correct
aria
-
current
for
#
one
"
)
;
is
(
two
.
getAttributeValue
(
"
AXARIACurrent
"
)
null
"
Correct
aria
-
current
for
#
two
"
)
;
let
stateChanged
=
waitForEvent
(
EVENT_STATE_CHANGE
"
one
"
)
;
await
SpecialPowers
.
spawn
(
browser
[
]
(
)
=
>
{
content
.
document
.
getElementById
(
"
one
"
)
.
setAttribute
(
"
aria
-
current
"
"
step
"
)
;
}
)
;
await
stateChanged
;
is
(
one
.
getAttributeValue
(
"
AXARIACurrent
"
)
"
step
"
"
Correct
aria
-
current
for
#
one
"
)
;
stateChanged
=
waitForEvent
(
EVENT_STATE_CHANGE
"
one
"
)
;
await
SpecialPowers
.
spawn
(
browser
[
]
(
)
=
>
{
content
.
document
.
getElementById
(
"
one
"
)
.
removeAttribute
(
"
aria
-
current
"
)
;
}
)
;
await
stateChanged
;
is
(
one
.
getAttributeValue
(
"
AXARIACurrent
"
)
null
"
Correct
aria
-
current
for
#
one
"
)
;
}
)
;
