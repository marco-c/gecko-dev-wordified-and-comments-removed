"
use
strict
"
;
const
TRANSLATION_OFFSET
=
50
;
const
ELEM_ID
=
"
test
-
elem
-
id
"
;
async
function
invokeSetStyleIframe
(
browser
id
style
value
)
{
if
(
value
)
{
Logger
.
log
(
Setting
{
style
}
style
to
{
value
}
for
iframe
with
id
:
{
id
}
)
;
}
else
{
Logger
.
log
(
Removing
{
style
}
style
from
iframe
with
id
:
{
id
}
)
;
}
await
SpecialPowers
.
spawn
(
browser
[
id
style
value
]
(
iframeId
iframeStyle
iframeValue
)
=
>
{
const
elm
=
content
.
document
.
getElementById
(
iframeId
)
;
if
(
iframeValue
)
{
elm
.
style
[
iframeStyle
]
=
iframeValue
;
}
else
{
delete
elm
.
style
[
iframeStyle
]
;
}
}
)
;
}
function
testBoundsWithOffset
(
browser
iframeDocAcc
id
domElmBounds
offset
)
{
const
acc
=
findAccessibleChildByID
(
iframeDocAcc
id
)
;
const
accX
=
{
}
;
const
accY
=
{
}
;
const
accWidth
=
{
}
;
const
accHeight
=
{
}
;
acc
.
getBounds
(
accX
accY
accWidth
accHeight
)
;
const
addTranslationOffset
=
!
gIsRemoteIframe
&
&
isCacheEnabled
;
const
expectedX
=
addTranslationOffset
?
domElmBounds
[
0
]
+
offset
:
domElmBounds
[
0
]
;
const
expectedY
=
addTranslationOffset
?
domElmBounds
[
1
]
+
offset
:
domElmBounds
[
1
]
;
const
expectedWidth
=
domElmBounds
[
2
]
;
const
expectedHeight
=
domElmBounds
[
3
]
;
let
boundsAreEquivalent
=
true
;
boundsAreEquivalent
&
&
=
accX
.
value
=
=
expectedX
;
boundsAreEquivalent
&
&
=
accY
.
value
=
=
expectedY
;
boundsAreEquivalent
&
&
=
accWidth
.
value
=
=
expectedWidth
;
boundsAreEquivalent
&
&
=
accHeight
.
value
=
=
expectedHeight
;
return
boundsAreEquivalent
;
}
addAccessibleTask
(
<
div
id
=
'
{
ELEM_ID
}
'
>
hello
world
<
/
div
>
async
function
(
browser
iframeDocAcc
contentDocAcc
)
{
ok
(
iframeDocAcc
"
IFRAME
document
accessible
is
present
"
)
;
await
testBoundsInContent
(
iframeDocAcc
ELEM_ID
browser
)
;
await
invokeSetStyleIframe
(
browser
DEFAULT_IFRAME_ID
"
transform
"
translate
(
{
TRANSLATION_OFFSET
}
px
{
TRANSLATION_OFFSET
}
px
)
)
;
await
waitForContentPaint
(
browser
)
;
const
domElmBoundsAfterTranslate
=
await
getContentBoundsForDOMElm
(
browser
ELEM_ID
)
;
await
untilCacheOk
(
(
)
=
>
{
return
testBoundsWithOffset
(
browser
iframeDocAcc
ELEM_ID
domElmBoundsAfterTranslate
TRANSLATION_OFFSET
)
;
}
"
Accessible
bounds
have
changed
in
the
cache
and
match
DOM
bounds
.
"
)
;
}
{
topLevel
:
false
iframe
:
true
remoteIframe
:
true
iframeAttrs
:
{
style
:
height
:
100px
;
width
:
100px
;
}
}
)
;
