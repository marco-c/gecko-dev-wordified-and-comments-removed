#
import
"
MacUtils
.
h
"
#
include
"
LocalAccessible
.
h
"
#
include
"
nsCocoaUtils
.
h
"
#
include
"
mozilla
/
a11y
/
PDocAccessible
.
h
"
#
include
"
nsIPersistentProperties2
.
h
"
namespace
mozilla
{
namespace
a11y
{
namespace
utils
{
NSArray
<
mozAccessible
*
>
*
ConvertToNSArray
(
nsTArray
<
LocalAccessible
*
>
&
aArray
)
{
NSMutableArray
*
nativeArray
=
[
[
NSMutableArray
alloc
]
init
]
;
size_t
totalCount
=
aArray
.
Length
(
)
;
for
(
size_t
i
=
0
;
i
<
totalCount
;
i
+
+
)
{
LocalAccessible
*
curAccessible
=
aArray
.
ElementAt
(
i
)
;
mozAccessible
*
curNative
=
GetNativeFromGeckoAccessible
(
curAccessible
)
;
if
(
curNative
)
[
nativeArray
addObject
:
GetObjectOrRepresentedView
(
curNative
)
]
;
}
return
nativeArray
;
}
NSArray
<
mozAccessible
*
>
*
ConvertToNSArray
(
nsTArray
<
ProxyAccessible
*
>
&
aArray
)
{
NSMutableArray
*
nativeArray
=
[
[
NSMutableArray
alloc
]
init
]
;
size_t
totalCount
=
aArray
.
Length
(
)
;
for
(
size_t
i
=
0
;
i
<
totalCount
;
i
+
+
)
{
ProxyAccessible
*
curAccessible
=
aArray
.
ElementAt
(
i
)
;
mozAccessible
*
curNative
=
GetNativeFromGeckoAccessible
(
curAccessible
)
;
if
(
curNative
)
[
nativeArray
addObject
:
GetObjectOrRepresentedView
(
curNative
)
]
;
}
return
nativeArray
;
}
NSString
*
LocalizedString
(
const
nsString
&
aString
)
{
nsString
text
;
LocalAccessible
:
:
TranslateString
(
aString
text
)
;
return
text
.
IsEmpty
(
)
?
nil
:
nsCocoaUtils
:
:
ToNSString
(
text
)
;
}
NSString
*
GetAccAttr
(
mozAccessible
*
aNativeAccessible
const
char
*
aAttrName
)
{
nsAutoString
result
;
if
(
LocalAccessible
*
acc
=
[
aNativeAccessible
geckoAccessible
]
.
AsAccessible
(
)
)
{
nsCOMPtr
<
nsIPersistentProperties
>
attributes
=
acc
-
>
Attributes
(
)
;
attributes
-
>
GetStringProperty
(
nsCString
(
aAttrName
)
result
)
;
}
else
if
(
ProxyAccessible
*
proxy
=
[
aNativeAccessible
geckoAccessible
]
.
AsProxy
(
)
)
{
AutoTArray
<
Attribute
10
>
attrs
;
proxy
-
>
Attributes
(
&
attrs
)
;
for
(
size_t
i
=
0
;
i
<
attrs
.
Length
(
)
;
i
+
+
)
{
if
(
attrs
.
ElementAt
(
i
)
.
Name
(
)
=
=
aAttrName
)
{
result
=
attrs
.
ElementAt
(
i
)
.
Value
(
)
;
break
;
}
}
}
if
(
!
result
.
IsEmpty
(
)
)
{
return
nsCocoaUtils
:
:
ToNSString
(
result
)
;
}
return
nil
;
}
}
}
}
