#
include
"
UiaRoot
.
h
"
#
include
"
MsaaRootAccessible
.
h
"
#
include
"
RootAccessible
.
h
"
using
namespace
mozilla
;
using
namespace
mozilla
:
:
a11y
;
Accessible
*
UiaRoot
:
:
Acc
(
)
{
auto
*
mr
=
static_cast
<
MsaaRootAccessible
*
>
(
this
)
;
return
static_cast
<
MsaaAccessible
*
>
(
mr
)
-
>
Acc
(
)
;
}
STDMETHODIMP
UiaRoot
:
:
ElementProviderFromPoint
(
double
aX
double
aY
__RPC__deref_out_opt
IRawElementProviderFragment
*
*
aRetVal
)
{
if
(
!
aRetVal
)
{
return
E_INVALIDARG
;
}
*
aRetVal
=
nullptr
;
Accessible
*
acc
=
Acc
(
)
;
if
(
!
acc
)
{
return
CO_E_OBJNOTCONNECTED
;
}
if
(
Accessible
*
target
=
acc
-
>
ChildAtPoint
(
aX
aY
Accessible
:
:
EWhichChildAtPoint
:
:
DeepestChild
)
)
{
RefPtr
<
IRawElementProviderFragment
>
fragment
=
MsaaAccessible
:
:
GetFrom
(
target
)
;
fragment
.
forget
(
aRetVal
)
;
}
return
S_OK
;
}
STDMETHODIMP
UiaRoot
:
:
GetFocus
(
__RPC__deref_out_opt
IRawElementProviderFragment
*
*
aRetVal
)
{
if
(
!
aRetVal
)
{
return
E_INVALIDARG
;
}
*
aRetVal
=
nullptr
;
Accessible
*
acc
=
Acc
(
)
;
if
(
!
acc
)
{
return
CO_E_OBJNOTCONNECTED
;
}
if
(
Accessible
*
focus
=
acc
-
>
FocusedChild
(
)
)
{
RefPtr
<
IRawElementProviderFragment
>
fragment
=
MsaaAccessible
:
:
GetFrom
(
focus
)
;
fragment
.
forget
(
aRetVal
)
;
}
return
S_OK
;
}
