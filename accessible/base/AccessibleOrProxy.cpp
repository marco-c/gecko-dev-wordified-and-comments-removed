#
include
"
AccessibleOrProxy
.
h
"
#
include
"
mozilla
/
a11y
/
DocAccessibleParent
.
h
"
#
include
"
mozilla
/
a11y
/
OuterDocAccessible
.
h
"
namespace
mozilla
{
namespace
a11y
{
int32_t
AccessibleOrProxy
:
:
IndexInParent
(
)
const
{
if
(
IsAccessible
(
)
)
{
return
AsAccessible
(
)
-
>
IndexInParent
(
)
;
}
RemoteAccessible
*
proxy
=
AsProxy
(
)
;
if
(
!
proxy
)
{
return
-
1
;
}
if
(
proxy
-
>
RemoteParent
(
)
)
{
return
proxy
-
>
IndexInParent
(
)
;
}
if
(
proxy
-
>
OuterDocOfRemoteBrowser
(
)
)
{
return
0
;
}
MOZ_ASSERT_UNREACHABLE
(
"
Proxy
should
have
parent
or
outer
doc
.
"
)
;
return
-
1
;
}
AccessibleOrProxy
AccessibleOrProxy
:
:
Parent
(
)
const
{
if
(
IsAccessible
(
)
)
{
return
AsAccessible
(
)
-
>
LocalParent
(
)
;
}
RemoteAccessible
*
proxy
=
AsProxy
(
)
;
if
(
!
proxy
)
{
return
nullptr
;
}
if
(
RemoteAccessible
*
parent
=
proxy
-
>
RemoteParent
(
)
)
{
return
parent
;
}
return
proxy
-
>
OuterDocOfRemoteBrowser
(
)
;
}
AccessibleOrProxy
AccessibleOrProxy
:
:
ChildAtPoint
(
int32_t
aX
int32_t
aY
Accessible
:
:
EWhichChildAtPoint
aWhichChild
)
{
if
(
IsProxy
(
)
)
{
return
AsProxy
(
)
-
>
ChildAtPoint
(
aX
aY
aWhichChild
)
;
}
RemoteAccessible
*
childDoc
=
RemoteChildDoc
(
)
;
if
(
childDoc
)
{
nsIntRect
docRect
=
AsAccessible
(
)
-
>
Bounds
(
)
;
if
(
!
docRect
.
Contains
(
aX
aY
)
)
{
return
nullptr
;
}
if
(
aWhichChild
=
=
Accessible
:
:
EWhichChildAtPoint
:
:
DirectChild
)
{
return
childDoc
;
}
return
childDoc
-
>
ChildAtPoint
(
aX
aY
aWhichChild
)
;
}
AccessibleOrProxy
target
=
AsAccessible
(
)
-
>
LocalChildAtPoint
(
aX
aY
aWhichChild
)
;
if
(
target
.
IsNull
(
)
|
|
aWhichChild
=
=
Accessible
:
:
EWhichChildAtPoint
:
:
DirectChild
)
{
return
target
;
}
childDoc
=
target
.
RemoteChildDoc
(
)
;
if
(
childDoc
)
{
return
childDoc
-
>
ChildAtPoint
(
aX
aY
aWhichChild
)
;
}
return
target
;
}
RemoteAccessible
*
AccessibleOrProxy
:
:
RemoteChildDoc
(
)
const
{
MOZ_ASSERT
(
!
IsNull
(
)
)
;
if
(
IsProxy
(
)
)
{
return
nullptr
;
}
OuterDocAccessible
*
outerDoc
=
AsAccessible
(
)
-
>
AsOuterDoc
(
)
;
if
(
!
outerDoc
)
{
return
nullptr
;
}
return
outerDoc
-
>
RemoteChildDoc
(
)
;
}
}
}
