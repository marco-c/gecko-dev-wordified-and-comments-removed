#
ifndef
mozilla_a11y_SelectionManager_h__
#
define
mozilla_a11y_SelectionManager_h__
#
include
"
nsISelectionController
.
h
"
#
include
"
nsISelectionListener
.
h
"
#
include
"
mozilla
/
WeakPtr
.
h
"
namespace
mozilla
{
class
PresShell
;
namespace
dom
{
class
AbstractRange
;
class
Element
;
class
Selection
;
}
namespace
a11y
{
class
AccEvent
;
class
HyperTextAccessible
;
struct
SelData
;
class
SelectionManager
:
public
nsISelectionListener
{
public
:
NS_DECL_NSISELECTIONLISTENER
void
Shutdown
(
)
{
ClearControlSelectionListener
(
)
;
}
void
SetControlSelectionListener
(
dom
:
:
Element
*
aFocusedElm
)
;
void
ClearControlSelectionListener
(
)
;
void
AddDocSelectionListener
(
PresShell
*
aPresShell
)
;
void
RemoveDocSelectionListener
(
PresShell
*
aPresShell
)
;
void
ProcessTextSelChangeEvent
(
AccEvent
*
aEvent
)
;
inline
HyperTextAccessible
*
AccessibleWithCaret
(
int32_t
*
aCaret
)
{
if
(
aCaret
)
*
aCaret
=
mCaretOffset
;
return
mAccWithCaret
;
}
inline
void
UpdateCaretOffset
(
HyperTextAccessible
*
aItem
int32_t
aOffset
)
{
mAccWithCaret
=
aItem
;
mCaretOffset
=
aOffset
;
}
inline
void
ResetCaretOffset
(
)
{
mCaretOffset
=
-
1
;
mAccWithCaret
=
nullptr
;
}
static
bool
SelectionRangeChanged
(
SelectionType
aType
const
dom
:
:
AbstractRange
&
aRange
)
;
~
SelectionManager
(
)
;
protected
:
SelectionManager
(
)
;
void
ProcessSelectionChanged
(
SelData
*
aSelData
)
;
private
:
int32_t
mCaretOffset
;
HyperTextAccessible
*
mAccWithCaret
;
WeakPtr
<
dom
:
:
Selection
>
mCurrCtrlNormalSel
;
}
;
}
}
#
endif
