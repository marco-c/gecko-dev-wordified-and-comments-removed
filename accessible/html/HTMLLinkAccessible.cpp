#
include
"
HTMLLinkAccessible
.
h
"
#
include
"
CacheConstants
.
h
"
#
include
"
nsCoreUtils
.
h
"
#
include
"
mozilla
/
a11y
/
Role
.
h
"
#
include
"
States
.
h
"
#
include
"
nsContentUtils
.
h
"
#
include
"
nsIMutationObserver
.
h
"
#
include
"
mozilla
/
a11y
/
DocAccessible
.
h
"
#
include
"
mozilla
/
dom
/
Element
.
h
"
#
include
"
mozilla
/
dom
/
MutationEventBinding
.
h
"
using
namespace
mozilla
;
using
namespace
mozilla
:
:
a11y
;
HTMLLinkAccessible
:
:
HTMLLinkAccessible
(
nsIContent
*
aContent
DocAccessible
*
aDoc
)
:
HyperTextAccessible
(
aContent
aDoc
)
{
mType
=
eHTMLLinkType
;
}
role
HTMLLinkAccessible
:
:
NativeRole
(
)
const
{
return
roles
:
:
LINK
;
}
uint64_t
HTMLLinkAccessible
:
:
NativeState
(
)
const
{
return
HyperTextAccessible
:
:
NativeState
(
)
&
~
states
:
:
READONLY
;
}
uint64_t
HTMLLinkAccessible
:
:
NativeLinkState
(
)
const
{
dom
:
:
ElementState
state
=
mContent
-
>
AsElement
(
)
-
>
State
(
)
;
if
(
state
.
HasState
(
dom
:
:
ElementState
:
:
UNVISITED
)
)
{
return
states
:
:
LINKED
;
}
if
(
state
.
HasState
(
dom
:
:
ElementState
:
:
VISITED
)
)
{
return
states
:
:
LINKED
|
states
:
:
TRAVERSED
;
}
return
nsCoreUtils
:
:
HasClickListener
(
mContent
)
?
states
:
:
LINKED
:
0
;
}
uint64_t
HTMLLinkAccessible
:
:
NativeInteractiveState
(
)
const
{
uint64_t
state
=
HyperTextAccessible
:
:
NativeInteractiveState
(
)
;
if
(
mContent
-
>
AsElement
(
)
-
>
HasAttr
(
nsGkAtoms
:
:
name
)
)
{
state
|
=
states
:
:
SELECTABLE
;
}
return
state
;
}
void
HTMLLinkAccessible
:
:
Value
(
nsString
&
aValue
)
const
{
aValue
.
Truncate
(
)
;
HyperTextAccessible
:
:
Value
(
aValue
)
;
if
(
aValue
.
IsEmpty
(
)
)
{
nsContentUtils
:
:
GetLinkLocation
(
mContent
-
>
AsElement
(
)
aValue
)
;
}
}
bool
HTMLLinkAccessible
:
:
HasPrimaryAction
(
)
const
{
return
IsLinked
(
)
|
|
HyperTextAccessible
:
:
HasPrimaryAction
(
)
;
;
}
void
HTMLLinkAccessible
:
:
ActionNameAt
(
uint8_t
aIndex
nsAString
&
aName
)
{
aName
.
Truncate
(
)
;
if
(
!
IsLinked
(
)
)
{
HyperTextAccessible
:
:
ActionNameAt
(
aIndex
aName
)
;
return
;
}
if
(
aIndex
=
=
eAction_Jump
)
aName
.
AssignLiteral
(
"
jump
"
)
;
}
bool
HTMLLinkAccessible
:
:
AttributeChangesState
(
nsAtom
*
aAttribute
)
{
return
aAttribute
=
=
nsGkAtoms
:
:
href
|
|
HyperTextAccessible
:
:
AttributeChangesState
(
aAttribute
)
;
}
void
HTMLLinkAccessible
:
:
DOMAttributeChanged
(
int32_t
aNameSpaceID
nsAtom
*
aAttribute
AttrModType
aModType
const
nsAttrValue
*
aOldValue
uint64_t
aOldState
)
{
HyperTextAccessible
:
:
DOMAttributeChanged
(
aNameSpaceID
aAttribute
aModType
aOldValue
aOldState
)
;
if
(
aAttribute
=
=
nsGkAtoms
:
:
href
&
&
IsAdditionOrRemoval
(
aModType
)
)
{
mDoc
-
>
QueueCacheUpdate
(
this
CacheDomain
:
:
Actions
)
;
}
}
ENameValueFlag
HTMLLinkAccessible
:
:
NativeName
(
nsString
&
aName
)
const
{
if
(
mContent
-
>
IsSVGElement
(
)
)
{
mContent
-
>
AsElement
(
)
-
>
GetAttr
(
kNameSpaceID_XLink
nsGkAtoms
:
:
title
aName
)
;
if
(
!
aName
.
IsEmpty
(
)
)
{
return
eNameOK
;
}
}
return
HyperTextAccessible
:
:
NativeName
(
aName
)
;
}
bool
HTMLLinkAccessible
:
:
IsLink
(
)
const
{
return
true
;
}
bool
HTMLLinkAccessible
:
:
IsLinked
(
)
const
{
dom
:
:
ElementState
state
=
mContent
-
>
AsElement
(
)
-
>
State
(
)
;
return
state
.
HasAtLeastOneOfStates
(
dom
:
:
ElementState
:
:
VISITED_OR_UNVISITED
)
;
}
