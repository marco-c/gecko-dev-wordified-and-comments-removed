#
include
"
BaseAccessibles
.
h
"
#
include
"
Accessible
-
inl
.
h
"
#
include
"
HyperTextAccessibleWrap
.
h
"
#
include
"
nsAccessibilityService
.
h
"
#
include
"
nsAccUtils
.
h
"
#
include
"
nsCoreUtils
.
h
"
#
include
"
Role
.
h
"
#
include
"
States
.
h
"
#
include
"
nsIURI
.
h
"
using
namespace
mozilla
:
:
a11y
;
LeafAccessible
:
:
LeafAccessible
(
nsIContent
*
aContent
DocAccessible
*
aDoc
)
:
AccessibleWrap
(
aContent
aDoc
)
{
}
NS_IMPL_ISUPPORTS_INHERITED0
(
LeafAccessible
Accessible
)
Accessible
*
LeafAccessible
:
:
ChildAtPoint
(
int32_t
aX
int32_t
aY
EWhichChildAtPoint
aWhichChild
)
{
return
this
;
}
bool
LeafAccessible
:
:
InsertChildAt
(
uint32_t
aIndex
Accessible
*
aChild
)
{
NS_NOTREACHED
(
"
InsertChildAt
called
on
leaf
accessible
!
"
)
;
return
false
;
}
bool
LeafAccessible
:
:
RemoveChild
(
Accessible
*
aChild
)
{
NS_NOTREACHED
(
"
RemoveChild
called
on
leaf
accessible
!
"
)
;
return
false
;
}
void
LeafAccessible
:
:
CacheChildren
(
)
{
}
NS_IMPL_ISUPPORTS_INHERITED0
(
LinkableAccessible
AccessibleWrap
)
void
LinkableAccessible
:
:
TakeFocus
(
)
{
if
(
Accessible
*
actionAcc
=
ActionWalk
(
)
)
{
actionAcc
-
>
TakeFocus
(
)
;
}
else
{
AccessibleWrap
:
:
TakeFocus
(
)
;
}
}
uint64_t
LinkableAccessible
:
:
NativeLinkState
(
)
const
{
bool
isLink
;
Accessible
*
actionAcc
=
const_cast
<
LinkableAccessible
*
>
(
this
)
-
>
ActionWalk
(
&
isLink
)
;
if
(
isLink
)
{
return
states
:
:
LINKED
|
(
actionAcc
-
>
LinkState
(
)
&
states
:
:
TRAVERSED
)
;
}
return
0
;
}
void
LinkableAccessible
:
:
Value
(
nsString
&
aValue
)
{
aValue
.
Truncate
(
)
;
Accessible
:
:
Value
(
aValue
)
;
if
(
!
aValue
.
IsEmpty
(
)
)
{
return
;
}
bool
isLink
;
Accessible
*
actionAcc
=
ActionWalk
(
&
isLink
)
;
if
(
isLink
)
{
actionAcc
-
>
Value
(
aValue
)
;
}
}
uint8_t
LinkableAccessible
:
:
ActionCount
(
)
{
bool
isLink
isOnclick
isLabelWithControl
;
ActionWalk
(
&
isLink
&
isOnclick
&
isLabelWithControl
)
;
return
(
isLink
|
|
isOnclick
|
|
isLabelWithControl
)
?
1
:
0
;
}
Accessible
*
LinkableAccessible
:
:
ActionWalk
(
bool
*
aIsLink
bool
*
aIsOnclick
bool
*
aIsLabelWithControl
)
{
if
(
aIsOnclick
)
{
*
aIsOnclick
=
false
;
}
if
(
aIsLink
)
{
*
aIsLink
=
false
;
}
if
(
aIsLabelWithControl
)
{
*
aIsLabelWithControl
=
false
;
}
if
(
nsCoreUtils
:
:
HasClickListener
(
mContent
)
)
{
if
(
aIsOnclick
)
{
*
aIsOnclick
=
true
;
}
return
nullptr
;
}
Accessible
*
walkUpAcc
=
this
;
while
(
(
walkUpAcc
=
walkUpAcc
-
>
Parent
(
)
)
&
&
!
walkUpAcc
-
>
IsDoc
(
)
)
{
if
(
walkUpAcc
-
>
LinkState
(
)
&
states
:
:
LINKED
)
{
if
(
aIsLink
)
{
*
aIsLink
=
true
;
}
return
walkUpAcc
;
}
if
(
nsCoreUtils
:
:
HasClickListener
(
walkUpAcc
-
>
GetContent
(
)
)
)
{
if
(
aIsOnclick
)
{
*
aIsOnclick
=
true
;
}
return
walkUpAcc
;
}
if
(
nsCoreUtils
:
:
IsLabelWithControl
(
walkUpAcc
-
>
GetContent
(
)
)
)
{
if
(
aIsLabelWithControl
)
{
*
aIsLabelWithControl
=
true
;
}
return
walkUpAcc
;
}
}
return
nullptr
;
}
void
LinkableAccessible
:
:
ActionNameAt
(
uint8_t
aIndex
nsAString
&
aName
)
{
aName
.
Truncate
(
)
;
if
(
aIndex
=
=
eAction_Jump
)
{
bool
isOnclick
isLink
isLabelWithControl
;
ActionWalk
(
&
isLink
&
isOnclick
&
isLabelWithControl
)
;
if
(
isLink
)
{
aName
.
AssignLiteral
(
"
jump
"
)
;
}
else
if
(
isOnclick
|
|
isLabelWithControl
)
{
aName
.
AssignLiteral
(
"
click
"
)
;
}
}
}
bool
LinkableAccessible
:
:
DoAction
(
uint8_t
aIndex
)
{
if
(
aIndex
!
=
eAction_Jump
)
{
return
false
;
}
if
(
Accessible
*
actionAcc
=
ActionWalk
(
)
)
{
return
actionAcc
-
>
DoAction
(
aIndex
)
;
}
return
AccessibleWrap
:
:
DoAction
(
aIndex
)
;
}
KeyBinding
LinkableAccessible
:
:
AccessKey
(
)
const
{
if
(
const
Accessible
*
actionAcc
=
const_cast
<
LinkableAccessible
*
>
(
this
)
-
>
ActionWalk
(
)
)
{
return
actionAcc
-
>
AccessKey
(
)
;
}
return
Accessible
:
:
AccessKey
(
)
;
}
already_AddRefed
<
nsIURI
>
LinkableAccessible
:
:
AnchorURIAt
(
uint32_t
aAnchorIndex
)
{
bool
isLink
;
Accessible
*
actionAcc
=
ActionWalk
(
&
isLink
)
;
if
(
isLink
)
{
NS_ASSERTION
(
actionAcc
-
>
IsLink
(
)
"
HyperLink
isn
'
t
implemented
.
"
)
;
if
(
actionAcc
-
>
IsLink
(
)
)
{
return
actionAcc
-
>
AnchorURIAt
(
aAnchorIndex
)
;
}
}
return
nullptr
;
}
uint64_t
DummyAccessible
:
:
NativeState
(
)
{
return
0
;
}
uint64_t
DummyAccessible
:
:
NativeInteractiveState
(
)
const
{
return
0
;
}
uint64_t
DummyAccessible
:
:
NativeLinkState
(
)
const
{
return
0
;
}
bool
DummyAccessible
:
:
NativelyUnavailable
(
)
const
{
return
false
;
}
void
DummyAccessible
:
:
ApplyARIAState
(
uint64_t
*
aState
)
const
{
}
