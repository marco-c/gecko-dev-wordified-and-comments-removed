#
ifndef
mozilla_a11y_HyperTextAccessible_h__
#
define
mozilla_a11y_HyperTextAccessible_h__
#
include
"
AccessibleWrap
.
h
"
#
include
"
mozilla
/
a11y
/
HyperTextAccessibleBase
.
h
"
#
include
"
nsIAccessibleText
.
h
"
#
include
"
nsIAccessibleTypes
.
h
"
#
include
"
nsIFrame
.
h
"
#
include
"
nsISelectionController
.
h
"
#
include
"
nsDirection
.
h
"
#
include
"
WordMovementType
.
h
"
class
nsFrameSelection
;
class
nsIFrame
;
class
nsRange
;
class
nsIWidget
;
namespace
mozilla
{
class
EditorBase
;
namespace
dom
{
class
Selection
;
}
namespace
a11y
{
class
TextLeafPoint
;
class
TextRange
;
struct
DOMPoint
{
DOMPoint
(
)
:
node
(
nullptr
)
idx
(
0
)
{
}
DOMPoint
(
nsINode
*
aNode
int32_t
aIdx
)
:
node
(
aNode
)
idx
(
aIdx
)
{
}
nsINode
*
node
;
int32_t
idx
;
}
;
class
HyperTextAccessible
:
public
AccessibleWrap
public
HyperTextAccessibleBase
{
public
:
HyperTextAccessible
(
nsIContent
*
aContent
DocAccessible
*
aDoc
)
;
NS_INLINE_DECL_REFCOUNTING_INHERITED
(
HyperTextAccessible
AccessibleWrap
)
virtual
already_AddRefed
<
AccAttributes
>
NativeAttributes
(
)
override
;
virtual
mozilla
:
:
a11y
:
:
role
NativeRole
(
)
const
override
;
virtual
uint64_t
NativeState
(
)
const
override
;
virtual
void
Shutdown
(
)
override
;
virtual
bool
RemoveChild
(
LocalAccessible
*
aAccessible
)
override
;
virtual
bool
InsertChildAt
(
uint32_t
aIndex
LocalAccessible
*
aChild
)
override
;
virtual
Relation
RelationByType
(
RelationType
aType
)
const
override
;
bool
IsEditable
(
)
const
;
nsresult
ContentToRenderedOffset
(
nsIFrame
*
aFrame
int32_t
aContentOffset
uint32_t
*
aRenderedOffset
)
const
;
nsresult
RenderedToContentOffset
(
nsIFrame
*
aFrame
uint32_t
aRenderedOffset
int32_t
*
aContentOffset
)
const
;
LocalAccessible
*
LinkAt
(
uint32_t
aIndex
)
{
return
EmbeddedChildAt
(
aIndex
)
;
}
uint32_t
DOMPointToOffset
(
nsINode
*
aNode
int32_t
aNodeOffset
bool
aIsEndOffset
=
false
)
const
;
uint32_t
TransformOffset
(
LocalAccessible
*
aDescendant
uint32_t
aOffset
bool
aIsEndOffset
)
const
;
DOMPoint
OffsetToDOMPoint
(
int32_t
aOffset
)
const
;
using
HyperTextAccessibleBase
:
:
CharAt
;
char16_t
CharAt
(
int32_t
aOffset
)
{
nsAutoString
charAtOffset
;
CharAt
(
aOffset
charAtOffset
)
;
return
charAtOffset
.
CharAt
(
0
)
;
}
bool
IsCharAt
(
int32_t
aOffset
char16_t
aChar
)
{
return
CharAt
(
aOffset
)
=
=
aChar
;
}
bool
IsLineEndCharAt
(
int32_t
aOffset
)
{
return
IsCharAt
(
aOffset
'
\
n
'
)
;
}
virtual
void
TextBeforeOffset
(
int32_t
aOffset
AccessibleTextBoundary
aBoundaryType
int32_t
*
aStartOffset
int32_t
*
aEndOffset
nsAString
&
aText
)
override
;
virtual
void
TextAtOffset
(
int32_t
aOffset
AccessibleTextBoundary
aBoundaryType
int32_t
*
aStartOffset
int32_t
*
aEndOffset
nsAString
&
aText
)
override
;
virtual
void
TextAfterOffset
(
int32_t
aOffset
AccessibleTextBoundary
aBoundaryType
int32_t
*
aStartOffset
int32_t
*
aEndOffset
nsAString
&
aText
)
override
;
virtual
already_AddRefed
<
AccAttributes
>
TextAttributes
(
bool
aIncludeDefAttrs
int32_t
aOffset
int32_t
*
aStartOffset
int32_t
*
aEndOffset
)
override
;
virtual
already_AddRefed
<
AccAttributes
>
DefaultTextAttributes
(
)
override
;
using
HyperTextAccessibleBase
:
:
GetChildOffset
;
virtual
LocalAccessible
*
GetChildAtOffset
(
uint32_t
aOffset
)
const
override
{
return
LocalChildAt
(
GetChildIndexAtOffset
(
aOffset
)
)
;
}
int32_t
OffsetAtPoint
(
int32_t
aX
int32_t
aY
uint32_t
aCoordType
)
override
;
LayoutDeviceIntRect
TextBounds
(
int32_t
aStartOffset
int32_t
aEndOffset
uint32_t
aCoordType
=
nsIAccessibleCoordinateType
:
:
COORDTYPE_SCREEN_RELATIVE
)
override
;
LayoutDeviceIntRect
CharBounds
(
int32_t
aOffset
uint32_t
aCoordType
)
override
;
virtual
int32_t
CaretOffset
(
)
const
override
;
virtual
void
SetCaretOffset
(
int32_t
aOffset
)
override
;
int32_t
CaretLineNumber
(
)
;
mozilla
:
:
LayoutDeviceIntRect
GetCaretRect
(
nsIWidget
*
*
aWidget
)
;
bool
IsCaretAtEndOfLine
(
)
const
;
virtual
int32_t
SelectionCount
(
)
override
;
virtual
bool
SelectionBoundsAt
(
int32_t
aSelectionNum
int32_t
*
aStartOffset
int32_t
*
aEndOffset
)
override
;
MOZ_CAN_RUN_SCRIPT_BOUNDARY
virtual
bool
RemoveFromSelection
(
int32_t
aSelectionNum
)
override
;
void
ScrollSubstringTo
(
int32_t
aStartOffset
int32_t
aEndOffset
uint32_t
aScrollType
)
;
void
ScrollSubstringToPoint
(
int32_t
aStartOffset
int32_t
aEndOffset
uint32_t
aCoordinateType
int32_t
aX
int32_t
aY
)
;
void
EnclosingRange
(
TextRange
&
aRange
)
const
;
virtual
void
SelectionRanges
(
nsTArray
<
TextRange
>
*
aRanges
)
const
override
;
void
VisibleRanges
(
nsTArray
<
TextRange
>
*
aRanges
)
const
;
void
RangeByChild
(
LocalAccessible
*
aChild
TextRange
&
aRange
)
const
;
void
RangeAtPoint
(
int32_t
aX
int32_t
aY
TextRange
&
aRange
)
const
;
MOZ_CAN_RUN_SCRIPT_BOUNDARY
void
ReplaceText
(
const
nsAString
&
aText
)
;
MOZ_CAN_RUN_SCRIPT_BOUNDARY
void
InsertText
(
const
nsAString
&
aText
int32_t
aPosition
)
;
void
CopyText
(
int32_t
aStartPos
int32_t
aEndPos
)
;
MOZ_CAN_RUN_SCRIPT_BOUNDARY
void
CutText
(
int32_t
aStartPos
int32_t
aEndPos
)
;
MOZ_CAN_RUN_SCRIPT_BOUNDARY
void
DeleteText
(
int32_t
aStartPos
int32_t
aEndPos
)
;
MOZ_CAN_RUN_SCRIPT
void
PasteText
(
int32_t
aPosition
)
;
virtual
already_AddRefed
<
EditorBase
>
GetEditor
(
)
const
;
dom
:
:
Selection
*
DOMSelection
(
)
const
;
protected
:
virtual
~
HyperTextAccessible
(
)
{
}
virtual
ENameValueFlag
NativeName
(
nsString
&
aName
)
const
override
;
uint32_t
AdjustCaretOffset
(
uint32_t
aOffset
)
const
;
bool
IsEmptyLastLineOffset
(
int32_t
aOffset
)
{
return
aOffset
=
=
static_cast
<
int32_t
>
(
CharacterCount
(
)
)
&
&
IsLineEndCharAt
(
aOffset
-
1
)
;
}
uint32_t
FindWordBoundary
(
uint32_t
aOffset
nsDirection
aDirection
EWordMovementType
aWordMovementType
)
;
enum
EWhichLineBoundary
{
ePrevLineBegin
ePrevLineEnd
eThisLineBegin
eThisLineEnd
eNextLineBegin
eNextLineEnd
}
;
uint32_t
FindLineBoundary
(
uint32_t
aOffset
EWhichLineBoundary
aWhichLineBoundary
)
;
int32_t
FindParagraphStartOffset
(
uint32_t
aOffset
)
;
int32_t
FindParagraphEndOffset
(
uint32_t
aOffset
)
;
uint32_t
FindOffset
(
uint32_t
aOffset
nsDirection
aDirection
nsSelectionAmount
aAmount
EWordMovementType
aWordMovementType
=
eDefaultBehavior
)
;
LayoutDeviceIntRect
GetBoundsInFrame
(
nsIFrame
*
aFrame
uint32_t
aStartRenderedOffset
uint32_t
aEndRenderedOffset
)
;
already_AddRefed
<
nsFrameSelection
>
FrameSelection
(
)
const
;
void
GetSelectionDOMRanges
(
SelectionType
aSelectionType
nsTArray
<
nsRange
*
>
*
aRanges
)
;
MOZ_CAN_RUN_SCRIPT_BOUNDARY
nsresult
SetSelectionRange
(
int32_t
aStartPos
int32_t
aEndPos
)
;
nsresult
GetDOMPointByFrameOffset
(
nsIFrame
*
aFrame
int32_t
aOffset
LocalAccessible
*
aAccessible
mozilla
:
:
a11y
:
:
DOMPoint
*
aPoint
)
;
void
GetSpellTextAttr
(
nsINode
*
aNode
uint32_t
aNodeOffset
uint32_t
*
aStartOffset
uint32_t
*
aEndOffset
AccAttributes
*
aAttributes
)
;
void
SetMathMLXMLRoles
(
AccAttributes
*
aAttributes
)
;
virtual
const
Accessible
*
Acc
(
)
const
override
{
return
this
;
}
virtual
nsTArray
<
int32_t
>
&
GetCachedHyperTextOffsets
(
)
override
{
return
mOffsets
;
}
private
:
mutable
nsTArray
<
int32_t
>
mOffsets
;
}
;
inline
HyperTextAccessible
*
LocalAccessible
:
:
AsHyperText
(
)
{
return
IsHyperText
(
)
?
static_cast
<
HyperTextAccessible
*
>
(
this
)
:
nullptr
;
}
inline
HyperTextAccessibleBase
*
LocalAccessible
:
:
AsHyperTextBase
(
)
{
return
AsHyperText
(
)
;
}
}
}
#
endif
