#
include
"
XULTabAccessible
.
h
"
#
include
"
ARIAMap
.
h
"
#
include
"
nsAccUtils
.
h
"
#
include
"
Relation
.
h
"
#
include
"
Role
.
h
"
#
include
"
States
.
h
"
#
include
"
mozilla
/
dom
/
Document
.
h
"
#
include
"
nsIDOMXULSelectCntrlEl
.
h
"
#
include
"
nsIDOMXULSelectCntrlItemEl
.
h
"
#
include
"
nsIDOMXULRelatedElement
.
h
"
#
include
"
nsXULElement
.
h
"
#
include
"
mozilla
/
dom
/
BindingDeclarations
.
h
"
using
namespace
mozilla
:
:
a11y
;
XULTabAccessible
:
:
XULTabAccessible
(
nsIContent
*
aContent
DocAccessible
*
aDoc
)
:
HyperTextAccessibleWrap
(
aContent
aDoc
)
{
}
uint8_t
XULTabAccessible
:
:
ActionCount
(
)
const
{
return
1
;
}
void
XULTabAccessible
:
:
ActionNameAt
(
uint8_t
aIndex
nsAString
&
aName
)
{
if
(
aIndex
=
=
eAction_Switch
)
aName
.
AssignLiteral
(
"
switch
"
)
;
}
bool
XULTabAccessible
:
:
DoAction
(
uint8_t
index
)
const
{
if
(
index
=
=
eAction_Switch
)
{
RefPtr
<
nsXULElement
>
tab
=
nsXULElement
:
:
FromNodeOrNull
(
mContent
)
;
if
(
tab
)
{
tab
-
>
Click
(
mozilla
:
:
dom
:
:
CallerType
:
:
System
)
;
return
true
;
}
}
return
false
;
}
role
XULTabAccessible
:
:
NativeRole
(
)
const
{
return
roles
:
:
PAGETAB
;
}
uint64_t
XULTabAccessible
:
:
NativeState
(
)
const
{
uint64_t
state
=
AccessibleWrap
:
:
NativeState
(
)
;
nsCOMPtr
<
nsIDOMXULSelectControlItemElement
>
tab
=
Elm
(
)
-
>
AsXULSelectControlItem
(
)
;
if
(
tab
)
{
bool
selected
=
false
;
if
(
NS_SUCCEEDED
(
tab
-
>
GetSelected
(
&
selected
)
)
&
&
selected
)
state
|
=
states
:
:
SELECTED
;
if
(
mContent
-
>
AsElement
(
)
-
>
AttrValueIs
(
kNameSpaceID_None
nsGkAtoms
:
:
pinned
nsGkAtoms
:
:
_true
eCaseMatters
)
)
state
|
=
states
:
:
PINNED
;
}
return
state
;
}
uint64_t
XULTabAccessible
:
:
NativeInteractiveState
(
)
const
{
uint64_t
state
=
Accessible
:
:
NativeInteractiveState
(
)
;
return
(
state
&
states
:
:
UNAVAILABLE
)
?
state
:
state
|
states
:
:
SELECTABLE
;
}
Relation
XULTabAccessible
:
:
RelationByType
(
RelationType
aType
)
const
{
Relation
rel
=
AccessibleWrap
:
:
RelationByType
(
aType
)
;
if
(
aType
!
=
RelationType
:
:
LABEL_FOR
)
return
rel
;
ErrorResult
rv
;
nsIContent
*
parent
=
mContent
-
>
AsElement
(
)
-
>
Closest
(
NS_LITERAL_STRING
(
"
tabs
"
)
rv
)
;
if
(
!
parent
)
return
rel
;
nsCOMPtr
<
nsIDOMXULRelatedElement
>
tabsElm
=
parent
-
>
AsElement
(
)
-
>
AsXULRelated
(
)
;
if
(
!
tabsElm
)
return
rel
;
RefPtr
<
mozilla
:
:
dom
:
:
Element
>
tabpanelElement
;
tabsElm
-
>
GetRelatedElement
(
GetNode
(
)
getter_AddRefs
(
tabpanelElement
)
)
;
if
(
!
tabpanelElement
)
return
rel
;
rel
.
AppendTarget
(
mDoc
tabpanelElement
)
;
return
rel
;
}
void
XULTabAccessible
:
:
ApplyARIAState
(
uint64_t
*
aState
)
const
{
HyperTextAccessibleWrap
:
:
ApplyARIAState
(
aState
)
;
if
(
nsAccUtils
:
:
IsARIASelected
(
this
)
)
{
*
aState
|
=
states
:
:
SELECTED
;
}
}
XULTabsAccessible
:
:
XULTabsAccessible
(
nsIContent
*
aContent
DocAccessible
*
aDoc
)
:
XULSelectControlAccessible
(
aContent
aDoc
)
{
}
role
XULTabsAccessible
:
:
NativeRole
(
)
const
{
return
roles
:
:
PAGETABLIST
;
}
uint8_t
XULTabsAccessible
:
:
ActionCount
(
)
const
{
return
0
;
}
void
XULTabsAccessible
:
:
Value
(
nsString
&
aValue
)
const
{
aValue
.
Truncate
(
)
;
}
ENameValueFlag
XULTabsAccessible
:
:
NativeName
(
nsString
&
aName
)
const
{
return
eNameOK
;
}
void
XULTabsAccessible
:
:
ApplyARIAState
(
uint64_t
*
aState
)
const
{
XULSelectControlAccessible
:
:
ApplyARIAState
(
aState
)
;
MOZ_ASSERT
(
Elm
(
)
)
;
aria
:
:
MapToState
(
aria
:
:
eARIAMultiSelectable
Elm
(
)
aState
)
;
}
void
XULTabsAccessible
:
:
SelectedItems
(
nsTArray
<
Accessible
*
>
*
aItems
)
{
if
(
nsAccUtils
:
:
IsARIAMultiSelectable
(
this
)
)
{
AccessibleWrap
:
:
SelectedItems
(
aItems
)
;
}
else
{
XULSelectControlAccessible
:
:
SelectedItems
(
aItems
)
;
}
}
Accessible
*
XULTabsAccessible
:
:
GetSelectedItem
(
uint32_t
aIndex
)
{
if
(
nsAccUtils
:
:
IsARIAMultiSelectable
(
this
)
)
{
return
AccessibleWrap
:
:
GetSelectedItem
(
aIndex
)
;
}
return
XULSelectControlAccessible
:
:
GetSelectedItem
(
aIndex
)
;
}
uint32_t
XULTabsAccessible
:
:
SelectedItemCount
(
)
{
if
(
nsAccUtils
:
:
IsARIAMultiSelectable
(
this
)
)
{
return
AccessibleWrap
:
:
SelectedItemCount
(
)
;
}
return
XULSelectControlAccessible
:
:
SelectedItemCount
(
)
;
}
bool
XULTabsAccessible
:
:
IsItemSelected
(
uint32_t
aIndex
)
{
if
(
nsAccUtils
:
:
IsARIAMultiSelectable
(
this
)
)
{
return
AccessibleWrap
:
:
IsItemSelected
(
aIndex
)
;
}
return
XULSelectControlAccessible
:
:
IsItemSelected
(
aIndex
)
;
}
role
XULTabpanelsAccessible
:
:
NativeRole
(
)
const
{
return
roles
:
:
PANE
;
}
XULTabpanelAccessible
:
:
XULTabpanelAccessible
(
nsIContent
*
aContent
DocAccessible
*
aDoc
)
:
AccessibleWrap
(
aContent
aDoc
)
{
}
role
XULTabpanelAccessible
:
:
NativeRole
(
)
const
{
return
roles
:
:
PROPERTYPAGE
;
}
Relation
XULTabpanelAccessible
:
:
RelationByType
(
RelationType
aType
)
const
{
Relation
rel
=
AccessibleWrap
:
:
RelationByType
(
aType
)
;
if
(
aType
!
=
RelationType
:
:
LABELLED_BY
)
return
rel
;
if
(
!
mContent
-
>
GetParent
(
)
)
return
rel
;
nsCOMPtr
<
nsIDOMXULRelatedElement
>
tabpanelsElm
=
mContent
-
>
GetParent
(
)
-
>
AsElement
(
)
-
>
AsXULRelated
(
)
;
if
(
!
tabpanelsElm
)
return
rel
;
RefPtr
<
mozilla
:
:
dom
:
:
Element
>
tabElement
;
tabpanelsElm
-
>
GetRelatedElement
(
GetNode
(
)
getter_AddRefs
(
tabElement
)
)
;
if
(
!
tabElement
)
return
rel
;
rel
.
AppendTarget
(
mDoc
tabElement
)
;
return
rel
;
}
