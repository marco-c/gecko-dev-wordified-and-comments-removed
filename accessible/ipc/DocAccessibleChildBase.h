#
ifndef
mozilla_a11y_DocAccessibleChildBase_h
#
define
mozilla_a11y_DocAccessibleChildBase_h
#
include
"
mozilla
/
a11y
/
DocAccessible
.
h
"
#
include
"
mozilla
/
a11y
/
PDocAccessibleChild
.
h
"
#
include
"
mozilla
/
Unused
.
h
"
#
include
"
nsISupportsImpl
.
h
"
namespace
mozilla
{
namespace
a11y
{
class
LocalAccessible
;
class
AccShowEvent
;
class
DocAccessibleChildBase
:
public
PDocAccessibleChild
{
public
:
explicit
DocAccessibleChildBase
(
DocAccessible
*
aDoc
)
:
mDoc
(
aDoc
)
mIsRemoteConstructed
(
false
)
{
MOZ_COUNT_CTOR
(
DocAccessibleChildBase
)
;
}
~
DocAccessibleChildBase
(
)
{
MOZ_ASSERT
(
!
mDoc
)
;
if
(
mDoc
)
{
mDoc
-
>
SetIPCDoc
(
nullptr
)
;
}
MOZ_COUNT_DTOR
(
DocAccessibleChildBase
)
;
}
virtual
void
Shutdown
(
)
{
DetachDocument
(
)
;
SendShutdown
(
)
;
}
void
InsertIntoIpcTree
(
LocalAccessible
*
aParent
LocalAccessible
*
aChild
uint32_t
aIdxInParent
bool
aSuppressShowEvent
)
;
void
ShowEvent
(
AccShowEvent
*
aShowEvent
)
;
virtual
void
ActorDestroy
(
ActorDestroyReason
)
override
{
if
(
!
mDoc
)
{
return
;
}
mDoc
-
>
SetIPCDoc
(
nullptr
)
;
mDoc
=
nullptr
;
}
virtual
mozilla
:
:
ipc
:
:
IPCResult
RecvVerifyCache
(
const
uint64_t
&
aID
const
uint64_t
&
aCacheDomain
AccAttributes
*
aFields
)
override
;
protected
:
static
void
FlattenTree
(
LocalAccessible
*
aRoot
nsTArray
<
LocalAccessible
*
>
&
aTree
)
;
static
void
SerializeTree
(
nsTArray
<
LocalAccessible
*
>
&
aTree
nsTArray
<
AccessibleData
>
&
aData
)
;
virtual
void
MaybeSendShowEvent
(
ShowEventData
&
aData
bool
aFromUser
)
{
Unused
<
<
SendShowEvent
(
aData
aFromUser
)
;
}
void
DetachDocument
(
)
{
if
(
mDoc
)
{
mDoc
-
>
SetIPCDoc
(
nullptr
)
;
mDoc
=
nullptr
;
}
}
bool
IsConstructedInParentProcess
(
)
const
{
return
mIsRemoteConstructed
;
}
void
SetConstructedInParentProcess
(
)
{
mIsRemoteConstructed
=
true
;
}
LocalAccessible
*
IdToAccessible
(
const
uint64_t
&
aID
)
const
;
DocAccessible
*
mDoc
;
bool
mIsRemoteConstructed
;
friend
void
DocAccessible
:
:
DoInitialUpdate
(
)
;
}
;
}
}
#
endif
