add_task
(
async
function
test_default_promo
(
)
{
ASRouter
.
resetMessageState
(
)
;
let
{
win
:
win1
tab
:
tab1
}
=
await
openTabAndWaitForRender
(
)
;
await
SpecialPowers
.
spawn
(
tab1
[
]
async
function
(
)
{
const
promoContainer
=
content
.
document
.
querySelector
(
"
.
promo
"
)
;
const
promoHeader
=
content
.
document
.
getElementById
(
"
promo
-
header
"
)
;
ok
(
promoContainer
"
Focus
promo
is
shown
"
)
;
is
(
promoHeader
.
textContent
"
Next
-
level
privacy
on
mobile
"
"
Correct
default
values
are
shown
"
)
;
}
)
;
let
{
win
:
win2
tab
:
tab2
}
=
await
openTabAndWaitForRender
(
)
;
let
{
win
:
win3
tab
:
tab3
}
=
await
openTabAndWaitForRender
(
)
;
let
{
win
:
win4
tab
:
tab4
}
=
await
openTabAndWaitForRender
(
)
;
await
SpecialPowers
.
spawn
(
tab4
[
]
async
function
(
)
{
is
(
content
.
document
.
querySelector
(
"
.
promo
button
"
)
null
"
should
no
longer
render
the
promo
after
3
impressions
"
)
;
}
)
;
await
BrowserTestUtils
.
closeWindow
(
win1
)
;
await
BrowserTestUtils
.
closeWindow
(
win2
)
;
await
BrowserTestUtils
.
closeWindow
(
win3
)
;
await
BrowserTestUtils
.
closeWindow
(
win4
)
;
}
)
;
