function
test
(
)
{
waitForExplicitFinish
(
)
;
function
openSidebar
(
win
)
{
return
win
.
SidebarUI
.
show
(
"
viewBookmarksSidebar
"
)
.
then
(
(
)
=
>
win
)
;
}
let
windowCache
=
[
]
;
function
cacheWindow
(
w
)
{
windowCache
.
push
(
w
)
;
return
w
;
}
function
closeCachedWindows
(
)
{
windowCache
.
forEach
(
w
=
>
w
.
close
(
)
)
;
}
openWindow
(
window
{
}
1
)
.
then
(
cacheWindow
)
.
then
(
openSidebar
)
.
then
(
win
=
>
openWindow
(
win
{
private
:
true
}
)
)
.
then
(
cacheWindow
)
.
then
(
function
(
{
document
}
)
{
let
sidebarBox
=
document
.
getElementById
(
"
sidebar
-
box
"
)
;
is
(
sidebarBox
.
hidden
true
"
Opening
a
private
window
from
reg
window
does
not
open
the
sidebar
"
)
;
}
)
.
then
(
closeCachedWindows
)
.
then
(
(
)
=
>
openWindow
(
window
)
)
.
then
(
cacheWindow
)
.
then
(
openSidebar
)
.
then
(
win
=
>
openWindow
(
win
)
)
.
then
(
cacheWindow
)
.
then
(
function
(
{
document
}
)
{
let
sidebarBox
=
document
.
getElementById
(
"
sidebar
-
box
"
)
;
is
(
sidebarBox
.
hidden
false
"
Opening
a
reg
window
from
reg
window
does
open
the
sidebar
"
)
;
}
)
.
then
(
closeCachedWindows
)
.
then
(
(
)
=
>
openWindow
(
window
{
private
:
true
}
)
)
.
then
(
cacheWindow
)
.
then
(
openSidebar
)
.
then
(
win
=
>
openWindow
(
win
)
)
.
then
(
cacheWindow
)
.
then
(
function
(
{
document
}
)
{
let
sidebarBox
=
document
.
getElementById
(
"
sidebar
-
box
"
)
;
is
(
sidebarBox
.
hidden
true
"
Opening
a
reg
window
from
a
private
window
does
not
open
the
sidebar
"
)
;
}
)
.
then
(
closeCachedWindows
)
.
then
(
(
)
=
>
openWindow
(
window
{
private
:
true
}
)
)
.
then
(
cacheWindow
)
.
then
(
openSidebar
)
.
then
(
win
=
>
openWindow
(
win
{
private
:
true
}
)
)
.
then
(
cacheWindow
)
.
then
(
function
(
{
document
}
)
{
let
sidebarBox
=
document
.
getElementById
(
"
sidebar
-
box
"
)
;
is
(
sidebarBox
.
hidden
false
"
Opening
a
private
window
from
private
window
does
open
the
sidebar
"
)
;
}
)
.
then
(
closeCachedWindows
)
.
then
(
finish
)
;
}
