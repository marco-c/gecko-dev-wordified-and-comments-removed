add_task
(
async
function
test
(
)
{
let
prefix
=
"
http
:
/
/
mochi
.
test
:
8888
/
browser
/
browser
/
components
/
privatebrowsing
/
test
/
browser
/
"
;
let
privateWin
=
await
BrowserTestUtils
.
openNewBrowserWindow
(
{
private
:
true
}
)
;
let
testURL
=
prefix
+
"
browser_privatebrowsing_localStorage_before_after_page
.
html
"
;
await
BrowserTestUtils
.
openNewForegroundTab
(
privateWin
.
gBrowser
testURL
)
;
is
(
privateWin
.
gBrowser
.
selectedBrowser
.
contentTitle
"
1
"
"
localStorage
should
contain
1
item
"
)
;
let
win
=
await
BrowserTestUtils
.
openNewBrowserWindow
(
)
;
testURL
=
prefix
+
"
browser_privatebrowsing_localStorage_before_after_page2
.
html
"
;
await
BrowserTestUtils
.
openNewForegroundTab
(
win
.
gBrowser
testURL
)
;
is
(
win
.
gBrowser
.
selectedBrowser
.
contentTitle
"
null
|
0
"
"
localStorage
should
contain
0
items
"
)
;
await
BrowserTestUtils
.
closeWindow
(
privateWin
)
;
await
BrowserTestUtils
.
closeWindow
(
win
)
;
}
)
;
