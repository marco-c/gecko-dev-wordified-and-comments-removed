const
TP_PB_ENABLED_PREF
=
"
privacy
.
trackingprotection
.
pbmode
.
enabled
"
;
const
PB_SEARCH_UI_ENABLED_PREF
=
"
browser
.
privatebrowsing
.
searchUI
"
;
document
.
addEventListener
(
"
DOMContentLoaded
"
function
(
)
{
if
(
!
RPMIsWindowPrivate
(
)
)
{
document
.
documentElement
.
classList
.
remove
(
"
private
"
)
;
document
.
documentElement
.
classList
.
add
(
"
normal
"
)
;
document
.
getElementById
(
"
startPrivateBrowsing
"
)
.
addEventListener
(
"
click
"
function
(
)
{
RPMSendAsyncMessage
(
"
OpenPrivateWindow
"
)
;
}
)
;
return
;
}
document
.
getElementById
(
"
startTour
"
)
.
addEventListener
(
"
click
"
function
(
)
{
RPMSendAsyncMessage
(
"
DontShowIntroPanelAgain
"
)
;
}
)
;
let
introURL
=
RPMGetFormatURLPref
(
"
privacy
.
trackingprotection
.
introURL
"
)
;
let
variation
=
"
?
variation
=
1
"
;
document
.
getElementById
(
"
startTour
"
)
.
setAttribute
(
"
href
"
introURL
+
variation
)
;
document
.
getElementById
(
"
learnMore
"
)
.
setAttribute
(
"
href
"
RPMGetFormatURLPref
(
"
app
.
support
.
baseURL
"
)
+
"
private
-
browsing
"
)
;
let
tpEnabled
=
RPMGetBoolPref
(
TP_PB_ENABLED_PREF
)
;
if
(
!
tpEnabled
)
{
document
.
getElementById
(
"
tpSubHeader
"
)
.
remove
(
)
;
document
.
getElementById
(
"
tpSection
"
)
.
remove
(
)
;
}
let
searchUIEnabled
=
RPMGetBoolPref
(
PB_SEARCH_UI_ENABLED_PREF
)
;
if
(
searchUIEnabled
)
{
setupSearchUI
(
)
;
}
}
)
;
function
setupSearchUI
(
)
{
document
.
documentElement
.
classList
.
remove
(
"
no
-
search
-
ui
"
)
;
document
.
documentElement
.
classList
.
add
(
"
search
-
ui
"
)
;
document
.
getElementById
(
"
private
-
browsing
-
myths
"
)
.
setAttribute
(
"
href
"
RPMGetFormatURLPref
(
"
app
.
support
.
baseURL
"
)
+
"
private
-
browsing
-
myths
"
)
;
let
btn
=
document
.
getElementById
(
"
search
-
handoff
-
button
"
)
;
let
editable
=
document
.
getElementById
(
"
fake
-
editable
"
)
;
let
HIDE_SEARCH_TOPIC
=
"
HideSearch
"
;
let
SHOW_SEARCH_TOPIC
=
"
ShowSearch
"
;
let
SEARCH_HANDOFF_TOPIC
=
"
SearchHandoff
"
;
function
showSearch
(
)
{
btn
.
classList
.
remove
(
"
focused
"
)
;
btn
.
classList
.
remove
(
"
hidden
"
)
;
RPMRemoveMessageListener
(
SHOW_SEARCH_TOPIC
showSearch
)
;
}
function
hideSearch
(
)
{
btn
.
classList
.
add
(
"
hidden
"
)
;
}
function
handoffSearch
(
text
)
{
RPMSendAsyncMessage
(
SEARCH_HANDOFF_TOPIC
{
text
}
)
;
RPMAddMessageListener
(
SHOW_SEARCH_TOPIC
showSearch
)
;
if
(
text
)
{
hideSearch
(
)
;
}
else
{
btn
.
classList
.
add
(
"
focused
"
)
;
RPMAddMessageListener
(
HIDE_SEARCH_TOPIC
hideSearch
)
;
}
}
btn
.
addEventListener
(
"
focus
"
function
(
)
{
handoffSearch
(
)
;
}
)
;
btn
.
addEventListener
(
"
click
"
function
(
)
{
handoffSearch
(
)
;
}
)
;
editable
.
addEventListener
(
"
drop
"
function
(
ev
)
{
ev
.
preventDefault
(
)
;
let
text
=
ev
.
dataTransfer
.
getData
(
"
text
"
)
;
if
(
text
)
{
handoffSearch
(
text
)
;
}
}
)
;
editable
.
addEventListener
(
"
paste
"
function
(
ev
)
{
ev
.
preventDefault
(
)
;
handoffSearch
(
ev
.
clipboardData
.
getData
(
"
Text
"
)
)
;
}
)
;
let
input
=
document
.
getElementById
(
"
dummy
-
input
"
)
;
new
window
.
ContentSearchUIController
(
input
input
.
parentNode
"
aboutprivatebrowsing
"
"
aboutprivatebrowsing
"
)
;
}
