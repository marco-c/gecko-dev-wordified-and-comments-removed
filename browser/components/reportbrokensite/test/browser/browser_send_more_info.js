"
use
strict
"
;
const
VIDEO_URL
=
{
BASE_URL
}
/
videotest
.
mp4
;
Services
.
scriptloader
.
loadSubScript
(
getRootDirectory
(
gTestPath
)
+
"
send_more_info
.
js
"
this
)
;
add_common_setup
(
)
;
requestLongerTimeout
(
2
)
;
add_task
(
async
function
testSendMoreInfoPref
(
)
{
ensureReportBrokenSitePreffedOn
(
)
;
await
BrowserTestUtils
.
withNewTab
(
REPORTABLE_PAGE_URL
async
function
(
browser
)
{
await
changeTab
(
gBrowser
.
selectedTab
REPORTABLE_PAGE_URL
)
;
ensureSendMoreInfoDisabled
(
)
;
let
rbs
=
await
AppMenu
(
)
.
openReportBrokenSite
(
)
;
await
rbs
.
isSendMoreInfoHidden
(
)
;
await
rbs
.
close
(
)
;
ensureSendMoreInfoEnabled
(
)
;
rbs
=
await
AppMenu
(
)
.
openReportBrokenSite
(
)
;
await
rbs
.
isSendMoreInfoShown
(
)
;
await
rbs
.
close
(
)
;
}
)
;
}
)
;
add_task
(
async
function
testSendingMoreInfo
(
)
{
ensureReportBrokenSitePreffedOn
(
)
;
ensureSendMoreInfoEnabled
(
)
;
const
tab
=
await
openTab
(
REPORTABLE_PAGE_URL
)
;
await
testSendMoreInfo
(
tab
AppMenu
(
)
)
;
await
changeTab
(
tab
REPORTABLE_PAGE_URL2
)
;
await
testSendMoreInfo
(
tab
ProtectionsPanel
(
)
{
url
:
"
https
:
/
/
override
.
com
"
description
:
"
another
"
expectNoTabDetails
:
true
}
)
;
const
tab2
=
await
openTab
(
VIDEO_URL
)
;
await
testSendMoreInfo
(
tab2
HelpMenu
(
)
)
;
closeTab
(
tab2
)
;
closeTab
(
tab
)
;
}
)
;
