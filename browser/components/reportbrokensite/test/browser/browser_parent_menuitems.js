"
use
strict
"
;
add_common_setup
(
)
;
add_task
(
async
function
testMenus
(
)
{
ensureReportBrokenSitePreffedOff
(
)
;
const
appMenu
=
AppMenu
(
)
;
const
helpMenu
=
HelpMenu
(
)
;
const
protectionsPanel
=
ProtectionsPanel
(
)
;
async
function
ensure
(
menu
fn
test
)
{
await
menu
.
open
(
)
;
fn
(
menu
.
reportBrokenSite
{
fn
.
name
}
(
{
menu
.
menuDescription
}
)
{
test
}
-
)
;
await
menu
.
close
(
)
;
}
await
BrowserTestUtils
.
withNewTab
(
"
about
:
blank
"
async
function
(
)
{
ReportBrokenSite
.
enableOrDisableMenuitems
(
window
)
;
const
test
=
"
on
invalid
page
when
preffed
off
"
;
await
ensure
(
appMenu
isMenuItemDisabled
test
)
;
await
ensure
(
helpMenu
isMenuItemDisabled
test
)
;
ensureProtectionsPanelHidden
(
test
)
;
}
)
;
await
BrowserTestUtils
.
withNewTab
(
REPORTABLE_PAGE_URL
async
function
(
)
{
ReportBrokenSite
.
enableOrDisableMenuitems
(
window
)
;
const
test
=
"
on
valid
page
when
preffed
off
(
fallback
to
original
reporter
)
"
;
await
ensure
(
appMenu
isMenuItemEnabled
test
)
;
await
ensure
(
helpMenu
isMenuItemEnabled
test
)
;
await
ensure
(
protectionsPanel
isMenuItemEnabled
test
)
;
}
)
;
ensureReportBrokenSitePreffedOn
(
)
;
await
BrowserTestUtils
.
withNewTab
(
"
about
:
blank
"
async
function
(
)
{
ReportBrokenSite
.
enableOrDisableMenuitems
(
window
)
;
const
test
=
"
on
invalid
page
when
preffed
on
"
;
await
ensure
(
appMenu
isMenuItemDisabled
test
)
;
await
ensure
(
helpMenu
isMenuItemDisabled
test
)
;
ensureProtectionsPanelHidden
(
test
)
;
}
)
;
await
BrowserTestUtils
.
withNewTab
(
REPORTABLE_PAGE_URL
async
function
(
)
{
ReportBrokenSite
.
enableOrDisableMenuitems
(
window
)
;
const
test
=
"
on
valid
page
when
preffed
on
"
;
await
ensure
(
appMenu
isMenuItemEnabled
test
)
;
await
ensure
(
helpMenu
isMenuItemEnabled
test
)
;
await
ensure
(
protectionsPanel
isMenuItemEnabled
test
)
;
}
)
;
ensureReportBrokenSitePreffedOff
(
)
;
await
BrowserTestUtils
.
withNewTab
(
REPORTABLE_PAGE_URL
async
function
(
)
{
ReportBrokenSite
.
enableOrDisableMenuitems
(
window
)
;
const
test
=
"
still
active
when
pref
toggled
back
off
"
;
await
ensure
(
appMenu
isMenuItemEnabled
test
)
;
await
ensure
(
helpMenu
isMenuItemEnabled
test
)
;
await
ensure
(
protectionsPanel
isMenuItemEnabled
test
)
;
}
)
;
ensureReportBrokenSitePreffedOn
(
)
;
ensureReportBrokenSiteDisabledByPolicy
(
)
;
await
BrowserTestUtils
.
withNewTab
(
REPORTABLE_PAGE_URL
async
function
(
)
{
ReportBrokenSite
.
enableOrDisableMenuitems
(
window
)
;
const
test
=
"
when
disabled
by
DisableFeedbackCommands
enterprise
policy
"
;
await
ensure
(
appMenu
isMenuItemHidden
test
)
;
await
ensure
(
helpMenu
isMenuItemHidden
test
)
;
await
ensure
(
protectionsPanel
isMenuItemHidden
test
)
;
}
)
;
}
)
;
