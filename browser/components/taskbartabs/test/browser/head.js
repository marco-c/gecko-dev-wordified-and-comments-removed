"
use
strict
"
;
ChromeUtils
.
defineESModuleGetters
(
this
{
TaskbarTabsRegistry
:
"
resource
:
/
/
/
modules
/
taskbartabs
/
TaskbarTabsRegistry
.
sys
.
mjs
"
TaskbarTabsWindowManager
:
"
resource
:
/
/
/
modules
/
taskbartabs
/
TaskbarTabsWindowManager
.
sys
.
mjs
"
}
)
;
add_setup
(
async
(
)
=
>
{
await
SpecialPowers
.
pushPrefEnv
(
{
set
:
[
[
"
network
.
dns
.
localDomains
"
"
www
.
test
.
com
"
]
]
}
)
;
}
)
;
async
function
openTaskbarTabWindow
(
aTab
=
null
)
{
const
url
=
Services
.
io
.
newURI
(
"
https
:
/
/
www
.
test
.
com
"
)
;
const
userContextId
=
0
;
const
registry
=
new
TaskbarTabsRegistry
(
)
;
const
taskbarTab
=
registry
.
findOrCreateTaskbarTab
(
url
userContextId
)
;
const
windowManager
=
new
TaskbarTabsWindowManager
(
)
;
const
windowPromise
=
BrowserTestUtils
.
waitForNewWindow
(
)
;
if
(
aTab
)
{
windowManager
.
replaceTabWithWindow
(
taskbarTab
aTab
)
;
}
else
{
windowManager
.
openWindow
(
taskbarTab
)
;
}
return
await
windowPromise
;
}
