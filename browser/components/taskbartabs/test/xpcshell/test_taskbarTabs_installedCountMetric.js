"
use
strict
"
;
ChromeUtils
.
defineESModuleGetters
(
this
{
sinon
:
"
resource
:
/
/
testing
-
common
/
Sinon
.
sys
.
mjs
"
TaskbarTabsPin
:
"
resource
:
/
/
/
modules
/
taskbartabs
/
TaskbarTabsPin
.
sys
.
mjs
"
}
)
;
add_setup
(
function
test_setup
(
)
{
do_get_profile
(
)
;
Services
.
fog
.
initializeFOG
(
)
;
sinon
.
stub
(
TaskbarTabsPin
"
pinTaskbarTab
"
)
;
sinon
.
stub
(
TaskbarTabsPin
"
unpinTaskbarTab
"
)
;
}
)
;
add_task
(
async
function
test_installedCounterMetric
(
)
{
const
value
=
(
)
=
>
Glean
.
webApp
.
installedWebAppCount
.
testGetValue
(
)
;
equal
(
value
(
)
undefined
"
Should
not
be
set
before
initializing
"
)
;
const
{
TaskbarTabs
}
=
ChromeUtils
.
importESModule
(
"
resource
:
/
/
/
modules
/
taskbartabs
/
TaskbarTabs
.
sys
.
mjs
"
)
;
await
TaskbarTabs
.
waitUntilReady
(
)
;
equal
(
value
(
)
0
"
No
taskbar
tabs
exist
yet
"
)
;
const
tt1
=
await
createTaskbarTab
(
TaskbarTabs
Services
.
io
.
newURI
(
"
https
:
/
/
example
.
com
"
)
0
)
;
equal
(
value
(
)
1
"
First
new
taskbar
tab
was
accounted
for
"
)
;
const
tt2
=
await
createTaskbarTab
(
TaskbarTabs
Services
.
io
.
newURI
(
"
https
:
/
/
example
.
edu
"
)
0
)
;
equal
(
value
(
)
2
"
Second
new
taskbar
tab
was
accounted
for
"
)
;
await
TaskbarTabs
.
removeTaskbarTab
(
tt1
.
id
)
;
equal
(
value
(
)
1
"
Removing
first
taskbar
tab
was
accounted
for
"
)
;
await
TaskbarTabs
.
removeTaskbarTab
(
tt2
.
id
)
;
equal
(
value
(
)
0
"
Removing
second
taskbar
tab
was
accounted
for
"
)
;
}
)
;
