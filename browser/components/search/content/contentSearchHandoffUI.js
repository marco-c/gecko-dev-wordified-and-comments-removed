"
use
strict
"
;
class
ContentSearchHandoffUIController
{
constructor
(
)
{
this
.
_isPrivateEngine
=
false
;
this
.
_engineIcon
=
null
;
window
.
addEventListener
(
"
ContentSearchService
"
this
)
;
this
.
_sendMsg
(
"
GetEngine
"
)
;
this
.
_sendMsg
(
"
GetHandoffSearchModePrefs
"
)
;
}
handleEvent
(
event
)
{
let
methodName
=
"
_onMsg
"
+
event
.
detail
.
type
;
if
(
methodName
in
this
)
{
this
[
methodName
]
(
event
.
detail
.
data
)
;
}
}
get
defaultEngine
(
)
{
return
this
.
_defaultEngine
;
}
static
privateBrowsingRegex
=
/
^
about
:
privatebrowsing
(
[
#
?
]
|
)
/
i
;
get
_isAboutPrivateBrowsing
(
)
{
return
ContentSearchHandoffUIController
.
privateBrowsingRegex
.
test
(
document
.
location
.
href
)
;
}
_onMsgEngine
(
{
isPrivateEngine
engine
}
)
{
this
.
_isPrivateEngine
=
isPrivateEngine
;
this
.
_updateEngine
(
engine
)
;
}
_onMsgCurrentEngine
(
engine
)
{
if
(
!
this
.
_isPrivateEngine
)
{
this
.
_updateEngine
(
engine
)
;
}
}
_onMsgCurrentPrivateEngine
(
engine
)
{
if
(
this
.
_isPrivateEngine
)
{
this
.
_updateEngine
(
engine
)
;
}
}
_onMsgHandoffSearchModePrefs
(
pref
)
{
this
.
_shouldHandOffToSearchMode
=
pref
;
this
.
_updatel10nIds
(
)
;
}
_updateEngine
(
engine
)
{
this
.
_defaultEngine
=
engine
;
if
(
this
.
_engineIcon
)
{
URL
.
revokeObjectURL
(
this
.
_engineIcon
)
;
}
if
(
!
engine
.
isAppProvided
)
{
this
.
_engineIcon
=
"
chrome
:
/
/
global
/
skin
/
icons
/
search
-
glass
.
svg
"
;
}
else
if
(
engine
.
iconData
)
{
this
.
_engineIcon
=
this
.
_getFaviconURIFromIconData
(
engine
.
iconData
)
;
}
else
{
this
.
_engineIcon
=
"
chrome
:
/
/
global
/
skin
/
icons
/
defaultFavicon
.
svg
"
;
}
document
.
body
.
style
.
setProperty
(
"
-
-
newtab
-
search
-
icon
"
"
url
(
"
+
this
.
_engineIcon
+
"
)
"
)
;
this
.
_updatel10nIds
(
)
;
}
_updatel10nIds
(
)
{
let
engine
=
this
.
_defaultEngine
;
let
fakeButton
=
document
.
querySelector
(
"
.
search
-
handoff
-
button
"
)
;
let
fakeInput
=
document
.
querySelector
(
"
.
fake
-
textbox
"
)
;
if
(
!
fakeButton
|
|
!
fakeInput
)
{
return
;
}
if
(
!
engine
|
|
this
.
_shouldHandOffToSearchMode
)
{
document
.
l10n
.
setAttributes
(
fakeButton
this
.
_isAboutPrivateBrowsing
?
"
about
-
private
-
browsing
-
search
-
btn
"
:
"
newtab
-
search
-
box
-
input
"
)
;
document
.
l10n
.
setAttributes
(
fakeInput
this
.
_isAboutPrivateBrowsing
?
"
about
-
private
-
browsing
-
search
-
placeholder
"
:
"
newtab
-
search
-
box
-
text
"
)
;
}
else
if
(
!
engine
.
isAppProvided
)
{
document
.
l10n
.
setAttributes
(
fakeButton
this
.
_isAboutPrivateBrowsing
?
"
about
-
private
-
browsing
-
handoff
-
no
-
engine
"
:
"
newtab
-
search
-
box
-
handoff
-
input
-
no
-
engine
"
)
;
document
.
l10n
.
setAttributes
(
fakeInput
this
.
_isAboutPrivateBrowsing
?
"
about
-
private
-
browsing
-
handoff
-
text
-
no
-
engine
"
:
"
newtab
-
search
-
box
-
handoff
-
text
-
no
-
engine
"
)
;
}
else
{
document
.
l10n
.
setAttributes
(
fakeButton
this
.
_isAboutPrivateBrowsing
?
"
about
-
private
-
browsing
-
handoff
"
:
"
newtab
-
search
-
box
-
handoff
-
input
"
{
engine
:
engine
.
name
}
)
;
document
.
l10n
.
setAttributes
(
fakeInput
this
.
_isAboutPrivateBrowsing
?
"
about
-
private
-
browsing
-
handoff
-
text
"
:
"
newtab
-
search
-
box
-
handoff
-
text
"
{
engine
:
engine
.
name
}
)
;
}
}
_getFaviconURIFromIconData
(
data
)
{
if
(
typeof
data
=
=
"
string
"
)
{
return
data
;
}
let
blob
=
new
Blob
(
[
data
.
icon
]
{
type
:
data
.
mimeType
}
)
;
return
URL
.
createObjectURL
(
blob
)
;
}
_sendMsg
(
type
data
=
null
)
{
dispatchEvent
(
new
CustomEvent
(
"
ContentSearchClient
"
{
detail
:
{
type
data
}
}
)
)
;
}
}
window
.
ContentSearchHandoffUIController
=
ContentSearchHandoffUIController
;
