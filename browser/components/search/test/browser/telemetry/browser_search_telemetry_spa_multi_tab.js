"
use
strict
"
;
if
(
AppConstants
.
platform
=
=
"
macosx
"
)
{
requestLongerTimeout
(
3
)
;
}
add_setup
(
async
function
(
)
{
await
initSinglePageAppTest
(
)
;
await
SpecialPowers
.
pushPrefEnv
(
{
set
:
[
[
"
dom
.
ipc
.
processCount
.
webIsolated
"
1
]
]
}
)
;
registerCleanupFunction
(
async
(
)
=
>
{
SearchSERPTelemetry
.
overrideSearchTelemetryForTests
(
)
;
resetTelemetry
(
)
;
}
)
;
}
)
;
add_task
(
async
function
test_load_serps_and_click_related_searches
(
)
{
resetTelemetry
(
)
;
let
tab1
=
await
SinglePageAppUtils
.
createTabAndLoadURL
(
)
;
let
tab2
=
await
SinglePageAppUtils
.
createTabAndLoadURL
(
)
;
let
tab3
=
await
SinglePageAppUtils
.
createTabAndLoadURL
(
)
;
await
BrowserTestUtils
.
switchTab
(
gBrowser
tab1
)
;
await
SinglePageAppUtils
.
visitRelatedSearchWithoutAds
(
tab1
)
;
await
BrowserTestUtils
.
switchTab
(
gBrowser
tab2
)
;
await
SinglePageAppUtils
.
visitRelatedSearch
(
tab2
)
;
await
BrowserTestUtils
.
switchTab
(
gBrowser
tab3
)
;
await
SinglePageAppUtils
.
visitRelatedSearchWithoutAds
(
tab3
)
;
await
BrowserTestUtils
.
switchTab
(
gBrowser
tab1
)
;
await
SinglePageAppUtils
.
visitRelatedSearch
(
tab1
)
;
await
BrowserTestUtils
.
switchTab
(
gBrowser
tab2
)
;
await
SinglePageAppUtils
.
visitRelatedSearchWithoutAds
(
tab2
)
;
await
BrowserTestUtils
.
switchTab
(
gBrowser
tab3
)
;
await
SinglePageAppUtils
.
visitRelatedSearchWithoutAds
(
tab3
)
;
await
assertSearchSourcesTelemetry
(
{
}
{
"
browser
.
search
.
content
.
unknown
"
:
{
"
example1
:
tagged
:
ff
"
:
9
}
"
browser
.
search
.
withads
.
unknown
"
:
{
"
example1
:
tagged
"
:
5
}
}
)
;
assertSERPTelemetry
(
[
{
impression
:
{
provider
:
"
example1
"
tagged
:
"
true
"
partner_code
:
"
ff
"
source
:
"
unknown
"
is_shopping_page
:
"
false
"
is_private
:
"
false
"
shopping_tab_displayed
:
"
false
"
is_signed_in
:
"
false
"
}
engagements
:
[
{
action
:
SearchSERPTelemetryUtils
.
ACTIONS
.
CLICKED
target
:
SearchSERPTelemetryUtils
.
COMPONENTS
.
NON_ADS_LINK
}
]
adImpressions
:
[
{
component
:
SearchSERPTelemetryUtils
.
COMPONENTS
.
AD_LINK
ads_loaded
:
"
2
"
ads_visible
:
"
2
"
ads_hidden
:
"
0
"
}
]
}
{
impression
:
{
provider
:
"
example1
"
tagged
:
"
true
"
partner_code
:
"
ff
"
source
:
"
unknown
"
is_shopping_page
:
"
false
"
is_private
:
"
false
"
shopping_tab_displayed
:
"
false
"
is_signed_in
:
"
false
"
}
engagements
:
[
{
action
:
SearchSERPTelemetryUtils
.
ACTIONS
.
CLICKED
target
:
SearchSERPTelemetryUtils
.
COMPONENTS
.
NON_ADS_LINK
}
]
adImpressions
:
[
{
component
:
SearchSERPTelemetryUtils
.
COMPONENTS
.
AD_LINK
ads_loaded
:
"
2
"
ads_visible
:
"
2
"
ads_hidden
:
"
0
"
}
]
}
{
impression
:
{
provider
:
"
example1
"
tagged
:
"
true
"
partner_code
:
"
ff
"
source
:
"
unknown
"
is_shopping_page
:
"
false
"
is_private
:
"
false
"
shopping_tab_displayed
:
"
false
"
is_signed_in
:
"
false
"
}
engagements
:
[
{
action
:
SearchSERPTelemetryUtils
.
ACTIONS
.
CLICKED
target
:
SearchSERPTelemetryUtils
.
COMPONENTS
.
NON_ADS_LINK
}
]
adImpressions
:
[
{
component
:
SearchSERPTelemetryUtils
.
COMPONENTS
.
AD_LINK
ads_loaded
:
"
2
"
ads_visible
:
"
2
"
ads_hidden
:
"
0
"
}
]
}
{
impression
:
{
provider
:
"
example1
"
tagged
:
"
true
"
partner_code
:
"
ff
"
source
:
"
unknown
"
is_shopping_page
:
"
false
"
is_private
:
"
false
"
shopping_tab_displayed
:
"
false
"
is_signed_in
:
"
false
"
}
engagements
:
[
{
action
:
SearchSERPTelemetryUtils
.
ACTIONS
.
CLICKED
target
:
SearchSERPTelemetryUtils
.
COMPONENTS
.
NON_ADS_LINK
}
]
adImpressions
:
[
]
}
{
impression
:
{
provider
:
"
example1
"
tagged
:
"
true
"
partner_code
:
"
ff
"
source
:
"
unknown
"
is_shopping_page
:
"
false
"
is_private
:
"
false
"
shopping_tab_displayed
:
"
false
"
is_signed_in
:
"
false
"
}
engagements
:
[
{
action
:
SearchSERPTelemetryUtils
.
ACTIONS
.
CLICKED
target
:
SearchSERPTelemetryUtils
.
COMPONENTS
.
NON_ADS_LINK
}
]
adImpressions
:
[
{
component
:
SearchSERPTelemetryUtils
.
COMPONENTS
.
AD_LINK
ads_loaded
:
"
2
"
ads_visible
:
"
2
"
ads_hidden
:
"
0
"
}
]
}
{
impression
:
{
provider
:
"
example1
"
tagged
:
"
true
"
partner_code
:
"
ff
"
source
:
"
unknown
"
is_shopping_page
:
"
false
"
is_private
:
"
false
"
shopping_tab_displayed
:
"
false
"
is_signed_in
:
"
false
"
}
engagements
:
[
{
action
:
SearchSERPTelemetryUtils
.
ACTIONS
.
CLICKED
target
:
SearchSERPTelemetryUtils
.
COMPONENTS
.
NON_ADS_LINK
}
]
adImpressions
:
[
]
}
{
impression
:
{
provider
:
"
example1
"
tagged
:
"
true
"
partner_code
:
"
ff
"
source
:
"
unknown
"
is_shopping_page
:
"
false
"
is_private
:
"
false
"
shopping_tab_displayed
:
"
false
"
is_signed_in
:
"
false
"
}
adImpressions
:
[
{
component
:
SearchSERPTelemetryUtils
.
COMPONENTS
.
AD_LINK
ads_loaded
:
"
2
"
ads_visible
:
"
2
"
ads_hidden
:
"
0
"
}
]
}
{
impression
:
{
provider
:
"
example1
"
tagged
:
"
true
"
partner_code
:
"
ff
"
source
:
"
unknown
"
is_shopping_page
:
"
false
"
is_private
:
"
false
"
shopping_tab_displayed
:
"
false
"
is_signed_in
:
"
false
"
}
adImpressions
:
[
]
}
{
impression
:
{
provider
:
"
example1
"
tagged
:
"
true
"
partner_code
:
"
ff
"
source
:
"
unknown
"
is_shopping_page
:
"
false
"
is_private
:
"
false
"
shopping_tab_displayed
:
"
false
"
is_signed_in
:
"
false
"
}
adImpressions
:
[
]
}
]
)
;
await
BrowserTestUtils
.
removeTab
(
tab1
)
;
await
BrowserTestUtils
.
removeTab
(
tab2
)
;
await
BrowserTestUtils
.
removeTab
(
tab3
)
;
}
)
;
add_task
(
async
function
test_different_sources_click_ad
(
)
{
resetTelemetry
(
)
;
let
tab1
=
await
SinglePageAppUtils
.
createTabAndLoadURL
(
)
;
let
tab2
=
await
SinglePageAppUtils
.
createTabAndLoadURL
(
)
;
await
SinglePageAppUtils
.
visitRelatedSearch
(
tab2
)
;
await
SinglePageAppUtils
.
goBack
(
tab2
)
;
await
SinglePageAppUtils
.
clickAd
(
tab2
)
;
await
assertSearchSourcesTelemetry
(
{
}
{
"
browser
.
search
.
content
.
unknown
"
:
{
"
example1
:
tagged
:
ff
"
:
3
}
"
browser
.
search
.
withads
.
unknown
"
:
{
"
example1
:
tagged
"
:
3
}
"
browser
.
search
.
content
.
tabhistory
"
:
{
"
example1
:
tagged
:
ff
"
:
1
}
"
browser
.
search
.
withads
.
tabhistory
"
:
{
"
example1
:
tagged
"
:
1
}
"
browser
.
search
.
adclicks
.
tabhistory
"
:
{
"
example1
:
tagged
"
:
1
}
}
)
;
assertSERPTelemetry
(
[
{
impression
:
{
provider
:
"
example1
"
tagged
:
"
true
"
partner_code
:
"
ff
"
source
:
"
unknown
"
is_shopping_page
:
"
false
"
is_private
:
"
false
"
shopping_tab_displayed
:
"
false
"
is_signed_in
:
"
false
"
}
adImpressions
:
[
{
component
:
SearchSERPTelemetryUtils
.
COMPONENTS
.
AD_LINK
ads_loaded
:
"
2
"
ads_visible
:
"
2
"
ads_hidden
:
"
0
"
}
]
}
{
impression
:
{
provider
:
"
example1
"
tagged
:
"
true
"
partner_code
:
"
ff
"
source
:
"
unknown
"
is_shopping_page
:
"
false
"
is_private
:
"
false
"
shopping_tab_displayed
:
"
false
"
is_signed_in
:
"
false
"
}
engagements
:
[
{
action
:
SearchSERPTelemetryUtils
.
ACTIONS
.
CLICKED
target
:
SearchSERPTelemetryUtils
.
COMPONENTS
.
NON_ADS_LINK
}
]
adImpressions
:
[
{
component
:
SearchSERPTelemetryUtils
.
COMPONENTS
.
AD_LINK
ads_loaded
:
"
2
"
ads_visible
:
"
2
"
ads_hidden
:
"
0
"
}
]
}
{
impression
:
{
provider
:
"
example1
"
tagged
:
"
true
"
partner_code
:
"
ff
"
source
:
"
unknown
"
is_shopping_page
:
"
false
"
is_private
:
"
false
"
shopping_tab_displayed
:
"
false
"
is_signed_in
:
"
false
"
}
adImpressions
:
[
{
component
:
SearchSERPTelemetryUtils
.
COMPONENTS
.
AD_LINK
ads_loaded
:
"
2
"
ads_visible
:
"
2
"
ads_hidden
:
"
0
"
}
]
abandonment
:
{
reason
:
SearchSERPTelemetryUtils
.
ABANDONMENTS
.
NAVIGATION
}
}
{
impression
:
{
provider
:
"
example1
"
tagged
:
"
true
"
partner_code
:
"
ff
"
source
:
"
tabhistory
"
is_shopping_page
:
"
false
"
is_private
:
"
false
"
shopping_tab_displayed
:
"
false
"
is_signed_in
:
"
false
"
}
adImpressions
:
[
{
component
:
SearchSERPTelemetryUtils
.
COMPONENTS
.
AD_LINK
ads_loaded
:
"
2
"
ads_visible
:
"
2
"
ads_hidden
:
"
0
"
}
]
engagements
:
[
{
action
:
SearchSERPTelemetryUtils
.
ACTIONS
.
CLICKED
target
:
SearchSERPTelemetryUtils
.
COMPONENTS
.
AD_LINK
}
]
}
]
)
;
await
BrowserTestUtils
.
removeTab
(
tab1
)
;
await
BrowserTestUtils
.
removeTab
(
tab2
)
;
}
)
;
add_task
(
async
function
test_different_sources_click_redirect_ad_in_new_tab
(
)
{
resetTelemetry
(
)
;
let
tab1
=
await
SinglePageAppUtils
.
createTabAndLoadURL
(
)
;
let
tab2
=
await
SinglePageAppUtils
.
createTabAndLoadURL
(
)
;
await
SinglePageAppUtils
.
visitRelatedSearch
(
tab2
)
;
await
SinglePageAppUtils
.
goBack
(
tab2
)
;
let
tab3
=
await
SinglePageAppUtils
.
clickRedirectAdInNewTab
(
tab2
)
;
await
assertSearchSourcesTelemetry
(
{
}
{
"
browser
.
search
.
content
.
unknown
"
:
{
"
example1
:
tagged
:
ff
"
:
3
}
"
browser
.
search
.
withads
.
unknown
"
:
{
"
example1
:
tagged
"
:
3
}
"
browser
.
search
.
content
.
tabhistory
"
:
{
"
example1
:
tagged
:
ff
"
:
1
}
"
browser
.
search
.
withads
.
tabhistory
"
:
{
"
example1
:
tagged
"
:
1
}
"
browser
.
search
.
adclicks
.
tabhistory
"
:
{
"
example1
:
tagged
"
:
1
}
}
)
;
assertSERPTelemetry
(
[
{
impression
:
{
provider
:
"
example1
"
tagged
:
"
true
"
partner_code
:
"
ff
"
source
:
"
unknown
"
is_shopping_page
:
"
false
"
is_private
:
"
false
"
shopping_tab_displayed
:
"
false
"
is_signed_in
:
"
false
"
}
adImpressions
:
[
{
component
:
SearchSERPTelemetryUtils
.
COMPONENTS
.
AD_LINK
ads_loaded
:
"
2
"
ads_visible
:
"
2
"
ads_hidden
:
"
0
"
}
]
}
{
impression
:
{
provider
:
"
example1
"
tagged
:
"
true
"
partner_code
:
"
ff
"
source
:
"
unknown
"
is_shopping_page
:
"
false
"
is_private
:
"
false
"
shopping_tab_displayed
:
"
false
"
is_signed_in
:
"
false
"
}
engagements
:
[
{
action
:
SearchSERPTelemetryUtils
.
ACTIONS
.
CLICKED
target
:
SearchSERPTelemetryUtils
.
COMPONENTS
.
NON_ADS_LINK
}
]
adImpressions
:
[
{
component
:
SearchSERPTelemetryUtils
.
COMPONENTS
.
AD_LINK
ads_loaded
:
"
2
"
ads_visible
:
"
2
"
ads_hidden
:
"
0
"
}
]
}
{
impression
:
{
provider
:
"
example1
"
tagged
:
"
true
"
partner_code
:
"
ff
"
source
:
"
unknown
"
is_shopping_page
:
"
false
"
is_private
:
"
false
"
shopping_tab_displayed
:
"
false
"
is_signed_in
:
"
false
"
}
adImpressions
:
[
{
component
:
SearchSERPTelemetryUtils
.
COMPONENTS
.
AD_LINK
ads_loaded
:
"
2
"
ads_visible
:
"
2
"
ads_hidden
:
"
0
"
}
]
abandonment
:
{
reason
:
SearchSERPTelemetryUtils
.
ABANDONMENTS
.
NAVIGATION
}
}
{
impression
:
{
provider
:
"
example1
"
tagged
:
"
true
"
partner_code
:
"
ff
"
source
:
"
tabhistory
"
is_shopping_page
:
"
false
"
is_private
:
"
false
"
shopping_tab_displayed
:
"
false
"
is_signed_in
:
"
false
"
}
adImpressions
:
[
{
component
:
SearchSERPTelemetryUtils
.
COMPONENTS
.
AD_LINK
ads_loaded
:
"
2
"
ads_visible
:
"
2
"
ads_hidden
:
"
0
"
}
]
engagements
:
[
{
action
:
SearchSERPTelemetryUtils
.
ACTIONS
.
CLICKED
target
:
SearchSERPTelemetryUtils
.
COMPONENTS
.
AD_LINK
}
]
}
]
)
;
await
BrowserTestUtils
.
removeTab
(
tab1
)
;
await
BrowserTestUtils
.
removeTab
(
tab2
)
;
await
BrowserTestUtils
.
removeTab
(
tab3
)
;
}
)
;
add_task
(
async
function
test_update_query_params_after_search
(
)
{
resetTelemetry
(
)
;
let
tab1
=
await
SinglePageAppUtils
.
createTabAndLoadURL
(
)
;
info
(
"
Visit
a
related
search
so
that
the
URL
has
an
extra
query
parameter
.
"
)
;
await
SinglePageAppUtils
.
visitRelatedSearch
(
tab1
)
;
let
tab2
=
await
SinglePageAppUtils
.
createTabAndLoadURL
(
)
;
await
assertSearchSourcesTelemetry
(
{
}
{
"
browser
.
search
.
content
.
unknown
"
:
{
"
example1
:
tagged
:
ff
"
:
3
}
"
browser
.
search
.
withads
.
unknown
"
:
{
"
example1
:
tagged
"
:
3
}
}
)
;
assertSERPTelemetry
(
[
{
impression
:
{
provider
:
"
example1
"
tagged
:
"
true
"
partner_code
:
"
ff
"
source
:
"
unknown
"
is_shopping_page
:
"
false
"
is_private
:
"
false
"
shopping_tab_displayed
:
"
false
"
is_signed_in
:
"
false
"
}
engagements
:
[
{
action
:
SearchSERPTelemetryUtils
.
ACTIONS
.
CLICKED
target
:
SearchSERPTelemetryUtils
.
COMPONENTS
.
NON_ADS_LINK
}
]
adImpressions
:
[
{
component
:
SearchSERPTelemetryUtils
.
COMPONENTS
.
AD_LINK
ads_loaded
:
"
2
"
ads_visible
:
"
2
"
ads_hidden
:
"
0
"
}
]
}
{
impression
:
{
provider
:
"
example1
"
tagged
:
"
true
"
partner_code
:
"
ff
"
source
:
"
unknown
"
is_shopping_page
:
"
false
"
is_private
:
"
false
"
shopping_tab_displayed
:
"
false
"
is_signed_in
:
"
false
"
}
adImpressions
:
[
{
component
:
SearchSERPTelemetryUtils
.
COMPONENTS
.
AD_LINK
ads_loaded
:
"
2
"
ads_visible
:
"
2
"
ads_hidden
:
"
0
"
}
]
}
{
impression
:
{
provider
:
"
example1
"
tagged
:
"
true
"
partner_code
:
"
ff
"
source
:
"
unknown
"
is_shopping_page
:
"
false
"
is_private
:
"
false
"
shopping_tab_displayed
:
"
false
"
is_signed_in
:
"
false
"
}
adImpressions
:
[
{
component
:
SearchSERPTelemetryUtils
.
COMPONENTS
.
AD_LINK
ads_loaded
:
"
2
"
ads_visible
:
"
2
"
ads_hidden
:
"
0
"
}
]
}
]
)
;
await
BrowserTestUtils
.
removeTab
(
tab1
)
;
await
BrowserTestUtils
.
removeTab
(
tab2
)
;
}
)
;
add_task
(
async
function
test_update_query_params
(
)
{
resetTelemetry
(
)
;
let
tab1
=
await
SinglePageAppUtils
.
createTabAndSearch
(
"
foo
bar
"
)
;
info
(
"
Visit
a
related
search
so
that
the
URL
has
an
extra
query
parameter
.
"
)
;
await
SinglePageAppUtils
.
visitRelatedSearch
(
tab1
)
;
let
tab2
=
await
SinglePageAppUtils
.
createTabAndLoadURL
(
)
;
let
newWindow
=
await
SinglePageAppUtils
.
clickRedirectAdInNewWindow
(
tab2
)
;
await
assertSearchSourcesTelemetry
(
{
}
{
"
browser
.
search
.
content
.
unknown
"
:
{
"
example1
:
tagged
:
ff
"
:
3
}
"
browser
.
search
.
withads
.
unknown
"
:
{
"
example1
:
tagged
"
:
3
}
"
browser
.
search
.
adclicks
.
unknown
"
:
{
"
example1
:
tagged
"
:
1
}
}
)
;
assertSERPTelemetry
(
[
{
impression
:
{
provider
:
"
example1
"
tagged
:
"
true
"
partner_code
:
"
ff
"
source
:
"
unknown
"
is_shopping_page
:
"
false
"
is_private
:
"
false
"
shopping_tab_displayed
:
"
false
"
is_signed_in
:
"
false
"
}
engagements
:
[
{
action
:
SearchSERPTelemetryUtils
.
ACTIONS
.
CLICKED
target
:
SearchSERPTelemetryUtils
.
COMPONENTS
.
NON_ADS_LINK
}
]
adImpressions
:
[
{
component
:
SearchSERPTelemetryUtils
.
COMPONENTS
.
AD_LINK
ads_loaded
:
"
2
"
ads_visible
:
"
2
"
ads_hidden
:
"
0
"
}
]
}
{
impression
:
{
provider
:
"
example1
"
tagged
:
"
true
"
partner_code
:
"
ff
"
source
:
"
unknown
"
is_shopping_page
:
"
false
"
is_private
:
"
false
"
shopping_tab_displayed
:
"
false
"
is_signed_in
:
"
false
"
}
adImpressions
:
[
{
component
:
SearchSERPTelemetryUtils
.
COMPONENTS
.
AD_LINK
ads_loaded
:
"
2
"
ads_visible
:
"
2
"
ads_hidden
:
"
0
"
}
]
}
{
impression
:
{
provider
:
"
example1
"
tagged
:
"
true
"
partner_code
:
"
ff
"
source
:
"
unknown
"
is_shopping_page
:
"
false
"
is_private
:
"
false
"
shopping_tab_displayed
:
"
false
"
is_signed_in
:
"
false
"
}
engagements
:
[
{
action
:
SearchSERPTelemetryUtils
.
ACTIONS
.
CLICKED
target
:
SearchSERPTelemetryUtils
.
COMPONENTS
.
AD_LINK
}
]
adImpressions
:
[
{
component
:
SearchSERPTelemetryUtils
.
COMPONENTS
.
AD_LINK
ads_loaded
:
"
2
"
ads_visible
:
"
2
"
ads_hidden
:
"
0
"
}
]
}
]
)
;
await
BrowserTestUtils
.
closeWindow
(
newWindow
)
;
await
BrowserTestUtils
.
removeTab
(
tab1
)
;
await
BrowserTestUtils
.
removeTab
(
tab2
)
;
}
)
;
add_task
(
async
function
test_update_query_params_multiple_related
(
)
{
resetTelemetry
(
)
;
let
tab1
=
await
SinglePageAppUtils
.
createTabAndSearch
(
"
foo
bar
"
)
;
info
(
"
Visit
a
related
search
so
that
the
URL
has
an
extra
query
parameter
.
"
)
;
await
SinglePageAppUtils
.
visitRelatedSearch
(
tab1
)
;
let
tab2
=
await
SinglePageAppUtils
.
createTabAndLoadURL
(
)
;
info
(
"
Visit
a
related
search
so
that
the
URL
has
an
extra
query
parameter
.
"
)
;
await
SinglePageAppUtils
.
visitRelatedSearch
(
tab2
)
;
let
newWindow
=
await
SinglePageAppUtils
.
clickRedirectAdInNewWindow
(
tab2
)
;
await
assertSearchSourcesTelemetry
(
{
}
{
"
browser
.
search
.
content
.
unknown
"
:
{
"
example1
:
tagged
:
ff
"
:
4
}
"
browser
.
search
.
withads
.
unknown
"
:
{
"
example1
:
tagged
"
:
4
}
"
browser
.
search
.
adclicks
.
unknown
"
:
{
"
example1
:
tagged
"
:
1
}
}
)
;
assertSERPTelemetry
(
[
{
impression
:
{
provider
:
"
example1
"
tagged
:
"
true
"
partner_code
:
"
ff
"
source
:
"
unknown
"
is_shopping_page
:
"
false
"
is_private
:
"
false
"
shopping_tab_displayed
:
"
false
"
is_signed_in
:
"
false
"
}
engagements
:
[
{
action
:
SearchSERPTelemetryUtils
.
ACTIONS
.
CLICKED
target
:
SearchSERPTelemetryUtils
.
COMPONENTS
.
NON_ADS_LINK
}
]
adImpressions
:
[
{
component
:
SearchSERPTelemetryUtils
.
COMPONENTS
.
AD_LINK
ads_loaded
:
"
2
"
ads_visible
:
"
2
"
ads_hidden
:
"
0
"
}
]
}
{
impression
:
{
provider
:
"
example1
"
tagged
:
"
true
"
partner_code
:
"
ff
"
source
:
"
unknown
"
is_shopping_page
:
"
false
"
is_private
:
"
false
"
shopping_tab_displayed
:
"
false
"
is_signed_in
:
"
false
"
}
adImpressions
:
[
{
component
:
SearchSERPTelemetryUtils
.
COMPONENTS
.
AD_LINK
ads_loaded
:
"
2
"
ads_visible
:
"
2
"
ads_hidden
:
"
0
"
}
]
}
{
impression
:
{
provider
:
"
example1
"
tagged
:
"
true
"
partner_code
:
"
ff
"
source
:
"
unknown
"
is_shopping_page
:
"
false
"
is_private
:
"
false
"
shopping_tab_displayed
:
"
false
"
is_signed_in
:
"
false
"
}
engagements
:
[
{
action
:
SearchSERPTelemetryUtils
.
ACTIONS
.
CLICKED
target
:
SearchSERPTelemetryUtils
.
COMPONENTS
.
NON_ADS_LINK
}
]
adImpressions
:
[
{
component
:
SearchSERPTelemetryUtils
.
COMPONENTS
.
AD_LINK
ads_loaded
:
"
2
"
ads_visible
:
"
2
"
ads_hidden
:
"
0
"
}
]
}
{
impression
:
{
provider
:
"
example1
"
tagged
:
"
true
"
partner_code
:
"
ff
"
source
:
"
unknown
"
is_shopping_page
:
"
false
"
is_private
:
"
false
"
shopping_tab_displayed
:
"
false
"
is_signed_in
:
"
false
"
}
engagements
:
[
{
action
:
SearchSERPTelemetryUtils
.
ACTIONS
.
CLICKED
target
:
SearchSERPTelemetryUtils
.
COMPONENTS
.
AD_LINK
}
]
adImpressions
:
[
{
component
:
SearchSERPTelemetryUtils
.
COMPONENTS
.
AD_LINK
ads_loaded
:
"
2
"
ads_visible
:
"
2
"
ads_hidden
:
"
0
"
}
]
}
]
)
;
await
BrowserTestUtils
.
closeWindow
(
newWindow
)
;
await
BrowserTestUtils
.
removeTab
(
tab1
)
;
await
BrowserTestUtils
.
removeTab
(
tab2
)
;
}
)
;
