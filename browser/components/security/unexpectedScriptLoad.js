var
UnexpectedScriptLoadPanel
=
new
(
class
{
#
console
;
get
console
(
)
{
if
(
!
this
.
#
console
)
{
this
.
#
console
=
console
.
createInstance
(
{
maxLogLevelPref
:
"
browser
.
unexpectedScriptLoad
.
logLevel
"
prefix
:
"
UnexpectedScriptLoad
"
}
)
;
}
return
this
.
#
console
;
}
#
lazyElements
;
get
elements
(
)
{
if
(
!
this
.
#
lazyElements
)
{
this
.
#
lazyElements
=
{
dialogCloseButton
:
document
.
querySelector
(
"
.
dialogClose
"
)
reportCheckbox
:
document
.
querySelector
(
"
#
reportCheckbox
"
)
emailCheckbox
:
document
.
querySelector
(
"
#
emailCheckbox
"
)
emailInput
:
document
.
querySelector
(
"
#
emailInput
"
)
moreInfoLink
:
document
.
querySelector
(
"
#
more
-
info
-
link
"
)
}
;
}
return
this
.
#
lazyElements
;
}
init
(
)
{
this
.
console
?
.
warn
(
"
UnexpectedScriptLoadPanel
initialized
"
)
;
this
.
setupEventHandlers
(
)
;
}
setupEventHandlers
(
)
{
this
.
elements
.
dialogCloseButton
.
addEventListener
(
"
click
"
(
)
=
>
{
this
.
close
(
)
;
}
)
;
this
.
elements
.
moreInfoLink
.
addEventListener
(
"
click
"
(
)
=
>
{
this
.
onLearnMoreLink
(
)
;
}
)
;
this
.
elements
.
emailInput
.
addEventListener
(
"
change
"
e
=
>
{
const
hasEmail
=
this
.
elements
.
emailInput
.
value
.
trim
(
)
!
=
=
"
"
;
if
(
!
hasEmail
)
return
;
setTimeout
(
(
)
=
>
{
this
.
console
?
.
warn
(
Rechecking
checkboxes
)
;
if
(
this
.
elements
.
emailInput
.
value
.
trim
(
)
)
{
this
.
elements
.
emailCheckbox
.
checked
=
true
;
this
.
elements
.
reportCheckbox
.
checked
=
true
;
}
}
0
)
;
e
.
stopPropagation
(
)
;
}
)
;
this
.
elements
.
emailCheckbox
.
addEventListener
(
"
change
"
(
)
=
>
{
if
(
!
this
.
elements
.
emailCheckbox
.
checked
)
{
this
.
elements
.
emailInput
.
value
=
"
"
;
}
}
)
;
this
.
elements
.
reportCheckbox
.
addEventListener
(
"
change
"
(
)
=
>
{
if
(
!
this
.
elements
.
reportCheckbox
.
checked
)
{
this
.
elements
.
emailCheckbox
.
checked
=
false
;
this
.
elements
.
emailInput
.
value
=
"
"
;
}
}
)
;
}
close
(
)
{
this
.
console
?
.
warn
(
"
UnexpectedScriptLoadPanel
is
closing
"
)
;
window
.
close
(
)
;
}
onLearnMoreLink
(
)
{
this
.
close
(
)
;
window
.
top
.
document
.
documentElement
.
removeAttribute
(
"
window
-
modal
-
open
"
)
;
window
.
browsingContext
.
top
.
window
.
openTrustedLinkIn
(
"
https
:
/
/
support
.
mozilla
.
org
/
kb
/
unexpected
-
script
-
load
"
"
tab
"
)
;
}
}
)
(
)
;
UnexpectedScriptLoadPanel
.
init
(
)
;
