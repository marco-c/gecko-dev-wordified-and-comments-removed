var
EventUtils
=
{
}
;
this
.
_scriptLoader
=
Cc
[
"
mozilla
.
org
/
moz
/
jssubscript
-
loader
;
1
"
]
.
getService
(
Ci
.
mozIJSSubScriptLoader
)
;
this
.
_scriptLoader
.
loadSubScript
(
"
chrome
:
/
/
mochikit
/
content
/
tests
/
SimpleTest
/
EventUtils
.
js
"
EventUtils
)
;
add_task
(
async
function
test
(
)
{
let
toolbar
=
document
.
getElementById
(
"
PersonalToolbar
"
)
;
ok
(
toolbar
"
PersonalToolbar
should
not
be
null
"
)
;
if
(
toolbar
.
collapsed
)
{
await
promiseSetToolbarVisibility
(
toolbar
true
)
;
registerCleanupFunction
(
function
(
)
{
return
promiseSetToolbarVisibility
(
toolbar
false
)
;
}
)
;
}
let
placesItems
=
document
.
getElementById
(
"
PlacesToolbarItems
"
)
;
ok
(
placesItems
"
PlacesToolbarItems
should
not
be
null
"
)
;
ok
(
placesItems
.
localName
=
=
"
scrollbox
"
"
PlacesToolbarItems
should
not
be
null
"
)
;
ok
(
placesItems
.
childNodes
[
0
]
"
PlacesToolbarItems
must
have
at
least
one
child
"
)
;
let
simulateDragDrop
=
function
(
aEffect
aMimeType
)
{
const
uriSpec
=
"
http
:
/
/
www
.
mozilla
.
org
/
D1995729
-
A152
-
4e30
-
8329
-
469B01F30AA7
"
;
let
uri
=
makeURI
(
uriSpec
)
;
EventUtils
.
synthesizeDrop
(
placesItems
.
childNodes
[
0
]
placesItems
[
[
{
type
:
aMimeType
data
:
uriSpec
}
]
]
aEffect
window
)
;
let
bookmarkIds
=
PlacesUtils
.
bookmarks
.
getBookmarkIdsForURI
(
uri
)
;
ok
(
bookmarkIds
.
length
=
=
1
"
There
should
be
exactly
one
bookmark
"
)
;
PlacesUtils
.
bookmarks
.
removeItem
(
bookmarkIds
[
0
]
)
;
ok
(
!
PlacesUtils
.
bookmarks
.
isBookmarked
(
uri
)
"
URI
should
be
removed
"
)
;
}
;
let
simulateDragDropMultiple
=
function
(
aEffect
aMimeType
)
{
const
uriSpecs
=
[
"
http
:
/
/
www
.
mozilla
.
org
/
C54263C6
-
A484
-
46CF
-
8E2B
-
FE131586348A
"
"
http
:
/
/
www
.
mozilla
.
org
/
71381257
-
61E6
-
4376
-
AF7C
-
BF3C5FD8870D
"
"
http
:
/
/
www
.
mozilla
.
org
/
091A88BD
-
5743
-
4C16
-
A005
-
3D2EA3A3B71E
"
]
;
let
uris
=
uriSpecs
.
map
(
spec
=
>
makeURI
(
spec
)
)
;
let
data
;
if
(
aMimeType
=
=
"
text
/
x
-
moz
-
url
"
)
data
=
uriSpecs
.
map
(
spec
=
>
spec
+
"
\
n
"
+
spec
)
.
join
(
"
\
n
"
)
;
else
data
=
uriSpecs
.
join
(
"
\
n
"
)
;
EventUtils
.
synthesizeDrop
(
placesItems
.
childNodes
[
0
]
placesItems
[
[
{
type
:
aMimeType
data
}
]
]
aEffect
window
)
;
for
(
let
uri
of
uris
)
{
let
bookmarkIds
=
PlacesUtils
.
bookmarks
.
getBookmarkIdsForURI
(
uri
)
;
ok
(
bookmarkIds
.
length
=
=
1
"
There
should
be
exactly
one
bookmark
"
)
;
PlacesUtils
.
bookmarks
.
removeItem
(
bookmarkIds
[
0
]
)
;
ok
(
!
PlacesUtils
.
bookmarks
.
isBookmarked
(
uri
)
"
URI
should
be
removed
"
)
;
}
}
;
let
mimeTypes
=
[
"
text
/
plain
"
"
text
/
unicode
"
"
text
/
x
-
moz
-
url
"
]
;
let
effects
=
[
"
move
"
"
copy
"
"
link
"
]
;
effects
.
forEach
(
function
(
effect
)
{
mimeTypes
.
forEach
(
function
(
mimeType
)
{
simulateDragDrop
(
effect
mimeType
)
;
simulateDragDropMultiple
(
effect
mimeType
)
;
}
)
;
}
)
;
}
)
;
