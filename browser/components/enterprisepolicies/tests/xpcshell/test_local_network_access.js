"
use
strict
"
;
add_task
(
async
function
test_local_network_access_enabled
(
)
{
await
setupPolicyEngineWithJson
(
{
policies
:
{
LocalNetworkAccess
:
{
Enabled
:
true
}
}
}
)
;
equal
(
Services
.
prefs
.
getBoolPref
(
"
network
.
lna
.
enabled
"
)
true
"
network
.
lna
.
enabled
should
be
true
when
LocalNetworkAccess
is
enabled
"
)
;
equal
(
Services
.
prefs
.
getBoolPref
(
"
network
.
lna
.
block_trackers
"
)
true
"
network
.
lna
.
block_trackers
should
be
true
when
LocalNetworkAccess
is
enabled
"
)
;
equal
(
Services
.
prefs
.
getBoolPref
(
"
network
.
lna
.
blocking
"
)
true
"
network
.
lna
.
blocking
should
be
true
when
LocalNetworkAccess
is
enabled
"
)
;
equal
(
Services
.
prefs
.
prefIsLocked
(
"
network
.
lna
.
enabled
"
)
false
"
network
.
lna
.
enabled
should
not
be
locked
when
Locked
is
not
specified
"
)
;
equal
(
Services
.
prefs
.
prefIsLocked
(
"
network
.
lna
.
block_trackers
"
)
false
"
network
.
lna
.
block_trackers
should
not
be
locked
when
Locked
is
not
specified
"
)
;
equal
(
Services
.
prefs
.
prefIsLocked
(
"
network
.
lna
.
blocking
"
)
false
"
network
.
lna
.
blocking
should
not
be
locked
when
Locked
is
not
specified
"
)
;
}
)
;
add_task
(
async
function
test_local_network_access_disabled
(
)
{
await
setupPolicyEngineWithJson
(
{
policies
:
{
LocalNetworkAccess
:
{
Enabled
:
false
}
}
}
)
;
equal
(
Services
.
prefs
.
getBoolPref
(
"
network
.
lna
.
enabled
"
)
false
"
network
.
lna
.
enabled
should
be
false
when
LocalNetworkAccess
is
disabled
"
)
;
equal
(
Services
.
prefs
.
getBoolPref
(
"
network
.
lna
.
block_trackers
"
)
false
"
network
.
lna
.
block_trackers
should
be
false
when
LocalNetworkAccess
is
disabled
"
)
;
equal
(
Services
.
prefs
.
getBoolPref
(
"
network
.
lna
.
blocking
"
)
false
"
network
.
lna
.
blocking
should
be
false
when
LocalNetworkAccess
is
disabled
"
)
;
equal
(
Services
.
prefs
.
prefIsLocked
(
"
network
.
lna
.
enabled
"
)
false
"
network
.
lna
.
enabled
should
not
be
locked
when
Locked
is
not
specified
"
)
;
equal
(
Services
.
prefs
.
prefIsLocked
(
"
network
.
lna
.
block_trackers
"
)
false
"
network
.
lna
.
block_trackers
should
not
be
locked
when
Locked
is
not
specified
"
)
;
equal
(
Services
.
prefs
.
prefIsLocked
(
"
network
.
lna
.
blocking
"
)
false
"
network
.
lna
.
blocking
should
not
be
locked
when
Locked
is
not
specified
"
)
;
}
)
;
add_task
(
async
function
test_local_network_access_enabled_locked
(
)
{
await
setupPolicyEngineWithJson
(
{
policies
:
{
LocalNetworkAccess
:
{
Enabled
:
true
Locked
:
true
}
}
}
)
;
equal
(
Services
.
prefs
.
getBoolPref
(
"
network
.
lna
.
enabled
"
)
true
"
network
.
lna
.
enabled
should
be
true
when
LocalNetworkAccess
is
enabled
"
)
;
equal
(
Services
.
prefs
.
getBoolPref
(
"
network
.
lna
.
block_trackers
"
)
true
"
network
.
lna
.
block_trackers
should
be
true
when
LocalNetworkAccess
is
enabled
"
)
;
equal
(
Services
.
prefs
.
getBoolPref
(
"
network
.
lna
.
blocking
"
)
true
"
network
.
lna
.
blocking
should
be
true
when
LocalNetworkAccess
is
enabled
"
)
;
equal
(
Services
.
prefs
.
prefIsLocked
(
"
network
.
lna
.
enabled
"
)
true
"
network
.
lna
.
enabled
should
be
locked
when
Locked
:
true
is
specified
"
)
;
equal
(
Services
.
prefs
.
prefIsLocked
(
"
network
.
lna
.
block_trackers
"
)
true
"
network
.
lna
.
block_trackers
should
be
locked
when
Locked
:
true
is
specified
"
)
;
equal
(
Services
.
prefs
.
prefIsLocked
(
"
network
.
lna
.
blocking
"
)
true
"
network
.
lna
.
blocking
should
be
locked
when
Locked
:
true
is
specified
"
)
;
}
)
;
add_task
(
async
function
test_local_network_access_disabled_locked
(
)
{
await
setupPolicyEngineWithJson
(
{
policies
:
{
LocalNetworkAccess
:
{
Enabled
:
false
Locked
:
true
}
}
}
)
;
equal
(
Services
.
prefs
.
getBoolPref
(
"
network
.
lna
.
enabled
"
)
false
"
network
.
lna
.
enabled
should
be
false
when
LocalNetworkAccess
is
disabled
"
)
;
equal
(
Services
.
prefs
.
getBoolPref
(
"
network
.
lna
.
block_trackers
"
)
false
"
network
.
lna
.
block_trackers
should
be
false
when
LocalNetworkAccess
is
disabled
"
)
;
equal
(
Services
.
prefs
.
getBoolPref
(
"
network
.
lna
.
blocking
"
)
false
"
network
.
lna
.
blocking
should
be
false
when
LocalNetworkAccess
is
disabled
"
)
;
equal
(
Services
.
prefs
.
prefIsLocked
(
"
network
.
lna
.
enabled
"
)
true
"
network
.
lna
.
enabled
should
be
locked
when
Locked
:
true
is
specified
"
)
;
equal
(
Services
.
prefs
.
prefIsLocked
(
"
network
.
lna
.
block_trackers
"
)
true
"
network
.
lna
.
block_trackers
should
be
locked
when
Locked
:
true
is
specified
"
)
;
equal
(
Services
.
prefs
.
prefIsLocked
(
"
network
.
lna
.
blocking
"
)
true
"
network
.
lna
.
blocking
should
be
locked
when
Locked
:
true
is
specified
"
)
;
await
setupPolicyEngineWithJson
(
{
policies
:
{
LocalNetworkAccess
:
{
Enabled
:
false
Locked
:
false
}
}
}
)
;
}
)
;
add_task
(
async
function
test_local_network_access_fine_grained_block_trackers_only
(
)
{
await
setupPolicyEngineWithJson
(
{
policies
:
{
LocalNetworkAccess
:
{
Enabled
:
true
BlockTrackers
:
true
EnablePrompting
:
false
}
}
}
)
;
equal
(
Services
.
prefs
.
getBoolPref
(
"
network
.
lna
.
enabled
"
)
true
"
network
.
lna
.
enabled
should
be
true
"
)
;
equal
(
Services
.
prefs
.
getBoolPref
(
"
network
.
lna
.
block_trackers
"
)
true
"
network
.
lna
.
block_trackers
should
be
true
when
BlockTrackers
is
true
"
)
;
equal
(
Services
.
prefs
.
getBoolPref
(
"
network
.
lna
.
blocking
"
)
false
"
network
.
lna
.
blocking
should
be
false
when
EnablePrompting
is
false
"
)
;
}
)
;
add_task
(
async
function
test_local_network_access_fine_grained_prompting_only
(
)
{
await
setupPolicyEngineWithJson
(
{
policies
:
{
LocalNetworkAccess
:
{
Enabled
:
true
BlockTrackers
:
false
EnablePrompting
:
true
}
}
}
)
;
equal
(
Services
.
prefs
.
getBoolPref
(
"
network
.
lna
.
enabled
"
)
true
"
network
.
lna
.
enabled
should
be
true
"
)
;
equal
(
Services
.
prefs
.
getBoolPref
(
"
network
.
lna
.
block_trackers
"
)
false
"
network
.
lna
.
block_trackers
should
be
false
when
BlockTrackers
is
false
"
)
;
equal
(
Services
.
prefs
.
getBoolPref
(
"
network
.
lna
.
blocking
"
)
true
"
network
.
lna
.
blocking
should
be
true
when
EnablePrompting
is
true
"
)
;
}
)
;
add_task
(
async
function
test_local_network_access_enabled_only_backward_compatibility
(
)
{
await
setupPolicyEngineWithJson
(
{
policies
:
{
LocalNetworkAccess
:
{
Enabled
:
true
}
}
}
)
;
equal
(
Services
.
prefs
.
getBoolPref
(
"
network
.
lna
.
enabled
"
)
true
"
network
.
lna
.
enabled
should
be
true
"
)
;
equal
(
Services
.
prefs
.
getBoolPref
(
"
network
.
lna
.
block_trackers
"
)
true
"
network
.
lna
.
block_trackers
should
default
to
true
for
backward
compatibility
"
)
;
equal
(
Services
.
prefs
.
getBoolPref
(
"
network
.
lna
.
blocking
"
)
true
"
network
.
lna
.
blocking
should
default
to
true
for
backward
compatibility
"
)
;
}
)
;
add_task
(
async
function
test_local_network_access_disabled_overrides_fine_grained
(
)
{
await
setupPolicyEngineWithJson
(
{
policies
:
{
LocalNetworkAccess
:
{
Enabled
:
false
BlockTrackers
:
true
EnablePrompting
:
true
}
}
}
)
;
equal
(
Services
.
prefs
.
getBoolPref
(
"
network
.
lna
.
enabled
"
)
false
"
network
.
lna
.
enabled
should
be
false
when
Enabled
is
false
"
)
;
equal
(
Services
.
prefs
.
getBoolPref
(
"
network
.
lna
.
block_trackers
"
)
false
"
network
.
lna
.
block_trackers
should
be
false
when
LNA
is
disabled
regardless
of
BlockTrackers
setting
"
)
;
equal
(
Services
.
prefs
.
getBoolPref
(
"
network
.
lna
.
blocking
"
)
false
"
network
.
lna
.
blocking
should
be
false
when
LNA
is
disabled
regardless
of
EnablePrompting
setting
"
)
;
}
)
;
add_task
(
async
function
test_local_network_access_no_enabled_field_no_modification
(
)
{
Services
.
prefs
.
setBoolPref
(
"
network
.
lna
.
enabled
"
false
)
;
Services
.
prefs
.
setBoolPref
(
"
network
.
lna
.
block_trackers
"
false
)
;
Services
.
prefs
.
setBoolPref
(
"
network
.
lna
.
blocking
"
true
)
;
await
setupPolicyEngineWithJson
(
{
policies
:
{
LocalNetworkAccess
:
{
BlockTrackers
:
true
EnablePrompting
:
false
}
}
}
)
;
equal
(
Services
.
prefs
.
getBoolPref
(
"
network
.
lna
.
enabled
"
)
false
"
network
.
lna
.
enabled
should
remain
unchanged
when
Enabled
is
not
specified
"
)
;
equal
(
Services
.
prefs
.
getBoolPref
(
"
network
.
lna
.
block_trackers
"
)
false
"
network
.
lna
.
block_trackers
should
remain
unchanged
when
Enabled
is
not
specified
"
)
;
equal
(
Services
.
prefs
.
getBoolPref
(
"
network
.
lna
.
blocking
"
)
true
"
network
.
lna
.
blocking
should
remain
unchanged
when
Enabled
is
not
specified
"
)
;
}
)
;
add_task
(
async
function
test_local_network_access_fine_grained_locked
(
)
{
await
setupPolicyEngineWithJson
(
{
policies
:
{
LocalNetworkAccess
:
{
Enabled
:
true
BlockTrackers
:
false
EnablePrompting
:
true
Locked
:
true
}
}
}
)
;
equal
(
Services
.
prefs
.
getBoolPref
(
"
network
.
lna
.
enabled
"
)
true
)
;
equal
(
Services
.
prefs
.
getBoolPref
(
"
network
.
lna
.
block_trackers
"
)
false
)
;
equal
(
Services
.
prefs
.
getBoolPref
(
"
network
.
lna
.
blocking
"
)
true
)
;
equal
(
Services
.
prefs
.
prefIsLocked
(
"
network
.
lna
.
enabled
"
)
true
"
network
.
lna
.
enabled
should
be
locked
"
)
;
equal
(
Services
.
prefs
.
prefIsLocked
(
"
network
.
lna
.
block_trackers
"
)
true
"
network
.
lna
.
block_trackers
should
be
locked
"
)
;
equal
(
Services
.
prefs
.
prefIsLocked
(
"
network
.
lna
.
blocking
"
)
true
"
network
.
lna
.
blocking
should
be
locked
"
)
;
}
)
;
add_task
(
async
function
test_local_network_access_policy_enforcement
(
)
{
await
setupPolicyEngineWithJson
(
{
policies
:
{
LocalNetworkAccess
:
{
Enabled
:
false
Locked
:
true
}
}
}
)
;
equal
(
Services
.
prefs
.
getBoolPref
(
"
network
.
lna
.
enabled
"
)
false
)
;
equal
(
Services
.
prefs
.
prefIsLocked
(
"
network
.
lna
.
enabled
"
)
true
)
;
Services
.
prefs
.
setBoolPref
(
"
network
.
lna
.
enabled
"
true
)
;
equal
(
Services
.
prefs
.
getBoolPref
(
"
network
.
lna
.
enabled
"
)
false
"
Locked
preference
should
remain
unchanged
after
attempted
modification
"
)
;
equal
(
Services
.
prefs
.
prefIsLocked
(
"
network
.
lna
.
enabled
"
)
true
"
Preference
should
still
be
locked
"
)
;
}
)
;
