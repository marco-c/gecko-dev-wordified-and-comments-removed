"
use
strict
"
;
add_task
(
async
function
setup
(
)
{
await
setupPolicyEngineWithJson
(
{
"
policies
"
:
{
"
BlockAboutAddons
"
:
true
}
}
)
;
}
)
;
add_task
(
async
function
test_about_addons
(
)
{
let
options
=
{
gBrowser
opening
:
"
about
:
addons
"
waitForLoad
:
false
waitForStateStop
:
true
}
;
let
tab
=
await
BrowserTestUtils
.
openNewForegroundTab
(
options
)
;
await
ContentTask
.
spawn
(
tab
.
linkedBrowser
null
async
function
(
)
{
ok
(
content
.
document
.
documentURI
.
startsWith
(
"
about
:
neterror
?
e
=
blockedByPolicy
"
)
content
.
document
.
documentURI
+
"
should
start
with
about
:
neterror
?
e
=
blockedByPolicy
"
)
;
is
(
Services
.
policies
.
isAllowed
(
"
about
:
addons
"
)
false
"
Policy
Engine
should
report
about
:
addons
as
not
allowed
"
)
;
}
)
;
BrowserTestUtils
.
removeTab
(
tab
)
;
}
)
;
