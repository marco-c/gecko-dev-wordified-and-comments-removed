"
use
strict
"
;
const
PREF_DISABLE_FX_SCREENSHOTS
=
"
extensions
.
screenshots
.
disabled
"
;
async
function
checkScreenshots
(
shouldBeEnabled
)
{
return
BrowserTestUtils
.
waitForCondition
(
(
)
=
>
{
return
!
!
PageActions
.
actionForID
(
"
screenshots
"
)
=
=
shouldBeEnabled
;
}
"
Expecting
screenshots
to
be
"
+
shouldBeEnabled
)
;
}
add_task
(
async
function
test_disable_firefox_screenshots
(
)
{
await
BrowserTestUtils
.
withNewTab
(
"
data
:
text
/
html
Test
"
async
function
(
)
{
await
setupPolicyEngineWithJson
(
"
"
)
;
is
(
Services
.
policies
.
status
Services
.
policies
.
INACTIVE
"
Start
with
no
policies
"
)
;
Services
.
prefs
.
setBoolPref
(
PREF_DISABLE_FX_SCREENSHOTS
false
)
;
await
checkScreenshots
(
true
)
;
await
setupPolicyEngineWithJson
(
{
"
policies
"
:
{
"
DisableFirefoxScreenshots
"
:
true
}
}
)
;
is
(
Services
.
policies
.
status
Services
.
policies
.
ACTIVE
"
Policy
engine
is
active
"
)
;
await
checkScreenshots
(
false
)
;
await
setupPolicyEngineWithJson
(
"
"
)
;
Services
.
prefs
.
unlockPref
(
PREF_DISABLE_FX_SCREENSHOTS
)
;
Services
.
prefs
.
clearUserPref
(
PREF_DISABLE_FX_SCREENSHOTS
)
;
await
checkScreenshots
(
false
)
;
}
)
;
}
)
;
