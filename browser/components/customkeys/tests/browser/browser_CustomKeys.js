"
use
strict
"
;
registerCleanupFunction
(
(
)
=
>
{
CustomKeys
.
resetAll
(
)
;
}
)
;
add_task
(
async
function
testChangeKey
(
)
{
is
(
document
.
activeElement
gBrowser
.
selectedBrowser
"
Tab
document
browser
is
focused
"
)
;
is
(
CustomKeys
.
getDefaultKey
(
"
key_gotoHistory
"
)
null
"
key_gotoHistory
is
not
customized
"
)
;
info
(
Changing
key_gotoHistory
to
{
consts
.
unusedDisplay
}
)
;
CustomKeys
.
changeKey
(
"
key_gotoHistory
"
{
modifiers
:
consts
.
unusedModifiers
key
:
consts
.
unusedKey
}
)
;
Assert
.
deepEqual
(
CustomKeys
.
getDefaultKey
(
"
key_gotoHistory
"
)
{
modifiers
:
consts
.
historyModifiers
key
:
"
H
"
}
"
key_gotoHistory
is
customized
"
)
;
info
(
Pressing
{
consts
.
unusedDisplay
}
)
;
let
focused
=
BrowserTestUtils
.
waitForEvent
(
window
"
SidebarFocused
"
)
;
EventUtils
.
synthesizeKey
(
consts
.
unusedKey
consts
.
unusedOptions
window
)
;
await
focused
;
ok
(
true
"
Sidebar
got
focus
"
)
;
is
(
SidebarController
.
currentID
"
viewHistorySidebar
"
"
History
sidebar
is
open
"
)
;
info
(
Pressing
{
consts
.
unusedDisplay
}
)
;
focused
=
BrowserTestUtils
.
waitForEvent
(
gBrowser
.
selectedBrowser
"
focus
"
)
;
EventUtils
.
synthesizeKey
(
consts
.
unusedKey
consts
.
unusedOptions
window
)
;
await
focused
;
ok
(
true
"
Tab
document
browser
got
focus
"
)
;
is
(
CustomKeys
.
getDefaultKey
(
"
viewBookmarksSidebarKb
"
)
null
"
viewBookmarksSidebarKb
is
not
customized
"
)
;
info
(
Changing
viewBookmarksSidebarKb
to
{
consts
.
historyDisplay
}
)
;
CustomKeys
.
changeKey
(
"
viewBookmarksSidebarKb
"
{
modifiers
:
consts
.
historyModifiers
key
:
"
H
"
}
)
;
Assert
.
deepEqual
(
CustomKeys
.
getDefaultKey
(
"
viewBookmarksSidebarKb
"
)
{
modifiers
:
"
accel
"
key
:
"
B
"
}
"
viewBookmarksSidebarKb
is
customized
"
)
;
info
(
Pressing
{
consts
.
historyDisplay
}
)
;
focused
=
BrowserTestUtils
.
waitForEvent
(
window
"
SidebarFocused
"
)
;
EventUtils
.
synthesizeKey
(
"
H
"
consts
.
historyOptions
window
)
;
await
focused
;
ok
(
true
"
Sidebar
got
focus
"
)
;
is
(
SidebarController
.
currentID
"
viewBookmarksSidebar
"
"
Bookmarks
sidebar
is
open
"
)
;
info
(
Pressing
{
consts
.
historyDisplay
}
)
;
focused
=
BrowserTestUtils
.
waitForEvent
(
gBrowser
.
selectedBrowser
"
focus
"
)
;
EventUtils
.
synthesizeKey
(
"
H
"
consts
.
historyOptions
window
)
;
await
focused
;
ok
(
true
"
Tab
document
browser
got
focus
"
)
;
info
(
"
Resetting
all
keys
"
)
;
CustomKeys
.
resetAll
(
)
;
}
)
;
add_task
(
async
function
testClearKey
(
)
{
is
(
document
.
activeElement
gBrowser
.
selectedBrowser
"
Tab
document
browser
is
focused
"
)
;
info
(
"
Focusing
selected
tab
"
)
;
let
focused
=
BrowserTestUtils
.
waitForEvent
(
gBrowser
.
selectedTab
"
focus
"
)
;
gBrowser
.
selectedTab
.
focus
(
)
;
await
focused
;
ok
(
true
"
Selected
tab
got
focus
"
)
;
is
(
CustomKeys
.
getDefaultKey
(
"
focusURLBar
"
)
null
"
focusURLBar
is
not
customized
"
)
;
info
(
"
Pressing
accel
+
L
"
)
;
EventUtils
.
synthesizeKey
(
"
L
"
{
accelKey
:
true
}
window
)
;
is
(
document
.
activeElement
gURLBar
.
inputField
"
URL
bar
is
focused
"
)
;
info
(
"
Focusing
selected
tab
"
)
;
focused
=
BrowserTestUtils
.
waitForEvent
(
gBrowser
.
selectedTab
"
focus
"
)
;
gBrowser
.
selectedTab
.
focus
(
)
;
await
focused
;
ok
(
true
"
Selected
tab
got
focus
"
)
;
info
(
"
Clearing
focusURLBar
"
)
;
CustomKeys
.
clearKey
(
"
focusURLBar
"
)
;
Assert
.
deepEqual
(
CustomKeys
.
getDefaultKey
(
"
focusURLBar
"
)
{
modifiers
:
"
accel
"
key
:
"
L
"
}
"
focusURLBar
is
customized
"
)
;
info
(
"
Pressing
accel
+
L
"
)
;
EventUtils
.
synthesizeKey
(
"
L
"
{
accelKey
:
true
}
window
)
;
is
(
document
.
activeElement
gBrowser
.
selectedTab
"
Selected
tab
still
focused
"
)
;
info
(
"
Focusing
tab
document
browser
"
)
;
focused
=
BrowserTestUtils
.
waitForEvent
(
gBrowser
.
selectedBrowser
"
focus
"
)
;
gBrowser
.
selectedBrowser
.
focus
(
)
;
await
focused
;
ok
(
true
"
Tab
document
browser
got
focus
"
)
;
info
(
"
Resetting
all
keys
"
)
;
CustomKeys
.
resetAll
(
)
;
}
)
;
add_task
(
async
function
testResetKey
(
)
{
is
(
document
.
activeElement
gBrowser
.
selectedBrowser
"
Tab
document
browser
is
focused
"
)
;
is
(
CustomKeys
.
getDefaultKey
(
"
focusURLBar
"
)
null
"
focusURLBar
is
not
customized
"
)
;
info
(
"
Clearing
focusURLBar
"
)
;
CustomKeys
.
clearKey
(
"
focusURLBar
"
)
;
Assert
.
deepEqual
(
CustomKeys
.
getDefaultKey
(
"
focusURLBar
"
)
{
modifiers
:
"
accel
"
key
:
"
L
"
}
"
focusURLBar
is
customized
"
)
;
info
(
"
Resetting
focusURLBar
"
)
;
CustomKeys
.
resetKey
(
"
focusURLBar
"
)
;
is
(
CustomKeys
.
getDefaultKey
(
"
focusURLBar
"
)
null
"
focusURLBar
is
not
customized
"
)
;
info
(
"
Pressing
accel
+
L
"
)
;
let
focused
=
BrowserTestUtils
.
waitForEvent
(
gURLBar
.
inputField
"
focus
"
)
;
EventUtils
.
synthesizeKey
(
"
L
"
{
accelKey
:
true
}
window
)
;
await
focused
;
ok
(
true
"
URL
bar
got
focus
"
)
;
info
(
"
Focusing
tab
document
browser
"
)
;
focused
=
BrowserTestUtils
.
waitForEvent
(
gBrowser
.
selectedBrowser
"
focus
"
)
;
gBrowser
.
selectedBrowser
.
focus
(
)
;
await
focused
;
ok
(
true
"
Tab
document
browser
got
focus
"
)
;
info
(
"
Resetting
all
keys
"
)
;
CustomKeys
.
resetAll
(
)
;
}
)
;
add_task
(
async
function
testResetAll
(
)
{
is
(
document
.
activeElement
gBrowser
.
selectedBrowser
"
Tab
document
browser
is
focused
"
)
;
is
(
CustomKeys
.
getDefaultKey
(
"
key_gotoHistory
"
)
null
"
key_gotoHistory
is
not
customized
"
)
;
info
(
Changing
key_gotoHistory
to
{
consts
.
unusedDisplay
}
)
;
CustomKeys
.
changeKey
(
"
key_gotoHistory
"
{
modifiers
:
consts
.
unusedModifiers
key
:
consts
.
unusedKey
}
)
;
Assert
.
deepEqual
(
CustomKeys
.
getDefaultKey
(
"
key_gotoHistory
"
)
{
modifiers
:
consts
.
historyModifiers
key
:
"
H
"
}
"
key_gotoHistory
is
customized
"
)
;
is
(
CustomKeys
.
getDefaultKey
(
"
focusURLBar
"
)
null
"
focusURLBar
is
not
customized
"
)
;
info
(
"
Clearing
focusURLBar
"
)
;
CustomKeys
.
clearKey
(
"
focusURLBar
"
)
;
Assert
.
deepEqual
(
CustomKeys
.
getDefaultKey
(
"
focusURLBar
"
)
{
modifiers
:
"
accel
"
key
:
"
L
"
}
"
focusURLBar
is
customized
"
)
;
info
(
"
Resetting
all
keys
"
)
;
CustomKeys
.
resetAll
(
)
;
info
(
Pressing
{
consts
.
historyDisplay
}
)
;
let
focused
=
BrowserTestUtils
.
waitForEvent
(
window
"
SidebarFocused
"
)
;
EventUtils
.
synthesizeKey
(
"
H
"
consts
.
historyOptions
window
)
;
await
focused
;
ok
(
true
"
Sidebar
got
focus
"
)
;
is
(
SidebarController
.
currentID
"
viewHistorySidebar
"
"
History
sidebar
is
open
"
)
;
info
(
Pressing
{
consts
.
historyDisplay
}
)
;
focused
=
BrowserTestUtils
.
waitForEvent
(
gBrowser
.
selectedBrowser
"
focus
"
)
;
EventUtils
.
synthesizeKey
(
"
H
"
consts
.
historyOptions
window
)
;
await
focused
;
ok
(
true
"
Tab
document
browser
got
focus
"
)
;
info
(
"
Pressing
accel
+
L
"
)
;
focused
=
BrowserTestUtils
.
waitForEvent
(
gURLBar
.
inputField
"
focus
"
)
;
EventUtils
.
synthesizeKey
(
"
L
"
{
accelKey
:
true
}
window
)
;
await
focused
;
ok
(
true
"
URL
bar
got
focus
"
)
;
info
(
"
Focusing
tab
document
browser
"
)
;
focused
=
BrowserTestUtils
.
waitForEvent
(
gBrowser
.
selectedBrowser
"
focus
"
)
;
gBrowser
.
selectedBrowser
.
focus
(
)
;
await
focused
;
ok
(
true
"
Tab
document
browser
got
focus
"
)
;
}
)
;
add_task
(
async
function
testOtherWindow
(
)
{
is
(
CustomKeys
.
getDefaultKey
(
"
key_gotoHistory
"
)
null
"
key_gotoHistory
is
not
customized
"
)
;
info
(
Changing
key_gotoHistory
to
{
consts
.
unusedDisplay
}
)
;
CustomKeys
.
changeKey
(
"
key_gotoHistory
"
{
modifiers
:
consts
.
unusedModifiers
key
:
consts
.
unusedKey
}
)
;
Assert
.
deepEqual
(
CustomKeys
.
getDefaultKey
(
"
key_gotoHistory
"
)
{
modifiers
:
consts
.
historyModifiers
key
:
"
H
"
}
"
key_gotoHistory
is
customized
"
)
;
info
(
"
Opening
new
window
"
)
;
const
newWin
=
await
BrowserTestUtils
.
openNewBrowserWindow
(
)
;
is
(
newWin
.
document
.
activeElement
newWin
.
gURLBar
.
inputField
"
URL
bar
is
focused
in
new
window
"
)
;
info
(
Pressing
{
consts
.
unusedDisplay
}
in
new
window
)
;
let
focused
=
BrowserTestUtils
.
waitForEvent
(
newWin
"
SidebarFocused
"
)
;
EventUtils
.
synthesizeKey
(
consts
.
unusedKey
consts
.
unusedOptions
newWin
)
;
await
focused
;
ok
(
true
"
Sidebar
got
focus
in
new
window
"
)
;
is
(
newWin
.
SidebarController
.
currentID
"
viewHistorySidebar
"
"
History
sidebar
is
open
in
new
window
"
)
;
info
(
Pressing
{
consts
.
unusedDisplay
}
in
new
window
)
;
focused
=
BrowserTestUtils
.
waitForEvent
(
newWin
.
gBrowser
.
selectedBrowser
"
focus
"
)
;
EventUtils
.
synthesizeKey
(
consts
.
unusedKey
consts
.
unusedOptions
newWin
)
;
await
focused
;
ok
(
true
"
Tab
document
browser
got
focus
in
new
window
"
)
;
is
(
CustomKeys
.
getDefaultKey
(
"
viewBookmarksSidebarKb
"
)
null
"
viewBookmarksSidebarKb
is
not
customized
"
)
;
info
(
Changing
viewBookmarksSidebarKb
to
{
consts
.
historyDisplay
}
)
;
CustomKeys
.
changeKey
(
"
viewBookmarksSidebarKb
"
{
modifiers
:
consts
.
historyModifiers
key
:
"
H
"
}
)
;
Assert
.
deepEqual
(
CustomKeys
.
getDefaultKey
(
"
viewBookmarksSidebarKb
"
)
{
modifiers
:
"
accel
"
key
:
"
B
"
}
"
viewBookmarksSidebarKb
is
customized
"
)
;
info
(
Pressing
{
consts
.
historyDisplay
}
in
new
window
)
;
focused
=
BrowserTestUtils
.
waitForEvent
(
newWin
"
SidebarFocused
"
)
;
EventUtils
.
synthesizeKey
(
"
H
"
consts
.
historyOptions
newWin
)
;
await
focused
;
ok
(
true
"
Sidebar
got
focus
in
new
window
"
)
;
is
(
newWin
.
SidebarController
.
currentID
"
viewBookmarksSidebar
"
"
Bookmarks
sidebar
is
open
"
)
;
info
(
Pressing
{
consts
.
historyDisplay
}
in
new
window
)
;
focused
=
BrowserTestUtils
.
waitForEvent
(
newWin
.
gBrowser
.
selectedBrowser
"
focus
"
)
;
EventUtils
.
synthesizeKey
(
"
H
"
consts
.
historyOptions
newWin
)
;
await
focused
;
ok
(
true
"
Tab
document
browser
got
focus
in
new
window
"
)
;
info
(
"
Resetting
all
keys
"
)
;
CustomKeys
.
resetAll
(
)
;
is
(
CustomKeys
.
getDefaultKey
(
"
key_gotoHistory
"
)
null
"
key_gotoHistory
is
not
customized
"
)
;
info
(
Pressing
{
consts
.
historyDisplay
}
in
new
window
)
;
focused
=
BrowserTestUtils
.
waitForEvent
(
newWin
"
SidebarFocused
"
)
;
EventUtils
.
synthesizeKey
(
"
H
"
consts
.
historyOptions
newWin
)
;
await
focused
;
ok
(
true
"
Sidebar
got
focus
in
new
window
"
)
;
is
(
newWin
.
SidebarController
.
currentID
"
viewHistorySidebar
"
"
History
sidebar
is
open
in
new
window
"
)
;
info
(
Pressing
{
consts
.
historyDisplay
}
in
new
window
)
;
focused
=
BrowserTestUtils
.
waitForEvent
(
newWin
.
gBrowser
.
selectedBrowser
"
focus
"
)
;
EventUtils
.
synthesizeKey
(
"
H
"
consts
.
historyOptions
newWin
)
;
await
focused
;
ok
(
true
"
Tab
document
browser
got
focus
in
new
window
"
)
;
info
(
"
Closing
new
window
"
)
;
await
BrowserTestUtils
.
closeWindow
(
newWin
)
;
}
)
;
