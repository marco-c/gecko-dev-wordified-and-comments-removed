const
path
=
require
(
"
path
"
)
;
const
fs
=
require
(
"
fs
"
)
;
const
projectRoot
=
path
.
resolve
(
__dirname
"
.
.
/
.
.
/
.
.
/
.
.
/
"
)
;
function
getTitleFromPath
(
filePath
)
{
let
fileName
=
path
.
basename
(
filePath
"
.
stories
.
md
"
)
;
if
(
fileName
!
=
"
README
"
)
{
try
{
let
relatedFilePath
=
path
.
resolve
(
"
.
.
/
.
.
/
.
.
/
"
filePath
.
replace
(
"
.
md
"
"
.
mjs
"
)
)
;
let
relatedFile
=
fs
.
readFileSync
(
relatedFilePath
)
.
toString
(
)
;
let
relatedTitle
=
relatedFile
.
match
(
/
title
:
"
(
.
*
)
"
/
)
[
1
]
;
if
(
relatedTitle
)
{
return
relatedTitle
+
"
/
README
"
;
}
}
catch
{
}
}
return
separateWords
(
fileName
)
;
}
function
separateWords
(
str
)
{
return
(
str
.
match
(
/
[
A
-
Z
]
?
[
a
-
z0
-
9
]
+
/
g
)
?
.
map
(
text
=
>
text
[
0
]
.
toUpperCase
(
)
+
text
.
substring
(
1
)
)
.
join
(
"
"
)
|
|
str
)
;
}
function
parseStoriesFromMarkdown
(
source
)
{
let
storiesRegex
=
/
(
?
:
js
|
html
)
story
\
n
(
?
<
code
>
[
\
s
\
S
]
*
?
)
/
g
;
return
source
.
replace
(
storiesRegex
"
<
Canvas
withSource
=
'
none
'
>
<
with
-
common
-
styles
>
\
n
<
code
>
<
/
with
-
common
-
styles
>
<
/
Canvas
>
"
)
;
}
function
getComponentName
(
resourcePath
)
{
let
componentName
=
"
"
;
if
(
resourcePath
.
includes
(
"
toolkit
/
content
/
widgets
"
)
)
{
let
storyNameRegex
=
/
(
?
<
=
\
/
widgets
\
/
)
(
?
<
name
>
.
*
?
)
(
?
=
\
/
)
/
g
;
componentName
=
storyNameRegex
.
exec
(
resourcePath
)
?
.
groups
?
.
name
;
}
return
componentName
;
}
function
getStoryTitle
(
resourcePath
)
{
let
storyPath
=
"
Docs
"
;
let
relativePath
=
path
.
relative
(
projectRoot
resourcePath
)
.
replaceAll
(
path
.
sep
"
/
"
)
;
let
componentName
=
getComponentName
(
relativePath
)
;
if
(
componentName
)
{
storyPath
=
"
UI
Widgets
/
"
+
separateWords
(
componentName
)
.
replace
(
/
^
Moz
/
g
"
"
)
;
}
let
storyTitle
=
getTitleFromPath
(
relativePath
)
;
let
title
=
storyTitle
.
includes
(
"
/
"
)
?
storyTitle
:
{
storyPath
}
/
{
storyTitle
}
;
return
title
;
}
function
getImportPath
(
resourcePath
)
{
let
normalizedPath
=
resourcePath
.
split
(
path
.
sep
)
.
join
(
"
/
"
)
;
if
(
!
normalizedPath
.
includes
(
"
toolkit
/
content
/
widgets
"
)
)
{
return
"
"
;
}
let
componentName
=
getComponentName
(
normalizedPath
)
;
let
fileExtension
=
"
"
;
if
(
componentName
)
{
let
mjsPath
=
normalizedPath
.
replace
(
"
README
.
stories
.
md
"
{
componentName
}
.
mjs
)
;
let
jsPath
=
normalizedPath
.
replace
(
"
README
.
stories
.
md
"
{
componentName
}
.
js
)
;
if
(
fs
.
existsSync
(
mjsPath
)
)
{
fileExtension
=
"
mjs
"
;
}
else
if
(
fs
.
existsSync
(
jsPath
)
)
{
fileExtension
=
"
js
"
;
}
else
{
return
"
"
;
}
}
return
"
toolkit
-
widgets
/
{
componentName
}
/
{
componentName
}
.
{
fileExtension
}
"
;
}
function
getMDXSource
(
source
title
resourcePath
=
"
"
)
{
let
importPath
=
getImportPath
(
resourcePath
)
;
let
componentName
=
getComponentName
(
resourcePath
)
;
let
mdxSource
=
import
{
Meta
Canvas
ArgTypes
}
from
"
storybook
/
addon
-
docs
"
;
{
importPath
?
import
{
importPath
}
;
:
"
"
}
<
Meta
title
=
"
{
title
}
"
parameters
=
{
{
previewTabs
:
{
canvas
:
{
hidden
:
true
}
}
viewMode
:
"
docs
"
}
}
/
>
{
parseStoriesFromMarkdown
(
source
)
}
{
importPath
&
&
#
#
Args
Table
<
ArgTypes
of
=
{
"
{
componentName
}
"
}
/
>
}
;
return
mdxSource
;
}
module
.
exports
=
{
getMDXSource
getStoryTitle
}
;
