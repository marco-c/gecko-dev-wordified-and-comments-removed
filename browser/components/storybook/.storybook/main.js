const
path
=
require
(
"
path
"
)
;
const
webpack
=
require
(
"
webpack
"
)
;
const
[
prefixMap
aliasMap
sourceMap
]
=
require
(
"
.
/
chrome
-
map
.
js
"
)
;
const
projectRoot
=
path
.
resolve
(
__dirname
"
.
.
/
.
.
/
.
.
/
.
.
/
"
)
;
function
rewriteChromeUri
(
uri
)
{
if
(
uri
in
aliasMap
)
{
return
rewriteChromeUri
(
aliasMap
[
uri
]
)
;
}
for
(
let
[
prefix
[
bundlePath
]
]
of
Object
.
entries
(
prefixMap
)
)
{
if
(
uri
.
startsWith
(
prefix
)
)
{
if
(
!
bundlePath
.
endsWith
(
"
/
"
)
)
{
bundlePath
+
=
"
/
"
;
}
let
relativePath
=
uri
.
slice
(
prefix
.
length
)
;
let
objdirPath
=
bundlePath
+
relativePath
;
for
(
let
[
_objdirPath
[
filePath
]
]
of
Object
.
entries
(
sourceMap
)
)
{
if
(
_objdirPath
=
=
objdirPath
)
{
return
filePath
;
}
}
}
}
return
"
"
;
}
module
.
exports
=
{
stories
:
[
"
.
.
/
*
*
/
*
.
stories
.
md
"
"
.
.
/
stories
/
*
*
/
*
.
stories
.
mdx
"
"
.
.
/
stories
/
*
*
/
*
.
stories
.
(
js
|
jsx
|
mjs
|
ts
|
tsx
|
md
)
"
{
projectRoot
}
/
toolkit
/
content
/
widgets
/
*
*
/
*
.
stories
.
(
js
|
jsx
|
mjs
|
ts
|
tsx
|
md
)
]
staticDirs
:
[
{
projectRoot
}
/
toolkit
/
content
/
widgets
/
{
projectRoot
}
/
browser
/
themes
/
shared
/
{
projectRoot
}
/
browser
/
components
/
firefoxview
/
]
addons
:
[
"
storybook
/
addon
-
links
"
{
name
:
"
storybook
/
addon
-
essentials
"
options
:
{
backgrounds
:
false
measure
:
false
outline
:
false
}
}
"
storybook
/
addon
-
a11y
"
path
.
resolve
(
__dirname
"
addon
-
pseudo
-
localization
"
)
path
.
resolve
(
__dirname
"
addon
-
component
-
status
"
)
]
framework
:
"
storybook
/
web
-
components
"
webpackFinal
:
async
(
config
{
configType
}
)
=
>
{
config
.
resolve
.
alias
.
browser
=
{
projectRoot
}
/
browser
;
config
.
resolve
.
alias
.
toolkit
=
{
projectRoot
}
/
toolkit
;
config
.
resolve
.
alias
[
"
toolkit
-
widgets
"
]
=
{
projectRoot
}
/
toolkit
/
content
/
widgets
/
;
config
.
resolve
.
alias
[
"
lit
.
all
.
mjs
"
]
=
{
projectRoot
}
/
toolkit
/
content
/
widgets
/
vendor
/
lit
.
all
.
mjs
;
config
.
resolve
.
alias
[
"
storybook
/
addon
-
docs
"
]
=
"
browser
/
components
/
storybook
/
node_modules
/
storybook
/
addon
-
docs
"
;
config
.
resolve
.
alias
[
"
mdx
-
js
/
react
"
]
=
"
storybook
/
addon
-
docs
/
node_modules
/
mdx
-
js
/
react
"
;
config
.
resolve
.
alias
[
"
lit
-
html
/
directive
-
helpers
.
js
"
]
=
"
lit
.
all
.
mjs
"
;
config
.
resolve
.
alias
[
"
lit
-
html
"
]
=
"
lit
.
all
.
mjs
"
;
config
.
plugins
.
push
(
new
webpack
.
NormalModuleReplacementPlugin
(
/
^
chrome
:
\
/
\
/
/
resource
=
>
{
resource
.
request
=
rewriteChromeUri
(
resource
.
request
)
;
}
)
)
;
config
.
module
.
rules
.
push
(
{
test
:
/
\
.
ftl
/
type
:
"
asset
/
source
"
}
)
;
const
MD_STORY_REGEX
=
/
(
stories
|
story
)
\
.
md
/
;
let
mdxStoryTest
=
/
(
stories
|
story
)
\
.
mdx
/
.
toString
(
)
;
let
mdxRule
=
config
.
module
.
rules
.
find
(
rule
=
>
rule
.
test
.
toString
(
)
=
=
=
mdxStoryTest
)
;
config
.
module
.
rules
.
push
(
{
test
:
MD_STORY_REGEX
use
:
[
.
.
.
mdxRule
.
use
{
loader
:
path
.
resolve
(
__dirname
"
.
/
markdown
-
story
-
loader
.
js
"
)
}
]
}
)
;
let
markdownTest
=
/
\
.
md
/
.
toString
(
)
;
let
markdownRuleIndex
=
config
.
module
.
rules
.
findIndex
(
rule
=
>
rule
.
test
.
toString
(
)
=
=
=
markdownTest
)
;
let
markdownRule
=
config
.
module
.
rules
[
markdownRuleIndex
]
;
config
.
module
.
rules
[
markdownRuleIndex
]
=
{
.
.
.
markdownRule
exclude
:
MD_STORY_REGEX
}
;
config
.
optimization
=
{
splitChunks
:
false
runtimeChunk
:
false
sideEffects
:
false
usedExports
:
false
concatenateModules
:
false
minimizer
:
[
]
}
;
return
config
;
}
core
:
{
builder
:
"
webpack5
"
}
}
;
