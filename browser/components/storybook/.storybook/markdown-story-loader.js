const
path
=
require
(
"
path
"
)
;
const
projectRoot
=
path
.
resolve
(
__dirname
"
.
.
/
.
.
/
.
.
/
.
.
/
"
)
;
function
getStoryTitle
(
filePath
)
{
let
fileName
=
path
.
basename
(
filePath
"
.
stories
.
md
"
)
;
return
separateWords
(
fileName
)
;
}
function
separateWords
(
str
)
{
return
(
str
.
match
(
/
[
A
-
Z
]
?
[
a
-
z0
-
9
]
+
/
g
)
?
.
map
(
text
=
>
text
[
0
]
.
toUpperCase
(
)
+
text
.
substring
(
1
)
)
.
join
(
"
"
)
|
|
str
)
;
}
function
parseStoriesFromMarkdown
(
source
)
{
let
storiesRegex
=
/
(
?
:
js
|
html
)
story
\
n
(
?
<
code
>
[
\
s
\
S
]
*
?
)
/
g
;
return
source
.
replace
(
storiesRegex
"
<
Canvas
withSource
=
'
none
'
>
<
with
-
common
-
styles
>
<
code
>
<
/
with
-
common
-
styles
>
<
/
Canvas
>
"
)
;
}
module
.
exports
=
function
markdownStoryLoader
(
source
)
{
let
storyPath
=
"
Docs
"
;
let
relativePath
=
path
.
relative
(
projectRoot
this
.
resourcePath
)
.
replaceAll
(
path
.
sep
"
/
"
)
;
if
(
relativePath
.
includes
(
"
toolkit
/
content
/
widgets
"
)
)
{
let
storyNameRegex
=
/
(
?
<
=
\
/
widgets
\
/
)
(
?
<
name
>
.
*
?
)
(
?
=
\
/
)
/
g
;
let
componentName
=
storyNameRegex
.
exec
(
relativePath
)
?
.
groups
?
.
name
;
if
(
componentName
)
{
storyPath
=
separateWords
(
componentName
)
.
replace
(
/
^
Moz
/
g
"
"
)
;
}
}
let
storyTitle
=
getStoryTitle
(
relativePath
)
;
let
mdxSource
=
import
{
Meta
Description
Canvas
}
from
"
storybook
/
addon
-
docs
"
;
<
Meta
title
=
"
{
storyPath
}
/
{
storyTitle
}
"
parameters
=
{
{
previewTabs
:
{
canvas
:
{
hidden
:
true
}
}
viewMode
:
"
docs
"
}
}
/
>
{
parseStoriesFromMarkdown
(
source
)
}
;
return
mdxSource
;
}
;
