"
use
strict
"
;
add_task
(
async
function
test_migration_dialog_open_in_tab_dialog_box
(
)
{
let
wizardReady
=
BrowserTestUtils
.
waitForEvent
(
window
"
MigrationWizard
:
Ready
"
)
;
let
dialogPromise
=
TestUtils
.
topicObserved
(
"
subdialog
-
loaded
"
)
;
MigrationUtils
.
showMigrationWizard
(
window
{
}
)
;
await
dialogPromise
;
await
wizardReady
;
Assert
.
ok
(
true
"
Migration
dialog
was
opened
"
)
;
let
dialogClosed
=
BrowserTestUtils
.
waitForEvent
(
window
"
dialogclose
"
)
;
EventUtils
.
sendKey
(
"
ESCAPE
"
)
;
await
dialogClosed
;
}
)
;
add_task
(
async
function
test_migration_dialog_open_in_xul_window
(
)
{
let
firstWindowOpened
=
BrowserTestUtils
.
domWindowOpened
(
)
;
MigrationUtils
.
showMigrationWizard
(
null
{
}
)
;
let
firstDialogWin
=
await
firstWindowOpened
;
await
BrowserTestUtils
.
waitForEvent
(
firstDialogWin
"
MigrationWizard
:
Ready
"
)
;
Assert
.
ok
(
true
"
Migration
dialog
was
opened
"
)
;
let
secondWindowOpened
=
BrowserTestUtils
.
domWindowOpened
(
)
;
MigrationUtils
.
showMigrationWizard
(
firstDialogWin
{
}
)
;
let
secondDialogWin
=
await
secondWindowOpened
;
await
BrowserTestUtils
.
waitForEvent
(
secondDialogWin
"
MigrationWizard
:
Ready
"
)
;
for
(
let
dialogWin
of
[
firstDialogWin
secondDialogWin
]
)
{
let
dialogClosed
=
BrowserTestUtils
.
domWindowClosed
(
dialogWin
)
;
dialogWin
.
close
(
)
;
await
dialogClosed
;
}
}
)
;
