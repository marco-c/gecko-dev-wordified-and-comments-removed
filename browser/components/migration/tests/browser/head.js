"
use
strict
"
;
const
scope
=
{
}
;
ChromeUtils
.
import
(
"
resource
:
/
/
/
modules
/
AutoMigrate
.
jsm
"
scope
)
;
const
oldCanUndo
=
scope
.
AutoMigrate
.
canUndo
;
const
oldUndo
=
scope
.
AutoMigrate
.
undo
;
registerCleanupFunction
(
function
(
)
{
scope
.
AutoMigrate
.
canUndo
=
oldCanUndo
;
scope
.
AutoMigrate
.
undo
=
oldUndo
;
}
)
;
const
kExpectedNotificationId
=
"
automigration
-
undo
"
;
function
getNotification
(
browser
)
{
const
box
=
gBrowser
.
getNotificationBox
(
browser
)
.
getNotificationWithValue
(
kExpectedNotificationId
)
;
if
(
!
box
)
{
executeSoon
(
(
)
=
>
scope
.
AutoMigrate
.
showUndoNotificationBar
(
browser
)
)
;
}
return
box
;
}
function
getOrWaitForNotification
(
browser
description
)
{
const
notification
=
getNotification
(
browser
)
;
if
(
notification
)
{
return
notification
;
}
info
(
Notification
for
{
description
}
not
immediately
present
waiting
for
it
.
)
;
return
BrowserTestUtils
.
waitForNotificationBar
(
gBrowser
browser
kExpectedNotificationId
)
;
}
