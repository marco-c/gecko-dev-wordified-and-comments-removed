var
EXPORTED_SYMBOLS
=
[
"
WindowsSupport
"
]
;
const
{
Services
}
=
ChromeUtils
.
import
(
"
resource
:
/
/
gre
/
modules
/
Services
.
jsm
"
)
;
const
{
SiteSpecificBrowserService
}
=
ChromeUtils
.
import
(
"
resource
:
/
/
/
modules
/
SiteSpecificBrowserService
.
jsm
"
)
;
ChromeUtils
.
defineModuleGetter
(
this
"
OS
"
"
resource
:
/
/
gre
/
modules
/
osfile
.
jsm
"
)
;
const
shellService
=
Cc
[
"
mozilla
.
org
/
browser
/
shell
-
service
;
1
"
]
.
getService
(
Ci
.
nsIWindowsShellService
)
;
const
File
=
Components
.
Constructor
(
"
mozilla
.
org
/
file
/
local
;
1
"
Ci
.
nsIFile
"
initWithPath
"
)
;
const
WindowsSupport
=
{
async
install
(
ssb
)
{
if
(
!
SiteSpecificBrowserService
.
useOSIntegration
)
{
return
;
}
let
desktop
=
Services
.
dirsvc
.
get
(
"
Desk
"
Ci
.
nsIFile
)
;
let
link
=
OS
.
Path
.
join
(
desktop
.
path
{
ssb
.
name
}
.
lnk
)
;
shellService
.
createShortcut
(
Services
.
dirsvc
.
get
(
"
XREExeF
"
Ci
.
nsIFile
)
[
"
-
profile
"
OS
.
Constants
.
Path
.
profileDir
"
-
start
-
ssb
"
ssb
.
id
]
ssb
.
name
new
File
(
link
)
)
;
}
async
uninstall
(
ssb
)
{
if
(
!
SiteSpecificBrowserService
.
useOSIntegration
)
{
return
;
}
let
desktop
=
Services
.
dirsvc
.
get
(
"
Desk
"
Ci
.
nsIFile
)
;
let
link
=
OS
.
Path
.
join
(
desktop
.
path
{
ssb
.
name
}
.
lnk
)
;
try
{
await
OS
.
File
.
remove
(
link
)
;
}
catch
(
e
)
{
console
.
error
(
e
)
;
}
}
}
;
