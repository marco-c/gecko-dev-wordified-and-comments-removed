add_task
(
async
(
)
=
>
{
Services
.
prefs
.
setBoolPref
(
"
browser
.
ssb
.
osintegration
"
true
)
;
let
ssb
=
SiteSpecificBrowser
.
createFromURI
(
uri
(
"
https
:
/
/
www
.
mozilla
.
org
/
"
)
)
;
await
ssb
.
install
(
)
;
let
ssbs
=
await
SiteSpecificBrowserService
.
list
(
)
;
Assert
.
equal
(
ssbs
.
length
1
)
;
Assert
.
equal
(
ssbs
[
0
]
ssb
)
;
let
kvstore
=
await
getKVStore
(
)
;
Assert
.
ok
(
await
kvstore
.
has
(
storeKey
(
ssb
.
id
)
)
)
;
let
data
=
JSON
.
parse
(
await
kvstore
.
get
(
ssb
:
{
ssb
.
id
}
)
)
;
Assert
.
ok
(
"
manifest
"
in
data
)
;
Assert
.
ok
(
"
config
"
in
data
)
;
if
(
AppConstants
.
platform
=
=
"
win
"
)
{
let
link
=
Services
.
dirsvc
.
get
(
"
Desk
"
Ci
.
nsIFile
)
;
link
.
append
(
"
www
.
mozilla
.
org
.
lnk
"
)
;
Assert
.
ok
(
link
.
isFile
(
)
)
;
await
ssb
.
uninstall
(
)
;
Assert
.
ok
(
!
link
.
exists
(
)
)
;
}
}
)
;
