async
function
testNewTabLoad
(
target
checker
)
{
let
ssb
=
await
openSSB
(
gHttpsTestRoot
+
"
test_page
.
html
#
"
+
target
)
;
let
promise
=
checker
(
ssb
)
;
await
BrowserTestUtils
.
synthesizeMouseAtCenter
(
"
#
new
-
tab
"
{
}
getBrowser
(
ssb
)
)
;
await
promise
;
await
BrowserTestUtils
.
closeWindow
(
ssb
)
;
}
add_task
(
async
function
local
(
)
{
await
testNewTabLoad
(
gHttpsTestRoot
+
"
empty_page
.
html
"
async
ssb
=
>
{
try
{
await
expectSSBLoad
(
ssb
)
;
Assert
.
equal
(
getBrowser
(
ssb
)
.
currentURI
.
spec
gHttpsTestRoot
+
"
empty_page
.
html
"
"
Should
have
loaded
the
right
uri
.
"
)
;
}
catch
(
e
)
{
}
}
)
;
}
)
;
add_task
(
async
function
insecure
(
)
{
await
testNewTabLoad
(
gHttpTestRoot
+
"
empty_page
.
html
"
async
ssb
=
>
{
try
{
let
tab
=
await
expectTabLoad
(
ssb
)
;
Assert
.
equal
(
tab
.
linkedBrowser
.
currentURI
.
spec
gHttpTestRoot
+
"
empty_page
.
html
"
"
Should
have
loaded
the
right
uri
.
"
)
;
BrowserTestUtils
.
removeTab
(
tab
)
;
}
catch
(
e
)
{
}
}
)
;
}
)
;
add_task
(
async
function
external
(
)
{
await
testNewTabLoad
(
gHttpsOtherRoot
+
"
empty_page
.
html
"
async
ssb
=
>
{
try
{
let
tab
=
await
expectTabLoad
(
ssb
)
;
Assert
.
equal
(
tab
.
linkedBrowser
.
currentURI
.
spec
gHttpsOtherRoot
+
"
empty_page
.
html
"
"
Should
have
loaded
the
right
uri
.
"
)
;
BrowserTestUtils
.
removeTab
(
tab
)
;
}
catch
(
e
)
{
}
}
)
;
}
)
;
