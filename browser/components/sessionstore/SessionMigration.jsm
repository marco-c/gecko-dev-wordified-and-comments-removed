"
use
strict
"
;
var
EXPORTED_SYMBOLS
=
[
"
SessionMigration
"
]
;
const
lazy
=
{
}
;
ChromeUtils
.
defineModuleGetter
(
lazy
"
E10SUtils
"
"
resource
:
/
/
gre
/
modules
/
E10SUtils
.
jsm
"
)
;
var
SessionMigrationInternal
=
{
convertState
(
aStateObj
)
{
let
state
=
{
selectedWindow
:
aStateObj
.
selectedWindow
_closedWindows
:
[
]
}
;
state
.
windows
=
aStateObj
.
windows
.
map
(
function
(
oldWin
)
{
var
win
=
{
extData
:
{
}
}
;
win
.
tabs
=
oldWin
.
tabs
.
map
(
function
(
oldTab
)
{
var
tab
=
{
}
;
tab
.
entries
=
oldTab
.
entries
.
map
(
function
(
entry
)
{
return
{
url
:
entry
.
url
triggeringPrincipal_base64
:
entry
.
triggeringPrincipal_base64
title
:
entry
.
title
}
;
}
)
;
tab
.
index
=
oldTab
.
index
;
tab
.
hidden
=
oldTab
.
hidden
;
tab
.
pinned
=
oldTab
.
pinned
;
return
tab
;
}
)
;
win
.
selected
=
oldWin
.
selected
;
win
.
_closedTabs
=
[
]
;
return
win
;
}
)
;
let
url
=
"
about
:
welcomeback
"
;
let
formdata
=
{
id
:
{
sessionData
:
state
}
url
}
;
let
entry
=
{
url
triggeringPrincipal_base64
:
lazy
.
E10SUtils
.
SERIALIZED_SYSTEMPRINCIPAL
}
;
return
{
windows
:
[
{
tabs
:
[
{
entries
:
[
entry
]
formdata
}
]
}
]
}
;
}
readState
(
aPath
)
{
return
IOUtils
.
readJSON
(
aPath
{
decompress
:
true
}
)
;
}
writeState
(
aPath
aState
)
{
return
IOUtils
.
writeJSON
(
aPath
aState
{
compress
:
true
tmpPath
:
{
aPath
}
.
tmp
}
)
;
}
}
;
var
SessionMigration
=
{
migrate
(
aFromPath
aToPath
)
{
return
(
async
function
(
)
{
let
inState
=
await
SessionMigrationInternal
.
readState
(
aFromPath
)
;
let
outState
=
SessionMigrationInternal
.
convertState
(
inState
)
;
await
SessionMigrationInternal
.
writeState
(
aToPath
outState
)
;
}
)
(
)
;
}
}
;
