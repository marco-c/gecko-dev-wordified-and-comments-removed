var
{
Services
}
=
ChromeUtils
.
import
(
"
resource
:
/
/
gre
/
modules
/
Services
.
jsm
"
)
;
const
{
OS
}
=
ChromeUtils
.
import
(
"
resource
:
/
/
gre
/
modules
/
osfile
.
jsm
"
)
;
ChromeUtils
.
defineModuleGetter
(
this
"
SessionStartup
"
"
resource
:
/
/
/
modules
/
sessionstore
/
SessionStartup
.
jsm
"
)
;
function
afterSessionStartupInitialization
(
cb
)
{
info
(
"
Waiting
for
session
startup
initialization
"
)
;
let
observer
=
function
(
)
{
try
{
info
(
"
Session
startup
initialization
observed
"
)
;
Services
.
obs
.
removeObserver
(
observer
"
sessionstore
-
state
-
finalized
"
)
;
cb
(
)
;
}
catch
(
ex
)
{
do_throw
(
ex
)
;
}
}
;
Services
.
obs
.
addObserver
(
observer
"
sessionstore
-
state
-
finalized
"
)
;
const
{
CrashMonitor
}
=
ChromeUtils
.
import
(
"
resource
:
/
/
gre
/
modules
/
CrashMonitor
.
jsm
"
)
;
CrashMonitor
.
init
(
)
;
SessionStartup
.
init
(
)
;
}
async
function
writeCompressedFile
(
source
destination
)
{
let
s
=
await
OS
.
File
.
read
(
source
)
;
await
OS
.
File
.
writeAtomic
(
destination
s
{
compression
:
"
lz4
"
}
)
;
await
OS
.
File
.
remove
(
source
)
;
}
