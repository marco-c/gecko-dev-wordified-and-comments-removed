"
use
strict
"
;
var
uniqueName
=
"
bug
465215
"
;
var
uniqueValue1
=
"
as
good
as
unique
:
"
+
Date
.
now
(
)
;
var
uniqueValue2
=
"
as
good
as
unique
:
"
+
Math
.
random
(
)
;
add_task
(
async
function
(
)
{
let
tab1
=
BrowserTestUtils
.
addTab
(
gBrowser
"
about
:
blank
"
)
;
await
BrowserTestUtils
.
browserLoaded
(
tab1
.
linkedBrowser
{
wantLoad
:
"
about
:
blank
"
}
)
;
ss
.
setCustomTabValue
(
tab1
uniqueName
uniqueValue1
)
;
let
tab2
=
ss
.
duplicateTab
(
window
tab1
)
;
await
promiseTabRestored
(
tab2
)
;
is
(
ss
.
getCustomTabValue
(
tab2
uniqueName
)
uniqueValue1
"
tab
value
was
duplicated
"
)
;
ss
.
setCustomTabValue
(
tab2
uniqueName
uniqueValue2
)
;
isnot
(
ss
.
getCustomTabValue
(
tab1
uniqueName
)
uniqueValue2
"
tab
values
aren
'
t
sync
'
d
"
)
;
await
promiseTabState
(
tab1
{
entries
:
[
]
}
)
;
is
(
ss
.
getCustomTabValue
(
tab1
uniqueName
)
"
"
"
tab
value
was
cleared
"
)
;
gBrowser
.
removeTab
(
tab2
)
;
gBrowser
.
removeTab
(
tab1
)
;
}
)
;
