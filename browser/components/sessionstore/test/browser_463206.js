"
use
strict
"
;
const
TEST_URL
=
"
http
:
/
/
mochi
.
test
:
8888
/
browser
/
"
+
"
browser
/
components
/
sessionstore
/
test
/
browser_463206_sample
.
html
"
;
add_task
(
async
function
(
)
{
let
tab
=
BrowserTestUtils
.
addTab
(
gBrowser
TEST_URL
)
;
await
BrowserTestUtils
.
browserLoaded
(
tab
.
linkedBrowser
)
;
await
SpecialPowers
.
spawn
(
tab
.
linkedBrowser
[
]
async
function
(
)
{
function
typeText
(
aTextField
aValue
)
{
aTextField
.
value
=
aValue
;
let
event
=
aTextField
.
ownerDocument
.
createEvent
(
"
UIEvents
"
)
;
event
.
initUIEvent
(
"
input
"
true
true
aTextField
.
ownerGlobal
0
)
;
aTextField
.
dispatchEvent
(
event
)
;
}
typeText
(
content
.
document
.
getElementById
(
"
out1
"
)
Date
.
now
(
)
.
toString
(
16
)
)
;
typeText
(
content
.
document
.
getElementsByName
(
"
1
|
#
out2
"
)
[
0
]
Math
.
random
(
)
)
;
typeText
(
content
.
frames
[
0
]
.
frames
[
1
]
.
document
.
getElementById
(
"
in1
"
)
new
Date
(
)
)
;
}
)
;
let
tab2
=
gBrowser
.
duplicateTab
(
tab
)
;
await
promiseTabRestored
(
tab2
)
;
await
SpecialPowers
.
spawn
(
tab2
.
linkedBrowser
[
]
async
function
(
)
{
Assert
.
notEqual
(
content
.
document
.
getElementById
(
"
out1
"
)
.
value
content
.
frames
[
1
]
.
document
.
getElementById
(
"
out1
"
)
.
value
"
text
isn
'
t
reused
for
frames
"
)
;
Assert
.
notEqual
(
content
.
document
.
getElementsByName
(
"
1
|
#
out2
"
)
[
0
]
.
value
"
"
"
text
containing
|
and
#
is
correctly
restored
"
)
;
Assert
.
equal
(
content
.
frames
[
1
]
.
document
.
getElementById
(
"
out2
"
)
.
value
"
"
"
id
prefixes
can
'
t
be
faked
"
)
;
Assert
.
equal
(
content
.
frames
[
1
]
.
frames
[
0
]
.
document
.
getElementById
(
"
in1
"
)
.
value
"
"
"
id
prefixes
aren
'
t
mixed
up
"
)
;
}
)
;
gBrowser
.
removeTab
(
tab2
)
;
gBrowser
.
removeTab
(
tab
)
;
}
)
;
