add_task
(
async
function
test
(
)
{
let
win
=
await
BrowserTestUtils
.
openNewBrowserWindow
(
)
;
async
function
changeSizeMode
(
mode
)
{
let
promise
=
BrowserTestUtils
.
waitForEvent
(
win
"
sizemodechange
"
)
;
win
[
mode
]
(
)
;
await
promise
;
}
function
checkCurrentState
(
sizemodeBeforeMinimized
)
{
let
state
=
JSON
.
parse
(
ss
.
getWindowState
(
win
)
)
;
let
winState
=
state
.
windows
[
0
]
;
is
(
winState
.
sizemodeBeforeMinimized
sizemodeBeforeMinimized
"
sizemodeBeforeMinimized
should
match
"
)
;
}
if
(
win
.
windowState
!
=
win
.
STATE_NORMAL
)
{
await
changeSizeMode
(
"
restore
"
)
;
}
ss
.
getWindowState
(
win
)
;
await
changeSizeMode
(
"
minimize
"
)
;
checkCurrentState
(
"
normal
"
)
;
await
BrowserTestUtils
.
closeWindow
(
win
)
;
win
=
await
BrowserTestUtils
.
openNewBrowserWindow
(
)
;
if
(
win
.
windowState
!
=
win
.
STATE_MAXIMIZED
)
{
await
changeSizeMode
(
"
maximize
"
)
;
}
ss
.
getWindowState
(
win
)
;
await
changeSizeMode
(
"
minimize
"
)
;
checkCurrentState
(
"
maximized
"
)
;
await
BrowserTestUtils
.
closeWindow
(
win
)
;
}
)
;
