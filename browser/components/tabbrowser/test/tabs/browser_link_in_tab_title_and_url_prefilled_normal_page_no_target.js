Services
.
scriptloader
.
loadSubScript
(
"
chrome
:
/
/
mochitests
/
content
/
browser
/
browser
/
components
/
tabbrowser
/
test
/
tabs
/
common_link_in_tab_title_and_url_prefilled
.
js
"
this
)
;
const
{
UrlbarTestUtils
}
=
ChromeUtils
.
importESModule
(
"
resource
:
/
/
testing
-
common
/
UrlbarTestUtils
.
sys
.
mjs
"
)
;
add_task
(
async
function
normal_page__no_target
(
)
{
await
doTestInSameWindow
(
{
link
:
"
wait
-
a
-
bit
-
-
no
-
target
"
openBy
:
OPEN_BY
.
CLICK
openAs
:
OPEN_AS
.
FOREGROUND
loadingState
:
{
tab
:
HOME_TITLE
urlbar
:
UrlbarTestUtils
.
trimURL
(
HOME_URL
)
}
async
actionWhileLoading
(
onTabLoaded
)
{
info
(
"
Wait
until
loading
the
link
target
"
)
;
await
onTabLoaded
;
}
finalState
:
{
tab
:
WAIT_A_BIT_PAGE_TITLE
urlbar
:
UrlbarTestUtils
.
trimURL
(
WAIT_A_BIT_URL
)
history
:
[
HOME_URL
WAIT_A_BIT_URL
]
}
}
)
;
}
)
;
add_task
(
async
function
normal_page__no_target__abort
(
)
{
await
doTestInSameWindow
(
{
link
:
"
wait
-
a
-
bit
-
-
no
-
target
"
openBy
:
OPEN_BY
.
CLICK
openAs
:
OPEN_AS
.
FOREGROUND
loadingState
:
{
tab
:
HOME_TITLE
urlbar
:
UrlbarTestUtils
.
trimURL
(
HOME_URL
)
}
async
actionWhileLoading
(
)
{
info
(
"
Abort
loading
"
)
;
document
.
getElementById
(
"
stop
-
button
"
)
.
click
(
)
;
}
finalState
:
{
tab
:
HOME_TITLE
urlbar
:
UrlbarTestUtils
.
trimURL
(
HOME_URL
)
history
:
[
HOME_URL
]
}
}
)
;
}
)
;
add_task
(
async
function
normal_page__no_target__timeout
(
)
{
await
doTestInSameWindow
(
{
link
:
"
request
-
timeout
-
-
no
-
target
"
openBy
:
OPEN_BY
.
CLICK
openAs
:
OPEN_AS
.
FOREGROUND
loadingState
:
{
tab
:
HOME_TITLE
urlbar
:
UrlbarTestUtils
.
trimURL
(
HOME_URL
)
}
async
actionWhileLoading
(
onTabLoaded
)
{
info
(
"
Wait
until
loading
the
link
target
"
)
;
await
onTabLoaded
;
}
finalState
:
{
tab
:
REQUEST_TIMEOUT_LOADING_TITLE
urlbar
:
UrlbarTestUtils
.
trimURL
(
REQUEST_TIMEOUT_URL
)
history
:
[
HOME_URL
REQUEST_TIMEOUT_URL
]
}
}
)
;
}
)
;
add_task
(
async
function
normal_page__no_target__session_restore
(
)
{
await
doSessionRestoreTest
(
{
link
:
"
wait
-
a
-
bit
-
-
no
-
target
"
openBy
:
OPEN_BY
.
CLICK
openAs
:
OPEN_AS
.
FOREGROUND
expectedSessionRestored
:
false
}
)
;
}
)
;
