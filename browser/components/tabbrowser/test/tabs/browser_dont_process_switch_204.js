const
TEST_ROOT
=
getRootDirectory
(
gTestPath
)
.
replace
(
"
chrome
:
/
/
mochitests
/
content
"
"
https
:
/
/
example
.
com
"
)
;
const
TEST_URL
=
TEST_ROOT
+
"
204
.
sjs
"
;
const
BLANK_URL
=
TEST_ROOT
+
"
blank
.
html
"
;
add_task
(
async
function
(
)
{
await
BrowserTestUtils
.
withNewTab
(
"
about
:
robots
"
async
function
(
aBrowser
)
{
let
browserPid
=
await
SpecialPowers
.
spawn
(
aBrowser
[
]
(
)
=
>
{
return
Services
.
appinfo
.
processID
;
}
)
;
is
(
Services
.
appinfo
.
processID
browserPid
"
about
:
robots
should
have
loaded
in
the
parent
"
)
;
let
stopped
=
BrowserTestUtils
.
browserStopped
(
aBrowser
TEST_URL
true
)
;
BrowserTestUtils
.
startLoadingURIString
(
aBrowser
TEST_URL
)
;
await
stopped
;
let
newPid
=
await
SpecialPowers
.
spawn
(
aBrowser
[
]
(
)
=
>
{
return
Services
.
appinfo
.
processID
;
}
)
;
is
(
browserPid
newPid
"
Shouldn
'
t
change
process
when
we
get
a
204
response
"
)
;
let
loaded
=
BrowserTestUtils
.
browserLoaded
(
aBrowser
false
BLANK_URL
)
;
BrowserTestUtils
.
startLoadingURIString
(
aBrowser
BLANK_URL
)
;
await
loaded
;
newPid
=
await
SpecialPowers
.
spawn
(
aBrowser
[
]
(
)
=
>
{
return
Services
.
appinfo
.
processID
;
}
)
;
isnot
(
browserPid
newPid
"
Should
change
process
for
a
valid
response
"
)
;
}
)
;
}
)
;
