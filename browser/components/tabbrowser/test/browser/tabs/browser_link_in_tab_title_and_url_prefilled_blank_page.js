ChromeUtils
.
defineESModuleGetters
(
this
{
UrlbarTestUtils
:
"
resource
:
/
/
testing
-
common
/
UrlbarTestUtils
.
sys
.
mjs
"
}
)
;
Services
.
scriptloader
.
loadSubScript
(
"
chrome
:
/
/
mochitests
/
content
/
browser
/
browser
/
components
/
tabbrowser
/
test
/
browser
/
tabs
/
common_link_in_tab_title_and_url_prefilled
.
js
"
this
)
;
add_task
(
async
function
blank_target__foreground
(
)
{
await
doTestInSameWindow
(
{
link
:
"
blank
-
page
-
-
blank
-
target
"
openBy
:
OPEN_BY
.
CLICK
openAs
:
OPEN_AS
.
FOREGROUND
loadingState
:
{
tab
:
BLANK_TITLE
urlbar
:
"
"
}
async
actionWhileLoading
(
onTabLoaded
)
{
info
(
"
Wait
until
loading
the
link
target
"
)
;
await
onTabLoaded
;
}
finalState
:
{
tab
:
BLANK_TITLE
urlbar
:
"
"
history
:
[
BLANK_URL
]
}
}
)
;
}
)
;
add_task
(
async
function
blank_target__background
(
)
{
await
doTestInSameWindow
(
{
link
:
"
blank
-
page
-
-
blank
-
target
"
openBy
:
OPEN_BY
.
CLICK
openAs
:
OPEN_AS
.
BACKGROUND
loadingState
:
{
tab
:
BLANK_TITLE
urlbar
:
UrlbarTestUtils
.
trimURL
(
HOME_URL
)
}
async
actionWhileLoading
(
onTabLoaded
)
{
info
(
"
Wait
until
loading
the
link
target
"
)
;
await
onTabLoaded
;
}
finalState
:
{
tab
:
BLANK_TITLE
urlbar
:
UrlbarTestUtils
.
trimURL
(
HOME_URL
)
history
:
[
BLANK_URL
]
}
}
)
;
}
)
;
add_task
(
async
function
other_target__foreground
(
)
{
await
doTestInSameWindow
(
{
link
:
"
blank
-
page
-
-
other
-
target
"
openBy
:
OPEN_BY
.
CLICK
openAs
:
OPEN_AS
.
FOREGROUND
loadingState
:
{
tab
:
BLANK_TITLE
urlbar
:
UrlbarTestUtils
.
trimURL
(
BLANK_URL
)
}
async
actionWhileLoading
(
onTabLoaded
)
{
info
(
"
Wait
until
loading
the
link
target
"
)
;
await
onTabLoaded
;
}
finalState
:
{
tab
:
BLANK_TITLE
urlbar
:
UrlbarTestUtils
.
trimURL
(
BLANK_URL
)
history
:
[
BLANK_URL
]
}
}
)
;
}
)
;
add_task
(
async
function
other_target__background
(
)
{
await
doTestInSameWindow
(
{
link
:
"
blank
-
page
-
-
other
-
target
"
openBy
:
OPEN_BY
.
CLICK
openAs
:
OPEN_AS
.
BACKGROUND
loadingState
:
{
tab
:
BLANK_TITLE
urlbar
:
UrlbarTestUtils
.
trimURL
(
HOME_URL
)
}
async
actionWhileLoading
(
onTabLoaded
)
{
info
(
"
Wait
until
loading
the
link
target
"
)
;
await
onTabLoaded
;
}
finalState
:
{
tab
:
BLANK_TITLE
urlbar
:
UrlbarTestUtils
.
trimURL
(
HOME_URL
)
history
:
[
BLANK_URL
]
}
}
)
;
}
)
;
add_task
(
async
function
by_script
(
)
{
await
doTestInSameWindow
(
{
link
:
"
blank
-
page
-
-
by
-
script
"
openBy
:
OPEN_BY
.
CLICK
openAs
:
OPEN_AS
.
FOREGROUND
loadingState
:
{
tab
:
BLANK_TITLE
urlbar
:
UrlbarTestUtils
.
trimURL
(
BLANK_URL
)
}
async
actionWhileLoading
(
_onTabLoaded
)
{
info
(
"
Skip
waiting
for
link
target
to
load
"
)
;
}
finalState
:
{
tab
:
BLANK_TITLE
urlbar
:
UrlbarTestUtils
.
trimURL
(
BLANK_URL
)
history
:
[
BLANK_URL
]
}
}
)
;
}
)
;
add_task
(
async
function
no_target
(
)
{
await
doTestInSameWindow
(
{
link
:
"
blank
-
page
-
-
no
-
target
"
openBy
:
OPEN_BY
.
CLICK
openAs
:
OPEN_AS
.
FOREGROUND
loadingState
:
{
tab
:
HOME_TITLE
urlbar
:
UrlbarTestUtils
.
trimURL
(
HOME_URL
)
}
async
actionWhileLoading
(
onTabLoaded
)
{
info
(
"
Wait
until
loading
the
link
target
"
)
;
await
onTabLoaded
;
}
finalState
:
{
tab
:
BLANK_TITLE
urlbar
:
UrlbarTestUtils
.
trimURL
(
BLANK_URL
)
history
:
[
HOME_URL
BLANK_URL
]
}
}
)
;
}
)
;
