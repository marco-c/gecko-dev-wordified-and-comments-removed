"
use
strict
"
;
async
function
waitForAllTabsMenu
(
window
=
window
)
{
await
BrowserTestUtils
.
waitForCondition
(
(
)
=
>
window
.
document
.
getElementById
(
"
customizationui
-
widget
-
panel
"
)
!
=
null
)
;
let
menu
=
window
.
document
.
getElementById
(
"
customizationui
-
widget
-
panel
"
)
;
if
(
menu
.
state
!
=
"
open
"
)
{
await
BrowserTestUtils
.
waitForEvent
(
menu
"
popupshown
"
)
;
is
(
menu
.
state
"
open
"
All
tabs
menu
is
open
)
;
}
return
menu
;
}
add_task
(
async
function
test_open_tabmanager_keyboard
(
)
{
await
SpecialPowers
.
pushPrefEnv
(
{
set
:
[
[
"
browser
.
tabs
.
tabmanager
.
enabled
"
true
]
]
}
)
;
let
newWindow
=
await
BrowserTestUtils
.
openNewBrowserWindow
(
)
;
let
elem
=
newWindow
.
document
.
getElementById
(
"
alltabs
-
button
"
)
;
elem
.
setAttribute
(
"
tabindex
"
"
-
1
"
)
;
elem
.
focus
(
)
;
let
focused
=
BrowserTestUtils
.
waitForEvent
(
newWindow
"
focus
"
true
)
;
EventUtils
.
synthesizeKey
(
"
"
{
}
newWindow
)
;
let
event
=
await
focused
;
let
allTabsMenu
=
await
waitForAllTabsMenu
(
newWindow
)
;
elem
.
removeAttribute
(
"
tabindex
"
)
;
ok
(
event
.
originalTarget
.
closest
(
"
#
allTabsMenu
-
allTabsView
"
)
"
Focus
inside
all
tabs
menu
after
toolbar
button
pressed
"
)
;
let
hidden
=
BrowserTestUtils
.
waitForEvent
(
allTabsMenu
"
popuphidden
"
)
;
EventUtils
.
synthesizeKey
(
"
KEY_Escape
"
{
shiftKey
:
false
}
newWindow
)
;
await
hidden
;
await
BrowserTestUtils
.
closeWindow
(
newWindow
)
;
}
)
;
