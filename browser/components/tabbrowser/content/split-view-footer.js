"
use
strict
"
;
{
ChromeUtils
.
defineESModuleGetters
(
this
{
BrowserUtils
:
"
resource
:
/
/
gre
/
modules
/
BrowserUtils
.
sys
.
mjs
"
}
)
;
class
MozSplitViewFooter
extends
MozXULElement
{
#
initialized
=
false
;
#
isInsecure
=
false
;
securityElement
=
null
;
iconElement
=
null
;
#
iconSrc
=
"
"
;
uriElement
=
null
;
#
uri
=
null
;
#
browserProgressListener
=
{
QueryInterface
:
ChromeUtils
.
generateQI
(
[
Ci
.
nsIWebProgressListener
Ci
.
nsISupportsWeakReference
]
)
onLocationChange
:
(
aWebProgress
aRequest
aLocation
)
=
>
{
if
(
aWebProgress
?
.
isTopLevel
&
&
aLocation
)
{
this
.
#
updateUri
(
aLocation
)
;
}
}
onSecurityChange
:
(
aWebProgress
aRequest
aState
)
=
>
this
.
#
toggleInsecure
(
!
!
(
aState
&
Ci
.
nsIWebProgressListener
.
STATE_IS_INSECURE
|
|
aState
&
Ci
.
nsIWebProgressListener
.
STATE_IS_BROKEN
)
)
}
;
#
tab
=
null
;
static
markup
=
<
hbox
class
=
"
split
-
view
-
security
-
warning
"
hidden
=
"
"
>
<
html
:
img
role
=
"
presentation
"
src
=
"
chrome
:
/
/
global
/
skin
/
icons
/
security
-
broken
.
svg
"
/
>
<
html
:
span
data
-
l10n
-
id
=
"
urlbar
-
trust
-
icon
-
notsecure
-
label
"
>
<
/
html
:
span
>
<
/
hbox
>
<
html
:
img
class
=
"
split
-
view
-
icon
"
hidden
=
"
"
role
=
"
presentation
"
/
>
<
html
:
span
class
=
"
split
-
view
-
uri
"
>
<
/
html
:
span
>
<
toolbarbutton
type
=
"
menu
"
image
=
"
chrome
:
/
/
global
/
skin
/
icons
/
more
.
svg
"
>
<
menupopup
class
=
"
split
-
view
-
footer
-
menu
"
>
<
menuitem
command
=
"
splitViewCmd_separateTabs
"
data
-
l10n
-
id
=
"
split
-
view
-
menuitem
-
separate
-
tabs
"
/
>
<
menuitem
command
=
"
splitViewCmd_reverseTabs
"
data
-
l10n
-
id
=
"
split
-
view
-
menuitem
-
reverse
-
tabs
"
/
>
<
menuseparator
/
>
<
menuitem
command
=
"
splitViewCmd_closeTabs
"
data
-
l10n
-
id
=
"
split
-
view
-
menuitem
-
close
-
both
-
tabs
"
/
>
<
/
menupopup
>
<
/
toolbarbutton
>
;
connectedCallback
(
)
{
if
(
this
.
#
initialized
)
{
return
;
}
this
.
appendChild
(
this
.
constructor
.
fragment
)
;
this
.
securityElement
=
this
.
querySelector
(
"
.
split
-
view
-
security
-
warning
"
)
;
this
.
iconElement
=
this
.
querySelector
(
"
.
split
-
view
-
icon
"
)
;
this
.
uriElement
=
this
.
querySelector
(
"
.
split
-
view
-
uri
"
)
;
this
.
#
updateSecurityElement
(
)
;
this
.
#
updateIconElement
(
)
;
this
.
#
updateUriElement
(
)
;
this
.
#
initialized
=
true
;
}
disconnectedCallback
(
)
{
this
.
#
resetTab
(
)
;
}
handleEvent
(
e
)
{
switch
(
e
.
type
)
{
case
"
TabAttrModified
"
:
for
(
const
attribute
of
e
.
detail
.
changed
)
{
this
.
#
handleTabAttrModified
(
attribute
)
;
}
break
;
}
}
#
handleTabAttrModified
(
attribute
)
{
switch
(
attribute
)
{
case
"
image
"
:
this
.
#
updateIconSrc
(
this
.
#
tab
.
image
)
;
break
;
}
}
#
toggleInsecure
(
isInsecure
)
{
this
.
#
isInsecure
=
isInsecure
;
if
(
this
.
securityElement
)
{
this
.
#
updateSecurityElement
(
)
;
}
if
(
this
.
iconElement
)
{
this
.
#
updateIconElement
(
)
;
}
}
#
updateSecurityElement
(
)
{
const
isWebsite
=
this
.
#
uri
.
schemeIs
(
"
http
"
)
|
|
this
.
#
uri
.
schemeIs
(
"
https
"
)
;
this
.
securityElement
.
hidden
=
!
isWebsite
|
|
!
this
.
#
isInsecure
;
}
#
updateIconSrc
(
iconSrc
)
{
this
.
#
iconSrc
=
iconSrc
;
if
(
this
.
iconElement
)
{
this
.
#
updateIconElement
(
)
;
}
}
#
updateIconElement
(
)
{
let
canShowIcon
=
!
this
.
#
isInsecure
&
&
this
.
#
iconSrc
;
if
(
canShowIcon
)
{
this
.
iconElement
.
setAttribute
(
"
src
"
this
.
#
iconSrc
)
;
}
else
{
this
.
iconElement
.
removeAttribute
(
"
src
"
)
;
}
this
.
iconElement
.
hidden
=
!
canShowIcon
;
}
#
updateUri
(
uri
)
{
this
.
hidden
=
uri
.
specIgnoringRef
=
=
=
"
about
:
opentabs
"
;
this
.
#
uri
=
uri
;
if
(
this
.
uriElement
)
{
this
.
#
updateUriElement
(
)
;
}
if
(
this
.
securityElement
)
{
this
.
#
updateSecurityElement
(
)
;
}
}
#
updateUriElement
(
)
{
const
uriString
=
this
.
#
uri
?
BrowserUtils
.
formatURIForDisplay
(
this
.
#
uri
)
:
"
"
;
this
.
uriElement
.
textContent
=
uriString
;
}
setTab
(
tab
)
{
this
.
#
resetTab
(
)
;
this
.
#
updateIconSrc
(
tab
.
image
)
;
tab
.
addEventListener
(
"
TabAttrModified
"
this
)
;
this
.
#
updateUri
(
tab
.
linkedBrowser
.
currentURI
)
;
const
securityState
=
tab
.
linkedBrowser
.
securityUI
.
state
;
this
.
#
toggleInsecure
(
!
!
(
securityState
&
Ci
.
nsIWebProgressListener
.
STATE_IS_INSECURE
|
|
securityState
&
Ci
.
nsIWebProgressListener
.
STATE_IS_BROKEN
)
)
;
tab
.
linkedBrowser
.
addProgressListener
(
this
.
#
browserProgressListener
Ci
.
nsIWebProgress
.
NOTIFY_LOCATION
|
Ci
.
nsIWebProgress
.
NOTIFY_SECURITY
)
;
this
.
#
tab
=
tab
;
}
#
resetTab
(
)
{
if
(
this
.
#
tab
)
{
this
.
#
tab
.
removeEventListener
(
"
TabAttrModified
"
this
)
;
this
.
#
tab
.
linkedBrowser
?
.
removeProgressListener
(
this
.
#
browserProgressListener
)
;
}
this
.
#
tab
=
null
;
}
}
customElements
.
define
(
"
split
-
view
-
footer
"
MozSplitViewFooter
)
;
}
