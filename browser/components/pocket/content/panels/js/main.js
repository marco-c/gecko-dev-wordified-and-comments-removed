var
PKT_PANEL
=
function
(
)
{
}
;
PKT_PANEL
.
prototype
=
{
init
(
)
{
if
(
this
.
inited
)
{
return
;
}
this
.
overlay
=
new
PKT_PANEL_OVERLAY
(
)
;
this
.
setupMutationObserver
(
)
;
this
.
setupIntersectionObserver
(
)
;
this
.
inited
=
true
;
}
resizeParent
(
)
{
let
clientHeight
=
document
.
body
.
clientHeight
;
if
(
this
.
overlay
.
tagsDropdownOpen
)
{
clientHeight
=
Math
.
max
(
clientHeight
252
)
;
}
if
(
clientHeight
)
{
pktPanelMessaging
.
sendMessage
(
"
PKT_resizePanel
"
{
width
:
document
.
body
.
clientWidth
height
:
clientHeight
}
)
;
}
}
clickHelper
(
element
{
source
=
"
"
position
}
)
{
element
?
.
addEventListener
(
click
event
=
>
{
event
.
preventDefault
(
)
;
pktPanelMessaging
.
sendMessage
(
"
PKT_openTabWithUrl
"
{
url
:
event
.
currentTarget
.
getAttribute
(
href
)
activate
:
true
source
position
}
)
;
}
)
;
}
setupIntersectionObserver
(
)
{
const
observer
=
new
IntersectionObserver
(
entries
=
>
{
if
(
entries
.
find
(
e
=
>
e
.
isIntersecting
)
)
{
this
.
resizeParent
(
)
;
observer
.
unobserve
(
document
.
body
)
;
}
}
)
;
observer
.
observe
(
document
.
body
)
;
}
setupMutationObserver
(
)
{
const
targetNode
=
document
.
body
;
const
config
=
{
attributes
:
false
childList
:
true
subtree
:
true
}
;
const
callback
=
(
mutationList
observer
)
=
>
{
mutationList
.
forEach
(
mutation
=
>
{
switch
(
mutation
.
type
)
{
case
"
childList
"
:
{
this
.
resizeParent
(
)
;
break
;
}
}
}
)
;
}
;
const
observer
=
new
MutationObserver
(
callback
)
;
observer
.
observe
(
targetNode
config
)
;
}
create
(
)
{
this
.
overlay
.
create
(
)
;
}
}
;
function
onDOMLoaded
(
)
{
if
(
!
window
.
thePKT_PANEL
)
{
var
thePKT_PANEL
=
new
PKT_PANEL
(
)
;
window
.
thePKT_PANEL
=
thePKT_PANEL
;
thePKT_PANEL
.
init
(
)
;
}
window
.
thePKT_PANEL
.
create
(
)
;
}
if
(
document
.
readyState
!
=
loading
)
{
onDOMLoaded
(
)
;
}
else
{
document
.
addEventListener
(
DOMContentLoaded
onDOMLoaded
)
;
}
