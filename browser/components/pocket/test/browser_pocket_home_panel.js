"
use
strict
"
;
add_task
(
async
function
(
)
{
await
SpecialPowers
.
pushPrefEnv
(
{
set
:
[
[
"
extensions
.
pocket
.
refresh
.
hideRecentSaves
.
enabled
"
true
]
]
}
)
;
let
tab
=
await
BrowserTestUtils
.
openNewForegroundTab
(
gBrowser
"
about
:
robots
"
)
;
const
stub
=
sinon
.
stub
(
pktApi
"
isUserLoggedIn
"
)
.
callsFake
(
(
)
=
>
true
)
;
info
(
"
clicking
on
pocket
button
in
toolbar
"
)
;
let
pocketButton
=
document
.
getElementById
(
"
save
-
to
-
pocket
-
button
"
)
;
let
pocketPanelShowing
=
BrowserTestUtils
.
waitForEvent
(
document
"
popupshowing
"
true
)
;
pocketButton
.
click
(
)
;
await
pocketPanelShowing
;
let
pocketPanel
=
document
.
getElementById
(
"
customizationui
-
widget
-
panel
"
)
;
let
pocketFrame
=
pocketPanel
.
querySelector
(
"
browser
"
)
;
await
TestUtils
.
waitForCondition
(
(
)
=
>
pocketFrame
.
src
.
startsWith
(
"
about
:
pocket
-
home
?
"
)
"
pocket
home
panel
is
showing
"
)
;
info
(
"
closing
pocket
panel
"
)
;
let
pocketPanelHidden
=
BrowserTestUtils
.
waitForEvent
(
pocketPanel
"
popuphidden
"
)
;
pocketPanel
.
hidePopup
(
)
;
await
pocketPanelHidden
;
checkElements
(
false
[
"
customizationui
-
widget
-
panel
"
]
)
;
stub
.
restore
(
)
;
BrowserTestUtils
.
removeTab
(
tab
)
;
}
)
;
