"
use
strict
"
;
const
{
sinon
}
=
ChromeUtils
.
importESModule
(
"
resource
:
/
/
testing
-
common
/
Sinon
.
sys
.
mjs
"
)
;
add_setup
(
(
)
=
>
{
sinon
.
stub
(
SelectableProfileService
"
execProcess
"
)
;
registerCleanupFunction
(
(
)
=
>
{
sinon
.
restore
(
)
;
}
)
;
}
)
;
async
function
promiseAppMenuOpened
(
)
{
let
promiseViewShown
=
BrowserTestUtils
.
waitForEvent
(
PanelUI
.
panel
"
ViewShown
"
)
;
PanelUI
.
show
(
)
;
return
promiseViewShown
;
}
add_task
(
async
function
test_appmenu_updates_on_edit
(
)
{
await
SelectableProfileService
.
createNewProfile
(
)
;
const
INITIAL_NAME
=
"
Initial
name
"
;
const
UPDATED_NAME
=
"
Updated
"
;
SelectableProfileService
.
currentProfile
.
name
=
INITIAL_NAME
;
await
promiseAppMenuOpened
(
)
;
let
view
=
PanelMultiView
.
getViewNode
(
document
"
appMenu
-
profiles
-
button
"
)
;
Assert
.
equal
(
view
.
label
INITIAL_NAME
"
expected
the
initial
name
"
)
;
SelectableProfileService
.
currentProfile
.
name
=
UPDATED_NAME
;
PanelUI
.
hide
(
)
;
await
promiseAppMenuOpened
(
)
;
Assert
.
equal
(
view
.
label
UPDATED_NAME
"
expected
the
name
to
be
updated
"
)
;
PanelUI
.
hide
(
)
;
}
)
;
