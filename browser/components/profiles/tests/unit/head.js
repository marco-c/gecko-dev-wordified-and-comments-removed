"
use
strict
"
;
const
{
SelectableProfile
}
=
ChromeUtils
.
importESModule
(
"
resource
:
/
/
/
modules
/
profiles
/
SelectableProfile
.
sys
.
mjs
"
)
;
const
lazy
=
{
}
;
ChromeUtils
.
defineLazyGetter
(
lazy
"
SelectableProfileService
"
(
)
=
>
{
const
{
SelectableProfileService
}
=
ChromeUtils
.
importESModule
(
"
resource
:
/
/
/
modules
/
profiles
/
SelectableProfileService
.
sys
.
mjs
"
)
;
SelectableProfileService
.
overrideDirectoryService
(
{
ProfD
:
getProfileService
(
)
.
currentProfile
.
rootDir
}
)
;
return
SelectableProfileService
;
}
)
;
let
gProfileServiceInitialised
=
false
;
function
startProfileService
(
)
{
if
(
gProfileServiceInitialised
)
{
return
;
}
gProfileServiceInitialised
=
true
;
selectStartupProfile
(
)
;
}
function
getSelectableProfileService
(
)
{
return
lazy
.
SelectableProfileService
;
}
async
function
initSelectableProfileService
(
)
{
startProfileService
(
)
;
const
SelectableProfileService
=
getSelectableProfileService
(
)
;
await
SelectableProfileService
.
init
(
)
;
await
SelectableProfileService
.
maybeSetupDataStore
(
)
;
}
function
getRelativeProfilePath
(
path
)
{
let
relativePath
=
path
.
getRelativePath
(
Services
.
dirsvc
.
get
(
"
UAppData
"
Ci
.
nsIFile
)
)
;
if
(
AppConstants
.
platform
=
=
=
"
win
"
)
{
relativePath
=
relativePath
.
replace
(
"
/
"
"
\
\
"
)
;
}
return
relativePath
;
}
async
function
createTestProfile
(
profileData
=
{
}
)
{
const
SelectableProfileService
=
getSelectableProfileService
(
)
;
let
name
=
profileData
.
name
?
?
"
Test
"
;
let
path
=
profileData
.
path
;
if
(
!
path
)
{
path
=
await
SelectableProfileService
.
createProfileDirs
(
name
)
;
await
SelectableProfileService
.
createProfileInitialFiles
(
path
)
;
path
=
SelectableProfileService
.
getRelativeProfilePath
(
path
)
;
}
return
SelectableProfileService
.
insertProfile
(
{
avatar
:
profileData
.
avatar
?
?
"
book
"
name
path
themeBg
:
profileData
.
themeBg
?
?
"
var
(
-
-
background
-
color
-
box
)
"
themeFg
:
profileData
.
themeFg
?
?
"
var
(
-
-
text
-
color
)
"
themeL10nId
:
profileData
.
themeL10nId
?
?
"
default
"
}
)
;
}
