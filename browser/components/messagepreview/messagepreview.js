"
use
strict
"
;
function
fromBinary
(
encoded
)
{
const
binary
=
atob
(
decodeURIComponent
(
encoded
)
)
;
const
bytes
=
new
Uint8Array
(
binary
.
length
)
;
for
(
let
i
=
0
;
i
<
bytes
.
length
;
i
+
+
)
{
bytes
[
i
]
=
binary
.
charCodeAt
(
i
)
;
}
return
String
.
fromCharCode
(
.
.
.
new
Uint16Array
(
bytes
.
buffer
)
)
;
}
function
decodeMessageFromUrl
(
)
{
const
url
=
new
URL
(
document
.
location
.
href
)
;
if
(
url
.
searchParams
.
has
(
"
json
"
)
)
{
const
encodedMessage
=
url
.
searchParams
.
get
(
"
json
"
)
;
return
fromBinary
(
encodedMessage
)
;
}
return
null
;
}
function
showHint
(
)
{
document
.
body
.
classList
.
add
(
"
hint
-
box
"
)
;
document
.
body
.
innerHTML
=
<
div
class
=
"
hint
"
>
Message
preview
is
not
enabled
.
Enable
it
in
about
:
config
by
setting
<
code
>
browser
.
newtabpage
.
activity
-
stream
.
asrouter
.
devtoolsEnabled
<
/
code
>
to
true
.
<
/
div
>
;
}
document
.
addEventListener
(
"
DOMContentLoaded
"
(
)
=
>
{
document
.
querySelector
(
"
#
light
-
switch
"
)
.
addEventListener
(
"
click
"
MPToggleLights
)
;
}
)
;
const
message
=
decodeMessageFromUrl
(
)
;
if
(
message
)
{
if
(
MPIsEnabled
(
)
)
{
MPShowMessage
(
message
)
;
}
else
if
(
MPShouldShowHint
(
)
)
{
if
(
document
.
body
)
{
showHint
(
)
;
}
else
{
document
.
addEventListener
(
"
DOMContentLoaded
"
showHint
{
once
:
true
}
)
;
}
}
}
