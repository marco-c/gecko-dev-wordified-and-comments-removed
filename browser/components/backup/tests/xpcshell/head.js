"
use
strict
"
;
const
{
BackupService
}
=
ChromeUtils
.
importESModule
(
"
resource
:
/
/
/
modules
/
backup
/
BackupService
.
sys
.
mjs
"
)
;
const
{
BackupResource
}
=
ChromeUtils
.
importESModule
(
"
resource
:
/
/
/
modules
/
backup
/
BackupResource
.
sys
.
mjs
"
)
;
const
{
sinon
}
=
ChromeUtils
.
importESModule
(
"
resource
:
/
/
testing
-
common
/
Sinon
.
sys
.
mjs
"
)
;
const
BYTES_IN_KB
=
1000
;
do_get_profile
(
)
;
class
FakeBackupResource1
extends
BackupResource
{
static
get
key
(
)
{
return
"
fake1
"
;
}
measure
(
)
{
}
}
class
FakeBackupResource2
extends
BackupResource
{
static
get
key
(
)
{
return
"
fake2
"
;
}
measure
(
)
{
}
}
class
FakeBackupResource3
extends
BackupResource
{
static
get
key
(
)
{
return
"
fake3
"
;
}
measure
(
)
{
}
}
async
function
createKilobyteSizedFile
(
path
sizeInKB
)
{
let
bytes
=
new
Uint8Array
(
sizeInKB
*
BYTES_IN_KB
)
;
await
IOUtils
.
write
(
path
bytes
)
;
}
async
function
maybeRemovePath
(
path
)
{
try
{
await
IOUtils
.
remove
(
path
{
ignoreAbsent
:
true
recursive
:
true
}
)
;
}
catch
(
error
)
{
if
(
error
.
name
=
=
"
NS_ERROR_FILE_IS_LOCKED
"
)
{
return
;
}
throw
error
;
}
}
