export
default
class
VPNCard
{
constructor
(
document
)
{
this
.
doc
=
document
;
}
init
(
)
{
const
vpnLink
=
this
.
doc
.
getElementById
(
"
get
-
vpn
-
link
"
)
;
const
vpnBannerLink
=
this
.
doc
.
getElementById
(
"
vpn
-
banner
-
link
"
)
;
vpnLink
.
href
=
RPMGetStringPref
(
"
browser
.
contentblocking
.
report
.
vpn
.
url
"
"
"
)
;
vpnBannerLink
.
href
=
RPMGetStringPref
(
"
browser
.
contentblocking
.
report
.
vpn
-
promo
.
url
"
"
"
)
;
this
.
showVPNCard
(
)
;
}
async
showVPNCard
(
)
{
const
showVPNBanner
=
this
.
showVPNBanner
.
bind
(
this
)
;
RPMSendQuery
(
"
FetchShowVPNCard
"
{
}
)
.
then
(
shouldShow
=
>
{
if
(
!
shouldShow
)
{
return
;
}
const
vpnCard
=
this
.
doc
.
querySelector
(
"
.
vpn
-
card
"
)
;
let
availablePlatforms
=
RPMGetStringPref
(
"
browser
.
contentblocking
.
report
.
vpn_platforms
"
)
;
let
hasSupportedPlatform
=
false
;
for
(
let
platform
of
availablePlatforms
.
split
(
"
"
)
)
{
if
(
navigator
.
platform
.
toLowerCase
(
)
.
includes
(
platform
)
)
{
hasSupportedPlatform
=
true
;
break
;
}
}
if
(
!
hasSupportedPlatform
)
{
return
;
}
RPMSendQuery
(
"
FetchVPNSubStatus
"
{
}
)
.
then
(
async
hasVPN
=
>
{
let
vpnLink
=
vpnCard
.
querySelector
(
"
#
get
-
vpn
-
link
"
)
;
if
(
hasVPN
)
{
vpnCard
.
classList
.
add
(
"
subscribed
"
)
;
vpnCard
.
querySelector
(
"
.
card
-
title
"
)
.
setAttribute
(
"
data
-
l10n
-
id
"
"
vpn
-
title
-
subscribed
"
)
;
await
RPMSetBoolPref
(
"
browser
.
contentblocking
.
report
.
hide_vpn_banner
"
true
)
;
}
vpnLink
.
addEventListener
(
"
click
"
(
)
=
>
{
this
.
doc
.
sendTelemetryEvent
(
"
click
"
"
vpn_card_link
"
)
;
}
)
;
let
androidVPNAppLink
=
document
.
getElementById
(
"
vpn
-
google
-
playstore
-
link
"
)
;
androidVPNAppLink
.
href
=
RPMGetStringPref
(
"
browser
.
contentblocking
.
report
.
vpn
-
android
.
url
"
)
;
androidVPNAppLink
.
addEventListener
(
"
click
"
(
)
=
>
{
document
.
sendTelemetryEvent
(
"
click
"
"
vpn_app_link_android
"
)
;
}
)
;
let
iosVPNAppLink
=
document
.
getElementById
(
"
vpn
-
app
-
store
-
link
"
)
;
iosVPNAppLink
.
href
=
RPMGetStringPref
(
"
browser
.
contentblocking
.
report
.
vpn
-
ios
.
url
"
)
;
iosVPNAppLink
.
addEventListener
(
"
click
"
(
)
=
>
{
document
.
sendTelemetryEvent
(
"
click
"
"
vpn_app_link_ios
"
)
;
}
)
;
vpnCard
.
classList
.
remove
(
"
hidden
"
)
;
showVPNBanner
(
)
;
}
)
;
}
)
;
}
showVPNBanner
(
)
{
if
(
RPMGetBoolPref
(
"
browser
.
contentblocking
.
report
.
hide_vpn_banner
"
false
)
|
|
!
RPMGetBoolPref
(
"
browser
.
contentblocking
.
report
.
vpn
.
enabled
"
false
)
)
{
return
;
}
const
vpnBanner
=
this
.
doc
.
querySelector
(
"
.
vpn
-
banner
"
)
;
const
exitIcon
=
vpnBanner
.
querySelector
(
"
.
exit
-
icon
"
)
;
const
vpnBannerLink
=
vpnBanner
.
querySelector
(
"
#
vpn
-
banner
-
link
"
)
;
vpnBannerLink
.
addEventListener
(
"
click
"
(
)
=
>
{
this
.
doc
.
sendTelemetryEvent
(
"
click
"
"
vpn_banner_link
"
)
;
}
)
;
exitIcon
.
addEventListener
(
"
click
"
(
)
=
>
{
vpnBanner
.
classList
.
add
(
"
hidden
"
)
;
this
.
doc
.
sendTelemetryEvent
(
"
click
"
"
vpn_banner_close
"
)
;
}
)
;
vpnBanner
.
classList
.
remove
(
"
hidden
"
)
;
this
.
doc
.
sendTelemetryEvent
(
"
show
"
"
vpn_banner
"
)
;
RPMSetBoolPref
(
"
browser
.
contentblocking
.
report
.
hide_vpn_banner
"
true
)
;
}
}
