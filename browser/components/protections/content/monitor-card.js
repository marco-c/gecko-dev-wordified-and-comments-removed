const
MONITOR_SIGN_IN_URL
=
"
https
:
/
/
monitor
.
firefox
.
com
"
;
export
default
class
MonitorClass
{
constructor
(
document
)
{
this
.
doc
=
document
;
}
init
(
)
{
RPMAddMessageListener
(
"
SendUserLoginsData
"
(
{
data
}
)
=
>
{
this
.
getMonitorData
(
data
)
;
RPMSendAsyncMessage
(
"
FetchMonitorData
"
)
;
}
)
;
}
getMonitorData
(
loginData
)
{
RPMAddMessageListener
(
"
SendMonitorData
"
(
{
data
:
monitorData
}
)
=
>
{
this
.
buildContent
(
loginData
monitorData
)
;
const
monitorCard
=
this
.
doc
.
querySelector
(
"
.
card
.
monitor
-
card
.
hidden
"
)
;
monitorCard
.
classList
.
remove
(
"
hidden
"
)
;
}
)
;
}
buildContent
(
loginData
monitorData
)
{
const
{
hasFxa
numLogins
}
=
loginData
;
const
isLoggedIn
=
numLogins
>
0
|
|
hasFxa
;
const
headerContent
=
this
.
doc
.
querySelector
(
"
#
monitor
-
header
-
content
span
"
)
;
const
monitorCard
=
this
.
doc
.
querySelector
(
"
.
card
.
monitor
-
card
"
)
;
if
(
isLoggedIn
&
&
!
monitorData
.
error
)
{
monitorCard
.
classList
.
add
(
"
has
-
logins
"
)
;
headerContent
.
textContent
=
"
Firefox
Monitor
warns
you
if
your
info
has
appeared
in
a
known
data
breach
"
;
this
.
renderContentForUserWithLogins
(
monitorData
)
;
}
else
{
monitorCard
.
classList
.
add
(
"
no
-
logins
"
)
;
const
signUpForMonitorLink
=
this
.
doc
.
getElementById
(
"
sign
-
up
-
for
-
monitor
-
link
"
)
;
signUpForMonitorLink
.
textContent
=
hasFxa
?
"
Turn
on
Monitor
"
:
"
Sign
up
for
Monitor
"
;
signUpForMonitorLink
.
href
=
this
.
buildMonitorUrl
(
monitorData
.
userEmail
)
;
headerContent
.
textContent
=
"
Check
Firefox
Monitor
to
see
if
you
'
ve
been
part
of
a
data
breach
and
get
alerts
about
new
breaches
.
"
;
}
}
buildMonitorUrl
(
email
=
null
)
{
let
url
=
MONITOR_SIGN_IN_URL
;
if
(
email
)
{
url
+
=
/
oauth
/
init
?
email
=
{
email
}
&
entrypoint
=
protection_report_monitor
&
utm_source
=
about
-
protections
;
}
else
{
url
+
=
"
/
?
entrypoint
=
protection_report_monitor
&
utm_source
=
about
-
protections
"
;
}
return
url
;
}
renderContentForUserWithLogins
(
monitorData
)
{
const
storedEmail
=
this
.
doc
.
querySelector
(
"
span
[
data
-
type
=
'
stored
-
emails
'
]
"
)
;
const
knownBreaches
=
this
.
doc
.
querySelector
(
"
span
[
data
-
type
=
'
known
-
breaches
'
]
"
)
;
const
exposedPasswords
=
this
.
doc
.
querySelector
(
"
span
[
data
-
type
=
'
exposed
-
passwords
'
]
"
)
;
storedEmail
.
textContent
=
monitorData
.
monitoredEmails
;
knownBreaches
.
textContent
=
monitorData
.
numBreaches
;
exposedPasswords
.
textContent
=
monitorData
.
passwords
;
if
(
monitorData
.
potentiallyBreachedLogins
>
0
)
{
const
lockwiseSection
=
this
.
doc
.
querySelector
(
"
.
monitor
-
breached
-
passwords
"
)
;
const
exposedLockwisePasswords
=
this
.
doc
.
querySelector
(
"
span
[
data
-
type
=
'
breached
-
lockwise
-
passwords
'
]
"
)
;
exposedLockwisePasswords
.
textContent
=
monitorData
.
potentiallyBreachedLogins
;
lockwiseSection
.
classList
.
remove
(
"
hidden
"
)
;
}
}
}
