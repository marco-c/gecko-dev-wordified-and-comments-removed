const
{
XPCOMUtils
}
=
ChromeUtils
.
import
(
"
resource
:
/
/
gre
/
modules
/
XPCOMUtils
.
jsm
"
)
;
XPCOMUtils
.
defineLazyModuleGetters
(
globalThis
{
Services
:
"
resource
:
/
/
gre
/
modules
/
Services
.
jsm
"
PlacesUIUtils
:
"
resource
:
/
/
/
modules
/
PlacesUIUtils
.
jsm
"
}
)
;
export
function
formatURIForDisplay
(
uriString
)
{
let
uri
;
try
{
uri
=
Services
.
io
.
newURI
(
uriString
)
;
}
catch
(
ex
)
{
return
uriString
;
}
if
(
!
uri
.
asciiHost
)
{
return
uriString
;
}
let
displayHost
;
try
{
displayHost
=
Services
.
eTLD
.
getBaseDomain
(
uri
)
;
}
catch
(
ex
)
{
return
uri
.
displayHostPort
;
}
return
displayHost
.
length
?
displayHost
:
uriString
;
}
export
function
convertTimestamp
(
timestamp
fluentStrings
)
{
const
relativeTimeFormat
=
new
Services
.
intl
.
RelativeTimeFormat
(
undefined
{
}
)
;
const
elapsed
=
Date
.
now
(
)
-
timestamp
;
const
nowThresholdMs
=
91000
;
let
formattedTime
;
if
(
elapsed
<
=
nowThresholdMs
)
{
formattedTime
=
fluentStrings
.
formatValueSync
(
"
firefoxview
-
just
-
now
-
timestamp
"
)
;
}
else
{
formattedTime
=
relativeTimeFormat
.
formatBestUnit
(
new
Date
(
timestamp
)
)
;
}
return
formattedTime
;
}
export
function
createFaviconElement
(
image
)
{
const
imageUrl
=
image
?
PlacesUIUtils
.
getImageURL
(
image
)
:
"
chrome
:
/
/
global
/
skin
/
icons
/
defaultFavicon
.
svg
"
;
let
favicon
=
document
.
createElement
(
"
div
"
)
;
favicon
.
style
.
backgroundImage
=
url
(
'
{
imageUrl
}
'
)
;
favicon
.
classList
.
add
(
"
favicon
"
)
;
return
favicon
;
}
