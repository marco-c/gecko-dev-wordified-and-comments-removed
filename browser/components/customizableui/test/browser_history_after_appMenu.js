"
use
strict
"
;
add_task
(
async
function
test_history_after_appMenu
(
)
{
CustomizableUI
.
addWidgetToArea
(
"
history
-
panelmenu
"
"
nav
-
bar
"
)
;
registerCleanupFunction
(
(
)
=
>
CustomizableUI
.
removeWidgetFromArea
(
"
history
-
panelmenu
"
)
)
;
await
waitForElementShown
(
document
.
getElementById
(
"
history
-
panelmenu
"
)
)
;
let
historyView
=
PanelMultiView
.
getViewNode
(
document
"
PanelUI
-
history
"
)
;
let
libraryView
=
PanelMultiView
.
getViewNode
(
document
"
appMenu
-
libraryView
"
)
;
await
gCUITestUtils
.
openMainMenu
(
)
;
if
(
!
PanelUI
.
protonAppMenuEnabled
)
{
document
.
getElementById
(
"
appMenu
-
library
-
button
"
)
.
click
(
)
;
await
BrowserTestUtils
.
waitForEvent
(
libraryView
"
ViewShown
"
)
;
}
document
.
getElementById
(
PanelUI
.
protonAppMenuEnabled
?
"
appMenu
-
history
-
button
"
:
"
appMenu
-
library
-
history
-
button
"
)
.
click
(
)
;
await
BrowserTestUtils
.
waitForEvent
(
historyView
"
ViewShown
"
)
;
document
.
getElementById
(
"
history
-
panelmenu
"
)
.
click
(
)
;
await
BrowserTestUtils
.
waitForEvent
(
historyView
"
ViewShown
"
)
;
let
historyPanel
=
historyView
.
closest
(
"
panel
"
)
;
let
promise
=
BrowserTestUtils
.
waitForEvent
(
historyPanel
"
popuphidden
"
)
;
historyPanel
.
hidePopup
(
)
;
await
promise
;
}
)
;
