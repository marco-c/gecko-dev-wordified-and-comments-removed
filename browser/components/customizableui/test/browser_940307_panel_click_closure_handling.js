"
use
strict
"
;
var
button
menuButton
;
add_task
(
async
function
plain_button
(
)
{
button
=
document
.
createElement
(
"
toolbarbutton
"
)
;
button
.
id
=
"
browser_940307_button
"
;
button
.
setAttribute
(
"
label
"
"
Button
"
)
;
gNavToolbox
.
palette
.
appendChild
(
button
)
;
CustomizableUI
.
addWidgetToArea
(
button
.
id
CustomizableUI
.
AREA_FIXED_OVERFLOW_PANEL
)
;
await
document
.
getElementById
(
"
nav
-
bar
"
)
.
overflowable
.
show
(
)
;
let
hiddenAgain
=
promiseOverflowHidden
(
window
)
;
EventUtils
.
synthesizeMouseAtCenter
(
button
{
}
)
;
await
hiddenAgain
;
CustomizableUI
.
removeWidgetFromArea
(
button
.
id
)
;
button
.
remove
(
)
;
}
)
;
add_task
(
async
function
menu_button_popup
(
)
{
menuButton
=
document
.
createElement
(
"
toolbarbutton
"
)
;
menuButton
.
setAttribute
(
"
type
"
"
menu
-
button
"
)
;
menuButton
.
id
=
"
browser_940307_menubutton
"
;
menuButton
.
setAttribute
(
"
label
"
"
Menu
button
"
)
;
let
menuPopup
=
document
.
createElement
(
"
menupopup
"
)
;
menuPopup
.
id
=
"
browser_940307_menupopup
"
;
let
menuItem
=
document
.
createElement
(
"
menuitem
"
)
;
menuItem
.
setAttribute
(
"
label
"
"
Menu
item
"
)
;
menuItem
.
id
=
"
browser_940307_menuitem
"
;
menuPopup
.
appendChild
(
menuItem
)
;
menuButton
.
appendChild
(
menuPopup
)
;
gNavToolbox
.
palette
.
appendChild
(
menuButton
)
;
CustomizableUI
.
addWidgetToArea
(
menuButton
.
id
CustomizableUI
.
AREA_FIXED_OVERFLOW_PANEL
)
;
await
document
.
getElementById
(
"
nav
-
bar
"
)
.
overflowable
.
show
(
)
;
let
hiddenAgain
=
promiseOverflowHidden
(
window
)
;
let
innerButton
=
document
.
getAnonymousElementByAttribute
(
menuButton
"
anonid
"
"
button
"
)
;
EventUtils
.
synthesizeMouseAtCenter
(
innerButton
{
}
)
;
await
hiddenAgain
;
await
document
.
getElementById
(
"
nav
-
bar
"
)
.
overflowable
.
show
(
)
;
hiddenAgain
=
promiseOverflowHidden
(
window
)
;
let
menuShown
=
promisePanelElementShown
(
window
menuPopup
)
;
let
dropmarker
=
document
.
getAnonymousElementByAttribute
(
menuButton
"
type
"
"
menu
-
button
"
)
;
EventUtils
.
synthesizeMouseAtCenter
(
dropmarker
{
}
)
;
await
menuShown
;
ok
(
isOverflowOpen
(
)
"
Panel
should
still
be
open
"
)
;
let
menuHidden
=
promisePanelElementHidden
(
window
menuPopup
)
;
EventUtils
.
synthesizeMouseAtCenter
(
menuItem
{
}
)
;
await
menuHidden
;
await
hiddenAgain
;
CustomizableUI
.
removeWidgetFromArea
(
menuButton
.
id
)
;
menuButton
.
remove
(
)
;
}
)
;
add_task
(
async
function
searchbar_in_panel
(
)
{
let
searchbar
=
document
.
getElementById
(
"
searchbar
"
)
;
gCustomizeMode
.
addToPanel
(
searchbar
)
;
let
placement
=
CustomizableUI
.
getPlacementOfWidget
(
"
search
-
container
"
)
;
is
(
placement
.
area
CustomizableUI
.
AREA_FIXED_OVERFLOW_PANEL
"
Should
be
in
panel
"
)
;
await
document
.
getElementById
(
"
nav
-
bar
"
)
.
overflowable
.
show
(
)
;
await
waitForCondition
(
(
)
=
>
"
value
"
in
searchbar
&
&
searchbar
.
value
=
=
=
"
"
)
;
await
SpecialPowers
.
pushPrefEnv
(
{
set
:
[
[
"
browser
.
search
.
suggest
.
enabled
"
false
]
]
}
)
;
searchbar
.
value
=
"
foo
"
;
searchbar
.
focus
(
)
;
let
textbox
=
document
.
getAnonymousElementByAttribute
(
searchbar
.
textbox
"
anonid
"
"
textbox
-
input
-
box
"
)
;
let
contextmenu
=
document
.
getAnonymousElementByAttribute
(
textbox
"
anonid
"
"
input
-
box
-
contextmenu
"
)
;
let
contextMenuShown
=
promisePanelElementShown
(
window
contextmenu
)
;
EventUtils
.
synthesizeMouseAtCenter
(
searchbar
{
type
:
"
contextmenu
"
button
:
2
}
)
;
await
contextMenuShown
;
ok
(
isOverflowOpen
(
)
"
Panel
should
still
be
open
"
)
;
let
selectAll
=
contextmenu
.
querySelector
(
"
[
cmd
=
'
cmd_selectAll
'
]
"
)
;
let
contextMenuHidden
=
promisePanelElementHidden
(
window
contextmenu
)
;
EventUtils
.
synthesizeMouseAtCenter
(
selectAll
{
}
)
;
await
contextMenuHidden
;
searchbar
.
textbox
.
popup
.
hidePopup
(
)
;
ok
(
isOverflowOpen
(
)
"
Panel
should
still
be
open
"
)
;
let
hiddenPanelPromise
=
promiseOverflowHidden
(
window
)
;
EventUtils
.
synthesizeKey
(
"
VK_ESCAPE
"
{
}
)
;
await
hiddenPanelPromise
;
ok
(
!
isOverflowOpen
(
)
"
Panel
should
no
longer
be
open
"
)
;
gURLBar
.
select
(
)
;
CustomizableUI
.
reset
(
)
;
}
)
;
add_task
(
async
function
disabled_button_in_panel
(
)
{
button
=
document
.
createElement
(
"
toolbarbutton
"
)
;
button
.
id
=
"
browser_946166_button_disabled
"
;
button
.
setAttribute
(
"
disabled
"
"
true
"
)
;
button
.
setAttribute
(
"
label
"
"
Button
"
)
;
gNavToolbox
.
palette
.
appendChild
(
button
)
;
CustomizableUI
.
addWidgetToArea
(
button
.
id
CustomizableUI
.
AREA_FIXED_OVERFLOW_PANEL
)
;
await
document
.
getElementById
(
"
nav
-
bar
"
)
.
overflowable
.
show
(
)
;
EventUtils
.
synthesizeMouseAtCenter
(
button
{
}
)
;
is
(
PanelUI
.
overflowPanel
.
state
"
open
"
"
Popup
stays
open
"
)
;
button
.
removeAttribute
(
"
disabled
"
)
;
let
hiddenAgain
=
promiseOverflowHidden
(
window
)
;
EventUtils
.
synthesizeMouseAtCenter
(
button
{
}
)
;
await
hiddenAgain
;
button
.
remove
(
)
;
}
)
;
registerCleanupFunction
(
function
(
)
{
if
(
button
&
&
button
.
parentNode
)
{
button
.
remove
(
)
;
}
if
(
menuButton
&
&
menuButton
.
parentNode
)
{
menuButton
.
remove
(
)
;
}
if
(
isOverflowOpen
(
)
)
{
PanelUI
.
overflowPanel
.
hidePopup
(
)
;
}
CustomizableUI
.
reset
(
)
;
}
)
;
