"
use
strict
"
;
registerCleanupFunction
(
async
function
(
)
{
await
resetCustomization
(
)
;
if
(
!
document
.
getElementById
(
"
sidebar
-
box
"
)
.
hidden
)
{
SidebarUI
.
hide
(
)
;
}
}
)
;
var
showSidebar
=
async
function
(
win
=
window
)
{
let
button
=
win
.
document
.
getElementById
(
"
sidebar
-
button
"
)
;
let
sidebarFocusedPromise
=
BrowserTestUtils
.
waitForEvent
(
win
.
document
"
SidebarFocused
"
)
;
EventUtils
.
synthesizeMouseAtCenter
(
button
{
}
win
)
;
await
sidebarFocusedPromise
;
ok
(
win
.
SidebarUI
.
isOpen
"
Sidebar
is
opened
"
)
;
ok
(
button
.
hasAttribute
(
"
checked
"
)
"
Toolbar
button
is
checked
"
)
;
}
;
var
hideSidebar
=
async
function
(
win
=
window
)
{
let
button
=
win
.
document
.
getElementById
(
"
sidebar
-
button
"
)
;
EventUtils
.
synthesizeMouseAtCenter
(
button
{
}
win
)
;
ok
(
!
win
.
SidebarUI
.
isOpen
"
Sidebar
is
closed
"
)
;
ok
(
!
button
.
hasAttribute
(
"
checked
"
)
"
Toolbar
button
isn
'
t
checked
"
)
;
}
;
add_task
(
async
function
(
)
{
CustomizableUI
.
addWidgetToArea
(
"
sidebar
-
button
"
"
nav
-
bar
"
)
;
await
showSidebar
(
)
;
is
(
SidebarUI
.
currentID
"
viewBookmarksSidebar
"
"
Default
sidebar
selected
"
)
;
await
SidebarUI
.
show
(
"
viewHistorySidebar
"
)
;
await
hideSidebar
(
)
;
await
showSidebar
(
)
;
is
(
SidebarUI
.
currentID
"
viewHistorySidebar
"
"
Selected
sidebar
remembered
"
)
;
await
hideSidebar
(
)
;
let
otherWin
=
await
BrowserTestUtils
.
openNewBrowserWindow
(
{
opener
:
window
}
)
;
await
showSidebar
(
otherWin
)
;
is
(
otherWin
.
SidebarUI
.
currentID
"
viewHistorySidebar
"
"
Selected
sidebar
remembered
across
windows
"
)
;
await
hideSidebar
(
otherWin
)
;
await
BrowserTestUtils
.
closeWindow
(
otherWin
)
;
}
)
;
