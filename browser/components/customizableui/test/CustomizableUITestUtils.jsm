"
use
strict
"
;
var
EXPORTED_SYMBOLS
=
[
"
CustomizableUITestUtils
"
]
;
ChromeUtils
.
import
(
"
resource
:
/
/
testing
-
common
/
Assert
.
jsm
"
)
;
ChromeUtils
.
import
(
"
resource
:
/
/
testing
-
common
/
BrowserTestUtils
.
jsm
"
)
;
class
CustomizableUITestUtils
{
constructor
(
window
)
{
this
.
window
=
window
;
this
.
document
=
window
.
document
;
this
.
PanelUI
=
window
.
PanelUI
;
}
async
openPanelMultiView
(
panel
mainView
openFn
)
{
if
(
panel
.
state
=
=
"
open
"
)
{
Assert
.
ok
(
true
"
A
previous
test
left
the
panel
open
.
This
should
be
"
+
"
fixed
but
we
can
still
do
a
best
-
effort
recovery
and
"
+
"
assume
that
the
requested
view
will
be
made
visible
.
"
)
;
await
openFn
(
)
;
return
;
}
if
(
panel
.
state
=
=
"
hiding
"
)
{
Assert
.
ok
(
true
"
A
previous
test
requested
the
panel
to
close
but
"
+
"
didn
'
t
wait
for
the
operation
to
complete
.
While
"
+
"
the
test
should
be
fixed
we
can
still
continue
.
"
)
;
}
else
{
Assert
.
equal
(
panel
.
state
"
closed
"
"
The
panel
is
closed
to
begin
with
.
"
)
;
}
let
promiseShown
=
BrowserTestUtils
.
waitForEvent
(
mainView
"
ViewShown
"
)
;
await
openFn
(
)
;
await
promiseShown
;
}
async
hidePanelMultiView
(
panel
closeFn
)
{
Assert
.
ok
(
panel
.
state
=
=
"
open
"
"
The
panel
is
open
to
begin
with
.
"
)
;
let
promiseHidden
=
BrowserTestUtils
.
waitForEvent
(
panel
"
popuphidden
"
)
;
await
closeFn
(
)
;
await
promiseHidden
;
}
async
openMainMenu
(
)
{
await
this
.
openPanelMultiView
(
this
.
PanelUI
.
panel
this
.
PanelUI
.
mainView
(
)
=
>
this
.
PanelUI
.
show
(
)
)
;
}
async
hideMainMenu
(
)
{
await
this
.
hidePanelMultiView
(
this
.
PanelUI
.
panel
(
)
=
>
this
.
PanelUI
.
hide
(
)
)
;
}
}
