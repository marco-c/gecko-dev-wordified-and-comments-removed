"
use
strict
"
;
const
kButton
=
"
test_dynamically_created_button
"
;
var
initialLocation
=
gBrowser
.
currentURI
.
spec
;
add_task
(
async
function
(
)
{
info
(
"
Check
dynamically
created
button
functionality
"
)
;
let
widgetSpec
=
{
id
:
kButton
type
:
"
button
"
tooltiptext
:
"
I
am
an
accessible
name
"
onClick
(
)
{
gBrowser
.
selectedTab
=
BrowserTestUtils
.
addTab
(
gBrowser
"
about
:
addons
"
)
;
}
}
;
CustomizableUI
.
createWidget
(
widgetSpec
)
;
CustomizableUI
.
addWidgetToArea
(
kButton
CustomizableUI
.
AREA_NAVBAR
)
;
ok
(
!
CustomizableUI
.
isWebExtensionWidget
(
kButton
)
"
This
button
should
not
be
considered
an
extension
widget
.
"
)
;
let
button
=
document
.
getElementById
(
kButton
)
;
let
navBar
=
document
.
getElementById
(
"
nav
-
bar
"
)
;
ok
(
button
"
Dynamically
created
button
exists
"
)
;
ok
(
navBar
.
contains
(
button
)
"
Dynamically
created
button
is
in
the
navbar
"
)
;
await
checkButtonFunctionality
(
button
)
;
resetTabs
(
)
;
CustomizableUI
.
addWidgetToArea
(
kButton
CustomizableUI
.
AREA_FIXED_OVERFLOW_PANEL
)
;
ok
(
!
navBar
.
contains
(
button
)
"
Dynamically
created
button
was
removed
from
the
browser
bar
"
)
;
await
waitForOverflowButtonShown
(
)
;
await
document
.
getElementById
(
"
nav
-
bar
"
)
.
overflowable
.
show
(
)
;
var
panelMenu
=
document
.
getElementById
(
"
widget
-
overflow
-
mainView
"
)
;
let
buttonInPanel
=
panelMenu
.
getElementsByAttribute
(
"
id
"
kButton
)
;
ok
(
panelMenu
.
contains
(
button
)
"
Dynamically
created
button
was
added
to
the
Panel
Menu
"
)
;
await
checkButtonFunctionality
(
buttonInPanel
[
0
]
)
;
}
)
;
add_task
(
async
function
asyncCleanup
(
)
{
resetTabs
(
)
;
await
resetCustomization
(
)
;
ok
(
CustomizableUI
.
inDefaultState
"
The
UI
is
in
default
state
again
.
"
)
;
CustomizableUI
.
destroyWidget
(
kButton
)
;
}
)
;
function
resetTabs
(
)
{
while
(
gBrowser
.
tabs
.
length
>
1
)
{
gBrowser
.
removeTab
(
gBrowser
.
selectedTab
)
;
}
BrowserTestUtils
.
addTab
(
gBrowser
initialLocation
)
;
gBrowser
.
removeTab
(
gBrowser
.
selectedTab
)
;
}
async
function
checkButtonFunctionality
(
aButton
)
{
aButton
.
click
(
)
;
await
BrowserTestUtils
.
browserLoaded
(
gBrowser
.
selectedBrowser
false
"
about
:
addons
"
)
;
}
