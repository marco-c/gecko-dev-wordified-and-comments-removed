"
use
strict
"
;
add_task
(
async
function
test_privatebrowsing_window
(
)
{
const
ABOUT_ORIGIN_WITH_UITOUR_DEFAULT
=
"
about
:
newtab
"
;
const
HTTPS_ORIGIN_WITH_UITOUR_DEFAULT
=
"
https
:
/
/
www
.
mozilla
.
org
"
;
let
{
UITourUtils
}
=
ChromeUtils
.
importESModule
(
"
moz
-
src
:
/
/
/
browser
/
components
/
uitour
/
UITourUtils
.
sys
.
mjs
"
)
;
let
win
=
await
BrowserTestUtils
.
openNewBrowserWindow
(
{
private
:
true
}
)
;
let
browser
=
win
.
gBrowser
.
selectedBrowser
;
for
(
let
uri
of
[
ABOUT_ORIGIN_WITH_UITOUR_DEFAULT
HTTPS_ORIGIN_WITH_UITOUR_DEFAULT
]
)
{
BrowserTestUtils
.
startLoadingURIString
(
browser
uri
)
;
await
BrowserTestUtils
.
browserLoaded
(
browser
)
;
Assert
.
ok
(
UITourUtils
.
ensureTrustedOrigin
(
browser
.
browsingContext
.
currentWindowGlobal
)
"
Page
should
be
considered
trusted
for
UITour
in
the
parent
.
"
)
;
await
SpecialPowers
.
spawn
(
browser
[
]
async
(
)
=
>
{
let
actor
=
content
.
windowGlobalChild
.
getActor
(
"
UITour
"
)
;
let
{
UITourUtils
}
=
ChromeUtils
.
importESModule
(
"
moz
-
src
:
/
/
/
browser
/
components
/
uitour
/
UITourUtils
.
sys
.
mjs
"
)
;
Assert
.
ok
(
UITourUtils
.
ensureTrustedOrigin
(
actor
.
manager
)
"
Page
should
be
considered
trusted
for
UITour
.
"
)
;
}
)
;
}
await
BrowserTestUtils
.
closeWindow
(
win
)
;
}
)
;
