const
fs
=
require
(
"
fs
"
)
;
const
{
mkdir
}
=
require
(
"
shelljs
"
)
;
const
path
=
require
(
"
path
"
)
;
const
{
pathToFileURL
}
=
require
(
"
url
"
)
;
const
chalk
=
require
(
"
chalk
"
)
;
const
DEFAULT_OPTIONS
=
{
addonPath
:
"
.
.
"
baseUrl
:
"
resource
:
/
/
activity
-
stream
/
"
}
;
function
templateHTML
(
options
)
{
const
debugString
=
options
.
debug
?
"
-
dev
"
:
"
"
;
const
scripts
=
[
"
chrome
:
/
/
browser
/
content
/
contentSearchUI
.
js
"
"
chrome
:
/
/
browser
/
content
/
contentSearchHandoffUI
.
js
"
"
chrome
:
/
/
browser
/
content
/
contentTheme
.
js
"
{
options
.
baseUrl
}
vendor
/
react
{
debugString
}
.
js
{
options
.
baseUrl
}
vendor
/
react
-
dom
{
debugString
}
.
js
{
options
.
baseUrl
}
vendor
/
prop
-
types
.
js
{
options
.
baseUrl
}
vendor
/
redux
.
js
{
options
.
baseUrl
}
vendor
/
react
-
redux
.
js
{
options
.
baseUrl
}
vendor
/
react
-
transition
-
group
.
js
{
options
.
baseUrl
}
data
/
content
/
activity
-
stream
.
bundle
.
js
{
options
.
baseUrl
}
data
/
content
/
newtab
-
render
.
js
]
;
const
scriptRender
=
\
n
{
scripts
.
map
(
script
=
>
<
script
src
=
"
{
script
}
"
>
<
/
script
>
)
.
join
(
"
\
n
"
)
}
;
return
<
!
-
-
This
Source
Code
Form
is
subject
to
the
terms
of
the
Mozilla
Public
-
License
v
.
2
.
0
.
If
a
copy
of
the
MPL
was
not
distributed
with
this
file
-
You
can
obtain
one
at
http
:
/
/
mozilla
.
org
/
MPL
/
2
.
0
/
.
-
-
>
<
!
DOCTYPE
html
>
<
html
>
<
head
>
<
meta
charset
=
"
utf
-
8
"
/
>
<
meta
http
-
equiv
=
"
Content
-
Security
-
Policy
"
content
=
"
default
-
src
'
none
'
;
object
-
src
'
none
'
;
script
-
src
resource
:
chrome
:
;
connect
-
src
https
:
;
img
-
src
https
:
data
:
blob
:
chrome
:
;
style
-
src
'
unsafe
-
inline
'
;
"
/
>
<
meta
name
=
"
color
-
scheme
"
content
=
"
light
dark
"
/
>
<
title
data
-
l10n
-
id
=
"
newtab
-
page
-
title
"
>
<
/
title
>
<
link
rel
=
"
icon
"
type
=
"
image
/
png
"
href
=
"
chrome
:
/
/
branding
/
content
/
icon32
.
png
"
/
>
<
link
rel
=
"
localization
"
href
=
"
branding
/
brand
.
ftl
"
/
>
<
link
rel
=
"
localization
"
href
=
"
toolkit
/
branding
/
brandings
.
ftl
"
/
>
<
link
rel
=
"
localization
"
href
=
"
browser
/
newtab
/
newtab
.
ftl
"
/
>
<
link
rel
=
"
stylesheet
"
href
=
"
chrome
:
/
/
global
/
skin
/
design
-
system
/
tokens
-
brand
.
css
"
/
>
<
link
rel
=
"
stylesheet
"
href
=
"
chrome
:
/
/
browser
/
content
/
contentSearchUI
.
css
"
/
>
<
link
rel
=
"
stylesheet
"
href
=
"
chrome
:
/
/
activity
-
stream
/
content
/
css
/
activity
-
stream
.
css
"
/
>
<
/
head
>
<
body
class
=
"
activity
-
stream
"
>
<
div
id
=
"
root
"
>
<
/
div
>
<
div
id
=
"
footer
-
asrouter
-
container
"
role
=
"
presentation
"
>
<
/
div
>
{
options
.
noscripts
?
"
"
:
scriptRender
}
<
script
async
type
=
"
module
"
src
=
"
chrome
:
/
/
global
/
content
/
elements
/
moz
-
toggle
.
mjs
"
>
<
/
script
>
<
/
body
>
<
/
html
>
.
trimLeft
(
)
;
}
function
writeFiles
(
destPath
filesMap
options
)
{
for
(
const
[
file
templater
]
of
filesMap
)
{
fs
.
writeFileSync
(
path
.
join
(
destPath
file
)
templater
(
{
options
}
)
)
;
console
.
log
(
chalk
.
green
(
{
file
}
)
)
;
}
}
const
STATIC_FILES
=
new
Map
(
[
[
"
activity
-
stream
.
html
"
(
{
options
}
)
=
>
templateHTML
(
options
)
]
[
"
activity
-
stream
-
debug
.
html
"
(
{
options
}
)
=
>
templateHTML
(
Object
.
assign
(
{
}
options
{
debug
:
true
}
)
)
]
[
"
activity
-
stream
-
noscripts
.
html
"
(
{
options
}
)
=
>
templateHTML
(
Object
.
assign
(
{
}
options
{
noscripts
:
true
}
)
)
]
]
)
;
async
function
main
(
)
{
const
{
default
:
meow
}
=
await
import
(
"
meow
"
)
;
const
fileUrl
=
pathToFileURL
(
__filename
)
;
const
cli
=
meow
(
Usage
node
.
/
bin
/
render
-
activity
-
stream
-
html
.
js
[
options
]
Options
-
a
PATH
-
-
addon
-
path
PATH
Path
to
the
parent
of
the
target
directory
.
default
:
"
{
DEFAULT_OPTIONS
.
addonPath
}
"
-
b
URL
-
-
base
-
url
URL
Base
URL
for
assets
.
default
:
"
{
DEFAULT_OPTIONS
.
baseUrl
}
"
-
-
help
Show
this
help
message
.
{
description
:
false
pkg
:
{
name
:
"
render
-
activity
-
stream
-
html
"
version
:
"
0
.
0
.
0
"
}
importMeta
:
{
url
:
fileUrl
}
flags
:
{
addonPath
:
{
type
:
"
string
"
alias
:
"
a
"
default
:
DEFAULT_OPTIONS
.
addonPath
}
baseUrl
:
{
type
:
"
string
"
alias
:
"
b
"
default
:
DEFAULT_OPTIONS
.
baseUrl
}
}
}
)
;
const
options
=
Object
.
assign
(
{
debug
:
false
}
cli
.
flags
|
|
{
}
)
;
const
addonPath
=
path
.
resolve
(
__dirname
options
.
addonPath
)
;
const
prerenderedPath
=
path
.
join
(
addonPath
"
prerendered
"
)
;
console
.
log
(
Writing
prerendered
files
to
{
prerenderedPath
}
:
)
;
mkdir
(
"
-
p
"
prerenderedPath
)
;
writeFiles
(
prerenderedPath
STATIC_FILES
options
)
;
}
main
(
)
;
