const
path
=
require
(
"
path
"
)
;
module
.
exports
=
{
ResourceUriPlugin
:
class
ResourceUriPlugin
{
#
resourcePathRegEx
;
constructor
(
{
resourcePathRegEx
}
)
{
this
.
#
resourcePathRegEx
=
resourcePathRegEx
;
}
apply
(
compiler
)
{
compiler
.
hooks
.
compilation
.
tap
(
"
ResourceUriPlugin
"
(
compilation
{
normalModuleFactory
}
)
=
>
{
normalModuleFactory
.
hooks
.
resolveForScheme
.
for
(
"
resource
"
)
.
tap
(
"
ResourceUriPlugin
"
resourceData
=
>
{
const
url
=
new
URL
(
resourceData
.
resource
)
;
if
(
!
url
.
href
.
match
(
this
.
#
resourcePathRegEx
)
)
{
return
true
;
}
const
pathname
=
path
.
join
(
__dirname
"
.
.
"
url
.
pathname
)
;
resourceData
.
path
=
pathname
;
resourceData
.
query
=
url
.
search
;
resourceData
.
fragment
=
url
.
hash
;
resourceData
.
resource
=
pathname
+
url
.
search
+
url
.
hash
;
return
true
;
}
)
;
}
)
;
}
}
}
;
