"
use
strict
"
;
registerCleanupFunction
(
async
(
)
=
>
{
await
withFullyLoadedAboutHome
(
async
browser
=
>
{
await
simulateRestart
(
browser
)
;
}
)
;
}
)
;
add_task
(
async
function
test_cache_disabled
(
)
{
await
withFullyLoadedAboutHome
(
async
browser
=
>
{
await
SpecialPowers
.
pushPrefEnv
(
{
set
:
[
[
"
browser
.
startup
.
homepage
.
abouthome_cache
.
enabled
"
false
]
]
}
)
;
await
simulateRestart
(
browser
)
;
await
ensureDynamicAboutHome
(
browser
AboutHomeStartupCache
.
CACHE_RESULT_SCALARS
.
DISABLED
)
;
await
SpecialPowers
.
popPrefEnv
(
)
;
}
)
;
}
)
;
add_task
(
async
function
test_cache_custom_homepage
(
)
{
await
withFullyLoadedAboutHome
(
async
browser
=
>
{
await
HomePage
.
set
(
"
https
:
/
/
example
.
com
"
)
;
await
simulateRestart
(
browser
)
;
await
ensureDynamicAboutHome
(
browser
AboutHomeStartupCache
.
CACHE_RESULT_SCALARS
.
NOT_LOADING_ABOUTHOME
)
;
HomePage
.
reset
(
)
;
}
)
;
}
)
;
add_task
(
async
function
test_cache_restore_session
(
)
{
await
withFullyLoadedAboutHome
(
async
browser
=
>
{
await
SpecialPowers
.
pushPrefEnv
(
{
set
:
[
[
"
browser
.
startup
.
page
"
3
]
]
}
)
;
await
simulateRestart
(
browser
)
;
await
ensureDynamicAboutHome
(
browser
AboutHomeStartupCache
.
CACHE_RESULT_SCALARS
.
NOT_LOADING_ABOUTHOME
)
;
await
SpecialPowers
.
popPrefEnv
(
)
;
}
)
;
}
)
;
add_task
(
async
function
test_cache_no_preloading
(
)
{
await
withFullyLoadedAboutHome
(
async
browser
=
>
{
await
SpecialPowers
.
pushPrefEnv
(
{
set
:
[
[
"
browser
.
newtab
.
preload
"
false
]
]
}
)
;
await
simulateRestart
(
browser
)
;
await
ensureDynamicAboutHome
(
browser
AboutHomeStartupCache
.
CACHE_RESULT_SCALARS
.
PRELOADING_DISABLED
)
;
await
SpecialPowers
.
popPrefEnv
(
)
;
}
)
;
}
)
;
