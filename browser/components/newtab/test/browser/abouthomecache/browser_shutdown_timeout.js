"
use
strict
"
;
add_task
(
async
function
test_shutdown_timeout
(
)
{
await
BrowserTestUtils
.
withNewTab
(
"
about
:
home
"
async
browser
=
>
{
await
clearCache
(
)
;
await
simulateRestart
(
browser
)
;
await
SpecialPowers
.
spawn
(
browser
[
]
async
(
)
=
>
{
let
{
AboutHomeStartupCacheChild
}
=
ChromeUtils
.
importESModule
(
"
resource
:
/
/
/
modules
/
AboutNewTabService
.
sys
.
mjs
"
)
;
AboutHomeStartupCacheChild
.
uninit
(
)
;
}
)
;
AboutHomeStartupCache
.
onPreloadedNewTabMessage
(
)
;
await
simulateRestart
(
browser
{
expectTimeout
:
true
}
)
;
Assert
.
ok
(
true
"
We
reached
here
which
means
shutdown
didn
'
t
block
forever
.
"
)
;
await
clearCache
(
)
;
}
)
;
}
)
;
