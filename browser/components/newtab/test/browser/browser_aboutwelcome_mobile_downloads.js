"
use
strict
"
;
const
BASE_CONTENT
=
{
id
:
"
MOBILE_DOWNLOADS
"
order
:
0
content
:
{
tiles
:
{
type
:
"
mobile_downloads
"
data
:
{
QR_code
:
{
image_url
:
"
focus
-
qr
-
code
.
svg
"
alt_text
:
"
Test
alt
"
}
email
:
{
link_text
:
{
string_id
:
"
spotlight
-
focus
-
promo
-
email
-
link
"
}
}
marketplace_buttons
:
{
}
}
}
}
}
;
async
function
openAboutWelcome
(
json
)
{
if
(
json
)
{
await
setAboutWelcomeMultiStage
(
json
)
;
}
let
tab
=
await
BrowserTestUtils
.
openNewForegroundTab
(
gBrowser
"
about
:
welcome
"
true
)
;
registerCleanupFunction
(
(
)
=
>
{
BrowserTestUtils
.
removeTab
(
tab
)
;
}
)
;
return
tab
.
linkedBrowser
;
}
function
setLocale
(
locale
)
{
Services
.
locale
.
availableLocales
=
[
locale
]
;
Services
.
locale
.
requestedLocales
=
[
locale
]
;
}
const
ALT_TEXT
=
BASE_CONTENT
.
content
.
tiles
.
data
.
QR_code
.
alt_text
;
add_task
(
async
function
test_aboutwelcome_mobile_downloads_all
(
)
{
const
TEST_JSON
=
JSON
.
stringify
(
[
BASE_CONTENT
]
)
;
let
browser
=
await
openAboutWelcome
(
TEST_JSON
)
;
await
test_screen_content
(
browser
"
renders
screen
with
all
mobile
download
elements
"
[
img
.
qr
-
code
-
image
[
alt
=
"
{
ALT_TEXT
}
"
]
"
ul
.
mobile
-
download
-
buttons
"
"
li
.
android
"
"
li
.
ios
"
"
button
.
email
-
link
"
]
)
;
}
)
;
add_task
(
async
function
test_aboutwelcome_mobile_downloads_qr_and_marketplace
(
)
{
const
SCREEN_CONTENT
=
structuredClone
(
BASE_CONTENT
)
;
delete
SCREEN_CONTENT
.
content
.
tiles
.
data
.
email
;
const
TEST_JSON
=
JSON
.
stringify
(
[
SCREEN_CONTENT
]
)
;
let
browser
=
await
openAboutWelcome
(
TEST_JSON
)
;
await
test_screen_content
(
browser
"
renders
screen
with
QR
code
and
marketplace
badges
"
[
img
.
qr
-
code
-
image
[
alt
=
"
{
ALT_TEXT
}
"
]
"
ul
.
mobile
-
download
-
buttons
"
"
li
.
android
"
"
li
.
ios
"
]
[
button
.
email
-
link
]
)
;
}
)
;
add_task
(
async
function
test_aboutwelcome_mobile_downloads_qr
(
)
{
let
SCREEN_CONTENT
=
structuredClone
(
BASE_CONTENT
)
;
const
QR_CODE_SRC
=
"
focus
-
qr
-
code
.
svg
"
;
delete
SCREEN_CONTENT
.
content
.
tiles
.
data
.
email
;
delete
SCREEN_CONTENT
.
content
.
tiles
.
data
.
marketplace_buttons
;
const
TEST_JSON
=
JSON
.
stringify
(
[
SCREEN_CONTENT
]
)
;
let
browser
=
await
openAboutWelcome
(
TEST_JSON
)
;
await
test_screen_content
(
browser
"
renders
screen
with
QR
code
"
[
img
.
qr
-
code
-
image
[
alt
=
"
{
ALT_TEXT
}
"
]
[
src
=
"
{
QR_CODE_SRC
}
"
]
]
[
"
button
.
email
-
link
"
"
li
.
android
"
"
li
.
ios
"
]
)
;
}
)
;
add_task
(
async
function
test_aboutwelcome_localized_qr_override
(
)
{
const
TEST_LOCALE
=
"
de
"
;
setLocale
(
TEST_LOCALE
)
;
const
DE_QR_CODE_SRC
=
"
klar
-
qr
-
code
.
svg
"
;
let
SCREEN_CONTENT
=
structuredClone
(
BASE_CONTENT
)
;
SCREEN_CONTENT
.
content
.
tiles
.
data
.
QR_code
.
image_overrides
=
{
de
:
DE_QR_CODE_SRC
}
;
const
TEST_JSON
=
JSON
.
stringify
(
[
SCREEN_CONTENT
]
)
;
let
browser
=
await
openAboutWelcome
(
TEST_JSON
)
;
await
test_screen_content
(
browser
"
renders
screen
with
localized
QR
code
"
[
img
.
qr
-
code
-
image
[
src
=
"
{
DE_QR_CODE_SRC
}
"
]
]
)
;
}
)
;
