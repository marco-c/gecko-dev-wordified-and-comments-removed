"
use
strict
"
;
ChromeUtils
.
import
(
"
resource
:
/
/
gre
/
modules
/
Preferences
.
jsm
"
this
)
;
const
PREF_BOOLEAN_DEFAULT_TRUE
=
"
accessibility
.
typeaheadfind
.
manual
"
;
const
PREF_BOOLEAN_USERVALUE_TRUE
=
"
browser
.
dom
.
window
.
dump
.
enabled
"
;
const
PREF_NUMBER_DEFAULT_ZERO
=
"
accessibility
.
typeaheadfind
.
casesensitive
"
;
const
PREF_STRING_DEFAULT_EMPTY
=
"
browser
.
helperApps
.
neverAsk
.
openFile
"
;
const
PREF_STRING_DEFAULT_NOTEMPTY
=
"
accessibility
.
typeaheadfind
.
soundURL
"
;
const
PREF_STRING_DEFAULT_NOTEMPTY_VALUE
=
"
beep
"
;
const
PREF_STRING_LOCALIZED_MISSING
=
"
gecko
.
handlerService
.
schemes
.
irc
.
1
.
name
"
;
const
PREF_NEW
=
"
test
.
aboutconfig
.
new
"
;
class
AboutConfigRowTest
{
constructor
(
element
)
{
this
.
element
=
element
;
}
querySelector
(
selector
)
{
return
this
.
element
.
querySelector
(
selector
)
;
}
get
name
(
)
{
return
this
.
querySelector
(
"
td
"
)
.
textContent
;
}
get
value
(
)
{
return
this
.
querySelector
(
"
td
.
cell
-
value
"
)
.
textContent
;
}
get
valueInput
(
)
{
return
this
.
querySelector
(
"
td
.
cell
-
value
input
"
)
;
}
get
editColumnButton
(
)
{
return
this
.
querySelector
(
"
td
.
cell
-
edit
>
button
"
)
;
}
get
resetColumnButton
(
)
{
return
this
.
querySelector
(
"
td
:
last
-
child
>
button
"
)
;
}
hasClass
(
className
)
{
return
this
.
element
.
classList
.
contains
(
className
)
;
}
}
class
AboutConfigTest
{
static
withNewTab
(
testFn
options
=
{
}
)
{
return
BrowserTestUtils
.
withNewTab
(
{
gBrowser
url
:
"
chrome
:
/
/
browser
/
content
/
aboutconfig
/
aboutconfig
.
html
"
}
async
browser
=
>
{
let
scope
=
new
this
(
browser
)
;
await
scope
.
setupNewTab
(
options
)
;
await
testFn
.
call
(
scope
)
;
}
)
;
}
constructor
(
browser
)
{
this
.
document
=
browser
.
contentDocument
;
}
async
setupNewTab
(
options
)
{
await
this
.
document
.
l10n
.
ready
;
if
(
!
options
.
dontBypassWarning
)
{
this
.
document
.
querySelector
(
"
button
"
)
.
click
(
)
;
}
}
get
rows
(
)
{
let
elements
=
this
.
document
.
getElementById
(
"
prefs
"
)
.
getElementsByTagName
(
"
tr
"
)
;
return
Array
.
map
(
elements
element
=
>
new
AboutConfigRowTest
(
element
)
)
;
}
getRow
(
name
)
{
return
this
.
rows
.
find
(
row
=
>
row
.
name
=
=
name
)
;
}
search
(
value
=
"
"
)
{
let
search
=
this
.
document
.
getElementById
(
"
search
"
)
;
search
.
value
=
value
;
search
.
focus
(
)
;
EventUtils
.
sendKey
(
"
return
"
)
;
}
}
