ChromeUtils
.
import
(
"
resource
:
/
/
gre
/
modules
/
Preferences
.
jsm
"
this
)
;
const
PAGE_URL
=
"
chrome
:
/
/
browser
/
content
/
aboutconfig
/
aboutconfig
.
html
"
;
add_task
(
async
function
setup
(
)
{
await
SpecialPowers
.
pushPrefEnv
(
{
set
:
[
[
"
test
.
aboutconfig
.
a
"
"
test
value
1
"
]
[
"
test
.
aboutconfig
.
ab
"
"
test
value
2
"
]
[
"
test
.
aboutconfig
.
b
"
"
test
value
3
"
]
]
}
)
;
}
)
;
add_task
(
async
function
test_search
(
)
{
await
BrowserTestUtils
.
withNewTab
(
{
gBrowser
url
:
PAGE_URL
}
async
browser
=
>
{
let
prefArray
=
Services
.
prefs
.
getChildList
(
"
"
)
;
await
content
.
document
.
querySelector
(
"
button
"
)
.
click
(
)
;
Assert
.
greater
(
content
.
document
.
getElementById
(
"
prefs
"
)
.
childElementCount
prefArray
.
length
-
50
)
;
let
search
=
content
.
document
.
getElementById
(
"
search
"
)
;
search
.
value
=
"
wser
.
down
"
;
search
.
focus
(
)
;
EventUtils
.
sendKey
(
"
return
"
)
;
let
filteredPrefArray
=
prefArray
.
filter
(
pref
=
>
pref
.
includes
(
"
wser
.
down
"
)
)
;
Assert
.
equal
(
content
.
document
.
getElementById
(
"
prefs
"
)
.
childElementCount
filteredPrefArray
.
length
+
1
)
;
search
.
value
=
"
"
;
search
.
focus
(
)
;
EventUtils
.
sendKey
(
"
return
"
)
;
Assert
.
greater
(
content
.
document
.
getElementById
(
"
prefs
"
)
.
childElementCount
prefArray
.
length
-
50
)
;
search
.
value
=
"
aJunkValueasdf
"
;
search
.
focus
(
)
;
EventUtils
.
sendKey
(
"
return
"
)
;
Assert
.
equal
(
content
.
document
.
getElementById
(
"
prefs
"
)
.
childElementCount
1
)
;
search
.
value
=
"
test
.
aboutconfig
.
a
"
;
search
.
focus
(
)
;
EventUtils
.
sendKey
(
"
return
"
)
;
Assert
.
equal
(
content
.
document
.
getElementById
(
"
prefs
"
)
.
childElementCount
2
)
;
}
)
;
}
)
;
