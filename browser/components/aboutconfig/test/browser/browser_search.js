add_task
(
async
function
setup
(
)
{
await
SpecialPowers
.
pushPrefEnv
(
{
set
:
[
[
"
test
.
aboutconfig
.
a
"
"
test
value
1
"
]
[
"
test
.
aboutconfig
.
ab
"
"
test
value
2
"
]
[
"
test
.
aboutconfig
.
b
"
"
test
value
3
"
]
]
}
)
;
}
)
;
add_task
(
async
function
test_search
(
)
{
await
AboutConfigTest
.
withNewTab
(
async
function
(
)
{
let
prefArray
=
Services
.
prefs
.
getChildList
(
"
"
)
;
Assert
.
greater
(
this
.
rows
.
length
prefArray
.
length
-
50
)
;
this
.
search
(
"
Wser
.
down
"
)
;
let
filteredPrefArray
=
prefArray
.
filter
(
pref
=
>
pref
.
includes
(
"
wser
.
down
"
)
)
;
Assert
.
equal
(
this
.
rows
.
length
filteredPrefArray
.
length
+
1
)
;
this
.
search
(
)
;
Assert
.
greater
(
this
.
rows
.
length
prefArray
.
length
-
50
)
;
this
.
search
(
"
aJunkValueasdf
"
)
;
Assert
.
equal
(
this
.
rows
.
length
1
)
;
this
.
search
(
"
test
.
aboutconfig
.
a
"
)
;
Assert
.
equal
(
this
.
rows
.
length
2
)
;
this
.
search
(
"
TEST
.
aboutconfig
.
a
"
)
;
Assert
.
equal
(
this
.
rows
.
length
3
)
;
}
)
;
}
)
;
add_task
(
async
function
test_search_delayed
(
)
{
await
AboutConfigTest
.
withNewTab
(
async
function
(
)
{
this
.
search
(
"
test
.
aboutconfig
.
a
"
)
;
Assert
.
equal
(
this
.
rows
.
length
2
)
;
let
prefsTableChanged
=
new
Promise
(
resolve
=
>
{
let
observer
=
new
MutationObserver
(
(
)
=
>
{
observer
.
disconnect
(
)
;
resolve
(
)
;
}
)
;
observer
.
observe
(
this
.
prefsTable
{
childList
:
true
}
)
;
for
(
let
element
of
this
.
prefsTable
.
children
)
{
observer
.
observe
(
element
{
attributes
:
true
}
)
;
}
}
)
;
EventUtils
.
synthesizeKey
(
"
b
"
)
;
Assert
.
equal
(
this
.
rows
.
length
2
)
;
await
prefsTableChanged
;
Assert
.
equal
(
this
.
rows
.
length
1
)
;
}
)
;
}
)
;
