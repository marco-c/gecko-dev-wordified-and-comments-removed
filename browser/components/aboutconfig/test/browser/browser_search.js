add_task
(
async
function
setup
(
)
{
await
SpecialPowers
.
pushPrefEnv
(
{
set
:
[
[
"
test
.
aboutconfig
.
a
"
"
test
value
1
"
]
[
"
test
.
aboutconfig
.
ab
"
"
test
value
2
"
]
[
"
test
.
aboutconfig
.
b
"
"
test
value
3
"
]
]
}
)
;
}
)
;
add_task
(
async
function
test_search
(
)
{
await
AboutConfigTest
.
withNewTab
(
async
function
(
)
{
let
prefArray
=
Services
.
prefs
.
getChildList
(
"
"
)
;
await
this
.
document
.
querySelector
(
"
button
"
)
.
click
(
)
;
Assert
.
greater
(
this
.
document
.
getElementById
(
"
prefs
"
)
.
childElementCount
prefArray
.
length
-
50
)
;
let
search
=
this
.
document
.
getElementById
(
"
search
"
)
;
search
.
value
=
"
wser
.
down
"
;
search
.
focus
(
)
;
EventUtils
.
sendKey
(
"
return
"
)
;
let
filteredPrefArray
=
prefArray
.
filter
(
pref
=
>
pref
.
includes
(
"
wser
.
down
"
)
)
;
Assert
.
equal
(
this
.
document
.
getElementById
(
"
prefs
"
)
.
childElementCount
filteredPrefArray
.
length
+
1
)
;
search
.
value
=
"
"
;
search
.
focus
(
)
;
EventUtils
.
sendKey
(
"
return
"
)
;
Assert
.
greater
(
this
.
document
.
getElementById
(
"
prefs
"
)
.
childElementCount
prefArray
.
length
-
50
)
;
search
.
value
=
"
aJunkValueasdf
"
;
search
.
focus
(
)
;
EventUtils
.
sendKey
(
"
return
"
)
;
Assert
.
equal
(
this
.
document
.
getElementById
(
"
prefs
"
)
.
childElementCount
1
)
;
search
.
value
=
"
test
.
aboutconfig
.
a
"
;
search
.
focus
(
)
;
EventUtils
.
sendKey
(
"
return
"
)
;
Assert
.
equal
(
this
.
document
.
getElementById
(
"
prefs
"
)
.
childElementCount
2
)
;
}
)
;
}
)
;
