ChromeUtils
.
import
(
"
resource
:
/
/
gre
/
modules
/
Services
.
jsm
"
)
;
var
commonFile
=
do_get_file
(
"
.
.
/
.
.
/
.
.
/
.
.
/
.
.
/
toolkit
/
components
/
places
/
tests
/
head_common
.
js
"
false
)
;
if
(
commonFile
)
{
let
uri
=
Services
.
io
.
newFileURI
(
commonFile
)
;
Services
.
scriptloader
.
loadSubScript
(
uri
.
spec
this
)
;
}
ChromeUtils
.
import
(
"
resource
:
/
/
/
modules
/
UrlbarController
.
jsm
"
)
;
ChromeUtils
.
defineModuleGetter
(
this
"
UrlbarInput
"
"
resource
:
/
/
/
modules
/
UrlbarInput
.
jsm
"
)
;
ChromeUtils
.
defineModuleGetter
(
this
"
UrlbarTokenizer
"
"
resource
:
/
/
/
modules
/
UrlbarTokenizer
.
jsm
"
)
;
ChromeUtils
.
defineModuleGetter
(
this
"
PlacesTestUtils
"
"
resource
:
/
/
testing
-
common
/
PlacesTestUtils
.
jsm
"
)
;
ChromeUtils
.
import
(
"
resource
:
/
/
gre
/
modules
/
Timer
.
jsm
"
)
;
Services
.
scriptloader
.
loadSubScript
(
"
resource
:
/
/
testing
-
common
/
sinon
-
2
.
3
.
2
.
js
"
this
)
;
function
createContext
(
searchString
=
"
foo
"
)
{
return
new
QueryContext
(
{
searchString
lastKey
:
searchString
?
searchString
[
searchString
.
length
-
1
]
:
"
"
maxResults
:
Services
.
prefs
.
getIntPref
(
"
browser
.
urlbar
.
maxRichResults
"
)
isPrivate
:
true
}
)
;
}
function
promiseControllerNotification
(
controller
notification
)
{
return
new
Promise
(
resolve
=
>
{
let
proxifiedObserver
=
new
Proxy
(
{
}
{
get
:
(
target
name
)
=
>
{
if
(
name
=
=
notification
)
{
return
(
.
.
.
args
)
=
>
{
controller
.
removeQueryListener
(
proxifiedObserver
)
;
resolve
(
args
)
;
}
;
}
return
(
)
=
>
false
;
}
}
)
;
controller
.
addQueryListener
(
proxifiedObserver
)
;
}
)
;
}
