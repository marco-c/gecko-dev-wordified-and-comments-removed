"
use
strict
"
;
add_task
(
async
function
test_providers
(
)
{
let
match
=
new
UrlbarMatch
(
UrlbarUtils
.
MATCH_TYPE
.
TAB_SWITCH
UrlbarUtils
.
MATCH_SOURCE
.
TABS
{
url
:
"
http
:
/
/
mozilla
.
org
/
foo
/
"
}
)
;
registerBasicTestProvider
(
[
match
]
)
;
let
context
=
createContext
(
)
;
let
controller
=
new
UrlbarController
(
{
browserWindow
:
{
location
:
{
href
:
AppConstants
.
BROWSER_CHROME_URL
}
}
}
)
;
let
resultsPromise
=
promiseControllerNotification
(
controller
"
onQueryResults
"
)
;
await
UrlbarProvidersManager
.
startQuery
(
context
controller
)
;
UrlbarProvidersManager
.
cancelQuery
(
context
)
;
let
params
=
await
resultsPromise
;
Assert
.
deepEqual
(
params
[
0
]
.
results
[
match
]
)
;
}
)
;
add_task
(
async
function
test_criticalSection
(
)
{
await
UrlbarProvidersManager
.
runInCriticalSection
(
async
(
)
=
>
{
let
db
=
await
PlacesUtils
.
promiseLargeCacheDBConnection
(
)
;
await
db
.
execute
(
PRAGMA
page_cache
)
;
}
)
;
}
)
;
