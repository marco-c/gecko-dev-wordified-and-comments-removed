"
use
strict
"
;
add_task
(
async
function
suggestDisabled
(
)
{
await
assertPingSubmitted
(
(
)
=
>
{
UrlbarPrefs
.
set
(
"
quicksuggest
.
enabled
"
false
)
;
}
)
;
UrlbarPrefs
.
clear
(
"
quicksuggest
.
enabled
"
)
;
await
QuickSuggestTestUtils
.
forceSync
(
)
;
}
)
;
add_task
(
async
function
ampDisabled
(
)
{
await
assertPingSubmitted
(
(
)
=
>
{
UrlbarPrefs
.
set
(
"
suggest
.
quicksuggest
.
sponsored
"
false
)
;
}
)
;
UrlbarPrefs
.
clear
(
"
suggest
.
quicksuggest
.
sponsored
"
)
;
await
QuickSuggestTestUtils
.
forceSync
(
)
;
}
)
;
async
function
assertPingSubmitted
(
callback
)
{
let
submitted
=
false
;
GleanPings
.
quickSuggestDeletionRequest
.
testBeforeNextSubmit
(
(
)
=
>
{
submitted
=
true
;
}
)
;
await
callback
(
)
;
await
TestUtils
.
waitForCondition
(
(
)
=
>
submitted
"
Waiting
for
testBeforeNextSubmit
"
)
;
Assert
.
equal
(
Glean
.
quickSuggest
.
contextId
.
testGetValue
(
)
expectedPingContextId
(
)
"
The
ping
should
have
contextId
set
"
)
;
}
