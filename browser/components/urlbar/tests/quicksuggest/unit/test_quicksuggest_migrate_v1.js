"
use
strict
"
;
const
DEFAULT_PREFS
=
{
history
:
{
"
quicksuggest
.
enabled
"
:
false
}
offline
:
{
"
quicksuggest
.
enabled
"
:
true
"
quicksuggest
.
dataCollection
.
enabled
"
:
false
"
quicksuggest
.
shouldShowOnboardingDialog
"
:
false
"
suggest
.
quicksuggest
.
nonsponsored
"
:
true
"
suggest
.
quicksuggest
.
sponsored
"
:
true
}
online
:
{
"
quicksuggest
.
enabled
"
:
true
"
quicksuggest
.
dataCollection
.
enabled
"
:
false
"
quicksuggest
.
shouldShowOnboardingDialog
"
:
true
"
suggest
.
quicksuggest
.
nonsponsored
"
:
false
"
suggest
.
quicksuggest
.
sponsored
"
:
false
}
}
;
const
TEST_OVERRIDES
=
{
migrationVersion
:
1
defaultPrefs
:
DEFAULT_PREFS
}
;
add_task
(
async
function
init
(
)
{
await
QuickSuggestTestUtils
.
initNimbusFeature
(
)
;
}
)
;
add_task
(
async
function
(
)
{
await
doMigrateTest
(
{
testOverrides
:
TEST_OVERRIDES
scenario
:
"
offline
"
expectedPrefs
:
{
defaultBranch
:
DEFAULT_PREFS
.
offline
}
}
)
;
}
)
;
add_task
(
async
function
(
)
{
await
doMigrateTest
(
{
testOverrides
:
TEST_OVERRIDES
initialUserBranch
:
{
"
suggest
.
quicksuggest
.
sponsored
"
:
false
}
scenario
:
"
offline
"
expectedPrefs
:
{
defaultBranch
:
DEFAULT_PREFS
.
offline
userBranch
:
{
"
suggest
.
quicksuggest
.
sponsored
"
:
false
}
}
}
)
;
}
)
;
add_task
(
async
function
(
)
{
await
doMigrateTest
(
{
testOverrides
:
TEST_OVERRIDES
initialUserBranch
:
{
"
suggest
.
quicksuggest
"
:
false
}
scenario
:
"
offline
"
expectedPrefs
:
{
defaultBranch
:
DEFAULT_PREFS
.
offline
userBranch
:
{
"
suggest
.
quicksuggest
.
nonsponsored
"
:
false
"
suggest
.
quicksuggest
.
sponsored
"
:
false
}
}
}
)
;
}
)
;
add_task
(
async
function
(
)
{
await
doMigrateTest
(
{
testOverrides
:
TEST_OVERRIDES
initialUserBranch
:
{
"
suggest
.
quicksuggest
"
:
false
"
suggest
.
quicksuggest
.
sponsored
"
:
false
}
scenario
:
"
offline
"
expectedPrefs
:
{
defaultBranch
:
DEFAULT_PREFS
.
offline
userBranch
:
{
"
suggest
.
quicksuggest
.
nonsponsored
"
:
false
"
suggest
.
quicksuggest
.
sponsored
"
:
false
}
}
}
)
;
}
)
;
add_task
(
async
function
(
)
{
await
doMigrateTest
(
{
testOverrides
:
TEST_OVERRIDES
scenario
:
"
online
"
expectedPrefs
:
{
defaultBranch
:
DEFAULT_PREFS
.
online
}
}
)
;
}
)
;
add_task
(
async
function
(
)
{
await
doMigrateTest
(
{
testOverrides
:
TEST_OVERRIDES
initialUserBranch
:
{
"
suggest
.
quicksuggest
.
sponsored
"
:
false
}
scenario
:
"
online
"
expectedPrefs
:
{
defaultBranch
:
DEFAULT_PREFS
.
online
userBranch
:
{
"
suggest
.
quicksuggest
.
sponsored
"
:
false
}
}
}
)
;
}
)
;
add_task
(
async
function
(
)
{
await
doMigrateTest
(
{
testOverrides
:
TEST_OVERRIDES
initialUserBranch
:
{
"
suggest
.
quicksuggest
"
:
false
}
scenario
:
"
online
"
expectedPrefs
:
{
defaultBranch
:
DEFAULT_PREFS
.
online
userBranch
:
{
"
suggest
.
quicksuggest
.
nonsponsored
"
:
false
}
}
}
)
;
}
)
;
add_task
(
async
function
(
)
{
await
doMigrateTest
(
{
testOverrides
:
TEST_OVERRIDES
initialUserBranch
:
{
"
suggest
.
quicksuggest
"
:
false
"
suggest
.
quicksuggest
.
sponsored
"
:
false
}
scenario
:
"
online
"
expectedPrefs
:
{
defaultBranch
:
DEFAULT_PREFS
.
online
userBranch
:
{
"
suggest
.
quicksuggest
.
nonsponsored
"
:
false
"
suggest
.
quicksuggest
.
sponsored
"
:
false
}
}
}
)
;
}
)
;
add_task
(
async
function
(
)
{
await
doMigrateTest
(
{
testOverrides
:
TEST_OVERRIDES
scenario
:
"
offline
"
expectedPrefs
:
{
defaultBranch
:
DEFAULT_PREFS
.
offline
}
}
)
;
}
)
;
add_task
(
async
function
(
)
{
await
doMigrateTest
(
{
testOverrides
:
TEST_OVERRIDES
initialUserBranch
:
{
"
suggest
.
quicksuggest
.
sponsored
"
:
true
}
scenario
:
"
offline
"
expectedPrefs
:
{
defaultBranch
:
DEFAULT_PREFS
.
offline
userBranch
:
{
"
suggest
.
quicksuggest
.
sponsored
"
:
true
}
}
}
)
;
}
)
;
add_task
(
async
function
(
)
{
await
doMigrateTest
(
{
testOverrides
:
TEST_OVERRIDES
initialUserBranch
:
{
"
suggest
.
quicksuggest
"
:
true
}
scenario
:
"
offline
"
expectedPrefs
:
{
defaultBranch
:
DEFAULT_PREFS
.
offline
userBranch
:
{
"
suggest
.
quicksuggest
.
nonsponsored
"
:
true
}
}
}
)
;
}
)
;
add_task
(
async
function
(
)
{
await
doMigrateTest
(
{
testOverrides
:
TEST_OVERRIDES
initialUserBranch
:
{
"
suggest
.
quicksuggest
"
:
true
"
suggest
.
quicksuggest
.
sponsored
"
:
true
}
scenario
:
"
offline
"
expectedPrefs
:
{
defaultBranch
:
DEFAULT_PREFS
.
offline
userBranch
:
{
"
suggest
.
quicksuggest
.
nonsponsored
"
:
true
"
suggest
.
quicksuggest
.
sponsored
"
:
true
}
}
}
)
;
}
)
;
add_task
(
async
function
(
)
{
await
doMigrateTest
(
{
testOverrides
:
TEST_OVERRIDES
scenario
:
"
online
"
expectedPrefs
:
{
defaultBranch
:
DEFAULT_PREFS
.
online
}
}
)
;
}
)
;
add_task
(
async
function
(
)
{
await
doMigrateTest
(
{
testOverrides
:
TEST_OVERRIDES
initialUserBranch
:
{
"
suggest
.
quicksuggest
.
sponsored
"
:
true
}
scenario
:
"
online
"
expectedPrefs
:
{
defaultBranch
:
DEFAULT_PREFS
.
online
}
}
)
;
}
)
;
add_task
(
async
function
(
)
{
await
doMigrateTest
(
{
testOverrides
:
TEST_OVERRIDES
initialUserBranch
:
{
"
suggest
.
quicksuggest
"
:
true
}
scenario
:
"
online
"
expectedPrefs
:
{
defaultBranch
:
DEFAULT_PREFS
.
online
userBranch
:
{
"
suggest
.
quicksuggest
.
nonsponsored
"
:
true
"
quicksuggest
.
dataCollection
.
enabled
"
:
true
}
}
}
)
;
}
)
;
add_task
(
async
function
(
)
{
await
doMigrateTest
(
{
testOverrides
:
TEST_OVERRIDES
initialUserBranch
:
{
"
suggest
.
quicksuggest
"
:
true
"
suggest
.
quicksuggest
.
sponsored
"
:
true
}
scenario
:
"
online
"
expectedPrefs
:
{
defaultBranch
:
DEFAULT_PREFS
.
online
userBranch
:
{
"
suggest
.
quicksuggest
.
nonsponsored
"
:
true
"
suggest
.
quicksuggest
.
sponsored
"
:
true
"
quicksuggest
.
dataCollection
.
enabled
"
:
true
}
}
}
)
;
}
)
;
