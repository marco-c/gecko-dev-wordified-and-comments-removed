"
use
strict
"
;
XPCOMUtils
.
defineLazyModuleGetters
(
this
{
ExperimentFakes
:
"
resource
:
/
/
testing
-
common
/
NimbusTestUtils
.
jsm
"
NimbusFeatures
:
"
resource
:
/
/
nimbus
/
ExperimentAPI
.
jsm
"
}
)
;
const
DEFAULT_PREFS
=
{
history
:
{
"
quicksuggest
.
enabled
"
:
false
}
offline
:
{
"
quicksuggest
.
enabled
"
:
true
"
quicksuggest
.
dataCollection
.
enabled
"
:
false
"
quicksuggest
.
shouldShowOnboardingDialog
"
:
false
"
suggest
.
quicksuggest
.
nonsponsored
"
:
true
"
suggest
.
quicksuggest
.
sponsored
"
:
true
}
online
:
{
"
quicksuggest
.
enabled
"
:
true
"
quicksuggest
.
dataCollection
.
enabled
"
:
false
"
quicksuggest
.
shouldShowOnboardingDialog
"
:
true
"
suggest
.
quicksuggest
.
nonsponsored
"
:
true
"
suggest
.
quicksuggest
.
sponsored
"
:
true
}
}
;
const
TEST_OVERRIDES
=
undefined
;
add_task
(
async
function
init
(
)
{
await
QuickSuggestTestUtils
.
initNimbusFeature
(
)
;
}
)
;
add_task
(
async
function
(
)
{
await
doMigrateTest
(
{
testOverrides
:
TEST_OVERRIDES
scenario
:
"
offline
"
expectedPrefs
:
{
defaultBranch
:
DEFAULT_PREFS
.
offline
}
}
)
;
}
)
;
add_task
(
async
function
(
)
{
await
doMigrateTest
(
{
testOverrides
:
TEST_OVERRIDES
initialUserBranch
:
{
"
suggest
.
quicksuggest
"
:
false
}
scenario
:
"
offline
"
expectedPrefs
:
{
defaultBranch
:
DEFAULT_PREFS
.
offline
userBranch
:
{
"
suggest
.
quicksuggest
.
nonsponsored
"
:
false
"
suggest
.
quicksuggest
.
sponsored
"
:
false
}
}
}
)
;
}
)
;
add_task
(
async
function
(
)
{
await
doMigrateTest
(
{
testOverrides
:
TEST_OVERRIDES
initialUserBranch
:
{
"
suggest
.
quicksuggest
.
sponsored
"
:
false
}
scenario
:
"
offline
"
expectedPrefs
:
{
defaultBranch
:
DEFAULT_PREFS
.
offline
userBranch
:
{
"
suggest
.
quicksuggest
.
sponsored
"
:
false
}
}
}
)
;
}
)
;
add_task
(
async
function
(
)
{
await
doMigrateTest
(
{
testOverrides
:
TEST_OVERRIDES
initialUserBranch
:
{
"
suggest
.
quicksuggest
"
:
false
"
suggest
.
quicksuggest
.
sponsored
"
:
false
}
scenario
:
"
offline
"
expectedPrefs
:
{
defaultBranch
:
DEFAULT_PREFS
.
offline
userBranch
:
{
"
suggest
.
quicksuggest
.
nonsponsored
"
:
false
"
suggest
.
quicksuggest
.
sponsored
"
:
false
}
}
}
)
;
}
)
;
add_task
(
async
function
(
)
{
await
doMigrateTest
(
{
testOverrides
:
TEST_OVERRIDES
scenario
:
"
online
"
expectedPrefs
:
{
defaultBranch
:
DEFAULT_PREFS
.
online
}
}
)
;
}
)
;
add_task
(
async
function
(
)
{
await
doMigrateTest
(
{
testOverrides
:
TEST_OVERRIDES
initialUserBranch
:
{
"
suggest
.
quicksuggest
"
:
false
}
scenario
:
"
online
"
expectedPrefs
:
{
defaultBranch
:
DEFAULT_PREFS
.
online
userBranch
:
{
"
suggest
.
quicksuggest
.
nonsponsored
"
:
false
"
suggest
.
quicksuggest
.
sponsored
"
:
false
}
}
}
)
;
}
)
;
add_task
(
async
function
(
)
{
await
doMigrateTest
(
{
testOverrides
:
TEST_OVERRIDES
initialUserBranch
:
{
"
suggest
.
quicksuggest
.
sponsored
"
:
false
}
scenario
:
"
online
"
expectedPrefs
:
{
defaultBranch
:
DEFAULT_PREFS
.
online
userBranch
:
{
"
suggest
.
quicksuggest
.
sponsored
"
:
false
}
}
}
)
;
}
)
;
add_task
(
async
function
(
)
{
await
doMigrateTest
(
{
testOverrides
:
TEST_OVERRIDES
initialUserBranch
:
{
"
suggest
.
quicksuggest
"
:
false
"
suggest
.
quicksuggest
.
sponsored
"
:
false
}
scenario
:
"
online
"
expectedPrefs
:
{
defaultBranch
:
DEFAULT_PREFS
.
online
userBranch
:
{
"
suggest
.
quicksuggest
.
nonsponsored
"
:
false
"
suggest
.
quicksuggest
.
sponsored
"
:
false
}
}
}
)
;
}
)
;
add_task
(
async
function
(
)
{
await
withOnlineExperiment
(
async
(
)
=
>
{
await
doMigrateTest
(
{
testOverrides
:
TEST_OVERRIDES
scenario
:
"
online
"
expectedPrefs
:
{
defaultBranch
:
DEFAULT_PREFS
.
online
}
}
)
;
}
)
;
}
)
;
add_task
(
async
function
(
)
{
await
withOnlineExperiment
(
async
(
)
=
>
{
await
doMigrateTest
(
{
testOverrides
:
TEST_OVERRIDES
initialUserBranch
:
{
"
suggest
.
quicksuggest
"
:
true
}
scenario
:
"
online
"
expectedPrefs
:
{
defaultBranch
:
DEFAULT_PREFS
.
online
userBranch
:
{
"
suggest
.
quicksuggest
.
nonsponsored
"
:
true
}
}
}
)
;
}
)
;
}
)
;
add_task
(
async
function
(
)
{
await
withOnlineExperiment
(
async
(
)
=
>
{
await
doMigrateTest
(
{
testOverrides
:
TEST_OVERRIDES
initialUserBranch
:
{
"
suggest
.
quicksuggest
.
sponsored
"
:
true
}
scenario
:
"
online
"
expectedPrefs
:
{
defaultBranch
:
DEFAULT_PREFS
.
online
userBranch
:
{
"
suggest
.
quicksuggest
.
sponsored
"
:
true
}
}
}
)
;
}
)
;
}
)
;
add_task
(
async
function
(
)
{
await
withOnlineExperiment
(
async
(
)
=
>
{
await
doMigrateTest
(
{
testOverrides
:
TEST_OVERRIDES
initialUserBranch
:
{
"
suggest
.
quicksuggest
"
:
true
"
suggest
.
quicksuggest
.
sponsored
"
:
true
}
scenario
:
"
online
"
expectedPrefs
:
{
defaultBranch
:
DEFAULT_PREFS
.
online
userBranch
:
{
"
suggest
.
quicksuggest
.
nonsponsored
"
:
true
"
suggest
.
quicksuggest
.
sponsored
"
:
true
}
}
}
)
;
}
)
;
}
)
;
add_task
(
async
function
(
)
{
await
doMigrateTest
(
{
testOverrides
:
TEST_OVERRIDES
initialUserBranch
:
{
"
quicksuggest
.
showedOnboardingDialog
"
:
true
}
scenario
:
"
online
"
expectedPrefs
:
{
defaultBranch
:
DEFAULT_PREFS
.
online
userBranch
:
{
"
suggest
.
quicksuggest
.
nonsponsored
"
:
false
"
suggest
.
quicksuggest
.
sponsored
"
:
false
"
quicksuggest
.
dataCollection
.
enabled
"
:
false
}
}
}
)
;
}
)
;
add_task
(
async
function
(
)
{
await
doMigrateTest
(
{
testOverrides
:
TEST_OVERRIDES
initialUserBranch
:
{
"
quicksuggest
.
showedOnboardingDialog
"
:
true
"
suggest
.
quicksuggest
"
:
true
}
scenario
:
"
online
"
expectedPrefs
:
{
defaultBranch
:
DEFAULT_PREFS
.
online
userBranch
:
{
"
suggest
.
quicksuggest
.
nonsponsored
"
:
true
"
suggest
.
quicksuggest
.
sponsored
"
:
false
"
quicksuggest
.
dataCollection
.
enabled
"
:
true
}
}
}
)
;
}
)
;
add_task
(
async
function
(
)
{
await
doMigrateTest
(
{
testOverrides
:
TEST_OVERRIDES
initialUserBranch
:
{
"
quicksuggest
.
showedOnboardingDialog
"
:
true
"
suggest
.
quicksuggest
.
sponsored
"
:
true
}
scenario
:
"
online
"
expectedPrefs
:
{
defaultBranch
:
DEFAULT_PREFS
.
online
userBranch
:
{
"
suggest
.
quicksuggest
.
nonsponsored
"
:
false
"
suggest
.
quicksuggest
.
sponsored
"
:
false
"
quicksuggest
.
dataCollection
.
enabled
"
:
false
}
}
}
)
;
}
)
;
add_task
(
async
function
(
)
{
await
doMigrateTest
(
{
testOverrides
:
TEST_OVERRIDES
initialUserBranch
:
{
"
quicksuggest
.
showedOnboardingDialog
"
:
true
"
suggest
.
quicksuggest
"
:
true
"
suggest
.
quicksuggest
.
sponsored
"
:
true
}
scenario
:
"
online
"
expectedPrefs
:
{
defaultBranch
:
DEFAULT_PREFS
.
online
userBranch
:
{
"
suggest
.
quicksuggest
.
nonsponsored
"
:
true
"
suggest
.
quicksuggest
.
sponsored
"
:
true
"
quicksuggest
.
dataCollection
.
enabled
"
:
true
}
}
}
)
;
}
)
;
add_task
(
async
function
(
)
{
await
doMigrateTest
(
{
testOverrides
:
TEST_OVERRIDES
initialUserBranch
:
{
"
quicksuggest
.
migrationVersion
"
:
1
"
quicksuggest
.
scenario
"
:
"
offline
"
}
scenario
:
"
offline
"
expectedPrefs
:
{
defaultBranch
:
DEFAULT_PREFS
.
offline
}
}
)
;
}
)
;
add_task
(
async
function
(
)
{
await
doMigrateTest
(
{
testOverrides
:
TEST_OVERRIDES
initialUserBranch
:
{
"
quicksuggest
.
migrationVersion
"
:
1
"
quicksuggest
.
scenario
"
:
"
offline
"
"
quicksuggest
.
dataCollection
.
enabled
"
:
true
}
scenario
:
"
offline
"
expectedPrefs
:
{
defaultBranch
:
DEFAULT_PREFS
.
offline
userBranch
:
{
"
quicksuggest
.
dataCollection
.
enabled
"
:
true
}
}
}
)
;
}
)
;
add_task
(
async
function
(
)
{
await
doMigrateTest
(
{
testOverrides
:
TEST_OVERRIDES
initialUserBranch
:
{
"
quicksuggest
.
migrationVersion
"
:
1
"
quicksuggest
.
scenario
"
:
"
offline
"
"
suggest
.
quicksuggest
.
sponsored
"
:
false
}
scenario
:
"
offline
"
expectedPrefs
:
{
defaultBranch
:
DEFAULT_PREFS
.
offline
userBranch
:
{
"
suggest
.
quicksuggest
.
sponsored
"
:
false
}
}
}
)
;
}
)
;
add_task
(
async
function
(
)
{
await
doMigrateTest
(
{
testOverrides
:
TEST_OVERRIDES
initialUserBranch
:
{
"
quicksuggest
.
migrationVersion
"
:
1
"
quicksuggest
.
scenario
"
:
"
offline
"
"
suggest
.
quicksuggest
.
nonsponsored
"
:
false
"
suggest
.
quicksuggest
.
sponsored
"
:
false
}
scenario
:
"
offline
"
expectedPrefs
:
{
defaultBranch
:
DEFAULT_PREFS
.
offline
userBranch
:
{
"
suggest
.
quicksuggest
.
nonsponsored
"
:
false
"
suggest
.
quicksuggest
.
sponsored
"
:
false
}
}
}
)
;
}
)
;
add_task
(
async
function
(
)
{
await
doMigrateTest
(
{
testOverrides
:
TEST_OVERRIDES
initialUserBranch
:
{
"
quicksuggest
.
migrationVersion
"
:
1
"
quicksuggest
.
scenario
"
:
"
offline
"
}
scenario
:
"
online
"
expectedPrefs
:
{
defaultBranch
:
DEFAULT_PREFS
.
online
}
}
)
;
}
)
;
add_task
(
async
function
(
)
{
await
doMigrateTest
(
{
testOverrides
:
TEST_OVERRIDES
initialUserBranch
:
{
"
quicksuggest
.
migrationVersion
"
:
1
"
quicksuggest
.
scenario
"
:
"
offline
"
"
suggest
.
quicksuggest
.
sponsored
"
:
false
}
scenario
:
"
online
"
expectedPrefs
:
{
defaultBranch
:
DEFAULT_PREFS
.
online
userBranch
:
{
"
suggest
.
quicksuggest
.
sponsored
"
:
false
}
}
}
)
;
}
)
;
add_task
(
async
function
(
)
{
await
doMigrateTest
(
{
testOverrides
:
TEST_OVERRIDES
initialUserBranch
:
{
"
quicksuggest
.
migrationVersion
"
:
1
"
quicksuggest
.
scenario
"
:
"
offline
"
"
suggest
.
quicksuggest
.
nonsponsored
"
:
false
"
suggest
.
quicksuggest
.
sponsored
"
:
false
}
scenario
:
"
online
"
expectedPrefs
:
{
defaultBranch
:
DEFAULT_PREFS
.
online
userBranch
:
{
"
suggest
.
quicksuggest
.
nonsponsored
"
:
false
"
suggest
.
quicksuggest
.
sponsored
"
:
false
}
}
}
)
;
}
)
;
add_task
(
async
function
(
)
{
await
doMigrateTest
(
{
testOverrides
:
TEST_OVERRIDES
initialUserBranch
:
{
"
quicksuggest
.
migrationVersion
"
:
1
"
quicksuggest
.
scenario
"
:
"
online
"
}
scenario
:
"
online
"
expectedPrefs
:
{
defaultBranch
:
DEFAULT_PREFS
.
online
userBranch
:
{
"
suggest
.
quicksuggest
.
nonsponsored
"
:
false
"
suggest
.
quicksuggest
.
sponsored
"
:
false
}
}
}
)
;
}
)
;
add_task
(
async
function
(
)
{
await
doMigrateTest
(
{
testOverrides
:
TEST_OVERRIDES
initialUserBranch
:
{
"
quicksuggest
.
migrationVersion
"
:
1
"
quicksuggest
.
scenario
"
:
"
online
"
"
quicksuggest
.
dataCollection
.
enabled
"
:
true
}
scenario
:
"
online
"
expectedPrefs
:
{
defaultBranch
:
DEFAULT_PREFS
.
online
userBranch
:
{
"
suggest
.
quicksuggest
.
nonsponsored
"
:
false
"
suggest
.
quicksuggest
.
sponsored
"
:
false
"
quicksuggest
.
dataCollection
.
enabled
"
:
true
}
}
}
)
;
}
)
;
add_task
(
async
function
(
)
{
await
doMigrateTest
(
{
testOverrides
:
TEST_OVERRIDES
initialUserBranch
:
{
"
quicksuggest
.
migrationVersion
"
:
1
"
quicksuggest
.
scenario
"
:
"
online
"
"
suggest
.
quicksuggest
.
sponsored
"
:
true
}
scenario
:
"
online
"
expectedPrefs
:
{
defaultBranch
:
DEFAULT_PREFS
.
online
userBranch
:
{
"
suggest
.
quicksuggest
.
nonsponsored
"
:
false
"
suggest
.
quicksuggest
.
sponsored
"
:
true
}
}
}
)
;
}
)
;
add_task
(
async
function
(
)
{
await
doMigrateTest
(
{
testOverrides
:
TEST_OVERRIDES
initialUserBranch
:
{
"
quicksuggest
.
migrationVersion
"
:
1
"
quicksuggest
.
scenario
"
:
"
online
"
"
suggest
.
quicksuggest
.
sponsored
"
:
true
"
quicksuggest
.
dataCollection
.
enabled
"
:
true
}
scenario
:
"
online
"
expectedPrefs
:
{
defaultBranch
:
DEFAULT_PREFS
.
online
userBranch
:
{
"
suggest
.
quicksuggest
.
nonsponsored
"
:
false
"
suggest
.
quicksuggest
.
sponsored
"
:
true
"
quicksuggest
.
dataCollection
.
enabled
"
:
true
}
}
}
)
;
}
)
;
add_task
(
async
function
(
)
{
await
doMigrateTest
(
{
testOverrides
:
TEST_OVERRIDES
initialUserBranch
:
{
"
quicksuggest
.
migrationVersion
"
:
1
"
quicksuggest
.
scenario
"
:
"
online
"
"
suggest
.
quicksuggest
.
nonsponsored
"
:
true
}
scenario
:
"
online
"
expectedPrefs
:
{
defaultBranch
:
DEFAULT_PREFS
.
online
userBranch
:
{
"
suggest
.
quicksuggest
.
nonsponsored
"
:
true
"
suggest
.
quicksuggest
.
sponsored
"
:
false
}
}
}
)
;
}
)
;
add_task
(
async
function
(
)
{
await
doMigrateTest
(
{
testOverrides
:
TEST_OVERRIDES
initialUserBranch
:
{
"
quicksuggest
.
migrationVersion
"
:
1
"
quicksuggest
.
scenario
"
:
"
online
"
"
suggest
.
quicksuggest
.
nonsponsored
"
:
true
"
quicksuggest
.
dataCollection
.
enabled
"
:
true
}
scenario
:
"
online
"
expectedPrefs
:
{
defaultBranch
:
DEFAULT_PREFS
.
online
userBranch
:
{
"
suggest
.
quicksuggest
.
nonsponsored
"
:
true
"
suggest
.
quicksuggest
.
sponsored
"
:
false
"
quicksuggest
.
dataCollection
.
enabled
"
:
true
}
}
}
)
;
}
)
;
add_task
(
async
function
(
)
{
await
doMigrateTest
(
{
testOverrides
:
TEST_OVERRIDES
initialUserBranch
:
{
"
quicksuggest
.
migrationVersion
"
:
1
"
quicksuggest
.
scenario
"
:
"
online
"
"
suggest
.
quicksuggest
.
nonsponsored
"
:
true
"
suggest
.
quicksuggest
.
sponsored
"
:
true
}
scenario
:
"
online
"
expectedPrefs
:
{
defaultBranch
:
DEFAULT_PREFS
.
online
userBranch
:
{
"
suggest
.
quicksuggest
.
nonsponsored
"
:
true
"
suggest
.
quicksuggest
.
sponsored
"
:
true
}
}
}
)
;
}
)
;
add_task
(
async
function
(
)
{
await
doMigrateTest
(
{
testOverrides
:
TEST_OVERRIDES
initialUserBranch
:
{
"
quicksuggest
.
migrationVersion
"
:
1
"
quicksuggest
.
scenario
"
:
"
online
"
"
suggest
.
quicksuggest
.
nonsponsored
"
:
true
"
suggest
.
quicksuggest
.
sponsored
"
:
true
"
quicksuggest
.
dataCollection
.
enabled
"
:
true
}
scenario
:
"
online
"
expectedPrefs
:
{
defaultBranch
:
DEFAULT_PREFS
.
online
userBranch
:
{
"
suggest
.
quicksuggest
.
nonsponsored
"
:
true
"
suggest
.
quicksuggest
.
sponsored
"
:
true
"
quicksuggest
.
dataCollection
.
enabled
"
:
true
}
}
}
)
;
}
)
;
add_task
(
async
function
(
)
{
await
doMigrateTest
(
{
testOverrides
:
TEST_OVERRIDES
initialUserBranch
:
{
"
quicksuggest
.
migrationVersion
"
:
1
"
quicksuggest
.
scenario
"
:
"
online
"
"
quicksuggest
.
showedOnboardingDialog
"
:
true
}
scenario
:
"
online
"
expectedPrefs
:
{
defaultBranch
:
DEFAULT_PREFS
.
online
userBranch
:
{
"
suggest
.
quicksuggest
.
nonsponsored
"
:
false
"
suggest
.
quicksuggest
.
sponsored
"
:
false
}
}
}
)
;
}
)
;
add_task
(
async
function
(
)
{
await
doMigrateTest
(
{
testOverrides
:
TEST_OVERRIDES
initialUserBranch
:
{
"
quicksuggest
.
migrationVersion
"
:
1
"
quicksuggest
.
scenario
"
:
"
online
"
"
quicksuggest
.
showedOnboardingDialog
"
:
true
"
suggest
.
quicksuggest
.
nonsponsored
"
:
true
}
scenario
:
"
online
"
expectedPrefs
:
{
defaultBranch
:
DEFAULT_PREFS
.
online
userBranch
:
{
"
suggest
.
quicksuggest
.
nonsponsored
"
:
true
"
suggest
.
quicksuggest
.
sponsored
"
:
false
}
}
}
)
;
}
)
;
add_task
(
async
function
(
)
{
await
doMigrateTest
(
{
testOverrides
:
TEST_OVERRIDES
initialUserBranch
:
{
"
quicksuggest
.
migrationVersion
"
:
1
"
quicksuggest
.
scenario
"
:
"
online
"
"
quicksuggest
.
showedOnboardingDialog
"
:
true
"
suggest
.
quicksuggest
.
nonsponsored
"
:
true
"
suggest
.
quicksuggest
.
sponsored
"
:
true
"
quicksuggest
.
dataCollection
.
enabled
"
:
true
}
scenario
:
"
online
"
expectedPrefs
:
{
defaultBranch
:
DEFAULT_PREFS
.
online
userBranch
:
{
"
suggest
.
quicksuggest
.
nonsponsored
"
:
true
"
suggest
.
quicksuggest
.
sponsored
"
:
true
"
quicksuggest
.
dataCollection
.
enabled
"
:
true
}
}
}
)
;
}
)
;
add_task
(
async
function
(
)
{
await
doMigrateTest
(
{
testOverrides
:
TEST_OVERRIDES
initialUserBranch
:
{
"
quicksuggest
.
migrationVersion
"
:
1
"
quicksuggest
.
scenario
"
:
"
online
"
"
quicksuggest
.
showedOnboardingDialog
"
:
true
"
suggest
.
quicksuggest
.
sponsored
"
:
true
"
quicksuggest
.
dataCollection
.
enabled
"
:
true
}
scenario
:
"
online
"
expectedPrefs
:
{
defaultBranch
:
DEFAULT_PREFS
.
online
userBranch
:
{
"
suggest
.
quicksuggest
.
nonsponsored
"
:
false
"
suggest
.
quicksuggest
.
sponsored
"
:
true
"
quicksuggest
.
dataCollection
.
enabled
"
:
true
}
}
}
)
;
}
)
;
add_task
(
async
function
(
)
{
await
doMigrateTest
(
{
testOverrides
:
TEST_OVERRIDES
initialUserBranch
:
{
"
quicksuggest
.
migrationVersion
"
:
1
"
quicksuggest
.
scenario
"
:
"
online
"
"
quicksuggest
.
showedOnboardingDialog
"
:
true
"
suggest
.
quicksuggest
.
nonsponsored
"
:
true
"
suggest
.
quicksuggest
.
sponsored
"
:
true
"
quicksuggest
.
dataCollection
.
enabled
"
:
false
}
scenario
:
"
online
"
expectedPrefs
:
{
defaultBranch
:
DEFAULT_PREFS
.
online
userBranch
:
{
"
suggest
.
quicksuggest
.
nonsponsored
"
:
true
"
suggest
.
quicksuggest
.
sponsored
"
:
true
"
quicksuggest
.
dataCollection
.
enabled
"
:
false
}
}
}
)
;
}
)
;
add_task
(
async
function
(
)
{
await
doMigrateTest
(
{
testOverrides
:
TEST_OVERRIDES
initialUserBranch
:
{
"
quicksuggest
.
migrationVersion
"
:
1
"
quicksuggest
.
scenario
"
:
"
online
"
"
quicksuggest
.
showedOnboardingDialog
"
:
true
"
quicksuggest
.
onboardingDialogChoice
"
:
"
not_now_link
"
"
suggest
.
quicksuggest
.
nonsponsored
"
:
false
"
suggest
.
quicksuggest
.
sponsored
"
:
false
"
quicksuggest
.
dataCollection
.
enabled
"
:
false
}
scenario
:
"
online
"
expectedPrefs
:
{
defaultBranch
:
DEFAULT_PREFS
.
online
userBranch
:
{
"
suggest
.
quicksuggest
.
nonsponsored
"
:
false
"
suggest
.
quicksuggest
.
sponsored
"
:
false
"
quicksuggest
.
dataCollection
.
enabled
"
:
false
}
}
}
)
;
}
)
;
add_task
(
async
function
(
)
{
await
doMigrateTest
(
{
testOverrides
:
TEST_OVERRIDES
initialUserBranch
:
{
"
quicksuggest
.
migrationVersion
"
:
1
"
quicksuggest
.
scenario
"
:
"
online
"
"
quicksuggest
.
showedOnboardingDialog
"
:
true
"
quicksuggest
.
onboardingDialogChoice
"
:
"
accept
"
"
suggest
.
quicksuggest
.
nonsponsored
"
:
true
"
suggest
.
quicksuggest
.
sponsored
"
:
true
"
quicksuggest
.
dataCollection
.
enabled
"
:
true
}
scenario
:
"
online
"
expectedPrefs
:
{
defaultBranch
:
DEFAULT_PREFS
.
online
userBranch
:
{
"
suggest
.
quicksuggest
.
nonsponsored
"
:
true
"
suggest
.
quicksuggest
.
sponsored
"
:
true
"
quicksuggest
.
dataCollection
.
enabled
"
:
true
}
}
}
)
;
}
)
;
async
function
withOnlineExperiment
(
callback
)
{
let
{
enrollmentPromise
doExperimentCleanup
}
=
ExperimentFakes
.
enrollmentHelper
(
ExperimentFakes
.
recipe
(
"
firefox
-
suggest
-
offline
-
vs
-
online
"
{
active
:
true
branches
:
[
{
slug
:
"
treatment
"
features
:
[
{
featureId
:
NimbusFeatures
.
urlbar
.
featureId
value
:
{
enabled
:
true
}
}
]
}
]
}
)
)
;
await
enrollmentPromise
;
await
callback
(
)
;
await
doExperimentCleanup
(
)
;
}
