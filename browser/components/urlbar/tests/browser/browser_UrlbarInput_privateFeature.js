add_task
(
async
function
privateFeatureSetOnNewWindowImplicitly
(
)
{
let
privateWin
=
await
BrowserTestUtils
.
openNewBrowserWindow
(
{
private
:
true
}
)
;
let
newWinOpened
=
BrowserTestUtils
.
waitForNewWindow
(
)
;
privateWin
.
gURLBar
.
_loadURL
(
"
about
:
blank
"
null
"
window
"
{
}
)
;
let
newWin
=
await
newWinOpened
;
Assert
.
equal
(
newWin
.
docShell
.
treeOwner
.
QueryInterface
(
Ci
.
nsIInterfaceRequestor
)
.
getInterface
(
Ci
.
nsIAppWindow
)
.
chromeFlags
&
Ci
.
nsIWebBrowserChrome
.
CHROME_PRIVATE_WINDOW
Ci
.
nsIWebBrowserChrome
.
CHROME_PRIVATE_WINDOW
"
New
window
opened
from
existing
private
window
should
be
marked
as
private
"
)
;
await
BrowserTestUtils
.
closeWindow
(
newWin
)
;
await
BrowserTestUtils
.
closeWindow
(
privateWin
)
;
}
)
;
add_task
(
async
function
privateFeatureSetOnNewWindowExplicitly
(
)
{
let
privateWin
=
await
BrowserTestUtils
.
openNewBrowserWindow
(
{
private
:
true
}
)
;
let
newWinOpened
=
BrowserTestUtils
.
waitForNewWindow
(
)
;
privateWin
.
gURLBar
.
_loadURL
(
"
about
:
blank
"
null
"
window
"
{
private
:
true
}
)
;
let
newWin
=
await
newWinOpened
;
Assert
.
equal
(
newWin
.
docShell
.
treeOwner
.
QueryInterface
(
Ci
.
nsIInterfaceRequestor
)
.
getInterface
(
Ci
.
nsIAppWindow
)
.
chromeFlags
&
Ci
.
nsIWebBrowserChrome
.
CHROME_PRIVATE_WINDOW
Ci
.
nsIWebBrowserChrome
.
CHROME_PRIVATE_WINDOW
"
New
window
opened
from
existing
private
window
should
be
marked
as
private
"
)
;
await
BrowserTestUtils
.
closeWindow
(
newWin
)
;
await
BrowserTestUtils
.
closeWindow
(
privateWin
)
;
}
)
;
add_task
(
async
function
privateFeatureNotSetOnNewWindowExplicitly
(
)
{
let
privateWin
=
await
BrowserTestUtils
.
openNewBrowserWindow
(
{
private
:
true
}
)
;
let
newWinOpened
=
BrowserTestUtils
.
waitForNewWindow
(
)
;
privateWin
.
gURLBar
.
_loadURL
(
"
about
:
blank
"
null
"
window
"
{
private
:
false
}
)
;
let
newWin
=
await
newWinOpened
;
Assert
.
notEqual
(
newWin
.
docShell
.
treeOwner
.
QueryInterface
(
Ci
.
nsIInterfaceRequestor
)
.
getInterface
(
Ci
.
nsIAppWindow
)
.
chromeFlags
&
Ci
.
nsIWebBrowserChrome
.
CHROME_PRIVATE_WINDOW
Ci
.
nsIWebBrowserChrome
.
CHROME_PRIVATE_WINDOW
"
New
window
opened
from
existing
private
window
should
be
marked
as
private
"
)
;
await
BrowserTestUtils
.
closeWindow
(
newWin
)
;
await
BrowserTestUtils
.
closeWindow
(
privateWin
)
;
}
)
;
