"
use
strict
"
;
async
function
checkOpensOnFocus
(
win
=
window
)
{
win
.
gURLBar
.
blur
(
)
;
win
.
gURLBar
.
focus
(
)
;
Assert
.
ok
(
!
win
.
gURLBar
.
view
.
isOpen
"
check
urlbar
panel
is
not
open
"
)
;
win
.
gURLBar
.
blur
(
)
;
await
UrlbarTestUtils
.
promisePopupOpen
(
win
(
)
=
>
{
win
.
document
.
getElementById
(
"
Browser
:
OpenLocation
"
)
.
doCommand
(
)
;
}
)
;
await
UrlbarTestUtils
.
promisePopupClose
(
win
(
)
=
>
{
win
.
gURLBar
.
blur
(
)
;
}
)
;
await
UrlbarTestUtils
.
promisePopupOpen
(
win
(
)
=
>
{
EventUtils
.
synthesizeMouseAtCenter
(
win
.
gURLBar
.
inputField
{
}
win
)
;
}
)
;
await
UrlbarTestUtils
.
promisePopupClose
(
win
(
)
=
>
{
win
.
gURLBar
.
blur
(
)
;
}
)
;
}
add_setup
(
async
function
(
)
{
await
PlacesTestUtils
.
addVisits
(
[
{
uri
:
"
http
:
/
/
mochi
.
test
:
8888
/
"
transition
:
PlacesUtils
.
history
.
TRANSITIONS
.
TYPED
}
]
)
;
registerCleanupFunction
(
(
)
=
>
PlacesUtils
.
history
.
clear
(
)
)
;
}
)
;
add_task
(
async
function
test
(
)
{
await
BrowserTestUtils
.
withNewTab
(
{
gBrowser
url
:
"
about
:
blank
"
}
async
browser
=
>
{
await
checkOpensOnFocus
(
)
;
}
)
;
}
)
;
add_task
(
async
function
newtabAndHome
(
)
{
for
(
let
url
of
[
"
about
:
newtab
"
"
about
:
home
"
]
)
{
await
BrowserTestUtils
.
withNewTab
(
{
gBrowser
url
waitForLoad
:
false
}
async
browser
=
>
{
await
TestUtils
.
waitForCondition
(
(
)
=
>
gBrowser
.
currentURI
.
spec
=
=
url
"
Ensure
we
'
re
on
the
expected
page
"
)
;
await
checkOpensOnFocus
(
)
;
await
BrowserTestUtils
.
withNewTab
(
{
gBrowser
url
:
"
http
:
/
/
example
.
com
/
"
}
async
otherBrowser
=
>
{
await
checkOpensOnFocus
(
)
;
await
BrowserTestUtils
.
switchTab
(
gBrowser
gBrowser
.
getTabForBrowser
(
browser
)
)
;
await
checkOpensOnFocus
(
)
;
await
BrowserTestUtils
.
switchTab
(
gBrowser
gBrowser
.
getTabForBrowser
(
otherBrowser
)
)
;
await
checkOpensOnFocus
(
)
;
}
)
;
await
checkOpensOnFocus
(
)
;
BrowserTestUtils
.
loadURIString
(
gBrowser
.
selectedBrowser
"
http
:
/
/
example
.
com
/
"
)
;
await
BrowserTestUtils
.
browserLoaded
(
gBrowser
.
selectedBrowser
)
;
await
checkOpensOnFocus
(
)
;
}
)
;
}
}
)
;
