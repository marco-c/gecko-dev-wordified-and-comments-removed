"
use
strict
"
;
const
MEGABAR_PREF
=
"
browser
.
urlbar
.
megabar
"
;
add_task
(
async
function
(
)
{
Services
.
prefs
.
setBoolPref
(
MEGABAR_PREF
true
)
;
let
win
=
await
BrowserTestUtils
.
openNewBrowserWindow
(
)
;
registerCleanupFunction
(
(
)
=
>
{
BrowserTestUtils
.
closeWindow
(
win
)
;
Services
.
prefs
.
clearUserPref
(
MEGABAR_PREF
)
;
}
)
;
win
.
gURLBar
.
focus
(
)
;
Assert
.
ok
(
win
.
gURLBar
.
hasAttribute
(
"
breakout
-
extend
"
)
"
The
Urlbar
should
have
the
breakout
-
extend
attribute
.
"
)
;
EventUtils
.
synthesizeMouseAtCenter
(
gURLBar
.
textbox
{
}
win
)
;
Assert
.
ok
(
win
.
gURLBar
.
hasAttribute
(
"
breakout
-
extend
"
)
"
The
Urlbar
should
have
the
breakout
-
extend
attribute
.
"
)
;
let
chromeTarget
=
gURLBar
.
textbox
.
closest
(
"
toolbar
"
)
.
querySelector
(
"
toolbarspring
"
)
;
EventUtils
.
synthesizeMouseAtCenter
(
chromeTarget
{
}
win
)
;
Assert
.
ok
(
!
win
.
gURLBar
.
hasAttribute
(
"
breakout
-
extend
"
)
"
The
Urlbar
should
not
have
the
breakout
-
extend
attribute
.
"
)
;
Assert
.
ok
(
win
.
gURLBar
.
focused
"
The
Urlbar
should
be
focused
.
"
)
;
let
newWin
=
await
BrowserTestUtils
.
openNewBrowserWindow
(
)
;
await
BrowserTestUtils
.
closeWindow
(
newWin
)
;
Assert
.
ok
(
win
.
gURLBar
.
hasAttribute
(
"
breakout
-
extend
"
)
"
The
Urlbar
should
have
the
breakout
-
extend
attribute
.
"
)
;
}
)
;
