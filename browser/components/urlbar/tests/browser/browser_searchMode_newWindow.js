"
use
strict
"
;
add_task
(
async
function
escape
(
)
{
await
doTest
(
win
=
>
EventUtils
.
synthesizeKey
(
"
KEY_Escape
"
{
repeat
:
2
}
win
)
)
;
}
)
;
add_task
(
async
function
backspace
(
)
{
await
doTest
(
win
=
>
EventUtils
.
synthesizeKey
(
"
KEY_Backspace
"
{
}
win
)
)
;
}
)
;
async
function
doTest
(
exitSearchMode
)
{
let
win
=
await
BrowserTestUtils
.
openNewBrowserWindow
(
)
;
await
UrlbarTestUtils
.
promisePopupOpen
(
win
(
)
=
>
EventUtils
.
synthesizeKey
(
"
k
"
{
accelKey
:
true
}
win
)
)
;
await
UrlbarTestUtils
.
assertSearchMode
(
win
{
engineName
:
Services
.
search
.
defaultEngine
.
name
isGeneralPurposeEngine
:
true
source
:
UrlbarUtils
.
RESULT_SOURCE
.
SEARCH
isPreview
:
false
entry
:
"
shortcut
"
}
)
;
await
exitSearchMode
(
win
)
;
await
UrlbarTestUtils
.
assertSearchMode
(
win
null
)
;
await
UrlbarTestUtils
.
promisePopupClose
(
win
)
;
await
BrowserTestUtils
.
closeWindow
(
win
)
;
}
