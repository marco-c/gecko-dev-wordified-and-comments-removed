"
use
strict
"
;
add_task
(
async
function
testSwitchToTabTextDisplay
(
)
{
let
extension
=
ExtensionTestUtils
.
loadExtension
(
{
manifest
:
{
"
omnibox
"
:
{
"
keyword
"
:
"
omniboxtest
"
}
background
(
)
{
browser
.
omnibox
.
setDefaultSuggestion
(
{
description
:
"
doit
"
}
)
;
}
}
}
)
;
await
extension
.
startup
(
)
;
await
UrlbarTestUtils
.
promiseAutocompleteResultPopup
(
{
window
waitForFocus
value
:
"
omniboxtest
"
fireInputEvent
:
true
}
)
;
EventUtils
.
synthesizeKey
(
"
KEY_ArrowDown
"
)
;
EventUtils
.
synthesizeKey
(
"
KEY_ArrowUp
"
)
;
const
extensionText
=
document
.
getElementById
(
"
extension
"
)
;
Assert
.
ok
(
BrowserTestUtils
.
is_visible
(
extensionText
)
)
;
Assert
.
equal
(
extensionText
.
value
"
Extension
:
"
)
;
const
allLabels
=
document
.
getElementById
(
"
urlbar
-
display
-
box
"
)
.
children
;
for
(
let
label
of
allLabels
)
{
if
(
label
!
=
extensionText
)
{
Assert
.
ok
(
BrowserTestUtils
.
is_hidden
(
label
)
)
;
}
}
await
UrlbarTestUtils
.
promisePopupClose
(
window
(
)
=
>
EventUtils
.
synthesizeKey
(
"
KEY_Escape
"
)
)
;
await
extension
.
unload
(
)
;
}
)
;
