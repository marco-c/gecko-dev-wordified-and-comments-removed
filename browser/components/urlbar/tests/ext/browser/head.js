"
use
strict
"
;
Services
.
scriptloader
.
loadSubScript
(
"
chrome
:
/
/
mochitests
/
content
/
browser
/
browser
/
components
/
urlbar
/
tests
/
ext
/
browser
/
head
-
common
.
js
"
this
)
;
const
SCHEMA_BASENAME
=
"
schema
.
json
"
;
const
SCRIPT_BASENAME
=
"
api
.
js
"
;
const
SCHEMA_PATH
=
getTestFilePath
(
SCHEMA_BASENAME
)
;
const
SCRIPT_PATH
=
getTestFilePath
(
SCRIPT_BASENAME
)
;
let
schemaSource
;
let
scriptSource
;
add_task
(
async
function
loadSource
(
)
{
schemaSource
=
await
(
await
fetch
(
"
file
:
/
/
"
+
SCHEMA_PATH
)
)
.
text
(
)
;
scriptSource
=
await
(
await
fetch
(
"
file
:
/
/
"
+
SCRIPT_PATH
)
)
.
text
(
)
;
}
)
;
async
function
loadExtension
(
background
)
{
let
ext
=
ExtensionTestUtils
.
loadExtension
(
{
manifest
:
{
permissions
:
[
"
urlbar
"
]
experiment_apis
:
{
experiments_urlbar
:
{
schema
:
SCHEMA_BASENAME
parent
:
{
scopes
:
[
"
addon_parent
"
]
paths
:
[
[
"
experiments
"
"
urlbar
"
]
]
script
:
SCRIPT_BASENAME
}
}
}
}
files
:
{
[
SCHEMA_BASENAME
]
:
schemaSource
[
SCRIPT_BASENAME
]
:
scriptSource
}
isPrivileged
:
true
background
}
)
;
await
ext
.
startup
(
)
;
return
ext
;
}
