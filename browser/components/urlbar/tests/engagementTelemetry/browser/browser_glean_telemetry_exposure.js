"
use
strict
"
;
requestLongerTimeout
(
6
)
;
add_setup
(
async
function
(
)
{
await
initExposureTest
(
)
;
}
)
;
add_task
(
async
function
engagement
(
)
{
await
doExposureTest
(
{
prefs
:
[
[
"
exposureResults
"
suggestResultType
(
"
adm_sponsored
"
)
]
[
"
showExposureResults
"
true
]
]
query
:
"
amp
"
trigger
:
doClick
expectedResultTypes
:
[
"
adm_sponsored
"
]
shouldBeShown
:
true
}
)
;
}
)
;
add_task
(
async
function
abandonment
(
)
{
await
doExposureTest
(
{
prefs
:
[
[
"
exposureResults
"
suggestResultType
(
"
adm_sponsored
"
)
]
[
"
showExposureResults
"
true
]
]
query
:
"
amp
"
trigger
:
doBlur
expectedResultTypes
:
[
"
adm_sponsored
"
]
shouldBeShown
:
true
}
)
;
}
)
;
add_task
(
async
function
oneExposureResult_shown_matched
(
)
{
await
doExposureTest
(
{
prefs
:
[
[
"
exposureResults
"
suggestResultType
(
"
adm_sponsored
"
)
]
[
"
showExposureResults
"
true
]
]
query
:
"
amp
"
expectedResultTypes
:
[
"
adm_sponsored
"
]
shouldBeShown
:
true
}
)
;
}
)
;
add_task
(
async
function
oneExposureResult_shown_notMatched
(
)
{
await
doExposureTest
(
{
prefs
:
[
[
"
exposureResults
"
suggestResultType
(
"
adm_sponsored
"
)
]
[
"
showExposureResults
"
true
]
]
query
:
"
wikipedia
"
expectedResultTypes
:
[
]
}
)
;
}
)
;
add_task
(
async
function
oneExposureResult_hidden_matched
(
)
{
await
doExposureTest
(
{
prefs
:
[
[
"
exposureResults
"
suggestResultType
(
"
adm_sponsored
"
)
]
[
"
showExposureResults
"
false
]
]
query
:
"
amp
"
expectedResultTypes
:
[
"
adm_sponsored
"
]
shouldBeShown
:
false
}
)
;
}
)
;
add_task
(
async
function
oneExposureResult_hidden_notMatched
(
)
{
await
doExposureTest
(
{
prefs
:
[
[
"
exposureResults
"
suggestResultType
(
"
adm_sponsored
"
)
]
[
"
showExposureResults
"
false
]
]
query
:
"
wikipedia
"
expectedResultTypes
:
[
]
}
)
;
}
)
;
add_task
(
async
function
manyExposureResults_shown_oneMatched_1
(
)
{
await
doExposureTest
(
{
prefs
:
[
[
"
exposureResults
"
[
suggestResultType
(
"
adm_sponsored
"
)
suggestResultType
(
"
adm_nonsponsored
"
)
]
.
join
(
"
"
)
]
[
"
showExposureResults
"
true
]
]
query
:
"
amp
"
expectedResultTypes
:
[
"
adm_sponsored
"
]
shouldBeShown
:
true
}
)
;
}
)
;
add_task
(
async
function
manyExposureResults_shown_oneMatched_2
(
)
{
await
doExposureTest
(
{
prefs
:
[
[
"
exposureResults
"
[
suggestResultType
(
"
adm_sponsored
"
)
suggestResultType
(
"
adm_nonsponsored
"
)
]
.
join
(
"
"
)
]
[
"
showExposureResults
"
true
]
]
query
:
"
wikipedia
"
expectedResultTypes
:
[
"
adm_nonsponsored
"
]
shouldBeShown
:
true
}
)
;
}
)
;
add_task
(
async
function
manyExposureResults_shown_manyMatched
(
)
{
await
doExposureTest
(
{
prefs
:
[
[
"
exposureResults
"
[
suggestResultType
(
"
adm_sponsored
"
)
suggestResultType
(
"
adm_nonsponsored
"
)
]
.
join
(
"
"
)
]
[
"
showExposureResults
"
true
]
]
query
:
"
amp
and
wikipedia
"
expectedResultTypes
:
[
"
adm_sponsored
"
]
shouldBeShown
:
true
}
)
;
}
)
;
add_task
(
async
function
manyExposureResults_hidden_oneMatched_1
(
)
{
await
doExposureTest
(
{
prefs
:
[
[
"
exposureResults
"
[
suggestResultType
(
"
adm_sponsored
"
)
suggestResultType
(
"
adm_nonsponsored
"
)
]
.
join
(
"
"
)
]
[
"
showExposureResults
"
false
]
]
query
:
"
amp
"
expectedResultTypes
:
[
"
adm_sponsored
"
]
shouldBeShown
:
false
}
)
;
}
)
;
add_task
(
async
function
manyExposureResults_hidden_oneMatched_2
(
)
{
await
doExposureTest
(
{
prefs
:
[
[
"
exposureResults
"
[
suggestResultType
(
"
adm_sponsored
"
)
suggestResultType
(
"
adm_nonsponsored
"
)
]
.
join
(
"
"
)
]
[
"
showExposureResults
"
false
]
]
query
:
"
wikipedia
"
expectedResultTypes
:
[
"
adm_nonsponsored
"
]
shouldBeShown
:
false
}
)
;
}
)
;
add_task
(
async
function
manyExposureResults_hidden_manyMatched
(
)
{
await
doExposureTest
(
{
prefs
:
[
[
"
exposureResults
"
[
suggestResultType
(
"
adm_sponsored
"
)
suggestResultType
(
"
adm_nonsponsored
"
)
]
.
join
(
"
"
)
]
[
"
showExposureResults
"
false
]
]
query
:
"
amp
and
wikipedia
"
expectedResultTypes
:
[
"
adm_nonsponsored
"
"
adm_sponsored
"
]
shouldBeShown
:
false
}
)
;
}
)
;
add_task
(
async
function
modifyQuery_terminal
(
)
{
await
doExposureTest
(
{
prefs
:
[
[
"
exposureResults
"
suggestResultType
(
"
adm_sponsored
"
)
]
[
"
showExposureResults
"
true
]
]
query
:
"
wikipedia
"
trigger
:
async
(
)
=
>
{
gURLBar
.
select
(
)
;
EventUtils
.
synthesizeKey
(
"
KEY_Backspace
"
)
;
await
openPopup
(
"
amp
"
)
;
await
doClick
(
)
;
}
expectedResultTypes
:
[
"
adm_sponsored
"
]
shouldBeShown
:
false
}
)
;
}
)
;
add_task
(
async
function
modifyQuery_nonTerminal
(
)
{
await
doExposureTest
(
{
prefs
:
[
[
"
exposureResults
"
suggestResultType
(
"
adm_sponsored
"
)
]
[
"
showExposureResults
"
true
]
]
query
:
"
amp
"
trigger
:
async
(
)
=
>
{
gURLBar
.
select
(
)
;
EventUtils
.
synthesizeKey
(
"
KEY_Backspace
"
)
;
await
openPopup
(
"
wikipedia
"
)
;
await
doClick
(
)
;
}
expectedResultTypes
:
[
"
adm_sponsored
"
]
shouldBeShown
:
true
}
)
;
}
)
;
add_task
(
async
function
suggestExposure_matched
(
)
{
await
doExposureTest
(
{
prefs
:
[
[
"
quicksuggest
.
exposureSuggestionTypes
"
"
aaa
"
]
]
query
:
"
aaa
keyword
"
expectedResultTypes
:
[
"
exposure
"
]
shouldBeShown
:
false
}
)
;
}
)
;
add_task
(
async
function
suggestExposure_notMatched
(
)
{
await
doExposureTest
(
{
prefs
:
[
[
"
quicksuggest
.
exposureSuggestionTypes
"
"
aaa
"
]
]
query
:
"
bbb
keyword
"
expectedResultTypes
:
[
]
}
)
;
}
)
;
add_task
(
async
function
suggestExposure_showExposureResults
(
)
{
await
doExposureTest
(
{
prefs
:
[
[
"
quicksuggest
.
exposureSuggestionTypes
"
"
aaa
"
]
[
"
showExposureResults
"
true
]
]
query
:
"
aaa
keyword
"
expectedResultTypes
:
[
"
exposure
"
]
shouldBeShown
:
false
}
)
;
}
)
;
