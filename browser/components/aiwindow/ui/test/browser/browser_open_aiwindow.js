"
use
strict
"
;
add_task
(
async
function
test_ai_menuitem_pref_connection
(
)
{
await
SpecialPowers
.
pushPrefEnv
(
{
set
:
[
[
"
browser
.
aiwindow
.
enabled
"
false
]
]
}
)
;
const
menuButton
=
document
.
getElementById
(
"
PanelUI
-
menu
-
button
"
)
;
const
mainViewID
=
"
appMenu
-
mainView
"
;
const
mainView
=
PanelMultiView
.
getViewNode
(
document
mainViewID
)
;
let
viewShownPromise
=
BrowserTestUtils
.
waitForEvent
(
mainView
"
ViewShown
"
)
;
menuButton
.
click
(
)
;
await
viewShownPromise
;
const
aiMenuItem
=
document
.
getElementById
(
"
appMenu
-
new
-
ai
-
window
-
button
"
)
;
Assert
.
equal
(
PanelUI
.
isAIWindowEnabled
false
"
PanelUI
.
isAIWindowEnabled
should
be
false
when
pref
is
false
"
)
;
Assert
.
ok
(
aiMenuItem
.
hidden
"
AI
menu
item
should
be
hidden
when
pref
is
false
"
)
;
let
panelHiddenPromise
=
BrowserTestUtils
.
waitForEvent
(
document
.
getElementById
(
"
appMenu
-
popup
"
)
"
popuphidden
"
)
;
PanelUI
.
hide
(
)
;
await
panelHiddenPromise
;
await
SpecialPowers
.
pushPrefEnv
(
{
set
:
[
[
"
browser
.
aiwindow
.
enabled
"
true
]
]
}
)
;
viewShownPromise
=
BrowserTestUtils
.
waitForEvent
(
mainView
"
ViewShown
"
)
;
menuButton
.
click
(
)
;
await
viewShownPromise
;
Assert
.
equal
(
PanelUI
.
isAIWindowEnabled
true
"
PanelUI
.
isAIWindowEnabled
should
be
true
when
pref
is
true
"
)
;
Assert
.
ok
(
!
aiMenuItem
.
hidden
"
AI
menu
item
should
be
visible
when
pref
is
true
"
)
;
panelHiddenPromise
=
BrowserTestUtils
.
waitForEvent
(
document
.
getElementById
(
"
appMenu
-
popup
"
)
"
popuphidden
"
)
;
PanelUI
.
hide
(
)
;
await
panelHiddenPromise
;
await
SpecialPowers
.
popPrefEnv
(
)
;
await
SpecialPowers
.
popPrefEnv
(
)
;
}
)
;
add_task
(
async
function
test_ai_menuitem_opens_window_with_attribute
(
)
{
await
SpecialPowers
.
pushPrefEnv
(
{
set
:
[
[
"
browser
.
aiwindow
.
enabled
"
true
]
]
}
)
;
const
menuButton
=
document
.
getElementById
(
"
PanelUI
-
menu
-
button
"
)
;
const
mainView
=
document
.
getElementById
(
"
appMenu
-
mainView
"
)
;
const
viewShownPromise
=
BrowserTestUtils
.
waitForEvent
(
mainView
"
ViewShown
"
)
;
menuButton
.
click
(
)
;
await
viewShownPromise
;
const
delayedStartupPromise
=
BrowserTestUtils
.
waitForNewWindow
(
)
;
const
aiMenuItem
=
document
.
getElementById
(
"
appMenu
-
new
-
ai
-
window
-
button
"
)
;
aiMenuItem
.
click
(
)
;
const
newWin
=
await
delayedStartupPromise
;
Assert
.
ok
(
newWin
.
document
.
documentElement
.
hasAttribute
(
"
ai
-
window
"
)
"
New
window
should
have
the
ai
-
window
attribute
"
)
;
await
BrowserTestUtils
.
closeWindow
(
newWin
)
;
await
SpecialPowers
.
popPrefEnv
(
)
;
}
)
;
