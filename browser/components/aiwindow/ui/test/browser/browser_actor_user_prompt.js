"
use
strict
"
;
add_task
(
async
function
test_user_prompt_dispatch
(
)
{
await
SpecialPowers
.
pushPrefEnv
(
{
set
:
[
[
"
browser
.
aiwindow
.
enabled
"
true
]
]
}
)
;
await
BrowserTestUtils
.
withNewTab
(
"
about
:
aichatcontent
"
async
browser
=
>
{
const
actor
=
browser
.
browsingContext
.
currentWindowGlobal
.
getActor
(
"
AIChatContent
"
)
;
const
testPrompt
=
{
role
:
"
user
"
content
:
"
Hello
AI
!
"
}
;
const
result
=
await
actor
.
dispatchMessageToChatContent
(
testPrompt
)
;
Assert
.
equal
(
result
undefined
"
dispatchUserPrompt
should
complete
successfully
"
)
;
}
)
;
}
)
;
add_task
(
async
function
test_streaming_ai_response
(
)
{
await
BrowserTestUtils
.
withNewTab
(
"
about
:
aichatcontent
"
async
browser
=
>
{
const
actor
=
browser
.
browsingContext
.
currentWindowGlobal
.
getActor
(
"
AIChatContent
"
)
;
const
streamingResponse
=
{
role
:
"
assistant
"
content
:
"
Partial
AI
response
.
.
.
"
latestAssistantMessageIndex
:
0
}
;
const
result
=
await
actor
.
dispatchMessageToChatContent
(
streamingResponse
)
;
Assert
.
equal
(
result
undefined
"
Streaming
AI
response
should
be
dispatched
successfully
"
)
;
}
)
;
await
SpecialPowers
.
popPrefEnv
(
)
;
}
)
;
