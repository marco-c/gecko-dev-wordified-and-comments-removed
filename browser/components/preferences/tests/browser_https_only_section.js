"
use
strict
"
;
const
HTTPS_ONLY_ENABLED
=
"
enabled
"
;
const
HTTPS_ONLY_PBM_ONLY
=
"
privateOnly
"
;
const
HTTPS_ONLY_DISABLED
=
"
disabled
"
;
add_task
(
async
function
httpsOnlyRadioGroupIsWorking
(
)
{
registerCleanupFunction
(
async
function
(
)
{
Services
.
prefs
.
clearUserPref
(
"
dom
.
security
.
https_only_mode
"
)
;
Services
.
prefs
.
clearUserPref
(
"
dom
.
security
.
https_only_mode_pbm
"
)
;
}
)
;
await
SpecialPowers
.
setBoolPref
(
"
dom
.
security
.
https_only_mode
"
false
)
;
await
SpecialPowers
.
setBoolPref
(
"
dom
.
security
.
https_only_mode_pbm
"
true
)
;
await
openPreferencesViaOpenPreferencesAPI
(
"
privacy
"
{
leaveOpen
:
true
}
)
;
const
doc
=
gBrowser
.
selectedBrowser
.
contentDocument
;
const
radioGroup
=
doc
.
getElementById
(
"
httpsOnlyRadioGroup
"
)
;
const
enableAllRadio
=
doc
.
getElementById
(
"
httpsOnlyRadioEnabled
"
)
;
const
enablePbmRadio
=
doc
.
getElementById
(
"
httpsOnlyRadioEnabledPBM
"
)
;
const
disableRadio
=
doc
.
getElementById
(
"
httpsOnlyRadioDisabled
"
)
;
check
(
radioGroup
HTTPS_ONLY_PBM_ONLY
)
;
await
SpecialPowers
.
setBoolPref
(
"
dom
.
security
.
https_only_mode_pbm
"
false
)
;
check
(
radioGroup
HTTPS_ONLY_DISABLED
)
;
enableAllRadio
.
click
(
)
;
check
(
radioGroup
HTTPS_ONLY_ENABLED
)
;
enableAllRadio
.
click
(
)
;
check
(
radioGroup
HTTPS_ONLY_ENABLED
)
;
enablePbmRadio
.
click
(
)
;
check
(
radioGroup
HTTPS_ONLY_PBM_ONLY
)
;
disableRadio
.
click
(
)
;
check
(
radioGroup
HTTPS_ONLY_DISABLED
)
;
BrowserTestUtils
.
removeTab
(
gBrowser
.
selectedTab
)
;
}
)
;
function
check
(
radioGroupElement
expectedValue
)
{
is
(
radioGroupElement
.
value
expectedValue
"
Radio
Group
value
should
match
expected
value
"
)
;
is
(
SpecialPowers
.
getBoolPref
(
"
dom
.
security
.
https_only_mode
"
)
expectedValue
=
=
=
HTTPS_ONLY_ENABLED
"
HTTPS
-
Only
pref
should
match
expected
value
.
"
)
;
is
(
SpecialPowers
.
getBoolPref
(
"
dom
.
security
.
https_only_mode_pbm
"
)
expectedValue
=
=
=
HTTPS_ONLY_PBM_ONLY
"
HTTPS
-
Only
PBM
pref
should
match
expected
value
.
"
)
;
}
