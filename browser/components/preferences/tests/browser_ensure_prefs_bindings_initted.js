"
use
strict
"
;
add_task
(
async
function
test_prefs_bindings_initted
(
)
{
await
openPreferencesViaOpenPreferencesAPI
(
"
general
"
{
leaveOpen
:
true
}
)
;
let
doc
=
gBrowser
.
selectedBrowser
.
contentDocument
;
let
prefReader
=
doc
.
ownerGlobal
.
Preferences
;
let
prefBasedCheckboxes
=
Array
.
from
(
doc
.
querySelectorAll
(
"
checkbox
[
preference
]
"
)
)
;
for
(
let
checkbox
of
prefBasedCheckboxes
)
{
let
pref
=
checkbox
.
getAttribute
(
"
preference
"
)
;
if
(
Services
.
prefs
.
getPrefType
(
pref
)
=
=
Services
.
prefs
.
PREF_BOOL
)
{
info
(
Waiting
for
checkbox
to
match
pref
{
pref
}
)
;
await
BrowserTestUtils
.
waitForMutationCondition
(
checkbox
{
attributeFilter
:
[
"
checked
"
]
}
(
)
=
>
checkbox
.
checked
=
=
prefReader
.
get
(
pref
)
.
value
)
;
is
(
checkbox
.
checked
prefReader
.
get
(
pref
)
.
value
Checkbox
value
should
match
preference
(
{
pref
}
)
.
)
;
}
}
BrowserTestUtils
.
removeTab
(
gBrowser
.
selectedTab
)
;
}
)
;
