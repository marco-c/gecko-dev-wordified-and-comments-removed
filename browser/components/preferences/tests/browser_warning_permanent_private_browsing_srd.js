"
use
strict
"
;
function
checkForPrompt
(
prefVal
)
{
return
async
function
(
)
{
await
SpecialPowers
.
pushPrefEnv
(
{
set
:
[
[
"
privacy
.
history
.
custom
"
true
]
[
"
browser
.
privatebrowsing
.
autostart
"
!
prefVal
]
[
"
browser
.
settings
-
redesign
.
history2
.
enabled
"
true
]
]
}
)
;
await
openPreferencesViaOpenPreferencesAPI
(
"
paneHistory
"
{
leaveOpen
:
true
}
)
;
let
doc
=
gBrowser
.
contentDocument
;
let
promptFired
=
false
;
doc
.
defaultView
.
confirmRestartPrompt
=
(
)
=
>
{
promptFired
=
true
;
return
doc
.
defaultView
.
CONFIRM_RESTART_PROMPT_RESTART_NOW
;
}
;
let
checkbox
=
gBrowser
.
contentWindow
.
document
.
querySelector
(
"
setting
-
group
[
groupid
=
'
historyAdvanced
'
]
#
privateBrowsingAutoStart
"
)
;
ok
(
checkbox
"
the
privateBrowsingAutoStart
checkbox
should
exist
"
)
;
is_element_visible
(
checkbox
"
the
privateBrowsingAutoStart
checkbox
should
be
visible
"
)
;
if
(
checkbox
.
checked
=
=
=
prefVal
)
{
return
;
}
checkbox
.
scrollIntoView
(
)
;
await
EventUtils
.
synthesizeMouseAtCenter
(
checkbox
{
}
checkbox
.
ownerGlobal
)
;
ok
(
promptFired
Expect
a
prompt
when
turning
permanent
private
browsing
{
prefVal
?
"
on
"
:
"
off
"
}
!
)
;
BrowserTestUtils
.
removeTab
(
gBrowser
.
selectedTab
)
;
await
SpecialPowers
.
popPrefEnv
(
)
;
}
;
}
add_task
(
checkForPrompt
(
true
)
)
;
add_task
(
checkForPrompt
(
false
)
)
;
