const
{
classes
:
Cc
Constructor
:
CC
interfaces
:
Ci
utils
:
Cu
}
=
Components
;
const
TEST_DOMAIN
=
"
http
:
/
/
example
.
net
/
"
;
const
TEST_PATH
=
TEST_DOMAIN
+
"
browser
/
browser
/
components
/
resistFingerprinting
/
test
/
browser
/
"
;
let
gMaxAvailWidth
;
let
gMaxAvailHeight
;
let
gPopupChromeUIWidth
;
let
gPopupChromeUIHeight
;
const
TESTCASES
=
[
{
settingWidth
:
1025
settingHeight
:
1050
targetWidth
:
1000
targetHeight
:
1000
initWidth
:
200
initHeight
:
100
}
{
settingWidth
:
9999
settingHeight
:
9999
targetWidth
:
1000
targetHeight
:
1000
initWidth
:
200
initHeight
:
100
}
{
settingWidth
:
999
settingHeight
:
999
targetWidth
:
1000
targetHeight
:
1000
initWidth
:
200
initHeight
:
100
}
]
;
add_task
(
function
*
setup
(
)
{
yield
SpecialPowers
.
pushPrefEnv
(
{
"
set
"
:
[
[
"
privacy
.
resistFingerprinting
"
true
]
]
}
)
;
let
popUpChromeUISize
=
yield
calcPopUpWindowChromeUISize
(
)
;
gPopupChromeUIWidth
=
popUpChromeUISize
.
chromeWidth
;
gPopupChromeUIHeight
=
popUpChromeUISize
.
chromeHeight
;
let
maxAvailSize
=
yield
calcMaximumAvailSize
(
gPopupChromeUIWidth
gPopupChromeUIHeight
)
;
gMaxAvailWidth
=
maxAvailSize
.
maxAvailWidth
;
gMaxAvailHeight
=
maxAvailSize
.
maxAvailHeight
;
}
)
;
add_task
(
function
*
test_window_size_setting
(
)
{
let
tab
=
yield
BrowserTestUtils
.
openNewForegroundTab
(
gBrowser
TEST_PATH
+
"
file_dummy
.
html
"
)
;
for
(
let
test
of
TESTCASES
)
{
yield
testWindowSizeSetting
(
tab
.
linkedBrowser
test
.
settingWidth
test
.
settingHeight
test
.
targetWidth
test
.
targetHeight
test
.
initWidth
test
.
initHeight
false
gMaxAvailWidth
gMaxAvailHeight
gPopupChromeUIWidth
gPopupChromeUIHeight
)
;
yield
testWindowSizeSetting
(
tab
.
linkedBrowser
test
.
settingWidth
test
.
settingHeight
test
.
targetWidth
test
.
targetHeight
test
.
initWidth
test
.
initHeight
true
gMaxAvailWidth
gMaxAvailHeight
gPopupChromeUIWidth
gPopupChromeUIHeight
)
;
}
yield
BrowserTestUtils
.
removeTab
(
tab
)
;
}
)
;
