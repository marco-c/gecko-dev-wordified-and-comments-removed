add_setup
(
async
function
(
)
{
await
SpecialPowers
.
pushPrefEnv
(
{
set
:
[
[
"
browser
.
newtab
.
preload
"
false
]
[
"
privacy
.
firstparty
.
isolate
"
true
]
]
}
)
;
}
)
;
add_task
(
async
function
test_aboutNewTab
(
)
{
let
win
=
await
BrowserTestUtils
.
openNewBrowserWindow
(
{
remote
:
SpecialPowers
.
useRemoteSubframes
}
)
;
let
gbrowser
=
win
.
gBrowser
;
let
tab
=
BrowserTestUtils
.
addTab
(
gbrowser
"
about
:
newtab
"
)
;
await
BrowserTestUtils
.
browserLoaded
(
tab
.
linkedBrowser
)
;
let
attrs
=
{
firstPartyDomain
:
"
about
.
ef2a7dd5
-
93bc
-
417f
-
a698
-
142c3116864f
.
mozilla
"
}
;
await
SpecialPowers
.
spawn
(
tab
.
linkedBrowser
[
{
attrs
}
]
async
function
(
args
)
{
Assert
.
ok
(
true
"
principal
"
+
content
.
document
.
nodePrincipal
.
origin
)
;
Assert
.
equal
(
content
.
document
.
nodePrincipal
.
originAttributes
.
firstPartyDomain
args
.
attrs
.
firstPartyDomain
"
about
:
newtab
should
have
firstPartyDomain
set
"
)
;
Assert
.
ok
(
content
.
document
.
nodePrincipal
.
isContentPrincipal
"
The
principal
should
be
a
content
principal
.
"
)
;
}
)
;
gbrowser
.
removeTab
(
tab
)
;
win
.
close
(
)
;
}
)
;
