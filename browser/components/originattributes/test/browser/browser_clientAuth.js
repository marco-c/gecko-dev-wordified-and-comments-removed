let
certCached
=
true
;
let
secondTabStarted
=
false
;
function
onCertDialogLoaded
(
subject
)
{
certCached
=
false
;
subject
.
acceptDialog
(
)
;
}
Services
.
obs
.
addObserver
(
onCertDialogLoaded
"
cert
-
dialog
-
loaded
"
)
;
registerCleanupFunction
(
(
)
=
>
{
Services
.
obs
.
removeObserver
(
onCertDialogLoaded
"
cert
-
dialog
-
loaded
"
)
;
}
)
;
async
function
setup
(
)
{
await
SpecialPowers
.
pushPrefEnv
(
{
set
:
[
[
"
security
.
default_personal_cert
"
"
Ask
Every
Time
"
]
]
}
)
;
}
function
getResult
(
)
{
if
(
!
secondTabStarted
)
{
certCached
=
true
;
secondTabStarted
=
true
;
return
true
;
}
let
ret
=
certCached
;
certCached
=
true
;
secondTabStarted
=
false
;
return
ret
;
}
IsolationTestTools
.
runTests
(
"
https
:
/
/
requireclientcert
.
example
.
com
"
getResult
null
setup
true
)
;
