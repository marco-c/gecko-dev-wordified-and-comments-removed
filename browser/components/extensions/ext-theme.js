"
use
strict
"
;
Cu
.
import
(
"
resource
:
/
/
gre
/
modules
/
Services
.
jsm
"
)
;
XPCOMUtils
.
defineLazyModuleGetter
(
this
"
Preferences
"
"
resource
:
/
/
gre
/
modules
/
Preferences
.
jsm
"
)
;
let
themeMap
=
new
WeakMap
(
)
;
class
Theme
{
constructor
(
)
{
this
.
lwtStyles
=
{
}
;
}
load
(
details
)
{
if
(
details
.
colors
)
{
this
.
loadColors
(
details
.
colors
)
;
}
if
(
details
.
images
)
{
this
.
loadImages
(
details
.
images
)
;
}
if
(
this
.
lwtStyles
.
headerURL
&
&
this
.
lwtStyles
.
accentcolor
&
&
this
.
lwtStyles
.
textcolor
)
{
Services
.
obs
.
notifyObservers
(
null
"
lightweight
-
theme
-
styling
-
update
"
JSON
.
stringify
(
this
.
lwtStyles
)
)
;
}
}
loadColors
(
colors
)
{
let
{
accentcolor
textcolor
}
=
colors
;
if
(
accentcolor
)
{
this
.
lwtStyles
.
accentcolor
=
accentcolor
;
}
if
(
textcolor
)
{
this
.
lwtStyles
.
textcolor
=
textcolor
;
}
}
loadImages
(
images
)
{
let
{
headerURL
}
=
images
;
if
(
headerURL
)
{
this
.
lwtStyles
.
headerURL
=
headerURL
;
}
}
unload
(
)
{
Services
.
obs
.
notifyObservers
(
null
"
lightweight
-
theme
-
styling
-
update
"
null
)
;
}
}
extensions
.
on
(
"
manifest_theme
"
(
type
directive
extension
manifest
)
=
>
{
if
(
!
Preferences
.
get
(
"
extensions
.
webextensions
.
themes
.
enabled
"
)
)
{
return
;
}
let
theme
=
new
Theme
(
)
;
theme
.
load
(
manifest
.
theme
)
;
themeMap
.
set
(
extension
theme
)
;
}
)
;
extensions
.
on
(
"
shutdown
"
(
type
extension
)
=
>
{
let
theme
=
themeMap
.
get
(
extension
)
;
if
(
!
theme
)
{
return
;
}
theme
.
unload
(
)
;
}
)
;
extensions
.
registerSchemaAPI
(
"
theme
"
"
addon_parent
"
context
=
>
{
let
{
extension
}
=
context
;
return
{
theme
:
{
update
(
details
)
{
let
theme
=
themeMap
.
get
(
extension
)
;
if
(
!
theme
)
{
return
;
}
theme
.
load
(
details
)
;
}
}
}
;
}
)
;
