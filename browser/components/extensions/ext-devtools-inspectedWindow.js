"
use
strict
"
;
XPCOMUtils
.
defineLazyModuleGetter
(
this
"
DevToolsShim
"
"
chrome
:
/
/
devtools
-
shim
/
content
/
DevToolsShim
.
jsm
"
)
;
var
{
SpreadArgs
}
=
ExtensionCommon
;
this
.
devtools_inspectedWindow
=
class
extends
ExtensionAPI
{
getAPI
(
context
)
{
let
waitForInspectedWindowFront
;
async
function
getInspectedWindowFront
(
)
{
const
clonedTarget
=
await
getDevToolsTargetForContext
(
context
)
;
return
DevToolsShim
.
createWebExtensionInspectedWindowFront
(
clonedTarget
)
;
}
function
getToolboxOptions
(
)
{
const
options
=
{
}
;
const
toolbox
=
context
.
devToolsToolbox
;
const
selectedNode
=
toolbox
.
selection
;
if
(
selectedNode
&
&
selectedNode
.
nodeFront
)
{
options
.
toolboxSelectedNodeActorID
=
selectedNode
.
nodeFront
.
actorID
;
}
options
.
toolboxConsoleActorID
=
toolbox
.
target
.
form
.
consoleActor
;
return
options
;
}
const
callerInfo
=
{
addonId
:
context
.
extension
.
id
url
:
context
.
extension
.
baseURI
.
spec
}
;
return
{
devtools
:
{
inspectedWindow
:
{
async
eval
(
expression
options
)
{
if
(
!
waitForInspectedWindowFront
)
{
waitForInspectedWindowFront
=
getInspectedWindowFront
(
)
;
}
const
front
=
await
waitForInspectedWindowFront
;
const
evalOptions
=
Object
.
assign
(
{
}
options
getToolboxOptions
(
)
)
;
const
evalResult
=
await
front
.
eval
(
callerInfo
expression
evalOptions
)
;
return
new
SpreadArgs
(
[
evalResult
.
value
evalResult
.
exceptionInfo
]
)
;
}
async
reload
(
options
)
{
const
{
ignoreCache
userAgent
injectedScript
}
=
options
|
|
{
}
;
if
(
!
waitForInspectedWindowFront
)
{
waitForInspectedWindowFront
=
getInspectedWindowFront
(
)
;
}
const
front
=
await
waitForInspectedWindowFront
;
front
.
reload
(
callerInfo
{
ignoreCache
userAgent
injectedScript
}
)
;
}
}
}
}
;
}
}
;
