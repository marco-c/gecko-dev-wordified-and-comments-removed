"
use
strict
"
;
add_task
(
async
function
test_onCreated_active
(
)
{
let
extension
=
ExtensionTestUtils
.
loadExtension
(
{
manifest
:
{
permissions
:
[
"
tabs
"
]
}
async
background
(
)
{
let
created
=
false
;
let
tabIds
=
(
await
browser
.
tabs
.
query
(
{
}
)
)
.
map
(
t
=
>
t
.
id
)
;
browser
.
tabs
.
onCreated
.
addListener
(
tab
=
>
{
created
=
tab
.
id
;
browser
.
tabs
.
remove
(
tab
.
id
)
;
browser
.
test
.
sendMessage
(
"
onCreated
"
tab
)
;
}
)
;
browser
.
tabs
.
onUpdated
.
addListener
(
(
tabId
changes
tab
)
=
>
{
if
(
tabIds
.
includes
(
tabId
)
)
{
return
;
}
browser
.
test
.
assertTrue
(
created
tabId
"
tab
created
before
updated
"
)
;
browser
.
test
.
notifyPass
(
"
onUpdated
"
)
;
}
)
;
browser
.
test
.
sendMessage
(
"
ready
"
)
;
}
}
)
;
await
extension
.
startup
(
)
;
await
extension
.
awaitMessage
(
"
ready
"
)
;
BrowserOpenTab
(
)
;
let
tab
=
await
extension
.
awaitMessage
(
"
onCreated
"
)
;
is
(
true
tab
.
active
"
Tab
should
be
active
"
)
;
await
extension
.
awaitFinish
(
"
onUpdated
"
)
;
await
extension
.
unload
(
)
;
}
)
;
