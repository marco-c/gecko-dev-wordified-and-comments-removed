"
use
strict
"
;
let
extData
=
{
manifest
:
{
"
sidebar_action
"
:
{
"
default_panel
"
:
"
sidebar
.
html
"
}
}
useAddonManager
:
"
temporary
"
files
:
{
"
sidebar
.
html
"
:
<
!
DOCTYPE
html
>
<
html
>
<
head
>
<
meta
charset
=
"
utf
-
8
"
/
>
<
script
src
=
"
sidebar
.
js
"
>
<
/
script
>
<
/
head
>
<
body
>
A
Test
Sidebar
<
/
body
>
<
/
html
>
"
sidebar
.
js
"
:
function
(
)
{
window
.
onload
=
(
)
=
>
{
browser
.
test
.
sendMessage
(
"
sidebar
"
)
;
}
;
}
}
background
:
function
(
)
{
browser
.
test
.
onMessage
.
addListener
(
msg
=
>
{
if
(
msg
=
=
=
"
set
-
panel
"
)
{
browser
.
sidebarAction
.
setPanel
(
{
panel
:
"
"
}
)
.
then
(
(
)
=
>
{
browser
.
test
.
notifyFail
(
"
empty
panel
settable
"
)
;
}
)
.
catch
(
(
)
=
>
{
browser
.
test
.
notifyPass
(
"
unable
to
set
empty
panel
"
)
;
}
)
;
}
}
)
;
}
}
;
add_task
(
function
*
sidebar_initial_install
(
)
{
ok
(
document
.
getElementById
(
"
sidebar
-
box
"
)
.
hidden
"
sidebar
box
is
not
visible
"
)
;
let
extension
=
ExtensionTestUtils
.
loadExtension
(
extData
)
;
yield
extension
.
startup
(
)
;
yield
extension
.
awaitMessage
(
"
sidebar
"
)
;
ok
(
!
document
.
getElementById
(
"
sidebar
-
box
"
)
.
hidden
"
sidebar
box
is
visible
"
)
;
ok
(
document
.
getElementById
(
"
sidebar
-
button
"
)
"
sidebar
button
is
in
UI
"
)
;
yield
extension
.
unload
(
)
;
ok
(
document
.
getElementById
(
"
sidebar
-
box
"
)
.
hidden
"
sidebar
box
is
not
visible
"
)
;
CustomizableUI
.
removeWidgetFromArea
(
"
sidebar
-
button
"
CustomizableUI
.
AREA_NAVBAR
)
;
ok
(
!
document
.
getElementById
(
"
sidebar
-
button
"
)
"
sidebar
button
is
not
in
UI
"
)
;
}
)
;
add_task
(
function
*
sidebar_two_sidebar_addons
(
)
{
let
extension2
=
ExtensionTestUtils
.
loadExtension
(
extData
)
;
yield
extension2
.
startup
(
)
;
yield
extension2
.
awaitMessage
(
"
sidebar
"
)
;
ok
(
!
document
.
getElementById
(
"
sidebar
-
box
"
)
.
hidden
"
sidebar
box
is
visible
"
)
;
ok
(
!
document
.
getElementById
(
"
sidebar
-
button
"
)
"
sidebar
button
is
not
in
UI
"
)
;
let
extension3
=
ExtensionTestUtils
.
loadExtension
(
extData
)
;
yield
extension3
.
startup
(
)
;
yield
extension3
.
awaitMessage
(
"
sidebar
"
)
;
ok
(
!
document
.
getElementById
(
"
sidebar
-
box
"
)
.
hidden
"
sidebar
box
is
visible
"
)
;
yield
extension3
.
unload
(
)
;
ok
(
document
.
getElementById
(
"
sidebar
-
box
"
)
.
hidden
"
sidebar
box
is
not
visible
"
)
;
yield
extension2
.
unload
(
)
;
}
)
;
add_task
(
function
*
sidebar_windows
(
)
{
let
extension
=
ExtensionTestUtils
.
loadExtension
(
extData
)
;
yield
extension
.
startup
(
)
;
yield
extension
.
awaitMessage
(
"
sidebar
"
)
;
ok
(
!
document
.
getElementById
(
"
sidebar
-
box
"
)
.
hidden
"
sidebar
box
is
visible
in
first
window
"
)
;
let
elements
=
document
.
getElementsByClassName
(
"
webextension
-
menuitem
"
)
;
is
(
elements
.
length
1
"
have
one
menuitem
"
)
;
let
style
=
elements
[
0
]
.
getAttribute
(
"
style
"
)
;
ok
(
style
.
includes
(
"
webextension
-
menuitem
-
image
"
)
"
this
menu
has
style
"
)
;
let
secondSidebar
=
extension
.
awaitMessage
(
"
sidebar
"
)
;
let
win
=
yield
BrowserTestUtils
.
openNewBrowserWindow
(
{
opener
:
window
}
)
;
yield
secondSidebar
;
ok
(
!
win
.
document
.
getElementById
(
"
sidebar
-
box
"
)
.
hidden
"
sidebar
box
is
visible
in
second
window
"
)
;
elements
=
win
.
document
.
getElementsByClassName
(
"
webextension
-
menuitem
"
)
;
is
(
elements
.
length
1
"
have
one
menuitem
"
)
;
style
=
elements
[
0
]
.
getAttribute
(
"
style
"
)
;
ok
(
style
.
includes
(
"
webextension
-
menuitem
-
image
"
)
"
this
menu
has
style
"
)
;
yield
extension
.
unload
(
)
;
yield
BrowserTestUtils
.
closeWindow
(
win
)
;
}
)
;
add_task
(
function
*
sidebar_empty_panel
(
)
{
let
extension
=
ExtensionTestUtils
.
loadExtension
(
extData
)
;
yield
extension
.
startup
(
)
;
yield
extension
.
awaitMessage
(
"
sidebar
"
)
;
ok
(
!
document
.
getElementById
(
"
sidebar
-
box
"
)
.
hidden
"
sidebar
box
is
visible
in
first
window
"
)
;
extension
.
sendMessage
(
"
set
-
panel
"
)
;
yield
extension
.
awaitFinish
(
)
;
yield
extension
.
unload
(
)
;
}
)
;
add_task
(
function
*
cleanup
(
)
{
Services
.
prefs
.
clearUserPref
(
"
extensions
.
sidebar
-
button
.
shown
"
)
;
}
)
;
