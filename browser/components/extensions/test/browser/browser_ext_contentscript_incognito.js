"
use
strict
"
;
add_task
(
async
function
test_contentscript_window_open_doesnot_crash
(
)
{
const
extension
=
ExtensionTestUtils
.
loadExtension
(
{
incognitoOverride
:
"
spanning
"
manifest
:
{
content_scripts
:
[
{
matches
:
[
"
https
:
/
/
example
.
com
/
*
"
]
js
:
[
"
test_window_open
.
js
"
]
}
]
}
files
:
{
"
test_window_open
.
js
"
:
function
(
)
{
const
newWin
=
window
.
open
(
)
;
browser
.
test
.
log
(
"
calling
window
.
open
did
not
triggered
a
crash
"
)
;
browser
.
test
.
sendMessage
(
"
window
-
open
-
called
"
!
!
newWin
)
;
}
}
}
)
;
await
extension
.
startup
(
)
;
const
winPrivate
=
await
BrowserTestUtils
.
openNewBrowserWindow
(
{
private
:
true
}
)
;
await
BrowserTestUtils
.
openNewForegroundTab
(
winPrivate
.
gBrowser
"
https
:
/
/
example
.
com
"
)
;
const
newWinOpened
=
await
extension
.
awaitMessage
(
"
window
-
open
-
called
"
)
;
ok
(
newWinOpened
"
Content
script
successfully
open
a
new
window
"
)
;
await
extension
.
unload
(
)
;
await
BrowserTestUtils
.
closeWindow
(
winPrivate
)
;
}
)
;
