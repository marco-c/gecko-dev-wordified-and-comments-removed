"
use
strict
"
;
Components
.
utils
.
import
(
"
resource
:
/
/
gre
/
modules
/
XPCOMUtils
.
jsm
"
)
;
XPCOMUtils
.
defineLazyServiceGetter
(
this
"
aboutNewTabService
"
"
mozilla
.
org
/
browser
/
aboutnewtab
-
service
;
1
"
"
nsIAboutNewTabService
"
)
;
let
overrides
=
{
newtab
:
[
]
}
;
extensions
.
on
(
"
manifest_chrome_url_overrides
"
(
type
directive
extension
manifest
)
=
>
{
if
(
manifest
.
chrome_url_overrides
.
newtab
)
{
let
newtab
=
manifest
.
chrome_url_overrides
.
newtab
;
let
url
=
extension
.
baseURI
.
resolve
(
newtab
)
;
if
(
!
overrides
.
newtab
.
length
)
{
aboutNewTabService
.
newTabURL
=
url
;
}
overrides
.
newtab
.
push
(
{
extension
url
}
)
;
}
}
)
;
extensions
.
on
(
"
shutdown
"
(
type
extension
)
=
>
{
let
i
=
overrides
.
newtab
.
findIndex
(
o
=
>
o
.
extension
=
=
=
extension
)
;
if
(
i
!
=
=
-
1
)
{
overrides
.
newtab
.
splice
(
i
1
)
;
if
(
overrides
.
newtab
.
length
)
{
aboutNewTabService
.
newTabURL
=
overrides
.
newtab
[
0
]
.
url
;
}
else
{
aboutNewTabService
.
resetNewTabURL
(
)
;
}
}
}
)
;
