const
{
TabNotes
}
=
ChromeUtils
.
importESModule
(
"
moz
-
src
:
/
/
/
browser
/
components
/
tabnotes
/
TabNotes
.
sys
.
mjs
"
)
;
async
function
getContextMenu
(
triggerNode
contextMenuId
)
{
let
win
=
triggerNode
.
ownerGlobal
;
triggerNode
.
scrollIntoView
(
{
behavior
:
"
instant
"
}
)
;
const
contextMenu
=
win
.
document
.
getElementById
(
contextMenuId
)
;
const
contextMenuShown
=
BrowserTestUtils
.
waitForPopupEvent
(
contextMenu
"
shown
"
)
;
EventUtils
.
synthesizeMouseAtCenter
(
triggerNode
{
type
:
"
contextmenu
"
button
:
2
}
win
)
;
await
contextMenuShown
;
return
contextMenu
;
}
async
function
closeContextMenu
(
contextMenu
)
{
let
menuHidden
=
BrowserTestUtils
.
waitForPopupEvent
(
contextMenu
"
hidden
"
)
;
contextMenu
.
hidePopup
(
)
;
await
menuHidden
;
}
async
function
openPanel
(
panel
opener
)
{
let
panelShown
=
BrowserTestUtils
.
waitForPopupEvent
(
panel
"
shown
"
)
;
Assert
.
equal
(
panel
.
state
"
closed
"
"
Panel
starts
hidden
"
)
;
await
Promise
.
all
(
[
opener
(
)
panelShown
]
)
;
Assert
.
equal
(
panel
.
state
"
open
"
"
Panel
is
now
open
"
)
;
return
panel
;
}
async
function
openTabNoteMenu
(
tab
)
{
let
tabContextMenu
=
await
getContextMenu
(
tab
"
tabContextMenu
"
)
;
let
tabNotePanel
=
document
.
getElementById
(
"
tabNotePanel
"
)
;
let
panelShown
=
BrowserTestUtils
.
waitForPopupEvent
(
tabNotePanel
"
shown
"
)
;
tabContextMenu
.
activateItem
(
document
.
getElementById
(
"
context_addNote
"
)
)
;
await
panelShown
;
return
tabNotePanel
;
}
function
closeTabNoteMenu
(
)
{
let
tabNotePanel
=
document
.
getElementById
(
"
tabNotePanel
"
)
;
let
menuHidden
=
BrowserTestUtils
.
waitForPopupEvent
(
tabNotePanel
"
hidden
"
)
;
tabNotePanel
.
hidePopup
(
)
;
return
menuHidden
;
}
