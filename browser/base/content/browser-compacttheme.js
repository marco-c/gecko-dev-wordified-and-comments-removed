ChromeUtils
.
defineModuleGetter
(
this
"
LightweightThemeManager
"
"
resource
:
/
/
gre
/
modules
/
LightweightThemeManager
.
jsm
"
)
;
var
CompactTheme
=
{
get
styleSheet
(
)
{
delete
this
.
styleSheet
;
for
(
let
styleSheet
of
document
.
styleSheets
)
{
if
(
styleSheet
.
href
=
=
"
chrome
:
/
/
browser
/
skin
/
compacttheme
.
css
"
)
{
this
.
styleSheet
=
styleSheet
;
break
;
}
}
return
this
.
styleSheet
;
}
get
isStyleSheetEnabled
(
)
{
return
this
.
styleSheet
&
&
!
this
.
styleSheet
.
disabled
;
}
isCompactTheme
(
theme
)
{
return
theme
&
&
(
theme
.
id
=
=
"
firefox
-
compact
-
dark
mozilla
.
org
"
|
|
theme
.
id
=
=
"
firefox
-
compact
-
light
mozilla
.
org
"
)
;
}
get
isThemeCurrentlyApplied
(
)
{
return
this
.
isCompactTheme
(
LightweightThemeManager
.
currentThemeWithFallback
)
;
}
init
(
)
{
Services
.
obs
.
addObserver
(
this
"
lightweight
-
theme
-
styling
-
update
"
)
;
if
(
this
.
isThemeCurrentlyApplied
)
{
this
.
_toggleStyleSheet
(
true
)
;
}
}
observe
(
subject
topic
data
)
{
if
(
topic
=
=
"
lightweight
-
theme
-
styling
-
update
"
)
{
if
(
this
.
isCompactTheme
(
subject
.
wrappedJSObject
.
theme
)
)
{
this
.
_toggleStyleSheet
(
true
)
;
}
else
{
this
.
_toggleStyleSheet
(
false
)
;
}
}
}
_toggleStyleSheet
(
enabled
)
{
let
wasEnabled
=
this
.
isStyleSheetEnabled
;
if
(
enabled
)
{
this
.
styleSheet
.
disabled
=
false
;
}
else
if
(
!
enabled
&
&
wasEnabled
)
{
this
.
styleSheet
.
disabled
=
true
;
}
}
uninit
(
)
{
Services
.
obs
.
removeObserver
(
this
"
lightweight
-
theme
-
styling
-
update
"
)
;
this
.
styleSheet
=
null
;
}
}
;
