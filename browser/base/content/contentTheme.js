"
use
strict
"
;
{
const
prefersDarkQuery
=
window
.
matchMedia
(
"
(
prefers
-
color
-
scheme
:
dark
)
"
)
;
function
_isTextColorDark
(
r
g
b
)
{
return
0
.
2125
*
r
+
0
.
7154
*
g
+
0
.
0721
*
b
<
=
110
;
}
const
inContentVariableMap
=
[
[
"
-
-
newtab
-
background
-
color
"
{
lwtProperty
:
"
ntp_background
"
processColor
(
rgbaChannels
)
{
if
(
!
rgbaChannels
)
{
return
null
;
}
const
{
r
g
b
}
=
rgbaChannels
;
return
rgb
(
{
r
}
{
g
}
{
b
}
)
;
}
}
]
[
"
-
-
newtab
-
background
-
color
-
secondary
"
{
lwtProperty
:
"
ntp_card_background
"
}
]
[
"
-
-
newtab
-
text
-
primary
-
color
"
{
lwtProperty
:
"
ntp_text
"
processColor
(
rgbaChannels
element
)
{
let
browserStyle
=
element
.
ownerGlobal
.
docShell
.
chromeEventHandler
.
style
;
if
(
!
rgbaChannels
)
{
element
.
removeAttribute
(
"
lwt
-
newtab
"
)
;
element
.
toggleAttribute
(
"
lwt
-
newtab
-
brighttext
"
prefersDarkQuery
.
matches
)
;
browserStyle
.
colorScheme
=
"
"
;
return
null
;
}
element
.
setAttribute
(
"
lwt
-
newtab
"
"
true
"
)
;
const
{
r
g
b
a
}
=
rgbaChannels
;
let
darkMode
=
!
_isTextColorDark
(
r
g
b
)
;
element
.
toggleAttribute
(
"
lwt
-
newtab
-
brighttext
"
darkMode
)
;
browserStyle
.
colorScheme
=
darkMode
?
"
dark
"
:
"
light
"
;
return
rgba
(
{
r
}
{
g
}
{
b
}
{
a
}
)
;
}
}
]
[
"
-
-
lwt
-
sidebar
-
background
-
color
"
{
lwtProperty
:
"
sidebar
"
processColor
(
rgbaChannels
)
{
if
(
!
rgbaChannels
)
{
return
null
;
}
const
{
r
g
b
}
=
rgbaChannels
;
return
rgb
(
{
r
}
{
g
}
{
b
}
)
;
}
}
]
[
"
-
-
lwt
-
sidebar
-
text
-
color
"
{
lwtProperty
:
"
sidebar_text
"
processColor
(
rgbaChannels
element
)
{
if
(
!
rgbaChannels
)
{
element
.
removeAttribute
(
"
lwt
-
sidebar
"
)
;
element
.
removeAttribute
(
"
lwt
-
sidebar
-
brighttext
"
)
;
return
null
;
}
element
.
setAttribute
(
"
lwt
-
sidebar
"
"
true
"
)
;
const
{
r
g
b
a
}
=
rgbaChannels
;
if
(
!
_isTextColorDark
(
r
g
b
)
)
{
element
.
setAttribute
(
"
lwt
-
sidebar
-
brighttext
"
"
true
"
)
;
}
else
{
element
.
removeAttribute
(
"
lwt
-
sidebar
-
brighttext
"
)
;
}
return
rgba
(
{
r
}
{
g
}
{
b
}
{
a
}
)
;
}
}
]
[
"
-
-
lwt
-
sidebar
-
highlight
-
background
-
color
"
{
lwtProperty
:
"
sidebar_highlight
"
processColor
(
rgbaChannels
element
)
{
if
(
!
rgbaChannels
)
{
element
.
removeAttribute
(
"
lwt
-
sidebar
-
highlight
"
)
;
return
null
;
}
element
.
setAttribute
(
"
lwt
-
sidebar
-
highlight
"
"
true
"
)
;
const
{
r
g
b
a
}
=
rgbaChannels
;
return
rgba
(
{
r
}
{
g
}
{
b
}
{
a
}
)
;
}
}
]
[
"
-
-
lwt
-
sidebar
-
highlight
-
text
-
color
"
{
lwtProperty
:
"
sidebar_highlight_text
"
}
]
]
;
const
ContentThemeController
=
{
init
(
)
{
addEventListener
(
"
LightweightTheme
:
Set
"
this
)
;
prefersDarkQuery
.
addEventListener
(
"
change
"
this
)
;
}
handleEvent
(
event
)
{
const
element
=
document
.
body
?
document
.
body
:
document
.
documentElement
;
if
(
event
.
type
=
=
"
LightweightTheme
:
Set
"
)
{
let
{
data
}
=
event
.
detail
;
if
(
!
data
)
{
data
=
{
}
;
}
this
.
_setProperties
(
element
data
)
;
}
else
if
(
event
.
type
=
=
"
change
"
)
{
if
(
!
element
.
hasAttribute
(
"
lwt
-
newtab
"
)
)
{
element
.
toggleAttribute
(
"
lwt
-
newtab
-
brighttext
"
event
.
matches
)
;
}
}
}
_setProperty
(
elem
variableName
value
)
{
if
(
value
)
{
elem
.
style
.
setProperty
(
variableName
value
)
;
}
else
{
elem
.
style
.
removeProperty
(
variableName
)
;
}
}
_setProperties
(
elem
themeData
)
{
for
(
let
[
cssVarName
definition
]
of
inContentVariableMap
)
{
const
{
lwtProperty
processColor
}
=
definition
;
let
value
=
themeData
[
lwtProperty
]
;
if
(
processColor
)
{
value
=
processColor
(
value
elem
)
;
}
else
if
(
value
)
{
const
{
r
g
b
a
}
=
value
;
value
=
rgba
(
{
r
}
{
g
}
{
b
}
{
a
}
)
;
}
this
.
_setProperty
(
elem
cssVarName
value
)
;
}
}
}
;
ContentThemeController
.
init
(
)
;
}
