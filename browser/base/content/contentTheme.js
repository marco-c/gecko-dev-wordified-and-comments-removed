"
use
strict
"
;
{
function
_isTextColorDark
(
r
g
b
)
{
return
(
0
.
2125
*
r
+
0
.
7154
*
g
+
0
.
0721
*
b
)
<
=
110
;
}
const
inContentVariableMap
=
[
[
"
-
-
newtab
-
background
-
color
"
{
lwtProperty
:
"
ntp_background
"
}
]
[
"
-
-
newtab
-
text
-
primary
-
color
"
{
lwtProperty
:
"
ntp_text
"
processColor
(
rgbaChannels
element
)
{
if
(
!
rgbaChannels
)
{
element
.
removeAttribute
(
"
lwt
-
newtab
"
)
;
element
.
removeAttribute
(
"
lwt
-
newtab
-
brighttext
"
)
;
return
null
;
}
element
.
setAttribute
(
"
lwt
-
newtab
"
"
true
"
)
;
const
{
r
g
b
a
}
=
rgbaChannels
;
if
(
!
_isTextColorDark
(
r
g
b
)
)
{
element
.
setAttribute
(
"
lwt
-
newtab
-
brighttext
"
"
true
"
)
;
}
return
rgba
(
{
r
}
{
g
}
{
b
}
{
a
}
)
;
}
}
]
]
;
const
ContentThemeController
=
{
init
(
)
{
addEventListener
(
"
LightweightTheme
:
Set
"
this
)
;
const
event
=
new
CustomEvent
(
"
LightweightTheme
:
Support
"
{
bubbles
:
true
}
)
;
document
.
dispatchEvent
(
event
)
;
}
handleEvent
(
{
detail
}
)
{
if
(
detail
.
type
=
=
"
LightweightTheme
:
Update
"
)
{
let
{
data
}
=
detail
;
if
(
!
data
)
{
data
=
{
}
;
}
this
.
_setProperties
(
document
.
body
data
)
;
}
}
_setProperty
(
elem
variableName
value
)
{
if
(
value
)
{
elem
.
style
.
setProperty
(
variableName
value
)
;
}
else
{
elem
.
style
.
removeProperty
(
variableName
)
;
}
}
_setProperties
(
elem
themeData
)
{
for
(
let
[
cssVarName
definition
]
of
inContentVariableMap
)
{
const
{
lwtProperty
processColor
}
=
definition
;
let
value
=
themeData
[
lwtProperty
]
;
if
(
processColor
)
{
value
=
processColor
(
value
document
.
body
)
;
}
else
if
(
value
)
{
const
{
r
g
b
a
}
=
value
;
value
=
rgba
(
{
r
}
{
g
}
{
b
}
{
a
}
)
;
}
this
.
_setProperty
(
elem
cssVarName
value
)
;
}
}
}
;
ContentThemeController
.
init
(
)
;
}
