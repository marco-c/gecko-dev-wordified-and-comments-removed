"
use
strict
"
;
add_task
(
function
*
clearURLBarAfterParentProcessURL
(
)
{
let
tab
=
yield
new
Promise
(
resolve
=
>
{
gBrowser
.
selectedTab
=
gBrowser
.
addTab
(
"
about
:
preferences
"
)
;
let
newTabBrowser
=
gBrowser
.
getBrowserForTab
(
gBrowser
.
selectedTab
)
;
newTabBrowser
.
addEventListener
(
"
Initialized
"
function
onInit
(
)
{
newTabBrowser
.
removeEventListener
(
"
Initialized
"
onInit
true
)
;
resolve
(
gBrowser
.
selectedTab
)
;
}
true
)
;
}
)
;
document
.
getElementById
(
"
home
-
button
"
)
.
click
(
)
;
yield
BrowserTestUtils
.
browserLoaded
(
tab
.
linkedBrowser
)
;
is
(
gURLBar
.
value
"
"
"
URL
bar
should
be
empty
"
)
;
is
(
tab
.
linkedBrowser
.
userTypedValue
null
"
The
browser
should
have
no
recorded
userTypedValue
"
)
;
yield
BrowserTestUtils
.
removeTab
(
tab
)
;
}
)
;
add_task
(
function
*
clearURLBarAfterParentProcessURLInExistingTab
(
)
{
let
tab
=
yield
new
Promise
(
resolve
=
>
{
gBrowser
.
selectedTab
=
gBrowser
.
addTab
(
)
;
let
newTabBrowser
=
gBrowser
.
getBrowserForTab
(
gBrowser
.
selectedTab
)
;
newTabBrowser
.
addEventListener
(
"
Initialized
"
function
onInit
(
)
{
newTabBrowser
.
removeEventListener
(
"
Initialized
"
onInit
true
)
;
resolve
(
gBrowser
.
selectedTab
)
;
}
true
)
;
newTabBrowser
.
loadURI
(
"
about
:
preferences
"
)
;
}
)
;
document
.
getElementById
(
"
home
-
button
"
)
.
click
(
)
;
yield
BrowserTestUtils
.
browserLoaded
(
tab
.
linkedBrowser
)
;
is
(
gURLBar
.
value
"
"
"
URL
bar
should
be
empty
"
)
;
is
(
tab
.
linkedBrowser
.
userTypedValue
null
"
The
browser
should
have
no
recorded
userTypedValue
"
)
;
yield
BrowserTestUtils
.
removeTab
(
tab
)
;
}
)
;
