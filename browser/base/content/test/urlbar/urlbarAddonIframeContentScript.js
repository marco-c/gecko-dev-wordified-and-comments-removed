addMessageListener
(
"
TestMessage
"
msg
=
>
{
content
.
dispatchEvent
(
new
content
.
CustomEvent
(
"
TestEvent
"
{
detail
:
Components
.
utils
.
cloneInto
(
msg
.
data
content
)
}
)
)
;
}
)
;
addEventListener
(
"
TestEventAck
"
event
=
>
{
sendAsyncMessage
(
"
TestMessageAck
"
Components
.
utils
.
waiveXrays
(
event
.
detail
)
)
;
}
true
true
)
;
if
(
content
.
document
.
readyState
=
=
"
complete
"
)
{
sendAsyncMessage
(
"
TestIframeLoadAck
"
)
;
}
else
{
addEventListener
(
"
load
"
function
onLoad
(
event
)
{
removeEventListener
(
"
load
"
onLoad
)
;
sendAsyncMessage
(
"
TestIframeLoadAck
"
)
;
}
true
true
)
;
}
