add_task
(
async
function
(
)
{
let
bm
=
await
PlacesUtils
.
bookmarks
.
insert
(
{
parentGuid
:
PlacesUtils
.
bookmarks
.
unfiledGuid
url
:
"
http
:
/
/
bug1105244
.
example
.
com
/
"
title
:
"
test
"
}
)
;
registerCleanupFunction
(
function
*
(
)
{
yield
PlacesUtils
.
bookmarks
.
remove
(
bm
)
;
}
)
;
await
BrowserTestUtils
.
withNewTab
(
{
gBrowser
url
:
"
about
:
blank
"
}
testDelete
)
;
}
)
;
function
sendHome
(
)
{
if
(
Services
.
appinfo
.
OS
=
=
"
Darwin
"
)
{
EventUtils
.
synthesizeKey
(
"
VK_LEFT
"
{
altKey
:
true
}
)
;
}
else
{
EventUtils
.
synthesizeKey
(
"
VK_HOME
"
{
}
)
;
}
}
function
sendDelete
(
)
{
EventUtils
.
synthesizeKey
(
"
VK_DELETE
"
{
}
)
;
}
async
function
testDelete
(
)
{
await
promiseAutocompleteResultPopup
(
"
bug1105244
"
)
;
sendHome
(
)
;
sendDelete
(
)
;
Assert
.
equal
(
gURLBar
.
inputField
.
value
"
ug1105244
"
)
;
await
promisePopupShown
(
gURLBar
.
popup
)
;
sendDelete
(
)
;
Assert
.
equal
(
gURLBar
.
inputField
.
value
"
g1105244
"
)
;
}
