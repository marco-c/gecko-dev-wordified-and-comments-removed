add_task
(
async
function
testIdentityPopupFocusClick
(
)
{
await
SpecialPowers
.
pushPrefEnv
(
{
"
set
"
:
[
[
"
accessibility
.
tabfocus
"
7
]
]
}
)
;
await
BrowserTestUtils
.
withNewTab
(
"
https
:
/
/
example
.
com
"
function
*
(
)
{
let
shown
=
BrowserTestUtils
.
waitForEvent
(
gIdentityHandler
.
_identityPopup
"
popupshown
"
)
;
EventUtils
.
synthesizeMouseAtCenter
(
gIdentityHandler
.
_identityBox
{
}
)
;
yield
shown
;
isnot
(
Services
.
focus
.
focusedElement
document
.
getElementById
(
"
identity
-
popup
-
security
-
expander
"
)
)
;
}
)
;
}
)
;
add_task
(
async
function
testIdentityPopupFocusKeyboard
(
)
{
await
SpecialPowers
.
pushPrefEnv
(
{
"
set
"
:
[
[
"
accessibility
.
tabfocus
"
7
]
]
}
)
;
await
BrowserTestUtils
.
withNewTab
(
"
https
:
/
/
example
.
com
"
function
*
(
)
{
let
focused
=
BrowserTestUtils
.
waitForEvent
(
gIdentityHandler
.
_identityBox
"
focus
"
)
;
gIdentityHandler
.
_identityBox
.
focus
(
)
;
yield
focused
;
let
shown
=
BrowserTestUtils
.
waitForEvent
(
gIdentityHandler
.
_identityPopup
"
popupshown
"
)
;
EventUtils
.
synthesizeKey
(
"
"
{
}
)
;
yield
shown
;
is
(
Services
.
focus
.
focusedElement
document
.
getElementById
(
"
identity
-
popup
-
security
-
expander
"
)
)
;
}
)
;
}
)
;
