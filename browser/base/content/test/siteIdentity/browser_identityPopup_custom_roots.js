const
TEST_PATH
=
getRootDirectory
(
gTestPath
)
.
replace
(
"
chrome
:
/
/
mochitests
/
content
"
"
https
:
/
/
example
.
com
"
)
;
add_task
(
async
function
test_https
(
)
{
await
BrowserTestUtils
.
withNewTab
(
"
https
:
/
/
example
.
com
"
async
function
(
)
{
let
promisePanelOpen
=
BrowserTestUtils
.
waitForEvent
(
window
"
popupshown
"
true
event
=
>
event
.
target
=
=
gIdentityHandler
.
_identityPopup
)
;
gIdentityHandler
.
_identityIconBox
.
click
(
)
;
await
promisePanelOpen
;
let
customRootWarning
=
document
.
getElementById
(
"
identity
-
popup
-
security
-
decription
-
custom
-
root
"
)
;
ok
(
BrowserTestUtils
.
isVisible
(
customRootWarning
)
"
custom
root
warning
is
visible
"
)
;
let
securityView
=
document
.
getElementById
(
"
identity
-
popup
-
securityView
"
)
;
let
shown
=
BrowserTestUtils
.
waitForEvent
(
securityView
"
ViewShown
"
)
;
document
.
getElementById
(
"
identity
-
popup
-
security
-
button
"
)
.
click
(
)
;
await
shown
;
let
subPanelInfo
=
document
.
getElementById
(
"
identity
-
popup
-
content
-
verifier
-
unknown
"
)
;
ok
(
BrowserTestUtils
.
isVisible
(
subPanelInfo
)
"
custom
root
warning
in
sub
panel
is
visible
"
)
;
}
)
;
}
)
;
add_task
(
async
function
test_http
(
)
{
await
BrowserTestUtils
.
withNewTab
(
"
http
:
/
/
example
.
com
"
async
function
(
)
{
let
promisePanelOpen
=
BrowserTestUtils
.
waitForEvent
(
window
"
popupshown
"
true
event
=
>
event
.
target
=
=
gIdentityHandler
.
_identityPopup
)
;
gIdentityHandler
.
_identityIconBox
.
click
(
)
;
await
promisePanelOpen
;
let
customRootWarning
=
document
.
getElementById
(
"
identity
-
popup
-
security
-
decription
-
custom
-
root
"
)
;
ok
(
BrowserTestUtils
.
isHidden
(
customRootWarning
)
"
custom
root
warning
is
hidden
"
)
;
let
securityView
=
document
.
getElementById
(
"
identity
-
popup
-
securityView
"
)
;
let
shown
=
BrowserTestUtils
.
waitForEvent
(
securityView
"
ViewShown
"
)
;
document
.
getElementById
(
"
identity
-
popup
-
security
-
button
"
)
.
click
(
)
;
await
shown
;
let
subPanelInfo
=
document
.
getElementById
(
"
identity
-
popup
-
content
-
verifier
-
unknown
"
)
;
ok
(
BrowserTestUtils
.
isHidden
(
subPanelInfo
)
"
custom
root
warning
in
sub
panel
is
hidden
"
)
;
}
)
;
}
)
;
