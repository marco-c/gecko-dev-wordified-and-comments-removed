const
TEST_PATH
=
getRootDirectory
(
gTestPath
)
.
replace
(
"
chrome
:
/
/
mochitests
/
content
"
"
https
:
/
/
example
.
com
"
)
;
const
PERMISSIONS_PAGE
=
TEST_PATH
+
"
permissions
.
html
"
;
function
synthesizeKeyAndWaitForFocus
(
element
keyCode
options
)
{
let
focused
=
BrowserTestUtils
.
waitForEvent
(
element
"
focus
"
)
;
EventUtils
.
synthesizeKey
(
keyCode
options
)
;
return
focused
;
}
add_task
(
function
*
testWithoutNotifications
(
)
{
yield
BrowserTestUtils
.
withNewTab
(
"
https
:
/
/
example
.
com
"
function
*
(
)
{
yield
synthesizeKeyAndWaitForFocus
(
gURLBar
"
l
"
{
accelKey
:
true
}
)
is
(
document
.
activeElement
gURLBar
.
inputField
"
urlbar
should
be
focused
"
)
;
yield
synthesizeKeyAndWaitForFocus
(
gIdentityHandler
.
_identityBox
"
VK_TAB
"
{
shiftKey
:
true
}
)
is
(
document
.
activeElement
gIdentityHandler
.
_identityBox
"
identity
block
should
be
focused
"
)
;
}
)
;
}
)
;
add_task
(
function
*
testWithoutNotifications
(
)
{
yield
BrowserTestUtils
.
withNewTab
(
PERMISSIONS_PAGE
function
*
(
browser
)
{
let
popupshown
=
BrowserTestUtils
.
waitForEvent
(
PopupNotifications
.
panel
"
popupshown
"
)
;
BrowserTestUtils
.
synthesizeMouseAtCenter
(
"
#
geo
"
{
}
browser
)
;
yield
popupshown
;
yield
synthesizeKeyAndWaitForFocus
(
gURLBar
"
l
"
{
accelKey
:
true
}
)
is
(
document
.
activeElement
gURLBar
.
inputField
"
urlbar
should
be
focused
"
)
;
let
geoIcon
=
document
.
getElementById
(
"
geo
-
notification
-
icon
"
)
;
yield
synthesizeKeyAndWaitForFocus
(
geoIcon
"
VK_TAB
"
{
shiftKey
:
true
}
)
is
(
document
.
activeElement
geoIcon
"
notification
anchor
should
be
focused
"
)
;
yield
synthesizeKeyAndWaitForFocus
(
gIdentityHandler
.
_identityBox
"
VK_TAB
"
{
shiftKey
:
true
}
)
is
(
document
.
activeElement
gIdentityHandler
.
_identityBox
"
identity
block
should
be
focused
"
)
;
}
)
;
}
)
;
add_task
(
function
*
testInvalidPageProxyState
(
)
{
yield
BrowserTestUtils
.
withNewTab
(
"
about
:
blank
"
function
*
(
browser
)
{
if
(
document
.
activeElement
!
=
gURLBar
.
inputField
)
{
yield
synthesizeKeyAndWaitForFocus
(
gURLBar
"
l
"
{
accelKey
:
true
}
)
}
is
(
document
.
activeElement
gURLBar
.
inputField
"
urlbar
should
be
focused
"
)
;
yield
synthesizeKeyAndWaitForFocus
(
gBrowser
.
getTabForBrowser
(
browser
)
"
VK_TAB
"
{
shiftKey
:
true
}
)
isnot
(
document
.
activeElement
gIdentityHandler
.
_identityBox
"
identity
block
should
not
be
focused
"
)
;
gURLBar
.
focus
(
)
;
}
)
;
}
)
;
