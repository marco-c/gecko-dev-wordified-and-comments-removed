var
gTab
=
null
;
function
load
(
url
cb
)
{
gTab
=
BrowserTestUtils
.
addTab
(
gBrowser
url
)
;
gBrowser
.
addEventListener
(
"
load
"
function
listener
(
event
)
{
if
(
event
.
target
.
location
!
=
url
)
return
;
gBrowser
.
removeEventListener
(
"
load
"
listener
true
)
;
gBrowser
.
selectedTab
=
gTab
;
cb
(
)
;
}
true
)
;
}
function
test
(
)
{
waitForExplicitFinish
(
)
;
ok
(
gFindBar
.
hidden
"
Find
bar
should
not
be
visible
by
default
"
)
;
EventUtils
.
synthesizeKey
(
"
f
"
{
accelKey
:
true
}
)
;
ok
(
!
gFindBar
.
hidden
"
Find
bar
should
be
visible
"
)
;
nextTest
(
)
;
}
var
urls
=
[
"
about
:
config
"
"
about
:
addons
"
]
;
function
nextTest
(
)
{
let
url
=
urls
.
shift
(
)
;
if
(
url
)
{
testFindDisabled
(
url
nextTest
)
;
}
else
{
testFindEnabled
(
"
about
:
blank
"
function
(
)
{
EventUtils
.
synthesizeKey
(
"
KEY_Escape
"
)
;
ok
(
gFindBar
.
hidden
"
Find
bar
should
now
be
hidden
"
)
;
finish
(
)
;
}
)
;
}
}
function
testFindDisabled
(
url
cb
)
{
load
(
url
function
(
)
{
ok
(
gFindBar
.
hidden
"
Find
bar
should
not
be
visible
"
)
;
EventUtils
.
synthesizeKey
(
"
/
"
{
}
gTab
.
linkedBrowser
.
contentWindow
)
;
ok
(
gFindBar
.
hidden
"
Find
bar
should
not
be
visible
"
)
;
EventUtils
.
synthesizeKey
(
"
f
"
{
accelKey
:
true
}
)
;
ok
(
gFindBar
.
hidden
"
Find
bar
should
not
be
visible
"
)
;
ok
(
document
.
getElementById
(
"
cmd_find
"
)
.
getAttribute
(
"
disabled
"
)
"
Find
command
should
be
disabled
"
)
;
gBrowser
.
removeTab
(
gTab
)
;
cb
(
)
;
}
)
;
}
function
testFindEnabled
(
url
cb
)
{
load
(
url
function
(
)
{
ok
(
!
document
.
getElementById
(
"
cmd_find
"
)
.
getAttribute
(
"
disabled
"
)
"
Find
command
should
not
be
disabled
"
)
;
EventUtils
.
synthesizeKey
(
"
f
"
{
accelKey
:
true
}
)
;
ok
(
!
gFindBar
.
hidden
"
Find
bar
should
be
visible
again
"
)
;
EventUtils
.
synthesizeKey
(
"
KEY_Escape
"
)
;
ok
(
gFindBar
.
hidden
"
Find
bar
should
now
be
hidden
"
)
;
gBrowser
.
removeTab
(
gTab
)
;
cb
(
)
;
}
)
;
}
