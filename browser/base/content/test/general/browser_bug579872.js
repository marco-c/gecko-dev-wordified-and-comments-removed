function
test
(
)
{
let
newTab
=
BrowserTestUtils
.
addTab
(
gBrowser
)
;
waitForExplicitFinish
(
)
;
BrowserTestUtils
.
browserLoaded
(
newTab
.
linkedBrowser
)
.
then
(
mainPart
)
;
function
mainPart
(
)
{
gBrowser
.
pinTab
(
newTab
)
;
gBrowser
.
selectedTab
=
newTab
;
openTrustedLinkIn
(
"
javascript
:
var
x
=
0
;
"
"
current
"
)
;
is
(
gBrowser
.
tabs
.
length
2
"
Should
open
in
current
tab
"
)
;
openTrustedLinkIn
(
"
http
:
/
/
example
.
com
/
1
"
"
current
"
)
;
is
(
gBrowser
.
tabs
.
length
2
"
Should
open
in
current
tab
"
)
;
openTrustedLinkIn
(
"
http
:
/
/
example
.
org
/
"
"
current
"
)
;
is
(
gBrowser
.
tabs
.
length
3
"
Should
open
in
new
tab
"
)
;
gBrowser
.
removeTab
(
newTab
)
;
gBrowser
.
removeTab
(
gBrowser
.
tabs
[
1
]
)
;
finish
(
)
;
}
newTab
.
linkedBrowser
.
loadURI
(
"
http
:
/
/
example
.
com
"
)
;
}
