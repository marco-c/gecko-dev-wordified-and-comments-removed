"
use
strict
"
;
add_task
(
async
function
testPBNewTab
(
)
{
registerCleanupFunction
(
async
function
(
)
{
for
(
let
win
of
windowsToClose
)
{
await
BrowserTestUtils
.
closeWindow
(
win
)
;
}
}
)
;
let
windowsToClose
=
[
]
;
async
function
doTest
(
aIsPrivateMode
)
{
let
newTabURL
;
let
mode
;
let
win
=
await
BrowserTestUtils
.
openNewBrowserWindow
(
{
private
:
aIsPrivateMode
}
)
;
windowsToClose
.
push
(
win
)
;
if
(
aIsPrivateMode
)
{
mode
=
"
per
window
private
browsing
"
;
newTabURL
=
"
about
:
privatebrowsing
"
;
}
else
{
mode
=
"
normal
"
;
newTabURL
=
"
about
:
newtab
"
;
}
await
openNewTab
(
win
newTabURL
)
;
is
(
win
.
gBrowser
.
currentURI
.
spec
newTabURL
"
URL
of
NewTab
should
be
"
+
newTabURL
+
"
in
"
+
mode
+
"
mode
"
)
;
}
await
doTest
(
false
)
;
await
doTest
(
true
)
;
await
doTest
(
false
)
;
}
)
;
async
function
openNewTab
(
aWindow
aExpectedURL
)
{
aWindow
.
BrowserOpenTab
(
)
;
let
browser
=
aWindow
.
gBrowser
.
selectedBrowser
;
if
(
browser
.
currentURI
.
spec
=
=
=
aExpectedURL
)
{
return
;
}
await
BrowserTestUtils
.
waitForLocationChange
(
aWindow
.
gBrowser
)
;
}
