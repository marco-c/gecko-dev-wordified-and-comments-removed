"
use
strict
"
;
function
test
(
)
{
waitForExplicitFinish
(
)
;
let
windowsToClose
=
[
]
;
let
newTabURL
;
let
mode
;
function
doTest
(
aIsPrivateMode
aWindow
aCallback
)
{
whenNewTabLoaded
(
aWindow
function
(
)
{
if
(
aIsPrivateMode
)
{
mode
=
"
per
window
private
browsing
"
;
newTabURL
=
"
about
:
privatebrowsing
"
;
}
else
{
mode
=
"
normal
"
;
newTabURL
=
"
about
:
newtab
"
;
}
is
(
aWindow
.
gBrowser
.
currentURI
.
spec
newTabURL
"
URL
of
NewTab
should
be
"
+
newTabURL
+
"
in
"
+
mode
+
"
mode
"
)
;
aWindow
.
gBrowser
.
removeTab
(
aWindow
.
gBrowser
.
selectedTab
)
;
aCallback
(
)
;
}
)
;
}
function
testOnWindow
(
aOptions
aCallback
)
{
whenNewWindowLoaded
(
aOptions
function
(
aWin
)
{
windowsToClose
.
push
(
aWin
)
;
executeSoon
(
(
)
=
>
aCallback
(
aWin
)
)
;
}
)
;
}
registerCleanupFunction
(
function
(
)
{
windowsToClose
.
forEach
(
function
(
aWin
)
{
aWin
.
close
(
)
;
}
)
;
}
)
;
testOnWindow
(
{
}
function
(
aWin
)
{
doTest
(
false
aWin
function
(
)
{
testOnWindow
(
{
private
:
true
}
function
(
aWin2
)
{
doTest
(
true
aWin2
function
(
)
{
testOnWindow
(
{
}
function
(
aWin3
)
{
doTest
(
false
aWin3
finish
)
;
}
)
;
}
)
;
}
)
;
}
)
;
}
)
;
}
