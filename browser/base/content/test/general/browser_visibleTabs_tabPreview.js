add_task
(
async
function
test
(
)
{
await
SpecialPowers
.
pushPrefEnv
(
{
"
set
"
:
[
[
"
browser
.
ctrlTab
.
recentlyUsedOrder
"
true
]
]
}
)
;
let
[
origTab
]
=
gBrowser
.
visibleTabs
;
let
tabOne
=
BrowserTestUtils
.
addTab
(
gBrowser
)
;
let
tabTwo
=
BrowserTestUtils
.
addTab
(
gBrowser
)
;
pressCtrlTab
(
)
;
ok
(
ctrlTab
.
tabList
.
length
3
"
Show
3
tabs
in
tab
preview
"
)
;
releaseCtrl
(
)
;
gBrowser
.
showOnlyTheseTabs
(
[
origTab
]
)
;
pressCtrlTab
(
)
;
ok
(
ctrlTab
.
tabList
.
length
1
"
Show
1
tab
in
tab
preview
"
)
;
ok
(
!
ctrlTab
.
isOpen
"
With
1
tab
open
Ctrl
+
Tab
doesn
'
t
open
the
preview
panel
"
)
;
gBrowser
.
showOnlyTheseTabs
(
[
origTab
tabOne
tabTwo
]
)
;
pressCtrlTab
(
)
;
ok
(
ctrlTab
.
isOpen
"
With
3
tabs
open
Ctrl
+
Tab
does
open
the
preview
panel
"
)
;
releaseCtrl
(
)
;
gBrowser
.
removeTab
(
tabOne
)
;
gBrowser
.
removeTab
(
tabTwo
)
;
}
)
;
function
pressCtrlTab
(
aShiftKey
)
{
EventUtils
.
synthesizeKey
(
"
VK_TAB
"
{
ctrlKey
:
true
shiftKey
:
!
!
aShiftKey
}
)
;
}
function
releaseCtrl
(
)
{
EventUtils
.
synthesizeKey
(
"
VK_CONTROL
"
{
type
:
"
keyup
"
}
)
;
}
