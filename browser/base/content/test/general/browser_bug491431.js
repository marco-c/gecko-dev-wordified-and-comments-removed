var
testPage
=
"
data
:
text
/
plain
test
bug
491431
Page
"
;
function
test
(
)
{
waitForExplicitFinish
(
)
;
let
newWin
tabA
tabB
;
tabA
=
gBrowser
.
addTab
(
testPage
)
;
gBrowser
.
tabContainer
.
addEventListener
(
"
TabClose
"
function
(
firstTabCloseEvent
)
{
gBrowser
.
tabContainer
.
removeEventListener
(
"
TabClose
"
arguments
.
callee
true
)
;
ok
(
!
firstTabCloseEvent
.
detail
.
adoptedBy
"
This
was
a
normal
tab
close
"
)
;
tabB
=
gBrowser
.
addTab
(
testPage
)
;
gBrowser
.
tabContainer
.
addEventListener
(
"
TabClose
"
function
(
secondTabCloseEvent
)
{
gBrowser
.
tabContainer
.
removeEventListener
(
"
TabClose
"
arguments
.
callee
true
)
;
executeSoon
(
function
(
)
{
ok
(
secondTabCloseEvent
.
detail
.
adoptedBy
"
This
was
a
tab
closed
by
moving
"
)
;
newWin
.
close
(
)
;
executeSoon
(
finish
)
;
}
)
;
}
true
)
;
newWin
=
gBrowser
.
replaceTabWithWindow
(
tabB
)
;
}
true
)
;
gBrowser
.
removeTab
(
tabA
)
;
}
