var
count
=
0
;
const
URIS
=
[
"
about
:
config
"
"
about
:
plugins
"
"
about
:
buildconfig
"
"
data
:
text
/
html
<
title
>
OK
<
/
title
>
"
]
;
function
test
(
)
{
waitForExplicitFinish
(
)
;
URIS
.
forEach
(
addTab
)
;
}
function
addTab
(
aURI
aIndex
)
{
var
tab
=
gBrowser
.
addTab
(
aURI
)
;
if
(
aIndex
=
=
0
)
gBrowser
.
removeTab
(
gBrowser
.
tabs
[
0
]
{
skipPermitUnload
:
true
}
)
;
tab
.
linkedBrowser
.
addEventListener
(
"
load
"
function
(
event
)
{
if
(
+
+
count
=
=
URIS
.
length
)
executeSoon
(
doTabsTest
)
;
}
{
capture
:
true
once
:
true
}
)
;
}
function
doTabsTest
(
)
{
is
(
gBrowser
.
tabs
.
length
URIS
.
length
"
Correctly
opened
all
expected
tabs
"
)
;
gBrowser
.
tabContainer
.
addEventListener
(
"
TabClose
"
function
(
event
)
{
var
closedTab
=
event
.
originalTarget
;
var
scheme
=
closedTab
.
linkedBrowser
.
currentURI
.
scheme
;
Array
.
slice
(
gBrowser
.
tabs
)
.
forEach
(
function
(
aTab
)
{
if
(
aTab
!
=
closedTab
&
&
aTab
.
linkedBrowser
.
currentURI
.
scheme
=
=
scheme
)
gBrowser
.
removeTab
(
aTab
{
skipPermitUnload
:
true
}
)
;
}
)
;
}
{
capture
:
true
once
:
true
}
)
;
gBrowser
.
removeTab
(
gBrowser
.
tabs
[
0
]
{
skipPermitUnload
:
true
}
)
;
is
(
gBrowser
.
tabs
.
length
1
"
Related
tabs
are
not
closed
unexpectedly
"
)
;
gBrowser
.
addTab
(
"
about
:
blank
"
)
;
gBrowser
.
removeTab
(
gBrowser
.
tabs
[
0
]
{
skipPermitUnload
:
true
}
)
;
finish
(
)
;
}
