add_setup
(
async
function
(
)
{
await
SpecialPowers
.
pushPrefEnv
(
{
set
:
[
[
"
test
.
wait300msAfterTabSwitch
"
true
]
]
}
)
;
}
)
;
add_task
(
async
function
(
)
{
const
URL_FIREBIRD
=
"
http
:
/
/
mochi
.
test
:
8888
/
browser
/
browser
/
base
/
content
/
test
/
contextMenu
/
firebird
.
png
"
;
await
BrowserTestUtils
.
withNewTab
(
URL_FIREBIRD
async
function
(
browser
)
{
let
popupShownPromise
=
BrowserTestUtils
.
waitForEvent
(
document
"
popupshown
"
)
;
await
BrowserTestUtils
.
synthesizeMouseAtCenter
(
"
img
"
{
type
:
"
contextmenu
"
button
:
2
}
browser
)
;
await
popupShownPromise
;
await
SimpleTest
.
promiseClipboardChange
(
URL_FIREBIRD
(
)
=
>
{
document
.
getElementById
(
"
context
-
copyimage
"
)
.
doCommand
(
)
;
}
)
;
let
contextMenu
=
document
.
getElementById
(
"
contentAreaContextMenu
"
)
;
let
popupHiddenPromise
=
BrowserTestUtils
.
waitForEvent
(
contextMenu
"
popuphidden
"
)
;
contextMenu
.
hidePopup
(
)
;
await
popupHiddenPromise
;
}
)
;
}
)
;
