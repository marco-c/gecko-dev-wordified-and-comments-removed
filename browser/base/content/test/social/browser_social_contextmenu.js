var
SocialService
=
Cu
.
import
(
"
resource
:
/
/
gre
/
modules
/
SocialService
.
jsm
"
{
}
)
.
SocialService
;
var
manifest
=
{
name
:
"
provider
test1
"
origin
:
"
https
:
/
/
test1
.
example
.
com
"
markURL
:
"
https
:
/
/
test1
.
example
.
com
/
browser
/
browser
/
base
/
content
/
test
/
social
/
social_mark
.
html
?
url
=
%
{
url
}
"
markedIcon
:
"
https
:
/
/
test1
.
example
.
com
/
browser
/
browser
/
base
/
content
/
test
/
social
/
unchecked
.
jpg
"
unmarkedIcon
:
"
https
:
/
/
test1
.
example
.
com
/
browser
/
browser
/
base
/
content
/
test
/
social
/
checked
.
jpg
"
iconURL
:
"
https
:
/
/
test1
.
example
.
com
/
browser
/
browser
/
base
/
content
/
test
/
general
/
moz
.
png
"
version
:
"
1
.
0
"
}
;
function
test
(
)
{
waitForExplicitFinish
(
)
;
let
frameScript
=
"
data
:
(
"
+
function
frame_script
(
)
{
addEventListener
(
"
OpenGraphData
"
function
(
aEvent
)
{
sendAsyncMessage
(
"
sharedata
"
aEvent
.
detail
)
;
}
true
true
)
;
}
.
toString
(
)
+
"
)
(
)
;
"
;
let
mm
=
getGroupMessageManager
(
"
social
"
)
;
mm
.
loadFrameScript
(
frameScript
true
)
;
runSocialTestWithProvider
(
manifest
function
(
finishcb
)
{
runSocialTests
(
tests
undefined
undefined
function
(
)
{
mm
.
removeDelayedFrameScript
(
frameScript
)
;
finishcb
(
)
;
}
)
;
}
)
;
}
var
tests
=
{
testMarkMicroformats
:
function
(
next
)
{
let
provider
=
Social
.
_getProviderFromOrigin
(
manifest
.
origin
)
;
let
target
testTab
;
let
expecting
=
JSON
.
stringify
(
{
"
url
"
:
"
https
:
/
/
example
.
com
/
browser
/
browser
/
base
/
content
/
test
/
social
/
microformats
.
html
"
"
microformats
"
:
{
"
items
"
:
[
{
"
type
"
:
[
"
h
-
review
"
]
"
properties
"
:
{
"
rating
"
:
[
"
4
.
5
"
]
}
}
]
"
rels
"
:
{
}
"
rel
-
urls
"
:
{
}
}
}
)
;
let
mm
=
getGroupMessageManager
(
"
social
"
)
;
mm
.
addMessageListener
(
"
sharedata
"
function
handler
(
msg
)
{
is
(
msg
.
data
expecting
"
microformats
data
ok
"
)
;
mm
.
removeMessageListener
(
"
sharedata
"
handler
)
;
BrowserTestUtils
.
removeTab
(
testTab
)
.
then
(
next
)
;
}
)
;
let
url
=
"
https
:
/
/
example
.
com
/
browser
/
browser
/
base
/
content
/
test
/
social
/
microformats
.
html
"
BrowserTestUtils
.
openNewForegroundTab
(
gBrowser
url
)
.
then
(
tab
=
>
{
testTab
=
tab
;
let
doc
=
tab
.
linkedBrowser
.
contentDocument
;
target
=
doc
.
getElementById
(
"
test
-
review
"
)
;
SocialMarks
.
markLink
(
manifest
.
origin
url
target
)
;
}
)
;
}
}
