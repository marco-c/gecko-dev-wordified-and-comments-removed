var
SocialService
=
Cu
.
import
(
"
resource
:
/
/
gre
/
modules
/
SocialService
.
jsm
"
{
}
)
.
SocialService
;
var
manifest
=
{
name
:
"
provider
1
"
origin
:
"
https
:
/
/
example
.
com
"
sidebarURL
:
"
https
:
/
/
example
.
com
/
browser
/
browser
/
base
/
content
/
test
/
social
/
social_sidebar
.
html
"
iconURL
:
"
https
:
/
/
example
.
com
/
browser
/
browser
/
base
/
content
/
test
/
general
/
moz
.
png
"
}
;
function
test
(
)
{
waitForExplicitFinish
(
)
;
SocialService
.
addProvider
(
manifest
function
(
)
{
doTest
(
)
;
}
)
;
}
function
doTest
(
)
{
ok
(
SocialSidebar
.
canShow
"
social
sidebar
should
be
able
to
be
shown
"
)
;
ok
(
!
SocialSidebar
.
opened
"
social
sidebar
should
not
be
open
by
default
"
)
;
let
command
=
document
.
getElementById
(
"
Social
:
ToggleSidebar
"
)
;
let
sidebar
=
document
.
getElementById
(
"
social
-
sidebar
-
box
"
)
;
let
browser
=
sidebar
.
lastChild
;
function
checkShown
(
shouldBeShown
)
{
is
(
command
.
getAttribute
(
"
checked
"
)
shouldBeShown
?
"
true
"
:
"
false
"
"
toggle
command
should
be
"
+
(
shouldBeShown
?
"
checked
"
:
"
unchecked
"
)
)
;
is
(
sidebar
.
hidden
!
shouldBeShown
"
sidebar
should
be
"
+
(
shouldBeShown
?
"
visible
"
:
"
hidden
"
)
)
;
if
(
shouldBeShown
)
{
is
(
browser
.
getAttribute
(
'
src
'
)
SocialSidebar
.
provider
.
sidebarURL
"
sidebar
url
should
be
set
"
)
;
}
else
{
ok
(
!
browser
.
docShellIsActive
"
sidebar
should
have
an
inactive
docshell
"
)
;
if
(
SocialSidebar
.
canShow
)
{
is
(
browser
.
getAttribute
(
'
src
'
)
SocialSidebar
.
provider
.
sidebarURL
"
sidebar
url
should
be
set
"
)
;
}
else
{
is
(
browser
.
getAttribute
(
'
src
'
)
"
about
:
blank
"
"
sidebar
url
should
be
blank
"
)
;
}
}
}
ok
(
!
command
.
hidden
"
toggle
command
should
be
visible
"
)
;
ensureEventFired
(
browser
"
socialFrameShow
"
)
.
then
(
function
sidebarhide
(
)
{
checkShown
(
true
)
;
ensureEventFired
(
browser
"
socialFrameHide
"
)
.
then
(
function
sidebarshow
(
)
{
checkShown
(
false
)
;
SocialService
.
disableProvider
(
SocialSidebar
.
provider
.
origin
function
(
)
{
checkShown
(
false
)
;
is
(
Social
.
providers
.
length
0
"
no
providers
left
"
)
;
defaultFinishChecks
(
)
;
executeSoon
(
finish
)
;
}
)
;
}
)
;
info
(
"
Toggling
sidebar
back
on
"
)
;
SocialSidebar
.
toggleSidebar
(
)
;
}
)
;
SocialSidebar
.
show
(
)
;
}
