add_task
(
async
function
test_scroll_to_text_fragment
(
)
{
let
initialUrl
=
"
about
:
blank
"
;
let
crossOriginUrl
=
https
:
/
/
example
.
org
/
browser
/
browser
/
base
/
content
/
test
/
scroll
-
to
-
text
-
fragment
/
scroll
-
to
-
text
-
fragment
-
from
-
browser
-
chrome
-
target
.
html
#
:
~
:
text
=
This
%
20is
%
20the
%
20text
%
20fragment
%
20to
%
20scroll
%
20to
.
;
await
BrowserTestUtils
.
withNewTab
(
{
gBrowser
url
:
initialUrl
}
async
function
(
browser
)
{
gURLBar
.
focus
(
)
;
gURLBar
.
value
=
crossOriginUrl
;
info
(
"
Synthesize
a
click
in
the
URL
bar
.
.
.
"
)
;
await
BrowserTestUtils
.
synthesizeMouseAtCenter
(
gURLBar
.
inputField
{
}
browser
)
;
info
(
"
Synthesize
pressing
the
Enter
key
.
.
.
"
)
;
EventUtils
.
synthesizeKey
(
"
VK_RETURN
"
{
}
)
;
info
(
"
Waiting
for
cross
-
origin
page
to
load
.
.
.
"
)
;
await
BrowserTestUtils
.
browserLoaded
(
browser
false
)
;
info
(
"
Cross
-
origin
page
loaded
.
"
)
;
let
scrolled
=
await
SpecialPowers
.
spawn
(
browser
[
]
(
)
=
>
{
return
content
.
window
.
scrollY
>
0
;
}
)
;
ok
(
scrolled
"
Page
has
scrolled
down
from
the
top
.
"
)
;
}
)
;
}
)
;
