"
use
strict
"
;
const
{
TelemetryTestUtils
}
=
ChromeUtils
.
importESModule
(
"
resource
:
/
/
testing
-
common
/
TelemetryTestUtils
.
sys
.
mjs
"
)
;
async
function
waitForDialog
(
index
histogram
)
{
await
TestUtils
.
topicObserved
(
"
common
-
dialog
-
loaded
"
)
;
let
dialog
=
gBrowser
.
getTabDialogBox
(
gBrowser
.
selectedBrowser
)
.
_tabDialogManager
.
_topDialog
;
let
dialogDocument
=
dialog
.
_frame
.
contentDocument
;
let
onDialogClosed
=
BrowserTestUtils
.
waitForEvent
(
window
"
DOMModalDialogClosed
"
)
;
TelemetryTestUtils
.
assertHistogram
(
histogram
index
1
)
;
dialogDocument
.
getElementById
(
"
commonDialog
"
)
.
cancelDialog
(
)
;
await
onDialogClosed
;
}
