add_task
(
async
function
(
)
{
await
pushPrefs
(
[
"
browser
.
newtabpage
.
rows
"
1
]
)
;
await
setLinks
(
"
0
"
)
;
await
addNewTabPageTab
(
)
;
await
addNewTabPageTab
(
)
;
await
ContentTask
.
spawn
(
gBrowser
.
selectedBrowser
{
index
:
0
}
async
function
(
args
)
{
let
{
site
}
=
content
.
wrappedJSObject
.
gGrid
.
cells
[
args
.
index
]
;
let
origOnClick
=
site
.
onClick
;
site
.
onClick
=
e
=
>
{
origOnClick
.
call
(
site
e
)
;
sendAsyncMessage
(
"
test
:
clicked
-
on
-
cell
"
{
}
)
;
}
;
}
)
;
let
mm
=
gBrowser
.
selectedBrowser
.
messageManager
;
let
messagePromise
=
new
Promise
(
resolve
=
>
{
mm
.
addMessageListener
(
"
test
:
clicked
-
on
-
cell
"
function
onResponse
(
message
)
{
mm
.
removeMessageListener
(
"
test
:
clicked
-
on
-
cell
"
onResponse
)
;
resolve
(
)
;
}
)
;
}
)
;
await
BrowserTestUtils
.
synthesizeMouseAtCenter
(
"
.
newtab
-
control
-
block
"
{
button
:
1
}
gBrowser
.
selectedBrowser
)
;
await
messagePromise
;
ok
(
true
"
middle
click
triggered
click
listener
"
)
;
await
checkGrid
(
"
0
"
)
;
}
)
;
