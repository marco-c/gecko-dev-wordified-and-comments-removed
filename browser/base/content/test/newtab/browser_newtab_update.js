"
use
strict
"
;
add_task
(
async
function
(
)
{
let
updatedPromise
=
whenPagesUpdated
(
)
;
let
setLinksPromise
=
setLinks
(
[
]
)
;
await
Promise
.
all
(
[
updatedPromise
setLinksPromise
]
)
;
await
fillHistoryAndWaitForPageUpdate
(
[
1
]
)
;
await
addNewTabPageTab
(
)
;
await
checkGrid
(
"
1
"
)
;
await
fillHistoryAndWaitForPageUpdate
(
[
2
]
)
;
await
addNewTabPageTab
(
)
;
await
checkGrid
(
"
2
1
"
)
;
await
fillHistoryAndWaitForPageUpdate
(
[
1
]
)
;
await
addNewTabPageTab
(
)
;
await
checkGrid
(
"
1
2
"
)
;
await
fillHistoryAndWaitForPageUpdate
(
[
2
3
4
]
)
;
await
addNewTabPageTab
(
)
;
await
checkGrid
(
"
2
1
3
4
"
)
;
let
type
=
await
performOnCell
(
1
cell
=
>
{
return
cell
.
site
.
link
.
type
;
}
)
;
is
(
type
"
history
"
"
added
link
is
history
"
)
;
}
)
;
function
fillHistoryAndWaitForPageUpdate
(
links
)
{
let
updatedPromise
=
whenPagesUpdated
;
let
fillHistoryPromise
=
fillHistory
(
links
.
map
(
link
)
)
;
return
Promise
.
all
(
[
updatedPromise
fillHistoryPromise
]
)
;
}
function
link
(
id
)
{
return
{
url
:
"
http
:
/
/
example
"
+
id
+
"
.
com
/
"
title
:
"
site
#
"
+
id
}
;
}
