add_task
(
async
function
(
)
{
is
(
gBrowser
.
tabs
.
length
1
"
one
tab
is
open
initially
"
)
;
let
tabs
=
[
]
;
function
addTab
(
aURL
aReferrer
)
{
let
tab
=
BrowserTestUtils
.
addTab
(
gBrowser
aURL
{
referrerURI
:
aReferrer
}
)
;
tabs
.
push
(
tab
)
;
return
BrowserTestUtils
.
browserLoaded
(
tab
.
linkedBrowser
)
;
}
await
addTab
(
"
http
:
/
/
mochi
.
test
:
8888
/
#
0
"
)
;
await
addTab
(
"
http
:
/
/
mochi
.
test
:
8888
/
#
1
"
)
;
await
addTab
(
"
http
:
/
/
mochi
.
test
:
8888
/
#
2
"
)
;
await
addTab
(
"
http
:
/
/
mochi
.
test
:
8888
/
#
3
"
)
;
await
setLinks
(
"
-
1
"
)
;
await
addNewTabPageTab
(
)
;
gBrowser
.
moveTabTo
(
gBrowser
.
selectedTab
1
)
;
await
BrowserTestUtils
.
synthesizeMouseAtCenter
(
"
.
newtab
-
cell
"
{
button
:
1
}
gBrowser
.
selectedBrowser
)
;
await
BrowserTestUtils
.
browserLoaded
(
gBrowser
.
getBrowserAtIndex
(
2
)
)
;
is
(
gBrowser
.
getBrowserAtIndex
(
2
)
.
currentURI
.
spec
"
http
:
/
/
example
.
com
/
"
"
Middle
click
opens
site
in
a
new
tab
immediately
to
the
right
.
"
)
;
}
)
;
