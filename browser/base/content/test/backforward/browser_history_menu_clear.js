"
use
strict
"
;
add_task
(
async
function
test_back_button_disabled_after_history_clear
(
)
{
let
tab
=
await
BrowserTestUtils
.
openNewForegroundTab
(
gBrowser
"
https
:
/
/
example
.
com
/
"
)
;
registerCleanupFunction
(
(
)
=
>
{
gBrowser
.
removeTab
(
tab
)
;
}
)
;
BrowserTestUtils
.
startLoadingURIString
(
tab
.
linkedBrowser
"
https
:
/
/
example
.
org
/
"
)
;
await
BrowserTestUtils
.
browserLoaded
(
tab
.
linkedBrowser
)
;
let
backButton
=
document
.
getElementById
(
"
back
-
button
"
)
;
await
TestUtils
.
waitForCondition
(
(
)
=
>
!
backButton
.
disabled
"
Back
button
should
be
enabled
with
history
"
)
;
await
Sanitizer
.
sanitize
(
[
"
history
"
]
)
;
await
TestUtils
.
waitForCondition
(
(
)
=
>
!
tab
.
linkedBrowser
.
webNavigation
.
canGoBack
"
webNavigation
.
canGoBack
should
be
false
after
clearing
"
)
;
if
(
typeof
gBrowser
.
updateBackForwardButtons
=
=
=
"
function
"
)
{
gBrowser
.
updateBackForwardButtons
(
)
;
}
else
{
goUpdateCommand
(
"
Browser
:
Back
"
)
;
}
await
TestUtils
.
waitForCondition
(
(
)
=
>
backButton
.
hasAttribute
(
"
disabled
"
)
"
Back
button
should
be
disabled
after
clearing
history
"
)
;
Assert
.
ok
(
backButton
.
hasAttribute
(
"
disabled
"
)
"
Back
button
should
be
disabled
"
)
;
let
computedStyle
=
window
.
getComputedStyle
(
backButton
)
;
Assert
.
equal
(
computedStyle
.
getPropertyValue
(
"
opacity
"
)
"
0
.
4
"
"
Back
button
should
appear
grayed
out
when
disabled
"
)
;
}
)
;
