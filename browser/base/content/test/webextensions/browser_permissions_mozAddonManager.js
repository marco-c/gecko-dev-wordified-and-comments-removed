"
use
strict
"
;
const
INSTALL_PAGE
=
{
BASE
}
/
file_install_extensions
.
html
;
async
function
installMozAM
(
filename
)
{
BrowserTestUtils
.
startLoadingURIString
(
gBrowser
.
selectedBrowser
INSTALL_PAGE
)
;
await
BrowserTestUtils
.
browserLoaded
(
gBrowser
.
selectedBrowser
)
;
await
SpecialPowers
.
pushPrefEnv
(
{
set
:
[
[
"
xpinstall
.
signatures
.
dev
-
root
"
true
]
]
}
)
;
await
SpecialPowers
.
spawn
(
gBrowser
.
selectedBrowser
[
{
BASE
}
/
{
filename
}
]
async
function
(
url
)
{
await
content
.
wrappedJSObject
.
installMozAM
(
url
)
;
}
)
;
await
SpecialPowers
.
popPrefEnv
(
)
;
}
add_task
(
(
)
=
>
testInstallMethod
(
installMozAM
"
installAmo
"
)
)
;
