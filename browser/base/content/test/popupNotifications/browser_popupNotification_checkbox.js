function
test
(
)
{
waitForExplicitFinish
(
)
;
ok
(
PopupNotifications
"
PopupNotifications
object
exists
"
)
;
ok
(
PopupNotifications
.
panel
"
PopupNotifications
panel
exists
"
)
;
setup
(
)
;
}
function
checkCheckbox
(
checkbox
label
checked
=
false
hidden
=
false
)
{
is
(
checkbox
.
label
label
"
Checkbox
should
have
the
correct
label
"
)
;
is
(
checkbox
.
hidden
hidden
"
Checkbox
should
be
shown
"
)
;
is
(
checkbox
.
checked
checked
"
Checkbox
should
be
checked
by
default
"
)
;
}
function
checkMainAction
(
notification
disabled
=
false
)
{
let
mainAction
=
notification
.
button
;
let
warningLabel
=
notification
.
querySelector
(
"
.
popup
-
notification
-
warning
"
)
;
is
(
warningLabel
.
hidden
!
disabled
"
Warning
label
should
be
shown
"
)
;
is
(
mainAction
.
disabled
disabled
"
MainAction
should
be
disabled
"
)
;
}
function
promiseElementVisible
(
element
)
{
return
BrowserTestUtils
.
waitForCondition
(
(
)
=
>
element
.
offsetParent
!
=
=
null
"
Waiting
for
element
to
be
visible
"
)
;
}
var
gNotification
;
var
tests
=
[
{
id
:
"
show_checkbox
"
run
(
)
{
this
.
notifyObj
=
new
BasicNotification
(
this
.
id
)
;
this
.
notifyObj
.
options
.
checkbox
=
{
label
:
"
This
is
a
checkbox
"
}
;
gNotification
=
showNotification
(
this
.
notifyObj
)
;
}
onShown
(
popup
)
{
checkPopup
(
popup
this
.
notifyObj
)
;
let
notification
=
popup
.
children
[
0
]
;
checkCheckbox
(
notification
.
checkbox
"
This
is
a
checkbox
"
)
;
triggerMainCommand
(
popup
)
;
}
onHidden
(
)
{
}
}
{
id
:
"
checkbox_checked
"
run
(
)
{
this
.
notifyObj
=
new
BasicNotification
(
this
.
id
)
;
this
.
notifyObj
.
options
.
checkbox
=
{
label
:
"
Check
this
"
checked
:
true
}
;
gNotification
=
showNotification
(
this
.
notifyObj
)
;
}
onShown
(
popup
)
{
checkPopup
(
popup
this
.
notifyObj
)
;
let
notification
=
popup
.
children
[
0
]
;
checkCheckbox
(
notification
.
checkbox
"
Check
this
"
true
)
;
triggerMainCommand
(
popup
)
;
}
onHidden
(
)
{
}
}
{
id
:
"
checkbox_passCheckboxChecked_mainAction
"
run
(
)
{
this
.
notifyObj
=
new
BasicNotification
(
this
.
id
)
;
this
.
notifyObj
.
mainAction
.
callback
=
(
{
checkboxChecked
}
)
=
>
this
.
mainActionChecked
=
checkboxChecked
;
this
.
notifyObj
.
options
.
checkbox
=
{
label
:
"
This
is
a
checkbox
"
}
;
gNotification
=
showNotification
(
this
.
notifyObj
)
;
}
async
onShown
(
popup
)
{
checkPopup
(
popup
this
.
notifyObj
)
;
let
notification
=
popup
.
children
[
0
]
;
let
checkbox
=
notification
.
checkbox
;
checkCheckbox
(
checkbox
"
This
is
a
checkbox
"
)
;
await
promiseElementVisible
(
checkbox
)
;
EventUtils
.
synthesizeMouseAtCenter
(
checkbox
{
}
)
;
checkCheckbox
(
checkbox
"
This
is
a
checkbox
"
true
)
;
triggerMainCommand
(
popup
)
;
}
onHidden
(
)
{
is
(
this
.
mainActionChecked
true
"
mainAction
callback
is
passed
the
correct
checkbox
value
"
)
;
}
}
{
id
:
"
checkbox_passCheckboxChecked_secondaryAction
"
run
(
)
{
this
.
notifyObj
=
new
BasicNotification
(
this
.
id
)
;
this
.
notifyObj
.
secondaryActions
=
[
{
label
:
"
Test
Secondary
"
accessKey
:
"
T
"
callback
:
(
{
checkboxChecked
}
)
=
>
this
.
secondaryActionChecked
=
checkboxChecked
}
]
;
this
.
notifyObj
.
options
.
checkbox
=
{
label
:
"
This
is
a
checkbox
"
}
;
gNotification
=
showNotification
(
this
.
notifyObj
)
;
}
async
onShown
(
popup
)
{
checkPopup
(
popup
this
.
notifyObj
)
;
let
notification
=
popup
.
children
[
0
]
;
let
checkbox
=
notification
.
checkbox
;
checkCheckbox
(
checkbox
"
This
is
a
checkbox
"
)
;
await
promiseElementVisible
(
checkbox
)
;
EventUtils
.
synthesizeMouseAtCenter
(
checkbox
{
}
)
;
checkCheckbox
(
checkbox
"
This
is
a
checkbox
"
true
)
;
triggerSecondaryCommand
(
popup
0
)
;
}
onHidden
(
)
{
is
(
this
.
secondaryActionChecked
true
"
secondaryAction
callback
is
passed
the
correct
checkbox
value
"
)
;
}
}
{
id
:
"
checkbox_reopen
"
run
(
)
{
this
.
notifyObj
=
new
BasicNotification
(
this
.
id
)
;
this
.
notifyObj
.
options
.
checkbox
=
{
label
:
"
This
is
a
checkbox
"
checkedState
:
{
disableMainAction
:
true
warningLabel
:
"
Testing
disable
"
}
}
;
gNotification
=
showNotification
(
this
.
notifyObj
)
;
}
async
onShown
(
popup
)
{
checkPopup
(
popup
this
.
notifyObj
)
;
let
notification
=
popup
.
children
[
0
]
;
let
checkbox
=
notification
.
checkbox
;
checkCheckbox
(
checkbox
"
This
is
a
checkbox
"
)
;
await
promiseElementVisible
(
checkbox
)
;
EventUtils
.
synthesizeMouseAtCenter
(
checkbox
{
}
)
;
dismissNotification
(
popup
)
;
}
async
onHidden
(
popup
)
{
let
icon
=
document
.
getElementById
(
"
default
-
notification
-
icon
"
)
;
let
shown
=
waitForNotificationPanel
(
)
;
EventUtils
.
synthesizeMouseAtCenter
(
icon
{
}
)
;
await
shown
;
let
notification
=
popup
.
children
[
0
]
;
let
checkbox
=
notification
.
checkbox
;
checkCheckbox
(
checkbox
"
This
is
a
checkbox
"
true
)
;
checkMainAction
(
notification
true
)
;
gNotification
.
remove
(
)
;
}
}
{
id
:
"
no_checkbox
"
run
(
)
{
this
.
notifyObj
=
new
BasicNotification
(
this
.
id
)
;
this
.
notifyObj
.
options
.
checkbox
=
null
;
gNotification
=
showNotification
(
this
.
notifyObj
)
;
}
onShown
(
popup
)
{
checkPopup
(
popup
this
.
notifyObj
)
;
let
notification
=
popup
.
children
[
0
]
;
checkCheckbox
(
notification
.
checkbox
"
"
false
true
)
;
checkMainAction
(
notification
)
;
triggerMainCommand
(
popup
)
;
}
onHidden
(
)
{
}
}
]
;
[
"
checkedState
"
"
uncheckedState
"
]
.
forEach
(
function
(
state
)
{
[
true
false
]
.
forEach
(
function
(
checked
)
{
tests
.
push
(
{
id
:
checkbox_disableMainAction_
{
state
}
_
{
checked
?
"
checked
"
:
"
unchecked
"
}
run
(
)
{
this
.
notifyObj
=
new
BasicNotification
(
this
.
id
)
;
this
.
notifyObj
.
options
.
checkbox
=
{
label
:
"
This
is
a
checkbox
"
checked
[
state
]
:
{
disableMainAction
:
true
warningLabel
:
"
Testing
disable
"
}
}
;
gNotification
=
showNotification
(
this
.
notifyObj
)
;
}
async
onShown
(
popup
)
{
checkPopup
(
popup
this
.
notifyObj
)
;
let
notification
=
popup
.
children
[
0
]
;
let
checkbox
=
notification
.
checkbox
;
let
disabled
=
(
state
=
=
=
"
checkedState
"
&
&
checked
)
|
|
(
state
=
=
=
"
uncheckedState
"
&
&
!
checked
)
;
checkCheckbox
(
checkbox
"
This
is
a
checkbox
"
checked
)
;
checkMainAction
(
notification
disabled
)
;
await
promiseElementVisible
(
checkbox
)
;
EventUtils
.
synthesizeMouseAtCenter
(
checkbox
{
}
)
;
checkCheckbox
(
checkbox
"
This
is
a
checkbox
"
!
checked
)
;
checkMainAction
(
notification
!
disabled
)
;
EventUtils
.
synthesizeMouseAtCenter
(
checkbox
{
}
)
;
checkCheckbox
(
checkbox
"
This
is
a
checkbox
"
checked
)
;
checkMainAction
(
notification
disabled
)
;
if
(
disabled
)
{
EventUtils
.
synthesizeMouseAtCenter
(
checkbox
{
}
)
;
}
triggerMainCommand
(
popup
)
;
}
onHidden
(
)
{
}
}
)
;
}
)
;
}
)
;
