const
remoteClientsFixture
=
[
{
id
:
1
name
:
"
Foo
"
}
{
id
:
2
name
:
"
Bar
"
}
]
;
add_task
(
async
function
test
(
)
{
let
[
origTab
]
=
gBrowser
.
visibleTabs
;
is
(
gBrowser
.
visibleTabs
.
length
1
"
there
is
one
visible
tab
"
)
;
let
testTab
=
BrowserTestUtils
.
addTab
(
gBrowser
)
;
is
(
gBrowser
.
visibleTabs
.
length
2
"
there
are
now
two
visible
tabs
"
)
;
updateTabContextMenu
(
origTab
)
;
is
(
document
.
getElementById
(
"
context_closeTab
"
)
.
disabled
false
"
Close
Tab
is
enabled
"
)
;
is
(
document
.
getElementById
(
"
context_reloadAllTabs
"
)
.
disabled
false
"
Reload
All
Tabs
is
enabled
"
)
;
gBrowser
.
selectedTab
=
testTab
;
gBrowser
.
showOnlyTheseTabs
(
[
testTab
]
)
;
is
(
gBrowser
.
visibleTabs
.
length
1
"
now
there
is
only
one
visible
tab
"
)
;
updateTabContextMenu
(
testTab
)
;
is
(
document
.
getElementById
(
"
context_closeTab
"
)
.
disabled
false
"
Close
Tab
is
enabled
when
more
than
one
tab
exists
"
)
;
is
(
document
.
getElementById
(
"
context_reloadAllTabs
"
)
.
disabled
true
"
Reload
All
Tabs
is
disabled
"
)
;
let
pinned
=
BrowserTestUtils
.
addTab
(
gBrowser
)
;
gBrowser
.
pinTab
(
pinned
)
;
is
(
gBrowser
.
visibleTabs
.
length
2
"
now
there
are
two
visible
tabs
"
)
;
updateTabContextMenu
(
pinned
)
;
ok
(
!
document
.
getElementById
(
"
context_closeOtherTabs
"
)
.
disabled
"
Close
Other
Tabs
is
enabled
on
pinned
tab
"
)
;
ok
(
!
document
.
getElementById
(
"
context_closeTabsToTheEnd
"
)
.
disabled
"
Close
Tabs
To
The
End
is
enabled
on
pinned
tab
"
)
;
updateTabContextMenu
(
testTab
)
;
ok
(
document
.
getElementById
(
"
context_closeOtherTabs
"
)
.
disabled
"
Close
Other
Tabs
is
disabled
on
single
unpinned
tab
"
)
;
ok
(
document
.
getElementById
(
"
context_closeTabsToTheEnd
"
)
.
disabled
"
Close
Tabs
To
The
End
is
disabled
on
single
unpinned
tab
"
)
;
let
allTabs
=
Array
.
from
(
gBrowser
.
tabs
)
;
gBrowser
.
showOnlyTheseTabs
(
allTabs
)
;
updateTabContextMenu
(
testTab
)
;
ok
(
!
document
.
getElementById
(
"
context_closeOtherTabs
"
)
.
disabled
"
Close
Other
Tabs
is
enabled
on
unpinned
tab
when
there
'
s
another
unpinned
tab
"
)
;
ok
(
document
.
getElementById
(
"
context_closeTabsToTheEnd
"
)
.
disabled
"
Close
Tabs
To
The
End
is
disabled
on
last
unpinned
tab
"
)
;
updateTabContextMenu
(
origTab
)
;
ok
(
!
document
.
getElementById
(
"
context_closeTabsToTheEnd
"
)
.
disabled
"
Close
Tabs
To
The
End
is
enabled
on
unpinned
tab
when
followed
by
another
"
)
;
gBrowser
.
removeTab
(
testTab
)
;
gBrowser
.
removeTab
(
pinned
)
;
}
)
;
