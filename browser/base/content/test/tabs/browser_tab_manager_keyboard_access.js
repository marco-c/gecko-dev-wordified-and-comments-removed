"
use
strict
"
;
add_task
(
async
function
test_open_tabmanager_keyboard
(
)
{
await
SpecialPowers
.
pushPrefEnv
(
{
set
:
[
[
"
browser
.
tabs
.
tabmanager
.
enabled
"
true
]
]
}
)
;
let
newWindow
=
await
BrowserTestUtils
.
openNewWindowWithFlushedCacheForMozSupports
(
)
;
let
elem
=
newWindow
.
document
.
getElementById
(
"
alltabs
-
button
"
)
;
elem
.
setAttribute
(
"
tabindex
"
"
-
1
"
)
;
elem
.
focus
(
)
;
elem
.
removeAttribute
(
"
tabindex
"
)
;
let
focused
=
BrowserTestUtils
.
waitForEvent
(
newWindow
"
focus
"
true
)
;
EventUtils
.
synthesizeKey
(
"
"
{
}
newWindow
)
;
let
event
=
await
focused
;
ok
(
event
.
originalTarget
.
closest
(
"
#
allTabsMenu
-
allTabsView
"
)
"
Focus
inside
all
tabs
menu
after
toolbar
button
pressed
"
)
;
let
hidden
=
BrowserTestUtils
.
waitForEvent
(
event
.
target
.
closest
(
"
panel
"
)
"
popuphidden
"
)
;
EventUtils
.
synthesizeKey
(
"
KEY_Escape
"
{
shiftKey
:
false
}
newWindow
)
;
await
hidden
;
await
BrowserTestUtils
.
closeWindow
(
newWindow
)
;
}
)
;
