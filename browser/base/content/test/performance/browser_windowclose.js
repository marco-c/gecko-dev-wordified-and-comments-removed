"
use
strict
"
;
const
EXPECTED_REFLOWS
=
[
]
;
add_task
(
async
function
(
)
{
await
new
Promise
(
resolve
=
>
{
waitForFocus
(
resolve
window
)
;
}
)
;
let
win
=
await
BrowserTestUtils
.
openNewBrowserWindow
(
)
;
await
new
Promise
(
resolve
=
>
{
waitForFocus
(
resolve
win
)
;
}
)
;
Assert
.
equal
(
EXPECTED_REFLOWS
.
length
0
"
We
shouldn
'
t
have
added
any
new
expected
reflows
for
window
close
.
"
)
;
await
withPerfObserver
(
async
function
(
)
{
let
promiseOrigBrowserFocused
=
TestUtils
.
waitForCondition
(
(
)
=
>
{
return
Services
.
focus
.
activeWindow
=
=
window
;
}
)
;
await
BrowserTestUtils
.
closeWindow
(
win
)
;
await
promiseOrigBrowserFocused
;
}
{
expectedReflows
:
EXPECTED_REFLOWS
frames
:
{
filter
(
rects
frame
)
{
if
(
isLikelyFocusChange
(
rects
frame
)
)
{
return
[
]
;
}
return
rects
;
}
}
}
win
)
;
}
)
;
