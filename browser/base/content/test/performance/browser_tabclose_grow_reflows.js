"
use
strict
"
;
const
EXPECTED_REFLOWS
=
[
]
;
add_task
(
async
function
(
)
{
await
ensureNoPreloadedBrowser
(
)
;
Assert
.
equal
(
EXPECTED_REFLOWS
.
length
0
"
We
shouldn
'
t
have
added
any
new
expected
reflows
.
"
)
;
const
TAB_COUNT_FOR_GROWTH
=
computeMaxTabCount
(
)
;
await
createTabs
(
TAB_COUNT_FOR_GROWTH
)
;
let
lastTab
=
gBrowser
.
tabs
[
gBrowser
.
tabs
.
length
-
1
]
;
await
BrowserTestUtils
.
switchTab
(
gBrowser
lastTab
)
;
await
withReflowObserver
(
async
function
(
)
{
let
switchDone
=
BrowserTestUtils
.
waitForEvent
(
window
"
TabSwitchDone
"
)
;
let
tab
=
gBrowser
.
tabs
[
gBrowser
.
tabs
.
length
-
1
]
;
gBrowser
.
removeTab
(
tab
{
animate
:
true
}
)
;
await
BrowserTestUtils
.
waitForEvent
(
tab
"
transitionend
"
false
e
=
>
e
.
propertyName
=
=
=
"
max
-
width
"
)
;
await
switchDone
;
}
EXPECTED_REFLOWS
)
;
await
removeAllButFirstTab
(
)
;
}
)
;
