XPCOMUtils
.
defineLazyModuleGetter
(
this
"
PlacesUtils
"
"
resource
:
/
/
gre
/
modules
/
PlacesUtils
.
jsm
"
)
;
function
promiseIsURIVisited
(
aURI
aExpectedValue
)
{
return
new
Promise
(
resolve
=
>
{
PlacesUtils
.
asyncHistory
.
isURIVisited
(
aURI
function
(
unused
aIsVisited
)
{
resolve
(
aIsVisited
)
;
}
)
;
}
)
;
}
function
promiseHistoryClearedState
(
aURIs
aShouldBeCleared
)
{
return
new
Promise
(
resolve
=
>
{
let
callbackCount
=
0
;
let
niceStr
=
aShouldBeCleared
?
"
no
longer
"
:
"
still
"
;
function
callbackDone
(
)
{
if
(
+
+
callbackCount
=
=
aURIs
.
length
)
resolve
(
)
;
}
aURIs
.
forEach
(
function
(
aURI
)
{
PlacesUtils
.
asyncHistory
.
isURIVisited
(
aURI
function
(
uri
isVisited
)
{
is
(
isVisited
!
aShouldBeCleared
"
history
visit
"
+
uri
.
spec
+
"
should
"
+
niceStr
+
"
exist
"
)
;
callbackDone
(
)
;
}
)
;
}
)
;
}
)
;
}
