function
countPermissions
(
)
{
return
Services
.
perms
.
all
.
length
;
}
add_task
(
async
function
test
(
)
{
await
Sanitizer
.
sanitize
(
[
"
siteSettings
"
]
{
ignoreTimespan
:
false
}
)
;
let
numAtStart
=
countPermissions
(
)
;
PermissionTestUtils
.
add
(
"
http
:
/
/
example
.
com
"
"
testing
"
Services
.
perms
.
ALLOW_ACTION
)
;
ok
(
!
!
Services
.
perms
.
all
.
length
"
Permission
manager
should
have
elements
since
we
just
added
one
"
)
;
await
Sanitizer
.
sanitize
(
[
"
siteSettings
"
]
{
ignoreTimespan
:
false
}
)
;
is
(
numAtStart
countPermissions
(
)
"
Permission
manager
should
have
the
same
count
it
started
with
"
)
;
}
)
;
