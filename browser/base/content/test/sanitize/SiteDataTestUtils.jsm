"
use
strict
"
;
var
EXPORTED_SYMBOLS
=
[
"
SiteDataTestUtils
"
]
;
ChromeUtils
.
import
(
"
resource
:
/
/
gre
/
modules
/
Services
.
jsm
"
)
;
const
{
Sanitizer
}
=
ChromeUtils
.
import
(
"
resource
:
/
/
/
modules
/
Sanitizer
.
jsm
"
{
}
)
;
var
SiteDataTestUtils
=
{
addToIndexedDB
(
origin
)
{
return
new
Promise
(
resolve
=
>
{
let
uri
=
Services
.
io
.
newURI
(
origin
)
;
let
principal
=
Services
.
scriptSecurityManager
.
createCodebasePrincipal
(
uri
{
}
)
;
let
request
=
indexedDB
.
openForPrincipal
(
principal
"
TestDatabase
"
1
)
;
request
.
onupgradeneeded
=
function
(
e
)
{
let
db
=
e
.
target
.
result
;
db
.
createObjectStore
(
"
TestStore
"
{
keyPath
:
"
id
"
}
)
;
}
;
request
.
onsuccess
=
function
(
e
)
{
let
db
=
e
.
target
.
result
;
let
tx
=
db
.
transaction
(
"
TestStore
"
"
readwrite
"
)
;
let
store
=
tx
.
objectStore
(
"
TestStore
"
)
;
tx
.
oncomplete
=
resolve
;
store
.
put
(
{
id
:
performance
.
now
(
)
.
toString
(
)
description
:
"
IndexedDB
Test
"
}
)
;
}
;
}
)
;
}
addToCookies
(
origin
name
value
)
{
let
uri
=
Services
.
io
.
newURI
(
origin
)
;
Services
.
cookies
.
add
(
uri
.
host
uri
.
pathQueryRef
name
value
false
false
false
Date
.
now
(
)
+
24000
*
60
*
60
)
;
}
getQuotaUsage
(
origin
)
{
return
new
Promise
(
resolve
=
>
{
let
uri
=
Services
.
io
.
newURI
(
origin
)
;
let
principal
=
Services
.
scriptSecurityManager
.
createCodebasePrincipal
(
uri
{
}
)
;
Services
.
qms
.
getUsageForPrincipal
(
principal
request
=
>
resolve
(
request
.
result
.
usage
)
)
;
}
)
;
}
clear
(
)
{
return
Sanitizer
.
sanitize
(
[
"
cookies
"
"
cache
"
"
siteSettings
"
"
offlineApps
"
]
)
;
}
}
;
