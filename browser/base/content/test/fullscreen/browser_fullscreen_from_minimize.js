add_task
(
async
function
(
)
{
registerCleanupFunction
(
function
(
)
{
window
.
restore
(
)
;
}
)
;
let
promiseSizeModeChange
;
let
promiseFullscreen
;
ok
(
!
window
.
fullScreen
"
Window
should
be
normal
at
start
of
test
.
"
)
;
info
(
"
Requesting
fullscreen
.
"
)
;
promiseFullscreen
=
document
.
documentElement
.
requestFullscreen
(
)
;
await
promiseFullscreen
;
ok
(
window
.
fullScreen
"
Window
should
be
fullscreen
before
being
minimized
.
"
)
;
info
(
"
Requesting
minimize
on
a
fullscreen
window
.
"
)
;
promiseSizeModeChange
=
BrowserTestUtils
.
waitForEvent
(
window
"
sizemodechange
"
)
;
window
.
minimize
(
)
;
await
promiseSizeModeChange
;
is
(
window
.
windowState
window
.
STATE_MINIMIZED
"
Window
should
be
minimized
after
fullscreen
.
"
)
;
if
(
window
.
windowState
!
=
window
.
STATE_NORMAL
)
{
info
(
"
Restoring
window
.
"
)
;
promiseSizeModeChange
=
BrowserTestUtils
.
waitForEvent
(
window
"
sizemodechange
"
)
;
window
.
restore
(
)
;
await
promiseSizeModeChange
;
is
(
window
.
windowState
window
.
STATE_NORMAL
"
Window
should
be
normal
.
"
)
;
}
info
(
"
Requesting
minimize
on
a
normal
window
.
"
)
;
promiseSizeModeChange
=
BrowserTestUtils
.
waitForEvent
(
window
"
sizemodechange
"
)
;
window
.
minimize
(
)
;
await
promiseSizeModeChange
;
is
(
window
.
windowState
window
.
STATE_MINIMIZED
"
Window
should
be
minimized
before
fullscreen
.
"
)
;
info
(
"
Requesting
fullscreen
on
a
minimized
window
.
"
)
;
promiseFullscreen
=
document
.
documentElement
.
requestFullscreen
(
)
;
await
promiseFullscreen
;
ok
(
window
.
fullScreen
"
Window
should
be
fullscreen
after
being
minimized
.
"
)
;
}
)
;
