const
{
Services
}
=
ChromeUtils
.
import
(
"
resource
:
/
/
gre
/
modules
/
Services
.
jsm
"
)
;
const
appStartup
=
Services
.
startup
;
const
{
ResetProfile
}
=
ChromeUtils
.
import
(
"
resource
:
/
/
gre
/
modules
/
ResetProfile
.
jsm
"
)
;
var
defaultToReset
=
false
;
function
restartApp
(
)
{
appStartup
.
quit
(
appStartup
.
eForceQuit
|
appStartup
.
eRestart
)
;
}
function
resetProfile
(
)
{
let
env
=
Cc
[
"
mozilla
.
org
/
process
/
environment
;
1
"
]
.
getService
(
Ci
.
nsIEnvironment
)
;
env
.
set
(
"
MOZ_RESET_PROFILE_RESTART
"
"
1
"
)
;
}
function
showResetDialog
(
)
{
let
retVals
=
{
reset
:
false
}
;
window
.
openDialog
(
"
chrome
:
/
/
global
/
content
/
resetProfile
.
xul
"
null
"
chrome
modal
centerscreen
titlebar
dialog
=
yes
"
retVals
)
;
if
(
!
retVals
.
reset
)
return
;
resetProfile
(
)
;
restartApp
(
)
;
}
function
onDefaultButton
(
)
{
if
(
defaultToReset
)
{
resetProfile
(
)
;
restartApp
(
)
;
return
false
;
}
return
true
;
}
function
onCancel
(
)
{
appStartup
.
quit
(
appStartup
.
eForceQuit
)
;
}
function
onExtra1
(
)
{
if
(
defaultToReset
)
{
window
.
close
(
)
;
}
showResetDialog
(
)
;
}
function
onLoad
(
)
{
if
(
appStartup
.
automaticSafeModeNecessary
)
{
document
.
getElementById
(
"
autoSafeMode
"
)
.
hidden
=
false
;
document
.
getElementById
(
"
safeMode
"
)
.
hidden
=
true
;
if
(
ResetProfile
.
resetSupported
(
)
)
{
document
.
getElementById
(
"
resetProfile
"
)
.
hidden
=
false
;
}
else
{
document
.
documentElement
.
getButton
(
"
extra1
"
)
.
hidden
=
true
;
}
}
else
if
(
!
ResetProfile
.
resetSupported
(
)
)
{
document
.
documentElement
.
getButton
(
"
extra1
"
)
.
hidden
=
true
;
document
.
getElementById
(
"
resetProfileInstead
"
)
.
hidden
=
true
;
}
document
.
addEventListener
(
"
dialogextra1
"
onExtra1
)
;
}
