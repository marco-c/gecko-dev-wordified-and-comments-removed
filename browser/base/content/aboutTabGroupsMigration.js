"
use
strict
"
;
Cu
.
import
(
"
resource
:
/
/
/
modules
/
TabGroupsMigrator
.
jsm
"
)
;
XPCOMUtils
.
defineLazyModuleGetter
(
this
"
PlacesUtils
"
"
resource
:
/
/
gre
/
modules
/
PlacesUtils
.
jsm
"
)
;
const
SUPPORT_URL
=
"
https
:
/
/
support
.
mozilla
.
org
/
kb
/
tab
-
groups
-
removal
"
;
function
fillInDescription
(
)
{
let
descElement
=
document
.
getElementById
(
"
mainDescription
"
)
;
let
text
=
descElement
.
getAttribute
(
"
_description_label
"
)
;
let
learnMoreText
=
descElement
.
getAttribute
(
"
_learnmore_label
"
)
;
let
link
=
document
.
createElement
(
"
a
"
)
;
link
.
href
=
SUPPORT_URL
;
link
.
target
=
"
_blank
"
;
link
.
textContent
=
learnMoreText
;
let
nodes
=
text
.
split
(
/
%
S
/
)
.
map
(
document
.
createTextNode
.
bind
(
document
)
)
;
nodes
.
splice
(
1
0
link
)
;
for
(
let
node
of
nodes
)
{
descElement
.
appendChild
(
node
)
;
}
}
let
loadPromise
=
new
Promise
(
resolve
=
>
{
let
loadHandler
=
e
=
>
{
window
.
removeEventListener
(
"
DOMContentLoaded
"
loadHandler
)
;
fillInDescription
(
)
;
resolve
(
)
;
}
;
window
.
addEventListener
(
"
DOMContentLoaded
"
loadHandler
false
)
;
}
)
;
let
tabGroupsBookmarkItemId
;
if
(
TabGroupsMigrator
.
bookmarkedGroupsPromise
)
{
let
bookmarkPromise
=
TabGroupsMigrator
.
bookmarkedGroupsPromise
.
then
(
bm
=
>
{
return
PlacesUtils
.
promiseItemId
(
bm
.
guid
)
;
}
)
.
then
(
itemId
=
>
{
tabGroupsBookmarkItemId
=
itemId
}
)
;
Promise
.
all
(
[
bookmarkPromise
loadPromise
]
)
.
then
(
function
(
)
{
document
.
getElementById
(
"
show
-
migrated
-
bookmarks
-
button
"
)
.
style
.
removeProperty
(
"
display
"
)
;
}
)
;
}
function
showMigratedGroups
(
)
{
let
browserWin
=
getBrowserWindow
(
)
;
browserWin
.
PlacesCommandHook
.
showPlacesOrganizer
(
[
"
BookmarksMenu
"
tabGroupsBookmarkItemId
]
)
;
}
