"
use
strict
"
;
var
EXPORTED_SYMBOLS
=
[
"
URIFixupChild
"
]
;
const
{
ActorChild
}
=
ChromeUtils
.
import
(
"
resource
:
/
/
gre
/
modules
/
ActorChild
.
jsm
"
)
;
class
URIFixupChild
extends
ActorChild
{
observe
(
subject
)
{
let
fixupInfo
=
subject
.
QueryInterface
(
Ci
.
nsIURIFixupInfo
)
;
if
(
!
fixupInfo
.
consumer
)
{
return
;
}
let
parent
=
fixupInfo
.
consumer
.
QueryInterface
(
Ci
.
nsIDocShellTreeItem
)
.
sameTypeRootTreeItem
;
if
(
parent
!
=
this
.
mm
.
docShell
)
{
return
;
}
let
data
=
{
}
;
for
(
let
f
of
Object
.
keys
(
fixupInfo
)
)
{
if
(
f
=
=
"
consumer
"
|
|
typeof
fixupInfo
[
f
]
=
=
"
function
"
)
{
continue
;
}
if
(
fixupInfo
[
f
]
&
&
fixupInfo
[
f
]
instanceof
Ci
.
nsIURI
)
{
data
[
f
]
=
fixupInfo
[
f
]
.
spec
;
}
else
{
data
[
f
]
=
fixupInfo
[
f
]
;
}
}
this
.
mm
.
sendAsyncMessage
(
"
Browser
:
URIFixup
"
data
)
;
}
}
