const
path
=
require
(
"
path
"
)
;
module
.
exports
=
{
MozSrcUriPlugin
:
class
MozSrcUriPlugin
{
#
baseDir
;
constructor
(
{
baseDir
}
)
{
this
.
#
baseDir
=
baseDir
;
}
apply
(
compiler
)
{
compiler
.
hooks
.
compilation
.
tap
(
"
MozSrcUriPlugin
"
(
compilation
{
normalModuleFactory
}
)
=
>
{
normalModuleFactory
.
hooks
.
resolveForScheme
.
for
(
"
moz
-
src
"
)
.
tap
(
"
MozSrcUriPlugin
"
resourceData
=
>
{
const
url
=
new
URL
(
resourceData
.
resource
)
;
const
pathname
=
path
.
join
(
this
.
#
baseDir
url
.
pathname
)
;
resourceData
.
path
=
pathname
;
resourceData
.
query
=
url
.
search
;
resourceData
.
fragment
=
url
.
hash
;
resourceData
.
resource
=
pathname
+
url
.
search
+
url
.
hash
;
return
true
;
}
)
;
}
)
;
}
}
}
;
