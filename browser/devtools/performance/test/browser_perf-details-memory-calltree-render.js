function
*
spawnTest
(
)
{
let
{
panel
}
=
yield
initPerformance
(
ALLOCS_URL
)
;
let
{
EVENTS
PerformanceController
DetailsView
MemoryCallTreeView
}
=
panel
.
panelWin
;
Services
.
prefs
.
setBoolPref
(
ALLOCATIONS_PREF
true
)
;
yield
startRecording
(
panel
)
;
yield
waitUntil
(
(
)
=
>
PerformanceController
.
getCurrentRecording
(
)
.
getAllocations
(
)
.
sizes
.
length
)
;
yield
stopRecording
(
panel
)
;
let
rendered
=
once
(
MemoryCallTreeView
EVENTS
.
MEMORY_CALL_TREE_RENDERED
)
;
yield
DetailsView
.
selectView
(
"
memory
-
calltree
"
)
;
ok
(
DetailsView
.
isViewSelected
(
MemoryCallTreeView
)
"
The
call
tree
is
now
selected
.
"
)
;
yield
rendered
;
ok
(
true
"
MemoryCallTreeView
rendered
after
recording
is
stopped
.
"
)
;
ok
(
(
"
#
memory
-
calltree
-
view
.
call
-
tree
-
item
"
)
.
length
"
there
are
several
allocations
rendered
.
"
)
;
yield
startRecording
(
panel
)
;
yield
busyWait
(
100
)
;
rendered
=
once
(
MemoryCallTreeView
EVENTS
.
MEMORY_CALL_TREE_RENDERED
)
;
yield
stopRecording
(
panel
)
;
yield
rendered
;
ok
(
true
"
MemoryCallTreeView
rendered
again
after
recording
completed
a
second
time
.
"
)
;
yield
teardown
(
panel
)
;
finish
(
)
;
}
