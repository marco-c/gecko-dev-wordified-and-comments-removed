"
use
strict
"
;
const
NAME
=
exports
.
NAME
=
"
service
/
waitUntil
"
;
function
waitUntilService
(
{
dispatch
getState
}
)
{
let
pending
=
[
]
;
function
checkPending
(
action
)
{
let
readyRequests
=
[
]
;
let
stillPending
=
[
]
;
for
(
let
request
of
pending
)
{
if
(
request
.
predicate
(
action
)
)
{
readyRequests
.
push
(
request
)
;
}
else
{
stillPending
.
push
(
request
)
;
}
}
pending
=
stillPending
;
for
(
let
request
of
readyRequests
)
{
request
.
run
(
dispatch
getState
action
)
;
}
}
return
next
=
>
action
=
>
{
if
(
action
.
type
=
=
=
NAME
)
{
pending
.
push
(
action
)
;
}
else
{
next
(
action
)
;
checkPending
(
action
)
;
}
}
}
exports
.
waitUntilService
=
waitUntilService
;
