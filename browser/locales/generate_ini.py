import
codecs
import
re
import
shutil
import
buildconfig
def
main
(
output
ini
ini_append
=
None
locale
=
None
)
:
    
fixup_re
=
re
.
compile
(
"
^
(
Info
|
Title
)
Text
=
"
)
    
with
codecs
.
open
(
ini
"
rb
"
"
utf_8
"
)
as
f
:
        
for
line
in
f
:
            
fixed_line
=
fixup_re
.
sub
(
r
"
\
1
=
"
line
)
            
fixed_line
=
fixed_line
.
replace
(
                
"
%
MOZ_APP_DISPLAYNAME
%
"
buildconfig
.
substs
[
"
MOZ_APP_DISPLAYNAME
"
]
            
)
            
output
.
write
(
fixed_line
)
    
if
ini_append
and
buildconfig
.
substs
[
"
OS_TARGET
"
]
=
=
"
WINNT
"
:
        
with
codecs
.
open
(
ini_append
"
rb
"
"
utf_8
"
)
as
f
:
            
shutil
.
copyfileobj
(
f
output
)
