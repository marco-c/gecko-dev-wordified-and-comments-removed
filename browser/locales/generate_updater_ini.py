from
__future__
import
absolute_import
unicode_literals
print_function
import
buildconfig
import
codecs
import
re
import
shutil
def
main
(
output
updater_ini
updater_ini_append
locale
=
None
)
:
    
assert
(
locale
is
not
None
)
    
fixup_re
=
re
.
compile
(
'
^
(
Info
|
Title
)
Text
=
'
)
    
with
codecs
.
open
(
updater_ini
'
rb
'
'
utf_8
'
)
as
f
:
        
for
line
in
f
:
            
line
=
fixup_re
.
sub
(
r
'
\
1
=
'
line
)
            
line
=
line
.
replace
(
'
%
MOZ_APP_DISPLAYNAME
%
'
                                
buildconfig
.
substs
[
'
MOZ_APP_DISPLAYNAME
'
]
)
            
output
.
write
(
line
)
    
if
buildconfig
.
substs
[
'
OS_TARGET
'
]
=
=
'
WINNT
'
:
        
with
codecs
.
open
(
updater_ini_append
'
rb
'
'
utf_8
'
)
as
f
:
            
shutil
.
copyfileobj
(
f
output
)
