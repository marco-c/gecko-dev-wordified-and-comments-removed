#
include
"
mozilla
/
LoaderAPIInterfaces
.
h
"
#
include
"
freestanding
/
CheckForCaller
.
h
"
#
include
"
freestanding
/
LoaderPrivateAPI
.
h
"
namespace
mozilla
{
extern
"
C
"
MOZ_EXPORT
nt
:
:
LoaderAPI
*
GetNtLoaderAPI
(
nt
:
:
LoaderObserver
*
aNewObserver
)
{
const
bool
isCallerMozglue
=
CheckForAddress
(
RETURN_ADDRESS
(
)
L
"
mozglue
.
dll
"
)
;
MOZ_ASSERT
(
isCallerMozglue
)
;
if
(
!
isCallerMozglue
)
{
return
nullptr
;
}
freestanding
:
:
EnsureInitialized
(
)
;
freestanding
:
:
LoaderPrivateAPI
&
api
=
freestanding
:
:
gLoaderPrivateAPI
;
api
.
SetObserver
(
aNewObserver
)
;
return
&
api
;
}
}
