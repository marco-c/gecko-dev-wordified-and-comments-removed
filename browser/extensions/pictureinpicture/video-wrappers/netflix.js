"
use
strict
"
;
class
PictureInPictureVideoWrapper
{
constructor
(
)
{
let
netflixPlayerAPI
=
window
.
wrappedJSObject
.
netflix
.
appContext
.
state
.
playerApp
.
getAPI
(
)
.
videoPlayer
;
let
sessionId
=
null
;
for
(
let
id
of
netflixPlayerAPI
.
getAllPlayerSessionIds
(
)
)
{
if
(
id
.
startsWith
(
"
watch
-
"
)
)
{
sessionId
=
id
;
break
;
}
}
this
.
player
=
netflixPlayerAPI
.
getVideoPlayerBySessionId
(
sessionId
)
;
}
getCurrentTime
(
video
)
{
return
this
.
player
.
getCurrentTime
(
)
;
}
getDuration
(
video
)
{
return
this
.
player
.
getDuration
(
)
;
}
play
(
)
{
this
.
player
.
play
(
)
;
}
pause
(
)
{
this
.
player
.
pause
(
)
;
}
setCaptionContainerObserver
(
video
updateCaptionsFunction
)
{
let
container
=
document
.
querySelector
(
"
.
watch
-
video
"
)
;
if
(
container
)
{
updateCaptionsFunction
(
"
"
)
;
const
callback
=
function
(
mutationsList
observer
)
{
let
text
=
container
.
querySelector
(
"
.
player
-
timedtext
"
)
.
innerText
;
updateCaptionsFunction
(
text
)
;
}
;
callback
(
[
1
]
null
)
;
let
captionsObserver
=
new
MutationObserver
(
callback
)
;
captionsObserver
.
observe
(
container
{
attributes
:
false
childList
:
true
subtree
:
true
}
)
;
}
}
setCurrentTime
(
video
position
)
{
let
oldTime
=
this
.
player
.
getCurrentTime
(
)
;
let
duration
=
this
.
player
.
getDuration
(
)
;
let
isHome
=
position
=
=
0
;
let
isEnd
=
position
>
=
duration
;
let
seekDirection
=
position
-
oldTime
;
let
seekTimeMS
=
10000
;
let
newTime
=
0
;
if
(
isHome
|
|
isEnd
)
{
newTime
=
position
;
}
else
if
(
seekDirection
<
0
)
{
newTime
=
Math
.
max
(
oldTime
-
seekTimeMS
0
)
;
}
else
if
(
seekDirection
>
0
)
{
newTime
=
Math
.
min
(
oldTime
+
seekTimeMS
duration
)
;
}
this
.
player
.
seek
(
newTime
)
;
}
}
this
.
PictureInPictureVideoWrapper
=
PictureInPictureVideoWrapper
;
