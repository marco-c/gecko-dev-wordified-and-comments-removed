"
use
strict
"
;
const
{
LoopAPI
}
=
Cu
.
import
(
"
chrome
:
/
/
loop
/
content
/
modules
/
MozLoopAPI
.
jsm
"
{
}
)
;
var
[
gHandlers
]
=
LoopAPI
.
inspect
(
)
;
function
promiseGetMetadata
(
)
{
return
new
Promise
(
resolve
=
>
gHandlers
.
GetSelectedTabMetadata
(
{
}
resolve
)
)
;
}
add_task
(
function
*
test_mozLoop_getSelectedTabMetadata
(
)
{
let
metadata
=
yield
promiseGetMetadata
(
)
;
Assert
.
strictEqual
(
metadata
.
url
null
"
URL
should
be
empty
for
about
:
blank
"
)
;
Assert
.
strictEqual
(
metadata
.
favicon
null
"
Favicon
should
be
empty
for
about
:
blank
"
)
;
Assert
.
strictEqual
(
metadata
.
title
"
"
"
Title
should
be
empty
for
about
:
blank
"
)
;
Assert
.
deepEqual
(
metadata
.
previews
[
]
"
No
previews
available
for
about
:
blank
"
)
;
let
tab
=
yield
BrowserTestUtils
.
openNewForegroundTab
(
gBrowser
"
about
:
home
"
)
;
metadata
=
yield
promiseGetMetadata
(
)
;
Assert
.
strictEqual
(
metadata
.
url
null
"
URL
should
be
empty
for
about
:
home
"
)
;
Assert
.
strictEqual
(
metadata
.
favicon
null
"
Favicon
should
be
empty
for
about
:
home
"
)
;
Assert
.
ok
(
metadata
.
title
"
Title
should
be
set
for
about
:
home
"
)
;
Assert
.
deepEqual
(
metadata
.
previews
.
filter
(
e
=
>
e
)
[
]
"
No
previews
available
for
about
:
home
"
)
;
yield
BrowserTestUtils
.
removeTab
(
tab
)
;
}
)
;
add_task
(
function
*
test_mozLoop_getSelectedTabMetadata_defaultIcon
(
)
{
let
tab
=
yield
BrowserTestUtils
.
openNewForegroundTab
(
gBrowser
"
http
:
/
/
example
.
com
/
"
)
;
let
metadata
=
yield
promiseGetMetadata
(
)
;
Assert
.
strictEqual
(
metadata
.
url
"
http
:
/
/
example
.
com
/
"
"
URL
should
match
"
)
;
Assert
.
strictEqual
(
metadata
.
favicon
null
"
Favicon
should
be
empty
"
)
;
Assert
.
ok
(
metadata
.
title
"
Title
should
be
set
"
)
;
Assert
.
deepEqual
(
metadata
.
previews
[
]
"
No
previews
available
"
)
;
yield
BrowserTestUtils
.
removeTab
(
tab
)
;
}
)
;
