"
use
strict
"
;
const
{
utils
:
Cu
}
=
Components
;
ChromeUtils
.
import
(
"
resource
:
/
/
gre
/
modules
/
XPCOMUtils
.
jsm
"
)
;
ChromeUtils
.
import
(
"
resource
:
/
/
gre
/
modules
/
Services
.
jsm
"
)
;
ChromeUtils
.
import
(
"
chrome
:
/
/
pocket
/
content
/
AboutPocket
.
jsm
"
)
;
function
AboutPocketChildListener
(
)
{
}
AboutPocketChildListener
.
prototype
=
{
onStartup
:
function
onStartup
(
)
{
if
(
Services
.
appinfo
.
processType
=
=
Services
.
appinfo
.
PROCESS_TYPE_CONTENT
)
{
Services
.
cpmm
.
addMessageListener
(
"
PocketShuttingDown
"
this
true
)
;
}
AboutPocket
.
aboutSaved
.
register
(
)
;
AboutPocket
.
aboutSignup
.
register
(
)
;
}
onShutdown
:
function
onShutdown
(
)
{
AboutPocket
.
aboutSignup
.
unregister
(
)
;
AboutPocket
.
aboutSaved
.
unregister
(
)
;
Services
.
cpmm
.
removeMessageListener
(
"
PocketShuttingDown
"
this
)
;
Cu
.
unload
(
"
chrome
:
/
/
pocket
/
content
/
AboutPocket
.
jsm
"
)
;
}
receiveMessage
:
function
receiveMessage
(
message
)
{
switch
(
message
.
name
)
{
case
"
PocketShuttingDown
"
:
this
.
onShutdown
(
)
;
break
;
default
:
break
;
}
}
}
;
const
listener
=
new
AboutPocketChildListener
(
)
;
listener
.
onStartup
(
)
;
