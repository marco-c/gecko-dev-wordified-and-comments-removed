"
use
strict
"
;
this
.
EXPORTED_SYMBOLS
=
[
"
FormAutofillHandler
"
]
;
const
{
classes
:
Cc
interfaces
:
Ci
utils
:
Cu
results
:
Cr
}
=
Components
;
Cu
.
import
(
"
resource
:
/
/
gre
/
modules
/
XPCOMUtils
.
jsm
"
)
;
Cu
.
import
(
"
resource
:
/
/
formautofill
/
FormAutofillUtils
.
jsm
"
)
;
XPCOMUtils
.
defineLazyModuleGetter
(
this
"
FormAutofillHeuristics
"
"
resource
:
/
/
formautofill
/
FormAutofillHeuristics
.
jsm
"
)
;
this
.
log
=
null
;
FormAutofillUtils
.
defineLazyLogGetter
(
this
this
.
EXPORTED_SYMBOLS
[
0
]
)
;
function
FormAutofillHandler
(
form
)
{
this
.
form
=
form
;
this
.
fieldDetails
=
[
]
;
}
FormAutofillHandler
.
prototype
=
{
form
:
null
fieldDetails
:
null
collectFormFields
(
)
{
let
autofillData
=
[
]
;
for
(
let
element
of
this
.
form
.
elements
)
{
let
info
=
FormAutofillHeuristics
.
getInfo
(
element
)
;
if
(
!
info
)
{
continue
;
}
if
(
this
.
fieldDetails
.
some
(
f
=
>
f
.
section
=
=
info
.
section
&
&
f
.
addressType
=
=
info
.
addressType
&
&
f
.
contactType
=
=
info
.
contactType
&
&
f
.
fieldName
=
=
info
.
fieldName
)
)
{
log
.
debug
(
"
Not
collecting
a
field
matching
another
with
the
same
info
:
"
info
)
;
return
null
;
}
let
inputFormat
=
{
section
:
info
.
section
addressType
:
info
.
addressType
contactType
:
info
.
contactType
fieldName
:
info
.
fieldName
}
;
let
formatWithElement
=
Object
.
assign
(
{
}
inputFormat
)
;
inputFormat
.
index
=
autofillData
.
length
;
autofillData
.
push
(
inputFormat
)
;
formatWithElement
.
element
=
element
;
this
.
fieldDetails
.
push
(
formatWithElement
)
;
}
log
.
debug
(
"
Collected
details
on
"
autofillData
.
length
"
fields
"
)
;
return
autofillData
;
}
autofillFormFields
(
profile
focusedInput
)
{
log
.
debug
(
"
profile
in
autofillFormFields
:
"
profile
)
;
for
(
let
fieldDetail
of
this
.
fieldDetails
)
{
if
(
fieldDetail
.
element
=
=
=
focusedInput
|
|
fieldDetail
.
element
.
value
)
{
continue
;
}
let
value
=
profile
[
fieldDetail
.
fieldName
]
;
if
(
value
)
{
fieldDetail
.
element
.
setUserInput
(
value
)
;
}
}
}
}
;
