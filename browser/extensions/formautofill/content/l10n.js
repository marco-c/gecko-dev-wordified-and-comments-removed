"
use
strict
"
;
const
{
FormAutofillUtils
}
=
ChromeUtils
.
import
(
"
resource
:
/
/
formautofill
/
FormAutofillUtils
.
jsm
"
)
;
const
CONTENT_WIN
=
typeof
(
window
)
!
=
"
undefined
"
?
window
:
this
;
const
L10N_ATTRIBUTES
=
[
"
data
-
localization
"
"
data
-
localization
-
region
"
]
;
CONTENT_WIN
.
addEventListener
(
"
DOMContentLoaded
"
function
onDCL
(
evt
)
{
let
doc
=
evt
.
target
;
FormAutofillUtils
.
localizeMarkup
(
doc
)
;
let
mutationObserver
=
new
doc
.
ownerGlobal
.
MutationObserver
(
function
onMutation
(
mutations
)
{
for
(
let
mutation
of
mutations
)
{
switch
(
mutation
.
type
)
{
case
"
attributes
"
:
{
if
(
!
mutation
.
target
.
hasAttribute
(
mutation
.
attributeName
)
)
{
continue
;
}
FormAutofillUtils
.
localizeAttributeForElement
(
mutation
.
target
mutation
.
attributeName
)
;
break
;
}
case
"
childList
"
:
{
if
(
!
mutation
.
addedNodes
|
|
!
mutation
.
target
.
closest
(
"
.
page
"
)
)
{
break
;
}
FormAutofillUtils
.
localizeMarkup
(
mutation
.
target
)
;
break
;
}
}
}
}
)
;
mutationObserver
.
observe
(
doc
{
attributes
:
true
attributeFilter
:
L10N_ATTRIBUTES
childList
:
true
subtree
:
true
}
)
;
}
)
;
