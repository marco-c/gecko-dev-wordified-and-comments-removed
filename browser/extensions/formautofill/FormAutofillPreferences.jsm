"
use
strict
"
;
this
.
EXPORTED_SYMBOLS
=
[
"
FormAutofillPreferences
"
]
;
const
{
classes
:
Cc
interfaces
:
Ci
utils
:
Cu
results
:
Cr
}
=
Components
;
const
PREF_AUTOFILL_ENABLED
=
"
extensions
.
formautofill
.
addresses
.
enabled
"
;
const
BUNDLE_URI
=
"
chrome
:
/
/
formautofill
/
locale
/
formautofill
.
properties
"
;
const
MANAGE_ADDRESSES_URL
=
"
chrome
:
/
/
formautofill
/
content
/
manageAddresses
.
xhtml
"
;
const
XUL_NS
=
"
http
:
/
/
www
.
mozilla
.
org
/
keymaster
/
gatekeeper
/
there
.
is
.
only
.
xul
"
;
Cu
.
import
(
"
resource
:
/
/
gre
/
modules
/
Services
.
jsm
"
)
;
Cu
.
import
(
"
resource
:
/
/
gre
/
modules
/
XPCOMUtils
.
jsm
"
)
;
Cu
.
import
(
"
resource
:
/
/
formautofill
/
FormAutofillUtils
.
jsm
"
)
;
this
.
log
=
null
;
FormAutofillUtils
.
defineLazyLogGetter
(
this
this
.
EXPORTED_SYMBOLS
[
0
]
)
;
function
FormAutofillPreferences
(
{
useOldOrganization
}
)
{
this
.
useOldOrganization
=
useOldOrganization
;
this
.
bundle
=
Services
.
strings
.
createBundle
(
BUNDLE_URI
)
;
}
FormAutofillPreferences
.
prototype
=
{
get
isAutofillEnabled
(
)
{
return
Services
.
prefs
.
getBoolPref
(
PREF_AUTOFILL_ENABLED
)
;
}
init
(
document
)
{
this
.
createPreferenceGroup
(
document
)
;
this
.
attachEventListeners
(
)
;
return
this
.
refs
.
formAutofillGroup
;
}
uninit
(
)
{
this
.
detachEventListeners
(
)
;
this
.
refs
.
formAutofillGroup
.
remove
(
)
;
}
createPreferenceGroup
(
document
)
{
let
formAutofillGroup
;
let
addressAutofill
=
document
.
createElementNS
(
XUL_NS
"
hbox
"
)
;
let
addressAutofillCheckbox
=
document
.
createElementNS
(
XUL_NS
"
checkbox
"
)
;
let
spacer
=
document
.
createElementNS
(
XUL_NS
"
spacer
"
)
;
let
savedAddressesBtn
=
document
.
createElementNS
(
XUL_NS
"
button
"
)
;
if
(
this
.
useOldOrganization
)
{
let
caption
=
document
.
createElementNS
(
XUL_NS
"
caption
"
)
;
let
captionLabel
=
document
.
createElementNS
(
XUL_NS
"
label
"
)
;
formAutofillGroup
=
document
.
createElementNS
(
XUL_NS
"
groupbox
"
)
;
formAutofillGroup
.
hidden
=
document
.
location
.
href
!
=
"
about
:
preferences
#
privacy
"
;
formAutofillGroup
.
setAttribute
(
"
data
-
category
"
"
panePrivacy
"
)
;
formAutofillGroup
.
appendChild
(
caption
)
;
caption
.
appendChild
(
captionLabel
)
;
captionLabel
.
textContent
=
this
.
bundle
.
GetStringFromName
(
"
preferenceGroupTitle
"
)
;
}
else
{
formAutofillGroup
=
document
.
createElementNS
(
XUL_NS
"
vbox
"
)
;
savedAddressesBtn
.
className
=
"
accessory
-
button
"
;
}
this
.
refs
=
{
formAutofillGroup
addressAutofillCheckbox
savedAddressesBtn
}
;
formAutofillGroup
.
id
=
"
formAutofillGroup
"
;
addressAutofill
.
id
=
"
addressAutofill
"
;
savedAddressesBtn
.
setAttribute
(
"
label
"
this
.
bundle
.
GetStringFromName
(
"
savedAddresses
"
)
)
;
addressAutofillCheckbox
.
setAttribute
(
"
label
"
this
.
bundle
.
GetStringFromName
(
"
enableAddressAutofill
"
)
)
;
if
(
this
.
isAutofillEnabled
)
{
addressAutofillCheckbox
.
setAttribute
(
"
checked
"
true
)
;
}
spacer
.
flex
=
1
;
formAutofillGroup
.
appendChild
(
addressAutofill
)
;
addressAutofill
.
appendChild
(
addressAutofillCheckbox
)
;
addressAutofill
.
appendChild
(
spacer
)
;
addressAutofill
.
appendChild
(
savedAddressesBtn
)
;
}
handleEvent
(
event
)
{
switch
(
event
.
type
)
{
case
"
command
"
:
{
let
target
=
event
.
target
;
if
(
target
=
=
this
.
refs
.
addressAutofillCheckbox
)
{
Services
.
prefs
.
setBoolPref
(
PREF_AUTOFILL_ENABLED
target
.
checked
)
;
}
else
if
(
target
=
=
this
.
refs
.
savedAddressesBtn
)
{
target
.
ownerGlobal
.
gSubDialog
.
open
(
MANAGE_ADDRESSES_URL
)
;
}
break
;
}
}
}
attachEventListeners
(
)
{
this
.
refs
.
formAutofillGroup
.
addEventListener
(
"
command
"
this
)
;
}
detachEventListeners
(
)
{
this
.
refs
.
formAutofillGroup
.
removeEventListener
(
"
command
"
this
)
;
}
}
;
