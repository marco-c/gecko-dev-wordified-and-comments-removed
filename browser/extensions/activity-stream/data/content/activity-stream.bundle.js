(
function
(
modules
)
{
var
installedModules
=
{
}
;
function
__webpack_require__
(
moduleId
)
{
if
(
installedModules
[
moduleId
]
)
{
return
installedModules
[
moduleId
]
.
exports
;
}
var
module
=
installedModules
[
moduleId
]
=
{
i
:
moduleId
l
:
false
exports
:
{
}
}
;
modules
[
moduleId
]
.
call
(
module
.
exports
module
module
.
exports
__webpack_require__
)
;
module
.
l
=
true
;
return
module
.
exports
;
}
__webpack_require__
.
m
=
modules
;
__webpack_require__
.
c
=
installedModules
;
__webpack_require__
.
d
=
function
(
exports
name
getter
)
{
if
(
!
__webpack_require__
.
o
(
exports
name
)
)
{
Object
.
defineProperty
(
exports
name
{
configurable
:
false
enumerable
:
true
get
:
getter
}
)
;
}
}
;
__webpack_require__
.
n
=
function
(
module
)
{
var
getter
=
module
&
&
module
.
__esModule
?
function
getDefault
(
)
{
return
module
[
'
default
'
]
;
}
:
function
getModuleExports
(
)
{
return
module
;
}
;
__webpack_require__
.
d
(
getter
'
a
'
getter
)
;
return
getter
;
}
;
__webpack_require__
.
o
=
function
(
object
property
)
{
return
Object
.
prototype
.
hasOwnProperty
.
call
(
object
property
)
;
}
;
__webpack_require__
.
p
=
"
"
;
return
__webpack_require__
(
__webpack_require__
.
s
=
10
)
;
}
)
(
[
(
function
(
module
__webpack_exports__
__webpack_require__
)
{
"
use
strict
"
;
__webpack_require__
.
d
(
__webpack_exports__
"
a
"
function
(
)
{
return
actionCreators
;
}
)
;
__webpack_require__
.
d
(
__webpack_exports__
"
c
"
function
(
)
{
return
actionUtils
;
}
)
;
var
MAIN_MESSAGE_TYPE
=
"
ActivityStream
:
Main
"
;
var
CONTENT_MESSAGE_TYPE
=
"
ActivityStream
:
Content
"
;
var
PRELOAD_MESSAGE_TYPE
=
"
ActivityStream
:
PreloadedBrowser
"
;
var
UI_CODE
=
1
;
var
BACKGROUND_PROCESS
=
2
;
const
globalImportContext
=
typeof
Window
=
=
=
"
undefined
"
?
BACKGROUND_PROCESS
:
UI_CODE
;
const
actionTypes
=
{
}
;
__webpack_exports__
[
"
b
"
]
=
actionTypes
;
for
(
const
type
of
[
"
BLOCK_URL
"
"
BOOKMARK_URL
"
"
DELETE_BOOKMARK_BY_ID
"
"
DELETE_HISTORY_URL
"
"
DELETE_HISTORY_URL_CONFIRM
"
"
DIALOG_CANCEL
"
"
DIALOG_OPEN
"
"
DISABLE_ONBOARDING
"
"
INIT
"
"
MIGRATION_CANCEL
"
"
MIGRATION_COMPLETED
"
"
MIGRATION_START
"
"
NEW_TAB_INIT
"
"
NEW_TAB_INITIAL_STATE
"
"
NEW_TAB_LOAD
"
"
NEW_TAB_REHYDRATED
"
"
NEW_TAB_STATE_REQUEST
"
"
NEW_TAB_UNLOAD
"
"
OPEN_LINK
"
"
OPEN_NEW_WINDOW
"
"
OPEN_PRIVATE_WINDOW
"
"
PAGE_PRERENDERED
"
"
PLACES_BOOKMARK_ADDED
"
"
PLACES_BOOKMARK_CHANGED
"
"
PLACES_BOOKMARK_REMOVED
"
"
PLACES_HISTORY_CLEARED
"
"
PLACES_LINKS_DELETED
"
"
PLACES_LINK_BLOCKED
"
"
PREFS_INITIAL_VALUES
"
"
PREF_CHANGED
"
"
RICH_ICON_MISSING
"
"
SAVE_SESSION_PERF_DATA
"
"
SAVE_TO_POCKET
"
"
SCREENSHOT_UPDATED
"
"
SECTION_DEREGISTER
"
"
SECTION_DISABLE
"
"
SECTION_ENABLE
"
"
SECTION_OPTIONS_CHANGED
"
"
SECTION_REGISTER
"
"
SECTION_UPDATE
"
"
SECTION_UPDATE_CARD
"
"
SETTINGS_CLOSE
"
"
SETTINGS_OPEN
"
"
SET_PREF
"
"
SHOW_FIREFOX_ACCOUNTS
"
"
SNIPPETS_BLOCKLIST_UPDATED
"
"
SNIPPETS_DATA
"
"
SNIPPETS_RESET
"
"
SNIPPET_BLOCKED
"
"
SYSTEM_TICK
"
"
TELEMETRY_IMPRESSION_STATS
"
"
TELEMETRY_PERFORMANCE_EVENT
"
"
TELEMETRY_UNDESIRED_EVENT
"
"
TELEMETRY_USER_EVENT
"
"
TOP_SITES_CANCEL_EDIT
"
"
TOP_SITES_EDIT
"
"
TOP_SITES_INSERT
"
"
TOP_SITES_PIN
"
"
TOP_SITES_UNPIN
"
"
TOP_SITES_UPDATED
"
"
UNINIT
"
]
)
{
actionTypes
[
type
]
=
type
;
}
function
_RouteMessage
(
action
options
)
{
const
meta
=
action
.
meta
?
Object
.
assign
(
{
}
action
.
meta
)
:
{
}
;
if
(
!
options
|
|
!
options
.
from
|
|
!
options
.
to
)
{
throw
new
Error
(
"
Routed
Messages
must
have
options
as
the
second
parameter
and
must
at
least
include
a
.
from
and
.
to
property
.
"
)
;
}
[
"
from
"
"
to
"
"
toTarget
"
"
fromTarget
"
"
skipOrigin
"
]
.
forEach
(
o
=
>
{
if
(
typeof
options
[
o
]
!
=
=
"
undefined
"
)
{
meta
[
o
]
=
options
[
o
]
;
}
else
if
(
meta
[
o
]
)
{
delete
meta
[
o
]
;
}
}
)
;
return
Object
.
assign
(
{
}
action
{
meta
}
)
;
}
function
SendToMain
(
action
fromTarget
)
{
return
_RouteMessage
(
action
{
from
:
CONTENT_MESSAGE_TYPE
to
:
MAIN_MESSAGE_TYPE
fromTarget
}
)
;
}
function
BroadcastToContent
(
action
)
{
return
_RouteMessage
(
action
{
from
:
MAIN_MESSAGE_TYPE
to
:
CONTENT_MESSAGE_TYPE
}
)
;
}
function
SendToContent
(
action
target
)
{
if
(
!
target
)
{
throw
new
Error
(
"
You
must
provide
a
target
ID
as
the
second
parameter
of
SendToContent
.
If
you
want
to
send
to
all
content
processes
use
BroadcastToContent
"
)
;
}
return
_RouteMessage
(
action
{
from
:
MAIN_MESSAGE_TYPE
to
:
CONTENT_MESSAGE_TYPE
toTarget
:
target
}
)
;
}
function
SendToPreloaded
(
action
)
{
return
_RouteMessage
(
action
{
from
:
MAIN_MESSAGE_TYPE
to
:
PRELOAD_MESSAGE_TYPE
}
)
;
}
function
UserEvent
(
data
)
{
return
SendToMain
(
{
type
:
actionTypes
.
TELEMETRY_USER_EVENT
data
}
)
;
}
function
UndesiredEvent
(
data
importContext
=
globalImportContext
)
{
const
action
=
{
type
:
actionTypes
.
TELEMETRY_UNDESIRED_EVENT
data
}
;
return
importContext
=
=
=
UI_CODE
?
SendToMain
(
action
)
:
action
;
}
function
PerfEvent
(
data
importContext
=
globalImportContext
)
{
const
action
=
{
type
:
actionTypes
.
TELEMETRY_PERFORMANCE_EVENT
data
}
;
return
importContext
=
=
=
UI_CODE
?
SendToMain
(
action
)
:
action
;
}
function
ImpressionStats
(
data
importContext
=
globalImportContext
)
{
const
action
=
{
type
:
actionTypes
.
TELEMETRY_IMPRESSION_STATS
data
}
;
return
importContext
=
=
=
UI_CODE
?
SendToMain
(
action
)
:
action
;
}
function
SetPref
(
name
value
importContext
=
globalImportContext
)
{
const
action
=
{
type
:
actionTypes
.
SET_PREF
data
:
{
name
value
}
}
;
return
importContext
=
=
=
UI_CODE
?
SendToMain
(
action
)
:
action
;
}
var
actionCreators
=
{
BroadcastToContent
UserEvent
UndesiredEvent
PerfEvent
ImpressionStats
SendToContent
SendToMain
SendToPreloaded
SetPref
}
;
var
actionUtils
=
{
isSendToMain
(
action
)
{
if
(
!
action
.
meta
)
{
return
false
;
}
return
action
.
meta
.
to
=
=
=
MAIN_MESSAGE_TYPE
&
&
action
.
meta
.
from
=
=
=
CONTENT_MESSAGE_TYPE
;
}
isBroadcastToContent
(
action
)
{
if
(
!
action
.
meta
)
{
return
false
;
}
if
(
action
.
meta
.
to
=
=
=
CONTENT_MESSAGE_TYPE
&
&
!
action
.
meta
.
toTarget
)
{
return
true
;
}
return
false
;
}
isSendToContent
(
action
)
{
if
(
!
action
.
meta
)
{
return
false
;
}
if
(
action
.
meta
.
to
=
=
=
CONTENT_MESSAGE_TYPE
&
&
action
.
meta
.
toTarget
)
{
return
true
;
}
return
false
;
}
isSendToPreloaded
(
action
)
{
if
(
!
action
.
meta
)
{
return
false
;
}
return
action
.
meta
.
to
=
=
=
PRELOAD_MESSAGE_TYPE
&
&
action
.
meta
.
from
=
=
=
MAIN_MESSAGE_TYPE
;
}
isFromMain
(
action
)
{
if
(
!
action
.
meta
)
{
return
false
;
}
return
action
.
meta
.
from
=
=
=
MAIN_MESSAGE_TYPE
&
&
action
.
meta
.
to
=
=
=
CONTENT_MESSAGE_TYPE
;
}
getPortIdOfSender
(
action
)
{
return
action
.
meta
&
&
action
.
meta
.
fromTarget
|
|
null
;
}
_RouteMessage
}
;
}
)
(
function
(
module
exports
)
{
module
.
exports
=
React
;
}
)
(
function
(
module
exports
)
{
module
.
exports
=
ReactIntl
;
}
)
(
function
(
module
exports
)
{
module
.
exports
=
ReactRedux
;
}
)
(
function
(
module
exports
)
{
var
g
;
g
=
(
function
(
)
{
return
this
;
}
)
(
)
;
try
{
g
=
g
|
|
Function
(
"
return
this
"
)
(
)
|
|
(
1
eval
)
(
"
this
"
)
;
}
catch
(
e
)
{
if
(
typeof
window
=
=
=
"
object
"
)
g
=
window
;
}
module
.
exports
=
g
;
}
)
(
function
(
module
__webpack_exports__
__webpack_require__
)
{
"
use
strict
"
;
var
Actions
=
__webpack_require__
(
0
)
;
class
Dedupe
{
constructor
(
createKey
)
{
this
.
createKey
=
createKey
|
|
this
.
defaultCreateKey
;
}
defaultCreateKey
(
item
)
{
return
item
;
}
group
(
.
.
.
groups
)
{
const
globalKeys
=
new
Set
(
)
;
const
result
=
[
]
;
for
(
const
values
of
groups
)
{
const
valueMap
=
new
Map
(
)
;
for
(
const
value
of
values
)
{
const
key
=
this
.
createKey
(
value
)
;
if
(
!
globalKeys
.
has
(
key
)
&
&
!
valueMap
.
has
(
key
)
)
{
valueMap
.
set
(
key
value
)
;
}
}
result
.
push
(
valueMap
)
;
valueMap
.
forEach
(
(
value
key
)
=
>
globalKeys
.
add
(
key
)
)
;
}
return
result
.
map
(
m
=
>
Array
.
from
(
m
.
values
(
)
)
)
;
}
}
__webpack_require__
.
d
(
__webpack_exports__
"
c
"
function
(
)
{
return
reducers
;
}
)
;
const
TOP_SITES_DEFAULT_LENGTH
=
6
;
__webpack_exports__
[
"
a
"
]
=
TOP_SITES_DEFAULT_LENGTH
;
const
TOP_SITES_SHOWMORE_LENGTH
=
12
;
__webpack_exports__
[
"
b
"
]
=
TOP_SITES_SHOWMORE_LENGTH
;
const
dedupe
=
new
Dedupe
(
site
=
>
site
&
&
site
.
url
)
;
const
INITIAL_STATE
=
{
App
:
{
initialized
:
false
version
:
null
}
Snippets
:
{
initialized
:
false
}
TopSites
:
{
initialized
:
false
rows
:
[
]
editForm
:
{
visible
:
false
index
:
-
1
}
}
Prefs
:
{
initialized
:
false
values
:
{
}
}
Dialog
:
{
visible
:
false
data
:
{
}
}
Sections
:
[
]
PreferencesPane
:
{
visible
:
false
}
}
;
function
App
(
prevState
=
INITIAL_STATE
.
App
action
)
{
switch
(
action
.
type
)
{
case
Actions
[
"
b
"
]
.
INIT
:
return
Object
.
assign
(
{
}
prevState
action
.
data
|
|
{
}
{
initialized
:
true
}
)
;
default
:
return
prevState
;
}
}
function
insertPinned
(
links
pinned
)
{
const
pinnedUrls
=
pinned
.
map
(
link
=
>
link
&
&
link
.
url
)
;
let
newLinks
=
links
.
filter
(
link
=
>
link
?
!
pinnedUrls
.
includes
(
link
.
url
)
:
false
)
;
newLinks
=
newLinks
.
map
(
link
=
>
{
if
(
link
&
&
link
.
isPinned
)
{
delete
link
.
isPinned
;
delete
link
.
pinIndex
;
}
return
link
;
}
)
;
pinned
.
forEach
(
(
val
index
)
=
>
{
if
(
!
val
)
{
return
;
}
let
link
=
Object
.
assign
(
{
}
val
{
isPinned
:
true
pinIndex
:
index
}
)
;
if
(
index
>
newLinks
.
length
)
{
newLinks
[
index
]
=
link
;
}
else
{
newLinks
.
splice
(
index
0
link
)
;
}
}
)
;
return
newLinks
;
}
function
TopSites
(
prevState
=
INITIAL_STATE
.
TopSites
action
)
{
let
hasMatch
;
let
newRows
;
switch
(
action
.
type
)
{
case
Actions
[
"
b
"
]
.
TOP_SITES_UPDATED
:
if
(
!
action
.
data
)
{
return
prevState
;
}
return
Object
.
assign
(
{
}
prevState
{
initialized
:
true
rows
:
action
.
data
}
)
;
case
Actions
[
"
b
"
]
.
TOP_SITES_EDIT
:
return
Object
.
assign
(
{
}
prevState
{
editForm
:
{
visible
:
true
index
:
action
.
data
.
index
}
}
)
;
case
Actions
[
"
b
"
]
.
TOP_SITES_CANCEL_EDIT
:
return
Object
.
assign
(
{
}
prevState
{
editForm
:
{
visible
:
false
}
}
)
;
case
Actions
[
"
b
"
]
.
SCREENSHOT_UPDATED
:
newRows
=
prevState
.
rows
.
map
(
row
=
>
{
if
(
row
&
&
row
.
url
=
=
=
action
.
data
.
url
)
{
hasMatch
=
true
;
return
Object
.
assign
(
{
}
row
{
screenshot
:
action
.
data
.
screenshot
}
)
;
}
return
row
;
}
)
;
return
hasMatch
?
Object
.
assign
(
{
}
prevState
{
rows
:
newRows
}
)
:
prevState
;
case
Actions
[
"
b
"
]
.
PLACES_BOOKMARK_ADDED
:
if
(
!
action
.
data
)
{
return
prevState
;
}
newRows
=
prevState
.
rows
.
map
(
site
=
>
{
if
(
site
&
&
site
.
url
=
=
=
action
.
data
.
url
)
{
const
{
bookmarkGuid
bookmarkTitle
dateAdded
}
=
action
.
data
;
return
Object
.
assign
(
{
}
site
{
bookmarkGuid
bookmarkTitle
bookmarkDateCreated
:
dateAdded
}
)
;
}
return
site
;
}
)
;
return
Object
.
assign
(
{
}
prevState
{
rows
:
newRows
}
)
;
case
Actions
[
"
b
"
]
.
PLACES_BOOKMARK_REMOVED
:
if
(
!
action
.
data
)
{
return
prevState
;
}
newRows
=
prevState
.
rows
.
map
(
site
=
>
{
if
(
site
&
&
site
.
url
=
=
=
action
.
data
.
url
)
{
const
newSite
=
Object
.
assign
(
{
}
site
)
;
delete
newSite
.
bookmarkGuid
;
delete
newSite
.
bookmarkTitle
;
delete
newSite
.
bookmarkDateCreated
;
return
newSite
;
}
return
site
;
}
)
;
return
Object
.
assign
(
{
}
prevState
{
rows
:
newRows
}
)
;
default
:
return
prevState
;
}
}
function
Dialog
(
prevState
=
INITIAL_STATE
.
Dialog
action
)
{
switch
(
action
.
type
)
{
case
Actions
[
"
b
"
]
.
DIALOG_OPEN
:
return
Object
.
assign
(
{
}
prevState
{
visible
:
true
data
:
action
.
data
}
)
;
case
Actions
[
"
b
"
]
.
DIALOG_CANCEL
:
return
Object
.
assign
(
{
}
prevState
{
visible
:
false
}
)
;
case
Actions
[
"
b
"
]
.
DELETE_HISTORY_URL
:
return
Object
.
assign
(
{
}
INITIAL_STATE
.
Dialog
)
;
default
:
return
prevState
;
}
}
function
Prefs
(
prevState
=
INITIAL_STATE
.
Prefs
action
)
{
let
newValues
;
switch
(
action
.
type
)
{
case
Actions
[
"
b
"
]
.
PREFS_INITIAL_VALUES
:
return
Object
.
assign
(
{
}
prevState
{
initialized
:
true
values
:
action
.
data
}
)
;
case
Actions
[
"
b
"
]
.
PREF_CHANGED
:
newValues
=
Object
.
assign
(
{
}
prevState
.
values
)
;
newValues
[
action
.
data
.
name
]
=
action
.
data
.
value
;
return
Object
.
assign
(
{
}
prevState
{
values
:
newValues
}
)
;
default
:
return
prevState
;
}
}
function
Sections
(
prevState
=
INITIAL_STATE
.
Sections
action
)
{
let
hasMatch
;
let
newState
;
switch
(
action
.
type
)
{
case
Actions
[
"
b
"
]
.
SECTION_DEREGISTER
:
return
prevState
.
filter
(
section
=
>
section
.
id
!
=
=
action
.
data
)
;
case
Actions
[
"
b
"
]
.
SECTION_REGISTER
:
newState
=
prevState
.
map
(
section
=
>
{
if
(
section
&
&
section
.
id
=
=
=
action
.
data
.
id
)
{
hasMatch
=
true
;
return
Object
.
assign
(
{
}
section
action
.
data
)
;
}
return
section
;
}
)
;
if
(
!
hasMatch
)
{
const
initialized
=
!
!
(
action
.
data
.
rows
&
&
action
.
data
.
rows
.
length
>
0
)
;
let
order
;
let
index
;
if
(
prevState
.
length
>
0
)
{
order
=
action
.
data
.
order
!
=
=
undefined
?
action
.
data
.
order
:
prevState
[
0
]
.
order
-
1
;
index
=
newState
.
findIndex
(
section
=
>
section
.
order
>
=
order
)
;
if
(
index
=
=
=
-
1
)
{
index
=
newState
.
length
;
}
}
else
{
order
=
action
.
data
.
order
!
=
=
undefined
?
action
.
data
.
order
:
0
;
index
=
0
;
}
const
section
=
Object
.
assign
(
{
title
:
"
"
rows
:
[
]
order
enabled
:
false
}
action
.
data
{
initialized
}
)
;
newState
.
splice
(
index
0
section
)
;
}
return
newState
;
case
Actions
[
"
b
"
]
.
SECTION_UPDATE
:
newState
=
prevState
.
map
(
section
=
>
{
if
(
section
&
&
section
.
id
=
=
=
action
.
data
.
id
)
{
const
initialized
=
action
.
data
.
rows
?
{
initialized
:
true
}
:
{
}
;
return
Object
.
assign
(
{
}
section
initialized
action
.
data
)
;
}
return
section
;
}
)
;
if
(
!
action
.
data
.
dedupeConfigurations
)
{
return
newState
;
}
action
.
data
.
dedupeConfigurations
.
forEach
(
dedupeConf
=
>
{
newState
=
newState
.
map
(
section
=
>
{
if
(
section
.
id
=
=
=
dedupeConf
.
id
)
{
const
dedupedRows
=
dedupeConf
.
dedupeFrom
.
reduce
(
(
rows
dedupeSectionId
)
=
>
{
const
dedupeSection
=
newState
.
find
(
s
=
>
s
.
id
=
=
=
dedupeSectionId
)
;
const
[
newRows
]
=
dedupe
.
group
(
dedupeSection
.
rows
rows
)
;
return
newRows
;
}
section
.
rows
)
;
return
Object
.
assign
(
{
}
section
{
rows
:
dedupedRows
}
)
;
}
return
section
;
}
)
;
}
)
;
return
newState
;
case
Actions
[
"
b
"
]
.
SECTION_UPDATE_CARD
:
return
prevState
.
map
(
section
=
>
{
if
(
section
&
&
section
.
id
=
=
=
action
.
data
.
id
&
&
section
.
rows
)
{
const
newRows
=
section
.
rows
.
map
(
card
=
>
{
if
(
card
.
url
=
=
=
action
.
data
.
url
)
{
return
Object
.
assign
(
{
}
card
action
.
data
.
options
)
;
}
return
card
;
}
)
;
return
Object
.
assign
(
{
}
section
{
rows
:
newRows
}
)
;
}
return
section
;
}
)
;
case
Actions
[
"
b
"
]
.
PLACES_BOOKMARK_ADDED
:
if
(
!
action
.
data
)
{
return
prevState
;
}
return
prevState
.
map
(
section
=
>
Object
.
assign
(
{
}
section
{
rows
:
section
.
rows
.
map
(
item
=
>
{
if
(
item
.
url
=
=
=
action
.
data
.
url
)
{
const
{
bookmarkGuid
bookmarkTitle
dateAdded
}
=
action
.
data
;
return
Object
.
assign
(
{
}
item
{
bookmarkGuid
bookmarkTitle
bookmarkDateCreated
:
dateAdded
type
:
"
bookmark
"
}
)
;
}
return
item
;
}
)
}
)
)
;
case
Actions
[
"
b
"
]
.
PLACES_BOOKMARK_REMOVED
:
if
(
!
action
.
data
)
{
return
prevState
;
}
return
prevState
.
map
(
section
=
>
Object
.
assign
(
{
}
section
{
rows
:
section
.
rows
.
map
(
item
=
>
{
if
(
item
.
url
=
=
=
action
.
data
.
url
)
{
const
newSite
=
Object
.
assign
(
{
}
item
)
;
delete
newSite
.
bookmarkGuid
;
delete
newSite
.
bookmarkTitle
;
delete
newSite
.
bookmarkDateCreated
;
if
(
!
newSite
.
type
|
|
newSite
.
type
=
=
=
"
bookmark
"
)
{
newSite
.
type
=
"
history
"
;
}
return
newSite
;
}
return
item
;
}
)
}
)
)
;
case
Actions
[
"
b
"
]
.
PLACES_LINKS_DELETED
:
return
prevState
.
map
(
section
=
>
Object
.
assign
(
{
}
section
{
rows
:
section
.
rows
.
filter
(
site
=
>
!
action
.
data
.
includes
(
site
.
url
)
)
}
)
)
;
case
Actions
[
"
b
"
]
.
PLACES_LINK_BLOCKED
:
return
prevState
.
map
(
section
=
>
Object
.
assign
(
{
}
section
{
rows
:
section
.
rows
.
filter
(
site
=
>
site
.
url
!
=
=
action
.
data
.
url
)
}
)
)
;
default
:
return
prevState
;
}
}
function
Snippets
(
prevState
=
INITIAL_STATE
.
Snippets
action
)
{
switch
(
action
.
type
)
{
case
Actions
[
"
b
"
]
.
SNIPPETS_DATA
:
return
Object
.
assign
(
{
}
prevState
{
initialized
:
true
}
action
.
data
)
;
case
Actions
[
"
b
"
]
.
SNIPPETS_RESET
:
return
INITIAL_STATE
.
Snippets
;
default
:
return
prevState
;
}
}
function
PreferencesPane
(
prevState
=
INITIAL_STATE
.
PreferencesPane
action
)
{
switch
(
action
.
type
)
{
case
Actions
[
"
b
"
]
.
SETTINGS_OPEN
:
return
Object
.
assign
(
{
}
prevState
{
visible
:
true
}
)
;
case
Actions
[
"
b
"
]
.
SETTINGS_CLOSE
:
return
Object
.
assign
(
{
}
prevState
{
visible
:
false
}
)
;
default
:
return
prevState
;
}
}
var
reducers
=
{
TopSites
App
Snippets
Prefs
Dialog
Sections
PreferencesPane
}
;
}
)
(
function
(
module
__webpack_exports__
__webpack_require__
)
{
"
use
strict
"
;
var
Actions
=
__webpack_require__
(
0
)
;
var
external__React_
=
__webpack_require__
(
1
)
;
var
external__React__default
=
__webpack_require__
.
n
(
external__React_
)
;
class
ContextMenu_ContextMenu
extends
external__React__default
.
a
.
PureComponent
{
constructor
(
props
)
{
super
(
props
)
;
this
.
hideContext
=
this
.
hideContext
.
bind
(
this
)
;
}
hideContext
(
)
{
this
.
props
.
onUpdate
(
false
)
;
}
componentWillMount
(
)
{
this
.
hideContext
(
)
;
}
componentDidUpdate
(
prevProps
)
{
if
(
this
.
props
.
visible
&
&
!
prevProps
.
visible
)
{
setTimeout
(
(
)
=
>
{
window
.
addEventListener
(
"
click
"
this
.
hideContext
)
;
}
0
)
;
}
if
(
!
this
.
props
.
visible
&
&
prevProps
.
visible
)
{
window
.
removeEventListener
(
"
click
"
this
.
hideContext
)
;
}
}
componentWillUnmount
(
)
{
window
.
removeEventListener
(
"
click
"
this
.
hideContext
)
;
}
render
(
)
{
return
external__React__default
.
a
.
createElement
(
"
span
"
{
hidden
:
!
this
.
props
.
visible
className
:
"
context
-
menu
"
}
external__React__default
.
a
.
createElement
(
"
ul
"
{
role
:
"
menu
"
className
:
"
context
-
menu
-
list
"
}
this
.
props
.
options
.
map
(
(
option
i
)
=
>
option
.
type
=
=
=
"
separator
"
?
external__React__default
.
a
.
createElement
(
"
li
"
{
key
:
i
className
:
"
separator
"
}
)
:
external__React__default
.
a
.
createElement
(
ContextMenu_ContextMenuItem
{
key
:
i
option
:
option
hideContext
:
this
.
hideContext
}
)
)
)
)
;
}
}
class
ContextMenu_ContextMenuItem
extends
external__React__default
.
a
.
PureComponent
{
constructor
(
props
)
{
super
(
props
)
;
this
.
onClick
=
this
.
onClick
.
bind
(
this
)
;
this
.
onKeyDown
=
this
.
onKeyDown
.
bind
(
this
)
;
}
onClick
(
)
{
this
.
props
.
hideContext
(
)
;
this
.
props
.
option
.
onClick
(
)
;
}
onKeyDown
(
event
)
{
const
{
option
}
=
this
.
props
;
switch
(
event
.
key
)
{
case
"
Tab
"
:
if
(
event
.
shiftKey
&
&
option
.
first
|
|
!
event
.
shiftKey
&
&
option
.
last
)
{
this
.
props
.
hideContext
(
)
;
}
break
;
case
"
Enter
"
:
this
.
props
.
hideContext
(
)
;
option
.
onClick
(
)
;
break
;
}
}
render
(
)
{
const
{
option
}
=
this
.
props
;
return
external__React__default
.
a
.
createElement
(
"
li
"
{
role
:
"
menuitem
"
className
:
"
context
-
menu
-
item
"
}
external__React__default
.
a
.
createElement
(
"
a
"
{
onClick
:
this
.
onClick
onKeyDown
:
this
.
onKeyDown
tabIndex
:
"
0
"
}
option
.
icon
&
&
external__React__default
.
a
.
createElement
(
"
span
"
{
className
:
icon
icon
-
spacer
icon
-
{
option
.
icon
}
}
)
option
.
label
)
)
;
}
}
var
external__ReactIntl_
=
__webpack_require__
(
2
)
;
var
external__ReactIntl__default
=
__webpack_require__
.
n
(
external__ReactIntl_
)
;
const
LinkMenuOptions
=
{
Separator
:
(
)
=
>
(
{
type
:
"
separator
"
}
)
RemoveBookmark
:
site
=
>
(
{
id
:
"
menu_action_remove_bookmark
"
icon
:
"
bookmark
-
added
"
action
:
Actions
[
"
a
"
]
.
SendToMain
(
{
type
:
Actions
[
"
b
"
]
.
DELETE_BOOKMARK_BY_ID
data
:
site
.
bookmarkGuid
}
)
userEvent
:
"
BOOKMARK_DELETE
"
}
)
AddBookmark
:
site
=
>
(
{
id
:
"
menu_action_bookmark
"
icon
:
"
bookmark
-
hollow
"
action
:
Actions
[
"
a
"
]
.
SendToMain
(
{
type
:
Actions
[
"
b
"
]
.
BOOKMARK_URL
data
:
{
url
:
site
.
url
title
:
site
.
title
type
:
site
.
type
}
}
)
userEvent
:
"
BOOKMARK_ADD
"
}
)
OpenInNewWindow
:
site
=
>
(
{
id
:
"
menu_action_open_new_window
"
icon
:
"
new
-
window
"
action
:
Actions
[
"
a
"
]
.
SendToMain
(
{
type
:
Actions
[
"
b
"
]
.
OPEN_NEW_WINDOW
data
:
{
url
:
site
.
url
referrer
:
site
.
referrer
}
}
)
userEvent
:
"
OPEN_NEW_WINDOW
"
}
)
OpenInPrivateWindow
:
site
=
>
(
{
id
:
"
menu_action_open_private_window
"
icon
:
"
new
-
window
-
private
"
action
:
Actions
[
"
a
"
]
.
SendToMain
(
{
type
:
Actions
[
"
b
"
]
.
OPEN_PRIVATE_WINDOW
data
:
{
url
:
site
.
url
referrer
:
site
.
referrer
}
}
)
userEvent
:
"
OPEN_PRIVATE_WINDOW
"
}
)
BlockUrl
:
(
site
index
eventSource
)
=
>
(
{
id
:
"
menu_action_dismiss
"
icon
:
"
dismiss
"
action
:
Actions
[
"
a
"
]
.
SendToMain
(
{
type
:
Actions
[
"
b
"
]
.
BLOCK_URL
data
:
site
.
url
}
)
impression
:
Actions
[
"
a
"
]
.
ImpressionStats
(
{
source
:
eventSource
block
:
0
tiles
:
[
{
id
:
site
.
guid
pos
:
index
}
]
}
)
userEvent
:
"
BLOCK
"
}
)
DeleteUrl
:
site
=
>
(
{
id
:
"
menu_action_delete
"
icon
:
"
delete
"
action
:
{
type
:
Actions
[
"
b
"
]
.
DIALOG_OPEN
data
:
{
onConfirm
:
[
Actions
[
"
a
"
]
.
SendToMain
(
{
type
:
Actions
[
"
b
"
]
.
DELETE_HISTORY_URL
data
:
{
url
:
site
.
url
forceBlock
:
site
.
bookmarkGuid
}
}
)
Actions
[
"
a
"
]
.
UserEvent
(
{
event
:
"
DELETE
"
}
)
]
body_string_id
:
[
"
confirm_history_delete_p1
"
"
confirm_history_delete_notice_p2
"
]
confirm_button_string_id
:
"
menu_action_delete
"
cancel_button_string_id
:
"
topsites_form_cancel_button
"
icon
:
"
modal
-
delete
"
}
}
userEvent
:
"
DIALOG_OPEN
"
}
)
PinTopSite
:
(
site
index
)
=
>
(
{
id
:
"
menu_action_pin
"
icon
:
"
pin
"
action
:
Actions
[
"
a
"
]
.
SendToMain
(
{
type
:
Actions
[
"
b
"
]
.
TOP_SITES_PIN
data
:
{
site
:
{
url
:
site
.
url
}
index
}
}
)
userEvent
:
"
PIN
"
}
)
UnpinTopSite
:
site
=
>
(
{
id
:
"
menu_action_unpin
"
icon
:
"
unpin
"
action
:
Actions
[
"
a
"
]
.
SendToMain
(
{
type
:
Actions
[
"
b
"
]
.
TOP_SITES_UNPIN
data
:
{
site
:
{
url
:
site
.
url
}
}
}
)
userEvent
:
"
UNPIN
"
}
)
SaveToPocket
:
(
site
index
eventSource
)
=
>
(
{
id
:
"
menu_action_save_to_pocket
"
icon
:
"
pocket
"
action
:
Actions
[
"
a
"
]
.
SendToMain
(
{
type
:
Actions
[
"
b
"
]
.
SAVE_TO_POCKET
data
:
{
site
:
{
url
:
site
.
url
title
:
site
.
title
}
}
}
)
impression
:
Actions
[
"
a
"
]
.
ImpressionStats
(
{
source
:
eventSource
pocket
:
0
tiles
:
[
{
id
:
site
.
guid
pos
:
index
}
]
}
)
userEvent
:
"
SAVE_TO_POCKET
"
}
)
EditTopSite
:
(
site
index
)
=
>
(
{
id
:
"
edit_topsites_button_text
"
icon
:
"
edit
"
action
:
{
type
:
Actions
[
"
b
"
]
.
TOP_SITES_EDIT
data
:
{
index
}
}
}
)
CheckBookmark
:
site
=
>
site
.
bookmarkGuid
?
LinkMenuOptions
.
RemoveBookmark
(
site
)
:
LinkMenuOptions
.
AddBookmark
(
site
)
CheckPinTopSite
:
(
site
index
)
=
>
site
.
isPinned
?
LinkMenuOptions
.
UnpinTopSite
(
site
)
:
LinkMenuOptions
.
PinTopSite
(
site
index
)
}
;
const
DEFAULT_SITE_MENU_OPTIONS
=
[
"
CheckPinTopSite
"
"
EditTopSite
"
"
Separator
"
"
OpenInNewWindow
"
"
OpenInPrivateWindow
"
"
Separator
"
"
BlockUrl
"
]
;
class
LinkMenu__LinkMenu
extends
external__React__default
.
a
.
PureComponent
{
getOptions
(
)
{
const
{
props
}
=
this
;
const
{
site
index
source
}
=
props
;
const
propOptions
=
!
site
.
isDefault
?
props
.
options
:
DEFAULT_SITE_MENU_OPTIONS
;
const
options
=
propOptions
.
map
(
o
=
>
LinkMenuOptions
[
o
]
(
site
index
source
)
)
.
map
(
option
=
>
{
const
{
action
impression
id
type
userEvent
}
=
option
;
if
(
!
type
&
&
id
)
{
option
.
label
=
props
.
intl
.
formatMessage
(
option
)
;
option
.
onClick
=
(
)
=
>
{
props
.
dispatch
(
action
)
;
if
(
userEvent
)
{
props
.
dispatch
(
Actions
[
"
a
"
]
.
UserEvent
(
{
event
:
userEvent
source
action_position
:
index
}
)
)
;
}
if
(
impression
&
&
props
.
shouldSendImpressionStats
)
{
props
.
dispatch
(
impression
)
;
}
}
;
}
return
option
;
}
)
;
options
[
0
]
.
first
=
true
;
options
[
options
.
length
-
1
]
.
last
=
true
;
return
options
;
}
render
(
)
{
return
external__React__default
.
a
.
createElement
(
ContextMenu_ContextMenu
{
visible
:
this
.
props
.
visible
onUpdate
:
this
.
props
.
onUpdate
options
:
this
.
getOptions
(
)
}
)
;
}
}
const
LinkMenu
=
Object
(
external__ReactIntl_
[
"
injectIntl
"
]
)
(
LinkMenu__LinkMenu
)
;
__webpack_exports__
[
"
a
"
]
=
LinkMenu
;
}
)
(
function
(
module
__webpack_exports__
__webpack_require__
)
{
"
use
strict
"
;
(
function
(
global
)
{
var
__WEBPACK_IMPORTED_MODULE_0_common_Actions_jsm__
=
__webpack_require__
(
0
)
;
var
__WEBPACK_IMPORTED_MODULE_1_react_intl__
=
__webpack_require__
(
2
)
;
var
__WEBPACK_IMPORTED_MODULE_1_react_intl___default
=
__webpack_require__
.
n
(
__WEBPACK_IMPORTED_MODULE_1_react_intl__
)
;
var
__WEBPACK_IMPORTED_MODULE_2_react__
=
__webpack_require__
(
1
)
;
var
__WEBPACK_IMPORTED_MODULE_2_react___default
=
__webpack_require__
.
n
(
__WEBPACK_IMPORTED_MODULE_2_react__
)
;
var
_extends
=
Object
.
assign
|
|
function
(
target
)
{
for
(
var
i
=
1
;
i
<
arguments
.
length
;
i
+
+
)
{
var
source
=
arguments
[
i
]
;
for
(
var
key
in
source
)
{
if
(
Object
.
prototype
.
hasOwnProperty
.
call
(
source
key
)
)
{
target
[
key
]
=
source
[
key
]
;
}
}
}
return
target
;
}
;
const
VISIBLE
=
"
visible
"
;
const
VISIBILITY_CHANGE_EVENT
=
"
visibilitychange
"
;
function
getFormattedMessage
(
message
)
{
return
typeof
message
=
=
=
"
string
"
?
__WEBPACK_IMPORTED_MODULE_2_react___default
.
a
.
createElement
(
"
span
"
null
message
)
:
__WEBPACK_IMPORTED_MODULE_2_react___default
.
a
.
createElement
(
__WEBPACK_IMPORTED_MODULE_1_react_intl__
[
"
FormattedMessage
"
]
message
)
;
}
function
getCollapsed
(
props
)
{
return
props
.
prefName
in
props
.
Prefs
.
values
?
props
.
Prefs
.
values
[
props
.
prefName
]
:
false
;
}
class
Info
extends
__WEBPACK_IMPORTED_MODULE_2_react___default
.
a
.
PureComponent
{
constructor
(
props
)
{
super
(
props
)
;
this
.
onInfoEnter
=
this
.
onInfoEnter
.
bind
(
this
)
;
this
.
onInfoLeave
=
this
.
onInfoLeave
.
bind
(
this
)
;
this
.
onManageClick
=
this
.
onManageClick
.
bind
(
this
)
;
this
.
state
=
{
infoActive
:
false
}
;
}
_setInfoState
(
nextActive
)
{
const
infoActive
=
!
!
nextActive
;
if
(
infoActive
!
=
=
this
.
state
.
infoActive
)
{
this
.
setState
(
{
infoActive
}
)
;
}
}
onInfoEnter
(
)
{
this
.
_setInfoState
(
true
)
;
}
onInfoLeave
(
event
)
{
this
.
_setInfoState
(
event
&
&
event
.
relatedTarget
&
&
(
event
.
relatedTarget
=
=
=
event
.
currentTarget
|
|
event
.
relatedTarget
.
compareDocumentPosition
(
event
.
currentTarget
)
&
Node
.
DOCUMENT_POSITION_CONTAINS
)
)
;
}
onManageClick
(
)
{
this
.
props
.
dispatch
(
{
type
:
__WEBPACK_IMPORTED_MODULE_0_common_Actions_jsm__
[
"
b
"
]
.
SETTINGS_OPEN
}
)
;
this
.
props
.
dispatch
(
__WEBPACK_IMPORTED_MODULE_0_common_Actions_jsm__
[
"
a
"
]
.
UserEvent
(
{
event
:
"
OPEN_NEWTAB_PREFS
"
}
)
)
;
}
render
(
)
{
const
{
infoOption
intl
}
=
this
.
props
;
const
infoOptionIconA11yAttrs
=
{
"
aria
-
haspopup
"
:
"
true
"
"
aria
-
controls
"
:
"
info
-
option
"
"
aria
-
expanded
"
:
this
.
state
.
infoActive
?
"
true
"
:
"
false
"
"
role
"
:
"
note
"
"
tabIndex
"
:
0
}
;
const
sectionInfoTitle
=
intl
.
formatMessage
(
{
id
:
"
section_info_option
"
}
)
;
return
__WEBPACK_IMPORTED_MODULE_2_react___default
.
a
.
createElement
(
"
span
"
{
className
:
"
section
-
info
-
option
"
onBlur
:
this
.
onInfoLeave
onFocus
:
this
.
onInfoEnter
onMouseOut
:
this
.
onInfoLeave
onMouseOver
:
this
.
onInfoEnter
}
__WEBPACK_IMPORTED_MODULE_2_react___default
.
a
.
createElement
(
"
img
"
_extends
(
{
className
:
"
info
-
option
-
icon
"
title
:
sectionInfoTitle
}
infoOptionIconA11yAttrs
)
)
__WEBPACK_IMPORTED_MODULE_2_react___default
.
a
.
createElement
(
"
div
"
{
className
:
"
info
-
option
"
}
infoOption
.
header
&
&
__WEBPACK_IMPORTED_MODULE_2_react___default
.
a
.
createElement
(
"
div
"
{
className
:
"
info
-
option
-
header
"
role
:
"
heading
"
}
getFormattedMessage
(
infoOption
.
header
)
)
__WEBPACK_IMPORTED_MODULE_2_react___default
.
a
.
createElement
(
"
p
"
{
className
:
"
info
-
option
-
body
"
}
infoOption
.
body
&
&
getFormattedMessage
(
infoOption
.
body
)
infoOption
.
link
&
&
__WEBPACK_IMPORTED_MODULE_2_react___default
.
a
.
createElement
(
"
a
"
{
href
:
infoOption
.
link
.
href
target
:
"
_blank
"
rel
:
"
noopener
noreferrer
"
className
:
"
info
-
option
-
link
"
}
getFormattedMessage
(
infoOption
.
link
.
title
|
|
infoOption
.
link
)
)
)
__WEBPACK_IMPORTED_MODULE_2_react___default
.
a
.
createElement
(
"
div
"
{
className
:
"
info
-
option
-
manage
"
}
__WEBPACK_IMPORTED_MODULE_2_react___default
.
a
.
createElement
(
"
button
"
{
onClick
:
this
.
onManageClick
}
__WEBPACK_IMPORTED_MODULE_2_react___default
.
a
.
createElement
(
__WEBPACK_IMPORTED_MODULE_1_react_intl__
[
"
FormattedMessage
"
]
{
id
:
"
settings_pane_header
"
}
)
)
)
)
)
;
}
}
const
InfoIntl
=
Object
(
__WEBPACK_IMPORTED_MODULE_1_react_intl__
[
"
injectIntl
"
]
)
(
Info
)
;
class
Disclaimer
extends
__WEBPACK_IMPORTED_MODULE_2_react___default
.
a
.
PureComponent
{
constructor
(
props
)
{
super
(
props
)
;
this
.
onAcknowledge
=
this
.
onAcknowledge
.
bind
(
this
)
;
}
onAcknowledge
(
)
{
this
.
props
.
dispatch
(
__WEBPACK_IMPORTED_MODULE_0_common_Actions_jsm__
[
"
a
"
]
.
SetPref
(
this
.
props
.
disclaimerPref
false
)
)
;
this
.
props
.
dispatch
(
__WEBPACK_IMPORTED_MODULE_0_common_Actions_jsm__
[
"
a
"
]
.
UserEvent
(
{
event
:
"
SECTION_DISCLAIMER_ACKNOWLEDGED
"
source
:
this
.
props
.
eventSource
}
)
)
;
}
render
(
)
{
const
{
disclaimer
}
=
this
.
props
;
return
__WEBPACK_IMPORTED_MODULE_2_react___default
.
a
.
createElement
(
"
div
"
{
className
:
"
section
-
disclaimer
"
}
__WEBPACK_IMPORTED_MODULE_2_react___default
.
a
.
createElement
(
"
div
"
{
className
:
"
section
-
disclaimer
-
text
"
}
getFormattedMessage
(
disclaimer
.
text
)
disclaimer
.
link
&
&
__WEBPACK_IMPORTED_MODULE_2_react___default
.
a
.
createElement
(
"
a
"
{
href
:
disclaimer
.
link
.
href
target
:
"
_blank
"
rel
:
"
noopener
noreferrer
"
}
getFormattedMessage
(
disclaimer
.
link
.
title
|
|
disclaimer
.
link
)
)
)
__WEBPACK_IMPORTED_MODULE_2_react___default
.
a
.
createElement
(
"
button
"
{
onClick
:
this
.
onAcknowledge
}
getFormattedMessage
(
disclaimer
.
button
)
)
)
;
}
}
const
DisclaimerIntl
=
Object
(
__WEBPACK_IMPORTED_MODULE_1_react_intl__
[
"
injectIntl
"
]
)
(
Disclaimer
)
;
class
_CollapsibleSection
extends
__WEBPACK_IMPORTED_MODULE_2_react___default
.
a
.
PureComponent
{
constructor
(
props
)
{
super
(
props
)
;
this
.
onBodyMount
=
this
.
onBodyMount
.
bind
(
this
)
;
this
.
onInfoEnter
=
this
.
onInfoEnter
.
bind
(
this
)
;
this
.
onInfoLeave
=
this
.
onInfoLeave
.
bind
(
this
)
;
this
.
onHeaderClick
=
this
.
onHeaderClick
.
bind
(
this
)
;
this
.
onTransitionEnd
=
this
.
onTransitionEnd
.
bind
(
this
)
;
this
.
enableOrDisableAnimation
=
this
.
enableOrDisableAnimation
.
bind
(
this
)
;
this
.
state
=
{
enableAnimation
:
true
isAnimating
:
false
infoActive
:
false
}
;
}
componentWillMount
(
)
{
this
.
props
.
document
.
addEventListener
(
VISIBILITY_CHANGE_EVENT
this
.
enableOrDisableAnimation
)
;
}
componentWillUpdate
(
nextProps
)
{
if
(
!
getCollapsed
(
this
.
props
)
&
&
getCollapsed
(
nextProps
)
)
{
this
.
sectionBody
.
scrollHeight
;
}
}
componentWillUnmount
(
)
{
this
.
props
.
document
.
removeEventListener
(
VISIBILITY_CHANGE_EVENT
this
.
enableOrDisableAnimation
)
;
}
enableOrDisableAnimation
(
)
{
const
visible
=
this
.
props
.
document
.
visibilityState
=
=
=
VISIBLE
;
if
(
this
.
state
.
enableAnimation
!
=
=
visible
)
{
this
.
setState
(
{
enableAnimation
:
visible
}
)
;
}
}
_setInfoState
(
nextActive
)
{
const
infoActive
=
!
!
nextActive
;
if
(
infoActive
!
=
=
this
.
state
.
infoActive
)
{
this
.
setState
(
{
infoActive
}
)
;
}
}
onBodyMount
(
node
)
{
this
.
sectionBody
=
node
;
}
onInfoEnter
(
)
{
this
.
_setInfoState
(
true
)
;
}
onInfoLeave
(
event
)
{
this
.
_setInfoState
(
event
&
&
event
.
relatedTarget
&
&
(
event
.
relatedTarget
=
=
=
event
.
currentTarget
|
|
event
.
relatedTarget
.
compareDocumentPosition
(
event
.
currentTarget
)
&
Node
.
DOCUMENT_POSITION_CONTAINS
)
)
;
}
onHeaderClick
(
)
{
this
.
setState
(
{
isAnimating
:
true
maxHeight
:
{
this
.
sectionBody
.
scrollHeight
}
px
}
)
;
this
.
props
.
dispatch
(
__WEBPACK_IMPORTED_MODULE_0_common_Actions_jsm__
[
"
a
"
]
.
SetPref
(
this
.
props
.
prefName
!
getCollapsed
(
this
.
props
)
)
)
;
}
onTransitionEnd
(
event
)
{
if
(
event
.
target
=
=
=
event
.
currentTarget
)
{
this
.
setState
(
{
isAnimating
:
false
}
)
;
}
}
renderIcon
(
)
{
const
{
icon
}
=
this
.
props
;
if
(
icon
&
&
icon
.
startsWith
(
"
moz
-
extension
:
/
/
"
)
)
{
return
__WEBPACK_IMPORTED_MODULE_2_react___default
.
a
.
createElement
(
"
span
"
{
className
:
"
icon
icon
-
small
-
spacer
"
style
:
{
backgroundImage
:
url
(
'
{
icon
}
'
)
}
}
)
;
}
return
__WEBPACK_IMPORTED_MODULE_2_react___default
.
a
.
createElement
(
"
span
"
{
className
:
icon
icon
-
small
-
spacer
icon
-
{
icon
|
|
"
webextension
"
}
}
)
;
}
render
(
)
{
const
isCollapsible
=
this
.
props
.
prefName
in
this
.
props
.
Prefs
.
values
;
const
isCollapsed
=
getCollapsed
(
this
.
props
)
;
const
{
enableAnimation
isAnimating
maxHeight
}
=
this
.
state
;
const
{
id
infoOption
eventSource
disclaimer
}
=
this
.
props
;
const
disclaimerPref
=
section
.
{
id
}
.
showDisclaimer
;
const
needsDisclaimer
=
disclaimer
&
&
this
.
props
.
Prefs
.
values
[
disclaimerPref
]
;
return
__WEBPACK_IMPORTED_MODULE_2_react___default
.
a
.
createElement
(
"
section
"
{
className
:
collapsible
-
section
{
this
.
props
.
className
}
{
enableAnimation
?
"
animation
-
enabled
"
:
"
"
}
{
isCollapsed
?
"
collapsed
"
:
"
"
}
}
__WEBPACK_IMPORTED_MODULE_2_react___default
.
a
.
createElement
(
"
div
"
{
className
:
"
section
-
top
-
bar
"
}
__WEBPACK_IMPORTED_MODULE_2_react___default
.
a
.
createElement
(
"
h3
"
{
className
:
"
section
-
title
"
}
__WEBPACK_IMPORTED_MODULE_2_react___default
.
a
.
createElement
(
"
span
"
{
className
:
"
click
-
target
"
onClick
:
isCollapsible
&
&
this
.
onHeaderClick
}
this
.
renderIcon
(
)
this
.
props
.
title
isCollapsible
&
&
__WEBPACK_IMPORTED_MODULE_2_react___default
.
a
.
createElement
(
"
span
"
{
className
:
collapsible
-
arrow
icon
{
isCollapsed
?
"
icon
-
arrowhead
-
forward
"
:
"
icon
-
arrowhead
-
down
"
}
}
)
)
)
infoOption
&
&
__WEBPACK_IMPORTED_MODULE_2_react___default
.
a
.
createElement
(
InfoIntl
{
infoOption
:
infoOption
dispatch
:
this
.
props
.
dispatch
}
)
)
__WEBPACK_IMPORTED_MODULE_2_react___default
.
a
.
createElement
(
"
div
"
{
className
:
section
-
body
{
isAnimating
?
"
animating
"
:
"
"
}
onTransitionEnd
:
this
.
onTransitionEnd
ref
:
this
.
onBodyMount
style
:
isAnimating
&
&
!
isCollapsed
?
{
maxHeight
}
:
null
}
needsDisclaimer
&
&
__WEBPACK_IMPORTED_MODULE_2_react___default
.
a
.
createElement
(
DisclaimerIntl
{
disclaimerPref
:
disclaimerPref
disclaimer
:
disclaimer
eventSource
:
eventSource
dispatch
:
this
.
props
.
dispatch
}
)
this
.
props
.
children
)
)
;
}
}
_CollapsibleSection
.
defaultProps
=
{
document
:
global
.
document
|
|
{
addEventListener
:
(
)
=
>
{
}
removeEventListener
:
(
)
=
>
{
}
visibilityState
:
"
hidden
"
}
Prefs
:
{
values
:
{
}
}
}
;
const
CollapsibleSection
=
Object
(
__WEBPACK_IMPORTED_MODULE_1_react_intl__
[
"
injectIntl
"
]
)
(
_CollapsibleSection
)
;
__webpack_exports__
[
"
a
"
]
=
CollapsibleSection
;
}
.
call
(
__webpack_exports__
__webpack_require__
(
4
)
)
)
}
)
(
function
(
module
__webpack_exports__
__webpack_require__
)
{
"
use
strict
"
;
var
__WEBPACK_IMPORTED_MODULE_0_common_Actions_jsm__
=
__webpack_require__
(
0
)
;
var
__WEBPACK_IMPORTED_MODULE_1_common_PerfService_jsm__
=
__webpack_require__
(
9
)
;
var
__WEBPACK_IMPORTED_MODULE_2_react__
=
__webpack_require__
(
1
)
;
var
__WEBPACK_IMPORTED_MODULE_2_react___default
=
__webpack_require__
.
n
(
__WEBPACK_IMPORTED_MODULE_2_react__
)
;
const
RECORDED_SECTIONS
=
[
"
highlights
"
"
topsites
"
]
;
class
ComponentPerfTimer
extends
__WEBPACK_IMPORTED_MODULE_2_react___default
.
a
.
Component
{
constructor
(
props
)
{
super
(
props
)
;
this
.
perfSvc
=
this
.
props
.
perfSvc
|
|
__WEBPACK_IMPORTED_MODULE_1_common_PerfService_jsm__
[
"
a
"
]
;
this
.
_sendBadStateEvent
=
this
.
_sendBadStateEvent
.
bind
(
this
)
;
this
.
_sendPaintedEvent
=
this
.
_sendPaintedEvent
.
bind
(
this
)
;
this
.
_reportMissingData
=
false
;
this
.
_timestampHandled
=
false
;
this
.
_recordedFirstRender
=
false
;
}
componentDidMount
(
)
{
if
(
!
RECORDED_SECTIONS
.
includes
(
this
.
props
.
id
)
)
{
return
;
}
this
.
_maybeSendPaintedEvent
(
)
;
}
componentDidUpdate
(
)
{
if
(
!
RECORDED_SECTIONS
.
includes
(
this
.
props
.
id
)
)
{
return
;
}
this
.
_maybeSendPaintedEvent
(
)
;
}
_afterFramePaint
(
callback
)
{
requestAnimationFrame
(
(
)
=
>
setTimeout
(
callback
0
)
)
;
}
_maybeSendBadStateEvent
(
)
{
if
(
!
this
.
props
.
initialized
)
{
this
.
_reportMissingData
=
true
;
}
else
if
(
this
.
_reportMissingData
)
{
this
.
_reportMissingData
=
false
;
this
.
_sendBadStateEvent
(
)
;
}
}
_maybeSendPaintedEvent
(
)
{
if
(
this
.
_timestampHandled
|
|
!
this
.
props
.
initialized
)
{
return
;
}
this
.
_timestampHandled
=
true
;
this
.
_afterFramePaint
(
this
.
_sendPaintedEvent
)
;
}
_ensureFirstRenderTsRecorded
(
)
{
if
(
!
this
.
_recordedFirstRender
)
{
this
.
_recordedFirstRender
=
true
;
const
key
=
{
this
.
props
.
id
}
_first_render_ts
;
this
.
perfSvc
.
mark
(
key
)
;
}
}
_sendBadStateEvent
(
)
{
const
dataReadyKey
=
{
this
.
props
.
id
}
_data_ready_ts
;
this
.
perfSvc
.
mark
(
dataReadyKey
)
;
try
{
const
firstRenderKey
=
{
this
.
props
.
id
}
_first_render_ts
;
const
value
=
parseInt
(
this
.
perfSvc
.
getMostRecentAbsMarkStartByName
(
dataReadyKey
)
-
this
.
perfSvc
.
getMostRecentAbsMarkStartByName
(
firstRenderKey
)
10
)
;
this
.
props
.
dispatch
(
__WEBPACK_IMPORTED_MODULE_0_common_Actions_jsm__
[
"
a
"
]
.
SendToMain
(
{
type
:
__WEBPACK_IMPORTED_MODULE_0_common_Actions_jsm__
[
"
b
"
]
.
SAVE_SESSION_PERF_DATA
data
:
{
[
{
this
.
props
.
id
}
_data_late_by_ms
]
:
value
}
}
)
)
;
}
catch
(
ex
)
{
}
}
_sendPaintedEvent
(
)
{
if
(
this
.
props
.
id
!
=
=
"
topsites
"
)
{
return
;
}
const
key
=
{
this
.
props
.
id
}
_first_painted_ts
;
this
.
perfSvc
.
mark
(
key
)
;
try
{
const
data
=
{
}
;
data
[
key
]
=
this
.
perfSvc
.
getMostRecentAbsMarkStartByName
(
key
)
;
this
.
props
.
dispatch
(
__WEBPACK_IMPORTED_MODULE_0_common_Actions_jsm__
[
"
a
"
]
.
SendToMain
(
{
type
:
__WEBPACK_IMPORTED_MODULE_0_common_Actions_jsm__
[
"
b
"
]
.
SAVE_SESSION_PERF_DATA
data
}
)
)
;
}
catch
(
ex
)
{
}
}
render
(
)
{
if
(
RECORDED_SECTIONS
.
includes
(
this
.
props
.
id
)
)
{
this
.
_ensureFirstRenderTsRecorded
(
)
;
this
.
_maybeSendBadStateEvent
(
)
;
}
return
this
.
props
.
children
;
}
}
__webpack_exports__
[
"
a
"
]
=
ComponentPerfTimer
;
}
)
(
function
(
module
__webpack_exports__
__webpack_require__
)
{
"
use
strict
"
;
__webpack_require__
.
d
(
__webpack_exports__
"
a
"
function
(
)
{
return
perfService
;
}
)
;
if
(
typeof
Window
=
=
=
"
undefined
"
&
&
typeof
Components
!
=
=
"
undefined
"
&
&
Components
.
utils
)
{
Components
.
utils
.
import
(
"
resource
:
/
/
gre
/
modules
/
Services
.
jsm
"
)
;
}
let
usablePerfObj
;
if
(
typeof
Services
!
=
=
"
undefined
"
)
{
usablePerfObj
=
Services
.
appShell
.
hiddenDOMWindow
.
performance
;
}
else
if
(
typeof
performance
!
=
=
"
undefined
"
)
{
usablePerfObj
=
performance
;
}
else
{
usablePerfObj
=
{
now
(
)
{
}
mark
(
)
{
}
}
;
}
function
_PerfService
(
options
)
{
if
(
options
&
&
options
.
performanceObj
)
{
this
.
_perf
=
options
.
performanceObj
;
}
else
{
this
.
_perf
=
usablePerfObj
;
}
}
_PerfService
.
prototype
=
{
mark
:
function
mark
(
str
)
{
this
.
_perf
.
mark
(
str
)
;
}
getEntriesByName
:
function
getEntriesByName
(
name
type
)
{
return
this
.
_perf
.
getEntriesByName
(
name
type
)
;
}
get
timeOrigin
(
)
{
return
this
.
_perf
.
timeOrigin
;
}
absNow
:
function
absNow
(
)
{
return
this
.
timeOrigin
+
this
.
_perf
.
now
(
)
;
}
getMostRecentAbsMarkStartByName
(
name
)
{
let
entries
=
this
.
getEntriesByName
(
name
"
mark
"
)
;
if
(
!
entries
.
length
)
{
throw
new
Error
(
No
marks
with
the
name
{
name
}
)
;
}
let
mostRecentEntry
=
entries
[
entries
.
length
-
1
]
;
return
this
.
_perf
.
timeOrigin
+
mostRecentEntry
.
startTime
;
}
}
;
var
perfService
=
new
_PerfService
(
)
;
}
)
(
function
(
module
__webpack_exports__
__webpack_require__
)
{
"
use
strict
"
;
Object
.
defineProperty
(
__webpack_exports__
"
__esModule
"
{
value
:
true
}
)
;
(
function
(
global
)
{
var
__WEBPACK_IMPORTED_MODULE_0_common_Actions_jsm__
=
__webpack_require__
(
0
)
;
var
__WEBPACK_IMPORTED_MODULE_1_content_src_lib_snippets__
=
__webpack_require__
(
11
)
;
var
__WEBPACK_IMPORTED_MODULE_2_content_src_components_Base_Base__
=
__webpack_require__
(
12
)
;
var
__WEBPACK_IMPORTED_MODULE_3_content_src_lib_detect_user_session_start__
=
__webpack_require__
(
17
)
;
var
__WEBPACK_IMPORTED_MODULE_4_content_src_lib_init_store__
=
__webpack_require__
(
18
)
;
var
__WEBPACK_IMPORTED_MODULE_5_react_redux__
=
__webpack_require__
(
3
)
;
var
__WEBPACK_IMPORTED_MODULE_5_react_redux___default
=
__webpack_require__
.
n
(
__WEBPACK_IMPORTED_MODULE_5_react_redux__
)
;
var
__WEBPACK_IMPORTED_MODULE_6_react__
=
__webpack_require__
(
1
)
;
var
__WEBPACK_IMPORTED_MODULE_6_react___default
=
__webpack_require__
.
n
(
__WEBPACK_IMPORTED_MODULE_6_react__
)
;
var
__WEBPACK_IMPORTED_MODULE_7_react_dom__
=
__webpack_require__
(
20
)
;
var
__WEBPACK_IMPORTED_MODULE_7_react_dom___default
=
__webpack_require__
.
n
(
__WEBPACK_IMPORTED_MODULE_7_react_dom__
)
;
var
__WEBPACK_IMPORTED_MODULE_8_common_Reducers_jsm__
=
__webpack_require__
(
5
)
;
const
store
=
Object
(
__WEBPACK_IMPORTED_MODULE_4_content_src_lib_init_store__
[
"
a
"
]
)
(
__WEBPACK_IMPORTED_MODULE_8_common_Reducers_jsm__
[
"
c
"
]
global
.
gActivityStreamPrerenderedState
)
;
new
__WEBPACK_IMPORTED_MODULE_3_content_src_lib_detect_user_session_start__
[
"
a
"
]
(
store
)
.
sendEventOrAddListener
(
)
;
if
(
!
global
.
gActivityStreamPrerenderedState
)
{
store
.
dispatch
(
__WEBPACK_IMPORTED_MODULE_0_common_Actions_jsm__
[
"
a
"
]
.
SendToMain
(
{
type
:
__WEBPACK_IMPORTED_MODULE_0_common_Actions_jsm__
[
"
b
"
]
.
NEW_TAB_STATE_REQUEST
}
)
)
;
}
__WEBPACK_IMPORTED_MODULE_7_react_dom___default
.
a
.
render
(
__WEBPACK_IMPORTED_MODULE_6_react___default
.
a
.
createElement
(
__WEBPACK_IMPORTED_MODULE_5_react_redux__
[
"
Provider
"
]
{
store
:
store
}
__WEBPACK_IMPORTED_MODULE_6_react___default
.
a
.
createElement
(
__WEBPACK_IMPORTED_MODULE_2_content_src_components_Base_Base__
[
"
a
"
]
{
isPrerendered
:
!
!
global
.
gActivityStreamPrerenderedState
locale
:
global
.
document
.
documentElement
.
lang
strings
:
global
.
gActivityStreamStrings
}
)
)
document
.
getElementById
(
"
root
"
)
)
;
Object
(
__WEBPACK_IMPORTED_MODULE_1_content_src_lib_snippets__
[
"
a
"
]
)
(
store
)
;
}
.
call
(
__webpack_exports__
__webpack_require__
(
4
)
)
)
}
)
(
function
(
module
__webpack_exports__
__webpack_require__
)
{
"
use
strict
"
;
(
function
(
global
)
{
__webpack_exports__
[
"
a
"
]
=
addSnippetsSubscriber
;
var
__WEBPACK_IMPORTED_MODULE_0_common_Actions_jsm__
=
__webpack_require__
(
0
)
;
const
DATABASE_NAME
=
"
snippets_db
"
;
const
DATABASE_VERSION
=
1
;
const
SNIPPETS_OBJECTSTORE_NAME
=
"
snippets
"
;
const
SNIPPETS_UPDATE_INTERVAL_MS
=
14400000
;
const
SNIPPETS_ENABLED_EVENT
=
"
Snippets
:
Enabled
"
;
const
SNIPPETS_DISABLED_EVENT
=
"
Snippets
:
Disabled
"
;
class
SnippetsMap
extends
Map
{
constructor
(
dispatch
)
{
super
(
)
;
this
.
_db
=
null
;
this
.
_dispatch
=
dispatch
;
}
set
(
key
value
)
{
super
.
set
(
key
value
)
;
return
this
.
_dbTransaction
(
db
=
>
db
.
put
(
value
key
)
)
;
}
delete
(
key
)
{
super
.
delete
(
key
)
;
return
this
.
_dbTransaction
(
db
=
>
db
.
delete
(
key
)
)
;
}
clear
(
)
{
super
.
clear
(
)
;
return
this
.
_dbTransaction
(
db
=
>
db
.
clear
(
)
)
;
}
get
blockList
(
)
{
return
this
.
get
(
"
blockList
"
)
|
|
[
]
;
}
async
blockSnippetById
(
id
)
{
if
(
!
id
)
{
return
;
}
const
{
blockList
}
=
this
;
if
(
!
blockList
.
includes
(
id
)
)
{
blockList
.
push
(
id
)
;
this
.
_dispatch
(
__WEBPACK_IMPORTED_MODULE_0_common_Actions_jsm__
[
"
a
"
]
.
SendToMain
(
{
type
:
__WEBPACK_IMPORTED_MODULE_0_common_Actions_jsm__
[
"
b
"
]
.
SNIPPETS_BLOCKLIST_UPDATED
data
:
blockList
}
)
)
;
await
this
.
set
(
"
blockList
"
blockList
)
;
}
}
disableOnboarding
(
)
{
this
.
_dispatch
(
__WEBPACK_IMPORTED_MODULE_0_common_Actions_jsm__
[
"
a
"
]
.
SendToMain
(
{
type
:
__WEBPACK_IMPORTED_MODULE_0_common_Actions_jsm__
[
"
b
"
]
.
DISABLE_ONBOARDING
}
)
)
;
}
showFirefoxAccounts
(
)
{
this
.
_dispatch
(
__WEBPACK_IMPORTED_MODULE_0_common_Actions_jsm__
[
"
a
"
]
.
SendToMain
(
{
type
:
__WEBPACK_IMPORTED_MODULE_0_common_Actions_jsm__
[
"
b
"
]
.
SHOW_FIREFOX_ACCOUNTS
}
)
)
;
}
async
connect
(
)
{
const
db
=
await
this
.
_openDB
(
)
;
await
this
.
_restoreFromDb
(
db
)
;
this
.
_db
=
db
;
}
_dbTransaction
(
modifier
)
{
if
(
!
this
.
_db
)
{
return
Promise
.
resolve
(
)
;
}
return
new
Promise
(
(
resolve
reject
)
=
>
{
const
transaction
=
modifier
(
this
.
_db
.
transaction
(
SNIPPETS_OBJECTSTORE_NAME
"
readwrite
"
)
.
objectStore
(
SNIPPETS_OBJECTSTORE_NAME
)
)
;
transaction
.
onsuccess
=
event
=
>
resolve
(
)
;
transaction
.
onerror
=
event
=
>
reject
(
transaction
.
error
)
;
}
)
;
}
_openDB
(
)
{
return
new
Promise
(
(
resolve
reject
)
=
>
{
const
openRequest
=
indexedDB
.
open
(
DATABASE_NAME
DATABASE_VERSION
)
;
openRequest
.
onerror
=
event
=
>
{
indexedDB
.
deleteDatabase
(
DATABASE_NAME
)
;
reject
(
event
)
;
}
;
openRequest
.
onupgradeneeded
=
event
=
>
{
const
db
=
event
.
target
.
result
;
if
(
!
db
.
objectStoreNames
.
contains
(
SNIPPETS_OBJECTSTORE_NAME
)
)
{
db
.
createObjectStore
(
SNIPPETS_OBJECTSTORE_NAME
)
;
}
}
;
openRequest
.
onsuccess
=
event
=
>
{
let
db
=
event
.
target
.
result
;
db
.
onerror
=
err
=
>
console
.
error
(
err
)
;
db
.
onversionchange
=
versionChangeEvent
=
>
versionChangeEvent
.
target
.
close
(
)
;
resolve
(
db
)
;
}
;
}
)
;
}
_restoreFromDb
(
db
)
{
return
new
Promise
(
(
resolve
reject
)
=
>
{
let
cursorRequest
;
try
{
cursorRequest
=
db
.
transaction
(
SNIPPETS_OBJECTSTORE_NAME
)
.
objectStore
(
SNIPPETS_OBJECTSTORE_NAME
)
.
openCursor
(
)
;
}
catch
(
err
)
{
reject
(
err
)
;
return
;
}
cursorRequest
.
onerror
=
event
=
>
reject
(
event
)
;
cursorRequest
.
onsuccess
=
event
=
>
{
let
cursor
=
event
.
target
.
result
;
if
(
cursor
)
{
this
.
set
(
cursor
.
key
cursor
.
value
)
;
cursor
.
continue
(
)
;
}
else
{
resolve
(
)
;
}
}
;
}
)
;
}
}
class
SnippetsProvider
{
constructor
(
dispatch
)
{
global
.
gSnippetsMap
=
new
SnippetsMap
(
dispatch
)
;
this
.
_onAction
=
this
.
_onAction
.
bind
(
this
)
;
}
get
snippetsMap
(
)
{
return
global
.
gSnippetsMap
;
}
async
_refreshSnippets
(
)
{
const
cachedVersion
=
this
.
snippetsMap
.
get
(
"
snippets
-
cached
-
version
"
)
;
if
(
cachedVersion
!
=
=
this
.
appData
.
version
)
{
this
.
snippetsMap
.
clear
(
)
;
}
const
lastUpdate
=
this
.
snippetsMap
.
get
(
"
snippets
-
last
-
update
"
)
;
const
needsUpdate
=
!
(
lastUpdate
>
=
0
)
|
|
Date
.
now
(
)
-
lastUpdate
>
SNIPPETS_UPDATE_INTERVAL_MS
;
if
(
needsUpdate
&
&
this
.
appData
.
snippetsURL
)
{
this
.
snippetsMap
.
set
(
"
snippets
-
last
-
update
"
Date
.
now
(
)
)
;
try
{
const
response
=
await
fetch
(
this
.
appData
.
snippetsURL
)
;
if
(
response
.
status
=
=
=
200
)
{
const
payload
=
await
response
.
text
(
)
;
this
.
snippetsMap
.
set
(
"
snippets
"
payload
)
;
this
.
snippetsMap
.
set
(
"
snippets
-
cached
-
version
"
this
.
appData
.
version
)
;
}
}
catch
(
e
)
{
console
.
error
(
e
)
;
}
}
}
_noSnippetFallback
(
)
{
}
_forceOnboardingVisibility
(
shouldBeVisible
)
{
const
onboardingEl
=
document
.
getElementById
(
"
onboarding
-
notification
-
bar
"
)
;
if
(
onboardingEl
)
{
onboardingEl
.
style
.
display
=
shouldBeVisible
?
"
"
:
"
none
"
;
}
}
_showRemoteSnippets
(
)
{
const
snippetsEl
=
document
.
getElementById
(
this
.
elementId
)
;
const
payload
=
this
.
snippetsMap
.
get
(
"
snippets
"
)
;
if
(
!
snippetsEl
)
{
throw
new
Error
(
No
element
was
found
with
id
'
{
this
.
elementId
}
'
.
)
;
}
if
(
!
payload
)
{
throw
new
Error
(
"
No
remote
snippets
were
found
in
gSnippetsMap
.
"
)
;
}
if
(
typeof
payload
!
=
=
"
string
"
)
{
throw
new
Error
(
"
Snippet
payload
was
incorrectly
formatted
"
)
;
}
snippetsEl
.
innerHTML
=
payload
;
for
(
const
scriptEl
of
snippetsEl
.
getElementsByTagName
(
"
script
"
)
)
{
const
relocatedScript
=
document
.
createElement
(
"
script
"
)
;
relocatedScript
.
text
=
scriptEl
.
text
;
scriptEl
.
parentNode
.
replaceChild
(
relocatedScript
scriptEl
)
;
}
}
_onAction
(
msg
)
{
if
(
msg
.
data
.
type
=
=
=
__WEBPACK_IMPORTED_MODULE_0_common_Actions_jsm__
[
"
b
"
]
.
SNIPPET_BLOCKED
)
{
this
.
snippetsMap
.
set
(
"
blockList
"
msg
.
data
.
data
)
;
document
.
getElementById
(
"
snippets
-
container
"
)
.
style
.
display
=
"
none
"
;
}
}
async
init
(
options
)
{
Object
.
assign
(
this
{
appData
:
{
}
elementId
:
"
snippets
"
connect
:
true
}
options
)
;
if
(
global
.
addMessageListener
)
{
global
.
addMessageListener
(
"
ActivityStream
:
MainToContent
"
this
.
_onAction
)
;
}
if
(
this
.
connect
)
{
try
{
await
this
.
snippetsMap
.
connect
(
)
;
}
catch
(
e
)
{
console
.
error
(
e
)
;
}
}
for
(
const
key
of
Object
.
keys
(
this
.
appData
)
)
{
this
.
snippetsMap
.
set
(
appData
.
{
key
}
this
.
appData
[
key
]
)
;
}
await
this
.
_refreshSnippets
(
)
;
try
{
this
.
_showRemoteSnippets
(
)
;
}
catch
(
e
)
{
this
.
_noSnippetFallback
(
e
)
;
}
window
.
dispatchEvent
(
new
Event
(
SNIPPETS_ENABLED_EVENT
)
)
;
this
.
_forceOnboardingVisibility
(
true
)
;
this
.
initialized
=
true
;
}
uninit
(
)
{
window
.
dispatchEvent
(
new
Event
(
SNIPPETS_DISABLED_EVENT
)
)
;
this
.
_forceOnboardingVisibility
(
false
)
;
if
(
global
.
removeMessageListener
)
{
global
.
removeMessageListener
(
"
ActivityStream
:
MainToContent
"
this
.
_onAction
)
;
}
this
.
initialized
=
false
;
}
}
function
addSnippetsSubscriber
(
store
)
{
const
snippets
=
new
SnippetsProvider
(
store
.
dispatch
)
;
let
initializing
=
false
;
store
.
subscribe
(
async
(
)
=
>
{
const
state
=
store
.
getState
(
)
;
if
(
state
.
Prefs
.
values
[
"
feeds
.
snippets
"
]
&
&
!
state
.
Prefs
.
values
.
disableSnippets
&
&
state
.
Snippets
.
initialized
&
&
!
snippets
.
initialized
&
&
!
initializing
)
{
initializing
=
true
;
await
snippets
.
init
(
{
appData
:
state
.
Snippets
}
)
;
initializing
=
false
;
}
else
if
(
(
state
.
Prefs
.
values
[
"
feeds
.
snippets
"
]
=
=
=
false
|
|
state
.
Prefs
.
values
.
disableSnippets
=
=
=
true
)
&
&
snippets
.
initialized
)
{
snippets
.
uninit
(
)
;
}
}
)
;
return
snippets
;
}
}
.
call
(
__webpack_exports__
__webpack_require__
(
4
)
)
)
}
)
(
function
(
module
__webpack_exports__
__webpack_require__
)
{
"
use
strict
"
;
var
Actions
=
__webpack_require__
(
0
)
;
var
external__ReactIntl_
=
__webpack_require__
(
2
)
;
var
external__ReactIntl__default
=
__webpack_require__
.
n
(
external__ReactIntl_
)
;
var
external__ReactRedux_
=
__webpack_require__
(
3
)
;
var
external__ReactRedux__default
=
__webpack_require__
.
n
(
external__ReactRedux_
)
;
var
external__React_
=
__webpack_require__
(
1
)
;
var
external__React__default
=
__webpack_require__
.
n
(
external__React_
)
;
class
ConfirmDialog__ConfirmDialog
extends
external__React__default
.
a
.
PureComponent
{
constructor
(
props
)
{
super
(
props
)
;
this
.
_handleCancelBtn
=
this
.
_handleCancelBtn
.
bind
(
this
)
;
this
.
_handleConfirmBtn
=
this
.
_handleConfirmBtn
.
bind
(
this
)
;
}
_handleCancelBtn
(
)
{
this
.
props
.
dispatch
(
{
type
:
Actions
[
"
b
"
]
.
DIALOG_CANCEL
}
)
;
this
.
props
.
dispatch
(
Actions
[
"
a
"
]
.
UserEvent
(
{
event
:
Actions
[
"
b
"
]
.
DIALOG_CANCEL
}
)
)
;
}
_handleConfirmBtn
(
)
{
this
.
props
.
data
.
onConfirm
.
forEach
(
this
.
props
.
dispatch
)
;
}
_renderModalMessage
(
)
{
const
message_body
=
this
.
props
.
data
.
body_string_id
;
if
(
!
message_body
)
{
return
null
;
}
return
external__React__default
.
a
.
createElement
(
"
span
"
null
message_body
.
map
(
msg
=
>
external__React__default
.
a
.
createElement
(
"
p
"
{
key
:
msg
}
external__React__default
.
a
.
createElement
(
external__ReactIntl_
[
"
FormattedMessage
"
]
{
id
:
msg
}
)
)
)
)
;
}
render
(
)
{
if
(
!
this
.
props
.
visible
)
{
return
null
;
}
return
external__React__default
.
a
.
createElement
(
"
div
"
{
className
:
"
confirmation
-
dialog
"
}
external__React__default
.
a
.
createElement
(
"
div
"
{
className
:
"
modal
-
overlay
"
onClick
:
this
.
_handleCancelBtn
}
)
external__React__default
.
a
.
createElement
(
"
div
"
{
className
:
"
modal
"
}
external__React__default
.
a
.
createElement
(
"
section
"
{
className
:
"
modal
-
message
"
}
this
.
props
.
data
.
icon
&
&
external__React__default
.
a
.
createElement
(
"
span
"
{
className
:
icon
icon
-
spacer
icon
-
{
this
.
props
.
data
.
icon
}
}
)
this
.
_renderModalMessage
(
)
)
external__React__default
.
a
.
createElement
(
"
section
"
{
className
:
"
actions
"
}
external__React__default
.
a
.
createElement
(
"
button
"
{
onClick
:
this
.
_handleCancelBtn
}
external__React__default
.
a
.
createElement
(
external__ReactIntl_
[
"
FormattedMessage
"
]
{
id
:
this
.
props
.
data
.
cancel_button_string_id
}
)
)
external__React__default
.
a
.
createElement
(
"
button
"
{
className
:
"
done
"
onClick
:
this
.
_handleConfirmBtn
}
external__React__default
.
a
.
createElement
(
external__ReactIntl_
[
"
FormattedMessage
"
]
{
id
:
this
.
props
.
data
.
confirm_button_string_id
}
)
)
)
)
)
;
}
}
const
ConfirmDialog
=
Object
(
external__ReactRedux_
[
"
connect
"
]
)
(
state
=
>
state
.
Dialog
)
(
ConfirmDialog__ConfirmDialog
)
;
class
ManualMigration__ManualMigration
extends
external__React__default
.
a
.
PureComponent
{
constructor
(
props
)
{
super
(
props
)
;
this
.
onLaunchTour
=
this
.
onLaunchTour
.
bind
(
this
)
;
this
.
onCancelTour
=
this
.
onCancelTour
.
bind
(
this
)
;
}
onLaunchTour
(
)
{
this
.
props
.
dispatch
(
Actions
[
"
a
"
]
.
SendToMain
(
{
type
:
Actions
[
"
b
"
]
.
MIGRATION_START
}
)
)
;
this
.
props
.
dispatch
(
Actions
[
"
a
"
]
.
UserEvent
(
{
event
:
Actions
[
"
b
"
]
.
MIGRATION_START
}
)
)
;
}
onCancelTour
(
)
{
this
.
props
.
dispatch
(
Actions
[
"
a
"
]
.
SendToMain
(
{
type
:
Actions
[
"
b
"
]
.
MIGRATION_CANCEL
}
)
)
;
this
.
props
.
dispatch
(
Actions
[
"
a
"
]
.
UserEvent
(
{
event
:
Actions
[
"
b
"
]
.
MIGRATION_CANCEL
}
)
)
;
}
render
(
)
{
return
external__React__default
.
a
.
createElement
(
"
div
"
{
className
:
"
manual
-
migration
-
container
"
}
external__React__default
.
a
.
createElement
(
"
p
"
null
external__React__default
.
a
.
createElement
(
"
span
"
{
className
:
"
icon
icon
-
import
"
}
)
external__React__default
.
a
.
createElement
(
external__ReactIntl_
[
"
FormattedMessage
"
]
{
id
:
"
manual_migration_explanation2
"
}
)
)
external__React__default
.
a
.
createElement
(
"
div
"
{
className
:
"
manual
-
migration
-
actions
actions
"
}
external__React__default
.
a
.
createElement
(
"
button
"
{
className
:
"
dismiss
"
onClick
:
this
.
onCancelTour
}
external__React__default
.
a
.
createElement
(
external__ReactIntl_
[
"
FormattedMessage
"
]
{
id
:
"
manual_migration_cancel_button
"
}
)
)
external__React__default
.
a
.
createElement
(
"
button
"
{
onClick
:
this
.
onLaunchTour
}
external__React__default
.
a
.
createElement
(
external__ReactIntl_
[
"
FormattedMessage
"
]
{
id
:
"
manual_migration_import_button
"
}
)
)
)
)
;
}
}
const
ManualMigration
=
Object
(
external__ReactRedux_
[
"
connect
"
]
)
(
)
(
ManualMigration__ManualMigration
)
;
var
Reducers
=
__webpack_require__
(
5
)
;
const
getFormattedMessage
=
message
=
>
typeof
message
=
=
=
"
string
"
?
external__React__default
.
a
.
createElement
(
"
span
"
null
message
)
:
external__React__default
.
a
.
createElement
(
external__ReactIntl_
[
"
FormattedMessage
"
]
message
)
;
const
PreferencesInput
=
props
=
>
external__React__default
.
a
.
createElement
(
"
section
"
null
external__React__default
.
a
.
createElement
(
"
input
"
{
type
:
"
checkbox
"
id
:
props
.
prefName
name
:
props
.
prefName
checked
:
props
.
value
disabled
:
props
.
disabled
onChange
:
props
.
onChange
className
:
props
.
className
}
)
external__React__default
.
a
.
createElement
(
"
label
"
{
htmlFor
:
props
.
prefName
className
:
props
.
labelClassName
}
getFormattedMessage
(
props
.
titleString
)
)
props
.
descString
&
&
external__React__default
.
a
.
createElement
(
"
p
"
{
className
:
"
prefs
-
input
-
description
"
}
getFormattedMessage
(
props
.
descString
)
)
external__React__default
.
a
.
Children
.
map
(
props
.
children
child
=
>
external__React__default
.
a
.
createElement
(
"
div
"
{
className
:
options
{
child
.
props
.
disabled
?
"
disabled
"
:
"
"
}
}
child
)
)
)
;
class
PreferencesPane__PreferencesPane
extends
external__React__default
.
a
.
PureComponent
{
constructor
(
props
)
{
super
(
props
)
;
this
.
handleClickOutside
=
this
.
handleClickOutside
.
bind
(
this
)
;
this
.
handlePrefChange
=
this
.
handlePrefChange
.
bind
(
this
)
;
this
.
handleSectionChange
=
this
.
handleSectionChange
.
bind
(
this
)
;
this
.
togglePane
=
this
.
togglePane
.
bind
(
this
)
;
this
.
onWrapperMount
=
this
.
onWrapperMount
.
bind
(
this
)
;
}
componentDidUpdate
(
prevProps
prevState
)
{
if
(
prevProps
.
PreferencesPane
.
visible
!
=
=
this
.
props
.
PreferencesPane
.
visible
)
{
if
(
this
.
isSidebarOpen
(
)
)
{
document
.
addEventListener
(
"
click
"
this
.
handleClickOutside
)
;
}
else
{
document
.
removeEventListener
(
"
click
"
this
.
handleClickOutside
)
;
}
}
}
isSidebarOpen
(
)
{
return
this
.
props
.
PreferencesPane
.
visible
;
}
handleClickOutside
(
event
)
{
if
(
this
.
isSidebarOpen
(
)
&
&
!
this
.
wrapper
.
contains
(
event
.
target
)
)
{
this
.
togglePane
(
)
;
}
}
handlePrefChange
(
{
target
:
{
name
checked
}
}
)
{
let
value
=
checked
;
if
(
name
=
=
=
"
topSitesCount
"
)
{
value
=
checked
?
Reducers
[
"
b
"
]
:
Reducers
[
"
a
"
]
;
}
this
.
props
.
dispatch
(
Actions
[
"
a
"
]
.
SetPref
(
name
value
)
)
;
}
handleSectionChange
(
{
target
}
)
{
const
id
=
target
.
name
;
const
type
=
target
.
checked
?
Actions
[
"
b
"
]
.
SECTION_ENABLE
:
Actions
[
"
b
"
]
.
SECTION_DISABLE
;
this
.
props
.
dispatch
(
Actions
[
"
a
"
]
.
SendToMain
(
{
type
data
:
id
}
)
)
;
}
togglePane
(
)
{
if
(
this
.
isSidebarOpen
(
)
)
{
this
.
props
.
dispatch
(
{
type
:
Actions
[
"
b
"
]
.
SETTINGS_CLOSE
}
)
;
this
.
props
.
dispatch
(
Actions
[
"
a
"
]
.
UserEvent
(
{
event
:
"
CLOSE_NEWTAB_PREFS
"
}
)
)
;
}
else
{
this
.
props
.
dispatch
(
{
type
:
Actions
[
"
b
"
]
.
SETTINGS_OPEN
}
)
;
this
.
props
.
dispatch
(
Actions
[
"
a
"
]
.
UserEvent
(
{
event
:
"
OPEN_NEWTAB_PREFS
"
}
)
)
;
}
}
onWrapperMount
(
wrapper
)
{
this
.
wrapper
=
wrapper
;
}
render
(
)
{
const
{
props
}
=
this
;
const
prefs
=
props
.
Prefs
.
values
;
const
sections
=
props
.
Sections
;
const
isVisible
=
this
.
isSidebarOpen
(
)
;
return
external__React__default
.
a
.
createElement
(
"
div
"
{
className
:
"
prefs
-
pane
-
wrapper
"
ref
:
this
.
onWrapperMount
}
external__React__default
.
a
.
createElement
(
"
div
"
{
className
:
"
prefs
-
pane
-
button
"
}
external__React__default
.
a
.
createElement
(
"
button
"
{
className
:
prefs
-
button
icon
{
isVisible
?
"
icon
-
dismiss
"
:
"
icon
-
settings
"
}
title
:
props
.
intl
.
formatMessage
(
{
id
:
isVisible
?
"
settings_pane_done_button
"
:
"
settings_pane_button_label
"
}
)
onClick
:
this
.
togglePane
}
)
)
external__React__default
.
a
.
createElement
(
"
div
"
{
className
:
"
prefs
-
pane
"
}
external__React__default
.
a
.
createElement
(
"
div
"
{
className
:
sidebar
{
isVisible
?
"
"
:
"
hidden
"
}
}
external__React__default
.
a
.
createElement
(
"
div
"
{
className
:
"
prefs
-
modal
-
inner
-
wrapper
"
}
external__React__default
.
a
.
createElement
(
"
h1
"
null
external__React__default
.
a
.
createElement
(
external__ReactIntl_
[
"
FormattedMessage
"
]
{
id
:
"
settings_pane_header
"
}
)
)
external__React__default
.
a
.
createElement
(
"
p
"
null
external__React__default
.
a
.
createElement
(
external__ReactIntl_
[
"
FormattedMessage
"
]
{
id
:
"
settings_pane_body2
"
}
)
)
external__React__default
.
a
.
createElement
(
PreferencesInput
{
className
:
"
showSearch
"
prefName
:
"
showSearch
"
value
:
prefs
.
showSearch
onChange
:
this
.
handlePrefChange
titleString
:
{
id
:
"
settings_pane_search_header
"
}
descString
:
{
id
:
"
settings_pane_search_body
"
}
}
)
external__React__default
.
a
.
createElement
(
"
hr
"
null
)
external__React__default
.
a
.
createElement
(
PreferencesInput
{
className
:
"
showTopSites
"
prefName
:
"
showTopSites
"
value
:
prefs
.
showTopSites
onChange
:
this
.
handlePrefChange
titleString
:
{
id
:
"
settings_pane_topsites_header
"
}
descString
:
{
id
:
"
settings_pane_topsites_body
"
}
}
external__React__default
.
a
.
createElement
(
PreferencesInput
{
className
:
"
showMoreTopSites
"
prefName
:
"
topSitesCount
"
disabled
:
!
prefs
.
showTopSites
value
:
prefs
.
topSitesCount
!
=
=
Reducers
[
"
a
"
]
onChange
:
this
.
handlePrefChange
titleString
:
{
id
:
"
settings_pane_topsites_options_showmore
"
}
labelClassName
:
"
icon
icon
-
topsites
"
}
)
)
sections
.
filter
(
section
=
>
!
section
.
shouldHidePref
)
.
map
(
(
{
id
title
enabled
pref
}
)
=
>
external__React__default
.
a
.
createElement
(
PreferencesInput
{
key
:
id
className
:
"
showSection
"
prefName
:
pref
&
&
pref
.
feed
|
|
id
value
:
enabled
onChange
:
pref
&
&
pref
.
feed
?
this
.
handlePrefChange
:
this
.
handleSectionChange
titleString
:
pref
&
&
pref
.
titleString
|
|
title
descString
:
pref
&
&
pref
.
descString
}
pref
&
&
pref
.
nestedPrefs
&
&
pref
.
nestedPrefs
.
map
(
nestedPref
=
>
external__React__default
.
a
.
createElement
(
PreferencesInput
{
key
:
nestedPref
.
name
prefName
:
nestedPref
.
name
disabled
:
!
enabled
value
:
prefs
[
nestedPref
.
name
]
onChange
:
this
.
handlePrefChange
titleString
:
nestedPref
.
titleString
labelClassName
:
icon
{
nestedPref
.
icon
}
}
)
)
)
)
!
prefs
.
disableSnippets
&
&
external__React__default
.
a
.
createElement
(
"
hr
"
null
)
!
prefs
.
disableSnippets
&
&
external__React__default
.
a
.
createElement
(
PreferencesInput
{
className
:
"
showSnippets
"
prefName
:
"
feeds
.
snippets
"
value
:
prefs
[
"
feeds
.
snippets
"
]
onChange
:
this
.
handlePrefChange
titleString
:
{
id
:
"
settings_pane_snippets_header
"
}
descString
:
{
id
:
"
settings_pane_snippets_body
"
}
}
)
)
external__React__default
.
a
.
createElement
(
"
section
"
{
className
:
"
actions
"
}
external__React__default
.
a
.
createElement
(
"
button
"
{
className
:
"
done
"
onClick
:
this
.
togglePane
}
external__React__default
.
a
.
createElement
(
external__ReactIntl_
[
"
FormattedMessage
"
]
{
id
:
"
settings_pane_done_button
"
}
)
)
)
)
)
)
;
}
}
const
PreferencesPane
=
Object
(
external__ReactRedux_
[
"
connect
"
]
)
(
state
=
>
(
{
Prefs
:
state
.
Prefs
PreferencesPane
:
state
.
PreferencesPane
Sections
:
state
.
Sections
}
)
)
(
Object
(
external__ReactIntl_
[
"
injectIntl
"
]
)
(
PreferencesPane__PreferencesPane
)
)
;
class
_PrerenderData
{
constructor
(
options
)
{
this
.
initialPrefs
=
options
.
initialPrefs
;
this
.
initialSections
=
options
.
initialSections
;
this
.
_setValidation
(
options
.
validation
)
;
}
get
validation
(
)
{
return
this
.
_validation
;
}
set
validation
(
value
)
{
this
.
_setValidation
(
value
)
;
}
get
invalidatingPrefs
(
)
{
return
this
.
_invalidatingPrefs
;
}
_setValidation
(
value
=
[
]
)
{
this
.
_validation
=
value
;
this
.
_invalidatingPrefs
=
value
.
reduce
(
(
result
next
)
=
>
{
if
(
typeof
next
=
=
=
"
string
"
)
{
result
.
push
(
next
)
;
return
result
;
}
else
if
(
next
&
&
next
.
oneOf
)
{
return
result
.
concat
(
next
.
oneOf
)
;
}
throw
new
Error
(
"
Your
validation
configuration
is
not
properly
configured
"
)
;
}
[
]
)
;
}
arePrefsValid
(
getPref
)
{
for
(
const
prefs
of
this
.
validation
)
{
if
(
prefs
&
&
prefs
.
oneOf
&
&
!
prefs
.
oneOf
.
some
(
name
=
>
getPref
(
name
)
=
=
=
this
.
initialPrefs
[
name
]
)
)
{
return
false
;
}
else
if
(
getPref
(
prefs
)
!
=
=
this
.
initialPrefs
[
prefs
]
)
{
return
false
;
}
}
return
true
;
}
}
var
PrerenderData
=
new
_PrerenderData
(
{
initialPrefs
:
{
"
migrationExpired
"
:
true
"
showTopSites
"
:
true
"
showSearch
"
:
true
"
topSitesCount
"
:
12
"
collapseTopSites
"
:
false
"
section
.
highlights
.
collapsed
"
:
false
"
section
.
topstories
.
collapsed
"
:
false
"
feeds
.
section
.
topstories
"
:
true
"
feeds
.
section
.
highlights
"
:
true
}
validation
:
[
"
showTopSites
"
"
showSearch
"
"
topSitesCount
"
"
collapseTopSites
"
"
section
.
highlights
.
collapsed
"
"
section
.
topstories
.
collapsed
"
{
oneOf
:
[
"
feeds
.
section
.
topstories
"
"
feeds
.
section
.
highlights
"
]
}
]
initialSections
:
[
{
enabled
:
true
icon
:
"
pocket
"
id
:
"
topstories
"
order
:
1
title
:
{
id
:
"
header_recommended_by
"
values
:
{
provider
:
"
Pocket
"
}
}
}
{
enabled
:
true
id
:
"
highlights
"
icon
:
"
highlights
"
order
:
2
title
:
{
id
:
"
header_highlights
"
}
}
]
}
)
;
var
constants
=
__webpack_require__
(
13
)
;
class
Search__Search
extends
external__React__default
.
a
.
PureComponent
{
constructor
(
props
)
{
super
(
props
)
;
this
.
onClick
=
this
.
onClick
.
bind
(
this
)
;
this
.
onInputMount
=
this
.
onInputMount
.
bind
(
this
)
;
}
handleEvent
(
event
)
{
if
(
event
.
detail
.
type
=
=
=
"
Search
"
)
{
this
.
props
.
dispatch
(
Actions
[
"
a
"
]
.
UserEvent
(
{
event
:
"
SEARCH
"
}
)
)
;
}
}
onClick
(
event
)
{
window
.
gContentSearchController
.
search
(
event
)
;
}
componentWillUnmount
(
)
{
delete
window
.
gContentSearchController
;
}
onInputMount
(
input
)
{
if
(
input
)
{
const
healthReportKey
=
constants
[
"
a
"
]
?
"
newtab
"
:
"
abouthome
"
;
const
searchSource
=
constants
[
"
a
"
]
?
"
newtab
"
:
"
homepage
"
;
window
.
gContentSearchController
=
new
ContentSearchUIController
(
input
input
.
parentNode
healthReportKey
searchSource
)
;
addEventListener
(
"
ContentSearchClient
"
this
)
;
}
else
{
window
.
gContentSearchController
=
null
;
removeEventListener
(
"
ContentSearchClient
"
this
)
;
}
}
render
(
)
{
return
external__React__default
.
a
.
createElement
(
"
div
"
{
className
:
"
search
-
wrapper
"
}
external__React__default
.
a
.
createElement
(
"
label
"
{
htmlFor
:
"
newtab
-
search
-
text
"
className
:
"
search
-
label
"
}
external__React__default
.
a
.
createElement
(
"
span
"
{
className
:
"
sr
-
only
"
}
external__React__default
.
a
.
createElement
(
external__ReactIntl_
[
"
FormattedMessage
"
]
{
id
:
"
search_web_placeholder
"
}
)
)
)
external__React__default
.
a
.
createElement
(
"
input
"
{
id
:
"
newtab
-
search
-
text
"
maxLength
:
"
256
"
placeholder
:
this
.
props
.
intl
.
formatMessage
(
{
id
:
"
search_web_placeholder
"
}
)
ref
:
this
.
onInputMount
title
:
this
.
props
.
intl
.
formatMessage
(
{
id
:
"
search_web_placeholder
"
}
)
type
:
"
search
"
}
)
external__React__default
.
a
.
createElement
(
"
button
"
{
id
:
"
searchSubmit
"
className
:
"
search
-
button
"
onClick
:
this
.
onClick
title
:
this
.
props
.
intl
.
formatMessage
(
{
id
:
"
search_button
"
}
)
}
external__React__default
.
a
.
createElement
(
"
span
"
{
className
:
"
sr
-
only
"
}
external__React__default
.
a
.
createElement
(
external__ReactIntl_
[
"
FormattedMessage
"
]
{
id
:
"
search_button
"
}
)
)
)
)
;
}
}
const
Search
=
Object
(
external__ReactRedux_
[
"
connect
"
]
)
(
)
(
Object
(
external__ReactIntl_
[
"
injectIntl
"
]
)
(
Search__Search
)
)
;
var
Sections
=
__webpack_require__
(
14
)
;
const
TOP_SITES_SOURCE
=
"
TOP_SITES
"
;
const
TOP_SITES_CONTEXT_MENU_OPTIONS
=
[
"
CheckPinTopSite
"
"
EditTopSite
"
"
Separator
"
"
OpenInNewWindow
"
"
OpenInPrivateWindow
"
"
Separator
"
"
BlockUrl
"
"
DeleteUrl
"
]
;
const
MIN_RICH_FAVICON_SIZE
=
96
;
const
MIN_CORNER_FAVICON_SIZE
=
16
;
var
CollapsibleSection
=
__webpack_require__
(
7
)
;
var
ComponentPerfTimer
=
__webpack_require__
(
8
)
;
class
TopSiteForm_TopSiteForm
extends
external__React__default
.
a
.
PureComponent
{
constructor
(
props
)
{
super
(
props
)
;
this
.
state
=
{
label
:
props
.
label
|
|
"
"
url
:
props
.
url
|
|
"
"
validationError
:
false
}
;
this
.
onLabelChange
=
this
.
onLabelChange
.
bind
(
this
)
;
this
.
onUrlChange
=
this
.
onUrlChange
.
bind
(
this
)
;
this
.
onCancelButtonClick
=
this
.
onCancelButtonClick
.
bind
(
this
)
;
this
.
onAddButtonClick
=
this
.
onAddButtonClick
.
bind
(
this
)
;
this
.
onSaveButtonClick
=
this
.
onSaveButtonClick
.
bind
(
this
)
;
this
.
onUrlInputMount
=
this
.
onUrlInputMount
.
bind
(
this
)
;
}
onLabelChange
(
event
)
{
this
.
resetValidation
(
)
;
this
.
setState
(
{
"
label
"
:
event
.
target
.
value
}
)
;
}
onUrlChange
(
event
)
{
this
.
resetValidation
(
)
;
this
.
setState
(
{
"
url
"
:
event
.
target
.
value
}
)
;
}
onCancelButtonClick
(
ev
)
{
ev
.
preventDefault
(
)
;
this
.
props
.
onClose
(
)
;
}
onAddButtonClick
(
ev
)
{
ev
.
preventDefault
(
)
;
if
(
this
.
validateForm
(
)
)
{
let
site
=
{
url
:
this
.
cleanUrl
(
)
}
;
if
(
this
.
state
.
label
!
=
=
"
"
)
{
site
.
label
=
this
.
state
.
label
;
}
this
.
props
.
dispatch
(
Actions
[
"
a
"
]
.
SendToMain
(
{
type
:
Actions
[
"
b
"
]
.
TOP_SITES_INSERT
data
:
{
site
}
}
)
)
;
this
.
props
.
dispatch
(
Actions
[
"
a
"
]
.
UserEvent
(
{
source
:
TOP_SITES_SOURCE
event
:
"
TOP_SITES_ADD
"
}
)
)
;
this
.
props
.
onClose
(
)
;
}
}
onSaveButtonClick
(
ev
)
{
ev
.
preventDefault
(
)
;
if
(
this
.
validateForm
(
)
)
{
let
site
=
{
url
:
this
.
cleanUrl
(
)
}
;
if
(
this
.
state
.
label
!
=
=
"
"
)
{
site
.
label
=
this
.
state
.
label
;
}
this
.
props
.
dispatch
(
Actions
[
"
a
"
]
.
SendToMain
(
{
type
:
Actions
[
"
b
"
]
.
TOP_SITES_PIN
data
:
{
site
index
:
this
.
props
.
index
}
}
)
)
;
this
.
props
.
dispatch
(
Actions
[
"
a
"
]
.
UserEvent
(
{
source
:
TOP_SITES_SOURCE
event
:
"
TOP_SITES_EDIT
"
action_position
:
this
.
props
.
index
}
)
)
;
this
.
props
.
onClose
(
)
;
}
}
cleanUrl
(
)
{
let
{
url
}
=
this
.
state
;
if
(
!
url
.
startsWith
(
"
http
:
"
)
&
&
!
url
.
startsWith
(
"
https
:
"
)
)
{
url
=
http
:
/
/
{
url
}
;
}
return
url
;
}
resetValidation
(
)
{
if
(
this
.
state
.
validationError
)
{
this
.
setState
(
{
validationError
:
false
}
)
;
}
}
validateUrl
(
)
{
try
{
return
!
!
new
URL
(
this
.
cleanUrl
(
)
)
;
}
catch
(
e
)
{
return
false
;
}
}
validateForm
(
)
{
this
.
resetValidation
(
)
;
if
(
!
this
.
state
.
url
|
|
!
this
.
validateUrl
(
)
)
{
this
.
setState
(
{
validationError
:
true
}
)
;
this
.
inputUrl
.
focus
(
)
;
return
false
;
}
return
true
;
}
onUrlInputMount
(
input
)
{
this
.
inputUrl
=
input
;
}
render
(
)
{
return
external__React__default
.
a
.
createElement
(
"
form
"
{
className
:
"
topsite
-
form
"
}
external__React__default
.
a
.
createElement
(
"
section
"
{
className
:
"
edit
-
topsites
-
inner
-
wrapper
"
}
external__React__default
.
a
.
createElement
(
"
div
"
{
className
:
"
form
-
wrapper
"
}
external__React__default
.
a
.
createElement
(
"
h3
"
{
className
:
"
section
-
title
"
}
external__React__default
.
a
.
createElement
(
external__ReactIntl_
[
"
FormattedMessage
"
]
{
id
:
this
.
props
.
editMode
?
"
topsites_form_edit_header
"
:
"
topsites_form_add_header
"
}
)
)
external__React__default
.
a
.
createElement
(
"
div
"
{
className
:
"
field
title
"
}
external__React__default
.
a
.
createElement
(
"
input
"
{
type
:
"
text
"
value
:
this
.
state
.
label
onChange
:
this
.
onLabelChange
placeholder
:
this
.
props
.
intl
.
formatMessage
(
{
id
:
"
topsites_form_title_placeholder
"
}
)
}
)
)
external__React__default
.
a
.
createElement
(
"
div
"
{
className
:
field
url
{
this
.
state
.
validationError
?
"
invalid
"
:
"
"
}
}
external__React__default
.
a
.
createElement
(
"
input
"
{
type
:
"
text
"
ref
:
this
.
onUrlInputMount
value
:
this
.
state
.
url
onChange
:
this
.
onUrlChange
placeholder
:
this
.
props
.
intl
.
formatMessage
(
{
id
:
"
topsites_form_url_placeholder
"
}
)
}
)
this
.
state
.
validationError
&
&
external__React__default
.
a
.
createElement
(
"
aside
"
{
className
:
"
error
-
tooltip
"
}
external__React__default
.
a
.
createElement
(
external__ReactIntl_
[
"
FormattedMessage
"
]
{
id
:
"
topsites_form_url_validation
"
}
)
)
)
)
)
external__React__default
.
a
.
createElement
(
"
section
"
{
className
:
"
actions
"
}
external__React__default
.
a
.
createElement
(
"
button
"
{
className
:
"
cancel
"
type
:
"
button
"
onClick
:
this
.
onCancelButtonClick
}
external__React__default
.
a
.
createElement
(
external__ReactIntl_
[
"
FormattedMessage
"
]
{
id
:
"
topsites_form_cancel_button
"
}
)
)
this
.
props
.
editMode
&
&
external__React__default
.
a
.
createElement
(
"
button
"
{
className
:
"
done
save
"
type
:
"
submit
"
onClick
:
this
.
onSaveButtonClick
}
external__React__default
.
a
.
createElement
(
external__ReactIntl_
[
"
FormattedMessage
"
]
{
id
:
"
topsites_form_save_button
"
}
)
)
!
this
.
props
.
editMode
&
&
external__React__default
.
a
.
createElement
(
"
button
"
{
className
:
"
done
add
"
type
:
"
submit
"
onClick
:
this
.
onAddButtonClick
}
external__React__default
.
a
.
createElement
(
external__ReactIntl_
[
"
FormattedMessage
"
]
{
id
:
"
topsites_form_add_button
"
}
)
)
)
)
;
}
}
TopSiteForm_TopSiteForm
.
defaultProps
=
{
label
:
"
"
url
:
"
"
index
:
0
editMode
:
false
}
;
var
LinkMenu
=
__webpack_require__
(
6
)
;
var
_extends
=
Object
.
assign
|
|
function
(
target
)
{
for
(
var
i
=
1
;
i
<
arguments
.
length
;
i
+
+
)
{
var
source
=
arguments
[
i
]
;
for
(
var
key
in
source
)
{
if
(
Object
.
prototype
.
hasOwnProperty
.
call
(
source
key
)
)
{
target
[
key
]
=
source
[
key
]
;
}
}
}
return
target
;
}
;
class
TopSite_TopSiteLink
extends
external__React__default
.
a
.
PureComponent
{
constructor
(
props
)
{
super
(
props
)
;
this
.
onDragEvent
=
this
.
onDragEvent
.
bind
(
this
)
;
}
_allowDrop
(
e
)
{
return
e
.
dataTransfer
.
types
.
includes
(
"
text
/
topsite
-
index
"
)
;
}
onDragEvent
(
event
)
{
switch
(
event
.
type
)
{
case
"
click
"
:
if
(
this
.
dragged
)
{
event
.
preventDefault
(
)
;
}
break
;
case
"
dragstart
"
:
this
.
dragged
=
true
;
event
.
dataTransfer
.
effectAllowed
=
"
move
"
;
event
.
dataTransfer
.
setData
(
"
text
/
topsite
-
index
"
this
.
props
.
index
)
;
event
.
target
.
blur
(
)
;
this
.
props
.
onDragEvent
(
event
this
.
props
.
index
this
.
props
.
link
this
.
props
.
title
)
;
break
;
case
"
dragend
"
:
this
.
props
.
onDragEvent
(
event
)
;
break
;
case
"
dragenter
"
:
case
"
dragover
"
:
case
"
drop
"
:
if
(
this
.
_allowDrop
(
event
)
)
{
event
.
preventDefault
(
)
;
this
.
props
.
onDragEvent
(
event
this
.
props
.
index
)
;
}
break
;
case
"
mousedown
"
:
this
.
dragged
=
false
;
break
;
}
}
render
(
)
{
const
{
children
className
isDraggable
link
onClick
title
}
=
this
.
props
;
const
topSiteOuterClassName
=
top
-
site
-
outer
{
className
?
{
className
}
:
"
"
}
;
const
{
tippyTopIcon
faviconSize
}
=
link
;
const
[
letterFallback
]
=
title
;
let
imageClassName
;
let
imageStyle
;
let
showSmallFavicon
=
false
;
let
smallFaviconStyle
;
let
smallFaviconFallback
;
if
(
tippyTopIcon
|
|
faviconSize
>
=
MIN_RICH_FAVICON_SIZE
)
{
imageClassName
=
"
top
-
site
-
icon
rich
-
icon
"
;
imageStyle
=
{
backgroundColor
:
link
.
backgroundColor
backgroundImage
:
url
(
{
tippyTopIcon
|
|
link
.
favicon
}
)
}
;
}
else
{
imageClassName
=
screenshot
{
link
.
screenshot
?
"
active
"
:
"
"
}
;
imageStyle
=
{
backgroundImage
:
link
.
screenshot
?
url
(
{
link
.
screenshot
}
)
:
"
none
"
}
;
if
(
faviconSize
>
=
MIN_CORNER_FAVICON_SIZE
)
{
showSmallFavicon
=
true
;
smallFaviconStyle
=
{
backgroundImage
:
url
(
{
link
.
favicon
}
)
}
;
}
else
if
(
link
.
screenshot
)
{
showSmallFavicon
=
true
;
smallFaviconFallback
=
true
;
}
}
let
draggableProps
=
{
}
;
if
(
isDraggable
)
{
draggableProps
=
{
onClick
:
this
.
onDragEvent
onDragEnd
:
this
.
onDragEvent
onDragStart
:
this
.
onDragEvent
onMouseDown
:
this
.
onDragEvent
}
;
}
return
external__React__default
.
a
.
createElement
(
"
li
"
_extends
(
{
className
:
topSiteOuterClassName
onDrop
:
this
.
onDragEvent
onDragOver
:
this
.
onDragEvent
onDragEnter
:
this
.
onDragEvent
onDragLeave
:
this
.
onDragEvent
}
draggableProps
)
external__React__default
.
a
.
createElement
(
"
div
"
{
className
:
"
top
-
site
-
inner
"
}
external__React__default
.
a
.
createElement
(
"
a
"
{
href
:
link
.
url
onClick
:
onClick
}
external__React__default
.
a
.
createElement
(
"
div
"
{
className
:
"
tile
"
"
aria
-
hidden
"
:
true
"
data
-
fallback
"
:
letterFallback
}
external__React__default
.
a
.
createElement
(
"
div
"
{
className
:
imageClassName
style
:
imageStyle
}
)
showSmallFavicon
&
&
external__React__default
.
a
.
createElement
(
"
div
"
{
className
:
"
top
-
site
-
icon
default
-
icon
"
"
data
-
fallback
"
:
smallFaviconFallback
&
&
letterFallback
style
:
smallFaviconStyle
}
)
)
external__React__default
.
a
.
createElement
(
"
div
"
{
className
:
title
{
link
.
isPinned
?
"
pinned
"
:
"
"
}
}
link
.
isPinned
&
&
external__React__default
.
a
.
createElement
(
"
div
"
{
className
:
"
icon
icon
-
pin
-
small
"
}
)
external__React__default
.
a
.
createElement
(
"
span
"
{
dir
:
"
auto
"
}
title
)
)
)
children
)
)
;
}
}
TopSite_TopSiteLink
.
defaultProps
=
{
title
:
"
"
link
:
{
}
isDraggable
:
true
}
;
class
TopSite_TopSite
extends
external__React__default
.
a
.
PureComponent
{
constructor
(
props
)
{
super
(
props
)
;
this
.
state
=
{
showContextMenu
:
false
}
;
this
.
onLinkClick
=
this
.
onLinkClick
.
bind
(
this
)
;
this
.
onMenuButtonClick
=
this
.
onMenuButtonClick
.
bind
(
this
)
;
this
.
onMenuUpdate
=
this
.
onMenuUpdate
.
bind
(
this
)
;
}
userEvent
(
event
)
{
this
.
props
.
dispatch
(
Actions
[
"
a
"
]
.
UserEvent
(
{
event
source
:
TOP_SITES_SOURCE
action_position
:
this
.
props
.
index
}
)
)
;
}
onLinkClick
(
ev
)
{
this
.
userEvent
(
"
CLICK
"
)
;
}
onMenuButtonClick
(
event
)
{
event
.
preventDefault
(
)
;
this
.
props
.
onActivate
(
this
.
props
.
index
)
;
this
.
setState
(
{
showContextMenu
:
true
}
)
;
}
onMenuUpdate
(
showContextMenu
)
{
this
.
setState
(
{
showContextMenu
}
)
;
}
render
(
)
{
const
{
props
}
=
this
;
const
{
link
}
=
props
;
const
isContextMenuOpen
=
this
.
state
.
showContextMenu
&
&
props
.
activeIndex
=
=
=
props
.
index
;
const
title
=
link
.
label
|
|
link
.
hostname
;
return
external__React__default
.
a
.
createElement
(
TopSite_TopSiteLink
_extends
(
{
}
props
{
onClick
:
this
.
onLinkClick
onDragEvent
:
this
.
props
.
onDragEvent
className
:
isContextMenuOpen
?
"
active
"
:
"
"
title
:
title
}
)
external__React__default
.
a
.
createElement
(
"
div
"
null
external__React__default
.
a
.
createElement
(
"
button
"
{
className
:
"
context
-
menu
-
button
icon
"
onClick
:
this
.
onMenuButtonClick
}
external__React__default
.
a
.
createElement
(
"
span
"
{
className
:
"
sr
-
only
"
}
external__React__default
.
a
.
createElement
(
external__ReactIntl_
[
"
FormattedMessage
"
]
{
id
:
"
context_menu_button_sr
"
values
:
{
title
}
}
)
)
)
external__React__default
.
a
.
createElement
(
LinkMenu
[
"
a
"
]
{
dispatch
:
props
.
dispatch
index
:
props
.
index
onUpdate
:
this
.
onMenuUpdate
options
:
TOP_SITES_CONTEXT_MENU_OPTIONS
site
:
link
source
:
TOP_SITES_SOURCE
visible
:
isContextMenuOpen
}
)
)
)
;
}
}
TopSite_TopSite
.
defaultProps
=
{
link
:
{
}
onActivate
(
)
{
}
}
;
class
TopSite_TopSitePlaceholder
extends
external__React__default
.
a
.
PureComponent
{
constructor
(
props
)
{
super
(
props
)
;
this
.
onEditButtonClick
=
this
.
onEditButtonClick
.
bind
(
this
)
;
}
onEditButtonClick
(
)
{
if
(
this
.
props
.
onEdit
)
{
this
.
props
.
onEdit
(
this
.
props
.
index
)
;
return
;
}
this
.
props
.
dispatch
(
{
type
:
Actions
[
"
b
"
]
.
TOP_SITES_EDIT
data
:
{
index
:
this
.
props
.
index
}
}
)
;
}
render
(
)
{
return
external__React__default
.
a
.
createElement
(
TopSite_TopSiteLink
_extends
(
{
className
:
"
placeholder
"
isDraggable
:
false
}
this
.
props
)
external__React__default
.
a
.
createElement
(
"
button
"
{
className
:
"
context
-
menu
-
button
edit
-
button
icon
"
title
:
this
.
props
.
intl
.
formatMessage
(
{
id
:
"
edit_topsites_edit_button
"
}
)
onClick
:
this
.
onEditButtonClick
}
)
)
;
}
}
class
TopSite__TopSiteList
extends
external__React__default
.
a
.
PureComponent
{
static
get
DEFAULT_STATE
(
)
{
return
{
activeIndex
:
null
draggedIndex
:
null
draggedSite
:
null
draggedTitle
:
null
topSitesPreview
:
null
}
;
}
constructor
(
props
)
{
super
(
props
)
;
this
.
state
=
TopSite__TopSiteList
.
DEFAULT_STATE
;
this
.
onDragEvent
=
this
.
onDragEvent
.
bind
(
this
)
;
this
.
onActivate
=
this
.
onActivate
.
bind
(
this
)
;
}
componentWillUpdate
(
nextProps
)
{
if
(
this
.
state
.
draggedSite
)
{
const
prevTopSites
=
this
.
props
.
TopSites
&
&
this
.
props
.
TopSites
.
rows
;
const
newTopSites
=
nextProps
.
TopSites
&
&
nextProps
.
TopSites
.
rows
;
if
(
prevTopSites
&
&
prevTopSites
[
this
.
state
.
draggedIndex
]
&
&
prevTopSites
[
this
.
state
.
draggedIndex
]
.
url
=
=
=
this
.
state
.
draggedSite
.
url
&
&
(
!
newTopSites
[
this
.
state
.
draggedIndex
]
|
|
newTopSites
[
this
.
state
.
draggedIndex
]
.
url
!
=
=
this
.
state
.
draggedSite
.
url
)
)
{
this
.
setState
(
TopSite__TopSiteList
.
DEFAULT_STATE
)
;
}
}
}
userEvent
(
event
index
)
{
this
.
props
.
dispatch
(
Actions
[
"
a
"
]
.
UserEvent
(
{
event
source
:
TOP_SITES_SOURCE
action_position
:
index
}
)
)
;
}
onDragEvent
(
event
index
link
title
)
{
switch
(
event
.
type
)
{
case
"
dragstart
"
:
this
.
dropped
=
false
;
this
.
setState
(
{
draggedIndex
:
index
draggedSite
:
link
draggedTitle
:
title
activeIndex
:
null
}
)
;
this
.
userEvent
(
"
DRAG
"
index
)
;
break
;
case
"
dragend
"
:
if
(
!
this
.
dropped
)
{
this
.
setState
(
TopSite__TopSiteList
.
DEFAULT_STATE
)
;
}
break
;
case
"
dragenter
"
:
if
(
index
=
=
=
this
.
state
.
draggedIndex
)
{
this
.
setState
(
{
topSitesPreview
:
null
}
)
;
}
else
{
this
.
setState
(
{
topSitesPreview
:
this
.
_makeTopSitesPreview
(
index
)
}
)
;
}
break
;
case
"
drop
"
:
if
(
index
!
=
=
this
.
state
.
draggedIndex
)
{
this
.
dropped
=
true
;
this
.
props
.
dispatch
(
Actions
[
"
a
"
]
.
SendToMain
(
{
type
:
Actions
[
"
b
"
]
.
TOP_SITES_INSERT
data
:
{
site
:
{
url
:
this
.
state
.
draggedSite
.
url
label
:
this
.
state
.
draggedTitle
}
index
draggedFromIndex
:
this
.
state
.
draggedIndex
}
}
)
)
;
this
.
userEvent
(
"
DROP
"
index
)
;
}
break
;
}
}
_getTopSites
(
)
{
let
topSites
=
this
.
props
.
TopSites
.
rows
.
slice
(
)
;
topSites
.
length
=
this
.
props
.
TopSitesCount
;
return
topSites
;
}
_makeTopSitesPreview
(
index
)
{
const
topSites
=
this
.
_getTopSites
(
)
;
topSites
[
this
.
state
.
draggedIndex
]
=
null
;
const
pinnedOnly
=
topSites
.
map
(
site
=
>
site
&
&
site
.
isPinned
?
site
:
null
)
;
const
unpinned
=
topSites
.
filter
(
site
=
>
site
&
&
!
site
.
isPinned
)
;
const
siteToInsert
=
Object
.
assign
(
{
}
this
.
state
.
draggedSite
{
isPinned
:
true
}
)
;
if
(
!
pinnedOnly
[
index
]
)
{
pinnedOnly
[
index
]
=
siteToInsert
;
}
else
{
let
holeIndex
=
index
;
const
indexStep
=
index
>
this
.
state
.
draggedIndex
?
-
1
:
1
;
while
(
pinnedOnly
[
holeIndex
]
)
{
holeIndex
+
=
indexStep
;
}
const
shiftingStep
=
index
>
this
.
state
.
draggedIndex
?
1
:
-
1
;
while
(
holeIndex
!
=
=
index
)
{
const
nextIndex
=
holeIndex
+
shiftingStep
;
pinnedOnly
[
holeIndex
]
=
pinnedOnly
[
nextIndex
]
;
holeIndex
=
nextIndex
;
}
pinnedOnly
[
index
]
=
siteToInsert
;
}
const
preview
=
pinnedOnly
;
for
(
let
i
=
0
;
i
<
preview
.
length
;
i
+
+
)
{
if
(
!
preview
[
i
]
)
{
preview
[
i
]
=
unpinned
.
shift
(
)
|
|
null
;
}
}
return
preview
;
}
onActivate
(
index
)
{
this
.
setState
(
{
activeIndex
:
index
}
)
;
}
render
(
)
{
const
{
props
}
=
this
;
const
topSites
=
this
.
state
.
topSitesPreview
|
|
this
.
_getTopSites
(
)
;
const
topSitesUI
=
[
]
;
const
commonProps
=
{
onDragEvent
:
this
.
onDragEvent
dispatch
:
props
.
dispatch
intl
:
props
.
intl
}
;
let
holeIndex
=
0
;
for
(
let
i
=
0
l
=
topSites
.
length
;
i
<
l
;
i
+
+
)
{
const
link
=
topSites
[
i
]
;
const
slotProps
=
{
key
:
link
?
link
.
url
:
holeIndex
+
+
index
:
i
}
;
topSitesUI
.
push
(
!
link
?
external__React__default
.
a
.
createElement
(
TopSite_TopSitePlaceholder
_extends
(
{
onEdit
:
props
.
onEdit
}
slotProps
commonProps
)
)
:
external__React__default
.
a
.
createElement
(
TopSite_TopSite
_extends
(
{
link
:
link
onEdit
:
props
.
onEdit
activeIndex
:
this
.
state
.
activeIndex
onActivate
:
this
.
onActivate
}
slotProps
commonProps
)
)
)
;
}
return
external__React__default
.
a
.
createElement
(
"
ul
"
{
className
:
top
-
sites
-
list
{
this
.
state
.
draggedSite
?
"
dnd
-
active
"
:
"
"
}
}
topSitesUI
)
;
}
}
const
TopSiteList
=
Object
(
external__ReactIntl_
[
"
injectIntl
"
]
)
(
TopSite__TopSiteList
)
;
function
countTopSitesIconsTypes
(
topSites
)
{
const
countTopSitesTypes
=
(
acc
link
)
=
>
{
if
(
link
.
tippyTopIcon
|
|
link
.
faviconRef
=
=
=
"
tippytop
"
)
{
acc
.
tippytop
+
+
;
}
else
if
(
link
.
faviconSize
>
=
MIN_RICH_FAVICON_SIZE
)
{
acc
.
rich_icon
+
+
;
}
else
if
(
link
.
screenshot
&
&
link
.
faviconSize
>
=
MIN_CORNER_FAVICON_SIZE
)
{
acc
.
screenshot_with_icon
+
+
;
}
else
if
(
link
.
screenshot
)
{
acc
.
screenshot
+
+
;
}
else
{
acc
.
no_image
+
+
;
}
return
acc
;
}
;
return
topSites
.
reduce
(
countTopSitesTypes
{
"
screenshot_with_icon
"
:
0
"
screenshot
"
:
0
"
tippytop
"
:
0
"
rich_icon
"
:
0
"
no_image
"
:
0
}
)
;
}
class
TopSites__TopSites
extends
external__React__default
.
a
.
PureComponent
{
static
get
DEFAULT_STATE
(
)
{
return
{
showAddForm
:
false
showEditForm
:
false
editIndex
:
-
1
}
;
}
constructor
(
props
)
{
super
(
props
)
;
this
.
state
=
TopSites__TopSites
.
DEFAULT_STATE
;
this
.
onAddButtonClick
=
this
.
onAddButtonClick
.
bind
(
this
)
;
this
.
onFormClose
=
this
.
onFormClose
.
bind
(
this
)
;
}
_dispatchTopSitesStats
(
)
{
const
topSites
=
this
.
_getTopSites
(
)
;
const
topSitesIconsStats
=
countTopSitesIconsTypes
(
topSites
)
;
const
topSitesPinned
=
topSites
.
filter
(
site
=
>
!
!
site
.
isPinned
)
.
length
;
this
.
props
.
dispatch
(
Actions
[
"
a
"
]
.
SendToMain
(
{
type
:
Actions
[
"
b
"
]
.
SAVE_SESSION_PERF_DATA
data
:
{
topsites_icon_stats
:
topSitesIconsStats
topsites_pinned
:
topSitesPinned
}
}
)
)
;
}
_getTopSites
(
)
{
return
this
.
props
.
TopSites
.
rows
.
slice
(
0
this
.
props
.
TopSitesCount
)
;
}
componentDidUpdate
(
)
{
this
.
_dispatchTopSitesStats
(
)
;
}
componentDidMount
(
)
{
this
.
_dispatchTopSitesStats
(
)
;
}
onAddButtonClick
(
)
{
this
.
setState
(
{
showAddForm
:
true
}
)
;
this
.
props
.
dispatch
(
Actions
[
"
a
"
]
.
UserEvent
(
{
source
:
TOP_SITES_SOURCE
event
:
"
TOP_SITES_ADD_FORM_OPEN
"
}
)
)
;
}
onFormClose
(
)
{
this
.
setState
(
TopSites__TopSites
.
DEFAULT_STATE
)
;
this
.
props
.
dispatch
(
Actions
[
"
a
"
]
.
UserEvent
(
{
source
:
TOP_SITES_SOURCE
event
:
"
TOP_SITES_EDIT_CLOSE
"
}
)
)
;
this
.
props
.
dispatch
(
{
type
:
Actions
[
"
b
"
]
.
TOP_SITES_CANCEL_EDIT
}
)
;
}
render
(
)
{
const
{
props
}
=
this
;
const
infoOption
=
{
header
:
{
id
:
"
settings_pane_topsites_header
"
}
body
:
{
id
:
"
settings_pane_topsites_body
"
}
}
;
const
{
showAddForm
}
=
this
.
state
;
const
{
editForm
}
=
this
.
props
.
TopSites
;
const
showEditForm
=
editForm
&
&
editForm
.
visible
|
|
this
.
state
.
showEditForm
;
let
{
editIndex
}
=
this
.
state
;
if
(
editIndex
<
0
&
&
editForm
)
{
editIndex
=
editForm
.
index
;
}
const
editSite
=
this
.
props
.
TopSites
.
rows
[
editIndex
]
|
|
{
}
;
return
external__React__default
.
a
.
createElement
(
ComponentPerfTimer
[
"
a
"
]
{
id
:
"
topsites
"
initialized
:
props
.
TopSites
.
initialized
dispatch
:
props
.
dispatch
}
external__React__default
.
a
.
createElement
(
CollapsibleSection
[
"
a
"
]
{
className
:
"
top
-
sites
"
icon
:
"
topsites
"
title
:
external__React__default
.
a
.
createElement
(
external__ReactIntl_
[
"
FormattedMessage
"
]
{
id
:
"
header_top_sites
"
}
)
infoOption
:
infoOption
prefName
:
"
collapseTopSites
"
Prefs
:
props
.
Prefs
dispatch
:
props
.
dispatch
}
external__React__default
.
a
.
createElement
(
TopSiteList
{
TopSites
:
props
.
TopSites
TopSitesCount
:
props
.
TopSitesCount
dispatch
:
props
.
dispatch
intl
:
props
.
intl
}
)
external__React__default
.
a
.
createElement
(
"
div
"
{
className
:
"
edit
-
topsites
-
wrapper
"
}
external__React__default
.
a
.
createElement
(
"
div
"
{
className
:
"
add
-
topsites
-
button
"
}
external__React__default
.
a
.
createElement
(
"
button
"
{
className
:
"
add
"
title
:
this
.
props
.
intl
.
formatMessage
(
{
id
:
"
edit_topsites_add_button_tooltip
"
}
)
onClick
:
this
.
onAddButtonClick
}
external__React__default
.
a
.
createElement
(
external__ReactIntl_
[
"
FormattedMessage
"
]
{
id
:
"
edit_topsites_add_button
"
}
)
)
)
showAddForm
&
&
external__React__default
.
a
.
createElement
(
"
div
"
{
className
:
"
edit
-
topsites
"
}
external__React__default
.
a
.
createElement
(
"
div
"
{
className
:
"
modal
-
overlay
"
onClick
:
this
.
onFormClose
}
)
external__React__default
.
a
.
createElement
(
"
div
"
{
className
:
"
modal
"
}
external__React__default
.
a
.
createElement
(
TopSiteForm_TopSiteForm
{
onClose
:
this
.
onFormClose
dispatch
:
this
.
props
.
dispatch
intl
:
this
.
props
.
intl
}
)
)
)
showEditForm
&
&
external__React__default
.
a
.
createElement
(
"
div
"
{
className
:
"
edit
-
topsites
"
}
external__React__default
.
a
.
createElement
(
"
div
"
{
className
:
"
modal
-
overlay
"
onClick
:
this
.
onFormClose
}
)
external__React__default
.
a
.
createElement
(
"
div
"
{
className
:
"
modal
"
}
external__React__default
.
a
.
createElement
(
TopSiteForm_TopSiteForm
{
label
:
editSite
.
label
|
|
editSite
.
hostname
|
|
"
"
url
:
editSite
.
url
|
|
"
"
index
:
editIndex
editMode
:
true
onClose
:
this
.
onFormClose
dispatch
:
this
.
props
.
dispatch
intl
:
this
.
props
.
intl
}
)
)
)
)
)
)
;
}
}
const
TopSites
=
Object
(
external__ReactRedux_
[
"
connect
"
]
)
(
state
=
>
(
{
TopSites
:
state
.
TopSites
Prefs
:
state
.
Prefs
TopSitesCount
:
state
.
Prefs
.
values
.
topSitesCount
}
)
)
(
Object
(
external__ReactIntl_
[
"
injectIntl
"
]
)
(
TopSites__TopSites
)
)
;
function
addLocaleDataForReactIntl
(
locale
)
{
Object
(
external__ReactIntl_
[
"
addLocaleData
"
]
)
(
[
{
locale
parentLocale
:
"
en
"
}
]
)
;
}
class
Base__Base
extends
external__React__default
.
a
.
PureComponent
{
componentWillMount
(
)
{
const
{
App
locale
}
=
this
.
props
;
this
.
sendNewTabRehydrated
(
App
)
;
addLocaleDataForReactIntl
(
locale
)
;
}
componentDidMount
(
)
{
if
(
this
.
props
.
isPrerendered
)
{
this
.
props
.
dispatch
(
Actions
[
"
a
"
]
.
SendToMain
(
{
type
:
Actions
[
"
b
"
]
.
NEW_TAB_STATE_REQUEST
}
)
)
;
this
.
props
.
dispatch
(
Actions
[
"
a
"
]
.
SendToMain
(
{
type
:
Actions
[
"
b
"
]
.
PAGE_PRERENDERED
}
)
)
;
}
}
componentWillUpdate
(
{
App
}
)
{
this
.
sendNewTabRehydrated
(
App
)
;
}
sendNewTabRehydrated
(
App
)
{
if
(
App
&
&
App
.
initialized
&
&
!
this
.
renderNotified
)
{
this
.
props
.
dispatch
(
Actions
[
"
a
"
]
.
SendToMain
(
{
type
:
Actions
[
"
b
"
]
.
NEW_TAB_REHYDRATED
data
:
{
}
}
)
)
;
this
.
renderNotified
=
true
;
}
}
render
(
)
{
const
{
props
}
=
this
;
const
{
App
locale
strings
}
=
props
;
const
{
initialized
}
=
App
;
const
prefs
=
props
.
Prefs
.
values
;
const
shouldBeFixedToTop
=
PrerenderData
.
arePrefsValid
(
name
=
>
prefs
[
name
]
)
;
const
outerClassName
=
outer
-
wrapper
{
shouldBeFixedToTop
?
"
fixed
-
to
-
top
"
:
"
"
}
;
if
(
!
props
.
isPrerendered
&
&
!
initialized
)
{
return
null
;
}
return
external__React__default
.
a
.
createElement
(
external__ReactIntl_
[
"
IntlProvider
"
]
{
locale
:
locale
messages
:
strings
}
external__React__default
.
a
.
createElement
(
"
div
"
{
className
:
outerClassName
}
external__React__default
.
a
.
createElement
(
"
main
"
null
prefs
.
showSearch
&
&
external__React__default
.
a
.
createElement
(
Search
null
)
external__React__default
.
a
.
createElement
(
"
div
"
{
className
:
body
-
wrapper
{
initialized
?
"
on
"
:
"
"
}
}
!
prefs
.
migrationExpired
&
&
external__React__default
.
a
.
createElement
(
ManualMigration
null
)
prefs
.
showTopSites
&
&
external__React__default
.
a
.
createElement
(
TopSites
null
)
external__React__default
.
a
.
createElement
(
Sections
[
"
a
"
]
null
)
)
external__React__default
.
a
.
createElement
(
ConfirmDialog
null
)
)
initialized
&
&
external__React__default
.
a
.
createElement
(
PreferencesPane
null
)
)
)
;
}
}
const
Base
=
Object
(
external__ReactRedux_
[
"
connect
"
]
)
(
state
=
>
(
{
App
:
state
.
App
Prefs
:
state
.
Prefs
}
)
)
(
Base__Base
)
;
__webpack_exports__
[
"
a
"
]
=
Base
;
}
)
(
function
(
module
__webpack_exports__
__webpack_require__
)
{
"
use
strict
"
;
(
function
(
global
)
{
const
IS_NEWTAB
=
global
.
document
&
&
global
.
document
.
documentURI
=
=
=
"
about
:
newtab
"
;
__webpack_exports__
[
"
a
"
]
=
IS_NEWTAB
;
}
.
call
(
__webpack_exports__
__webpack_require__
(
4
)
)
)
}
)
(
function
(
module
__webpack_exports__
__webpack_require__
)
{
"
use
strict
"
;
(
function
(
global
)
{
var
__WEBPACK_IMPORTED_MODULE_0_content_src_components_Card_Card__
=
__webpack_require__
(
15
)
;
var
__WEBPACK_IMPORTED_MODULE_1_react_intl__
=
__webpack_require__
(
2
)
;
var
__WEBPACK_IMPORTED_MODULE_1_react_intl___default
=
__webpack_require__
.
n
(
__WEBPACK_IMPORTED_MODULE_1_react_intl__
)
;
var
__WEBPACK_IMPORTED_MODULE_2_common_Actions_jsm__
=
__webpack_require__
(
0
)
;
var
__WEBPACK_IMPORTED_MODULE_3_content_src_components_CollapsibleSection_CollapsibleSection__
=
__webpack_require__
(
7
)
;
var
__WEBPACK_IMPORTED_MODULE_4_content_src_components_ComponentPerfTimer_ComponentPerfTimer__
=
__webpack_require__
(
8
)
;
var
__WEBPACK_IMPORTED_MODULE_5_react_redux__
=
__webpack_require__
(
3
)
;
var
__WEBPACK_IMPORTED_MODULE_5_react_redux___default
=
__webpack_require__
.
n
(
__WEBPACK_IMPORTED_MODULE_5_react_redux__
)
;
var
__WEBPACK_IMPORTED_MODULE_6_react__
=
__webpack_require__
(
1
)
;
var
__WEBPACK_IMPORTED_MODULE_6_react___default
=
__webpack_require__
.
n
(
__WEBPACK_IMPORTED_MODULE_6_react__
)
;
var
__WEBPACK_IMPORTED_MODULE_7_content_src_components_Topics_Topics__
=
__webpack_require__
(
16
)
;
var
_extends
=
Object
.
assign
|
|
function
(
target
)
{
for
(
var
i
=
1
;
i
<
arguments
.
length
;
i
+
+
)
{
var
source
=
arguments
[
i
]
;
for
(
var
key
in
source
)
{
if
(
Object
.
prototype
.
hasOwnProperty
.
call
(
source
key
)
)
{
target
[
key
]
=
source
[
key
]
;
}
}
}
return
target
;
}
;
const
VISIBLE
=
"
visible
"
;
const
VISIBILITY_CHANGE_EVENT
=
"
visibilitychange
"
;
const
CARDS_PER_ROW
=
3
;
function
getFormattedMessage
(
message
)
{
return
typeof
message
=
=
=
"
string
"
?
__WEBPACK_IMPORTED_MODULE_6_react___default
.
a
.
createElement
(
"
span
"
null
message
)
:
__WEBPACK_IMPORTED_MODULE_6_react___default
.
a
.
createElement
(
__WEBPACK_IMPORTED_MODULE_1_react_intl__
[
"
FormattedMessage
"
]
message
)
;
}
class
Section
extends
__WEBPACK_IMPORTED_MODULE_6_react___default
.
a
.
PureComponent
{
_dispatchImpressionStats
(
)
{
const
{
props
}
=
this
;
const
maxCards
=
3
*
props
.
maxRows
;
const
cards
=
props
.
rows
.
slice
(
0
maxCards
)
;
if
(
this
.
needsImpressionStats
(
cards
)
)
{
props
.
dispatch
(
__WEBPACK_IMPORTED_MODULE_2_common_Actions_jsm__
[
"
a
"
]
.
ImpressionStats
(
{
source
:
props
.
eventSource
tiles
:
cards
.
map
(
link
=
>
(
{
id
:
link
.
guid
}
)
)
}
)
)
;
this
.
impressionCardGuids
=
cards
.
map
(
link
=
>
link
.
guid
)
;
}
}
sendImpressionStatsOrAddListener
(
)
{
const
{
props
}
=
this
;
if
(
!
props
.
shouldSendImpressionStats
|
|
!
props
.
dispatch
)
{
return
;
}
if
(
props
.
document
.
visibilityState
=
=
=
VISIBLE
)
{
this
.
_dispatchImpressionStats
(
)
;
}
else
{
if
(
this
.
_onVisibilityChange
)
{
props
.
document
.
removeEventListener
(
VISIBILITY_CHANGE_EVENT
this
.
_onVisibilityChange
)
;
}
this
.
_onVisibilityChange
=
(
)
=
>
{
if
(
props
.
document
.
visibilityState
=
=
=
VISIBLE
)
{
const
{
id
Prefs
}
=
this
.
props
;
const
isCollapsed
=
Prefs
.
values
[
section
.
{
id
}
.
collapsed
]
;
if
(
!
isCollapsed
)
{
this
.
_dispatchImpressionStats
(
)
;
}
props
.
document
.
removeEventListener
(
VISIBILITY_CHANGE_EVENT
this
.
_onVisibilityChange
)
;
}
}
;
props
.
document
.
addEventListener
(
VISIBILITY_CHANGE_EVENT
this
.
_onVisibilityChange
)
;
}
}
componentDidMount
(
)
{
const
{
id
rows
Prefs
}
=
this
.
props
;
const
isCollapsed
=
Prefs
.
values
[
section
.
{
id
}
.
collapsed
]
;
if
(
rows
.
length
&
&
!
isCollapsed
)
{
this
.
sendImpressionStatsOrAddListener
(
)
;
}
}
componentDidUpdate
(
prevProps
)
{
const
{
props
}
=
this
;
const
{
id
Prefs
}
=
props
;
const
isCollapsedPref
=
section
.
{
id
}
.
collapsed
;
const
isCollapsed
=
Prefs
.
values
[
isCollapsedPref
]
;
const
wasCollapsed
=
prevProps
.
Prefs
.
values
[
isCollapsedPref
]
;
if
(
props
.
rows
.
length
&
&
(
props
.
rows
!
=
=
prevProps
.
rows
&
&
!
isCollapsed
|
|
wasCollapsed
&
&
!
isCollapsed
)
)
{
this
.
sendImpressionStatsOrAddListener
(
)
;
}
}
needsImpressionStats
(
cards
)
{
if
(
!
this
.
impressionCardGuids
|
|
this
.
impressionCardGuids
.
length
!
=
=
cards
.
length
)
{
return
true
;
}
for
(
let
i
=
0
;
i
<
cards
.
length
;
i
+
+
)
{
if
(
cards
[
i
]
.
guid
!
=
=
this
.
impressionCardGuids
[
i
]
)
{
return
true
;
}
}
return
false
;
}
numberOfPlaceholders
(
items
)
{
if
(
items
=
=
=
0
)
{
return
CARDS_PER_ROW
;
}
const
remainder
=
items
%
CARDS_PER_ROW
;
if
(
remainder
=
=
=
0
)
{
return
0
;
}
return
CARDS_PER_ROW
-
remainder
;
}
render
(
)
{
const
{
id
eventSource
title
icon
rows
infoOption
emptyState
dispatch
maxRows
contextMenuOptions
initialized
disclaimer
}
=
this
.
props
;
const
maxCards
=
CARDS_PER_ROW
*
maxRows
;
const
shouldShowTopics
=
id
=
=
=
"
topstories
"
&
&
(
!
this
.
props
.
topics
|
|
this
.
props
.
topics
.
length
>
0
)
;
const
realRows
=
rows
.
slice
(
0
maxCards
)
;
const
placeholders
=
this
.
numberOfPlaceholders
(
realRows
.
length
)
;
const
shouldShowEmptyState
=
initialized
&
&
!
rows
.
length
;
return
__WEBPACK_IMPORTED_MODULE_6_react___default
.
a
.
createElement
(
__WEBPACK_IMPORTED_MODULE_4_content_src_components_ComponentPerfTimer_ComponentPerfTimer__
[
"
a
"
]
this
.
props
__WEBPACK_IMPORTED_MODULE_6_react___default
.
a
.
createElement
(
__WEBPACK_IMPORTED_MODULE_3_content_src_components_CollapsibleSection_CollapsibleSection__
[
"
a
"
]
{
className
:
"
section
"
icon
:
icon
title
:
getFormattedMessage
(
title
)
infoOption
:
infoOption
id
:
id
eventSource
:
eventSource
disclaimer
:
disclaimer
prefName
:
section
.
{
id
}
.
collapsed
Prefs
:
this
.
props
.
Prefs
dispatch
:
this
.
props
.
dispatch
}
!
shouldShowEmptyState
&
&
__WEBPACK_IMPORTED_MODULE_6_react___default
.
a
.
createElement
(
"
ul
"
{
className
:
"
section
-
list
"
style
:
{
padding
:
0
}
}
realRows
.
map
(
(
link
index
)
=
>
link
&
&
__WEBPACK_IMPORTED_MODULE_6_react___default
.
a
.
createElement
(
__WEBPACK_IMPORTED_MODULE_0_content_src_components_Card_Card__
[
"
a
"
]
{
key
:
index
index
:
index
dispatch
:
dispatch
link
:
link
contextMenuOptions
:
contextMenuOptions
eventSource
:
eventSource
shouldSendImpressionStats
:
this
.
props
.
shouldSendImpressionStats
}
)
)
placeholders
>
0
&
&
[
.
.
.
new
Array
(
placeholders
)
]
.
map
(
(
_
i
)
=
>
__WEBPACK_IMPORTED_MODULE_6_react___default
.
a
.
createElement
(
__WEBPACK_IMPORTED_MODULE_0_content_src_components_Card_Card__
[
"
b
"
]
{
key
:
i
}
)
)
)
shouldShowEmptyState
&
&
__WEBPACK_IMPORTED_MODULE_6_react___default
.
a
.
createElement
(
"
div
"
{
className
:
"
section
-
empty
-
state
"
}
__WEBPACK_IMPORTED_MODULE_6_react___default
.
a
.
createElement
(
"
div
"
{
className
:
"
empty
-
state
"
}
emptyState
.
icon
&
&
emptyState
.
icon
.
startsWith
(
"
moz
-
extension
:
/
/
"
)
?
__WEBPACK_IMPORTED_MODULE_6_react___default
.
a
.
createElement
(
"
img
"
{
className
:
"
empty
-
state
-
icon
icon
"
style
:
{
"
background
-
image
"
:
url
(
'
{
emptyState
.
icon
}
'
)
}
}
)
:
__WEBPACK_IMPORTED_MODULE_6_react___default
.
a
.
createElement
(
"
img
"
{
className
:
empty
-
state
-
icon
icon
icon
-
{
emptyState
.
icon
}
}
)
__WEBPACK_IMPORTED_MODULE_6_react___default
.
a
.
createElement
(
"
p
"
{
className
:
"
empty
-
state
-
message
"
}
getFormattedMessage
(
emptyState
.
message
)
)
)
)
shouldShowTopics
&
&
__WEBPACK_IMPORTED_MODULE_6_react___default
.
a
.
createElement
(
__WEBPACK_IMPORTED_MODULE_7_content_src_components_Topics_Topics__
[
"
a
"
]
{
topics
:
this
.
props
.
topics
read_more_endpoint
:
this
.
props
.
read_more_endpoint
}
)
)
)
;
}
}
Section
.
defaultProps
=
{
document
:
global
.
document
rows
:
[
]
emptyState
:
{
}
title
:
"
"
}
;
const
SectionIntl
=
Object
(
__WEBPACK_IMPORTED_MODULE_1_react_intl__
[
"
injectIntl
"
]
)
(
Section
)
;
class
_Sections
extends
__WEBPACK_IMPORTED_MODULE_6_react___default
.
a
.
PureComponent
{
render
(
)
{
const
sections
=
this
.
props
.
Sections
;
return
__WEBPACK_IMPORTED_MODULE_6_react___default
.
a
.
createElement
(
"
div
"
{
className
:
"
sections
-
list
"
}
sections
.
filter
(
section
=
>
section
.
enabled
)
.
map
(
section
=
>
__WEBPACK_IMPORTED_MODULE_6_react___default
.
a
.
createElement
(
SectionIntl
_extends
(
{
key
:
section
.
id
}
section
{
Prefs
:
this
.
props
.
Prefs
dispatch
:
this
.
props
.
dispatch
}
)
)
)
)
;
}
}
const
Sections
=
Object
(
__WEBPACK_IMPORTED_MODULE_5_react_redux__
[
"
connect
"
]
)
(
state
=
>
(
{
Sections
:
state
.
Sections
Prefs
:
state
.
Prefs
}
)
)
(
_Sections
)
;
__webpack_exports__
[
"
a
"
]
=
Sections
;
}
.
call
(
__webpack_exports__
__webpack_require__
(
4
)
)
)
}
)
(
function
(
module
__webpack_exports__
__webpack_require__
)
{
"
use
strict
"
;
var
Actions
=
__webpack_require__
(
0
)
;
const
cardContextTypes
=
{
history
:
{
intlID
:
"
type_label_visited
"
icon
:
"
historyItem
"
}
bookmark
:
{
intlID
:
"
type_label_bookmarked
"
icon
:
"
bookmark
-
added
"
}
trending
:
{
intlID
:
"
type_label_recommended
"
icon
:
"
trending
"
}
now
:
{
intlID
:
"
type_label_now
"
icon
:
"
now
"
}
}
;
var
external__ReactIntl_
=
__webpack_require__
(
2
)
;
var
external__ReactIntl__default
=
__webpack_require__
.
n
(
external__ReactIntl_
)
;
var
LinkMenu
=
__webpack_require__
(
6
)
;
var
external__React_
=
__webpack_require__
(
1
)
;
var
external__React__default
=
__webpack_require__
.
n
(
external__React_
)
;
const
gImageLoading
=
new
Map
(
)
;
class
Card_Card
extends
external__React__default
.
a
.
PureComponent
{
constructor
(
props
)
{
super
(
props
)
;
this
.
state
=
{
activeCard
:
null
imageLoaded
:
false
showContextMenu
:
false
}
;
this
.
onMenuButtonClick
=
this
.
onMenuButtonClick
.
bind
(
this
)
;
this
.
onMenuUpdate
=
this
.
onMenuUpdate
.
bind
(
this
)
;
this
.
onLinkClick
=
this
.
onLinkClick
.
bind
(
this
)
;
}
async
maybeLoadImage
(
)
{
const
{
image
}
=
this
.
props
.
link
;
if
(
!
this
.
state
.
imageLoaded
&
&
image
)
{
if
(
!
gImageLoading
.
has
(
image
)
)
{
const
loaderPromise
=
new
Promise
(
(
resolve
reject
)
=
>
{
const
loader
=
new
Image
(
)
;
loader
.
addEventListener
(
"
load
"
resolve
)
;
loader
.
addEventListener
(
"
error
"
reject
)
;
loader
.
src
=
image
;
}
)
;
gImageLoading
.
set
(
image
loaderPromise
)
;
loaderPromise
.
catch
(
ex
=
>
ex
)
.
then
(
(
)
=
>
gImageLoading
.
delete
(
image
)
)
.
catch
(
)
;
}
await
gImageLoading
.
get
(
image
)
;
if
(
this
.
props
.
link
.
image
=
=
=
image
&
&
!
this
.
state
.
imageLoaded
)
{
this
.
setState
(
{
imageLoaded
:
true
}
)
;
}
}
}
onMenuButtonClick
(
event
)
{
event
.
preventDefault
(
)
;
this
.
setState
(
{
activeCard
:
this
.
props
.
index
showContextMenu
:
true
}
)
;
}
onLinkClick
(
event
)
{
event
.
preventDefault
(
)
;
const
{
altKey
button
ctrlKey
metaKey
shiftKey
}
=
event
;
this
.
props
.
dispatch
(
Actions
[
"
a
"
]
.
SendToMain
(
{
type
:
Actions
[
"
b
"
]
.
OPEN_LINK
data
:
Object
.
assign
(
this
.
props
.
link
{
event
:
{
altKey
button
ctrlKey
metaKey
shiftKey
}
}
)
}
)
)
;
this
.
props
.
dispatch
(
Actions
[
"
a
"
]
.
UserEvent
(
{
event
:
"
CLICK
"
source
:
this
.
props
.
eventSource
action_position
:
this
.
props
.
index
}
)
)
;
if
(
this
.
props
.
shouldSendImpressionStats
)
{
this
.
props
.
dispatch
(
Actions
[
"
a
"
]
.
ImpressionStats
(
{
source
:
this
.
props
.
eventSource
click
:
0
tiles
:
[
{
id
:
this
.
props
.
link
.
guid
pos
:
this
.
props
.
index
}
]
}
)
)
;
}
}
onMenuUpdate
(
showContextMenu
)
{
this
.
setState
(
{
showContextMenu
}
)
;
}
componentDidMount
(
)
{
this
.
maybeLoadImage
(
)
;
}
componentDidUpdate
(
)
{
this
.
maybeLoadImage
(
)
;
}
componentWillReceiveProps
(
nextProps
)
{
if
(
nextProps
.
link
.
image
!
=
=
this
.
props
.
link
.
image
)
{
this
.
setState
(
{
imageLoaded
:
false
}
)
;
}
}
render
(
)
{
const
{
index
link
dispatch
contextMenuOptions
eventSource
shouldSendImpressionStats
}
=
this
.
props
;
const
{
props
}
=
this
;
const
isContextMenuOpen
=
this
.
state
.
showContextMenu
&
&
this
.
state
.
activeCard
=
=
=
index
;
const
{
icon
intlID
}
=
cardContextTypes
[
link
.
type
=
=
=
"
now
"
?
"
trending
"
:
link
.
type
]
|
|
{
}
;
const
hasImage
=
link
.
image
|
|
link
.
hasImage
;
const
imageStyle
=
{
backgroundImage
:
link
.
image
?
url
(
{
link
.
image
}
)
:
"
none
"
}
;
return
external__React__default
.
a
.
createElement
(
"
li
"
{
className
:
card
-
outer
{
isContextMenuOpen
?
"
active
"
:
"
"
}
{
props
.
placeholder
?
"
placeholder
"
:
"
"
}
}
external__React__default
.
a
.
createElement
(
"
a
"
{
href
:
link
.
url
onClick
:
!
props
.
placeholder
&
&
this
.
onLinkClick
}
external__React__default
.
a
.
createElement
(
"
div
"
{
className
:
"
card
"
}
hasImage
&
&
external__React__default
.
a
.
createElement
(
"
div
"
{
className
:
"
card
-
preview
-
image
-
outer
"
}
external__React__default
.
a
.
createElement
(
"
div
"
{
className
:
card
-
preview
-
image
{
this
.
state
.
imageLoaded
?
"
loaded
"
:
"
"
}
style
:
imageStyle
}
)
)
external__React__default
.
a
.
createElement
(
"
div
"
{
className
:
card
-
details
{
hasImage
?
"
"
:
"
no
-
image
"
}
}
link
.
hostname
&
&
external__React__default
.
a
.
createElement
(
"
div
"
{
className
:
"
card
-
host
-
name
"
}
link
.
hostname
)
external__React__default
.
a
.
createElement
(
"
div
"
{
className
:
[
"
card
-
text
"
icon
?
"
"
:
"
no
-
context
"
link
.
description
?
"
"
:
"
no
-
description
"
link
.
hostname
?
"
"
:
"
no
-
host
-
name
"
hasImage
?
"
"
:
"
no
-
image
"
]
.
join
(
"
"
)
}
external__React__default
.
a
.
createElement
(
"
h4
"
{
className
:
"
card
-
title
"
dir
:
"
auto
"
}
link
.
title
)
external__React__default
.
a
.
createElement
(
"
p
"
{
className
:
"
card
-
description
"
dir
:
"
auto
"
}
link
.
description
)
)
external__React__default
.
a
.
createElement
(
"
div
"
{
className
:
"
card
-
context
"
}
icon
&
&
!
link
.
context
&
&
external__React__default
.
a
.
createElement
(
"
span
"
{
className
:
card
-
context
-
icon
icon
icon
-
{
icon
}
}
)
link
.
icon
&
&
link
.
context
&
&
external__React__default
.
a
.
createElement
(
"
span
"
{
className
:
"
card
-
context
-
icon
icon
"
style
:
{
backgroundImage
:
url
(
'
{
link
.
icon
}
'
)
}
}
)
intlID
&
&
!
link
.
context
&
&
external__React__default
.
a
.
createElement
(
"
div
"
{
className
:
"
card
-
context
-
label
"
}
external__React__default
.
a
.
createElement
(
external__ReactIntl_
[
"
FormattedMessage
"
]
{
id
:
intlID
defaultMessage
:
"
Visited
"
}
)
)
link
.
context
&
&
external__React__default
.
a
.
createElement
(
"
div
"
{
className
:
"
card
-
context
-
label
"
}
link
.
context
)
)
)
)
)
!
props
.
placeholder
&
&
external__React__default
.
a
.
createElement
(
"
button
"
{
className
:
"
context
-
menu
-
button
icon
"
onClick
:
this
.
onMenuButtonClick
}
external__React__default
.
a
.
createElement
(
"
span
"
{
className
:
"
sr
-
only
"
}
Open
context
menu
for
{
link
.
title
}
)
)
!
props
.
placeholder
&
&
external__React__default
.
a
.
createElement
(
LinkMenu
[
"
a
"
]
{
dispatch
:
dispatch
index
:
index
source
:
eventSource
onUpdate
:
this
.
onMenuUpdate
options
:
link
.
contextMenuOptions
|
|
contextMenuOptions
site
:
link
visible
:
isContextMenuOpen
shouldSendImpressionStats
:
shouldSendImpressionStats
}
)
)
;
}
}
__webpack_exports__
[
"
a
"
]
=
Card_Card
;
Card_Card
.
defaultProps
=
{
link
:
{
}
}
;
const
PlaceholderCard
=
(
)
=
>
external__React__default
.
a
.
createElement
(
Card_Card
{
placeholder
:
true
}
)
;
__webpack_exports__
[
"
b
"
]
=
PlaceholderCard
;
}
)
(
function
(
module
__webpack_exports__
__webpack_require__
)
{
"
use
strict
"
;
var
__WEBPACK_IMPORTED_MODULE_0_react_intl__
=
__webpack_require__
(
2
)
;
var
__WEBPACK_IMPORTED_MODULE_0_react_intl___default
=
__webpack_require__
.
n
(
__WEBPACK_IMPORTED_MODULE_0_react_intl__
)
;
var
__WEBPACK_IMPORTED_MODULE_1_react__
=
__webpack_require__
(
1
)
;
var
__WEBPACK_IMPORTED_MODULE_1_react___default
=
__webpack_require__
.
n
(
__WEBPACK_IMPORTED_MODULE_1_react__
)
;
class
Topic
extends
__WEBPACK_IMPORTED_MODULE_1_react___default
.
a
.
PureComponent
{
render
(
)
{
const
{
url
name
}
=
this
.
props
;
return
__WEBPACK_IMPORTED_MODULE_1_react___default
.
a
.
createElement
(
"
li
"
null
__WEBPACK_IMPORTED_MODULE_1_react___default
.
a
.
createElement
(
"
a
"
{
key
:
name
className
:
"
topic
-
link
"
href
:
url
}
name
)
)
;
}
}
class
Topics
extends
__WEBPACK_IMPORTED_MODULE_1_react___default
.
a
.
PureComponent
{
render
(
)
{
const
{
topics
read_more_endpoint
}
=
this
.
props
;
return
__WEBPACK_IMPORTED_MODULE_1_react___default
.
a
.
createElement
(
"
div
"
{
className
:
"
topic
"
}
__WEBPACK_IMPORTED_MODULE_1_react___default
.
a
.
createElement
(
"
span
"
null
__WEBPACK_IMPORTED_MODULE_1_react___default
.
a
.
createElement
(
__WEBPACK_IMPORTED_MODULE_0_react_intl__
[
"
FormattedMessage
"
]
{
id
:
"
pocket_read_more
"
}
)
)
__WEBPACK_IMPORTED_MODULE_1_react___default
.
a
.
createElement
(
"
ul
"
null
topics
&
&
topics
.
map
(
t
=
>
__WEBPACK_IMPORTED_MODULE_1_react___default
.
a
.
createElement
(
Topic
{
key
:
t
.
name
url
:
t
.
url
name
:
t
.
name
}
)
)
)
read_more_endpoint
&
&
__WEBPACK_IMPORTED_MODULE_1_react___default
.
a
.
createElement
(
"
a
"
{
className
:
"
topic
-
read
-
more
"
href
:
read_more_endpoint
}
__WEBPACK_IMPORTED_MODULE_1_react___default
.
a
.
createElement
(
__WEBPACK_IMPORTED_MODULE_0_react_intl__
[
"
FormattedMessage
"
]
{
id
:
"
pocket_read_even_more
"
}
)
)
)
;
}
}
__webpack_exports__
[
"
a
"
]
=
Topics
;
}
)
(
function
(
module
__webpack_exports__
__webpack_require__
)
{
"
use
strict
"
;
(
function
(
global
)
{
var
__WEBPACK_IMPORTED_MODULE_0_common_Actions_jsm__
=
__webpack_require__
(
0
)
;
var
__WEBPACK_IMPORTED_MODULE_1_common_PerfService_jsm__
=
__webpack_require__
(
9
)
;
const
VISIBLE
=
"
visible
"
;
const
VISIBILITY_CHANGE_EVENT
=
"
visibilitychange
"
;
class
DetectUserSessionStart
{
constructor
(
store
options
=
{
}
)
{
this
.
_store
=
store
;
this
.
document
=
options
.
document
|
|
global
.
document
;
this
.
_perfService
=
options
.
perfService
|
|
__WEBPACK_IMPORTED_MODULE_1_common_PerfService_jsm__
[
"
a
"
]
;
this
.
_onVisibilityChange
=
this
.
_onVisibilityChange
.
bind
(
this
)
;
}
sendEventOrAddListener
(
)
{
if
(
this
.
document
.
visibilityState
=
=
=
VISIBLE
)
{
this
.
_sendEvent
(
)
;
}
else
{
this
.
document
.
addEventListener
(
VISIBILITY_CHANGE_EVENT
this
.
_onVisibilityChange
)
;
}
}
_sendEvent
(
)
{
this
.
_perfService
.
mark
(
"
visibility_event_rcvd_ts
"
)
;
try
{
let
visibility_event_rcvd_ts
=
this
.
_perfService
.
getMostRecentAbsMarkStartByName
(
"
visibility_event_rcvd_ts
"
)
;
this
.
_store
.
dispatch
(
__WEBPACK_IMPORTED_MODULE_0_common_Actions_jsm__
[
"
a
"
]
.
SendToMain
(
{
type
:
__WEBPACK_IMPORTED_MODULE_0_common_Actions_jsm__
[
"
b
"
]
.
SAVE_SESSION_PERF_DATA
data
:
{
visibility_event_rcvd_ts
}
}
)
)
;
}
catch
(
ex
)
{
}
}
_onVisibilityChange
(
)
{
if
(
this
.
document
.
visibilityState
=
=
=
VISIBLE
)
{
this
.
_sendEvent
(
)
;
this
.
document
.
removeEventListener
(
VISIBILITY_CHANGE_EVENT
this
.
_onVisibilityChange
)
;
}
}
}
__webpack_exports__
[
"
a
"
]
=
DetectUserSessionStart
;
}
.
call
(
__webpack_exports__
__webpack_require__
(
4
)
)
)
}
)
(
function
(
module
__webpack_exports__
__webpack_require__
)
{
"
use
strict
"
;
(
function
(
global
)
{
__webpack_exports__
[
"
a
"
]
=
initStore
;
var
__WEBPACK_IMPORTED_MODULE_0_common_Actions_jsm__
=
__webpack_require__
(
0
)
;
var
__WEBPACK_IMPORTED_MODULE_1_redux__
=
__webpack_require__
(
19
)
;
var
__WEBPACK_IMPORTED_MODULE_1_redux___default
=
__webpack_require__
.
n
(
__WEBPACK_IMPORTED_MODULE_1_redux__
)
;
const
MERGE_STORE_ACTION
=
"
NEW_TAB_INITIAL_STATE
"
;
const
OUTGOING_MESSAGE_NAME
=
"
ActivityStream
:
ContentToMain
"
;
const
INCOMING_MESSAGE_NAME
=
"
ActivityStream
:
MainToContent
"
;
const
EARLY_QUEUED_ACTIONS
=
[
__WEBPACK_IMPORTED_MODULE_0_common_Actions_jsm__
[
"
b
"
]
.
SAVE_SESSION_PERF_DATA
__WEBPACK_IMPORTED_MODULE_0_common_Actions_jsm__
[
"
b
"
]
.
PAGE_PRERENDERED
]
;
function
mergeStateReducer
(
mainReducer
)
{
return
(
prevState
action
)
=
>
{
if
(
action
.
type
=
=
=
MERGE_STORE_ACTION
)
{
return
Object
.
assign
(
{
}
prevState
action
.
data
)
;
}
return
mainReducer
(
prevState
action
)
;
}
;
}
const
messageMiddleware
=
store
=
>
next
=
>
action
=
>
{
if
(
__WEBPACK_IMPORTED_MODULE_0_common_Actions_jsm__
[
"
c
"
]
.
isSendToMain
(
action
)
)
{
sendAsyncMessage
(
OUTGOING_MESSAGE_NAME
action
)
;
}
next
(
action
)
;
}
;
const
rehydrationMiddleware
=
store
=
>
next
=
>
action
=
>
{
if
(
store
.
_didRehydrate
)
{
return
next
(
action
)
;
}
const
isMergeStoreAction
=
action
.
type
=
=
=
MERGE_STORE_ACTION
;
const
isRehydrationRequest
=
action
.
type
=
=
=
__WEBPACK_IMPORTED_MODULE_0_common_Actions_jsm__
[
"
b
"
]
.
NEW_TAB_STATE_REQUEST
;
if
(
isRehydrationRequest
)
{
store
.
_didRequestInitialState
=
true
;
return
next
(
action
)
;
}
if
(
isMergeStoreAction
)
{
store
.
_didRehydrate
=
true
;
return
next
(
action
)
;
}
if
(
store
.
_didRequestInitialState
&
&
action
.
type
=
=
=
__WEBPACK_IMPORTED_MODULE_0_common_Actions_jsm__
[
"
b
"
]
.
INIT
)
{
return
next
(
__WEBPACK_IMPORTED_MODULE_0_common_Actions_jsm__
[
"
a
"
]
.
SendToMain
(
{
type
:
__WEBPACK_IMPORTED_MODULE_0_common_Actions_jsm__
[
"
b
"
]
.
NEW_TAB_STATE_REQUEST
}
)
)
;
}
if
(
__WEBPACK_IMPORTED_MODULE_0_common_Actions_jsm__
[
"
c
"
]
.
isBroadcastToContent
(
action
)
|
|
__WEBPACK_IMPORTED_MODULE_0_common_Actions_jsm__
[
"
c
"
]
.
isSendToContent
(
action
)
|
|
__WEBPACK_IMPORTED_MODULE_0_common_Actions_jsm__
[
"
c
"
]
.
isSendToPreloaded
(
action
)
)
{
return
null
;
}
return
next
(
action
)
;
}
;
const
queueEarlyMessageMiddleware
=
store
=
>
next
=
>
action
=
>
{
if
(
store
.
_receivedFromMain
)
{
next
(
action
)
;
}
else
if
(
__WEBPACK_IMPORTED_MODULE_0_common_Actions_jsm__
[
"
c
"
]
.
isFromMain
(
action
)
)
{
next
(
action
)
;
store
.
_receivedFromMain
=
true
;
if
(
store
.
_earlyActionQueue
)
{
store
.
_earlyActionQueue
.
forEach
(
next
)
;
store
.
_earlyActionQueue
=
[
]
;
}
}
else
if
(
EARLY_QUEUED_ACTIONS
.
includes
(
action
.
type
)
)
{
store
.
_earlyActionQueue
=
store
.
_earlyActionQueue
|
|
[
]
;
store
.
_earlyActionQueue
.
push
(
action
)
;
}
else
{
next
(
action
)
;
}
}
;
function
initStore
(
reducers
initialState
)
{
const
store
=
Object
(
__WEBPACK_IMPORTED_MODULE_1_redux__
[
"
createStore
"
]
)
(
mergeStateReducer
(
Object
(
__WEBPACK_IMPORTED_MODULE_1_redux__
[
"
combineReducers
"
]
)
(
reducers
)
)
initialState
global
.
addMessageListener
&
&
Object
(
__WEBPACK_IMPORTED_MODULE_1_redux__
[
"
applyMiddleware
"
]
)
(
rehydrationMiddleware
queueEarlyMessageMiddleware
messageMiddleware
)
)
;
store
.
_didRehydrate
=
false
;
store
.
_didRequestInitialState
=
false
;
if
(
global
.
addMessageListener
)
{
global
.
addMessageListener
(
INCOMING_MESSAGE_NAME
msg
=
>
{
try
{
store
.
dispatch
(
msg
.
data
)
;
}
catch
(
ex
)
{
console
.
error
(
"
Content
msg
:
"
msg
"
Dispatch
error
:
"
ex
)
;
dump
(
Content
msg
:
{
JSON
.
stringify
(
msg
)
}
\
nDispatch
error
:
{
ex
}
\
n
{
ex
.
stack
}
)
;
}
}
)
;
}
return
store
;
}
}
.
call
(
__webpack_exports__
__webpack_require__
(
4
)
)
)
}
)
(
function
(
module
exports
)
{
module
.
exports
=
Redux
;
}
)
(
function
(
module
exports
)
{
module
.
exports
=
ReactDOM
;
}
)
]
)
;
