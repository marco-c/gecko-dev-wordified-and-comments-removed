"
use
strict
"
;
const
{
utils
:
Cu
}
=
Components
;
Cu
.
import
(
"
resource
:
/
/
gre
/
modules
/
XPCOMUtils
.
jsm
"
)
;
Cu
.
import
(
"
resource
:
/
/
gre
/
modules
/
Preferences
.
jsm
"
)
;
XPCOMUtils
.
defineLazyModuleGetter
(
this
"
ActivityStream
"
"
resource
:
/
/
activity
-
stream
/
lib
/
ActivityStream
.
jsm
"
)
;
const
ACTIVITY_STREAM_ENABLED_PREF
=
"
browser
.
newtabpage
.
activity
-
stream
.
enabled
"
;
const
REASON_STARTUP_ON_PREF_CHANGE
=
"
PREF_ON
"
;
const
REASON_SHUTDOWN_ON_PREF_CHANGE
=
"
PREF_OFF
"
;
const
ACTIVITY_STREAM_OPTIONS
=
{
newTabURL
:
"
about
:
newtab
"
}
;
let
activityStream
;
let
startupData
;
function
init
(
reason
)
{
if
(
activityStream
&
&
activityStream
.
initialized
)
{
return
;
}
const
options
=
Object
.
assign
(
{
}
startupData
|
|
{
}
ACTIVITY_STREAM_OPTIONS
)
;
activityStream
=
new
ActivityStream
(
options
)
;
activityStream
.
init
(
reason
)
;
}
function
uninit
(
reason
)
{
if
(
activityStream
)
{
activityStream
.
uninit
(
reason
)
;
activityStream
=
null
;
}
}
function
onPrefChanged
(
isEnabled
)
{
if
(
isEnabled
)
{
init
(
REASON_STARTUP_ON_PREF_CHANGE
)
;
}
else
{
uninit
(
REASON_SHUTDOWN_ON_PREF_CHANGE
)
;
}
}
this
.
install
=
function
install
(
data
reason
)
{
}
;
this
.
startup
=
function
startup
(
data
reason
)
{
startupData
=
data
;
Preferences
.
observe
(
ACTIVITY_STREAM_ENABLED_PREF
onPrefChanged
)
;
if
(
Preferences
.
get
(
ACTIVITY_STREAM_ENABLED_PREF
)
)
{
init
(
reason
)
;
}
}
;
this
.
shutdown
=
function
shutdown
(
data
reason
)
{
startupData
=
null
;
uninit
(
reason
)
;
Preferences
.
ignore
(
ACTIVITY_STREAM_ENABLED_PREF
onPrefChanged
)
;
}
;
this
.
uninstall
=
function
uninstall
(
data
reason
)
{
}
;
