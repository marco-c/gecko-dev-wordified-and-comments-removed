"
use
strict
"
;
test_newtab
(
function
topsites_edit
(
)
{
const
topsitesAddBtn
=
content
.
document
.
querySelector
(
"
.
add
-
topsites
-
button
button
"
)
;
topsitesAddBtn
.
click
(
)
;
let
found
=
content
.
document
.
querySelector
(
"
.
topsite
-
form
"
)
;
ok
(
found
&
&
!
found
.
hidden
"
Should
find
a
visible
topsite
form
"
)
;
found
=
content
.
document
.
querySelector
(
"
.
modal
-
overlay
"
)
;
ok
(
found
&
&
!
found
.
hidden
"
Should
find
a
visible
overlay
"
)
;
}
)
;
test_newtab
(
{
async
before
(
{
pushPrefs
}
)
{
await
pushPrefs
(
[
"
browser
.
newtabpage
.
activity
-
stream
.
default
.
sites
"
"
https
:
/
/
www
.
youtube
.
com
/
https
:
/
/
www
.
facebook
.
com
/
https
:
/
/
www
.
amazon
.
com
/
https
:
/
/
www
.
reddit
.
com
/
https
:
/
/
www
.
wikipedia
.
org
/
https
:
/
/
twitter
.
com
/
"
]
)
;
await
pushPrefs
(
[
"
browser
.
newtabpage
.
activity
-
stream
.
feeds
.
topsites
"
false
]
)
;
await
pushPrefs
(
[
"
browser
.
newtabpage
.
activity
-
stream
.
feeds
.
topsites
"
true
]
)
;
}
test
:
async
function
topsites_pin_unpin
(
)
{
await
ContentTaskUtils
.
waitForCondition
(
(
)
=
>
content
.
document
.
querySelector
(
"
.
top
-
site
-
icon
"
)
"
Topsite
tippytop
icon
not
found
"
)
;
const
topsiteContextBtn
=
content
.
document
.
querySelector
(
"
.
context
-
menu
-
button
"
)
;
topsiteContextBtn
.
click
(
)
;
const
contextMenu
=
content
.
document
.
querySelector
(
"
.
context
-
menu
"
)
;
ok
(
contextMenu
&
&
!
contextMenu
.
hidden
"
Should
find
a
visible
topsite
context
menu
"
)
;
const
pinUnpinTopsiteBtn
=
contextMenu
.
querySelector
(
"
.
context
-
menu
-
item
a
"
)
;
pinUnpinTopsiteBtn
.
click
(
)
;
await
ContentTaskUtils
.
waitForCondition
(
(
)
=
>
content
.
document
.
querySelector
(
"
.
icon
-
pin
-
small
"
)
"
No
pinned
icon
found
"
)
;
let
pinnedIcon
=
content
.
document
.
querySelectorAll
(
"
.
icon
-
pin
-
small
"
)
.
length
;
is
(
pinnedIcon
1
"
should
find
1
pinned
topsite
"
)
;
pinUnpinTopsiteBtn
.
click
(
)
;
await
ContentTaskUtils
.
waitForCondition
(
(
)
=
>
!
content
.
document
.
querySelector
(
"
.
icon
-
pin
-
small
"
)
"
Topsite
should
be
unpinned
"
)
;
}
}
)
;
