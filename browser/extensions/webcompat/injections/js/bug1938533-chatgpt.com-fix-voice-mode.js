"
use
strict
"
;
console
.
info
(
"
RTCPeerConnection
is
being
shimmed
for
compatibility
reasons
.
See
https
:
/
/
bugzilla
.
mozilla
.
org
/
show_bug
.
cgi
?
id
=
1938533
for
details
.
"
)
;
const
win
=
window
.
wrappedJSObject
;
const
origRTCPeerConnection
=
win
.
RTCPeerConnection
;
win
.
RTCPeerConnection
=
exportFunction
(
function
(
cfg
=
{
}
)
{
const
extra
=
[
{
urls
:
"
stun
:
stun
.
l
.
google
.
com
:
19302
"
}
]
;
const
merged
=
{
.
.
.
cfg
iceServers
:
[
.
.
.
(
cfg
.
iceServers
|
|
[
]
)
.
.
.
extra
]
}
;
const
pc
=
new
origRTCPeerConnection
(
merged
)
;
pc
.
addEventListener
(
"
icecandidateerror
"
e
=
>
console
.
warn
(
"
ICE
error
"
e
)
)
;
pc
.
addEventListener
(
"
iceconnectionstatechange
"
(
)
=
>
console
.
log
(
"
iceConnectionState
"
pc
.
iceConnectionState
)
)
;
return
pc
;
}
window
)
;
win
.
RTCPeerConnection
.
prototype
=
origRTCPeerConnection
.
prototype
;
