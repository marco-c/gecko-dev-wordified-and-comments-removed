"
use
strict
"
;
console
.
info
(
'
getDisplayMedia
has
been
modified
to
drop
resizeMode
:
"
none
"
for
compatibility
reasons
.
See
https
:
/
/
bugzilla
.
mozilla
.
org
/
show_bug
.
cgi
?
id
=
2000906
for
details
.
'
)
;
function
maybeDeleteResizeMode
(
video
)
{
const
{
resizeMode
width
height
frameRate
}
=
video
;
if
(
resizeMode
=
=
"
none
"
&
&
(
width
|
|
height
|
|
frameRate
)
)
{
delete
video
.
resizeMode
;
}
}
if
(
navigator
.
mediaDevices
?
.
getDisplayMedia
)
{
{
const
{
prototype
}
=
MediaDevices
.
wrappedJSObject
;
const
{
getDisplayMedia
:
gDM
}
=
prototype
;
prototype
.
getDisplayMedia
=
exportFunction
(
function
getDisplayMedia
(
options
)
{
const
{
video
}
=
options
|
|
{
}
;
if
(
video
)
{
maybeDeleteResizeMode
(
video
)
;
}
return
gDM
.
call
(
this
options
)
;
}
window
)
;
}
{
const
{
prototype
}
=
MediaStreamTrack
.
wrappedJSObject
;
const
{
applyConstraints
:
aC
}
=
prototype
;
prototype
.
applyConstraints
=
exportFunction
(
function
applyConstraints
(
constraints
)
{
if
(
!
this
.
getConstraints
(
)
.
resizeMode
)
{
maybeDeleteResizeMode
(
constraints
|
|
{
}
)
;
}
return
aC
.
call
(
this
constraints
)
;
}
window
)
;
}
}
