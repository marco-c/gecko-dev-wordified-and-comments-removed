"
use
strict
"
;
ChromeUtils
.
defineModuleGetter
(
this
"
Services
"
"
resource
:
/
/
gre
/
modules
/
Services
.
jsm
"
)
;
XPCOMUtils
.
defineLazyServiceGetter
(
this
"
resProto
"
"
mozilla
.
org
/
network
/
protocol
;
1
?
name
=
resource
"
"
nsISubstitutingProtocolHandler
"
)
;
const
ResourceSubstitution
=
"
webcompat
"
;
const
ProcessScriptURL
=
"
resource
:
/
/
webcompat
/
aboutPageProcessScript
.
js
"
;
const
ContractID
=
"
mozilla
.
org
/
network
/
protocol
/
about
;
1
?
what
=
compat
"
;
this
.
aboutPage
=
class
extends
ExtensionAPI
{
onStartup
(
)
{
const
{
rootURI
}
=
this
.
extension
;
resProto
.
setSubstitution
(
ResourceSubstitution
Services
.
io
.
newURI
(
"
about
-
compat
/
"
null
rootURI
)
)
;
if
(
!
(
ContractID
in
Cc
)
)
{
Services
.
ppmm
.
loadProcessScript
(
ProcessScriptURL
true
)
;
this
.
processScriptRegistered
=
true
;
}
}
onShutdown
(
)
{
resProto
.
setSubstitution
(
ResourceSubstitution
null
)
;
if
(
this
.
processScriptRegistered
)
{
Services
.
ppmm
.
removeDelayedProcessScript
(
ProcessScriptURL
)
;
}
}
}
;
