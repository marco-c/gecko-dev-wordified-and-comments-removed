"
use
strict
"
;
class
LightweightThemeChildListener
{
constructor
(
)
{
this
.
whitelist
=
new
Set
(
[
"
about
:
home
"
"
about
:
newtab
"
"
about
:
welcome
"
]
)
;
this
.
_lastData
=
null
;
}
receiveMessage
(
{
name
data
target
}
)
{
if
(
name
=
=
"
LightweightTheme
:
Update
"
)
{
this
.
_lastData
=
data
;
this
.
_update
(
data
target
.
content
)
;
}
}
handleEvent
(
event
)
{
const
content
=
event
.
originalTarget
.
defaultView
;
if
(
content
!
=
content
.
top
)
{
return
;
}
if
(
event
.
type
=
=
"
LightweightTheme
:
Support
"
)
{
this
.
_update
(
this
.
_lastData
content
)
;
}
}
_isContentWhitelisted
(
content
)
{
return
this
.
whitelist
.
has
(
content
.
document
.
documentURI
)
;
}
_update
(
data
content
)
{
if
(
this
.
_isContentWhitelisted
(
content
)
)
{
const
event
=
Cu
.
cloneInto
(
{
detail
:
{
type
:
"
LightweightTheme
:
Update
"
data
}
}
content
)
;
content
.
dispatchEvent
(
new
content
.
CustomEvent
(
"
LightweightTheme
:
Set
"
event
)
)
;
}
}
}
var
EXPORTED_SYMBOLS
=
[
"
LightweightThemeChildListener
"
]
;
