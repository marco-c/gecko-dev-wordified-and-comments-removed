#
include
"
GfxTexturesReporter
.
h
"
#
ifdef
MOZ_CRASHREPORTER
#
include
"
nsExceptionHandler
.
h
"
#
endif
using
namespace
mozilla
;
using
namespace
mozilla
:
:
gl
;
NS_IMPL_ISUPPORTS
(
GfxTexturesReporter
nsIMemoryReporter
)
Atomic
<
size_t
>
GfxTexturesReporter
:
:
sAmount
(
0
)
;
Atomic
<
size_t
>
GfxTexturesReporter
:
:
sPeakAmount
(
0
)
;
Atomic
<
size_t
>
GfxTexturesReporter
:
:
sTileWasteAmount
(
0
)
;
void
GfxTexturesReporter
:
:
UpdateAmount
(
MemoryUse
action
size_t
amount
)
{
if
(
action
=
=
MemoryFreed
)
{
MOZ_RELEASE_ASSERT
(
amount
<
=
sAmount
)
;
sAmount
-
=
amount
;
}
else
{
sAmount
+
=
amount
;
if
(
sAmount
>
sPeakAmount
)
{
sPeakAmount
.
exchange
(
sAmount
)
;
}
}
#
ifdef
MOZ_CRASHREPORTER
CrashReporter
:
:
AnnotateTexturesSize
(
sAmount
)
;
#
endif
}
