#
ifndef
GFX_CORETEXTSHAPER_H
#
define
GFX_CORETEXTSHAPER_H
#
include
"
gfxFont
.
h
"
#
include
<
ApplicationServices
/
ApplicationServices
.
h
>
class
gfxMacFont
;
class
gfxCoreTextShaper
:
public
gfxFontShaper
{
public
:
explicit
gfxCoreTextShaper
(
gfxMacFont
*
aFont
)
;
virtual
~
gfxCoreTextShaper
(
)
;
bool
ShapeText
(
DrawTarget
*
aDrawTarget
const
char16_t
*
aText
uint32_t
aOffset
uint32_t
aLength
Script
aScript
nsAtom
*
aLanguage
bool
aVertical
RoundingFlags
aRounding
gfxShapedText
*
aShapedText
)
override
;
static
void
Shutdown
(
)
;
enum
FeatureFlags
:
uint8_t
{
kDefaultFeatures
=
0x00
kDisableLigatures
=
0x01
kAddSmallCaps
=
0x02
kIndicFeatures
=
0x04
kMaxFontInstances
=
8
}
;
protected
:
CTFontRef
mCTFont
[
kMaxFontInstances
]
;
CFDictionaryRef
mAttributesDictLTR
;
CFDictionaryRef
mAttributesDictRTL
;
nsresult
SetGlyphsFromRun
(
gfxShapedText
*
aShapedText
uint32_t
aOffset
uint32_t
aLength
CTRunRef
aCTRun
)
;
CTFontRef
CreateCTFontWithFeatures
(
CGFloat
aSize
CTFontDescriptorRef
aDescriptor
)
;
CFDictionaryRef
CreateAttrDict
(
bool
aRightToLeft
)
;
CFDictionaryRef
CreateAttrDictWithoutDirection
(
)
;
static
CTFontDescriptorRef
CreateFontFeaturesDescriptor
(
const
std
:
:
pair
<
SInt16
SInt16
>
*
aFeatures
size_t
aCount
)
;
static
CTFontDescriptorRef
GetFeaturesDescriptor
(
FeatureFlags
aFeatureFlags
)
;
static
CTFontDescriptorRef
sFeaturesDescriptor
[
kMaxFontInstances
]
;
}
;
MOZ_MAKE_ENUM_CLASS_BITWISE_OPERATORS
(
gfxCoreTextShaper
:
:
FeatureFlags
)
#
endif
