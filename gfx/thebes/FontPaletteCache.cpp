#
include
"
FontPaletteCache
.
h
"
#
include
"
COLRFonts
.
h
"
using
namespace
mozilla
;
void
gfx
:
:
PaletteCache
:
:
SetPaletteValueSet
(
const
gfx
:
:
FontPaletteValueSet
*
aSet
)
{
mPaletteValueSet
=
aSet
;
Clear
(
)
;
}
nsTArray
<
gfx
:
:
sRGBColor
>
*
gfx
:
:
PaletteCache
:
:
GetPaletteFor
(
gfxFontEntry
*
aFontEntry
nsAtom
*
aPaletteName
)
{
auto
entry
=
Lookup
(
std
:
:
pair
(
aFontEntry
aPaletteName
)
)
;
if
(
!
entry
)
{
CacheData
newData
;
newData
.
mKey
=
std
:
:
pair
(
aFontEntry
aPaletteName
)
;
gfxFontEntry
:
:
AutoHBFace
face
=
aFontEntry
-
>
GetHBFace
(
)
;
newData
.
mPalette
=
gfx
:
:
COLRFonts
:
:
SetupColorPalette
(
face
mPaletteValueSet
aPaletteName
aFontEntry
-
>
FamilyName
(
)
)
;
entry
.
Set
(
std
:
:
move
(
newData
)
)
;
}
return
entry
.
Data
(
)
.
mPalette
.
get
(
)
;
}
