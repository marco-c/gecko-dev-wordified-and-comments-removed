#
include
"
FontPaletteCache
.
h
"
#
include
"
COLRFonts
.
h
"
#
include
"
gfxFontEntry
.
h
"
using
namespace
mozilla
;
void
gfx
:
:
PaletteCache
:
:
SetPaletteValueSet
(
const
gfx
:
:
FontPaletteValueSet
*
aSet
)
{
mPaletteValueSet
=
aSet
;
Clear
(
)
;
}
already_AddRefed
<
gfx
:
:
FontPalette
>
gfx
:
:
PaletteCache
:
:
GetPaletteFor
(
gfxFontEntry
*
aFontEntry
nsAtom
*
aPaletteName
)
{
auto
entry
=
Lookup
(
std
:
:
pair
(
aFontEntry
aPaletteName
)
)
;
if
(
!
entry
)
{
CacheData
newData
;
newData
.
mKey
=
std
:
:
pair
(
aFontEntry
aPaletteName
)
;
gfxFontEntry
:
:
AutoHBFace
face
=
aFontEntry
-
>
GetHBFace
(
)
;
newData
.
mPalette
=
new
FontPalette
(
gfx
:
:
COLRFonts
:
:
CreateColorPalette
(
face
mPaletteValueSet
aPaletteName
aFontEntry
-
>
FamilyName
(
)
)
)
;
entry
.
Set
(
std
:
:
move
(
newData
)
)
;
}
RefPtr
result
=
entry
.
Data
(
)
.
mPalette
;
return
result
.
forget
(
)
;
}
