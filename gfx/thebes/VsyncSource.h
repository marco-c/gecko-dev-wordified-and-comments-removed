#
ifndef
GFX_VSYNCSOURCE_H
#
define
GFX_VSYNCSOURCE_H
#
include
"
nsTArray
.
h
"
#
include
"
mozilla
/
RefPtr
.
h
"
#
include
"
mozilla
/
Mutex
.
h
"
#
include
"
mozilla
/
TimeStamp
.
h
"
#
include
"
nsISupportsImpl
.
h
"
namespace
mozilla
{
class
RefreshTimerVsyncDispatcher
;
class
CompositorVsyncDispatcher
;
namespace
gfx
{
class
VsyncSource
{
NS_INLINE_DECL_THREADSAFE_REFCOUNTING
(
VsyncSource
)
typedef
mozilla
:
:
RefreshTimerVsyncDispatcher
RefreshTimerVsyncDispatcher
;
typedef
mozilla
:
:
CompositorVsyncDispatcher
CompositorVsyncDispatcher
;
public
:
class
Display
{
public
:
Display
(
)
;
virtual
~
Display
(
)
;
virtual
void
NotifyVsync
(
TimeStamp
aVsyncTimestamp
)
;
RefPtr
<
RefreshTimerVsyncDispatcher
>
GetRefreshTimerVsyncDispatcher
(
)
;
void
AddCompositorVsyncDispatcher
(
CompositorVsyncDispatcher
*
aCompositorVsyncDispatcher
)
;
void
RemoveCompositorVsyncDispatcher
(
CompositorVsyncDispatcher
*
aCompositorVsyncDispatcher
)
;
void
NotifyRefreshTimerVsyncStatus
(
bool
aEnable
)
;
virtual
TimeDuration
GetVsyncRate
(
)
;
virtual
void
EnableVsync
(
)
=
0
;
virtual
void
DisableVsync
(
)
=
0
;
virtual
bool
IsVsyncEnabled
(
)
=
0
;
virtual
void
Shutdown
(
)
=
0
;
private
:
void
UpdateVsyncStatus
(
)
;
Mutex
mDispatcherLock
;
bool
mRefreshTimerNeedsVsync
;
nsTArray
<
RefPtr
<
CompositorVsyncDispatcher
>
>
mCompositorVsyncDispatchers
;
RefPtr
<
RefreshTimerVsyncDispatcher
>
mRefreshTimerVsyncDispatcher
;
}
;
void
AddCompositorVsyncDispatcher
(
CompositorVsyncDispatcher
*
aCompositorVsyncDispatcher
)
;
void
RemoveCompositorVsyncDispatcher
(
CompositorVsyncDispatcher
*
aCompositorVsyncDispatcher
)
;
RefPtr
<
RefreshTimerVsyncDispatcher
>
GetRefreshTimerVsyncDispatcher
(
)
;
virtual
Display
&
GetGlobalDisplay
(
)
=
0
;
void
Shutdown
(
)
;
protected
:
virtual
~
VsyncSource
(
)
{
}
}
;
}
}
#
endif
