#
ifndef
_include_mozilla_gfx_ipc_GPUProcessManager_h_
#
define
_include_mozilla_gfx_ipc_GPUProcessManager_h_
#
include
"
base
/
basictypes
.
h
"
#
include
"
base
/
process
.
h
"
#
include
"
Units
.
h
"
#
include
"
mozilla
/
dom
/
ipc
/
IdType
.
h
"
#
include
"
mozilla
/
ipc
/
Transport
.
h
"
namespace
mozilla
{
namespace
layers
{
class
APZCTreeManager
;
class
CompositorSession
;
class
ClientLayerManager
;
class
CompositorUpdateObserver
;
class
PCompositorBridgeParent
;
}
namespace
widget
{
class
CompositorWidgetProxy
;
}
namespace
dom
{
class
ContentParent
;
class
TabParent
;
}
namespace
ipc
{
class
GeckoChildProcessHost
;
}
namespace
gfx
{
class
GPUProcessManager
final
{
typedef
layers
:
:
APZCTreeManager
APZCTreeManager
;
typedef
layers
:
:
CompositorUpdateObserver
CompositorUpdateObserver
;
public
:
static
void
Initialize
(
)
;
static
void
Shutdown
(
)
;
static
GPUProcessManager
*
Get
(
)
;
~
GPUProcessManager
(
)
;
already_AddRefed
<
layers
:
:
CompositorSession
>
CreateTopLevelCompositor
(
widget
:
:
CompositorWidgetProxy
*
aProxy
layers
:
:
ClientLayerManager
*
aLayerManager
CSSToLayoutDeviceScale
aScale
bool
aUseAPZ
bool
aUseExternalSurfaceSize
int
aSurfaceWidth
int
aSurfaceHeight
)
;
layers
:
:
PCompositorBridgeParent
*
CreateTabCompositorBridge
(
ipc
:
:
Transport
*
aTransport
base
:
:
ProcessId
aOtherProcess
ipc
:
:
GeckoChildProcessHost
*
aSubprocess
)
;
already_AddRefed
<
APZCTreeManager
>
GetAPZCTreeManagerForLayers
(
uint64_t
aLayersId
)
;
uint64_t
AllocateLayerTreeId
(
)
;
void
DeallocateLayerTreeId
(
uint64_t
aLayersId
)
;
void
RequestNotifyLayerTreeReady
(
uint64_t
aLayersId
CompositorUpdateObserver
*
aObserver
)
;
void
RequestNotifyLayerTreeCleared
(
uint64_t
aLayersId
CompositorUpdateObserver
*
aObserver
)
;
void
SwapLayerTreeObservers
(
uint64_t
aLayer
uint64_t
aOtherLayer
)
;
bool
UpdateRemoteContentController
(
uint64_t
aLayersId
dom
:
:
ContentParent
*
aContentParent
const
dom
:
:
TabId
&
aTabId
dom
:
:
TabParent
*
aBrowserParent
)
;
private
:
GPUProcessManager
(
)
;
DISALLOW_COPY_AND_ASSIGN
(
GPUProcessManager
)
;
}
;
}
}
#
endif
