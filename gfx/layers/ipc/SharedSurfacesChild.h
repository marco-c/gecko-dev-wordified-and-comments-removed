#
ifndef
MOZILLA_GFX_SHAREDSURFACESCHILD_H
#
define
MOZILLA_GFX_SHAREDSURFACESCHILD_H
#
include
<
stddef
.
h
>
#
include
<
stdint
.
h
>
#
include
"
mozilla
/
Attributes
.
h
"
#
include
"
mozilla
/
Maybe
.
h
"
#
include
"
mozilla
/
RefPtr
.
h
"
#
include
"
mozilla
/
StaticPtr
.
h
"
#
include
"
mozilla
/
gfx
/
UserData
.
h
"
#
include
"
mozilla
/
webrender
/
WebRenderTypes
.
h
"
namespace
mozilla
{
namespace
gfx
{
class
SourceSurfaceSharedData
;
}
namespace
wr
{
class
IpcResourceUpdateQueue
;
}
namespace
layers
{
class
CompositorManagerChild
;
class
ImageContainer
;
class
WebRenderLayerManager
;
class
SharedSurfacesChild
final
{
public
:
static
void
Share
(
gfx
:
:
SourceSurfaceSharedData
*
aSurface
)
;
static
nsresult
Share
(
gfx
:
:
SourceSurface
*
aSurface
wr
:
:
ExternalImageId
&
aId
)
;
static
nsresult
Share
(
gfx
:
:
SourceSurfaceSharedData
*
aSurface
WebRenderLayerManager
*
aManager
wr
:
:
IpcResourceUpdateQueue
&
aResources
wr
:
:
ImageKey
&
aKey
)
;
static
nsresult
Share
(
ImageContainer
*
aContainer
WebRenderLayerManager
*
aManager
wr
:
:
IpcResourceUpdateQueue
&
aResources
wr
:
:
ImageKey
&
aKey
)
;
static
Maybe
<
wr
:
:
ExternalImageId
>
GetExternalId
(
const
gfx
:
:
SourceSurfaceSharedData
*
aSurface
)
;
private
:
SharedSurfacesChild
(
)
=
delete
;
~
SharedSurfacesChild
(
)
=
delete
;
class
ImageKeyData
;
class
SharedUserData
;
static
nsresult
ShareInternal
(
gfx
:
:
SourceSurfaceSharedData
*
aSurface
SharedUserData
*
*
aUserData
)
;
static
void
Unshare
(
const
wr
:
:
ExternalImageId
&
aId
nsTArray
<
ImageKeyData
>
&
aKeys
)
;
static
void
DestroySharedUserData
(
void
*
aClosure
)
;
static
gfx
:
:
UserDataKey
sSharedKey
;
}
;
}
}
#
endif
