#
include
"
ImageContainerChild
.
h
"
#
include
"
ImageContainer
.
h
"
#
include
"
mozilla
/
Assertions
.
h
"
#
include
"
mozilla
/
layers
/
ImageBridgeChild
.
h
"
namespace
mozilla
{
namespace
layers
{
ImageContainerChild
:
:
ImageContainerChild
(
ImageContainer
*
aImageContainer
)
:
mLock
(
"
ImageContainerChild
"
)
mImageContainer
(
aImageContainer
)
mIPCOpen
(
false
)
{
}
void
ImageContainerChild
:
:
ForgetImageContainer
(
)
{
MutexAutoLock
lock
(
mLock
)
;
mImageContainer
=
nullptr
;
}
void
ImageContainerChild
:
:
NotifyComposite
(
const
ImageCompositeNotification
&
aNotification
)
{
MOZ_ASSERT
(
InImageBridgeChildThread
(
)
)
;
MutexAutoLock
lock
(
mLock
)
;
if
(
mImageContainer
)
{
mImageContainer
-
>
NotifyComposite
(
aNotification
)
;
}
}
void
ImageContainerChild
:
:
RegisterWithIPDL
(
)
{
MOZ_ASSERT
(
!
mIPCOpen
)
;
MOZ_ASSERT
(
InImageBridgeChildThread
(
)
)
;
AddRef
(
)
;
mIPCOpen
=
true
;
}
void
ImageContainerChild
:
:
UnregisterFromIPDL
(
)
{
MOZ_ASSERT
(
mIPCOpen
)
;
MOZ_ASSERT
(
InImageBridgeChildThread
(
)
)
;
mIPCOpen
=
false
;
Release
(
)
;
}
void
ImageContainerChild
:
:
SendAsyncDelete
(
)
{
MOZ_ASSERT
(
InImageBridgeChildThread
(
)
)
;
if
(
mIPCOpen
)
{
PImageContainerChild
:
:
SendAsyncDelete
(
)
;
}
}
}
}
