#
ifndef
THREADSAFEREFCOUNTINGWITHMAINTHREADDESTRUCTION_H_
#
define
THREADSAFEREFCOUNTINGWITHMAINTHREADDESTRUCTION_H_
#
include
"
nsISupportsImpl
.
h
"
#
include
"
MainThreadUtils
.
h
"
#
include
"
nsThreadUtils
.
h
"
#
define
NS_INLINE_DECL_THREADSAFE_REFCOUNTING_WITH_MAIN_THREAD_DESTRUCTION
(
\
_class
)
\
private
:
\
void
DeleteOnMainThread
(
)
{
\
if
(
NS_IsMainThread
(
)
)
{
\
delete
this
;
\
return
;
\
}
\
NS_DispatchToMainThread
(
NewNonOwningRunnableMethod
(
\
#
_class
"
:
:
DeleteOnMainThread
"
this
&
_class
:
:
DeleteOnMainThread
)
)
;
\
}
\
\
NS_INLINE_DECL_THREADSAFE_REFCOUNTING_WITH_DESTROY
(
_class
\
DeleteOnMainThread
(
)
)
#
endif
