#
ifndef
GFX_WEBRENDERSCROLLDATA_H
#
define
GFX_WEBRENDERSCROLLDATA_H
#
include
<
map
>
#
include
"
chrome
/
common
/
ipc_message_utils
.
h
"
#
include
"
FrameMetrics
.
h
"
#
include
"
mozilla
/
Maybe
.
h
"
#
include
"
nsTArrayForwardDeclare
.
h
"
namespace
mozilla
{
namespace
layers
{
class
Layer
;
class
WebRenderScrollData
;
class
WebRenderLayerScrollData
{
public
:
WebRenderLayerScrollData
(
)
;
~
WebRenderLayerScrollData
(
)
;
void
Initialize
(
WebRenderScrollData
&
aOwner
Layer
*
aLayer
int32_t
aDescendantCount
)
;
int32_t
GetDescendantCount
(
)
const
;
size_t
GetScrollMetadataCount
(
)
const
;
const
ScrollMetadata
&
GetScrollMetadata
(
const
WebRenderScrollData
&
aOwner
size_t
aIndex
)
const
;
friend
struct
IPC
:
:
ParamTraits
<
WebRenderLayerScrollData
>
;
private
:
int32_t
mDescendantCount
;
nsTArray
<
size_t
>
mScrollIds
;
}
;
class
WebRenderScrollData
{
public
:
WebRenderScrollData
(
)
;
~
WebRenderScrollData
(
)
;
size_t
AddMetadata
(
const
ScrollMetadata
&
aMetadata
)
;
size_t
AddNewLayerData
(
)
;
size_t
GetLayerCount
(
)
const
;
WebRenderLayerScrollData
*
GetLayerDataMutable
(
size_t
aIndex
)
;
const
WebRenderLayerScrollData
*
GetLayerData
(
size_t
aIndex
)
const
;
const
ScrollMetadata
&
GetScrollMetadata
(
size_t
aIndex
)
const
;
friend
struct
IPC
:
:
ParamTraits
<
WebRenderScrollData
>
;
private
:
std
:
:
map
<
FrameMetrics
:
:
ViewID
size_t
>
mScrollIdMap
;
nsTArray
<
ScrollMetadata
>
mScrollMetadatas
;
nsTArray
<
WebRenderLayerScrollData
>
mLayerScrollData
;
}
;
}
}
namespace
IPC
{
template
<
>
struct
ParamTraits
<
mozilla
:
:
layers
:
:
WebRenderLayerScrollData
>
{
typedef
mozilla
:
:
layers
:
:
WebRenderLayerScrollData
paramType
;
static
void
Write
(
Message
*
aMsg
const
paramType
&
aParam
)
{
WriteParam
(
aMsg
aParam
.
mDescendantCount
)
;
WriteParam
(
aMsg
aParam
.
mScrollIds
)
;
}
static
bool
Read
(
const
Message
*
aMsg
PickleIterator
*
aIter
paramType
*
aResult
)
{
return
ReadParam
(
aMsg
aIter
&
aResult
-
>
mDescendantCount
)
&
&
ReadParam
(
aMsg
aIter
&
aResult
-
>
mScrollIds
)
;
}
}
;
template
<
>
struct
ParamTraits
<
mozilla
:
:
layers
:
:
WebRenderScrollData
>
{
typedef
mozilla
:
:
layers
:
:
WebRenderScrollData
paramType
;
static
void
Write
(
Message
*
aMsg
const
paramType
&
aParam
)
{
WriteParam
(
aMsg
aParam
.
mScrollMetadatas
)
;
WriteParam
(
aMsg
aParam
.
mLayerScrollData
)
;
}
static
bool
Read
(
const
Message
*
aMsg
PickleIterator
*
aIter
paramType
*
aResult
)
{
return
ReadParam
(
aMsg
aIter
&
aResult
-
>
mScrollMetadatas
)
&
&
ReadParam
(
aMsg
aIter
&
aResult
-
>
mLayerScrollData
)
;
}
}
;
}
#
endif
