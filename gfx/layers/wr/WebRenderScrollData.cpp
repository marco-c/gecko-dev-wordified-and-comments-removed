#
include
"
mozilla
/
layers
/
WebRenderScrollData
.
h
"
#
include
"
mozilla
/
Unused
.
h
"
#
include
"
nsTArray
.
h
"
namespace
mozilla
{
namespace
layers
{
WebRenderLayerScrollData
:
:
WebRenderLayerScrollData
(
)
:
mDescendantCount
(
-
1
)
{
}
WebRenderLayerScrollData
:
:
~
WebRenderLayerScrollData
(
)
{
}
void
WebRenderLayerScrollData
:
:
Initialize
(
WebRenderScrollData
&
aOwner
Layer
*
aLayer
int32_t
aDescendantCount
)
{
MOZ_ASSERT
(
aDescendantCount
>
=
0
)
;
MOZ_ASSERT
(
mDescendantCount
=
=
-
1
)
;
mDescendantCount
=
aDescendantCount
;
MOZ_ASSERT
(
aLayer
)
;
for
(
uint32_t
i
=
0
;
i
<
aLayer
-
>
GetScrollMetadataCount
(
)
;
i
+
+
)
{
mScrollIds
.
AppendElement
(
aOwner
.
AddMetadata
(
aLayer
-
>
GetScrollMetadata
(
i
)
)
)
;
}
}
WebRenderScrollData
:
:
WebRenderScrollData
(
)
{
}
WebRenderScrollData
:
:
~
WebRenderScrollData
(
)
{
}
size_t
WebRenderScrollData
:
:
AddMetadata
(
const
ScrollMetadata
&
aMetadata
)
{
FrameMetrics
:
:
ViewID
scrollId
=
aMetadata
.
GetMetrics
(
)
.
GetScrollId
(
)
;
auto
insertResult
=
mScrollIdMap
.
insert
(
std
:
:
make_pair
(
scrollId
0
)
)
;
if
(
insertResult
.
second
)
{
insertResult
.
first
-
>
second
=
mScrollMetadatas
.
Length
(
)
;
mScrollMetadatas
.
AppendElement
(
aMetadata
)
;
}
return
insertResult
.
first
-
>
second
;
}
size_t
WebRenderScrollData
:
:
AddNewLayerData
(
)
{
size_t
len
=
mLayerScrollData
.
Length
(
)
;
Unused
<
<
mLayerScrollData
.
AppendElement
(
)
;
return
len
;
}
WebRenderLayerScrollData
*
WebRenderScrollData
:
:
GetLayerDataMutable
(
size_t
aIndex
)
{
if
(
aIndex
>
=
mLayerScrollData
.
Length
(
)
)
{
return
nullptr
;
}
return
&
(
mLayerScrollData
.
ElementAt
(
aIndex
)
)
;
}
}
}
