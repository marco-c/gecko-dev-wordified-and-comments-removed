#
include
"
WebRenderDrawEventRecorder
.
h
"
#
include
"
mozilla
/
layers
/
SharedSurfacesChild
.
h
"
#
include
"
mozilla
/
layers
/
SharedSurfacesParent
.
h
"
namespace
mozilla
{
using
namespace
gfx
;
namespace
layers
{
void
WebRenderDrawEventRecorder
:
:
StoreSourceSurfaceRecording
(
SourceSurface
*
aSurface
const
char
*
aReason
)
{
wr
:
:
ExternalImageId
extId
;
nsresult
rv
=
layers
:
:
SharedSurfacesChild
:
:
Share
(
aSurface
extId
)
;
if
(
NS_FAILED
(
rv
)
)
{
DrawEventRecorderMemory
:
:
StoreSourceSurfaceRecording
(
aSurface
aReason
)
;
return
;
}
StoreExternalSurfaceRecording
(
aSurface
wr
:
:
AsUint64
(
extId
)
)
;
}
already_AddRefed
<
SourceSurface
>
WebRenderTranslator
:
:
LookupExternalSurface
(
uint64_t
aKey
)
{
return
SharedSurfacesParent
:
:
Get
(
wr
:
:
ToExternalImageId
(
aKey
)
)
;
}
}
}
