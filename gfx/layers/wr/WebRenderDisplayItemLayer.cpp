#
include
"
WebRenderDisplayItemLayer
.
h
"
#
include
"
LayersLogging
.
h
"
#
include
"
mozilla
/
webrender
/
webrender_ffi
.
h
"
#
include
"
mozilla
/
webrender
/
WebRenderTypes
.
h
"
#
include
"
mozilla
/
layers
/
ScrollingLayersHelper
.
h
"
#
include
"
mozilla
/
layers
/
StackingContextHelper
.
h
"
#
include
"
mozilla
/
layers
/
WebRenderBridgeChild
.
h
"
#
include
"
nsDisplayList
.
h
"
#
include
"
mozilla
/
gfx
/
Matrix
.
h
"
#
include
"
UnitTransforms
.
h
"
namespace
mozilla
{
namespace
layers
{
WebRenderDisplayItemLayer
:
:
~
WebRenderDisplayItemLayer
(
)
{
MOZ_COUNT_DTOR
(
WebRenderDisplayItemLayer
)
;
}
void
WebRenderDisplayItemLayer
:
:
RenderLayer
(
wr
:
:
DisplayListBuilder
&
aBuilder
wr
:
:
IpcResourceUpdateQueue
&
aResources
const
StackingContextHelper
&
aSc
)
{
if
(
mVisibleRegion
.
IsEmpty
(
)
)
{
return
;
}
ScrollingLayersHelper
scroller
(
this
aBuilder
aResources
aSc
)
;
if
(
mItem
)
{
wr
:
:
LayoutSize
contentSize
;
wr
:
:
DisplayListBuilder
builder
(
WrBridge
(
)
-
>
GetPipeline
(
)
contentSize
)
;
mParentCommands
.
Clear
(
)
;
mItem
-
>
CreateWebRenderCommands
(
builder
aResources
aSc
mParentCommands
WrManager
(
)
GetDisplayListBuilder
(
)
)
;
builder
.
Finalize
(
contentSize
mBuiltDisplayList
)
;
}
else
{
WebRenderLayerManager
*
manager
=
WrManager
(
)
;
MOZ_ASSERT
(
manager
)
;
if
(
manager
-
>
IsMutatedLayer
(
this
)
|
|
manager
-
>
IsMutatedLayer
(
GetParent
(
)
)
)
{
manager
-
>
SetTransactionIncomplete
(
)
;
return
;
}
}
aBuilder
.
PushBuiltDisplayList
(
mBuiltDisplayList
)
;
WrBridge
(
)
-
>
AddWebRenderParentCommands
(
mParentCommands
)
;
}
}
}
