#
ifndef
mozilla_gfx_layers_d3d11_HelpersD3D11_h
#
define
mozilla_gfx_layers_d3d11_HelpersD3D11_h
#
include
<
d3d11
.
h
>
#
include
"
mozilla
/
TimeStamp
.
h
"
namespace
mozilla
{
namespace
layers
{
template
<
typename
T
>
static
inline
bool
WaitForGPUQuery
(
ID3D11Device
*
aDevice
ID3D11DeviceContext
*
aContext
ID3D11Query
*
aQuery
T
*
aOut
)
{
TimeStamp
start
=
TimeStamp
:
:
Now
(
)
;
while
(
aContext
-
>
GetData
(
aQuery
aOut
sizeof
(
*
aOut
)
0
)
!
=
S_OK
)
{
if
(
aDevice
-
>
GetDeviceRemovedReason
(
)
!
=
S_OK
)
{
return
false
;
}
if
(
TimeStamp
:
:
Now
(
)
-
start
>
TimeDuration
:
:
FromSeconds
(
2
)
)
{
return
false
;
}
Sleep
(
0
)
;
}
return
true
;
}
}
}
#
endif
