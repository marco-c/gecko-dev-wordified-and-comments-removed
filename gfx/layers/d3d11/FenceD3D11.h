#
ifndef
MOZILLA_GFX_FenceD3D11_H
#
define
MOZILLA_GFX_FenceD3D11_H
#
include
<
unordered_map
>
#
include
"
mozilla
/
gfx
/
FileHandleWrapper
.
h
"
#
include
"
nsISupportsImpl
.
h
"
struct
ID3D11Device
;
struct
ID3D11Fence
;
namespace
mozilla
{
namespace
layers
{
class
FenceD3D11
final
{
public
:
NS_INLINE_DECL_THREADSAFE_REFCOUNTING
(
FenceD3D11
)
;
static
RefPtr
<
FenceD3D11
>
Create
(
ID3D11Device
*
aDevice
)
;
static
RefPtr
<
FenceD3D11
>
CreateFromHandle
(
RefPtr
<
gfx
:
:
FileHandleWrapper
>
aHandle
)
;
static
bool
IsSupported
(
ID3D11Device
*
aDevice
)
;
bool
IncrementAndSignal
(
)
;
void
Update
(
uint64_t
aFenceValue
)
;
bool
Wait
(
ID3D11Device
*
aDevice
)
;
uint64_t
GetFenceValue
(
)
const
{
return
mFenceValue
;
}
gfx
:
:
FenceInfo
GetFenceInfo
(
)
const
;
const
RefPtr
<
gfx
:
:
FileHandleWrapper
>
mHandle
;
protected
:
explicit
FenceD3D11
(
RefPtr
<
gfx
:
:
FileHandleWrapper
>
&
aHandle
)
;
~
FenceD3D11
(
)
;
RefPtr
<
ID3D11Device
>
mDevice
;
RefPtr
<
ID3D11Fence
>
mSignalFence
;
uint64_t
mFenceValue
=
0
;
std
:
:
unordered_map
<
const
ID3D11Device
*
RefPtr
<
ID3D11Fence
>
>
mWaitFenceMap
;
}
;
}
}
#
endif
