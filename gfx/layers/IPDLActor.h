#
ifndef
MOZILLA_LAYERS_IPDLACTOR_H
#
define
MOZILLA_LAYERS_IPDLACTOR_H
#
include
"
mozilla
/
ipc
/
ProtocolUtils
.
h
"
#
include
"
mozilla
/
layers
/
CompositableForwarder
.
h
"
#
include
"
mozilla
/
Unused
.
h
"
#
include
"
gfxPlatform
.
h
"
namespace
mozilla
{
namespace
layers
{
template
<
typename
Protocol
>
class
ParentActor
:
public
Protocol
{
public
:
ParentActor
(
)
:
mDestroyed
(
false
)
{
}
~
ParentActor
(
)
{
MOZ_ASSERT
(
mDestroyed
)
;
}
bool
CanSend
(
)
const
{
return
!
mDestroyed
;
}
virtual
void
Destroy
(
)
{
}
virtual
bool
RecvDestroy
(
)
override
{
DestroyIfNeeded
(
)
;
Unused
<
<
Protocol
:
:
Send__delete__
(
this
)
;
return
true
;
}
typedef
ipc
:
:
IProtocolManager
<
ipc
:
:
IProtocol
>
:
:
ActorDestroyReason
Why
;
virtual
void
ActorDestroy
(
Why
)
override
{
DestroyIfNeeded
(
)
;
}
protected
:
void
DestroyIfNeeded
(
)
{
if
(
!
mDestroyed
)
{
Destroy
(
)
;
mDestroyed
=
true
;
}
}
private
:
bool
mDestroyed
;
}
;
}
}
#
endif
