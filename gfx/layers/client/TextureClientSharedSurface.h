#
ifndef
MOZILLA_GFX_TEXTURECLIENT_SHAREDSURFACE_H
#
define
MOZILLA_GFX_TEXTURECLIENT_SHAREDSURFACE_H
#
include
<
cstddef
>
#
include
<
stdint
.
h
>
#
include
"
GLContextTypes
.
h
"
#
include
"
TextureClient
.
h
"
#
include
"
mozilla
/
Assertions
.
h
"
#
include
"
mozilla
/
RefPtr
.
h
"
#
include
"
mozilla
/
gfx
/
Point
.
h
"
#
include
"
mozilla
/
gfx
/
Types
.
h
"
#
include
"
mozilla
/
layers
/
CompositorTypes
.
h
"
#
include
"
mozilla
/
layers
/
LayersSurfaces
.
h
"
namespace
mozilla
{
namespace
gl
{
class
GLContext
;
class
SharedSurface
;
class
SurfaceFactory
;
}
namespace
layers
{
class
SharedSurfaceTextureClient
;
class
SharedSurfaceTextureData
:
public
TextureData
{
protected
:
const
UniquePtr
<
gl
:
:
SharedSurface
>
mSurf
;
friend
class
SharedSurfaceTextureClient
;
explicit
SharedSurfaceTextureData
(
UniquePtr
<
gl
:
:
SharedSurface
>
surf
)
;
public
:
~
SharedSurfaceTextureData
(
)
;
virtual
bool
Lock
(
OpenMode
FenceHandle
*
)
override
{
return
false
;
}
virtual
void
Unlock
(
)
override
{
}
virtual
bool
HasInternalBuffer
(
)
const
override
{
return
false
;
}
virtual
gfx
:
:
SurfaceFormat
GetFormat
(
)
const
override
{
return
gfx
:
:
SurfaceFormat
:
:
UNKNOWN
;
}
virtual
gfx
:
:
IntSize
GetSize
(
)
const
override
;
virtual
bool
Serialize
(
SurfaceDescriptor
&
aOutDescriptor
)
override
;
virtual
void
Deallocate
(
ISurfaceAllocator
*
)
override
;
gl
:
:
SharedSurface
*
Surf
(
)
const
{
return
mSurf
.
get
(
)
;
}
}
;
class
SharedSurfaceTextureClient
:
public
TextureClient
{
public
:
SharedSurfaceTextureClient
(
SharedSurfaceTextureData
*
aData
TextureFlags
aFlags
ISurfaceAllocator
*
aAllocator
)
;
static
already_AddRefed
<
SharedSurfaceTextureClient
>
Create
(
UniquePtr
<
gl
:
:
SharedSurface
>
surf
gl
:
:
SurfaceFactory
*
factory
ISurfaceAllocator
*
aAllocator
TextureFlags
aFlags
)
;
virtual
void
SetReleaseFenceHandle
(
const
FenceHandle
&
aReleaseFenceHandle
)
override
;
virtual
FenceHandle
GetAndResetReleaseFenceHandle
(
)
override
;
virtual
void
SetAcquireFenceHandle
(
const
FenceHandle
&
aAcquireFenceHandle
)
override
;
virtual
const
FenceHandle
&
GetAcquireFenceHandle
(
)
const
override
;
gl
:
:
SharedSurface
*
Surf
(
)
const
{
return
static_cast
<
const
SharedSurfaceTextureData
*
>
(
GetInternalData
(
)
)
-
>
Surf
(
)
;
}
}
;
}
}
#
endif
