#
ifndef
GFX_CLIENTTILEDPAINTEDLAYER_H
#
define
GFX_CLIENTTILEDPAINTEDLAYER_H
#
include
"
ClientLayerManager
.
h
"
#
include
"
Layers
.
h
"
#
include
"
mozilla
/
RefPtr
.
h
"
#
include
"
mozilla
/
layers
/
TiledContentClient
.
h
"
#
include
"
nsRegion
.
h
"
namespace
mozilla
{
namespace
layers
{
class
ShadowableLayer
;
class
SpecificLayerAttributes
;
class
ClientTiledPaintedLayer
:
public
PaintedLayer
public
ClientLayer
{
typedef
PaintedLayer
Base
;
public
:
explicit
ClientTiledPaintedLayer
(
ClientLayerManager
*
const
aManager
ClientLayerManager
:
:
PaintedLayerCreationHint
aCreationHint
=
LayerManager
:
:
NONE
)
;
protected
:
~
ClientTiledPaintedLayer
(
)
;
virtual
void
PrintInfo
(
std
:
:
stringstream
&
aStream
const
char
*
aPrefix
)
override
;
public
:
virtual
const
char
*
Name
(
)
const
override
{
return
"
TiledPaintedLayer
"
;
}
virtual
Layer
*
AsLayer
(
)
override
{
return
this
;
}
virtual
void
InvalidateRegion
(
const
nsIntRegion
&
aRegion
)
override
{
mInvalidRegion
.
Add
(
aRegion
)
;
UpdateValidRegionAfterInvalidRegionChanged
(
)
;
if
(
!
mLowPrecisionValidRegion
.
IsEmpty
(
)
)
{
mLowPrecisionValidRegion
.
SubOut
(
mInvalidRegion
.
GetRegion
(
)
)
;
}
}
virtual
void
FillSpecificAttributes
(
SpecificLayerAttributes
&
aAttrs
)
override
;
virtual
ShadowableLayer
*
AsShadowableLayer
(
)
override
{
return
this
;
}
virtual
void
RenderLayer
(
)
override
;
virtual
void
ClearCachedResources
(
)
override
;
virtual
void
HandleMemoryPressure
(
)
override
{
if
(
mContentClient
)
{
mContentClient
-
>
HandleMemoryPressure
(
)
;
}
}
void
GetAncestorLayers
(
LayerMetricsWrapper
*
aOutScrollAncestor
LayerMetricsWrapper
*
aOutDisplayPortAncestor
bool
*
aOutHasTransformAnimation
)
;
virtual
bool
IsOptimizedFor
(
LayerManager
:
:
PaintedLayerCreationHint
aCreationHint
)
override
;
private
:
ClientLayerManager
*
ClientManager
(
)
{
return
static_cast
<
ClientLayerManager
*
>
(
mManager
)
;
}
void
BeginPaint
(
)
;
bool
IsScrollingOnCompositor
(
const
FrameMetrics
&
aParentMetrics
)
;
bool
UseProgressiveDraw
(
)
;
bool
RenderHighPrecision
(
const
nsIntRegion
&
aInvalidRegion
const
nsIntRegion
&
aVisibleRegion
LayerManager
:
:
DrawPaintedLayerCallback
aCallback
void
*
aCallbackData
)
;
bool
RenderLowPrecision
(
const
nsIntRegion
&
aInvalidRegion
const
nsIntRegion
&
aVisibleRegion
LayerManager
:
:
DrawPaintedLayerCallback
aCallback
void
*
aCallbackData
)
;
void
EndPaint
(
)
;
RefPtr
<
TiledContentClient
>
mContentClient
;
bool
mHaveSingleTiledContentClient
;
nsIntRegion
mLowPrecisionValidRegion
;
BasicTiledLayerPaintData
mPaintData
;
}
;
}
}
#
endif
