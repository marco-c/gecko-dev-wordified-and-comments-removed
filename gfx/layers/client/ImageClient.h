#
ifndef
MOZILLA_GFX_IMAGECLIENT_H
#
define
MOZILLA_GFX_IMAGECLIENT_H
#
include
<
stdint
.
h
>
#
include
<
sys
/
types
.
h
>
#
include
"
mozilla
/
Attributes
.
h
"
#
include
"
mozilla
/
RefPtr
.
h
"
#
include
"
mozilla
/
gfx
/
Types
.
h
"
#
include
"
mozilla
/
layers
/
CompositableClient
.
h
"
#
include
"
mozilla
/
layers
/
CompositorTypes
.
h
"
#
include
"
mozilla
/
layers
/
LayersSurfaces
.
h
"
#
include
"
mozilla
/
layers
/
TextureClient
.
h
"
#
include
"
mozilla
/
mozalloc
.
h
"
#
include
"
nsCOMPtr
.
h
"
#
include
"
nsRect
.
h
"
namespace
mozilla
{
namespace
layers
{
class
CompositableForwarder
;
class
Image
;
class
ImageContainer
;
class
ImageClientSingle
;
class
ImageClient
:
public
CompositableClient
{
public
:
static
already_AddRefed
<
ImageClient
>
CreateImageClient
(
CompositableType
aImageHostType
ImageUsageType
aUsageType
CompositableForwarder
*
aFwd
TextureFlags
aFlags
)
;
virtual
~
ImageClient
(
)
=
default
;
virtual
bool
UpdateImage
(
ImageContainer
*
aContainer
)
=
0
;
virtual
void
ClearImagesInHost
(
ClearImagesType
aType
)
{
}
virtual
void
RemoveTexture
(
TextureClient
*
aTexture
)
override
;
virtual
ImageClientSingle
*
AsImageClientSingle
(
)
{
return
nullptr
;
}
static
already_AddRefed
<
TextureClient
>
CreateTextureClientForImage
(
Image
*
aImage
KnowsCompositor
*
aForwarder
)
;
uint32_t
GetLastUpdateGenerationCounter
(
)
{
return
mLastUpdateGenerationCounter
;
}
virtual
RefPtr
<
TextureClient
>
GetForwardedTexture
(
)
{
return
nullptr
;
}
CompositableType
mType
;
ImageUsageType
mUsageType
;
protected
:
ImageClient
(
CompositableForwarder
*
aFwd
TextureFlags
aFlags
CompositableType
aType
ImageUsageType
aUsageType
)
;
uint32_t
mLastUpdateGenerationCounter
;
}
;
class
ImageClientSingle
:
public
ImageClient
{
public
:
ImageClientSingle
(
CompositableForwarder
*
aFwd
TextureFlags
aFlags
CompositableType
aType
ImageUsageType
aUsageType
)
;
bool
UpdateImage
(
ImageContainer
*
aContainer
)
override
;
void
OnDetach
(
)
override
;
bool
AddTextureClient
(
TextureClient
*
aTexture
)
override
;
TextureInfo
GetTextureInfo
(
)
const
override
;
void
ClearImagesInHost
(
ClearImagesType
aType
)
override
;
ImageClientSingle
*
AsImageClientSingle
(
)
override
{
return
this
;
}
RefPtr
<
TextureClient
>
GetForwardedTexture
(
)
override
;
bool
IsEmpty
(
)
{
return
mBuffers
.
IsEmpty
(
)
;
}
protected
:
struct
Buffer
{
RefPtr
<
TextureClient
>
mTextureClient
;
int32_t
mImageSerial
;
}
;
nsTArray
<
Buffer
>
mBuffers
;
}
;
}
}
#
endif
