#
ifndef
MOZILLA_LAYERS_ASYNCCANVASRENDERER_H_
#
define
MOZILLA_LAYERS_ASYNCCANVASRENDERER_H_
#
include
"
LayersTypes
.
h
"
#
include
"
mozilla
/
gfx
/
Point
.
h
"
#
include
"
mozilla
/
Mutex
.
h
"
#
include
"
mozilla
/
RefPtr
.
h
"
#
include
"
nsCOMPtr
.
h
"
class
nsICanvasRenderingContextInternal
;
class
nsIInputStream
;
class
nsIThread
;
namespace
mozilla
{
namespace
gfx
{
class
DataSourceSurface
;
class
DrawTarget
;
}
namespace
gl
{
class
GLContext
;
}
namespace
dom
{
class
HTMLCanvasElement
;
class
CanvasRenderingContext2D
;
}
namespace
layers
{
class
CanvasClient
;
class
PersistentBufferProvider
;
class
TextureClient
;
class
AsyncCanvasRenderer
final
{
NS_INLINE_DECL_THREADSAFE_REFCOUNTING
(
AsyncCanvasRenderer
)
public
:
AsyncCanvasRenderer
(
)
;
void
NotifyElementAboutAttributesChanged
(
)
;
void
NotifyElementAboutInvalidation
(
)
;
void
SetCanvasClient
(
CanvasClient
*
aClient
)
;
void
SetWidth
(
uint32_t
aWidth
)
{
mWidth
=
aWidth
;
}
void
SetHeight
(
uint32_t
aHeight
)
{
mHeight
=
aHeight
;
}
bool
GetOpaque
(
)
{
return
mOpaque
;
}
void
SetOpaque
(
bool
aOpaque
)
{
mOpaque
=
aOpaque
;
}
void
SetIsAlphaPremultiplied
(
bool
aIsAlphaPremultiplied
)
{
mIsAlphaPremultiplied
=
aIsAlphaPremultiplied
;
}
void
UpdateTarget
(
TextureClient
*
aTexture
)
;
void
SetActiveThread
(
)
;
void
ResetActiveThread
(
)
;
already_AddRefed
<
gfx
:
:
DataSourceSurface
>
GetSurface
(
)
;
void
CopyFromTextureClient
(
TextureClient
*
aClient
)
;
nsresult
GetInputStream
(
const
char
*
aMimeType
const
char16_t
*
aEncoderOptions
nsIInputStream
*
*
aStream
)
;
gfx
:
:
IntSize
GetSize
(
)
const
{
return
gfx
:
:
IntSize
(
mWidth
mHeight
)
;
}
uint64_t
GetCanvasClientAsyncID
(
)
const
{
return
mCanvasClientAsyncID
;
}
CanvasClient
*
GetCanvasClient
(
)
const
{
return
mCanvasClient
;
}
already_AddRefed
<
nsIThread
>
GetActiveThread
(
)
;
dom
:
:
HTMLCanvasElement
*
mHTMLCanvasElement
;
nsICanvasRenderingContextInternal
*
mContext
;
RefPtr
<
gl
:
:
GLContext
>
mGLContext
;
PersistentBufferProvider
*
mBufferProvider
;
private
:
virtual
~
AsyncCanvasRenderer
(
)
;
already_AddRefed
<
gfx
:
:
DataSourceSurface
>
UpdateTarget
(
)
;
bool
mIsAlphaPremultiplied
;
bool
mOpaque
;
uint32_t
mWidth
;
uint32_t
mHeight
;
uint64_t
mCanvasClientAsyncID
;
CanvasClient
*
mCanvasClient
;
RefPtr
<
gfx
:
:
DataSourceSurface
>
mSurfaceForBasic
;
Mutex
mMutex
;
nsCOMPtr
<
nsIThread
>
mActiveThread
;
}
;
}
}
#
endif
