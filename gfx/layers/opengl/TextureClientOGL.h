#
ifndef
MOZILLA_GFX_TEXTURECLIENTOGL_H
#
define
MOZILLA_GFX_TEXTURECLIENTOGL_H
#
include
"
GLContextTypes
.
h
"
#
include
"
GLImages
.
h
"
#
include
"
gfxTypes
.
h
"
#
include
"
mozilla
/
Attributes
.
h
"
#
include
"
mozilla
/
gfx
/
Point
.
h
"
#
include
"
mozilla
/
gfx
/
Types
.
h
"
#
include
"
mozilla
/
layers
/
CompositorTypes
.
h
"
#
include
"
mozilla
/
layers
/
LayersSurfaces
.
h
"
#
include
"
mozilla
/
layers
/
TextureClient
.
h
"
#
ifdef
MOZ_WIDGET_ANDROID
#
include
"
AndroidSurfaceTexture
.
h
"
#
include
"
AndroidNativeWindow
.
h
"
#
include
"
mozilla
/
java
/
GeckoSurfaceWrappers
.
h
"
#
include
"
mozilla
/
layers
/
AndroidHardwareBuffer
.
h
"
#
endif
namespace
mozilla
{
namespace
gfx
{
class
DrawTarget
;
}
namespace
layers
{
#
ifdef
MOZ_WIDGET_ANDROID
class
AndroidHardwareBuffer
;
class
AndroidSurfaceTextureData
:
public
TextureData
{
public
:
static
already_AddRefed
<
TextureClient
>
CreateTextureClient
(
AndroidSurfaceTextureHandle
aHandle
gfx
:
:
IntSize
aSize
bool
aContinuous
gl
:
:
OriginPos
aOriginPos
bool
aHasAlpha
LayersIPCChannel
*
aAllocator
TextureFlags
aFlags
)
;
virtual
~
AndroidSurfaceTextureData
(
)
;
void
FillInfo
(
TextureData
:
:
Info
&
aInfo
)
const
override
;
bool
Serialize
(
SurfaceDescriptor
&
aOutDescriptor
)
override
;
bool
Lock
(
OpenMode
)
override
{
return
true
;
}
void
Unlock
(
)
override
{
}
void
Deallocate
(
LayersIPCChannel
*
)
override
{
}
protected
:
AndroidSurfaceTextureData
(
AndroidSurfaceTextureHandle
aHandle
gfx
:
:
IntSize
aSize
bool
aContinuous
bool
aHasAlpha
)
;
const
AndroidSurfaceTextureHandle
mHandle
;
const
gfx
:
:
IntSize
mSize
;
const
bool
mContinuous
;
const
bool
mHasAlpha
;
}
;
class
AndroidNativeWindowTextureData
:
public
TextureData
{
public
:
static
AndroidNativeWindowTextureData
*
Create
(
gfx
:
:
IntSize
aSize
gfx
:
:
SurfaceFormat
aFormat
)
;
void
FillInfo
(
TextureData
:
:
Info
&
aInfo
)
const
override
;
bool
Serialize
(
SurfaceDescriptor
&
aOutDescriptor
)
override
;
bool
Lock
(
OpenMode
)
override
;
void
Unlock
(
)
override
;
void
Forget
(
LayersIPCChannel
*
)
override
;
void
Deallocate
(
LayersIPCChannel
*
)
override
{
}
already_AddRefed
<
gfx
:
:
DrawTarget
>
BorrowDrawTarget
(
)
override
;
void
OnForwardedToHost
(
)
override
;
protected
:
AndroidNativeWindowTextureData
(
java
:
:
GeckoSurface
:
:
Param
aSurface
gfx
:
:
IntSize
aSize
gfx
:
:
SurfaceFormat
aFormat
)
;
private
:
java
:
:
GeckoSurface
:
:
GlobalRef
mSurface
;
ANativeWindow
*
mNativeWindow
;
ANativeWindow_Buffer
mBuffer
;
bool
mIsLocked
;
const
gfx
:
:
IntSize
mSize
;
const
gfx
:
:
SurfaceFormat
mFormat
;
}
;
class
AndroidHardwareBufferTextureData
:
public
TextureData
{
public
:
static
AndroidHardwareBufferTextureData
*
Create
(
gfx
:
:
IntSize
aSize
gfx
:
:
SurfaceFormat
aFormat
)
;
virtual
~
AndroidHardwareBufferTextureData
(
)
;
void
FillInfo
(
TextureData
:
:
Info
&
aInfo
)
const
override
;
bool
Serialize
(
SurfaceDescriptor
&
aOutDescriptor
)
override
;
bool
Lock
(
OpenMode
aMode
)
override
;
void
Unlock
(
)
override
;
void
Forget
(
LayersIPCChannel
*
)
override
;
void
Deallocate
(
LayersIPCChannel
*
)
override
{
}
already_AddRefed
<
gfx
:
:
DrawTarget
>
BorrowDrawTarget
(
)
override
;
void
OnForwardedToHost
(
)
override
;
TextureFlags
GetTextureFlags
(
)
const
override
;
Maybe
<
uint64_t
>
GetBufferId
(
)
const
override
;
mozilla
:
:
ipc
:
:
FileDescriptor
GetAcquireFence
(
)
override
;
AndroidHardwareBufferTextureData
*
AsAndroidHardwareBufferTextureData
(
)
override
{
return
this
;
}
AndroidHardwareBuffer
*
GetBuffer
(
)
{
return
mAndroidHardwareBuffer
;
}
protected
:
AndroidHardwareBufferTextureData
(
AndroidHardwareBuffer
*
aAndroidHardwareBuffer
gfx
:
:
IntSize
aSize
gfx
:
:
SurfaceFormat
aFormat
)
;
RefPtr
<
AndroidHardwareBuffer
>
mAndroidHardwareBuffer
;
const
gfx
:
:
IntSize
mSize
;
const
gfx
:
:
SurfaceFormat
mFormat
;
void
*
mAddress
;
bool
mIsLocked
;
}
;
#
endif
}
}
#
endif
