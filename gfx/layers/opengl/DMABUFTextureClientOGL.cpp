#
include
"
DMABUFTextureClientOGL
.
h
"
#
include
"
mozilla
/
widget
/
DMABufSurface
.
h
"
#
include
"
gfxPlatform
.
h
"
namespace
mozilla
:
:
layers
{
using
namespace
gfx
;
DMABUFTextureData
:
:
DMABUFTextureData
(
DMABufSurface
*
aSurface
BackendType
aBackend
)
:
mSurface
(
aSurface
)
mBackend
(
aBackend
)
{
MOZ_ASSERT
(
mSurface
)
;
}
DMABUFTextureData
:
:
~
DMABUFTextureData
(
)
=
default
;
bool
DMABUFTextureData
:
:
Serialize
(
SurfaceDescriptor
&
aOutDescriptor
)
{
return
mSurface
-
>
Serialize
(
aOutDescriptor
)
;
}
void
DMABUFTextureData
:
:
GetSubDescriptor
(
RemoteDecoderVideoSubDescriptor
*
const
aOutDesc
)
{
SurfaceDescriptor
desc
;
if
(
!
mSurface
-
>
Serialize
(
desc
)
)
{
return
;
}
*
aOutDesc
=
static_cast
<
SurfaceDescriptorDMABuf
>
(
desc
)
;
}
void
DMABUFTextureData
:
:
FillInfo
(
TextureData
:
:
Info
&
aInfo
)
const
{
aInfo
.
size
=
gfx
:
:
IntSize
(
mSurface
-
>
GetWidth
(
)
mSurface
-
>
GetHeight
(
)
)
;
aInfo
.
format
=
mSurface
-
>
GetFormat
(
)
;
aInfo
.
hasSynchronization
=
false
;
aInfo
.
supportsMoz2D
=
false
;
aInfo
.
canExposeMappedData
=
false
;
}
bool
DMABUFTextureData
:
:
Lock
(
OpenMode
)
{
MOZ_DIAGNOSTIC_CRASH
(
"
Not
implemented
.
"
)
;
return
false
;
}
void
DMABUFTextureData
:
:
Unlock
(
)
{
MOZ_DIAGNOSTIC_CRASH
(
"
Not
implemented
.
"
)
;
}
already_AddRefed
<
DataSourceSurface
>
DMABUFTextureData
:
:
GetAsSurface
(
)
{
return
nullptr
;
}
void
DMABUFTextureData
:
:
Deallocate
(
LayersIPCChannel
*
)
{
mSurface
=
nullptr
;
}
void
DMABUFTextureData
:
:
Forget
(
LayersIPCChannel
*
)
{
mSurface
=
nullptr
;
}
}
