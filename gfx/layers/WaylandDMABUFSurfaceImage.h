#
ifndef
WAYLAND_SURFACE_DMABUF_H
#
define
WAYLAND_SURFACE_DMABUF_H
#
include
"
ImageContainer
.
h
"
#
include
"
mozilla
/
widget
/
WaylandDMABufSurface
.
h
"
#
include
"
mozilla
/
gfx
/
Point
.
h
"
#
include
"
mozilla
/
layers
/
TextureClient
.
h
"
namespace
mozilla
{
class
VAAPIFrameHolder
;
}
namespace
mozilla
{
namespace
layers
{
typedef
void
(
*
AVFrameReleaseCallback
)
(
VAAPIFrameHolder
*
aFrameHolder
)
;
class
WaylandDMABUFSurfaceImage
:
public
Image
{
public
:
explicit
WaylandDMABUFSurfaceImage
(
WaylandDMABufSurface
*
aSurface
AVFrameReleaseCallback
aReleaseCallback
VAAPIFrameHolder
*
aFrameHolder
)
:
Image
(
nullptr
ImageFormat
:
:
WAYLAND_DMABUF
)
mSurface
(
aSurface
)
mReleaseCallback
(
aReleaseCallback
)
mFrameHolder
(
aFrameHolder
)
{
}
~
WaylandDMABUFSurfaceImage
(
)
{
if
(
mReleaseCallback
)
{
mReleaseCallback
(
mFrameHolder
)
;
}
}
WaylandDMABufSurface
*
GetSurface
(
)
{
return
mSurface
;
}
gfx
:
:
IntSize
GetSize
(
)
const
override
{
return
gfx
:
:
IntSize
:
:
Truncate
(
mSurface
-
>
GetWidth
(
)
mSurface
-
>
GetHeight
(
)
)
;
}
already_AddRefed
<
gfx
:
:
SourceSurface
>
GetAsSourceSurface
(
)
override
{
return
nullptr
;
}
TextureClient
*
GetTextureClient
(
KnowsCompositor
*
aKnowsCompositor
)
override
;
private
:
RefPtr
<
WaylandDMABufSurface
>
mSurface
;
RefPtr
<
TextureClient
>
mTextureClient
;
AVFrameReleaseCallback
mReleaseCallback
;
VAAPIFrameHolder
*
mFrameHolder
;
}
;
}
}
#
endif
