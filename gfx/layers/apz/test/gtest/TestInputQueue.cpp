#
include
"
APZCTreeManagerTester
.
h
"
#
include
"
APZTestCommon
.
h
"
#
include
"
InputUtils
.
h
"
TEST_F
(
APZCTreeManagerTester
WheelInterruptedByMouseDrag
)
{
SCOPED_GFX_PREF_BOOL
(
"
general
.
smoothScroll
"
true
)
;
CreateSimpleScrollingLayer
(
)
;
ScopedLayerTreeRegistration
registration
(
LayersId
{
0
}
mcc
)
;
UpdateHitTestingTree
(
)
;
RefPtr
<
TestAsyncPanZoomController
>
apzc
=
ApzcOf
(
root
)
;
uint64_t
dragBlockId
=
MouseDown
(
apzc
ScreenIntPoint
(
5
5
)
mcc
-
>
Time
(
)
)
.
mInputBlockId
;
uint64_t
tmpBlockId
=
MouseMove
(
apzc
ScreenIntPoint
(
6
6
)
mcc
-
>
Time
(
)
)
.
mInputBlockId
;
EXPECT_EQ
(
dragBlockId
tmpBlockId
)
;
uint64_t
wheelBlockId
=
SmoothWheel
(
apzc
ScreenIntPoint
(
6
6
)
ScreenPoint
(
0
1
)
mcc
-
>
Time
(
)
)
.
mInputBlockId
;
EXPECT_NE
(
dragBlockId
wheelBlockId
)
;
tmpBlockId
=
MouseMove
(
apzc
ScreenIntPoint
(
7
5
)
mcc
-
>
Time
(
)
)
.
mInputBlockId
;
EXPECT_EQ
(
dragBlockId
tmpBlockId
)
;
apzc
-
>
AdvanceAnimationsUntilEnd
(
)
;
ParentLayerPoint
scroll
=
apzc
-
>
GetCurrentAsyncScrollOffset
(
AsyncPanZoomController
:
:
eForEventHandling
)
;
EXPECT_EQ
(
scroll
.
x
0
)
;
EXPECT_EQ
(
scroll
.
y
10
)
;
}
