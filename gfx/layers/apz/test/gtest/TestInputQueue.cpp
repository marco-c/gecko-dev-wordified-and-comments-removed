#
include
"
APZCTreeManagerTester
.
h
"
#
include
"
APZTestCommon
.
h
"
#
include
"
InputUtils
.
h
"
TEST_F
(
APZCTreeManagerTester
WheelInterruptedByMouseDrag
)
{
CreateSimpleScrollingLayer
(
)
;
ScopedLayerTreeRegistration
registration
(
manager
0
root
mcc
)
;
manager
-
>
UpdateHitTestingTree
(
0
root
false
0
0
)
;
RefPtr
<
TestAsyncPanZoomController
>
apzc
=
ApzcOf
(
root
)
;
uint64_t
dragBlockId
=
0
;
uint64_t
wheelBlockId
=
0
;
uint64_t
tmpBlockId
=
0
;
MouseDown
(
apzc
ScreenIntPoint
(
5
5
)
mcc
-
>
Time
(
)
&
dragBlockId
)
;
MouseMove
(
apzc
ScreenIntPoint
(
6
6
)
mcc
-
>
Time
(
)
&
tmpBlockId
)
;
EXPECT_EQ
(
dragBlockId
tmpBlockId
)
;
SmoothWheel
(
apzc
ScreenIntPoint
(
6
6
)
ScreenPoint
(
0
1
)
mcc
-
>
Time
(
)
&
wheelBlockId
)
;
EXPECT_NE
(
dragBlockId
wheelBlockId
)
;
MouseMove
(
apzc
ScreenIntPoint
(
7
5
)
mcc
-
>
Time
(
)
&
tmpBlockId
)
;
EXPECT_EQ
(
dragBlockId
tmpBlockId
)
;
apzc
-
>
AdvanceAnimationsUntilEnd
(
)
;
ParentLayerPoint
scroll
=
apzc
-
>
GetCurrentAsyncScrollOffset
(
AsyncPanZoomController
:
:
NORMAL
)
;
EXPECT_EQ
(
scroll
.
x
0
)
;
EXPECT_EQ
(
scroll
.
y
10
)
;
}
