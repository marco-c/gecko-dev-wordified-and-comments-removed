function
fission_subtest_init
(
)
{
SimpleTest
.
waitForExplicitFinish
(
)
;
window
.
dispatchEvent
(
new
Event
(
"
FissionTestHelper
:
Init
"
)
)
;
}
function
promiseOneEvent
(
eventType
filter
)
{
return
new
Promise
(
(
resolve
reject
)
=
>
{
window
.
addEventListener
(
eventType
function
listener
(
e
)
{
let
success
=
false
;
if
(
filter
=
=
null
)
{
success
=
true
;
}
else
if
(
typeof
filter
=
=
"
function
"
)
{
try
{
success
=
filter
(
e
)
;
}
catch
(
ex
)
{
dump
(
ERROR
:
Filter
passed
to
promiseOneEvent
threw
exception
:
{
ex
}
\
n
)
;
reject
(
)
;
return
;
}
}
else
{
dump
(
"
ERROR
:
Filter
passed
to
promiseOneEvent
was
neither
null
nor
a
function
\
n
"
)
;
reject
(
)
;
return
;
}
if
(
success
)
{
window
.
removeEventListener
(
eventType
listener
)
;
resolve
(
e
)
;
}
}
)
;
}
)
;
}
function
loadOOPIFrame
(
iframeElementId
iframePage
)
{
return
async
function
(
)
{
if
(
window
.
location
.
href
.
startsWith
(
"
https
:
/
/
example
.
com
/
"
)
)
{
dump
(
WARNING
:
Calling
loadOOPIFrame
from
{
window
.
location
.
href
}
so
the
iframe
may
not
be
OOP
\
n
)
;
ok
(
false
"
Current
origin
is
not
example
.
com
:
443
"
)
;
}
let
url
=
"
https
:
/
/
example
.
com
/
browser
/
gfx
/
layers
/
apz
/
test
/
mochitest
/
"
+
iframePage
;
let
loadPromise
=
promiseOneEvent
(
"
OOPIF
:
Load
"
function
(
e
)
{
return
typeof
e
.
data
.
content
=
=
"
string
"
&
&
e
.
data
.
content
=
=
url
;
}
)
;
let
elem
=
document
.
getElementById
(
iframeElementId
)
;
elem
.
src
=
url
;
await
loadPromise
;
}
;
}
