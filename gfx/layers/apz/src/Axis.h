#
ifndef
mozilla_layers_Axis_h
#
define
mozilla_layers_Axis_h
#
include
<
sys
/
types
.
h
>
#
include
"
APZUtils
.
h
"
#
include
"
AxisPhysicsMSDModel
.
h
"
#
include
"
mozilla
/
gfx
/
Types
.
h
"
#
include
"
mozilla
/
TimeStamp
.
h
"
#
include
"
nsTArray
.
h
"
#
include
"
Units
.
h
"
namespace
mozilla
{
namespace
layers
{
const
float
EPSILON
=
0
.
0001f
;
bool
FuzzyEqualsCoordinate
(
float
aValue1
float
aValue2
)
;
struct
FrameMetrics
;
class
AsyncPanZoomController
;
class
Axis
{
public
:
explicit
Axis
(
AsyncPanZoomController
*
aAsyncPanZoomController
)
;
void
UpdateWithTouchAtDevicePoint
(
ParentLayerCoord
aPos
ParentLayerCoord
aAdditionalDelta
uint32_t
aTimestampMs
)
;
protected
:
float
ApplyFlingCurveToVelocity
(
float
aVelocity
)
const
;
void
AddVelocityToQueue
(
uint32_t
aTimestampMs
float
aVelocity
)
;
public
:
void
HandleTouchVelocity
(
uint32_t
aTimestampMs
float
aSpeed
)
;
void
StartTouch
(
ParentLayerCoord
aPos
uint32_t
aTimestampMs
)
;
void
EndTouch
(
uint32_t
aTimestampMs
)
;
void
CancelGesture
(
)
;
bool
AdjustDisplacement
(
ParentLayerCoord
aDisplacement
float
&
aDisplacementOut
float
&
aOverscrollAmountOut
bool
aForceOverscroll
=
false
)
;
void
OverscrollBy
(
ParentLayerCoord
aOverscroll
)
;
ParentLayerCoord
GetOverscroll
(
)
const
;
void
StartOverscrollAnimation
(
float
aVelocity
)
;
bool
SampleOverscrollAnimation
(
const
TimeDuration
&
aDelta
)
;
void
EndOverscrollAnimation
(
)
;
bool
IsOverscrolled
(
)
const
;
void
ClearOverscroll
(
)
;
ParentLayerCoord
PanStart
(
)
const
;
ParentLayerCoord
PanDistance
(
)
const
;
ParentLayerCoord
PanDistance
(
ParentLayerCoord
aPos
)
const
;
bool
FlingApplyFrictionOrCancel
(
const
TimeDuration
&
aDelta
float
aFriction
float
aThreshold
)
;
bool
CanScroll
(
)
const
;
bool
CanScroll
(
ParentLayerCoord
aDelta
)
const
;
bool
CanScrollNow
(
)
const
;
CSSCoord
ClampOriginToScrollableRect
(
CSSCoord
aOrigin
)
const
;
void
SetAxisLocked
(
bool
aAxisLocked
)
{
mAxisLocked
=
aAxisLocked
;
}
float
GetVelocity
(
)
const
;
void
SetVelocity
(
float
aVelocity
)
;
ParentLayerCoord
DisplacementWillOverscrollAmount
(
ParentLayerCoord
aDisplacement
)
const
;
CSSCoord
ScaleWillOverscrollAmount
(
float
aScale
CSSCoord
aFocus
)
const
;
bool
ScaleWillOverscrollBothSides
(
float
aScale
)
const
;
bool
IsAxisLocked
(
)
const
;
ParentLayerCoord
GetOrigin
(
)
const
;
ParentLayerCoord
GetCompositionLength
(
)
const
;
ParentLayerCoord
GetPageStart
(
)
const
;
ParentLayerCoord
GetPageLength
(
)
const
;
ParentLayerCoord
GetCompositionEnd
(
)
const
;
ParentLayerCoord
GetPageEnd
(
)
const
;
ParentLayerCoord
GetScrollRangeEnd
(
)
const
;
ParentLayerCoord
GetPos
(
)
const
{
return
mPos
;
}
bool
OverscrollBehaviorAllowsHandoff
(
)
const
;
bool
OverscrollBehaviorAllowsOverscrollEffect
(
)
const
;
virtual
ParentLayerCoord
GetPointOffset
(
const
ParentLayerPoint
&
aPoint
)
const
=
0
;
virtual
ParentLayerCoord
GetRectLength
(
const
ParentLayerRect
&
aRect
)
const
=
0
;
virtual
ParentLayerCoord
GetRectOffset
(
const
ParentLayerRect
&
aRect
)
const
=
0
;
virtual
CSSToParentLayerScale
GetScaleForAxis
(
const
CSSToParentLayerScale2D
&
aScale
)
const
=
0
;
virtual
ScreenPoint
MakePoint
(
ScreenCoord
aCoord
)
const
=
0
;
virtual
const
char
*
Name
(
)
const
=
0
;
protected
:
ParentLayerCoord
mPos
;
uint32_t
mVelocitySampleTimeMs
;
ParentLayerCoord
mVelocitySamplePos
;
ParentLayerCoord
mStartPos
;
float
mVelocity
;
bool
mAxisLocked
;
AsyncPanZoomController
*
mAsyncPanZoomController
;
ParentLayerCoord
mOverscroll
;
AxisPhysicsMSDModel
mMSDModel
;
nsTArray
<
std
:
:
pair
<
uint32_t
float
>
>
mVelocityQueue
;
const
FrameMetrics
&
GetFrameMetrics
(
)
const
;
const
ScrollMetadata
&
GetScrollMetadata
(
)
const
;
virtual
OverscrollBehavior
GetOverscrollBehavior
(
)
const
=
0
;
ParentLayerCoord
ApplyResistance
(
ParentLayerCoord
aOverscroll
)
const
;
void
StepOverscrollAnimation
(
double
aStepDurationMilliseconds
)
;
float
ToLocalVelocity
(
float
aVelocityInchesPerMs
)
const
;
}
;
class
AxisX
:
public
Axis
{
public
:
explicit
AxisX
(
AsyncPanZoomController
*
mAsyncPanZoomController
)
;
virtual
ParentLayerCoord
GetPointOffset
(
const
ParentLayerPoint
&
aPoint
)
const
override
;
virtual
ParentLayerCoord
GetRectLength
(
const
ParentLayerRect
&
aRect
)
const
override
;
virtual
ParentLayerCoord
GetRectOffset
(
const
ParentLayerRect
&
aRect
)
const
override
;
virtual
CSSToParentLayerScale
GetScaleForAxis
(
const
CSSToParentLayerScale2D
&
aScale
)
const
override
;
virtual
ScreenPoint
MakePoint
(
ScreenCoord
aCoord
)
const
override
;
virtual
const
char
*
Name
(
)
const
override
;
bool
CanScrollTo
(
Side
aSide
)
const
;
private
:
virtual
OverscrollBehavior
GetOverscrollBehavior
(
)
const
override
;
}
;
class
AxisY
:
public
Axis
{
public
:
explicit
AxisY
(
AsyncPanZoomController
*
mAsyncPanZoomController
)
;
virtual
ParentLayerCoord
GetPointOffset
(
const
ParentLayerPoint
&
aPoint
)
const
override
;
virtual
ParentLayerCoord
GetRectLength
(
const
ParentLayerRect
&
aRect
)
const
override
;
virtual
ParentLayerCoord
GetRectOffset
(
const
ParentLayerRect
&
aRect
)
const
override
;
virtual
CSSToParentLayerScale
GetScaleForAxis
(
const
CSSToParentLayerScale2D
&
aScale
)
const
override
;
virtual
ScreenPoint
MakePoint
(
ScreenCoord
aCoord
)
const
override
;
virtual
const
char
*
Name
(
)
const
override
;
bool
CanScrollTo
(
Side
aSide
)
const
;
private
:
virtual
OverscrollBehavior
GetOverscrollBehavior
(
)
const
override
;
}
;
}
}
#
endif
