#
include
"
SmoothScrollAnimation
.
h
"
#
include
"
AsyncPanZoomController
.
h
"
#
include
"
ScrollPositionUpdate
.
h
"
#
include
"
apz
/
src
/
GenericScrollAnimation
.
h
"
namespace
mozilla
{
namespace
layers
{
already_AddRefed
<
SmoothScrollAnimation
>
SmoothScrollAnimation
:
:
Create
(
AsyncPanZoomController
&
aApzc
const
nsPoint
&
aInitialPosition
ScrollOrigin
aOrigin
)
{
RefPtr
<
SmoothScrollAnimation
>
result
=
new
SmoothScrollAnimation
(
ScrollAnimationKind
:
:
Smooth
aApzc
aInitialPosition
aOrigin
)
;
return
result
.
forget
(
)
;
}
already_AddRefed
<
SmoothScrollAnimation
>
SmoothScrollAnimation
:
:
CreateForKeyboard
(
AsyncPanZoomController
&
aApzc
const
nsPoint
&
aInitialPosition
ScrollOrigin
aOrigin
)
{
RefPtr
<
SmoothScrollAnimation
>
result
=
new
SmoothScrollAnimation
(
ScrollAnimationKind
:
:
Keyboard
aApzc
aInitialPosition
aOrigin
)
;
return
result
.
forget
(
)
;
}
static
ScrollOrigin
OriginForDeltaType
(
ScrollWheelInput
:
:
ScrollDeltaType
aDeltaType
)
{
switch
(
aDeltaType
)
{
case
ScrollWheelInput
:
:
SCROLLDELTA_PAGE
:
return
ScrollOrigin
:
:
Pages
;
case
ScrollWheelInput
:
:
SCROLLDELTA_PIXEL
:
return
ScrollOrigin
:
:
Pixels
;
case
ScrollWheelInput
:
:
SCROLLDELTA_LINE
:
return
ScrollOrigin
:
:
MouseWheel
;
}
return
ScrollOrigin
:
:
MouseWheel
;
}
already_AddRefed
<
SmoothScrollAnimation
>
SmoothScrollAnimation
:
:
CreateForWheel
(
AsyncPanZoomController
&
aApzc
const
nsPoint
&
aInitialPosition
ScrollWheelInput
:
:
ScrollDeltaType
aDeltaType
)
{
RefPtr
<
SmoothScrollAnimation
>
result
=
new
SmoothScrollAnimation
(
ScrollAnimationKind
:
:
Wheel
aApzc
aInitialPosition
OriginForDeltaType
(
aDeltaType
)
)
;
MOZ_ASSERT
(
nsLayoutUtils
:
:
IsSmoothScrollingEnabled
(
)
"
We
shouldn
'
t
be
creating
a
WheelScrollAnimation
if
smooth
"
"
scrolling
is
disabled
"
)
;
result
-
>
mDirectionForcedToOverscroll
=
aApzc
.
mScrollMetadata
.
GetDisregardedDirection
(
)
;
return
result
.
forget
(
)
;
}
SmoothScrollAnimation
:
:
SmoothScrollAnimation
(
ScrollAnimationKind
aKind
AsyncPanZoomController
&
aApzc
const
nsPoint
&
aInitialPosition
ScrollOrigin
aOrigin
)
:
GenericScrollAnimation
(
aApzc
aInitialPosition
aOrigin
)
mKind
(
aKind
)
mOrigin
(
aOrigin
)
mTriggeredByScript
(
ScrollTriggeredByScript
:
:
No
)
{
}
SmoothScrollAnimation
*
SmoothScrollAnimation
:
:
AsSmoothScrollAnimation
(
)
{
return
this
;
}
void
SmoothScrollAnimation
:
:
UpdateDestinationAndSnapTargets
(
TimeStamp
aTime
const
nsPoint
&
aDestination
const
nsSize
&
aCurrentVelocity
ScrollSnapTargetIds
&
&
aSnapTargetIds
ScrollTriggeredByScript
aTriggeredByScript
)
{
GenericScrollAnimation
:
:
UpdateDestination
(
aTime
aDestination
aCurrentVelocity
)
;
mSnapTargetIds
=
std
:
:
move
(
aSnapTargetIds
)
;
mTriggeredByScript
=
aTriggeredByScript
;
}
ScrollOrigin
SmoothScrollAnimation
:
:
GetScrollOrigin
(
)
const
{
return
mOrigin
;
}
ScrollOrigin
SmoothScrollAnimation
:
:
GetScrollOriginForAction
(
KeyboardScrollAction
:
:
KeyboardScrollActionType
aAction
)
{
switch
(
aAction
)
{
case
KeyboardScrollAction
:
:
eScrollCharacter
:
case
KeyboardScrollAction
:
:
eScrollLine
:
{
return
ScrollOrigin
:
:
Lines
;
}
case
KeyboardScrollAction
:
:
eScrollPage
:
return
ScrollOrigin
:
:
Pages
;
case
KeyboardScrollAction
:
:
eScrollComplete
:
return
ScrollOrigin
:
:
Other
;
default
:
MOZ_ASSERT
(
false
"
Unknown
keyboard
scroll
action
type
"
)
;
return
ScrollOrigin
:
:
Other
;
}
}
}
}
