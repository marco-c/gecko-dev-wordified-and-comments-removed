#
ifndef
mozilla_layers_APZUtils_h
#
define
mozilla_layers_APZUtils_h
#
include
<
stdint
.
h
>
#
include
"
FrameMetrics
.
h
"
#
include
"
LayersTypes
.
h
"
#
include
"
UnitTransforms
.
h
"
#
include
"
mozilla
/
gfx
/
CompositorHitTestInfo
.
h
"
#
include
"
mozilla
/
gfx
/
Point
.
h
"
#
include
"
mozilla
/
DefineEnum
.
h
"
#
include
"
mozilla
/
EnumSet
.
h
"
#
include
"
mozilla
/
FloatingPoint
.
h
"
namespace
mozilla
{
struct
ExternalPixel
;
template
<
>
struct
IsPixel
<
ExternalPixel
>
:
TrueType
{
}
;
typedef
gfx
:
:
CoordTyped
<
ExternalPixel
>
ExternalCoord
;
typedef
gfx
:
:
IntCoordTyped
<
ExternalPixel
>
ExternalIntCoord
;
typedef
gfx
:
:
PointTyped
<
ExternalPixel
>
ExternalPoint
;
typedef
gfx
:
:
IntPointTyped
<
ExternalPixel
>
ExternalIntPoint
;
typedef
gfx
:
:
SizeTyped
<
ExternalPixel
>
ExternalSize
;
typedef
gfx
:
:
IntSizeTyped
<
ExternalPixel
>
ExternalIntSize
;
typedef
gfx
:
:
RectTyped
<
ExternalPixel
>
ExternalRect
;
typedef
gfx
:
:
IntRectTyped
<
ExternalPixel
>
ExternalIntRect
;
typedef
gfx
:
:
MarginTyped
<
ExternalPixel
>
ExternalMargin
;
typedef
gfx
:
:
IntMarginTyped
<
ExternalPixel
>
ExternalIntMargin
;
typedef
gfx
:
:
IntRegionTyped
<
ExternalPixel
>
ExternalIntRegion
;
typedef
gfx
:
:
Matrix4x4Typed
<
ExternalPixel
ParentLayerPixel
>
ExternalToParentLayerMatrix4x4
;
struct
ExternalPixel
{
}
;
namespace
layers
{
class
AsyncPanZoomController
;
enum
CancelAnimationFlags
:
uint32_t
{
Default
=
0x0
ExcludeOverscroll
=
0x1
ScrollSnap
=
0x2
ExcludeWheel
=
0x4
TriggeredExternally
=
0x8
}
;
inline
CancelAnimationFlags
operator
|
(
CancelAnimationFlags
a
CancelAnimationFlags
b
)
{
return
static_cast
<
CancelAnimationFlags
>
(
static_cast
<
int
>
(
a
)
|
static_cast
<
int
>
(
b
)
)
;
}
typedef
EnumSet
<
ScrollDirection
>
ScrollDirections
;
enum
class
ScrollSource
{
DOM
Touch
Wheel
Keyboard
}
;
MOZ_DEFINE_ENUM_CLASS_WITH_BASE
(
APZWheelAction
uint8_t
(
Scroll
PinchZoom
)
)
const
float
COORDINATE_EPSILON
=
0
.
01f
;
template
<
typename
Units
>
static
bool
IsZero
(
const
gfx
:
:
PointTyped
<
Units
>
&
aPoint
)
{
return
FuzzyEqualsAdditive
(
aPoint
.
x
0
.
0f
COORDINATE_EPSILON
)
&
&
FuzzyEqualsAdditive
(
aPoint
.
y
0
.
0f
COORDINATE_EPSILON
)
;
}
inline
AsyncTransformMatrix
CompleteAsyncTransform
(
const
AsyncTransformComponentMatrix
&
aMatrix
)
{
return
ViewAs
<
AsyncTransformMatrix
>
(
aMatrix
PixelCastJustification
:
:
MultipleAsyncTransforms
)
;
}
struct
TargetConfirmationFlags
{
explicit
TargetConfirmationFlags
(
bool
aTargetConfirmed
)
:
mTargetConfirmed
(
aTargetConfirmed
)
mRequiresTargetConfirmation
(
false
)
{
}
explicit
TargetConfirmationFlags
(
const
gfx
:
:
CompositorHitTestInfo
&
aHitTestInfo
)
:
mTargetConfirmed
(
(
aHitTestInfo
!
=
gfx
:
:
CompositorHitTestInvisibleToHit
)
&
&
!
aHitTestInfo
.
contains
(
gfx
:
:
CompositorHitTestFlags
:
:
eDispatchToContent
)
)
mRequiresTargetConfirmation
(
aHitTestInfo
.
contains
(
gfx
:
:
CompositorHitTestFlags
:
:
eRequiresTargetConfirmation
)
)
{
}
bool
mTargetConfirmed
:
1
;
bool
mRequiresTargetConfirmation
:
1
;
}
;
class
MOZ_RAII
AutoApplyAsyncTestAttributes
{
public
:
explicit
AutoApplyAsyncTestAttributes
(
AsyncPanZoomController
*
)
;
~
AutoApplyAsyncTestAttributes
(
)
;
private
:
AsyncPanZoomController
*
mApzc
;
FrameMetrics
mPrevFrameMetrics
;
}
;
enum
class
AsyncTransformComponent
{
eLayout
eVisual
}
;
using
AsyncTransformComponents
=
EnumSet
<
AsyncTransformComponent
>
;
constexpr
AsyncTransformComponents
LayoutAndVisual
(
AsyncTransformComponent
:
:
eLayout
AsyncTransformComponent
:
:
eVisual
)
;
namespace
apz
{
void
InitializeGlobalState
(
)
;
const
ScreenMargin
CalculatePendingDisplayPort
(
const
FrameMetrics
&
aFrameMetrics
const
ParentLayerPoint
&
aVelocity
)
;
bool
IsCloseToHorizontal
(
float
aAngle
float
aThreshold
)
;
bool
IsCloseToVertical
(
float
aAngle
float
aThreshold
)
;
}
}
}
#
endif
