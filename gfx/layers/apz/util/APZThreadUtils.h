#
ifndef
mozilla_layers_APZThreadUtils_h
#
define
mozilla_layers_APZThreadUtils_h
#
include
"
base
/
message_loop
.
h
"
#
include
"
nsINamed
.
h
"
#
include
"
nsITimer
.
h
"
namespace
mozilla
{
class
Runnable
;
namespace
layers
{
class
APZThreadUtils
{
public
:
static
void
SetThreadAssertionsEnabled
(
bool
aEnabled
)
;
static
bool
GetThreadAssertionsEnabled
(
)
;
static
void
SetControllerThread
(
MessageLoop
*
aLoop
)
;
static
void
AssertOnControllerThread
(
)
;
static
void
AssertOnCompositorThread
(
)
;
static
void
RunOnControllerThread
(
already_AddRefed
<
Runnable
>
aTask
)
;
static
bool
IsControllerThread
(
)
;
}
;
class
GenericTimerCallbackBase
:
public
nsITimerCallback
{
public
:
NS_DECL_THREADSAFE_ISUPPORTS
protected
:
virtual
~
GenericTimerCallbackBase
(
)
{
}
}
;
template
<
typename
Function
>
class
GenericTimerCallback
final
:
public
GenericTimerCallbackBase
{
public
:
explicit
GenericTimerCallback
(
const
Function
&
aFunction
)
:
mFunction
(
aFunction
)
{
}
NS_IMETHOD
Notify
(
nsITimer
*
)
override
{
mFunction
(
)
;
return
NS_OK
;
}
private
:
Function
mFunction
;
}
;
template
<
typename
Function
>
GenericTimerCallback
<
Function
>
*
NewTimerCallback
(
const
Function
&
aFunction
)
{
return
new
GenericTimerCallback
<
Function
>
(
aFunction
)
;
}
class
GenericNamedTimerCallbackBase
:
public
nsITimerCallback
public
nsINamed
{
public
:
NS_DECL_THREADSAFE_ISUPPORTS
protected
:
virtual
~
GenericNamedTimerCallbackBase
(
)
{
}
}
;
template
<
typename
Function
>
class
GenericNamedTimerCallback
final
:
public
GenericNamedTimerCallbackBase
{
public
:
explicit
GenericNamedTimerCallback
(
const
Function
&
aFunction
const
char
*
aName
)
:
mFunction
(
aFunction
)
mName
(
aName
)
{
}
NS_IMETHOD
Notify
(
nsITimer
*
)
override
{
mFunction
(
)
;
return
NS_OK
;
}
NS_IMETHOD
GetName
(
nsACString
&
aName
)
override
{
aName
=
mName
;
return
NS_OK
;
}
NS_IMETHOD
SetName
(
const
char
*
aName
)
override
{
mName
.
Assign
(
aName
)
;
return
NS_OK
;
}
private
:
Function
mFunction
;
nsCString
mName
;
}
;
template
<
typename
Function
>
GenericNamedTimerCallback
<
Function
>
*
NewNamedTimerCallback
(
const
Function
&
aFunction
const
char
*
aName
)
{
return
new
GenericNamedTimerCallback
<
Function
>
(
aFunction
aName
)
;
}
}
}
#
endif
