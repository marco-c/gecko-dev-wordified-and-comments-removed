#
ifndef
mozilla_layers_APZEventState_h
#
define
mozilla_layers_APZEventState_h
#
include
<
stdint
.
h
>
#
include
"
Units
.
h
"
#
include
"
mozilla
/
EventForwards
.
h
"
#
include
"
mozilla
/
layers
/
GeckoContentControllerTypes
.
h
"
#
include
"
mozilla
/
layers
/
ScrollableLayerGuid
.
h
"
#
include
"
mozilla
/
layers
/
TouchCounter
.
h
"
#
include
"
mozilla
/
RefPtr
.
h
"
#
include
"
nsCOMPtr
.
h
"
#
include
"
nsISupportsImpl
.
h
"
#
include
"
nsIWeakReferenceUtils
.
h
"
#
include
<
functional
>
template
<
class
>
class
nsCOMPtr
;
class
nsIContent
;
class
nsIWidget
;
namespace
mozilla
{
class
PresShell
;
namespace
layers
{
class
ActiveElementManager
;
typedef
std
:
:
function
<
void
(
uint64_t
bool
)
>
ContentReceivedInputBlockCallback
;
class
APZEventState
final
{
typedef
GeckoContentController_APZStateChange
APZStateChange
;
typedef
ScrollableLayerGuid
:
:
ViewID
ViewID
;
public
:
APZEventState
(
nsIWidget
*
aWidget
ContentReceivedInputBlockCallback
&
&
aCallback
)
;
NS_INLINE_DECL_REFCOUNTING
(
APZEventState
)
;
void
ProcessSingleTap
(
const
CSSPoint
&
aPoint
const
CSSToLayoutDeviceScale
&
aScale
Modifiers
aModifiers
int32_t
aClickCount
)
;
MOZ_CAN_RUN_SCRIPT
void
ProcessLongTap
(
PresShell
*
aPresShell
const
CSSPoint
&
aPoint
const
CSSToLayoutDeviceScale
&
aScale
Modifiers
aModifiers
uint64_t
aInputBlockId
)
;
MOZ_CAN_RUN_SCRIPT
void
ProcessLongTapUp
(
PresShell
*
aPresShell
const
CSSPoint
&
aPoint
const
CSSToLayoutDeviceScale
&
aScale
Modifiers
aModifiers
)
;
void
ProcessTouchEvent
(
const
WidgetTouchEvent
&
aEvent
const
ScrollableLayerGuid
&
aGuid
uint64_t
aInputBlockId
nsEventStatus
aApzResponse
nsEventStatus
aContentResponse
nsTArray
<
TouchBehaviorFlags
>
&
&
aAllowedTouchBehaviors
)
;
void
ProcessWheelEvent
(
const
WidgetWheelEvent
&
aEvent
uint64_t
aInputBlockId
)
;
void
ProcessMouseEvent
(
const
WidgetMouseEvent
&
aEvent
uint64_t
aInputBlockId
)
;
void
ProcessAPZStateChange
(
ViewID
aViewId
APZStateChange
aChange
int
aArg
)
;
void
ProcessClusterHit
(
)
;
private
:
~
APZEventState
(
)
;
bool
SendPendingTouchPreventedResponse
(
bool
aPreventDefault
)
;
MOZ_CAN_RUN_SCRIPT
bool
FireContextmenuEvents
(
PresShell
*
aPresShell
const
CSSPoint
&
aPoint
const
CSSToLayoutDeviceScale
&
aScale
Modifiers
aModifiers
const
nsCOMPtr
<
nsIWidget
>
&
aWidget
)
;
already_AddRefed
<
nsIWidget
>
GetWidget
(
)
const
;
already_AddRefed
<
nsIContent
>
GetTouchRollup
(
)
const
;
bool
MainThreadAgreesEventsAreConsumableByAPZ
(
)
const
;
private
:
nsWeakPtr
mWidget
;
RefPtr
<
ActiveElementManager
>
mActiveElementManager
;
ContentReceivedInputBlockCallback
mContentReceivedInputBlockCallback
;
TouchCounter
mTouchCounter
;
bool
mPendingTouchPreventedResponse
;
ScrollableLayerGuid
mPendingTouchPreventedGuid
;
uint64_t
mPendingTouchPreventedBlockId
;
bool
mEndTouchIsClick
;
bool
mFirstTouchCancelled
;
bool
mTouchEndCancelled
;
int32_t
mLastTouchIdentifier
;
nsTArray
<
TouchBehaviorFlags
>
mTouchBlockAllowedBehaviors
;
nsWeakPtr
mTouchRollup
;
}
;
}
}
#
endif
