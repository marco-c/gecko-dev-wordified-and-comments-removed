#
ifndef
mozilla_layers_APZCCallbackHelper_h
#
define
mozilla_layers_APZCCallbackHelper_h
#
include
"
FrameMetrics
.
h
"
#
include
"
InputData
.
h
"
#
include
"
mozilla
/
EventForwards
.
h
"
#
include
"
mozilla
/
layers
/
APZUtils
.
h
"
#
include
"
nsIDOMWindowUtils
.
h
"
#
include
<
functional
>
class
nsIContent
;
class
nsIDocument
;
class
nsIPresShell
;
class
nsIScrollableFrame
;
class
nsIWidget
;
template
<
class
T
>
struct
already_AddRefed
;
template
<
class
T
>
class
nsCOMPtr
;
namespace
mozilla
{
namespace
layers
{
typedef
std
:
:
function
<
void
(
uint64_t
const
nsTArray
<
TouchBehaviorFlags
>
&
)
>
SetAllowedTouchBehaviorCallback
;
class
APZCCallbackHelper
{
typedef
mozilla
:
:
layers
:
:
FrameMetrics
FrameMetrics
;
typedef
mozilla
:
:
layers
:
:
ScrollableLayerGuid
ScrollableLayerGuid
;
public
:
static
void
UpdateRootFrame
(
FrameMetrics
&
aMetrics
)
;
static
void
UpdateSubFrame
(
FrameMetrics
&
aMetrics
)
;
static
bool
GetOrCreateScrollIdentifiers
(
nsIContent
*
aContent
uint32_t
*
aPresShellIdOut
FrameMetrics
:
:
ViewID
*
aViewIdOut
)
;
static
void
InitializeRootDisplayport
(
nsIPresShell
*
aPresShell
)
;
static
nsPresContext
*
GetPresContextForContent
(
nsIContent
*
aContent
)
;
static
nsIPresShell
*
GetRootContentDocumentPresShellForContent
(
nsIContent
*
aContent
)
;
static
CSSPoint
ApplyCallbackTransform
(
const
CSSPoint
&
aInput
const
ScrollableLayerGuid
&
aGuid
)
;
static
mozilla
:
:
LayoutDeviceIntPoint
ApplyCallbackTransform
(
const
LayoutDeviceIntPoint
&
aPoint
const
ScrollableLayerGuid
&
aGuid
const
CSSToLayoutDeviceScale
&
aScale
)
;
static
void
ApplyCallbackTransform
(
WidgetEvent
&
aEvent
const
ScrollableLayerGuid
&
aGuid
const
CSSToLayoutDeviceScale
&
aScale
)
;
static
nsEventStatus
DispatchWidgetEvent
(
WidgetGUIEvent
&
aEvent
)
;
static
nsEventStatus
DispatchSynthesizedMouseEvent
(
EventMessage
aMsg
uint64_t
aTime
const
LayoutDevicePoint
&
aRefPoint
Modifiers
aModifiers
int32_t
aClickCount
nsIWidget
*
aWidget
)
;
static
bool
DispatchMouseEvent
(
const
nsCOMPtr
<
nsIPresShell
>
&
aPresShell
const
nsString
&
aType
const
CSSPoint
&
aPoint
int32_t
aButton
int32_t
aClickCount
int32_t
aModifiers
bool
aIgnoreRootScrollFrame
unsigned
short
aInputSourceArg
uint32_t
aPointerId
)
;
static
void
FireSingleTapEvent
(
const
LayoutDevicePoint
&
aPoint
Modifiers
aModifiers
int32_t
aClickCount
nsIWidget
*
aWidget
)
;
static
bool
SendSetTargetAPZCNotification
(
nsIWidget
*
aWidget
nsIDocument
*
aDocument
const
WidgetGUIEvent
&
aEvent
const
ScrollableLayerGuid
&
aGuid
uint64_t
aInputBlockId
)
;
static
void
SendSetAllowedTouchBehaviorNotification
(
nsIWidget
*
aWidget
nsIDocument
*
aDocument
const
WidgetTouchEvent
&
aEvent
uint64_t
aInputBlockId
const
SetAllowedTouchBehaviorCallback
&
aCallback
)
;
static
void
NotifyMozMouseScrollEvent
(
const
FrameMetrics
:
:
ViewID
&
aScrollId
const
nsString
&
aEvent
)
;
static
void
NotifyFlushComplete
(
nsIPresShell
*
aShell
)
;
static
void
NotifyAsyncScrollbarDragRejected
(
const
FrameMetrics
:
:
ViewID
&
aScrollId
)
;
static
void
NotifyAutoscrollHandledByAPZ
(
const
FrameMetrics
:
:
ViewID
&
aScrollId
)
;
static
void
CancelAutoscroll
(
const
FrameMetrics
:
:
ViewID
&
aScrollId
)
;
static
void
SuppressDisplayport
(
const
bool
&
aEnabled
const
nsCOMPtr
<
nsIPresShell
>
&
aShell
)
;
static
void
RespectDisplayPortSuppression
(
bool
aEnabled
const
nsCOMPtr
<
nsIPresShell
>
&
aShell
)
;
static
bool
IsDisplayportSuppressed
(
)
;
static
void
AdjustDisplayPortForScrollDelta
(
mozilla
:
:
layers
:
:
FrameMetrics
&
aFrameMetrics
const
CSSPoint
&
aActualScrollOffset
)
;
static
bool
IsScrollInProgress
(
nsIScrollableFrame
*
aFrame
)
;
static
void
NotifyPinchGesture
(
PinchGestureInput
:
:
PinchGestureType
aType
LayoutDeviceCoord
aSpanChange
Modifiers
aModifiers
nsIWidget
*
aWidget
)
;
private
:
static
uint64_t
sLastTargetAPZCNotificationInputBlock
;
}
;
}
}
#
endif
