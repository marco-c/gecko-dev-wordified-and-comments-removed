#
include
"
ContentProcessController
.
h
"
#
include
"
mozilla
/
dom
/
TabChild
.
h
"
#
include
"
mozilla
/
layers
/
APZCCallbackHelper
.
h
"
#
include
"
mozilla
/
layers
/
APZChild
.
h
"
#
include
"
nsIContentInlines
.
h
"
#
include
"
InputData
.
h
"
namespace
mozilla
{
namespace
layers
{
ContentProcessController
:
:
ContentProcessController
(
const
RefPtr
<
dom
:
:
TabChild
>
&
aBrowser
)
:
mBrowser
(
aBrowser
)
{
MOZ_ASSERT
(
mBrowser
)
;
}
void
ContentProcessController
:
:
RequestContentRepaint
(
const
FrameMetrics
&
aFrameMetrics
)
{
if
(
mBrowser
)
{
mBrowser
-
>
UpdateFrame
(
aFrameMetrics
)
;
}
}
void
ContentProcessController
:
:
HandleTap
(
TapType
aType
const
LayoutDevicePoint
&
aPoint
Modifiers
aModifiers
const
ScrollableLayerGuid
&
aGuid
uint64_t
aInputBlockId
)
{
MOZ_ASSERT
(
false
)
;
}
void
ContentProcessController
:
:
NotifyPinchGesture
(
PinchGestureInput
:
:
PinchGestureType
aType
const
ScrollableLayerGuid
&
aGuid
LayoutDeviceCoord
aSpanChange
Modifiers
aModifiers
)
{
MOZ_ASSERT_UNREACHABLE
(
"
Unexpected
message
to
content
process
"
)
;
}
void
ContentProcessController
:
:
NotifyAPZStateChange
(
const
ScrollableLayerGuid
&
aGuid
APZStateChange
aChange
int
aArg
)
{
if
(
mBrowser
)
{
mBrowser
-
>
NotifyAPZStateChange
(
aGuid
.
mScrollId
aChange
aArg
)
;
}
}
void
ContentProcessController
:
:
NotifyMozMouseScrollEvent
(
const
FrameMetrics
:
:
ViewID
&
aScrollId
const
nsString
&
aEvent
)
{
if
(
mBrowser
)
{
APZCCallbackHelper
:
:
NotifyMozMouseScrollEvent
(
aScrollId
aEvent
)
;
}
}
void
ContentProcessController
:
:
NotifyFlushComplete
(
)
{
if
(
mBrowser
)
{
nsCOMPtr
<
nsIPresShell
>
shell
;
if
(
nsCOMPtr
<
nsIDocument
>
doc
=
mBrowser
-
>
GetDocument
(
)
)
{
shell
=
doc
-
>
GetShell
(
)
;
}
APZCCallbackHelper
:
:
NotifyFlushComplete
(
shell
.
get
(
)
)
;
}
}
void
ContentProcessController
:
:
NotifyAsyncScrollbarDragRejected
(
const
FrameMetrics
:
:
ViewID
&
aScrollId
)
{
APZCCallbackHelper
:
:
NotifyAsyncScrollbarDragRejected
(
aScrollId
)
;
}
void
ContentProcessController
:
:
NotifyAsyncAutoscrollRejected
(
const
FrameMetrics
:
:
ViewID
&
aScrollId
)
{
APZCCallbackHelper
:
:
NotifyAsyncAutoscrollRejected
(
aScrollId
)
;
}
void
ContentProcessController
:
:
CancelAutoscroll
(
const
ScrollableLayerGuid
&
aGuid
)
{
MOZ_ASSERT_UNREACHABLE
(
"
Unexpected
message
to
content
process
"
)
;
}
void
ContentProcessController
:
:
PostDelayedTask
(
already_AddRefed
<
Runnable
>
aRunnable
int
aDelayMs
)
{
MOZ_ASSERT_UNREACHABLE
(
"
ContentProcessController
should
only
be
used
remotely
.
"
)
;
}
bool
ContentProcessController
:
:
IsRepaintThread
(
)
{
return
NS_IsMainThread
(
)
;
}
void
ContentProcessController
:
:
DispatchToRepaintThread
(
already_AddRefed
<
Runnable
>
aTask
)
{
NS_DispatchToMainThread
(
std
:
:
move
(
aTask
)
)
;
}
}
}
