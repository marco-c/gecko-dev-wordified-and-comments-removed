#
include
"
FrameMetrics
.
h
"
#
include
"
gfxPrefs
.
h
"
#
include
"
nsStyleConsts
.
h
"
namespace
mozilla
{
namespace
layers
{
const
FrameMetrics
:
:
ViewID
FrameMetrics
:
:
NULL_SCROLL_ID
=
0
;
void
FrameMetrics
:
:
RecalculateViewportOffset
(
)
{
if
(
!
mIsRootContent
)
{
return
;
}
CSSRect
visualViewport
=
GetVisualViewport
(
)
;
if
(
mViewport
.
Contains
(
visualViewport
)
|
|
visualViewport
.
Contains
(
mViewport
)
)
{
return
;
}
if
(
(
mViewport
.
Width
(
)
<
visualViewport
.
Width
(
)
&
&
!
FuzzyEqualsMultiplicative
(
mViewport
.
Width
(
)
visualViewport
.
Width
(
)
)
)
|
|
(
mViewport
.
Height
(
)
<
visualViewport
.
Height
(
)
&
&
!
FuzzyEqualsMultiplicative
(
mViewport
.
Height
(
)
visualViewport
.
Height
(
)
)
)
)
{
if
(
mViewport
.
X
(
)
<
visualViewport
.
X
(
)
)
{
mViewport
.
MoveToX
(
visualViewport
.
X
(
)
)
;
}
else
if
(
visualViewport
.
XMost
(
)
<
mViewport
.
XMost
(
)
)
{
mViewport
.
MoveByX
(
visualViewport
.
XMost
(
)
-
mViewport
.
XMost
(
)
)
;
}
if
(
mViewport
.
Y
(
)
<
visualViewport
.
Y
(
)
)
{
mViewport
.
MoveToY
(
visualViewport
.
Y
(
)
)
;
}
else
if
(
visualViewport
.
YMost
(
)
<
mViewport
.
YMost
(
)
)
{
mViewport
.
MoveByY
(
visualViewport
.
YMost
(
)
-
mViewport
.
YMost
(
)
)
;
}
}
else
{
if
(
visualViewport
.
X
(
)
<
mViewport
.
X
(
)
)
{
mViewport
.
MoveToX
(
visualViewport
.
X
(
)
)
;
}
else
if
(
mViewport
.
XMost
(
)
<
visualViewport
.
XMost
(
)
)
{
mViewport
.
MoveByX
(
visualViewport
.
XMost
(
)
-
mViewport
.
XMost
(
)
)
;
}
if
(
visualViewport
.
Y
(
)
<
mViewport
.
Y
(
)
)
{
mViewport
.
MoveToY
(
visualViewport
.
Y
(
)
)
;
}
else
if
(
mViewport
.
YMost
(
)
<
visualViewport
.
YMost
(
)
)
{
mViewport
.
MoveByY
(
visualViewport
.
YMost
(
)
-
mViewport
.
YMost
(
)
)
;
}
}
}
void
ScrollMetadata
:
:
SetUsesContainerScrolling
(
bool
aValue
)
{
MOZ_ASSERT_IF
(
aValue
gfxPrefs
:
:
LayoutUseContainersForRootFrames
(
)
)
;
mUsesContainerScrolling
=
aValue
;
}
static
OverscrollBehavior
ToOverscrollBehavior
(
StyleOverscrollBehavior
aBehavior
)
{
switch
(
aBehavior
)
{
case
StyleOverscrollBehavior
:
:
Auto
:
return
OverscrollBehavior
:
:
Auto
;
case
StyleOverscrollBehavior
:
:
Contain
:
return
OverscrollBehavior
:
:
Contain
;
case
StyleOverscrollBehavior
:
:
None
:
return
OverscrollBehavior
:
:
None
;
}
MOZ_ASSERT_UNREACHABLE
(
"
Invalid
overscroll
behavior
"
)
;
return
OverscrollBehavior
:
:
Auto
;
}
OverscrollBehaviorInfo
OverscrollBehaviorInfo
:
:
FromStyleConstants
(
StyleOverscrollBehavior
aBehaviorX
StyleOverscrollBehavior
aBehaviorY
)
{
OverscrollBehaviorInfo
result
;
result
.
mBehaviorX
=
ToOverscrollBehavior
(
aBehaviorX
)
;
result
.
mBehaviorY
=
ToOverscrollBehavior
(
aBehaviorY
)
;
return
result
;
}
StaticAutoPtr
<
const
ScrollMetadata
>
ScrollMetadata
:
:
sNullMetadata
;
}
}
