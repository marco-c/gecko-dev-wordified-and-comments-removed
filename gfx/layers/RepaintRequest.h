#
ifndef
GFX_REPAINTREQUEST_H
#
define
GFX_REPAINTREQUEST_H
#
include
<
iosfwd
>
#
include
<
stdint
.
h
>
#
include
"
FrameMetrics
.
h
"
#
include
"
mozilla
/
DefineEnum
.
h
"
#
include
"
mozilla
/
gfx
/
BasePoint
.
h
"
#
include
"
mozilla
/
gfx
/
Rect
.
h
"
#
include
"
mozilla
/
gfx
/
ScaleFactor
.
h
"
#
include
"
mozilla
/
TimeStamp
.
h
"
#
include
"
Units
.
h
"
#
include
"
UnitTransforms
.
h
"
namespace
IPC
{
template
<
typename
T
>
struct
ParamTraits
;
}
namespace
mozilla
{
namespace
layers
{
struct
RepaintRequest
{
friend
struct
IPC
:
:
ParamTraits
<
mozilla
:
:
layers
:
:
RepaintRequest
>
;
public
:
MOZ_DEFINE_ENUM_WITH_BASE_AT_CLASS_SCOPE
(
ScrollOffsetUpdateType
uint8_t
(
eNone
eUserAction
eVisualUpdate
)
)
;
RepaintRequest
(
)
:
mScrollId
(
ScrollableLayerGuid
:
:
NULL_SCROLL_ID
)
mPresShellResolution
(
1
)
mCompositionBounds
(
0
0
0
0
)
mCumulativeResolution
(
)
mDevPixelsPerCSSPixel
(
1
)
mScrollOffset
(
0
0
)
mZoom
(
)
mDisplayPortMargins
(
0
0
0
0
)
mPresShellId
(
-
1
)
mLayoutViewport
(
0
0
0
0
)
mTransformToAncestorScale
(
)
mPaintRequestTime
(
)
mScrollUpdateType
(
eNone
)
mIsRootContent
(
false
)
mIsAnimationInProgress
(
false
)
mIsScrollInfoLayer
(
false
)
{
}
RepaintRequest
(
const
FrameMetrics
&
aOther
const
ScreenMargin
&
aDisplayportMargins
const
ScrollOffsetUpdateType
aScrollUpdateType
bool
aIsAnimationInProgress
)
:
mScrollId
(
aOther
.
GetScrollId
(
)
)
mPresShellResolution
(
aOther
.
GetPresShellResolution
(
)
)
mCompositionBounds
(
aOther
.
GetCompositionBounds
(
)
)
mCumulativeResolution
(
aOther
.
GetCumulativeResolution
(
)
)
mDevPixelsPerCSSPixel
(
aOther
.
GetDevPixelsPerCSSPixel
(
)
)
mScrollOffset
(
aOther
.
GetVisualScrollOffset
(
)
)
mZoom
(
aOther
.
GetZoom
(
)
)
mScrollGeneration
(
aOther
.
GetScrollGeneration
(
)
)
mDisplayPortMargins
(
aDisplayportMargins
)
mPresShellId
(
aOther
.
GetPresShellId
(
)
)
mLayoutViewport
(
aOther
.
GetLayoutViewport
(
)
)
mTransformToAncestorScale
(
aOther
.
GetTransformToAncestorScale
(
)
)
mPaintRequestTime
(
aOther
.
GetPaintRequestTime
(
)
)
mScrollUpdateType
(
aScrollUpdateType
)
mIsRootContent
(
aOther
.
IsRootContent
(
)
)
mIsAnimationInProgress
(
aIsAnimationInProgress
)
mIsScrollInfoLayer
(
aOther
.
IsScrollInfoLayer
(
)
)
{
}
bool
operator
=
=
(
const
RepaintRequest
&
aOther
)
const
{
return
mScrollId
=
=
aOther
.
mScrollId
&
&
mPresShellResolution
=
=
aOther
.
mPresShellResolution
&
&
mCompositionBounds
.
IsEqualEdges
(
aOther
.
mCompositionBounds
)
&
&
mCumulativeResolution
=
=
aOther
.
mCumulativeResolution
&
&
mDevPixelsPerCSSPixel
=
=
aOther
.
mDevPixelsPerCSSPixel
&
&
mScrollOffset
=
=
aOther
.
mScrollOffset
&
&
mScrollGeneration
=
=
aOther
.
mScrollGeneration
&
&
mDisplayPortMargins
=
=
aOther
.
mDisplayPortMargins
&
&
mPresShellId
=
=
aOther
.
mPresShellId
&
&
mLayoutViewport
.
IsEqualEdges
(
aOther
.
mLayoutViewport
)
&
&
mTransformToAncestorScale
=
=
aOther
.
mTransformToAncestorScale
&
&
mPaintRequestTime
=
=
aOther
.
mPaintRequestTime
&
&
mScrollUpdateType
=
=
aOther
.
mScrollUpdateType
&
&
mIsRootContent
=
=
aOther
.
mIsRootContent
&
&
mIsAnimationInProgress
=
=
aOther
.
mIsAnimationInProgress
&
&
mIsScrollInfoLayer
=
=
aOther
.
mIsScrollInfoLayer
;
}
bool
operator
!
=
(
const
RepaintRequest
&
aOther
)
const
{
return
!
operator
=
=
(
aOther
)
;
}
friend
std
:
:
ostream
&
operator
<
<
(
std
:
:
ostream
&
aOut
const
RepaintRequest
&
aRequest
)
;
CSSToScreenScale2D
DisplayportPixelsPerCSSPixel
(
)
const
{
return
mZoom
*
mTransformToAncestorScale
;
}
CSSToLayerScale
LayersPixelsPerCSSPixel
(
)
const
{
return
mDevPixelsPerCSSPixel
*
mCumulativeResolution
;
}
LayerToParentLayerScale
GetAsyncZoom
(
)
const
{
return
mZoom
/
LayersPixelsPerCSSPixel
(
)
;
}
CSSSize
CalculateCompositedSizeInCssPixels
(
)
const
{
if
(
GetZoom
(
)
=
=
CSSToParentLayerScale
(
0
)
)
{
return
CSSSize
(
)
;
}
return
mCompositionBounds
.
Size
(
)
/
GetZoom
(
)
;
}
float
GetPresShellResolution
(
)
const
{
return
mPresShellResolution
;
}
const
ParentLayerRect
&
GetCompositionBounds
(
)
const
{
return
mCompositionBounds
;
}
const
LayoutDeviceToLayerScale
&
GetCumulativeResolution
(
)
const
{
return
mCumulativeResolution
;
}
const
CSSToLayoutDeviceScale
&
GetDevPixelsPerCSSPixel
(
)
const
{
return
mDevPixelsPerCSSPixel
;
}
bool
IsAnimationInProgress
(
)
const
{
return
mIsAnimationInProgress
;
}
bool
IsRootContent
(
)
const
{
return
mIsRootContent
;
}
CSSPoint
GetLayoutScrollOffset
(
)
const
{
return
mLayoutViewport
.
TopLeft
(
)
;
}
const
CSSPoint
&
GetVisualScrollOffset
(
)
const
{
return
mScrollOffset
;
}
const
CSSToParentLayerScale
&
GetZoom
(
)
const
{
return
mZoom
;
}
ScrollOffsetUpdateType
GetScrollUpdateType
(
)
const
{
return
mScrollUpdateType
;
}
bool
GetScrollOffsetUpdated
(
)
const
{
return
mScrollUpdateType
!
=
eNone
;
}
ScrollGeneration
GetScrollGeneration
(
)
const
{
return
mScrollGeneration
;
}
ScrollableLayerGuid
:
:
ViewID
GetScrollId
(
)
const
{
return
mScrollId
;
}
const
ScreenMargin
&
GetDisplayPortMargins
(
)
const
{
return
mDisplayPortMargins
;
}
uint32_t
GetPresShellId
(
)
const
{
return
mPresShellId
;
}
const
CSSRect
&
GetLayoutViewport
(
)
const
{
return
mLayoutViewport
;
}
const
ParentLayerToScreenScale2D
&
GetTransformToAncestorScale
(
)
const
{
return
mTransformToAncestorScale
;
}
const
TimeStamp
&
GetPaintRequestTime
(
)
const
{
return
mPaintRequestTime
;
}
bool
IsScrollInfoLayer
(
)
const
{
return
mIsScrollInfoLayer
;
}
protected
:
void
SetIsAnimationInProgress
(
bool
aInProgress
)
{
mIsAnimationInProgress
=
aInProgress
;
}
void
SetIsRootContent
(
bool
aIsRootContent
)
{
mIsRootContent
=
aIsRootContent
;
}
void
SetIsScrollInfoLayer
(
bool
aIsScrollInfoLayer
)
{
mIsScrollInfoLayer
=
aIsScrollInfoLayer
;
}
private
:
ScrollableLayerGuid
:
:
ViewID
mScrollId
;
float
mPresShellResolution
;
ParentLayerRect
mCompositionBounds
;
LayoutDeviceToLayerScale
mCumulativeResolution
;
CSSToLayoutDeviceScale
mDevPixelsPerCSSPixel
;
CSSPoint
mScrollOffset
;
CSSToParentLayerScale
mZoom
;
ScrollGeneration
mScrollGeneration
;
ScreenMargin
mDisplayPortMargins
;
uint32_t
mPresShellId
;
CSSRect
mLayoutViewport
;
ParentLayerToScreenScale2D
mTransformToAncestorScale
;
TimeStamp
mPaintRequestTime
;
ScrollOffsetUpdateType
mScrollUpdateType
;
bool
mIsRootContent
:
1
;
bool
mIsAnimationInProgress
:
1
;
bool
mIsScrollInfoLayer
:
1
;
}
;
}
}
#
endif
