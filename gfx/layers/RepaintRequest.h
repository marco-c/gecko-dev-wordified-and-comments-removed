#
ifndef
GFX_REPAINTREQUEST_H
#
define
GFX_REPAINTREQUEST_H
#
include
<
stdint
.
h
>
#
include
"
FrameMetrics
.
h
"
#
include
"
mozilla
/
DefineEnum
.
h
"
#
include
"
mozilla
/
gfx
/
BasePoint
.
h
"
#
include
"
mozilla
/
gfx
/
Rect
.
h
"
#
include
"
mozilla
/
gfx
/
ScaleFactor
.
h
"
#
include
"
mozilla
/
TimeStamp
.
h
"
#
include
"
Units
.
h
"
namespace
IPC
{
template
<
typename
T
>
struct
ParamTraits
;
}
namespace
mozilla
{
namespace
layers
{
struct
RepaintRequest
{
friend
struct
IPC
:
:
ParamTraits
<
mozilla
:
:
layers
:
:
RepaintRequest
>
;
public
:
MOZ_DEFINE_ENUM_WITH_BASE_AT_CLASS_SCOPE
(
ScrollOffsetUpdateType
uint8_t
(
eNone
eUserAction
eVisualUpdate
)
)
;
RepaintRequest
(
)
:
mScrollId
(
ScrollableLayerGuid
:
:
NULL_SCROLL_ID
)
mPresShellResolution
(
1
)
mCompositionBounds
(
0
0
0
0
)
mCumulativeResolution
(
)
mDevPixelsPerCSSPixel
(
1
)
mScrollOffset
(
0
0
)
mZoom
(
)
mScrollGeneration
(
0
)
mDisplayPortMargins
(
0
0
0
0
)
mPresShellId
(
-
1
)
mLayoutViewport
(
0
0
0
0
)
mExtraResolution
(
)
mPaintRequestTime
(
)
mScrollUpdateType
(
eNone
)
mIsRootContent
(
false
)
mIsScrollInfoLayer
(
false
)
{
}
RepaintRequest
(
const
FrameMetrics
&
aOther
const
ScrollOffsetUpdateType
aScrollUpdateType
)
:
mScrollId
(
aOther
.
GetScrollId
(
)
)
mPresShellResolution
(
aOther
.
GetPresShellResolution
(
)
)
mCompositionBounds
(
aOther
.
GetCompositionBounds
(
)
)
mCumulativeResolution
(
aOther
.
GetCumulativeResolution
(
)
)
mDevPixelsPerCSSPixel
(
aOther
.
GetDevPixelsPerCSSPixel
(
)
)
mScrollOffset
(
aOther
.
GetScrollOffset
(
)
)
mZoom
(
aOther
.
GetZoom
(
)
)
mScrollGeneration
(
aOther
.
GetScrollGeneration
(
)
)
mDisplayPortMargins
(
aOther
.
GetDisplayPortMargins
(
)
)
mPresShellId
(
aOther
.
GetPresShellId
(
)
)
mLayoutViewport
(
aOther
.
GetLayoutViewport
(
)
)
mExtraResolution
(
aOther
.
GetExtraResolution
(
)
)
mPaintRequestTime
(
aOther
.
GetPaintRequestTime
(
)
)
mScrollUpdateType
(
aScrollUpdateType
)
mIsRootContent
(
aOther
.
IsRootContent
(
)
)
mIsScrollInfoLayer
(
aOther
.
IsScrollInfoLayer
(
)
)
{
}
bool
operator
=
=
(
const
RepaintRequest
&
aOther
)
const
{
return
mScrollId
=
=
aOther
.
mScrollId
&
&
mPresShellResolution
=
=
aOther
.
mPresShellResolution
&
&
mCompositionBounds
.
IsEqualEdges
(
aOther
.
mCompositionBounds
)
&
&
mCumulativeResolution
=
=
aOther
.
mCumulativeResolution
&
&
mDevPixelsPerCSSPixel
=
=
aOther
.
mDevPixelsPerCSSPixel
&
&
mScrollOffset
=
=
aOther
.
mScrollOffset
&
&
mScrollGeneration
=
=
aOther
.
mScrollGeneration
&
&
mDisplayPortMargins
=
=
aOther
.
mDisplayPortMargins
&
&
mPresShellId
=
=
aOther
.
mPresShellId
&
&
mLayoutViewport
.
IsEqualEdges
(
aOther
.
mLayoutViewport
)
&
&
mExtraResolution
=
=
aOther
.
mExtraResolution
&
&
mPaintRequestTime
=
=
aOther
.
mPaintRequestTime
&
&
mScrollUpdateType
=
=
aOther
.
mScrollUpdateType
&
&
mIsRootContent
=
=
aOther
.
mIsRootContent
&
&
mIsScrollInfoLayer
=
=
aOther
.
mIsScrollInfoLayer
;
}
bool
operator
!
=
(
const
RepaintRequest
&
aOther
)
const
{
return
!
operator
=
=
(
aOther
)
;
}
CSSToScreenScale2D
DisplayportPixelsPerCSSPixel
(
)
const
{
return
mZoom
*
ParentLayerToLayerScale
(
1
.
0f
)
/
mExtraResolution
;
}
CSSToLayerScale2D
LayersPixelsPerCSSPixel
(
)
const
{
return
mDevPixelsPerCSSPixel
*
mCumulativeResolution
;
}
LayerToParentLayerScale
GetAsyncZoom
(
)
const
{
return
(
mZoom
/
LayersPixelsPerCSSPixel
(
)
)
.
ToScaleFactor
(
)
;
}
CSSSize
CalculateCompositedSizeInCssPixels
(
)
const
{
if
(
GetZoom
(
)
=
=
CSSToParentLayerScale2D
(
0
0
)
)
{
return
CSSSize
(
)
;
}
return
mCompositionBounds
.
Size
(
)
/
GetZoom
(
)
;
}
float
GetPresShellResolution
(
)
const
{
return
mPresShellResolution
;
}
const
ParentLayerRect
&
GetCompositionBounds
(
)
const
{
return
mCompositionBounds
;
}
const
LayoutDeviceToLayerScale2D
&
GetCumulativeResolution
(
)
const
{
return
mCumulativeResolution
;
}
const
CSSToLayoutDeviceScale
&
GetDevPixelsPerCSSPixel
(
)
const
{
return
mDevPixelsPerCSSPixel
;
}
bool
IsRootContent
(
)
const
{
return
mIsRootContent
;
}
const
CSSPoint
&
GetScrollOffset
(
)
const
{
return
mScrollOffset
;
}
const
CSSToParentLayerScale2D
&
GetZoom
(
)
const
{
return
mZoom
;
}
ScrollOffsetUpdateType
GetScrollUpdateType
(
)
const
{
return
mScrollUpdateType
;
}
bool
GetScrollOffsetUpdated
(
)
const
{
return
mScrollUpdateType
!
=
eNone
;
}
uint32_t
GetScrollGeneration
(
)
const
{
return
mScrollGeneration
;
}
ScrollableLayerGuid
:
:
ViewID
GetScrollId
(
)
const
{
return
mScrollId
;
}
const
ScreenMargin
&
GetDisplayPortMargins
(
)
const
{
return
mDisplayPortMargins
;
}
uint32_t
GetPresShellId
(
)
const
{
return
mPresShellId
;
}
const
CSSRect
&
GetLayoutViewport
(
)
const
{
return
mLayoutViewport
;
}
const
ScreenToLayerScale2D
&
GetExtraResolution
(
)
const
{
return
mExtraResolution
;
}
const
TimeStamp
&
GetPaintRequestTime
(
)
const
{
return
mPaintRequestTime
;
}
bool
IsScrollInfoLayer
(
)
const
{
return
mIsScrollInfoLayer
;
}
protected
:
void
SetIsRootContent
(
bool
aIsRootContent
)
{
mIsRootContent
=
aIsRootContent
;
}
void
SetIsScrollInfoLayer
(
bool
aIsScrollInfoLayer
)
{
mIsScrollInfoLayer
=
aIsScrollInfoLayer
;
}
private
:
ScrollableLayerGuid
:
:
ViewID
mScrollId
;
float
mPresShellResolution
;
ParentLayerRect
mCompositionBounds
;
LayoutDeviceToLayerScale2D
mCumulativeResolution
;
CSSToLayoutDeviceScale
mDevPixelsPerCSSPixel
;
CSSPoint
mScrollOffset
;
CSSToParentLayerScale2D
mZoom
;
uint32_t
mScrollGeneration
;
ScreenMargin
mDisplayPortMargins
;
uint32_t
mPresShellId
;
CSSRect
mLayoutViewport
;
ScreenToLayerScale2D
mExtraResolution
;
TimeStamp
mPaintRequestTime
;
ScrollOffsetUpdateType
mScrollUpdateType
;
bool
mIsRootContent
:
1
;
bool
mIsScrollInfoLayer
:
1
;
}
;
}
}
#
endif
