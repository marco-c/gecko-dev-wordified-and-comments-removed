#
ifndef
mozilla_layers_CompositionRecorder_h
#
define
mozilla_layers_CompositionRecorder_h
#
include
"
mozilla
/
RefPtr
.
h
"
#
include
"
mozilla
/
TimeStamp
.
h
"
#
include
"
nsISupportsImpl
.
h
"
#
include
"
nsTArray
.
h
"
namespace
mozilla
{
namespace
gfx
{
class
DataSourceSurface
;
}
namespace
layers
{
class
RecordedFrame
{
public
:
NS_INLINE_DECL_THREADSAFE_REFCOUNTING
(
RecordedFrame
)
virtual
already_AddRefed
<
gfx
:
:
DataSourceSurface
>
GetSourceSurface
(
)
=
0
;
TimeStamp
GetTimeStamp
(
)
{
return
mTimeStamp
;
}
protected
:
virtual
~
RecordedFrame
(
)
=
default
;
RecordedFrame
(
const
TimeStamp
&
aTimeStamp
)
:
mTimeStamp
(
aTimeStamp
)
{
}
private
:
TimeStamp
mTimeStamp
;
}
;
struct
CollectedFrame
{
CollectedFrame
(
double
aTimeOffset
nsCString
&
&
aDataUri
)
:
mTimeOffset
(
aTimeOffset
)
mDataUri
(
std
:
:
move
(
aDataUri
)
)
{
}
double
mTimeOffset
;
nsCString
mDataUri
;
}
;
struct
CollectedFrames
{
CollectedFrames
(
double
aRecordingStart
nsTArray
<
CollectedFrame
>
&
&
aFrames
)
:
mRecordingStart
(
aRecordingStart
)
mFrames
(
std
:
:
move
(
aFrames
)
)
{
}
double
mRecordingStart
;
nsTArray
<
CollectedFrame
>
mFrames
;
}
;
class
CompositionRecorder
{
public
:
explicit
CompositionRecorder
(
TimeStamp
aRecordingStart
)
;
void
RecordFrame
(
RecordedFrame
*
aFrame
)
;
void
WriteCollectedFrames
(
)
;
CollectedFrames
GetCollectedFrames
(
)
;
protected
:
void
ClearCollectedFrames
(
)
;
private
:
nsTArray
<
RefPtr
<
RecordedFrame
>
>
mCollectedFrames
;
TimeStamp
mRecordingStart
;
}
;
}
}
#
endif
