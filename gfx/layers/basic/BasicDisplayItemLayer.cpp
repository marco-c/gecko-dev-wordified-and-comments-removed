#
include
"
BasicLayersImpl
.
h
"
#
include
"
Layers
.
h
"
#
include
"
BasicImplData
.
h
"
#
include
"
BasicLayers
.
h
"
#
include
"
gfxContext
.
h
"
#
include
"
gfxRect
.
h
"
#
include
"
gfx2DGlue
.
h
"
#
include
"
mozilla
/
mozalloc
.
h
"
#
include
"
nsCOMPtr
.
h
"
#
include
"
nsDebug
.
h
"
#
include
"
nsISupportsImpl
.
h
"
#
include
"
nsRect
.
h
"
#
include
"
nsRegion
.
h
"
#
include
"
mozilla
/
gfx
/
PathHelpers
.
h
"
#
include
"
nsDisplayList
.
h
"
#
include
"
nsCaret
.
h
"
using
namespace
mozilla
:
:
gfx
;
namespace
mozilla
{
namespace
layers
{
class
BasicDisplayItemLayer
:
public
DisplayItemLayer
public
BasicImplData
{
public
:
explicit
BasicDisplayItemLayer
(
BasicLayerManager
*
aLayerManager
)
:
DisplayItemLayer
(
aLayerManager
static_cast
<
BasicImplData
*
>
(
this
)
)
{
MOZ_COUNT_CTOR
(
BasicDisplayItemLayer
)
;
}
protected
:
virtual
~
BasicDisplayItemLayer
(
)
{
MOZ_COUNT_DTOR
(
BasicDisplayItemLayer
)
;
}
public
:
virtual
void
SetVisibleRegion
(
const
LayerIntRegion
&
aRegion
)
override
{
NS_ASSERTION
(
BasicManager
(
)
-
>
InConstruction
(
)
"
Can
only
set
properties
in
construction
phase
"
)
;
DisplayItemLayer
:
:
SetVisibleRegion
(
aRegion
)
;
}
virtual
void
Paint
(
DrawTarget
*
aDT
const
gfx
:
:
Point
&
aDeviceOffset
Layer
*
aMaskLayer
)
override
{
if
(
IsHidden
(
)
|
|
!
mItem
|
|
!
mBuilder
)
{
return
;
}
AutoRestoreTransform
autoRestoreTransform
(
aDT
)
;
Matrix
transform
=
aDT
-
>
GetTransform
(
)
;
RefPtr
<
gfxContext
>
context
=
gfxContext
:
:
CreateOrNull
(
aDT
aDeviceOffset
)
;
context
-
>
SetMatrix
(
ThebesMatrix
(
transform
)
)
;
nsRenderingContext
ctx
(
context
)
;
mItem
-
>
Paint
(
mBuilder
&
ctx
)
;
}
protected
:
BasicLayerManager
*
BasicManager
(
)
{
return
static_cast
<
BasicLayerManager
*
>
(
mManager
)
;
}
}
;
already_AddRefed
<
DisplayItemLayer
>
BasicLayerManager
:
:
CreateDisplayItemLayer
(
)
{
NS_ASSERTION
(
InConstruction
(
)
"
Only
allowed
in
construction
phase
"
)
;
RefPtr
<
DisplayItemLayer
>
layer
=
new
BasicDisplayItemLayer
(
this
)
;
mDisplayItemLayers
.
AppendElement
(
layer
)
;
return
layer
.
forget
(
)
;
}
}
}
