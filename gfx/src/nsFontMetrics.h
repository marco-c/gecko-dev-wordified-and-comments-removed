#
ifndef
NSFONTMETRICS__H__
#
define
NSFONTMETRICS__H__
#
include
<
stdint
.
h
>
#
include
<
sys
/
types
.
h
>
#
include
"
mozilla
/
Assertions
.
h
"
#
include
"
mozilla
/
RefPtr
.
h
"
#
include
"
nsCOMPtr
.
h
"
#
include
"
nsCoord
.
h
"
#
include
"
nsError
.
h
"
#
include
"
nsFont
.
h
"
#
include
"
nsISupports
.
h
"
#
include
"
nsStyleConsts
.
h
"
#
include
"
nscore
.
h
"
class
gfxContext
;
class
gfxFontGroup
;
class
gfxUserFontSet
;
class
gfxTextPerfMetrics
;
class
nsPresContext
;
class
nsAtom
;
struct
nsBoundingMetrics
;
namespace
mozilla
{
namespace
gfx
{
class
DrawTarget
;
}
}
class
nsFontMetrics
final
{
public
:
typedef
mozilla
:
:
gfx
:
:
DrawTarget
DrawTarget
;
enum
FontOrientation
{
eHorizontal
eVertical
}
;
struct
MOZ_STACK_CLASS
Params
{
nsAtom
*
language
=
nullptr
;
bool
explicitLanguage
=
false
;
#
ifdef
XP_WIN
bool
allowForceGDIClassic
=
true
;
#
endif
FontOrientation
orientation
=
eHorizontal
;
gfxUserFontSet
*
userFontSet
=
nullptr
;
gfxTextPerfMetrics
*
textPerf
=
nullptr
;
gfxFontFeatureValueSet
*
featureValueLookup
=
nullptr
;
}
;
nsFontMetrics
(
const
nsFont
&
aFont
const
Params
&
aParams
nsPresContext
*
aContext
)
;
NS_INLINE_DECL_THREADSAFE_REFCOUNTING
(
nsFontMetrics
)
void
Destroy
(
)
;
nscoord
XHeight
(
)
const
;
nscoord
CapHeight
(
)
const
;
nscoord
SuperscriptOffset
(
)
const
;
nscoord
SubscriptOffset
(
)
const
;
void
GetStrikeout
(
nscoord
&
aOffset
nscoord
&
aSize
)
const
;
void
GetUnderline
(
nscoord
&
aOffset
nscoord
&
aSize
)
const
;
nscoord
InternalLeading
(
)
const
;
nscoord
ExternalLeading
(
)
const
;
nscoord
EmHeight
(
)
const
;
nscoord
EmAscent
(
)
const
;
nscoord
EmDescent
(
)
const
;
nscoord
MaxHeight
(
)
const
;
nscoord
MaxAscent
(
)
const
;
nscoord
MaxDescent
(
)
const
;
nscoord
MaxAdvance
(
)
const
;
nscoord
AveCharWidth
(
)
const
;
nscoord
ZeroOrAveCharWidth
(
)
const
;
nscoord
SpaceWidth
(
)
const
;
const
nsFont
&
Font
(
)
const
{
return
mFont
;
}
nsAtom
*
Language
(
)
const
{
return
mLanguage
;
}
FontOrientation
Orientation
(
)
const
{
return
mOrientation
;
}
int32_t
GetMaxStringLength
(
)
const
;
nscoord
GetWidth
(
const
char
*
aString
uint32_t
aLength
DrawTarget
*
aDrawTarget
)
const
;
nscoord
GetWidth
(
const
char16_t
*
aString
uint32_t
aLength
DrawTarget
*
aDrawTarget
)
const
;
void
DrawString
(
const
char
*
aString
uint32_t
aLength
nscoord
aX
nscoord
aY
gfxContext
*
aContext
)
const
;
void
DrawString
(
const
char16_t
*
aString
uint32_t
aLength
nscoord
aX
nscoord
aY
gfxContext
*
aContext
DrawTarget
*
aTextRunConstructionDrawTarget
)
const
;
nsBoundingMetrics
GetBoundingMetrics
(
const
char16_t
*
aString
uint32_t
aLength
DrawTarget
*
aDrawTarget
)
const
;
nsBoundingMetrics
GetInkBoundsForInkOverflow
(
const
char16_t
*
aString
uint32_t
aLength
DrawTarget
*
aDrawTarget
)
const
;
void
SetTextRunRTL
(
bool
aIsRTL
)
{
mTextRunRTL
=
aIsRTL
;
}
bool
GetTextRunRTL
(
)
const
{
return
mTextRunRTL
;
}
void
SetVertical
(
bool
aVertical
)
{
mVertical
=
aVertical
;
}
bool
GetVertical
(
)
const
{
return
mVertical
;
}
void
SetTextOrientation
(
mozilla
:
:
StyleTextOrientation
aTextOrientation
)
{
mTextOrientation
=
aTextOrientation
;
}
mozilla
:
:
StyleTextOrientation
GetTextOrientation
(
)
const
{
return
mTextOrientation
;
}
bool
ExplicitLanguage
(
)
const
{
return
mExplicitLanguage
;
}
gfxFontGroup
*
GetThebesFontGroup
(
)
const
{
return
mFontGroup
;
}
gfxUserFontSet
*
GetUserFontSet
(
)
const
;
int32_t
AppUnitsPerDevPixel
(
)
const
{
return
mP2A
;
}
#
ifdef
XP_WIN
bool
AllowForceGDIClassic
(
)
const
{
return
mAllowForceGDIClassic
;
}
#
endif
private
:
~
nsFontMetrics
(
)
;
const
nsFont
mFont
;
RefPtr
<
gfxFontGroup
>
mFontGroup
;
RefPtr
<
nsAtom
>
const
mLanguage
;
nsPresContext
*
MOZ_NON_OWNING_REF
mPresContext
;
const
int32_t
mP2A
;
const
FontOrientation
mOrientation
;
const
bool
mExplicitLanguage
;
#
ifdef
XP_WIN
const
bool
mAllowForceGDIClassic
=
true
;
#
endif
bool
mTextRunRTL
;
bool
mVertical
;
mozilla
:
:
StyleTextOrientation
mTextOrientation
;
}
;
#
endif
