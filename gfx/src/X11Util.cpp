#
include
"
X11Util
.
h
"
#
include
"
nsDebug
.
h
"
#
include
"
MainThreadUtils
.
h
"
namespace
mozilla
{
void
FindVisualAndDepth
(
Display
*
aDisplay
VisualID
aVisualID
Visual
*
*
aVisual
int
*
aDepth
)
{
const
Screen
*
screen
=
DefaultScreenOfDisplay
(
aDisplay
)
;
for
(
int
d
=
0
;
d
<
screen
-
>
ndepths
;
d
+
+
)
{
Depth
*
d_info
=
&
screen
-
>
depths
[
d
]
;
for
(
int
v
=
0
;
v
<
d_info
-
>
nvisuals
;
v
+
+
)
{
Visual
*
visual
=
&
d_info
-
>
visuals
[
v
]
;
if
(
visual
-
>
visualid
=
=
aVisualID
)
{
*
aVisual
=
visual
;
*
aDepth
=
d_info
-
>
depth
;
return
;
}
}
}
NS_ASSERTION
(
aVisualID
=
=
X11None
"
VisualID
not
on
Screen
.
"
)
;
*
aVisual
=
nullptr
;
*
aDepth
=
0
;
}
void
FinishX
(
Display
*
aDisplay
)
{
unsigned
long
lastRequest
=
NextRequest
(
aDisplay
)
-
1
;
if
(
lastRequest
=
=
LastKnownRequestProcessed
(
aDisplay
)
)
return
;
XSync
(
aDisplay
X11False
)
;
}
}
