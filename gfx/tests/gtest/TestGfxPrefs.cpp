#
include
"
gtest
/
gtest
.
h
"
#
include
"
gfxPrefs
.
h
"
#
ifdef
GFX_DECL_PREF
#
error
"
This
is
not
supposed
to
be
defined
outside
of
gfxPrefs
.
h
"
#
endif
TEST
(
GfxPrefs
Singleton
)
{
gfxPrefs
:
:
GetSingleton
(
)
;
ASSERT_TRUE
(
gfxPrefs
:
:
SingletonExists
(
)
)
;
}
TEST
(
GfxPrefs
OnceValues
)
{
gfxPrefs
:
:
GetSingleton
(
)
;
ASSERT_TRUE
(
gfxPrefs
:
:
SingletonExists
(
)
)
;
ASSERT_TRUE
(
gfxPrefs
:
:
WorkAroundDriverBugs
(
)
)
;
ASSERT_FALSE
(
gfxPrefs
:
:
UseApitrace
(
)
)
;
ASSERT_TRUE
(
gfxPrefs
:
:
APZMaxVelocityQueueSize
(
)
=
=
5
)
;
ASSERT_TRUE
(
gfxPrefs
:
:
APZCurveFunctionX1
(
)
=
=
0
.
0f
)
;
}
TEST
(
GfxPrefs
Set
)
{
gfxPrefs
:
:
GetSingleton
(
)
;
ASSERT_TRUE
(
gfxPrefs
:
:
SingletonExists
(
)
)
;
ASSERT_FALSE
(
gfxPrefs
:
:
UseApitrace
(
)
)
;
gfxPrefs
:
:
SetUseApitrace
(
true
)
;
ASSERT_TRUE
(
gfxPrefs
:
:
UseApitrace
(
)
)
;
gfxPrefs
:
:
SetUseApitrace
(
false
)
;
ASSERT_FALSE
(
gfxPrefs
:
:
UseApitrace
(
)
)
;
ASSERT_TRUE
(
gfxPrefs
:
:
APZCurveFunctionX1
(
)
=
=
0
.
0f
)
;
gfxPrefs
:
:
SetAPZCurveFunctionX1
(
1
.
75f
)
;
ASSERT_TRUE
(
gfxPrefs
:
:
APZCurveFunctionX1
(
)
=
=
1
.
75f
)
;
gfxPrefs
:
:
SetAPZCurveFunctionX1
(
0
.
0f
)
;
ASSERT_TRUE
(
gfxPrefs
:
:
APZCurveFunctionX1
(
)
=
=
0
.
0f
)
;
}
extern
bool
SimpleNoCLibDtoA
(
double
aValue
char
*
aBuffer
int
aBufferLength
)
;
TEST
(
GfxPrefs
StringUtility
)
{
char
testBuffer
[
64
]
;
double
testVal
[
]
=
{
13
.
4
3324243
.
42
0
.
332424342
864
.
0
86400
*
100000000
.
0
*
10000000000
.
0
*
10000000000
.
0
*
100
.
0
86400
.
0
*
366
.
0
*
100
.
0
+
14243
.
44332
}
;
for
(
size_t
i
=
0
;
i
<
mozilla
:
:
ArrayLength
(
testVal
)
;
i
+
+
)
{
ASSERT_TRUE
(
SimpleNoCLibDtoA
(
testVal
[
i
]
testBuffer
sizeof
(
testBuffer
)
)
)
;
ASSERT_TRUE
(
fabs
(
1
.
0
-
atof
(
testBuffer
)
/
testVal
[
i
]
)
<
0
.
0001
)
;
}
ASSERT_FALSE
(
SimpleNoCLibDtoA
(
-
864
.
0
testBuffer
sizeof
(
testBuffer
)
)
)
;
ASSERT_FALSE
(
SimpleNoCLibDtoA
(
testVal
[
4
]
testBuffer
sizeof
(
testBuffer
)
/
2
)
)
;
}
