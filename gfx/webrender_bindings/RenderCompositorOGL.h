#
ifndef
MOZILLA_GFX_RENDERCOMPOSITOR_OGL_H
#
define
MOZILLA_GFX_RENDERCOMPOSITOR_OGL_H
#
include
"
mozilla
/
webrender
/
RenderCompositor
.
h
"
#
include
"
mozilla
/
TimeStamp
.
h
"
namespace
mozilla
{
namespace
layers
{
class
NativeLayerRoot
;
class
NativeLayer
;
}
namespace
wr
{
class
RenderCompositorOGL
:
public
RenderCompositor
{
public
:
static
UniquePtr
<
RenderCompositor
>
Create
(
RefPtr
<
widget
:
:
CompositorWidget
>
&
&
aWidget
)
;
RenderCompositorOGL
(
RefPtr
<
gl
:
:
GLContext
>
&
&
aGL
RefPtr
<
widget
:
:
CompositorWidget
>
&
&
aWidget
)
;
virtual
~
RenderCompositorOGL
(
)
;
bool
BeginFrame
(
)
override
;
RenderedFrameId
EndFrame
(
const
FfiVec
<
DeviceIntRect
>
&
aDirtyRects
)
final
;
bool
WaitForGPU
(
)
override
;
void
Pause
(
)
override
;
bool
Resume
(
)
override
;
gl
:
:
GLContext
*
gl
(
)
const
override
{
return
mGL
;
}
bool
UseANGLE
(
)
const
override
{
return
false
;
}
LayoutDeviceIntSize
GetBufferSize
(
)
override
;
bool
ShouldUseNativeCompositor
(
)
override
;
uint32_t
GetMaxUpdateRects
(
)
override
;
void
CompositorBeginFrame
(
)
override
;
void
CompositorEndFrame
(
)
override
;
void
Bind
(
wr
:
:
NativeSurfaceId
aId
wr
:
:
DeviceIntPoint
*
aOffset
uint32_t
*
aFboId
wr
:
:
DeviceIntRect
aDirtyRect
)
override
;
void
Unbind
(
)
override
;
void
CreateSurface
(
wr
:
:
NativeSurfaceId
aId
wr
:
:
DeviceIntSize
aSize
bool
aIsOpaque
)
override
;
void
DestroySurface
(
NativeSurfaceId
aId
)
override
;
void
AddSurface
(
wr
:
:
NativeSurfaceId
aId
wr
:
:
DeviceIntPoint
aPosition
wr
:
:
DeviceIntRect
aClipRect
)
override
;
protected
:
void
InsertFrameDoneSync
(
)
;
RefPtr
<
gl
:
:
GLContext
>
mGL
;
RefPtr
<
layers
:
:
NativeLayerRoot
>
mNativeLayerRoot
;
RefPtr
<
layers
:
:
NativeLayer
>
mNativeLayerForEntireWindow
;
RefPtr
<
layers
:
:
NativeLayer
>
mCurrentlyBoundNativeLayer
;
nsTArray
<
RefPtr
<
layers
:
:
NativeLayer
>
>
mAddedLayers
;
uint64_t
mAddedPixelCount
=
0
;
uint64_t
mAddedClippedPixelCount
=
0
;
uint64_t
mDrawnPixelCount
=
0
;
gfx
:
:
IntRect
mVisibleBounds
;
std
:
:
unordered_map
<
uint64_t
RefPtr
<
layers
:
:
NativeLayer
>
>
mNativeLayers
;
TimeStamp
mBeginFrameTimeStamp
;
GLsync
mPreviousFrameDoneSync
;
GLsync
mThisFrameDoneSync
;
}
;
}
}
#
endif
