#
ifndef
MOZILLA_GFX_RENDERCOMPOSITOR_RECORDEDFRAME_H
#
define
MOZILLA_GFX_RENDERCOMPOSITOR_RECORDEDFRAME_H
#
include
"
mozilla
/
layers
/
CompositionRecorder
.
h
"
namespace
mozilla
{
namespace
wr
{
class
RenderCompositorRecordedFrame
final
:
public
layers
:
:
RecordedFrame
{
public
:
RenderCompositorRecordedFrame
(
const
TimeStamp
&
aTimeStamp
RefPtr
<
layers
:
:
profiler_screenshots
:
:
AsyncReadbackBuffer
>
&
&
aBuffer
)
:
RecordedFrame
(
aTimeStamp
)
mBuffer
(
aBuffer
)
{
}
virtual
already_AddRefed
<
gfx
:
:
DataSourceSurface
>
GetSourceSurface
(
)
override
{
if
(
mSurface
)
{
return
do_AddRef
(
mSurface
)
;
}
gfx
:
:
IntSize
size
=
mBuffer
-
>
Size
(
)
;
mSurface
=
gfx
:
:
Factory
:
:
CreateDataSourceSurface
(
size
gfx
:
:
SurfaceFormat
:
:
B8G8R8A8
false
)
;
if
(
!
mBuffer
-
>
MapAndCopyInto
(
mSurface
size
)
)
{
mSurface
=
nullptr
;
return
nullptr
;
}
return
do_AddRef
(
mSurface
)
;
}
private
:
RefPtr
<
layers
:
:
profiler_screenshots
:
:
AsyncReadbackBuffer
>
mBuffer
;
RefPtr
<
gfx
:
:
DataSourceSurface
>
mSurface
;
}
;
}
}
#
endif
