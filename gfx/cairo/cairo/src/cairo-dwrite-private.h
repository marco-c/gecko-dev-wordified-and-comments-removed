#
include
<
dwrite
.
h
>
#
include
<
D2d1
.
h
>
typedef
HRESULT
(
WINAPI
*
DWriteCreateFactoryFunc
)
(
__in
DWRITE_FACTORY_TYPE
factoryType
__in
REFIID
iid
__out
IUnknown
*
*
factory
)
;
class
DWriteFactory
{
public
:
static
IDWriteFactory
*
Instance
(
)
{
if
(
!
mFactoryInstance
)
{
DWriteCreateFactoryFunc
createDWriteFactory
=
(
DWriteCreateFactoryFunc
)
GetProcAddress
(
LoadLibraryW
(
L
"
dwrite
.
dll
"
)
"
DWriteCreateFactory
"
)
;
if
(
createDWriteFactory
)
{
HRESULT
hr
=
createDWriteFactory
(
DWRITE_FACTORY_TYPE_SHARED
__uuidof
(
IDWriteFactory
)
reinterpret_cast
<
IUnknown
*
*
>
(
&
mFactoryInstance
)
)
;
assert
(
SUCCEEDED
(
hr
)
)
;
}
}
return
mFactoryInstance
;
}
static
IDWriteFontCollection
*
SystemCollection
(
)
{
if
(
!
mSystemCollection
)
{
if
(
Instance
(
)
)
{
HRESULT
hr
=
Instance
(
)
-
>
GetSystemFontCollection
(
&
mSystemCollection
)
;
assert
(
SUCCEEDED
(
hr
)
)
;
}
}
return
mSystemCollection
;
}
static
IDWriteFontFamily
*
FindSystemFontFamily
(
const
WCHAR
*
aFamilyName
)
{
UINT32
idx
;
BOOL
found
;
if
(
!
SystemCollection
(
)
)
{
return
NULL
;
}
SystemCollection
(
)
-
>
FindFamilyName
(
aFamilyName
&
idx
&
found
)
;
if
(
!
found
)
{
return
NULL
;
}
IDWriteFontFamily
*
family
;
SystemCollection
(
)
-
>
GetFontFamily
(
idx
&
family
)
;
return
family
;
}
private
:
static
IDWriteFactory
*
mFactoryInstance
;
static
IDWriteFontCollection
*
mSystemCollection
;
}
;
cairo_int_status_t
cairo_dwrite_show_glyphs_on_d2d_surface
(
void
*
surface
cairo_operator_t
op
const
cairo_pattern_t
*
source
cairo_glyph_t
*
glyphs
int
num_glyphs
cairo_scaled_font_t
*
scaled_font
cairo_rectangle_int_t
*
extents
)
;
