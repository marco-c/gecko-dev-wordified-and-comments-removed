#
include
"
cairoint
.
h
"
#
include
"
cairo
-
gl
-
private
.
h
"
#
include
"
cairo
-
surface
-
backend
-
private
.
h
"
static
cairo_status_t
_cairo_gl_source_finish
(
void
*
abstract_surface
)
{
cairo_gl_source_t
*
source
=
abstract_surface
;
_cairo_gl_operand_destroy
(
&
source
-
>
operand
)
;
return
CAIRO_STATUS_SUCCESS
;
}
static
const
cairo_surface_backend_t
cairo_gl_source_backend
=
{
CAIRO_SURFACE_TYPE_GL
_cairo_gl_source_finish
NULL
}
;
cairo_surface_t
*
_cairo_gl_pattern_to_source
(
cairo_surface_t
*
dst
const
cairo_pattern_t
*
pattern
cairo_bool_t
is_mask
const
cairo_rectangle_int_t
*
extents
const
cairo_rectangle_int_t
*
sample
int
*
src_x
int
*
src_y
)
{
cairo_gl_source_t
*
source
;
cairo_int_status_t
status
;
TRACE
(
(
stderr
"
%
s
\
n
"
__FUNCTION__
)
)
;
if
(
pattern
=
=
NULL
)
return
_cairo_gl_white_source
(
)
;
source
=
_cairo_malloc
(
sizeof
(
*
source
)
)
;
if
(
unlikely
(
source
=
=
NULL
)
)
return
_cairo_surface_create_in_error
(
_cairo_error
(
CAIRO_STATUS_NO_MEMORY
)
)
;
_cairo_surface_init
(
&
source
-
>
base
&
cairo_gl_source_backend
NULL
CAIRO_CONTENT_COLOR_ALPHA
FALSE
)
;
*
src_x
=
*
src_y
=
0
;
status
=
_cairo_gl_operand_init
(
&
source
-
>
operand
pattern
(
cairo_gl_surface_t
*
)
dst
sample
extents
FALSE
)
;
if
(
unlikely
(
status
)
)
{
cairo_surface_destroy
(
&
source
-
>
base
)
;
return
_cairo_surface_create_in_error
(
status
)
;
}
return
&
source
-
>
base
;
}
cairo_surface_t
*
_cairo_gl_white_source
(
void
)
{
cairo_gl_source_t
*
source
;
source
=
_cairo_malloc
(
sizeof
(
*
source
)
)
;
if
(
unlikely
(
source
=
=
NULL
)
)
return
_cairo_surface_create_in_error
(
_cairo_error
(
CAIRO_STATUS_NO_MEMORY
)
)
;
_cairo_surface_init
(
&
source
-
>
base
&
cairo_gl_source_backend
NULL
CAIRO_CONTENT_COLOR_ALPHA
FALSE
)
;
_cairo_gl_solid_operand_init
(
&
source
-
>
operand
CAIRO_COLOR_WHITE
)
;
return
&
source
-
>
base
;
}
