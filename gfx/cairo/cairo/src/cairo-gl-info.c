#
include
"
cairoint
.
h
"
#
include
"
cairo
-
gl
-
private
.
h
"
#
include
<
errno
.
h
>
int
_cairo_gl_get_version
(
void
)
{
int
major
minor
;
const
char
*
version
=
(
const
char
*
)
glGetString
(
GL_VERSION
)
;
const
char
*
dot
=
version
=
=
NULL
?
NULL
:
strchr
(
version
'
.
'
)
;
const
char
*
major_start
=
dot
;
if
(
dot
=
=
NULL
|
|
dot
=
=
version
|
|
*
(
dot
+
1
)
=
=
'
\
0
'
)
{
major
=
0
;
minor
=
0
;
}
else
{
while
(
major_start
>
version
&
&
*
major_start
!
=
'
'
)
-
-
major_start
;
major
=
strtol
(
major_start
NULL
10
)
;
minor
=
strtol
(
dot
+
1
NULL
10
)
;
}
return
CAIRO_GL_VERSION_ENCODE
(
major
minor
)
;
}
cairo_gl_flavor_t
_cairo_gl_degrade_flavor_by_build_features
(
cairo_gl_flavor_t
flavor
)
{
switch
(
flavor
)
{
case
CAIRO_GL_FLAVOR_DESKTOP
:
#
if
CAIRO_HAS_GL_SURFACE
return
CAIRO_GL_FLAVOR_DESKTOP
;
#
else
return
CAIRO_GL_FLAVOR_NONE
;
#
endif
case
CAIRO_GL_FLAVOR_ES3
:
#
if
CAIRO_HAS_GLESV3_SURFACE
return
CAIRO_GL_FLAVOR_ES3
;
#
else
#
endif
case
CAIRO_GL_FLAVOR_ES2
:
#
if
CAIRO_HAS_GLESV2_SURFACE
return
CAIRO_GL_FLAVOR_ES2
;
#
else
#
endif
default
:
return
CAIRO_GL_FLAVOR_NONE
;
}
}
cairo_gl_flavor_t
_cairo_gl_get_flavor
(
void
)
{
const
char
*
version
=
(
const
char
*
)
glGetString
(
GL_VERSION
)
;
cairo_gl_flavor_t
flavor
;
if
(
version
=
=
NULL
)
{
flavor
=
CAIRO_GL_FLAVOR_NONE
;
}
else
if
(
strstr
(
version
"
OpenGL
ES
3
"
)
!
=
NULL
)
{
flavor
=
CAIRO_GL_FLAVOR_ES3
;
}
else
if
(
strstr
(
version
"
OpenGL
ES
2
"
)
!
=
NULL
)
{
flavor
=
CAIRO_GL_FLAVOR_ES2
;
}
else
{
flavor
=
CAIRO_GL_FLAVOR_DESKTOP
;
}
return
_cairo_gl_degrade_flavor_by_build_features
(
flavor
)
;
}
unsigned
long
_cairo_gl_get_vbo_size
(
void
)
{
unsigned
long
vbo_size
;
const
char
*
env
=
getenv
(
"
CAIRO_GL_VBO_SIZE
"
)
;
if
(
env
=
=
NULL
)
{
vbo_size
=
CAIRO_GL_VBO_SIZE_DEFAULT
;
}
else
{
errno
=
0
;
vbo_size
=
strtol
(
env
NULL
10
)
;
assert
(
errno
=
=
0
)
;
assert
(
vbo_size
>
0
)
;
}
return
vbo_size
;
}
cairo_bool_t
_cairo_gl_has_extension
(
const
char
*
ext
)
{
const
char
*
extensions
=
(
const
char
*
)
glGetString
(
GL_EXTENSIONS
)
;
size_t
len
=
strlen
(
ext
)
;
const
char
*
ext_ptr
=
extensions
;
if
(
unlikely
(
ext_ptr
=
=
NULL
)
)
return
0
;
while
(
(
ext_ptr
=
strstr
(
ext_ptr
ext
)
)
!
=
NULL
)
{
if
(
ext_ptr
[
len
]
=
=
'
'
|
|
ext_ptr
[
len
]
=
=
'
\
0
'
)
break
;
ext_ptr
+
=
len
;
}
return
(
ext_ptr
!
=
NULL
)
;
}
