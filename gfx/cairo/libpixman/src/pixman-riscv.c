#
ifdef
HAVE_CONFIG_H
#
include
<
pixman
-
config
.
h
>
#
endif
#
include
"
pixman
-
private
.
h
"
#
ifdef
USE_RVV
#
if
defined
(
__linux__
)
#
include
<
asm
/
hwcap
.
h
>
#
include
<
sys
/
auxv
.
h
>
#
endif
typedef
enum
{
RVV
=
(
1
<
<
0
)
}
riscv_cpu_features_t
;
static
riscv_cpu_features_t
detect_cpu_features
(
void
)
{
riscv_cpu_features_t
features
=
0
;
#
if
defined
(
__linux__
)
if
(
getauxval
(
AT_HWCAP
)
&
COMPAT_HWCAP_ISA_V
)
{
features
|
=
RVV
;
}
#
else
#
pragma
message
(
\
"
warning
:
RISC
-
V
Vector
Extension
runtime
check
not
implemented
for
this
platform
.
RVV
will
be
disabled
"
)
#
endif
return
features
;
}
#
endif
pixman_implementation_t
*
_pixman_riscv_get_implementations
(
pixman_implementation_t
*
imp
)
{
#
ifdef
USE_RVV
if
(
!
_pixman_disabled
(
"
rvv
"
)
&
&
(
detect_cpu_features
(
)
&
RVV
)
)
{
imp
=
_pixman_implementation_create_rvv
(
imp
)
;
}
#
endif
return
imp
;
}
