#
ifndef
MOZILLA_GFX_COORD_H_
#
define
MOZILLA_GFX_COORD_H_
#
include
"
mozilla
/
Attributes
.
h
"
#
include
"
Types
.
h
"
#
include
"
BaseCoord
.
h
"
#
include
<
cmath
>
#
include
<
type_traits
>
namespace
mozilla
{
template
<
typename
>
struct
IsPixel
;
namespace
gfx
{
struct
UnknownUnits
{
}
;
template
<
class
Units
class
Rep
=
int32_t
>
struct
IntCoordTyped
;
template
<
class
Units
class
F
=
Float
>
struct
CoordTyped
;
template
<
class
Coord
class
Primitive
>
struct
CommonType
;
template
<
class
Units
class
Rep
class
Primitive
>
struct
CommonType
<
IntCoordTyped
<
Units
Rep
>
Primitive
>
{
using
type
=
decltype
(
Rep
(
)
+
Primitive
(
)
)
;
}
;
template
<
class
Units
class
F
class
Primitive
>
struct
CommonType
<
CoordTyped
<
Units
F
>
Primitive
>
{
using
type
=
decltype
(
F
(
)
+
Primitive
(
)
)
;
}
;
template
<
bool
B
class
Coord
class
Primitive
>
struct
CoordOperatorsHelper
{
}
;
template
<
class
Coord
class
Primitive
>
struct
CoordOperatorsHelper
<
true
Coord
Primitive
>
{
friend
bool
operator
=
=
(
Coord
aA
Primitive
aB
)
{
return
aA
.
value
=
=
aB
;
}
friend
bool
operator
=
=
(
Primitive
aA
Coord
aB
)
{
return
aA
=
=
aB
.
value
;
}
friend
bool
operator
!
=
(
Coord
aA
Primitive
aB
)
{
return
aA
.
value
!
=
aB
;
}
friend
bool
operator
!
=
(
Primitive
aA
Coord
aB
)
{
return
aA
!
=
aB
.
value
;
}
using
result_type
=
typename
CommonType
<
Coord
Primitive
>
:
:
type
;
friend
result_type
operator
+
(
Coord
aA
Primitive
aB
)
{
return
aA
.
value
+
aB
;
}
friend
result_type
operator
+
(
Primitive
aA
Coord
aB
)
{
return
aA
+
aB
.
value
;
}
friend
result_type
operator
-
(
Coord
aA
Primitive
aB
)
{
return
aA
.
value
-
aB
;
}
friend
result_type
operator
-
(
Primitive
aA
Coord
aB
)
{
return
aA
-
aB
.
value
;
}
friend
result_type
operator
*
(
Coord
aCoord
Primitive
aScale
)
{
return
aCoord
.
value
*
aScale
;
}
friend
result_type
operator
*
(
Primitive
aScale
Coord
aCoord
)
{
return
aScale
*
aCoord
.
value
;
}
friend
result_type
operator
/
(
Coord
aCoord
Primitive
aScale
)
{
return
aCoord
.
value
/
aScale
;
}
}
;
template
<
class
Units
class
Rep
>
struct
MOZ_EMPTY_BASES
IntCoordTyped
:
public
BaseCoord
<
Rep
IntCoordTyped
<
Units
Rep
>
>
public
CoordOperatorsHelper
<
true
IntCoordTyped
<
Units
Rep
>
float
>
public
CoordOperatorsHelper
<
true
IntCoordTyped
<
Units
Rep
>
double
>
{
static_assert
(
IsPixel
<
Units
>
:
:
value
"
'
Units
'
must
be
a
coordinate
system
tag
"
)
;
using
Super
=
BaseCoord
<
Rep
IntCoordTyped
<
Units
Rep
>
>
;
constexpr
IntCoordTyped
(
)
:
Super
(
)
{
static_assert
(
sizeof
(
IntCoordTyped
)
=
=
sizeof
(
Rep
)
"
Would
be
unfortunate
otherwise
!
"
)
;
}
constexpr
MOZ_IMPLICIT
IntCoordTyped
(
Rep
aValue
)
:
Super
(
aValue
)
{
static_assert
(
sizeof
(
IntCoordTyped
)
=
=
sizeof
(
Rep
)
"
Would
be
unfortunate
otherwise
!
"
)
;
}
}
;
template
<
class
Units
class
F
>
struct
MOZ_EMPTY_BASES
CoordTyped
:
public
BaseCoord
<
F
CoordTyped
<
Units
F
>
>
public
CoordOperatorsHelper
<
!
std
:
:
is_same_v
<
F
int32_t
>
CoordTyped
<
Units
F
>
int32_t
>
public
CoordOperatorsHelper
<
!
std
:
:
is_same_v
<
F
uint32_t
>
CoordTyped
<
Units
F
>
uint32_t
>
public
CoordOperatorsHelper
<
!
std
:
:
is_same_v
<
F
double
>
CoordTyped
<
Units
F
>
double
>
public
CoordOperatorsHelper
<
!
std
:
:
is_same_v
<
F
float
>
CoordTyped
<
Units
F
>
float
>
{
static_assert
(
IsPixel
<
Units
>
:
:
value
"
'
Units
'
must
be
a
coordinate
system
tag
"
)
;
using
Super
=
BaseCoord
<
F
CoordTyped
<
Units
F
>
>
;
constexpr
CoordTyped
(
)
:
Super
(
)
{
static_assert
(
sizeof
(
CoordTyped
)
=
=
sizeof
(
F
)
"
Would
be
unfortunate
otherwise
!
"
)
;
}
constexpr
MOZ_IMPLICIT
CoordTyped
(
F
aValue
)
:
Super
(
aValue
)
{
static_assert
(
sizeof
(
CoordTyped
)
=
=
sizeof
(
F
)
"
Would
be
unfortunate
otherwise
!
"
)
;
}
explicit
constexpr
CoordTyped
(
const
IntCoordTyped
<
Units
>
&
aCoord
)
:
Super
(
F
(
aCoord
.
value
)
)
{
static_assert
(
sizeof
(
CoordTyped
)
=
=
sizeof
(
F
)
"
Would
be
unfortunate
otherwise
!
"
)
;
}
void
Round
(
)
{
this
-
>
value
=
floor
(
this
-
>
value
+
0
.
5
)
;
}
void
Truncate
(
)
{
this
-
>
value
=
int32_t
(
this
-
>
value
)
;
}
IntCoordTyped
<
Units
>
Rounded
(
)
const
{
return
IntCoordTyped
<
Units
>
(
int32_t
(
floor
(
this
-
>
value
+
0
.
5
)
)
)
;
}
IntCoordTyped
<
Units
>
Truncated
(
)
const
{
return
IntCoordTyped
<
Units
>
(
int32_t
(
this
-
>
value
)
)
;
}
}
;
typedef
CoordTyped
<
UnknownUnits
>
Coord
;
}
}
#
endif
