#
include
"
NativeFontResourceMac
.
h
"
#
include
"
UnscaledFontMac
.
h
"
#
include
"
Types
.
h
"
#
include
"
mozilla
/
RefPtr
.
h
"
#
ifdef
MOZ_WIDGET_UIKIT
#
include
<
CoreFoundation
/
CoreFoundation
.
h
>
#
endif
#
include
"
nsCocoaFeatures
.
h
"
namespace
mozilla
{
namespace
gfx
{
already_AddRefed
<
NativeFontResourceMac
>
NativeFontResourceMac
:
:
Create
(
uint8_t
*
aFontData
uint32_t
aDataLength
bool
aNeedsCairo
)
{
CFDataRef
data
=
CFDataCreate
(
kCFAllocatorDefault
aFontData
aDataLength
)
;
if
(
!
data
)
{
return
nullptr
;
}
CGDataProviderRef
provider
=
CGDataProviderCreateWithCFData
(
data
)
;
CFRelease
(
data
)
;
CGFontRef
fontRef
=
CGFontCreateWithDataProvider
(
provider
)
;
CGDataProviderRelease
(
provider
)
;
if
(
!
fontRef
)
{
return
nullptr
;
}
RefPtr
<
NativeFontResourceMac
>
fontResource
=
new
NativeFontResourceMac
(
fontRef
aNeedsCairo
)
;
return
fontResource
.
forget
(
)
;
}
already_AddRefed
<
UnscaledFont
>
NativeFontResourceMac
:
:
CreateUnscaledFont
(
uint32_t
aIndex
const
uint8_t
*
aInstanceData
uint32_t
aInstanceDataLength
)
{
RefPtr
<
UnscaledFont
>
unscaledFont
=
new
UnscaledFontMac
(
mFontRef
true
mNeedsCairo
)
;
return
unscaledFont
.
forget
(
)
;
}
}
}
