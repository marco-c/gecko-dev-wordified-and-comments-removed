#
include
"
NativeFontResourceMac
.
h
"
#
include
"
Types
.
h
"
#
include
"
mozilla
/
RefPtr
.
h
"
#
ifdef
MOZ_WIDGET_UIKIT
#
include
<
CoreFoundation
/
CoreFoundation
.
h
>
#
endif
namespace
mozilla
{
namespace
gfx
{
already_AddRefed
<
NativeFontResourceMac
>
NativeFontResourceMac
:
:
Create
(
uint8_t
*
aFontData
uint32_t
aDataLength
)
{
CFDataRef
data
=
CFDataCreate
(
kCFAllocatorDefault
aFontData
aDataLength
)
;
if
(
!
data
)
{
return
nullptr
;
}
CGDataProviderRef
provider
=
CGDataProviderCreateWithCFData
(
data
)
;
CFRelease
(
data
)
;
CGFontRef
fontRef
=
CGFontCreateWithDataProvider
(
provider
)
;
CGDataProviderRelease
(
provider
)
;
if
(
!
fontRef
)
{
return
nullptr
;
}
RefPtr
<
NativeFontResourceMac
>
fontResource
=
new
NativeFontResourceMac
(
fontRef
)
;
return
fontResource
.
forget
(
)
;
}
already_AddRefed
<
ScaledFont
>
NativeFontResourceMac
:
:
CreateScaledFont
(
uint32_t
aIndex
Float
aGlyphSize
)
{
RefPtr
<
ScaledFontBase
>
scaledFont
=
new
ScaledFontMac
(
mFontRef
aGlyphSize
)
;
if
(
!
scaledFont
-
>
PopulateCairoScaledFont
(
)
)
{
gfxWarning
(
)
<
<
"
Unable
to
create
cairo
scaled
Mac
font
.
"
;
return
nullptr
;
}
return
scaledFont
.
forget
(
)
;
}
}
}
