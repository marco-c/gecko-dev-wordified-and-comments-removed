#
ifndef
MOZILLA_GFX_SCALEDFONTDWRITE_H_
#
define
MOZILLA_GFX_SCALEDFONTDWRITE_H_
#
include
<
dwrite
.
h
>
#
include
"
DWriteSettings
.
h
"
#
include
"
ScaledFontBase
.
h
"
struct
gfxFontStyle
;
namespace
mozilla
{
namespace
gfx
{
class
NativeFontResourceDWrite
;
class
UnscaledFontDWrite
;
class
ScaledFontDWrite
final
:
public
ScaledFontBase
{
public
:
MOZ_DECLARE_REFCOUNTED_VIRTUAL_TYPENAME
(
ScaledFontDWrite
override
)
ScaledFontDWrite
(
IDWriteFontFace
*
aFontFace
const
RefPtr
<
UnscaledFont
>
&
aUnscaledFont
Float
aSize
bool
aUseEmbeddedBitmap
bool
aUseMultistrikeBold
bool
aGDIForced
const
gfxFontStyle
*
aStyle
)
;
FontType
GetType
(
)
const
override
{
return
FontType
:
:
DWRITE
;
}
bool
CanSerialize
(
)
override
{
return
true
;
}
bool
MayUseBitmaps
(
)
override
;
bool
GetFontInstanceData
(
FontInstanceDataOutput
aCb
void
*
aBaton
)
override
;
bool
GetWRFontInstanceOptions
(
Maybe
<
wr
:
:
FontInstanceOptions
>
*
aOutOptions
Maybe
<
wr
:
:
FontInstancePlatformOptions
>
*
aOutPlatformOptions
std
:
:
vector
<
FontVariation
>
*
aOutVariations
)
override
;
DWriteSettings
&
DWriteSettings
(
)
const
;
AntialiasMode
GetDefaultAAMode
(
)
override
;
bool
UseEmbeddedBitmaps
(
)
const
{
return
mUseEmbeddedBitmap
;
}
bool
UseMultistrikeBold
(
)
const
{
return
mUseMultistrikeBold
;
}
bool
ForceGDIMode
(
)
const
{
return
mGDIForced
;
}
bool
UseSubpixelPosition
(
)
const
override
{
return
!
ForceGDIMode
(
)
;
}
bool
HasBoldSimulation
(
)
const
{
return
(
mFontFace
-
>
GetSimulations
(
)
&
DWRITE_FONT_SIMULATIONS_BOLD
)
!
=
0
;
}
bool
HasVariationSettings
(
)
override
;
SkTypeface
*
CreateSkTypeface
(
)
override
;
void
SetupSkFontDrawOptions
(
SkFont
&
aFont
)
override
;
SkFontStyle
mStyle
;
RefPtr
<
IDWriteFontFace
>
mFontFace
;
bool
mUseEmbeddedBitmap
;
bool
mUseMultistrikeBold
=
false
;
bool
mGDIForced
=
false
;
cairo_font_face_t
*
CreateCairoFontFace
(
cairo_font_options_t
*
aFontOptions
)
override
;
void
PrepareCairoScaledFont
(
cairo_scaled_font_t
*
aFont
)
override
;
private
:
friend
class
NativeFontResourceDWrite
;
friend
class
UnscaledFontDWrite
;
struct
InstanceData
{
explicit
InstanceData
(
ScaledFontDWrite
*
aScaledFont
)
:
mUseEmbeddedBitmap
(
aScaledFont
-
>
mUseEmbeddedBitmap
)
mUseBoldSimulation
(
aScaledFont
-
>
HasBoldSimulation
(
)
)
mUseMultistrikeBold
(
aScaledFont
-
>
UseMultistrikeBold
(
)
)
mGDIForced
(
aScaledFont
-
>
mGDIForced
)
{
}
InstanceData
(
const
wr
:
:
FontInstanceOptions
*
aOptions
const
wr
:
:
FontInstancePlatformOptions
*
aPlatformOptions
)
;
bool
mUseEmbeddedBitmap
=
false
;
bool
mUseBoldSimulation
=
false
;
bool
mUseMultistrikeBold
=
false
;
bool
mGDIForced
=
false
;
}
;
}
;
}
}
#
endif
