#
include
"
compiler
/
translator
/
tree_ops
/
AddAndTrueToLoopCondition
.
h
"
#
include
"
compiler
/
translator
/
Compiler
.
h
"
#
include
"
compiler
/
translator
/
tree_util
/
IntermNode_util
.
h
"
#
include
"
compiler
/
translator
/
tree_util
/
IntermTraverse
.
h
"
namespace
sh
{
namespace
{
class
AddAndTrueToLoopConditionTraverser
:
public
TIntermTraverser
{
public
:
AddAndTrueToLoopConditionTraverser
(
)
:
TIntermTraverser
(
true
false
false
)
{
}
bool
visitLoop
(
Visit
TIntermLoop
*
loop
)
override
{
if
(
loop
-
>
getType
(
)
!
=
ELoopFor
&
&
loop
-
>
getType
(
)
!
=
ELoopWhile
)
{
return
true
;
}
if
(
loop
-
>
getCondition
(
)
=
=
nullptr
)
{
return
true
;
}
TIntermTyped
*
trueValue
=
CreateBoolNode
(
true
)
;
TIntermBinary
*
andOp
=
new
TIntermBinary
(
EOpLogicalAnd
loop
-
>
getCondition
(
)
trueValue
)
;
loop
-
>
setCondition
(
andOp
)
;
return
true
;
}
}
;
}
bool
AddAndTrueToLoopCondition
(
TCompiler
*
compiler
TIntermNode
*
root
)
{
AddAndTrueToLoopConditionTraverser
traverser
;
root
-
>
traverse
(
&
traverser
)
;
return
compiler
-
>
validateAST
(
root
)
;
}
}
