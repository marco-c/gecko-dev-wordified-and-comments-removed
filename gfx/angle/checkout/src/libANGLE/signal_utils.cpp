#
include
"
libANGLE
/
signal_utils
.
h
"
#
include
<
algorithm
>
#
include
"
common
/
debug
.
h
"
namespace
angle
{
ObserverInterface
:
:
~
ObserverInterface
(
)
=
default
;
Subject
:
:
Subject
(
)
{
}
Subject
:
:
~
Subject
(
)
{
resetObservers
(
)
;
}
bool
Subject
:
:
hasObservers
(
)
const
{
return
!
mObservers
.
empty
(
)
;
}
void
Subject
:
:
addObserver
(
ObserverBinding
*
observer
)
{
ASSERT
(
std
:
:
find
(
mObservers
.
begin
(
)
mObservers
.
end
(
)
observer
)
=
=
mObservers
.
end
(
)
)
;
mObservers
.
push_back
(
observer
)
;
}
void
Subject
:
:
removeObserver
(
ObserverBinding
*
observer
)
{
auto
iter
=
std
:
:
find
(
mObservers
.
begin
(
)
mObservers
.
end
(
)
observer
)
;
ASSERT
(
iter
!
=
mObservers
.
end
(
)
)
;
mObservers
.
erase
(
iter
)
;
}
void
Subject
:
:
onStateChange
(
const
gl
:
:
Context
*
context
SubjectMessage
message
)
const
{
if
(
mObservers
.
empty
(
)
)
return
;
for
(
const
angle
:
:
ObserverBinding
*
receiver
:
mObservers
)
{
receiver
-
>
onStateChange
(
context
message
)
;
}
}
void
Subject
:
:
resetObservers
(
)
{
for
(
angle
:
:
ObserverBinding
*
observer
:
mObservers
)
{
observer
-
>
onSubjectReset
(
)
;
}
mObservers
.
clear
(
)
;
}
ObserverBinding
:
:
ObserverBinding
(
ObserverInterface
*
observer
SubjectIndex
index
)
:
mSubject
(
nullptr
)
mObserver
(
observer
)
mIndex
(
index
)
{
ASSERT
(
observer
)
;
}
ObserverBinding
:
:
~
ObserverBinding
(
)
{
reset
(
)
;
}
ObserverBinding
:
:
ObserverBinding
(
const
ObserverBinding
&
other
)
=
default
;
ObserverBinding
&
ObserverBinding
:
:
operator
=
(
const
ObserverBinding
&
other
)
=
default
;
void
ObserverBinding
:
:
bind
(
Subject
*
subject
)
{
ASSERT
(
mObserver
)
;
if
(
mSubject
)
{
mSubject
-
>
removeObserver
(
this
)
;
}
mSubject
=
subject
;
if
(
mSubject
)
{
mSubject
-
>
addObserver
(
this
)
;
}
}
void
ObserverBinding
:
:
reset
(
)
{
bind
(
nullptr
)
;
}
void
ObserverBinding
:
:
onStateChange
(
const
gl
:
:
Context
*
context
SubjectMessage
message
)
const
{
mObserver
-
>
onSubjectStateChange
(
context
mIndex
message
)
;
}
void
ObserverBinding
:
:
onSubjectReset
(
)
{
mSubject
=
nullptr
;
}
}
