#
include
"
angle_gl
.
h
"
#
include
"
gtest
/
gtest
.
h
"
#
include
"
GLSLANG
/
ShaderLang
.
h
"
#
include
"
tests
/
test_utils
/
compiler_test
.
h
"
namespace
{
class
EmulateBuiltInFunctionsTest
:
public
testing
:
:
Test
{
public
:
EmulateBuiltInFunctionsTest
(
)
{
}
protected
:
void
compile
(
const
std
:
:
string
&
shaderString
)
{
std
:
:
string
infoLog
;
bool
compilationSuccess
=
compileTestShader
(
GL_VERTEX_SHADER
SH_GLES2_SPEC
SH_GLSL_COMPATIBILITY_OUTPUT
shaderString
SH_EMULATE_BUILT_IN_FUNCTIONS
&
mGLSLCode
&
infoLog
)
;
if
(
!
compilationSuccess
)
{
FAIL
(
)
<
<
"
Shader
compilation
into
GLSL
failed
"
<
<
infoLog
;
}
}
bool
foundInCode
(
const
char
*
stringToFind
)
{
return
mGLSLCode
.
find
(
stringToFind
)
!
=
std
:
:
string
:
:
npos
;
}
private
:
std
:
:
string
mGLSLCode
;
}
;
TEST_F
(
EmulateBuiltInFunctionsTest
DotEmulated
)
{
const
std
:
:
string
shaderString
=
"
precision
mediump
float
;
\
n
"
"
uniform
float
u
;
\
n
"
"
void
main
(
)
\
n
"
"
{
\
n
"
"
gl_Position
=
vec4
(
dot
(
u
1
.
0
)
1
.
0
1
.
0
1
.
0
)
;
\
n
"
"
}
\
n
"
;
compile
(
shaderString
)
;
ASSERT_TRUE
(
foundInCode
(
"
webgl_dot_emu
(
"
)
)
;
}
}
