#
ifndef
LIBANGLE_REFCOUNTOBJECT_H_
#
define
LIBANGLE_REFCOUNTOBJECT_H_
#
include
"
common
/
debug
.
h
"
#
include
"
angle_gl
.
h
"
#
include
<
cstddef
>
class
RefCountObject
:
angle
:
:
NonCopyable
{
public
:
explicit
RefCountObject
(
GLuint
id
)
:
mId
(
id
)
mRefCount
(
0
)
{
}
void
addRef
(
)
const
{
+
+
mRefCount
;
}
void
release
(
)
const
{
ASSERT
(
mRefCount
>
0
)
;
if
(
-
-
mRefCount
=
=
0
)
{
delete
this
;
}
}
GLuint
id
(
)
const
{
return
mId
;
}
size_t
getRefCount
(
)
const
{
return
mRefCount
;
}
protected
:
virtual
~
RefCountObject
(
)
{
ASSERT
(
mRefCount
=
=
0
)
;
}
private
:
GLuint
mId
;
mutable
std
:
:
size_t
mRefCount
;
}
;
template
<
class
ObjectType
>
class
BindingPointer
{
public
:
BindingPointer
(
)
:
mObject
(
nullptr
)
{
}
BindingPointer
(
const
BindingPointer
<
ObjectType
>
&
other
)
:
mObject
(
nullptr
)
{
set
(
other
.
mObject
)
;
}
void
operator
=
(
const
BindingPointer
<
ObjectType
>
&
other
)
{
set
(
other
.
mObject
)
;
}
virtual
~
BindingPointer
(
)
{
ASSERT
(
mObject
=
=
nullptr
)
;
}
virtual
void
set
(
ObjectType
*
newObject
)
{
if
(
newObject
!
=
nullptr
)
reinterpret_cast
<
const
RefCountObject
*
>
(
newObject
)
-
>
addRef
(
)
;
if
(
mObject
!
=
nullptr
)
reinterpret_cast
<
const
RefCountObject
*
>
(
mObject
)
-
>
release
(
)
;
mObject
=
newObject
;
}
ObjectType
*
get
(
)
const
{
return
mObject
;
}
ObjectType
*
operator
-
>
(
)
const
{
return
mObject
;
}
GLuint
id
(
)
const
{
return
(
mObject
!
=
nullptr
)
?
mObject
-
>
id
(
)
:
0
;
}
bool
operator
=
=
(
const
BindingPointer
<
ObjectType
>
&
other
)
const
{
return
mObject
=
=
other
.
mObject
;
}
bool
operator
!
=
(
const
BindingPointer
<
ObjectType
>
&
other
)
const
{
return
!
(
*
this
=
=
other
)
;
}
private
:
ObjectType
*
mObject
;
}
;
template
<
class
ObjectType
>
class
OffsetBindingPointer
:
public
BindingPointer
<
ObjectType
>
{
public
:
OffsetBindingPointer
(
)
:
mOffset
(
0
)
mSize
(
0
)
{
}
void
set
(
ObjectType
*
newObject
)
override
{
BindingPointer
<
ObjectType
>
:
:
set
(
newObject
)
;
mOffset
=
0
;
mSize
=
0
;
}
void
set
(
ObjectType
*
newObject
GLintptr
offset
GLsizeiptr
size
)
{
BindingPointer
<
ObjectType
>
:
:
set
(
newObject
)
;
mOffset
=
offset
;
mSize
=
size
;
}
GLintptr
getOffset
(
)
const
{
return
mOffset
;
}
GLsizeiptr
getSize
(
)
const
{
return
mSize
;
}
bool
operator
=
=
(
const
OffsetBindingPointer
<
ObjectType
>
&
other
)
const
{
return
this
-
>
get
(
)
=
=
other
.
get
(
)
&
&
mOffset
=
=
other
.
mOffset
&
&
mSize
=
=
other
.
mSize
;
}
bool
operator
!
=
(
const
OffsetBindingPointer
<
ObjectType
>
&
other
)
const
{
return
!
(
*
this
=
=
other
)
;
}
private
:
GLintptr
mOffset
;
GLsizeiptr
mSize
;
}
;
#
endif
