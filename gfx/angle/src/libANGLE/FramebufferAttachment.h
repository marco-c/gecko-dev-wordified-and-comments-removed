#
ifndef
LIBANGLE_FRAMEBUFFERATTACHMENT_H_
#
define
LIBANGLE_FRAMEBUFFERATTACHMENT_H_
#
include
"
angle_gl
.
h
"
#
include
"
common
/
angleutils
.
h
"
#
include
"
libANGLE
/
Error
.
h
"
#
include
"
libANGLE
/
ImageIndex
.
h
"
#
include
"
libANGLE
/
RefCountObject
.
h
"
namespace
egl
{
class
Surface
;
}
namespace
rx
{
class
FramebufferAttachmentRenderTarget
:
angle
:
:
NonCopyable
{
public
:
FramebufferAttachmentRenderTarget
(
)
{
}
virtual
~
FramebufferAttachmentRenderTarget
(
)
{
}
}
;
class
FramebufferAttachmentObjectImpl
;
}
namespace
gl
{
class
FramebufferAttachmentObject
;
class
Renderbuffer
;
class
Texture
;
class
FramebufferAttachment
final
{
public
:
FramebufferAttachment
(
)
;
FramebufferAttachment
(
GLenum
type
GLenum
binding
const
ImageIndex
&
textureIndex
FramebufferAttachmentObject
*
resource
)
;
FramebufferAttachment
(
const
FramebufferAttachment
&
other
)
:
mType
(
other
.
mType
)
mTarget
(
other
.
mTarget
)
{
mResource
.
set
(
other
.
mResource
.
get
(
)
)
;
}
FramebufferAttachment
&
operator
=
(
const
FramebufferAttachment
&
other
)
{
mType
=
other
.
mType
;
mTarget
=
other
.
mTarget
;
mResource
.
set
(
other
.
mResource
.
get
(
)
)
;
return
*
this
;
}
~
FramebufferAttachment
(
)
;
class
Target
{
public
:
Target
(
GLenum
binding
const
ImageIndex
&
imageIndex
)
;
Target
(
const
Target
&
other
)
;
Target
&
operator
=
(
const
Target
&
other
)
;
GLenum
binding
(
)
const
{
return
mBinding
;
}
const
ImageIndex
&
textureIndex
(
)
const
{
return
mTextureIndex
;
}
private
:
GLenum
mBinding
;
ImageIndex
mTextureIndex
;
}
;
void
detach
(
)
;
void
attach
(
GLenum
type
GLenum
binding
const
ImageIndex
&
textureIndex
FramebufferAttachmentObject
*
resource
)
;
GLuint
getRedSize
(
)
const
;
GLuint
getGreenSize
(
)
const
;
GLuint
getBlueSize
(
)
const
;
GLuint
getAlphaSize
(
)
const
;
GLuint
getDepthSize
(
)
const
;
GLuint
getStencilSize
(
)
const
;
GLenum
getComponentType
(
)
const
;
GLenum
getColorEncoding
(
)
const
;
bool
isTextureWithId
(
GLuint
textureId
)
const
{
return
mType
=
=
GL_TEXTURE
&
&
id
(
)
=
=
textureId
;
}
bool
isRenderbufferWithId
(
GLuint
renderbufferId
)
const
{
return
mType
=
=
GL_RENDERBUFFER
&
&
id
(
)
=
=
renderbufferId
;
}
GLenum
getBinding
(
)
const
{
return
mTarget
.
binding
(
)
;
}
GLuint
id
(
)
const
{
return
mResource
.
id
(
)
;
}
const
ImageIndex
&
getTextureImageIndex
(
)
const
;
GLenum
cubeMapFace
(
)
const
;
GLint
mipLevel
(
)
const
;
GLint
layer
(
)
const
;
GLsizei
getWidth
(
)
const
;
GLsizei
getHeight
(
)
const
;
GLenum
getInternalFormat
(
)
const
;
GLsizei
getSamples
(
)
const
;
GLenum
type
(
)
const
{
return
mType
;
}
bool
isAttached
(
)
const
{
return
mType
!
=
GL_NONE
;
}
Renderbuffer
*
getRenderbuffer
(
)
const
;
Texture
*
getTexture
(
)
const
;
const
egl
:
:
Surface
*
getSurface
(
)
const
;
template
<
typename
T
>
gl
:
:
Error
getRenderTarget
(
T
*
*
rtOut
)
const
{
rx
:
:
FramebufferAttachmentRenderTarget
*
rtPtr
=
nullptr
;
gl
:
:
Error
error
=
getRenderTarget
(
&
rtPtr
)
;
*
rtOut
=
static_cast
<
T
*
>
(
rtPtr
)
;
return
error
;
}
private
:
gl
:
:
Error
getRenderTarget
(
rx
:
:
FramebufferAttachmentRenderTarget
*
*
rtOut
)
const
;
GLenum
mType
;
Target
mTarget
;
BindingPointer
<
FramebufferAttachmentObject
>
mResource
;
}
;
class
FramebufferAttachmentObject
:
public
RefCountObject
{
public
:
FramebufferAttachmentObject
(
GLuint
id
)
:
RefCountObject
(
id
)
{
}
virtual
GLsizei
getAttachmentWidth
(
const
FramebufferAttachment
:
:
Target
&
target
)
const
=
0
;
virtual
GLsizei
getAttachmentHeight
(
const
FramebufferAttachment
:
:
Target
&
target
)
const
=
0
;
virtual
GLenum
getAttachmentInternalFormat
(
const
FramebufferAttachment
:
:
Target
&
target
)
const
=
0
;
virtual
GLsizei
getAttachmentSamples
(
const
FramebufferAttachment
:
:
Target
&
target
)
const
=
0
;
Error
getAttachmentRenderTarget
(
const
FramebufferAttachment
:
:
Target
&
target
rx
:
:
FramebufferAttachmentRenderTarget
*
*
rtOut
)
const
;
protected
:
virtual
rx
:
:
FramebufferAttachmentObjectImpl
*
getAttachmentImpl
(
)
const
=
0
;
}
;
inline
GLsizei
FramebufferAttachment
:
:
getWidth
(
)
const
{
return
mResource
-
>
getAttachmentWidth
(
mTarget
)
;
}
inline
GLsizei
FramebufferAttachment
:
:
getHeight
(
)
const
{
return
mResource
-
>
getAttachmentHeight
(
mTarget
)
;
}
inline
GLenum
FramebufferAttachment
:
:
getInternalFormat
(
)
const
{
return
mResource
-
>
getAttachmentInternalFormat
(
mTarget
)
;
}
inline
GLsizei
FramebufferAttachment
:
:
getSamples
(
)
const
{
return
mResource
-
>
getAttachmentSamples
(
mTarget
)
;
}
inline
gl
:
:
Error
FramebufferAttachment
:
:
getRenderTarget
(
rx
:
:
FramebufferAttachmentRenderTarget
*
*
rtOut
)
const
{
return
mResource
-
>
getAttachmentRenderTarget
(
mTarget
rtOut
)
;
}
}
namespace
rx
{
class
FramebufferAttachmentObjectImpl
:
angle
:
:
NonCopyable
{
public
:
FramebufferAttachmentObjectImpl
(
)
{
}
virtual
~
FramebufferAttachmentObjectImpl
(
)
{
}
virtual
gl
:
:
Error
getAttachmentRenderTarget
(
const
gl
:
:
FramebufferAttachment
:
:
Target
&
target
FramebufferAttachmentRenderTarget
*
*
rtOut
)
=
0
;
}
;
}
namespace
gl
{
inline
Error
FramebufferAttachmentObject
:
:
getAttachmentRenderTarget
(
const
FramebufferAttachment
:
:
Target
&
target
rx
:
:
FramebufferAttachmentRenderTarget
*
*
rtOut
)
const
{
return
getAttachmentImpl
(
)
-
>
getAttachmentRenderTarget
(
target
rtOut
)
;
}
}
#
endif
