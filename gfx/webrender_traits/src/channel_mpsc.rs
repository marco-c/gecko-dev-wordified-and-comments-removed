use
serde
:
:
{
Deserialize
Serialize
}
;
use
std
:
:
io
:
:
Error
;
use
serde
:
:
{
Deserializer
Serializer
}
;
use
std
:
:
sync
:
:
mpsc
;
pub
type
PayloadSender
=
MsgSender
<
Vec
<
u8
>
>
;
pub
type
PayloadReceiver
=
MsgReceiver
<
Vec
<
u8
>
>
;
impl
PayloadHelperMethods
for
PayloadSender
{
fn
send_vec
(
&
self
data
:
Vec
<
u8
>
)
-
>
Result
<
(
)
Error
>
{
self
.
send
(
data
)
}
}
pub
struct
MsgReceiver
<
T
>
{
rx
:
mpsc
:
:
Receiver
<
T
>
}
impl
<
T
>
MsgReceiver
<
T
>
{
pub
fn
recv
(
&
self
)
-
>
Result
<
T
Error
>
{
Ok
(
self
.
rx
.
recv
(
)
.
unwrap
(
)
)
}
}
#
[
derive
(
Clone
)
]
pub
struct
MsgSender
<
T
>
{
tx
:
mpsc
:
:
Sender
<
T
>
}
impl
<
T
>
MsgSender
<
T
>
{
pub
fn
send
(
&
self
data
:
T
)
-
>
Result
<
(
)
Error
>
{
Ok
(
self
.
tx
.
send
(
data
)
.
unwrap
(
)
)
}
}
pub
fn
payload_channel
(
)
-
>
Result
<
(
PayloadSender
PayloadReceiver
)
Error
>
{
let
(
tx
rx
)
=
mpsc
:
:
channel
(
)
;
Ok
(
(
PayloadSender
{
tx
:
tx
}
PayloadReceiver
{
rx
:
rx
}
)
)
}
pub
fn
msg_channel
<
T
>
(
)
-
>
Result
<
(
MsgSender
<
T
>
MsgReceiver
<
T
>
)
Error
>
{
let
(
tx
rx
)
=
mpsc
:
:
channel
(
)
;
Ok
(
(
MsgSender
{
tx
:
tx
}
MsgReceiver
{
rx
:
rx
}
)
)
}
impl
<
T
>
Serialize
for
MsgReceiver
<
T
>
{
fn
serialize
<
S
:
Serializer
>
(
&
self
_
:
&
mut
S
)
-
>
Result
<
(
)
S
:
:
Error
>
{
unreachable
!
(
)
;
}
}
impl
<
T
>
Serialize
for
MsgSender
<
T
>
{
fn
serialize
<
S
:
Serializer
>
(
&
self
_
:
&
mut
S
)
-
>
Result
<
(
)
S
:
:
Error
>
{
unreachable
!
(
)
;
}
}
impl
<
T
>
Deserialize
for
MsgReceiver
<
T
>
{
fn
deserialize
<
D
>
(
_
:
&
mut
D
)
-
>
Result
<
MsgReceiver
<
T
>
D
:
:
Error
>
where
D
:
Deserializer
{
unreachable
!
(
)
;
}
}
impl
<
T
>
Deserialize
for
MsgSender
<
T
>
{
fn
deserialize
<
D
>
(
_
:
&
mut
D
)
-
>
Result
<
MsgSender
<
T
>
D
:
:
Error
>
where
D
:
Deserializer
{
unreachable
!
(
)
;
}
}
