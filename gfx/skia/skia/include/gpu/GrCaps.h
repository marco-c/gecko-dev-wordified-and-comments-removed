#
ifndef
GrCaps_DEFINED
#
define
GrCaps_DEFINED
#
include
"
GrTypes
.
h
"
#
include
"
GrTypesPriv
.
h
"
#
include
"
GrBlend
.
h
"
#
include
"
GrShaderVar
.
h
"
#
include
"
GrShaderCaps
.
h
"
#
include
"
SkRefCnt
.
h
"
#
include
"
SkString
.
h
"
struct
GrContextOptions
;
class
GrRenderTargetProxy
;
class
GrCaps
:
public
SkRefCnt
{
public
:
GrCaps
(
const
GrContextOptions
&
)
;
virtual
SkString
dump
(
)
const
;
const
GrShaderCaps
*
shaderCaps
(
)
const
{
return
fShaderCaps
.
get
(
)
;
}
bool
npotTextureTileSupport
(
)
const
{
return
fNPOTTextureTileSupport
;
}
bool
mipMapSupport
(
)
const
{
return
fMipMapSupport
;
}
bool
srgbSupport
(
)
const
{
return
fSRGBSupport
;
}
bool
srgbWriteControl
(
)
const
{
return
fSRGBWriteControl
;
}
bool
twoSidedStencilSupport
(
)
const
{
return
fTwoSidedStencilSupport
;
}
bool
stencilWrapOpsSupport
(
)
const
{
return
fStencilWrapOpsSupport
;
}
bool
discardRenderTargetSupport
(
)
const
{
return
fDiscardRenderTargetSupport
;
}
bool
gpuTracingSupport
(
)
const
{
return
fGpuTracingSupport
;
}
bool
compressedTexSubImageSupport
(
)
const
{
return
fCompressedTexSubImageSupport
;
}
bool
oversizedStencilSupport
(
)
const
{
return
fOversizedStencilSupport
;
}
bool
textureBarrierSupport
(
)
const
{
return
fTextureBarrierSupport
;
}
bool
sampleLocationsSupport
(
)
const
{
return
fSampleLocationsSupport
;
}
bool
multisampleDisableSupport
(
)
const
{
return
fMultisampleDisableSupport
;
}
bool
usesMixedSamples
(
)
const
{
return
fUsesMixedSamples
;
}
bool
preferClientSideDynamicBuffers
(
)
const
{
return
fPreferClientSideDynamicBuffers
;
}
bool
useDrawInsteadOfClear
(
)
const
{
return
fUseDrawInsteadOfClear
;
}
bool
useDrawInsteadOfPartialRenderTargetWrite
(
)
const
{
return
fUseDrawInsteadOfPartialRenderTargetWrite
;
}
bool
useDrawInsteadOfAllRenderTargetWrites
(
)
const
{
return
fUseDrawInsteadOfAllRenderTargetWrites
;
}
bool
preferVRAMUseOverFlushes
(
)
const
{
return
fPreferVRAMUseOverFlushes
;
}
enum
class
InstancedSupport
{
kNone
kBasic
kMultisampled
kMixedSampled
}
;
InstancedSupport
instancedSupport
(
)
const
{
return
fInstancedSupport
;
}
bool
avoidInstancedDrawsToFPTargets
(
)
const
{
return
fAvoidInstancedDrawsToFPTargets
;
}
enum
BlendEquationSupport
{
kBasic_BlendEquationSupport
kAdvanced_BlendEquationSupport
kAdvancedCoherent_BlendEquationSupport
kLast_BlendEquationSupport
=
kAdvancedCoherent_BlendEquationSupport
}
;
BlendEquationSupport
blendEquationSupport
(
)
const
{
return
fBlendEquationSupport
;
}
bool
advancedBlendEquationSupport
(
)
const
{
return
fBlendEquationSupport
>
=
kAdvanced_BlendEquationSupport
;
}
bool
advancedCoherentBlendEquationSupport
(
)
const
{
return
kAdvancedCoherent_BlendEquationSupport
=
=
fBlendEquationSupport
;
}
bool
canUseAdvancedBlendEquation
(
GrBlendEquation
equation
)
const
{
SkASSERT
(
GrBlendEquationIsAdvanced
(
equation
)
)
;
return
SkToBool
(
fAdvBlendEqBlacklist
&
(
1
<
<
equation
)
)
;
}
enum
MapFlags
{
kNone_MapFlags
=
0x0
kCanMap_MapFlag
=
0x1
kSubset_MapFlag
=
0x2
}
;
uint32_t
mapBufferFlags
(
)
const
{
return
fMapBufferFlags
;
}
bool
reuseScratchTextures
(
)
const
{
return
fReuseScratchTextures
;
}
bool
reuseScratchBuffers
(
)
const
{
return
fReuseScratchBuffers
;
}
int
maxVertexAttributes
(
)
const
{
return
fMaxVertexAttributes
;
}
int
maxRenderTargetSize
(
)
const
{
return
fMaxRenderTargetSize
;
}
int
maxTextureSize
(
)
const
{
return
fMaxTextureSize
;
}
int
maxTileSize
(
)
const
{
SkASSERT
(
fMaxTileSize
<
=
fMaxTextureSize
)
;
return
fMaxTileSize
;
}
int
maxColorSampleCount
(
)
const
{
return
fMaxColorSampleCount
;
}
int
maxStencilSampleCount
(
)
const
{
return
fMaxStencilSampleCount
;
}
int
maxRasterSamples
(
)
const
{
return
fMaxRasterSamples
;
}
int
maxSampleCount
(
)
const
{
if
(
this
-
>
usesMixedSamples
(
)
)
{
return
this
-
>
maxStencilSampleCount
(
)
;
}
else
{
return
SkTMin
(
this
-
>
maxColorSampleCount
(
)
this
-
>
maxStencilSampleCount
(
)
)
;
}
}
int
maxWindowRectangles
(
)
const
{
return
fMaxWindowRectangles
;
}
virtual
bool
isConfigTexturable
(
GrPixelConfig
config
)
const
=
0
;
virtual
bool
isConfigRenderable
(
GrPixelConfig
config
bool
withMSAA
)
const
=
0
;
virtual
bool
canConfigBeImageStorage
(
GrPixelConfig
config
)
const
=
0
;
bool
suppressPrints
(
)
const
{
return
fSuppressPrints
;
}
bool
immediateFlush
(
)
const
{
return
fImmediateFlush
;
}
size_t
bufferMapThreshold
(
)
const
{
SkASSERT
(
fBufferMapThreshold
>
=
0
)
;
return
fBufferMapThreshold
;
}
bool
fullClearIsFree
(
)
const
{
return
fFullClearIsFree
;
}
bool
mustClearUploadedBufferData
(
)
const
{
return
fMustClearUploadedBufferData
;
}
bool
sampleShadingSupport
(
)
const
{
return
fSampleShadingSupport
;
}
bool
fenceSyncSupport
(
)
const
{
return
fFenceSyncSupport
;
}
bool
crossContextTextureSupport
(
)
const
{
return
fCrossContextTextureSupport
;
}
virtual
bool
initDescForDstCopy
(
const
GrRenderTargetProxy
*
src
GrSurfaceDesc
*
desc
bool
*
rectsMustMatch
bool
*
disallowSubrect
)
const
=
0
;
protected
:
void
applyOptionsOverrides
(
const
GrContextOptions
&
options
)
;
sk_sp
<
GrShaderCaps
>
fShaderCaps
;
bool
fNPOTTextureTileSupport
:
1
;
bool
fMipMapSupport
:
1
;
bool
fSRGBSupport
:
1
;
bool
fSRGBWriteControl
:
1
;
bool
fTwoSidedStencilSupport
:
1
;
bool
fStencilWrapOpsSupport
:
1
;
bool
fDiscardRenderTargetSupport
:
1
;
bool
fReuseScratchTextures
:
1
;
bool
fReuseScratchBuffers
:
1
;
bool
fGpuTracingSupport
:
1
;
bool
fCompressedTexSubImageSupport
:
1
;
bool
fOversizedStencilSupport
:
1
;
bool
fTextureBarrierSupport
:
1
;
bool
fSampleLocationsSupport
:
1
;
bool
fMultisampleDisableSupport
:
1
;
bool
fUsesMixedSamples
:
1
;
bool
fPreferClientSideDynamicBuffers
:
1
;
bool
fFullClearIsFree
:
1
;
bool
fMustClearUploadedBufferData
:
1
;
bool
fUseDrawInsteadOfClear
:
1
;
bool
fUseDrawInsteadOfPartialRenderTargetWrite
:
1
;
bool
fUseDrawInsteadOfAllRenderTargetWrites
:
1
;
bool
fAvoidInstancedDrawsToFPTargets
:
1
;
bool
fPreferVRAMUseOverFlushes
:
1
;
bool
fSampleShadingSupport
:
1
;
bool
fFenceSyncSupport
:
1
;
bool
fCrossContextTextureSupport
:
1
;
InstancedSupport
fInstancedSupport
;
BlendEquationSupport
fBlendEquationSupport
;
uint32_t
fAdvBlendEqBlacklist
;
GR_STATIC_ASSERT
(
kLast_GrBlendEquation
<
32
)
;
uint32_t
fMapBufferFlags
;
int
fBufferMapThreshold
;
int
fMaxRenderTargetSize
;
int
fMaxVertexAttributes
;
int
fMaxTextureSize
;
int
fMaxTileSize
;
int
fMaxColorSampleCount
;
int
fMaxStencilSampleCount
;
int
fMaxRasterSamples
;
int
fMaxWindowRectangles
;
private
:
virtual
void
onApplyOptionsOverrides
(
const
GrContextOptions
&
)
{
}
bool
fSuppressPrints
:
1
;
bool
fImmediateFlush
:
1
;
typedef
SkRefCnt
INHERITED
;
}
;
#
endif
