#
ifndef
GrBackendSurface_DEFINED
#
define
GrBackendSurface_DEFINED
#
include
"
include
/
gpu
/
GrBackendSurfaceMutableState
.
h
"
#
include
"
include
/
gpu
/
GrSurfaceInfo
.
h
"
#
include
"
include
/
gpu
/
GrTypes
.
h
"
#
include
"
include
/
gpu
/
MutableTextureState
.
h
"
#
ifdef
SK_GL
#
include
"
include
/
gpu
/
gl
/
GrGLTypes
.
h
"
#
include
"
include
/
private
/
gpu
/
ganesh
/
GrGLTypesPriv
.
h
"
#
endif
#
include
"
include
/
gpu
/
mock
/
GrMockTypes
.
h
"
#
ifdef
SK_VULKAN
#
include
"
include
/
gpu
/
vk
/
GrVkTypes
.
h
"
#
include
"
include
/
private
/
gpu
/
ganesh
/
GrVkTypesPriv
.
h
"
#
endif
#
ifdef
SK_DAWN
#
include
"
include
/
gpu
/
dawn
/
GrDawnTypes
.
h
"
#
endif
#
include
<
string
>
class
GrVkImageLayout
;
class
GrGLTextureParameters
;
class
GrColorFormatDesc
;
enum
class
SkTextureCompressionType
;
namespace
skgpu
{
class
MutableTextureStateRef
;
}
#
ifdef
SK_DAWN
#
include
"
webgpu
/
webgpu_cpp
.
h
"
#
endif
#
ifdef
SK_METAL
#
include
"
include
/
gpu
/
mtl
/
GrMtlTypes
.
h
"
#
endif
#
ifdef
SK_DIRECT3D
#
include
"
include
/
private
/
gpu
/
ganesh
/
GrD3DTypesMinimal
.
h
"
class
GrD3DResourceState
;
#
endif
#
if
defined
(
SK_DEBUG
)
|
|
GR_TEST_UTILS
class
SkString
;
#
endif
#
if
!
defined
(
SK_GANESH
)
class
SK_API
GrBackendFormat
{
public
:
bool
isValid
(
)
const
{
return
false
;
}
}
;
class
SK_API
GrBackendTexture
{
public
:
GrBackendTexture
(
)
{
}
bool
isValid
(
)
const
{
return
false
;
}
}
;
class
SK_API
GrBackendRenderTarget
{
public
:
GrBackendRenderTarget
(
)
{
}
bool
isValid
(
)
const
{
return
false
;
}
bool
isFramebufferOnly
(
)
const
{
return
false
;
}
}
;
#
else
enum
class
GrGLFormat
;
class
SK_API
GrBackendFormat
{
public
:
GrBackendFormat
(
)
{
}
GrBackendFormat
(
const
GrBackendFormat
&
)
;
GrBackendFormat
&
operator
=
(
const
GrBackendFormat
&
)
;
#
ifdef
SK_GL
static
GrBackendFormat
MakeGL
(
GrGLenum
format
GrGLenum
target
)
{
return
GrBackendFormat
(
format
target
)
;
}
#
endif
#
ifdef
SK_VULKAN
static
GrBackendFormat
MakeVk
(
VkFormat
format
bool
willUseDRMFormatModifiers
=
false
)
{
return
GrBackendFormat
(
format
GrVkYcbcrConversionInfo
(
)
willUseDRMFormatModifiers
)
;
}
static
GrBackendFormat
MakeVk
(
const
GrVkYcbcrConversionInfo
&
ycbcrInfo
bool
willUseDRMFormatModifiers
=
false
)
;
#
endif
#
ifdef
SK_DAWN
static
GrBackendFormat
MakeDawn
(
wgpu
:
:
TextureFormat
format
)
{
return
GrBackendFormat
(
format
)
;
}
#
endif
#
ifdef
SK_METAL
static
GrBackendFormat
MakeMtl
(
GrMTLPixelFormat
format
)
{
return
GrBackendFormat
(
format
)
;
}
#
endif
#
ifdef
SK_DIRECT3D
static
GrBackendFormat
MakeDxgi
(
DXGI_FORMAT
format
)
{
return
GrBackendFormat
(
format
)
;
}
#
endif
static
GrBackendFormat
MakeMock
(
GrColorType
colorType
SkTextureCompressionType
compression
bool
isStencilFormat
=
false
)
;
bool
operator
=
=
(
const
GrBackendFormat
&
that
)
const
;
bool
operator
!
=
(
const
GrBackendFormat
&
that
)
const
{
return
!
(
*
this
=
=
that
)
;
}
GrBackendApi
backend
(
)
const
{
return
fBackend
;
}
GrTextureType
textureType
(
)
const
{
return
fTextureType
;
}
uint32_t
channelMask
(
)
const
;
GrColorFormatDesc
desc
(
)
const
;
#
ifdef
SK_GL
GrGLFormat
asGLFormat
(
)
const
;
GrGLenum
asGLFormatEnum
(
)
const
;
#
endif
#
ifdef
SK_VULKAN
bool
asVkFormat
(
VkFormat
*
)
const
;
const
GrVkYcbcrConversionInfo
*
getVkYcbcrConversionInfo
(
)
const
;
#
endif
#
ifdef
SK_DAWN
bool
asDawnFormat
(
wgpu
:
:
TextureFormat
*
)
const
;
#
endif
#
ifdef
SK_METAL
GrMTLPixelFormat
asMtlFormat
(
)
const
;
#
endif
#
ifdef
SK_DIRECT3D
bool
asDxgiFormat
(
DXGI_FORMAT
*
)
const
;
#
endif
GrColorType
asMockColorType
(
)
const
;
SkTextureCompressionType
asMockCompressionType
(
)
const
;
bool
isMockStencilFormat
(
)
const
;
GrBackendFormat
makeTexture2D
(
)
const
;
bool
isValid
(
)
const
{
return
fValid
;
}
#
if
defined
(
SK_DEBUG
)
|
|
GR_TEST_UTILS
SkString
toStr
(
)
const
;
#
endif
private
:
#
ifdef
SK_GL
GrBackendFormat
(
GrGLenum
format
GrGLenum
target
)
;
#
endif
#
ifdef
SK_VULKAN
GrBackendFormat
(
const
VkFormat
vkFormat
const
GrVkYcbcrConversionInfo
&
bool
willUseDRMFormatModifiers
)
;
#
endif
#
ifdef
SK_DAWN
GrBackendFormat
(
wgpu
:
:
TextureFormat
format
)
;
#
endif
#
ifdef
SK_METAL
GrBackendFormat
(
const
GrMTLPixelFormat
mtlFormat
)
;
#
endif
#
ifdef
SK_DIRECT3D
GrBackendFormat
(
DXGI_FORMAT
dxgiFormat
)
;
#
endif
GrBackendFormat
(
GrColorType
SkTextureCompressionType
bool
isStencilFormat
)
;
#
ifdef
SK_DEBUG
bool
validateMock
(
)
const
;
#
endif
GrBackendApi
fBackend
=
GrBackendApi
:
:
kMock
;
bool
fValid
=
false
;
union
{
#
ifdef
SK_GL
GrGLenum
fGLFormat
;
#
endif
#
ifdef
SK_VULKAN
struct
{
VkFormat
fFormat
;
GrVkYcbcrConversionInfo
fYcbcrConversionInfo
;
}
fVk
;
#
endif
#
ifdef
SK_DAWN
wgpu
:
:
TextureFormat
fDawnFormat
;
#
endif
#
ifdef
SK_METAL
GrMTLPixelFormat
fMtlFormat
;
#
endif
#
ifdef
SK_DIRECT3D
DXGI_FORMAT
fDxgiFormat
;
#
endif
struct
{
GrColorType
fColorType
;
SkTextureCompressionType
fCompressionType
;
bool
fIsStencilFormat
;
}
fMock
;
}
;
GrTextureType
fTextureType
=
GrTextureType
:
:
kNone
;
}
;
class
SK_API
GrBackendTexture
{
public
:
GrBackendTexture
(
)
;
#
ifdef
SK_GL
GrBackendTexture
(
int
width
int
height
GrMipmapped
const
GrGLTextureInfo
&
glInfo
std
:
:
string_view
label
=
{
}
)
;
#
endif
#
ifdef
SK_VULKAN
GrBackendTexture
(
int
width
int
height
const
GrVkImageInfo
&
vkInfo
std
:
:
string_view
label
=
{
}
)
;
#
endif
#
ifdef
SK_METAL
GrBackendTexture
(
int
width
int
height
GrMipmapped
const
GrMtlTextureInfo
&
mtlInfo
std
:
:
string_view
label
=
{
}
)
;
#
endif
#
ifdef
SK_DIRECT3D
GrBackendTexture
(
int
width
int
height
const
GrD3DTextureResourceInfo
&
d3dInfo
std
:
:
string_view
label
=
{
}
)
;
#
endif
#
ifdef
SK_DAWN
GrBackendTexture
(
int
width
int
height
const
GrDawnTextureInfo
&
dawnInfo
std
:
:
string_view
label
=
{
}
)
;
#
endif
GrBackendTexture
(
int
width
int
height
GrMipmapped
const
GrMockTextureInfo
&
mockInfo
std
:
:
string_view
label
=
{
}
)
;
GrBackendTexture
(
const
GrBackendTexture
&
that
)
;
~
GrBackendTexture
(
)
;
GrBackendTexture
&
operator
=
(
const
GrBackendTexture
&
that
)
;
SkISize
dimensions
(
)
const
{
return
{
fWidth
fHeight
}
;
}
int
width
(
)
const
{
return
fWidth
;
}
int
height
(
)
const
{
return
fHeight
;
}
std
:
:
string_view
getLabel
(
)
const
{
return
fLabel
;
}
GrMipmapped
mipmapped
(
)
const
{
return
fMipmapped
;
}
bool
hasMipmaps
(
)
const
{
return
fMipmapped
=
=
GrMipmapped
:
:
kYes
;
}
bool
hasMipMaps
(
)
const
{
return
this
-
>
hasMipmaps
(
)
;
}
GrBackendApi
backend
(
)
const
{
return
fBackend
;
}
GrTextureType
textureType
(
)
const
{
return
fTextureType
;
}
#
ifdef
SK_GL
bool
getGLTextureInfo
(
GrGLTextureInfo
*
)
const
;
void
glTextureParametersModified
(
)
;
#
endif
#
ifdef
SK_DAWN
bool
getDawnTextureInfo
(
GrDawnTextureInfo
*
)
const
;
#
endif
#
ifdef
SK_VULKAN
bool
getVkImageInfo
(
GrVkImageInfo
*
)
const
;
void
setVkImageLayout
(
VkImageLayout
)
;
#
endif
#
ifdef
SK_METAL
bool
getMtlTextureInfo
(
GrMtlTextureInfo
*
)
const
;
#
endif
#
ifdef
SK_DIRECT3D
bool
getD3DTextureResourceInfo
(
GrD3DTextureResourceInfo
*
)
const
;
void
setD3DResourceState
(
GrD3DResourceStateEnum
)
;
#
endif
GrBackendFormat
getBackendFormat
(
)
const
;
bool
getMockTextureInfo
(
GrMockTextureInfo
*
)
const
;
void
setMutableState
(
const
skgpu
:
:
MutableTextureState
&
)
;
bool
isProtected
(
)
const
;
bool
isValid
(
)
const
{
return
fIsValid
;
}
bool
isSameTexture
(
const
GrBackendTexture
&
)
;
#
if
GR_TEST_UTILS
static
bool
TestingOnly_Equals
(
const
GrBackendTexture
&
const
GrBackendTexture
&
)
;
#
endif
private
:
friend
class
GrVkGpu
;
sk_sp
<
skgpu
:
:
MutableTextureStateRef
>
getMutableState
(
)
const
;
#
ifdef
SK_GL
friend
class
GrGLTexture
;
friend
class
GrGLGpu
;
GrBackendTexture
(
int
width
int
height
GrMipmapped
const
GrGLTextureInfo
sk_sp
<
GrGLTextureParameters
>
std
:
:
string_view
label
=
{
}
)
;
sk_sp
<
GrGLTextureParameters
>
getGLTextureParams
(
)
const
;
#
endif
#
ifdef
SK_VULKAN
friend
class
GrVkTexture
;
GrBackendTexture
(
int
width
int
height
const
GrVkImageInfo
&
vkInfo
sk_sp
<
skgpu
:
:
MutableTextureStateRef
>
mutableState
std
:
:
string_view
label
=
{
}
)
;
#
endif
#
ifdef
SK_DIRECT3D
friend
class
GrD3DTexture
;
friend
class
GrD3DGpu
;
GrBackendTexture
(
int
width
int
height
const
GrD3DTextureResourceInfo
&
vkInfo
sk_sp
<
GrD3DResourceState
>
state
std
:
:
string_view
label
=
{
}
)
;
sk_sp
<
GrD3DResourceState
>
getGrD3DResourceState
(
)
const
;
#
endif
void
cleanup
(
)
;
bool
fIsValid
;
int
fWidth
;
int
fHeight
;
const
std
:
:
string
fLabel
;
GrMipmapped
fMipmapped
;
GrBackendApi
fBackend
;
GrTextureType
fTextureType
;
union
{
#
ifdef
SK_GL
GrGLBackendTextureInfo
fGLInfo
;
#
endif
#
ifdef
SK_VULKAN
GrVkBackendSurfaceInfo
fVkInfo
;
#
endif
GrMockTextureInfo
fMockInfo
;
#
ifdef
SK_DIRECT3D
GrD3DBackendSurfaceInfo
fD3DInfo
;
#
endif
}
;
#
ifdef
SK_METAL
GrMtlTextureInfo
fMtlInfo
;
#
endif
#
ifdef
SK_DAWN
GrDawnTextureInfo
fDawnInfo
;
#
endif
sk_sp
<
skgpu
:
:
MutableTextureStateRef
>
fMutableState
;
}
;
class
SK_API
GrBackendRenderTarget
{
public
:
GrBackendRenderTarget
(
)
;
#
ifdef
SK_GL
GrBackendRenderTarget
(
int
width
int
height
int
sampleCnt
int
stencilBits
const
GrGLFramebufferInfo
&
glInfo
)
;
#
endif
#
ifdef
SK_DAWN
GrBackendRenderTarget
(
int
width
int
height
int
sampleCnt
int
stencilBits
const
GrDawnRenderTargetInfo
&
dawnInfo
)
;
#
endif
#
ifdef
SK_VULKAN
GrBackendRenderTarget
(
int
width
int
height
int
sampleCnt
const
GrVkImageInfo
&
vkInfo
)
;
GrBackendRenderTarget
(
int
width
int
height
const
GrVkImageInfo
&
vkInfo
)
;
#
endif
#
ifdef
SK_METAL
GrBackendRenderTarget
(
int
width
int
height
const
GrMtlTextureInfo
&
mtlInfo
)
;
GrBackendRenderTarget
(
int
width
int
height
int
sampleCnt
const
GrMtlTextureInfo
&
mtlInfo
)
;
#
endif
#
ifdef
SK_DIRECT3D
GrBackendRenderTarget
(
int
width
int
height
const
GrD3DTextureResourceInfo
&
d3dInfo
)
;
#
endif
GrBackendRenderTarget
(
int
width
int
height
int
sampleCnt
int
stencilBits
const
GrMockRenderTargetInfo
&
mockInfo
)
;
~
GrBackendRenderTarget
(
)
;
GrBackendRenderTarget
(
const
GrBackendRenderTarget
&
that
)
;
GrBackendRenderTarget
&
operator
=
(
const
GrBackendRenderTarget
&
)
;
SkISize
dimensions
(
)
const
{
return
{
fWidth
fHeight
}
;
}
int
width
(
)
const
{
return
fWidth
;
}
int
height
(
)
const
{
return
fHeight
;
}
int
sampleCnt
(
)
const
{
return
fSampleCnt
;
}
int
stencilBits
(
)
const
{
return
fStencilBits
;
}
GrBackendApi
backend
(
)
const
{
return
fBackend
;
}
bool
isFramebufferOnly
(
)
const
{
return
fFramebufferOnly
;
}
#
ifdef
SK_GL
bool
getGLFramebufferInfo
(
GrGLFramebufferInfo
*
)
const
;
#
endif
#
ifdef
SK_DAWN
bool
getDawnRenderTargetInfo
(
GrDawnRenderTargetInfo
*
)
const
;
#
endif
#
ifdef
SK_VULKAN
bool
getVkImageInfo
(
GrVkImageInfo
*
)
const
;
void
setVkImageLayout
(
VkImageLayout
)
;
#
endif
#
ifdef
SK_METAL
bool
getMtlTextureInfo
(
GrMtlTextureInfo
*
)
const
;
#
endif
#
ifdef
SK_DIRECT3D
bool
getD3DTextureResourceInfo
(
GrD3DTextureResourceInfo
*
)
const
;
void
setD3DResourceState
(
GrD3DResourceStateEnum
)
;
#
endif
GrBackendFormat
getBackendFormat
(
)
const
;
bool
getMockRenderTargetInfo
(
GrMockRenderTargetInfo
*
)
const
;
void
setMutableState
(
const
skgpu
:
:
MutableTextureState
&
)
;
bool
isProtected
(
)
const
;
bool
isValid
(
)
const
{
return
fIsValid
;
}
#
if
GR_TEST_UTILS
static
bool
TestingOnly_Equals
(
const
GrBackendRenderTarget
&
const
GrBackendRenderTarget
&
)
;
#
endif
private
:
friend
class
GrVkGpu
;
sk_sp
<
skgpu
:
:
MutableTextureStateRef
>
getMutableState
(
)
const
;
#
ifdef
SK_VULKAN
friend
class
GrVkRenderTarget
;
GrBackendRenderTarget
(
int
width
int
height
const
GrVkImageInfo
&
vkInfo
sk_sp
<
skgpu
:
:
MutableTextureStateRef
>
mutableState
)
;
#
endif
#
ifdef
SK_DIRECT3D
friend
class
GrD3DGpu
;
friend
class
GrD3DRenderTarget
;
GrBackendRenderTarget
(
int
width
int
height
const
GrD3DTextureResourceInfo
&
d3dInfo
sk_sp
<
GrD3DResourceState
>
state
)
;
sk_sp
<
GrD3DResourceState
>
getGrD3DResourceState
(
)
const
;
#
endif
void
cleanup
(
)
;
bool
fIsValid
;
bool
fFramebufferOnly
=
false
;
int
fWidth
;
int
fHeight
;
int
fSampleCnt
;
int
fStencilBits
;
GrBackendApi
fBackend
;
union
{
#
ifdef
SK_GL
GrGLFramebufferInfo
fGLInfo
;
#
endif
#
ifdef
SK_VULKAN
GrVkBackendSurfaceInfo
fVkInfo
;
#
endif
GrMockRenderTargetInfo
fMockInfo
;
#
ifdef
SK_DIRECT3D
GrD3DBackendSurfaceInfo
fD3DInfo
;
#
endif
}
;
#
ifdef
SK_METAL
GrMtlTextureInfo
fMtlInfo
;
#
endif
#
ifdef
SK_DAWN
GrDawnRenderTargetInfo
fDawnInfo
;
#
endif
sk_sp
<
skgpu
:
:
MutableTextureStateRef
>
fMutableState
;
}
;
#
endif
#
endif
