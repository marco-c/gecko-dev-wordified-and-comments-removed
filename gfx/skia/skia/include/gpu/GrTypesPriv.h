#
ifndef
GrTypesPriv_DEFINED
#
define
GrTypesPriv_DEFINED
#
include
"
GrTypes
.
h
"
#
include
"
SkTArray
.
h
"
#
include
"
SkRect
.
h
"
enum
GrSLType
{
kVoid_GrSLType
kFloat_GrSLType
kVec2f_GrSLType
kVec3f_GrSLType
kVec4f_GrSLType
kMat33f_GrSLType
kMat44f_GrSLType
kSampler2D_GrSLType
kSamplerExternal_GrSLType
kLast_GrSLType
=
kSamplerExternal_GrSLType
}
;
static
const
int
kGrSLTypeCount
=
kLast_GrSLType
+
1
;
enum
GrShaderType
{
kVertex_GrShaderType
kGeometry_GrShaderType
kFragment_GrShaderType
kLastkFragment_GrShaderType
=
kFragment_GrShaderType
}
;
static
const
int
kGrShaderTypeCount
=
kLastkFragment_GrShaderType
+
1
;
enum
GrSLPrecision
{
kLow_GrSLPrecision
kMedium_GrSLPrecision
kHigh_GrSLPrecision
kDefault_GrSLPrecision
=
kMedium_GrSLPrecision
kLast_GrSLPrecision
=
kHigh_GrSLPrecision
}
;
static
const
int
kGrSLPrecisionCount
=
kLast_GrSLPrecision
+
1
;
static
inline
int
GrSLTypeVectorCount
(
GrSLType
type
)
{
SkASSERT
(
type
>
=
0
&
&
type
<
static_cast
<
GrSLType
>
(
kGrSLTypeCount
)
)
;
static
const
int
kCounts
[
]
=
{
-
1
1
2
3
4
-
1
-
1
-
1
-
1
}
;
return
kCounts
[
type
]
;
GR_STATIC_ASSERT
(
0
=
=
kVoid_GrSLType
)
;
GR_STATIC_ASSERT
(
1
=
=
kFloat_GrSLType
)
;
GR_STATIC_ASSERT
(
2
=
=
kVec2f_GrSLType
)
;
GR_STATIC_ASSERT
(
3
=
=
kVec3f_GrSLType
)
;
GR_STATIC_ASSERT
(
4
=
=
kVec4f_GrSLType
)
;
GR_STATIC_ASSERT
(
5
=
=
kMat33f_GrSLType
)
;
GR_STATIC_ASSERT
(
6
=
=
kMat44f_GrSLType
)
;
GR_STATIC_ASSERT
(
7
=
=
kSampler2D_GrSLType
)
;
GR_STATIC_ASSERT
(
8
=
=
kSamplerExternal_GrSLType
)
;
GR_STATIC_ASSERT
(
SK_ARRAY_COUNT
(
kCounts
)
=
=
kGrSLTypeCount
)
;
}
static
inline
GrSLType
GrSLFloatVectorType
(
int
count
)
{
SkASSERT
(
count
>
0
&
&
count
<
=
4
)
;
return
(
GrSLType
)
(
count
)
;
GR_STATIC_ASSERT
(
kFloat_GrSLType
=
=
1
)
;
GR_STATIC_ASSERT
(
kVec2f_GrSLType
=
=
2
)
;
GR_STATIC_ASSERT
(
kVec3f_GrSLType
=
=
3
)
;
GR_STATIC_ASSERT
(
kVec4f_GrSLType
=
=
4
)
;
}
static
inline
bool
GrSLTypeIsFloatType
(
GrSLType
type
)
{
SkASSERT
(
type
>
=
0
&
&
type
<
static_cast
<
GrSLType
>
(
kGrSLTypeCount
)
)
;
return
type
>
=
1
&
&
type
<
=
6
;
GR_STATIC_ASSERT
(
0
=
=
kVoid_GrSLType
)
;
GR_STATIC_ASSERT
(
1
=
=
kFloat_GrSLType
)
;
GR_STATIC_ASSERT
(
2
=
=
kVec2f_GrSLType
)
;
GR_STATIC_ASSERT
(
3
=
=
kVec3f_GrSLType
)
;
GR_STATIC_ASSERT
(
4
=
=
kVec4f_GrSLType
)
;
GR_STATIC_ASSERT
(
5
=
=
kMat33f_GrSLType
)
;
GR_STATIC_ASSERT
(
6
=
=
kMat44f_GrSLType
)
;
GR_STATIC_ASSERT
(
7
=
=
kSampler2D_GrSLType
)
;
GR_STATIC_ASSERT
(
8
=
=
kSamplerExternal_GrSLType
)
;
GR_STATIC_ASSERT
(
9
=
=
kGrSLTypeCount
)
;
}
enum
GrVertexAttribType
{
kFloat_GrVertexAttribType
=
0
kVec2f_GrVertexAttribType
kVec3f_GrVertexAttribType
kVec4f_GrVertexAttribType
kUByte_GrVertexAttribType
kVec4ub_GrVertexAttribType
kVec2s_GrVertexAttribType
kLast_GrVertexAttribType
=
kVec2s_GrVertexAttribType
}
;
static
const
int
kGrVertexAttribTypeCount
=
kLast_GrVertexAttribType
+
1
;
static
inline
int
GrVertexAttribTypeVectorCount
(
GrVertexAttribType
type
)
{
SkASSERT
(
type
>
=
0
&
&
type
<
kGrVertexAttribTypeCount
)
;
static
const
int
kCounts
[
]
=
{
1
2
3
4
1
4
2
}
;
return
kCounts
[
type
]
;
GR_STATIC_ASSERT
(
0
=
=
kFloat_GrVertexAttribType
)
;
GR_STATIC_ASSERT
(
1
=
=
kVec2f_GrVertexAttribType
)
;
GR_STATIC_ASSERT
(
2
=
=
kVec3f_GrVertexAttribType
)
;
GR_STATIC_ASSERT
(
3
=
=
kVec4f_GrVertexAttribType
)
;
GR_STATIC_ASSERT
(
4
=
=
kUByte_GrVertexAttribType
)
;
GR_STATIC_ASSERT
(
5
=
=
kVec4ub_GrVertexAttribType
)
;
GR_STATIC_ASSERT
(
6
=
=
kVec2s_GrVertexAttribType
)
;
GR_STATIC_ASSERT
(
SK_ARRAY_COUNT
(
kCounts
)
=
=
kGrVertexAttribTypeCount
)
;
}
static
inline
size_t
GrVertexAttribTypeSize
(
GrVertexAttribType
type
)
{
SkASSERT
(
type
>
=
0
&
&
type
<
kGrVertexAttribTypeCount
)
;
static
const
size_t
kSizes
[
]
=
{
sizeof
(
float
)
2
*
sizeof
(
float
)
3
*
sizeof
(
float
)
4
*
sizeof
(
float
)
1
*
sizeof
(
char
)
4
*
sizeof
(
char
)
2
*
sizeof
(
int16_t
)
}
;
return
kSizes
[
type
]
;
GR_STATIC_ASSERT
(
0
=
=
kFloat_GrVertexAttribType
)
;
GR_STATIC_ASSERT
(
1
=
=
kVec2f_GrVertexAttribType
)
;
GR_STATIC_ASSERT
(
2
=
=
kVec3f_GrVertexAttribType
)
;
GR_STATIC_ASSERT
(
3
=
=
kVec4f_GrVertexAttribType
)
;
GR_STATIC_ASSERT
(
4
=
=
kUByte_GrVertexAttribType
)
;
GR_STATIC_ASSERT
(
5
=
=
kVec4ub_GrVertexAttribType
)
;
GR_STATIC_ASSERT
(
6
=
=
kVec2s_GrVertexAttribType
)
;
GR_STATIC_ASSERT
(
SK_ARRAY_COUNT
(
kSizes
)
=
=
kGrVertexAttribTypeCount
)
;
}
static
inline
GrSLType
GrVertexAttribTypeToSLType
(
GrVertexAttribType
type
)
{
switch
(
type
)
{
default
:
SkFAIL
(
"
Unsupported
type
conversion
"
)
;
case
kUByte_GrVertexAttribType
:
case
kFloat_GrVertexAttribType
:
return
kFloat_GrSLType
;
case
kVec2s_GrVertexAttribType
:
case
kVec2f_GrVertexAttribType
:
return
kVec2f_GrSLType
;
case
kVec3f_GrVertexAttribType
:
return
kVec3f_GrSLType
;
case
kVec4ub_GrVertexAttribType
:
case
kVec4f_GrVertexAttribType
:
return
kVec4f_GrSLType
;
}
}
enum
GrPrimitiveEdgeType
{
kFillBW_GrProcessorEdgeType
kFillAA_GrProcessorEdgeType
kInverseFillBW_GrProcessorEdgeType
kInverseFillAA_GrProcessorEdgeType
kHairlineAA_GrProcessorEdgeType
kLast_GrProcessorEdgeType
=
kHairlineAA_GrProcessorEdgeType
}
;
static
const
int
kGrProcessorEdgeTypeCnt
=
kLast_GrProcessorEdgeType
+
1
;
static
inline
bool
GrProcessorEdgeTypeIsFill
(
const
GrPrimitiveEdgeType
edgeType
)
{
return
(
kFillAA_GrProcessorEdgeType
=
=
edgeType
|
|
kFillBW_GrProcessorEdgeType
=
=
edgeType
)
;
}
static
inline
bool
GrProcessorEdgeTypeIsInverseFill
(
const
GrPrimitiveEdgeType
edgeType
)
{
return
(
kInverseFillAA_GrProcessorEdgeType
=
=
edgeType
|
|
kInverseFillBW_GrProcessorEdgeType
=
=
edgeType
)
;
}
static
inline
bool
GrProcessorEdgeTypeIsAA
(
const
GrPrimitiveEdgeType
edgeType
)
{
return
(
kFillBW_GrProcessorEdgeType
!
=
edgeType
&
&
kInverseFillBW_GrProcessorEdgeType
!
=
edgeType
)
;
}
static
inline
GrPrimitiveEdgeType
GrInvertProcessorEdgeType
(
const
GrPrimitiveEdgeType
edgeType
)
{
switch
(
edgeType
)
{
case
kFillBW_GrProcessorEdgeType
:
return
kInverseFillBW_GrProcessorEdgeType
;
case
kFillAA_GrProcessorEdgeType
:
return
kInverseFillAA_GrProcessorEdgeType
;
case
kInverseFillBW_GrProcessorEdgeType
:
return
kFillBW_GrProcessorEdgeType
;
case
kInverseFillAA_GrProcessorEdgeType
:
return
kFillAA_GrProcessorEdgeType
;
case
kHairlineAA_GrProcessorEdgeType
:
SkFAIL
(
"
Hairline
fill
isn
'
t
invertible
.
"
)
;
}
return
kFillAA_GrProcessorEdgeType
;
}
enum
GrIOType
{
kRead_GrIOType
kWrite_GrIOType
kRW_GrIOType
}
;
struct
GrScissorState
{
GrScissorState
(
)
:
fEnabled
(
false
)
{
}
void
set
(
const
SkIRect
&
rect
)
{
fRect
=
rect
;
fEnabled
=
true
;
}
bool
operator
=
=
(
const
GrScissorState
&
other
)
const
{
return
fEnabled
=
=
other
.
fEnabled
&
&
(
false
=
=
fEnabled
|
|
fRect
=
=
other
.
fRect
)
;
}
bool
operator
!
=
(
const
GrScissorState
&
other
)
const
{
return
!
(
*
this
=
=
other
)
;
}
bool
enabled
(
)
const
{
return
fEnabled
;
}
const
SkIRect
&
rect
(
)
const
{
return
fRect
;
}
private
:
bool
fEnabled
;
SkIRect
fRect
;
}
;
#
ifdef
SK_DEBUG
#
define
GrCapsDebugf
(
caps
.
.
.
)
\
if
(
!
caps
-
>
suppressPrints
(
)
)
{
\
SkDebugf
(
__VA_ARGS__
)
;
\
}
#
else
#
define
GrCapsDebugf
(
caps
.
.
.
)
#
endif
#
endif
