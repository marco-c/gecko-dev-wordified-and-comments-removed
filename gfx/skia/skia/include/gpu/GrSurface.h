#
ifndef
GrSurface_DEFINED
#
define
GrSurface_DEFINED
#
include
"
GrTypes
.
h
"
#
include
"
GrGpuResource
.
h
"
#
include
"
SkImageInfo
.
h
"
#
include
"
SkRect
.
h
"
class
GrRenderTarget
;
class
GrSurfacePriv
;
class
GrTexture
;
class
SK_API
GrSurface
:
public
GrGpuResource
{
public
:
int
width
(
)
const
{
return
fDesc
.
fWidth
;
}
int
height
(
)
const
{
return
fDesc
.
fHeight
;
}
SkRect
getBoundsRect
(
)
const
{
return
SkRect
:
:
MakeIWH
(
this
-
>
width
(
)
this
-
>
height
(
)
)
;
}
GrSurfaceOrigin
origin
(
)
const
{
SkASSERT
(
kTopLeft_GrSurfaceOrigin
=
=
fDesc
.
fOrigin
|
|
kBottomLeft_GrSurfaceOrigin
=
=
fDesc
.
fOrigin
)
;
return
fDesc
.
fOrigin
;
}
GrPixelConfig
config
(
)
const
{
return
fDesc
.
fConfig
;
}
const
GrSurfaceDesc
&
desc
(
)
const
{
return
fDesc
;
}
virtual
GrTexture
*
asTexture
(
)
{
return
NULL
;
}
virtual
const
GrTexture
*
asTexture
(
)
const
{
return
NULL
;
}
virtual
GrRenderTarget
*
asRenderTarget
(
)
{
return
NULL
;
}
virtual
const
GrRenderTarget
*
asRenderTarget
(
)
const
{
return
NULL
;
}
bool
readPixels
(
int
left
int
top
int
width
int
height
GrPixelConfig
config
void
*
buffer
size_t
rowBytes
=
0
uint32_t
pixelOpsFlags
=
0
)
;
bool
writePixels
(
int
left
int
top
int
width
int
height
GrPixelConfig
config
const
void
*
buffer
size_t
rowBytes
=
0
uint32_t
pixelOpsFlags
=
0
)
;
void
flushWrites
(
)
;
inline
GrSurfacePriv
surfacePriv
(
)
;
inline
const
GrSurfacePriv
surfacePriv
(
)
const
;
typedef
void
*
ReleaseCtx
;
typedef
void
(
*
ReleaseProc
)
(
ReleaseCtx
)
;
void
setRelease
(
ReleaseProc
proc
ReleaseCtx
ctx
)
{
fReleaseProc
=
proc
;
fReleaseCtx
=
ctx
;
}
static
size_t
WorstCaseSize
(
const
GrSurfaceDesc
&
desc
)
;
protected
:
bool
savePixels
(
const
char
*
filename
)
;
bool
hasPendingRead
(
)
const
;
bool
hasPendingWrite
(
)
const
;
bool
hasPendingIO
(
)
const
;
friend
class
GrSurfacePriv
;
GrSurface
(
GrGpu
*
gpu
const
GrSurfaceDesc
&
desc
)
:
INHERITED
(
gpu
)
fDesc
(
desc
)
fReleaseProc
(
NULL
)
fReleaseCtx
(
NULL
)
{
}
~
GrSurface
(
)
override
{
SkASSERT
(
NULL
=
=
fReleaseProc
)
;
}
GrSurfaceDesc
fDesc
;
void
onRelease
(
)
override
;
void
onAbandon
(
)
override
;
private
:
void
invokeReleaseProc
(
)
{
if
(
fReleaseProc
)
{
fReleaseProc
(
fReleaseCtx
)
;
fReleaseProc
=
NULL
;
}
}
ReleaseProc
fReleaseProc
;
ReleaseCtx
fReleaseCtx
;
typedef
GrGpuResource
INHERITED
;
}
;
#
endif
