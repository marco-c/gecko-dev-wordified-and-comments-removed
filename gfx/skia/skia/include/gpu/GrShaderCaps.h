#
ifndef
GrShaderCaps_DEFINED
#
define
GrShaderCaps_DEFINED
#
include
"
.
.
/
private
/
GrSwizzle
.
h
"
#
include
"
.
.
/
private
/
GrGLSL
.
h
"
namespace
SkSL
{
class
ShaderCapsFactory
;
}
struct
GrContextOptions
;
class
GrShaderCaps
:
public
SkRefCnt
{
public
:
struct
PrecisionInfo
{
PrecisionInfo
(
)
{
fLogRangeLow
=
0
;
fLogRangeHigh
=
0
;
fBits
=
0
;
}
bool
supported
(
)
const
{
return
0
!
=
fBits
;
}
bool
operator
=
=
(
const
PrecisionInfo
&
that
)
const
{
return
fLogRangeLow
=
=
that
.
fLogRangeLow
&
&
fLogRangeHigh
=
=
that
.
fLogRangeHigh
&
&
fBits
=
=
that
.
fBits
;
}
bool
operator
!
=
(
const
PrecisionInfo
&
that
)
const
{
return
!
(
*
this
=
=
that
)
;
}
int
fLogRangeLow
;
int
fLogRangeHigh
;
int
fBits
;
}
;
enum
AdvBlendEqInteraction
{
kNotSupported_AdvBlendEqInteraction
kAutomatic_AdvBlendEqInteraction
kGeneralEnable_AdvBlendEqInteraction
kSpecificEnables_AdvBlendEqInteraction
kLast_AdvBlendEqInteraction
=
kSpecificEnables_AdvBlendEqInteraction
}
;
GrShaderCaps
(
const
GrContextOptions
&
)
;
SkString
dump
(
)
const
;
bool
shaderDerivativeSupport
(
)
const
{
return
fShaderDerivativeSupport
;
}
bool
geometryShaderSupport
(
)
const
{
return
fGeometryShaderSupport
;
}
bool
pathRenderingSupport
(
)
const
{
return
fPathRenderingSupport
;
}
bool
dstReadInShaderSupport
(
)
const
{
return
fDstReadInShaderSupport
;
}
bool
dualSourceBlendingSupport
(
)
const
{
return
fDualSourceBlendingSupport
;
}
bool
integerSupport
(
)
const
{
return
fIntegerSupport
;
}
bool
texelBufferSupport
(
)
const
{
return
fTexelBufferSupport
;
}
int
imageLoadStoreSupport
(
)
const
{
return
fImageLoadStoreSupport
;
}
const
PrecisionInfo
&
getFloatShaderPrecisionInfo
(
GrShaderType
shaderType
GrSLPrecision
precision
)
const
{
return
fFloatPrecisions
[
shaderType
]
[
precision
]
;
}
bool
floatPrecisionVaries
(
)
const
{
return
fShaderPrecisionVaries
;
}
bool
fbFetchSupport
(
)
const
{
return
fFBFetchSupport
;
}
bool
fbFetchNeedsCustomOutput
(
)
const
{
return
fFBFetchNeedsCustomOutput
;
}
bool
bindlessTextureSupport
(
)
const
{
return
fBindlessTextureSupport
;
}
const
char
*
versionDeclString
(
)
const
{
return
fVersionDeclString
;
}
const
char
*
fbFetchColorName
(
)
const
{
return
fFBFetchColorName
;
}
const
char
*
fbFetchExtensionString
(
)
const
{
return
fFBFetchExtensionString
;
}
bool
dropsTileOnZeroDivide
(
)
const
{
return
fDropsTileOnZeroDivide
;
}
bool
flatInterpolationSupport
(
)
const
{
return
fFlatInterpolationSupport
;
}
bool
noperspectiveInterpolationSupport
(
)
const
{
return
fNoPerspectiveInterpolationSupport
;
}
bool
multisampleInterpolationSupport
(
)
const
{
return
fMultisampleInterpolationSupport
;
}
bool
sampleVariablesSupport
(
)
const
{
return
fSampleVariablesSupport
;
}
bool
sampleMaskOverrideCoverageSupport
(
)
const
{
return
fSampleMaskOverrideCoverageSupport
;
}
bool
externalTextureSupport
(
)
const
{
return
fExternalTextureSupport
;
}
bool
texelFetchSupport
(
)
const
{
return
fTexelFetchSupport
;
}
AdvBlendEqInteraction
advBlendEqInteraction
(
)
const
{
return
fAdvBlendEqInteraction
;
}
bool
mustEnableAdvBlendEqs
(
)
const
{
return
fAdvBlendEqInteraction
>
=
kGeneralEnable_AdvBlendEqInteraction
;
}
bool
mustEnableSpecificAdvBlendEqs
(
)
const
{
return
fAdvBlendEqInteraction
=
=
kSpecificEnables_AdvBlendEqInteraction
;
}
bool
mustDeclareFragmentShaderOutput
(
)
const
{
return
fGLSLGeneration
>
k110_GrGLSLGeneration
;
}
bool
usesPrecisionModifiers
(
)
const
{
return
fUsesPrecisionModifiers
;
}
bool
canUseAnyFunctionInShader
(
)
const
{
return
fCanUseAnyFunctionInShader
;
}
bool
canUseMinAndAbsTogether
(
)
const
{
return
fCanUseMinAndAbsTogether
;
}
bool
mustForceNegatedAtanParamToFloat
(
)
const
{
return
fMustForceNegatedAtanParamToFloat
;
}
bool
atan2ImplementedAsAtanYOverX
(
)
const
{
return
fAtan2ImplementedAsAtanYOverX
;
}
bool
requiresLocalOutputColorForFBFetch
(
)
const
{
return
fRequiresLocalOutputColorForFBFetch
;
}
bool
mustImplementGSInvocationsWithLoop
(
)
const
{
return
fMustImplementGSInvocationsWithLoop
;
}
const
char
*
shaderDerivativeExtensionString
(
)
const
{
SkASSERT
(
this
-
>
shaderDerivativeSupport
(
)
)
;
return
fShaderDerivativeExtensionString
;
}
const
char
*
fragCoordConventionsExtensionString
(
)
const
{
return
fFragCoordConventionsExtensionString
;
}
const
char
*
secondaryOutputExtensionString
(
)
const
{
return
fSecondaryOutputExtensionString
;
}
const
char
*
externalTextureExtensionString
(
)
const
{
SkASSERT
(
this
-
>
externalTextureSupport
(
)
)
;
return
fExternalTextureExtensionString
;
}
const
char
*
texelBufferExtensionString
(
)
const
{
SkASSERT
(
this
-
>
texelBufferSupport
(
)
)
;
return
fTexelBufferExtensionString
;
}
const
char
*
noperspectiveInterpolationExtensionString
(
)
const
{
SkASSERT
(
this
-
>
noperspectiveInterpolationSupport
(
)
)
;
return
fNoPerspectiveInterpolationExtensionString
;
}
const
char
*
multisampleInterpolationExtensionString
(
)
const
{
SkASSERT
(
this
-
>
multisampleInterpolationSupport
(
)
)
;
return
fMultisampleInterpolationExtensionString
;
}
const
char
*
sampleVariablesExtensionString
(
)
const
{
SkASSERT
(
this
-
>
sampleVariablesSupport
(
)
)
;
return
fSampleVariablesExtensionString
;
}
const
char
*
imageLoadStoreExtensionString
(
)
const
{
SkASSERT
(
this
-
>
imageLoadStoreSupport
(
)
)
;
return
fImageLoadStoreExtensionString
;
}
int
maxVertexSamplers
(
)
const
{
return
fMaxVertexSamplers
;
}
int
maxGeometrySamplers
(
)
const
{
return
fMaxGeometrySamplers
;
}
int
maxFragmentSamplers
(
)
const
{
return
fMaxFragmentSamplers
;
}
int
maxCombinedSamplers
(
)
const
{
return
fMaxCombinedSamplers
;
}
int
maxVertexImageStorages
(
)
const
{
return
fMaxVertexImageStorages
;
}
int
maxGeometryImageStorages
(
)
const
{
return
fMaxGeometryImageStorages
;
}
int
maxFragmentImageStorages
(
)
const
{
return
fMaxFragmentImageStorages
;
}
int
maxCombinedImageStorages
(
)
const
{
return
fMaxCombinedImageStorages
;
}
const
GrSwizzle
&
configTextureSwizzle
(
GrPixelConfig
config
)
const
{
return
fConfigTextureSwizzle
[
config
]
;
}
const
GrSwizzle
&
configOutputSwizzle
(
GrPixelConfig
config
)
const
{
return
fConfigOutputSwizzle
[
config
]
;
}
GrSLPrecision
samplerPrecision
(
GrPixelConfig
config
GrShaderFlags
visibility
)
const
{
return
static_cast
<
GrSLPrecision
>
(
fSamplerPrecisions
[
visibility
]
[
config
]
)
;
}
GrGLSLGeneration
generation
(
)
const
{
return
fGLSLGeneration
;
}
private
:
void
initSamplerPrecisionTable
(
)
;
void
applyOptionsOverrides
(
const
GrContextOptions
&
options
)
;
GrGLSLGeneration
fGLSLGeneration
;
bool
fShaderDerivativeSupport
:
1
;
bool
fGeometryShaderSupport
:
1
;
bool
fPathRenderingSupport
:
1
;
bool
fDstReadInShaderSupport
:
1
;
bool
fDualSourceBlendingSupport
:
1
;
bool
fIntegerSupport
:
1
;
bool
fTexelBufferSupport
:
1
;
bool
fImageLoadStoreSupport
:
1
;
bool
fShaderPrecisionVaries
:
1
;
bool
fDropsTileOnZeroDivide
:
1
;
bool
fFBFetchSupport
:
1
;
bool
fFBFetchNeedsCustomOutput
:
1
;
bool
fBindlessTextureSupport
:
1
;
bool
fUsesPrecisionModifiers
:
1
;
bool
fCanUseAnyFunctionInShader
:
1
;
bool
fFlatInterpolationSupport
:
1
;
bool
fNoPerspectiveInterpolationSupport
:
1
;
bool
fMultisampleInterpolationSupport
:
1
;
bool
fSampleVariablesSupport
:
1
;
bool
fSampleMaskOverrideCoverageSupport
:
1
;
bool
fExternalTextureSupport
:
1
;
bool
fTexelFetchSupport
:
1
;
bool
fCanUseMinAndAbsTogether
:
1
;
bool
fMustForceNegatedAtanParamToFloat
:
1
;
bool
fAtan2ImplementedAsAtanYOverX
:
1
;
bool
fRequiresLocalOutputColorForFBFetch
:
1
;
bool
fMustImplementGSInvocationsWithLoop
:
1
;
PrecisionInfo
fFloatPrecisions
[
kGrShaderTypeCount
]
[
kGrSLPrecisionCount
]
;
const
char
*
fVersionDeclString
;
const
char
*
fShaderDerivativeExtensionString
;
const
char
*
fFragCoordConventionsExtensionString
;
const
char
*
fSecondaryOutputExtensionString
;
const
char
*
fExternalTextureExtensionString
;
const
char
*
fTexelBufferExtensionString
;
const
char
*
fNoPerspectiveInterpolationExtensionString
;
const
char
*
fMultisampleInterpolationExtensionString
;
const
char
*
fSampleVariablesExtensionString
;
const
char
*
fImageLoadStoreExtensionString
;
const
char
*
fFBFetchColorName
;
const
char
*
fFBFetchExtensionString
;
int
fMaxVertexSamplers
;
int
fMaxGeometrySamplers
;
int
fMaxFragmentSamplers
;
int
fMaxCombinedSamplers
;
int
fMaxVertexImageStorages
;
int
fMaxGeometryImageStorages
;
int
fMaxFragmentImageStorages
;
int
fMaxCombinedImageStorages
;
AdvBlendEqInteraction
fAdvBlendEqInteraction
;
GrSwizzle
fConfigTextureSwizzle
[
kGrPixelConfigCnt
]
;
GrSwizzle
fConfigOutputSwizzle
[
kGrPixelConfigCnt
]
;
uint8_t
fSamplerPrecisions
[
(
1
<
<
kGrShaderTypeCount
)
]
[
kGrPixelConfigCnt
]
;
friend
class
GrGLCaps
;
friend
class
GrVkCaps
;
friend
class
SkSL
:
:
ShaderCapsFactory
;
}
;
#
endif
