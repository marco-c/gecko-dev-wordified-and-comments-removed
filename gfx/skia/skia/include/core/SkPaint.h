#
ifndef
SkPaint_DEFINED
#
define
SkPaint_DEFINED
#
include
"
SkBlendMode
.
h
"
#
include
"
SkColor
.
h
"
#
include
"
SkFilterQuality
.
h
"
#
include
"
SkMatrix
.
h
"
#
include
"
SkRefCnt
.
h
"
class
SkAutoDescriptor
;
class
SkAutoGlyphCache
;
class
SkColorFilter
;
class
SkData
;
class
SkDescriptor
;
class
SkDrawLooper
;
class
SkReadBuffer
;
class
SkWriteBuffer
;
class
SkGlyph
;
struct
SkRect
;
class
SkGlyphCache
;
class
SkImageFilter
;
class
SkMaskFilter
;
class
SkPath
;
class
SkPathEffect
;
struct
SkPoint
;
class
SkRasterizer
;
struct
SkScalerContextEffects
;
class
SkShader
;
class
SkSurfaceProps
;
class
SkTextBlob
;
class
SkTypeface
;
class
SK_API
SkPaint
{
public
:
SkPaint
(
)
;
SkPaint
(
const
SkPaint
&
paint
)
;
SkPaint
(
SkPaint
&
&
paint
)
;
~
SkPaint
(
)
;
SkPaint
&
operator
=
(
const
SkPaint
&
)
;
SkPaint
&
operator
=
(
SkPaint
&
&
)
;
SK_API
friend
bool
operator
=
=
(
const
SkPaint
&
a
const
SkPaint
&
b
)
;
friend
bool
operator
!
=
(
const
SkPaint
&
a
const
SkPaint
&
b
)
{
return
!
(
a
=
=
b
)
;
}
uint32_t
getHash
(
)
const
;
void
flatten
(
SkWriteBuffer
&
)
const
;
void
unflatten
(
SkReadBuffer
&
)
;
void
reset
(
)
;
enum
Hinting
{
kNo_Hinting
=
0
kSlight_Hinting
=
1
kNormal_Hinting
=
2
kFull_Hinting
=
3
}
;
Hinting
getHinting
(
)
const
{
return
static_cast
<
Hinting
>
(
fBitfields
.
fHinting
)
;
}
void
setHinting
(
Hinting
hintingLevel
)
;
enum
Flags
{
kAntiAlias_Flag
=
0x01
kDither_Flag
=
0x04
kFakeBoldText_Flag
=
0x20
kLinearText_Flag
=
0x40
kSubpixelText_Flag
=
0x80
kDevKernText_Flag
=
0x100
kLCDRenderText_Flag
=
0x200
kEmbeddedBitmapText_Flag
=
0x400
kAutoHinting_Flag
=
0x800
kVerticalText_Flag
=
0x1000
kGenA8FromLCD_Flag
=
0x2000
kAllFlags
=
0xFFFF
}
;
#
ifdef
SK_BUILD_FOR_ANDROID_FRAMEWORK
enum
ReserveFlags
{
kUnderlineText_ReserveFlag
=
0x08
kStrikeThruText_ReserveFlag
=
0x10
}
;
#
endif
uint32_t
getFlags
(
)
const
{
return
fBitfields
.
fFlags
;
}
void
setFlags
(
uint32_t
flags
)
;
bool
isAntiAlias
(
)
const
{
return
SkToBool
(
this
-
>
getFlags
(
)
&
kAntiAlias_Flag
)
;
}
void
setAntiAlias
(
bool
aa
)
;
bool
isDither
(
)
const
{
return
SkToBool
(
this
-
>
getFlags
(
)
&
kDither_Flag
)
;
}
void
setDither
(
bool
dither
)
;
bool
isLinearText
(
)
const
{
return
SkToBool
(
this
-
>
getFlags
(
)
&
kLinearText_Flag
)
;
}
void
setLinearText
(
bool
linearText
)
;
bool
isSubpixelText
(
)
const
{
return
SkToBool
(
this
-
>
getFlags
(
)
&
kSubpixelText_Flag
)
;
}
void
setSubpixelText
(
bool
subpixelText
)
;
bool
isLCDRenderText
(
)
const
{
return
SkToBool
(
this
-
>
getFlags
(
)
&
kLCDRenderText_Flag
)
;
}
void
setLCDRenderText
(
bool
lcdText
)
;
bool
isEmbeddedBitmapText
(
)
const
{
return
SkToBool
(
this
-
>
getFlags
(
)
&
kEmbeddedBitmapText_Flag
)
;
}
void
setEmbeddedBitmapText
(
bool
useEmbeddedBitmapText
)
;
bool
isAutohinted
(
)
const
{
return
SkToBool
(
this
-
>
getFlags
(
)
&
kAutoHinting_Flag
)
;
}
void
setAutohinted
(
bool
useAutohinter
)
;
bool
isVerticalText
(
)
const
{
return
SkToBool
(
this
-
>
getFlags
(
)
&
kVerticalText_Flag
)
;
}
void
setVerticalText
(
bool
)
;
bool
isFakeBoldText
(
)
const
{
return
SkToBool
(
this
-
>
getFlags
(
)
&
kFakeBoldText_Flag
)
;
}
void
setFakeBoldText
(
bool
fakeBoldText
)
;
bool
isDevKernText
(
)
const
{
return
SkToBool
(
this
-
>
getFlags
(
)
&
kDevKernText_Flag
)
;
}
void
setDevKernText
(
bool
devKernText
)
;
SkFilterQuality
getFilterQuality
(
)
const
{
return
(
SkFilterQuality
)
fBitfields
.
fFilterQuality
;
}
void
setFilterQuality
(
SkFilterQuality
quality
)
;
enum
Style
{
kFill_Style
kStroke_Style
kStrokeAndFill_Style
}
;
enum
{
kStyleCount
=
kStrokeAndFill_Style
+
1
}
;
Style
getStyle
(
)
const
{
return
(
Style
)
fBitfields
.
fStyle
;
}
void
setStyle
(
Style
style
)
;
SkColor
getColor
(
)
const
{
return
fColor
;
}
void
setColor
(
SkColor
color
)
;
uint8_t
getAlpha
(
)
const
{
return
SkToU8
(
SkColorGetA
(
fColor
)
)
;
}
void
setAlpha
(
U8CPU
a
)
;
void
setARGB
(
U8CPU
a
U8CPU
r
U8CPU
g
U8CPU
b
)
;
SkScalar
getStrokeWidth
(
)
const
{
return
fWidth
;
}
void
setStrokeWidth
(
SkScalar
width
)
;
SkScalar
getStrokeMiter
(
)
const
{
return
fMiterLimit
;
}
void
setStrokeMiter
(
SkScalar
miter
)
;
enum
Cap
{
kButt_Cap
kRound_Cap
kSquare_Cap
kLast_Cap
=
kSquare_Cap
kDefault_Cap
=
kButt_Cap
}
;
static
constexpr
int
kCapCount
=
kLast_Cap
+
1
;
enum
Join
{
kMiter_Join
kRound_Join
kBevel_Join
kLast_Join
=
kBevel_Join
kDefault_Join
=
kMiter_Join
}
;
static
constexpr
int
kJoinCount
=
kLast_Join
+
1
;
Cap
getStrokeCap
(
)
const
{
return
(
Cap
)
fBitfields
.
fCapType
;
}
void
setStrokeCap
(
Cap
cap
)
;
Join
getStrokeJoin
(
)
const
{
return
(
Join
)
fBitfields
.
fJoinType
;
}
void
setStrokeJoin
(
Join
join
)
;
bool
getFillPath
(
const
SkPath
&
src
SkPath
*
dst
const
SkRect
*
cullRect
SkScalar
resScale
=
1
)
const
;
bool
getFillPath
(
const
SkPath
&
src
SkPath
*
dst
)
const
{
return
this
-
>
getFillPath
(
src
dst
NULL
1
)
;
}
SkShader
*
getShader
(
)
const
{
return
fShader
.
get
(
)
;
}
sk_sp
<
SkShader
>
refShader
(
)
const
;
void
setShader
(
sk_sp
<
SkShader
>
)
;
SkColorFilter
*
getColorFilter
(
)
const
{
return
fColorFilter
.
get
(
)
;
}
sk_sp
<
SkColorFilter
>
refColorFilter
(
)
const
;
void
setColorFilter
(
sk_sp
<
SkColorFilter
>
)
;
SkBlendMode
getBlendMode
(
)
const
{
return
(
SkBlendMode
)
fBlendMode
;
}
bool
isSrcOver
(
)
const
{
return
(
SkBlendMode
)
fBlendMode
=
=
SkBlendMode
:
:
kSrcOver
;
}
void
setBlendMode
(
SkBlendMode
mode
)
{
fBlendMode
=
(
unsigned
)
mode
;
}
SkPathEffect
*
getPathEffect
(
)
const
{
return
fPathEffect
.
get
(
)
;
}
sk_sp
<
SkPathEffect
>
refPathEffect
(
)
const
;
void
setPathEffect
(
sk_sp
<
SkPathEffect
>
)
;
SkMaskFilter
*
getMaskFilter
(
)
const
{
return
fMaskFilter
.
get
(
)
;
}
sk_sp
<
SkMaskFilter
>
refMaskFilter
(
)
const
;
void
setMaskFilter
(
sk_sp
<
SkMaskFilter
>
)
;
SkTypeface
*
getTypeface
(
)
const
{
return
fTypeface
.
get
(
)
;
}
sk_sp
<
SkTypeface
>
refTypeface
(
)
const
;
void
setTypeface
(
sk_sp
<
SkTypeface
>
)
;
SkRasterizer
*
getRasterizer
(
)
const
{
return
fRasterizer
.
get
(
)
;
}
sk_sp
<
SkRasterizer
>
refRasterizer
(
)
const
;
void
setRasterizer
(
sk_sp
<
SkRasterizer
>
)
;
SkImageFilter
*
getImageFilter
(
)
const
{
return
fImageFilter
.
get
(
)
;
}
sk_sp
<
SkImageFilter
>
refImageFilter
(
)
const
;
void
setImageFilter
(
sk_sp
<
SkImageFilter
>
)
;
SkDrawLooper
*
getDrawLooper
(
)
const
{
return
fDrawLooper
.
get
(
)
;
}
sk_sp
<
SkDrawLooper
>
refDrawLooper
(
)
const
;
SkDrawLooper
*
getLooper
(
)
const
{
return
fDrawLooper
.
get
(
)
;
}
void
setDrawLooper
(
sk_sp
<
SkDrawLooper
>
)
;
void
setLooper
(
sk_sp
<
SkDrawLooper
>
)
;
enum
Align
{
kLeft_Align
kCenter_Align
kRight_Align
}
;
enum
{
kAlignCount
=
3
}
;
Align
getTextAlign
(
)
const
{
return
(
Align
)
fBitfields
.
fTextAlign
;
}
void
setTextAlign
(
Align
align
)
;
SkScalar
getTextSize
(
)
const
{
return
fTextSize
;
}
void
setTextSize
(
SkScalar
textSize
)
;
SkScalar
getTextScaleX
(
)
const
{
return
fTextScaleX
;
}
void
setTextScaleX
(
SkScalar
scaleX
)
;
SkScalar
getTextSkewX
(
)
const
{
return
fTextSkewX
;
}
void
setTextSkewX
(
SkScalar
skewX
)
;
enum
TextEncoding
{
kUTF8_TextEncoding
kUTF16_TextEncoding
kUTF32_TextEncoding
kGlyphID_TextEncoding
}
;
TextEncoding
getTextEncoding
(
)
const
{
return
(
TextEncoding
)
fBitfields
.
fTextEncoding
;
}
void
setTextEncoding
(
TextEncoding
encoding
)
;
struct
FontMetrics
{
enum
FontMetricsFlags
{
kUnderlineThicknessIsValid_Flag
=
1
<
<
0
kUnderlinePositionIsValid_Flag
=
1
<
<
1
}
;
uint32_t
fFlags
;
SkScalar
fTop
;
SkScalar
fAscent
;
SkScalar
fDescent
;
SkScalar
fBottom
;
SkScalar
fLeading
;
SkScalar
fAvgCharWidth
;
SkScalar
fMaxCharWidth
;
SkScalar
fXMin
;
SkScalar
fXMax
;
SkScalar
fXHeight
;
SkScalar
fCapHeight
;
SkScalar
fUnderlineThickness
;
SkScalar
fUnderlinePosition
;
bool
hasUnderlineThickness
(
SkScalar
*
thickness
)
const
{
if
(
SkToBool
(
fFlags
&
kUnderlineThicknessIsValid_Flag
)
)
{
*
thickness
=
fUnderlineThickness
;
return
true
;
}
return
false
;
}
bool
hasUnderlinePosition
(
SkScalar
*
position
)
const
{
if
(
SkToBool
(
fFlags
&
kUnderlinePositionIsValid_Flag
)
)
{
*
position
=
fUnderlinePosition
;
return
true
;
}
return
false
;
}
}
;
SkScalar
getFontMetrics
(
FontMetrics
*
metrics
SkScalar
scale
=
0
)
const
;
SkScalar
getFontSpacing
(
)
const
{
return
this
-
>
getFontMetrics
(
NULL
0
)
;
}
int
textToGlyphs
(
const
void
*
text
size_t
byteLength
SkGlyphID
glyphs
[
]
)
const
;
bool
containsText
(
const
void
*
text
size_t
byteLength
)
const
;
void
glyphsToUnichars
(
const
SkGlyphID
glyphs
[
]
int
count
SkUnichar
text
[
]
)
const
;
int
countText
(
const
void
*
text
size_t
byteLength
)
const
{
return
this
-
>
textToGlyphs
(
text
byteLength
NULL
)
;
}
SkScalar
measureText
(
const
void
*
text
size_t
length
SkRect
*
bounds
)
const
;
SkScalar
measureText
(
const
void
*
text
size_t
length
)
const
{
return
this
-
>
measureText
(
text
length
NULL
)
;
}
size_t
breakText
(
const
void
*
text
size_t
length
SkScalar
maxWidth
SkScalar
*
measuredWidth
=
NULL
)
const
;
int
getTextWidths
(
const
void
*
text
size_t
byteLength
SkScalar
widths
[
]
SkRect
bounds
[
]
=
NULL
)
const
;
void
getTextPath
(
const
void
*
text
size_t
length
SkScalar
x
SkScalar
y
SkPath
*
path
)
const
;
void
getPosTextPath
(
const
void
*
text
size_t
length
const
SkPoint
pos
[
]
SkPath
*
path
)
const
;
int
getTextIntercepts
(
const
void
*
text
size_t
length
SkScalar
x
SkScalar
y
const
SkScalar
bounds
[
2
]
SkScalar
*
intervals
)
const
;
int
getPosTextIntercepts
(
const
void
*
text
size_t
length
const
SkPoint
pos
[
]
const
SkScalar
bounds
[
2
]
SkScalar
*
intervals
)
const
;
int
getPosTextHIntercepts
(
const
void
*
text
size_t
length
const
SkScalar
xpos
[
]
SkScalar
constY
const
SkScalar
bounds
[
2
]
SkScalar
*
intervals
)
const
;
int
getTextBlobIntercepts
(
const
SkTextBlob
*
blob
const
SkScalar
bounds
[
2
]
SkScalar
*
intervals
)
const
;
SkRect
getFontBounds
(
)
const
;
bool
nothingToDraw
(
)
const
;
bool
canComputeFastBounds
(
)
const
;
const
SkRect
&
computeFastBounds
(
const
SkRect
&
orig
SkRect
*
storage
)
const
{
SkPaint
:
:
Style
style
=
this
-
>
getStyle
(
)
;
if
(
kFill_Style
=
=
style
)
{
uintptr_t
effects
=
reinterpret_cast
<
uintptr_t
>
(
this
-
>
getLooper
(
)
)
;
effects
|
=
reinterpret_cast
<
uintptr_t
>
(
this
-
>
getMaskFilter
(
)
)
;
effects
|
=
reinterpret_cast
<
uintptr_t
>
(
this
-
>
getPathEffect
(
)
)
;
effects
|
=
reinterpret_cast
<
uintptr_t
>
(
this
-
>
getImageFilter
(
)
)
;
if
(
!
effects
)
{
return
orig
;
}
}
return
this
-
>
doComputeFastBounds
(
orig
storage
style
)
;
}
const
SkRect
&
computeFastStrokeBounds
(
const
SkRect
&
orig
SkRect
*
storage
)
const
{
return
this
-
>
doComputeFastBounds
(
orig
storage
kStroke_Style
)
;
}
const
SkRect
&
doComputeFastBounds
(
const
SkRect
&
orig
SkRect
*
storage
Style
)
const
;
static
SkMatrix
*
SetTextMatrix
(
SkMatrix
*
matrix
SkScalar
size
SkScalar
scaleX
SkScalar
skewX
)
{
matrix
-
>
setScale
(
size
*
scaleX
size
)
;
if
(
skewX
)
{
matrix
-
>
postSkew
(
skewX
0
)
;
}
return
matrix
;
}
SkMatrix
*
setTextMatrix
(
SkMatrix
*
matrix
)
const
{
return
SetTextMatrix
(
matrix
fTextSize
fTextScaleX
fTextSkewX
)
;
}
typedef
const
SkGlyph
&
(
*
GlyphCacheProc
)
(
SkGlyphCache
*
const
char
*
*
)
;
SK_TO_STRING_NONVIRT
(
)
private
:
sk_sp
<
SkTypeface
>
fTypeface
;
sk_sp
<
SkPathEffect
>
fPathEffect
;
sk_sp
<
SkShader
>
fShader
;
sk_sp
<
SkMaskFilter
>
fMaskFilter
;
sk_sp
<
SkColorFilter
>
fColorFilter
;
sk_sp
<
SkRasterizer
>
fRasterizer
;
sk_sp
<
SkDrawLooper
>
fDrawLooper
;
sk_sp
<
SkImageFilter
>
fImageFilter
;
SkScalar
fTextSize
;
SkScalar
fTextScaleX
;
SkScalar
fTextSkewX
;
SkColor
fColor
;
SkScalar
fWidth
;
SkScalar
fMiterLimit
;
uint32_t
fBlendMode
;
union
{
struct
{
unsigned
fFlags
:
16
;
unsigned
fTextAlign
:
2
;
unsigned
fCapType
:
2
;
unsigned
fJoinType
:
2
;
unsigned
fStyle
:
2
;
unsigned
fTextEncoding
:
2
;
unsigned
fHinting
:
2
;
unsigned
fFilterQuality
:
2
;
}
fBitfields
;
uint32_t
fBitfieldsUInt
;
}
;
static
GlyphCacheProc
GetGlyphCacheProc
(
TextEncoding
encoding
bool
isDevKern
bool
needFullMetrics
)
;
SkScalar
measure_text
(
SkGlyphCache
*
const
char
*
text
size_t
length
int
*
count
SkRect
*
bounds
)
const
;
enum
ScalerContextFlags
:
uint32_t
{
kNone_ScalerContextFlags
=
0
kFakeGamma_ScalerContextFlag
=
1
<
<
0
kBoostContrast_ScalerContextFlag
=
1
<
<
1
kFakeGammaAndBoostContrast_ScalerContextFlags
=
kFakeGamma_ScalerContextFlag
|
kBoostContrast_ScalerContextFlag
}
;
void
getScalerContextDescriptor
(
SkScalerContextEffects
*
SkAutoDescriptor
*
const
SkSurfaceProps
&
surfaceProps
uint32_t
scalerContextFlags
const
SkMatrix
*
)
const
;
SkGlyphCache
*
detachCache
(
const
SkSurfaceProps
*
surfaceProps
uint32_t
scalerContextFlags
const
SkMatrix
*
)
const
;
void
descriptorProc
(
const
SkSurfaceProps
*
surfaceProps
uint32_t
scalerContextFlags
const
SkMatrix
*
deviceMatrix
void
(
*
proc
)
(
SkTypeface
*
const
SkScalerContextEffects
&
const
SkDescriptor
*
void
*
)
void
*
context
)
const
;
SkColor
computeLuminanceColor
(
)
const
;
enum
{
kCanonicalTextSizeForPaths
=
64
kMaxSizeForGlyphCache
=
256
}
;
static
bool
TooBigToUseCache
(
const
SkMatrix
&
ctm
const
SkMatrix
&
textM
)
;
SkScalar
setupForAsPaths
(
)
;
static
SkScalar
MaxCacheSize2
(
)
{
static
const
SkScalar
kMaxSize
=
SkIntToScalar
(
kMaxSizeForGlyphCache
)
;
static
const
SkScalar
kMag2Max
=
kMaxSize
*
kMaxSize
;
return
kMag2Max
;
}
friend
class
SkAutoGlyphCache
;
friend
class
SkAutoGlyphCacheNoGamma
;
friend
class
SkCanvas
;
friend
class
SkDraw
;
friend
class
SkPDFDevice
;
friend
class
GrAtlasTextBlob
;
friend
class
GrAtlasTextContext
;
friend
class
GrStencilAndCoverTextContext
;
friend
class
GrPathRendering
;
friend
class
GrTextUtils
;
friend
class
GrGLPathRendering
;
friend
class
SkScalerContext
;
friend
class
SkTextBaseIter
;
friend
class
SkCanonicalizePaint
;
}
;
#
endif
