#
ifndef
SkContourMeasure_DEFINED
#
define
SkContourMeasure_DEFINED
#
include
"
include
/
core
/
SkPath
.
h
"
#
include
"
include
/
core
/
SkRefCnt
.
h
"
#
include
"
include
/
private
/
SkTDArray
.
h
"
struct
SkConic
;
class
SK_API
SkContourMeasure
:
public
SkRefCnt
{
public
:
SkScalar
length
(
)
const
{
return
fLength
;
}
bool
SK_WARN_UNUSED_RESULT
getPosTan
(
SkScalar
distance
SkPoint
*
position
SkVector
*
tangent
)
const
;
enum
MatrixFlags
{
kGetPosition_MatrixFlag
=
0x01
kGetTangent_MatrixFlag
=
0x02
kGetPosAndTan_MatrixFlag
=
kGetPosition_MatrixFlag
|
kGetTangent_MatrixFlag
}
;
bool
SK_WARN_UNUSED_RESULT
getMatrix
(
SkScalar
distance
SkMatrix
*
matrix
MatrixFlags
flags
=
kGetPosAndTan_MatrixFlag
)
const
;
bool
SK_WARN_UNUSED_RESULT
getSegment
(
SkScalar
startD
SkScalar
stopD
SkPath
*
dst
bool
startWithMoveTo
)
const
;
bool
isClosed
(
)
const
{
return
fIsClosed
;
}
private
:
struct
Segment
{
SkScalar
fDistance
;
unsigned
fPtIndex
;
unsigned
fTValue
:
30
;
unsigned
fType
:
2
;
SkScalar
getScalarT
(
)
const
;
static
const
Segment
*
Next
(
const
Segment
*
seg
)
{
unsigned
ptIndex
=
seg
-
>
fPtIndex
;
do
{
+
+
seg
;
}
while
(
seg
-
>
fPtIndex
=
=
ptIndex
)
;
return
seg
;
}
}
;
const
SkTDArray
<
Segment
>
fSegments
;
const
SkTDArray
<
SkPoint
>
fPts
;
const
SkScalar
fLength
;
const
bool
fIsClosed
;
SkContourMeasure
(
SkTDArray
<
Segment
>
&
&
segs
SkTDArray
<
SkPoint
>
&
&
pts
SkScalar
length
bool
isClosed
)
;
~
SkContourMeasure
(
)
override
{
}
const
Segment
*
distanceToSegment
(
SkScalar
distance
SkScalar
*
t
)
const
;
friend
class
SkContourMeasureIter
;
}
;
class
SK_API
SkContourMeasureIter
{
public
:
SkContourMeasureIter
(
)
;
SkContourMeasureIter
(
const
SkPath
&
path
bool
forceClosed
SkScalar
resScale
=
1
)
;
~
SkContourMeasureIter
(
)
;
void
reset
(
const
SkPath
&
path
bool
forceClosed
SkScalar
resScale
=
1
)
;
sk_sp
<
SkContourMeasure
>
next
(
)
;
private
:
SkPath
:
:
RawIter
fIter
;
SkPath
fPath
;
SkScalar
fTolerance
;
bool
fForceClosed
;
SkTDArray
<
SkContourMeasure
:
:
Segment
>
fSegments
;
SkTDArray
<
SkPoint
>
fPts
;
SkContourMeasure
*
buildSegments
(
)
;
SkScalar
compute_line_seg
(
SkPoint
p0
SkPoint
p1
SkScalar
distance
unsigned
ptIndex
)
;
SkScalar
compute_quad_segs
(
const
SkPoint
pts
[
3
]
SkScalar
distance
int
mint
int
maxt
unsigned
ptIndex
)
;
SkScalar
compute_conic_segs
(
const
SkConic
&
conic
SkScalar
distance
int
mint
const
SkPoint
&
minPt
int
maxt
const
SkPoint
&
maxPt
unsigned
ptIndex
)
;
SkScalar
compute_cubic_segs
(
const
SkPoint
pts
[
4
]
SkScalar
distance
int
mint
int
maxt
unsigned
ptIndex
)
;
SkContourMeasureIter
(
const
SkContourMeasureIter
&
)
=
delete
;
SkContourMeasureIter
&
operator
=
(
const
SkContourMeasureIter
&
)
=
delete
;
}
;
#
endif
