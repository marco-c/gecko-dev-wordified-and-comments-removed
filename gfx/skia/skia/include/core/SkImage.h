#
ifndef
SkImage_DEFINED
#
define
SkImage_DEFINED
#
include
"
include
/
core
/
SkFilterQuality
.
h
"
#
include
"
include
/
core
/
SkImageEncoder
.
h
"
#
include
"
include
/
core
/
SkImageInfo
.
h
"
#
include
"
include
/
core
/
SkRefCnt
.
h
"
#
include
"
include
/
core
/
SkScalar
.
h
"
#
include
"
include
/
core
/
SkShader
.
h
"
#
include
"
include
/
core
/
SkTileMode
.
h
"
#
include
"
include
/
gpu
/
GrTypes
.
h
"
#
include
<
functional
>
#
if
defined
(
SK_BUILD_FOR_ANDROID
)
&
&
__ANDROID_API__
>
=
26
#
include
<
android
/
hardware_buffer
.
h
>
#
endif
class
SkData
;
class
SkCanvas
;
class
SkImageFilter
;
class
SkImageGenerator
;
class
SkPaint
;
class
SkPicture
;
class
SkString
;
class
SkSurface
;
class
GrBackendTexture
;
class
GrContext
;
class
GrContextThreadSafeProxy
;
class
GrTexture
;
struct
SkYUVAIndex
;
class
SK_API
SkImage
:
public
SkRefCnt
{
public
:
typedef
void
*
ReleaseContext
;
static
sk_sp
<
SkImage
>
MakeRasterCopy
(
const
SkPixmap
&
pixmap
)
;
static
sk_sp
<
SkImage
>
MakeRasterData
(
const
SkImageInfo
&
info
sk_sp
<
SkData
>
pixels
size_t
rowBytes
)
;
typedef
void
(
*
RasterReleaseProc
)
(
const
void
*
pixels
ReleaseContext
)
;
static
sk_sp
<
SkImage
>
MakeFromRaster
(
const
SkPixmap
&
pixmap
RasterReleaseProc
rasterReleaseProc
ReleaseContext
releaseContext
)
;
static
sk_sp
<
SkImage
>
MakeFromBitmap
(
const
SkBitmap
&
bitmap
)
;
static
sk_sp
<
SkImage
>
MakeFromGenerator
(
std
:
:
unique_ptr
<
SkImageGenerator
>
imageGenerator
const
SkIRect
*
subset
=
nullptr
)
;
static
sk_sp
<
SkImage
>
MakeFromEncoded
(
sk_sp
<
SkData
>
encoded
const
SkIRect
*
subset
=
nullptr
)
;
static
sk_sp
<
SkImage
>
DecodeToRaster
(
const
void
*
encoded
size_t
length
const
SkIRect
*
subset
=
nullptr
)
;
static
sk_sp
<
SkImage
>
DecodeToRaster
(
const
sk_sp
<
SkData
>
&
data
const
SkIRect
*
subset
=
nullptr
)
{
return
DecodeToRaster
(
data
-
>
data
(
)
data
-
>
size
(
)
subset
)
;
}
static
sk_sp
<
SkImage
>
DecodeToTexture
(
GrContext
*
ctx
const
void
*
encoded
size_t
length
const
SkIRect
*
subset
=
nullptr
)
;
static
sk_sp
<
SkImage
>
DecodeToTexture
(
GrContext
*
ctx
const
sk_sp
<
SkData
>
&
data
const
SkIRect
*
subset
=
nullptr
)
{
return
DecodeToTexture
(
ctx
data
-
>
data
(
)
data
-
>
size
(
)
subset
)
;
}
enum
CompressionType
{
kETC1_CompressionType
kLast_CompressionType
=
kETC1_CompressionType
}
;
static
sk_sp
<
SkImage
>
MakeFromCompressed
(
GrContext
*
context
sk_sp
<
SkData
>
data
int
width
int
height
CompressionType
type
)
;
typedef
void
(
*
TextureReleaseProc
)
(
ReleaseContext
releaseContext
)
;
static
sk_sp
<
SkImage
>
MakeFromTexture
(
GrContext
*
context
const
GrBackendTexture
&
backendTexture
GrSurfaceOrigin
origin
SkColorType
colorType
SkAlphaType
alphaType
sk_sp
<
SkColorSpace
>
colorSpace
)
{
return
MakeFromTexture
(
context
backendTexture
origin
colorType
alphaType
colorSpace
nullptr
nullptr
)
;
}
static
sk_sp
<
SkImage
>
MakeFromTexture
(
GrContext
*
context
const
GrBackendTexture
&
backendTexture
GrSurfaceOrigin
origin
SkColorType
colorType
SkAlphaType
alphaType
sk_sp
<
SkColorSpace
>
colorSpace
TextureReleaseProc
textureReleaseProc
ReleaseContext
releaseContext
)
;
static
sk_sp
<
SkImage
>
MakeCrossContextFromPixmap
(
GrContext
*
context
const
SkPixmap
&
pixmap
bool
buildMips
bool
limitToMaxTextureSize
=
false
)
;
static
sk_sp
<
SkImage
>
MakeFromAdoptedTexture
(
GrContext
*
context
const
GrBackendTexture
&
backendTexture
GrSurfaceOrigin
surfaceOrigin
SkColorType
colorType
SkAlphaType
alphaType
=
kPremul_SkAlphaType
sk_sp
<
SkColorSpace
>
colorSpace
=
nullptr
)
;
static
sk_sp
<
SkImage
>
MakeFromYUVATexturesCopy
(
GrContext
*
context
SkYUVColorSpace
yuvColorSpace
const
GrBackendTexture
yuvaTextures
[
]
const
SkYUVAIndex
yuvaIndices
[
4
]
SkISize
imageSize
GrSurfaceOrigin
imageOrigin
sk_sp
<
SkColorSpace
>
imageColorSpace
=
nullptr
)
;
static
sk_sp
<
SkImage
>
MakeFromYUVATexturesCopyWithExternalBackend
(
GrContext
*
context
SkYUVColorSpace
yuvColorSpace
const
GrBackendTexture
yuvaTextures
[
]
const
SkYUVAIndex
yuvaIndices
[
4
]
SkISize
imageSize
GrSurfaceOrigin
imageOrigin
const
GrBackendTexture
&
backendTexture
sk_sp
<
SkColorSpace
>
imageColorSpace
=
nullptr
TextureReleaseProc
textureReleaseProc
=
nullptr
ReleaseContext
releaseContext
=
nullptr
)
;
static
sk_sp
<
SkImage
>
MakeFromYUVATextures
(
GrContext
*
context
SkYUVColorSpace
yuvColorSpace
const
GrBackendTexture
yuvaTextures
[
]
const
SkYUVAIndex
yuvaIndices
[
4
]
SkISize
imageSize
GrSurfaceOrigin
imageOrigin
sk_sp
<
SkColorSpace
>
imageColorSpace
=
nullptr
)
;
static
sk_sp
<
SkImage
>
MakeFromYUVAPixmaps
(
GrContext
*
context
SkYUVColorSpace
yuvColorSpace
const
SkPixmap
yuvaPixmaps
[
]
const
SkYUVAIndex
yuvaIndices
[
4
]
SkISize
imageSize
GrSurfaceOrigin
imageOrigin
bool
buildMips
bool
limitToMaxTextureSize
=
false
sk_sp
<
SkColorSpace
>
imageColorSpace
=
nullptr
)
;
static
sk_sp
<
SkImage
>
MakeFromYUVTexturesCopy
(
GrContext
*
context
SkYUVColorSpace
yuvColorSpace
const
GrBackendTexture
yuvTextures
[
3
]
GrSurfaceOrigin
imageOrigin
sk_sp
<
SkColorSpace
>
imageColorSpace
=
nullptr
)
;
static
sk_sp
<
SkImage
>
MakeFromYUVTexturesCopyWithExternalBackend
(
GrContext
*
context
SkYUVColorSpace
yuvColorSpace
const
GrBackendTexture
yuvTextures
[
3
]
GrSurfaceOrigin
imageOrigin
const
GrBackendTexture
&
backendTexture
sk_sp
<
SkColorSpace
>
imageColorSpace
=
nullptr
)
;
static
sk_sp
<
SkImage
>
MakeFromNV12TexturesCopy
(
GrContext
*
context
SkYUVColorSpace
yuvColorSpace
const
GrBackendTexture
nv12Textures
[
2
]
GrSurfaceOrigin
imageOrigin
sk_sp
<
SkColorSpace
>
imageColorSpace
=
nullptr
)
;
static
sk_sp
<
SkImage
>
MakeFromNV12TexturesCopyWithExternalBackend
(
GrContext
*
context
SkYUVColorSpace
yuvColorSpace
const
GrBackendTexture
nv12Textures
[
2
]
GrSurfaceOrigin
imageOrigin
const
GrBackendTexture
&
backendTexture
sk_sp
<
SkColorSpace
>
imageColorSpace
=
nullptr
TextureReleaseProc
textureReleaseProc
=
nullptr
ReleaseContext
releaseContext
=
nullptr
)
;
enum
class
BitDepth
{
kU8
kF16
}
;
static
sk_sp
<
SkImage
>
MakeFromPicture
(
sk_sp
<
SkPicture
>
picture
const
SkISize
&
dimensions
const
SkMatrix
*
matrix
const
SkPaint
*
paint
BitDepth
bitDepth
sk_sp
<
SkColorSpace
>
colorSpace
)
;
#
if
defined
(
SK_BUILD_FOR_ANDROID
)
&
&
__ANDROID_API__
>
=
26
static
sk_sp
<
SkImage
>
MakeFromAHardwareBuffer
(
AHardwareBuffer
*
hardwareBuffer
SkAlphaType
alphaType
=
kPremul_SkAlphaType
sk_sp
<
SkColorSpace
>
colorSpace
=
nullptr
GrSurfaceOrigin
surfaceOrigin
=
kTopLeft_GrSurfaceOrigin
)
;
static
sk_sp
<
SkImage
>
MakeFromAHardwareBufferWithData
(
GrContext
*
context
const
SkPixmap
&
pixmap
AHardwareBuffer
*
hardwareBuffer
GrSurfaceOrigin
surfaceOrigin
=
kTopLeft_GrSurfaceOrigin
)
;
#
endif
const
SkImageInfo
&
imageInfo
(
)
const
{
return
fInfo
;
}
int
width
(
)
const
{
return
fInfo
.
width
(
)
;
}
int
height
(
)
const
{
return
fInfo
.
height
(
)
;
}
SkISize
dimensions
(
)
const
{
return
SkISize
:
:
Make
(
fInfo
.
width
(
)
fInfo
.
height
(
)
)
;
}
SkIRect
bounds
(
)
const
{
return
SkIRect
:
:
MakeWH
(
fInfo
.
width
(
)
fInfo
.
height
(
)
)
;
}
uint32_t
uniqueID
(
)
const
{
return
fUniqueID
;
}
SkAlphaType
alphaType
(
)
const
;
SkColorType
colorType
(
)
const
;
SkColorSpace
*
colorSpace
(
)
const
;
sk_sp
<
SkColorSpace
>
refColorSpace
(
)
const
;
bool
isAlphaOnly
(
)
const
;
bool
isOpaque
(
)
const
{
return
SkAlphaTypeIsOpaque
(
this
-
>
alphaType
(
)
)
;
}
sk_sp
<
SkShader
>
makeShader
(
SkTileMode
tmx
SkTileMode
tmy
const
SkMatrix
*
localMatrix
=
nullptr
)
const
;
sk_sp
<
SkShader
>
makeShader
(
const
SkMatrix
*
localMatrix
=
nullptr
)
const
{
return
this
-
>
makeShader
(
SkTileMode
:
:
kClamp
SkTileMode
:
:
kClamp
localMatrix
)
;
}
bool
peekPixels
(
SkPixmap
*
pixmap
)
const
;
GrTexture
*
getTexture
(
)
const
;
bool
isTextureBacked
(
)
const
;
bool
isValid
(
GrContext
*
context
)
const
;
GrSemaphoresSubmitted
flush
(
GrContext
*
context
const
GrFlushInfo
&
flushInfo
)
;
void
flush
(
GrContext
*
)
;
GrBackendTexture
getBackendTexture
(
bool
flushPendingGrContextIO
GrSurfaceOrigin
*
origin
=
nullptr
)
const
;
enum
CachingHint
{
kAllow_CachingHint
kDisallow_CachingHint
}
;
bool
readPixels
(
const
SkImageInfo
&
dstInfo
void
*
dstPixels
size_t
dstRowBytes
int
srcX
int
srcY
CachingHint
cachingHint
=
kAllow_CachingHint
)
const
;
bool
readPixels
(
const
SkPixmap
&
dst
int
srcX
int
srcY
CachingHint
cachingHint
=
kAllow_CachingHint
)
const
;
bool
scalePixels
(
const
SkPixmap
&
dst
SkFilterQuality
filterQuality
CachingHint
cachingHint
=
kAllow_CachingHint
)
const
;
sk_sp
<
SkData
>
encodeToData
(
SkEncodedImageFormat
encodedImageFormat
int
quality
)
const
;
sk_sp
<
SkData
>
encodeToData
(
)
const
;
sk_sp
<
SkData
>
refEncodedData
(
)
const
;
sk_sp
<
SkImage
>
makeSubset
(
const
SkIRect
&
subset
)
const
;
sk_sp
<
SkImage
>
makeTextureImage
(
GrContext
*
context
GrMipMapped
=
GrMipMapped
:
:
kNo
)
const
;
sk_sp
<
SkImage
>
makeNonTextureImage
(
)
const
;
sk_sp
<
SkImage
>
makeRasterImage
(
)
const
;
sk_sp
<
SkImage
>
makeWithFilter
(
GrContext
*
context
const
SkImageFilter
*
filter
const
SkIRect
&
subset
const
SkIRect
&
clipBounds
SkIRect
*
outSubset
SkIPoint
*
offset
)
const
;
sk_sp
<
SkImage
>
makeWithFilter
(
const
SkImageFilter
*
filter
const
SkIRect
&
subset
const
SkIRect
&
clipBounds
SkIRect
*
outSubset
SkIPoint
*
offset
)
const
;
typedef
std
:
:
function
<
void
(
GrBackendTexture
)
>
BackendTextureReleaseProc
;
static
bool
MakeBackendTextureFromSkImage
(
GrContext
*
context
sk_sp
<
SkImage
>
image
GrBackendTexture
*
backendTexture
BackendTextureReleaseProc
*
backendTextureReleaseProc
)
;
enum
LegacyBitmapMode
{
kRO_LegacyBitmapMode
}
;
bool
asLegacyBitmap
(
SkBitmap
*
bitmap
LegacyBitmapMode
legacyBitmapMode
=
kRO_LegacyBitmapMode
)
const
;
bool
isLazyGenerated
(
)
const
;
sk_sp
<
SkImage
>
makeColorSpace
(
sk_sp
<
SkColorSpace
>
target
)
const
;
sk_sp
<
SkImage
>
makeColorTypeAndColorSpace
(
SkColorType
targetColorType
sk_sp
<
SkColorSpace
>
targetColorSpace
)
const
;
sk_sp
<
SkImage
>
reinterpretColorSpace
(
sk_sp
<
SkColorSpace
>
newColorSpace
)
const
;
private
:
SkImage
(
const
SkImageInfo
&
info
uint32_t
uniqueID
)
;
friend
class
SkImage_Base
;
SkImageInfo
fInfo
;
const
uint32_t
fUniqueID
;
typedef
SkRefCnt
INHERITED
;
}
;
#
endif
