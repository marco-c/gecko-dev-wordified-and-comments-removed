#
ifndef
SkCanvas_DEFINED
#
define
SkCanvas_DEFINED
#
include
"
SkBlendMode
.
h
"
#
include
"
SkClipOp
.
h
"
#
include
"
SkDeque
.
h
"
#
include
"
SkPaint
.
h
"
#
include
"
SkRasterHandleAllocator
.
h
"
#
include
"
SkSurfaceProps
.
h
"
#
include
"
SkLights
.
h
"
#
include
"
.
.
/
private
/
SkShadowParams
.
h
"
class
GrContext
;
class
GrRenderTargetContext
;
class
SkBaseDevice
;
class
SkBitmap
;
#
ifdef
SK_SUPPORT_OBSOLETE_REPLAYCLIP
class
SkCanvasClipVisitor
;
#
endif
class
SkClipStack
;
class
SkData
;
class
SkDraw
;
class
SkDrawable
;
class
SkDrawFilter
;
class
SkImage
;
class
SkImageFilter
;
class
SkMetaData
;
class
SkPath
;
class
SkPicture
;
class
SkPixmap
;
class
SkRasterClip
;
class
SkRegion
;
class
SkRRect
;
struct
SkRSXform
;
class
SkSurface
;
class
SkSurface_Base
;
class
SkTextBlob
;
class
SkVertices
;
class
SK_API
SkCanvas
:
SkNoncopyable
{
enum
PrivateSaveLayerFlags
{
kDontClipToLayer_PrivateSaveLayerFlag
=
1U
<
<
31
}
;
public
:
static
std
:
:
unique_ptr
<
SkCanvas
>
MakeRasterDirect
(
const
SkImageInfo
&
void
*
size_t
)
;
static
std
:
:
unique_ptr
<
SkCanvas
>
MakeRasterDirectN32
(
int
width
int
height
SkPMColor
*
pixels
size_t
rowBytes
)
{
return
MakeRasterDirect
(
SkImageInfo
:
:
MakeN32Premul
(
width
height
)
pixels
rowBytes
)
;
}
SkCanvas
(
)
;
SkCanvas
(
int
width
int
height
const
SkSurfaceProps
*
=
NULL
)
;
explicit
SkCanvas
(
SkBaseDevice
*
device
)
;
explicit
SkCanvas
(
const
SkBitmap
&
bitmap
)
;
#
ifdef
SK_BUILD_FOR_ANDROID_FRAMEWORK
enum
class
ColorBehavior
{
kLegacy
}
;
SkCanvas
(
const
SkBitmap
&
bitmap
ColorBehavior
)
;
#
endif
SkCanvas
(
const
SkBitmap
&
bitmap
const
SkSurfaceProps
&
props
)
;
virtual
~
SkCanvas
(
)
;
SkMetaData
&
getMetaData
(
)
;
SkImageInfo
imageInfo
(
)
const
;
bool
getProps
(
SkSurfaceProps
*
)
const
;
void
flush
(
)
;
virtual
SkISize
getBaseLayerSize
(
)
const
;
sk_sp
<
SkSurface
>
makeSurface
(
const
SkImageInfo
&
const
SkSurfaceProps
*
=
nullptr
)
;
GrContext
*
getGrContext
(
)
;
void
*
accessTopLayerPixels
(
SkImageInfo
*
info
size_t
*
rowBytes
SkIPoint
*
origin
=
NULL
)
;
SkRasterHandleAllocator
:
:
Handle
accessTopRasterHandle
(
)
const
;
bool
peekPixels
(
SkPixmap
*
)
;
bool
readPixels
(
const
SkImageInfo
&
dstInfo
void
*
dstPixels
size_t
dstRowBytes
int
srcX
int
srcY
)
;
bool
readPixels
(
SkBitmap
*
bitmap
int
srcX
int
srcY
)
;
bool
readPixels
(
const
SkIRect
&
srcRect
SkBitmap
*
bitmap
)
;
bool
writePixels
(
const
SkImageInfo
&
const
void
*
pixels
size_t
rowBytes
int
x
int
y
)
;
bool
writePixels
(
const
SkBitmap
&
bitmap
int
x
int
y
)
;
int
save
(
)
;
int
saveLayer
(
const
SkRect
*
bounds
const
SkPaint
*
paint
)
;
int
saveLayer
(
const
SkRect
&
bounds
const
SkPaint
*
paint
)
{
return
this
-
>
saveLayer
(
&
bounds
paint
)
;
}
int
saveLayerPreserveLCDTextRequests
(
const
SkRect
*
bounds
const
SkPaint
*
paint
)
;
int
saveLayerAlpha
(
const
SkRect
*
bounds
U8CPU
alpha
)
;
enum
{
kIsOpaque_SaveLayerFlag
=
1
<
<
0
kPreserveLCDText_SaveLayerFlag
=
1
<
<
1
kInitWithPrevious_SaveLayerFlag
=
1
<
<
2
#
ifdef
SK_SUPPORT_LEGACY_CLIPTOLAYERFLAG
kDontClipToLayer_Legacy_SaveLayerFlag
=
kDontClipToLayer_PrivateSaveLayerFlag
#
endif
}
;
typedef
uint32_t
SaveLayerFlags
;
struct
SaveLayerRec
{
SaveLayerRec
(
)
:
fBounds
(
nullptr
)
fPaint
(
nullptr
)
fBackdrop
(
nullptr
)
fSaveLayerFlags
(
0
)
{
}
SaveLayerRec
(
const
SkRect
*
bounds
const
SkPaint
*
paint
SaveLayerFlags
saveLayerFlags
=
0
)
:
fBounds
(
bounds
)
fPaint
(
paint
)
fBackdrop
(
nullptr
)
fSaveLayerFlags
(
saveLayerFlags
)
{
}
SaveLayerRec
(
const
SkRect
*
bounds
const
SkPaint
*
paint
const
SkImageFilter
*
backdrop
SaveLayerFlags
saveLayerFlags
)
:
fBounds
(
bounds
)
fPaint
(
paint
)
fBackdrop
(
backdrop
)
fSaveLayerFlags
(
saveLayerFlags
)
{
}
const
SkRect
*
fBounds
;
const
SkPaint
*
fPaint
;
const
SkImageFilter
*
fBackdrop
;
SaveLayerFlags
fSaveLayerFlags
;
}
;
int
saveLayer
(
const
SaveLayerRec
&
)
;
void
restore
(
)
;
int
getSaveCount
(
)
const
;
void
restoreToCount
(
int
saveCount
)
;
void
translate
(
SkScalar
dx
SkScalar
dy
)
;
void
scale
(
SkScalar
sx
SkScalar
sy
)
;
void
rotate
(
SkScalar
degrees
)
;
void
rotate
(
SkScalar
degrees
SkScalar
px
SkScalar
py
)
;
void
skew
(
SkScalar
sx
SkScalar
sy
)
;
void
concat
(
const
SkMatrix
&
matrix
)
;
void
setMatrix
(
const
SkMatrix
&
matrix
)
;
void
resetMatrix
(
)
;
#
ifdef
SK_EXPERIMENTAL_SHADOWING
void
translateZ
(
SkScalar
z
)
;
void
setLights
(
sk_sp
<
SkLights
>
lights
)
;
sk_sp
<
SkLights
>
getLights
(
)
const
;
#
endif
void
clipRect
(
const
SkRect
&
rect
SkClipOp
bool
doAntiAlias
)
;
void
clipRect
(
const
SkRect
&
rect
SkClipOp
op
)
{
this
-
>
clipRect
(
rect
op
false
)
;
}
void
clipRect
(
const
SkRect
&
rect
bool
doAntiAlias
=
false
)
{
this
-
>
clipRect
(
rect
SkClipOp
:
:
kIntersect
doAntiAlias
)
;
}
void
androidFramework_setDeviceClipRestriction
(
const
SkIRect
&
rect
)
;
void
clipRRect
(
const
SkRRect
&
rrect
SkClipOp
op
bool
doAntiAlias
)
;
void
clipRRect
(
const
SkRRect
&
rrect
SkClipOp
op
)
{
this
-
>
clipRRect
(
rrect
op
false
)
;
}
void
clipRRect
(
const
SkRRect
&
rrect
bool
doAntiAlias
=
false
)
{
this
-
>
clipRRect
(
rrect
SkClipOp
:
:
kIntersect
doAntiAlias
)
;
}
void
clipPath
(
const
SkPath
&
path
SkClipOp
op
bool
doAntiAlias
)
;
void
clipPath
(
const
SkPath
&
path
SkClipOp
op
)
{
this
-
>
clipPath
(
path
op
false
)
;
}
void
clipPath
(
const
SkPath
&
path
bool
doAntiAlias
=
false
)
{
this
-
>
clipPath
(
path
SkClipOp
:
:
kIntersect
doAntiAlias
)
;
}
void
setAllowSimplifyClip
(
bool
allow
)
{
fAllowSimplifyClip
=
allow
;
}
void
clipRegion
(
const
SkRegion
&
deviceRgn
SkClipOp
op
=
SkClipOp
:
:
kIntersect
)
;
bool
quickReject
(
const
SkRect
&
rect
)
const
;
bool
quickReject
(
const
SkPath
&
path
)
const
;
SkRect
getLocalClipBounds
(
)
const
{
return
this
-
>
onGetLocalClipBounds
(
)
;
}
bool
getLocalClipBounds
(
SkRect
*
bounds
)
const
{
*
bounds
=
this
-
>
onGetLocalClipBounds
(
)
;
return
!
bounds
-
>
isEmpty
(
)
;
}
SkIRect
getDeviceClipBounds
(
)
const
{
return
this
-
>
onGetDeviceClipBounds
(
)
;
}
bool
getDeviceClipBounds
(
SkIRect
*
bounds
)
const
{
*
bounds
=
this
-
>
onGetDeviceClipBounds
(
)
;
return
!
bounds
-
>
isEmpty
(
)
;
}
void
drawColor
(
SkColor
color
SkBlendMode
mode
=
SkBlendMode
:
:
kSrcOver
)
;
void
clear
(
SkColor
color
)
{
this
-
>
drawColor
(
color
SkBlendMode
:
:
kSrc
)
;
}
void
discard
(
)
{
this
-
>
onDiscard
(
)
;
}
void
drawPaint
(
const
SkPaint
&
paint
)
;
enum
PointMode
{
kPoints_PointMode
kLines_PointMode
kPolygon_PointMode
}
;
void
drawPoints
(
PointMode
mode
size_t
count
const
SkPoint
pts
[
]
const
SkPaint
&
paint
)
;
void
drawPoint
(
SkScalar
x
SkScalar
y
const
SkPaint
&
paint
)
;
void
drawLine
(
SkScalar
x0
SkScalar
y0
SkScalar
x1
SkScalar
y1
const
SkPaint
&
paint
)
;
void
drawRect
(
const
SkRect
&
rect
const
SkPaint
&
paint
)
;
void
drawIRect
(
const
SkIRect
&
rect
const
SkPaint
&
paint
)
{
SkRect
r
;
r
.
set
(
rect
)
;
this
-
>
drawRect
(
r
paint
)
;
}
void
drawRegion
(
const
SkRegion
&
region
const
SkPaint
&
paint
)
;
void
drawOval
(
const
SkRect
&
oval
const
SkPaint
&
)
;
void
drawRRect
(
const
SkRRect
&
rrect
const
SkPaint
&
paint
)
;
void
drawDRRect
(
const
SkRRect
&
outer
const
SkRRect
&
inner
const
SkPaint
&
)
;
void
drawCircle
(
SkScalar
cx
SkScalar
cy
SkScalar
radius
const
SkPaint
&
paint
)
;
void
drawArc
(
const
SkRect
&
oval
SkScalar
startAngle
SkScalar
sweepAngle
bool
useCenter
const
SkPaint
&
paint
)
;
void
drawRoundRect
(
const
SkRect
&
rect
SkScalar
rx
SkScalar
ry
const
SkPaint
&
paint
)
;
void
drawPath
(
const
SkPath
&
path
const
SkPaint
&
paint
)
;
void
drawImage
(
const
SkImage
*
image
SkScalar
left
SkScalar
top
const
SkPaint
*
paint
=
NULL
)
;
void
drawImage
(
const
sk_sp
<
SkImage
>
&
image
SkScalar
left
SkScalar
top
const
SkPaint
*
paint
=
NULL
)
{
this
-
>
drawImage
(
image
.
get
(
)
left
top
paint
)
;
}
enum
SrcRectConstraint
{
kStrict_SrcRectConstraint
kFast_SrcRectConstraint
}
;
void
drawImageRect
(
const
SkImage
*
image
const
SkRect
&
src
const
SkRect
&
dst
const
SkPaint
*
paint
SrcRectConstraint
constraint
=
kStrict_SrcRectConstraint
)
;
void
drawImageRect
(
const
SkImage
*
image
const
SkIRect
&
isrc
const
SkRect
&
dst
const
SkPaint
*
paint
SrcRectConstraint
=
kStrict_SrcRectConstraint
)
;
void
drawImageRect
(
const
SkImage
*
image
const
SkRect
&
dst
const
SkPaint
*
paint
SrcRectConstraint
=
kStrict_SrcRectConstraint
)
;
void
drawImageRect
(
const
sk_sp
<
SkImage
>
&
image
const
SkRect
&
src
const
SkRect
&
dst
const
SkPaint
*
paint
SrcRectConstraint
constraint
=
kStrict_SrcRectConstraint
)
{
this
-
>
drawImageRect
(
image
.
get
(
)
src
dst
paint
constraint
)
;
}
void
drawImageRect
(
const
sk_sp
<
SkImage
>
&
image
const
SkIRect
&
isrc
const
SkRect
&
dst
const
SkPaint
*
paint
SrcRectConstraint
cons
=
kStrict_SrcRectConstraint
)
{
this
-
>
drawImageRect
(
image
.
get
(
)
isrc
dst
paint
cons
)
;
}
void
drawImageRect
(
const
sk_sp
<
SkImage
>
&
image
const
SkRect
&
dst
const
SkPaint
*
paint
SrcRectConstraint
cons
=
kStrict_SrcRectConstraint
)
{
this
-
>
drawImageRect
(
image
.
get
(
)
dst
paint
cons
)
;
}
void
drawImageNine
(
const
SkImage
*
const
SkIRect
&
center
const
SkRect
&
dst
const
SkPaint
*
paint
=
nullptr
)
;
void
drawImageNine
(
const
sk_sp
<
SkImage
>
&
image
const
SkIRect
&
center
const
SkRect
&
dst
const
SkPaint
*
paint
=
nullptr
)
{
this
-
>
drawImageNine
(
image
.
get
(
)
center
dst
paint
)
;
}
void
drawBitmap
(
const
SkBitmap
&
bitmap
SkScalar
left
SkScalar
top
const
SkPaint
*
paint
=
NULL
)
;
void
drawBitmapRect
(
const
SkBitmap
&
bitmap
const
SkRect
&
src
const
SkRect
&
dst
const
SkPaint
*
paint
SrcRectConstraint
=
kStrict_SrcRectConstraint
)
;
void
drawBitmapRect
(
const
SkBitmap
&
bitmap
const
SkIRect
&
isrc
const
SkRect
&
dst
const
SkPaint
*
paint
SrcRectConstraint
=
kStrict_SrcRectConstraint
)
;
void
drawBitmapRect
(
const
SkBitmap
&
bitmap
const
SkRect
&
dst
const
SkPaint
*
paint
SrcRectConstraint
=
kStrict_SrcRectConstraint
)
;
void
drawBitmapNine
(
const
SkBitmap
&
bitmap
const
SkIRect
&
center
const
SkRect
&
dst
const
SkPaint
*
paint
=
NULL
)
;
struct
Lattice
{
enum
Flags
:
uint8_t
{
kTransparent_Flags
=
1
<
<
0
}
;
const
int
*
fXDivs
;
const
int
*
fYDivs
;
const
Flags
*
fFlags
;
int
fXCount
;
int
fYCount
;
const
SkIRect
*
fBounds
;
}
;
void
drawBitmapLattice
(
const
SkBitmap
&
bitmap
const
Lattice
&
lattice
const
SkRect
&
dst
const
SkPaint
*
paint
=
nullptr
)
;
void
drawImageLattice
(
const
SkImage
*
image
const
Lattice
&
lattice
const
SkRect
&
dst
const
SkPaint
*
paint
=
nullptr
)
;
void
drawText
(
const
void
*
text
size_t
byteLength
SkScalar
x
SkScalar
y
const
SkPaint
&
paint
)
;
void
drawPosText
(
const
void
*
text
size_t
byteLength
const
SkPoint
pos
[
]
const
SkPaint
&
paint
)
;
void
drawPosTextH
(
const
void
*
text
size_t
byteLength
const
SkScalar
xpos
[
]
SkScalar
constY
const
SkPaint
&
paint
)
;
void
drawTextOnPathHV
(
const
void
*
text
size_t
byteLength
const
SkPath
&
path
SkScalar
hOffset
SkScalar
vOffset
const
SkPaint
&
paint
)
;
void
drawTextOnPath
(
const
void
*
text
size_t
byteLength
const
SkPath
&
path
const
SkMatrix
*
matrix
const
SkPaint
&
paint
)
;
void
drawTextRSXform
(
const
void
*
text
size_t
byteLength
const
SkRSXform
[
]
const
SkRect
*
cullRect
const
SkPaint
&
paint
)
;
void
drawTextBlob
(
const
SkTextBlob
*
blob
SkScalar
x
SkScalar
y
const
SkPaint
&
paint
)
;
void
drawTextBlob
(
const
sk_sp
<
SkTextBlob
>
&
blob
SkScalar
x
SkScalar
y
const
SkPaint
&
paint
)
{
this
-
>
drawTextBlob
(
blob
.
get
(
)
x
y
paint
)
;
}
void
drawPicture
(
const
SkPicture
*
picture
)
{
this
-
>
drawPicture
(
picture
NULL
NULL
)
;
}
void
drawPicture
(
const
sk_sp
<
SkPicture
>
&
picture
)
{
this
-
>
drawPicture
(
picture
.
get
(
)
)
;
}
void
drawPicture
(
const
SkPicture
*
const
SkMatrix
*
matrix
const
SkPaint
*
paint
)
;
void
drawPicture
(
const
sk_sp
<
SkPicture
>
&
picture
const
SkMatrix
*
matrix
const
SkPaint
*
paint
)
{
this
-
>
drawPicture
(
picture
.
get
(
)
matrix
paint
)
;
}
#
ifdef
SK_EXPERIMENTAL_SHADOWING
void
drawShadowedPicture
(
const
SkPicture
*
const
SkMatrix
*
matrix
const
SkPaint
*
paint
const
SkShadowParams
&
params
)
;
void
drawShadowedPicture
(
const
sk_sp
<
SkPicture
>
&
picture
const
SkMatrix
*
matrix
const
SkPaint
*
paint
const
SkShadowParams
&
params
)
{
this
-
>
drawShadowedPicture
(
picture
.
get
(
)
matrix
paint
params
)
;
}
#
endif
void
drawVertices
(
const
SkVertices
*
vertices
SkBlendMode
mode
const
SkPaint
&
paint
)
;
void
drawVertices
(
const
sk_sp
<
SkVertices
>
&
vertices
SkBlendMode
mode
const
SkPaint
&
paint
)
;
void
drawPatch
(
const
SkPoint
cubics
[
12
]
const
SkColor
colors
[
4
]
const
SkPoint
texCoords
[
4
]
SkBlendMode
mode
const
SkPaint
&
paint
)
;
void
drawPatch
(
const
SkPoint
cubics
[
12
]
const
SkColor
colors
[
4
]
const
SkPoint
texCoords
[
4
]
const
SkPaint
&
paint
)
{
this
-
>
drawPatch
(
cubics
colors
texCoords
SkBlendMode
:
:
kModulate
paint
)
;
}
void
drawAtlas
(
const
SkImage
*
atlas
const
SkRSXform
xform
[
]
const
SkRect
tex
[
]
const
SkColor
colors
[
]
int
count
SkBlendMode
const
SkRect
*
cullRect
const
SkPaint
*
paint
)
;
void
drawAtlas
(
const
sk_sp
<
SkImage
>
&
atlas
const
SkRSXform
xform
[
]
const
SkRect
tex
[
]
const
SkColor
colors
[
]
int
count
SkBlendMode
mode
const
SkRect
*
cullRect
const
SkPaint
*
paint
)
{
this
-
>
drawAtlas
(
atlas
.
get
(
)
xform
tex
colors
count
mode
cullRect
paint
)
;
}
void
drawAtlas
(
const
SkImage
*
atlas
const
SkRSXform
xform
[
]
const
SkRect
tex
[
]
int
count
const
SkRect
*
cullRect
const
SkPaint
*
paint
)
{
this
-
>
drawAtlas
(
atlas
xform
tex
nullptr
count
SkBlendMode
:
:
kDst
cullRect
paint
)
;
}
void
drawAtlas
(
const
sk_sp
<
SkImage
>
&
atlas
const
SkRSXform
xform
[
]
const
SkRect
tex
[
]
int
count
const
SkRect
*
cullRect
const
SkPaint
*
paint
)
{
this
-
>
drawAtlas
(
atlas
.
get
(
)
xform
tex
nullptr
count
SkBlendMode
:
:
kDst
cullRect
paint
)
;
}
void
drawDrawable
(
SkDrawable
*
drawable
const
SkMatrix
*
=
NULL
)
;
void
drawDrawable
(
SkDrawable
*
SkScalar
x
SkScalar
y
)
;
void
drawAnnotation
(
const
SkRect
&
const
char
key
[
]
SkData
*
value
)
;
void
drawAnnotation
(
const
SkRect
&
rect
const
char
key
[
]
const
sk_sp
<
SkData
>
&
value
)
{
this
-
>
drawAnnotation
(
rect
key
value
.
get
(
)
)
;
}
#
ifdef
SK_INTERNAL
#
ifndef
SK_SUPPORT_LEGACY_DRAWFILTER
#
define
SK_SUPPORT_LEGACY_DRAWFILTER
#
endif
#
endif
#
ifdef
SK_SUPPORT_LEGACY_DRAWFILTER
SK_ATTR_EXTERNALLY_DEPRECATED
(
"
getDrawFilter
use
is
deprecated
"
)
SkDrawFilter
*
getDrawFilter
(
)
const
;
SK_ATTR_EXTERNALLY_DEPRECATED
(
"
setDrawFilter
use
is
deprecated
"
)
virtual
SkDrawFilter
*
setDrawFilter
(
SkDrawFilter
*
filter
)
;
#
endif
virtual
bool
isClipEmpty
(
)
const
;
virtual
bool
isClipRect
(
)
const
;
const
SkMatrix
&
getTotalMatrix
(
)
const
;
#
ifdef
SK_SUPPORT_OBSOLETE_REPLAYCLIP
typedef
SkCanvasClipVisitor
ClipVisitor
;
void
replayClips
(
ClipVisitor
*
)
const
;
#
endif
GrRenderTargetContext
*
internal_private_accessTopLayerRenderTargetContext
(
)
;
static
void
Internal_Private_SetIgnoreSaveLayerBounds
(
bool
)
;
static
bool
Internal_Private_GetIgnoreSaveLayerBounds
(
)
;
static
void
Internal_Private_SetTreatSpriteAsBitmap
(
bool
)
;
static
bool
Internal_Private_GetTreatSpriteAsBitmap
(
)
;
void
legacy_drawImageRect
(
const
SkImage
*
image
const
SkRect
*
src
const
SkRect
&
dst
const
SkPaint
*
paint
SrcRectConstraint
constraint
=
kStrict_SrcRectConstraint
)
;
void
legacy_drawBitmapRect
(
const
SkBitmap
&
bitmap
const
SkRect
*
src
const
SkRect
&
dst
const
SkPaint
*
paint
SrcRectConstraint
constraint
=
kStrict_SrcRectConstraint
)
;
void
temporary_internal_describeTopLayer
(
SkMatrix
*
matrix
SkIRect
*
clip_bounds
)
;
void
temporary_internal_getRgnClip
(
SkRegion
*
)
;
protected
:
#
ifdef
SK_EXPERIMENTAL_SHADOWING
SkScalar
getZ
(
)
const
;
sk_sp
<
SkLights
>
fLights
;
#
endif
virtual
sk_sp
<
SkSurface
>
onNewSurface
(
const
SkImageInfo
&
const
SkSurfaceProps
&
)
;
virtual
bool
onPeekPixels
(
SkPixmap
*
)
;
virtual
bool
onAccessTopLayerPixels
(
SkPixmap
*
)
;
virtual
SkImageInfo
onImageInfo
(
)
const
;
virtual
bool
onGetProps
(
SkSurfaceProps
*
)
const
;
virtual
void
onFlush
(
)
;
enum
SaveLayerStrategy
{
kFullLayer_SaveLayerStrategy
kNoLayer_SaveLayerStrategy
}
;
virtual
void
willSave
(
)
{
}
virtual
SaveLayerStrategy
getSaveLayerStrategy
(
const
SaveLayerRec
&
)
{
return
kFullLayer_SaveLayerStrategy
;
}
virtual
void
willRestore
(
)
{
}
virtual
void
didRestore
(
)
{
}
virtual
void
didConcat
(
const
SkMatrix
&
)
{
}
virtual
void
didSetMatrix
(
const
SkMatrix
&
)
{
}
virtual
void
didTranslate
(
SkScalar
dx
SkScalar
dy
)
{
this
-
>
didConcat
(
SkMatrix
:
:
MakeTrans
(
dx
dy
)
)
;
}
#
ifdef
SK_EXPERIMENTAL_SHADOWING
virtual
void
didTranslateZ
(
SkScalar
)
{
}
#
endif
virtual
SkRect
onGetLocalClipBounds
(
)
const
;
virtual
SkIRect
onGetDeviceClipBounds
(
)
const
;
virtual
void
onDrawAnnotation
(
const
SkRect
&
const
char
key
[
]
SkData
*
value
)
;
virtual
void
onDrawDRRect
(
const
SkRRect
&
const
SkRRect
&
const
SkPaint
&
)
;
virtual
void
onDrawText
(
const
void
*
text
size_t
byteLength
SkScalar
x
SkScalar
y
const
SkPaint
&
paint
)
;
virtual
void
onDrawPosText
(
const
void
*
text
size_t
byteLength
const
SkPoint
pos
[
]
const
SkPaint
&
paint
)
;
virtual
void
onDrawPosTextH
(
const
void
*
text
size_t
byteLength
const
SkScalar
xpos
[
]
SkScalar
constY
const
SkPaint
&
paint
)
;
virtual
void
onDrawTextOnPath
(
const
void
*
text
size_t
byteLength
const
SkPath
&
path
const
SkMatrix
*
matrix
const
SkPaint
&
paint
)
;
virtual
void
onDrawTextRSXform
(
const
void
*
text
size_t
byteLength
const
SkRSXform
[
]
const
SkRect
*
cullRect
const
SkPaint
&
paint
)
;
virtual
void
onDrawTextBlob
(
const
SkTextBlob
*
blob
SkScalar
x
SkScalar
y
const
SkPaint
&
paint
)
;
virtual
void
onDrawPatch
(
const
SkPoint
cubics
[
12
]
const
SkColor
colors
[
4
]
const
SkPoint
texCoords
[
4
]
SkBlendMode
const
SkPaint
&
paint
)
;
virtual
void
onDrawDrawable
(
SkDrawable
*
const
SkMatrix
*
)
;
virtual
void
onDrawPaint
(
const
SkPaint
&
)
;
virtual
void
onDrawRect
(
const
SkRect
&
const
SkPaint
&
)
;
virtual
void
onDrawRegion
(
const
SkRegion
&
region
const
SkPaint
&
paint
)
;
virtual
void
onDrawOval
(
const
SkRect
&
const
SkPaint
&
)
;
virtual
void
onDrawArc
(
const
SkRect
&
SkScalar
startAngle
SkScalar
sweepAngle
bool
useCenter
const
SkPaint
&
)
;
virtual
void
onDrawRRect
(
const
SkRRect
&
const
SkPaint
&
)
;
virtual
void
onDrawPoints
(
PointMode
size_t
count
const
SkPoint
pts
[
]
const
SkPaint
&
)
;
virtual
void
onDrawVerticesObject
(
const
SkVertices
*
SkBlendMode
const
SkPaint
&
)
;
virtual
void
onDrawAtlas
(
const
SkImage
*
const
SkRSXform
[
]
const
SkRect
[
]
const
SkColor
[
]
int
count
SkBlendMode
const
SkRect
*
cull
const
SkPaint
*
)
;
virtual
void
onDrawPath
(
const
SkPath
&
const
SkPaint
&
)
;
virtual
void
onDrawImage
(
const
SkImage
*
SkScalar
dx
SkScalar
dy
const
SkPaint
*
)
;
virtual
void
onDrawImageRect
(
const
SkImage
*
const
SkRect
*
const
SkRect
&
const
SkPaint
*
SrcRectConstraint
)
;
virtual
void
onDrawImageNine
(
const
SkImage
*
const
SkIRect
&
center
const
SkRect
&
dst
const
SkPaint
*
)
;
virtual
void
onDrawImageLattice
(
const
SkImage
*
const
Lattice
&
lattice
const
SkRect
&
dst
const
SkPaint
*
)
;
virtual
void
onDrawBitmap
(
const
SkBitmap
&
SkScalar
dx
SkScalar
dy
const
SkPaint
*
)
;
virtual
void
onDrawBitmapRect
(
const
SkBitmap
&
const
SkRect
*
const
SkRect
&
const
SkPaint
*
SrcRectConstraint
)
;
virtual
void
onDrawBitmapNine
(
const
SkBitmap
&
const
SkIRect
&
center
const
SkRect
&
dst
const
SkPaint
*
)
;
virtual
void
onDrawBitmapLattice
(
const
SkBitmap
&
const
Lattice
&
lattice
const
SkRect
&
dst
const
SkPaint
*
)
;
enum
ClipEdgeStyle
{
kHard_ClipEdgeStyle
kSoft_ClipEdgeStyle
}
;
virtual
void
onClipRect
(
const
SkRect
&
rect
SkClipOp
ClipEdgeStyle
)
;
virtual
void
onClipRRect
(
const
SkRRect
&
rrect
SkClipOp
ClipEdgeStyle
)
;
virtual
void
onClipPath
(
const
SkPath
&
path
SkClipOp
ClipEdgeStyle
)
;
virtual
void
onClipRegion
(
const
SkRegion
&
deviceRgn
SkClipOp
)
;
virtual
void
onDiscard
(
)
;
virtual
void
onDrawPicture
(
const
SkPicture
*
const
SkMatrix
*
const
SkPaint
*
)
;
#
ifdef
SK_EXPERIMENTAL_SHADOWING
virtual
void
onDrawShadowedPicture
(
const
SkPicture
*
const
SkMatrix
*
const
SkPaint
*
const
SkShadowParams
&
params
)
;
#
endif
bool
clipRectBounds
(
const
SkRect
*
bounds
SaveLayerFlags
SkIRect
*
intersection
const
SkImageFilter
*
imageFilter
=
NULL
)
;
private
:
class
LayerIter
{
public
:
LayerIter
(
SkCanvas
*
)
;
~
LayerIter
(
)
;
bool
done
(
)
const
{
return
fDone
;
}
void
next
(
)
;
SkBaseDevice
*
device
(
)
const
;
const
SkMatrix
&
matrix
(
)
const
;
void
clip
(
SkRegion
*
)
const
;
const
SkPaint
&
paint
(
)
const
;
int
x
(
)
const
;
int
y
(
)
const
;
private
:
intptr_t
fStorage
[
32
]
;
class
SkDrawIter
*
fImpl
;
SkPaint
fDefaultPaint
;
bool
fDone
;
}
;
static
bool
BoundsAffectsClip
(
SaveLayerFlags
)
;
static
SaveLayerFlags
LegacySaveFlagsToSaveLayerFlags
(
uint32_t
legacySaveFlags
)
;
static
void
DrawDeviceWithFilter
(
SkBaseDevice
*
src
const
SkImageFilter
*
filter
SkBaseDevice
*
dst
const
SkIPoint
&
dstOrigin
const
SkMatrix
&
ctm
)
;
enum
ShaderOverrideOpacity
{
kNone_ShaderOverrideOpacity
kOpaque_ShaderOverrideOpacity
kNotOpaque_ShaderOverrideOpacity
}
;
void
predrawNotify
(
bool
willOverwritesEntireSurface
=
false
)
;
void
predrawNotify
(
const
SkRect
*
rect
const
SkPaint
*
paint
ShaderOverrideOpacity
)
;
void
predrawNotify
(
const
SkRect
*
rect
const
SkPaint
*
paint
bool
shaderOverrideIsOpaque
)
{
this
-
>
predrawNotify
(
rect
paint
shaderOverrideIsOpaque
?
kOpaque_ShaderOverrideOpacity
:
kNotOpaque_ShaderOverrideOpacity
)
;
}
public
:
SkBaseDevice
*
getDevice
(
)
const
;
SkBaseDevice
*
getTopDevice
(
)
const
;
private
:
class
MCRec
;
SkDeque
fMCStack
;
MCRec
*
fMCRec
;
enum
{
kMCRecSize
=
128
kMCRecCount
=
32
kDeviceCMSize
=
184
}
;
intptr_t
fMCRecStorage
[
kMCRecSize
*
kMCRecCount
/
sizeof
(
intptr_t
)
]
;
intptr_t
fDeviceCMStorage
[
kDeviceCMSize
/
sizeof
(
intptr_t
)
]
;
const
SkSurfaceProps
fProps
;
int
fSaveCount
;
SkMetaData
*
fMetaData
;
std
:
:
unique_ptr
<
SkRasterHandleAllocator
>
fAllocator
;
SkSurface_Base
*
fSurfaceBase
;
SkSurface_Base
*
getSurfaceBase
(
)
const
{
return
fSurfaceBase
;
}
void
setSurfaceBase
(
SkSurface_Base
*
sb
)
{
fSurfaceBase
=
sb
;
}
friend
class
SkSurface_Base
;
friend
class
SkSurface_Gpu
;
SkIRect
fClipRestrictionRect
=
SkIRect
:
:
MakeEmpty
(
)
;
void
doSave
(
)
;
void
checkForDeferredSave
(
)
;
void
internalSetMatrix
(
const
SkMatrix
&
)
;
friend
class
SkDrawIter
;
friend
class
AutoDrawLooper
;
friend
class
SkDebugCanvas
;
friend
class
SkSurface_Raster
;
friend
class
SkRecorder
;
friend
class
SkLiteRecorder
;
friend
class
SkNoDrawCanvas
;
friend
class
SkPictureImageFilter
;
friend
class
SkPictureRecord
;
friend
class
SkPicturePlayback
;
friend
class
SkDeferredCanvas
;
friend
class
SkOverdrawCanvas
;
friend
class
SkRasterHandleAllocator
;
enum
InitFlags
{
kDefault_InitFlags
=
0
kConservativeRasterClip_InitFlag
=
1
<
<
0
}
;
SkCanvas
(
const
SkIRect
&
bounds
InitFlags
)
;
SkCanvas
(
SkBaseDevice
*
device
InitFlags
)
;
SkCanvas
(
const
SkBitmap
&
std
:
:
unique_ptr
<
SkRasterHandleAllocator
>
SkRasterHandleAllocator
:
:
Handle
)
;
void
resetForNextPicture
(
const
SkIRect
&
bounds
)
;
friend
class
SkCanvasStateUtils
;
void
setupDevice
(
SkBaseDevice
*
)
;
SkBaseDevice
*
init
(
SkBaseDevice
*
InitFlags
)
;
SkIRect
getTopLayerBounds
(
)
const
;
void
internalDrawBitmapRect
(
const
SkBitmap
&
bitmap
const
SkRect
*
src
const
SkRect
&
dst
const
SkPaint
*
paint
SrcRectConstraint
)
;
void
internalDrawPaint
(
const
SkPaint
&
paint
)
;
void
internalSaveLayer
(
const
SaveLayerRec
&
SaveLayerStrategy
)
;
void
internalDrawDevice
(
SkBaseDevice
*
int
x
int
y
const
SkPaint
*
)
;
void
internalSave
(
)
;
void
internalRestore
(
)
;
bool
wouldOverwriteEntireSurface
(
const
SkRect
*
const
SkPaint
*
ShaderOverrideOpacity
)
const
;
bool
canDrawBitmapAsSprite
(
SkScalar
x
SkScalar
y
int
w
int
h
const
SkPaint
&
)
;
bool
androidFramework_isClipAA
(
)
const
;
bool
fIsScaleTranslate
;
SkRect
fDeviceClipBounds
;
bool
fAllowSoftClip
;
bool
fAllowSimplifyClip
;
class
AutoValidateClip
:
:
:
SkNoncopyable
{
public
:
explicit
AutoValidateClip
(
SkCanvas
*
canvas
)
:
fCanvas
(
canvas
)
{
fCanvas
-
>
validateClip
(
)
;
}
~
AutoValidateClip
(
)
{
fCanvas
-
>
validateClip
(
)
;
}
private
:
const
SkCanvas
*
fCanvas
;
}
;
#
ifdef
SK_DEBUG
void
validateClip
(
)
const
;
#
else
void
validateClip
(
)
const
{
}
#
endif
typedef
SkRefCnt
INHERITED
;
}
;
class
SkAutoCanvasRestore
:
SkNoncopyable
{
public
:
SkAutoCanvasRestore
(
SkCanvas
*
canvas
bool
doSave
)
:
fCanvas
(
canvas
)
fSaveCount
(
0
)
{
if
(
fCanvas
)
{
fSaveCount
=
canvas
-
>
getSaveCount
(
)
;
if
(
doSave
)
{
canvas
-
>
save
(
)
;
}
}
}
~
SkAutoCanvasRestore
(
)
{
if
(
fCanvas
)
{
fCanvas
-
>
restoreToCount
(
fSaveCount
)
;
}
}
void
restore
(
)
{
if
(
fCanvas
)
{
fCanvas
-
>
restoreToCount
(
fSaveCount
)
;
fCanvas
=
NULL
;
}
}
private
:
SkCanvas
*
fCanvas
;
int
fSaveCount
;
}
;
#
define
SkAutoCanvasRestore
(
.
.
.
)
SK_REQUIRE_LOCAL_VAR
(
SkAutoCanvasRestore
)
#
ifdef
SK_SUPPORT_OBSOLETE_REPLAYCLIP
class
SkCanvasClipVisitor
{
public
:
virtual
~
SkCanvasClipVisitor
(
)
;
virtual
void
clipRect
(
const
SkRect
&
SkClipOp
bool
antialias
)
=
0
;
virtual
void
clipRRect
(
const
SkRRect
&
SkClipOp
bool
antialias
)
=
0
;
virtual
void
clipPath
(
const
SkPath
&
SkClipOp
bool
antialias
)
=
0
;
}
;
#
endif
#
endif
