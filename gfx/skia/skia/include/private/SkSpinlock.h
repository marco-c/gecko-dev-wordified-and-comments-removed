#
ifndef
SkSpinlock_DEFINED
#
define
SkSpinlock_DEFINED
#
include
"
.
.
/
private
/
SkAtomics
.
h
"
#
define
SK_DECLARE_STATIC_SPINLOCK
(
name
)
namespace
{
}
static
SkPODSpinlock
name
class
SK_API
SkPODSpinlock
{
public
:
void
acquire
(
)
{
if
(
sk_atomic_exchange
(
&
fLocked
true
sk_memory_order_acquire
)
)
{
this
-
>
contendedAcquire
(
)
;
}
}
void
release
(
)
{
sk_atomic_store
(
&
fLocked
false
sk_memory_order_release
)
;
}
private
:
void
contendedAcquire
(
)
;
bool
fLocked
;
}
;
class
SkSpinlock
:
public
SkPODSpinlock
{
public
:
SkSpinlock
(
)
{
this
-
>
release
(
)
;
}
}
;
#
endif
