#
ifndef
SkImage_Base_DEFINED
#
define
SkImage_Base_DEFINED
#
include
"
SkAtomics
.
h
"
#
include
"
SkImage
.
h
"
#
include
"
SkSurface
.
h
"
#
if
SK_SUPPORT_GPU
#
include
"
GrTexture
.
h
"
#
endif
#
include
<
new
>
class
GrTextureParams
;
class
SkImageCacherator
;
enum
{
kNeedNewImageUniqueID
=
0
}
;
class
SkImage_Base
:
public
SkImage
{
public
:
SkImage_Base
(
int
width
int
height
uint32_t
uniqueID
)
;
virtual
~
SkImage_Base
(
)
;
virtual
SkImageInfo
onImageInfo
(
)
const
=
0
;
virtual
SkAlphaType
onAlphaType
(
)
const
=
0
;
virtual
bool
onPeekPixels
(
SkPixmap
*
)
const
{
return
false
;
}
virtual
const
SkBitmap
*
onPeekBitmap
(
)
const
{
return
nullptr
;
}
virtual
bool
onReadPixels
(
const
SkImageInfo
&
dstInfo
void
*
dstPixels
size_t
dstRowBytes
int
srcX
int
srcY
CachingHint
)
const
;
virtual
GrTexture
*
peekTexture
(
)
const
{
return
nullptr
;
}
#
if
SK_SUPPORT_GPU
virtual
sk_sp
<
GrTexture
>
refPinnedTexture
(
uint32_t
*
uniqueID
)
const
{
return
nullptr
;
}
#
endif
virtual
SkImageCacherator
*
peekCacherator
(
)
const
{
return
nullptr
;
}
virtual
bool
getROPixels
(
SkBitmap
*
CachingHint
=
kAllow_CachingHint
)
const
=
0
;
virtual
GrTexture
*
asTextureRef
(
GrContext
*
const
GrTextureParams
&
SkSourceGammaTreatment
)
const
=
0
;
virtual
sk_sp
<
SkImage
>
onMakeSubset
(
const
SkIRect
&
)
const
=
0
;
virtual
SkData
*
onRefEncoded
(
GrContext
*
)
const
{
return
nullptr
;
}
virtual
bool
onAsLegacyBitmap
(
SkBitmap
*
LegacyBitmapMode
)
const
;
virtual
bool
onIsLazyGenerated
(
)
const
{
return
false
;
}
void
notifyAddedToCache
(
)
const
{
fAddedToCache
.
store
(
true
)
;
}
virtual
void
onPinAsTexture
(
GrContext
*
)
const
{
}
virtual
void
onUnpinAsTexture
(
GrContext
*
)
const
{
}
private
:
mutable
SkAtomic
<
bool
>
fAddedToCache
;
typedef
SkImage
INHERITED
;
}
;
static
inline
SkImage_Base
*
as_IB
(
SkImage
*
image
)
{
return
static_cast
<
SkImage_Base
*
>
(
image
)
;
}
static
inline
SkImage_Base
*
as_IB
(
const
sk_sp
<
SkImage
>
&
image
)
{
return
static_cast
<
SkImage_Base
*
>
(
image
.
get
(
)
)
;
}
static
inline
const
SkImage_Base
*
as_IB
(
const
SkImage
*
image
)
{
return
static_cast
<
const
SkImage_Base
*
>
(
image
)
;
}
#
endif
