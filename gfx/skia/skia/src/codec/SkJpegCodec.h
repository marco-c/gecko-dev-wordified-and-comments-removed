#
ifndef
SkJpegCodec_DEFINED
#
define
SkJpegCodec_DEFINED
#
include
"
include
/
codec
/
SkCodec
.
h
"
#
include
"
include
/
codec
/
SkEncodedImageFormat
.
h
"
#
include
"
include
/
codec
/
SkEncodedOrigin
.
h
"
#
include
"
include
/
core
/
SkRect
.
h
"
#
include
"
include
/
core
/
SkSize
.
h
"
#
include
"
include
/
core
/
SkTypes
.
h
"
#
include
"
include
/
core
/
SkYUVAPixmaps
.
h
"
#
include
"
include
/
private
/
SkEncodedInfo
.
h
"
#
include
"
include
/
private
/
base
/
SkTemplates
.
h
"
#
include
<
cstddef
>
#
include
<
cstdint
>
#
include
<
memory
>
class
JpegDecoderMgr
;
class
SkSampler
;
class
SkStream
;
class
SkSwizzler
;
struct
SkGainmapInfo
;
struct
SkImageInfo
;
class
SkJpegCodec
:
public
SkCodec
{
public
:
~
SkJpegCodec
(
)
override
;
static
bool
IsJpeg
(
const
void
*
size_t
)
;
static
std
:
:
unique_ptr
<
SkCodec
>
MakeFromStream
(
std
:
:
unique_ptr
<
SkStream
>
Result
*
)
;
protected
:
SkISize
onGetScaledDimensions
(
float
desiredScale
)
const
override
;
Result
onGetPixels
(
const
SkImageInfo
&
dstInfo
void
*
dst
size_t
dstRowBytes
const
Options
&
int
*
)
override
;
bool
onQueryYUVAInfo
(
const
SkYUVAPixmapInfo
:
:
SupportedDataTypes
&
SkYUVAPixmapInfo
*
)
const
override
;
Result
onGetYUVAPlanes
(
const
SkYUVAPixmaps
&
yuvaPixmaps
)
override
;
SkEncodedImageFormat
onGetEncodedFormat
(
)
const
override
{
return
SkEncodedImageFormat
:
:
kJPEG
;
}
bool
onRewind
(
)
override
;
bool
onDimensionsSupported
(
const
SkISize
&
)
override
;
bool
conversionSupported
(
const
SkImageInfo
&
bool
bool
)
override
;
bool
onGetGainmapInfo
(
SkGainmapInfo
*
info
std
:
:
unique_ptr
<
SkStream
>
*
gainmapImageStream
)
override
;
private
:
static
std
:
:
unique_ptr
<
SkCodec
>
MakeFromStream
(
std
:
:
unique_ptr
<
SkStream
>
Result
*
std
:
:
unique_ptr
<
SkEncodedInfo
:
:
ICCProfile
>
defaultColorProfile
)
;
static
Result
ReadHeader
(
SkStream
*
stream
SkCodec
*
*
codecOut
JpegDecoderMgr
*
*
decoderMgrOut
std
:
:
unique_ptr
<
SkEncodedInfo
:
:
ICCProfile
>
defaultColorProfile
)
;
SkJpegCodec
(
SkEncodedInfo
&
&
info
std
:
:
unique_ptr
<
SkStream
>
stream
JpegDecoderMgr
*
decoderMgr
SkEncodedOrigin
origin
)
;
void
initializeSwizzler
(
const
SkImageInfo
&
dstInfo
const
Options
&
options
bool
needsCMYKToRGB
)
;
[
[
nodiscard
]
]
bool
allocateStorage
(
const
SkImageInfo
&
dstInfo
)
;
int
readRows
(
const
SkImageInfo
&
dstInfo
void
*
dst
size_t
rowBytes
int
count
const
Options
&
)
;
SkSampler
*
getSampler
(
bool
createIfNecessary
)
override
;
Result
onStartScanlineDecode
(
const
SkImageInfo
&
dstInfo
const
Options
&
options
)
override
;
int
onGetScanlines
(
void
*
dst
int
count
size_t
rowBytes
)
override
;
bool
onSkipScanlines
(
int
count
)
override
;
std
:
:
unique_ptr
<
JpegDecoderMgr
>
fDecoderMgr
;
const
int
fReadyState
;
skia_private
:
:
AutoTMalloc
<
uint8_t
>
fStorage
;
uint8_t
*
fSwizzleSrcRow
=
nullptr
;
uint32_t
*
fColorXformSrcRow
=
nullptr
;
SkIRect
fSwizzlerSubset
=
SkIRect
:
:
MakeEmpty
(
)
;
std
:
:
unique_ptr
<
SkSwizzler
>
fSwizzler
;
friend
class
SkRawCodec
;
using
INHERITED
=
SkCodec
;
}
;
#
endif
