#
ifndef
SkSwizzler_DEFINED
#
define
SkSwizzler_DEFINED
#
include
"
SkCodec
.
h
"
#
include
"
SkColor
.
h
"
#
include
"
SkImageInfo
.
h
"
#
include
"
SkSampler
.
h
"
class
SkSwizzler
:
public
SkSampler
{
public
:
enum
SrcConfig
{
kUnknown
kBit
kGray
kIndex1
kIndex2
kIndex4
kIndex
kRGB
kBGR
kRGBX
kBGRX
kRGBA
kBGRA
kRGB_565
kCMYK
}
;
typedef
uint16_t
ResultAlpha
;
static
const
ResultAlpha
kOpaque_ResultAlpha
=
0xFFFF
;
static
const
ResultAlpha
kTransparent_ResultAlpha
=
0x0000
;
static
bool
IsTransparent
(
ResultAlpha
r
)
{
return
kTransparent_ResultAlpha
=
=
r
;
}
static
bool
IsOpaque
(
ResultAlpha
r
)
{
return
kOpaque_ResultAlpha
=
=
r
;
}
static
ResultAlpha
GetResult
(
uint8_t
zeroAlpha
uint8_t
maxAlpha
)
;
static
int
BitsPerPixel
(
SrcConfig
sc
)
{
switch
(
sc
)
{
case
kBit
:
case
kIndex1
:
return
1
;
case
kIndex2
:
return
2
;
case
kIndex4
:
return
4
;
case
kGray
:
case
kIndex
:
return
8
;
case
kRGB_565
:
return
16
;
case
kRGB
:
case
kBGR
:
return
24
;
case
kRGBX
:
case
kRGBA
:
case
kBGRX
:
case
kBGRA
:
case
kCMYK
:
return
32
;
default
:
SkASSERT
(
false
)
;
return
0
;
}
}
static
int
BytesPerPixel
(
SrcConfig
sc
)
{
SkASSERT
(
SkIsAlign8
(
BitsPerPixel
(
sc
)
)
)
;
return
BitsPerPixel
(
sc
)
>
>
3
;
}
static
SkSwizzler
*
CreateSwizzler
(
SrcConfig
const
SkPMColor
*
ctable
const
SkImageInfo
&
dstInfo
const
SkCodec
:
:
Options
&
const
SkIRect
*
frame
=
nullptr
)
;
ResultAlpha
swizzle
(
void
*
dst
const
uint8_t
*
SK_RESTRICT
src
)
;
void
fill
(
const
SkImageInfo
&
info
void
*
dst
size_t
rowBytes
uint32_t
colorOrIndex
SkCodec
:
:
ZeroInitialized
zeroInit
)
override
{
const
SkImageInfo
fillInfo
=
info
.
makeWH
(
fAllocatedWidth
info
.
height
(
)
)
;
SkSampler
:
:
Fill
(
fillInfo
dst
rowBytes
colorOrIndex
zeroInit
)
;
}
private
:
typedef
ResultAlpha
(
*
RowProc
)
(
void
*
SK_RESTRICT
dstRow
const
uint8_t
*
SK_RESTRICT
src
int
dstWidth
int
bpp
int
deltaSrc
int
offset
const
SkPMColor
ctable
[
]
)
;
const
RowProc
fRowProc
;
const
SkPMColor
*
fColorTable
;
const
int
fSrcOffset
;
const
int
fDstOffset
;
int
fSrcOffsetUnits
;
int
fDstOffsetBytes
;
const
int
fSrcWidth
;
const
int
fDstWidth
;
int
fSwizzleWidth
;
int
fAllocatedWidth
;
int
fSampleX
;
const
int
fSrcBPP
;
const
int
fDstBPP
;
SkSwizzler
(
RowProc
proc
const
SkPMColor
*
ctable
int
srcOffset
int
srcWidth
int
dstOffset
int
dstWidth
int
srcBPP
int
dstBPP
)
;
int
onSetSampleX
(
int
)
override
;
}
;
#
endif
