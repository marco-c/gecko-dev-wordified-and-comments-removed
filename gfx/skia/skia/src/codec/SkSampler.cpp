#
include
"
SkCodec
.
h
"
#
include
"
SkCodecPriv
.
h
"
#
include
"
SkSampler
.
h
"
#
include
"
SkUtils
.
h
"
void
SkSampler
:
:
Fill
(
const
SkImageInfo
&
info
void
*
dst
size_t
rowBytes
uint32_t
colorOrIndex
SkCodec
:
:
ZeroInitialized
zeroInit
)
{
SkASSERT
(
dst
!
=
nullptr
)
;
const
size_t
bytesToFill
=
info
.
getSafeSize
(
rowBytes
)
;
const
int
width
=
info
.
width
(
)
;
const
int
numRows
=
info
.
height
(
)
;
switch
(
info
.
colorType
(
)
)
{
case
kN32_SkColorType
:
{
uint32_t
color
=
colorOrIndex
;
if
(
SkCodec
:
:
kYes_ZeroInitialized
=
=
zeroInit
&
&
0
=
=
color
)
{
return
;
}
if
(
SkIsAlign4
(
(
size_t
)
dst
)
&
&
SkIsAlign4
(
rowBytes
)
)
{
sk_memset32
(
(
uint32_t
*
)
dst
color
(
uint32_t
)
bytesToFill
/
sizeof
(
SkPMColor
)
)
;
}
else
{
SkCodecPrintf
(
"
Warning
:
Strange
number
of
row
bytes
fill
will
be
slow
.
\
n
"
)
;
uint32_t
*
dstRow
=
(
uint32_t
*
)
dst
;
for
(
int
row
=
0
;
row
<
numRows
;
row
+
+
)
{
for
(
int
col
=
0
;
col
<
width
;
col
+
+
)
{
dstRow
[
col
]
=
color
;
}
dstRow
=
SkTAddOffset
<
uint32_t
>
(
dstRow
rowBytes
)
;
}
}
break
;
}
case
kRGB_565_SkColorType
:
{
uint16_t
color
=
(
uint16_t
)
colorOrIndex
;
if
(
SkCodec
:
:
kYes_ZeroInitialized
=
=
zeroInit
&
&
0
=
=
color
)
{
return
;
}
if
(
SkIsAlign2
(
(
size_t
)
dst
)
&
&
SkIsAlign2
(
rowBytes
)
)
{
sk_memset16
(
(
uint16_t
*
)
dst
color
(
uint32_t
)
bytesToFill
/
sizeof
(
uint16_t
)
)
;
}
else
{
SkCodecPrintf
(
"
Warning
:
Strange
number
of
row
bytes
fill
will
be
slow
.
\
n
"
)
;
uint16_t
*
dstRow
=
(
uint16_t
*
)
dst
;
for
(
int
row
=
0
;
row
<
numRows
;
row
+
+
)
{
for
(
int
col
=
0
;
col
<
width
;
col
+
+
)
{
dstRow
[
col
]
=
color
;
}
dstRow
=
SkTAddOffset
<
uint16_t
>
(
dstRow
rowBytes
)
;
}
}
break
;
}
case
kIndex_8_SkColorType
:
case
kGray_8_SkColorType
:
if
(
SkCodec
:
:
kYes_ZeroInitialized
=
=
zeroInit
&
&
0
=
=
(
uint8_t
)
colorOrIndex
)
{
return
;
}
memset
(
dst
(
uint8_t
)
colorOrIndex
bytesToFill
)
;
break
;
default
:
SkCodecPrintf
(
"
Error
:
Unsupported
dst
color
type
for
fill
(
)
.
Doing
nothing
.
\
n
"
)
;
SkASSERT
(
false
)
;
break
;
}
}
