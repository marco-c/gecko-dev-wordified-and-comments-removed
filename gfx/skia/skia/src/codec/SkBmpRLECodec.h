#
ifndef
SkBmpRLECodec_DEFINED
#
define
SkBmpRLECodec_DEFINED
#
include
"
include
/
core
/
SkImageInfo
.
h
"
#
include
"
include
/
core
/
SkTypes
.
h
"
#
include
"
src
/
codec
/
SkBmpCodec
.
h
"
#
include
"
src
/
codec
/
SkColorTable
.
h
"
#
include
"
src
/
codec
/
SkSampler
.
h
"
class
SkBmpRLECodec
:
public
SkBmpCodec
{
public
:
SkBmpRLECodec
(
SkEncodedInfo
&
&
info
std
:
:
unique_ptr
<
SkStream
>
uint16_t
bitsPerPixel
uint32_t
numColors
uint32_t
bytesPerColor
uint32_t
offset
SkCodec
:
:
SkScanlineOrder
rowOrder
)
;
int
setSampleX
(
int
)
;
int
fillWidth
(
)
const
;
protected
:
Result
onGetPixels
(
const
SkImageInfo
&
dstInfo
void
*
dst
size_t
dstRowBytes
const
Options
&
int
*
)
override
;
SkCodec
:
:
Result
onPrepareToDecode
(
const
SkImageInfo
&
dstInfo
const
SkCodec
:
:
Options
&
options
)
override
;
private
:
bool
createColorTable
(
SkColorType
dstColorType
)
;
bool
initializeStreamBuffer
(
)
;
size_t
checkForMoreData
(
)
;
void
setPixel
(
void
*
dst
size_t
dstRowBytes
const
SkImageInfo
&
dstInfo
uint32_t
x
uint32_t
y
uint8_t
index
)
;
void
setRGBPixel
(
void
*
dst
size_t
dstRowBytes
const
SkImageInfo
&
dstInfo
uint32_t
x
uint32_t
y
uint8_t
red
uint8_t
green
uint8_t
blue
)
;
int
decodeRows
(
const
SkImageInfo
&
dstInfo
void
*
dst
size_t
dstRowBytes
const
Options
&
opts
)
override
;
int
decodeRLE
(
const
SkImageInfo
&
dstInfo
void
*
dst
size_t
dstRowBytes
)
;
bool
skipRows
(
int
count
)
override
;
SkSampler
*
getSampler
(
bool
createIfNecessary
)
override
;
sk_sp
<
SkColorTable
>
fColorTable
;
const
uint32_t
fNumColors
;
const
uint32_t
fBytesPerColor
;
const
uint32_t
fOffset
;
static
constexpr
size_t
kBufferSize
=
4096
;
uint8_t
fStreamBuffer
[
kBufferSize
]
;
size_t
fBytesBuffered
;
uint32_t
fCurrRLEByte
;
int
fSampleX
;
std
:
:
unique_ptr
<
SkSampler
>
fSampler
;
int
fLinesToSkip
;
typedef
SkBmpCodec
INHERITED
;
}
;
#
endif
