#
include
"
SkPDFFormXObject
.
h
"
#
include
"
SkMatrix
.
h
"
#
include
"
SkPDFDevice
.
h
"
#
include
"
SkPDFUtils
.
h
"
#
include
"
SkStream
.
h
"
#
include
"
SkTypes
.
h
"
SkPDFFormXObject
:
:
SkPDFFormXObject
(
SkPDFDevice
*
device
)
{
SkAutoTUnref
<
SkPDFDict
>
resourceDict
(
device
-
>
createResourceDict
(
)
)
;
SkAutoTDelete
<
SkStreamAsset
>
content
(
device
-
>
content
(
)
)
;
this
-
>
setData
(
content
.
get
(
)
)
;
SkAutoTUnref
<
SkPDFArray
>
bboxArray
(
device
-
>
copyMediaBox
(
)
)
;
this
-
>
init
(
nullptr
resourceDict
.
get
(
)
bboxArray
)
;
if
(
!
device
-
>
initialTransform
(
)
.
isIdentity
(
)
)
{
SkMatrix
inverse
;
if
(
!
device
-
>
initialTransform
(
)
.
invert
(
&
inverse
)
)
{
SkASSERT
(
false
)
;
inverse
.
reset
(
)
;
}
this
-
>
insertObject
(
"
Matrix
"
SkPDFUtils
:
:
MatrixToArray
(
inverse
)
)
;
}
}
SkPDFFormXObject
:
:
SkPDFFormXObject
(
SkStream
*
content
SkRect
bbox
SkPDFDict
*
resourceDict
)
{
setData
(
content
)
;
SkAutoTUnref
<
SkPDFArray
>
bboxArray
(
SkPDFUtils
:
:
RectToArray
(
bbox
)
)
;
init
(
"
DeviceRGB
"
resourceDict
bboxArray
)
;
}
void
SkPDFFormXObject
:
:
init
(
const
char
*
colorSpace
SkPDFDict
*
resourceDict
SkPDFArray
*
bbox
)
{
this
-
>
insertName
(
"
Type
"
"
XObject
"
)
;
this
-
>
insertName
(
"
Subtype
"
"
Form
"
)
;
this
-
>
insertObject
(
"
Resources
"
SkRef
(
resourceDict
)
)
;
this
-
>
insertObject
(
"
BBox
"
SkRef
(
bbox
)
)
;
SkAutoTUnref
<
SkPDFDict
>
group
(
new
SkPDFDict
(
"
Group
"
)
)
;
group
-
>
insertName
(
"
S
"
"
Transparency
"
)
;
if
(
colorSpace
!
=
nullptr
)
{
group
-
>
insertName
(
"
CS
"
colorSpace
)
;
}
group
-
>
insertBool
(
"
I
"
true
)
;
this
-
>
insertObject
(
"
Group
"
group
.
detach
(
)
)
;
}
SkPDFFormXObject
:
:
~
SkPDFFormXObject
(
)
{
}
