#
ifndef
SkPDFDocument_DEFINED
#
define
SkPDFDocument_DEFINED
#
include
"
SkDocument
.
h
"
#
include
"
SkPDFCanon
.
h
"
#
include
"
SkPDFMetadata
.
h
"
#
include
"
SkPDFFont
.
h
"
class
SkPDFDevice
;
sk_sp
<
SkDocument
>
SkPDFMakeDocument
(
SkWStream
*
stream
void
(
*
doneProc
)
(
SkWStream
*
bool
)
SkScalar
rasterDpi
const
SkDocument
:
:
PDFMetadata
&
sk_sp
<
SkPixelSerializer
>
bool
pdfa
)
;
struct
SkPDFObjectSerializer
:
SkNoncopyable
{
SkPDFObjNumMap
fObjNumMap
;
SkTDArray
<
int32_t
>
fOffsets
;
sk_sp
<
SkPDFObject
>
fInfoDict
;
size_t
fBaseOffset
;
int32_t
fNextToBeSerialized
;
SkPDFObjectSerializer
(
)
;
~
SkPDFObjectSerializer
(
)
;
void
addObjectRecursively
(
const
sk_sp
<
SkPDFObject
>
&
)
;
void
serializeHeader
(
SkWStream
*
const
SkDocument
:
:
PDFMetadata
&
)
;
void
serializeObjects
(
SkWStream
*
)
;
void
serializeFooter
(
SkWStream
*
const
sk_sp
<
SkPDFObject
>
sk_sp
<
SkPDFObject
>
)
;
int32_t
offset
(
SkWStream
*
)
;
}
;
class
SkPDFDocument
:
public
SkDocument
{
public
:
SkPDFDocument
(
SkWStream
*
void
(
*
)
(
SkWStream
*
bool
)
SkScalar
const
SkDocument
:
:
PDFMetadata
&
sk_sp
<
SkPixelSerializer
>
bool
)
;
~
SkPDFDocument
(
)
override
;
SkCanvas
*
onBeginPage
(
SkScalar
SkScalar
const
SkRect
&
)
override
;
void
onEndPage
(
)
override
;
void
onClose
(
SkWStream
*
)
override
;
void
onAbort
(
)
override
;
void
serialize
(
const
sk_sp
<
SkPDFObject
>
&
)
;
SkPDFCanon
*
canon
(
)
{
return
&
fCanon
;
}
void
registerFont
(
SkPDFFont
*
f
)
{
fFonts
.
add
(
f
)
;
}
private
:
SkPDFObjectSerializer
fObjectSerializer
;
SkPDFCanon
fCanon
;
SkTArray
<
sk_sp
<
SkPDFDict
>
>
fPages
;
SkTHashSet
<
SkPDFFont
*
>
fFonts
;
sk_sp
<
SkPDFDict
>
fDests
;
sk_sp
<
SkPDFDevice
>
fPageDevice
;
std
:
:
unique_ptr
<
SkCanvas
>
fCanvas
;
sk_sp
<
SkPDFObject
>
fID
;
sk_sp
<
SkPDFObject
>
fXMP
;
SkScalar
fRasterDpi
;
SkDocument
:
:
PDFMetadata
fMetadata
;
bool
fPDFA
;
void
reset
(
)
;
}
;
#
endif
