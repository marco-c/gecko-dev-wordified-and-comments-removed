#
ifndef
GrBackendTextureImageGenerator_DEFINED
#
define
GrBackendTextureImageGenerator_DEFINED
#
include
"
SkImageGenerator
.
h
"
#
include
"
GrBackendSurface
.
h
"
#
include
"
SkMutex
.
h
"
class
GrSemaphore
;
class
GrBackendTextureImageGenerator
:
public
SkImageGenerator
{
public
:
static
std
:
:
unique_ptr
<
SkImageGenerator
>
Make
(
sk_sp
<
GrTexture
>
GrSurfaceOrigin
sk_sp
<
GrSemaphore
>
SkAlphaType
sk_sp
<
SkColorSpace
>
)
;
~
GrBackendTextureImageGenerator
(
)
override
;
protected
:
bool
onIsValid
(
GrContext
*
)
const
override
{
return
true
;
}
#
if
SK_SUPPORT_GPU
TexGenType
onCanGenerateTexture
(
)
const
override
{
return
TexGenType
:
:
kCheap
;
}
sk_sp
<
GrTextureProxy
>
onGenerateTexture
(
GrContext
*
const
SkImageInfo
&
const
SkIPoint
&
SkTransferFunctionBehavior
bool
willNeedMipMaps
)
override
;
#
endif
private
:
GrBackendTextureImageGenerator
(
const
SkImageInfo
&
info
GrTexture
*
GrSurfaceOrigin
uint32_t
owningContextID
sk_sp
<
GrSemaphore
>
const
GrBackendTexture
&
)
;
static
void
ReleaseRefHelper_TextureReleaseProc
(
void
*
ctx
)
;
class
RefHelper
:
public
SkNVRefCnt
<
RefHelper
>
{
public
:
RefHelper
(
GrTexture
*
texture
uint32_t
owningContextID
)
:
fOriginalTexture
(
texture
)
fOwningContextID
(
owningContextID
)
fBorrowedTexture
(
nullptr
)
fBorrowingContextReleaseProc
(
nullptr
)
fBorrowingContextID
(
SK_InvalidGenID
)
{
}
~
RefHelper
(
)
;
GrTexture
*
fOriginalTexture
;
uint32_t
fOwningContextID
;
GrTexture
*
fBorrowedTexture
;
GrReleaseProcHelper
*
fBorrowingContextReleaseProc
;
uint32_t
fBorrowingContextID
;
}
;
RefHelper
*
fRefHelper
;
SkMutex
fBorrowingMutex
;
sk_sp
<
GrSemaphore
>
fSemaphore
;
GrBackendTexture
fBackendTexture
;
GrPixelConfig
fConfig
;
GrSurfaceOrigin
fSurfaceOrigin
;
typedef
SkImageGenerator
INHERITED
;
}
;
#
endif
