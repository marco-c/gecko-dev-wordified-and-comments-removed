#
include
"
src
/
gpu
/
GrGeometryProcessor
.
h
"
#
include
"
src
/
gpu
/
GrProcessorAnalysis
.
h
"
#
include
"
src
/
gpu
/
ops
/
GrDrawOp
.
h
"
GrColorFragmentProcessorAnalysis
:
:
GrColorFragmentProcessorAnalysis
(
const
GrProcessorAnalysisColor
&
input
const
GrFragmentProcessor
*
const
*
processors
int
cnt
)
{
fCompatibleWithCoverageAsAlpha
=
true
;
fIsOpaque
=
input
.
isOpaque
(
)
;
fUsesLocalCoords
=
false
;
fProcessorsToEliminate
=
0
;
fKnowOutputColor
=
input
.
isConstant
(
&
fLastKnownOutputColor
)
;
for
(
int
i
=
0
;
i
<
cnt
;
+
+
i
)
{
if
(
fUsesLocalCoords
&
&
!
fKnowOutputColor
&
&
!
fCompatibleWithCoverageAsAlpha
&
&
!
fIsOpaque
)
{
break
;
}
const
GrFragmentProcessor
*
fp
=
processors
[
i
]
;
if
(
fKnowOutputColor
&
&
fp
-
>
hasConstantOutputForConstantInput
(
fLastKnownOutputColor
&
fLastKnownOutputColor
)
)
{
+
+
fProcessorsToEliminate
;
fIsOpaque
=
fLastKnownOutputColor
.
isOpaque
(
)
;
fCompatibleWithCoverageAsAlpha
=
true
;
fUsesLocalCoords
=
false
;
}
else
{
fKnowOutputColor
=
false
;
if
(
fIsOpaque
&
&
!
fp
-
>
preservesOpaqueInput
(
)
)
{
fIsOpaque
=
false
;
}
if
(
fCompatibleWithCoverageAsAlpha
&
&
!
fp
-
>
compatibleWithCoverageAsAlpha
(
)
)
{
fCompatibleWithCoverageAsAlpha
=
false
;
}
if
(
fp
-
>
usesLocalCoords
(
)
)
{
fUsesLocalCoords
=
true
;
}
}
}
}
