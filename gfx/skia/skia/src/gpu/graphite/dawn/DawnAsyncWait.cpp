#
include
"
src
/
gpu
/
graphite
/
dawn
/
DawnAsyncWait
.
h
"
#
ifdef
__EMSCRIPTEN__
#
include
<
emscripten
.
h
>
#
endif
namespace
skgpu
:
:
graphite
{
namespace
{
#
ifdef
__EMSCRIPTEN__
EM_ASYNC_JS
(
void
asyncSleep
(
)
{
await
new
Promise
(
(
resolve
_
)
=
>
{
setTimeout
(
resolve
0
)
;
}
)
}
)
;
#
endif
}
DawnAsyncWait
:
:
DawnAsyncWait
(
const
wgpu
:
:
Device
&
device
)
:
fDevice
(
device
)
fSignaled
(
false
)
{
}
bool
DawnAsyncWait
:
:
yieldAndCheck
(
)
const
{
if
(
fSignaled
.
load
(
)
)
{
return
true
;
}
#
ifdef
__EMSCRIPTEN__
asyncSleep
(
)
;
#
else
fDevice
.
Tick
(
)
;
#
endif
return
fSignaled
.
load
(
)
;
}
void
DawnAsyncWait
:
:
busyWait
(
)
const
{
while
(
!
this
-
>
yieldAndCheck
(
)
)
{
}
}
}
