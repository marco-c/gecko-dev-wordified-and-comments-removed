#
ifndef
GrGpuCommandBuffer_DEFINED
#
define
GrGpuCommandBuffer_DEFINED
#
include
"
GrColor
.
h
"
#
include
"
GrPipeline
.
h
"
#
include
"
ops
/
GrDrawOp
.
h
"
class
GrOpFlushState
;
class
GrFixedClip
;
class
GrGpu
;
class
GrMesh
;
class
GrPipeline
;
class
GrPrimitiveProcessor
;
class
GrRenderTarget
;
struct
SkIRect
;
struct
SkRect
;
class
GrGpuRTCommandBuffer
;
class
GrGpuCommandBuffer
{
public
:
virtual
~
GrGpuCommandBuffer
(
)
{
}
virtual
void
copy
(
GrSurface
*
src
GrSurfaceOrigin
srcOrigin
const
SkIRect
&
srcRect
const
SkIPoint
&
dstPoint
)
=
0
;
virtual
void
insertEventMarker
(
const
char
*
)
=
0
;
virtual
GrGpuRTCommandBuffer
*
asRTCommandBuffer
(
)
{
return
nullptr
;
}
}
;
class
GrGpuTextureCommandBuffer
:
public
GrGpuCommandBuffer
{
public
:
void
set
(
GrTexture
*
texture
GrSurfaceOrigin
origin
)
{
SkASSERT
(
!
fTexture
)
;
fOrigin
=
origin
;
fTexture
=
texture
;
}
protected
:
GrGpuTextureCommandBuffer
(
)
:
fOrigin
(
kTopLeft_GrSurfaceOrigin
)
fTexture
(
nullptr
)
{
}
GrGpuTextureCommandBuffer
(
GrTexture
*
texture
GrSurfaceOrigin
origin
)
:
fOrigin
(
origin
)
fTexture
(
texture
)
{
}
GrSurfaceOrigin
fOrigin
;
GrTexture
*
fTexture
;
private
:
typedef
GrGpuCommandBuffer
INHERITED
;
}
;
class
GrGpuRTCommandBuffer
:
public
GrGpuCommandBuffer
{
public
:
struct
LoadAndStoreInfo
{
GrLoadOp
fLoadOp
;
GrStoreOp
fStoreOp
;
GrColor
fClearColor
;
}
;
struct
StencilLoadAndStoreInfo
{
GrLoadOp
fLoadOp
;
GrStoreOp
fStoreOp
;
}
;
GrGpuRTCommandBuffer
*
asRTCommandBuffer
(
)
{
return
this
;
}
virtual
void
begin
(
)
=
0
;
virtual
void
end
(
)
=
0
;
bool
draw
(
const
GrPrimitiveProcessor
&
const
GrPipeline
&
const
GrPipeline
:
:
FixedDynamicState
*
const
GrPipeline
:
:
DynamicStateArrays
*
const
GrMesh
[
]
int
meshCount
const
SkRect
&
bounds
)
;
virtual
void
inlineUpload
(
GrOpFlushState
*
GrDeferredTextureUploadFn
&
)
=
0
;
void
clear
(
const
GrFixedClip
&
GrColor
)
;
void
clearStencilClip
(
const
GrFixedClip
&
bool
insideStencilMask
)
;
virtual
void
discard
(
)
=
0
;
protected
:
GrGpuRTCommandBuffer
(
)
:
fOrigin
(
kTopLeft_GrSurfaceOrigin
)
fRenderTarget
(
nullptr
)
{
}
GrGpuRTCommandBuffer
(
GrRenderTarget
*
rt
GrSurfaceOrigin
origin
)
:
fOrigin
(
origin
)
fRenderTarget
(
rt
)
{
}
void
set
(
GrRenderTarget
*
rt
GrSurfaceOrigin
origin
)
{
SkASSERT
(
!
fRenderTarget
)
;
fRenderTarget
=
rt
;
fOrigin
=
origin
;
}
GrSurfaceOrigin
fOrigin
;
GrRenderTarget
*
fRenderTarget
;
private
:
virtual
GrGpu
*
gpu
(
)
=
0
;
virtual
void
onDraw
(
const
GrPrimitiveProcessor
&
const
GrPipeline
&
const
GrPipeline
:
:
FixedDynamicState
*
const
GrPipeline
:
:
DynamicStateArrays
*
const
GrMesh
[
]
int
meshCount
const
SkRect
&
bounds
)
=
0
;
virtual
void
onClear
(
const
GrFixedClip
&
GrColor
)
=
0
;
virtual
void
onClearStencilClip
(
const
GrFixedClip
&
bool
insideStencilMask
)
=
0
;
typedef
GrGpuCommandBuffer
INHERITED
;
}
;
#
endif
