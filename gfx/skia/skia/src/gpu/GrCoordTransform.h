#
ifndef
GrCoordTransform_DEFINED
#
define
GrCoordTransform_DEFINED
#
include
"
include
/
core
/
SkMatrix
.
h
"
#
include
"
src
/
gpu
/
GrSurfaceProxyPriv
.
h
"
#
include
"
src
/
gpu
/
GrTextureProxy
.
h
"
class
GrTexture
;
class
GrCoordTransform
{
public
:
GrCoordTransform
(
)
:
fProxy
(
nullptr
)
fNormalize
(
false
)
fReverseY
(
false
)
fComputeInVertexShader
(
true
)
{
SkDEBUGCODE
(
fInProcessor
=
false
)
;
}
GrCoordTransform
(
const
GrCoordTransform
&
)
=
default
;
GrCoordTransform
(
GrTextureProxy
*
proxy
)
{
SkASSERT
(
proxy
)
;
SkDEBUGCODE
(
fInProcessor
=
false
)
;
this
-
>
reset
(
SkMatrix
:
:
I
(
)
proxy
)
;
}
GrCoordTransform
(
const
SkMatrix
&
m
GrTextureProxy
*
proxy
)
{
SkASSERT
(
proxy
)
;
SkDEBUGCODE
(
fInProcessor
=
false
)
;
this
-
>
reset
(
m
proxy
)
;
}
GrCoordTransform
(
const
SkMatrix
&
m
)
{
SkDEBUGCODE
(
fInProcessor
=
false
)
;
this
-
>
reset
(
m
)
;
}
GrCoordTransform
&
operator
=
(
const
GrCoordTransform
&
that
)
{
SkASSERT
(
!
fInProcessor
)
;
fMatrix
=
that
.
fMatrix
;
fProxy
=
that
.
fProxy
;
fNormalize
=
that
.
fNormalize
;
fReverseY
=
that
.
fReverseY
;
return
*
this
;
}
SkMatrix
*
accessMatrix
(
)
{
SkASSERT
(
!
fInProcessor
)
;
return
&
fMatrix
;
}
bool
hasSameEffectAs
(
const
GrCoordTransform
&
that
)
const
{
if
(
fNormalize
!
=
that
.
fNormalize
|
|
fReverseY
!
=
that
.
fReverseY
|
|
!
fMatrix
.
cheapEqualTo
(
that
.
fMatrix
)
)
{
return
false
;
}
if
(
fNormalize
)
{
if
(
fProxy
-
>
underlyingUniqueID
(
)
!
=
that
.
fProxy
-
>
underlyingUniqueID
(
)
)
{
return
false
;
}
}
return
true
;
}
const
SkMatrix
&
getMatrix
(
)
const
{
return
fMatrix
;
}
const
GrTextureProxy
*
proxy
(
)
const
{
return
fProxy
;
}
bool
normalize
(
)
const
{
return
fNormalize
;
}
bool
reverseY
(
)
const
{
return
fReverseY
;
}
GrTexture
*
peekTexture
(
)
const
{
return
fProxy
-
>
peekTexture
(
)
;
}
bool
computeInVertexShader
(
)
const
{
return
fComputeInVertexShader
;
}
void
setComputeInVertexShader
(
bool
computeInVertexShader
)
{
fComputeInVertexShader
=
computeInVertexShader
;
}
private
:
void
reset
(
const
SkMatrix
&
m
GrTextureProxy
*
proxy
=
nullptr
)
{
SkASSERT
(
!
fInProcessor
)
;
fMatrix
=
m
;
fProxy
=
proxy
;
fNormalize
=
proxy
&
&
proxy
-
>
textureType
(
)
!
=
GrTextureType
:
:
kRectangle
;
fReverseY
=
proxy
&
&
kBottomLeft_GrSurfaceOrigin
=
=
proxy
-
>
origin
(
)
;
fComputeInVertexShader
=
true
;
}
bool
operator
=
=
(
const
GrCoordTransform
&
that
)
const
;
bool
operator
!
=
(
const
GrCoordTransform
&
that
)
const
;
SkMatrix
fMatrix
;
const
GrTextureProxy
*
fProxy
;
bool
fNormalize
;
bool
fReverseY
;
bool
fComputeInVertexShader
;
#
ifdef
SK_DEBUG
public
:
void
setInProcessor
(
)
const
{
fInProcessor
=
true
;
}
private
:
mutable
bool
fInProcessor
;
#
endif
}
;
#
endif
