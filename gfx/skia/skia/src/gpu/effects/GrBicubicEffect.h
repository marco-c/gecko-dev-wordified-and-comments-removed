#
ifndef
GrBicubicTextureEffect_DEFINED
#
define
GrBicubicTextureEffect_DEFINED
#
include
"
GrSingleTextureEffect
.
h
"
#
include
"
GrTextureDomain
.
h
"
#
include
"
glsl
/
GrGLSLFragmentProcessor
.
h
"
class
GrGLBicubicEffect
;
class
GrInvariantOutput
;
class
GrBicubicEffect
:
public
GrSingleTextureEffect
{
public
:
enum
{
kFilterTexelPad
=
2
}
;
virtual
~
GrBicubicEffect
(
)
;
const
float
*
coefficients
(
)
const
{
return
fCoefficients
;
}
const
char
*
name
(
)
const
override
{
return
"
Bicubic
"
;
}
const
GrTextureDomain
&
domain
(
)
const
{
return
fDomain
;
}
GrColorSpaceXform
*
colorSpaceXform
(
)
const
{
return
fColorSpaceXform
.
get
(
)
;
}
static
sk_sp
<
GrFragmentProcessor
>
Make
(
GrTexture
*
tex
sk_sp
<
GrColorSpaceXform
>
colorSpaceXform
const
SkScalar
coefficients
[
16
]
const
SkRect
*
domain
=
nullptr
)
{
if
(
nullptr
=
=
domain
)
{
static
const
SkShader
:
:
TileMode
kTileModes
[
]
=
{
SkShader
:
:
kClamp_TileMode
SkShader
:
:
kClamp_TileMode
}
;
return
Make
(
tex
std
:
:
move
(
colorSpaceXform
)
coefficients
GrCoordTransform
:
:
MakeDivByTextureWHMatrix
(
tex
)
kTileModes
)
;
}
else
{
return
sk_sp
<
GrFragmentProcessor
>
(
new
GrBicubicEffect
(
tex
std
:
:
move
(
colorSpaceXform
)
coefficients
GrCoordTransform
:
:
MakeDivByTextureWHMatrix
(
tex
)
*
domain
)
)
;
}
}
static
sk_sp
<
GrFragmentProcessor
>
Make
(
GrTexture
*
tex
sk_sp
<
GrColorSpaceXform
>
colorSpaceXform
const
SkMatrix
&
matrix
const
SkShader
:
:
TileMode
tileModes
[
2
]
)
{
return
Make
(
tex
std
:
:
move
(
colorSpaceXform
)
gMitchellCoefficients
matrix
tileModes
)
;
}
static
sk_sp
<
GrFragmentProcessor
>
Make
(
GrTexture
*
tex
sk_sp
<
GrColorSpaceXform
>
colorSpaceXform
const
SkScalar
coefficients
[
16
]
const
SkMatrix
&
matrix
const
SkShader
:
:
TileMode
tileModes
[
2
]
)
{
return
sk_sp
<
GrFragmentProcessor
>
(
new
GrBicubicEffect
(
tex
std
:
:
move
(
colorSpaceXform
)
coefficients
matrix
tileModes
)
)
;
}
static
sk_sp
<
GrFragmentProcessor
>
Make
(
GrTexture
*
tex
sk_sp
<
GrColorSpaceXform
>
colorSpaceXform
const
SkMatrix
&
matrix
const
SkRect
&
domain
)
{
return
sk_sp
<
GrFragmentProcessor
>
(
new
GrBicubicEffect
(
tex
std
:
:
move
(
colorSpaceXform
)
gMitchellCoefficients
matrix
domain
)
)
;
}
static
bool
ShouldUseBicubic
(
const
SkMatrix
&
localCoordsToDevice
GrTextureParams
:
:
FilterMode
*
filterMode
)
;
private
:
GrBicubicEffect
(
GrTexture
*
sk_sp
<
GrColorSpaceXform
>
const
SkScalar
coefficients
[
16
]
const
SkMatrix
&
matrix
const
SkShader
:
:
TileMode
tileModes
[
2
]
)
;
GrBicubicEffect
(
GrTexture
*
sk_sp
<
GrColorSpaceXform
>
const
SkScalar
coefficients
[
16
]
const
SkMatrix
&
matrix
const
SkRect
&
domain
)
;
GrGLSLFragmentProcessor
*
onCreateGLSLInstance
(
)
const
override
;
void
onGetGLSLProcessorKey
(
const
GrGLSLCaps
&
GrProcessorKeyBuilder
*
)
const
override
;
bool
onIsEqual
(
const
GrFragmentProcessor
&
)
const
override
;
void
onComputeInvariantOutput
(
GrInvariantOutput
*
inout
)
const
override
;
float
fCoefficients
[
16
]
;
GrTextureDomain
fDomain
;
sk_sp
<
GrColorSpaceXform
>
fColorSpaceXform
;
GR_DECLARE_FRAGMENT_PROCESSOR_TEST
;
static
const
SkScalar
gMitchellCoefficients
[
16
]
;
typedef
GrSingleTextureEffect
INHERITED
;
}
;
#
endif
