#
include
"
effects
/
GrDisableColorXP
.
h
"
#
include
"
GrPipeline
.
h
"
#
include
"
GrProcessor
.
h
"
#
include
"
glsl
/
GrGLSLFragmentShaderBuilder
.
h
"
#
include
"
glsl
/
GrGLSLProgramDataManager
.
h
"
#
include
"
glsl
/
GrGLSLXferProcessor
.
h
"
class
DisableColorXP
:
public
GrXferProcessor
{
public
:
static
GrXferProcessor
*
Create
(
)
{
return
new
DisableColorXP
;
}
~
DisableColorXP
(
)
override
{
}
;
const
char
*
name
(
)
const
override
{
return
"
Disable
Color
"
;
}
GrGLSLXferProcessor
*
createGLSLInstance
(
)
const
override
;
private
:
DisableColorXP
(
)
;
GrXferProcessor
:
:
OptFlags
onGetOptimizations
(
const
GrPipelineOptimizations
&
optimizations
bool
doesStencilWrite
GrColor
*
color
const
GrCaps
&
caps
)
const
override
{
return
GrXferProcessor
:
:
kIgnoreColor_OptFlag
|
GrXferProcessor
:
:
kIgnoreCoverage_OptFlag
;
}
void
onGetGLSLProcessorKey
(
const
GrGLSLCaps
&
caps
GrProcessorKeyBuilder
*
b
)
const
override
;
void
onGetBlendInfo
(
GrXferProcessor
:
:
BlendInfo
*
blendInfo
)
const
override
;
bool
onIsEqual
(
const
GrXferProcessor
&
xpBase
)
const
override
{
return
true
;
}
typedef
GrXferProcessor
INHERITED
;
}
;
class
GLDisableColorXP
:
public
GrGLSLXferProcessor
{
public
:
GLDisableColorXP
(
const
GrProcessor
&
)
{
}
~
GLDisableColorXP
(
)
override
{
}
static
void
GenKey
(
const
GrProcessor
&
const
GrGLSLCaps
&
GrProcessorKeyBuilder
*
)
{
}
private
:
void
emitOutputsForBlendState
(
const
EmitArgs
&
args
)
override
{
GrGLSLXPFragmentBuilder
*
fragBuilder
=
args
.
fXPFragBuilder
;
fragBuilder
-
>
codeAppendf
(
"
%
s
=
vec4
(
0
)
;
"
args
.
fOutputPrimary
)
;
}
void
onSetData
(
const
GrGLSLProgramDataManager
&
const
GrXferProcessor
&
)
override
{
}
typedef
GrGLSLXferProcessor
INHERITED
;
}
;
DisableColorXP
:
:
DisableColorXP
(
)
{
this
-
>
initClassID
<
DisableColorXP
>
(
)
;
}
void
DisableColorXP
:
:
onGetGLSLProcessorKey
(
const
GrGLSLCaps
&
caps
GrProcessorKeyBuilder
*
b
)
const
{
GLDisableColorXP
:
:
GenKey
(
*
this
caps
b
)
;
}
GrGLSLXferProcessor
*
DisableColorXP
:
:
createGLSLInstance
(
)
const
{
return
new
GLDisableColorXP
(
*
this
)
;
}
void
DisableColorXP
:
:
onGetBlendInfo
(
GrXferProcessor
:
:
BlendInfo
*
blendInfo
)
const
{
blendInfo
-
>
fWriteColor
=
false
;
}
GrDisableColorXPFactory
:
:
GrDisableColorXPFactory
(
)
{
this
-
>
initClassID
<
GrDisableColorXPFactory
>
(
)
;
}
GrXferProcessor
*
GrDisableColorXPFactory
:
:
onCreateXferProcessor
(
const
GrCaps
&
caps
const
GrPipelineOptimizations
&
optimizations
bool
hasMixedSamples
const
DstTexture
*
dst
)
const
{
SkASSERT
(
!
optimizations
.
fOverrides
.
fUsePLSDstRead
)
;
return
DisableColorXP
:
:
Create
(
)
;
}
GR_DEFINE_XP_FACTORY_TEST
(
GrDisableColorXPFactory
)
;
const
GrXPFactory
*
GrDisableColorXPFactory
:
:
TestCreate
(
GrProcessorTestData
*
)
{
return
GrDisableColorXPFactory
:
:
Create
(
)
;
}
