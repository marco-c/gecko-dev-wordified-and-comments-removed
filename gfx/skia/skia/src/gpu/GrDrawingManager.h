#
ifndef
GrDrawingManager_DEFINED
#
define
GrDrawingManager_DEFINED
#
include
"
GrPathRenderer
.
h
"
#
include
"
GrPathRendererChain
.
h
"
#
include
"
GrRenderTargetOpList
.
h
"
#
include
"
GrResourceCache
.
h
"
#
include
"
SkTArray
.
h
"
#
include
"
text
/
GrAtlasTextContext
.
h
"
class
GrContext
;
class
GrCoverageCountingPathRenderer
;
class
GrOnFlushCallbackObject
;
class
GrRenderTargetContext
;
class
GrRenderTargetProxy
;
class
GrSingleOWner
;
class
GrSoftwarePathRenderer
;
class
GrTextureContext
;
class
GrTextureOpList
;
class
GrDrawingManager
{
public
:
~
GrDrawingManager
(
)
;
bool
wasAbandoned
(
)
const
{
return
fAbandoned
;
}
void
freeGpuResources
(
)
;
sk_sp
<
GrRenderTargetContext
>
makeRenderTargetContext
(
sk_sp
<
GrSurfaceProxy
>
sk_sp
<
SkColorSpace
>
const
SkSurfaceProps
*
bool
managedOpList
=
true
)
;
sk_sp
<
GrTextureContext
>
makeTextureContext
(
sk_sp
<
GrSurfaceProxy
>
sk_sp
<
SkColorSpace
>
)
;
sk_sp
<
GrRenderTargetOpList
>
newRTOpList
(
GrRenderTargetProxy
*
rtp
bool
managedOpList
)
;
sk_sp
<
GrTextureOpList
>
newTextureOpList
(
GrTextureProxy
*
textureProxy
)
;
GrContext
*
getContext
(
)
{
return
fContext
;
}
GrAtlasTextContext
*
getAtlasTextContext
(
)
;
GrPathRenderer
*
getPathRenderer
(
const
GrPathRenderer
:
:
CanDrawPathArgs
&
args
bool
allowSW
GrPathRendererChain
:
:
DrawType
drawType
GrPathRenderer
:
:
StencilSupport
*
stencilSupport
=
nullptr
)
;
GrCoverageCountingPathRenderer
*
getCoverageCountingPathRenderer
(
)
;
void
flushIfNecessary
(
)
{
GrResourceCache
*
resourceCache
=
fContext
-
>
contextPriv
(
)
.
getResourceCache
(
)
;
if
(
resourceCache
&
&
resourceCache
-
>
requestsFlush
(
)
)
{
this
-
>
internalFlush
(
nullptr
GrResourceCache
:
:
kCacheRequested
0
nullptr
)
;
}
}
static
bool
ProgramUnitTest
(
GrContext
*
context
int
maxStages
int
maxLevels
)
;
GrSemaphoresSubmitted
prepareSurfaceForExternalIO
(
GrSurfaceProxy
*
int
numSemaphores
GrBackendSemaphore
backendSemaphores
[
]
)
;
void
addOnFlushCallbackObject
(
GrOnFlushCallbackObject
*
)
;
void
testingOnly_removeOnFlushCallbackObject
(
GrOnFlushCallbackObject
*
)
;
void
moveOpListsToDDL
(
SkDeferredDisplayList
*
ddl
)
;
void
copyOpListsFromDDL
(
const
SkDeferredDisplayList
*
GrRenderTargetProxy
*
newDest
)
;
private
:
GrDrawingManager
(
GrContext
*
const
GrPathRendererChain
:
:
Options
&
const
GrAtlasTextContext
:
:
Options
&
GrSingleOwner
*
GrContextOptions
:
:
Enable
sortRenderTargets
)
;
void
abandon
(
)
;
void
cleanup
(
)
;
bool
executeOpLists
(
int
startIndex
int
stopIndex
GrOpFlushState
*
)
;
GrSemaphoresSubmitted
flush
(
GrSurfaceProxy
*
proxy
int
numSemaphores
=
0
GrBackendSemaphore
backendSemaphores
[
]
=
nullptr
)
{
return
this
-
>
internalFlush
(
proxy
GrResourceCache
:
:
FlushType
:
:
kExternal
numSemaphores
backendSemaphores
)
;
}
GrSemaphoresSubmitted
internalFlush
(
GrSurfaceProxy
*
GrResourceCache
:
:
FlushType
int
numSemaphores
GrBackendSemaphore
backendSemaphores
[
]
)
;
friend
class
GrContext
;
friend
class
GrContextPriv
;
friend
class
GrOnFlushResourceProvider
;
static
const
int
kNumPixelGeometries
=
5
;
static
const
int
kNumDFTOptions
=
2
;
GrContext
*
fContext
;
GrPathRendererChain
:
:
Options
fOptionsForPathRendererChain
;
GrAtlasTextContext
:
:
Options
fOptionsForAtlasTextContext
;
GrSingleOwner
*
fSingleOwner
;
bool
fAbandoned
;
SkTArray
<
sk_sp
<
GrOpList
>
>
fOpLists
;
SkSTArray
<
8
uint32_t
true
>
fFlushingOpListIDs
;
SkSTArray
<
8
sk_sp
<
GrOpList
>
>
fOnFlushCBOpLists
;
std
:
:
unique_ptr
<
GrAtlasTextContext
>
fAtlasTextContext
;
GrPathRendererChain
*
fPathRendererChain
;
GrSoftwarePathRenderer
*
fSoftwarePathRenderer
;
GrTokenTracker
fTokenTracker
;
bool
fFlushing
;
bool
fSortRenderTargets
;
SkTArray
<
GrOnFlushCallbackObject
*
>
fOnFlushCBObjects
;
}
;
#
endif
