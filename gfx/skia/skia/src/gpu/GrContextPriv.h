#
ifndef
GrContextPriv_DEFINED
#
define
GrContextPriv_DEFINED
#
include
"
GrContext
.
h
"
#
include
"
GrSurfaceContext
.
h
"
#
include
"
text
/
GrAtlasManager
.
h
"
class
GrBackendFormat
;
class
GrBackendRenderTarget
;
class
GrOpMemoryPool
;
class
GrOnFlushCallbackObject
;
class
GrSemaphore
;
class
GrSkSLFPFactory
;
class
GrSkSLFPFactoryCache
;
class
GrSurfaceProxy
;
class
GrTextureContext
;
class
SkDeferredDisplayList
;
class
SkTaskGroup
;
class
GrContextPriv
{
public
:
uint32_t
contextID
(
)
const
{
return
fContext
-
>
contextID
(
)
;
}
bool
matches
(
GrContext_Base
*
candidate
)
const
{
return
fContext
-
>
matches
(
candidate
)
;
}
const
GrContextOptions
&
options
(
)
const
{
return
fContext
-
>
options
(
)
;
}
bool
explicitlyAllocateGPUResources
(
)
const
{
return
fContext
-
>
explicitlyAllocateGPUResources
(
)
;
}
const
GrCaps
*
caps
(
)
const
{
return
fContext
-
>
caps
(
)
;
}
sk_sp
<
const
GrCaps
>
refCaps
(
)
const
;
sk_sp
<
GrSkSLFPFactoryCache
>
fpFactoryCache
(
)
;
GrImageContext
*
asImageContext
(
)
{
return
fContext
-
>
asImageContext
(
)
;
}
GrRecordingContext
*
asRecordingContext
(
)
{
return
fContext
-
>
asRecordingContext
(
)
;
}
GrContext
*
asDirectContext
(
)
{
return
fContext
-
>
asDirectContext
(
)
;
}
GrProxyProvider
*
proxyProvider
(
)
{
return
fContext
-
>
proxyProvider
(
)
;
}
const
GrProxyProvider
*
proxyProvider
(
)
const
{
return
fContext
-
>
proxyProvider
(
)
;
}
bool
abandoned
(
)
const
{
return
fContext
-
>
abandoned
(
)
;
}
SkDEBUGCODE
(
GrSingleOwner
*
singleOwner
(
)
const
{
return
fContext
-
>
singleOwner
(
)
;
}
)
GrDrawingManager
*
drawingManager
(
)
{
return
fContext
-
>
drawingManager
(
)
;
}
sk_sp
<
GrOpMemoryPool
>
refOpMemoryPool
(
)
;
GrOpMemoryPool
*
opMemoryPool
(
)
{
return
fContext
-
>
opMemoryPool
(
)
;
}
GrStrikeCache
*
getGrStrikeCache
(
)
{
return
fContext
-
>
getGrStrikeCache
(
)
;
}
GrTextBlobCache
*
getTextBlobCache
(
)
{
return
fContext
-
>
getTextBlobCache
(
)
;
}
void
addOnFlushCallbackObject
(
GrOnFlushCallbackObject
*
)
;
sk_sp
<
GrSurfaceContext
>
makeWrappedSurfaceContext
(
sk_sp
<
GrSurfaceProxy
>
sk_sp
<
SkColorSpace
>
=
nullptr
const
SkSurfaceProps
*
=
nullptr
)
;
sk_sp
<
GrSurfaceContext
>
makeDeferredSurfaceContext
(
const
GrBackendFormat
&
const
GrSurfaceDesc
&
GrSurfaceOrigin
GrMipMapped
SkBackingFit
SkBudgeted
sk_sp
<
SkColorSpace
>
colorSpace
=
nullptr
const
SkSurfaceProps
*
=
nullptr
)
;
sk_sp
<
GrRenderTargetContext
>
makeDeferredRenderTargetContext
(
const
GrBackendFormat
&
format
SkBackingFit
fit
int
width
int
height
GrPixelConfig
config
sk_sp
<
SkColorSpace
>
colorSpace
int
sampleCnt
=
1
GrMipMapped
=
GrMipMapped
:
:
kNo
GrSurfaceOrigin
origin
=
kBottomLeft_GrSurfaceOrigin
const
SkSurfaceProps
*
surfaceProps
=
nullptr
SkBudgeted
=
SkBudgeted
:
:
kYes
)
;
sk_sp
<
GrRenderTargetContext
>
makeDeferredRenderTargetContextWithFallback
(
const
GrBackendFormat
&
format
SkBackingFit
fit
int
width
int
height
GrPixelConfig
config
sk_sp
<
SkColorSpace
>
colorSpace
int
sampleCnt
=
1
GrMipMapped
=
GrMipMapped
:
:
kNo
GrSurfaceOrigin
origin
=
kBottomLeft_GrSurfaceOrigin
const
SkSurfaceProps
*
surfaceProps
=
nullptr
SkBudgeted
budgeted
=
SkBudgeted
:
:
kYes
)
;
GrAuditTrail
*
auditTrail
(
)
{
return
fContext
-
>
auditTrail
(
)
;
}
static
sk_sp
<
GrContext
>
MakeDDL
(
const
sk_sp
<
GrContextThreadSafeProxy
>
&
)
;
sk_sp
<
GrTextureContext
>
makeBackendTextureContext
(
const
GrBackendTexture
&
tex
GrSurfaceOrigin
origin
sk_sp
<
SkColorSpace
>
colorSpace
)
;
typedef
void
*
ReleaseContext
;
typedef
void
(
*
ReleaseProc
)
(
ReleaseContext
)
;
sk_sp
<
GrRenderTargetContext
>
makeBackendTextureRenderTargetContext
(
const
GrBackendTexture
&
tex
GrSurfaceOrigin
origin
int
sampleCnt
sk_sp
<
SkColorSpace
>
colorSpace
const
SkSurfaceProps
*
=
nullptr
ReleaseProc
=
nullptr
ReleaseContext
=
nullptr
)
;
sk_sp
<
GrRenderTargetContext
>
makeBackendRenderTargetRenderTargetContext
(
const
GrBackendRenderTarget
&
GrSurfaceOrigin
origin
sk_sp
<
SkColorSpace
>
colorSpace
const
SkSurfaceProps
*
=
nullptr
ReleaseProc
=
nullptr
ReleaseContext
=
nullptr
)
;
sk_sp
<
GrRenderTargetContext
>
makeBackendTextureAsRenderTargetRenderTargetContext
(
const
GrBackendTexture
&
tex
GrSurfaceOrigin
origin
int
sampleCnt
sk_sp
<
SkColorSpace
>
colorSpace
const
SkSurfaceProps
*
=
nullptr
)
;
sk_sp
<
GrRenderTargetContext
>
makeVulkanSecondaryCBRenderTargetContext
(
const
SkImageInfo
&
const
GrVkDrawableInfo
&
const
SkSurfaceProps
*
=
nullptr
)
;
void
flush
(
GrSurfaceProxy
*
)
;
void
flushSurfaceWrites
(
GrSurfaceProxy
*
)
;
void
flushSurfaceIO
(
GrSurfaceProxy
*
)
;
void
prepareSurfaceForExternalIO
(
GrSurfaceProxy
*
)
;
enum
PixelOpsFlags
{
kDontFlush_PixelOpsFlag
=
0x1
kFlushWrites_PixelOp
=
0x2
kUnpremul_PixelOpsFlag
=
0x4
}
;
bool
readSurfacePixels
(
GrSurfaceContext
*
src
int
left
int
top
int
width
int
height
GrColorType
dstColorType
SkColorSpace
*
dstColorSpace
void
*
buffer
size_t
rowBytes
=
0
uint32_t
pixelOpsFlags
=
0
)
;
bool
writeSurfacePixels
(
GrSurfaceContext
*
dst
int
left
int
top
int
width
int
height
GrColorType
srcColorType
SkColorSpace
*
srcColorSpace
const
void
*
buffer
size_t
rowBytes
uint32_t
pixelOpsFlags
=
0
)
;
SkTaskGroup
*
getTaskGroup
(
)
{
return
fContext
-
>
fTaskGroup
.
get
(
)
;
}
GrResourceProvider
*
resourceProvider
(
)
{
return
fContext
-
>
fResourceProvider
;
}
const
GrResourceProvider
*
resourceProvider
(
)
const
{
return
fContext
-
>
fResourceProvider
;
}
GrResourceCache
*
getResourceCache
(
)
{
return
fContext
-
>
fResourceCache
;
}
GrGpu
*
getGpu
(
)
{
return
fContext
-
>
fGpu
.
get
(
)
;
}
const
GrGpu
*
getGpu
(
)
const
{
return
fContext
-
>
fGpu
.
get
(
)
;
}
GrAtlasManager
*
getAtlasManager
(
)
{
return
fContext
-
>
onGetAtlasManager
(
)
;
}
void
moveOpListsToDDL
(
SkDeferredDisplayList
*
)
;
void
copyOpListsFromDDL
(
const
SkDeferredDisplayList
*
GrRenderTargetProxy
*
newDest
)
;
GrContextOptions
:
:
PersistentCache
*
getPersistentCache
(
)
{
return
fContext
-
>
fPersistentCache
;
}
#
ifdef
SK_ENABLE_DUMP_GPU
SkString
dump
(
)
const
;
#
endif
#
if
GR_TEST_UTILS
void
resetGpuStats
(
)
const
;
void
dumpCacheStats
(
SkString
*
)
const
;
void
dumpCacheStatsKeyValuePairs
(
SkTArray
<
SkString
>
*
keys
SkTArray
<
double
>
*
values
)
const
;
void
printCacheStats
(
)
const
;
void
dumpGpuStats
(
SkString
*
)
const
;
void
dumpGpuStatsKeyValuePairs
(
SkTArray
<
SkString
>
*
keys
SkTArray
<
double
>
*
values
)
const
;
void
printGpuStats
(
)
const
;
void
testingOnly_setTextBlobCacheLimit
(
size_t
bytes
)
;
sk_sp
<
SkImage
>
testingOnly_getFontAtlasImage
(
GrMaskFormat
format
unsigned
int
index
=
0
)
;
void
testingOnly_purgeAllUnlockedResources
(
)
;
void
testingOnly_flushAndRemoveOnFlushCallbackObject
(
GrOnFlushCallbackObject
*
)
;
#
endif
private
:
explicit
GrContextPriv
(
GrContext
*
context
)
:
fContext
(
context
)
{
}
GrContextPriv
(
const
GrContextPriv
&
)
;
GrContextPriv
&
operator
=
(
const
GrContextPriv
&
)
;
const
GrContextPriv
*
operator
&
(
)
const
;
GrContextPriv
*
operator
&
(
)
;
GrContext
*
fContext
;
friend
class
GrContext
;
}
;
inline
GrContextPriv
GrContext
:
:
priv
(
)
{
return
GrContextPriv
(
this
)
;
}
inline
const
GrContextPriv
GrContext
:
:
priv
(
)
const
{
return
GrContextPriv
(
const_cast
<
GrContext
*
>
(
this
)
)
;
}
#
endif
