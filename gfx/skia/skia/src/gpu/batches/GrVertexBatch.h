#
ifndef
GrVertexBatch_DEFINED
#
define
GrVertexBatch_DEFINED
#
include
"
GrDrawBatch
.
h
"
#
include
"
GrGeometryProcessor
.
h
"
#
include
"
GrMesh
.
h
"
#
include
"
GrPendingProgramElement
.
h
"
#
include
"
SkTLList
.
h
"
class
GrBatchFlushState
;
class
GrVertexBatch
:
public
GrDrawBatch
{
public
:
class
Target
;
GrVertexBatch
(
uint32_t
classID
)
;
protected
:
class
InstancedHelper
{
public
:
InstancedHelper
(
)
{
}
void
*
init
(
Target
*
GrPrimitiveType
size_t
vertexStride
const
GrBuffer
*
int
verticesPerInstance
int
indicesPerInstance
int
instancesToDraw
)
;
void
recordDraw
(
Target
*
const
GrGeometryProcessor
*
)
;
private
:
GrMesh
fMesh
;
}
;
static
const
int
kVerticesPerQuad
=
4
;
static
const
int
kIndicesPerQuad
=
6
;
class
QuadHelper
:
private
InstancedHelper
{
public
:
QuadHelper
(
)
:
INHERITED
(
)
{
}
void
*
init
(
Target
*
size_t
vertexStride
int
quadsToDraw
)
;
using
InstancedHelper
:
:
recordDraw
;
private
:
typedef
InstancedHelper
INHERITED
;
}
;
private
:
void
onPrepare
(
GrBatchFlushState
*
state
)
final
;
void
onDraw
(
GrBatchFlushState
*
state
)
final
;
virtual
void
onPrepareDraws
(
Target
*
)
const
=
0
;
struct
QueuedDraw
{
int
fMeshCnt
=
0
;
GrPendingProgramElement
<
const
GrGeometryProcessor
>
fGeometryProcessor
;
}
;
GrBatchDrawToken
fBaseDrawToken
;
SkSTArray
<
4
GrMesh
>
fMeshes
;
SkSTArray
<
4
QueuedDraw
true
>
fQueuedDraws
;
typedef
GrDrawBatch
INHERITED
;
}
;
#
endif
