#
include
"
GrCopySurfaceBatch
.
h
"
static
bool
clip_srcrect_and_dstpoint
(
const
GrSurface
*
dst
const
GrSurface
*
src
const
SkIRect
&
srcRect
const
SkIPoint
&
dstPoint
SkIRect
*
clippedSrcRect
SkIPoint
*
clippedDstPoint
)
{
*
clippedSrcRect
=
srcRect
;
*
clippedDstPoint
=
dstPoint
;
if
(
clippedSrcRect
-
>
fLeft
<
0
)
{
clippedDstPoint
-
>
fX
-
=
clippedSrcRect
-
>
fLeft
;
clippedSrcRect
-
>
fLeft
=
0
;
}
if
(
clippedDstPoint
-
>
fX
<
0
)
{
clippedSrcRect
-
>
fLeft
-
=
clippedDstPoint
-
>
fX
;
clippedDstPoint
-
>
fX
=
0
;
}
if
(
clippedSrcRect
-
>
fTop
<
0
)
{
clippedDstPoint
-
>
fY
-
=
clippedSrcRect
-
>
fTop
;
clippedSrcRect
-
>
fTop
=
0
;
}
if
(
clippedDstPoint
-
>
fY
<
0
)
{
clippedSrcRect
-
>
fTop
-
=
clippedDstPoint
-
>
fY
;
clippedDstPoint
-
>
fY
=
0
;
}
if
(
clippedSrcRect
-
>
fRight
>
src
-
>
width
(
)
)
{
clippedSrcRect
-
>
fRight
=
src
-
>
width
(
)
;
}
if
(
clippedDstPoint
-
>
fX
+
clippedSrcRect
-
>
width
(
)
>
dst
-
>
width
(
)
)
{
clippedSrcRect
-
>
fRight
=
clippedSrcRect
-
>
fLeft
+
dst
-
>
width
(
)
-
clippedDstPoint
-
>
fX
;
}
if
(
clippedSrcRect
-
>
fBottom
>
src
-
>
height
(
)
)
{
clippedSrcRect
-
>
fBottom
=
src
-
>
height
(
)
;
}
if
(
clippedDstPoint
-
>
fY
+
clippedSrcRect
-
>
height
(
)
>
dst
-
>
height
(
)
)
{
clippedSrcRect
-
>
fBottom
=
clippedSrcRect
-
>
fTop
+
dst
-
>
height
(
)
-
clippedDstPoint
-
>
fY
;
}
return
!
clippedSrcRect
-
>
isEmpty
(
)
;
}
GrBatch
*
GrCopySurfaceBatch
:
:
Create
(
GrSurface
*
dst
GrSurface
*
src
const
SkIRect
&
srcRect
const
SkIPoint
&
dstPoint
)
{
SkASSERT
(
dst
)
;
SkASSERT
(
src
)
;
SkIRect
clippedSrcRect
;
SkIPoint
clippedDstPoint
;
if
(
!
clip_srcrect_and_dstpoint
(
dst
src
srcRect
dstPoint
&
clippedSrcRect
&
clippedDstPoint
)
)
{
return
nullptr
;
}
return
new
GrCopySurfaceBatch
(
dst
src
clippedSrcRect
clippedDstPoint
)
;
}
