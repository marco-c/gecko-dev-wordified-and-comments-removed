#
ifndef
GrGLSLXferProcessor_DEFINED
#
define
GrGLSLXferProcessor_DEFINED
#
include
"
glsl
/
GrGLSLProgramDataManager
.
h
"
#
include
"
glsl
/
GrGLSLSampler
.
h
"
class
GrXferProcessor
;
class
GrGLSLCaps
;
class
GrGLSLUniformHandler
;
class
GrGLSLXPBuilder
;
class
GrGLSLXPFragmentBuilder
;
class
GrGLSLXferProcessor
{
public
:
GrGLSLXferProcessor
(
)
{
}
virtual
~
GrGLSLXferProcessor
(
)
{
}
typedef
GrGLSLProgramDataManager
:
:
UniformHandle
SamplerHandle
;
struct
EmitArgs
{
EmitArgs
(
GrGLSLXPFragmentBuilder
*
fragBuilder
GrGLSLUniformHandler
*
uniformHandler
const
GrGLSLCaps
*
caps
const
GrXferProcessor
&
xp
const
char
*
inputColor
const
char
*
inputCoverage
const
char
*
outputPrimary
const
char
*
outputSecondary
const
SamplerHandle
*
texSamplers
const
SamplerHandle
*
bufferSamplers
const
bool
usePLSDstRead
)
:
fXPFragBuilder
(
fragBuilder
)
fUniformHandler
(
uniformHandler
)
fGLSLCaps
(
caps
)
fXP
(
xp
)
fInputColor
(
inputColor
)
fInputCoverage
(
inputCoverage
)
fOutputPrimary
(
outputPrimary
)
fOutputSecondary
(
outputSecondary
)
fTexSamplers
(
texSamplers
)
fBufferSamplers
(
bufferSamplers
)
fUsePLSDstRead
(
usePLSDstRead
)
{
}
GrGLSLXPFragmentBuilder
*
fXPFragBuilder
;
GrGLSLUniformHandler
*
fUniformHandler
;
const
GrGLSLCaps
*
fGLSLCaps
;
const
GrXferProcessor
&
fXP
;
const
char
*
fInputColor
;
const
char
*
fInputCoverage
;
const
char
*
fOutputPrimary
;
const
char
*
fOutputSecondary
;
const
SamplerHandle
*
fTexSamplers
;
const
SamplerHandle
*
fBufferSamplers
;
bool
fUsePLSDstRead
;
}
;
void
emitCode
(
const
EmitArgs
&
)
;
void
setData
(
const
GrGLSLProgramDataManager
&
pdm
const
GrXferProcessor
&
xp
)
;
protected
:
static
void
DefaultCoverageModulation
(
GrGLSLXPFragmentBuilder
*
fragBuilder
const
char
*
srcCoverage
const
char
*
dstColor
const
char
*
outColor
const
char
*
outColorSecondary
const
GrXferProcessor
&
proc
)
;
private
:
virtual
void
emitOutputsForBlendState
(
const
EmitArgs
&
)
{
SkFAIL
(
"
emitOutputsForBlendState
not
implemented
.
"
)
;
}
virtual
void
emitBlendCodeForDstRead
(
GrGLSLXPFragmentBuilder
*
GrGLSLUniformHandler
*
const
char
*
srcColor
const
char
*
srcCoverage
const
char
*
dstColor
const
char
*
outColor
const
char
*
outColorSecondary
const
GrXferProcessor
&
)
{
SkFAIL
(
"
emitBlendCodeForDstRead
not
implemented
.
"
)
;
}
virtual
void
onSetData
(
const
GrGLSLProgramDataManager
&
const
GrXferProcessor
&
)
=
0
;
GrGLSLProgramDataManager
:
:
UniformHandle
fDstTopLeftUni
;
GrGLSLProgramDataManager
:
:
UniformHandle
fDstScaleUni
;
}
;
#
endif
