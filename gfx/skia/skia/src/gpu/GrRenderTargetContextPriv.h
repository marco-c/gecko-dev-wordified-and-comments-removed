#
ifndef
GrRenderTargetContextPriv_DEFINED
#
define
GrRenderTargetContextPriv_DEFINED
#
include
"
src
/
gpu
/
GrOpsTask
.
h
"
#
include
"
src
/
gpu
/
GrPathRendering
.
h
"
#
include
"
src
/
gpu
/
GrRenderTargetContext
.
h
"
class
GrFixedClip
;
class
GrHardClip
;
class
GrPath
;
class
GrRenderTargetPriv
;
struct
GrUserStencilSettings
;
class
GrRenderTargetContextPriv
{
public
:
void
setLastClip
(
uint32_t
clipStackGenID
const
SkIRect
&
devClipBounds
int
numClipAnalyticFPs
)
{
GrOpsTask
*
opsTask
=
fRenderTargetContext
-
>
getOpsTask
(
)
;
opsTask
-
>
fLastClipStackGenID
=
clipStackGenID
;
opsTask
-
>
fLastDevClipBounds
=
devClipBounds
;
opsTask
-
>
fLastClipNumAnalyticFPs
=
numClipAnalyticFPs
;
}
bool
mustRenderClip
(
uint32_t
clipStackGenID
const
SkIRect
&
devClipBounds
int
numClipAnalyticFPs
)
const
{
GrOpsTask
*
opsTask
=
fRenderTargetContext
-
>
getOpsTask
(
)
;
return
opsTask
-
>
fLastClipStackGenID
!
=
clipStackGenID
|
|
!
opsTask
-
>
fLastDevClipBounds
.
contains
(
devClipBounds
)
|
|
opsTask
-
>
fLastClipNumAnalyticFPs
!
=
numClipAnalyticFPs
;
}
using
CanClearFullscreen
=
GrRenderTargetContext
:
:
CanClearFullscreen
;
void
clear
(
const
GrFixedClip
&
const
SkPMColor4f
&
CanClearFullscreen
)
;
void
clearStencilClip
(
const
GrFixedClip
&
bool
insideStencilMask
)
;
void
stencilRect
(
const
GrClip
&
clip
const
GrUserStencilSettings
*
ss
GrPaint
&
&
paint
GrAA
doStencilMSAA
const
SkMatrix
&
viewMatrix
const
SkRect
&
rect
const
SkMatrix
*
localMatrix
=
nullptr
)
{
GrQuad
localQuad
=
localMatrix
?
GrQuad
:
:
MakeFromRect
(
rect
*
localMatrix
)
:
GrQuad
(
rect
)
;
fRenderTargetContext
-
>
drawFilledQuad
(
clip
std
:
:
move
(
paint
)
doStencilMSAA
GrQuadAAFlags
:
:
kNone
GrQuad
:
:
MakeFromRect
(
rect
viewMatrix
)
localQuad
ss
)
;
}
void
stencilPath
(
const
GrHardClip
&
GrAA
doStencilMSAA
const
SkMatrix
&
viewMatrix
sk_sp
<
const
GrPath
>
)
;
bool
drawAndStencilPath
(
const
GrHardClip
&
const
GrUserStencilSettings
*
SkRegion
:
:
Op
op
bool
invert
GrAA
doStencilMSAA
const
SkMatrix
&
viewMatrix
const
SkPath
&
)
;
SkBudgeted
isBudgeted
(
)
const
;
int
maxWindowRectangles
(
)
const
;
GrSurfaceProxy
:
:
UniqueID
uniqueID
(
)
const
{
return
fRenderTargetContext
-
>
fRenderTargetProxy
-
>
uniqueID
(
)
;
}
uint32_t
testingOnly_getOpsTaskID
(
)
;
using
WillAddOpFn
=
GrRenderTargetContext
:
:
WillAddOpFn
;
void
testingOnly_addDrawOp
(
std
:
:
unique_ptr
<
GrDrawOp
>
)
;
void
testingOnly_addDrawOp
(
const
GrClip
&
std
:
:
unique_ptr
<
GrDrawOp
>
const
std
:
:
function
<
WillAddOpFn
>
&
=
std
:
:
function
<
WillAddOpFn
>
(
)
)
;
bool
refsWrappedObjects
(
)
const
{
return
fRenderTargetContext
-
>
fRenderTargetProxy
-
>
refsWrappedObjects
(
)
;
}
private
:
explicit
GrRenderTargetContextPriv
(
GrRenderTargetContext
*
renderTargetContext
)
:
fRenderTargetContext
(
renderTargetContext
)
{
}
GrRenderTargetContextPriv
(
const
GrRenderTargetPriv
&
)
{
}
GrRenderTargetContextPriv
&
operator
=
(
const
GrRenderTargetPriv
&
)
;
const
GrRenderTargetContextPriv
*
operator
&
(
)
const
;
GrRenderTargetContextPriv
*
operator
&
(
)
;
GrRenderTargetContext
*
fRenderTargetContext
;
friend
class
GrRenderTargetContext
;
}
;
inline
GrRenderTargetContextPriv
GrRenderTargetContext
:
:
priv
(
)
{
return
GrRenderTargetContextPriv
(
this
)
;
}
inline
const
GrRenderTargetContextPriv
GrRenderTargetContext
:
:
priv
(
)
const
{
return
GrRenderTargetContextPriv
(
const_cast
<
GrRenderTargetContext
*
>
(
this
)
)
;
}
#
endif
