#
ifndef
GrTracing_DEFINED
#
define
GrTracing_DEFINED
#
include
"
GrDrawTarget
.
h
"
#
include
"
GrGpu
.
h
"
#
include
"
GrTraceMarker
.
h
"
#
include
"
SkTLazy
.
h
"
#
include
"
SkTraceEvent
.
h
"
class
GrGpuTraceMarkerGenerator
:
public
:
:
SkNoncopyable
{
public
:
GrGpuTraceMarkerGenerator
(
GrDrawTarget
*
target
)
{
}
~
GrGpuTraceMarkerGenerator
(
)
{
if
(
fTraceMarker
.
isValid
(
)
)
{
}
}
void
initialize
(
const
char
*
marker_str
int
*
marker_counter
)
{
}
private
:
SkTLazy
<
GrGpuTraceMarker
>
fTraceMarker
;
}
;
class
GrGpuTraceMarkerGeneratorContext
:
public
:
:
SkNoncopyable
{
public
:
GrGpuTraceMarkerGeneratorContext
(
GrContext
*
context
)
{
}
~
GrGpuTraceMarkerGeneratorContext
(
)
{
if
(
fTraceMarker
.
isValid
(
)
)
{
}
}
void
initialize
(
const
char
*
marker_str
int
*
marker_counter
)
{
}
private
:
SkTLazy
<
GrGpuTraceMarker
>
fTraceMarker
;
}
;
#
define
GR_CREATE_TRACE_MARKER
(
name
target
)
\
static
int
SK_MACRO_APPEND_LINE
(
name_counter
)
=
0
;
\
bool
SK_MACRO_APPEND_LINE
(
gpuTracingEnabled
)
;
\
TRACE_EVENT_CATEGORY_GROUP_ENABLED
(
TRACE_DISABLED_BY_DEFAULT
(
"
skia
.
gpu
"
)
\
&
SK_MACRO_APPEND_LINE
(
gpuTracingEnabled
)
)
;
\
if
(
SK_MACRO_APPEND_LINE
(
gpuTracingEnabled
)
)
{
\
INTERNAL_GR_CREATE_TRACE_MARKER_SCOPED
(
name
SK_MACRO_APPEND_LINE
(
name_counter
)
target
)
\
}
\
INTERNAL_TRACE_EVENT_ADD_SCOPED
(
TRACE_DISABLED_BY_DEFAULT
(
"
skia
.
gpu
"
)
name
\
"
id
"
SK_MACRO_APPEND_LINE
(
name_counter
)
)
;
#
define
INTERNAL_GR_CREATE_TRACE_MARKER_SCOPED
(
name
name_counter
target
)
\
static
const
char
*
SK_MACRO_APPEND_LINE
(
static_name
)
=
name
;
\
INTERNAL_GR_CREATE_TRACE_MARKER
(
SK_MACRO_APPEND_LINE
(
static_name
)
\
name_counter
\
target
)
\
sk_atomic_inc
(
&
name_counter
)
;
#
define
INTERNAL_GR_CREATE_TRACE_MARKER
(
name
name_counter
target
.
.
.
)
\
GR_CREATE_GPU_TRACE_MARKER
(
name
name_counter
target
)
\
#
define
GR_CREATE_GPU_TRACE_MARKER
(
name
name_counter
target
)
\
GrGpuTraceMarkerGenerator
SK_MACRO_APPEND_LINE
(
TMG
)
(
target
)
;
\
SK_MACRO_APPEND_LINE
(
TMG
)
.
initialize
(
name
&
name_counter
)
;
\
#
define
GR_CREATE_TRACE_MARKER_CONTEXT
(
classname
op
context
)
\
static
int
SK_MACRO_APPEND_LINE
(
name_counter
)
=
0
;
\
bool
SK_MACRO_APPEND_LINE
(
gpuTracingEnabled
)
;
\
TRACE_EVENT_CATEGORY_GROUP_ENABLED
(
TRACE_DISABLED_BY_DEFAULT
(
"
skia
.
gpu
"
)
\
&
SK_MACRO_APPEND_LINE
(
gpuTracingEnabled
)
)
;
\
if
(
SK_MACRO_APPEND_LINE
(
gpuTracingEnabled
)
)
{
\
INTERNAL_GR_CREATE_TRACE_MARKER_SCOPED_C
(
classname
"
:
:
"
op
\
SK_MACRO_APPEND_LINE
(
name_counter
)
context
)
\
}
\
GR_AUDIT_TRAIL_AUTO_FRAME
(
context
-
>
getAuditTrail
(
)
classname
"
:
:
"
op
)
;
\
INTERNAL_TRACE_EVENT_ADD_SCOPED
(
TRACE_DISABLED_BY_DEFAULT
(
"
skia
.
gpu
"
)
classname
"
:
:
"
op
\
"
id
"
SK_MACRO_APPEND_LINE
(
name_counter
)
)
;
#
define
INTERNAL_GR_CREATE_TRACE_MARKER_SCOPED_C
(
name
name_counter
context
)
\
static
const
char
*
SK_MACRO_APPEND_LINE
(
static_name
)
=
name
;
\
INTERNAL_GR_CREATE_TRACE_MARKER_C
(
SK_MACRO_APPEND_LINE
(
static_name
)
\
name_counter
\
context
)
\
sk_atomic_inc
(
&
name_counter
)
;
#
define
INTERNAL_GR_CREATE_TRACE_MARKER_C
(
name
name_counter
context
.
.
.
)
\
GR_CREATE_GPU_TRACE_MARKER_C
(
name
name_counter
context
)
\
#
define
GR_CREATE_GPU_TRACE_MARKER_C
(
name
name_counter
context
)
\
GrGpuTraceMarkerGeneratorContext
SK_MACRO_APPEND_LINE
(
TMG
)
(
context
)
;
\
SK_MACRO_APPEND_LINE
(
TMG
)
.
initialize
(
name
&
name_counter
)
;
\
#
endif
