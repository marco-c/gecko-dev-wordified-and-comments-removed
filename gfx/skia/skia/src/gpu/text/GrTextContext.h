#
ifndef
GrTextContext_DEFINED
#
define
GrTextContext_DEFINED
#
include
"
GrDistanceFieldAdjustTable
.
h
"
#
include
"
GrGeometryProcessor
.
h
"
#
include
"
GrTextBlob
.
h
"
#
include
"
GrTextTarget
.
h
"
#
include
"
SkGlyphRun
.
h
"
#
if
GR_TEST_UTILS
#
include
"
GrDrawOpTest
.
h
"
#
endif
class
GrDrawOp
;
class
GrTextBlobCache
;
class
SkGlyph
;
class
GrTextContext
{
public
:
struct
Options
{
SkScalar
fMinDistanceFieldFontSize
=
-
1
.
f
;
SkScalar
fMaxDistanceFieldFontSize
=
-
1
.
f
;
bool
fDistanceFieldVerticesAlwaysHaveW
=
false
;
}
;
static
std
:
:
unique_ptr
<
GrTextContext
>
Make
(
const
Options
&
options
)
;
void
drawGlyphRunList
(
GrContext
*
GrTextTarget
*
const
GrClip
&
const
SkMatrix
&
viewMatrix
const
SkSurfaceProps
&
const
SkGlyphRunList
&
)
;
std
:
:
unique_ptr
<
GrDrawOp
>
createOp_TestingOnly
(
GrContext
*
GrTextContext
*
GrRenderTargetContext
*
const
SkPaint
&
const
SkMatrix
&
viewMatrix
const
char
*
text
int
x
int
y
)
;
static
void
SanitizeOptions
(
Options
*
options
)
;
static
bool
CanDrawAsDistanceFields
(
const
SkPaint
&
skPaint
const
SkMatrix
&
viewMatrix
const
SkSurfaceProps
&
props
bool
contextSupportsDistanceFieldText
const
Options
&
options
)
;
static
void
InitDistanceFieldPaint
(
GrTextBlob
*
blob
SkPaint
*
skPaint
const
SkMatrix
&
viewMatrix
const
Options
&
options
SkScalar
*
textRatio
SkScalerContextFlags
*
flags
)
;
private
:
GrTextContext
(
const
Options
&
options
)
;
static
SkColor
ComputeCanonicalColor
(
const
SkPaint
&
bool
lcd
)
;
static
SkScalerContextFlags
ComputeScalerContextFlags
(
const
GrColorSpaceInfo
&
)
;
void
regenerateGlyphRunList
(
GrTextBlob
*
bmp
GrGlyphCache
*
const
GrShaderCaps
&
const
SkPaint
&
GrColor
filteredColor
SkScalerContextFlags
scalerContextFlags
const
SkMatrix
&
viewMatrix
const
SkSurfaceProps
&
const
SkGlyphRunList
&
glyphRunList
SkGlyphRunListPainter
*
glyphPainter
)
;
static
void
AppendGlyph
(
GrTextBlob
*
int
runIndex
const
sk_sp
<
GrTextStrike
>
&
const
SkGlyph
&
GrGlyph
:
:
MaskStyle
maskStyle
SkScalar
sx
SkScalar
sy
GrColor
color
SkGlyphCache
*
SkScalar
textRatio
bool
needsTransform
)
;
const
GrDistanceFieldAdjustTable
*
dfAdjustTable
(
)
const
{
return
fDistanceAdjustTable
.
get
(
)
;
}
sk_sp
<
const
GrDistanceFieldAdjustTable
>
fDistanceAdjustTable
;
Options
fOptions
;
#
if
GR_TEST_UTILS
static
const
SkScalerContextFlags
kTextBlobOpScalerContextFlags
=
SkScalerContextFlags
:
:
kFakeGammaAndBoostContrast
;
GR_DRAW_OP_TEST_FRIEND
(
GrAtlasTextOp
)
;
#
endif
}
;
#
endif
