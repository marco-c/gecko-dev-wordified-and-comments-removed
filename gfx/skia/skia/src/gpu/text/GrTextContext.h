#
ifndef
GrTextContext_DEFINED
#
define
GrTextContext_DEFINED
#
include
"
GrDistanceFieldAdjustTable
.
h
"
#
include
"
GrGeometryProcessor
.
h
"
#
include
"
GrTextTarget
.
h
"
#
include
"
SkGlyphRun
.
h
"
#
if
GR_TEST_UTILS
#
include
"
GrDrawOpTest
.
h
"
#
endif
class
GrDrawOp
;
class
GrRecordingContext
;
class
GrTextBlobCache
;
class
SkGlyph
;
class
GrTextBlob
;
class
GrTextContext
{
public
:
struct
Options
{
SkScalar
fMinDistanceFieldFontSize
=
-
1
.
f
;
SkScalar
fMaxDistanceFieldFontSize
=
-
1
.
f
;
bool
fDistanceFieldVerticesAlwaysHaveW
=
false
;
}
;
static
std
:
:
unique_ptr
<
GrTextContext
>
Make
(
const
Options
&
options
)
;
void
drawGlyphRunList
(
GrRecordingContext
*
GrTextTarget
*
const
GrClip
&
const
SkMatrix
&
viewMatrix
const
SkSurfaceProps
&
const
SkGlyphRunList
&
)
;
std
:
:
unique_ptr
<
GrDrawOp
>
createOp_TestingOnly
(
GrRecordingContext
*
GrTextContext
*
GrRenderTargetContext
*
const
SkPaint
&
const
SkFont
&
const
SkMatrix
&
viewMatrix
const
char
*
text
int
x
int
y
)
;
static
void
SanitizeOptions
(
Options
*
options
)
;
static
bool
CanDrawAsDistanceFields
(
const
SkPaint
&
const
SkFont
&
const
SkMatrix
&
viewMatrix
const
SkSurfaceProps
&
props
bool
contextSupportsDistanceFieldText
const
Options
&
options
)
;
static
SkFont
InitDistanceFieldFont
(
const
SkFont
&
font
const
SkMatrix
&
viewMatrix
const
Options
&
options
SkScalar
*
textRatio
)
;
static
SkPaint
InitDistanceFieldPaint
(
const
SkPaint
&
paint
)
;
static
std
:
:
pair
<
SkScalar
SkScalar
>
InitDistanceFieldMinMaxScale
(
SkScalar
textSize
const
SkMatrix
&
viewMatrix
const
Options
&
options
)
;
private
:
GrTextContext
(
const
Options
&
options
)
;
static
SkColor
ComputeCanonicalColor
(
const
SkPaint
&
bool
lcd
)
;
static
SkScalerContextFlags
ComputeScalerContextFlags
(
const
GrColorSpaceInfo
&
)
;
const
GrDistanceFieldAdjustTable
*
dfAdjustTable
(
)
const
{
return
fDistanceAdjustTable
.
get
(
)
;
}
sk_sp
<
const
GrDistanceFieldAdjustTable
>
fDistanceAdjustTable
;
Options
fOptions
;
#
if
GR_TEST_UTILS
static
const
SkScalerContextFlags
kTextBlobOpScalerContextFlags
=
SkScalerContextFlags
:
:
kFakeGammaAndBoostContrast
;
GR_DRAW_OP_TEST_FRIEND
(
GrAtlasTextOp
)
;
#
endif
}
;
#
endif
