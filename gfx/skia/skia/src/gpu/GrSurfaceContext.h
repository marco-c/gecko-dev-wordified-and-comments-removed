#
ifndef
GrSurfaceContext_DEFINED
#
define
GrSurfaceContext_DEFINED
#
include
"
include
/
core
/
SkFilterQuality
.
h
"
#
include
"
include
/
core
/
SkImageInfo
.
h
"
#
include
"
include
/
core
/
SkRect
.
h
"
#
include
"
include
/
core
/
SkRefCnt
.
h
"
#
include
"
include
/
core
/
SkSurface
.
h
"
#
include
"
src
/
gpu
/
GrColorInfo
.
h
"
#
include
"
src
/
gpu
/
GrDataUtils
.
h
"
#
include
"
src
/
gpu
/
GrSurfaceProxy
.
h
"
class
GrAuditTrail
;
class
GrDrawingManager
;
class
GrRecordingContext
;
class
GrRenderTargetContext
;
class
GrRenderTargetProxy
;
class
GrSingleOwner
;
class
GrSurface
;
class
GrSurfaceContextPriv
;
class
GrSurfaceProxy
;
class
GrTextureProxy
;
struct
SkIPoint
;
struct
SkIRect
;
class
GrSurfaceContext
{
public
:
virtual
~
GrSurfaceContext
(
)
=
default
;
const
GrColorInfo
&
colorInfo
(
)
const
{
return
fColorInfo
;
}
int
width
(
)
const
{
return
this
-
>
asSurfaceProxy
(
)
-
>
width
(
)
;
}
int
height
(
)
const
{
return
this
-
>
asSurfaceProxy
(
)
-
>
height
(
)
;
}
const
GrCaps
*
caps
(
)
const
;
bool
readPixels
(
const
GrImageInfo
&
dstInfo
void
*
dst
size_t
rowBytes
SkIPoint
srcPt
GrContext
*
direct
=
nullptr
)
;
bool
writePixels
(
const
GrImageInfo
&
srcInfo
const
void
*
src
size_t
rowBytes
SkIPoint
dstPt
GrContext
*
direct
=
nullptr
)
;
virtual
GrSurfaceProxy
*
asSurfaceProxy
(
)
=
0
;
virtual
const
GrSurfaceProxy
*
asSurfaceProxy
(
)
const
=
0
;
virtual
sk_sp
<
GrSurfaceProxy
>
asSurfaceProxyRef
(
)
=
0
;
virtual
GrTextureProxy
*
asTextureProxy
(
)
=
0
;
virtual
const
GrTextureProxy
*
asTextureProxy
(
)
const
=
0
;
virtual
sk_sp
<
GrTextureProxy
>
asTextureProxyRef
(
)
=
0
;
virtual
GrRenderTargetProxy
*
asRenderTargetProxy
(
)
=
0
;
virtual
sk_sp
<
GrRenderTargetProxy
>
asRenderTargetProxyRef
(
)
=
0
;
virtual
GrRenderTargetContext
*
asRenderTargetContext
(
)
{
return
nullptr
;
}
GrAuditTrail
*
auditTrail
(
)
;
GrSurfaceContextPriv
surfPriv
(
)
;
const
GrSurfaceContextPriv
surfPriv
(
)
const
;
#
if
GR_TEST_UTILS
bool
testCopy
(
GrSurfaceProxy
*
src
const
SkIRect
&
srcRect
const
SkIPoint
&
dstPoint
)
{
return
this
-
>
copy
(
src
srcRect
dstPoint
)
;
}
bool
testCopy
(
GrSurfaceProxy
*
src
)
{
return
this
-
>
copy
(
src
)
;
}
#
endif
protected
:
friend
class
GrSurfaceContextPriv
;
GrSurfaceContext
(
GrRecordingContext
*
GrColorType
SkAlphaType
sk_sp
<
SkColorSpace
>
)
;
GrDrawingManager
*
drawingManager
(
)
;
const
GrDrawingManager
*
drawingManager
(
)
const
;
SkDEBUGCODE
(
virtual
void
validate
(
)
const
=
0
;
)
SkDEBUGCODE
(
GrSingleOwner
*
singleOwner
(
)
;
)
GrRecordingContext
*
fContext
;
std
:
:
unique_ptr
<
GrRenderTargetContext
>
rescale
(
const
SkImageInfo
&
info
const
SkIRect
&
srcRect
SkSurface
:
:
RescaleGamma
rescaleGamma
SkFilterQuality
rescaleQuality
)
;
struct
PixelTransferResult
{
using
ConversionFn
=
void
(
void
*
dst
const
void
*
mappedBuffer
)
;
sk_sp
<
GrGpuBuffer
>
fTransferBuffer
;
std
:
:
function
<
ConversionFn
>
fPixelConverter
;
}
;
PixelTransferResult
transferPixels
(
GrColorType
colorType
const
SkIRect
&
rect
)
;
private
:
friend
class
GrSurfaceProxy
;
bool
copy
(
GrSurfaceProxy
*
src
const
SkIRect
&
srcRect
const
SkIPoint
&
dstPoint
)
;
bool
copy
(
GrSurfaceProxy
*
src
)
{
return
this
-
>
copy
(
src
SkIRect
:
:
MakeWH
(
src
-
>
width
(
)
src
-
>
height
(
)
)
SkIPoint
:
:
Make
(
0
0
)
)
;
}
GrColorInfo
fColorInfo
;
typedef
SkRefCnt
INHERITED
;
}
;
#
endif
