#
ifndef
GrMtlRenderTarget_DEFINED
#
define
GrMtlRenderTarget_DEFINED
#
include
"
src
/
gpu
/
ganesh
/
GrRenderTarget
.
h
"
#
include
"
include
/
gpu
/
GrBackendSurface
.
h
"
#
include
"
src
/
gpu
/
ganesh
/
GrGpu
.
h
"
#
include
"
src
/
gpu
/
ganesh
/
mtl
/
GrMtlAttachment
.
h
"
#
include
"
src
/
gpu
/
ganesh
/
mtl
/
GrMtlFramebuffer
.
h
"
#
import
<
Metal
/
Metal
.
h
>
class
GrMtlGpu
;
class
GrMtlRenderTarget
:
public
GrRenderTarget
{
public
:
static
sk_sp
<
GrMtlRenderTarget
>
MakeWrappedRenderTarget
(
GrMtlGpu
*
SkISize
int
sampleCnt
id
<
MTLTexture
>
)
;
~
GrMtlRenderTarget
(
)
override
;
bool
canAttemptStencilAttachment
(
bool
useMSAASurface
)
const
override
{
SkASSERT
(
useMSAASurface
=
=
(
this
-
>
numSamples
(
)
>
1
)
)
;
return
true
;
}
GrMtlAttachment
*
colorAttachment
(
)
const
{
return
fColorAttachment
.
get
(
)
;
}
id
<
MTLTexture
>
colorMTLTexture
(
)
const
{
return
fColorAttachment
-
>
mtlTexture
(
)
;
}
GrMtlAttachment
*
resolveAttachment
(
)
const
{
return
fResolveAttachment
.
get
(
)
;
}
id
<
MTLTexture
>
resolveMTLTexture
(
)
const
{
return
fResolveAttachment
-
>
mtlTexture
(
)
;
}
GrMtlAttachment
*
nonMSAAAttachment
(
)
const
{
if
(
fColorAttachment
-
>
numSamples
(
)
=
=
1
)
{
return
fColorAttachment
.
get
(
)
;
}
else
{
return
fResolveAttachment
.
get
(
)
;
}
}
GrBackendRenderTarget
getBackendRenderTarget
(
)
const
override
;
GrBackendFormat
backendFormat
(
)
const
override
;
const
GrMtlFramebuffer
*
getFramebuffer
(
bool
withResolve
bool
withStencil
)
;
protected
:
GrMtlRenderTarget
(
GrMtlGpu
*
gpu
SkISize
sk_sp
<
GrMtlAttachment
>
colorAttachment
sk_sp
<
GrMtlAttachment
>
resolveAttachment
std
:
:
string_view
label
)
;
GrMtlGpu
*
getMtlGpu
(
)
const
;
void
onAbandon
(
)
override
;
void
onRelease
(
)
override
;
size_t
onGpuMemorySize
(
)
const
override
{
return
0
;
}
void
onSetLabel
(
)
override
;
sk_sp
<
GrMtlAttachment
>
fColorAttachment
;
sk_sp
<
GrMtlAttachment
>
fResolveAttachment
;
private
:
enum
Wrapped
{
kWrapped
}
;
GrMtlRenderTarget
(
GrMtlGpu
*
gpu
SkISize
sk_sp
<
GrMtlAttachment
>
colorAttachment
sk_sp
<
GrMtlAttachment
>
resolveAttachment
Wrapped
std
:
:
string_view
label
)
;
bool
completeStencilAttachment
(
GrAttachment
*
stencil
bool
useMSAASurface
)
override
;
inline
static
constexpr
int
kNumCachedFramebuffers
=
4
;
sk_sp
<
const
GrMtlFramebuffer
>
fCachedFramebuffers
[
kNumCachedFramebuffers
]
;
using
INHERITED
=
GrRenderTarget
;
}
;
#
endif
