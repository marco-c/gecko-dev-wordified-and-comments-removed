#
include
"
src
/
gpu
/
ganesh
/
mtl
/
GrMtlSemaphore
.
h
"
#
include
"
src
/
gpu
/
ganesh
/
mtl
/
GrMtlGpu
.
h
"
#
if
!
__has_feature
(
objc_arc
)
#
error
This
file
must
be
compiled
with
Arc
.
Use
-
fobjc
-
arc
flag
#
endif
GR_NORETAIN_BEGIN
sk_sp
<
GrMtlEvent
>
GrMtlEvent
:
:
Make
(
GrMtlGpu
*
gpu
)
{
if
(
available
(
macOS
10
.
14
iOS
12
.
0
*
)
)
{
id
<
MTLEvent
>
event
=
[
gpu
-
>
device
(
)
newEvent
]
;
return
sk_sp
<
GrMtlEvent
>
(
new
GrMtlEvent
(
event
)
)
;
}
else
{
return
nullptr
;
}
}
sk_sp
<
GrMtlEvent
>
GrMtlEvent
:
:
MakeWrapped
(
GrMTLHandle
event
)
{
if
(
available
(
macOS
10
.
14
iOS
12
.
0
*
)
)
{
id
<
MTLEvent
>
mtlEvent
=
(
__bridge_transfer
id
<
MTLEvent
>
)
event
;
return
sk_sp
<
GrMtlEvent
>
(
new
GrMtlEvent
(
mtlEvent
)
)
;
}
else
{
return
nullptr
;
}
}
GrBackendSemaphore
GrMtlSemaphore
:
:
backendSemaphore
(
)
const
{
GrBackendSemaphore
backendSemaphore
;
if
(
available
(
macOS
10
.
14
iOS
12
.
0
*
)
)
{
GrMTLHandle
handle
=
(
__bridge_retained
GrMTLHandle
)
(
fEvent
-
>
mtlEvent
(
)
)
;
backendSemaphore
.
initMetal
(
handle
fValue
)
;
}
return
backendSemaphore
;
}
GR_NORETAIN_END
