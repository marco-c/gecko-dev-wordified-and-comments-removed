#
ifndef
PathRenderer_DEFINED
#
define
PathRenderer_DEFINED
#
include
"
include
/
core
/
SkRefCnt
.
h
"
#
include
"
include
/
private
/
base
/
SkTArray
.
h
"
#
include
"
include
/
private
/
gpu
/
ganesh
/
GrTypesPriv
.
h
"
class
GrCaps
;
class
GrClip
;
class
GrHardClip
;
class
GrPaint
;
class
GrRecordingContext
;
class
GrRenderTargetProxy
;
class
GrStyledShape
;
class
GrStyle
;
struct
GrUserStencilSettings
;
struct
SkIRect
;
class
SkMatrix
;
class
SkPath
;
class
SkSurfaceProps
;
namespace
skgpu
:
:
ganesh
{
class
SurfaceDrawContext
;
class
PathRenderer
:
public
SkRefCnt
{
public
:
PathRenderer
(
)
=
default
;
virtual
const
char
*
name
(
)
const
=
0
;
enum
StencilSupport
{
kNoSupport_StencilSupport
kStencilOnly_StencilSupport
kNoRestriction_StencilSupport
}
;
StencilSupport
getStencilSupport
(
const
GrStyledShape
&
shape
)
const
;
enum
class
CanDrawPath
{
kNo
kAsBackup
kYes
}
;
struct
CanDrawPathArgs
{
SkDEBUGCODE
(
CanDrawPathArgs
(
)
{
memset
(
this
0
sizeof
(
*
this
)
)
;
}
)
const
GrCaps
*
fCaps
;
const
GrRenderTargetProxy
*
fProxy
;
const
SkIRect
*
fClipConservativeBounds
;
const
SkMatrix
*
fViewMatrix
;
const
GrStyledShape
*
fShape
;
const
GrPaint
*
fPaint
;
const
SkSurfaceProps
*
fSurfaceProps
;
GrAAType
fAAType
;
bool
fHasUserStencilSettings
;
#
ifdef
SK_DEBUG
void
validate
(
)
const
{
SkASSERT
(
fCaps
)
;
SkASSERT
(
fProxy
)
;
SkASSERT
(
fClipConservativeBounds
)
;
SkASSERT
(
fViewMatrix
)
;
SkASSERT
(
fShape
)
;
SkASSERT
(
fSurfaceProps
)
;
}
#
endif
}
;
CanDrawPath
canDrawPath
(
const
CanDrawPathArgs
&
args
)
const
{
SkDEBUGCODE
(
args
.
validate
(
)
;
)
return
this
-
>
onCanDrawPath
(
args
)
;
}
struct
DrawPathArgs
{
GrRecordingContext
*
fContext
;
GrPaint
&
&
fPaint
;
const
GrUserStencilSettings
*
fUserStencilSettings
;
SurfaceDrawContext
*
fSurfaceDrawContext
;
const
GrClip
*
fClip
;
const
SkIRect
*
fClipConservativeBounds
;
const
SkMatrix
*
fViewMatrix
;
const
GrStyledShape
*
fShape
;
GrAAType
fAAType
;
bool
fGammaCorrect
;
#
ifdef
SK_DEBUG
void
validate
(
)
const
{
SkASSERT
(
fContext
)
;
SkASSERT
(
fUserStencilSettings
)
;
SkASSERT
(
fSurfaceDrawContext
)
;
SkASSERT
(
fClipConservativeBounds
)
;
SkASSERT
(
fViewMatrix
)
;
SkASSERT
(
fShape
)
;
}
#
endif
}
;
bool
drawPath
(
const
DrawPathArgs
&
args
)
;
struct
StencilPathArgs
{
SkDEBUGCODE
(
StencilPathArgs
(
)
{
memset
(
this
0
sizeof
(
*
this
)
)
;
}
)
GrRecordingContext
*
fContext
;
SurfaceDrawContext
*
fSurfaceDrawContext
;
const
GrHardClip
*
fClip
;
const
SkIRect
*
fClipConservativeBounds
;
const
SkMatrix
*
fViewMatrix
;
const
GrStyledShape
*
fShape
;
GrAA
fDoStencilMSAA
;
SkDEBUGCODE
(
void
validate
(
)
const
)
;
}
;
void
stencilPath
(
const
StencilPathArgs
&
args
)
{
SkDEBUGCODE
(
args
.
validate
(
)
;
)
SkASSERT
(
kNoSupport_StencilSupport
!
=
this
-
>
getStencilSupport
(
*
args
.
fShape
)
)
;
this
-
>
onStencilPath
(
args
)
;
}
protected
:
static
void
GetPathDevBounds
(
const
SkPath
&
path
SkISize
devSize
const
SkMatrix
&
matrix
SkRect
*
bounds
)
;
private
:
virtual
StencilSupport
onGetStencilSupport
(
const
GrStyledShape
&
)
const
{
return
kNoRestriction_StencilSupport
;
}
virtual
bool
onDrawPath
(
const
DrawPathArgs
&
args
)
=
0
;
virtual
CanDrawPath
onCanDrawPath
(
const
CanDrawPathArgs
&
args
)
const
=
0
;
virtual
void
onStencilPath
(
const
StencilPathArgs
&
)
;
using
INHERITED
=
SkRefCnt
;
}
;
}
#
endif
