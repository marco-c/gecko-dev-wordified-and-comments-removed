#
ifndef
GrTextureProducer_DEFINED
#
define
GrTextureProducer_DEFINED
#
include
"
GrSamplerParams
.
h
"
#
include
"
GrResourceKey
.
h
"
class
GrColorSpaceXform
;
class
GrResourceProvider
;
class
GrTexture
;
class
GrTextureProxy
;
class
GrTextureProducer
:
public
SkNoncopyable
{
public
:
struct
CopyParams
{
GrSamplerParams
:
:
FilterMode
fFilter
;
int
fWidth
;
int
fHeight
;
}
;
enum
FilterConstraint
{
kYes_FilterConstraint
kNo_FilterConstraint
}
;
virtual
sk_sp
<
GrFragmentProcessor
>
createFragmentProcessor
(
const
SkMatrix
&
textureMatrix
const
SkRect
&
constraintRect
FilterConstraint
filterConstraint
bool
coordsLimitedToConstraintRect
const
GrSamplerParams
:
:
FilterMode
*
filterOrNullForBicubic
SkColorSpace
*
dstColorSpace
)
=
0
;
virtual
~
GrTextureProducer
(
)
{
}
int
width
(
)
const
{
return
fWidth
;
}
int
height
(
)
const
{
return
fHeight
;
}
bool
isAlphaOnly
(
)
const
{
return
fIsAlphaOnly
;
}
virtual
SkAlphaType
alphaType
(
)
const
=
0
;
protected
:
friend
class
GrTextureProducer_TestAccess
;
GrTextureProducer
(
int
width
int
height
bool
isAlphaOnly
)
:
fWidth
(
width
)
fHeight
(
height
)
fIsAlphaOnly
(
isAlphaOnly
)
{
}
static
void
MakeCopyKeyFromOrigKey
(
const
GrUniqueKey
&
origKey
const
CopyParams
&
copyParams
GrUniqueKey
*
copyKey
)
{
SkASSERT
(
!
copyKey
-
>
isValid
(
)
)
;
if
(
origKey
.
isValid
(
)
)
{
static
const
GrUniqueKey
:
:
Domain
kDomain
=
GrUniqueKey
:
:
GenerateDomain
(
)
;
GrUniqueKey
:
:
Builder
builder
(
copyKey
origKey
kDomain
3
)
;
builder
[
0
]
=
copyParams
.
fFilter
;
builder
[
1
]
=
copyParams
.
fWidth
;
builder
[
2
]
=
copyParams
.
fHeight
;
}
}
virtual
void
makeCopyKey
(
const
CopyParams
&
GrUniqueKey
*
copyKey
SkColorSpace
*
dstColorSpace
)
=
0
;
virtual
void
didCacheCopy
(
const
GrUniqueKey
&
copyKey
)
=
0
;
enum
DomainMode
{
kNoDomain_DomainMode
kDomain_DomainMode
kTightCopy_DomainMode
}
;
static
sk_sp
<
GrTextureProxy
>
CopyOnGpu
(
GrContext
*
sk_sp
<
GrTextureProxy
>
inputProxy
const
SkIRect
*
subset
const
CopyParams
&
copyParams
)
;
static
DomainMode
DetermineDomainMode
(
const
SkRect
&
constraintRect
FilterConstraint
filterConstraint
bool
coordsLimitedToConstraintRect
GrTextureProxy
*
const
SkIRect
*
textureContentArea
const
GrSamplerParams
:
:
FilterMode
*
filterModeOrNullForBicubic
SkRect
*
domainRect
)
;
static
sk_sp
<
GrFragmentProcessor
>
CreateFragmentProcessorForDomainAndFilter
(
GrResourceProvider
*
sk_sp
<
GrTextureProxy
>
proxy
sk_sp
<
GrColorSpaceXform
>
const
SkMatrix
&
textureMatrix
DomainMode
const
SkRect
&
domain
const
GrSamplerParams
:
:
FilterMode
*
filterOrNullForBicubic
)
;
private
:
const
int
fWidth
;
const
int
fHeight
;
const
bool
fIsAlphaOnly
;
typedef
SkNoncopyable
INHERITED
;
}
;
#
endif
