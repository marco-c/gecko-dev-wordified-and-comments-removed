#
ifndef
GrGLVertexArray_DEFINED
#
define
GrGLVertexArray_DEFINED
#
include
"
GrGpuResource
.
h
"
#
include
"
GrTypesPriv
.
h
"
#
include
"
gl
/
GrGLDefines
.
h
"
#
include
"
gl
/
GrGLTypes
.
h
"
#
include
"
SkTArray
.
h
"
class
GrBuffer
;
class
GrGLGpu
;
class
GrGLAttribArrayState
{
public
:
explicit
GrGLAttribArrayState
(
int
arrayCount
=
0
)
{
this
-
>
resize
(
arrayCount
)
;
}
void
resize
(
int
newCount
)
{
fAttribArrayStates
.
resize_back
(
newCount
)
;
this
-
>
invalidate
(
)
;
}
void
set
(
GrGLGpu
*
int
attribIndex
const
GrBuffer
*
vertexBuffer
GrVertexAttribType
type
GrGLsizei
stride
size_t
offsetInBytes
int
divisor
=
0
)
;
enum
class
EnablePrimitiveRestart
:
bool
{
kYes
=
true
kNo
=
false
}
;
void
enableVertexArrays
(
const
GrGLGpu
*
int
enabledCount
EnablePrimitiveRestart
=
EnablePrimitiveRestart
:
:
kNo
)
;
void
invalidate
(
)
{
int
count
=
fAttribArrayStates
.
count
(
)
;
for
(
int
i
=
0
;
i
<
count
;
+
+
i
)
{
fAttribArrayStates
[
i
]
.
invalidate
(
)
;
}
fEnableStateIsValid
=
false
;
}
int
count
(
)
const
{
return
fAttribArrayStates
.
count
(
)
;
}
private
:
static
constexpr
int
kInvalidDivisor
=
-
1
;
struct
AttribArrayState
{
void
invalidate
(
)
{
fVertexBufferUniqueID
.
makeInvalid
(
)
;
fDivisor
=
kInvalidDivisor
;
}
GrGpuResource
:
:
UniqueID
fVertexBufferUniqueID
;
GrVertexAttribType
fType
;
GrGLsizei
fStride
;
size_t
fOffset
;
int
fDivisor
;
}
;
SkSTArray
<
16
AttribArrayState
true
>
fAttribArrayStates
;
int
fNumEnabledArrays
;
EnablePrimitiveRestart
fPrimitiveRestartEnabled
;
bool
fEnableStateIsValid
=
false
;
}
;
class
GrGLVertexArray
{
public
:
GrGLVertexArray
(
GrGLint
id
int
attribCount
)
;
GrGLAttribArrayState
*
bind
(
GrGLGpu
*
)
;
GrGLAttribArrayState
*
bindWithIndexBuffer
(
GrGLGpu
*
gpu
const
GrBuffer
*
indexBuffer
)
;
GrGLuint
arrayID
(
)
const
{
return
fID
;
}
void
invalidateCachedState
(
)
;
private
:
GrGLuint
fID
;
GrGLAttribArrayState
fAttribArrays
;
GrGpuResource
:
:
UniqueID
fIndexBufferUniqueID
;
}
;
#
endif
