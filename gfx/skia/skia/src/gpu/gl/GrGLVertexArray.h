#
ifndef
GrGLVertexArray_DEFINED
#
define
GrGLVertexArray_DEFINED
#
include
"
GrGpuResource
.
h
"
#
include
"
GrTypesPriv
.
h
"
#
include
"
gl
/
GrGLDefines
.
h
"
#
include
"
gl
/
GrGLTypes
.
h
"
#
include
"
SkTArray
.
h
"
class
GrBuffer
;
class
GrGLGpu
;
class
GrGLAttribArrayState
{
public
:
explicit
GrGLAttribArrayState
(
int
arrayCount
=
0
)
{
this
-
>
resize
(
arrayCount
)
;
}
void
resize
(
int
newCount
)
{
fAttribArrayStates
.
resize_back
(
newCount
)
;
for
(
int
i
=
0
;
i
<
newCount
;
+
+
i
)
{
fAttribArrayStates
[
i
]
.
invalidate
(
)
;
}
}
void
set
(
GrGLGpu
*
int
attribIndex
const
GrBuffer
*
vertexBuffer
GrVertexAttribType
type
GrGLsizei
stride
GrGLvoid
*
offset
)
;
void
disableUnusedArrays
(
const
GrGLGpu
*
uint64_t
usedAttribArrayMask
)
;
void
invalidate
(
)
{
int
count
=
fAttribArrayStates
.
count
(
)
;
for
(
int
i
=
0
;
i
<
count
;
+
+
i
)
{
fAttribArrayStates
[
i
]
.
invalidate
(
)
;
}
}
int
count
(
)
const
{
return
fAttribArrayStates
.
count
(
)
;
}
private
:
struct
AttribArrayState
{
void
invalidate
(
)
{
fEnableIsValid
=
false
;
fVertexBufferUniqueID
.
makeInvalid
(
)
;
}
bool
fEnableIsValid
;
bool
fEnabled
;
GrGpuResource
:
:
UniqueID
fVertexBufferUniqueID
;
GrVertexAttribType
fType
;
GrGLsizei
fStride
;
GrGLvoid
*
fOffset
;
}
;
SkSTArray
<
16
AttribArrayState
true
>
fAttribArrayStates
;
}
;
class
GrGLVertexArray
{
public
:
GrGLVertexArray
(
GrGLint
id
int
attribCount
)
;
GrGLAttribArrayState
*
bind
(
GrGLGpu
*
)
;
GrGLAttribArrayState
*
bindWithIndexBuffer
(
GrGLGpu
*
gpu
const
GrBuffer
*
indexBuffer
)
;
GrGLuint
arrayID
(
)
const
{
return
fID
;
}
void
invalidateCachedState
(
)
;
private
:
GrGLuint
fID
;
GrGLAttribArrayState
fAttribArrays
;
GrGpuResource
:
:
UniqueID
fIndexBufferUniqueID
;
}
;
#
endif
