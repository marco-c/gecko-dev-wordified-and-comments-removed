#
ifndef
GrOnFlushResourceProvider_DEFINED
#
define
GrOnFlushResourceProvider_DEFINED
#
include
"
GrDeferredUpload
.
h
"
#
include
"
GrOpFlushState
.
h
"
#
include
"
GrResourceProvider
.
h
"
#
include
"
SkRefCnt
.
h
"
#
include
"
SkTArray
.
h
"
class
GrDrawingManager
;
class
GrOpList
;
class
GrOnFlushResourceProvider
;
class
GrRenderTargetOpList
;
class
GrRenderTargetContext
;
class
GrSurfaceProxy
;
class
SkColorSpace
;
class
SkSurfaceProps
;
class
GrOnFlushCallbackObject
{
public
:
virtual
~
GrOnFlushCallbackObject
(
)
{
}
virtual
void
preFlush
(
GrOnFlushResourceProvider
*
const
uint32_t
*
opListIDs
int
numOpListIDs
SkTArray
<
sk_sp
<
GrRenderTargetContext
>
>
*
results
)
=
0
;
virtual
void
postFlush
(
GrDeferredUploadToken
startTokenForNextFlush
const
uint32_t
*
opListIDs
int
numOpListIDs
)
{
}
virtual
bool
retainOnFreeGpuResources
(
)
{
return
false
;
}
}
;
class
GrOnFlushResourceProvider
{
public
:
explicit
GrOnFlushResourceProvider
(
GrDrawingManager
*
drawingMgr
)
:
fDrawingMgr
(
drawingMgr
)
{
}
sk_sp
<
GrRenderTargetContext
>
makeRenderTargetContext
(
const
GrSurfaceDesc
&
GrSurfaceOrigin
sk_sp
<
SkColorSpace
>
const
SkSurfaceProps
*
)
;
sk_sp
<
GrRenderTargetContext
>
makeRenderTargetContext
(
sk_sp
<
GrSurfaceProxy
>
sk_sp
<
SkColorSpace
>
const
SkSurfaceProps
*
)
;
bool
assignUniqueKeyToProxy
(
const
GrUniqueKey
&
GrTextureProxy
*
)
;
void
removeUniqueKeyFromProxy
(
const
GrUniqueKey
&
GrTextureProxy
*
)
;
sk_sp
<
GrTextureProxy
>
findOrCreateProxyByUniqueKey
(
const
GrUniqueKey
&
GrSurfaceOrigin
)
;
bool
instatiateProxy
(
GrSurfaceProxy
*
)
;
sk_sp
<
GrBuffer
>
makeBuffer
(
GrBufferType
size_t
const
void
*
data
=
nullptr
)
;
sk_sp
<
const
GrBuffer
>
findOrMakeStaticBuffer
(
GrBufferType
size_t
const
void
*
data
const
GrUniqueKey
&
)
;
uint32_t
contextUniqueID
(
)
const
;
const
GrCaps
*
caps
(
)
const
;
private
:
GrOnFlushResourceProvider
(
const
GrOnFlushResourceProvider
&
)
=
delete
;
GrOnFlushResourceProvider
&
operator
=
(
const
GrOnFlushResourceProvider
&
)
=
delete
;
GrDrawingManager
*
fDrawingMgr
;
}
;
#
endif
