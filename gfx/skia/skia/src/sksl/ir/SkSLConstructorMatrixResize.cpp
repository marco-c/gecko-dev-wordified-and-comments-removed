#
include
"
src
/
sksl
/
ir
/
SkSLConstructorMatrixResize
.
h
"
#
include
"
include
/
core
/
SkTypes
.
h
"
#
include
"
src
/
sksl
/
ir
/
SkSLType
.
h
"
namespace
SkSL
{
std
:
:
unique_ptr
<
Expression
>
ConstructorMatrixResize
:
:
Make
(
const
Context
&
context
Position
pos
const
Type
&
type
std
:
:
unique_ptr
<
Expression
>
arg
)
{
SkASSERT
(
type
.
isMatrix
(
)
)
;
SkASSERT
(
type
.
isAllowedInES2
(
context
)
)
;
SkASSERT
(
arg
-
>
type
(
)
.
componentType
(
)
.
matches
(
type
.
componentType
(
)
)
)
;
if
(
type
.
rows
(
)
=
=
arg
-
>
type
(
)
.
rows
(
)
&
&
type
.
columns
(
)
=
=
arg
-
>
type
(
)
.
columns
(
)
)
{
return
arg
;
}
return
std
:
:
make_unique
<
ConstructorMatrixResize
>
(
pos
type
std
:
:
move
(
arg
)
)
;
}
std
:
:
optional
<
double
>
ConstructorMatrixResize
:
:
getConstantValue
(
int
n
)
const
{
int
rows
=
this
-
>
type
(
)
.
rows
(
)
;
int
row
=
n
%
rows
;
int
col
=
n
/
rows
;
SkASSERT
(
col
>
=
0
)
;
SkASSERT
(
row
>
=
0
)
;
SkASSERT
(
col
<
this
-
>
type
(
)
.
columns
(
)
)
;
SkASSERT
(
row
<
this
-
>
type
(
)
.
rows
(
)
)
;
if
(
col
<
this
-
>
argument
(
)
-
>
type
(
)
.
columns
(
)
&
&
row
<
this
-
>
argument
(
)
-
>
type
(
)
.
rows
(
)
)
{
n
=
row
+
(
col
*
this
-
>
argument
(
)
-
>
type
(
)
.
rows
(
)
)
;
return
this
-
>
argument
(
)
-
>
getConstantValue
(
n
)
;
}
return
(
col
=
=
row
)
?
1
.
0
:
0
.
0
;
}
}
