#
ifndef
SKIASL_TYPE
#
define
SKIASL_TYPE
#
include
"
SkSLModifiers
.
h
"
#
include
"
SkSLSymbol
.
h
"
#
include
"
.
.
/
SkSLPosition
.
h
"
#
include
"
.
.
/
SkSLUtil
.
h
"
#
include
"
.
.
/
spirv
.
h
"
#
include
<
vector
>
#
include
<
memory
>
namespace
SkSL
{
class
Context
;
class
Type
:
public
Symbol
{
public
:
struct
Field
{
Field
(
Modifiers
modifiers
String
name
const
Type
*
type
)
:
fModifiers
(
modifiers
)
fName
(
std
:
:
move
(
name
)
)
fType
(
std
:
:
move
(
type
)
)
{
}
const
String
description
(
)
const
{
return
fType
-
>
description
(
)
+
"
"
+
fName
+
"
;
"
;
}
Modifiers
fModifiers
;
String
fName
;
const
Type
*
fType
;
}
;
enum
Kind
{
kScalar_Kind
kVector_Kind
kMatrix_Kind
kArray_Kind
kStruct_Kind
kGeneric_Kind
kSampler_Kind
kOther_Kind
}
;
Type
(
String
name
)
:
INHERITED
(
Position
(
)
kType_Kind
std
:
:
move
(
name
)
)
fTypeKind
(
kOther_Kind
)
{
}
Type
(
String
name
std
:
:
vector
<
const
Type
*
>
types
)
:
INHERITED
(
Position
(
)
kType_Kind
std
:
:
move
(
name
)
)
fTypeKind
(
kGeneric_Kind
)
fCoercibleTypes
(
std
:
:
move
(
types
)
)
{
}
Type
(
Position
position
String
name
std
:
:
vector
<
Field
>
fields
)
:
INHERITED
(
position
kType_Kind
std
:
:
move
(
name
)
)
fTypeKind
(
kStruct_Kind
)
fFields
(
std
:
:
move
(
fields
)
)
{
}
Type
(
String
name
bool
isNumber
)
:
INHERITED
(
Position
(
)
kType_Kind
std
:
:
move
(
name
)
)
fTypeKind
(
kScalar_Kind
)
fIsNumber
(
isNumber
)
fColumns
(
1
)
fRows
(
1
)
{
}
Type
(
String
name
bool
isNumber
std
:
:
vector
<
const
Type
*
>
coercibleTypes
)
:
INHERITED
(
Position
(
)
kType_Kind
std
:
:
move
(
name
)
)
fTypeKind
(
kScalar_Kind
)
fIsNumber
(
isNumber
)
fCoercibleTypes
(
std
:
:
move
(
coercibleTypes
)
)
fColumns
(
1
)
fRows
(
1
)
{
}
Type
(
String
name
const
Type
&
componentType
int
columns
)
:
Type
(
name
kVector_Kind
componentType
columns
)
{
}
Type
(
String
name
Kind
kind
const
Type
&
componentType
int
columns
)
:
INHERITED
(
Position
(
)
kType_Kind
std
:
:
move
(
name
)
)
fTypeKind
(
kind
)
fComponentType
(
&
componentType
)
fColumns
(
columns
)
fRows
(
1
)
fDimensions
(
SpvDim1D
)
{
}
Type
(
String
name
const
Type
&
componentType
int
columns
int
rows
)
:
INHERITED
(
Position
(
)
kType_Kind
std
:
:
move
(
name
)
)
fTypeKind
(
kMatrix_Kind
)
fComponentType
(
&
componentType
)
fColumns
(
columns
)
fRows
(
rows
)
fDimensions
(
SpvDim1D
)
{
}
Type
(
String
name
SpvDim_
dimensions
bool
isDepth
bool
isArrayed
bool
isMultisampled
bool
isSampled
)
:
INHERITED
(
Position
(
)
kType_Kind
std
:
:
move
(
name
)
)
fTypeKind
(
kSampler_Kind
)
fDimensions
(
dimensions
)
fIsDepth
(
isDepth
)
fIsArrayed
(
isArrayed
)
fIsMultisampled
(
isMultisampled
)
fIsSampled
(
isSampled
)
{
}
String
name
(
)
const
{
return
fName
;
}
String
description
(
)
const
override
{
return
fName
;
}
bool
operator
=
=
(
const
Type
&
other
)
const
{
return
fName
=
=
other
.
fName
;
}
bool
operator
!
=
(
const
Type
&
other
)
const
{
return
fName
!
=
other
.
fName
;
}
Kind
kind
(
)
const
{
return
fTypeKind
;
}
bool
isNumber
(
)
const
{
return
fIsNumber
;
}
bool
canCoerceTo
(
const
Type
&
other
)
const
{
int
cost
;
return
determineCoercionCost
(
other
&
cost
)
;
}
bool
determineCoercionCost
(
const
Type
&
other
int
*
outCost
)
const
;
const
Type
&
componentType
(
)
const
{
ASSERT
(
fComponentType
)
;
return
*
fComponentType
;
}
int
columns
(
)
const
{
ASSERT
(
fTypeKind
=
=
kScalar_Kind
|
|
fTypeKind
=
=
kVector_Kind
|
|
fTypeKind
=
=
kMatrix_Kind
|
|
fTypeKind
=
=
kArray_Kind
)
;
return
fColumns
;
}
int
rows
(
)
const
{
ASSERT
(
fRows
>
0
)
;
return
fRows
;
}
const
std
:
:
vector
<
Field
>
&
fields
(
)
const
{
ASSERT
(
fTypeKind
=
=
kStruct_Kind
)
;
return
fFields
;
}
const
std
:
:
vector
<
const
Type
*
>
&
coercibleTypes
(
)
const
{
ASSERT
(
fCoercibleTypes
.
size
(
)
>
0
)
;
return
fCoercibleTypes
;
}
SpvDim_
dimensions
(
)
const
{
ASSERT
(
kSampler_Kind
=
=
fTypeKind
)
;
return
fDimensions
;
}
bool
isDepth
(
)
const
{
ASSERT
(
kSampler_Kind
=
=
fTypeKind
)
;
return
fIsDepth
;
}
bool
isArrayed
(
)
const
{
ASSERT
(
kSampler_Kind
=
=
fTypeKind
)
;
return
fIsArrayed
;
}
bool
isMultisampled
(
)
const
{
ASSERT
(
kSampler_Kind
=
=
fTypeKind
)
;
return
fIsMultisampled
;
}
bool
isSampled
(
)
const
{
ASSERT
(
kSampler_Kind
=
=
fTypeKind
)
;
return
fIsSampled
;
}
const
Type
&
toCompound
(
const
Context
&
context
int
columns
int
rows
)
const
;
private
:
typedef
Symbol
INHERITED
;
const
Kind
fTypeKind
;
const
bool
fIsNumber
=
false
;
const
Type
*
fComponentType
=
nullptr
;
const
std
:
:
vector
<
const
Type
*
>
fCoercibleTypes
;
const
int
fColumns
=
-
1
;
const
int
fRows
=
-
1
;
const
std
:
:
vector
<
Field
>
fFields
;
const
SpvDim_
fDimensions
=
SpvDim1D
;
const
bool
fIsDepth
=
false
;
const
bool
fIsArrayed
=
false
;
const
bool
fIsMultisampled
=
false
;
const
bool
fIsSampled
=
false
;
}
;
}
#
endif
