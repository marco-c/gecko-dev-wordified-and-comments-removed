#
ifndef
SKSL_PARSER
#
define
SKSL_PARSER
#
include
<
vector
>
#
include
<
memory
>
#
include
<
unordered_map
>
#
include
<
unordered_set
>
#
include
"
src
/
sksl
/
SkSLASTFile
.
h
"
#
include
"
src
/
sksl
/
SkSLASTNode
.
h
"
#
include
"
src
/
sksl
/
SkSLErrorReporter
.
h
"
#
include
"
src
/
sksl
/
SkSLLexer
.
h
"
#
include
"
src
/
sksl
/
ir
/
SkSLLayout
.
h
"
struct
yy_buffer_state
;
#
define
YY_TYPEDEF_YY_BUFFER_STATE
typedef
struct
yy_buffer_state
*
YY_BUFFER_STATE
;
namespace
SkSL
{
struct
Modifiers
;
class
SymbolTable
;
class
Parser
{
public
:
enum
class
LayoutToken
{
LOCATION
OFFSET
BINDING
INDEX
SET
BUILTIN
INPUT_ATTACHMENT_INDEX
ORIGIN_UPPER_LEFT
OVERRIDE_COVERAGE
BLEND_SUPPORT_ALL_EQUATIONS
BLEND_SUPPORT_MULTIPLY
BLEND_SUPPORT_SCREEN
BLEND_SUPPORT_OVERLAY
BLEND_SUPPORT_DARKEN
BLEND_SUPPORT_LIGHTEN
BLEND_SUPPORT_COLORDODGE
BLEND_SUPPORT_COLORBURN
BLEND_SUPPORT_HARDLIGHT
BLEND_SUPPORT_SOFTLIGHT
BLEND_SUPPORT_DIFFERENCE
BLEND_SUPPORT_EXCLUSION
BLEND_SUPPORT_HSL_HUE
BLEND_SUPPORT_HSL_SATURATION
BLEND_SUPPORT_HSL_COLOR
BLEND_SUPPORT_HSL_LUMINOSITY
PUSH_CONSTANT
POINTS
LINES
LINE_STRIP
LINES_ADJACENCY
TRIANGLES
TRIANGLE_STRIP
TRIANGLES_ADJACENCY
MAX_VERTICES
INVOCATIONS
WHEN
KEY
TRACKED
CTYPE
SKPMCOLOR4F
SKVECTOR4
SKRECT
SKIRECT
SKPMCOLOR
SKMATRIX44
BOOL
INT
FLOAT
}
;
Parser
(
const
char
*
text
size_t
length
SymbolTable
&
types
ErrorReporter
&
errors
)
;
std
:
:
unique_ptr
<
ASTFile
>
file
(
)
;
StringFragment
text
(
Token
token
)
;
Position
position
(
Token
token
)
;
private
:
static
void
InitLayoutMap
(
)
;
Token
nextRawToken
(
)
;
Token
nextToken
(
)
;
void
pushback
(
Token
t
)
;
Token
peek
(
)
;
bool
checkNext
(
Token
:
:
Kind
kind
Token
*
result
=
nullptr
)
;
bool
expect
(
Token
:
:
Kind
kind
const
char
*
expected
Token
*
result
=
nullptr
)
;
bool
expect
(
Token
:
:
Kind
kind
String
expected
Token
*
result
=
nullptr
)
;
void
error
(
Token
token
String
msg
)
;
void
error
(
int
offset
String
msg
)
;
bool
isType
(
StringFragment
name
)
;
ASTNode
&
getNode
(
ASTNode
:
:
ID
id
)
{
SkASSERT
(
id
.
fValue
>
=
0
&
&
id
.
fValue
<
(
int
)
fFile
-
>
fNodes
.
size
(
)
)
;
return
fFile
-
>
fNodes
[
id
.
fValue
]
;
}
ASTNode
:
:
ID
precision
(
)
;
ASTNode
:
:
ID
directive
(
)
;
ASTNode
:
:
ID
section
(
)
;
ASTNode
:
:
ID
enumDeclaration
(
)
;
ASTNode
:
:
ID
declaration
(
)
;
ASTNode
:
:
ID
varDeclarations
(
)
;
ASTNode
:
:
ID
structDeclaration
(
)
;
ASTNode
:
:
ID
structVarDeclaration
(
Modifiers
modifiers
)
;
ASTNode
:
:
ID
varDeclarationEnd
(
Modifiers
modifiers
ASTNode
:
:
ID
type
StringFragment
name
)
;
ASTNode
:
:
ID
parameter
(
)
;
int
layoutInt
(
)
;
StringFragment
layoutIdentifier
(
)
;
StringFragment
layoutCode
(
)
;
Layout
:
:
Key
layoutKey
(
)
;
Layout
:
:
CType
layoutCType
(
)
;
Layout
layout
(
)
;
Modifiers
modifiers
(
)
;
Modifiers
modifiersWithDefaults
(
int
defaultFlags
)
;
ASTNode
:
:
ID
statement
(
)
;
ASTNode
:
:
ID
type
(
)
;
ASTNode
:
:
ID
interfaceBlock
(
Modifiers
mods
)
;
ASTNode
:
:
ID
ifStatement
(
)
;
ASTNode
:
:
ID
doStatement
(
)
;
ASTNode
:
:
ID
whileStatement
(
)
;
ASTNode
:
:
ID
forStatement
(
)
;
ASTNode
:
:
ID
switchCase
(
)
;
ASTNode
:
:
ID
switchStatement
(
)
;
ASTNode
:
:
ID
returnStatement
(
)
;
ASTNode
:
:
ID
breakStatement
(
)
;
ASTNode
:
:
ID
continueStatement
(
)
;
ASTNode
:
:
ID
discardStatement
(
)
;
ASTNode
:
:
ID
block
(
)
;
ASTNode
:
:
ID
expressionStatement
(
)
;
ASTNode
:
:
ID
expression
(
)
;
ASTNode
:
:
ID
assignmentExpression
(
)
;
ASTNode
:
:
ID
ternaryExpression
(
)
;
ASTNode
:
:
ID
logicalOrExpression
(
)
;
ASTNode
:
:
ID
logicalXorExpression
(
)
;
ASTNode
:
:
ID
logicalAndExpression
(
)
;
ASTNode
:
:
ID
bitwiseOrExpression
(
)
;
ASTNode
:
:
ID
bitwiseXorExpression
(
)
;
ASTNode
:
:
ID
bitwiseAndExpression
(
)
;
ASTNode
:
:
ID
equalityExpression
(
)
;
ASTNode
:
:
ID
relationalExpression
(
)
;
ASTNode
:
:
ID
shiftExpression
(
)
;
ASTNode
:
:
ID
additiveExpression
(
)
;
ASTNode
:
:
ID
multiplicativeExpression
(
)
;
ASTNode
:
:
ID
unaryExpression
(
)
;
ASTNode
:
:
ID
postfixExpression
(
)
;
ASTNode
:
:
ID
suffix
(
ASTNode
:
:
ID
base
)
;
ASTNode
:
:
ID
term
(
)
;
bool
intLiteral
(
SKSL_INT
*
dest
)
;
bool
floatLiteral
(
SKSL_FLOAT
*
dest
)
;
bool
boolLiteral
(
bool
*
dest
)
;
bool
identifier
(
StringFragment
*
dest
)
;
static
std
:
:
unordered_map
<
String
LayoutToken
>
*
layoutTokens
;
const
char
*
fText
;
Lexer
fLexer
;
YY_BUFFER_STATE
fBuffer
;
int
fDepth
=
0
;
Token
fPushback
;
SymbolTable
&
fTypes
;
ErrorReporter
&
fErrors
;
std
:
:
unique_ptr
<
ASTFile
>
fFile
;
friend
class
AutoDepth
;
friend
class
HCodeGenerator
;
}
;
}
#
endif
