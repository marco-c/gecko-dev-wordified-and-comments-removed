#
ifndef
SkSRGB_DEFINED
#
define
SkSRGB_DEFINED
#
include
"
SkNx
.
h
"
extern
const
float
sk_linear_from_srgb
[
256
]
;
extern
const
uint16_t
sk_linear12_from_srgb
[
256
]
;
extern
const
uint8_t
sk_linear12_to_srgb
[
4096
]
;
static
inline
Sk4i
sk_linear_to_srgb
(
const
Sk4f
&
x
)
{
auto
rsqrt
=
x
.
rsqrt
(
)
sqrt
=
rsqrt
.
invert
(
)
ftrt
=
rsqrt
.
rsqrt
(
)
;
auto
lo
=
(
13
.
0471f
*
255
.
0f
)
*
x
;
auto
hi
=
SkNx_fma
(
Sk4f
{
+
0
.
412999f
*
255
.
0f
}
ftrt
SkNx_fma
(
Sk4f
{
+
0
.
687999f
*
255
.
0f
}
sqrt
Sk4f
{
-
0
.
0974983f
*
255
.
0f
}
)
)
;
auto
s
=
(
x
<
0
.
0048f
)
.
thenElse
(
lo
hi
)
;
return
SkNx_cast
<
int
>
(
Sk4f
:
:
Min
(
Sk4f
:
:
Max
(
s
0
.
0f
)
255
.
0f
)
)
;
}
#
endif
