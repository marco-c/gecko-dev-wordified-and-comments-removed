#
ifndef
SkSpecialImage_DEFINED
#
define
SkSpecialImage_DEFINED
#
include
"
SkNextID
.
h
"
#
include
"
SkRefCnt
.
h
"
#
include
"
SkSurfaceProps
.
h
"
#
include
"
SkImageFilter
.
h
"
#
include
"
SkImageInfo
.
h
"
class
GrContext
;
class
GrTexture
;
class
SkBitmap
;
class
SkCanvas
;
class
SkImage
;
struct
SkImageInfo
;
class
SkPaint
;
class
SkPixmap
;
class
SkSpecialSurface
;
class
SkSurface
;
enum
{
kNeedNewImageUniqueID_SpecialImage
=
0
}
;
class
SkSpecialImage
:
public
SkRefCnt
{
public
:
typedef
void
*
ReleaseContext
;
typedef
void
(
*
RasterReleaseProc
)
(
void
*
pixels
ReleaseContext
)
;
const
SkSurfaceProps
&
props
(
)
const
{
return
fProps
;
}
int
width
(
)
const
{
return
fSubset
.
width
(
)
;
}
int
height
(
)
const
{
return
fSubset
.
height
(
)
;
}
const
SkIRect
&
subset
(
)
const
{
return
fSubset
;
}
uint32_t
uniqueID
(
)
const
{
return
fUniqueID
;
}
virtual
bool
isOpaque
(
)
const
{
return
false
;
}
virtual
size_t
getSize
(
)
const
=
0
;
sk_sp
<
SkSpecialImage
>
makeTextureImage
(
SkImageFilter
:
:
Proxy
*
GrContext
*
)
;
void
draw
(
SkCanvas
*
SkScalar
x
SkScalar
y
const
SkPaint
*
)
const
;
static
sk_sp
<
SkSpecialImage
>
MakeFromImage
(
SkImageFilter
:
:
Proxy
*
const
SkIRect
&
subset
sk_sp
<
SkImage
>
const
SkSurfaceProps
*
=
nullptr
)
;
static
sk_sp
<
SkSpecialImage
>
MakeFromRaster
(
SkImageFilter
:
:
Proxy
*
const
SkIRect
&
subset
const
SkBitmap
&
const
SkSurfaceProps
*
=
nullptr
)
;
static
sk_sp
<
SkSpecialImage
>
MakeFromGpu
(
SkImageFilter
:
:
Proxy
*
const
SkIRect
&
subset
uint32_t
uniqueID
GrTexture
*
const
SkSurfaceProps
*
=
nullptr
SkAlphaType
at
=
kPremul_SkAlphaType
)
;
static
sk_sp
<
SkSpecialImage
>
MakeFromPixmap
(
SkImageFilter
:
:
Proxy
*
const
SkIRect
&
subset
const
SkPixmap
&
RasterReleaseProc
ReleaseContext
const
SkSurfaceProps
*
=
nullptr
)
;
sk_sp
<
SkSpecialSurface
>
makeSurface
(
const
SkImageInfo
&
)
const
;
sk_sp
<
SkSurface
>
makeTightSurface
(
const
SkImageInfo
&
)
const
;
sk_sp
<
SkSpecialImage
>
makeSubset
(
const
SkIRect
&
subset
)
const
;
sk_sp
<
SkImage
>
makeTightSubset
(
const
SkIRect
&
subset
)
const
;
bool
internal_getBM
(
SkBitmap
*
result
)
;
static
sk_sp
<
SkSpecialImage
>
internal_fromBM
(
SkImageFilter
:
:
Proxy
*
const
SkBitmap
&
const
SkSurfaceProps
*
)
;
SkImageFilter
:
:
Proxy
*
internal_getProxy
(
)
const
;
GrTexture
*
peekTexture
(
)
const
;
bool
peekPixels
(
SkPixmap
*
)
const
;
protected
:
SkSpecialImage
(
SkImageFilter
:
:
Proxy
*
const
SkIRect
&
subset
uint32_t
uniqueID
const
SkSurfaceProps
*
)
;
friend
class
TestingSpecialImageAccess
;
friend
class
TestingSpecialSurfaceAccess
;
bool
testingOnlyGetROPixels
(
SkBitmap
*
)
const
;
SkImageFilter
:
:
Proxy
*
proxy
(
)
const
{
return
fProxy
;
}
private
:
const
SkSurfaceProps
fProps
;
const
SkIRect
fSubset
;
const
uint32_t
fUniqueID
;
SkImageFilter
:
:
Proxy
*
fProxy
;
typedef
SkRefCnt
INHERITED
;
}
;
#
endif
