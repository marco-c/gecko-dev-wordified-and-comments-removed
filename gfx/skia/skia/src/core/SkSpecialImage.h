#
ifndef
SkSpecialImage_DEFINED
#
define
SkSpecialImage_DEFINED
#
include
"
include
/
core
/
SkImageInfo
.
h
"
#
include
"
include
/
core
/
SkRefCnt
.
h
"
#
include
"
include
/
core
/
SkSurfaceProps
.
h
"
#
include
"
src
/
core
/
SkNextID
.
h
"
#
if
SK_SUPPORT_GPU
#
include
"
include
/
private
/
GrTypesPriv
.
h
"
#
endif
class
GrRecordingContext
;
class
GrTextureProxy
;
class
SkBitmap
;
class
SkCanvas
;
class
SkImage
;
struct
SkImageInfo
;
class
SkPaint
;
class
SkPixmap
;
class
SkSpecialSurface
;
class
SkSurface
;
enum
{
kNeedNewImageUniqueID_SpecialImage
=
0
}
;
class
SkSpecialImage
:
public
SkRefCnt
{
public
:
typedef
void
*
ReleaseContext
;
typedef
void
(
*
RasterReleaseProc
)
(
void
*
pixels
ReleaseContext
)
;
const
SkSurfaceProps
&
props
(
)
const
{
return
fProps
;
}
int
width
(
)
const
{
return
fSubset
.
width
(
)
;
}
int
height
(
)
const
{
return
fSubset
.
height
(
)
;
}
const
SkIRect
&
subset
(
)
const
{
return
fSubset
;
}
SkColorSpace
*
getColorSpace
(
)
const
;
uint32_t
uniqueID
(
)
const
{
return
fUniqueID
;
}
virtual
SkAlphaType
alphaType
(
)
const
=
0
;
virtual
SkColorType
colorType
(
)
const
=
0
;
virtual
size_t
getSize
(
)
const
=
0
;
sk_sp
<
SkSpecialImage
>
makeTextureImage
(
GrRecordingContext
*
)
const
;
void
draw
(
SkCanvas
*
SkScalar
x
SkScalar
y
const
SkPaint
*
)
const
;
static
sk_sp
<
SkSpecialImage
>
MakeFromImage
(
GrRecordingContext
*
const
SkIRect
&
subset
sk_sp
<
SkImage
>
const
SkSurfaceProps
*
=
nullptr
)
;
static
sk_sp
<
SkSpecialImage
>
MakeFromRaster
(
const
SkIRect
&
subset
const
SkBitmap
&
const
SkSurfaceProps
*
=
nullptr
)
;
static
sk_sp
<
SkSpecialImage
>
CopyFromRaster
(
const
SkIRect
&
subset
const
SkBitmap
&
const
SkSurfaceProps
*
=
nullptr
)
;
#
if
SK_SUPPORT_GPU
static
sk_sp
<
SkSpecialImage
>
MakeDeferredFromGpu
(
GrRecordingContext
*
const
SkIRect
&
subset
uint32_t
uniqueID
sk_sp
<
GrTextureProxy
>
GrColorType
sk_sp
<
SkColorSpace
>
const
SkSurfaceProps
*
=
nullptr
SkAlphaType
at
=
kPremul_SkAlphaType
)
;
#
endif
sk_sp
<
SkSpecialSurface
>
makeSurface
(
SkColorType
colorType
const
SkColorSpace
*
colorSpace
const
SkISize
&
size
SkAlphaType
at
=
kPremul_SkAlphaType
const
SkSurfaceProps
*
props
=
nullptr
)
const
;
sk_sp
<
SkSurface
>
makeTightSurface
(
SkColorType
colorType
const
SkColorSpace
*
colorSpace
const
SkISize
&
size
SkAlphaType
at
=
kPremul_SkAlphaType
)
const
;
sk_sp
<
SkSpecialImage
>
makeSubset
(
const
SkIRect
&
subset
)
const
;
sk_sp
<
SkImage
>
asImage
(
const
SkIRect
*
subset
=
nullptr
)
const
;
bool
isTextureBacked
(
)
const
;
GrRecordingContext
*
getContext
(
)
const
;
#
if
SK_SUPPORT_GPU
sk_sp
<
GrTextureProxy
>
asTextureProxyRef
(
GrRecordingContext
*
)
const
;
#
endif
bool
getROPixels
(
SkBitmap
*
)
const
;
protected
:
SkSpecialImage
(
const
SkIRect
&
subset
uint32_t
uniqueID
const
SkSurfaceProps
*
)
;
private
:
const
SkSurfaceProps
fProps
;
const
SkIRect
fSubset
;
const
uint32_t
fUniqueID
;
typedef
SkRefCnt
INHERITED
;
}
;
#
endif
