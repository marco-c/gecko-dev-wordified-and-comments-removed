#
include
"
SkRecord
.
h
"
#
include
<
algorithm
>
SkRecord
:
:
~
SkRecord
(
)
{
Destroyer
destroyer
;
for
(
int
i
=
0
;
i
<
this
-
>
count
(
)
;
i
+
+
)
{
this
-
>
mutate
<
void
>
(
i
destroyer
)
;
}
}
void
SkRecord
:
:
grow
(
)
{
SkASSERT
(
fCount
=
=
fReserved
)
;
SkASSERT
(
fReserved
>
0
)
;
fReserved
*
=
2
;
fRecords
.
realloc
(
fReserved
)
;
}
size_t
SkRecord
:
:
bytesUsed
(
)
const
{
size_t
bytes
=
fAlloc
.
approxBytesAllocated
(
)
+
sizeof
(
SkRecord
)
;
if
(
fReserved
>
kInlineRecords
)
{
bytes
+
=
fReserved
*
sizeof
(
Record
)
;
}
return
bytes
;
}
void
SkRecord
:
:
defrag
(
)
{
Record
*
noops
=
std
:
:
remove_if
(
fRecords
.
get
(
)
fRecords
.
get
(
)
+
fCount
[
]
(
Record
op
)
{
return
op
.
type
(
)
=
=
SkRecords
:
:
NoOp_Type
;
}
)
;
fCount
=
noops
-
fRecords
.
get
(
)
;
}
