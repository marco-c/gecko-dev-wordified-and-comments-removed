#
ifndef
GFX_VR_PROCESS_MANAGER_H
#
define
GFX_VR_PROCESS_MANAGER_H
#
include
"
VRProcessParent
.
h
"
#
include
"
mozilla
/
ipc
/
ProtocolUtils
.
h
"
#
include
"
nsIObserver
.
h
"
namespace
mozilla
{
class
MemoryReportingProcess
;
namespace
ipc
{
template
<
typename
T
>
class
Endpoint
;
}
namespace
gfx
{
class
VRManagerChild
;
class
PVRGPUChild
;
class
VRChild
;
class
VRProcessManager
final
:
public
VRProcessParent
:
:
Listener
{
public
:
static
VRProcessManager
*
Get
(
)
;
static
void
Initialize
(
)
;
static
void
Shutdown
(
)
;
~
VRProcessManager
(
)
;
void
LaunchVRProcess
(
)
;
bool
EnsureVRReady
(
)
;
bool
CreateGPUBridges
(
mozilla
:
:
ipc
:
:
EndpointProcInfo
aOtherProcess
mozilla
:
:
ipc
:
:
Endpoint
<
PVRGPUChild
>
*
aOutVRBridge
)
;
VRChild
*
GetVRChild
(
)
;
RefPtr
<
MemoryReportingProcess
>
GetProcessMemoryReporter
(
)
;
virtual
void
OnProcessLaunchComplete
(
VRProcessParent
*
aParent
)
override
;
virtual
void
OnProcessUnexpectedShutdown
(
VRProcessParent
*
aParent
)
override
;
private
:
VRProcessManager
(
)
;
DISALLOW_COPY_AND_ASSIGN
(
VRProcessManager
)
;
bool
CreateGPUVRManager
(
mozilla
:
:
ipc
:
:
EndpointProcInfo
aOtherProcess
mozilla
:
:
ipc
:
:
Endpoint
<
PVRGPUChild
>
*
aOutEndpoint
)
;
void
OnXPCOMShutdown
(
)
;
void
OnPreferenceChange
(
const
char16_t
*
aData
)
;
void
CleanShutdown
(
)
;
void
DestroyProcess
(
)
;
void
DisableVRProcess
(
const
char
*
aMessage
)
;
class
Observer
final
:
public
nsIObserver
{
public
:
NS_DECL_ISUPPORTS
NS_DECL_NSIOBSERVER
explicit
Observer
(
VRProcessManager
*
aManager
)
;
protected
:
~
Observer
(
)
=
default
;
VRProcessManager
*
mManager
;
}
;
friend
class
Observer
;
RefPtr
<
Observer
>
mObserver
;
VRProcessParent
*
mProcess
;
VRChild
*
mVRChild
;
nsTArray
<
mozilla
:
:
dom
:
:
Pref
>
mQueuedPrefs
;
}
;
}
}
#
endif
