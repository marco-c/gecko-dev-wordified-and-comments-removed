#
ifndef
GFX_VR_PROCESS_PARENT_H
#
define
GFX_VR_PROCESS_PARENT_H
#
include
"
mozilla
/
UniquePtr
.
h
"
#
include
"
mozilla
/
ipc
/
GeckoChildProcessHost
.
h
"
#
include
"
mozilla
/
ipc
/
TaskFactory
.
h
"
namespace
mozilla
{
namespace
ipc
{
class
SharedPreferenceSerializer
;
}
namespace
gfx
{
class
VRChild
;
class
VRProcessParent
final
:
public
mozilla
:
:
ipc
:
:
GeckoChildProcessHost
{
public
:
class
Listener
{
public
:
virtual
void
OnProcessLaunchComplete
(
VRProcessParent
*
aParent
)
{
}
virtual
void
OnProcessUnexpectedShutdown
(
VRProcessParent
*
aParent
)
{
}
}
;
explicit
VRProcessParent
(
Listener
*
aListener
)
;
bool
Launch
(
)
;
bool
WaitForLaunch
(
)
;
void
Shutdown
(
)
;
void
DestroyProcess
(
)
;
bool
CanShutdown
(
)
override
{
return
true
;
}
void
OnChannelError
(
)
override
;
void
OnChannelConnected
(
int32_t
peer_pid
)
override
;
void
OnChannelConnectedTask
(
)
;
void
OnChannelErrorTask
(
)
;
void
OnChannelClosed
(
)
;
bool
IsConnected
(
)
const
;
base
:
:
ProcessId
OtherPid
(
)
;
VRChild
*
GetActor
(
)
const
{
return
mVRChild
.
get
(
)
;
}
uint64_t
GetProcessToken
(
)
const
;
private
:
~
VRProcessParent
(
)
;
DISALLOW_COPY_AND_ASSIGN
(
VRProcessParent
)
;
bool
InitAfterConnect
(
bool
aSucceeded
)
;
void
KillHard
(
const
char
*
aReason
)
;
UniquePtr
<
VRChild
>
mVRChild
;
mozilla
:
:
ipc
:
:
TaskFactory
<
VRProcessParent
>
mTaskFactory
;
nsCOMPtr
<
nsIThread
>
mLaunchThread
;
Listener
*
mListener
;
enum
class
LaunchPhase
{
Unlaunched
Waiting
Complete
}
;
LaunchPhase
mLaunchPhase
;
bool
mChannelClosed
;
bool
mShutdownRequested
;
UniquePtr
<
mozilla
:
:
ipc
:
:
SharedPreferenceSerializer
>
mPrefSerializer
;
}
;
}
}
#
endif
