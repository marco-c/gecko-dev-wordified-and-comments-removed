#
ifndef
GFX_VR_MUTEX_H
#
define
GFX_VR_MUTEX_H
#
if
defined
(
XP_WIN
)
#
include
"
nsTString
.
h
"
#
endif
namespace
mozilla
{
namespace
gfx
{
#
if
defined
(
XP_WIN
)
class
WaitForMutex
{
public
:
explicit
WaitForMutex
(
HANDLE
handle
)
:
mHandle
(
handle
)
mStatus
(
false
)
{
MOZ_ASSERT
(
mHandle
)
;
DWORD
dwWaitResult
;
dwWaitResult
=
WaitForSingleObject
(
mHandle
INFINITE
)
;
switch
(
dwWaitResult
)
{
case
WAIT_OBJECT_0
:
mStatus
=
true
;
break
;
case
WAIT_ABANDONED
:
mStatus
=
false
;
break
;
default
:
mStatus
=
false
;
break
;
}
}
~
WaitForMutex
(
)
{
if
(
mHandle
&
&
!
ReleaseMutex
(
mHandle
)
)
{
#
ifdef
MOZILLA_INTERNAL_API
nsAutoCString
msg
;
msg
.
AppendPrintf
(
"
WaitForMutex
%
d
ReleaseMutex
error
\
"
%
lu
\
"
.
"
mHandle
GetLastError
(
)
)
;
NS_WARNING
(
msg
.
get
(
)
)
;
#
endif
MOZ_ASSERT
(
false
"
Failed
to
release
mutex
.
"
)
;
}
}
bool
GetStatus
(
)
{
return
mStatus
;
}
private
:
HANDLE
mHandle
;
bool
mStatus
;
}
;
#
endif
}
}
#
endif
