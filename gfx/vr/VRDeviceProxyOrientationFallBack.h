#
ifndef
GFX_VR_PROXY_ORIENTATION_FALLBACK_H
#
define
GFX_VR_PROXY_ORIENTATION_FALLBACK_H
#
include
"
VRDeviceProxy
.
h
"
#
include
"
mozilla
/
HalSensor
.
h
"
#
include
"
mozilla
/
HalScreenConfiguration
.
h
"
namespace
mozilla
{
namespace
gfx
{
class
VRDeviceProxyOrientationFallBack
:
public
VRDeviceProxy
public
hal
:
:
ISensorObserver
public
hal
:
:
ScreenConfigurationObserver
{
public
:
explicit
VRDeviceProxyOrientationFallBack
(
const
VRDeviceUpdate
&
aDeviceUpdate
)
;
virtual
void
ZeroSensor
(
)
override
;
virtual
VRHMDSensorState
GetSensorState
(
double
timeOffset
=
0
.
0
)
override
;
void
Notify
(
const
hal
:
:
SensorData
&
SensorData
)
override
;
void
Notify
(
const
hal
:
:
ScreenConfiguration
&
ScreenConfiguration
)
override
;
protected
:
virtual
~
VRDeviceProxyOrientationFallBack
(
)
;
void
StartSensorTracking
(
)
;
void
StopSensorTracking
(
)
;
void
ComputeStateFromLastSensor
(
)
;
uint32_t
mOrient
;
Quaternion
mScreenTransform
;
Quaternion
mSensorZeroInverse
;
Quaternion
mSavedLastSensor
;
double
mSavedLastSensorTime
;
bool
mNeedsSensorCompute
;
bool
mTracking
;
}
;
}
}
#
endif
