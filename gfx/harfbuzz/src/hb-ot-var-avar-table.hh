#
ifndef
HB_OT_VAR_AVAR_TABLE_HH
#
define
HB_OT_VAR_AVAR_TABLE_HH
#
include
"
hb
-
open
-
type
.
hh
"
#
define
HB_OT_TAG_avar
HB_TAG
(
'
a
'
'
v
'
'
a
'
'
r
'
)
namespace
OT
{
struct
AxisValueMap
{
bool
sanitize
(
hb_sanitize_context_t
*
c
)
const
{
TRACE_SANITIZE
(
this
)
;
return_trace
(
c
-
>
check_struct
(
this
)
)
;
}
public
:
F2DOT14
fromCoord
;
F2DOT14
toCoord
;
public
:
DEFINE_SIZE_STATIC
(
4
)
;
}
;
struct
SegmentMaps
:
ArrayOf
<
AxisValueMap
>
{
int
map
(
int
value
)
const
{
if
(
len
<
2
)
{
if
(
!
len
)
return
value
;
else
return
value
-
arrayZ
[
0
]
.
fromCoord
+
arrayZ
[
0
]
.
toCoord
;
}
if
(
value
<
=
arrayZ
[
0
]
.
fromCoord
)
return
value
-
arrayZ
[
0
]
.
fromCoord
+
arrayZ
[
0
]
.
toCoord
;
unsigned
int
i
;
unsigned
int
count
=
len
;
for
(
i
=
1
;
i
<
count
&
&
value
>
arrayZ
[
i
]
.
fromCoord
;
i
+
+
)
;
if
(
value
>
=
arrayZ
[
i
]
.
fromCoord
)
return
value
-
arrayZ
[
i
]
.
fromCoord
+
arrayZ
[
i
]
.
toCoord
;
if
(
unlikely
(
arrayZ
[
i
-
1
]
.
fromCoord
=
=
arrayZ
[
i
]
.
fromCoord
)
)
return
arrayZ
[
i
-
1
]
.
toCoord
;
int
denom
=
arrayZ
[
i
]
.
fromCoord
-
arrayZ
[
i
-
1
]
.
fromCoord
;
return
arrayZ
[
i
-
1
]
.
toCoord
+
(
(
arrayZ
[
i
]
.
toCoord
-
arrayZ
[
i
-
1
]
.
toCoord
)
*
(
value
-
arrayZ
[
i
-
1
]
.
fromCoord
)
+
denom
/
2
)
/
denom
;
}
public
:
DEFINE_SIZE_ARRAY
(
2
*
this
)
;
}
;
struct
avar
{
static
constexpr
hb_tag_t
tableTag
=
HB_OT_TAG_avar
;
bool
sanitize
(
hb_sanitize_context_t
*
c
)
const
{
TRACE_SANITIZE
(
this
)
;
if
(
unlikely
(
!
(
version
.
sanitize
(
c
)
&
&
version
.
major
=
=
1
&
&
c
-
>
check_struct
(
this
)
)
)
)
return_trace
(
false
)
;
const
SegmentMaps
*
map
=
&
firstAxisSegmentMaps
;
unsigned
int
count
=
axisCount
;
for
(
unsigned
int
i
=
0
;
i
<
count
;
i
+
+
)
{
if
(
unlikely
(
!
map
-
>
sanitize
(
c
)
)
)
return_trace
(
false
)
;
map
=
&
StructAfter
<
SegmentMaps
>
(
*
map
)
;
}
return_trace
(
true
)
;
}
void
map_coords
(
int
*
coords
unsigned
int
coords_length
)
const
{
unsigned
int
count
=
hb_min
(
coords_length
axisCount
)
;
const
SegmentMaps
*
map
=
&
firstAxisSegmentMaps
;
for
(
unsigned
int
i
=
0
;
i
<
count
;
i
+
+
)
{
coords
[
i
]
=
map
-
>
map
(
coords
[
i
]
)
;
map
=
&
StructAfter
<
SegmentMaps
>
(
*
map
)
;
}
}
protected
:
FixedVersion
<
>
version
;
HBUINT16
reserved
;
HBUINT16
axisCount
;
SegmentMaps
firstAxisSegmentMaps
;
public
:
DEFINE_SIZE_MIN
(
8
)
;
}
;
}
#
endif
