#
include
"
hb
.
hh
"
#
ifndef
HB_NO_NAME
#
include
"
hb
-
ot
-
name
-
table
.
hh
"
#
include
"
hb
-
utf
.
hh
"
const
hb_ot_name_entry_t
*
hb_ot_name_list_names
(
hb_face_t
*
face
unsigned
int
*
num_entries
)
{
const
OT
:
:
name_accelerator_t
&
name
=
*
face
-
>
table
.
name
;
if
(
num_entries
)
*
num_entries
=
name
.
names
.
length
;
return
(
const
hb_ot_name_entry_t
*
)
name
.
names
;
}
template
<
typename
in_utf_t
typename
out_utf_t
>
static
inline
unsigned
int
hb_ot_name_convert_utf
(
hb_bytes_t
bytes
unsigned
int
*
text_size
typename
out_utf_t
:
:
codepoint_t
*
text
)
{
unsigned
int
src_len
=
bytes
.
length
/
sizeof
(
typename
in_utf_t
:
:
codepoint_t
)
;
const
typename
in_utf_t
:
:
codepoint_t
*
src
=
(
const
typename
in_utf_t
:
:
codepoint_t
*
)
bytes
.
arrayZ
;
const
typename
in_utf_t
:
:
codepoint_t
*
src_end
=
src
+
src_len
;
typename
out_utf_t
:
:
codepoint_t
*
dst
=
text
;
hb_codepoint_t
unicode
;
const
hb_codepoint_t
replacement
=
HB_BUFFER_REPLACEMENT_CODEPOINT_DEFAULT
;
if
(
text_size
&
&
*
text_size
)
{
(
*
text_size
)
-
-
;
const
typename
out_utf_t
:
:
codepoint_t
*
dst_end
=
text
+
*
text_size
;
while
(
src
<
src_end
&
&
dst
<
dst_end
)
{
const
typename
in_utf_t
:
:
codepoint_t
*
src_next
=
in_utf_t
:
:
next
(
src
src_end
&
unicode
replacement
)
;
typename
out_utf_t
:
:
codepoint_t
*
dst_next
=
out_utf_t
:
:
encode
(
dst
dst_end
unicode
)
;
if
(
dst_next
=
=
dst
)
break
;
dst
=
dst_next
;
src
=
src_next
;
}
*
text_size
=
dst
-
text
;
*
dst
=
0
;
}
unsigned
int
dst_len
=
dst
-
text
;
while
(
src
<
src_end
)
{
src
=
in_utf_t
:
:
next
(
src
src_end
&
unicode
replacement
)
;
dst_len
+
=
out_utf_t
:
:
encode_len
(
unicode
)
;
}
return
dst_len
;
}
template
<
typename
utf_t
>
static
inline
unsigned
int
hb_ot_name_get_utf
(
hb_face_t
*
face
hb_ot_name_id_t
name_id
hb_language_t
language
unsigned
int
*
text_size
typename
utf_t
:
:
codepoint_t
*
text
)
{
const
OT
:
:
name_accelerator_t
&
name
=
*
face
-
>
table
.
name
;
if
(
!
language
)
language
=
hb_language_from_string
(
"
en
"
2
)
;
unsigned
int
width
;
int
idx
=
name
.
get_index
(
name_id
language
&
width
)
;
if
(
idx
!
=
-
1
)
{
hb_bytes_t
bytes
=
name
.
get_name
(
idx
)
;
if
(
width
=
=
2
)
return
hb_ot_name_convert_utf
<
hb_utf16_be_t
utf_t
>
(
bytes
text_size
text
)
;
if
(
width
=
=
1
)
return
hb_ot_name_convert_utf
<
hb_ascii_t
utf_t
>
(
bytes
text_size
text
)
;
}
if
(
text_size
)
{
if
(
*
text_size
)
*
text
=
0
;
*
text_size
=
0
;
}
return
0
;
}
unsigned
int
hb_ot_name_get_utf8
(
hb_face_t
*
face
hb_ot_name_id_t
name_id
hb_language_t
language
unsigned
int
*
text_size
char
*
text
)
{
return
hb_ot_name_get_utf
<
hb_utf8_t
>
(
face
name_id
language
text_size
(
hb_utf8_t
:
:
codepoint_t
*
)
text
)
;
}
unsigned
int
hb_ot_name_get_utf16
(
hb_face_t
*
face
hb_ot_name_id_t
name_id
hb_language_t
language
unsigned
int
*
text_size
uint16_t
*
text
)
{
return
hb_ot_name_get_utf
<
hb_utf16_t
>
(
face
name_id
language
text_size
text
)
;
}
unsigned
int
hb_ot_name_get_utf32
(
hb_face_t
*
face
hb_ot_name_id_t
name_id
hb_language_t
language
unsigned
int
*
text_size
uint32_t
*
text
)
{
return
hb_ot_name_get_utf
<
hb_utf32_t
>
(
face
name_id
language
text_size
text
)
;
}
#
endif
