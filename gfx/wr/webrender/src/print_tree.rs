use
std
:
:
io
:
:
Write
;
use
std
:
:
fmt
:
:
Write
as
FmtWrite
;
pub
struct
PrintTree
<
W
>
where
W
:
Write
{
level
:
u32
queued_item
:
Option
<
String
>
line_buffer
:
String
sink
:
W
}
pub
trait
PrintTreePrinter
{
fn
new_level
(
&
mut
self
title
:
String
)
;
fn
end_level
(
&
mut
self
)
;
fn
add_item
(
&
mut
self
text
:
String
)
;
}
impl
PrintTree
<
std
:
:
io
:
:
Sink
>
{
pub
fn
new
(
title
:
&
str
)
-
>
Self
{
PrintTree
:
:
new_with_sink
(
title
std
:
:
io
:
:
sink
(
)
)
}
}
impl
<
W
>
PrintTree
<
W
>
where
W
:
Write
{
pub
fn
new_with_sink
(
title
:
&
str
sink
:
W
)
-
>
Self
{
let
mut
result
=
PrintTree
{
level
:
1
queued_item
:
None
line_buffer
:
String
:
:
new
(
)
sink
}
;
writeln
!
(
result
.
line_buffer
"
\
u
{
250c
}
{
}
"
title
)
.
unwrap
(
)
;
result
.
flush_line
(
)
;
result
}
fn
print_level_prefix
(
&
mut
self
)
{
for
_
in
0
.
.
self
.
level
{
write
!
(
self
.
line_buffer
"
\
u
{
2502
}
"
)
.
unwrap
(
)
;
}
}
fn
flush_queued_item
(
&
mut
self
prefix
:
&
str
)
{
if
let
Some
(
queued_item
)
=
self
.
queued_item
.
take
(
)
{
self
.
print_level_prefix
(
)
;
writeln
!
(
self
.
line_buffer
"
{
}
{
}
"
prefix
queued_item
)
.
unwrap
(
)
;
self
.
flush_line
(
)
;
}
}
fn
flush_line
(
&
mut
self
)
{
debug
!
(
"
{
}
"
self
.
line_buffer
)
;
self
.
sink
.
write_all
(
self
.
line_buffer
.
as_bytes
(
)
)
.
unwrap
(
)
;
self
.
line_buffer
.
clear
(
)
;
}
}
impl
<
W
>
PrintTreePrinter
for
PrintTree
<
W
>
where
W
:
Write
{
fn
new_level
(
&
mut
self
title
:
String
)
{
self
.
flush_queued_item
(
"
\
u
{
251C
}
\
u
{
2500
}
"
)
;
self
.
print_level_prefix
(
)
;
writeln
!
(
self
.
line_buffer
"
\
u
{
251C
}
\
u
{
2500
}
{
}
"
title
)
.
unwrap
(
)
;
self
.
flush_line
(
)
;
self
.
level
=
self
.
level
+
1
;
}
fn
end_level
(
&
mut
self
)
{
self
.
flush_queued_item
(
"
\
u
{
2514
}
\
u
{
2500
}
"
)
;
self
.
level
=
self
.
level
-
1
;
}
fn
add_item
(
&
mut
self
text
:
String
)
{
self
.
flush_queued_item
(
"
\
u
{
251C
}
\
u
{
2500
}
"
)
;
self
.
queued_item
=
Some
(
text
)
;
}
}
impl
<
W
>
Drop
for
PrintTree
<
W
>
where
W
:
Write
{
fn
drop
(
&
mut
self
)
{
self
.
flush_queued_item
(
"
\
u
{
9492
}
\
u
{
9472
}
"
)
;
}
}
pub
trait
PrintableTree
{
fn
print_with
<
T
:
PrintTreePrinter
>
(
&
self
pt
:
&
mut
T
)
;
}
