var
testGenerator
=
testSteps
(
)
;
function
*
testSteps
(
)
{
const
name
=
"
test_wasm_recompile
.
js
"
;
const
objectStoreName
=
"
Wasm
"
;
const
wasmData
=
{
key
:
1
}
;
info
(
"
Installing
profile
"
)
;
clearAllDatabases
(
continueToNextStepSync
)
;
yield
undefined
;
installPackagedProfile
(
"
wasm_get_values_profile
"
)
;
info
(
"
Opening
database
"
)
;
let
request
=
indexedDB
.
open
(
name
)
;
request
.
onerror
=
errorHandler
;
request
.
onupgradeneeded
=
unexpectedSuccessHandler
;
request
.
onsuccess
=
continueToNextStepSync
;
yield
undefined
;
let
db
=
request
.
result
;
db
.
onerror
=
errorHandler
;
info
(
"
Getting
wasm
"
)
;
request
=
db
.
transaction
(
[
objectStoreName
]
)
.
objectStore
(
objectStoreName
)
.
get
(
wasmData
.
key
)
;
request
.
onsuccess
=
continueToNextStepSync
;
yield
undefined
;
info
(
"
Verifying
wasm
"
)
;
let
isWasmModule
=
request
.
result
instanceof
WebAssembly
.
Module
;
ok
(
!
isWasmModule
"
Object
is
not
wasm
module
"
)
;
finishTest
(
)
;
yield
undefined
;
}
