#
include
"
mozilla
/
dom
/
TestFunctions
.
h
"
#
include
"
mozITestInterfaceJS
.
h
"
#
include
"
mozilla
/
StringBuffer
.
h
"
#
include
"
mozilla
/
dom
/
BindingUtils
.
h
"
#
include
"
mozilla
/
dom
/
Document
.
h
"
#
include
"
mozilla
/
dom
/
TestFunctionsBinding
.
h
"
#
include
"
mozilla
/
dom
/
WindowBinding
.
h
"
#
include
"
mozilla
/
dom
/
WrapperCachedNonISupportsTestInterface
.
h
"
#
include
"
nsComponentManagerUtils
.
h
"
#
include
"
nsGlobalWindowInner
.
h
"
namespace
mozilla
:
:
dom
{
UniquePtr
<
TestFunctions
>
TestFunctions
:
:
Constructor
(
GlobalObject
&
aGlobal
)
{
return
MakeUnique
<
TestFunctions
>
(
)
;
}
void
TestFunctions
:
:
ThrowUncatchableException
(
GlobalObject
&
aGlobal
ErrorResult
&
aRv
)
{
aRv
.
ThrowUncatchableException
(
)
;
}
Promise
*
TestFunctions
:
:
PassThroughPromise
(
GlobalObject
&
aGlobal
Promise
&
aPromise
)
{
return
&
aPromise
;
}
already_AddRefed
<
Promise
>
TestFunctions
:
:
PassThroughCallbackPromise
(
GlobalObject
&
aGlobal
PromiseReturner
&
aCallback
ErrorResult
&
aRv
)
{
return
aCallback
.
Call
(
aRv
)
;
}
void
TestFunctions
:
:
SetStringData
(
const
nsAString
&
aString
)
{
mStringData
=
aString
;
}
void
TestFunctions
:
:
GetStringDataAsAString
(
nsAString
&
aString
)
{
aString
=
mStringData
;
}
void
TestFunctions
:
:
GetStringDataAsAString
(
uint32_t
aLength
nsAString
&
aString
)
{
MOZ_RELEASE_ASSERT
(
aLength
<
=
mStringData
.
Length
(
)
"
Bogus
test
passing
in
a
too
-
big
length
"
)
;
aString
.
Assign
(
mStringData
.
BeginReading
(
)
aLength
)
;
}
void
TestFunctions
:
:
GetStringDataAsDOMString
(
const
Optional
<
uint32_t
>
&
aLength
DOMString
&
aString
)
{
uint32_t
length
;
if
(
aLength
.
WasPassed
(
)
)
{
length
=
aLength
.
Value
(
)
;
MOZ_RELEASE_ASSERT
(
length
<
=
mStringData
.
Length
(
)
"
Bogus
test
passing
in
a
too
-
big
length
"
)
;
}
else
{
length
=
mStringData
.
Length
(
)
;
}
if
(
StringBuffer
*
buf
=
mStringData
.
GetStringBuffer
(
)
)
{
aString
.
SetKnownLiveStringBuffer
(
buf
length
)
;
return
;
}
MOZ_RELEASE_ASSERT
(
length
=
=
0
"
Why
no
stringbuffer
?
"
)
;
}
void
TestFunctions
:
:
GetShortLiteralString
(
nsAString
&
aString
)
{
aString
.
AssignLiteral
(
u
"
012345
"
)
;
}
void
TestFunctions
:
:
GetMediumLiteralString
(
nsAString
&
aString
)
{
aString
.
AssignLiteral
(
u
"
0123456789012345678901234567890123456789
"
)
;
}
void
TestFunctions
:
:
GetLongLiteralString
(
nsAString
&
aString
)
{
aString
.
AssignLiteral
(
u
"
0123456789012345678901234567890123456789
"
"
0123456789012345678901234567890123456789
"
)
;
}
void
TestFunctions
:
:
GetStringbufferString
(
const
nsAString
&
aInput
nsAString
&
aRetval
)
{
nsString
str
;
str
.
Assign
(
aInput
.
BeginReading
(
)
aInput
.
Length
(
)
)
;
if
(
str
.
Length
(
)
>
1
)
{
char16_t
last
=
str
[
str
.
Length
(
)
-
1
]
;
str
.
Truncate
(
str
.
Length
(
)
-
1
)
;
if
(
last
=
=
'
x
'
)
{
str
.
Append
(
'
y
'
)
;
}
else
{
str
.
Append
(
'
x
'
)
;
}
}
aRetval
=
str
;
}
StringType
TestFunctions
:
:
GetStringType
(
const
nsAString
&
aString
)
{
if
(
aString
.
IsLiteral
(
)
)
{
return
StringType
:
:
Literal
;
}
if
(
aString
.
GetStringBuffer
(
)
)
{
return
StringType
:
:
Stringbuffer
;
}
if
(
aString
.
GetDataFlags
(
)
&
nsAString
:
:
DataFlags
:
:
INLINE
)
{
return
StringType
:
:
Inline
;
}
return
StringType
:
:
Other
;
}
bool
TestFunctions
:
:
StringbufferMatchesStored
(
const
nsAString
&
aString
)
{
return
aString
.
GetStringBuffer
(
)
&
&
aString
.
GetStringBuffer
(
)
=
=
mStringData
.
GetStringBuffer
(
)
;
}
void
TestFunctions
:
:
TestThrowNsresult
(
ErrorResult
&
aError
)
{
nsCOMPtr
<
mozITestInterfaceJS
>
impl
=
do_CreateInstance
(
"
mozilla
.
org
/
dom
/
test
-
interface
-
js
;
1
"
)
;
aError
=
impl
-
>
TestThrowNsresult
(
)
;
}
void
TestFunctions
:
:
TestThrowNsresultFromNative
(
ErrorResult
&
aError
)
{
nsCOMPtr
<
mozITestInterfaceJS
>
impl
=
do_CreateInstance
(
"
mozilla
.
org
/
dom
/
test
-
interface
-
js
;
1
"
)
;
aError
=
impl
-
>
TestThrowNsresultFromNative
(
)
;
}
already_AddRefed
<
Promise
>
TestFunctions
:
:
ThrowToRejectPromise
(
GlobalObject
&
aGlobal
ErrorResult
&
aError
)
{
aError
.
Throw
(
NS_ERROR_DOM_INVALID_STATE_ERR
)
;
return
nullptr
;
}
int32_t
TestFunctions
:
:
One
(
)
const
{
return
1
;
}
int32_t
TestFunctions
:
:
Two
(
)
const
{
return
2
;
}
void
TestFunctions
:
:
SetClampedNullableOctet
(
const
Nullable
<
uint8_t
>
&
aOctet
)
{
mClampedNullableOctet
=
aOctet
;
}
Nullable
<
uint8_t
>
TestFunctions
:
:
GetClampedNullableOctet
(
)
const
{
return
mClampedNullableOctet
;
}
void
TestFunctions
:
:
SetEnforcedNullableOctet
(
const
Nullable
<
uint8_t
>
&
aOctet
)
{
mEnforcedNullableOctet
=
aOctet
;
}
Nullable
<
uint8_t
>
TestFunctions
:
:
GetEnforcedNullableOctet
(
)
const
{
return
mEnforcedNullableOctet
;
}
void
TestFunctions
:
:
SetArrayBufferView
(
const
ArrayBufferView
&
aBuffer
)
{
}
void
TestFunctions
:
:
GetArrayBufferView
(
JSContext
*
aCx
JS
:
:
Handle
<
JSObject
*
>
aObj
JS
:
:
MutableHandle
<
JSObject
*
>
aRetval
ErrorResult
&
aError
)
{
aError
.
Throw
(
NS_ERROR_NOT_IMPLEMENTED
)
;
}
void
TestFunctions
:
:
SetAllowSharedArrayBufferView
(
const
ArrayBufferView
&
aBuffer
)
{
}
void
TestFunctions
:
:
GetAllowSharedArrayBufferView
(
JSContext
*
aCx
JS
:
:
Handle
<
JSObject
*
>
aObj
JS
:
:
MutableHandle
<
JSObject
*
>
aRetval
ErrorResult
&
aError
)
{
aError
.
Throw
(
NS_ERROR_NOT_IMPLEMENTED
)
;
}
void
TestFunctions
:
:
SetSequenceOfArrayBufferView
(
const
Sequence
<
ArrayBufferView
>
&
aBuffers
)
{
}
void
TestFunctions
:
:
GetSequenceOfArrayBufferView
(
JSContext
*
aCx
JS
:
:
Handle
<
JSObject
*
>
aObj
nsTArray
<
JSObject
*
>
&
aRetval
ErrorResult
&
aError
)
{
aError
.
Throw
(
NS_ERROR_NOT_IMPLEMENTED
)
;
}
void
TestFunctions
:
:
SetSequenceOfAllowSharedArrayBufferView
(
const
Sequence
<
ArrayBufferView
>
&
aBuffers
)
{
}
void
TestFunctions
:
:
GetSequenceOfAllowSharedArrayBufferView
(
JSContext
*
aCx
JS
:
:
Handle
<
JSObject
*
>
aObj
nsTArray
<
JSObject
*
>
&
aRetval
ErrorResult
&
aError
)
{
aError
.
Throw
(
NS_ERROR_NOT_IMPLEMENTED
)
;
}
void
TestFunctions
:
:
SetArrayBuffer
(
const
ArrayBuffer
&
aBuffer
)
{
}
void
TestFunctions
:
:
GetArrayBuffer
(
JSContext
*
aCx
JS
:
:
Handle
<
JSObject
*
>
aObj
JS
:
:
MutableHandle
<
JSObject
*
>
aRetval
ErrorResult
&
aError
)
{
aError
.
Throw
(
NS_ERROR_NOT_IMPLEMENTED
)
;
}
void
TestFunctions
:
:
SetAllowSharedArrayBuffer
(
const
ArrayBuffer
&
aBuffer
)
{
}
void
TestFunctions
:
:
GetAllowSharedArrayBuffer
(
JSContext
*
aCx
JS
:
:
Handle
<
JSObject
*
>
aObj
JS
:
:
MutableHandle
<
JSObject
*
>
aRetval
ErrorResult
&
aError
)
{
aError
.
Throw
(
NS_ERROR_NOT_IMPLEMENTED
)
;
}
void
TestFunctions
:
:
SetSequenceOfArrayBuffer
(
const
Sequence
<
ArrayBuffer
>
&
aBuffers
)
{
}
void
TestFunctions
:
:
GetSequenceOfArrayBuffer
(
JSContext
*
aCx
JS
:
:
Handle
<
JSObject
*
>
aObj
nsTArray
<
JSObject
*
>
&
aRetval
ErrorResult
&
aError
)
{
aError
.
Throw
(
NS_ERROR_NOT_IMPLEMENTED
)
;
}
void
TestFunctions
:
:
SetSequenceOfAllowSharedArrayBuffer
(
const
Sequence
<
ArrayBuffer
>
&
aBuffers
)
{
}
void
TestFunctions
:
:
GetSequenceOfAllowSharedArrayBuffer
(
JSContext
*
aCx
JS
:
:
Handle
<
JSObject
*
>
aObj
nsTArray
<
JSObject
*
>
&
aRetval
ErrorResult
&
aError
)
{
aError
.
Throw
(
NS_ERROR_NOT_IMPLEMENTED
)
;
}
void
TestFunctions
:
:
TestNotAllowShared
(
const
ArrayBufferView
&
aBuffer
)
{
}
void
TestFunctions
:
:
TestNotAllowShared
(
const
ArrayBuffer
&
aBuffer
)
{
}
void
TestFunctions
:
:
TestNotAllowShared
(
const
nsAString
&
aBuffer
)
{
}
void
TestFunctions
:
:
TestAllowShared
(
const
ArrayBufferView
&
aBuffer
)
{
}
void
TestFunctions
:
:
TestAllowShared
(
const
ArrayBuffer
&
aBuffer
)
{
}
void
TestFunctions
:
:
TestDictWithAllowShared
(
const
DictWithAllowSharedBufferSource
&
aDict
)
{
}
void
TestFunctions
:
:
TestUnionOfBufferSource
(
const
ArrayBufferOrArrayBufferViewOrString
&
aUnion
)
{
}
void
TestFunctions
:
:
TestUnionOfAllowSharedBufferSource
(
const
AllowSharedBufferSource
&
aUnion
)
{
}
void
TestFunctions
:
:
TestUnionWithAllowShared
(
const
MaybeSharedInt8ArrayOrMaybeSharedInt16Array
&
aUnion
)
{
}
bool
TestFunctions
:
:
ObjectFromAboutBlank
(
JSContext
*
aCx
JSObject
*
aObj
)
{
RefPtr
<
nsGlobalWindowInner
>
win
;
UNWRAP_MAYBE_CROSS_ORIGIN_OBJECT
(
Window
aObj
win
aCx
)
;
if
(
!
win
)
{
return
false
;
}
Document
*
doc
=
win
-
>
GetDoc
(
)
;
if
(
!
doc
)
{
return
false
;
}
return
doc
-
>
GetDocumentURI
(
)
-
>
GetSpecOrDefault
(
)
.
EqualsLiteral
(
"
about
:
blank
"
)
;
}
WrapperCachedNonISupportsTestInterface
*
TestFunctions
:
:
WrapperCachedNonISupportsObject
(
)
{
if
(
!
mWrapperCachedNonISupportsTestInterface
)
{
mWrapperCachedNonISupportsTestInterface
=
new
WrapperCachedNonISupportsTestInterface
(
)
;
}
return
mWrapperCachedNonISupportsTestInterface
;
}
already_AddRefed
<
TestChromeOnlyInterface
>
TestFunctions
:
:
CreateTestChromeOnlyInterface
(
GlobalObject
&
aGlobal
)
{
return
MakeRefPtr
<
TestChromeOnlyInterface
>
(
aGlobal
.
GetAsSupports
(
)
)
.
forget
(
)
;
}
bool
TestFunctions
:
:
WrapObject
(
JSContext
*
aCx
JS
:
:
Handle
<
JSObject
*
>
aGivenProto
JS
:
:
MutableHandle
<
JSObject
*
>
aWrapper
)
{
return
TestFunctions_Binding
:
:
Wrap
(
aCx
this
aGivenProto
aWrapper
)
;
}
JSObject
*
TestChromeOnlyInterface
:
:
WrapObject
(
JSContext
*
aCx
JS
:
:
Handle
<
JSObject
*
>
aGivenProto
)
{
return
TestChromeOnlyInterface_Binding
:
:
Wrap
(
aCx
this
aGivenProto
)
;
}
NS_IMPL_CYCLE_COLLECTION_WRAPPERCACHE
(
TestChromeOnlyInterface
mParent
)
}
