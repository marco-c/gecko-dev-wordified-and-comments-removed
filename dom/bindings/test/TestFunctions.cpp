#
include
"
mozilla
/
dom
/
TestFunctions
.
h
"
#
include
"
mozilla
/
dom
/
TestFunctionsBinding
.
h
"
#
include
"
nsStringBuffer
.
h
"
namespace
mozilla
{
namespace
dom
{
TestFunctions
*
TestFunctions
:
:
Constructor
(
GlobalObject
&
aGlobal
ErrorResult
&
aRv
)
{
return
new
TestFunctions
;
}
void
TestFunctions
:
:
ThrowUncatchableException
(
GlobalObject
&
aGlobal
ErrorResult
&
aRv
)
{
aRv
.
ThrowUncatchableException
(
)
;
}
Promise
*
TestFunctions
:
:
PassThroughPromise
(
GlobalObject
&
aGlobal
Promise
&
aPromise
)
{
return
&
aPromise
;
}
already_AddRefed
<
Promise
>
TestFunctions
:
:
PassThroughCallbackPromise
(
GlobalObject
&
aGlobal
PromiseReturner
&
aCallback
ErrorResult
&
aRv
)
{
return
aCallback
.
Call
(
aRv
)
;
}
void
TestFunctions
:
:
SetStringData
(
const
nsAString
&
aString
)
{
mStringData
=
aString
;
}
void
TestFunctions
:
:
GetStringDataAsAString
(
nsAString
&
aString
)
{
aString
=
mStringData
;
}
void
TestFunctions
:
:
GetStringDataAsAString
(
uint32_t
aLength
nsAString
&
aString
)
{
MOZ_RELEASE_ASSERT
(
aLength
<
=
mStringData
.
Length
(
)
"
Bogus
test
passing
in
a
too
-
big
length
"
)
;
aString
.
Assign
(
mStringData
.
BeginReading
(
)
aLength
)
;
}
void
TestFunctions
:
:
GetStringDataAsDOMString
(
const
Optional
<
uint32_t
>
&
aLength
DOMString
&
aString
)
{
uint32_t
length
;
if
(
aLength
.
WasPassed
(
)
)
{
length
=
aLength
.
Value
(
)
;
MOZ_RELEASE_ASSERT
(
length
<
=
mStringData
.
Length
(
)
"
Bogus
test
passing
in
a
too
-
big
length
"
)
;
}
else
{
length
=
mStringData
.
Length
(
)
;
}
nsStringBuffer
*
buf
=
nsStringBuffer
:
:
FromString
(
mStringData
)
;
if
(
buf
)
{
aString
.
SetStringBuffer
(
buf
length
)
;
return
;
}
MOZ_RELEASE_ASSERT
(
length
=
=
0
"
Why
no
stringbuffer
?
"
)
;
}
bool
TestFunctions
:
:
WrapObject
(
JSContext
*
aCx
JS
:
:
Handle
<
JSObject
*
>
aGivenProto
JS
:
:
MutableHandle
<
JSObject
*
>
aWrapper
)
{
return
TestFunctionsBinding
:
:
Wrap
(
aCx
this
aGivenProto
aWrapper
)
;
}
}
}
