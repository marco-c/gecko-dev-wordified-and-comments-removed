import
sys
import
string
import
argparse
import
subprocess
import
buildconfig
from
mozbuild
import
shellutil
def
generateLine
(
propName
extendedAttrs
)
:
    
return
"
[
%
s
]
attribute
DOMString
%
s
;
\
n
"
%
(
"
"
.
join
(
extendedAttrs
)
                                                 
propName
)
def
generate
(
output
idlFilename
preprocessorHeader
)
:
    
cpp
=
list
(
buildconfig
.
substs
[
'
CPP
'
]
)
    
cpp
+
=
shellutil
.
split
(
buildconfig
.
substs
[
'
ACDEFINES
'
]
)
    
cpp
.
append
(
preprocessorHeader
)
    
preprocessed
=
subprocess
.
check_output
(
cpp
)
    
propList
=
eval
(
preprocessed
)
    
props
=
"
"
    
for
[
name
prop
id
flags
pref
proptype
]
in
propList
:
        
if
"
CSS_PROPERTY_INTERNAL
"
in
flags
:
            
continue
        
extendedAttrs
=
[
"
CEReactions
"
"
Throws
"
"
TreatNullAs
=
EmptyString
"
                         
"
SetterNeedsSubjectPrincipal
=
NonSystem
"
]
        
if
pref
is
not
"
"
:
            
extendedAttrs
.
append
(
'
Pref
=
"
%
s
"
'
%
pref
)
        
if
(
prop
.
startswith
(
"
Webkit
"
)
)
:
            
extendedAttrs
.
append
(
'
BindingAlias
=
"
%
s
"
'
%
prop
)
        
if
not
prop
.
startswith
(
"
Moz
"
)
:
            
prop
=
prop
[
0
]
.
lower
(
)
+
prop
[
1
:
]
        
if
prop
!
=
name
:
            
extendedAttrs
.
append
(
'
BindingAlias
=
"
%
s
"
'
%
name
)
        
props
+
=
generateLine
(
prop
extendedAttrs
)
    
idlFile
=
open
(
idlFilename
"
r
"
)
    
idlTemplate
=
idlFile
.
read
(
)
    
idlFile
.
close
(
)
    
output
.
write
(
"
/
*
THIS
IS
AN
AUTOGENERATED
FILE
.
DO
NOT
EDIT
*
/
\
n
\
n
"
+
                 
string
.
Template
(
idlTemplate
)
.
substitute
(
{
"
props
"
:
props
}
)
+
'
\
n
'
)
def
main
(
)
:
    
parser
=
argparse
.
ArgumentParser
(
)
    
parser
.
add_argument
(
'
idlFilename
'
help
=
'
IDL
property
file
template
'
)
    
parser
.
add_argument
(
'
preprocessorHeader
'
help
=
'
Header
file
to
pass
through
the
preprocessor
'
)
    
args
=
parser
.
parse_args
(
)
    
generate
(
sys
.
stdout
args
.
idlFilename
args
.
preprocessorHeader
)
if
__name__
=
=
'
__main__
'
:
    
main
(
)
