#
include
"
mozilla
/
dom
/
Date
.
h
"
#
include
"
jsapi
.
h
"
#
include
"
jsfriendapi
.
h
"
#
include
"
js
/
Date
.
h
"
#
include
"
js
/
RootingAPI
.
h
"
#
include
"
js
/
Value
.
h
"
#
include
"
mozilla
/
FloatingPoint
.
h
"
namespace
mozilla
{
namespace
dom
{
bool
Date
:
:
SetTimeStamp
(
JSContext
*
aCx
JSObject
*
aObject
)
{
JS
:
:
Rooted
<
JSObject
*
>
obj
(
aCx
aObject
)
;
double
msecs
;
if
(
!
js
:
:
DateGetMsecSinceEpoch
(
aCx
obj
&
msecs
)
)
{
return
false
;
}
JS
:
:
ClippedTime
time
=
JS
:
:
TimeClip
(
msecs
)
;
MOZ_ASSERT
(
NumbersAreIdentical
(
msecs
time
.
toDouble
(
)
)
)
;
mMsecSinceEpoch
=
time
;
return
true
;
}
bool
Date
:
:
ToDateObject
(
JSContext
*
aCx
JS
:
:
MutableHandle
<
JS
:
:
Value
>
aRval
)
const
{
JSObject
*
obj
=
JS
:
:
NewDateObject
(
aCx
mMsecSinceEpoch
)
;
if
(
!
obj
)
{
return
false
;
}
aRval
.
setObject
(
*
obj
)
;
return
true
;
}
}
}
