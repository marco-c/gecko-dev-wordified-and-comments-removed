#
ifndef
DOM_QUOTA_QMRESULTINLINES_H_
#
define
DOM_QUOTA_QMRESULTINLINES_H_
#
ifndef
DOM_QUOTA_QMRESULT_H_
#
error
Must
include
QMResult
.
h
first
#
endif
#
include
"
mozilla
/
Result
.
h
"
#
include
"
mozilla
/
ResultExtensions
.
h
"
#
ifdef
QM_ERROR_STACKS_ENABLED
#
include
"
nsError
.
h
"
#
include
"
mozilla
/
ResultVariant
.
h
"
#
endif
namespace
mozilla
{
#
ifdef
QM_ERROR_STACKS_ENABLED
template
<
>
class
[
[
nodiscard
]
]
GenericErrorResult
<
QMResult
>
{
QMResult
mErrorValue
;
template
<
typename
V
typename
E2
>
friend
class
Result
;
public
:
explicit
GenericErrorResult
(
const
QMResult
&
aErrorValue
)
:
mErrorValue
(
aErrorValue
)
{
MOZ_ASSERT
(
NS_FAILED
(
aErrorValue
.
NSResult
(
)
)
)
;
}
explicit
GenericErrorResult
(
QMResult
&
&
aErrorValue
)
:
mErrorValue
(
std
:
:
move
(
aErrorValue
)
)
{
MOZ_ASSERT
(
NS_FAILED
(
aErrorValue
.
NSResult
(
)
)
)
;
}
explicit
GenericErrorResult
(
const
QMResult
&
aErrorValue
const
ErrorPropagationTag
&
)
:
GenericErrorResult
(
aErrorValue
.
Propagate
(
)
)
{
}
explicit
GenericErrorResult
(
QMResult
&
&
aErrorValue
const
ErrorPropagationTag
&
)
:
GenericErrorResult
(
aErrorValue
.
Propagate
(
)
)
{
}
operator
QMResult
(
)
const
{
return
mErrorValue
;
}
operator
nsresult
(
)
const
{
return
mErrorValue
.
NSResult
(
)
;
}
}
;
template
<
>
struct
ResultTypeTraits
<
QMResult
>
{
static
QMResult
From
(
nsresult
aValue
)
{
return
ToQMResult
(
aValue
)
;
}
static
QMResult
From
(
const
QMResult
&
aValue
)
{
return
aValue
;
}
static
QMResult
From
(
QMResult
&
&
aValue
)
{
return
std
:
:
move
(
aValue
)
;
}
}
;
template
<
typename
E
>
inline
Result
<
Ok
E
>
ToResult
(
const
QMResult
&
aValue
)
{
if
(
NS_FAILED
(
aValue
.
NSResult
(
)
)
)
{
return
Err
(
ResultTypeTraits
<
E
>
:
:
From
(
aValue
)
)
;
}
return
Ok
(
)
;
}
template
<
typename
E
>
inline
Result
<
Ok
E
>
ToResult
(
QMResult
&
&
aValue
)
{
if
(
NS_FAILED
(
aValue
.
NSResult
(
)
)
)
{
return
Err
(
ResultTypeTraits
<
E
>
:
:
From
(
aValue
)
)
;
}
return
Ok
(
)
;
}
#
endif
}
#
endif
