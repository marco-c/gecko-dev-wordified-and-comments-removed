#
ifndef
DOM_QUOTA_ORIGINOPERATIONBASE_H_
#
define
DOM_QUOTA_ORIGINOPERATIONBASE_H_
#
include
"
ErrorList
.
h
"
#
include
"
mozilla
/
NotNull
.
h
"
#
include
"
mozilla
/
RefPtr
.
h
"
#
include
"
mozilla
/
dom
/
quota
/
Config
.
h
"
#
include
"
mozilla
/
dom
/
quota
/
ForwardDecls
.
h
"
#
include
"
mozilla
/
dom
/
quota
/
QuotaCommon
.
h
"
#
include
"
mozilla
/
dom
/
quota
/
StringifyUtils
.
h
"
#
include
"
nsISupportsImpl
.
h
"
namespace
mozilla
:
:
dom
:
:
quota
{
class
QuotaManager
;
class
OriginOperationBase
:
public
BackgroundThreadObject
public
Stringifyable
{
protected
:
const
NotNull
<
RefPtr
<
QuotaManager
>
>
mQuotaManager
;
nsresult
mResultCode
;
private
:
bool
mActorDestroyed
;
#
ifdef
QM_COLLECTING_OPERATION_TELEMETRY
const
char
*
mName
=
nullptr
;
#
endif
public
:
NS_INLINE_DECL_REFCOUNTING
(
OriginOperationBase
)
void
NoteActorDestroyed
(
)
{
AssertIsOnOwningThread
(
)
;
mActorDestroyed
=
true
;
}
bool
IsActorDestroyed
(
)
const
{
AssertIsOnOwningThread
(
)
;
return
mActorDestroyed
;
}
#
ifdef
QM_COLLECTING_OPERATION_TELEMETRY
const
char
*
Name
(
)
const
{
return
mName
;
}
#
endif
void
RunImmediately
(
)
;
protected
:
OriginOperationBase
(
MovingNotNull
<
RefPtr
<
QuotaManager
>
>
&
&
aQuotaManager
const
char
*
aName
)
;
virtual
~
OriginOperationBase
(
)
;
virtual
nsresult
DoInit
(
QuotaManager
&
aQuotaManager
)
;
virtual
RefPtr
<
BoolPromise
>
Open
(
)
=
0
;
#
ifdef
DEBUG
virtual
nsresult
DirectoryOpen
(
)
;
#
endif
virtual
nsresult
DoDirectoryWork
(
QuotaManager
&
aQuotaManager
)
=
0
;
virtual
void
UnblockOpen
(
)
=
0
;
private
:
void
DoStringify
(
nsACString
&
aData
)
override
{
}
}
;
}
#
endif
