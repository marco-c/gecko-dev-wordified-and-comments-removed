#
include
"
mozilla
/
dom
/
quota
/
PromiseUtils
.
h
"
#
include
"
jsapi
.
h
"
#
include
"
MainThreadUtils
.
h
"
#
include
"
nsDebug
.
h
"
#
include
"
xpcpublic
.
h
"
#
include
"
mozilla
/
Assertions
.
h
"
#
include
"
mozilla
/
ErrorResult
.
h
"
#
include
"
mozilla
/
RefPtr
.
h
"
#
include
"
mozilla
/
dom
/
Promise
.
h
"
namespace
mozilla
:
:
dom
:
:
quota
{
nsresult
CreatePromise
(
JSContext
*
aContext
Promise
*
*
aPromise
)
{
MOZ_ASSERT
(
NS_IsMainThread
(
)
)
;
MOZ_ASSERT
(
aContext
)
;
nsIGlobalObject
*
global
=
xpc
:
:
NativeGlobal
(
JS
:
:
CurrentGlobalOrNull
(
aContext
)
)
;
if
(
NS_WARN_IF
(
!
global
)
)
{
return
NS_ERROR_FAILURE
;
}
ErrorResult
result
;
RefPtr
<
Promise
>
promise
=
Promise
:
:
Create
(
global
result
)
;
if
(
result
.
Failed
(
)
)
{
return
result
.
StealNSResult
(
)
;
}
promise
.
forget
(
aPromise
)
;
return
NS_OK
;
}
}
