#
ifndef
mozilla_dom_quota_QuotaManagerService_h
#
define
mozilla_dom_quota_QuotaManagerService_h
#
include
"
mozilla
/
dom
/
ipc
/
IdType
.
h
"
#
include
"
mozilla
/
dom
/
battery
/
Types
.
h
"
#
include
"
mozilla
/
Observer
.
h
"
#
include
"
nsAutoPtr
.
h
"
#
include
"
nsIObserver
.
h
"
#
include
"
nsIQuotaManagerService
.
h
"
#
define
QUOTAMANAGER_SERVICE_CONTRACTID
\
"
mozilla
.
org
/
dom
/
quota
-
manager
-
service
;
1
"
namespace
mozilla
{
namespace
ipc
{
class
PBackgroundChild
;
}
namespace
hal
{
class
BatteryInformation
;
}
namespace
dom
{
namespace
quota
{
class
QuotaChild
;
class
QuotaManager
;
class
QuotaManagerService
final
:
public
nsIQuotaManagerService
public
nsIObserver
public
BatteryObserver
{
typedef
mozilla
:
:
ipc
:
:
PBackgroundChild
PBackgroundChild
;
class
BackgroundCreateCallback
;
class
PendingRequestInfo
;
class
UsageRequestInfo
;
class
RequestInfo
;
class
IdleMaintenanceInfo
;
nsCOMPtr
<
nsIEventTarget
>
mBackgroundThread
;
nsTArray
<
nsAutoPtr
<
PendingRequestInfo
>
>
mPendingRequests
;
QuotaChild
*
mBackgroundActor
;
bool
mBackgroundActorFailed
;
bool
mIdleObserverRegistered
;
public
:
static
QuotaManagerService
*
GetOrCreate
(
)
;
static
QuotaManagerService
*
Get
(
)
;
static
QuotaManagerService
*
FactoryCreate
(
)
;
void
ClearBackgroundActor
(
)
;
void
NoteLiveManager
(
QuotaManager
*
aManager
)
;
void
NoteShuttingDownManager
(
)
;
void
AbortOperationsForProcess
(
ContentParentId
aContentParentId
)
;
private
:
QuotaManagerService
(
)
;
~
QuotaManagerService
(
)
;
nsresult
Init
(
)
;
void
Destroy
(
)
;
nsresult
InitiateRequest
(
nsAutoPtr
<
PendingRequestInfo
>
&
aInfo
)
;
nsresult
BackgroundActorCreated
(
PBackgroundChild
*
aBackgroundActor
)
;
void
BackgroundActorFailed
(
)
;
void
PerformIdleMaintenance
(
)
;
void
RemoveIdleObserver
(
)
;
NS_DECL_ISUPPORTS
NS_DECL_NSIQUOTAMANAGERSERVICE
NS_DECL_NSIOBSERVER
void
Notify
(
const
hal
:
:
BatteryInformation
&
aBatteryInfo
)
override
;
}
;
}
}
}
#
endif
