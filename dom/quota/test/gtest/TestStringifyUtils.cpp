#
include
"
gtest
/
gtest
.
h
"
#
include
"
mozilla
/
dom
/
quota
/
StringifyUtils
.
h
"
namespace
mozilla
:
:
dom
:
:
quota
{
class
B
;
class
A
:
public
Stringifyable
{
public
:
A
(
)
:
mB
(
nullptr
)
{
}
virtual
void
DoStringify
(
nsACString
&
aData
)
override
;
void
setB
(
B
*
aB
)
{
mB
=
aB
;
}
private
:
B
*
mB
;
}
;
class
B
:
public
Stringifyable
{
public
:
B
(
)
:
mA
(
nullptr
)
{
}
virtual
void
DoStringify
(
nsACString
&
aData
)
override
;
void
setA
(
A
*
aA
)
{
mA
=
aA
;
}
private
:
A
*
mA
;
}
;
void
A
:
:
DoStringify
(
nsACString
&
aData
)
{
aData
.
Append
(
"
Class
A
content
.
"
_ns
)
;
mB
-
>
Stringify
(
aData
)
;
}
void
B
:
:
DoStringify
(
nsACString
&
aData
)
{
aData
.
Append
(
"
Class
B
content
.
"
)
;
mA
-
>
Stringify
(
aData
)
;
}
TEST
(
DOM_Quota_StringifyUtils
Nested
)
{
A
a1
;
A
a2
;
B
b
;
a1
.
setB
(
&
b
)
;
b
.
setA
(
&
a2
)
;
a2
.
setB
(
&
b
)
;
nsCString
msg
;
a1
.
Stringify
(
msg
)
;
EXPECT_EQ
(
0
strcmp
(
"
{
Class
A
content
.
{
Class
B
content
.
{
Class
A
content
.
(
.
.
.
)
}
}
}
"
msg
.
get
(
)
)
)
;
}
}
