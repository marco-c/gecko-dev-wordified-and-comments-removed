async
function
testSteps
(
)
{
const
obsoleteOriginPaths
=
[
"
storage
/
default
/
chrome
+
+
+
content
+
browser
.
xul
/
"
"
storage
/
default
/
moz
-
safe
-
about
+
+
+
home
/
"
]
;
const
invalidOriginPath
=
"
storage
/
default
/
invalid
+
+
+
example
.
com
/
"
info
(
"
Verifying
the
obsolete
origins
are
removed
after
the
2_1To2_2
upgrade
"
+
"
and
invalid
origins
wouldn
'
t
block
upgrades
"
)
;
installPackage
(
"
version2_2upgrade_profile
"
)
;
for
(
let
originPath
of
obsoleteOriginPaths
.
concat
(
invalidOriginPath
)
)
{
let
originDir
=
getRelativeFile
(
originPath
)
;
originDir
.
create
(
Ci
.
nsIFile
.
DIRECTORY_TYPE
parseInt
(
"
0755
"
8
)
)
;
}
info
(
"
Upgrading
"
)
;
let
request
=
init
(
)
;
await
requestFinished
(
request
)
;
info
(
"
Verifying
the
obsolete
origins
are
removed
after
the
2_1To2_2
upgrade
"
)
;
for
(
let
originPath
of
obsoleteOriginPaths
)
{
let
folder
=
getRelativeFile
(
originPath
)
;
let
exists
=
folder
.
exists
(
)
;
ok
(
!
exists
"
Obsolete
origin
was
removed
during
origin
initialization
"
)
;
}
let
folder
=
getRelativeFile
(
invalidOriginPath
)
;
folder
.
remove
(
true
)
;
info
(
"
Verifying
the
temporary
storage
is
able
to
be
initialized
after
"
+
"
removing
an
invalid
origin
"
)
;
request
=
initTemporaryStorage
(
)
;
await
requestFinished
(
request
)
;
}
