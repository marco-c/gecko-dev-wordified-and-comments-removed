async
function
testSteps
(
)
{
const
packages
=
[
"
version2_2_profile
"
"
.
.
/
defaultStorageDirectory_shared
"
]
;
function
verifyDatabaseTable
(
shouldExist
)
{
let
file
=
getRelativeFile
(
"
storage
.
sqlite
"
)
;
let
conn
=
Services
.
storage
.
openUnsharedDatabase
(
file
)
;
let
exists
=
conn
.
tableExists
(
"
database
"
)
;
if
(
shouldExist
)
{
ok
(
exists
"
Database
table
does
exist
"
)
;
}
else
{
ok
(
!
exists
"
Database
table
does
not
exist
"
)
;
}
conn
.
close
(
)
;
}
info
(
"
Clearing
"
)
;
let
request
=
clear
(
)
;
await
requestFinished
(
request
)
;
info
(
"
Verifying
storage
"
)
;
verifyStorage
(
packages
"
beforeInstall
"
)
;
info
(
"
Installing
packages
"
)
;
installPackages
(
packages
)
;
info
(
"
Verifying
storage
"
)
;
verifyStorage
(
packages
"
afterInstall
"
)
;
verifyDatabaseTable
(
false
)
;
info
(
"
Initializing
"
)
;
request
=
init
(
)
;
await
requestFinished
(
request
)
;
info
(
"
Verifying
storage
"
)
;
verifyStorage
(
packages
"
afterInit
"
)
;
request
=
reset
(
)
;
await
requestFinished
(
request
)
;
verifyDatabaseTable
(
true
)
;
}
