async
function
testSteps
(
)
{
const
principal
=
getPrincipal
(
"
https
:
/
/
foo
.
bar
.
mozilla
-
iot
.
org
"
)
;
const
metadataFile
=
getRelativeFile
(
"
storage
/
default
/
https
+
+
+
foo
.
bar
.
mozilla
-
iot
.
org
/
.
metadata
-
v2
"
)
;
async
function
readMetadataFile
(
)
{
let
file
=
await
File
.
createFromNsIFile
(
metadataFile
)
;
let
buffer
=
await
new
Promise
(
resolve
=
>
{
let
reader
=
new
FileReader
(
)
;
reader
.
onloadend
=
(
)
=
>
resolve
(
reader
.
result
)
;
reader
.
readAsArrayBuffer
(
file
)
;
}
)
;
return
buffer
;
}
info
(
"
Clearing
"
)
;
let
request
=
clear
(
)
;
await
requestFinished
(
request
)
;
info
(
"
Installing
package
"
)
;
installPackage
(
"
groupMismatch_profile
"
)
;
info
(
"
Reading
out
contents
of
metadata
file
"
)
;
let
metadataBuffer
=
await
readMetadataFile
(
)
;
info
(
"
Initializing
origin
"
)
;
request
=
initStorageAndOrigin
(
principal
"
default
"
)
;
await
requestFinished
(
request
)
;
info
(
"
Reading
out
contents
of
metadata
file
"
)
;
let
metadataBuffer2
=
await
readMetadataFile
(
)
;
info
(
"
Verifying
blobs
differ
"
)
;
ok
(
!
compareBuffers
(
metadataBuffer
metadataBuffer2
)
"
Metadata
differ
"
)
;
}
