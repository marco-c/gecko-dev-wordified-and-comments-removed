async
function
testSteps
(
)
{
const
packages
=
[
"
cacheVersion1_profile
"
"
.
.
/
defaultStorageDirectory_shared
"
]
;
const
principal
=
getPrincipal
(
"
https
:
/
/
www
.
mozilla
.
org
"
{
userContextId
:
1
}
)
;
const
originUsage
=
100
;
info
(
"
Clearing
"
)
;
let
request
=
clear
(
)
;
await
requestFinished
(
request
)
;
info
(
"
Verifying
storage
"
)
;
verifyStorage
(
packages
"
beforeInstall
"
)
;
info
(
"
Installing
package
"
)
;
installPackages
(
packages
)
;
info
(
"
Verifying
storage
"
)
;
verifyStorage
(
packages
"
afterInstall
"
)
;
info
(
"
Initializing
"
)
;
request
=
init
(
)
;
await
requestFinished
(
request
)
;
info
(
"
Verifying
storage
"
)
;
verifyStorage
(
packages
"
afterInit
"
)
;
getRelativeFile
(
"
storage
/
default
/
invalid
+
+
+
example
.
com
"
)
.
remove
(
false
)
;
getRelativeFile
(
"
storage
/
temporary
/
invalid
+
+
+
example
.
com
"
)
.
remove
(
false
)
;
info
(
"
Initializing
temporary
storage
"
)
;
request
=
initTemporaryStorage
(
continueToNextStepSync
)
;
await
requestFinished
(
request
)
;
info
(
"
Getting
origin
usage
"
)
;
request
=
getOriginUsage
(
principal
true
)
;
await
requestFinished
(
request
)
;
info
(
"
Verifying
origin
usage
"
)
;
is
(
request
.
result
.
usage
originUsage
"
Correct
origin
usage
"
)
;
}
