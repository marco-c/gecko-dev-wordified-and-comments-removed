#
include
"
NormalOriginOperationBase
.
h
"
#
include
"
mozilla
/
dom
/
quota
/
DirectoryLock
.
h
"
#
include
"
mozilla
/
dom
/
quota
/
QuotaManager
.
h
"
namespace
mozilla
:
:
dom
:
:
quota
{
NormalOriginOperationBase
:
:
NormalOriginOperationBase
(
MovingNotNull
<
RefPtr
<
QuotaManager
>
>
aQuotaManager
const
char
*
aName
)
:
OriginOperationBase
(
std
:
:
move
(
aQuotaManager
)
aName
)
{
AssertIsOnOwningThread
(
)
;
}
NormalOriginOperationBase
:
:
~
NormalOriginOperationBase
(
)
{
AssertIsOnOwningThread
(
)
;
}
RefPtr
<
BoolPromise
>
NormalOriginOperationBase
:
:
Open
(
)
{
AssertIsOnOwningThread
(
)
;
mDirectoryLock
=
CreateDirectoryLock
(
)
;
if
(
mDirectoryLock
)
{
return
mDirectoryLock
-
>
Acquire
(
)
;
}
return
BoolPromise
:
:
CreateAndResolve
(
true
__func__
)
;
}
void
NormalOriginOperationBase
:
:
UnblockOpen
(
)
{
AssertIsOnOwningThread
(
)
;
SendResults
(
)
;
if
(
mDirectoryLock
)
{
mDirectoryLock
=
nullptr
;
}
mQuotaManager
-
>
UnregisterNormalOriginOp
(
*
this
)
;
}
}
