#
ifndef
DOM_QUOTA_PERSISTENCESCOPE_H_
#
define
DOM_QUOTA_PERSISTENCESCOPE_H_
#
include
"
mozilla
/
Assertions
.
h
"
#
include
"
mozilla
/
Variant
.
h
"
#
include
"
mozilla
/
dom
/
quota
/
PersistenceType
.
h
"
namespace
mozilla
:
:
dom
:
:
quota
{
class
PersistenceScope
{
class
Value
{
PersistenceType
mValue
;
public
:
explicit
Value
(
PersistenceType
aValue
)
:
mValue
(
aValue
)
{
}
PersistenceType
GetValue
(
)
const
{
return
mValue
;
}
}
;
struct
Null
{
}
;
using
DataType
=
Variant
<
Value
Null
>
;
DataType
mData
;
public
:
PersistenceScope
(
)
:
mData
(
Null
(
)
)
{
}
static
PersistenceScope
CreateFromValue
(
PersistenceType
aValue
)
{
return
PersistenceScope
(
std
:
:
move
(
Value
(
aValue
)
)
)
;
}
static
PersistenceScope
CreateFromNull
(
)
{
return
PersistenceScope
(
std
:
:
move
(
Null
(
)
)
)
;
}
bool
IsValue
(
)
const
{
return
mData
.
is
<
Value
>
(
)
;
}
bool
IsNull
(
)
const
{
return
mData
.
is
<
Null
>
(
)
;
}
void
SetFromValue
(
PersistenceType
aValue
)
{
mData
=
AsVariant
(
Value
(
aValue
)
)
;
}
void
SetFromNull
(
)
{
mData
=
AsVariant
(
Null
(
)
)
;
}
PersistenceType
GetValue
(
)
const
{
MOZ_ASSERT
(
IsValue
(
)
)
;
return
mData
.
as
<
Value
>
(
)
.
GetValue
(
)
;
}
bool
Matches
(
const
PersistenceScope
&
aOther
)
const
{
struct
Matcher
{
const
PersistenceScope
&
mThis
;
explicit
Matcher
(
const
PersistenceScope
&
aThis
)
:
mThis
(
aThis
)
{
}
bool
operator
(
)
(
const
Value
&
aOther
)
{
return
mThis
.
MatchesValue
(
aOther
)
;
}
bool
operator
(
)
(
const
Null
&
aOther
)
{
return
true
;
}
}
;
return
aOther
.
mData
.
match
(
Matcher
(
*
this
)
)
;
}
private
:
explicit
PersistenceScope
(
const
Value
&
&
aValue
)
:
mData
(
aValue
)
{
}
explicit
PersistenceScope
(
const
Null
&
&
aNull
)
:
mData
(
aNull
)
{
}
explicit
PersistenceScope
(
const
DataType
&
aOther
)
:
mData
(
aOther
)
{
}
bool
MatchesValue
(
const
Value
&
aOther
)
const
{
struct
ValueMatcher
{
const
Value
&
mOther
;
explicit
ValueMatcher
(
const
Value
&
aOther
)
:
mOther
(
aOther
)
{
}
bool
operator
(
)
(
const
Value
&
aThis
)
{
return
aThis
.
GetValue
(
)
=
=
mOther
.
GetValue
(
)
;
}
bool
operator
(
)
(
const
Null
&
aThis
)
{
return
true
;
}
}
;
return
mData
.
match
(
ValueMatcher
(
aOther
)
)
;
}
bool
operator
=
=
(
const
PersistenceScope
&
aOther
)
=
delete
;
}
;
}
#
endif
