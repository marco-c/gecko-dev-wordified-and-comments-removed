#
ifndef
mozilla_dom_TabContext_h
#
define
mozilla_dom_TabContext_h
#
include
"
nsCOMPtr
.
h
"
#
include
"
mozilla
/
BasePrincipal
.
h
"
#
include
"
nsPIDOMWindow
.
h
"
#
include
"
nsPIWindowRoot
.
h
"
namespace
mozilla
{
namespace
dom
{
class
IPCTabContext
;
class
TabContext
{
public
:
TabContext
(
)
;
IPCTabContext
AsIPCTabContext
(
)
const
;
bool
IsMozBrowserElement
(
)
const
;
bool
IsIsolatedMozBrowserElement
(
)
const
;
bool
IsMozBrowser
(
)
const
;
bool
IsJSPlugin
(
)
const
;
int32_t
JSPluginId
(
)
const
;
uint64_t
ChromeOuterWindowID
(
)
const
;
const
OriginAttributes
&
OriginAttributesRef
(
)
const
;
const
nsAString
&
PresentationURL
(
)
const
;
UIStateChangeType
ShowFocusRings
(
)
const
;
protected
:
friend
class
MaybeInvalidTabContext
;
bool
SetTabContext
(
const
TabContext
&
aContext
)
;
void
SetPrivateBrowsingAttributes
(
bool
aIsPrivateBrowsing
)
;
bool
SetTabContext
(
bool
aIsMozBrowserElement
uint64_t
aChromeOuterWindowID
UIStateChangeType
aShowFocusRings
const
OriginAttributes
&
aOriginAttributes
const
nsAString
&
aPresentationURL
)
;
bool
UpdateTabContextAfterSwap
(
const
TabContext
&
aContext
)
;
bool
SetTabContextForJSPluginFrame
(
int32_t
aJSPluginID
)
;
private
:
bool
mInitialized
;
bool
mIsMozBrowserElement
;
uint64_t
mChromeOuterWindowID
;
int32_t
mJSPluginID
;
OriginAttributes
mOriginAttributes
;
nsString
mPresentationURL
;
UIStateChangeType
mShowFocusRings
;
}
;
class
MutableTabContext
:
public
TabContext
{
public
:
bool
SetTabContext
(
const
TabContext
&
aContext
)
{
return
TabContext
:
:
SetTabContext
(
aContext
)
;
}
bool
SetTabContext
(
bool
aIsMozBrowserElement
uint64_t
aChromeOuterWindowID
UIStateChangeType
aShowFocusRings
const
OriginAttributes
&
aOriginAttributes
const
nsAString
&
aPresentationURL
=
EmptyString
(
)
)
{
return
TabContext
:
:
SetTabContext
(
aIsMozBrowserElement
aChromeOuterWindowID
aShowFocusRings
aOriginAttributes
aPresentationURL
)
;
}
bool
SetTabContextForJSPluginFrame
(
uint32_t
aJSPluginID
)
{
return
TabContext
:
:
SetTabContextForJSPluginFrame
(
aJSPluginID
)
;
}
}
;
class
MaybeInvalidTabContext
{
public
:
explicit
MaybeInvalidTabContext
(
const
IPCTabContext
&
aContext
)
;
bool
IsValid
(
)
;
const
char
*
GetInvalidReason
(
)
;
const
TabContext
&
GetTabContext
(
)
;
private
:
MaybeInvalidTabContext
(
const
MaybeInvalidTabContext
&
)
=
delete
;
MaybeInvalidTabContext
&
operator
=
(
const
MaybeInvalidTabContext
&
)
=
delete
;
const
char
*
mInvalidReason
;
MutableTabContext
mTabContext
;
}
;
}
}
#
endif
