#
include
"
URLClassifierParent
.
h
"
#
include
"
nsComponentManagerUtils
.
h
"
#
include
"
mozilla
/
Unused
.
h
"
using
namespace
mozilla
;
using
namespace
mozilla
:
:
dom
;
NS_IMPL_ISUPPORTS
(
URLClassifierParent
nsIURIClassifierCallback
)
mozilla
:
:
ipc
:
:
IPCResult
URLClassifierParent
:
:
StartClassify
(
nsIPrincipal
*
aPrincipal
bool
aUseTrackingProtection
bool
*
aSuccess
)
{
*
aSuccess
=
false
;
nsresult
rv
=
NS_OK
;
nsCOMPtr
<
nsIURIClassifier
>
uriClassifier
=
do_GetService
(
NS_URICLASSIFIERSERVICE_CONTRACTID
&
rv
)
;
if
(
NS_SUCCEEDED
(
rv
)
)
{
rv
=
uriClassifier
-
>
Classify
(
aPrincipal
nullptr
aUseTrackingProtection
this
aSuccess
)
;
}
if
(
NS_FAILED
(
rv
)
|
|
!
*
aSuccess
)
{
*
aSuccess
=
false
;
ClassificationFailed
(
)
;
}
return
IPC_OK
(
)
;
}
void
URLClassifierParent
:
:
ActorDestroy
(
ActorDestroyReason
aWhy
)
{
mIPCOpen
=
false
;
}
NS_IMPL_ISUPPORTS
(
URLClassifierLocalParent
nsIURIClassifierCallback
)
mozilla
:
:
ipc
:
:
IPCResult
URLClassifierLocalParent
:
:
StartClassify
(
nsIURI
*
aURI
const
nsACString
&
aTables
)
{
nsresult
rv
=
NS_OK
;
nsCOMPtr
<
nsIURIClassifier
>
uriClassifier
=
do_GetService
(
NS_URICLASSIFIERSERVICE_CONTRACTID
&
rv
)
;
if
(
NS_SUCCEEDED
(
rv
)
)
{
MOZ_ASSERT
(
aURI
)
;
rv
=
uriClassifier
-
>
AsyncClassifyLocalWithTables
(
aURI
aTables
nsTArray
<
nsCString
>
(
)
nsTArray
<
nsCString
>
(
)
this
)
;
}
if
(
NS_FAILED
(
rv
)
)
{
OnClassifyComplete
(
NS_OK
EmptyCString
(
)
EmptyCString
(
)
EmptyCString
(
)
)
;
}
return
IPC_OK
(
)
;
}
void
URLClassifierLocalParent
:
:
ActorDestroy
(
ActorDestroyReason
aWhy
)
{
mIPCOpen
=
false
;
}
