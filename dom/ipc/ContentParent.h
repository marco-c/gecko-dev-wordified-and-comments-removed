#
ifndef
mozilla_dom_ContentParent_h
#
define
mozilla_dom_ContentParent_h
#
include
"
mozilla
/
dom
/
PContentParent
.
h
"
#
include
"
mozilla
/
dom
/
ipc
/
IdType
.
h
"
#
include
"
mozilla
/
dom
/
MessageManagerCallback
.
h
"
#
include
"
mozilla
/
dom
/
MediaSessionBinding
.
h
"
#
include
"
mozilla
/
dom
/
RemoteBrowser
.
h
"
#
include
"
mozilla
/
dom
/
RemoteType
.
h
"
#
include
"
mozilla
/
dom
/
JSProcessActorParent
.
h
"
#
include
"
mozilla
/
dom
/
ProcessActor
.
h
"
#
include
"
mozilla
/
gfx
/
gfxVarReceiver
.
h
"
#
include
"
mozilla
/
gfx
/
GPUProcessListener
.
h
"
#
include
"
mozilla
/
ipc
/
BackgroundUtils
.
h
"
#
include
"
mozilla
/
ipc
/
GeckoChildProcessHost
.
h
"
#
include
"
mozilla
/
ipc
/
InputStreamUtils
.
h
"
#
include
"
mozilla
/
Attributes
.
h
"
#
include
"
mozilla
/
DataMutex
.
h
"
#
include
"
mozilla
/
FileUtils
.
h
"
#
include
"
mozilla
/
HalTypes
.
h
"
#
include
"
mozilla
/
LinkedList
.
h
"
#
include
"
mozilla
/
Maybe
.
h
"
#
include
"
mozilla
/
MemoryReportingProcess
.
h
"
#
include
"
mozilla
/
MozPromise
.
h
"
#
include
"
mozilla
/
TimeStamp
.
h
"
#
include
"
mozilla
/
UniquePtr
.
h
"
#
include
"
nsClassHashtable
.
h
"
#
include
"
nsTHashMap
.
h
"
#
include
"
nsTHashSet
.
h
"
#
include
"
nsPluginTags
.
h
"
#
include
"
nsHashKeys
.
h
"
#
include
"
nsIAsyncShutdown
.
h
"
#
include
"
nsIDOMProcessParent
.
h
"
#
include
"
nsIInterfaceRequestor
.
h
"
#
include
"
nsIObserver
.
h
"
#
include
"
nsIRemoteTab
.
h
"
#
include
"
nsIDOMGeoPositionCallback
.
h
"
#
include
"
nsIDOMGeoPositionErrorCallback
.
h
"
#
include
"
nsRefPtrHashtable
.
h
"
#
include
"
PermissionMessageUtils
.
h
"
#
include
"
DriverCrashGuard
.
h
"
#
include
"
nsIReferrerInfo
.
h
"
#
define
CHILD_PROCESS_SHUTDOWN_MESSAGE
u
"
child
-
process
-
shutdown
"
_ns
class
nsConsoleService
;
class
nsIContentProcessInfo
;
class
nsICycleCollectorLogSink
;
class
nsIDumpGCAndCCLogsCallback
;
class
nsIRemoteTab
;
class
nsITimer
;
class
ParentIdleListener
;
class
nsIWidget
;
namespace
mozilla
{
class
PRemoteSpellcheckEngineParent
;
#
if
defined
(
XP_LINUX
)
&
&
defined
(
MOZ_SANDBOX
)
class
SandboxBroker
;
class
SandboxBrokerPolicyFactory
;
#
endif
class
PreallocatedProcessManagerImpl
;
class
BenchmarkStorageParent
;
using
mozilla
:
:
loader
:
:
PScriptCacheParent
;
namespace
ipc
{
class
CrashReporterHost
;
class
TestShellParent
;
#
ifdef
FUZZING
class
ProtocolFuzzerHelper
;
#
endif
class
SharedPreferenceSerializer
;
}
namespace
layers
{
struct
TextureFactoryIdentifier
;
}
namespace
dom
{
class
BrowsingContextGroup
;
class
Element
;
class
BrowserParent
;
class
ClonedMessageData
;
class
MemoryReport
;
class
TabContext
;
class
GetFilesHelper
;
class
MemoryReportRequestHost
;
class
RemoteWorkerManager
;
struct
CancelContentJSOptions
;
#
define
NS_CONTENTPARENT_IID
\
{
\
0xeeec9ebf
0x8ecf
0x4e38
{
\
0x81
0xda
0xb7
0x34
0x13
0x7e
0xac
0xf3
\
}
\
}
class
ContentParent
final
:
public
PContentParent
public
nsIDOMProcessParent
public
nsIObserver
public
nsIDOMGeoPositionCallback
public
nsIDOMGeoPositionErrorCallback
public
nsIAsyncShutdownBlocker
public
nsIInterfaceRequestor
public
gfx
:
:
gfxVarReceiver
public
mozilla
:
:
LinkedListElement
<
ContentParent
>
public
gfx
:
:
GPUProcessListener
public
mozilla
:
:
MemoryReportingProcess
public
mozilla
:
:
dom
:
:
ipc
:
:
MessageManagerCallback
public
mozilla
:
:
ipc
:
:
IShmemAllocator
public
ProcessActor
{
typedef
mozilla
:
:
ipc
:
:
GeckoChildProcessHost
GeckoChildProcessHost
;
typedef
mozilla
:
:
ipc
:
:
TestShellParent
TestShellParent
;
typedef
mozilla
:
:
ipc
:
:
PrincipalInfo
PrincipalInfo
;
typedef
mozilla
:
:
dom
:
:
ClonedMessageData
ClonedMessageData
;
typedef
mozilla
:
:
dom
:
:
BrowsingContextGroup
BrowsingContextGroup
;
friend
class
mozilla
:
:
PreallocatedProcessManagerImpl
;
friend
class
PContentParent
;
friend
class
mozilla
:
:
dom
:
:
RemoteWorkerManager
;
#
ifdef
FUZZING
friend
class
mozilla
:
:
ipc
:
:
ProtocolFuzzerHelper
;
#
endif
public
:
using
LaunchError
=
mozilla
:
:
ipc
:
:
LaunchError
;
using
LaunchPromise
=
mozilla
:
:
MozPromise
<
RefPtr
<
ContentParent
>
LaunchError
false
>
;
NS_DECLARE_STATIC_IID_ACCESSOR
(
NS_CONTENTPARENT_IID
)
static
LogModule
*
GetLog
(
)
;
static
already_AddRefed
<
ContentParent
>
MakePreallocProcess
(
)
;
static
void
StartUp
(
)
;
static
void
ShutDown
(
)
;
static
uint32_t
GetPoolSize
(
const
nsACString
&
aContentProcessType
)
;
static
uint32_t
GetMaxProcessCount
(
const
nsACString
&
aContentProcessType
)
;
static
bool
IsMaxProcessCountReached
(
const
nsACString
&
aContentProcessType
)
;
static
void
ReleaseCachedProcesses
(
)
;
static
void
LogAndAssertFailedPrincipalValidationInfo
(
nsIPrincipal
*
aPrincipal
const
char
*
aMethod
)
;
static
already_AddRefed
<
ContentParent
>
MinTabSelect
(
const
nsTArray
<
ContentParent
*
>
&
aContentParents
int32_t
maxContentParents
)
;
static
RefPtr
<
ContentParent
:
:
LaunchPromise
>
GetNewOrUsedBrowserProcessAsync
(
const
nsACString
&
aRemoteType
BrowsingContextGroup
*
aGroup
=
nullptr
hal
:
:
ProcessPriority
aPriority
=
hal
:
:
ProcessPriority
:
:
PROCESS_PRIORITY_FOREGROUND
bool
aPreferUsed
=
false
)
;
static
already_AddRefed
<
ContentParent
>
GetNewOrUsedBrowserProcess
(
const
nsACString
&
aRemoteType
BrowsingContextGroup
*
aGroup
=
nullptr
hal
:
:
ProcessPriority
aPriority
=
hal
:
:
ProcessPriority
:
:
PROCESS_PRIORITY_FOREGROUND
bool
aPreferUsed
=
false
)
;
static
already_AddRefed
<
ContentParent
>
GetNewOrUsedLaunchingBrowserProcess
(
const
nsACString
&
aRemoteType
BrowsingContextGroup
*
aGroup
=
nullptr
hal
:
:
ProcessPriority
aPriority
=
hal
:
:
ProcessPriority
:
:
PROCESS_PRIORITY_FOREGROUND
bool
aPreferUsed
=
false
)
;
RefPtr
<
ContentParent
:
:
LaunchPromise
>
WaitForLaunchAsync
(
hal
:
:
ProcessPriority
aPriority
=
hal
:
:
ProcessPriority
:
:
PROCESS_PRIORITY_FOREGROUND
)
;
bool
WaitForLaunchSync
(
hal
:
:
ProcessPriority
aPriority
=
hal
:
:
ProcessPriority
:
:
PROCESS_PRIORITY_FOREGROUND
)
;
static
already_AddRefed
<
ContentParent
>
GetNewOrUsedJSPluginProcess
(
uint32_t
aPluginID
const
hal
:
:
ProcessPriority
&
aPriority
)
;
static
already_AddRefed
<
RemoteBrowser
>
CreateBrowser
(
const
TabContext
&
aContext
Element
*
aFrameElement
const
nsACString
&
aRemoteType
BrowsingContext
*
aBrowsingContext
ContentParent
*
aOpenerContentParent
)
;
static
void
GetAll
(
nsTArray
<
ContentParent
*
>
&
aArray
)
;
static
void
GetAllEvenIfDead
(
nsTArray
<
ContentParent
*
>
&
aArray
)
;
static
void
BroadcastStringBundle
(
const
StringBundleDescriptor
&
)
;
static
void
BroadcastFontListChanged
(
)
;
static
void
BroadcastShmBlockAdded
(
uint32_t
aGeneration
uint32_t
aIndex
)
;
static
void
BroadcastThemeUpdate
(
widget
:
:
ThemeChangeKind
)
;
static
void
BroadcastMediaCodecsSupportedUpdate
(
RemoteDecodeIn
aLocation
const
media
:
:
MediaCodecsSupported
&
aSupported
)
;
const
nsACString
&
GetRemoteType
(
)
const
override
;
virtual
void
DoGetRemoteType
(
nsACString
&
aRemoteType
ErrorResult
&
aError
)
const
override
{
aRemoteType
=
GetRemoteType
(
)
;
}
enum
CPIteratorPolicy
{
eLive
eAll
}
;
class
ContentParentIterator
{
private
:
ContentParent
*
mCurrent
;
CPIteratorPolicy
mPolicy
;
public
:
ContentParentIterator
(
CPIteratorPolicy
aPolicy
ContentParent
*
aCurrent
)
:
mCurrent
(
aCurrent
)
mPolicy
(
aPolicy
)
{
}
ContentParentIterator
begin
(
)
{
while
(
mPolicy
!
=
eAll
&
&
mCurrent
&
&
!
mCurrent
-
>
IsAlive
(
)
)
{
mCurrent
=
mCurrent
-
>
LinkedListElement
<
ContentParent
>
:
:
getNext
(
)
;
}
return
*
this
;
}
ContentParentIterator
end
(
)
{
return
ContentParentIterator
(
mPolicy
nullptr
)
;
}
const
ContentParentIterator
&
operator
+
+
(
)
{
MOZ_ASSERT
(
mCurrent
)
;
do
{
mCurrent
=
mCurrent
-
>
LinkedListElement
<
ContentParent
>
:
:
getNext
(
)
;
}
while
(
mPolicy
!
=
eAll
&
&
mCurrent
&
&
!
mCurrent
-
>
IsAlive
(
)
)
;
return
*
this
;
}
bool
operator
!
=
(
const
ContentParentIterator
&
aOther
)
{
MOZ_ASSERT
(
mPolicy
=
=
aOther
.
mPolicy
)
;
return
mCurrent
!
=
aOther
.
mCurrent
;
}
ContentParent
*
operator
*
(
)
{
return
mCurrent
;
}
}
;
static
ContentParentIterator
AllProcesses
(
CPIteratorPolicy
aPolicy
)
{
ContentParent
*
first
=
sContentParents
?
sContentParents
-
>
getFirst
(
)
:
nullptr
;
return
ContentParentIterator
(
aPolicy
first
)
;
}
static
void
NotifyUpdatedDictionaries
(
)
;
static
void
NotifyUpdatedFonts
(
bool
aFullRebuild
)
;
#
if
defined
(
XP_WIN
)
static
void
SendAsyncUpdate
(
nsIWidget
*
aWidget
)
;
#
endif
mozilla
:
:
ipc
:
:
IPCResult
RecvCreateGMPService
(
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvUngrabPointer
(
const
uint32_t
&
aTime
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvRemovePermission
(
const
IPC
:
:
Principal
&
aPrincipal
const
nsACString
&
aPermissionType
nsresult
*
aRv
)
;
NS_DECL_CYCLE_COLLECTION_CLASS_AMBIGUOUS
(
ContentParent
nsIObserver
)
NS_DECL_CYCLE_COLLECTING_ISUPPORTS
NS_DECL_NSIDOMPROCESSPARENT
NS_DECL_NSIOBSERVER
NS_DECL_NSIDOMGEOPOSITIONCALLBACK
NS_DECL_NSIDOMGEOPOSITIONERRORCALLBACK
NS_DECL_NSIASYNCSHUTDOWNBLOCKER
NS_DECL_NSIINTERFACEREQUESTOR
virtual
bool
DoLoadMessageManagerScript
(
const
nsAString
&
aURL
bool
aRunInGlobalScope
)
override
;
virtual
nsresult
DoSendAsyncMessage
(
const
nsAString
&
aMessage
StructuredCloneData
&
aData
)
override
;
void
NotifyTabDestroying
(
)
;
void
NotifyTabDestroyed
(
const
TabId
&
aTabId
bool
aNotifiedDestroying
)
;
void
AddKeepAlive
(
)
;
void
RemoveKeepAlive
(
)
;
TestShellParent
*
CreateTestShell
(
)
;
bool
DestroyTestShell
(
TestShellParent
*
aTestShell
)
;
TestShellParent
*
GetTestShellSingleton
(
)
;
void
RegisterRemoteWorkerActor
(
)
;
void
UnregisterRemoveWorkerActor
(
)
;
void
ReportChildAlreadyBlocked
(
)
;
bool
RequestRunToCompletion
(
)
;
void
UpdateCookieStatus
(
nsIChannel
*
aChannel
)
;
bool
IsLaunching
(
)
const
{
return
mLifecycleState
=
=
LifecycleState
:
:
LAUNCHING
;
}
bool
IsAlive
(
)
const
override
;
bool
IsInitialized
(
)
const
;
bool
IsDead
(
)
const
{
return
mLifecycleState
=
=
LifecycleState
:
:
DEAD
;
}
bool
IsForBrowser
(
)
const
{
return
mIsForBrowser
;
}
bool
IsForJSPlugin
(
)
const
{
return
mJSPluginID
!
=
nsFakePluginTag
:
:
NOT_JSPLUGIN
;
}
GeckoChildProcessHost
*
Process
(
)
const
{
return
mSubprocess
;
}
nsIContentProcessInfo
*
ScriptableHelper
(
)
const
{
return
mScriptableHelper
;
}
mozilla
:
:
dom
:
:
ProcessMessageManager
*
GetMessageManager
(
)
const
{
return
mMessageManager
;
}
bool
NeedsPermissionsUpdate
(
const
nsACString
&
aPermissionKey
)
const
;
void
KillHard
(
const
char
*
aWhy
)
;
ContentParentId
ChildID
(
)
const
{
return
mChildID
;
}
void
FriendlyName
(
nsAString
&
aName
bool
aAnonymize
=
false
)
;
virtual
void
OnChannelError
(
)
override
;
mozilla
:
:
ipc
:
:
IPCResult
RecvInitCrashReporter
(
const
NativeThreadId
&
aThreadId
)
;
already_AddRefed
<
PNeckoParent
>
AllocPNeckoParent
(
)
;
virtual
mozilla
:
:
ipc
:
:
IPCResult
RecvPNeckoConstructor
(
PNeckoParent
*
aActor
)
override
{
return
PContentParent
:
:
RecvPNeckoConstructor
(
aActor
)
;
}
mozilla
:
:
ipc
:
:
IPCResult
RecvInitStreamFilter
(
const
uint64_t
&
aChannelId
const
nsAString
&
aAddonId
InitStreamFilterResolver
&
&
aResolver
)
;
PHalParent
*
AllocPHalParent
(
)
;
virtual
mozilla
:
:
ipc
:
:
IPCResult
RecvPHalConstructor
(
PHalParent
*
aActor
)
override
{
return
PContentParent
:
:
RecvPHalConstructor
(
aActor
)
;
}
PHeapSnapshotTempFileHelperParent
*
AllocPHeapSnapshotTempFileHelperParent
(
)
;
PRemoteSpellcheckEngineParent
*
AllocPRemoteSpellcheckEngineParent
(
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvRecordingDeviceEvents
(
const
nsAString
&
aRecordingStatus
const
nsAString
&
aPageURL
const
bool
&
aIsAudio
const
bool
&
aIsVideo
)
;
bool
CycleCollectWithLogs
(
bool
aDumpAllTraces
nsICycleCollectorLogSink
*
aSink
nsIDumpGCAndCCLogsCallback
*
aCallback
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvNotifyTabDestroying
(
const
TabId
&
aTabId
const
ContentParentId
&
aCpId
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvSetOfflinePermission
(
const
IPC
:
:
Principal
&
principal
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvFinishShutdown
(
)
;
void
MaybeInvokeDragSession
(
BrowserParent
*
aParent
)
;
PContentPermissionRequestParent
*
AllocPContentPermissionRequestParent
(
const
nsTArray
<
PermissionRequest
>
&
aRequests
const
IPC
:
:
Principal
&
aPrincipal
const
IPC
:
:
Principal
&
aTopLevelPrincipal
const
bool
&
aIsHandlingUserInput
const
bool
&
aMaybeUnsafePermissionDelegate
const
TabId
&
aTabId
)
;
bool
DeallocPContentPermissionRequestParent
(
PContentPermissionRequestParent
*
actor
)
;
virtual
bool
HandleWindowsMessages
(
const
Message
&
aMsg
)
const
override
;
void
ForkNewProcess
(
bool
aBlocking
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvCreateWindow
(
PBrowserParent
*
aThisBrowserParent
const
MaybeDiscarded
<
BrowsingContext
>
&
aParent
PBrowserParent
*
aNewTab
const
uint32_t
&
aChromeFlags
const
bool
&
aCalledFromJS
const
bool
&
aForPrinting
const
bool
&
aForWindowDotPrint
nsIURI
*
aURIToLoad
const
nsACString
&
aFeatures
const
IPC
:
:
Principal
&
aTriggeringPrincipal
nsIContentSecurityPolicy
*
aCsp
nsIReferrerInfo
*
aReferrerInfo
const
OriginAttributes
&
aOriginAttributes
CreateWindowResolver
&
&
aResolve
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvCreateWindowInDifferentProcess
(
PBrowserParent
*
aThisTab
const
MaybeDiscarded
<
BrowsingContext
>
&
aParent
const
uint32_t
&
aChromeFlags
const
bool
&
aCalledFromJS
nsIURI
*
aURIToLoad
const
nsACString
&
aFeatures
const
nsAString
&
aName
nsIPrincipal
*
aTriggeringPrincipal
nsIContentSecurityPolicy
*
aCsp
nsIReferrerInfo
*
aReferrerInfo
const
OriginAttributes
&
aOriginAttributes
)
;
static
void
BroadcastBlobURLRegistration
(
const
nsACString
&
aURI
BlobImpl
*
aBlobImpl
nsIPrincipal
*
aPrincipal
const
Maybe
<
nsID
>
&
aAgentClusterId
ContentParent
*
aIgnoreThisCP
=
nullptr
)
;
static
void
BroadcastBlobURLUnregistration
(
const
nsACString
&
aURI
nsIPrincipal
*
aPrincipal
ContentParent
*
aIgnoreThisCP
=
nullptr
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvStoreAndBroadcastBlobURLRegistration
(
const
nsACString
&
aURI
const
IPCBlob
&
aBlob
const
Principal
&
aPrincipal
const
Maybe
<
nsID
>
&
aAgentCluster
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvUnstoreAndBroadcastBlobURLUnregistration
(
const
nsACString
&
aURI
const
Principal
&
aPrincipal
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvGetA11yContentId
(
uint32_t
*
aContentId
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvA11yHandlerControl
(
const
uint32_t
&
aPid
const
IHandlerControlHolder
&
aHandlerControl
)
;
virtual
int32_t
Pid
(
)
const
override
;
PURLClassifierParent
*
AllocPURLClassifierParent
(
const
Principal
&
aPrincipal
bool
*
aSuccess
)
;
virtual
mozilla
:
:
ipc
:
:
IPCResult
RecvPURLClassifierConstructor
(
PURLClassifierParent
*
aActor
const
Principal
&
aPrincipal
bool
*
aSuccess
)
override
;
PURLClassifierLocalParent
*
AllocPURLClassifierLocalParent
(
nsIURI
*
aURI
const
nsTArray
<
IPCURLClassifierFeature
>
&
aFeatures
)
;
virtual
mozilla
:
:
ipc
:
:
IPCResult
RecvPURLClassifierLocalConstructor
(
PURLClassifierLocalParent
*
aActor
nsIURI
*
aURI
nsTArray
<
IPCURLClassifierFeature
>
&
&
aFeatures
)
override
;
PLoginReputationParent
*
AllocPLoginReputationParent
(
nsIURI
*
aURI
)
;
virtual
mozilla
:
:
ipc
:
:
IPCResult
RecvPLoginReputationConstructor
(
PLoginReputationParent
*
aActor
nsIURI
*
aURI
)
override
;
bool
DeallocPLoginReputationParent
(
PLoginReputationParent
*
aActor
)
;
PSessionStorageObserverParent
*
AllocPSessionStorageObserverParent
(
)
;
virtual
mozilla
:
:
ipc
:
:
IPCResult
RecvPSessionStorageObserverConstructor
(
PSessionStorageObserverParent
*
aActor
)
override
;
bool
DeallocPSessionStorageObserverParent
(
PSessionStorageObserverParent
*
aActor
)
;
bool
DeallocPURLClassifierLocalParent
(
PURLClassifierLocalParent
*
aActor
)
;
bool
DeallocPURLClassifierParent
(
PURLClassifierParent
*
aActor
)
;
void
PaintTabWhileInterruptingJS
(
BrowserParent
*
aBrowserParent
const
layers
:
:
LayersObserverEpoch
&
aEpoch
)
;
void
CancelContentJSExecutionIfRunning
(
BrowserParent
*
aBrowserParent
nsIRemoteTab
:
:
NavigationType
aNavigationType
const
CancelContentJSOptions
&
aCancelContentJSOptions
)
;
nsresult
AboutToLoadHttpFtpDocumentForChild
(
nsIChannel
*
aChannel
bool
*
aShouldWaitForPermissionCookieUpdate
=
nullptr
)
;
void
TransmitBlobURLsForPrincipal
(
nsIPrincipal
*
aPrincipal
)
;
nsresult
TransmitPermissionsForPrincipal
(
nsIPrincipal
*
aPrincipal
)
;
enum
class
ValidatePrincipalOptions
{
AllowNullPtr
AllowSystem
AllowExpanded
}
;
bool
ValidatePrincipal
(
nsIPrincipal
*
aPrincipal
const
EnumSet
<
ValidatePrincipalOptions
>
&
aOptions
=
{
}
)
;
void
TransmitBlobDataIfBlobURL
(
nsIURI
*
aURI
)
;
void
OnCompositorDeviceReset
(
)
override
;
void
SetInputPriorityEventEnabled
(
bool
aEnabled
)
;
bool
IsInputPriorityEventEnabled
(
)
{
return
mIsInputPriorityEventEnabled
;
}
static
bool
IsInputEventQueueSupported
(
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvCreateBrowsingContext
(
uint64_t
aGroupId
BrowsingContext
:
:
IPCInitializer
&
&
aInit
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvDiscardBrowsingContext
(
const
MaybeDiscarded
<
BrowsingContext
>
&
aContext
bool
aDoDiscard
DiscardBrowsingContextResolver
&
&
aResolve
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvWindowClose
(
const
MaybeDiscarded
<
BrowsingContext
>
&
aContext
bool
aTrustedCaller
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvWindowFocus
(
const
MaybeDiscarded
<
BrowsingContext
>
&
aContext
CallerType
aCallerType
uint64_t
aActionId
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvWindowBlur
(
const
MaybeDiscarded
<
BrowsingContext
>
&
aContext
CallerType
aCallerType
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvRaiseWindow
(
const
MaybeDiscarded
<
BrowsingContext
>
&
aContext
CallerType
aCallerType
uint64_t
aActionId
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvAdjustWindowFocus
(
const
MaybeDiscarded
<
BrowsingContext
>
&
aContext
bool
aIsVisible
uint64_t
aActionId
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvClearFocus
(
const
MaybeDiscarded
<
BrowsingContext
>
&
aContext
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvSetFocusedBrowsingContext
(
const
MaybeDiscarded
<
BrowsingContext
>
&
aContext
uint64_t
aActionId
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvSetActiveBrowsingContext
(
const
MaybeDiscarded
<
BrowsingContext
>
&
aContext
uint64_t
aActionId
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvUnsetActiveBrowsingContext
(
const
MaybeDiscarded
<
BrowsingContext
>
&
aContext
uint64_t
aActionId
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvSetFocusedElement
(
const
MaybeDiscarded
<
BrowsingContext
>
&
aContext
bool
aNeedsFocus
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvFinalizeFocusOuter
(
const
MaybeDiscarded
<
BrowsingContext
>
&
aContext
bool
aCanFocus
CallerType
aCallerType
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvInsertNewFocusActionId
(
uint64_t
aActionId
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvBlurToParent
(
const
MaybeDiscarded
<
BrowsingContext
>
&
aFocusedBrowsingContext
const
MaybeDiscarded
<
BrowsingContext
>
&
aBrowsingContextToClear
const
MaybeDiscarded
<
BrowsingContext
>
&
aAncestorBrowsingContextToFocus
bool
aIsLeavingDocument
bool
aAdjustWidget
bool
aBrowsingContextToClearHandled
bool
aAncestorBrowsingContextToFocusHandled
uint64_t
aActionId
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvMaybeExitFullscreen
(
const
MaybeDiscarded
<
BrowsingContext
>
&
aContext
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvWindowPostMessage
(
const
MaybeDiscarded
<
BrowsingContext
>
&
aContext
const
ClonedOrErrorMessageData
&
aMessage
const
PostMessageData
&
aData
)
;
FORWARD_SHMEM_ALLOCATOR_TO
(
PContentParent
)
mozilla
:
:
ipc
:
:
IPCResult
RecvBlobURLDataRequest
(
const
nsACString
&
aBlobURL
nsIPrincipal
*
pTriggeringPrincipal
nsIPrincipal
*
pLoadingPrincipal
const
OriginAttributes
&
aOriginAttributes
uint64_t
aInnerWindowId
const
Maybe
<
nsID
>
&
aAgentClusterId
BlobURLDataRequestResolver
&
&
aResolver
)
;
protected
:
bool
CheckBrowsingContextEmbedder
(
CanonicalBrowsingContext
*
aBC
const
char
*
aOperation
)
const
;
void
ActorDestroy
(
ActorDestroyReason
why
)
override
;
void
ActorDealloc
(
)
override
;
bool
ShouldContinueFromReplyTimeout
(
)
override
;
void
OnVarChanged
(
const
GfxVarUpdate
&
aVar
)
override
;
void
OnCompositorUnexpectedShutdown
(
)
override
;
private
:
static
nsClassHashtable
<
nsCStringHashKey
nsTArray
<
ContentParent
*
>
>
*
sBrowserContentParents
;
static
UniquePtr
<
nsTArray
<
ContentParent
*
>
>
sPrivateContent
;
static
UniquePtr
<
nsTHashMap
<
nsUint32HashKey
ContentParent
*
>
>
sJSPluginContentParents
;
static
UniquePtr
<
LinkedList
<
ContentParent
>
>
sContentParents
;
static
StaticRefPtr
<
ContentParent
>
sRecycledE10SProcess
;
void
AddShutdownBlockers
(
)
;
void
RemoveShutdownBlockers
(
)
;
#
if
defined
(
XP_MACOSX
)
&
&
defined
(
MOZ_SANDBOX
)
static
UniquePtr
<
std
:
:
vector
<
std
:
:
string
>
>
sMacSandboxParams
;
#
endif
mozilla
:
:
ipc
:
:
IPCResult
CommonCreateWindow
(
PBrowserParent
*
aThisTab
BrowsingContext
&
aParent
bool
aSetOpener
const
uint32_t
&
aChromeFlags
const
bool
&
aCalledFromJS
const
bool
&
aForPrinting
const
bool
&
aForWindowDotPrint
nsIURI
*
aURIToLoad
const
nsACString
&
aFeatures
BrowserParent
*
aNextRemoteBrowser
const
nsAString
&
aName
nsresult
&
aResult
nsCOMPtr
<
nsIRemoteTab
>
&
aNewRemoteTab
bool
*
aWindowIsNew
int32_t
&
aOpenLocation
nsIPrincipal
*
aTriggeringPrincipal
nsIReferrerInfo
*
aReferrerInfo
bool
aLoadUri
nsIContentSecurityPolicy
*
aCsp
const
OriginAttributes
&
aOriginAttributes
)
;
explicit
ContentParent
(
int32_t
aPluginID
)
:
ContentParent
(
"
"
_ns
aPluginID
)
{
}
explicit
ContentParent
(
const
nsACString
&
aRemoteType
)
:
ContentParent
(
aRemoteType
nsFakePluginTag
:
:
NOT_JSPLUGIN
)
{
}
ContentParent
(
const
nsACString
&
aRemoteType
int32_t
aPluginID
)
;
bool
LaunchSubprocessSync
(
hal
:
:
ProcessPriority
aInitialPriority
)
;
RefPtr
<
LaunchPromise
>
LaunchSubprocessAsync
(
hal
:
:
ProcessPriority
aInitialPriority
)
;
bool
BeginSubprocessLaunch
(
ProcessPriority
aPriority
)
;
void
LaunchSubprocessReject
(
)
;
bool
LaunchSubprocessResolve
(
bool
aIsSync
ProcessPriority
aPriority
)
;
bool
InitInternal
(
ProcessPriority
aPriority
)
;
void
GeneratePairedMinidump
(
const
char
*
aReason
)
;
void
HandleOrphanedMinidump
(
nsString
*
aDumpId
)
;
virtual
~
ContentParent
(
)
;
void
Init
(
)
;
void
ForwardKnownInfo
(
)
;
bool
TryToRecycle
(
)
;
void
StopRecycling
(
bool
aForeground
=
true
)
;
void
RemoveFromList
(
)
;
bool
HasActiveWorkerOrJSPlugin
(
)
;
bool
ShouldKeepProcessAlive
(
)
;
void
MarkAsDead
(
)
;
void
MaybeBeginShutDown
(
uint32_t
aExpectedBrowserCount
=
0
bool
aSendShutDown
=
true
)
;
enum
ShutDownMethod
{
SEND_SHUTDOWN_MESSAGE
CLOSE_CHANNEL
CLOSE_CHANNEL_WITH_ERROR
}
;
void
MaybeAsyncSendShutDownMessage
(
)
;
void
ShutDownProcess
(
ShutDownMethod
aMethod
)
;
void
ShutDownMessageManager
(
)
;
void
StartForceKillTimer
(
)
;
void
EnsurePermissionsByKey
(
const
nsACString
&
aKey
const
nsACString
&
aOrigin
)
;
static
void
ForceKillTimerCallback
(
nsITimer
*
aTimer
void
*
aClosure
)
;
bool
CanOpenBrowser
(
const
IPCTabContext
&
aContext
)
;
static
nsTArray
<
ContentParent
*
>
&
GetOrCreatePool
(
const
nsACString
&
aContentProcessType
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvInitBackground
(
Endpoint
<
mozilla
:
:
ipc
:
:
PBackgroundStarterParent
>
&
&
aEndpoint
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvAddMemoryReport
(
const
MemoryReport
&
aReport
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvAddPerformanceMetrics
(
const
nsID
&
aID
nsTArray
<
PerformanceInfo
>
&
&
aMetrics
)
;
bool
DeallocPRemoteSpellcheckEngineParent
(
PRemoteSpellcheckEngineParent
*
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvCloneDocumentTreeInto
(
const
MaybeDiscarded
<
BrowsingContext
>
&
aSource
const
MaybeDiscarded
<
BrowsingContext
>
&
aTarget
PrintData
&
&
aPrintData
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvUpdateRemotePrintSettings
(
const
MaybeDiscarded
<
BrowsingContext
>
&
aTarget
PrintData
&
&
aPrintData
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvConstructPopupBrowser
(
ManagedEndpoint
<
PBrowserParent
>
&
&
actor
ManagedEndpoint
<
PWindowGlobalParent
>
&
&
windowEp
const
TabId
&
tabId
const
IPCTabContext
&
context
const
WindowGlobalInit
&
initialWindowInit
const
uint32_t
&
chromeFlags
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvIsSecureURI
(
nsIURI
*
aURI
const
OriginAttributes
&
aOriginAttributes
bool
*
aIsSecureURI
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvAccumulateMixedContentHSTS
(
nsIURI
*
aURI
const
bool
&
aActive
const
OriginAttributes
&
aOriginAttributes
)
;
bool
DeallocPHalParent
(
PHalParent
*
)
;
bool
DeallocPHeapSnapshotTempFileHelperParent
(
PHeapSnapshotTempFileHelperParent
*
)
;
PCycleCollectWithLogsParent
*
AllocPCycleCollectWithLogsParent
(
const
bool
&
aDumpAllTraces
const
FileDescriptor
&
aGCLog
const
FileDescriptor
&
aCCLog
)
;
bool
DeallocPCycleCollectWithLogsParent
(
PCycleCollectWithLogsParent
*
aActor
)
;
PTestShellParent
*
AllocPTestShellParent
(
)
;
bool
DeallocPTestShellParent
(
PTestShellParent
*
shell
)
;
PScriptCacheParent
*
AllocPScriptCacheParent
(
const
FileDescOrError
&
cacheFile
const
bool
&
wantCacheData
)
;
bool
DeallocPScriptCacheParent
(
PScriptCacheParent
*
shell
)
;
already_AddRefed
<
PExternalHelperAppParent
>
AllocPExternalHelperAppParent
(
nsIURI
*
aUri
const
Maybe
<
mozilla
:
:
net
:
:
LoadInfoArgs
>
&
aLoadInfoArgs
const
nsACString
&
aMimeContentType
const
nsACString
&
aContentDisposition
const
uint32_t
&
aContentDispositionHint
const
nsAString
&
aContentDispositionFilename
const
bool
&
aForceSave
const
int64_t
&
aContentLength
const
bool
&
aWasFileChannel
nsIURI
*
aReferrer
const
MaybeDiscarded
<
BrowsingContext
>
&
aContext
const
bool
&
aShouldCloseWindow
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvPExternalHelperAppConstructor
(
PExternalHelperAppParent
*
actor
nsIURI
*
uri
const
Maybe
<
LoadInfoArgs
>
&
loadInfoArgs
const
nsACString
&
aMimeContentType
const
nsACString
&
aContentDisposition
const
uint32_t
&
aContentDispositionHint
const
nsAString
&
aContentDispositionFilename
const
bool
&
aForceSave
const
int64_t
&
aContentLength
const
bool
&
aWasFileChannel
nsIURI
*
aReferrer
const
MaybeDiscarded
<
BrowsingContext
>
&
aContext
const
bool
&
aShouldCloseWindow
)
override
;
already_AddRefed
<
PHandlerServiceParent
>
AllocPHandlerServiceParent
(
)
;
PMediaParent
*
AllocPMediaParent
(
)
;
bool
DeallocPMediaParent
(
PMediaParent
*
aActor
)
;
PBenchmarkStorageParent
*
AllocPBenchmarkStorageParent
(
)
;
bool
DeallocPBenchmarkStorageParent
(
PBenchmarkStorageParent
*
aActor
)
;
#
ifdef
MOZ_WEBSPEECH
PSpeechSynthesisParent
*
AllocPSpeechSynthesisParent
(
)
;
bool
DeallocPSpeechSynthesisParent
(
PSpeechSynthesisParent
*
aActor
)
;
virtual
mozilla
:
:
ipc
:
:
IPCResult
RecvPSpeechSynthesisConstructor
(
PSpeechSynthesisParent
*
aActor
)
override
;
#
endif
PWebBrowserPersistDocumentParent
*
AllocPWebBrowserPersistDocumentParent
(
PBrowserParent
*
aBrowser
const
MaybeDiscarded
<
BrowsingContext
>
&
aContext
)
;
bool
DeallocPWebBrowserPersistDocumentParent
(
PWebBrowserPersistDocumentParent
*
aActor
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvGetGfxVars
(
nsTArray
<
GfxVarUpdate
>
*
aVars
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvSetClipboard
(
const
IPCDataTransfer
&
aDataTransfer
const
bool
&
aIsPrivateData
const
IPC
:
:
Principal
&
aRequestingPrincipal
const
nsContentPolicyType
&
aContentPolicyType
const
int32_t
&
aWhichClipboard
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvGetClipboard
(
nsTArray
<
nsCString
>
&
&
aTypes
const
int32_t
&
aWhichClipboard
IPCDataTransfer
*
aDataTransfer
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvEmptyClipboard
(
const
int32_t
&
aWhichClipboard
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvClipboardHasType
(
nsTArray
<
nsCString
>
&
&
aTypes
const
int32_t
&
aWhichClipboard
bool
*
aHasType
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvGetExternalClipboardFormats
(
const
int32_t
&
aWhichClipboard
const
bool
&
aPlainTextOnly
nsTArray
<
nsCString
>
*
aTypes
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvGetClipboardAsync
(
nsTArray
<
nsCString
>
&
&
aTypes
const
int32_t
&
aWhichClipboard
GetClipboardAsyncResolver
&
&
aResolver
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvPlaySound
(
nsIURI
*
aURI
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvBeep
(
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvPlayEventSound
(
const
uint32_t
&
aEventId
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvGetIconForExtension
(
const
nsACString
&
aFileExt
const
uint32_t
&
aIconSize
nsTArray
<
uint8_t
>
*
bits
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvStartVisitedQueries
(
const
nsTArray
<
RefPtr
<
nsIURI
>
>
&
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvSetURITitle
(
nsIURI
*
uri
const
nsAString
&
title
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvShowAlert
(
nsIAlertNotification
*
aAlert
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvCloseAlert
(
const
nsAString
&
aName
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvDisableNotifications
(
const
IPC
:
:
Principal
&
aPrincipal
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvOpenNotificationSettings
(
const
IPC
:
:
Principal
&
aPrincipal
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvNotificationEvent
(
const
nsAString
&
aType
const
NotificationEventData
&
aData
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvLoadURIExternal
(
nsIURI
*
uri
nsIPrincipal
*
triggeringPrincipal
nsIPrincipal
*
redirectPrincipal
const
MaybeDiscarded
<
BrowsingContext
>
&
aContext
bool
aWasExternallyTriggered
bool
aHasValidUserGestureActivation
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvExtProtocolChannelConnectParent
(
const
uint64_t
&
registrarId
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvSyncMessage
(
const
nsAString
&
aMsg
const
ClonedMessageData
&
aData
nsTArray
<
StructuredCloneData
>
*
aRetvals
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvAsyncMessage
(
const
nsAString
&
aMsg
const
ClonedMessageData
&
aData
)
;
MOZ_CAN_RUN_SCRIPT_BOUNDARY
mozilla
:
:
ipc
:
:
IPCResult
RecvAddGeolocationListener
(
const
bool
&
aHighAccuracy
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvRemoveGeolocationListener
(
)
;
MOZ_CAN_RUN_SCRIPT_BOUNDARY
mozilla
:
:
ipc
:
:
IPCResult
RecvSetGeolocationHigherAccuracy
(
const
bool
&
aEnable
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvConsoleMessage
(
const
nsAString
&
aMessage
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvScriptError
(
const
nsAString
&
aMessage
const
nsAString
&
aSourceName
const
nsAString
&
aSourceLine
const
uint32_t
&
aLineNumber
const
uint32_t
&
aColNumber
const
uint32_t
&
aFlags
const
nsACString
&
aCategory
const
bool
&
aIsFromPrivateWindow
const
uint64_t
&
aInnerWindowId
const
bool
&
aIsFromChromeContext
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvReportFrameTimingData
(
uint64_t
innerWindowId
const
nsAString
&
entryName
const
nsAString
&
initiatorType
UniquePtr
<
PerformanceTimingData
>
&
&
aData
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvScriptErrorWithStack
(
const
nsAString
&
aMessage
const
nsAString
&
aSourceName
const
nsAString
&
aSourceLine
const
uint32_t
&
aLineNumber
const
uint32_t
&
aColNumber
const
uint32_t
&
aFlags
const
nsACString
&
aCategory
const
bool
&
aIsFromPrivateWindow
const
bool
&
aIsFromChromeContext
const
ClonedMessageData
&
aStack
)
;
private
:
nsresult
GetDataFromClipboard
(
const
nsTArray
<
nsCString
>
&
aTypes
int32_t
aWhichClipboard
bool
aInSyncMessage
IPCDataTransfer
*
aDataTransfer
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvScriptErrorInternal
(
const
nsAString
&
aMessage
const
nsAString
&
aSourceName
const
nsAString
&
aSourceLine
const
uint32_t
&
aLineNumber
const
uint32_t
&
aColNumber
const
uint32_t
&
aFlags
const
nsACString
&
aCategory
const
bool
&
aIsFromPrivateWindow
const
bool
&
aIsFromChromeContext
const
ClonedMessageData
*
aStack
=
nullptr
)
;
public
:
mozilla
:
:
ipc
:
:
IPCResult
RecvCommitBrowsingContextTransaction
(
const
MaybeDiscarded
<
BrowsingContext
>
&
aContext
BrowsingContext
:
:
BaseTransaction
&
&
aTransaction
uint64_t
aEpoch
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvCommitWindowContextTransaction
(
const
MaybeDiscarded
<
WindowContext
>
&
aContext
WindowContext
:
:
BaseTransaction
&
&
aTransaction
uint64_t
aEpoch
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvAddSecurityState
(
const
MaybeDiscarded
<
WindowContext
>
&
aContext
uint32_t
aStateFlags
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvFirstIdle
(
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvDeviceReset
(
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvCopyFavicon
(
nsIURI
*
aOldURI
nsIURI
*
aNewURI
const
bool
&
aInPrivateBrowsing
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvFindImageText
(
ShmemImage
&
&
FindImageTextResolver
&
&
)
;
virtual
void
ProcessingError
(
Result
aCode
const
char
*
aMsgName
)
override
;
mozilla
:
:
ipc
:
:
IPCResult
RecvGraphicsError
(
const
nsACString
&
aError
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvBeginDriverCrashGuard
(
const
uint32_t
&
aGuardType
bool
*
aOutCrashed
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvEndDriverCrashGuard
(
const
uint32_t
&
aGuardType
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvAddIdleObserver
(
const
uint64_t
&
observerId
const
uint32_t
&
aIdleTimeInS
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvRemoveIdleObserver
(
const
uint64_t
&
observerId
const
uint32_t
&
aIdleTimeInS
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvBackUpXResources
(
const
FileDescriptor
&
aXSocketFd
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvRequestAnonymousTemporaryFile
(
const
uint64_t
&
aID
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvCreateAudioIPCConnection
(
CreateAudioIPCConnectionResolver
&
&
aResolver
)
;
already_AddRefed
<
extensions
:
:
PExtensionsParent
>
AllocPExtensionsParent
(
)
;
#
ifdef
MOZ_WEBRTC
PWebrtcGlobalParent
*
AllocPWebrtcGlobalParent
(
)
;
bool
DeallocPWebrtcGlobalParent
(
PWebrtcGlobalParent
*
aActor
)
;
#
endif
mozilla
:
:
ipc
:
:
IPCResult
RecvUpdateDropEffect
(
const
uint32_t
&
aDragAction
const
uint32_t
&
aDropEffect
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvShutdownProfile
(
const
nsACString
&
aProfile
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvShutdownPerfStats
(
const
nsACString
&
aPerfStats
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvGetGraphicsDeviceInitData
(
ContentDeviceData
*
aOut
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvGetOutputColorProfileData
(
nsTArray
<
uint8_t
>
*
aOutputColorProfileData
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvGetFontListShmBlock
(
const
uint32_t
&
aGeneration
const
uint32_t
&
aIndex
base
:
:
SharedMemoryHandle
*
aOut
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvInitializeFamily
(
const
uint32_t
&
aGeneration
const
uint32_t
&
aFamilyIndex
const
bool
&
aLoadCmaps
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvSetCharacterMap
(
const
uint32_t
&
aGeneration
const
mozilla
:
:
fontlist
:
:
Pointer
&
aFacePtr
const
gfxSparseBitSet
&
aMap
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvInitOtherFamilyNames
(
const
uint32_t
&
aGeneration
const
bool
&
aDefer
bool
*
aLoaded
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvSetupFamilyCharMap
(
const
uint32_t
&
aGeneration
const
mozilla
:
:
fontlist
:
:
Pointer
&
aFamilyPtr
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvStartCmapLoading
(
const
uint32_t
&
aGeneration
const
uint32_t
&
aStartIndex
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvGetHyphDict
(
nsIURI
*
aURIParams
base
:
:
SharedMemoryHandle
*
aOutHandle
uint32_t
*
aOutSize
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvNotifyBenchmarkResult
(
const
nsAString
&
aCodecName
const
uint32_t
&
aDecodeFPS
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvNotifyPushObservers
(
const
nsACString
&
aScope
const
IPC
:
:
Principal
&
aPrincipal
const
nsAString
&
aMessageId
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvNotifyPushObserversWithData
(
const
nsACString
&
aScope
const
IPC
:
:
Principal
&
aPrincipal
const
nsAString
&
aMessageId
nsTArray
<
uint8_t
>
&
&
aData
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvNotifyPushSubscriptionChangeObservers
(
const
nsACString
&
aScope
const
IPC
:
:
Principal
&
aPrincipal
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvPushError
(
const
nsACString
&
aScope
const
IPC
:
:
Principal
&
aPrincipal
const
nsAString
&
aMessage
const
uint32_t
&
aFlags
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvNotifyPushSubscriptionModifiedObservers
(
const
nsACString
&
aScope
const
IPC
:
:
Principal
&
aPrincipal
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvGetFilesRequest
(
const
nsID
&
aID
const
nsAString
&
aDirectoryPath
const
bool
&
aRecursiveFlag
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvDeleteGetFilesRequest
(
const
nsID
&
aID
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvAccumulateChildHistograms
(
nsTArray
<
HistogramAccumulation
>
&
&
aAccumulations
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvAccumulateChildKeyedHistograms
(
nsTArray
<
KeyedHistogramAccumulation
>
&
&
aAccumulations
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvUpdateChildScalars
(
nsTArray
<
ScalarAction
>
&
&
aScalarActions
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvUpdateChildKeyedScalars
(
nsTArray
<
KeyedScalarAction
>
&
&
aScalarActions
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvRecordChildEvents
(
nsTArray
<
ChildEventData
>
&
&
events
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvRecordDiscardedData
(
const
DiscardedData
&
aDiscardedData
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvRecordOrigin
(
const
uint32_t
&
aMetricId
const
nsACString
&
aOrigin
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvReportContentBlockingLog
(
const
IPCStream
&
aIPCStream
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvBHRThreadHang
(
const
HangDetails
&
aHangDetails
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvAddCertException
(
const
nsACString
&
aSerializedCert
uint32_t
aFlags
const
nsACString
&
aHostName
int32_t
aPort
const
OriginAttributes
&
aOriginAttributes
bool
aIsTemporary
AddCertExceptionResolver
&
&
aResolver
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvAutomaticStorageAccessPermissionCanBeGranted
(
const
Principal
&
aPrincipal
AutomaticStorageAccessPermissionCanBeGrantedResolver
&
&
aResolver
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvStorageAccessPermissionGrantedForOrigin
(
uint64_t
aTopLevelWindowId
const
MaybeDiscarded
<
BrowsingContext
>
&
aParentContext
const
Principal
&
aTrackingPrincipal
const
nsACString
&
aTrackingOrigin
const
int
&
aAllowMode
const
Maybe
<
ContentBlockingNotifier
:
:
StorageAccessPermissionGrantedReason
>
&
aReason
StorageAccessPermissionGrantedForOriginResolver
&
&
aResolver
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvCompleteAllowAccessFor
(
const
MaybeDiscarded
<
BrowsingContext
>
&
aParentContext
uint64_t
aTopLevelWindowId
const
Principal
&
aTrackingPrincipal
const
nsACString
&
aTrackingOrigin
uint32_t
aCookieBehavior
const
ContentBlockingNotifier
:
:
StorageAccessPermissionGrantedReason
&
aReason
CompleteAllowAccessForResolver
&
&
aResolver
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvSetAllowStorageAccessRequestFlag
(
nsIPrincipal
*
aEmbeddedPrincipal
nsIURI
*
aEmbeddingOrigin
SetAllowStorageAccessRequestFlagResolver
&
&
aResolver
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvTestAllowStorageAccessRequestFlag
(
nsIPrincipal
*
aEmbeddingPrincipal
nsIURI
*
aEmbeddedOrigin
TestAllowStorageAccessRequestFlagResolver
&
&
aResolver
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvStoreUserInteractionAsPermission
(
const
Principal
&
aPrincipal
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvTestCookiePermissionDecided
(
const
MaybeDiscarded
<
BrowsingContext
>
&
aContext
const
Principal
&
aPrincipal
const
TestCookiePermissionDecidedResolver
&
&
aResolver
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvNotifyMediaPlaybackChanged
(
const
MaybeDiscarded
<
BrowsingContext
>
&
aContext
MediaPlaybackState
aState
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvNotifyMediaAudibleChanged
(
const
MaybeDiscarded
<
BrowsingContext
>
&
aContext
MediaAudibleState
aState
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvNotifyPictureInPictureModeChanged
(
const
MaybeDiscarded
<
BrowsingContext
>
&
aContext
bool
aEnabled
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvNotifyMediaSessionUpdated
(
const
MaybeDiscarded
<
BrowsingContext
>
&
aContext
bool
aIsCreated
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvNotifyUpdateMediaMetadata
(
const
MaybeDiscarded
<
BrowsingContext
>
&
aContext
const
Maybe
<
MediaMetadataBase
>
&
aMetadata
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvNotifyMediaSessionPlaybackStateChanged
(
const
MaybeDiscarded
<
BrowsingContext
>
&
aContext
MediaSessionPlaybackState
aPlaybackState
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvNotifyMediaSessionSupportedActionChanged
(
const
MaybeDiscarded
<
BrowsingContext
>
&
aContext
MediaSessionAction
aAction
bool
aEnabled
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvNotifyMediaFullScreenState
(
const
MaybeDiscarded
<
BrowsingContext
>
&
aContext
bool
aIsInFullScreen
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvNotifyPositionStateChanged
(
const
MaybeDiscarded
<
BrowsingContext
>
&
aContext
const
PositionState
&
aState
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvAddOrRemovePageAwakeRequest
(
const
MaybeDiscarded
<
BrowsingContext
>
&
aContext
const
bool
&
aShouldAddCount
)
;
#
if
defined
(
XP_WIN
)
mozilla
:
:
ipc
:
:
IPCResult
RecvGetModulesTrust
(
ModulePaths
&
&
aModPaths
bool
aRunAtNormalPriority
GetModulesTrustResolver
&
&
aResolver
)
;
#
endif
mozilla
:
:
ipc
:
:
IPCResult
RecvReportServiceWorkerShutdownProgress
(
uint32_t
aShutdownStateId
ServiceWorkerShutdownState
:
:
Progress
aProgress
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvRawMessage
(
const
JSActorMessageMeta
&
aMeta
const
Maybe
<
ClonedMessageData
>
&
aData
const
Maybe
<
ClonedMessageData
>
&
aStack
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvAbortOtherOrientationPendingPromises
(
const
MaybeDiscarded
<
BrowsingContext
>
&
aContext
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvNotifyOnHistoryReload
(
const
MaybeDiscarded
<
BrowsingContext
>
&
aContext
const
bool
&
aForceReload
NotifyOnHistoryReloadResolver
&
&
aResolver
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvHistoryCommit
(
const
MaybeDiscarded
<
BrowsingContext
>
&
aContext
const
uint64_t
&
aLoadID
const
nsID
&
aChangeID
const
uint32_t
&
aLoadType
const
bool
&
aPersist
const
bool
&
aCloneEntryChildren
const
bool
&
aChannelExpired
const
uint32_t
&
aCacheKey
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvHistoryGo
(
const
MaybeDiscarded
<
BrowsingContext
>
&
aContext
int32_t
aOffset
uint64_t
aHistoryEpoch
bool
aRequireUserInteraction
bool
aUserActivation
HistoryGoResolver
&
&
aResolveRequestedIndex
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvSynchronizeLayoutHistoryState
(
const
MaybeDiscarded
<
BrowsingContext
>
&
aContext
nsILayoutHistoryState
*
aState
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvSessionHistoryEntryTitle
(
const
MaybeDiscarded
<
BrowsingContext
>
&
aContext
const
nsAString
&
aTitle
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvSessionHistoryEntryScrollRestorationIsManual
(
const
MaybeDiscarded
<
BrowsingContext
>
&
aContext
const
bool
&
aIsManual
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvSessionHistoryEntryScrollPosition
(
const
MaybeDiscarded
<
BrowsingContext
>
&
aContext
const
int32_t
&
aX
const
int32_t
&
aY
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvSessionHistoryEntryCacheKey
(
const
MaybeDiscarded
<
BrowsingContext
>
&
aContext
const
uint32_t
&
aCacheKey
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvSessionHistoryEntryWireframe
(
const
MaybeDiscarded
<
BrowsingContext
>
&
aContext
const
Wireframe
&
aWireframe
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvSessionHistoryEntryStoreWindowNameInContiguousEntries
(
const
MaybeDiscarded
<
BrowsingContext
>
&
aContext
const
nsAString
&
aName
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvGetLoadingSessionHistoryInfoFromParent
(
const
MaybeDiscarded
<
BrowsingContext
>
&
aContext
GetLoadingSessionHistoryInfoFromParentResolver
&
&
aResolver
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvRemoveFromBFCache
(
const
MaybeDiscarded
<
BrowsingContext
>
&
aContext
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvSetActiveSessionHistoryEntry
(
const
MaybeDiscarded
<
BrowsingContext
>
&
aContext
const
Maybe
<
nsPoint
>
&
aPreviousScrollPos
SessionHistoryInfo
&
&
aInfo
uint32_t
aLoadType
uint32_t
aUpdatedCacheKey
const
nsID
&
aChangeID
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvReplaceActiveSessionHistoryEntry
(
const
MaybeDiscarded
<
BrowsingContext
>
&
aContext
SessionHistoryInfo
&
&
aInfo
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvRemoveDynEntriesFromActiveSessionHistoryEntry
(
const
MaybeDiscarded
<
BrowsingContext
>
&
aContext
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvRemoveFromSessionHistory
(
const
MaybeDiscarded
<
BrowsingContext
>
&
aContext
const
nsID
&
aChangeID
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvHistoryReload
(
const
MaybeDiscarded
<
BrowsingContext
>
&
aContext
const
uint32_t
aReloadFlags
)
;
void
MaybeEnableRemoteInputEventQueue
(
)
;
#
if
defined
(
XP_MACOSX
)
&
&
defined
(
MOZ_SANDBOX
)
void
AppendSandboxParams
(
std
:
:
vector
<
std
:
:
string
>
&
aArgs
)
;
void
AppendDynamicSandboxParams
(
std
:
:
vector
<
std
:
:
string
>
&
aArgs
)
;
#
endif
mozilla
:
:
ipc
:
:
IPCResult
RecvFOGData
(
ByteBuf
&
&
buf
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvSetContainerFeaturePolicy
(
const
MaybeDiscardedBrowsingContext
&
aContainerContext
FeaturePolicy
*
aContainerFeaturePolicy
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvGetSystemIcon
(
nsIURI
*
aURI
GetSystemIconResolver
&
&
aResolver
)
;
#
ifdef
FUZZING_SNAPSHOT
mozilla
:
:
ipc
:
:
IPCResult
RecvSignalFuzzingReady
(
)
;
#
endif
public
:
void
SendGetFilesResponseAndForget
(
const
nsID
&
aID
const
GetFilesResponseResult
&
aResult
)
;
bool
SendRequestMemoryReport
(
const
uint32_t
&
aGeneration
const
bool
&
aAnonymize
const
bool
&
aMinimizeMemoryUsage
const
Maybe
<
FileDescriptor
>
&
aDMDFile
)
override
;
void
AddBrowsingContextGroup
(
BrowsingContextGroup
*
aGroup
)
;
void
RemoveBrowsingContextGroup
(
BrowsingContextGroup
*
aGroup
)
;
uint64_t
GetBrowsingContextFieldEpoch
(
)
const
{
return
mBrowsingContextFieldEpoch
;
}
void
UpdateNetworkLinkType
(
)
;
already_AddRefed
<
JSActor
>
InitJSActor
(
JS
:
:
Handle
<
JSObject
*
>
aMaybeActor
const
nsACString
&
aName
ErrorResult
&
aRv
)
override
;
mozilla
:
:
ipc
:
:
IProtocol
*
AsNativeActor
(
)
override
{
return
this
;
}
static
already_AddRefed
<
nsIPrincipal
>
CreateRemoteTypeIsolationPrincipal
(
const
nsACString
&
aRemoteType
)
;
#
ifdef
MOZ_DIAGNOSTIC_ASSERT_ENABLED
bool
IsBlockingShutdown
(
)
{
return
mBlockShutdownCalled
;
}
#
endif
private
:
static
already_AddRefed
<
ContentParent
>
GetUsedBrowserProcess
(
const
nsACString
&
aRemoteType
nsTArray
<
ContentParent
*
>
&
aContentParents
uint32_t
aMaxContentParents
bool
aPreferUsed
ProcessPriority
aPriority
)
;
void
AddToPool
(
nsTArray
<
ContentParent
*
>
&
)
;
void
RemoveFromPool
(
nsTArray
<
ContentParent
*
>
&
)
;
void
AssertNotInPool
(
)
;
void
AssertAlive
(
)
;
static
void
DidLaunchSubprocess
(
)
;
private
:
RefPtr
<
ContentParent
>
mSelfRef
;
GeckoChildProcessHost
*
mSubprocess
;
const
TimeStamp
mLaunchTS
;
TimeStamp
mLaunchYieldTS
;
TimeStamp
mActivateTS
;
bool
mIsAPreallocBlocker
;
nsCString
mRemoteType
;
nsCOMPtr
<
nsIPrincipal
>
mRemoteTypeIsolationPrincipal
;
ContentParentId
mChildID
;
int32_t
mGeolocationWatchID
;
int32_t
mJSPluginID
;
nsCOMPtr
<
nsITimer
>
mForceKillTimer
;
struct
RemoteWorkerActorData
{
uint32_t
mCount
=
0
;
bool
mShutdownStarted
=
false
;
}
;
DataMutex
<
RemoteWorkerActorData
>
mRemoteWorkerActorData
;
int32_t
mNumDestroyingTabs
;
uint32_t
mNumKeepaliveCalls
;
enum
class
LifecycleState
:
uint8_t
{
LAUNCHING
ALIVE
INITIALIZED
DEAD
}
;
LifecycleState
mLifecycleState
;
uint8_t
mIsForBrowser
:
1
;
uint8_t
mCalledClose
:
1
;
uint8_t
mCalledKillHard
:
1
;
uint8_t
mCreatedPairedMinidumps
:
1
;
uint8_t
mShutdownPending
:
1
;
uint8_t
mLaunchResolved
:
1
;
uint8_t
mLaunchResolvedOk
:
1
;
uint8_t
mIsRemoteInputEventQueueEnabled
:
1
;
uint8_t
mIsInputPriorityEventEnabled
:
1
;
uint8_t
mIsInPool
:
1
;
#
ifdef
MOZ_DIAGNOSTIC_ASSERT_ENABLED
bool
mBlockShutdownCalled
;
#
endif
nsCOMPtr
<
nsIContentProcessInfo
>
mScriptableHelper
;
nsTArray
<
nsCOMPtr
<
nsIObserver
>
>
mIdleListeners
;
#
ifdef
MOZ_X11
ScopedClose
mChildXSocketFdDup
;
#
endif
PProcessHangMonitorParent
*
mHangMonitorActor
;
UniquePtr
<
gfx
:
:
DriverCrashGuard
>
mDriverCrashGuard
;
UniquePtr
<
MemoryReportRequestHost
>
mMemoryReportRequest
;
#
if
defined
(
XP_LINUX
)
&
&
defined
(
MOZ_SANDBOX
)
mozilla
:
:
UniquePtr
<
SandboxBroker
>
mSandboxBroker
;
static
mozilla
:
:
UniquePtr
<
SandboxBrokerPolicyFactory
>
sSandboxBrokerPolicyFactory
;
#
endif
nsRefPtrHashtable
<
nsIDHashKey
GetFilesHelper
>
mGetFilesPendingRequests
;
nsTHashSet
<
nsCString
>
mActivePermissionKeys
;
nsTArray
<
nsCString
>
mBlobURLs
;
nsTArray
<
uint64_t
>
mLoadedOriginHashes
;
UniquePtr
<
mozilla
:
:
ipc
:
:
CrashReporterHost
>
mCrashReporter
;
nsTArray
<
Pref
>
mQueuedPrefs
;
RefPtr
<
mozilla
:
:
dom
:
:
ProcessMessageManager
>
mMessageManager
;
#
if
defined
(
XP_MACOSX
)
&
&
defined
(
MOZ_SANDBOX
)
static
bool
sEarlySandboxInit
;
#
endif
nsTHashSet
<
RefPtr
<
BrowsingContextGroup
>
>
mGroups
;
uint64_t
mBrowsingContextFieldEpoch
=
0
;
UniquePtr
<
mozilla
:
:
ipc
:
:
SharedPreferenceSerializer
>
mPrefSerializer
;
static
uint32_t
sMaxContentProcesses
;
static
Maybe
<
TimeStamp
>
sLastContentProcessLaunch
;
}
;
NS_DEFINE_STATIC_IID_ACCESSOR
(
ContentParent
NS_CONTENTPARENT_IID
)
const
nsDependentCSubstring
RemoteTypePrefix
(
const
nsACString
&
aContentProcessType
)
;
bool
IsWebRemoteType
(
const
nsACString
&
aContentProcessType
)
;
bool
IsWebCoopCoepRemoteType
(
const
nsACString
&
aContentProcessType
)
;
bool
IsPrivilegedMozillaRemoteType
(
const
nsACString
&
aContentProcessType
)
;
bool
IsExtensionRemoteType
(
const
nsACString
&
aContentProcessType
)
;
inline
nsISupports
*
ToSupports
(
mozilla
:
:
dom
:
:
ContentParent
*
aContentParent
)
{
return
static_cast
<
nsIDOMProcessParent
*
>
(
aContentParent
)
;
}
}
}
class
ParentIdleListener
:
public
nsIObserver
{
friend
class
mozilla
:
:
dom
:
:
ContentParent
;
public
:
NS_DECL_ISUPPORTS
NS_DECL_NSIOBSERVER
ParentIdleListener
(
mozilla
:
:
dom
:
:
ContentParent
*
aParent
uint64_t
aObserver
uint32_t
aTime
)
:
mParent
(
aParent
)
mObserver
(
aObserver
)
mTime
(
aTime
)
{
}
private
:
virtual
~
ParentIdleListener
(
)
=
default
;
RefPtr
<
mozilla
:
:
dom
:
:
ContentParent
>
mParent
;
uint64_t
mObserver
;
uint32_t
mTime
;
}
;
#
endif
