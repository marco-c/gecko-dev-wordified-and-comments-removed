#
ifndef
mozilla_dom_PushNotifier_h
#
define
mozilla_dom_PushNotifier_h
#
include
"
nsIPushNotifier
.
h
"
#
include
"
nsCycleCollectionParticipant
.
h
"
#
include
"
nsIPrincipal
.
h
"
#
include
"
nsString
.
h
"
#
include
"
nsTArray
.
h
"
#
include
"
mozilla
/
Maybe
.
h
"
#
define
PUSHNOTIFIER_CONTRACTID
\
"
mozilla
.
org
/
push
/
Notifier
;
1
"
namespace
mozilla
{
namespace
dom
{
class
PushNotifier
final
:
public
nsIPushNotifier
{
public
:
PushNotifier
(
)
;
NS_DECL_CYCLE_COLLECTING_ISUPPORTS
NS_DECL_CYCLE_COLLECTION_CLASS_AMBIGUOUS
(
PushNotifier
nsIPushNotifier
)
NS_DECL_NSIPUSHNOTIFIER
nsresult
NotifyPush
(
const
nsACString
&
aScope
nsIPrincipal
*
aPrincipal
Maybe
<
nsTArray
<
uint8_t
>
>
aData
)
;
nsresult
NotifyPushWorkers
(
const
nsACString
&
aScope
nsIPrincipal
*
aPrincipal
Maybe
<
nsTArray
<
uint8_t
>
>
aData
)
;
nsresult
NotifySubscriptionChangeWorkers
(
const
nsACString
&
aScope
nsIPrincipal
*
aPrincipal
)
;
protected
:
virtual
~
PushNotifier
(
)
;
private
:
nsresult
NotifyPushObservers
(
const
nsACString
&
aScope
Maybe
<
nsTArray
<
uint8_t
>
>
aData
)
;
nsresult
NotifySubscriptionChangeObservers
(
const
nsACString
&
aScope
)
;
bool
ShouldNotifyObservers
(
nsIPrincipal
*
aPrincipal
)
;
bool
ShouldNotifyWorkers
(
nsIPrincipal
*
aPrincipal
)
;
}
;
class
PushMessage
final
:
public
nsIPushMessage
{
public
:
explicit
PushMessage
(
const
nsTArray
<
uint8_t
>
&
aData
)
;
NS_DECL_CYCLE_COLLECTING_ISUPPORTS
NS_DECL_CYCLE_COLLECTION_CLASS_AMBIGUOUS
(
PushMessage
nsIPushMessage
)
NS_DECL_NSIPUSHMESSAGE
protected
:
virtual
~
PushMessage
(
)
;
private
:
nsresult
EnsureDecodedText
(
)
;
nsTArray
<
uint8_t
>
mData
;
nsString
mDecodedText
;
}
;
}
}
#
endif
