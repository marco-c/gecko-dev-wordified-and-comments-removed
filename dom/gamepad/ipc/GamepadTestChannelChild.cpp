#
include
"
GamepadTestChannelChild
.
h
"
namespace
mozilla
:
:
dom
{
already_AddRefed
<
GamepadTestChannelChild
>
GamepadTestChannelChild
:
:
Create
(
)
{
return
RefPtr
<
GamepadTestChannelChild
>
(
new
GamepadTestChannelChild
(
)
)
.
forget
(
)
;
}
void
GamepadTestChannelChild
:
:
AddPromise
(
const
uint32_t
&
aID
Promise
*
aPromise
)
{
MOZ_ASSERT
(
!
mPromiseList
.
Get
(
aID
nullptr
)
)
;
mPromiseList
.
Put
(
aID
RefPtr
{
aPromise
}
)
;
}
mozilla
:
:
ipc
:
:
IPCResult
GamepadTestChannelChild
:
:
RecvReplyGamepadIndex
(
const
uint32_t
&
aID
const
uint32_t
&
aIndex
)
{
RefPtr
<
Promise
>
p
;
if
(
!
mPromiseList
.
Get
(
aID
getter_AddRefs
(
p
)
)
)
{
MOZ_CRASH
(
"
We
should
always
have
a
promise
.
"
)
;
}
p
-
>
MaybeResolve
(
aIndex
)
;
mPromiseList
.
Remove
(
aID
)
;
return
IPC_OK
(
)
;
}
}
