#
include
"
GamepadEventChannelChild
.
h
"
#
include
"
mozilla
/
dom
/
GamepadManager
.
h
"
namespace
mozilla
{
namespace
dom
{
namespace
{
class
GamepadUpdateRunnable
final
:
public
Runnable
{
public
:
explicit
GamepadUpdateRunnable
(
const
GamepadChangeEvent
&
aGamepadEvent
)
:
mEvent
(
aGamepadEvent
)
{
}
NS_IMETHOD
Run
(
)
override
{
RefPtr
<
GamepadManager
>
svc
(
GamepadManager
:
:
GetService
(
)
)
;
if
(
svc
)
{
svc
-
>
Update
(
mEvent
)
;
}
return
NS_OK
;
}
protected
:
GamepadChangeEvent
mEvent
;
}
;
}
bool
GamepadEventChannelChild
:
:
RecvGamepadUpdate
(
const
GamepadChangeEvent
&
aGamepadEvent
)
{
DebugOnly
<
nsresult
>
rv
=
NS_DispatchToMainThread
(
new
GamepadUpdateRunnable
(
aGamepadEvent
)
)
;
NS_WARNING_ASSERTION
(
NS_SUCCEEDED
(
rv
)
"
NS_DispatchToMainThread
failed
"
)
;
return
true
;
}
}
}
