#
ifndef
mozilla_dom_IdentityCredential_h
#
define
mozilla_dom_IdentityCredential_h
#
include
"
mozilla
/
dom
/
CanonicalBrowsingContext
.
h
"
#
include
"
mozilla
/
dom
/
Credential
.
h
"
#
include
"
mozilla
/
dom
/
IPCIdentityCredential
.
h
"
#
include
"
mozilla
/
MozPromise
.
h
"
#
include
"
mozilla
/
Tuple
.
h
"
namespace
mozilla
:
:
dom
{
class
IdentityCredential
final
:
public
Credential
{
public
:
typedef
MozPromise
<
RefPtr
<
IdentityCredential
>
nsresult
true
>
GetIdentityCredentialPromise
;
typedef
MozPromise
<
IPCIdentityCredential
nsresult
true
>
GetIPCIdentityCredentialPromise
;
typedef
MozPromise
<
IdentityProvider
nsresult
true
>
GetIdentityProviderPromise
;
typedef
MozPromise
<
bool
nsresult
true
>
ValidationPromise
;
typedef
MozPromise
<
IdentityInternalManifest
nsresult
true
>
GetManifestPromise
;
typedef
Tuple
<
IdentityProvider
IdentityInternalManifest
>
IdentityProviderWithManifest
;
typedef
MozPromise
<
IdentityProviderWithManifest
nsresult
true
>
GetIdentityProviderWithManifestPromise
;
typedef
MozPromise
<
Tuple
<
IdentityInternalManifest
IdentityAccountList
>
nsresult
true
>
GetAccountListPromise
;
typedef
MozPromise
<
Tuple
<
IdentityProviderToken
IdentityAccount
>
nsresult
true
>
GetTokenPromise
;
typedef
MozPromise
<
Tuple
<
IdentityInternalManifest
IdentityAccount
>
nsresult
true
>
GetAccountPromise
;
typedef
MozPromise
<
IdentityClientMetadata
nsresult
true
>
GetMetadataPromise
;
explicit
IdentityCredential
(
nsPIDOMWindowInner
*
aParent
)
;
protected
:
~
IdentityCredential
(
)
override
;
public
:
virtual
JSObject
*
WrapObject
(
JSContext
*
aCx
JS
:
:
Handle
<
JSObject
*
>
aGivenProto
)
override
;
void
CopyValuesFrom
(
const
IPCIdentityCredential
&
aOther
)
;
IPCIdentityCredential
MakeIPCIdentityCredential
(
)
;
void
GetToken
(
nsAString
&
aToken
)
const
;
void
SetToken
(
const
nsAString
&
aToken
)
;
static
already_AddRefed
<
Promise
>
LogoutRPs
(
GlobalObject
&
aGlobal
const
Sequence
<
IdentityCredentialLogoutRPsRequest
>
&
aLogoutRequests
ErrorResult
&
aRv
)
;
static
RefPtr
<
GetIdentityCredentialPromise
>
DiscoverFromExternalSource
(
nsPIDOMWindowInner
*
aParent
const
CredentialRequestOptions
&
aOptions
bool
aSameOriginWithAncestors
)
;
static
RefPtr
<
GetIPCIdentityCredentialPromise
>
DiscoverFromExternalSourceInMainProcess
(
nsIPrincipal
*
aPrincipal
CanonicalBrowsingContext
*
aBrowsingContext
const
IdentityCredentialRequestOptions
&
aOptions
)
;
static
RefPtr
<
GetIPCIdentityCredentialPromise
>
CreateCredential
(
nsIPrincipal
*
aPrincipal
BrowsingContext
*
aBrowsingContext
const
IdentityProvider
&
aProvider
const
IdentityInternalManifest
&
aManifest
)
;
static
RefPtr
<
ValidationPromise
>
CheckRootManifest
(
nsIPrincipal
*
aPrincipal
const
IdentityProvider
&
aProvider
)
;
static
RefPtr
<
GetManifestPromise
>
FetchInternalManifest
(
nsIPrincipal
*
aPrincipal
const
IdentityProvider
&
aProvider
)
;
static
RefPtr
<
GetAccountListPromise
>
FetchAccountList
(
nsIPrincipal
*
aPrincipal
const
IdentityProvider
&
aProvider
const
IdentityInternalManifest
&
aManifest
)
;
static
RefPtr
<
GetTokenPromise
>
FetchToken
(
nsIPrincipal
*
aPrincipal
const
IdentityProvider
&
aProvider
const
IdentityInternalManifest
&
aManifest
const
IdentityAccount
&
aAccount
)
;
static
RefPtr
<
GetMetadataPromise
>
FetchMetadata
(
nsIPrincipal
*
aPrincipal
const
IdentityProvider
&
aProvider
const
IdentityInternalManifest
&
aManifest
)
;
static
RefPtr
<
GetIdentityProviderWithManifestPromise
>
PromptUserToSelectProvider
(
BrowsingContext
*
aBrowsingContext
const
Sequence
<
IdentityProvider
>
&
aProviders
const
Sequence
<
GetManifestPromise
:
:
ResolveOrRejectValue
>
&
aManifests
)
;
static
RefPtr
<
GetAccountPromise
>
PromptUserToSelectAccount
(
BrowsingContext
*
aBrowsingContext
const
IdentityAccountList
&
aAccounts
const
IdentityProvider
&
aProvider
const
IdentityInternalManifest
&
aManifest
)
;
static
RefPtr
<
GetAccountPromise
>
PromptUserWithPolicy
(
BrowsingContext
*
aBrowsingContext
nsIPrincipal
*
aPrincipal
const
IdentityAccount
&
aAccount
const
IdentityInternalManifest
&
aManifest
const
IdentityProvider
&
aProvider
)
;
static
void
CloseUserInterface
(
BrowsingContext
*
aBrowsingContext
)
;
private
:
nsAutoString
mToken
;
}
;
}
#
endif
