#
include
"
SDBResults
.
h
"
#
include
<
cstdint
>
#
include
<
cstring
>
#
include
<
new
>
#
include
<
utility
>
#
include
"
ErrorList
.
h
"
#
include
"
js
/
RootingAPI
.
h
"
#
include
"
js
/
TypeDecls
.
h
"
#
include
"
mozilla
/
Assertions
.
h
"
#
include
"
mozilla
/
MacroForEach
.
h
"
#
include
"
mozilla
/
dom
/
TypedArray
.
h
"
#
include
"
nsDebug
.
h
"
#
include
"
nsError
.
h
"
#
include
"
nsTArray
.
h
"
#
include
"
nscore
.
h
"
namespace
mozilla
:
:
dom
{
SDBResult
:
:
SDBResult
(
const
nsACString
&
aData
)
:
mData
(
aData
)
{
}
NS_IMPL_ISUPPORTS
(
SDBResult
nsISDBResult
)
NS_IMETHODIMP
SDBResult
:
:
GetAsArray
(
nsTArray
<
uint8_t
>
&
aData
)
{
uint32_t
length
=
mData
.
Length
(
)
;
aData
.
SetLength
(
length
)
;
if
(
length
!
=
0
)
{
memcpy
(
aData
.
Elements
(
)
mData
.
BeginReading
(
)
length
*
sizeof
(
uint8_t
)
)
;
}
return
NS_OK
;
}
NS_IMETHODIMP
SDBResult
:
:
GetAsArrayBuffer
(
JSContext
*
aCx
JS
:
:
MutableHandle
<
JS
:
:
Value
>
_retval
)
{
ErrorResult
rv
;
JS
:
:
Rooted
<
JSObject
*
>
arrayBuffer
(
aCx
ArrayBuffer
:
:
Create
(
aCx
mData
rv
)
)
;
ENSURE_SUCCESS
(
rv
rv
.
StealNSResult
(
)
)
;
_retval
.
setObject
(
*
arrayBuffer
)
;
return
NS_OK
;
}
}
