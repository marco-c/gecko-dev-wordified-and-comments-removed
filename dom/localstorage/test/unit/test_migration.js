var
testGenerator
=
testSteps
(
)
;
function
*
testSteps
(
)
{
const
principalInfos
=
[
{
url
:
"
http
:
/
/
localhost
"
attrs
:
{
}
}
{
url
:
"
http
:
/
/
www
.
mozilla
.
org
"
attrs
:
{
}
}
{
url
:
"
http
:
/
/
example
.
com
"
attrs
:
{
}
}
{
url
:
"
http
:
/
/
example
.
org
"
attrs
:
{
userContextId
:
5
}
}
]
;
const
data
=
{
key
:
"
foo
"
value
:
"
bar
"
}
;
info
(
"
Setting
pref
"
)
;
Services
.
prefs
.
setBoolPref
(
"
dom
.
storage
.
next_gen
"
true
)
;
info
(
"
Clearing
"
)
;
clear
(
continueToNextStepSync
)
;
yield
undefined
;
info
(
"
Installing
package
"
)
;
installPackage
(
"
migration_profile
"
)
;
info
(
"
Getting
storages
"
)
;
let
storages
=
[
]
;
for
(
let
i
=
0
;
i
<
principalInfos
.
length
;
i
+
+
)
{
let
principalInfo
=
principalInfos
[
i
]
;
let
principal
=
getPrincipal
(
principalInfo
.
url
principalInfo
.
attrs
)
;
let
storage
=
getLocalStorage
(
principal
)
;
storages
.
push
(
storage
)
;
}
info
(
"
Verifying
data
"
)
;
for
(
let
i
=
0
;
i
<
storages
.
length
;
i
+
+
)
{
let
value
=
storages
[
i
]
.
getItem
(
data
.
key
+
i
)
;
is
(
value
data
.
value
+
i
"
Correct
value
"
)
;
}
finishTest
(
)
;
}
