add_task
(
async
function
testSteps
(
)
{
const
origins
=
[
{
uri
:
"
file
:
/
/
/
test
'
.
html
"
path
:
"
storage
/
default
/
file
+
+
+
+
test
'
.
html
"
}
{
uri
:
"
file
:
/
/
/
test
>
.
html
"
path
:
"
storage
/
default
/
file
+
+
+
+
test
%
3E
.
html
"
}
]
;
info
(
"
Setting
prefs
"
)
;
Services
.
prefs
.
setBoolPref
(
"
dom
.
storage
.
enable_unsupported_legacy_implementation
"
false
)
;
for
(
let
origin
of
origins
)
{
const
principal
=
getPrincipal
(
origin
.
uri
)
;
let
originDir
=
getRelativeFile
(
origin
.
path
)
;
info
(
"
Checking
the
origin
directory
existence
"
)
;
ok
(
!
originDir
.
exists
(
)
The
origin
directory
{
origin
.
path
}
should
not
exists
)
;
info
(
"
Getting
storage
"
)
;
let
storage
=
getLocalStorage
(
principal
)
;
info
(
"
Adding
item
"
)
;
storage
.
setItem
(
"
foo
"
"
bar
"
)
;
info
(
"
Resetting
origin
"
)
;
let
request
=
resetOrigin
(
principal
)
;
await
requestFinished
(
request
)
;
info
(
"
Checking
the
origin
directory
existence
"
)
;
ok
(
originDir
.
exists
(
)
The
origin
directory
{
origin
.
path
}
should
exist
)
;
}
}
)
;
