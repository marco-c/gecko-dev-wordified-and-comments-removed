#
ifndef
mozilla_dom_localstorage_LocalStorageCommon_h
#
define
mozilla_dom_localstorage_LocalStorageCommon_h
#
include
"
mozilla
/
Attributes
.
h
"
#
include
"
mozilla
/
dom
/
quota
/
QuotaCommon
.
h
"
#
include
"
nsString
.
h
"
#
define
LS_TRY_GLUE
(
.
.
.
)
\
QM_TRY_META
(
mozilla
:
:
dom
:
:
localstorage
MOZ_UNIQUE_VAR
(
tryResult
)
\
#
#
__VA_ARGS__
)
#
define
LS_TRY
(
.
.
.
)
LS_TRY_GLUE
(
__VA_ARGS__
)
#
ifdef
DEBUG
#
define
LS_DEBUG_TRY
(
.
.
.
)
LS_TRY
(
__VA_ARGS__
)
#
else
#
define
LS_DEBUG_TRY
(
.
.
.
)
#
endif
#
define
LS_TRY_VAR_GLUE
(
.
.
.
)
\
QM_TRY_VAR_META
(
mozilla
:
:
dom
:
:
localstorage
MOZ_UNIQUE_VAR
(
tryResult
)
\
#
#
__VA_ARGS__
)
#
define
LS_TRY_VAR
(
.
.
.
)
LS_TRY_VAR_GLUE
(
__VA_ARGS__
)
#
ifdef
DEBUG
#
define
LS_DEBUG_TRY_VAR
(
.
.
.
)
LS_TRY_VAR
(
__VA_ARGS__
)
#
else
#
define
LS_DEBUG_TRY_VAR
(
.
.
.
)
#
endif
#
define
LS_FAIL_GLUE
(
.
.
.
)
\
QM_FAIL_META
(
mozilla
:
:
dom
:
:
localstorage
#
#
__VA_ARGS__
)
#
define
LS_FAIL
(
.
.
.
)
LS_FAIL_GLUE
(
__VA_ARGS__
)
#
ifdef
DEBUG
#
define
LS_DEBUG_FAIL
(
.
.
.
)
LS_FAIL
(
__VA_ARGS__
)
#
else
#
define
LS_DEBUG_FAIL
(
.
.
.
)
#
endif
namespace
mozilla
{
class
LogModule
;
namespace
ipc
{
class
PrincipalInfo
;
}
namespace
dom
{
extern
const
char16_t
*
kLocalStorageType
;
class
MOZ_STACK_CLASS
LSNotifyInfo
{
bool
mChanged
;
nsString
mOldValue
;
public
:
LSNotifyInfo
(
)
:
mChanged
(
false
)
{
}
bool
changed
(
)
const
{
return
mChanged
;
}
bool
&
changed
(
)
{
return
mChanged
;
}
const
nsString
&
oldValue
(
)
const
{
return
mOldValue
;
}
nsString
&
oldValue
(
)
{
return
mOldValue
;
}
}
;
bool
NextGenLocalStorageEnabled
(
)
;
bool
CachedNextGenLocalStorageEnabled
(
)
;
nsresult
GenerateOriginKey2
(
const
mozilla
:
:
ipc
:
:
PrincipalInfo
&
aPrincipalInfo
nsACString
&
aOriginAttrSuffix
nsACString
&
aOriginKey
)
;
LogModule
*
GetLocalStorageLogger
(
)
;
namespace
localstorage
{
MOZ_NEVER_INLINE
void
HandleError
(
const
nsLiteralCString
&
aExpr
const
nsLiteralCString
&
aSourceFile
int32_t
aSourceLine
)
;
}
}
}
#
endif
