#
include
"
gtest
/
gtest
.
h
"
#
include
"
mozilla
/
dom
/
ReportingHeader
.
h
"
#
include
"
nsIURI
.
h
"
#
include
"
nsNetUtil
.
h
"
using
namespace
mozilla
;
using
namespace
mozilla
:
:
dom
;
TEST
(
ReportToParser
Basic
)
{
nsCOMPtr
<
nsIURI
>
uri
;
nsresult
rv
=
NS_NewURI
(
getter_AddRefs
(
uri
)
"
https
:
/
/
example
.
com
"
)
;
ASSERT_EQ
(
NS_OK
rv
)
;
bool
urlEqual
=
false
;
UniquePtr
<
ReportingHeader
:
:
Client
>
client
=
ReportingHeader
:
:
ParseReportToHeader
(
nullptr
uri
"
"
_ns
)
;
ASSERT_TRUE
(
!
client
)
;
client
=
ReportingHeader
:
:
ParseReportToHeader
(
nullptr
uri
"
"
_ns
)
;
ASSERT_TRUE
(
!
client
)
;
client
=
ReportingHeader
:
:
ParseReportToHeader
(
nullptr
uri
"
{
}
"
_ns
)
;
ASSERT_TRUE
(
!
client
)
;
client
=
ReportingHeader
:
:
ParseReportToHeader
(
nullptr
uri
nsLiteralCString
(
"
{
\
"
max_age
\
"
:
42
\
"
endpoints
\
"
:
[
{
\
"
url
\
"
:
"
"
\
"
https
:
/
/
example
.
com
\
"
\
"
priority
\
"
:
1
\
"
weight
\
"
:
2
}
]
}
"
)
)
;
ASSERT_TRUE
(
!
!
client
)
;
ASSERT_EQ
(
(
uint32_t
)
1
client
-
>
mGroups
.
Length
(
)
)
;
ASSERT_TRUE
(
client
-
>
mGroups
.
ElementAt
(
0
)
.
mName
.
EqualsLiteral
(
"
default
"
)
)
;
ASSERT_FALSE
(
client
-
>
mGroups
.
ElementAt
(
0
)
.
mIncludeSubdomains
)
;
ASSERT_EQ
(
42
client
-
>
mGroups
.
ElementAt
(
0
)
.
mTTL
)
;
ASSERT_EQ
(
(
uint32_t
)
1
client
-
>
mGroups
.
ElementAt
(
0
)
.
mEndpoints
.
Length
(
)
)
;
ASSERT_TRUE
(
NS_SUCCEEDED
(
client
-
>
mGroups
.
ElementAt
(
0
)
.
mEndpoints
.
ElementAt
(
0
)
.
mUrl
-
>
Equals
(
uri
&
urlEqual
)
)
&
&
urlEqual
)
;
ASSERT_EQ
(
(
uint32_t
)
1
client
-
>
mGroups
.
ElementAt
(
0
)
.
mEndpoints
.
ElementAt
(
0
)
.
mPriority
)
;
ASSERT_EQ
(
(
uint32_t
)
2
client
-
>
mGroups
.
ElementAt
(
0
)
.
mEndpoints
.
ElementAt
(
0
)
.
mWeight
)
;
client
=
ReportingHeader
:
:
ParseReportToHeader
(
nullptr
uri
nsLiteralCString
(
"
{
\
"
max_age
\
"
:
43
\
"
endpoints
\
"
:
[
{
\
"
url
\
"
:
"
"
\
"
https
:
/
/
example
.
com
\
"
\
"
priority
\
"
:
1
\
"
weight
\
"
:
2
}
]
}
"
"
{
\
"
max_age
\
"
:
44
\
"
endpoints
\
"
:
[
{
\
"
url
\
"
:
"
"
\
"
https
:
/
/
example
.
com
\
"
\
"
priority
\
"
:
1
\
"
weight
\
"
:
2
}
]
}
"
)
)
;
ASSERT_TRUE
(
!
!
client
)
;
ASSERT_EQ
(
(
uint32_t
)
1
client
-
>
mGroups
.
Length
(
)
)
;
ASSERT_TRUE
(
client
-
>
mGroups
.
ElementAt
(
0
)
.
mName
.
EqualsLiteral
(
"
default
"
)
)
;
ASSERT_EQ
(
43
client
-
>
mGroups
.
ElementAt
(
0
)
.
mTTL
)
;
client
=
ReportingHeader
:
:
ParseReportToHeader
(
nullptr
uri
nsLiteralCString
(
"
{
\
"
max_age
\
"
:
43
\
"
group
\
"
:
123
\
"
endpoints
\
"
:
[
{
\
"
url
\
"
:
"
"
\
"
https
:
/
/
example
.
com
\
"
\
"
priority
\
"
:
1
\
"
weight
\
"
:
2
}
]
}
"
"
{
\
"
max_age
\
"
:
44
\
"
endpoints
\
"
:
[
{
\
"
url
\
"
:
"
"
\
"
https
:
/
/
example
.
com
\
"
\
"
priority
\
"
:
1
\
"
weight
\
"
:
2
}
]
}
"
)
)
;
ASSERT_TRUE
(
!
!
client
)
;
ASSERT_EQ
(
(
uint32_t
)
1
client
-
>
mGroups
.
Length
(
)
)
;
ASSERT_TRUE
(
client
-
>
mGroups
.
ElementAt
(
0
)
.
mName
.
EqualsLiteral
(
"
default
"
)
)
;
ASSERT_EQ
(
44
client
-
>
mGroups
.
ElementAt
(
0
)
.
mTTL
)
;
client
=
ReportingHeader
:
:
ParseReportToHeader
(
nullptr
uri
nsLiteralCString
(
"
{
\
"
max_age
\
"
:
43
\
"
group
\
"
:
null
\
"
endpoints
\
"
:
[
{
\
"
url
\
"
:
"
"
\
"
https
:
/
/
example
.
com
\
"
\
"
priority
\
"
:
1
\
"
weight
\
"
:
2
}
]
}
"
"
{
\
"
max_age
\
"
:
44
\
"
endpoints
\
"
:
[
{
\
"
url
\
"
:
"
"
\
"
https
:
/
/
example
.
com
\
"
\
"
priority
\
"
:
1
\
"
weight
\
"
:
2
}
]
}
"
)
)
;
ASSERT_TRUE
(
!
!
client
)
;
ASSERT_EQ
(
(
uint32_t
)
1
client
-
>
mGroups
.
Length
(
)
)
;
ASSERT_TRUE
(
client
-
>
mGroups
.
ElementAt
(
0
)
.
mName
.
EqualsLiteral
(
"
default
"
)
)
;
ASSERT_EQ
(
44
client
-
>
mGroups
.
ElementAt
(
0
)
.
mTTL
)
;
client
=
ReportingHeader
:
:
ParseReportToHeader
(
nullptr
uri
nsLiteralCString
(
"
{
\
"
max_age
\
"
:
43
\
"
group
\
"
:
{
}
\
"
endpoints
\
"
:
[
{
\
"
url
\
"
:
"
"
\
"
https
:
/
/
example
.
com
\
"
\
"
priority
\
"
:
1
\
"
weight
\
"
:
2
}
]
}
"
"
{
\
"
max_age
\
"
:
44
\
"
endpoints
\
"
:
[
{
\
"
url
\
"
:
"
"
\
"
https
:
/
/
example
.
com
\
"
\
"
priority
\
"
:
1
\
"
weight
\
"
:
2
}
]
}
"
)
)
;
ASSERT_TRUE
(
!
!
client
)
;
ASSERT_EQ
(
(
uint32_t
)
1
client
-
>
mGroups
.
Length
(
)
)
;
ASSERT_TRUE
(
client
-
>
mGroups
.
ElementAt
(
0
)
.
mName
.
EqualsLiteral
(
"
default
"
)
)
;
ASSERT_EQ
(
44
client
-
>
mGroups
.
ElementAt
(
0
)
.
mTTL
)
;
client
=
ReportingHeader
:
:
ParseReportToHeader
(
nullptr
uri
nsLiteralCString
(
"
{
\
"
max_age
\
"
:
45
\
"
group
\
"
:
\
"
foobar
\
"
\
"
include_subdomains
\
"
:
"
"
true
\
"
endpoints
\
"
:
[
{
\
"
url
\
"
:
\
"
https
:
/
/
example
.
com
\
"
"
"
\
"
priority
\
"
:
1
\
"
weight
\
"
:
2
}
]
}
"
)
)
;
ASSERT_TRUE
(
!
!
client
)
;
ASSERT_EQ
(
(
uint32_t
)
1
client
-
>
mGroups
.
Length
(
)
)
;
ASSERT_TRUE
(
client
-
>
mGroups
.
ElementAt
(
0
)
.
mName
.
EqualsLiteral
(
"
foobar
"
)
)
;
ASSERT_TRUE
(
client
-
>
mGroups
.
ElementAt
(
0
)
.
mIncludeSubdomains
)
;
ASSERT_EQ
(
45
client
-
>
mGroups
.
ElementAt
(
0
)
.
mTTL
)
;
client
=
ReportingHeader
:
:
ParseReportToHeader
(
nullptr
uri
nsLiteralCString
(
"
{
\
"
endpoints
\
"
:
[
{
\
"
url
\
"
:
\
"
https
:
/
/
example
.
com
\
"
\
"
priority
\
"
:
"
"
1
\
"
weight
\
"
:
2
}
]
}
"
"
{
\
"
max_age
\
"
:
46
\
"
endpoints
\
"
:
[
{
\
"
url
\
"
:
"
"
\
"
https
:
/
/
example
.
com
\
"
\
"
priority
\
"
:
1
\
"
weight
\
"
:
2
}
]
}
"
)
)
;
ASSERT_TRUE
(
!
!
client
)
;
ASSERT_EQ
(
(
uint32_t
)
1
client
-
>
mGroups
.
Length
(
)
)
;
ASSERT_EQ
(
46
client
-
>
mGroups
.
ElementAt
(
0
)
.
mTTL
)
;
client
=
ReportingHeader
:
:
ParseReportToHeader
(
nullptr
uri
nsLiteralCString
(
"
{
\
"
max_age
\
"
:
null
\
"
endpoints
\
"
:
[
{
\
"
url
\
"
:
"
"
\
"
https
:
/
/
example
.
com
\
"
\
"
priority
\
"
:
1
\
"
weight
\
"
:
2
}
]
}
"
"
{
\
"
max_age
\
"
:
46
\
"
endpoints
\
"
:
[
{
\
"
url
\
"
:
"
"
\
"
https
:
/
/
example
.
com
\
"
\
"
priority
\
"
:
1
\
"
weight
\
"
:
2
}
]
}
"
)
)
;
ASSERT_TRUE
(
!
!
client
)
;
ASSERT_EQ
(
(
uint32_t
)
1
client
-
>
mGroups
.
Length
(
)
)
;
ASSERT_EQ
(
46
client
-
>
mGroups
.
ElementAt
(
0
)
.
mTTL
)
;
client
=
ReportingHeader
:
:
ParseReportToHeader
(
nullptr
uri
nsLiteralCString
(
"
{
\
"
max_age
\
"
:
\
"
foobar
\
"
\
"
endpoints
\
"
:
[
{
\
"
url
\
"
:
"
"
\
"
https
:
/
/
example
.
com
\
"
\
"
priority
\
"
:
1
\
"
weight
\
"
:
2
}
]
}
"
"
{
\
"
max_age
\
"
:
46
\
"
endpoints
\
"
:
[
{
\
"
url
\
"
:
"
"
\
"
https
:
/
/
example
.
com
\
"
\
"
priority
\
"
:
1
\
"
weight
\
"
:
2
}
]
}
"
)
)
;
ASSERT_TRUE
(
!
!
client
)
;
ASSERT_EQ
(
(
uint32_t
)
1
client
-
>
mGroups
.
Length
(
)
)
;
ASSERT_EQ
(
46
client
-
>
mGroups
.
ElementAt
(
0
)
.
mTTL
)
;
client
=
ReportingHeader
:
:
ParseReportToHeader
(
nullptr
uri
nsLiteralCString
(
"
{
\
"
max_age
\
"
:
{
}
\
"
endpoints
\
"
:
[
{
\
"
url
\
"
:
"
"
\
"
https
:
/
/
example
.
com
\
"
\
"
priority
\
"
:
1
\
"
weight
\
"
:
2
}
]
}
"
"
{
\
"
max_age
\
"
:
46
\
"
endpoints
\
"
:
[
{
\
"
url
\
"
:
"
"
\
"
https
:
/
/
example
.
com
\
"
\
"
priority
\
"
:
1
\
"
weight
\
"
:
2
}
]
}
"
)
)
;
ASSERT_TRUE
(
!
!
client
)
;
ASSERT_EQ
(
(
uint32_t
)
1
client
-
>
mGroups
.
Length
(
)
)
;
ASSERT_EQ
(
46
client
-
>
mGroups
.
ElementAt
(
0
)
.
mTTL
)
;
client
=
ReportingHeader
:
:
ParseReportToHeader
(
nullptr
uri
nsLiteralCString
(
"
{
\
"
max_age
\
"
:
47
}
"
"
{
\
"
max_age
\
"
:
48
\
"
endpoints
\
"
:
[
{
\
"
url
\
"
:
"
"
\
"
https
:
/
/
example
.
com
\
"
\
"
priority
\
"
:
1
\
"
weight
\
"
:
2
}
]
}
"
)
)
;
ASSERT_TRUE
(
!
!
client
)
;
ASSERT_EQ
(
(
uint32_t
)
1
client
-
>
mGroups
.
Length
(
)
)
;
ASSERT_EQ
(
48
client
-
>
mGroups
.
ElementAt
(
0
)
.
mTTL
)
;
client
=
ReportingHeader
:
:
ParseReportToHeader
(
nullptr
uri
nsLiteralCString
(
"
{
\
"
max_age
\
"
:
47
\
"
endpoints
\
"
:
null
}
"
"
{
\
"
max_age
\
"
:
48
\
"
endpoints
\
"
:
[
{
\
"
url
\
"
:
"
"
\
"
https
:
/
/
example
.
com
\
"
\
"
priority
\
"
:
1
\
"
weight
\
"
:
2
}
]
}
"
)
)
;
ASSERT_TRUE
(
!
!
client
)
;
ASSERT_EQ
(
(
uint32_t
)
1
client
-
>
mGroups
.
Length
(
)
)
;
ASSERT_EQ
(
48
client
-
>
mGroups
.
ElementAt
(
0
)
.
mTTL
)
;
client
=
ReportingHeader
:
:
ParseReportToHeader
(
nullptr
uri
nsLiteralCString
(
"
{
\
"
max_age
\
"
:
47
\
"
endpoints
\
"
:
\
"
abc
\
"
}
"
"
{
\
"
max_age
\
"
:
48
\
"
endpoints
\
"
:
[
{
\
"
url
\
"
:
"
"
\
"
https
:
/
/
example
.
com
\
"
\
"
priority
\
"
:
1
\
"
weight
\
"
:
2
}
]
}
"
)
)
;
ASSERT_TRUE
(
!
!
client
)
;
ASSERT_EQ
(
(
uint32_t
)
1
client
-
>
mGroups
.
Length
(
)
)
;
ASSERT_EQ
(
48
client
-
>
mGroups
.
ElementAt
(
0
)
.
mTTL
)
;
client
=
ReportingHeader
:
:
ParseReportToHeader
(
nullptr
uri
nsLiteralCString
(
"
{
\
"
max_age
\
"
:
47
\
"
endpoints
\
"
:
42
}
"
"
{
\
"
max_age
\
"
:
48
\
"
endpoints
\
"
:
[
{
\
"
url
\
"
:
"
"
\
"
https
:
/
/
example
.
com
\
"
\
"
priority
\
"
:
1
\
"
weight
\
"
:
2
}
]
}
"
)
)
;
ASSERT_TRUE
(
!
!
client
)
;
ASSERT_EQ
(
(
uint32_t
)
1
client
-
>
mGroups
.
Length
(
)
)
;
ASSERT_EQ
(
48
client
-
>
mGroups
.
ElementAt
(
0
)
.
mTTL
)
;
client
=
ReportingHeader
:
:
ParseReportToHeader
(
nullptr
uri
nsLiteralCString
(
"
{
\
"
max_age
\
"
:
47
\
"
endpoints
\
"
:
{
}
}
"
"
{
\
"
max_age
\
"
:
48
\
"
endpoints
\
"
:
[
{
\
"
url
\
"
:
"
"
\
"
https
:
/
/
example
.
com
\
"
\
"
priority
\
"
:
1
\
"
weight
\
"
:
2
}
]
}
"
)
)
;
ASSERT_TRUE
(
!
!
client
)
;
ASSERT_EQ
(
(
uint32_t
)
1
client
-
>
mGroups
.
Length
(
)
)
;
ASSERT_EQ
(
48
client
-
>
mGroups
.
ElementAt
(
0
)
.
mTTL
)
;
client
=
ReportingHeader
:
:
ParseReportToHeader
(
nullptr
uri
nsLiteralCString
(
"
{
\
"
max_age
\
"
:
49
\
"
endpoints
\
"
:
[
]
}
"
"
{
\
"
max_age
\
"
:
50
\
"
endpoints
\
"
:
[
{
\
"
url
\
"
:
"
"
\
"
https
:
/
/
example
.
com
\
"
\
"
priority
\
"
:
1
\
"
weight
\
"
:
2
}
]
}
"
)
)
;
ASSERT_TRUE
(
!
!
client
)
;
ASSERT_EQ
(
(
uint32_t
)
1
client
-
>
mGroups
.
Length
(
)
)
;
ASSERT_EQ
(
50
client
-
>
mGroups
.
ElementAt
(
0
)
.
mTTL
)
;
client
=
ReportingHeader
:
:
ParseReportToHeader
(
nullptr
uri
nsLiteralCString
(
"
{
\
"
max_age
\
"
:
51
\
"
endpoints
\
"
:
[
"
"
{
\
"
priority
\
"
:
1
\
"
weight
\
"
:
2
}
"
"
{
\
"
url
\
"
:
\
"
https
:
/
/
example
.
com
\
"
\
"
priority
\
"
:
1
"
"
\
"
weight
\
"
:
2
}
]
}
"
)
)
;
ASSERT_TRUE
(
!
!
client
)
;
ASSERT_EQ
(
(
uint32_t
)
1
client
-
>
mGroups
.
Length
(
)
)
;
ASSERT_EQ
(
(
uint32_t
)
1
client
-
>
mGroups
.
ElementAt
(
0
)
.
mEndpoints
.
Length
(
)
)
;
ASSERT_TRUE
(
NS_SUCCEEDED
(
client
-
>
mGroups
.
ElementAt
(
0
)
.
mEndpoints
.
ElementAt
(
0
)
.
mUrl
-
>
Equals
(
uri
&
urlEqual
)
)
&
&
urlEqual
)
;
ASSERT_EQ
(
(
uint32_t
)
1
client
-
>
mGroups
.
ElementAt
(
0
)
.
mEndpoints
.
ElementAt
(
0
)
.
mPriority
)
;
ASSERT_EQ
(
(
uint32_t
)
2
client
-
>
mGroups
.
ElementAt
(
0
)
.
mEndpoints
.
ElementAt
(
0
)
.
mWeight
)
;
client
=
ReportingHeader
:
:
ParseReportToHeader
(
nullptr
uri
nsLiteralCString
(
"
{
\
"
max_age
\
"
:
51
\
"
endpoints
\
"
:
[
"
"
{
\
"
url
\
"
:
42
\
"
priority
\
"
:
1
\
"
weight
\
"
:
2
}
"
"
{
\
"
url
\
"
:
\
"
https
:
/
/
example
.
com
\
"
\
"
priority
\
"
:
1
"
"
\
"
weight
\
"
:
2
}
]
}
"
)
)
;
ASSERT_TRUE
(
!
!
client
)
;
ASSERT_EQ
(
(
uint32_t
)
1
client
-
>
mGroups
.
Length
(
)
)
;
ASSERT_EQ
(
(
uint32_t
)
1
client
-
>
mGroups
.
ElementAt
(
0
)
.
mEndpoints
.
Length
(
)
)
;
ASSERT_TRUE
(
NS_SUCCEEDED
(
client
-
>
mGroups
.
ElementAt
(
0
)
.
mEndpoints
.
ElementAt
(
0
)
.
mUrl
-
>
Equals
(
uri
&
urlEqual
)
)
&
&
urlEqual
)
;
ASSERT_EQ
(
(
uint32_t
)
1
client
-
>
mGroups
.
ElementAt
(
0
)
.
mEndpoints
.
ElementAt
(
0
)
.
mPriority
)
;
ASSERT_EQ
(
(
uint32_t
)
2
client
-
>
mGroups
.
ElementAt
(
0
)
.
mEndpoints
.
ElementAt
(
0
)
.
mWeight
)
;
client
=
ReportingHeader
:
:
ParseReportToHeader
(
nullptr
uri
nsLiteralCString
(
"
{
\
"
max_age
\
"
:
51
\
"
endpoints
\
"
:
[
"
"
{
\
"
url
\
"
:
\
"
something
here
\
"
\
"
priority
\
"
:
1
\
"
weight
\
"
:
2
}
"
"
{
\
"
url
\
"
:
\
"
https
:
/
/
example
.
com
\
"
\
"
priority
\
"
:
1
\
"
weight
\
"
:
"
"
2
}
]
}
"
)
)
;
ASSERT_TRUE
(
!
!
client
)
;
ASSERT_EQ
(
(
uint32_t
)
1
client
-
>
mGroups
.
Length
(
)
)
;
ASSERT_EQ
(
(
uint32_t
)
1
client
-
>
mGroups
.
ElementAt
(
0
)
.
mEndpoints
.
Length
(
)
)
;
ASSERT_TRUE
(
NS_SUCCEEDED
(
client
-
>
mGroups
.
ElementAt
(
0
)
.
mEndpoints
.
ElementAt
(
0
)
.
mUrl
-
>
Equals
(
uri
&
urlEqual
)
)
&
&
urlEqual
)
;
ASSERT_EQ
(
(
uint32_t
)
1
client
-
>
mGroups
.
ElementAt
(
0
)
.
mEndpoints
.
ElementAt
(
0
)
.
mPriority
)
;
ASSERT_EQ
(
(
uint32_t
)
2
client
-
>
mGroups
.
ElementAt
(
0
)
.
mEndpoints
.
ElementAt
(
0
)
.
mWeight
)
;
client
=
ReportingHeader
:
:
ParseReportToHeader
(
nullptr
uri
nsLiteralCString
(
"
{
\
"
max_age
\
"
:
51
\
"
endpoints
\
"
:
[
"
"
{
\
"
url
\
"
:
{
}
\
"
priority
\
"
:
1
\
"
weight
\
"
:
2
}
"
"
{
\
"
url
\
"
:
\
"
https
:
/
/
example
.
com
\
"
\
"
priority
\
"
:
1
"
"
\
"
weight
\
"
:
2
}
]
}
"
)
)
;
ASSERT_TRUE
(
!
!
client
)
;
ASSERT_EQ
(
(
uint32_t
)
1
client
-
>
mGroups
.
Length
(
)
)
;
ASSERT_EQ
(
(
uint32_t
)
1
client
-
>
mGroups
.
ElementAt
(
0
)
.
mEndpoints
.
Length
(
)
)
;
ASSERT_TRUE
(
NS_SUCCEEDED
(
client
-
>
mGroups
.
ElementAt
(
0
)
.
mEndpoints
.
ElementAt
(
0
)
.
mUrl
-
>
Equals
(
uri
&
urlEqual
)
)
&
&
urlEqual
)
;
ASSERT_EQ
(
(
uint32_t
)
1
client
-
>
mGroups
.
ElementAt
(
0
)
.
mEndpoints
.
ElementAt
(
0
)
.
mPriority
)
;
ASSERT_EQ
(
(
uint32_t
)
2
client
-
>
mGroups
.
ElementAt
(
0
)
.
mEndpoints
.
ElementAt
(
0
)
.
mWeight
)
;
client
=
ReportingHeader
:
:
ParseReportToHeader
(
nullptr
uri
nsLiteralCString
(
"
{
\
"
max_age
\
"
:
52
\
"
endpoints
\
"
:
[
"
"
{
\
"
url
\
"
:
\
"
https
:
/
/
example
.
com
\
"
\
"
weight
\
"
:
3
}
]
}
"
)
)
;
ASSERT_TRUE
(
!
!
client
)
;
ASSERT_EQ
(
(
uint32_t
)
1
client
-
>
mGroups
.
Length
(
)
)
;
ASSERT_EQ
(
(
uint32_t
)
1
client
-
>
mGroups
.
ElementAt
(
0
)
.
mEndpoints
.
Length
(
)
)
;
ASSERT_TRUE
(
NS_SUCCEEDED
(
client
-
>
mGroups
.
ElementAt
(
0
)
.
mEndpoints
.
ElementAt
(
0
)
.
mUrl
-
>
Equals
(
uri
&
urlEqual
)
)
&
&
urlEqual
)
;
ASSERT_EQ
(
(
uint32_t
)
1
client
-
>
mGroups
.
ElementAt
(
0
)
.
mEndpoints
.
ElementAt
(
0
)
.
mPriority
)
;
ASSERT_EQ
(
(
uint32_t
)
3
client
-
>
mGroups
.
ElementAt
(
0
)
.
mEndpoints
.
ElementAt
(
0
)
.
mWeight
)
;
client
=
ReportingHeader
:
:
ParseReportToHeader
(
nullptr
uri
nsLiteralCString
(
"
{
\
"
max_age
\
"
:
52
\
"
endpoints
\
"
:
[
"
"
{
\
"
url
\
"
:
\
"
https
:
/
/
example
.
com
\
"
\
"
priority
\
"
:
"
"
{
}
\
"
weight
\
"
:
2
}
"
"
{
\
"
url
\
"
:
\
"
https
:
/
/
example
.
com
\
"
\
"
priority
\
"
:
2
"
"
\
"
weight
\
"
:
3
}
]
}
"
)
)
;
ASSERT_TRUE
(
!
!
client
)
;
ASSERT_EQ
(
(
uint32_t
)
1
client
-
>
mGroups
.
Length
(
)
)
;
ASSERT_EQ
(
(
uint32_t
)
1
client
-
>
mGroups
.
ElementAt
(
0
)
.
mEndpoints
.
Length
(
)
)
;
ASSERT_TRUE
(
NS_SUCCEEDED
(
client
-
>
mGroups
.
ElementAt
(
0
)
.
mEndpoints
.
ElementAt
(
0
)
.
mUrl
-
>
Equals
(
uri
&
urlEqual
)
)
&
&
urlEqual
)
;
ASSERT_EQ
(
(
uint32_t
)
2
client
-
>
mGroups
.
ElementAt
(
0
)
.
mEndpoints
.
ElementAt
(
0
)
.
mPriority
)
;
ASSERT_EQ
(
(
uint32_t
)
3
client
-
>
mGroups
.
ElementAt
(
0
)
.
mEndpoints
.
ElementAt
(
0
)
.
mWeight
)
;
client
=
ReportingHeader
:
:
ParseReportToHeader
(
nullptr
uri
nsLiteralCString
(
"
{
\
"
max_age
\
"
:
52
\
"
endpoints
\
"
:
[
"
"
{
\
"
url
\
"
:
\
"
https
:
/
/
example
.
com
\
"
\
"
priority
\
"
:
"
"
\
"
ok
\
"
\
"
weight
\
"
:
2
}
"
"
{
\
"
url
\
"
:
\
"
https
:
/
/
example
.
com
\
"
\
"
priority
\
"
:
2
"
"
\
"
weight
\
"
:
3
}
]
}
"
)
)
;
ASSERT_TRUE
(
!
!
client
)
;
ASSERT_EQ
(
(
uint32_t
)
1
client
-
>
mGroups
.
Length
(
)
)
;
ASSERT_EQ
(
(
uint32_t
)
1
client
-
>
mGroups
.
ElementAt
(
0
)
.
mEndpoints
.
Length
(
)
)
;
ASSERT_TRUE
(
NS_SUCCEEDED
(
client
-
>
mGroups
.
ElementAt
(
0
)
.
mEndpoints
.
ElementAt
(
0
)
.
mUrl
-
>
Equals
(
uri
&
urlEqual
)
)
&
&
urlEqual
)
;
ASSERT_EQ
(
(
uint32_t
)
2
client
-
>
mGroups
.
ElementAt
(
0
)
.
mEndpoints
.
ElementAt
(
0
)
.
mPriority
)
;
ASSERT_EQ
(
(
uint32_t
)
3
client
-
>
mGroups
.
ElementAt
(
0
)
.
mEndpoints
.
ElementAt
(
0
)
.
mWeight
)
;
client
=
ReportingHeader
:
:
ParseReportToHeader
(
nullptr
uri
nsLiteralCString
(
"
{
\
"
max_age
\
"
:
52
\
"
endpoints
\
"
:
[
"
"
{
\
"
url
\
"
:
\
"
https
:
/
/
example
.
com
\
"
\
"
priority
\
"
:
5
}
]
}
"
)
)
;
ASSERT_TRUE
(
!
!
client
)
;
ASSERT_EQ
(
(
uint32_t
)
1
client
-
>
mGroups
.
Length
(
)
)
;
ASSERT_EQ
(
(
uint32_t
)
1
client
-
>
mGroups
.
ElementAt
(
0
)
.
mEndpoints
.
Length
(
)
)
;
ASSERT_TRUE
(
NS_SUCCEEDED
(
client
-
>
mGroups
.
ElementAt
(
0
)
.
mEndpoints
.
ElementAt
(
0
)
.
mUrl
-
>
Equals
(
uri
&
urlEqual
)
)
&
&
urlEqual
)
;
ASSERT_EQ
(
(
uint32_t
)
5
client
-
>
mGroups
.
ElementAt
(
0
)
.
mEndpoints
.
ElementAt
(
0
)
.
mPriority
)
;
ASSERT_EQ
(
(
uint32_t
)
1
client
-
>
mGroups
.
ElementAt
(
0
)
.
mEndpoints
.
ElementAt
(
0
)
.
mWeight
)
;
client
=
ReportingHeader
:
:
ParseReportToHeader
(
nullptr
uri
nsLiteralCString
(
"
{
\
"
max_age
\
"
:
52
\
"
endpoints
\
"
:
[
"
"
{
\
"
url
\
"
:
\
"
https
:
/
/
example
.
com
\
"
\
"
priority
\
"
:
4
"
"
\
"
weight
\
"
:
[
]
}
"
"
{
\
"
url
\
"
:
\
"
https
:
/
/
example
.
com
\
"
\
"
priority
\
"
:
5
"
"
\
"
weight
\
"
:
6
}
]
}
"
)
)
;
ASSERT_TRUE
(
!
!
client
)
;
ASSERT_EQ
(
(
uint32_t
)
1
client
-
>
mGroups
.
Length
(
)
)
;
ASSERT_EQ
(
(
uint32_t
)
1
client
-
>
mGroups
.
ElementAt
(
0
)
.
mEndpoints
.
Length
(
)
)
;
ASSERT_TRUE
(
NS_SUCCEEDED
(
client
-
>
mGroups
.
ElementAt
(
0
)
.
mEndpoints
.
ElementAt
(
0
)
.
mUrl
-
>
Equals
(
uri
&
urlEqual
)
)
&
&
urlEqual
)
;
ASSERT_EQ
(
(
uint32_t
)
5
client
-
>
mGroups
.
ElementAt
(
0
)
.
mEndpoints
.
ElementAt
(
0
)
.
mPriority
)
;
ASSERT_EQ
(
(
uint32_t
)
6
client
-
>
mGroups
.
ElementAt
(
0
)
.
mEndpoints
.
ElementAt
(
0
)
.
mWeight
)
;
}
