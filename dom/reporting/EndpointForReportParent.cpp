#
include
"
mozilla
/
dom
/
EndpointForReportParent
.
h
"
#
include
"
mozilla
/
dom
/
ReportingHeader
.
h
"
#
include
"
mozilla
/
ipc
/
PBackgroundSharedTypes
.
h
"
#
include
"
mozilla
/
Unused
.
h
"
#
include
"
nsIThread
.
h
"
#
include
"
nsThreadUtils
.
h
"
namespace
mozilla
{
namespace
dom
{
EndpointForReportParent
:
:
EndpointForReportParent
(
)
:
mPBackgroundThread
(
NS_GetCurrentThread
(
)
)
mActive
(
true
)
{
}
EndpointForReportParent
:
:
~
EndpointForReportParent
(
)
=
default
;
void
EndpointForReportParent
:
:
ActorDestroy
(
ActorDestroyReason
aWhy
)
{
mActive
=
false
;
}
void
EndpointForReportParent
:
:
Run
(
const
nsString
&
aGroupName
const
mozilla
:
:
ipc
:
:
PrincipalInfo
&
aPrincipalInfo
)
{
RefPtr
<
EndpointForReportParent
>
self
=
this
;
NS_DispatchToMainThread
(
NS_NewRunnableFunction
(
"
EndpointForReportParent
:
:
Run
"
[
self
aGroupName
aPrincipalInfo
]
(
)
{
nsAutoCString
uri
;
ReportingHeader
:
:
GetEndpointForReport
(
aGroupName
aPrincipalInfo
uri
)
;
self
-
>
mPBackgroundThread
-
>
Dispatch
(
NS_NewRunnableFunction
(
"
EndpointForReportParent
:
:
Answer
"
[
self
uri
]
(
)
{
if
(
self
-
>
mActive
)
{
Unused
<
<
self
-
>
Send__delete__
(
self
uri
)
;
}
}
)
)
;
}
)
)
;
}
}
}
