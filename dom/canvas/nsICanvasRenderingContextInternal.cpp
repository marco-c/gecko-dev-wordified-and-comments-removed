#
include
"
nsICanvasRenderingContextInternal
.
h
"
#
include
"
mozilla
/
dom
/
Document
.
h
"
#
include
"
mozilla
/
PresShell
.
h
"
#
include
"
nsRefreshDriver
.
h
"
nsICanvasRenderingContextInternal
:
:
nsICanvasRenderingContextInternal
(
)
:
mSharedPtrPtr
(
std
:
:
make_shared
<
nsICanvasRenderingContextInternal
*
>
(
this
)
)
{
}
nsICanvasRenderingContextInternal
:
:
~
nsICanvasRenderingContextInternal
(
)
=
default
;
mozilla
:
:
PresShell
*
nsICanvasRenderingContextInternal
:
:
GetPresShell
(
)
{
if
(
mCanvasElement
)
{
return
mCanvasElement
-
>
OwnerDoc
(
)
-
>
GetPresShell
(
)
;
}
return
nullptr
;
}
void
nsICanvasRenderingContextInternal
:
:
RemovePostRefreshObserver
(
)
{
if
(
mRefreshDriver
)
{
mRefreshDriver
-
>
RemovePostRefreshObserver
(
this
)
;
mRefreshDriver
=
nullptr
;
}
}
void
nsICanvasRenderingContextInternal
:
:
AddPostRefreshObserverIfNecessary
(
)
{
if
(
!
GetPresShell
(
)
|
|
!
GetPresShell
(
)
-
>
GetPresContext
(
)
|
|
!
GetPresShell
(
)
-
>
GetPresContext
(
)
-
>
RefreshDriver
(
)
)
{
return
;
}
mRefreshDriver
=
GetPresShell
(
)
-
>
GetPresContext
(
)
-
>
RefreshDriver
(
)
;
mRefreshDriver
-
>
AddPostRefreshObserver
(
this
)
;
}
