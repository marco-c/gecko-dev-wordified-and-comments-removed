#
ifndef
WEBGL_FORMATS_H_
#
define
WEBGL_FORMATS_H_
#
include
<
map
>
#
include
<
set
>
#
include
"
GLTypes
.
h
"
#
include
"
mozilla
/
UniquePtr
.
h
"
namespace
mozilla
{
namespace
webgl
{
typedef
uint8_t
EffectiveFormatValueT
;
enum
class
EffectiveFormat
:
EffectiveFormatValueT
{
RGBA32I
RGBA32UI
RGBA16I
RGBA16UI
RGBA8
RGBA8I
RGBA8UI
SRGB8_ALPHA8
RGB10_A2
RGB10_A2UI
RGBA4
RGB5_A1
RGB8
RGB565
RG32I
RG32UI
RG16I
RG16UI
RG8
RG8I
RG8UI
R32I
R32UI
R16I
R16UI
R8
R8I
R8UI
RGBA32F
RGBA16F
RGBA8_SNORM
RGB32F
RGB32I
RGB32UI
RGB16F
RGB16I
RGB16UI
RGB8_SNORM
RGB8I
RGB8UI
SRGB8
R11F_G11F_B10F
RGB9_E5
RG32F
RG16F
RG8_SNORM
R32F
R16F
R8_SNORM
DEPTH_COMPONENT32F
DEPTH_COMPONENT24
DEPTH_COMPONENT16
DEPTH32F_STENCIL8
DEPTH24_STENCIL8
STENCIL_INDEX8
COMPRESSED_R11_EAC
COMPRESSED_SIGNED_R11_EAC
COMPRESSED_RG11_EAC
COMPRESSED_SIGNED_RG11_EAC
COMPRESSED_RGB8_ETC2
COMPRESSED_SRGB8_ETC2
COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2
COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2
COMPRESSED_RGBA8_ETC2_EAC
COMPRESSED_SRGB8_ALPHA8_ETC2_EAC
ATC_RGB_AMD
ATC_RGBA_EXPLICIT_ALPHA_AMD
ATC_RGBA_INTERPOLATED_ALPHA_AMD
COMPRESSED_RGB_S3TC_DXT1_EXT
COMPRESSED_RGBA_S3TC_DXT1_EXT
COMPRESSED_RGBA_S3TC_DXT3_EXT
COMPRESSED_RGBA_S3TC_DXT5_EXT
COMPRESSED_RGB_PVRTC_4BPPV1
COMPRESSED_RGBA_PVRTC_4BPPV1
COMPRESSED_RGB_PVRTC_2BPPV1
COMPRESSED_RGBA_PVRTC_2BPPV1
ETC1_RGB8_OES
Luminance8Alpha8
Luminance8
Alpha8
Luminance32FAlpha32F
Luminance32F
Alpha32F
Luminance16FAlpha16F
Luminance16F
Alpha16F
MAX
}
;
enum
class
UnsizedFormat
:
uint8_t
{
R
RG
RGB
RGBA
LA
L
A
D
S
DS
}
;
enum
class
ComponentType
:
uint8_t
{
None
Int
UInt
NormInt
NormUInt
Float
Special
}
;
enum
class
CompressionFamily
:
uint8_t
{
ETC1
ES3
ATC
S3TC
PVRTC
}
;
struct
CompressedFormatInfo
{
const
EffectiveFormat
effectiveFormat
;
const
uint8_t
bytesPerBlock
;
const
uint8_t
blockWidth
;
const
uint8_t
blockHeight
;
const
CompressionFamily
family
;
}
;
struct
FormatInfo
{
const
EffectiveFormat
effectiveFormat
;
const
char
*
const
name
;
const
GLenum
sizedFormat
;
const
UnsizedFormat
unsizedFormat
;
const
ComponentType
componentType
;
const
uint8_t
estimatedBytesPerPixel
;
const
bool
isColorFormat
;
const
bool
isSRGB
;
const
bool
hasAlpha
;
const
bool
hasDepth
;
const
bool
hasStencil
;
const
CompressedFormatInfo
*
const
compression
;
}
;
struct
PackingInfo
{
GLenum
format
;
GLenum
type
;
bool
operator
<
(
const
PackingInfo
&
x
)
const
{
if
(
format
!
=
x
.
format
)
return
format
<
x
.
format
;
return
type
<
x
.
type
;
}
}
;
struct
DriverUnpackInfo
{
GLenum
internalFormat
;
GLenum
unpackFormat
;
GLenum
unpackType
;
PackingInfo
ToPacking
(
)
const
{
return
{
unpackFormat
unpackType
}
;
}
}
;
const
FormatInfo
*
GetFormat
(
EffectiveFormat
format
)
;
uint8_t
BytesPerPixel
(
const
PackingInfo
&
packing
)
;
struct
FormatUsageInfo
{
const
FormatInfo
*
const
format
;
bool
isRenderable
;
bool
isFilterable
;
std
:
:
map
<
PackingInfo
DriverUnpackInfo
>
validUnpacks
;
const
DriverUnpackInfo
*
idealUnpack
;
const
GLint
*
textureSwizzleRGBA
;
bool
maxSamplesKnown
;
uint32_t
maxSamples
;
static
const
GLint
kLuminanceSwizzleRGBA
[
4
]
;
static
const
GLint
kAlphaSwizzleRGBA
[
4
]
;
static
const
GLint
kLumAlphaSwizzleRGBA
[
4
]
;
explicit
FormatUsageInfo
(
const
FormatInfo
*
_format
)
:
format
(
_format
)
isRenderable
(
false
)
isFilterable
(
false
)
idealUnpack
(
nullptr
)
textureSwizzleRGBA
(
nullptr
)
maxSamplesKnown
(
false
)
maxSamples
(
0
)
{
}
bool
IsUnpackValid
(
const
PackingInfo
&
key
const
DriverUnpackInfo
*
*
const
out_value
)
const
;
void
ResolveMaxSamples
(
gl
:
:
GLContext
*
gl
)
;
}
;
class
FormatUsageAuthority
{
std
:
:
map
<
EffectiveFormat
FormatUsageInfo
>
mUsageMap
;
std
:
:
map
<
GLenum
const
FormatUsageInfo
*
>
mRBFormatMap
;
std
:
:
map
<
GLenum
const
FormatUsageInfo
*
>
mSizedTexFormatMap
;
std
:
:
map
<
PackingInfo
const
FormatUsageInfo
*
>
mUnsizedTexFormatMap
;
std
:
:
set
<
GLenum
>
mValidTexInternalFormats
;
std
:
:
set
<
GLenum
>
mValidTexUnpackFormats
;
std
:
:
set
<
GLenum
>
mValidTexUnpackTypes
;
public
:
static
UniquePtr
<
FormatUsageAuthority
>
CreateForWebGL1
(
gl
:
:
GLContext
*
gl
)
;
static
UniquePtr
<
FormatUsageAuthority
>
CreateForWebGL2
(
gl
:
:
GLContext
*
gl
)
;
private
:
FormatUsageAuthority
(
)
{
}
public
:
FormatUsageInfo
*
EditUsage
(
EffectiveFormat
format
)
;
const
FormatUsageInfo
*
GetUsage
(
EffectiveFormat
format
)
const
;
void
AddTexUnpack
(
FormatUsageInfo
*
usage
const
PackingInfo
&
pi
const
DriverUnpackInfo
&
dui
)
;
bool
IsInternalFormatEnumValid
(
GLenum
internalFormat
)
const
;
bool
AreUnpackEnumsValid
(
GLenum
unpackFormat
GLenum
unpackType
)
const
;
void
AllowRBFormat
(
GLenum
sizedFormat
const
FormatUsageInfo
*
usage
)
;
void
AllowSizedTexFormat
(
GLenum
sizedFormat
const
FormatUsageInfo
*
usage
)
;
void
AllowUnsizedTexFormat
(
const
PackingInfo
&
pi
const
FormatUsageInfo
*
usage
)
;
const
FormatUsageInfo
*
GetRBUsage
(
GLenum
sizedFormat
)
const
;
const
FormatUsageInfo
*
GetSizedTexUsage
(
GLenum
sizedFormat
)
const
;
const
FormatUsageInfo
*
GetUnsizedTexUsage
(
const
PackingInfo
&
pi
)
const
;
}
;
}
}
#
endif
