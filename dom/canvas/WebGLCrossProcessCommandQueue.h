#
ifndef
WEBGLCROSSPROCESSCOMMANDQUEUE_H_
#
define
WEBGLCROSSPROCESSCOMMANDQUEUE_H_
#
include
"
mozilla
/
dom
/
WebGLCommandQueue
.
h
"
namespace
mozilla
{
namespace
layers
{
class
PCompositorBridgeParent
;
}
class
HostWebGLContext
;
using
mozilla
:
:
webgl
:
:
ProducerConsumerQueue
;
using
ClientWebGLCommandSource
=
SyncCommandSource
<
size_t
>
;
class
HostWebGLCommandSink
:
public
SyncCommandSink
<
size_t
>
{
public
:
HostWebGLCommandSink
(
UniquePtr
<
Consumer
>
&
&
aConsumer
UniquePtr
<
ProducerConsumerQueue
>
&
aResponsePcq
)
;
~
HostWebGLCommandSink
(
)
{
}
void
SetHostContext
(
HostWebGLContext
*
aHostContext
)
{
mHostContext
=
aHostContext
;
}
protected
:
friend
struct
mozilla
:
:
ipc
:
:
IPDLParamTraits
<
HostWebGLCommandSink
>
;
friend
class
mozilla
:
:
layers
:
:
PCompositorBridgeParent
;
HostWebGLCommandSink
(
)
{
}
bool
DispatchCommand
(
size_t
command
)
override
;
void
ReportOOM
(
)
override
;
HostWebGLContext
*
mHostContext
;
}
;
using
WebGLCrossProcessCommandQueue
=
CommandQueue
<
ClientWebGLCommandSource
HostWebGLCommandSink
>
;
namespace
ipc
{
template
<
>
struct
IPDLParamTraits
<
mozilla
:
:
HostWebGLCommandSink
>
:
public
IPDLParamTraits
<
mozilla
:
:
SyncCommandSink
<
size_t
>
>
{
public
:
typedef
mozilla
:
:
HostWebGLCommandSink
paramType
;
}
;
}
}
#
endif
