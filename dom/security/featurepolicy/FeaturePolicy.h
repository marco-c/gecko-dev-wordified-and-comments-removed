#
ifndef
mozilla_dom_FeaturePolicy_h
#
define
mozilla_dom_FeaturePolicy_h
#
include
"
mozilla
/
Attributes
.
h
"
#
include
"
mozilla
/
dom
/
BindingUtils
.
h
"
#
include
"
mozilla
/
dom
/
Feature
.
h
"
#
include
"
nsCycleCollectionParticipant
.
h
"
#
include
"
nsString
.
h
"
#
include
"
nsTArray
.
h
"
#
include
"
nsWrapperCache
.
h
"
class
nsIDocument
;
class
nsIHttpChannel
;
class
nsINode
;
namespace
mozilla
{
namespace
dom
{
class
FeaturePolicyUtils
;
class
FeaturePolicy
final
:
public
nsISupports
public
nsWrapperCache
{
friend
class
FeaturePolicyUtils
;
public
:
NS_DECL_CYCLE_COLLECTING_ISUPPORTS
NS_DECL_CYCLE_COLLECTION_SCRIPT_HOLDER_CLASS
(
FeaturePolicy
)
explicit
FeaturePolicy
(
nsINode
*
aNode
)
;
void
SetDefaultOrigin
(
const
nsAString
&
aOrigin
)
{
mDefaultOrigin
=
aOrigin
;
}
const
nsAString
&
DefaultOrigin
(
)
const
{
return
mDefaultOrigin
;
}
void
InheritPolicy
(
FeaturePolicy
*
aParentFeaturePolicy
)
;
void
SetDeclaredPolicy
(
nsIDocument
*
aDocument
const
nsAString
&
aPolicyString
const
nsAString
&
aSelfOrigin
const
nsAString
&
aSrcOrigin
bool
aSrcEnabled
)
;
void
ResetDeclaredPolicy
(
)
;
JSObject
*
WrapObject
(
JSContext
*
aCx
JS
:
:
Handle
<
JSObject
*
>
aGivenProto
)
override
;
nsINode
*
GetParentObject
(
)
const
{
return
mParentNode
;
}
bool
AllowsFeature
(
const
nsAString
&
aFeatureName
const
Optional
<
nsAString
>
&
aOrigin
)
const
;
void
AllowedFeatures
(
nsTArray
<
nsString
>
&
aAllowedFeatures
)
;
void
GetAllowlistForFeature
(
const
nsAString
&
aFeatureName
nsTArray
<
nsString
>
&
aList
)
const
;
private
:
~
FeaturePolicy
(
)
=
default
;
bool
AllowsFeatureInternal
(
const
nsAString
&
aFeatureName
const
nsAString
&
aOrigin
)
const
;
void
SetInheritedDeniedFeature
(
const
nsAString
&
aFeatureName
)
;
bool
HasInheritedDeniedFeature
(
const
nsAString
&
aFeatureName
)
const
;
bool
HasDeclaredFeature
(
const
nsAString
&
aFeatureName
)
const
;
nsCOMPtr
<
nsINode
>
mParentNode
;
nsTArray
<
nsString
>
mInheritedDeniedFeatureNames
;
nsTArray
<
Feature
>
mFeatures
;
nsString
mDefaultOrigin
;
}
;
}
}
#
endif
