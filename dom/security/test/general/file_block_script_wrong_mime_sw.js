const
params
=
new
URLSearchParams
(
location
.
search
)
;
const
fetchMode
=
params
.
get
(
"
fetchMode
"
)
;
self
.
addEventListener
(
"
activate
"
event
=
>
{
event
.
waitUntil
(
(
async
(
)
=
>
{
await
clients
.
claim
(
)
;
const
allClients
=
await
clients
.
matchAll
(
)
;
for
(
const
client
of
allClients
)
{
client
.
postMessage
(
{
fetchMode
}
)
;
}
}
)
(
)
)
;
}
)
;
self
.
addEventListener
(
"
install
"
(
)
=
>
{
self
.
skipWaiting
(
)
;
}
)
;
self
.
addEventListener
(
"
fetch
"
event
=
>
{
switch
(
fetchMode
)
{
case
"
direct
"
:
event
.
respondWith
(
fetch
(
event
.
request
)
)
;
break
;
case
"
indirect
"
:
event
.
respondWith
(
fetch
(
event
.
request
.
url
)
)
;
break
;
}
}
)
;
