'
use
strict
'
;
add_task
(
function
*
(
)
{
Observer
.
add_observers
(
Services
)
;
registerCleanupFunction
(
do_cleanup
)
;
let
which
=
"
block_display
"
;
SetupPrefTestEnvironment
(
which
[
[
"
security
.
mixed_content
.
hsts_priming_cache_timeout
"
1
]
]
)
;
yield
execute_test
(
"
no
-
ssl
"
test_settings
[
which
]
.
mimetype
)
;
let
pre_promise
=
performance
.
now
(
)
;
while
(
(
performance
.
now
(
)
-
pre_promise
)
<
2000
)
{
yield
new
Promise
(
function
(
resolve
)
{
setTimeout
(
resolve
2000
)
;
}
)
;
}
test_settings
[
which
]
.
priming
=
{
}
;
yield
execute_test
(
"
no
-
ssl
"
test_settings
[
which
]
.
mimetype
)
;
is
(
test_settings
[
which
]
.
priming
[
"
no
-
ssl
"
]
true
"
Correctly
send
a
priming
request
after
expiration
.
"
)
;
SpecialPowers
.
popPrefEnv
(
)
;
}
)
;
