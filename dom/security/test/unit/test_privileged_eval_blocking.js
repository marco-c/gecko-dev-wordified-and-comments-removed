add_setup
(
(
)
=
>
{
Services
.
prefs
.
setBoolPref
(
"
extensions
.
webextensions
.
remote
"
true
)
;
registerCleanupFunction
(
(
)
=
>
{
Services
.
prefs
.
clearUserPref
(
"
extensions
.
webextensions
.
remote
"
)
;
}
)
;
}
)
;
add_task
(
async
function
(
)
{
let
errorObserved
=
new
Promise
(
resolve
=
>
{
const
listener
=
{
observe
(
{
message
}
)
{
if
(
message
.
includes
(
"
eval
(
)
and
eval
-
like
"
)
)
{
Services
.
console
.
unregisterListener
(
listener
)
;
resolve
(
)
;
}
}
}
;
Services
.
console
.
registerListener
(
listener
)
;
}
)
;
if
(
mozinfo
.
os
=
=
"
android
"
)
{
Assert
.
equal
(
eval
(
"
42
"
)
42
"
eval
on
Android
is
not
disabled
yet
"
)
;
}
else
{
Assert
.
throws
(
(
)
=
>
eval
(
"
42
"
)
EvalError
"
eval
(
)
in
privileged
context
should
throw
"
)
;
}
await
errorObserved
;
}
)
;
