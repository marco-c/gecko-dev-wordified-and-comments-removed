function
doXHR
(
uri
)
{
try
{
var
xhr
=
new
XMLHttpRequest
(
)
;
xhr
.
open
(
"
GET
"
uri
)
;
xhr
.
send
(
)
;
}
catch
(
ex
)
{
}
}
var
sameBase
=
"
http
:
/
/
mochi
.
test
:
8888
/
tests
/
dom
/
security
/
test
/
csp
/
file_CSP
.
sjs
?
testid
=
"
;
var
crossBase
=
"
http
:
/
/
example
.
com
/
tests
/
dom
/
security
/
test
/
csp
/
file_CSP
.
sjs
?
testid
=
"
;
onmessage
=
(
e
)
=
>
{
for
(
base
of
[
sameBase
crossBase
]
)
{
var
prefix
;
var
suffix
;
if
(
e
.
data
.
inherited
=
=
"
parent
"
)
{
prefix
=
base
+
"
worker_child_inherited_parent_
"
;
suffix
=
base
=
=
sameBase
?
"
_good
"
:
"
_bad
"
;
}
else
if
(
e
.
data
.
inherited
=
=
"
document
"
)
{
prefix
=
base
+
"
worker_child_inherited_document_
"
;
suffix
=
base
=
=
sameBase
?
"
_good
"
:
"
_bad
"
;
}
else
{
prefix
=
base
+
"
worker_child_
"
;
suffix
=
base
=
=
sameBase
?
"
_same_bad
"
:
"
_cross_bad
"
;
}
doXHR
(
prefix
+
"
xhr
"
+
suffix
)
;
try
{
importScripts
(
prefix
+
"
script
"
+
suffix
)
;
}
catch
(
ex
)
{
}
}
}
