#
ifndef
nsContentSecurityUtils_h___
#
define
nsContentSecurityUtils_h___
#
include
<
utility
>
#
include
"
mozilla
/
Maybe
.
h
"
#
include
"
nsStringFwd
.
h
"
struct
JSContext
;
class
nsIChannel
;
class
nsIHttpChannel
;
class
nsIPrincipal
;
class
nsIURI
;
class
NS_ConvertUTF8toUTF16
;
namespace
mozilla
:
:
dom
{
class
Document
;
class
Element
;
}
using
FilenameTypeAndDetails
=
std
:
:
pair
<
nsCString
mozilla
:
:
Maybe
<
nsCString
>
>
;
class
nsContentSecurityUtils
{
public
:
static
bool
IsConsideredSameOriginForUIR
(
nsIPrincipal
*
aTriggeringPrincipal
nsIPrincipal
*
aResultPrincipal
)
;
static
bool
IsTrustedScheme
(
nsIURI
*
aURI
)
;
static
bool
IsEvalAllowed
(
JSContext
*
cx
bool
aIsSystemPrincipal
const
nsAString
&
aScript
)
;
static
void
NotifyEvalUsage
(
bool
aIsSystemPrincipal
const
nsACString
&
aFileName
uint64_t
aWindowID
uint32_t
aLineNumber
uint32_t
aColumnNumber
)
;
static
void
DetectJsHacks
(
)
;
static
void
DetectCssHacks
(
)
;
static
nsresult
GetHttpChannelFromPotentialMultiPart
(
nsIChannel
*
aChannel
nsIHttpChannel
*
*
aHttpChannel
)
;
static
void
PerformCSPFrameAncestorAndXFOCheck
(
nsIChannel
*
aChannel
)
;
static
bool
CheckCSPFrameAncestorAndXFO
(
nsIChannel
*
aChannel
)
;
static
nsString
GetIsElementNonceableNonce
(
const
mozilla
:
:
dom
:
:
Element
&
aElement
)
;
static
long
ClassifyDownload
(
nsIChannel
*
aChannel
)
;
static
FilenameTypeAndDetails
FilenameToFilenameType
(
const
nsACString
&
fileName
bool
collectAdditionalExtensionData
)
;
static
char
*
SmartFormatCrashString
(
const
char
*
str
)
;
static
char
*
SmartFormatCrashString
(
char
*
str
)
;
static
nsCString
SmartFormatCrashString
(
const
char
*
part1
const
char
*
part2
const
char
*
format_string
)
;
static
nsCString
SmartFormatCrashString
(
char
*
part1
char
*
part2
const
char
*
format_string
)
;
#
if
defined
(
DEBUG
)
static
void
AssertAboutPageHasCSP
(
mozilla
:
:
dom
:
:
Document
*
aDocument
)
;
static
void
AssertChromePageHasCSP
(
mozilla
:
:
dom
:
:
Document
*
aDocument
)
;
#
endif
static
bool
ValidateScriptFilename
(
JSContext
*
cx
const
char
*
aFilename
)
;
static
void
LogMessageToConsole
(
nsIHttpChannel
*
aChannel
const
char
*
aMsg
)
;
}
;
#
endif
