#
ifndef
mozilla_dom_notification_h__
#
define
mozilla_dom_notification_h__
#
include
"
mozilla
/
DOMEventTargetHelper
.
h
"
#
include
"
mozilla
/
dom
/
NotificationBinding
.
h
"
#
include
"
mozilla
/
dom
/
notification
/
NotificationChild
.
h
"
#
include
"
mozilla
/
dom
/
WorkerPrivate
.
h
"
#
include
"
mozilla
/
dom
/
quota
/
QuotaCommon
.
h
"
#
include
"
nsISupports
.
h
"
#
include
"
nsCycleCollectionParticipant
.
h
"
class
nsIPrincipal
;
class
nsIVariant
;
namespace
mozilla
:
:
dom
{
class
NotificationRef
;
class
WorkerNotificationObserver
;
class
Promise
;
class
StrongWorkerRef
;
namespace
notification
{
enum
class
PermissionCheckPurpose
:
uint8_t
;
}
class
Notification
:
public
DOMEventTargetHelper
public
SupportsWeakPtr
{
friend
class
CloseNotificationRunnable
;
friend
class
NotificationTask
;
friend
class
NotificationPermissionRequest
;
friend
class
MainThreadNotificationObserver
;
friend
class
NotificationStorageCallback
;
friend
class
ServiceWorkerNotificationObserver
;
friend
class
WorkerGetRunnable
;
friend
class
WorkerNotificationObserver
;
public
:
IMPL_EVENT_HANDLER
(
click
)
IMPL_EVENT_HANDLER
(
show
)
IMPL_EVENT_HANDLER
(
error
)
IMPL_EVENT_HANDLER
(
close
)
NS_DECL_ISUPPORTS_INHERITED
NS_DECL_CYCLE_COLLECTION_SCRIPT_HOLDER_CLASS_INHERITED
(
Notification
DOMEventTargetHelper
)
static
bool
PrefEnabled
(
JSContext
*
aCx
JSObject
*
aObj
)
;
static
already_AddRefed
<
Notification
>
Constructor
(
const
GlobalObject
&
aGlobal
const
nsAString
&
aTitle
const
NotificationOptions
&
aOption
ErrorResult
&
aRv
)
;
static
Result
<
already_AddRefed
<
Notification
>
QMResult
>
ConstructFromFields
(
nsIGlobalObject
*
aGlobal
const
nsAString
&
aID
const
nsAString
&
aTitle
const
nsAString
&
aDir
const
nsAString
&
aLang
const
nsAString
&
aBody
const
nsAString
&
aTag
const
nsAString
&
aIcon
const
nsAString
&
aData
const
nsAString
&
aServiceWorkerRegistrationScope
)
;
void
GetID
(
nsAString
&
aRetval
)
{
aRetval
=
mID
;
}
void
GetTitle
(
nsAString
&
aRetval
)
{
aRetval
=
mTitle
;
}
NotificationDirection
Dir
(
)
{
return
mDir
;
}
void
GetLang
(
nsAString
&
aRetval
)
{
aRetval
=
mLang
;
}
void
GetBody
(
nsAString
&
aRetval
)
{
aRetval
=
mBody
;
}
void
GetTag
(
nsAString
&
aRetval
)
{
aRetval
=
mTag
;
}
void
GetIcon
(
nsAString
&
aRetval
)
{
aRetval
=
mIconUrl
;
}
void
MaybeNotifyClose
(
)
;
static
bool
RequestPermissionEnabledForScope
(
JSContext
*
aCx
JSObject
*
)
;
static
already_AddRefed
<
Promise
>
RequestPermission
(
const
GlobalObject
&
aGlobal
const
Optional
<
OwningNonNull
<
NotificationPermissionCallback
>
>
&
aCallback
ErrorResult
&
aRv
)
;
static
NotificationPermission
GetPermission
(
const
GlobalObject
&
aGlobal
ErrorResult
&
aRv
)
;
static
already_AddRefed
<
Promise
>
Get
(
nsPIDOMWindowInner
*
aWindow
const
GetNotificationOptions
&
aFilter
const
nsAString
&
aScope
ErrorResult
&
aRv
)
;
static
already_AddRefed
<
Promise
>
WorkerGet
(
WorkerPrivate
*
aWorkerPrivate
const
GetNotificationOptions
&
aFilter
const
nsAString
&
aScope
ErrorResult
&
aRv
)
;
static
already_AddRefed
<
Promise
>
ShowPersistentNotification
(
JSContext
*
aCx
nsIGlobalObject
*
aGlobal
const
nsAString
&
aScope
const
nsAString
&
aTitle
const
NotificationOptions
&
aOptions
const
ServiceWorkerRegistrationDescriptor
&
aDescriptor
ErrorResult
&
aRv
)
;
void
Close
(
)
;
nsIGlobalObject
*
GetParentObject
(
)
const
{
return
GetOwnerGlobal
(
)
;
}
JSObject
*
WrapObject
(
JSContext
*
JS
:
:
Handle
<
JSObject
*
>
aGivenProto
)
override
;
bool
RequireInteraction
(
)
const
;
bool
Silent
(
)
const
;
void
GetVibrate
(
nsTArray
<
uint32_t
>
&
aRetval
)
const
;
void
GetData
(
JSContext
*
aCx
JS
:
:
MutableHandle
<
JS
:
:
Value
>
aRetval
)
;
void
InitFromJSVal
(
JSContext
*
aCx
JS
:
:
Handle
<
JS
:
:
Value
>
aData
ErrorResult
&
aRv
)
;
Result
<
Ok
QMResult
>
InitFromBase64
(
const
nsAString
&
aData
)
;
static
NotificationPermission
GetPermission
(
nsIGlobalObject
*
aGlobal
notification
:
:
PermissionCheckPurpose
aPurpose
ErrorResult
&
aRv
)
;
bool
DispatchClickEvent
(
)
;
nsresult
DispatchToMainThread
(
already_AddRefed
<
nsIRunnable
>
&
&
aRunnable
)
;
protected
:
Notification
(
nsIGlobalObject
*
aGlobal
const
nsAString
&
aID
const
nsAString
&
aTitle
const
nsAString
&
aBody
NotificationDirection
aDir
const
nsAString
&
aLang
const
nsAString
&
aTag
const
nsAString
&
aIconUrl
bool
aRequireInteraction
bool
aSilent
nsTArray
<
uint32_t
>
&
&
aVibrate
const
NotificationBehavior
&
aBehavior
)
;
static
already_AddRefed
<
Notification
>
CreateInternal
(
nsIGlobalObject
*
aGlobal
const
nsAString
&
aID
const
nsAString
&
aTitle
const
NotificationOptions
&
aOptions
ErrorResult
&
aRv
)
;
void
Deactivate
(
)
;
static
NotificationPermission
GetPermissionInternal
(
nsPIDOMWindowInner
*
aWindow
notification
:
:
PermissionCheckPurpose
aPurpose
ErrorResult
&
rv
)
;
void
SetScope
(
const
nsAString
&
aScope
)
{
MOZ_ASSERT
(
mScope
.
IsEmpty
(
)
)
;
mScope
=
aScope
;
}
WeakPtr
<
notification
:
:
NotificationChild
>
mActor
;
const
nsString
mID
;
const
nsString
mTitle
;
const
nsString
mBody
;
const
NotificationDirection
mDir
;
const
nsString
mLang
;
const
nsString
mTag
;
const
nsString
mIconUrl
;
const
bool
mRequireInteraction
;
const
bool
mSilent
;
nsTArray
<
uint32_t
>
mVibrate
;
nsString
mDataAsBase64
;
const
NotificationBehavior
mBehavior
;
JS
:
:
Heap
<
JS
:
:
Value
>
mData
;
nsString
mScope
;
bool
mIsClosed
=
false
;
private
:
virtual
~
Notification
(
)
;
static
already_AddRefed
<
Notification
>
Create
(
JSContext
*
aCx
nsIGlobalObject
*
aGlobal
const
nsAString
&
aTitle
const
NotificationOptions
&
aOptions
const
nsAString
&
aScope
ErrorResult
&
aRv
)
;
bool
CreateActor
(
)
;
bool
SendShow
(
Promise
*
aPromise
)
;
static
nsresult
ResolveIconAndSoundURL
(
nsIGlobalObject
*
aGlobal
nsString
&
aIconURL
nsString
&
aSoundURL
)
;
}
;
}
#
endif
