#
ifndef
mozilla_dom_MessagePortService_h
#
define
mozilla_dom_MessagePortService_h
#
include
"
nsClassHashtable
.
h
"
#
include
"
nsHashKeys
.
h
"
#
include
"
nsISupportsImpl
.
h
"
namespace
mozilla
{
namespace
dom
{
class
MessagePortParent
;
class
SharedMessageBody
;
class
MessagePortService
final
{
public
:
NS_INLINE_DECL_REFCOUNTING
(
MessagePortService
)
struct
NextParent
;
static
MessagePortService
*
Get
(
)
;
static
MessagePortService
*
GetOrCreate
(
)
;
bool
RequestEntangling
(
MessagePortParent
*
aParent
const
nsID
&
aDestinationUUID
const
uint32_t
&
aSequenceID
)
;
bool
DisentanglePort
(
MessagePortParent
*
aParent
FallibleTArray
<
RefPtr
<
SharedMessageBody
>
>
&
aMessages
)
;
bool
ClosePort
(
MessagePortParent
*
aParent
)
;
bool
PostMessages
(
MessagePortParent
*
aParent
FallibleTArray
<
RefPtr
<
SharedMessageBody
>
>
&
aMessages
)
;
void
ParentDestroy
(
MessagePortParent
*
aParent
)
;
bool
ForceClose
(
const
nsID
&
aUUID
const
nsID
&
aDestinationUUID
const
uint32_t
&
aSequenceID
)
;
private
:
~
MessagePortService
(
)
=
default
;
void
CloseAll
(
const
nsID
&
aUUID
bool
aForced
=
false
)
;
void
MaybeShutdown
(
)
;
class
MessagePortServiceData
;
nsClassHashtable
<
nsIDHashKey
MessagePortServiceData
>
mPorts
;
}
;
}
}
#
endif
