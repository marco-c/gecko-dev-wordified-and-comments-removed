#
ifndef
mozilla_dom_PermissionStatus_h_
#
define
mozilla_dom_PermissionStatus_h_
#
include
"
mozilla
/
dom
/
PermissionsBinding
.
h
"
#
include
"
mozilla
/
dom
/
PermissionStatusBinding
.
h
"
#
include
"
mozilla
/
DOMEventTargetHelper
.
h
"
#
include
"
mozilla
/
MozPromise
.
h
"
#
include
"
nsIPermission
.
h
"
namespace
mozilla
:
:
dom
{
class
PermissionObserver
;
class
PermissionStatus
:
public
DOMEventTargetHelper
{
friend
class
PermissionObserver
;
public
:
using
CreatePromise
=
MozPromise
<
RefPtr
<
PermissionStatus
>
nsresult
true
>
;
using
SimplePromise
=
MozPromise
<
nsresult
nsresult
true
>
;
static
RefPtr
<
CreatePromise
>
Create
(
nsPIDOMWindowInner
*
aWindow
PermissionName
aName
)
;
JSObject
*
WrapObject
(
JSContext
*
aCx
JS
:
:
Handle
<
JSObject
*
>
aGivenProto
)
override
;
PermissionState
State
(
)
const
{
return
mState
;
}
IMPL_EVENT_HANDLER
(
change
)
void
DisconnectFromOwner
(
)
override
;
PermissionName
Name
(
)
const
{
return
mName
;
}
RefPtr
<
SimplePromise
>
Init
(
)
;
protected
:
~
PermissionStatus
(
)
;
PermissionStatus
(
nsPIDOMWindowInner
*
aWindow
PermissionName
aName
)
;
virtual
nsLiteralCString
GetPermissionType
(
)
;
private
:
virtual
RefPtr
<
SimplePromise
>
UpdateState
(
)
;
virtual
bool
MaybeUpdatedBy
(
nsIPermission
*
aPermission
)
const
;
virtual
bool
MaybeUpdatedByNotifyOnly
(
nsPIDOMWindowInner
*
aInnerWindow
)
const
;
void
PermissionChanged
(
)
;
PermissionName
mName
;
RefPtr
<
PermissionObserver
>
mObserver
;
protected
:
PermissionState
mState
;
}
;
}
#
endif
