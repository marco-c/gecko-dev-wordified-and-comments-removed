#
ifndef
mozilla_dom_SessionStorageManager_h
#
define
mozilla_dom_SessionStorageManager_h
#
include
"
nsIDOMStorageManager
.
h
"
#
include
"
nsClassHashtable
.
h
"
#
include
"
nsRefPtrHashtable
.
h
"
#
include
"
StorageObserver
.
h
"
namespace
mozilla
{
namespace
dom
{
class
SessionStorageCache
;
class
SessionStorageObserver
;
class
SessionStorageManager
final
:
public
nsIDOMSessionStorageManager
public
StorageObserverSink
{
public
:
explicit
SessionStorageManager
(
RefPtr
<
BrowsingContext
>
aBrowsingContext
)
;
NS_DECL_CYCLE_COLLECTING_ISUPPORTS
NS_DECL_NSIDOMSTORAGEMANAGER
NS_DECL_NSIDOMSESSIONSTORAGEMANAGER
NS_DECL_CYCLE_COLLECTION_CLASS
(
SessionStorageManager
)
RefPtr
<
BrowsingContext
>
GetBrowsingContext
(
)
const
{
return
mBrowsingContext
;
}
private
:
~
SessionStorageManager
(
)
;
nsresult
Observe
(
const
char
*
aTopic
const
nsAString
&
aOriginAttributesPattern
const
nsACString
&
aOriginScope
)
override
;
enum
ClearStorageType
{
eAll
eSessionOnly
}
;
void
ClearStorages
(
ClearStorageType
aType
const
OriginAttributesPattern
&
aPattern
const
nsACString
&
aOriginScope
)
;
nsresult
GetSessionStorageCacheHelper
(
nsIPrincipal
*
aPrincipal
bool
aMakeIfNeeded
SessionStorageCache
*
aCloneFrom
RefPtr
<
SessionStorageCache
>
*
aRetVal
)
;
nsresult
GetSessionStorageCacheHelper
(
const
nsACString
&
aOriginAttrs
const
nsACString
&
aOriginKey
bool
aMakeIfNeeded
SessionStorageCache
*
aCloneFrom
RefPtr
<
SessionStorageCache
>
*
aRetVal
)
;
typedef
nsRefPtrHashtable
<
nsCStringHashKey
SessionStorageCache
>
OriginKeyHashTable
;
nsClassHashtable
<
nsCStringHashKey
OriginKeyHashTable
>
mOATable
;
RefPtr
<
SessionStorageObserver
>
mObserver
;
RefPtr
<
BrowsingContext
>
mBrowsingContext
;
}
;
}
}
#
endif
