#
ifndef
mozilla_dom_StorageActivityService_h
#
define
mozilla_dom_StorageActivityService_h
#
include
"
nsDataHashtable
.
h
"
#
include
"
nsIStorageActivityService
.
h
"
#
include
"
nsITimer
.
h
"
#
include
"
nsWeakReference
.
h
"
namespace
mozilla
{
namespace
ipc
{
class
PrincipalInfo
;
}
namespace
dom
{
class
StorageActivityService
final
:
public
nsIStorageActivityService
public
nsIObserver
public
nsITimerCallback
public
nsSupportsWeakReference
{
public
:
NS_DECL_ISUPPORTS
NS_DECL_NSISTORAGEACTIVITYSERVICE
NS_DECL_NSIOBSERVER
NS_DECL_NSITIMERCALLBACK
static
void
SendActivity
(
nsIPrincipal
*
aPrincipal
)
;
static
void
SendActivity
(
const
mozilla
:
:
ipc
:
:
PrincipalInfo
&
aPrincipalInfo
)
;
static
void
SendActivity
(
const
nsACString
&
aOrigin
)
;
static
already_AddRefed
<
StorageActivityService
>
GetOrCreate
(
)
;
private
:
StorageActivityService
(
)
;
~
StorageActivityService
(
)
;
void
SendActivityInternal
(
nsIPrincipal
*
aPrincipal
)
;
void
SendActivityInternal
(
const
nsACString
&
aOrigin
)
;
void
SendActivityToParent
(
nsIPrincipal
*
aPrincipal
)
;
void
MaybeStartTimer
(
)
;
void
MaybeStopTimer
(
)
;
nsDataHashtable
<
nsCStringHashKey
PRTime
>
mActivities
;
nsCOMPtr
<
nsITimer
>
mTimer
;
}
;
}
}
#
endif
