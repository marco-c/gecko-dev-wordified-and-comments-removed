#
ifndef
mozilla_dom_bluetooth_BluetoothGattCharacteristic_h
#
define
mozilla_dom_bluetooth_BluetoothGattCharacteristic_h
#
include
"
mozilla
/
Attributes
.
h
"
#
include
"
mozilla
/
dom
/
BluetoothGattCharacteristicBinding
.
h
"
#
include
"
mozilla
/
dom
/
bluetooth
/
BluetoothCommon
.
h
"
#
include
"
mozilla
/
dom
/
bluetooth
/
BluetoothGattDescriptor
.
h
"
#
include
"
mozilla
/
dom
/
TypedArray
.
h
"
#
include
"
nsCOMPtr
.
h
"
#
include
"
nsWrapperCache
.
h
"
#
include
"
nsPIDOMWindow
.
h
"
namespace
mozilla
{
namespace
dom
{
class
Promise
;
}
}
BEGIN_BLUETOOTH_NAMESPACE
class
BluetoothGattService
;
class
BluetoothSignal
;
class
BluetoothValue
;
class
BluetoothGattCharacteristic
final
:
public
nsISupports
public
nsWrapperCache
public
BluetoothSignalObserver
{
friend
class
BluetoothGattServer
;
friend
class
BluetoothGattService
;
public
:
NS_DECL_CYCLE_COLLECTING_ISUPPORTS
NS_DECL_CYCLE_COLLECTION_SCRIPT_HOLDER_CLASS
(
BluetoothGattCharacteristic
)
BluetoothGattService
*
Service
(
)
const
{
return
mService
;
}
void
GetDescriptors
(
nsTArray
<
RefPtr
<
BluetoothGattDescriptor
>
>
&
aDescriptors
)
const
{
aDescriptors
=
mDescriptors
;
}
void
GetUuid
(
nsString
&
aUuidStr
)
const
{
aUuidStr
=
mUuidStr
;
}
int
InstanceId
(
)
const
{
return
mCharId
.
mInstanceId
;
}
void
GetValue
(
JSContext
*
cx
JS
:
:
MutableHandle
<
JSObject
*
>
aValue
)
const
;
void
GetPermissions
(
GattPermissions
&
aPermissions
)
const
;
void
GetProperties
(
GattCharacteristicProperties
&
aProperties
)
const
;
already_AddRefed
<
Promise
>
ReadValue
(
ErrorResult
&
aRv
)
;
already_AddRefed
<
Promise
>
WriteValue
(
const
ArrayBuffer
&
aValue
ErrorResult
&
aRv
)
;
already_AddRefed
<
Promise
>
StartNotifications
(
ErrorResult
&
aRv
)
;
already_AddRefed
<
Promise
>
StopNotifications
(
ErrorResult
&
aRv
)
;
already_AddRefed
<
Promise
>
AddDescriptor
(
const
nsAString
&
aDescriptorUuid
const
GattPermissions
&
aPermissions
const
ArrayBuffer
&
aValue
ErrorResult
&
aRv
)
;
const
BluetoothGattId
&
GetCharacteristicId
(
)
const
{
return
mCharId
;
}
void
Notify
(
const
BluetoothSignal
&
aData
)
;
const
BluetoothAttributeHandle
&
GetCharacteristicHandle
(
)
const
{
return
mCharacteristicHandle
;
}
void
GetUuid
(
BluetoothUuid
&
aUuid
)
const
;
nsPIDOMWindowInner
*
GetParentObject
(
)
const
{
return
mOwner
;
}
BluetoothGattAttrPerm
GetPermissions
(
)
const
{
return
mPermissions
;
}
BluetoothGattCharProp
GetProperties
(
)
const
{
return
mProperties
;
}
uint16_t
GetHandleCount
(
)
const
;
const
nsTArray
<
uint8_t
>
&
GetValue
(
)
const
{
return
mValue
;
}
virtual
JSObject
*
WrapObject
(
JSContext
*
aCx
JS
:
:
Handle
<
JSObject
*
>
aGivenProto
)
override
;
BluetoothGattCharacteristic
(
nsPIDOMWindowInner
*
aOwner
BluetoothGattService
*
aService
const
BluetoothGattCharAttribute
&
aChar
)
;
BluetoothGattCharacteristic
(
nsPIDOMWindowInner
*
aOwner
BluetoothGattService
*
aService
const
nsAString
&
aCharacteristicUuid
const
GattPermissions
&
aPermissions
const
GattCharacteristicProperties
&
aProperties
const
ArrayBuffer
&
aValue
)
;
private
:
~
BluetoothGattCharacteristic
(
)
;
void
AssignDescriptors
(
const
nsTArray
<
BluetoothGattId
>
&
aDescriptorIds
)
;
void
HandleCharacteristicValueUpdated
(
const
BluetoothValue
&
aValue
)
;
void
AssignCharacteristicHandle
(
const
BluetoothAttributeHandle
&
aCharacteristicHandle
)
;
void
AssignDescriptorHandle
(
const
BluetoothUuid
&
aDescriptorUuid
const
BluetoothAttributeHandle
&
aDescriptorHandle
)
;
bool
IsActivated
(
)
const
{
return
mActive
;
}
nsCOMPtr
<
nsPIDOMWindowInner
>
mOwner
;
RefPtr
<
BluetoothGattService
>
mService
;
nsTArray
<
RefPtr
<
BluetoothGattDescriptor
>
>
mDescriptors
;
BluetoothGattId
mCharId
;
nsString
mUuidStr
;
nsTArray
<
uint8_t
>
mValue
;
BluetoothGattAttrPerm
mPermissions
;
BluetoothGattCharProp
mProperties
;
BluetoothGattWriteType
mWriteType
;
const
BluetoothAttRole
mAttRole
;
bool
mActive
;
BluetoothAttributeHandle
mCharacteristicHandle
;
static
const
uint16_t
sHandleCount
;
}
;
END_BLUETOOTH_NAMESPACE
template
<
>
class
nsDefaultComparator
<
RefPtr
<
mozilla
:
:
dom
:
:
bluetooth
:
:
BluetoothGattCharacteristic
>
mozilla
:
:
dom
:
:
bluetooth
:
:
BluetoothGattId
>
{
public
:
bool
Equals
(
const
RefPtr
<
mozilla
:
:
dom
:
:
bluetooth
:
:
BluetoothGattCharacteristic
>
&
aChar
const
mozilla
:
:
dom
:
:
bluetooth
:
:
BluetoothGattId
&
aCharId
)
const
{
return
aChar
-
>
GetCharacteristicId
(
)
=
=
aCharId
;
}
}
;
template
<
>
class
nsDefaultComparator
<
RefPtr
<
mozilla
:
:
dom
:
:
bluetooth
:
:
BluetoothGattCharacteristic
>
mozilla
:
:
dom
:
:
bluetooth
:
:
BluetoothUuid
>
{
public
:
bool
Equals
(
const
RefPtr
<
mozilla
:
:
dom
:
:
bluetooth
:
:
BluetoothGattCharacteristic
>
&
aChar
const
mozilla
:
:
dom
:
:
bluetooth
:
:
BluetoothUuid
&
aUuid
)
const
{
mozilla
:
:
dom
:
:
bluetooth
:
:
BluetoothUuid
uuid
;
aChar
-
>
GetUuid
(
uuid
)
;
return
uuid
=
=
aUuid
;
}
}
;
template
<
>
class
nsDefaultComparator
<
RefPtr
<
mozilla
:
:
dom
:
:
bluetooth
:
:
BluetoothGattCharacteristic
>
mozilla
:
:
dom
:
:
bluetooth
:
:
BluetoothAttributeHandle
>
{
public
:
bool
Equals
(
const
RefPtr
<
mozilla
:
:
dom
:
:
bluetooth
:
:
BluetoothGattCharacteristic
>
&
aChar
const
mozilla
:
:
dom
:
:
bluetooth
:
:
BluetoothAttributeHandle
&
aCharacteristicHandle
)
const
{
return
aChar
-
>
GetCharacteristicHandle
(
)
=
=
aCharacteristicHandle
;
}
}
;
#
endif
