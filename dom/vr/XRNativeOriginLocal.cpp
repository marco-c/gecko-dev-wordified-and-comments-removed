#
include
"
XRNativeOriginLocal
.
h
"
#
include
"
VRDisplayClient
.
h
"
namespace
mozilla
{
namespace
dom
{
XRNativeOriginLocal
:
:
XRNativeOriginLocal
(
gfx
:
:
VRDisplayClient
*
aDisplay
)
:
mDisplay
(
aDisplay
)
mInitialPositionValid
(
false
)
{
MOZ_ASSERT
(
aDisplay
)
;
}
gfx
:
:
PointDouble3D
XRNativeOriginLocal
:
:
GetPosition
(
)
{
if
(
!
mInitialPositionValid
)
{
const
gfx
:
:
VRHMDSensorState
&
sensorState
=
mDisplay
-
>
GetSensorState
(
)
;
gfx
:
:
PointDouble3D
origin
;
if
(
sensorState
.
flags
&
gfx
:
:
VRDisplayCapabilityFlags
:
:
Cap_Position
|
|
sensorState
.
flags
&
gfx
:
:
VRDisplayCapabilityFlags
:
:
Cap_PositionEmulated
)
{
mInitialPosition
.
x
=
sensorState
.
pose
.
position
[
0
]
;
mInitialPosition
.
y
=
sensorState
.
pose
.
position
[
1
]
;
mInitialPosition
.
z
=
sensorState
.
pose
.
position
[
2
]
;
mInitialPositionValid
=
true
;
}
}
return
mInitialPosition
;
}
}
}
