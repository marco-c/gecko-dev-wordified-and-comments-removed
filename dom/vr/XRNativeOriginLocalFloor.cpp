#
include
"
XRNativeOriginLocalFloor
.
h
"
namespace
mozilla
{
namespace
dom
{
XRNativeOriginLocalFloor
:
:
XRNativeOriginLocalFloor
(
VRDisplayClient
*
aDisplay
)
:
mDisplay
(
aDisplay
)
mInitialPositionValid
(
false
)
{
MOZ_ASSERT
(
aDisplay
)
;
const
double
kFloorFuzz
=
0
.
05f
;
double
floor_random
=
double
(
rand
(
)
)
/
double
(
RAND_MAX
)
*
kFloorFuzz
;
mInitialPosition
.
y
=
-
floor_random
;
}
gfx
:
:
PointDouble3D
XRNativeOriginLocalFloor
:
:
GetPosition
(
)
{
if
(
!
mInitialPositionValid
)
{
const
gfx
:
:
VRHMDSensorState
&
sensorState
=
mDisplay
-
>
GetSensorState
(
)
;
gfx
:
:
PointDouble3D
origin
;
if
(
sensorState
.
flags
&
VRDisplayCapabilityFlags
:
:
Cap_Position
)
{
mInitialPosition
.
x
=
sensorState
.
pose
.
position
[
0
]
;
mInitialPosition
.
z
=
sensorState
.
pose
.
position
[
2
]
;
mInitialPositionValid
=
true
;
}
}
return
mInitialPosition
;
}
}
}
