#
ifndef
mozilla_dom_cache_CacheOpParent_h
#
define
mozilla_dom_cache_CacheOpParent_h
#
include
"
mozilla
/
InitializedOnce
.
h
"
#
include
"
mozilla
/
dom
/
cache
/
Manager
.
h
"
#
include
"
mozilla
/
dom
/
cache
/
PCacheOpParent
.
h
"
#
include
"
mozilla
/
dom
/
cache
/
PrincipalVerifier
.
h
"
#
include
"
nsTArray
.
h
"
namespace
mozilla
{
namespace
ipc
{
class
PBackgroundParent
;
}
namespace
dom
:
:
cache
{
class
CacheOpParent
final
:
public
PCacheOpParent
public
PrincipalVerifier
:
:
Listener
public
Manager
:
:
Listener
{
using
Manager
:
:
Listener
:
:
OnOpComplete
;
public
:
CacheOpParent
(
const
WeakRefParentType
&
aIpcManager
const
CacheOpArgs
&
aOpArgs
CacheId
aCacheId
=
INVALID_CACHE_ID
Namespace
aNamespace
=
INVALID_NAMESPACE
)
;
void
Execute
(
const
SafeRefPtr
<
ManagerId
>
&
aManagerId
)
;
void
Execute
(
SafeRefPtr
<
cache
:
:
Manager
>
aManager
)
;
void
WaitForVerification
(
PrincipalVerifier
*
aVerifier
)
;
NS_INLINE_DECL_REFCOUNTING
(
CacheOpParent
override
)
private
:
~
CacheOpParent
(
)
;
virtual
void
ActorDestroy
(
ActorDestroyReason
aReason
)
override
;
virtual
void
OnPrincipalVerified
(
nsresult
aRv
const
SafeRefPtr
<
ManagerId
>
&
aManagerId
)
override
;
virtual
void
OnOpComplete
(
ErrorResult
&
&
aRv
const
CacheOpResult
&
aResult
CacheId
aOpenedCacheId
const
Maybe
<
StreamInfo
>
&
aStreamInfo
)
override
;
already_AddRefed
<
nsIInputStream
>
DeserializeCacheStream
(
const
Maybe
<
CacheReadStream
>
&
aMaybeStream
)
;
void
ProcessCrossOriginResourcePolicyHeader
(
ErrorResult
&
aRv
const
nsTArray
<
SavedResponse
>
&
aResponses
)
;
mozilla
:
:
LazyInitializedOnceEarlyDestructible
<
const
WeakRefParentType
>
mIpcManager
;
const
CacheId
mCacheId
;
const
Namespace
mNamespace
;
const
CacheOpArgs
mOpArgs
;
SafeRefPtr
<
cache
:
:
Manager
>
mManager
;
RefPtr
<
PrincipalVerifier
>
mVerifier
;
}
;
}
}
#
endif
