#
ifndef
mozilla_dom_cache_CacheStreamControlParent_h
#
define
mozilla_dom_cache_CacheStreamControlParent_h
#
include
"
mozilla
/
dom
/
cache
/
Manager
.
h
"
#
include
"
mozilla
/
dom
/
cache
/
PCacheStreamControlParent
.
h
"
#
include
"
mozilla
/
dom
/
cache
/
StreamControl
.
h
"
#
include
"
nsTObserverArray
.
h
"
namespace
mozilla
{
namespace
ipc
{
class
AutoIPCStream
;
}
namespace
dom
{
namespace
cache
{
class
ReadStream
;
class
StreamList
;
class
CacheStreamControlParent
final
:
public
PCacheStreamControlParent
public
StreamControl
Manager
:
:
Listener
{
friend
class
PCacheStreamControlParent
;
public
:
CacheStreamControlParent
(
)
;
void
SetStreamList
(
SafeRefPtr
<
StreamList
>
aStreamList
)
;
void
CloseAll
(
)
;
void
Shutdown
(
)
;
virtual
void
SerializeControl
(
CacheReadStream
*
aReadStreamOut
)
override
;
virtual
void
SerializeStream
(
CacheReadStream
*
aReadStreamOut
nsIInputStream
*
aStream
nsTArray
<
UniquePtr
<
mozilla
:
:
ipc
:
:
AutoIPCStream
>
>
&
aStreamCleanupList
)
override
;
virtual
void
OpenStream
(
const
nsID
&
aId
InputStreamResolver
&
&
aResolver
)
override
;
private
:
~
CacheStreamControlParent
(
)
;
virtual
void
NoteClosedAfterForget
(
const
nsID
&
aId
)
override
;
#
ifdef
DEBUG
virtual
void
AssertOwningThread
(
)
override
;
#
endif
virtual
void
ActorDestroy
(
ActorDestroyReason
aReason
)
override
;
mozilla
:
:
ipc
:
:
IPCResult
RecvOpenStream
(
const
nsID
&
aStreamId
OpenStreamResolver
&
&
aResolve
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvNoteClosed
(
const
nsID
&
aId
)
;
void
NotifyCloseAll
(
)
;
SafeRefPtr
<
StreamList
>
mStreamList
;
NS_DECL_OWNINGTHREAD
NS_INLINE_DECL_THREADSAFE_REFCOUNTING
(
CacheStreamControlParent
override
)
}
;
}
}
}
#
endif
