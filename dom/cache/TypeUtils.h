#
ifndef
mozilla_dom_cache_TypesUtils_h
#
define
mozilla_dom_cache_TypesUtils_h
#
include
"
mozilla
/
AlreadyAddRefed
.
h
"
#
include
"
mozilla
/
UniquePtr
.
h
"
#
include
"
mozilla
/
dom
/
HeadersBinding
.
h
"
#
include
"
mozilla
/
dom
/
SafeRefPtr
.
h
"
#
include
"
nsStringFwd
.
h
"
class
nsIGlobalObject
;
class
nsIAsyncInputStream
;
class
nsIInputStream
;
namespace
mozilla
{
namespace
ipc
{
class
PBackgroundChild
;
class
AutoIPCStream
;
}
namespace
dom
{
struct
CacheQueryOptions
;
struct
MultiCacheQueryOptions
;
class
InternalHeaders
;
class
InternalRequest
;
class
InternalResponse
;
class
OwningRequestOrUSVString
;
class
Request
;
class
RequestOrUSVString
;
class
Response
;
namespace
cache
{
class
CacheQueryParams
;
class
CacheReadStream
;
class
CacheRequest
;
class
CacheResponse
;
class
HeadersEntry
;
class
TypeUtils
{
public
:
enum
BodyAction
{
IgnoreBody
ReadBody
}
;
enum
SchemeAction
{
IgnoreInvalidScheme
TypeErrorOnInvalidScheme
}
;
~
TypeUtils
(
)
=
default
;
virtual
nsIGlobalObject
*
GetGlobalObject
(
)
const
=
0
;
#
ifdef
DEBUG
virtual
void
AssertOwningThread
(
)
const
=
0
;
#
else
inline
void
AssertOwningThread
(
)
const
{
}
#
endif
virtual
mozilla
:
:
ipc
:
:
PBackgroundChild
*
GetIPCManager
(
)
=
0
;
SafeRefPtr
<
InternalRequest
>
ToInternalRequest
(
JSContext
*
aCx
const
RequestOrUSVString
&
aIn
BodyAction
aBodyAction
ErrorResult
&
aRv
)
;
SafeRefPtr
<
InternalRequest
>
ToInternalRequest
(
JSContext
*
aCx
const
OwningRequestOrUSVString
&
aIn
BodyAction
aBodyAction
ErrorResult
&
aRv
)
;
void
ToCacheRequest
(
CacheRequest
&
aOut
const
InternalRequest
&
aIn
BodyAction
aBodyAction
SchemeAction
aSchemeAction
nsTArray
<
UniquePtr
<
mozilla
:
:
ipc
:
:
AutoIPCStream
>
>
&
aStreamCleanupList
ErrorResult
&
aRv
)
;
void
ToCacheResponseWithoutBody
(
CacheResponse
&
aOut
InternalResponse
&
aIn
ErrorResult
&
aRv
)
;
void
ToCacheResponse
(
JSContext
*
aCx
CacheResponse
&
aOut
Response
&
aIn
nsTArray
<
UniquePtr
<
mozilla
:
:
ipc
:
:
AutoIPCStream
>
>
&
aStreamCleanupList
ErrorResult
&
aRv
)
;
void
ToCacheQueryParams
(
CacheQueryParams
&
aOut
const
CacheQueryOptions
&
aIn
)
;
void
ToCacheQueryParams
(
CacheQueryParams
&
aOut
const
MultiCacheQueryOptions
&
aIn
)
;
already_AddRefed
<
Response
>
ToResponse
(
const
CacheResponse
&
aIn
)
;
SafeRefPtr
<
InternalRequest
>
ToInternalRequest
(
const
CacheRequest
&
aIn
)
;
SafeRefPtr
<
Request
>
ToRequest
(
const
CacheRequest
&
aIn
)
;
static
already_AddRefed
<
InternalHeaders
>
ToInternalHeaders
(
const
nsTArray
<
HeadersEntry
>
&
aHeadersEntryList
HeadersGuardEnum
aGuard
=
HeadersGuardEnum
:
:
None
)
;
static
void
ProcessURL
(
nsACString
&
aUrl
bool
*
aSchemeValidOut
nsACString
*
aUrlWithoutQueryOut
nsACString
*
aUrlQueryOut
ErrorResult
&
aRv
)
;
private
:
void
CheckAndSetBodyUsed
(
JSContext
*
aCx
Request
&
aRequest
BodyAction
aBodyAction
ErrorResult
&
aRv
)
;
SafeRefPtr
<
InternalRequest
>
ToInternalRequest
(
const
nsAString
&
aIn
ErrorResult
&
aRv
)
;
void
SerializeCacheStream
(
nsIInputStream
*
aStream
Maybe
<
CacheReadStream
>
*
aStreamOut
nsTArray
<
UniquePtr
<
mozilla
:
:
ipc
:
:
AutoIPCStream
>
>
&
aStreamCleanupList
ErrorResult
&
aRv
)
;
void
SerializeSendStream
(
nsIInputStream
*
aStream
CacheReadStream
&
aReadStreamOut
ErrorResult
&
aRv
)
;
}
;
}
}
}
#
endif
