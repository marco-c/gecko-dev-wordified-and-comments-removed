#
ifndef
mozilla_dom_WebAuthnManager_h
#
define
mozilla_dom_WebAuthnManager_h
#
include
"
nsIIPCBackgroundChildCreateCallback
.
h
"
#
include
"
mozilla
/
MozPromise
.
h
"
#
include
"
mozilla
/
dom
/
PWebAuthnTransaction
.
h
"
namespace
mozilla
{
namespace
dom
{
struct
Account
;
class
ArrayBufferViewOrArrayBuffer
;
struct
AssertionOptions
;
class
OwningArrayBufferViewOrArrayBuffer
;
struct
ScopedCredentialOptions
;
struct
ScopedCredentialParameters
;
class
Promise
;
class
WebAuthnTransactionChild
;
class
WebAuthnTransactionInfo
;
class
WebAuthnManager
final
:
public
nsIIPCBackgroundChildCreateCallback
{
public
:
NS_DECL_ISUPPORTS
static
WebAuthnManager
*
GetOrCreate
(
)
;
static
WebAuthnManager
*
Get
(
)
;
void
FinishMakeCredential
(
nsTArray
<
uint8_t
>
&
aRegBuffer
nsTArray
<
uint8_t
>
&
aSigBuffer
)
;
void
FinishGetAssertion
(
nsTArray
<
uint8_t
>
&
aCredentialId
nsTArray
<
uint8_t
>
&
aSigBuffer
)
;
void
Cancel
(
const
nsresult
&
aError
)
;
already_AddRefed
<
Promise
>
MakeCredential
(
nsPIDOMWindowInner
*
aParent
JSContext
*
aCx
const
Account
&
aAccountInformation
const
Sequence
<
ScopedCredentialParameters
>
&
aCryptoParameters
const
ArrayBufferViewOrArrayBuffer
&
aAttestationChallenge
const
ScopedCredentialOptions
&
aOptions
)
;
already_AddRefed
<
Promise
>
GetAssertion
(
nsPIDOMWindowInner
*
aParent
const
ArrayBufferViewOrArrayBuffer
&
aAssertionChallenge
const
AssertionOptions
&
aOptions
)
;
void
StartRegister
(
)
;
void
StartSign
(
)
;
void
ActorCreated
(
PBackgroundChild
*
aActor
)
override
;
void
ActorFailed
(
)
override
;
void
ActorDestroyed
(
)
;
private
:
WebAuthnManager
(
)
;
virtual
~
WebAuthnManager
(
)
;
void
MaybeClearTransaction
(
)
;
already_AddRefed
<
MozPromise
<
nsresult
nsresult
false
>
>
GetOrCreateBackgroundActor
(
)
;
RefPtr
<
Promise
>
mTransactionPromise
;
RefPtr
<
WebAuthnTransactionChild
>
mChild
;
nsCOMPtr
<
nsPIDOMWindowInner
>
mCurrentParent
;
Maybe
<
nsCString
>
mClientData
;
Maybe
<
WebAuthnTransactionInfo
>
mInfo
;
MozPromiseHolder
<
MozPromise
<
nsresult
nsresult
false
>
>
mPBackgroundCreationPromise
;
}
;
}
}
#
endif
