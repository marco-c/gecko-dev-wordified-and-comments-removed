#
ifndef
mozilla_dom_U2FTokenManager_h
#
define
mozilla_dom_U2FTokenManager_h
#
include
"
mozilla
/
dom
/
PWebAuthnTransaction
.
h
"
#
include
"
mozilla
/
MozPromise
.
h
"
namespace
mozilla
{
namespace
dom
{
class
U2FTokenTransport
;
class
U2FSoftTokenManager
;
class
WebAuthnTransactionParent
;
class
U2FTokenManager
final
{
struct
U2FPrefs
{
bool
softTokenEnabled
;
uint32_t
softTokenCounter
;
}
;
typedef
MozPromise
<
bool
nsresult
false
>
PrefPromise
;
public
:
enum
TransactionType
{
RegisterTransaction
=
0
SignTransaction
NumTransactionTypes
}
;
NS_INLINE_DECL_REFCOUNTING
(
U2FTokenManager
)
static
U2FTokenManager
*
Get
(
)
;
void
Register
(
WebAuthnTransactionParent
*
aTransactionParent
const
WebAuthnTransactionInfo
&
aTransactionInfo
)
;
void
Sign
(
WebAuthnTransactionParent
*
aTransactionParent
const
WebAuthnTransactionInfo
&
aTransactionInfo
)
;
void
MaybeClearTransaction
(
WebAuthnTransactionParent
*
aParent
)
;
static
void
Initialize
(
)
;
private
:
U2FTokenManager
(
)
;
~
U2FTokenManager
(
)
;
void
Cancel
(
const
nsresult
&
aError
)
;
WebAuthnTransactionParent
*
mTransactionParent
;
RefPtr
<
U2FSoftTokenManager
>
mSoftTokenManager
;
}
;
}
}
#
endif
