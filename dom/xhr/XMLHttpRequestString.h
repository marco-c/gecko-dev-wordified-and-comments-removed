#
ifndef
mozilla_dom_XMLHttpRequestString_h
#
define
mozilla_dom_XMLHttpRequestString_h
#
include
"
mozilla
/
Mutex
.
h
"
#
include
"
nsString
.
h
"
namespace
mozilla
{
namespace
dom
{
class
DOMString
;
class
XMLHttpRequestStringBuffer
;
class
XMLHttpRequestStringSnapshot
;
class
XMLHttpRequestStringWriterHelper
;
class
XMLHttpRequestStringSnapshotReaderHelper
;
class
XMLHttpRequestString
final
{
friend
class
XMLHttpRequestStringWriterHelper
;
public
:
XMLHttpRequestString
(
)
;
~
XMLHttpRequestString
(
)
;
void
Truncate
(
)
;
uint32_t
Length
(
)
const
;
void
Append
(
const
nsAString
&
aString
)
;
MOZ_MUST_USE
bool
GetAsString
(
nsAString
&
aString
)
const
;
size_t
SizeOfThis
(
MallocSizeOf
aMallocSizeOf
)
const
;
const
char16_t
*
Data
(
)
const
;
bool
IsEmpty
(
)
const
;
void
CreateSnapshot
(
XMLHttpRequestStringSnapshot
&
aSnapshot
)
;
private
:
XMLHttpRequestString
(
const
XMLHttpRequestString
&
)
=
delete
;
XMLHttpRequestString
&
operator
=
(
const
XMLHttpRequestString
&
)
=
delete
;
XMLHttpRequestString
&
operator
=
(
const
XMLHttpRequestString
&
&
)
=
delete
;
RefPtr
<
XMLHttpRequestStringBuffer
>
mBuffer
;
}
;
class
MOZ_STACK_CLASS
XMLHttpRequestStringWriterHelper
final
{
public
:
explicit
XMLHttpRequestStringWriterHelper
(
XMLHttpRequestString
&
aString
)
;
uint32_t
Length
(
)
const
;
mozilla
:
:
BulkWriteHandle
<
char16_t
>
BulkWrite
(
uint32_t
aCapacity
nsresult
&
aRv
)
;
private
:
XMLHttpRequestStringWriterHelper
(
const
XMLHttpRequestStringWriterHelper
&
)
=
delete
;
XMLHttpRequestStringWriterHelper
&
operator
=
(
const
XMLHttpRequestStringWriterHelper
&
)
=
delete
;
XMLHttpRequestStringWriterHelper
&
operator
=
(
const
XMLHttpRequestStringWriterHelper
&
&
)
=
delete
;
RefPtr
<
XMLHttpRequestStringBuffer
>
mBuffer
;
MutexAutoLock
mLock
;
}
;
class
XMLHttpRequestStringSnapshot
final
{
friend
class
XMLHttpRequestStringBuffer
;
friend
class
XMLHttpRequestStringSnapshotReaderHelper
;
public
:
XMLHttpRequestStringSnapshot
(
)
;
~
XMLHttpRequestStringSnapshot
(
)
;
XMLHttpRequestStringSnapshot
&
operator
=
(
const
XMLHttpRequestStringSnapshot
&
)
=
delete
;
void
Reset
(
)
{
ResetInternal
(
false
)
;
}
void
SetVoid
(
)
{
ResetInternal
(
true
)
;
}
bool
IsVoid
(
)
const
{
return
mVoid
;
}
bool
IsEmpty
(
)
const
{
return
!
mLength
;
}
MOZ_MUST_USE
bool
GetAsString
(
DOMString
&
aString
)
const
;
private
:
XMLHttpRequestStringSnapshot
(
const
XMLHttpRequestStringSnapshot
&
)
=
delete
;
XMLHttpRequestStringSnapshot
&
operator
=
(
const
XMLHttpRequestStringSnapshot
&
&
)
=
delete
;
void
Set
(
XMLHttpRequestStringBuffer
*
aBuffer
uint32_t
aLength
)
;
void
ResetInternal
(
bool
aIsVoid
)
;
RefPtr
<
XMLHttpRequestStringBuffer
>
mBuffer
;
uint32_t
mLength
;
bool
mVoid
;
}
;
class
MOZ_STACK_CLASS
XMLHttpRequestStringSnapshotReaderHelper
final
{
public
:
explicit
XMLHttpRequestStringSnapshotReaderHelper
(
XMLHttpRequestStringSnapshot
&
aSnapshot
)
;
const
char16_t
*
Buffer
(
)
const
;
uint32_t
Length
(
)
const
;
private
:
XMLHttpRequestStringSnapshotReaderHelper
(
const
XMLHttpRequestStringSnapshotReaderHelper
&
)
=
delete
;
XMLHttpRequestStringSnapshotReaderHelper
&
operator
=
(
const
XMLHttpRequestStringSnapshotReaderHelper
&
)
=
delete
;
XMLHttpRequestStringSnapshotReaderHelper
&
operator
=
(
const
XMLHttpRequestStringSnapshotReaderHelper
&
&
)
=
delete
;
RefPtr
<
XMLHttpRequestStringBuffer
>
mBuffer
;
MutexAutoLock
mLock
;
}
;
}
}
#
endif
