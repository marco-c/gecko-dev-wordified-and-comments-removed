add_task
(
async
function
test
(
)
{
const
url
=
"
http
:
/
/
mochi
.
test
:
8888
/
browser
/
dom
/
xhr
/
tests
/
browser_xhr_onchange_leak
.
html
"
;
let
newTab
=
await
BrowserTestUtils
.
openNewForegroundTab
(
gBrowser
url
)
;
let
browser
=
gBrowser
.
selectedBrowser
;
let
origContentProcessId
=
browser
.
frameLoader
.
remoteTab
.
contentProcessId
;
let
pageShowPromise
=
BrowserTestUtils
.
waitForContentEvent
(
browser
"
pageshow
"
true
)
;
BrowserTestUtils
.
startLoadingURIString
(
browser
"
http
:
/
/
mochi
.
test
:
8888
/
"
)
;
await
pageShowPromise
;
is
(
browser
.
frameLoader
.
remoteTab
.
contentProcessId
origContentProcessId
"
we
must
still
be
in
the
same
process
after
we
navigate
"
+
"
so
the
entire
process
with
the
possibly
-
leaking
window
"
+
"
doesn
'
t
get
torn
down
"
)
;
BrowserTestUtils
.
removeTab
(
newTab
)
;
}
)
;
