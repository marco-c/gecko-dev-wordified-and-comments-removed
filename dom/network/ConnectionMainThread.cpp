#
include
<
limits
>
#
include
"
mozilla
/
Hal
.
h
"
#
include
"
ConnectionMainThread
.
h
"
namespace
mozilla
:
:
dom
:
:
network
{
ConnectionMainThread
:
:
ConnectionMainThread
(
nsPIDOMWindowInner
*
aWindow
bool
aShouldResistFingerprinting
)
:
Connection
(
aWindow
aShouldResistFingerprinting
)
{
hal
:
:
RegisterNetworkObserver
(
this
)
;
hal
:
:
NetworkInformation
networkInfo
;
hal
:
:
GetCurrentNetworkInformation
(
&
networkInfo
)
;
UpdateFromNetworkInfo
(
networkInfo
false
)
;
}
ConnectionMainThread
:
:
~
ConnectionMainThread
(
)
{
Shutdown
(
)
;
}
void
ConnectionMainThread
:
:
ShutdownInternal
(
)
{
hal
:
:
UnregisterNetworkObserver
(
this
)
;
}
void
ConnectionMainThread
:
:
UpdateFromNetworkInfo
(
const
hal
:
:
NetworkInformation
&
aNetworkInfo
bool
aNotify
)
{
Update
(
static_cast
<
ConnectionType
>
(
aNetworkInfo
.
type
(
)
)
aNetworkInfo
.
isWifi
(
)
aNetworkInfo
.
dhcpGateway
(
)
aNotify
)
;
}
void
ConnectionMainThread
:
:
Notify
(
const
hal
:
:
NetworkInformation
&
aNetworkInfo
)
{
UpdateFromNetworkInfo
(
aNetworkInfo
true
)
;
}
}
