#
ifndef
nsXBLWindowKeyHandler_h__
#
define
nsXBLWindowKeyHandler_h__
#
include
"
mozilla
/
EventForwards
.
h
"
#
include
"
mozilla
/
layers
/
KeyboardMap
.
h
"
#
include
"
nsWeakPtr
.
h
"
#
include
"
nsIDOMEventListener
.
h
"
class
nsAtom
;
class
nsXBLPrototypeHandler
;
namespace
mozilla
{
class
EventListenerManager
;
class
WidgetKeyboardEvent
;
struct
IgnoreModifierState
;
namespace
dom
{
class
Element
;
class
EventTarget
;
class
KeyboardEvent
;
}
}
class
nsXBLWindowKeyHandler
:
public
nsIDOMEventListener
{
typedef
mozilla
:
:
EventListenerManager
EventListenerManager
;
typedef
mozilla
:
:
IgnoreModifierState
IgnoreModifierState
;
typedef
mozilla
:
:
layers
:
:
KeyboardMap
KeyboardMap
;
typedef
mozilla
:
:
dom
:
:
KeyboardEvent
KeyboardEvent
;
public
:
nsXBLWindowKeyHandler
(
mozilla
:
:
dom
:
:
Element
*
aElement
mozilla
:
:
dom
:
:
EventTarget
*
aTarget
)
;
void
InstallKeyboardEventListenersTo
(
EventListenerManager
*
aEventListenerManager
)
;
void
RemoveKeyboardEventListenersFrom
(
EventListenerManager
*
aEventListenerManager
)
;
static
KeyboardMap
CollectKeyboardShortcuts
(
)
;
NS_DECL_ISUPPORTS
NS_DECL_NSIDOMEVENTLISTENER
protected
:
virtual
~
nsXBLWindowKeyHandler
(
)
;
nsresult
WalkHandlers
(
KeyboardEvent
*
aKeyEvent
nsAtom
*
aEventType
)
;
bool
WalkHandlersInternal
(
KeyboardEvent
*
aKeyEvent
nsAtom
*
aEventType
bool
aExecute
bool
*
aOutReservedForChrome
=
nullptr
)
;
bool
WalkHandlersAndExecute
(
KeyboardEvent
*
aKeyEvent
nsAtom
*
aEventType
uint32_t
aCharCode
const
IgnoreModifierState
&
aIgnoreModifierState
bool
aExecute
bool
*
aOutReservedForChrome
=
nullptr
)
;
void
HandleEventOnCaptureInDefaultEventGroup
(
KeyboardEvent
*
aEvent
)
;
void
HandleEventOnCaptureInSystemEventGroup
(
KeyboardEvent
*
aEvent
)
;
bool
HasHandlerForEvent
(
KeyboardEvent
*
aEvent
bool
*
aOutReservedForChrome
=
nullptr
)
;
bool
IsReservedKey
(
mozilla
:
:
WidgetKeyboardEvent
*
aKeyEvent
nsXBLPrototypeHandler
*
aHandler
)
;
nsAtom
*
ConvertEventToDOMEventType
(
const
mozilla
:
:
WidgetKeyboardEvent
&
aWidgetKeyboardEvent
)
const
;
nsresult
EnsureHandlers
(
)
;
bool
IsHTMLEditableFieldFocused
(
)
;
already_AddRefed
<
mozilla
:
:
dom
:
:
Element
>
GetElement
(
bool
*
aIsDisabled
=
nullptr
)
;
bool
GetElementForHandler
(
nsXBLPrototypeHandler
*
aHandler
mozilla
:
:
dom
:
:
Element
*
*
aElementForHandler
)
;
bool
IsExecutableElement
(
mozilla
:
:
dom
:
:
Element
*
aElement
)
const
;
nsWeakPtr
mWeakPtrForElement
;
mozilla
:
:
dom
:
:
EventTarget
*
mTarget
;
nsXBLPrototypeHandler
*
mHandler
;
}
;
already_AddRefed
<
nsXBLWindowKeyHandler
>
NS_NewXBLWindowKeyHandler
(
mozilla
:
:
dom
:
:
Element
*
aElement
mozilla
:
:
dom
:
:
EventTarget
*
aTarget
)
;
#
endif
