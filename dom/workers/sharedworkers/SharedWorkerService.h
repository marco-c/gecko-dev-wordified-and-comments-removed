#
ifndef
mozilla_dom_SharedWorkerService_h
#
define
mozilla_dom_SharedWorkerService_h
#
include
"
mozilla
/
dom
/
quota
/
CheckedUnsafePtr
.
h
"
#
include
"
nsISupportsImpl
.
h
"
#
include
"
nsTArray
.
h
"
class
nsIEventTarget
;
namespace
mozilla
{
namespace
ipc
{
class
PrincipalInfo
;
}
namespace
dom
{
class
MessagePortIdentifier
;
class
RemoteWorkerData
;
class
SharedWorkerManager
;
class
SharedWorkerParent
;
class
UniqueMessagePortId
;
class
SharedWorkerService
final
{
public
:
NS_INLINE_DECL_THREADSAFE_REFCOUNTING
(
SharedWorkerService
)
;
static
already_AddRefed
<
SharedWorkerService
>
GetOrCreate
(
)
;
static
SharedWorkerService
*
Get
(
)
;
void
GetOrCreateWorkerManager
(
SharedWorkerParent
*
aActor
const
RemoteWorkerData
&
aData
uint64_t
aWindowID
const
MessagePortIdentifier
&
aPortIdentifier
)
;
void
GetOrCreateWorkerManagerOnMainThread
(
nsIEventTarget
*
aBackgroundEventTarget
SharedWorkerParent
*
aActor
const
RemoteWorkerData
&
aData
uint64_t
aWindowID
UniqueMessagePortId
&
aPortIdentifier
)
;
void
RemoveWorkerManagerOnMainThread
(
SharedWorkerManager
*
aManager
)
;
private
:
SharedWorkerService
(
)
=
default
;
~
SharedWorkerService
(
)
=
default
;
void
ErrorPropagationOnMainThread
(
nsIEventTarget
*
aBackgroundEventTarget
SharedWorkerParent
*
aActor
nsresult
aError
)
;
void
MismatchOptionsErrorPropagationOnMainThread
(
nsIEventTarget
*
aBackgroundEventTarget
SharedWorkerParent
*
aActor
)
;
nsTArray
<
RefPtr
<
SharedWorkerManager
>
>
mWorkerManagers
;
}
;
}
}
#
endif
