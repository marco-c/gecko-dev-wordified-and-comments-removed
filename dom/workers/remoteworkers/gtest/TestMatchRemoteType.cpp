#
include
"
gtest
/
gtest
.
h
"
#
include
"
.
.
/
RemoteWorkerManager
.
h
"
using
namespace
mozilla
:
:
dom
;
TEST
(
RemoteWorkerManager
TestMatchRemoteType
)
{
static
const
struct
{
const
nsString
processRemoteType
;
const
nsString
workerRemoteType
;
const
bool
shouldMatch
;
}
tests
[
]
=
{
{
NS_LITERAL_STRING
(
DEFAULT_REMOTE_TYPE
)
NS_LITERAL_STRING
(
DEFAULT_REMOTE_TYPE
)
true
}
{
NS_LITERAL_STRING
(
EXTENSION_REMOTE_TYPE
)
NS_LITERAL_STRING
(
EXTENSION_REMOTE_TYPE
)
true
}
{
NS_LITERAL_STRING
(
PRIVILEGEDMOZILLA_REMOTE_TYPE
)
NS_LITERAL_STRING
(
PRIVILEGEDMOZILLA_REMOTE_TYPE
)
true
}
{
NS_LITERAL_STRING
(
PRIVILEGEDMOZILLA_REMOTE_TYPE
)
NS_LITERAL_STRING
(
DEFAULT_REMOTE_TYPE
)
false
}
{
NS_LITERAL_STRING
(
PRIVILEGEDABOUT_REMOTE_TYPE
)
NS_LITERAL_STRING
(
DEFAULT_REMOTE_TYPE
)
false
}
{
NS_LITERAL_STRING
(
EXTENSION_REMOTE_TYPE
)
NS_LITERAL_STRING
(
DEFAULT_REMOTE_TYPE
)
false
}
{
NS_LITERAL_STRING
(
FILE_REMOTE_TYPE
)
NS_LITERAL_STRING
(
DEFAULT_REMOTE_TYPE
)
false
}
{
NS_LITERAL_STRING
(
WITH_COOP_COEP_REMOTE_TYPE_PREFIX
)
NS_LITERAL_STRING
(
DEFAULT_REMOTE_TYPE
)
false
}
{
NS_LITERAL_STRING
(
LARGE_ALLOCATION_REMOTE_TYPE
)
NS_LITERAL_STRING
(
DEFAULT_REMOTE_TYPE
)
true
}
{
NS_LITERAL_STRING
(
FISSION_WEB_REMOTE_TYPE
)
NS_LITERAL_STRING
(
DEFAULT_REMOTE_TYPE
)
true
}
{
NS_LITERAL_STRING
(
DEFAULT_REMOTE_TYPE
)
EmptyString
(
)
true
}
{
NS_LITERAL_STRING
(
WITH_COOP_COEP_REMOTE_TYPE_PREFIX
)
EmptyString
(
)
false
}
{
NS_LITERAL_STRING
(
PRIVILEGEDMOZILLA_REMOTE_TYPE
)
EmptyString
(
)
false
}
{
NS_LITERAL_STRING
(
EXTENSION_REMOTE_TYPE
)
EmptyString
(
)
false
}
}
;
for
(
const
auto
&
test
:
tests
)
{
auto
message
=
nsPrintfCString
(
R
"
(
MatchRemoteType
(
"
%
s
"
"
%
s
"
)
should
return
%
s
)
"
NS_ConvertUTF16toUTF8
(
test
.
processRemoteType
)
.
get
(
)
NS_ConvertUTF16toUTF8
(
test
.
workerRemoteType
)
.
get
(
)
test
.
shouldMatch
?
"
true
"
:
"
false
"
)
;
ASSERT_EQ
(
RemoteWorkerManager
:
:
MatchRemoteType
(
test
.
processRemoteType
test
.
workerRemoteType
)
test
.
shouldMatch
)
<
<
message
;
}
}
