"
use
strict
"
;
const
TAB_URL
=
EXAMPLE_URL
+
"
bug1047663_tab
.
html
"
;
const
WORKER_URL
=
EXAMPLE_URL
+
"
bug1047663_worker
.
sjs
"
;
function
test
(
)
{
waitForExplicitFinish
(
)
;
let
rcwnEnabled
=
Preferences
.
get
(
"
network
.
http
.
rcwn
.
enabled
"
)
;
Preferences
.
set
(
"
network
.
http
.
rcwn
.
enabled
"
false
)
;
registerCleanupFunction
(
(
)
=
>
{
Preferences
.
set
(
"
network
.
http
.
rcwn
.
enabled
"
rcwnEnabled
)
;
}
)
;
(
async
function
(
)
{
let
tab
=
await
addTab
(
TAB_URL
)
;
await
createWorkerInTab
(
tab
WORKER_URL
)
;
let
message
=
await
postMessageToWorkerInTab
(
tab
WORKER_URL
"
ping
"
)
;
is
(
message
"
one
"
)
;
await
terminateWorkerInTab
(
tab
WORKER_URL
)
;
await
createWorkerInTab
(
tab
WORKER_URL
)
;
message
=
await
postMessageToWorkerInTab
(
tab
WORKER_URL
"
ping
"
)
;
is
(
message
"
one
"
)
;
await
terminateWorkerInTab
(
tab
WORKER_URL
)
;
await
disableCacheInTab
(
tab
)
;
await
createWorkerInTab
(
tab
WORKER_URL
)
;
message
=
await
postMessageToWorkerInTab
(
tab
WORKER_URL
"
ping
"
)
;
is
(
message
"
two
"
)
;
await
terminateWorkerInTab
(
tab
WORKER_URL
)
;
removeTab
(
tab
)
;
finish
(
)
;
}
)
(
)
;
}
