function
workerTestExec
(
script
)
{
SimpleTest
.
waitForExplicitFinish
(
)
;
var
worker
=
new
Worker
(
'
worker_wrapper
.
js
'
)
;
worker
.
onmessage
=
function
(
event
)
{
if
(
event
.
data
.
type
=
=
'
finish
'
)
{
SimpleTest
.
finish
(
)
;
}
else
if
(
event
.
data
.
type
=
=
'
status
'
)
{
ok
(
event
.
data
.
status
event
.
data
.
msg
)
;
}
else
if
(
event
.
data
.
type
=
=
'
getVersion
'
)
{
var
result
=
SpecialPowers
.
Cc
[
'
mozilla
.
org
/
xre
/
app
-
info
;
1
'
]
.
getService
(
SpecialPowers
.
Ci
.
nsIXULAppInfo
)
.
version
;
worker
.
postMessage
(
{
type
:
'
returnVersion
'
result
:
result
}
)
;
}
else
if
(
event
.
data
.
type
=
=
'
getUserAgent
'
)
{
worker
.
postMessage
(
{
type
:
'
returnUserAgent
'
result
:
navigator
.
userAgent
}
)
;
}
else
if
(
event
.
data
.
type
=
=
'
getOSCPU
'
)
{
worker
.
postMessage
(
{
type
:
'
returnOSCPU
'
result
:
navigator
.
oscpu
}
)
;
}
}
worker
.
onerror
=
function
(
event
)
{
ok
(
false
'
Worker
had
an
error
:
'
+
event
.
data
)
;
SimpleTest
.
finish
(
)
;
}
;
worker
.
postMessage
(
{
script
:
script
}
)
;
}
