#
ifndef
mozilla_dom_workers_WorkerLoadContext_h__
#
define
mozilla_dom_workers_WorkerLoadContext_h__
#
include
"
nsIInputStream
.
h
"
#
include
"
nsIRequest
.
h
"
#
include
"
mozilla
/
CORSMode
.
h
"
#
include
"
mozilla
/
dom
/
Promise
.
h
"
#
include
"
js
/
loader
/
ScriptKind
.
h
"
#
include
"
js
/
loader
/
ScriptLoadRequest
.
h
"
#
include
"
js
/
loader
/
LoadContextBase
.
h
"
class
nsIReferrerInfo
;
class
nsIURI
;
namespace
mozilla
:
:
dom
{
class
ClientInfo
;
class
WorkerPrivate
;
namespace
workerinternals
:
:
loader
{
class
CacheCreator
;
}
class
WorkerLoadContext
:
public
JS
:
:
loader
:
:
LoadContextBase
{
public
:
explicit
WorkerLoadContext
(
const
nsString
&
aURL
)
;
~
WorkerLoadContext
(
)
=
default
;
nsString
mURL
;
nsString
mFullURL
;
RefPtr
<
Promise
>
mCachePromise
;
nsCOMPtr
<
nsIInputStream
>
mCacheReadStream
;
nsresult
mLoadResult
=
NS_ERROR_NOT_INITIALIZED
;
RefPtr
<
workerinternals
:
:
loader
:
:
CacheCreator
>
mCacheCreator
;
void
ClearCacheCreator
(
)
;
void
SetCacheCreator
(
RefPtr
<
workerinternals
:
:
loader
:
:
CacheCreator
>
aCacheCreator
)
;
RefPtr
<
workerinternals
:
:
loader
:
:
CacheCreator
>
GetCacheCreator
(
)
;
Maybe
<
nsString
>
mSourceMapURL
;
enum
CacheStatus
{
Uncached
WritingToCache
ReadingFromCache
Cached
ToBeCached
Cancel
}
;
CacheStatus
mCacheStatus
=
Uncached
;
Maybe
<
bool
>
mMutedErrorFlag
;
bool
IsAwaitingPromise
(
)
const
{
return
bool
(
mCachePromise
)
;
}
}
;
}
#
endif
