#
ifndef
mozilla_dom_workerinternals_JSSettings_h
#
define
mozilla_dom_workerinternals_JSSettings_h
#
include
<
stdint
.
h
>
#
include
"
js
/
ContextOptions
.
h
"
#
include
"
js
/
GCAPI
.
h
"
#
include
"
js
/
RealmOptions
.
h
"
#
include
"
mozilla
/
Maybe
.
h
"
#
include
"
nsString
.
h
"
#
include
"
nsTArray
.
h
"
namespace
mozilla
{
namespace
dom
{
namespace
workerinternals
{
const
uint32_t
kJSPrincipalsDebugToken
=
0x7e2df9d2
;
struct
JSSettings
{
struct
JSGCSetting
{
JSGCParamKey
key
;
Maybe
<
uint32_t
>
value
;
bool
operator
=
=
(
JSGCParamKey
k
)
const
{
return
key
=
=
k
;
}
}
;
JS
:
:
RealmOptions
chromeRealmOptions
;
JS
:
:
RealmOptions
contentRealmOptions
;
CopyableTArray
<
JSGCSetting
>
gcSettings
;
JS
:
:
ContextOptions
contextOptions
;
#
ifdef
JS_GC_ZEAL
uint8_t
gcZeal
=
0
;
uint32_t
gcZealFrequency
=
0
;
#
endif
bool
ApplyGCSetting
(
JSGCParamKey
aKey
Maybe
<
uint32_t
>
aValue
)
{
size_t
index
=
gcSettings
.
IndexOf
(
aKey
)
;
if
(
index
=
=
gcSettings
.
NoIndex
)
{
gcSettings
.
AppendElement
(
JSGCSetting
{
aKey
aValue
}
)
;
return
true
;
}
if
(
gcSettings
[
index
]
.
value
!
=
aValue
)
{
gcSettings
[
index
]
.
value
=
aValue
;
return
true
;
}
return
false
;
}
}
;
}
}
}
#
endif
