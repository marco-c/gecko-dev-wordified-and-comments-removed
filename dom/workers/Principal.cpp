#
include
"
Principal
.
h
"
#
include
"
jsapi
.
h
"
#
include
"
mozilla
/
Assertions
.
h
"
#
include
"
mozilla
/
dom
/
StructuredCloneTags
.
h
"
namespace
mozilla
{
namespace
dom
{
struct
WorkerPrincipal
final
:
public
JSPrincipals
{
bool
write
(
JSContext
*
aCx
JSStructuredCloneWriter
*
aWriter
)
override
{
return
JS_WriteUint32Pair
(
aWriter
SCTAG_DOM_WORKER_PRINCIPAL
0
)
;
}
}
;
JSPrincipals
*
GetWorkerPrincipal
(
)
{
static
WorkerPrincipal
sPrincipal
;
int32_t
prevRefcount
=
sPrincipal
.
refcount
+
+
;
if
(
prevRefcount
>
0
)
{
-
-
sPrincipal
.
refcount
;
}
else
{
#
ifdef
DEBUG
sPrincipal
.
debugToken
=
workerinternals
:
:
kJSPrincipalsDebugToken
;
#
endif
}
return
&
sPrincipal
;
}
void
DestroyWorkerPrincipals
(
JSPrincipals
*
aPrincipals
)
{
MOZ_ASSERT_UNREACHABLE
(
"
Worker
principals
refcount
should
never
fall
below
one
"
)
;
}
}
}
