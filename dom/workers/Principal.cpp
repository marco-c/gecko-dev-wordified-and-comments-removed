#
include
"
Principal
.
h
"
#
include
"
jsapi
.
h
"
#
include
"
mozilla
/
Assertions
.
h
"
namespace
mozilla
{
namespace
dom
{
struct
WorkerPrincipal
final
:
public
JSPrincipals
{
bool
write
(
JSContext
*
aCx
JSStructuredCloneWriter
*
aWriter
)
override
{
MOZ_CRASH
(
"
WorkerPrincipal
:
:
write
not
implemented
"
)
;
return
false
;
}
}
;
JSPrincipals
*
GetWorkerPrincipal
(
)
{
static
WorkerPrincipal
sPrincipal
;
int32_t
prevRefcount
=
sPrincipal
.
refcount
+
+
;
if
(
prevRefcount
>
0
)
{
-
-
sPrincipal
.
refcount
;
}
else
{
#
ifdef
DEBUG
sPrincipal
.
debugToken
=
workers
:
:
kJSPrincipalsDebugToken
;
#
endif
}
return
&
sPrincipal
;
}
void
DestroyWorkerPrincipals
(
JSPrincipals
*
aPrincipals
)
{
MOZ_ASSERT_UNREACHABLE
(
"
Worker
principals
refcount
should
never
fall
below
one
"
)
;
}
}
}
