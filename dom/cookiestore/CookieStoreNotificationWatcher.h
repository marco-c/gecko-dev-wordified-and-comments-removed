#
ifndef
mozilla_dom_CookieStoreNotificationWatcher_h
#
define
mozilla_dom_CookieStoreNotificationWatcher_h
#
include
"
nsIObserver
.
h
"
#
include
"
nsWeakReference
.
h
"
#
include
"
mozilla
/
OriginAttributes
.
h
"
#
include
"
mozilla
/
MoveOnlyFunction
.
h
"
namespace
mozilla
:
:
dom
{
class
CookieStoreNotificationWatcher
final
:
public
nsIObserver
public
nsSupportsWeakReference
{
public
:
NS_DECL_ISUPPORTS
NS_DECL_NSIOBSERVER
static
already_AddRefed
<
CookieStoreNotificationWatcher
>
Create
(
bool
aPrivateBrowsing
)
;
static
void
ReleaseOnMainThread
(
already_AddRefed
<
CookieStoreNotificationWatcher
>
aWatcher
)
;
void
CallbackWhenNotified
(
const
nsID
&
aOperationID
MoveOnlyFunction
<
void
(
)
>
aCallback
)
;
void
ForgetOperationID
(
const
nsID
&
aOperationID
)
;
private
:
CookieStoreNotificationWatcher
(
)
=
default
;
~
CookieStoreNotificationWatcher
(
)
=
default
;
void
MaybeResolveOperations
(
const
nsID
*
aOperationID
)
;
struct
PendingOperation
{
MoveOnlyFunction
<
void
(
)
>
mCallback
;
nsID
mOperationID
;
}
;
nsTArray
<
PendingOperation
>
mPendingOperations
;
}
;
}
#
endif
