#
ifndef
mozilla_dom_DataTransferItem_h
#
define
mozilla_dom_DataTransferItem_h
#
include
"
mozilla
/
ErrorResult
.
h
"
#
include
"
mozilla
/
dom
/
DataTransfer
.
h
"
#
include
"
mozilla
/
dom
/
DOMString
.
h
"
#
include
"
mozilla
/
dom
/
File
.
h
"
namespace
mozilla
{
namespace
dom
{
class
FileSystemEntry
;
class
FunctionStringCallback
;
class
DataTransferItem
final
:
public
nsISupports
public
nsWrapperCache
{
public
:
NS_DECL_CYCLE_COLLECTING_ISUPPORTS
NS_DECL_CYCLE_COLLECTION_SCRIPT_HOLDER_CLASS
(
DataTransferItem
)
;
public
:
enum
eKind
{
KIND_FILE
KIND_STRING
KIND_OTHER
}
;
DataTransferItem
(
DataTransfer
*
aDataTransfer
const
nsAString
&
aType
)
:
mIndex
(
0
)
mChromeOnly
(
false
)
mKind
(
KIND_OTHER
)
mType
(
aType
)
mDataTransfer
(
aDataTransfer
)
{
MOZ_ASSERT
(
mDataTransfer
"
Must
be
associated
with
a
DataTransfer
"
)
;
}
already_AddRefed
<
DataTransferItem
>
Clone
(
DataTransfer
*
aDataTransfer
)
const
;
virtual
JSObject
*
WrapObject
(
JSContext
*
aCx
JS
:
:
Handle
<
JSObject
*
>
aGivenProto
)
override
;
void
GetAsString
(
FunctionStringCallback
*
aCallback
const
Maybe
<
nsIPrincipal
*
>
&
aPrincipal
ErrorResult
&
aRv
)
;
void
GetKind
(
nsAString
&
aKind
)
const
{
switch
(
mKind
)
{
case
KIND_FILE
:
aKind
=
NS_LITERAL_STRING
(
"
file
"
)
;
return
;
case
KIND_STRING
:
aKind
=
NS_LITERAL_STRING
(
"
string
"
)
;
return
;
default
:
aKind
=
NS_LITERAL_STRING
(
"
other
"
)
;
return
;
}
}
void
GetType
(
nsAString
&
aType
)
const
{
aType
=
mType
;
}
eKind
Kind
(
)
const
{
return
mKind
;
}
void
SetKind
(
eKind
aKind
)
{
mKind
=
aKind
;
}
already_AddRefed
<
File
>
GetAsFile
(
const
Maybe
<
nsIPrincipal
*
>
&
aSubjectPrincipal
ErrorResult
&
aRv
)
;
already_AddRefed
<
FileSystemEntry
>
GetAsEntry
(
const
Maybe
<
nsIPrincipal
*
>
&
aSubjectPrincipal
ErrorResult
&
aRv
)
;
DataTransfer
*
GetParentObject
(
)
const
{
return
mDataTransfer
;
}
nsIPrincipal
*
Principal
(
)
const
{
return
mPrincipal
;
}
void
SetPrincipal
(
nsIPrincipal
*
aPrincipal
)
{
mPrincipal
=
aPrincipal
;
}
already_AddRefed
<
nsIVariant
>
DataNoSecurityCheck
(
)
;
already_AddRefed
<
nsIVariant
>
Data
(
nsIPrincipal
*
aPrincipal
ErrorResult
&
aRv
)
;
void
SetData
(
nsIVariant
*
aData
)
;
uint32_t
Index
(
)
const
{
return
mIndex
;
}
void
SetIndex
(
uint32_t
aIndex
)
{
mIndex
=
aIndex
;
}
void
FillInExternalData
(
)
;
bool
ChromeOnly
(
)
const
{
return
mChromeOnly
;
}
void
SetChromeOnly
(
bool
aChromeOnly
)
{
mChromeOnly
=
aChromeOnly
;
}
static
eKind
KindFromData
(
nsIVariant
*
aData
)
;
private
:
~
DataTransferItem
(
)
{
}
already_AddRefed
<
File
>
CreateFileFromInputStream
(
nsIInputStream
*
aStream
)
;
uint32_t
mIndex
;
bool
mChromeOnly
;
eKind
mKind
;
const
nsString
mType
;
nsCOMPtr
<
nsIVariant
>
mData
;
nsCOMPtr
<
nsIPrincipal
>
mPrincipal
;
RefPtr
<
DataTransfer
>
mDataTransfer
;
RefPtr
<
File
>
mCachedFile
;
}
;
}
}
#
endif
