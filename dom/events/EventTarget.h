#
ifndef
mozilla_dom_EventTarget_h_
#
define
mozilla_dom_EventTarget_h_
#
include
"
mozilla
/
dom
/
BindingDeclarations
.
h
"
#
include
"
mozilla
/
dom
/
Nullable
.
h
"
#
include
"
mozilla
/
dom
/
WindowProxyHolder
.
h
"
#
include
"
nsISupports
.
h
"
#
include
"
nsWrapperCache
.
h
"
#
include
"
nsAtom
.
h
"
class
nsPIDOMWindowOuter
;
class
nsIGlobalObject
;
class
nsIDOMEventListener
;
namespace
mozilla
{
class
AsyncEventDispatcher
;
class
ErrorResult
;
class
EventChainPostVisitor
;
class
EventChainPreVisitor
;
class
EventChainVisitor
;
class
EventListenerManager
;
namespace
dom
{
class
AddEventListenerOptionsOrBoolean
;
class
Event
;
class
EventListener
;
class
EventListenerOptionsOrBoolean
;
class
EventHandlerNonNull
;
class
GlobalObject
;
template
<
typename
>
struct
Nullable
;
class
WindowProxyHolder
;
#
define
NS_EVENTTARGET_IID
\
{
\
0xde651c36
0x0053
0x4c67
{
\
0xb1
0x3d
0x67
0xb9
0x40
0xfc
0x82
0xe4
\
}
\
}
class
EventTarget
:
public
nsISupports
public
nsWrapperCache
{
public
:
NS_DECLARE_STATIC_IID_ACCESSOR
(
NS_EVENTTARGET_IID
)
static
already_AddRefed
<
EventTarget
>
Constructor
(
const
GlobalObject
&
aGlobal
ErrorResult
&
aRv
)
;
void
AddEventListener
(
const
nsAString
&
aType
EventListener
*
aCallback
const
AddEventListenerOptionsOrBoolean
&
aOptions
const
Nullable
<
bool
>
&
aWantsUntrusted
ErrorResult
&
aRv
)
;
void
RemoveEventListener
(
const
nsAString
&
aType
EventListener
*
aCallback
const
EventListenerOptionsOrBoolean
&
aOptions
ErrorResult
&
aRv
)
;
protected
:
nsresult
AddEventListener
(
const
nsAString
&
aType
nsIDOMEventListener
*
aListener
bool
aUseCapture
const
Nullable
<
bool
>
&
aWantsUntrusted
)
;
public
:
nsresult
AddEventListener
(
const
nsAString
&
aType
nsIDOMEventListener
*
aListener
bool
aUseCapture
)
{
return
AddEventListener
(
aType
aListener
aUseCapture
Nullable
<
bool
>
(
)
)
;
}
nsresult
AddEventListener
(
const
nsAString
&
aType
nsIDOMEventListener
*
aListener
bool
aUseCapture
bool
aWantsUntrusted
)
{
return
AddEventListener
(
aType
aListener
aUseCapture
Nullable
<
bool
>
(
aWantsUntrusted
)
)
;
}
void
RemoveEventListener
(
const
nsAString
&
aType
nsIDOMEventListener
*
aListener
bool
aUseCapture
)
;
void
RemoveSystemEventListener
(
const
nsAString
&
aType
nsIDOMEventListener
*
aListener
bool
aUseCapture
)
;
nsresult
AddSystemEventListener
(
const
nsAString
&
aType
nsIDOMEventListener
*
aListener
bool
aUseCapture
)
{
return
AddSystemEventListener
(
aType
aListener
aUseCapture
Nullable
<
bool
>
(
)
)
;
}
nsresult
AddSystemEventListener
(
const
nsAString
&
aType
nsIDOMEventListener
*
aListener
bool
aUseCapture
bool
aWantsUntrusted
)
{
return
AddSystemEventListener
(
aType
aListener
aUseCapture
Nullable
<
bool
>
(
aWantsUntrusted
)
)
;
}
virtual
EventTarget
*
GetTargetForDOMEvent
(
)
{
return
this
;
}
;
virtual
EventTarget
*
GetTargetForEventTargetChain
(
)
{
return
this
;
}
virtual
bool
DispatchEvent
(
Event
&
aEvent
CallerType
aCallerType
ErrorResult
&
aRv
)
=
0
;
void
DispatchEvent
(
Event
&
aEvent
)
;
void
DispatchEvent
(
Event
&
aEvent
ErrorResult
&
aRv
)
;
nsIGlobalObject
*
GetParentObject
(
)
const
{
return
GetOwnerGlobal
(
)
;
}
EventHandlerNonNull
*
GetEventHandler
(
const
nsAString
&
aType
)
{
RefPtr
<
nsAtom
>
type
=
NS_Atomize
(
aType
)
;
return
GetEventHandler
(
type
)
;
}
void
SetEventHandler
(
const
nsAString
&
aType
EventHandlerNonNull
*
aHandler
ErrorResult
&
rv
)
;
virtual
void
EventListenerAdded
(
nsAtom
*
aType
)
{
}
virtual
void
EventListenerRemoved
(
nsAtom
*
aType
)
{
}
Nullable
<
WindowProxyHolder
>
GetOwnerGlobalForBindings
(
)
;
virtual
nsPIDOMWindowOuter
*
GetOwnerGlobalForBindingsInternal
(
)
=
0
;
virtual
nsIGlobalObject
*
GetOwnerGlobal
(
)
const
=
0
;
virtual
EventListenerManager
*
GetOrCreateListenerManager
(
)
=
0
;
virtual
EventListenerManager
*
GetExistingListenerManager
(
)
const
=
0
;
virtual
void
AsyncEventRunning
(
AsyncEventDispatcher
*
aEvent
)
{
}
bool
HasNonSystemGroupListenersForUntrustedKeyEvents
(
)
const
;
bool
HasNonPassiveNonSystemGroupListenersForUntrustedKeyEvents
(
)
const
;
virtual
bool
IsApzAware
(
)
const
;
virtual
void
GetEventTargetParent
(
EventChainPreVisitor
&
aVisitor
)
=
0
;
virtual
nsresult
PreHandleEvent
(
EventChainVisitor
&
aVisitor
)
{
return
NS_OK
;
}
virtual
void
WillHandleEvent
(
EventChainPostVisitor
&
aVisitor
)
{
}
virtual
nsresult
PostHandleEvent
(
EventChainPostVisitor
&
aVisitor
)
=
0
;
protected
:
EventHandlerNonNull
*
GetEventHandler
(
nsAtom
*
aType
)
;
void
SetEventHandler
(
nsAtom
*
aType
EventHandlerNonNull
*
aHandler
)
;
virtual
bool
ComputeDefaultWantsUntrusted
(
ErrorResult
&
aRv
)
=
0
;
bool
ComputeWantsUntrusted
(
const
Nullable
<
bool
>
&
aWantsUntrusted
const
AddEventListenerOptionsOrBoolean
*
aOptions
ErrorResult
&
aRv
)
;
nsresult
AddSystemEventListener
(
const
nsAString
&
aType
nsIDOMEventListener
*
aListener
bool
aUseCapture
const
Nullable
<
bool
>
&
aWantsUntrusted
)
;
}
;
NS_DEFINE_STATIC_IID_ACCESSOR
(
EventTarget
NS_EVENTTARGET_IID
)
}
}
#
endif
