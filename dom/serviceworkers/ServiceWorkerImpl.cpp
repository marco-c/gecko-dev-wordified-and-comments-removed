#
include
"
ServiceWorkerImpl
.
h
"
namespace
mozilla
{
namespace
dom
{
ServiceWorkerImpl
:
:
~
ServiceWorkerImpl
(
)
{
MOZ_DIAGNOSTIC_ASSERT
(
!
mOuter
)
;
mInfo
-
>
RemoveListener
(
this
)
;
}
void
ServiceWorkerImpl
:
:
AddServiceWorker
(
ServiceWorker
*
aWorker
)
{
MOZ_DIAGNOSTIC_ASSERT
(
!
mOuter
)
;
MOZ_DIAGNOSTIC_ASSERT
(
aWorker
)
;
mOuter
=
aWorker
;
mInfo
-
>
AddListener
(
this
)
;
}
void
ServiceWorkerImpl
:
:
RemoveServiceWorker
(
ServiceWorker
*
aWorker
)
{
MOZ_DIAGNOSTIC_ASSERT
(
mOuter
)
;
MOZ_DIAGNOSTIC_ASSERT
(
mOuter
=
=
aWorker
)
;
mOuter
=
nullptr
;
}
void
ServiceWorkerImpl
:
:
PostMessage
(
ipc
:
:
StructuredCloneData
&
&
aData
const
ClientInfo
&
aClientInfo
const
ClientState
&
aClientState
)
{
mInfo
-
>
PostMessage
(
std
:
:
move
(
aData
)
aClientInfo
aClientState
)
;
}
void
ServiceWorkerImpl
:
:
SetState
(
ServiceWorkerState
aState
)
{
if
(
!
mOuter
)
{
return
;
}
mOuter
-
>
SetState
(
aState
)
;
}
ServiceWorkerImpl
:
:
ServiceWorkerImpl
(
ServiceWorkerInfo
*
aInfo
)
:
mInfo
(
aInfo
)
mOuter
(
nullptr
)
{
MOZ_DIAGNOSTIC_ASSERT
(
mInfo
)
;
}
}
}
