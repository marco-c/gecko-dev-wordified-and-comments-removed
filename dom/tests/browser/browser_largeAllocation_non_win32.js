let
testDir
=
gTestPath
.
substr
(
0
gTestPath
.
lastIndexOf
(
"
/
"
)
)
;
Services
.
scriptloader
.
loadSubScript
(
testDir
+
"
/
helper_largeAllocation
.
js
"
this
)
;
add_task
(
async
function
(
)
{
info
(
"
Test
1
-
force
enabling
the
Large
-
Allocation
header
"
)
;
await
SpecialPowers
.
pushPrefEnv
(
{
set
:
[
[
"
dom
.
largeAllocationHeader
.
enabled
"
true
]
[
"
dom
.
largeAllocation
.
forceEnable
"
true
]
[
"
dom
.
ipc
.
processCount
.
webLargeAllocation
"
20
]
]
}
)
;
await
largeAllocSuccessTests
(
)
;
}
)
;
add_task
(
async
function
(
)
{
info
(
"
Test
2
-
not
force
enabling
the
Large
-
Allocation
header
"
)
;
await
SpecialPowers
.
pushPrefEnv
(
{
set
:
[
[
"
dom
.
largeAllocationHeader
.
enabled
"
true
]
[
"
dom
.
largeAllocation
.
forceEnable
"
false
]
[
"
dom
.
ipc
.
processCount
.
webLargeAllocation
"
20
]
]
}
)
;
await
largeAllocFailTests
(
)
;
}
)
;
