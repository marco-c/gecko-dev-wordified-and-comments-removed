add_task
(
async
function
(
)
{
const
URL
=
"
data
:
text
/
html
<
!
DOCTYPE
html
>
<
html
>
<
body
>
<
input
autofocus
id
=
'
target
'
>
<
/
body
>
<
/
html
>
"
;
const
foregroundTab
=
gBrowser
.
selectedTab
;
const
backgroundTab
=
BrowserTestUtils
.
addTab
(
gBrowser
)
;
is
(
gBrowser
.
selectedTab
foregroundTab
"
foregroundTab
should
still
be
selected
"
)
;
const
loadedPromise
=
BrowserTestUtils
.
browserLoaded
(
backgroundTab
.
linkedBrowser
false
URL
)
;
BrowserTestUtils
.
loadURI
(
backgroundTab
.
linkedBrowser
URL
)
;
await
loadedPromise
;
let
tagName
=
await
SpecialPowers
.
spawn
(
backgroundTab
.
linkedBrowser
[
]
async
function
(
)
{
return
content
.
document
.
activeElement
.
tagName
;
}
)
;
is
(
tagName
"
INPUT
"
"
The
background
tab
'
s
focused
element
should
be
the
<
input
>
"
)
;
is
(
gBrowser
.
selectedTab
foregroundTab
"
foregroundTab
tab
should
still
be
selected
shouldn
'
t
cause
a
tab
switch
"
)
;
is
(
document
.
activeElement
foregroundTab
.
linkedBrowser
"
The
background
tab
'
s
focused
element
should
not
cause
the
tab
to
be
selected
"
)
;
BrowserTestUtils
.
removeTab
(
backgroundTab
)
;
}
)
;
