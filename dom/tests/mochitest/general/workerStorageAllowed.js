function
ok
(
condition
text
)
{
if
(
!
condition
)
{
self
.
postMessage
(
"
FAILURE
:
"
+
text
)
;
}
else
{
self
.
postMessage
(
text
)
;
}
}
function
finishTest
(
)
{
self
.
postMessage
(
"
done
"
)
;
self
.
close
(
)
;
}
ok
(
typeof
self
.
localStorage
=
=
"
undefined
"
"
localStorage
should
be
undefined
"
)
;
ok
(
typeof
self
.
sessionStorage
=
=
"
undefined
"
"
sessionStorage
should
be
undefined
"
)
;
try
{
indexedDB
;
ok
(
true
"
WORKER
getting
indexedDB
didn
'
t
throw
"
)
;
}
catch
(
e
)
{
ok
(
false
"
WORKER
getting
indexedDB
should
not
throw
"
)
;
}
try
{
var
promise
=
caches
.
keys
(
)
;
ok
(
true
"
WORKER
getting
caches
didn
'
t
throw
"
)
;
promise
.
then
(
function
(
)
{
ok
(
location
.
protocol
=
=
"
https
:
"
"
WORKER
The
promise
was
not
rejected
"
)
;
workerTest
(
)
;
}
function
(
)
{
ok
(
location
.
protocol
!
=
"
https
:
"
"
WORKER
The
promise
should
not
have
been
rejected
"
)
;
workerTest
(
)
;
}
)
;
}
catch
(
e
)
{
ok
(
false
"
WORKER
getting
caches
should
not
have
thrown
"
)
;
}
function
workerTest
(
)
{
if
(
location
.
hash
=
=
"
#
inner
"
)
{
finishTest
(
)
;
return
;
}
var
worker
=
new
Worker
(
"
workerStorageAllowed
.
js
#
inner
"
)
;
worker
.
addEventListener
(
"
message
"
function
(
e
)
{
if
(
e
.
data
=
=
"
done
"
)
{
finishTest
(
)
;
return
;
}
ok
(
!
e
.
data
.
match
(
/
^
FAILURE
/
)
e
.
data
+
"
(
WORKER
=
workerStorageAllowed
.
js
#
inner
)
"
)
;
}
)
;
}
