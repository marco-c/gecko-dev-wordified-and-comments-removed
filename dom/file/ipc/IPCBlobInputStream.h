#
ifndef
mozilla_dom_ipc_IPCBlobInputStream_h
#
define
mozilla_dom_ipc_IPCBlobInputStream_h
#
include
"
nsIAsyncInputStream
.
h
"
#
include
"
nsICloneableInputStream
.
h
"
#
include
"
nsIFileStreams
.
h
"
#
include
"
nsIIPCSerializableInputStream
.
h
"
#
include
"
nsCOMPtr
.
h
"
namespace
mozilla
{
namespace
dom
{
class
IPCBlobInputStreamChild
;
class
IPCBlobInputStream
final
:
public
nsIAsyncInputStream
public
nsIInputStreamCallback
public
nsICloneableInputStream
public
nsIIPCSerializableInputStream
public
nsIFileMetadata
{
public
:
NS_DECL_THREADSAFE_ISUPPORTS
NS_DECL_NSIINPUTSTREAM
NS_DECL_NSIASYNCINPUTSTREAM
NS_DECL_NSIINPUTSTREAMCALLBACK
NS_DECL_NSICLONEABLEINPUTSTREAM
NS_DECL_NSIIPCSERIALIZABLEINPUTSTREAM
NS_DECL_NSIFILEMETADATA
explicit
IPCBlobInputStream
(
IPCBlobInputStreamChild
*
aActor
)
;
void
StreamReady
(
nsIInputStream
*
aInputStream
)
;
private
:
~
IPCBlobInputStream
(
)
;
nsresult
MaybeExecuteCallback
(
nsIInputStreamCallback
*
aCallback
nsIEventTarget
*
aEventTarget
)
;
nsresult
EnsureAsyncRemoteStream
(
)
;
bool
IsFileMetadata
(
)
const
;
RefPtr
<
IPCBlobInputStreamChild
>
mActor
;
enum
{
eInit
ePending
eRunning
eClosed
}
mState
;
nsCOMPtr
<
nsIInputStream
>
mRemoteStream
;
nsCOMPtr
<
nsIAsyncInputStream
>
mAsyncRemoteStream
;
nsCOMPtr
<
nsIInputStreamCallback
>
mCallback
;
nsCOMPtr
<
nsIEventTarget
>
mCallbackEventTarget
;
}
;
}
}
#
endif
