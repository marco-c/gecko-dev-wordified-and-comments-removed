#
include
"
mozilla
/
dom
/
TVListeners
.
h
"
#
include
"
mozilla
/
Preferences
.
h
"
#
include
"
nsITVService
.
h
"
#
include
"
nsITVSimulatorService
.
h
"
#
include
"
nsServiceManagerUtils
.
h
"
#
include
"
TVServiceFactory
.
h
"
namespace
mozilla
{
namespace
dom
{
already_AddRefed
<
nsITVService
>
TVServiceFactory
:
:
AutoCreateTVService
(
)
{
nsresult
rv
=
NS_OK
;
nsCOMPtr
<
nsITVService
>
service
=
do_CreateInstance
(
TV_SERVICE_CONTRACTID
)
;
if
(
!
service
)
{
service
=
do_CreateInstance
(
TV_SIMULATOR_SERVICE_CONTRACTID
&
rv
)
;
if
(
NS_WARN_IF
(
NS_FAILED
(
rv
)
)
)
{
return
nullptr
;
}
}
rv
=
service
-
>
SetSourceListener
(
new
TVSourceListener
(
)
)
;
if
(
NS_WARN_IF
(
NS_FAILED
(
rv
)
)
)
{
return
nullptr
;
}
return
service
.
forget
(
)
;
}
}
}
