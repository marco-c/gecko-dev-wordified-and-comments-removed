"
use
strict
"
;
const
{
TabStateFlusher
}
=
ChromeUtils
.
importESModule
(
"
resource
:
/
/
/
modules
/
sessionstore
/
TabStateFlusher
.
sys
.
mjs
"
)
;
add_task
(
async
function
check_document_pip_not_saved
(
)
{
const
[
tab
chromePiP
]
=
await
newTabWithPiP
(
)
;
await
TabStateFlusher
.
flushWindow
(
window
)
;
await
TabStateFlusher
.
flushWindow
(
chromePiP
)
;
let
state
=
SessionStore
.
getCurrentState
(
true
)
;
is
(
state
.
windows
.
length
1
"
Only
one
window
in
session
store
"
)
;
const
urls
=
state
.
windows
[
0
]
.
tabs
.
flatMap
(
ssTab
=
>
ssTab
.
entries
.
map
(
entry
=
>
entry
.
url
)
)
.
filter
(
url
=
>
!
!
url
)
;
ok
(
urls
.
includes
(
"
https
:
/
/
example
.
com
/
"
)
"
Window
tracked
in
sessionstore
is
tab
not
PiP
"
)
;
await
BrowserTestUtils
.
closeWindow
(
chromePiP
)
;
BrowserTestUtils
.
removeTab
(
tab
)
;
}
)
;
