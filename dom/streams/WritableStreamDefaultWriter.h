#
ifndef
mozilla_dom_WritableStreamDefaultWriter_h
#
define
mozilla_dom_WritableStreamDefaultWriter_h
#
include
"
js
/
TypeDecls
.
h
"
#
include
"
js
/
Value
.
h
"
#
include
"
mozilla
/
Attributes
.
h
"
#
include
"
mozilla
/
ErrorResult
.
h
"
#
include
"
mozilla
/
dom
/
BindingDeclarations
.
h
"
#
include
"
mozilla
/
dom
/
QueuingStrategyBinding
.
h
"
#
include
"
nsCycleCollectionParticipant
.
h
"
#
include
"
nsWrapperCache
.
h
"
namespace
mozilla
:
:
dom
{
class
Promise
;
class
WritableStream
;
class
WritableStreamDefaultWriter
final
:
public
nsISupports
public
nsWrapperCache
{
public
:
NS_DECL_CYCLE_COLLECTING_ISUPPORTS
NS_DECL_CYCLE_COLLECTION_SCRIPT_HOLDER_CLASS
(
WritableStreamDefaultWriter
)
protected
:
~
WritableStreamDefaultWriter
(
)
;
public
:
explicit
WritableStreamDefaultWriter
(
nsIGlobalObject
*
aGlobal
)
;
public
:
WritableStream
*
GetStream
(
)
const
{
return
mStream
;
}
void
SetStream
(
WritableStream
*
aStream
)
{
mStream
=
aStream
;
}
Promise
*
ReadyPromise
(
)
const
{
return
mReadyPromise
;
}
void
SetReadyPromise
(
Promise
*
aPromise
)
;
Promise
*
ClosedPromise
(
)
const
{
return
mClosedPromise
;
}
void
SetClosedPromise
(
Promise
*
aPromise
)
;
public
:
nsIGlobalObject
*
GetParentObject
(
)
const
{
return
mGlobal
;
}
JSObject
*
WrapObject
(
JSContext
*
aCx
JS
:
:
Handle
<
JSObject
*
>
aGivenProto
)
override
;
static
already_AddRefed
<
WritableStreamDefaultWriter
>
Constructor
(
const
GlobalObject
&
aGlobal
WritableStream
&
aStream
ErrorResult
&
aRv
)
;
already_AddRefed
<
Promise
>
Closed
(
)
;
already_AddRefed
<
Promise
>
Ready
(
)
;
Nullable
<
double
>
GetDesiredSize
(
ErrorResult
&
aRv
)
;
MOZ_CAN_RUN_SCRIPT
already_AddRefed
<
Promise
>
Abort
(
JSContext
*
aCx
JS
:
:
Handle
<
JS
:
:
Value
>
aReason
ErrorResult
&
aRv
)
;
MOZ_CAN_RUN_SCRIPT
already_AddRefed
<
Promise
>
Close
(
JSContext
*
aCx
ErrorResult
&
aRv
)
;
void
ReleaseLock
(
JSContext
*
aCx
ErrorResult
&
aRv
)
;
MOZ_CAN_RUN_SCRIPT
already_AddRefed
<
Promise
>
Write
(
JSContext
*
aCx
JS
:
:
Handle
<
JS
:
:
Value
>
aChunk
ErrorResult
&
aRv
)
;
private
:
nsCOMPtr
<
nsIGlobalObject
>
mGlobal
;
RefPtr
<
WritableStream
>
mStream
;
RefPtr
<
Promise
>
mReadyPromise
;
RefPtr
<
Promise
>
mClosedPromise
;
}
;
void
SetUpWritableStreamDefaultWriter
(
WritableStreamDefaultWriter
*
aWriter
WritableStream
*
aStream
ErrorResult
&
aRv
)
;
void
WritableStreamDefaultWriterEnsureClosedPromiseRejected
(
WritableStreamDefaultWriter
*
aWriter
JS
:
:
Handle
<
JS
:
:
Value
>
aError
ErrorResult
&
aRv
)
;
void
WritableStreamDefaultWriterEnsureReadyPromiseRejected
(
WritableStreamDefaultWriter
*
aWriter
JS
:
:
Handle
<
JS
:
:
Value
>
aError
ErrorResult
&
aRv
)
;
Nullable
<
double
>
WritableStreamDefaultWriterGetDesiredSize
(
WritableStreamDefaultWriter
*
aWriter
)
;
void
WritableStreamDefaultWriterRelease
(
JSContext
*
aCx
WritableStreamDefaultWriter
*
aWriter
ErrorResult
&
aRv
)
;
MOZ_CAN_RUN_SCRIPT
already_AddRefed
<
Promise
>
WritableStreamDefaultWriterWrite
(
JSContext
*
aCx
WritableStreamDefaultWriter
*
aWriter
JS
:
:
Handle
<
JS
:
:
Value
>
aChunk
ErrorResult
&
aRv
)
;
MOZ_CAN_RUN_SCRIPT
already_AddRefed
<
Promise
>
WritableStreamDefaultWriterCloseWithErrorPropagation
(
JSContext
*
aCx
WritableStreamDefaultWriter
*
aWriter
ErrorResult
&
aRv
)
;
}
#
endif
