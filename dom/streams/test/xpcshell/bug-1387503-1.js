let
readerCreated
=
false
;
let
fnFinished
=
false
;
let
g
;
add_task
(
async
function
test
(
)
{
g
=
newGlobal
(
{
newCompartment
:
true
}
)
;
g
.
parent
=
this
;
g
.
hit
=
false
;
g
.
eval
(
new
Debugger
(
parent
)
.
onDebuggerStatement
=
_frame
=
>
(
hit
=
true
null
)
;
)
;
async
function
fn
(
)
{
try
{
let
stream
=
new
ReadableStream
(
{
start
(
)
{
}
pull
(
)
{
debugger
;
}
}
)
;
let
reader
=
stream
.
getReader
(
)
;
let
p
=
reader
.
read
(
)
;
readerCreated
=
true
;
await
p
;
}
finally
{
fnFinished
=
true
;
}
}
fn
(
)
;
}
)
;
add_task
(
(
)
=
>
{
equal
(
readerCreated
true
)
;
equal
(
g
.
hit
true
)
;
equal
(
fnFinished
false
)
;
}
)
;
