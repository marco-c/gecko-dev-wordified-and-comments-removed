#
include
"
mozilla
/
dom
/
MIDIPlatformRunnables
.
h
"
#
include
"
mozilla
/
dom
/
MIDIPlatformService
.
h
"
#
include
"
mozilla
/
dom
/
MIDIPortParent
.
h
"
#
include
"
mozilla
/
ipc
/
BackgroundParent
.
h
"
namespace
mozilla
{
namespace
dom
{
NS_IMETHODIMP
MIDIBackgroundRunnable
:
:
Run
(
)
{
:
:
mozilla
:
:
ipc
:
:
AssertIsOnBackgroundThread
(
)
;
if
(
!
MIDIPlatformService
:
:
IsRunning
(
)
)
{
return
NS_OK
;
}
RunInternal
(
)
;
return
NS_OK
;
}
void
ReceiveRunnable
:
:
RunInternal
(
)
{
MIDIPlatformService
:
:
Get
(
)
-
>
CheckAndReceive
(
mPortId
mMsgs
)
;
}
void
AddPortRunnable
:
:
RunInternal
(
)
{
MIDIPlatformService
:
:
Get
(
)
-
>
AddPortInfo
(
mPortInfo
)
;
}
void
RemovePortRunnable
:
:
RunInternal
(
)
{
MIDIPlatformService
:
:
Get
(
)
-
>
RemovePortInfo
(
mPortInfo
)
;
}
void
SetStatusRunnable
:
:
RunInternal
(
)
{
MIDIPlatformService
:
:
Get
(
)
-
>
UpdateStatus
(
mPortId
mState
mConnection
)
;
}
void
SendPortListRunnable
:
:
RunInternal
(
)
{
if
(
!
MIDIPlatformService
:
:
IsRunning
(
)
)
{
return
;
}
MIDIPlatformService
:
:
Get
(
)
-
>
SendPortList
(
)
;
}
}
}
