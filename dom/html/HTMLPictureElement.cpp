#
include
"
mozilla
/
dom
/
HTMLPictureElement
.
h
"
#
include
"
mozilla
/
dom
/
HTMLPictureElementBinding
.
h
"
#
include
"
mozilla
/
dom
/
HTMLImageElement
.
h
"
nsGenericHTMLElement
*
NS_NewHTMLPictureElement
(
already_AddRefed
<
mozilla
:
:
dom
:
:
NodeInfo
>
&
&
aNodeInfo
mozilla
:
:
dom
:
:
FromParser
aFromParser
)
{
RefPtr
<
mozilla
:
:
dom
:
:
NodeInfo
>
nodeInfo
(
aNodeInfo
)
;
auto
*
nim
=
nodeInfo
-
>
NodeInfoManager
(
)
;
return
new
(
nim
)
mozilla
:
:
dom
:
:
HTMLPictureElement
(
nodeInfo
.
forget
(
)
)
;
}
namespace
mozilla
:
:
dom
{
HTMLPictureElement
:
:
HTMLPictureElement
(
already_AddRefed
<
mozilla
:
:
dom
:
:
NodeInfo
>
&
&
aNodeInfo
)
:
nsGenericHTMLElement
(
std
:
:
move
(
aNodeInfo
)
)
{
}
HTMLPictureElement
:
:
~
HTMLPictureElement
(
)
=
default
;
NS_IMPL_ELEMENT_CLONE
(
HTMLPictureElement
)
void
HTMLPictureElement
:
:
RemoveChildNode
(
nsIContent
*
aKid
bool
aNotify
)
{
if
(
aKid
&
&
aKid
-
>
IsHTMLElement
(
nsGkAtoms
:
:
img
)
)
{
HTMLImageElement
*
img
=
HTMLImageElement
:
:
FromNode
(
aKid
)
;
if
(
img
)
{
img
-
>
PictureSourceRemoved
(
aKid
-
>
AsContent
(
)
)
;
}
}
else
if
(
aKid
&
&
aKid
-
>
IsHTMLElement
(
nsGkAtoms
:
:
source
)
)
{
nsCOMPtr
<
nsIContent
>
nextSibling
=
aKid
-
>
GetNextSibling
(
)
;
if
(
nextSibling
&
&
nextSibling
-
>
GetParentNode
(
)
=
=
this
)
{
do
{
HTMLImageElement
*
img
=
HTMLImageElement
:
:
FromNode
(
nextSibling
)
;
if
(
img
)
{
img
-
>
PictureSourceRemoved
(
aKid
-
>
AsContent
(
)
)
;
}
}
while
(
(
nextSibling
=
nextSibling
-
>
GetNextSibling
(
)
)
)
;
}
}
nsGenericHTMLElement
:
:
RemoveChildNode
(
aKid
aNotify
)
;
}
nsresult
HTMLPictureElement
:
:
InsertChildBefore
(
nsIContent
*
aKid
nsIContent
*
aBeforeThis
bool
aNotify
)
{
nsresult
rv
=
nsGenericHTMLElement
:
:
InsertChildBefore
(
aKid
aBeforeThis
aNotify
)
;
NS_ENSURE_SUCCESS
(
rv
rv
)
;
NS_ENSURE_TRUE
(
aKid
rv
)
;
if
(
aKid
-
>
IsHTMLElement
(
nsGkAtoms
:
:
img
)
)
{
HTMLImageElement
*
img
=
HTMLImageElement
:
:
FromNode
(
aKid
)
;
if
(
img
)
{
img
-
>
PictureSourceAdded
(
aKid
-
>
AsContent
(
)
)
;
}
}
else
if
(
aKid
-
>
IsHTMLElement
(
nsGkAtoms
:
:
source
)
)
{
nsCOMPtr
<
nsIContent
>
nextSibling
=
aKid
-
>
GetNextSibling
(
)
;
if
(
nextSibling
&
&
nextSibling
-
>
GetParentNode
(
)
=
=
this
)
{
do
{
HTMLImageElement
*
img
=
HTMLImageElement
:
:
FromNode
(
nextSibling
)
;
if
(
img
)
{
img
-
>
PictureSourceAdded
(
aKid
-
>
AsContent
(
)
)
;
}
}
while
(
(
nextSibling
=
nextSibling
-
>
GetNextSibling
(
)
)
)
;
}
}
return
rv
;
}
JSObject
*
HTMLPictureElement
:
:
WrapNode
(
JSContext
*
aCx
JS
:
:
Handle
<
JSObject
*
>
aGivenProto
)
{
return
HTMLPictureElement_Binding
:
:
Wrap
(
aCx
this
aGivenProto
)
;
}
}
