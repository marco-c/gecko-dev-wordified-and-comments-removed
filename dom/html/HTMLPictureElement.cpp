#
include
"
mozilla
/
dom
/
HTMLPictureElement
.
h
"
#
include
"
mozilla
/
dom
/
HTMLPictureElementBinding
.
h
"
#
include
"
mozilla
/
dom
/
HTMLImageElement
.
h
"
#
include
"
mozilla
/
dom
/
HTMLSourceElement
.
h
"
nsGenericHTMLElement
*
NS_NewHTMLPictureElement
(
already_AddRefed
<
mozilla
:
:
dom
:
:
NodeInfo
>
&
&
aNodeInfo
mozilla
:
:
dom
:
:
FromParser
aFromParser
)
{
RefPtr
<
mozilla
:
:
dom
:
:
NodeInfo
>
nodeInfo
(
aNodeInfo
)
;
auto
*
nim
=
nodeInfo
-
>
NodeInfoManager
(
)
;
return
new
(
nim
)
mozilla
:
:
dom
:
:
HTMLPictureElement
(
nodeInfo
.
forget
(
)
)
;
}
namespace
mozilla
:
:
dom
{
HTMLPictureElement
:
:
HTMLPictureElement
(
already_AddRefed
<
mozilla
:
:
dom
:
:
NodeInfo
>
&
&
aNodeInfo
)
:
nsGenericHTMLElement
(
std
:
:
move
(
aNodeInfo
)
)
{
}
HTMLPictureElement
:
:
~
HTMLPictureElement
(
)
=
default
;
NS_IMPL_ELEMENT_CLONE
(
HTMLPictureElement
)
void
HTMLPictureElement
:
:
RemoveChildNode
(
nsIContent
*
aKid
bool
aNotify
)
{
MOZ_ASSERT
(
aKid
)
;
if
(
auto
*
img
=
HTMLImageElement
:
:
FromNode
(
aKid
)
)
{
img
-
>
PictureSourceRemoved
(
)
;
}
else
if
(
auto
*
source
=
HTMLSourceElement
:
:
FromNode
(
aKid
)
)
{
nsCOMPtr
<
nsIContent
>
nextSibling
=
source
-
>
GetNextSibling
(
)
;
if
(
nextSibling
&
&
nextSibling
-
>
GetParentNode
(
)
=
=
this
)
{
do
{
if
(
auto
*
img
=
HTMLImageElement
:
:
FromNode
(
nextSibling
)
)
{
img
-
>
PictureSourceRemoved
(
source
)
;
}
}
while
(
(
nextSibling
=
nextSibling
-
>
GetNextSibling
(
)
)
)
;
}
}
nsGenericHTMLElement
:
:
RemoveChildNode
(
aKid
aNotify
)
;
}
void
HTMLPictureElement
:
:
InsertChildBefore
(
nsIContent
*
aKid
nsIContent
*
aBeforeThis
bool
aNotify
ErrorResult
&
aRv
)
{
nsGenericHTMLElement
:
:
InsertChildBefore
(
aKid
aBeforeThis
aNotify
aRv
)
;
if
(
aRv
.
Failed
(
)
|
|
!
aKid
)
{
return
;
}
if
(
auto
*
img
=
HTMLImageElement
:
:
FromNode
(
aKid
)
)
{
img
-
>
PictureSourceAdded
(
)
;
}
else
if
(
auto
*
source
=
HTMLSourceElement
:
:
FromNode
(
aKid
)
)
{
nsCOMPtr
<
nsIContent
>
nextSibling
=
source
-
>
GetNextSibling
(
)
;
if
(
nextSibling
&
&
nextSibling
-
>
GetParentNode
(
)
=
=
this
)
{
do
{
if
(
auto
*
img
=
HTMLImageElement
:
:
FromNode
(
nextSibling
)
)
{
img
-
>
PictureSourceAdded
(
source
)
;
}
}
while
(
(
nextSibling
=
nextSibling
-
>
GetNextSibling
(
)
)
)
;
}
}
}
JSObject
*
HTMLPictureElement
:
:
WrapNode
(
JSContext
*
aCx
JS
:
:
Handle
<
JSObject
*
>
aGivenProto
)
{
return
HTMLPictureElement_Binding
:
:
Wrap
(
aCx
this
aGivenProto
)
;
}
}
