#
ifndef
mozilla_dom_HTMLFormSubmission_h
#
define
mozilla_dom_HTMLFormSubmission_h
#
include
"
mozilla
/
Attributes
.
h
"
#
include
"
nsCOMPtr
.
h
"
#
include
"
nsIContent
.
h
"
#
include
"
nsNCRFallbackEncoderWrapper
.
h
"
#
include
"
nsString
.
h
"
class
nsIURI
;
class
nsIInputStream
;
class
nsGenericHTMLElement
;
class
nsIMultiplexInputStream
;
namespace
mozilla
{
namespace
dom
{
class
Blob
;
class
HTMLFormSubmission
{
public
:
static
nsresult
GetFromForm
(
nsGenericHTMLElement
*
aForm
nsGenericHTMLElement
*
aOriginatingElement
HTMLFormSubmission
*
*
aFormSubmission
)
;
virtual
~
HTMLFormSubmission
(
)
{
MOZ_COUNT_DTOR
(
HTMLFormSubmission
)
;
}
virtual
nsresult
AddNameValuePair
(
const
nsAString
&
aName
const
nsAString
&
aValue
)
=
0
;
virtual
nsresult
AddNameBlobOrNullPair
(
const
nsAString
&
aName
Blob
*
aBlob
)
=
0
;
virtual
bool
SupportsIsindexSubmission
(
)
{
return
false
;
}
virtual
nsresult
AddIsindex
(
const
nsAString
&
aValue
)
{
NS_NOTREACHED
(
"
AddIsindex
called
when
not
supported
"
)
;
return
NS_ERROR_UNEXPECTED
;
}
virtual
nsresult
GetEncodedSubmission
(
nsIURI
*
aURI
nsIInputStream
*
*
aPostDataStream
)
=
0
;
void
GetCharset
(
nsACString
&
aCharset
)
{
aCharset
=
mCharset
;
}
nsIContent
*
GetOriginatingElement
(
)
const
{
return
mOriginatingElement
.
get
(
)
;
}
protected
:
HTMLFormSubmission
(
const
nsACString
&
aCharset
nsIContent
*
aOriginatingElement
)
:
mCharset
(
aCharset
)
mOriginatingElement
(
aOriginatingElement
)
{
MOZ_COUNT_CTOR
(
HTMLFormSubmission
)
;
}
nsCString
mCharset
;
nsCOMPtr
<
nsIContent
>
mOriginatingElement
;
}
;
class
nsEncodingFormSubmission
:
public
HTMLFormSubmission
{
public
:
nsEncodingFormSubmission
(
const
nsACString
&
aCharset
nsIContent
*
aOriginatingElement
)
;
virtual
~
nsEncodingFormSubmission
(
)
;
nsresult
EncodeVal
(
const
nsAString
&
aStr
nsCString
&
aResult
bool
aHeaderEncode
)
;
private
:
nsNCRFallbackEncoderWrapper
mEncoder
;
}
;
class
nsFSMultipartFormData
:
public
nsEncodingFormSubmission
{
public
:
nsFSMultipartFormData
(
const
nsACString
&
aCharset
nsIContent
*
aOriginatingElement
)
;
~
nsFSMultipartFormData
(
)
;
virtual
nsresult
AddNameValuePair
(
const
nsAString
&
aName
const
nsAString
&
aValue
)
override
;
virtual
nsresult
AddNameBlobOrNullPair
(
const
nsAString
&
aName
Blob
*
aBlob
)
override
;
virtual
nsresult
GetEncodedSubmission
(
nsIURI
*
aURI
nsIInputStream
*
*
aPostDataStream
)
override
;
void
GetContentType
(
nsACString
&
aContentType
)
{
aContentType
=
NS_LITERAL_CSTRING
(
"
multipart
/
form
-
data
;
boundary
=
"
)
+
mBoundary
;
}
nsIInputStream
*
GetSubmissionBody
(
uint64_t
*
aContentLength
)
;
protected
:
nsresult
AddPostDataStream
(
)
;
private
:
nsCOMPtr
<
nsIMultiplexInputStream
>
mPostDataStream
;
nsCString
mPostDataChunk
;
nsCString
mBoundary
;
uint64_t
mTotalLength
;
}
;
}
}
#
endif
