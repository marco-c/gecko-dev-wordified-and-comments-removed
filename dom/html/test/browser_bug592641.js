var
testPath
=
"
http
:
/
/
mochi
.
test
:
8888
/
browser
/
dom
/
html
/
test
/
"
;
var
ctx
=
{
loadsDone
:
0
}
;
function
test
(
)
{
waitForExplicitFinish
(
)
;
ctx
.
tab1
=
BrowserTestUtils
.
addTab
(
gBrowser
testPath
+
"
bug592641_img
.
jpg
"
)
;
ctx
.
tab1Browser
=
gBrowser
.
getBrowserForTab
(
ctx
.
tab1
)
;
BrowserTestUtils
.
browserLoaded
(
ctx
.
tab1Browser
)
.
then
(
load1Soon
)
;
}
function
checkTitle
(
title
)
{
ctx
.
loadsDone
+
+
;
ok
(
/
^
bug592641_img
\
.
jpg
\
(
JPEG
Image
1500
\
u00A0
\
u00D7
\
u00A01500
pixels
\
)
/
.
test
(
title
)
"
Title
should
be
correct
on
load
#
"
+
ctx
.
loadsDone
+
"
was
:
"
+
title
)
;
}
function
load1Soon
(
)
{
executeSoon
(
load1Done
)
;
}
function
load1Done
(
)
{
var
title
=
ctx
.
tab1Browser
.
contentTitle
;
checkTitle
(
title
)
;
ctx
.
tab2
=
BrowserTestUtils
.
addTab
(
gBrowser
testPath
+
"
bug592641_img
.
jpg
"
)
;
ctx
.
tab2Browser
=
gBrowser
.
getBrowserForTab
(
ctx
.
tab2
)
;
BrowserTestUtils
.
browserLoaded
(
ctx
.
tab2Browser
)
.
then
(
load2Soon
)
;
}
function
load2Soon
(
)
{
executeSoon
(
load2Done
)
;
}
function
load2Done
(
)
{
var
title
=
ctx
.
tab2Browser
.
contentTitle
;
checkTitle
(
title
)
;
gBrowser
.
removeTab
(
ctx
.
tab1
)
;
gBrowser
.
removeTab
(
ctx
.
tab2
)
;
finish
(
)
;
}
