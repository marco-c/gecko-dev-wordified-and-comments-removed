#
include
"
FileSystemQuotaClientFactory
.
h
"
#
include
"
FileSystemQuotaClient
.
h
"
#
include
"
mozilla
/
RefPtr
.
h
"
#
include
"
mozilla
/
ipc
/
BackgroundParent
.
h
"
namespace
mozilla
:
:
dom
:
:
fs
{
namespace
{
StaticRefPtr
<
FileSystemQuotaClientFactory
>
gCustomFactory
;
}
void
FileSystemQuotaClientFactory
:
:
SetCustomFactory
(
RefPtr
<
FileSystemQuotaClientFactory
>
aCustomFactory
)
{
gCustomFactory
=
std
:
:
move
(
aCustomFactory
)
;
}
already_AddRefed
<
quota
:
:
Client
>
FileSystemQuotaClientFactory
:
:
CreateQuotaClient
(
)
{
:
:
mozilla
:
:
ipc
:
:
AssertIsOnBackgroundThread
(
)
;
if
(
gCustomFactory
)
{
return
gCustomFactory
-
>
AllocQuotaClient
(
)
;
}
auto
factory
=
MakeRefPtr
<
FileSystemQuotaClientFactory
>
(
)
;
return
factory
-
>
AllocQuotaClient
(
)
;
}
already_AddRefed
<
quota
:
:
Client
>
FileSystemQuotaClientFactory
:
:
AllocQuotaClient
(
)
{
:
:
mozilla
:
:
ipc
:
:
AssertIsOnBackgroundThread
(
)
;
RefPtr
<
FileSystemQuotaClient
>
result
=
new
FileSystemQuotaClient
(
)
;
return
result
.
forget
(
)
;
}
}
