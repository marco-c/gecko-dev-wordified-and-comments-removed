#
include
"
FileSystemAccessHandleControlParent
.
h
"
#
include
"
mozilla
/
dom
/
FileSystemAccessHandle
.
h
"
#
include
"
mozilla
/
ipc
/
IPCCore
.
h
"
namespace
mozilla
:
:
dom
{
FileSystemAccessHandleControlParent
:
:
FileSystemAccessHandleControlParent
(
RefPtr
<
FileSystemAccessHandle
>
aAccessHandle
)
:
mAccessHandle
(
std
:
:
move
(
aAccessHandle
)
)
{
}
FileSystemAccessHandleControlParent
:
:
~
FileSystemAccessHandleControlParent
(
)
{
MOZ_ASSERT
(
mActorDestroyed
)
;
}
mozilla
:
:
ipc
:
:
IPCResult
FileSystemAccessHandleControlParent
:
:
RecvClose
(
CloseResolver
&
&
aResolver
)
{
mAccessHandle
-
>
BeginClose
(
)
-
>
Then
(
GetCurrentSerialEventTarget
(
)
__func__
[
resolver
=
std
:
:
move
(
aResolver
)
]
(
const
BoolPromise
:
:
ResolveOrRejectValue
&
)
{
resolver
(
void_t
(
)
)
;
}
)
;
return
IPC_OK
(
)
;
}
void
FileSystemAccessHandleControlParent
:
:
ActorDestroy
(
ActorDestroyReason
)
{
MOZ_ASSERT
(
!
mActorDestroyed
)
;
#
ifdef
DEBUG
mActorDestroyed
=
true
;
#
endif
mAccessHandle
-
>
UnregisterControlActor
(
WrapNotNullUnchecked
(
this
)
)
;
mAccessHandle
=
nullptr
;
}
}
