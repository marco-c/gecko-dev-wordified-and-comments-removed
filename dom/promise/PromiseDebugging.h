#
ifndef
mozilla_dom_PromiseDebugging_h
#
define
mozilla_dom_PromiseDebugging_h
#
include
"
js
/
TypeDecls
.
h
"
#
include
"
nsTArray
.
h
"
#
include
"
mozilla
/
RefPtr
.
h
"
namespace
mozilla
{
class
ErrorResult
;
namespace
dom
{
namespace
workers
{
class
WorkerPrivate
;
}
class
Promise
;
struct
PromiseDebuggingStateHolder
;
class
GlobalObject
;
class
UncaughtRejectionObserver
;
class
FlushRejections
;
class
PromiseDebugging
{
public
:
static
void
Init
(
)
;
static
void
Shutdown
(
)
;
#
ifndef
SPIDERMONKEY_PROMISE
static
void
GetState
(
GlobalObject
&
JS
:
:
Handle
<
JSObject
*
>
aPromise
PromiseDebuggingStateHolder
&
aState
ErrorResult
&
aRv
)
;
static
void
GetAllocationStack
(
GlobalObject
&
JS
:
:
Handle
<
JSObject
*
>
aPromise
JS
:
:
MutableHandle
<
JSObject
*
>
aStack
ErrorResult
&
aRv
)
;
static
void
GetRejectionStack
(
GlobalObject
&
JS
:
:
Handle
<
JSObject
*
>
aPromise
JS
:
:
MutableHandle
<
JSObject
*
>
aStack
ErrorResult
&
aRv
)
;
static
void
GetFullfillmentStack
(
GlobalObject
&
JS
:
:
Handle
<
JSObject
*
>
aPromise
JS
:
:
MutableHandle
<
JSObject
*
>
aStack
ErrorResult
&
aRv
)
;
static
void
GetDependentPromises
(
GlobalObject
&
JS
:
:
Handle
<
JSObject
*
>
aPromise
nsTArray
<
RefPtr
<
Promise
>
>
&
aPromises
ErrorResult
&
aRv
)
;
static
double
GetPromiseLifetime
(
GlobalObject
&
JS
:
:
Handle
<
JSObject
*
>
aPromise
ErrorResult
&
aRv
)
;
static
double
GetTimeToSettle
(
GlobalObject
&
JS
:
:
Handle
<
JSObject
*
>
aPromise
ErrorResult
&
aRv
)
;
static
void
GetPromiseID
(
GlobalObject
&
JS
:
:
Handle
<
JSObject
*
>
nsString
&
ErrorResult
&
)
;
#
endif
static
void
AddUncaughtRejectionObserver
(
GlobalObject
&
UncaughtRejectionObserver
&
aObserver
)
;
static
bool
RemoveUncaughtRejectionObserver
(
GlobalObject
&
UncaughtRejectionObserver
&
aObserver
)
;
#
ifndef
SPIDERMONKEY_PROMISE
static
void
AddUncaughtRejection
(
Promise
&
)
;
static
void
AddConsumedRejection
(
Promise
&
)
;
#
endif
static
void
FlushUncaughtRejections
(
)
;
protected
:
static
void
FlushUncaughtRejectionsInternal
(
)
;
friend
class
FlushRejections
;
friend
class
WorkerPrivate
;
private
:
static
nsString
sIDPrefix
;
}
;
}
}
#
endif
