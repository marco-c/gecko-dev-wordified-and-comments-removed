#
include
"
SourceBufferContentManager
.
h
"
#
include
"
mozilla
/
Preferences
.
h
"
#
include
"
TrackBuffersManager
.
h
"
namespace
mozilla
{
#
if
defined
(
MOZ_GONK_MEDIACODEC
)
|
|
defined
(
XP_WIN
)
|
|
defined
(
MOZ_APPLEMEDIA
)
|
|
defined
(
MOZ_FFMPEG
)
#
define
MP4_READER_DORMANT_HEURISTIC
#
else
#
undef
MP4_READER_DORMANT_HEURISTIC
#
endif
already_AddRefed
<
SourceBufferContentManager
>
SourceBufferContentManager
:
:
CreateManager
(
dom
:
:
SourceBufferAttributes
*
aAttributes
MediaSourceDecoder
*
aParentDecoder
const
nsACString
&
aType
)
{
nsRefPtr
<
SourceBufferContentManager
>
manager
;
manager
=
new
TrackBuffersManager
(
aAttributes
aParentDecoder
aType
)
;
#
if
defined
(
MP4_READER_DORMANT_HEURISTIC
)
aParentDecoder
-
>
NotifyDormantSupported
(
Preferences
:
:
GetBool
(
"
media
.
decoder
.
heuristic
.
dormant
.
enabled
"
false
)
)
;
#
endif
return
manager
.
forget
(
)
;
}
}
