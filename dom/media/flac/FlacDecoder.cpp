#
include
"
FlacDecoder
.
h
"
#
include
"
FlacDemuxer
.
h
"
#
include
"
MediaContainerType
.
h
"
#
include
"
MediaDecoderStateMachine
.
h
"
#
include
"
MediaFormatReader
.
h
"
#
include
"
MediaPrefs
.
h
"
namespace
mozilla
{
ChannelMediaDecoder
*
FlacDecoder
:
:
Clone
(
MediaDecoderInit
&
aInit
)
{
if
(
!
IsEnabled
(
)
)
{
return
nullptr
;
}
return
new
FlacDecoder
(
aInit
)
;
}
MediaDecoderStateMachine
*
FlacDecoder
:
:
CreateStateMachine
(
)
{
MediaFormatReaderInit
init
(
this
)
;
init
.
mCrashHelper
=
GetOwner
(
)
-
>
CreateGMPCrashHelper
(
)
;
mReader
=
new
MediaFormatReader
(
init
new
FlacDemuxer
(
mResource
)
)
;
return
new
MediaDecoderStateMachine
(
this
mReader
)
;
}
bool
FlacDecoder
:
:
IsEnabled
(
)
{
#
ifdef
MOZ_FFVPX
return
MediaPrefs
:
:
FlacEnabled
(
)
;
#
else
return
false
;
#
endif
}
bool
FlacDecoder
:
:
IsSupportedType
(
const
MediaContainerType
&
aContainerType
)
{
return
IsEnabled
(
)
&
&
(
aContainerType
.
Type
(
)
=
=
MEDIAMIMETYPE
(
"
audio
/
flac
"
)
|
|
aContainerType
.
Type
(
)
=
=
MEDIAMIMETYPE
(
"
audio
/
x
-
flac
"
)
|
|
aContainerType
.
Type
(
)
=
=
MEDIAMIMETYPE
(
"
application
/
x
-
flac
"
)
)
;
}
}
