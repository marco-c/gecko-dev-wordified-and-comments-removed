#
ifndef
MediaSink_h_
#
define
MediaSink_h_
#
include
"
AudioDeviceInfo
.
h
"
#
include
"
MediaInfo
.
h
"
#
include
"
mozilla
/
MozPromise
.
h
"
#
include
"
mozilla
/
RefPtr
.
h
"
#
include
"
mozilla
/
dom
/
MediaDebugInfoBinding
.
h
"
#
include
"
nsISupportsImpl
.
h
"
namespace
mozilla
{
class
TimeStamp
;
class
VideoFrameContainer
;
class
MediaSink
{
public
:
NS_INLINE_DECL_THREADSAFE_REFCOUNTING
(
MediaSink
)
;
typedef
mozilla
:
:
TrackInfo
:
:
TrackType
TrackType
;
struct
PlaybackParams
{
PlaybackParams
(
)
:
mVolume
(
1
.
0
)
mPlaybackRate
(
1
.
0
)
mPreservesPitch
(
true
)
{
}
double
mVolume
;
double
mPlaybackRate
;
bool
mPreservesPitch
;
RefPtr
<
AudioDeviceInfo
>
mSink
;
}
;
virtual
const
PlaybackParams
&
GetPlaybackParams
(
)
const
=
0
;
virtual
void
SetPlaybackParams
(
const
PlaybackParams
&
aParams
)
=
0
;
typedef
MozPromise
<
bool
nsresult
false
>
EndedPromise
;
virtual
RefPtr
<
EndedPromise
>
OnEnded
(
TrackType
aType
)
=
0
;
virtual
media
:
:
TimeUnit
GetEndTime
(
TrackType
aType
)
const
=
0
;
virtual
media
:
:
TimeUnit
GetPosition
(
TimeStamp
*
aTimeStamp
=
nullptr
)
const
=
0
;
virtual
bool
HasUnplayedFrames
(
TrackType
aType
)
const
=
0
;
virtual
void
SetVolume
(
double
aVolume
)
{
}
virtual
void
SetPlaybackRate
(
double
aPlaybackRate
)
{
}
virtual
void
SetPreservesPitch
(
bool
aPreservesPitch
)
{
}
virtual
void
SetPlaying
(
bool
aPlaying
)
=
0
;
virtual
void
Redraw
(
const
VideoInfo
&
aInfo
)
{
}
;
virtual
nsresult
Start
(
const
media
:
:
TimeUnit
&
aStartTime
const
MediaInfo
&
aInfo
)
=
0
;
virtual
void
Stop
(
)
=
0
;
virtual
bool
IsStarted
(
)
const
=
0
;
virtual
bool
IsPlaying
(
)
const
=
0
;
virtual
void
Shutdown
(
)
{
}
virtual
void
SetSecondaryVideoContainer
(
VideoFrameContainer
*
aSecondary
)
{
}
virtual
void
ClearSecondaryVideoContainer
(
)
{
}
virtual
void
GetDebugInfo
(
dom
:
:
MediaSinkDebugInfo
&
aInfo
)
{
}
protected
:
virtual
~
MediaSink
(
)
=
default
;
}
;
}
#
endif
