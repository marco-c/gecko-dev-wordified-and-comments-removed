const
{
XPCOMUtils
}
=
ChromeUtils
.
import
(
"
resource
:
/
/
gre
/
modules
/
XPCOMUtils
.
jsm
"
)
;
const
{
WebVTT
}
=
ChromeUtils
.
import
(
"
resource
:
/
/
gre
/
modules
/
vtt
.
jsm
"
)
;
var
WEBVTTPARSERWRAPPER_CID
=
"
{
acf6e493
-
0092
-
4b26
-
b172
-
241e375c57ab
}
"
;
function
WebVTTParserWrapper
(
)
{
}
WebVTTParserWrapper
.
prototype
=
{
loadParser
:
function
(
window
)
{
this
.
parser
=
new
WebVTT
.
Parser
(
window
new
TextDecoder
(
"
utf8
"
)
)
;
}
parse
:
function
(
data
)
{
var
buffer
=
new
Uint8Array
(
data
.
length
)
;
for
(
var
i
=
0
;
i
<
data
.
length
;
i
+
+
)
{
buffer
[
i
]
=
data
.
charCodeAt
(
i
)
;
}
this
.
parser
.
parse
(
buffer
)
;
}
flush
:
function
(
)
{
this
.
parser
.
flush
(
)
;
}
watch
:
function
(
callback
)
{
this
.
parser
.
oncue
=
callback
.
onCue
;
this
.
parser
.
onregion
=
callback
.
onRegion
;
this
.
parser
.
onparsingerror
=
function
(
e
)
{
callback
.
onParsingError
(
(
"
code
"
in
e
)
?
e
.
code
:
-
1
)
;
}
;
}
convertCueToDOMTree
:
function
(
window
cue
)
{
return
WebVTT
.
convertCueToDOMTree
(
window
cue
.
text
)
;
}
processCues
:
function
(
window
cues
overlay
controls
)
{
WebVTT
.
processCues
(
window
cues
overlay
controls
)
;
}
classDescription
:
"
Wrapper
for
the
JS
WebVTT
implementation
(
vtt
.
js
)
"
classID
:
Components
.
ID
(
WEBVTTPARSERWRAPPER_CID
)
QueryInterface
:
ChromeUtils
.
generateQI
(
[
Ci
.
nsIWebVTTParserWrapper
]
)
}
;
this
.
NSGetFactory
=
XPCOMUtils
.
generateNSGetFactory
(
[
WebVTTParserWrapper
]
)
;
