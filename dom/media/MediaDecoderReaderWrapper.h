#
ifndef
MediaDecoderReaderWrapper_h_
#
define
MediaDecoderReaderWrapper_h_
#
include
"
mozilla
/
AbstractThread
.
h
"
#
include
"
mozilla
/
RefPtr
.
h
"
#
include
"
nsISupportsImpl
.
h
"
#
include
"
MediaDecoderReader
.
h
"
namespace
mozilla
{
class
StartTimeRendezvous
;
typedef
MozPromise
<
bool
bool
false
>
HaveStartTimePromise
;
class
MediaDecoderReaderWrapper
{
typedef
MediaDecoderReader
:
:
MetadataPromise
MetadataPromise
;
typedef
MediaDecoderReader
:
:
AudioDataPromise
AudioDataPromise
;
typedef
MediaDecoderReader
:
:
VideoDataPromise
VideoDataPromise
;
typedef
MediaDecoderReader
:
:
SeekPromise
SeekPromise
;
NS_INLINE_DECL_THREADSAFE_REFCOUNTING
(
MediaDecoderReaderWrapper
)
;
public
:
MediaDecoderReaderWrapper
(
bool
aIsRealTime
AbstractThread
*
aOwnerThread
MediaDecoderReader
*
aReader
)
;
media
:
:
TimeUnit
StartTime
(
)
const
;
RefPtr
<
MetadataPromise
>
ReadMetadata
(
)
;
RefPtr
<
HaveStartTimePromise
>
AwaitStartTime
(
)
;
RefPtr
<
AudioDataPromise
>
RequestAudioData
(
)
;
RefPtr
<
VideoDataPromise
>
RequestVideoData
(
bool
aSkipToNextKeyframe
media
:
:
TimeUnit
aTimeThreshold
)
;
RefPtr
<
SeekPromise
>
Seek
(
SeekTarget
aTarget
media
:
:
TimeUnit
aEndTime
)
;
void
Shutdown
(
)
;
private
:
~
MediaDecoderReaderWrapper
(
)
;
void
OnMetadataRead
(
MetadataHolder
*
aMetadata
)
;
void
OnMetadataNotRead
(
)
{
}
void
OnSampleDecoded
(
MediaData
*
aSample
)
;
void
OnNotDecoded
(
)
{
}
const
bool
mForceZeroStartTime
;
const
RefPtr
<
AbstractThread
>
mOwnerThread
;
const
RefPtr
<
MediaDecoderReader
>
mReader
;
bool
mShutdown
=
false
;
RefPtr
<
StartTimeRendezvous
>
mStartTimeRendezvous
;
}
;
}
#
endif
