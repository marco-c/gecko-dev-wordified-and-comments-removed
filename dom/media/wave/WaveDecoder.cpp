#
include
"
WaveDemuxer
.
h
"
#
include
"
mozilla
/
Preferences
.
h
"
#
include
"
MediaDecoderStateMachine
.
h
"
#
include
"
WaveReader
.
h
"
#
include
"
WaveDecoder
.
h
"
#
include
"
MediaFormatReader
.
h
"
#
include
"
PDMFactory
.
h
"
namespace
mozilla
{
MediaDecoder
*
WaveDecoder
:
:
Clone
(
MediaDecoderOwner
*
aOwner
)
{
return
new
WaveDecoder
(
aOwner
)
;
}
MediaDecoderStateMachine
*
WaveDecoder
:
:
CreateStateMachine
(
)
{
if
(
Preferences
:
:
GetBool
(
"
media
.
wave
.
decoder
.
enabled
"
false
)
)
{
RefPtr
<
MediaDecoderReader
>
reader
=
new
MediaFormatReader
(
this
new
WAVDemuxer
(
GetResource
(
)
)
)
;
return
new
MediaDecoderStateMachine
(
this
reader
)
;
}
else
{
return
new
MediaDecoderStateMachine
(
this
new
WaveReader
(
this
)
)
;
}
}
bool
WaveDecoder
:
:
IsEnabled
(
)
{
MOZ_ASSERT
(
NS_IsMainThread
(
)
)
;
if
(
!
Preferences
:
:
GetBool
(
"
media
.
wave
.
decoder
.
enabled
"
false
)
)
{
return
false
;
}
PDMFactory
:
:
Init
(
)
;
RefPtr
<
PDMFactory
>
platform
=
new
PDMFactory
(
)
;
return
platform
-
>
SupportsMimeType
(
NS_LITERAL_CSTRING
(
"
audio
/
x
-
wav
"
)
nullptr
)
;
}
bool
WaveDecoder
:
:
CanHandleMediaType
(
const
nsACString
&
aType
const
nsAString
&
aCodecs
)
{
if
(
aType
.
EqualsASCII
(
"
audio
/
wave
"
)
|
|
aType
.
EqualsASCII
(
"
audio
/
x
-
wav
"
)
|
|
aType
.
EqualsASCII
(
"
audio
/
wav
"
)
|
|
aType
.
EqualsASCII
(
"
audio
/
x
-
pn
-
wav
"
)
)
{
return
IsEnabled
(
)
&
&
(
aCodecs
.
IsEmpty
(
)
|
|
aCodecs
.
EqualsASCII
(
"
1
"
)
|
|
aCodecs
.
EqualsASCII
(
"
6
"
)
|
|
aCodecs
.
EqualsASCII
(
"
7
"
)
)
;
}
return
false
;
}
}
