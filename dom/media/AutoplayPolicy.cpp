#
include
"
AutoplayPolicy
.
h
"
#
include
"
mozilla
/
EventStateManager
.
h
"
#
include
"
mozilla
/
Preferences
.
h
"
#
include
"
mozilla
/
dom
/
HTMLMediaElement
.
h
"
#
include
"
nsIDocument
.
h
"
namespace
mozilla
{
namespace
dom
{
bool
AutoplayPolicy
:
:
IsDocumentAllowedToPlay
(
nsIDocument
*
aDoc
)
{
return
aDoc
?
aDoc
-
>
HasBeenUserActivated
(
)
:
false
;
}
bool
AutoplayPolicy
:
:
IsMediaElementAllowedToPlay
(
NotNull
<
HTMLMediaElement
*
>
aElement
)
{
if
(
Preferences
:
:
GetBool
(
"
media
.
autoplay
.
enabled
"
)
)
{
return
true
;
}
if
(
!
Preferences
:
:
GetBool
(
"
media
.
autoplay
.
enabled
.
user
-
gestures
-
needed
"
false
)
)
{
return
EventStateManager
:
:
IsHandlingUserInput
(
)
;
}
if
(
aElement
-
>
Volume
(
)
=
=
0
.
0
|
|
aElement
-
>
Muted
(
)
)
{
return
true
;
}
if
(
aElement
-
>
IsVideo
(
)
&
&
aElement
-
>
ReadyState
(
)
>
=
nsIDOMHTMLMediaElement
:
:
HAVE_METADATA
&
&
!
aElement
-
>
HasAudio
(
)
)
{
return
true
;
}
return
AutoplayPolicy
:
:
IsDocumentAllowedToPlay
(
aElement
-
>
OwnerDoc
(
)
)
;
}
}
}
