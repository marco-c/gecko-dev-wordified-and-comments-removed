#
include
"
AutoplayPolicy
.
h
"
#
include
"
mozilla
/
EventStateManager
.
h
"
#
include
"
mozilla
/
NotNull
.
h
"
#
include
"
mozilla
/
Preferences
.
h
"
#
include
"
mozilla
/
dom
/
HTMLMediaElement
.
h
"
#
include
"
nsIDocument
.
h
"
namespace
mozilla
{
namespace
dom
{
bool
AutoplayPolicy
:
:
IsDocumentAllowedToPlay
(
nsIDocument
*
aDoc
)
{
if
(
!
Preferences
:
:
GetBool
(
"
media
.
autoplay
.
enabled
.
user
-
gestures
-
needed
"
)
)
{
return
true
;
}
return
aDoc
?
aDoc
-
>
HasBeenUserActivated
(
)
:
false
;
}
bool
AutoplayPolicy
:
:
IsMediaElementAllowedToPlay
(
NotNull
<
HTMLMediaElement
*
>
aElement
)
{
if
(
Preferences
:
:
GetBool
(
"
media
.
autoplay
.
enabled
"
)
)
{
return
true
;
}
if
(
Preferences
:
:
GetBool
(
"
media
.
autoplay
.
enabled
.
user
-
gestures
-
needed
"
false
)
)
{
return
AutoplayPolicy
:
:
IsDocumentAllowedToPlay
(
aElement
-
>
OwnerDoc
(
)
)
;
}
return
aElement
-
>
GetAndClearHasUserInteractedLoadOrSeek
(
)
|
|
EventStateManager
:
:
IsHandlingUserInput
(
)
;
}
}
}
