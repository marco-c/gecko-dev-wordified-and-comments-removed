#
ifndef
DOM_MEDIA_MEDIACONTROL_CONTENTMEDIACONTROLLER_H_
#
define
DOM_MEDIA_MEDIACONTROL_CONTENTMEDIACONTROLLER_H_
#
include
"
MediaControlKeySource
.
h
"
#
include
"
MediaStatusManager
.
h
"
namespace
mozilla
{
namespace
dom
{
class
BrowsingContext
;
class
ContentMediaControlKeyReceiver
{
public
:
NS_INLINE_DECL_PURE_VIRTUAL_REFCOUNTING
static
ContentMediaControlKeyReceiver
*
Get
(
BrowsingContext
*
aBC
)
;
virtual
void
HandleMediaKey
(
MediaControlKey
aKey
)
=
0
;
virtual
bool
IsPlaying
(
)
const
=
0
;
}
;
class
ContentMediaAgent
:
public
IMediaInfoUpdater
{
public
:
static
ContentMediaAgent
*
Get
(
BrowsingContext
*
aBC
)
;
void
NotifyMediaPlaybackChanged
(
uint64_t
aBrowsingContextId
MediaPlaybackState
aState
)
override
;
void
NotifyMediaAudibleChanged
(
uint64_t
aBrowsingContextId
MediaAudibleState
aState
)
override
;
void
SetIsInPictureInPictureMode
(
uint64_t
aBrowsingContextId
bool
aIsInPictureInPictureMode
)
override
;
void
SetDeclaredPlaybackState
(
uint64_t
aBrowsingContextId
MediaSessionPlaybackState
aState
)
override
;
void
NotifySessionCreated
(
uint64_t
aBrowsingContextId
)
override
;
void
NotifySessionDestroyed
(
uint64_t
aBrowsingContextId
)
override
;
void
UpdateMetadata
(
uint64_t
aBrowsingContextId
const
Maybe
<
MediaMetadataBase
>
&
aMetadata
)
override
;
void
EnableAction
(
uint64_t
aBrowsingContextId
MediaSessionAction
aAction
)
override
;
void
DisableAction
(
uint64_t
aBrowsingContextId
MediaSessionAction
aAction
)
override
;
void
NotifyMediaFullScreenState
(
uint64_t
aBrowsingContextId
bool
aIsInFullScreen
)
override
;
void
UpdatePositionState
(
uint64_t
aBrowsingContextId
const
PositionState
&
aState
)
override
;
virtual
void
AddReceiver
(
ContentMediaControlKeyReceiver
*
aReceiver
)
=
0
;
virtual
void
RemoveReceiver
(
ContentMediaControlKeyReceiver
*
aReceiver
)
=
0
;
}
;
class
ContentMediaController
final
:
public
ContentMediaAgent
public
ContentMediaControlKeyReceiver
{
public
:
NS_INLINE_DECL_REFCOUNTING
(
ContentMediaController
override
)
explicit
ContentMediaController
(
uint64_t
aId
)
;
void
AddReceiver
(
ContentMediaControlKeyReceiver
*
aListener
)
override
;
void
RemoveReceiver
(
ContentMediaControlKeyReceiver
*
aListener
)
override
;
void
HandleMediaKey
(
MediaControlKey
aKey
)
override
;
private
:
~
ContentMediaController
(
)
=
default
;
virtual
bool
IsPlaying
(
)
const
override
{
return
false
;
}
void
PauseOrStopMedia
(
)
;
nsTArray
<
RefPtr
<
ContentMediaControlKeyReceiver
>
>
mReceivers
;
}
;
}
}
#
endif
