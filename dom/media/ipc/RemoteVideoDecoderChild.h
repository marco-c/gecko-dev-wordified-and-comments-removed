#
ifndef
include_dom_media_ipc_RemoteVideoDecoderChild_h
#
define
include_dom_media_ipc_RemoteVideoDecoderChild_h
#
include
"
mozilla
/
PRemoteVideoDecoderChild
.
h
"
#
include
"
IRemoteDecoderChild
.
h
"
#
include
"
MediaResult
.
h
"
namespace
mozilla
{
namespace
layers
{
class
BufferRecycleBin
;
}
}
namespace
mozilla
{
class
RemoteDecoderManagerChild
;
using
mozilla
:
:
MediaDataDecoder
;
class
RemoteVideoDecoderChild
final
:
public
PRemoteVideoDecoderChild
public
IRemoteDecoderChild
{
public
:
explicit
RemoteVideoDecoderChild
(
)
;
mozilla
:
:
ipc
:
:
IPCResult
RecvVideoOutput
(
const
RemoteVideoDataIPDL
&
aData
)
override
;
mozilla
:
:
ipc
:
:
IPCResult
RecvInputExhausted
(
)
override
;
mozilla
:
:
ipc
:
:
IPCResult
RecvDrainComplete
(
)
override
;
mozilla
:
:
ipc
:
:
IPCResult
RecvError
(
const
nsresult
&
aError
)
override
;
mozilla
:
:
ipc
:
:
IPCResult
RecvInitComplete
(
const
nsCString
&
aDecoderDescription
const
ConversionRequired
&
aConversion
)
override
;
mozilla
:
:
ipc
:
:
IPCResult
RecvInitFailed
(
const
nsresult
&
aReason
)
override
;
mozilla
:
:
ipc
:
:
IPCResult
RecvFlushComplete
(
)
override
;
void
ActorDestroy
(
ActorDestroyReason
aWhy
)
override
;
RefPtr
<
MediaDataDecoder
:
:
InitPromise
>
Init
(
)
override
;
RefPtr
<
MediaDataDecoder
:
:
DecodePromise
>
Decode
(
MediaRawData
*
aSample
)
override
;
RefPtr
<
MediaDataDecoder
:
:
DecodePromise
>
Drain
(
)
override
;
RefPtr
<
MediaDataDecoder
:
:
FlushPromise
>
Flush
(
)
override
;
void
Shutdown
(
)
override
;
bool
IsHardwareAccelerated
(
nsACString
&
aFailureReason
)
const
override
;
nsCString
GetDescriptionName
(
)
const
override
;
void
SetSeekThreshold
(
const
media
:
:
TimeUnit
&
aTime
)
override
;
MediaDataDecoder
:
:
ConversionRequired
NeedsConversion
(
)
const
override
;
void
DestroyIPDL
(
)
override
;
MOZ_IS_CLASS_INIT
MediaResult
InitIPDL
(
const
VideoInfo
&
aVideoInfo
float
aFramerate
const
CreateDecoderParams
:
:
OptionSet
&
aOptions
)
;
void
IPDLActorDestroyed
(
)
;
RemoteDecoderManagerChild
*
GetManager
(
)
;
private
:
~
RemoteVideoDecoderChild
(
)
;
void
AssertOnManagerThread
(
)
const
;
RefPtr
<
mozilla
:
:
layers
:
:
Image
>
DeserializeImage
(
const
SurfaceDescriptorBuffer
&
sdBuffer
const
IntSize
&
aPicSize
)
;
RefPtr
<
RemoteVideoDecoderChild
>
mIPDLSelfRef
;
RefPtr
<
nsIThread
>
mThread
;
MozPromiseHolder
<
MediaDataDecoder
:
:
InitPromise
>
mInitPromise
;
MozPromiseHolder
<
MediaDataDecoder
:
:
DecodePromise
>
mDecodePromise
;
MozPromiseHolder
<
MediaDataDecoder
:
:
DecodePromise
>
mDrainPromise
;
MozPromiseHolder
<
MediaDataDecoder
:
:
FlushPromise
>
mFlushPromise
;
nsCString
mHardwareAcceleratedReason
;
nsCString
mDescription
;
bool
mCanSend
;
bool
mInitialized
;
bool
mIsHardwareAccelerated
;
MediaDataDecoder
:
:
ConversionRequired
mConversion
;
MediaDataDecoder
:
:
DecodedData
mDecodedData
;
RefPtr
<
mozilla
:
:
layers
:
:
BufferRecycleBin
>
mBufferRecycleBin
;
}
;
}
#
endif
