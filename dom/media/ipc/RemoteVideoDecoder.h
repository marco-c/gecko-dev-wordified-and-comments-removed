#
ifndef
include_dom_media_ipc_RemoteVideoDecoderChild_h
#
define
include_dom_media_ipc_RemoteVideoDecoderChild_h
#
include
"
RemoteDecoderChild
.
h
"
#
include
"
RemoteDecoderParent
.
h
"
namespace
mozilla
{
namespace
layers
{
class
BufferRecycleBin
;
}
}
namespace
mozilla
{
class
KnowsCompositorVideo
;
using
mozilla
:
:
ipc
:
:
IPCResult
;
class
RemoteVideoDecoderChild
:
public
RemoteDecoderChild
{
public
:
explicit
RemoteVideoDecoderChild
(
bool
aRecreatedOnCrash
=
false
)
;
MOZ_IS_CLASS_INIT
MediaResult
InitIPDL
(
const
VideoInfo
&
aVideoInfo
float
aFramerate
const
CreateDecoderParams
:
:
OptionSet
&
aOptions
)
;
IPCResult
RecvOutput
(
const
DecodedOutputIPDL
&
aDecodedData
)
override
;
private
:
RefPtr
<
mozilla
:
:
layers
:
:
Image
>
DeserializeImage
(
const
SurfaceDescriptorBuffer
&
sdBuffer
const
IntSize
&
aPicSize
)
;
RefPtr
<
mozilla
:
:
layers
:
:
BufferRecycleBin
>
mBufferRecycleBin
;
}
;
class
GpuRemoteVideoDecoderChild
final
:
public
RemoteVideoDecoderChild
{
public
:
explicit
GpuRemoteVideoDecoderChild
(
)
;
MOZ_IS_CLASS_INIT
MediaResult
InitIPDL
(
const
VideoInfo
&
aVideoInfo
float
aFramerate
const
CreateDecoderParams
:
:
OptionSet
&
aOptions
const
layers
:
:
TextureFactoryIdentifier
&
aIdentifier
)
;
IPCResult
RecvOutput
(
const
DecodedOutputIPDL
&
aDecodedData
)
override
;
void
RecordShutdownTelemetry
(
bool
aAbnormalShutdown
)
override
;
private
:
nsCString
mBlacklistedD3D11Driver
;
nsCString
mBlacklistedD3D9Driver
;
}
;
class
RemoteVideoDecoderParent
final
:
public
RemoteDecoderParent
{
public
:
RemoteVideoDecoderParent
(
RemoteDecoderManagerParent
*
aParent
const
VideoInfo
&
aVideoInfo
float
aFramerate
const
CreateDecoderParams
:
:
OptionSet
&
aOptions
const
layers
:
:
TextureFactoryIdentifier
&
aIdentifier
TaskQueue
*
aManagerTaskQueue
TaskQueue
*
aDecodeTaskQueue
bool
*
aSuccess
nsCString
*
aErrorDescription
)
;
protected
:
MediaResult
ProcessDecodedData
(
const
MediaDataDecoder
:
:
DecodedData
&
aData
)
override
;
private
:
const
VideoInfo
mVideoInfo
;
RefPtr
<
KnowsCompositorVideo
>
mKnowsCompositor
;
}
;
}
#
endif
