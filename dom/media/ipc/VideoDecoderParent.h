#
ifndef
include_dom_ipc_VideoDecoderParent_h
#
define
include_dom_ipc_VideoDecoderParent_h
#
include
"
mozilla
/
RefPtr
.
h
"
#
include
"
mozilla
/
dom
/
PVideoDecoderParent
.
h
"
#
include
"
VideoDecoderManagerParent
.
h
"
#
include
"
MediaData
.
h
"
#
include
"
ImageContainer
.
h
"
namespace
mozilla
{
namespace
dom
{
class
VideoDecoderParent
final
:
public
PVideoDecoderParent
public
MediaDataDecoderCallback
{
public
:
NS_INLINE_DECL_THREADSAFE_REFCOUNTING
(
VideoDecoderParent
)
VideoDecoderParent
(
VideoDecoderManagerParent
*
aParent
TaskQueue
*
aManagerTaskQueue
TaskQueue
*
aDecodeTaskQueue
)
;
void
Destroy
(
)
;
bool
RecvInit
(
const
VideoInfo
&
aVideoInfo
const
layers
:
:
LayersBackend
&
aBackend
)
override
;
bool
RecvInput
(
const
MediaRawDataIPDL
&
aData
)
override
;
bool
RecvFlush
(
)
override
;
bool
RecvDrain
(
)
override
;
bool
RecvShutdown
(
)
override
;
void
ActorDestroy
(
ActorDestroyReason
aWhy
)
override
;
void
Output
(
MediaData
*
aData
)
override
;
void
Error
(
const
MediaResult
&
aError
)
override
;
void
InputExhausted
(
)
override
;
void
DrainComplete
(
)
override
;
bool
OnReaderTaskQueue
(
)
override
;
private
:
~
VideoDecoderParent
(
)
;
VideoDecoderManagerParent
*
GetManager
(
)
{
return
static_cast
<
VideoDecoderManagerParent
*
>
(
Manager
(
)
)
;
}
RefPtr
<
VideoDecoderManagerParent
>
mParent
;
RefPtr
<
VideoDecoderParent
>
mIPDLSelfRef
;
RefPtr
<
TaskQueue
>
mManagerTaskQueue
;
RefPtr
<
TaskQueue
>
mDecodeTaskQueue
;
RefPtr
<
MediaDataDecoder
>
mDecoder
;
bool
mDestroyed
;
}
;
}
}
#
endif
