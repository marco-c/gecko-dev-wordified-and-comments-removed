#
ifndef
include_ipc_VideoDecoderParent_h
#
define
include_ipc_VideoDecoderParent_h
#
include
"
ImageContainer
.
h
"
#
include
"
MediaData
.
h
"
#
include
"
PlatformDecoderModule
.
h
"
#
include
"
RemoteDecoderManagerParent
.
h
"
#
include
"
mozilla
/
MozPromise
.
h
"
#
include
"
mozilla
/
PVideoDecoderParent
.
h
"
#
include
"
mozilla
/
layers
/
TextureForwarder
.
h
"
namespace
mozilla
{
class
KnowsCompositorVideo
;
using
mozilla
:
:
ipc
:
:
IPCResult
;
class
VideoDecoderParent
final
:
public
PVideoDecoderParent
{
friend
class
PVideoDecoderParent
;
public
:
NS_INLINE_DECL_THREADSAFE_REFCOUNTING
(
VideoDecoderParent
)
VideoDecoderParent
(
RemoteDecoderManagerParent
*
aParent
const
VideoInfo
&
aVideoInfo
float
aFramerate
const
CreateDecoderParams
:
:
OptionSet
&
aOptions
const
layers
:
:
TextureFactoryIdentifier
&
aIdentifier
TaskQueue
*
aManagerTaskQueue
TaskQueue
*
aDecodeTaskQueue
bool
*
aSuccess
nsCString
*
aErrorDescription
)
;
void
Destroy
(
)
;
IPCResult
RecvInit
(
)
;
IPCResult
RecvInput
(
const
MediaRawDataIPDL
&
aData
)
;
IPCResult
RecvFlush
(
)
;
IPCResult
RecvDrain
(
)
;
IPCResult
RecvShutdown
(
)
;
IPCResult
RecvSetSeekThreshold
(
const
media
:
:
TimeUnit
&
aTime
)
;
void
ActorDestroy
(
ActorDestroyReason
aWhy
)
override
;
private
:
bool
OnManagerThread
(
)
;
void
Error
(
const
MediaResult
&
aError
)
;
~
VideoDecoderParent
(
)
;
void
ProcessDecodedData
(
MediaDataDecoder
:
:
DecodedData
&
&
aData
)
;
RefPtr
<
RemoteDecoderManagerParent
>
mParent
;
RefPtr
<
VideoDecoderParent
>
mIPDLSelfRef
;
RefPtr
<
TaskQueue
>
mManagerTaskQueue
;
RefPtr
<
TaskQueue
>
mDecodeTaskQueue
;
RefPtr
<
MediaDataDecoder
>
mDecoder
;
RefPtr
<
KnowsCompositorVideo
>
mKnowsCompositor
;
bool
mDestroyed
;
}
;
}
#
endif
