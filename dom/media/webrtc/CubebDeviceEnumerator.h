#
ifndef
CUBEBDEVICEENUMERATOR_H_
#
define
CUBEBDEVICEENUMERATOR_H_
#
include
"
AudioDeviceInfo
.
h
"
#
include
"
CubebUtils
.
h
"
#
include
"
cubeb
/
cubeb
.
h
"
#
include
"
MediaEventSource
.
h
"
#
include
"
mozilla
/
Mutex
.
h
"
#
include
"
nsTArray
.
h
"
namespace
mozilla
{
class
CubebDeviceEnumerator
final
{
public
:
NS_INLINE_DECL_THREADSAFE_REFCOUNTING
(
CubebDeviceEnumerator
)
static
CubebDeviceEnumerator
*
GetInstance
(
)
;
static
void
Shutdown
(
)
;
void
EnumerateAudioInputDevices
(
nsTArray
<
RefPtr
<
AudioDeviceInfo
>
>
&
aOutDevices
)
;
void
EnumerateAudioOutputDevices
(
nsTArray
<
RefPtr
<
AudioDeviceInfo
>
>
&
aOutDevices
)
;
already_AddRefed
<
AudioDeviceInfo
>
DeviceInfoFromID
(
CubebUtils
:
:
AudioDeviceID
aID
)
;
already_AddRefed
<
AudioDeviceInfo
>
DeviceInfoFromName
(
const
nsString
&
aName
)
;
enum
class
Side
{
INPUT
OUTPUT
}
;
already_AddRefed
<
AudioDeviceInfo
>
DeviceInfoFromName
(
const
nsString
&
aName
Side
aSide
)
;
MediaEventSource
<
void
>
&
OnAudioInputDeviceListChange
(
)
{
return
mOnInputDeviceListChange
;
}
MediaEventSource
<
void
>
&
OnAudioOutputDeviceListChange
(
)
{
return
mOnOutputDeviceListChange
;
}
private
:
CubebDeviceEnumerator
(
)
;
~
CubebDeviceEnumerator
(
)
;
static
void
InputAudioDeviceListChanged_s
(
cubeb
*
aContext
void
*
aUser
)
;
static
void
OutputAudioDeviceListChanged_s
(
cubeb
*
aContext
void
*
aUser
)
;
void
AudioDeviceListChanged
(
Side
aSide
)
;
void
EnumerateAudioDevices
(
Side
aSide
)
;
Mutex
mMutex
;
nsTArray
<
RefPtr
<
AudioDeviceInfo
>
>
mInputDevices
;
nsTArray
<
RefPtr
<
AudioDeviceInfo
>
>
mOutputDevices
;
bool
mManualInputInvalidation
;
bool
mManualOutputInvalidation
;
MediaEventProducer
<
void
>
mOnInputDeviceListChange
;
MediaEventProducer
<
void
>
mOnOutputDeviceListChange
;
static
StaticRefPtr
<
CubebDeviceEnumerator
>
sInstance
;
}
;
typedef
CubebDeviceEnumerator
Enumerator
;
typedef
CubebDeviceEnumerator
:
:
Side
EnumeratorSide
;
}
#
endif
