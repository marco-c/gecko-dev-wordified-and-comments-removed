#
ifndef
MOZILLA_DOM_MEDIA_WEBRTC_JSAPI_RTCENCODEDFRAMEBASE_H_
#
define
MOZILLA_DOM_MEDIA_WEBRTC_JSAPI_RTCENCODEDFRAMEBASE_H_
#
include
<
memory
>
#
include
"
js
/
TypeDecls
.
h
"
#
include
"
mozilla
/
Assertions
.
h
"
#
include
"
mozilla
/
dom
/
TypedArray
.
h
"
class
nsIGlobalObject
;
namespace
webrtc
{
class
TransformableFrameInterface
;
}
namespace
mozilla
:
:
dom
{
struct
RTCEncodedFrameState
{
std
:
:
unique_ptr
<
webrtc
:
:
TransformableFrameInterface
>
mFrame
;
uint64_t
mCounter
=
0
;
unsigned
long
mTimestamp
=
0
;
~
RTCEncodedFrameState
(
)
;
RTCEncodedFrameState
(
)
=
default
;
RTCEncodedFrameState
(
RTCEncodedFrameState
&
&
)
noexcept
=
default
;
RTCEncodedFrameState
&
operator
=
(
RTCEncodedFrameState
&
&
)
noexcept
=
default
;
RTCEncodedFrameState
(
const
RTCEncodedFrameState
&
)
=
delete
;
RTCEncodedFrameState
&
operator
=
(
const
RTCEncodedFrameState
&
)
=
delete
;
}
;
class
RTCRtpScriptTransformer
;
class
RTCEncodedFrameBase
:
public
nsISupports
public
nsWrapperCache
{
public
:
explicit
RTCEncodedFrameBase
(
nsIGlobalObject
*
aGlobal
RTCEncodedFrameState
&
aState
)
;
NS_DECL_CYCLE_COLLECTING_ISUPPORTS
NS_DECL_CYCLE_COLLECTION_SCRIPT_HOLDER_CLASS
(
RTCEncodedFrameBase
)
unsigned
long
Timestamp
(
)
const
;
void
SetData
(
const
ArrayBuffer
&
aData
)
;
void
GetData
(
JSContext
*
aCx
JS
:
:
Rooted
<
JSObject
*
>
*
aObj
)
const
;
uint64_t
GetCounter
(
)
const
;
virtual
bool
CheckOwner
(
RTCRtpScriptTransformer
*
aOwner
)
const
=
0
;
std
:
:
unique_ptr
<
webrtc
:
:
TransformableFrameInterface
>
TakeFrame
(
)
;
virtual
bool
IsVideo
(
)
const
=
0
;
protected
:
virtual
~
RTCEncodedFrameBase
(
)
;
RTCEncodedFrameBase
(
const
RTCEncodedFrameBase
&
)
=
delete
;
RTCEncodedFrameBase
&
operator
=
(
const
RTCEncodedFrameBase
&
)
=
delete
;
RTCEncodedFrameBase
(
RTCEncodedFrameBase
&
&
)
=
delete
;
RTCEncodedFrameBase
&
operator
=
(
RTCEncodedFrameBase
&
&
)
=
delete
;
RefPtr
<
nsIGlobalObject
>
mGlobal
;
RTCEncodedFrameState
&
mState
;
JS
:
:
Heap
<
JSObject
*
>
mData
;
}
;
}
#
endif
