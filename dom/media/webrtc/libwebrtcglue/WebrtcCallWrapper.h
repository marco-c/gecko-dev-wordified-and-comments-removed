#
ifndef
DOM_MEDIA_WEBRTC_LIBWEBRTCGLUE_WEBRTCCALLWRAPPER_H_
#
define
DOM_MEDIA_WEBRTC_LIBWEBRTCGLUE_WEBRTCCALLWRAPPER_H_
#
include
<
set
>
#
include
"
SystemTime
.
h
"
#
include
"
domstubs
.
h
"
#
include
"
jsapi
/
RTCStatsReport
.
h
"
#
include
"
nsISupportsImpl
.
h
"
#
include
"
api
/
video
/
builtin_video_bitrate_allocator_factory
.
h
"
#
include
"
call
/
call
.
h
"
#
include
"
call
/
call_config
.
h
"
namespace
mozilla
{
class
AbstractThread
;
class
MediaSessionConduit
;
class
SharedWebrtcState
;
class
WebrtcEnvironmentWrapper
;
namespace
media
{
class
ShutdownBlockingTicket
;
}
class
WebrtcCallWrapper
{
public
:
typedef
webrtc
:
:
CallConfig
Config
;
static
RefPtr
<
WebrtcCallWrapper
>
Create
(
RefPtr
<
WebrtcEnvironmentWrapper
>
aEnvWrapper
const
dom
:
:
RTCStatsTimestampMaker
&
aTimestampMaker
UniquePtr
<
media
:
:
ShutdownBlockingTicket
>
aShutdownTicket
const
RefPtr
<
SharedWebrtcState
>
&
aSharedState
)
;
NS_INLINE_DECL_THREADSAFE_REFCOUNTING
(
WebrtcCallWrapper
)
WebrtcCallWrapper
(
const
WebrtcCallWrapper
&
)
=
delete
;
void
operator
=
(
const
WebrtcCallWrapper
&
)
=
delete
;
void
SetCall
(
UniquePtr
<
webrtc
:
:
Call
>
aCall
)
;
webrtc
:
:
Call
*
Call
(
)
const
;
void
UnsetRemoteSSRC
(
uint32_t
aSsrc
)
;
void
RegisterConduit
(
MediaSessionConduit
*
conduit
)
;
void
UnregisterConduit
(
MediaSessionConduit
*
conduit
)
;
void
Destroy
(
)
;
const
dom
:
:
RTCStatsTimestampMaker
&
GetTimestampMaker
(
)
const
;
protected
:
virtual
~
WebrtcCallWrapper
(
)
;
WebrtcCallWrapper
(
RefPtr
<
SharedWebrtcState
>
aSharedState
UniquePtr
<
webrtc
:
:
VideoBitrateAllocatorFactory
>
aVideoBitrateAllocatorFactory
RefPtr
<
WebrtcEnvironmentWrapper
>
aEnvWrapper
const
dom
:
:
RTCStatsTimestampMaker
&
aTimestampMaker
UniquePtr
<
media
:
:
ShutdownBlockingTicket
>
aShutdownTicket
)
;
const
RefPtr
<
SharedWebrtcState
>
mSharedState
;
std
:
:
set
<
RefPtr
<
MediaSessionConduit
>
>
mConduits
;
RTCStatsTimestampMakerRealtimeClock
mClock
;
UniquePtr
<
media
:
:
ShutdownBlockingTicket
>
mShutdownTicket
;
public
:
const
RefPtr
<
AbstractThread
>
mCallThread
;
const
RefPtr
<
webrtc
:
:
AudioDecoderFactory
>
mAudioDecoderFactory
;
const
UniquePtr
<
webrtc
:
:
VideoBitrateAllocatorFactory
>
mVideoBitrateAllocatorFactory
;
const
RefPtr
<
WebrtcEnvironmentWrapper
>
mEnvWrapper
;
protected
:
UniquePtr
<
webrtc
:
:
Call
>
mCall
;
}
;
}
#
endif
