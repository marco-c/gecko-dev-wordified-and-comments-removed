#
ifndef
VideoStreamFactory_h
#
define
VideoStreamFactory_h
#
include
"
CodecConfig
.
h
"
#
include
"
mozilla
/
Atomics
.
h
"
#
include
"
mozilla
/
UniquePtr
.
h
"
#
include
"
api
/
video_codecs
/
video_encoder_config
.
h
"
#
include
"
media
/
base
/
video_adapter
.
h
"
namespace
mozilla
{
class
VideoStreamFactory
:
public
webrtc
:
:
VideoEncoderConfig
:
:
VideoStreamFactoryInterface
{
public
:
struct
ResolutionAndBitrateLimits
{
int
resolution_in_mb
;
int
min_bitrate_bps
;
int
start_bitrate_bps
;
int
max_bitrate_bps
;
}
;
static
ResolutionAndBitrateLimits
GetLimitsFor
(
unsigned
int
aWidth
unsigned
int
aHeight
int
aCapBps
=
0
)
;
VideoStreamFactory
(
VideoCodecConfig
aConfig
webrtc
:
:
VideoCodecMode
aCodecMode
int
aMinBitrate
int
aStartBitrate
int
aPrefMaxBitrate
int
aNegotiatedMaxBitrate
unsigned
int
aMaxFramerate
)
:
mCodecMode
(
aCodecMode
)
mMaxFramerateForAllStreams
(
aMaxFramerate
)
mCodecConfig
(
std
:
:
forward
<
VideoCodecConfig
>
(
aConfig
)
)
mMinBitrate
(
aMinBitrate
)
mStartBitrate
(
aStartBitrate
)
mPrefMaxBitrate
(
aPrefMaxBitrate
)
mNegotiatedMaxBitrate
(
aNegotiatedMaxBitrate
)
mSimulcastAdapter
(
MakeUnique
<
cricket
:
:
VideoAdapter
>
(
)
)
{
}
void
SetCodecMode
(
webrtc
:
:
VideoCodecMode
aCodecMode
)
;
void
SetMaxFramerateForAllStreams
(
unsigned
int
aMaxFramerate
)
;
std
:
:
vector
<
webrtc
:
:
VideoStream
>
CreateEncoderStreams
(
int
width
int
height
const
webrtc
:
:
VideoEncoderConfig
&
config
)
override
;
private
:
Atomic
<
webrtc
:
:
VideoCodecMode
>
mCodecMode
;
Atomic
<
unsigned
int
>
mMaxFramerateForAllStreams
;
const
VideoCodecConfig
mCodecConfig
;
const
int
mMinBitrate
=
0
;
const
int
mStartBitrate
=
0
;
const
int
mPrefMaxBitrate
=
0
;
const
int
mNegotiatedMaxBitrate
=
0
;
UniquePtr
<
cricket
:
:
VideoAdapter
>
mSimulcastAdapter
;
}
;
}
#
endif
