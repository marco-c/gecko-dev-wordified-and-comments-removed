#
ifndef
GMPContentParent_h_
#
define
GMPContentParent_h_
#
include
"
mozilla
/
gmp
/
PGMPContentParent
.
h
"
#
include
"
GMPSharedMemManager
.
h
"
#
include
"
nsISupportsImpl
.
h
"
namespace
mozilla
{
namespace
gmp
{
class
GMPDecryptorParent
;
class
GMPParent
;
class
GMPVideoDecoderParent
;
class
GMPVideoEncoderParent
;
class
GMPContentParent
final
:
public
PGMPContentParent
public
GMPSharedMem
{
public
:
NS_INLINE_DECL_THREADSAFE_REFCOUNTING
(
GMPContentParent
)
explicit
GMPContentParent
(
GMPParent
*
aParent
=
nullptr
)
;
nsresult
GetGMPVideoDecoder
(
GMPVideoDecoderParent
*
*
aGMPVD
uint32_t
aDecryptorId
)
;
void
VideoDecoderDestroyed
(
GMPVideoDecoderParent
*
aDecoder
)
;
nsresult
GetGMPVideoEncoder
(
GMPVideoEncoderParent
*
*
aGMPVE
)
;
void
VideoEncoderDestroyed
(
GMPVideoEncoderParent
*
aEncoder
)
;
nsresult
GetGMPDecryptor
(
GMPDecryptorParent
*
*
aGMPKS
)
;
void
DecryptorDestroyed
(
GMPDecryptorParent
*
aSession
)
;
nsIThread
*
GMPThread
(
)
;
void
CheckThread
(
)
override
;
void
SetDisplayName
(
const
nsCString
&
aDisplayName
)
{
mDisplayName
=
aDisplayName
;
}
const
nsCString
&
GetDisplayName
(
)
{
return
mDisplayName
;
}
void
SetPluginId
(
const
uint32_t
aPluginId
)
{
mPluginId
=
aPluginId
;
}
uint32_t
GetPluginId
(
)
const
{
return
mPluginId
;
}
class
CloseBlocker
{
public
:
NS_INLINE_DECL_THREADSAFE_REFCOUNTING
(
CloseBlocker
)
explicit
CloseBlocker
(
GMPContentParent
*
aParent
)
:
mParent
(
aParent
)
{
mParent
-
>
AddCloseBlocker
(
)
;
}
RefPtr
<
GMPContentParent
>
mParent
;
private
:
~
CloseBlocker
(
)
{
mParent
-
>
RemoveCloseBlocker
(
)
;
}
}
;
private
:
void
AddCloseBlocker
(
)
;
void
RemoveCloseBlocker
(
)
;
~
GMPContentParent
(
)
;
void
ActorDestroy
(
ActorDestroyReason
aWhy
)
override
;
PGMPVideoDecoderParent
*
AllocPGMPVideoDecoderParent
(
const
uint32_t
&
aDecryptorId
)
override
;
bool
DeallocPGMPVideoDecoderParent
(
PGMPVideoDecoderParent
*
aActor
)
override
;
PGMPVideoEncoderParent
*
AllocPGMPVideoEncoderParent
(
)
override
;
bool
DeallocPGMPVideoEncoderParent
(
PGMPVideoEncoderParent
*
aActor
)
override
;
PGMPDecryptorParent
*
AllocPGMPDecryptorParent
(
)
override
;
bool
DeallocPGMPDecryptorParent
(
PGMPDecryptorParent
*
aActor
)
override
;
void
CloseIfUnused
(
)
;
void
Close
(
)
{
PGMPContentParent
:
:
Close
(
)
;
}
nsTArray
<
RefPtr
<
GMPVideoDecoderParent
>
>
mVideoDecoders
;
nsTArray
<
RefPtr
<
GMPVideoEncoderParent
>
>
mVideoEncoders
;
nsTArray
<
RefPtr
<
GMPDecryptorParent
>
>
mDecryptors
;
nsCOMPtr
<
nsIThread
>
mGMPThread
;
RefPtr
<
GMPParent
>
mParent
;
nsCString
mDisplayName
;
uint32_t
mPluginId
;
uint32_t
mCloseBlockerCount
=
0
;
}
;
}
}
#
endif
