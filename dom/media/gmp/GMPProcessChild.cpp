#
include
"
GMPProcessChild
.
h
"
#
include
"
base
/
command_line
.
h
"
#
include
"
base
/
string_util
.
h
"
#
include
"
mozilla
/
ipc
/
IOThreadChild
.
h
"
#
include
"
mozilla
/
BackgroundHangMonitor
.
h
"
using
mozilla
:
:
ipc
:
:
IOThreadChild
;
namespace
mozilla
:
:
gmp
{
GMPProcessChild
:
:
GMPProcessChild
(
ProcessId
aParentPid
)
:
ProcessChild
(
aParentPid
)
{
}
GMPProcessChild
:
:
~
GMPProcessChild
(
)
=
default
;
bool
GMPProcessChild
:
:
Init
(
int
aArgc
char
*
aArgv
[
]
)
{
nsAutoString
pluginFilename
;
#
if
defined
(
OS_POSIX
)
std
:
:
vector
<
std
:
:
string
>
values
=
CommandLine
:
:
ForCurrentProcess
(
)
-
>
argv
(
)
;
MOZ_ASSERT
(
values
.
size
(
)
>
=
2
"
not
enough
args
"
)
;
CopyUTF8toUTF16
(
nsDependentCString
(
values
[
1
]
.
c_str
(
)
)
pluginFilename
)
;
#
elif
defined
(
OS_WIN
)
std
:
:
vector
<
std
:
:
wstring
>
values
=
CommandLine
:
:
ForCurrentProcess
(
)
-
>
GetLooseValues
(
)
;
MOZ_ASSERT
(
values
.
size
(
)
>
=
1
"
not
enough
loose
args
"
)
;
pluginFilename
=
nsDependentString
(
values
[
0
]
.
c_str
(
)
)
;
#
else
#
error
Not
implemented
#
endif
BackgroundHangMonitor
:
:
Startup
(
)
;
return
mPlugin
.
Init
(
pluginFilename
TakeInitialEndpoint
(
)
)
;
}
void
GMPProcessChild
:
:
CleanUp
(
)
{
BackgroundHangMonitor
:
:
Shutdown
(
)
;
}
}
