#
ifndef
GMPVideoDecoderChild_h_
#
define
GMPVideoDecoderChild_h_
#
include
"
nsString
.
h
"
#
include
"
mozilla
/
gmp
/
PGMPVideoDecoderChild
.
h
"
#
include
"
gmp
-
video
-
decode
.
h
"
#
include
"
GMPSharedMemManager
.
h
"
#
include
"
GMPVideoHost
.
h
"
#
include
"
mozilla
/
gmp
/
GMPTypes
.
h
"
namespace
mozilla
{
namespace
gmp
{
class
GMPContentChild
;
class
GMPVideoDecoderChild
:
public
PGMPVideoDecoderChild
public
GMPVideoDecoderCallback
public
GMPSharedMemManager
{
public
:
NS_INLINE_DECL_THREADSAFE_REFCOUNTING
(
GMPVideoDecoderChild
)
;
explicit
GMPVideoDecoderChild
(
GMPContentChild
*
aPlugin
)
;
void
Init
(
GMPVideoDecoder
*
aDecoder
)
;
GMPVideoHostImpl
&
Host
(
)
;
void
Decoded
(
GMPVideoi420Frame
*
decodedFrame
)
override
;
void
ReceivedDecodedReferenceFrame
(
const
uint64_t
pictureId
)
override
;
void
ReceivedDecodedFrame
(
const
uint64_t
pictureId
)
override
;
void
InputDataExhausted
(
)
override
;
void
DrainComplete
(
)
override
;
void
ResetComplete
(
)
override
;
void
Error
(
GMPErr
aError
)
override
;
bool
Alloc
(
size_t
aSize
Shmem
:
:
SharedMemory
:
:
SharedMemoryType
aType
Shmem
*
aMem
)
override
;
void
Dealloc
(
Shmem
&
aMem
)
override
;
private
:
virtual
~
GMPVideoDecoderChild
(
)
;
bool
RecvInitDecode
(
const
GMPVideoCodec
&
aCodecSettings
InfallibleTArray
<
uint8_t
>
&
&
aCodecSpecific
const
int32_t
&
aCoreCount
)
override
;
bool
RecvDecode
(
const
GMPVideoEncodedFrameData
&
aInputFrame
const
bool
&
aMissingFrames
InfallibleTArray
<
uint8_t
>
&
&
aCodecSpecificInfo
const
int64_t
&
aRenderTimeMs
)
override
;
bool
RecvChildShmemForPool
(
Shmem
&
&
aFrameBuffer
)
override
;
bool
RecvReset
(
)
override
;
bool
RecvDrain
(
)
override
;
bool
RecvDecodingComplete
(
)
override
;
GMPContentChild
*
mPlugin
;
GMPVideoDecoder
*
mVideoDecoder
;
GMPVideoHostImpl
mVideoHost
;
int
mNeedShmemIntrCount
;
bool
mPendingDecodeComplete
;
}
;
}
}
#
endif
