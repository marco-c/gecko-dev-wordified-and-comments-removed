#
ifndef
MOZILLA_MEDIASTREAMLISTENER_h_
#
define
MOZILLA_MEDIASTREAMLISTENER_h_
#
include
"
StreamTracks
.
h
"
#
include
"
MediaStreamGraph
.
h
"
namespace
mozilla
{
class
AudioSegment
;
class
MediaStream
;
class
MediaStreamGraph
;
class
MediaStreamVideoSink
;
class
VideoSegment
;
class
MediaStreamTrackListener
{
NS_INLINE_DECL_THREADSAFE_REFCOUNTING
(
MediaStreamTrackListener
)
public
:
virtual
void
NotifyPull
(
MediaStreamGraph
*
aGraph
StreamTime
aEndOfAppendedData
StreamTime
aDesiredTime
)
{
}
virtual
void
NotifyQueuedChanges
(
MediaStreamGraph
*
aGraph
StreamTime
aTrackOffset
const
MediaSegment
&
aQueuedMedia
)
{
}
virtual
void
NotifyPrincipalHandleChanged
(
MediaStreamGraph
*
aGraph
const
PrincipalHandle
&
aNewPrincipalHandle
)
{
}
virtual
void
NotifyEnabledStateChanged
(
bool
aEnabled
)
{
}
virtual
void
NotifyOutput
(
MediaStreamGraph
*
aGraph
StreamTime
aCurrentTrackTime
)
{
}
virtual
void
NotifyEnded
(
)
{
}
virtual
void
NotifyRemoved
(
)
{
}
protected
:
virtual
~
MediaStreamTrackListener
(
)
{
}
}
;
class
DirectMediaStreamTrackListener
:
public
MediaStreamTrackListener
{
friend
class
SourceMediaStream
;
friend
class
TrackUnionStream
;
public
:
virtual
void
NotifyRealtimeTrackData
(
MediaStreamGraph
*
aGraph
StreamTime
aTrackOffset
const
MediaSegment
&
aMedia
)
{
}
enum
class
InstallationResult
{
TRACK_NOT_FOUND_AT_SOURCE
TRACK_TYPE_NOT_SUPPORTED
STREAM_NOT_SUPPORTED
ALREADY_EXISTS
SUCCESS
}
;
virtual
void
NotifyDirectListenerInstalled
(
InstallationResult
aResult
)
{
}
virtual
void
NotifyDirectListenerUninstalled
(
)
{
}
protected
:
virtual
~
DirectMediaStreamTrackListener
(
)
{
}
void
MirrorAndDisableSegment
(
AudioSegment
&
aFrom
AudioSegment
&
aTo
)
;
void
MirrorAndDisableSegment
(
VideoSegment
&
aFrom
VideoSegment
&
aTo
DisabledTrackMode
aMode
)
;
void
NotifyRealtimeTrackDataAndApplyTrackDisabling
(
MediaStreamGraph
*
aGraph
StreamTime
aTrackOffset
MediaSegment
&
aMedia
)
;
void
IncreaseDisabled
(
DisabledTrackMode
aMode
)
;
void
DecreaseDisabled
(
DisabledTrackMode
aMode
)
;
Atomic
<
int32_t
>
mDisabledFreezeCount
;
Atomic
<
int32_t
>
mDisabledBlackCount
;
nsAutoPtr
<
MediaSegment
>
mMedia
;
}
;
}
#
endif
