#
ifndef
MediaStatistics_h_
#
define
MediaStatistics_h_
namespace
mozilla
{
struct
MediaStatistics
{
double
mPlaybackRate
;
double
mDownloadRate
;
int64_t
mTotalBytes
;
int64_t
mDownloadPosition
;
int64_t
mDecoderPosition
;
int64_t
mPlaybackPosition
;
bool
mDownloadRateReliable
;
bool
mPlaybackRateReliable
;
bool
CanPlayThrough
(
)
{
static
const
int64_t
CAN_PLAY_THROUGH_MARGIN
=
1
;
if
(
(
mTotalBytes
<
0
&
&
mDownloadRateReliable
)
|
|
(
mTotalBytes
>
=
0
&
&
mTotalBytes
=
=
mDownloadPosition
)
)
{
return
true
;
}
if
(
!
mDownloadRateReliable
|
|
!
mPlaybackRateReliable
)
{
return
false
;
}
int64_t
bytesToDownload
=
mTotalBytes
-
mDownloadPosition
;
int64_t
bytesToPlayback
=
mTotalBytes
-
mPlaybackPosition
;
double
timeToDownload
=
bytesToDownload
/
mDownloadRate
;
double
timeToPlay
=
bytesToPlayback
/
mPlaybackRate
;
if
(
timeToDownload
>
timeToPlay
)
{
return
false
;
}
int64_t
readAheadMargin
=
static_cast
<
int64_t
>
(
mPlaybackRate
*
CAN_PLAY_THROUGH_MARGIN
)
;
return
mDownloadPosition
>
mPlaybackPosition
+
readAheadMargin
;
}
}
;
}
#
endif
