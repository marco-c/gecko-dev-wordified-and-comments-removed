#
ifndef
ReverbConvolver_h
#
define
ReverbConvolver_h
#
include
"
ReverbAccumulationBuffer
.
h
"
#
include
"
ReverbInputBuffer
.
h
"
#
include
"
nsAutoPtr
.
h
"
#
include
"
mozilla
/
MemoryReporting
.
h
"
#
ifdef
LOG
#
undef
LOG
#
endif
#
include
"
base
/
condition_variable
.
h
"
#
include
"
base
/
lock
.
h
"
#
include
"
base
/
thread
.
h
"
namespace
WebCore
{
class
ReverbConvolverStage
;
class
ReverbConvolver
{
public
:
ReverbConvolver
(
const
float
*
impulseResponseData
size_t
impulseResponseLength
size_t
maxFFTSize
size_t
convolverRenderPhase
bool
useBackgroundThreads
)
;
~
ReverbConvolver
(
)
;
void
process
(
const
float
*
sourceChannelData
float
*
destinationChannelData
)
;
size_t
impulseResponseLength
(
)
const
{
return
m_impulseResponseLength
;
}
ReverbInputBuffer
*
inputBuffer
(
)
{
return
&
m_inputBuffer
;
}
bool
useBackgroundThreads
(
)
const
{
return
m_useBackgroundThreads
;
}
void
backgroundThreadEntry
(
)
;
size_t
sizeOfIncludingThis
(
mozilla
:
:
MallocSizeOf
aMallocSizeOf
)
const
;
private
:
nsTArray
<
nsAutoPtr
<
ReverbConvolverStage
>
>
m_stages
;
nsTArray
<
nsAutoPtr
<
ReverbConvolverStage
>
>
m_backgroundStages
;
size_t
m_impulseResponseLength
;
ReverbAccumulationBuffer
m_accumulationBuffer
;
ReverbInputBuffer
m_inputBuffer
;
base
:
:
Thread
m_backgroundThread
;
Lock
m_backgroundThreadLock
;
ConditionVariable
m_backgroundThreadCondition
;
bool
m_useBackgroundThreads
;
bool
m_wantsToExit
;
bool
m_moreInputBuffered
;
}
;
}
#
endif
