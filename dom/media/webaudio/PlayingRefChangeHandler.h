#
ifndef
PlayingRefChangeHandler_h__
#
define
PlayingRefChangeHandler_h__
#
include
"
nsThreadUtils
.
h
"
#
include
"
AudioNodeTrack
.
h
"
namespace
mozilla
{
namespace
dom
{
class
PlayingRefChangeHandler
final
:
public
Runnable
{
public
:
enum
ChangeType
{
ADDREF
RELEASE
}
;
PlayingRefChangeHandler
(
AudioNodeTrack
*
aTrack
ChangeType
aChange
)
:
Runnable
(
"
dom
:
:
PlayingRefChangeHandler
"
)
mTrack
(
aTrack
)
mChange
(
aChange
)
{
}
NS_IMETHOD
Run
(
)
override
{
RefPtr
<
AudioNode
>
node
=
mTrack
-
>
Engine
(
)
-
>
NodeMainThread
(
)
;
if
(
node
)
{
if
(
mChange
=
=
ADDREF
)
{
node
-
>
MarkActive
(
)
;
}
else
if
(
mChange
=
=
RELEASE
)
{
node
-
>
MarkInactive
(
)
;
}
}
return
NS_OK
;
}
private
:
RefPtr
<
AudioNodeTrack
>
mTrack
;
ChangeType
mChange
;
}
;
}
}
#
endif
