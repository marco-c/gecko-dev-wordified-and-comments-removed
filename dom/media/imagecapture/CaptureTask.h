#
ifndef
CAPTURETASK_H
#
define
CAPTURETASK_H
#
include
"
MediaStreamGraph
.
h
"
#
include
"
MediaStreamListener
.
h
"
#
include
"
PrincipalChangeObserver
.
h
"
namespace
mozilla
{
namespace
dom
{
class
Blob
;
class
ImageCapture
;
class
MediaStreamTrack
;
}
class
CaptureTask
:
public
DirectMediaStreamTrackListener
public
dom
:
:
PrincipalChangeObserver
<
dom
:
:
MediaStreamTrack
>
{
public
:
class
MediaStreamEventListener
;
void
NotifyRealtimeTrackData
(
MediaStreamGraph
*
aGraph
StreamTime
aTrackOffset
const
MediaSegment
&
aMedia
)
override
;
void
PrincipalChanged
(
dom
:
:
MediaStreamTrack
*
aMediaStreamTrack
)
override
;
nsresult
TaskComplete
(
already_AddRefed
<
dom
:
:
Blob
>
aBlob
nsresult
aRv
)
;
void
AttachTrack
(
)
;
void
DetachTrack
(
)
;
explicit
CaptureTask
(
dom
:
:
ImageCapture
*
aImageCapture
)
;
protected
:
virtual
~
CaptureTask
(
)
{
}
void
PostTrackEndEvent
(
)
;
RefPtr
<
dom
:
:
ImageCapture
>
mImageCapture
;
RefPtr
<
MediaStreamEventListener
>
mEventListener
;
Atomic
<
bool
>
mImageGrabbedOrTrackEnd
;
bool
mPrincipalChanged
;
}
;
}
#
endif
