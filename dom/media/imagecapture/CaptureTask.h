#
ifndef
CAPTURETASK_H
#
define
CAPTURETASK_H
#
include
"
MediaStreamGraph
.
h
"
#
include
"
MediaStreamListener
.
h
"
#
include
"
PrincipalChangeObserver
.
h
"
namespace
mozilla
{
namespace
dom
{
class
Blob
;
class
ImageCapture
;
class
MediaStreamTrack
;
}
class
CaptureTask
:
public
MediaStreamTrackListener
public
dom
:
:
PrincipalChangeObserver
<
dom
:
:
MediaStreamTrack
>
{
public
:
void
NotifyQueuedChanges
(
MediaStreamGraph
*
aGraph
StreamTime
aTrackOffset
const
MediaSegment
&
aQueuedMedia
)
override
;
void
NotifyEnded
(
)
override
;
void
PrincipalChanged
(
dom
:
:
MediaStreamTrack
*
aMediaStreamTrack
)
override
;
nsresult
TaskComplete
(
already_AddRefed
<
dom
:
:
Blob
>
aBlob
nsresult
aRv
)
;
void
AttachTrack
(
)
;
void
DetachTrack
(
)
;
explicit
CaptureTask
(
dom
:
:
ImageCapture
*
aImageCapture
)
:
mImageCapture
(
aImageCapture
)
mImageGrabbedOrTrackEnd
(
false
)
mPrincipalChanged
(
false
)
{
}
protected
:
virtual
~
CaptureTask
(
)
{
}
void
PostTrackEndEvent
(
)
;
RefPtr
<
dom
:
:
ImageCapture
>
mImageCapture
;
bool
mImageGrabbedOrTrackEnd
;
bool
mPrincipalChanged
;
}
;
}
#
endif
