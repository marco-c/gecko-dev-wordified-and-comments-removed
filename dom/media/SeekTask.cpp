#
include
"
SeekTask
.
h
"
#
include
"
MediaDecoderReaderWrapper
.
h
"
#
include
"
mozilla
/
AbstractThread
.
h
"
namespace
mozilla
{
SeekTask
:
:
SeekTask
(
const
void
*
aDecoderID
AbstractThread
*
aThread
MediaDecoderReaderWrapper
*
aReader
SeekJob
&
&
aSeekJob
)
:
mDecoderID
(
aDecoderID
)
mOwnerThread
(
aThread
)
mReader
(
aReader
)
mSeekJob
(
Move
(
aSeekJob
)
)
mIsDiscarded
(
false
)
mIsAudioQueueFinished
(
false
)
mIsVideoQueueFinished
(
false
)
mNeedToStopPrerollingAudio
(
false
)
mNeedToStopPrerollingVideo
(
false
)
{
AssertOwnerThread
(
)
;
}
SeekTask
:
:
~
SeekTask
(
)
{
AssertOwnerThread
(
)
;
MOZ_ASSERT
(
mIsDiscarded
)
;
}
void
SeekTask
:
:
Resolve
(
const
char
*
aCallSite
)
{
AssertOwnerThread
(
)
;
SeekTaskResolveValue
val
;
val
.
mSeekedAudioData
=
mSeekedAudioData
;
val
.
mSeekedVideoData
=
mSeekedVideoData
;
val
.
mIsAudioQueueFinished
=
mIsAudioQueueFinished
;
val
.
mIsVideoQueueFinished
=
mIsVideoQueueFinished
;
val
.
mNeedToStopPrerollingAudio
=
mNeedToStopPrerollingAudio
;
val
.
mNeedToStopPrerollingVideo
=
mNeedToStopPrerollingVideo
;
mSeekTaskPromise
.
Resolve
(
val
aCallSite
)
;
}
void
SeekTask
:
:
RejectIfExist
(
const
char
*
aCallSite
)
{
AssertOwnerThread
(
)
;
SeekTaskRejectValue
val
;
val
.
mIsAudioQueueFinished
=
mIsAudioQueueFinished
;
val
.
mIsVideoQueueFinished
=
mIsVideoQueueFinished
;
val
.
mNeedToStopPrerollingAudio
=
mNeedToStopPrerollingAudio
;
val
.
mNeedToStopPrerollingVideo
=
mNeedToStopPrerollingVideo
;
mSeekTaskPromise
.
RejectIfExists
(
val
aCallSite
)
;
}
void
SeekTask
:
:
AssertOwnerThread
(
)
const
{
MOZ_ASSERT
(
mOwnerThread
-
>
IsCurrentThreadIn
(
)
)
;
}
AbstractThread
*
SeekTask
:
:
OwnerThread
(
)
const
{
AssertOwnerThread
(
)
;
return
mOwnerThread
;
}
SeekJob
&
SeekTask
:
:
GetSeekJob
(
)
{
AssertOwnerThread
(
)
;
return
mSeekJob
;
}
bool
SeekTask
:
:
Exists
(
)
const
{
AssertOwnerThread
(
)
;
return
!
mSeekTaskPromise
.
IsEmpty
(
)
|
|
mSeekJob
.
Exists
(
)
;
}
}
