#
ifndef
EncodedFrame_h_
#
define
EncodedFrame_h_
#
include
"
nsISupportsImpl
.
h
"
#
include
"
mozilla
/
media
/
MediaUtils
.
h
"
#
include
"
VideoUtils
.
h
"
namespace
mozilla
{
class
EncodedFrame
final
{
NS_INLINE_DECL_THREADSAFE_REFCOUNTING
(
EncodedFrame
)
public
:
enum
FrameType
{
VP8_I_FRAME
VP8_P_FRAME
OPUS_AUDIO_FRAME
UNKNOWN
}
;
using
ConstFrameData
=
const
media
:
:
Refcountable
<
nsTArray
<
uint8_t
>
>
;
using
FrameData
=
media
:
:
Refcountable
<
nsTArray
<
uint8_t
>
>
;
EncodedFrame
(
uint64_t
aTime
uint64_t
aDuration
uint64_t
aDurationBase
FrameType
aFrameType
RefPtr
<
ConstFrameData
>
aData
)
:
mTime
(
aTime
)
mDuration
(
aDuration
)
mDurationBase
(
aDurationBase
)
mFrameType
(
aFrameType
)
mFrameData
(
std
:
:
move
(
aData
)
)
{
MOZ_ASSERT
(
mFrameData
)
;
MOZ_ASSERT_IF
(
mFrameType
=
=
VP8_I_FRAME
mDurationBase
=
=
PR_USEC_PER_SEC
)
;
MOZ_ASSERT_IF
(
mFrameType
=
=
VP8_P_FRAME
mDurationBase
=
=
PR_USEC_PER_SEC
)
;
MOZ_ASSERT_IF
(
mFrameType
=
=
OPUS_AUDIO_FRAME
mDurationBase
=
=
48000
)
;
}
const
uint64_t
mTime
;
const
uint64_t
mDuration
;
const
uint64_t
mDurationBase
;
const
FrameType
mFrameType
;
const
RefPtr
<
ConstFrameData
>
mFrameData
;
uint64_t
GetEndTime
(
)
const
{
return
mTime
+
FramesToUsecs
(
mDuration
mDurationBase
)
.
value
(
)
;
}
private
:
~
EncodedFrame
(
)
=
default
;
}
;
}
#
endif
