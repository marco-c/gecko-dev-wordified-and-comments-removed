#
ifndef
DOM_MEDIA_ENCODER_MUXER_H_
#
define
DOM_MEDIA_ENCODER_MUXER_H_
#
include
"
MediaQueue
.
h
"
namespace
mozilla
{
class
ContainerWriter
;
class
EncodedFrame
;
class
TrackMetadataBase
;
class
Muxer
{
public
:
explicit
Muxer
(
UniquePtr
<
ContainerWriter
>
aWriter
)
;
~
Muxer
(
)
=
default
;
bool
IsFinished
(
)
;
bool
NeedsMetadata
(
)
const
{
return
!
mMetadataSet
;
}
nsresult
SetMetadata
(
const
nsTArray
<
RefPtr
<
TrackMetadataBase
>
>
&
aMetadata
)
;
void
AddEncodedAudioFrame
(
EncodedFrame
*
aFrame
)
;
void
AddEncodedVideoFrame
(
EncodedFrame
*
aFrame
)
;
void
AudioEndOfStream
(
)
;
void
VideoEndOfStream
(
)
;
nsresult
GetData
(
nsTArray
<
nsTArray
<
uint8_t
>
>
*
aOutputBuffers
)
;
private
:
nsresult
Mux
(
)
;
MediaQueue
<
EncodedFrame
>
mEncodedAudioQueue
;
MediaQueue
<
EncodedFrame
>
mEncodedVideoQueue
;
UniquePtr
<
ContainerWriter
>
mWriter
;
bool
mMetadataSet
=
false
;
bool
mMetadataEncoded
=
false
;
bool
mHasAudio
=
false
;
bool
mHasVideo
=
false
;
}
;
}
#
endif
