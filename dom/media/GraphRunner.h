#
ifndef
mozilla_GraphRunner_h
#
define
mozilla_GraphRunner_h
#
include
"
MediaSegment
.
h
"
#
include
"
mozilla
/
Monitor
.
h
"
#
include
<
thread
>
struct
PRThread
;
namespace
mozilla
{
class
GraphDriver
;
class
MediaTrackGraphImpl
;
class
GraphRunner
final
:
public
Runnable
{
public
:
static
already_AddRefed
<
GraphRunner
>
Create
(
MediaTrackGraphImpl
*
aGraph
)
;
MOZ_CAN_RUN_SCRIPT
void
Shutdown
(
)
;
bool
OneIteration
(
GraphTime
aStateEnd
)
;
NS_IMETHOD
Run
(
)
;
bool
OnThread
(
)
;
#
ifdef
DEBUG
bool
RunByGraphDriver
(
GraphDriver
*
aDriver
)
;
#
endif
private
:
explicit
GraphRunner
(
MediaTrackGraphImpl
*
aGraph
already_AddRefed
<
nsIThread
>
aThread
)
;
~
GraphRunner
(
)
;
Monitor
mMonitor
;
MediaTrackGraphImpl
*
const
mGraph
;
GraphTime
mStateEnd
;
bool
mStillProcessing
;
enum
class
ThreadState
{
Wait
Run
Shutdown
}
;
ThreadState
mThreadState
;
const
nsCOMPtr
<
nsIThread
>
mThread
;
#
ifdef
DEBUG
std
:
:
thread
:
:
id
mAudioDriverThreadId
=
std
:
:
thread
:
:
id
(
)
;
nsIThread
*
mClockDriverThread
=
nullptr
;
#
endif
}
;
}
#
endif
