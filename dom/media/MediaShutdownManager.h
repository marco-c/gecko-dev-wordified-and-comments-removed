#
if
!
defined
(
MediaShutdownManager_h_
)
#
define
MediaShutdownManager_h_
#
include
"
mozilla
/
Monitor
.
h
"
#
include
"
mozilla
/
RefPtr
.
h
"
#
include
"
mozilla
/
StaticPtr
.
h
"
#
include
"
nsCOMPtr
.
h
"
#
include
"
nsIAsyncShutdown
.
h
"
#
include
"
nsIThread
.
h
"
#
include
"
nsHashKeys
.
h
"
#
include
"
nsTHashtable
.
h
"
namespace
mozilla
{
class
MediaDecoder
;
class
MediaShutdownManager
:
public
nsIAsyncShutdownBlocker
{
public
:
NS_DECL_ISUPPORTS
NS_DECL_NSIASYNCSHUTDOWNBLOCKER
static
void
InitStatics
(
)
;
static
MediaShutdownManager
&
Instance
(
)
;
void
Register
(
MediaDecoder
*
aDecoder
)
;
void
Unregister
(
MediaDecoder
*
aDecoder
)
;
private
:
MediaShutdownManager
(
)
;
virtual
~
MediaShutdownManager
(
)
;
void
RemoveBlocker
(
)
;
void
EnsureCorrectShutdownObserverState
(
)
;
static
StaticRefPtr
<
MediaShutdownManager
>
sInstance
;
nsTHashtable
<
nsRefPtrHashKey
<
MediaDecoder
>
>
mDecoders
;
bool
mIsObservingShutdown
;
bool
mIsDoingXPCOMShutDown
;
}
;
}
#
endif
