#
ifndef
mozilla_AppleVTDecoder_h
#
define
mozilla_AppleVTDecoder_h
#
include
"
AppleVDADecoder
.
h
"
#
include
"
VideoToolbox
/
VideoToolbox
.
h
"
namespace
mozilla
{
class
AppleVTDecoder
:
public
AppleVDADecoder
{
public
:
AppleVTDecoder
(
const
VideoInfo
&
aConfig
FlushableTaskQueue
*
aVideoTaskQueue
MediaDataDecoderCallback
*
aCallback
layers
:
:
ImageContainer
*
aImageContainer
)
;
virtual
~
AppleVTDecoder
(
)
;
RefPtr
<
InitPromise
>
Init
(
)
override
;
nsresult
Input
(
MediaRawData
*
aSample
)
override
;
bool
IsHardwareAccelerated
(
nsACString
&
aFailureReason
)
const
override
{
return
mIsHardwareAccelerated
;
}
const
char
*
GetDescriptionName
(
)
const
override
{
return
mIsHardwareAccelerated
?
"
apple
hardware
VT
decoder
"
:
"
apple
software
VT
decoder
"
;
}
protected
:
void
ProcessFlush
(
)
override
;
void
ProcessDrain
(
)
override
;
void
ProcessShutdown
(
)
override
;
private
:
CMVideoFormatDescriptionRef
mFormat
;
VTDecompressionSessionRef
mSession
;
nsresult
SubmitFrame
(
MediaRawData
*
aSample
)
;
nsresult
InitializeSession
(
)
;
nsresult
WaitForAsynchronousFrames
(
)
;
CFDictionaryRef
CreateDecoderSpecification
(
)
;
CFDictionaryRef
CreateDecoderExtensions
(
)
;
Atomic
<
bool
>
mIsHardwareAccelerated
;
}
;
}
#
endif
