#
ifndef
mozilla_AppleUtils_h
#
define
mozilla_AppleUtils_h
#
include
"
mozilla
/
Attributes
.
h
"
namespace
mozilla
{
template
<
class
T
>
class
AutoCFRelease
{
public
:
MOZ_IMPLICIT
AutoCFRelease
(
T
aRef
)
:
mRef
(
aRef
)
{
}
~
AutoCFRelease
(
)
{
if
(
mRef
)
{
CFRelease
(
mRef
)
;
}
}
operator
T
(
)
{
return
mRef
;
}
T
*
receive
(
)
{
return
&
mRef
;
}
private
:
AutoCFRelease
<
T
>
&
operator
=
(
const
AutoCFRelease
<
T
>
&
)
;
T
mRef
;
}
;
template
<
class
T
>
class
CFRefPtr
{
public
:
explicit
CFRefPtr
(
T
aRef
)
:
mRef
(
aRef
)
{
if
(
mRef
)
{
CFRetain
(
mRef
)
;
}
}
CFRefPtr
(
const
CFRefPtr
<
T
>
&
aCFRefPtr
)
:
mRef
(
aCFRefPtr
.
mRef
)
{
if
(
mRef
)
{
CFRetain
(
mRef
)
;
}
}
CFRefPtr
<
T
>
&
operator
=
(
const
CFRefPtr
<
T
>
&
aCFRefPtr
)
{
if
(
mRef
=
=
aCFRefPtr
.
mRef
)
{
return
;
}
if
(
mRef
)
{
CFRelease
(
mRef
)
;
}
mRef
=
aCFRefPtr
.
mRef
;
if
(
mRef
)
{
CFRetain
(
mRef
)
;
}
return
*
this
;
}
~
CFRefPtr
(
)
{
if
(
mRef
)
{
CFRelease
(
mRef
)
;
}
}
operator
T
(
)
{
return
mRef
;
}
private
:
T
mRef
;
}
;
}
#
endif
