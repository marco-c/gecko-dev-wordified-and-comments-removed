#
ifndef
DOM_MEDIA_PLATFORM_WMF_MFMEDIAENGINEVIDEOSTREAM_H
#
define
DOM_MEDIA_PLATFORM_WMF_MFMEDIAENGINEVIDEOSTREAM_H
#
include
"
MFMediaEngineStream
.
h
"
#
include
"
mozilla
/
Mutex
.
h
"
namespace
mozilla
{
namespace
layers
{
class
Image
;
class
DcompSurfaceImage
;
}
class
MFMediaSource
;
class
MFMediaEngineVideoStream
final
:
public
MFMediaEngineStream
{
public
:
MFMediaEngineVideoStream
(
)
=
default
;
static
MFMediaEngineVideoStream
*
Create
(
uint64_t
aStreamId
const
TrackInfo
&
aInfo
MFMediaSource
*
aParentSource
)
;
nsCString
GetDescriptionName
(
)
const
override
{
return
"
media
engine
video
stream
"
_ns
;
}
TrackInfo
:
:
TrackType
TrackType
(
)
override
{
return
TrackInfo
:
:
TrackType
:
:
kVideoTrack
;
}
void
SetKnowsCompositor
(
layers
:
:
KnowsCompositor
*
aKnowsCompositor
)
{
MutexAutoLock
lock
(
mMutex
)
;
mKnowsCompositor
=
aKnowsCompositor
;
}
HANDLE
GetDcompSurfaceHandle
(
)
{
MutexAutoLock
lock
(
mMutex
)
;
return
mDCompSurfaceHandle
;
}
void
SetDCompSurfaceHandle
(
HANDLE
aDCompSurfaceHandle
)
;
MFMediaEngineVideoStream
*
AsVideoStream
(
)
override
{
return
this
;
}
layers
:
:
Image
*
GetDcompSurfaceImage
(
)
;
already_AddRefed
<
MediaData
>
OutputData
(
MediaRawData
*
aSample
)
override
;
private
:
HRESULT
CreateMediaType
(
const
TrackInfo
&
aInfo
IMFMediaType
*
*
aMediaType
)
override
;
bool
HasEnoughRawData
(
)
const
override
;
VideoInfo
mInfo
;
Mutex
mMutex
{
"
MFMediaEngineVideoStream
"
}
;
HANDLE
mDCompSurfaceHandle
MOZ_GUARDED_BY
(
mMutex
)
;
bool
mNeedRecreateImage
MOZ_GUARDED_BY
(
mMutex
)
;
RefPtr
<
layers
:
:
KnowsCompositor
>
mKnowsCompositor
MOZ_GUARDED_BY
(
mMutex
)
;
RefPtr
<
layers
:
:
DcompSurfaceImage
>
mDcompSurfaceImage
;
}
;
}
#
endif
