#
if
!
defined
(
DXVA2Manager_h_
)
#
define
DXVA2Manager_h_
#
include
"
MediaInfo
.
h
"
#
include
"
WMF
.
h
"
#
include
"
mozilla
/
Mutex
.
h
"
#
include
"
nsAutoPtr
.
h
"
#
include
"
mozilla
/
gfx
/
Rect
.
h
"
#
include
"
d3d11
.
h
"
namespace
mozilla
{
namespace
layers
{
class
Image
;
class
ImageContainer
;
class
KnowsCompositor
;
}
class
DXVA2Manager
{
public
:
static
DXVA2Manager
*
CreateD3D9DXVA
(
layers
:
:
KnowsCompositor
*
aKnowsCompositor
nsACString
&
aFailureReason
)
;
static
DXVA2Manager
*
CreateD3D11DXVA
(
layers
:
:
KnowsCompositor
*
aKnowsCompositor
nsACString
&
aFailureReason
ID3D11Device
*
aDevice
=
nullptr
)
;
virtual
IUnknown
*
GetDXVADeviceManager
(
)
=
0
;
virtual
HRESULT
CopyToImage
(
IMFSample
*
aVideoSample
const
gfx
:
:
IntRect
&
aRegion
layers
:
:
Image
*
*
aOutImage
)
=
0
;
virtual
HRESULT
CopyToBGRATexture
(
ID3D11Texture2D
*
aInTexture
const
GUID
&
aSubType
ID3D11Texture2D
*
*
aOutTexture
)
{
MOZ_CRASH
(
"
CopyToBGRATexture
not
implemented
on
this
manager
.
"
)
;
return
E_FAIL
;
}
virtual
HRESULT
ConfigureForSize
(
IMFMediaType
*
aInputType
)
{
return
S_OK
;
}
virtual
bool
IsD3D11
(
)
{
return
false
;
}
virtual
~
DXVA2Manager
(
)
;
virtual
bool
SupportsConfig
(
IMFMediaType
*
aType
float
aFramerate
)
=
0
;
static
bool
IsNV12Supported
(
uint32_t
aVendorID
uint32_t
aDeviceID
const
nsAString
&
aDriverVersionString
)
;
protected
:
Mutex
mLock
;
DXVA2Manager
(
)
;
bool
IsUnsupportedResolution
(
const
uint32_t
&
aWidth
const
uint32_t
&
aHeight
const
float
&
aFramerate
)
const
;
bool
mIsAMDPreUVD4
=
false
;
}
;
}
#
endif
