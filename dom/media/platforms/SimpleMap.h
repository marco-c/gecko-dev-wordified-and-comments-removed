#
ifndef
mozilla_SimpleMap_h
#
define
mozilla_SimpleMap_h
#
include
"
mozilla
/
Mutex
.
h
"
#
include
"
nsTArray
.
h
"
#
include
<
utility
>
namespace
mozilla
{
template
<
typename
T
>
class
SimpleMap
{
public
:
typedef
std
:
:
pair
<
int64_t
T
>
Element
;
SimpleMap
(
)
:
mMutex
(
"
SimpleMap
"
)
{
}
void
Insert
(
int64_t
aKey
const
T
&
aValue
)
{
MutexAutoLock
lock
(
mMutex
)
;
mMap
.
AppendElement
(
std
:
:
make_pair
(
aKey
aValue
)
)
;
}
bool
Find
(
int64_t
aKey
T
&
aValue
)
{
MutexAutoLock
lock
(
mMutex
)
;
for
(
uint32_t
i
=
0
;
i
<
mMap
.
Length
(
)
;
i
+
+
)
{
Element
&
element
=
mMap
[
i
]
;
if
(
element
.
first
=
=
aKey
)
{
aValue
=
element
.
second
;
mMap
.
RemoveElementAt
(
i
)
;
return
true
;
}
}
return
false
;
}
void
Clear
(
)
{
MutexAutoLock
lock
(
mMutex
)
;
mMap
.
Clear
(
)
;
}
template
<
typename
F
>
void
ForEach
(
F
&
&
aCallback
)
{
MutexAutoLock
lock
(
mMutex
)
;
for
(
const
auto
&
element
:
mMap
)
{
aCallback
(
element
.
first
element
.
second
)
;
}
}
private
:
Mutex
mMutex
MOZ_UNANNOTATED
;
AutoTArray
<
Element
16
>
mMap
;
}
;
}
#
endif
