#
if
!
defined
(
PDMFactory_h_
)
#
define
PDMFactory_h_
#
include
"
PlatformDecoderModule
.
h
"
#
include
"
mozilla
/
StaticMutex
.
h
"
class
CDMProxy
;
namespace
mozilla
{
class
DecoderDoctorDiagnostics
;
class
PDMFactoryImpl
;
template
<
class
T
>
class
StaticAutoPtr
;
class
PDMFactory
final
{
public
:
NS_INLINE_DECL_THREADSAFE_REFCOUNTING
(
PDMFactory
)
PDMFactory
(
)
;
already_AddRefed
<
MediaDataDecoder
>
CreateDecoder
(
const
CreateDecoderParams
&
aParams
)
;
bool
SupportsMimeType
(
const
nsACString
&
aMimeType
DecoderDoctorDiagnostics
*
aDiagnostics
)
const
;
bool
Supports
(
const
TrackInfo
&
aTrackInfo
DecoderDoctorDiagnostics
*
aDiagnostics
)
const
;
void
SetCDMProxy
(
CDMProxy
*
aProxy
)
;
static
constexpr
int
kYUV400
=
0
;
static
constexpr
int
kYUV420
=
1
;
static
constexpr
int
kYUV422
=
2
;
static
constexpr
int
kYUV444
=
3
;
private
:
virtual
~
PDMFactory
(
)
;
void
CreatePDMs
(
)
;
void
CreateBlankPDM
(
)
;
bool
StartupPDM
(
PlatformDecoderModule
*
aPDM
)
;
already_AddRefed
<
PlatformDecoderModule
>
GetDecoder
(
const
TrackInfo
&
aTrackInfo
DecoderDoctorDiagnostics
*
aDiagnostics
)
const
;
already_AddRefed
<
MediaDataDecoder
>
CreateDecoderWithPDM
(
PlatformDecoderModule
*
aPDM
const
CreateDecoderParams
&
aParams
)
;
nsTArray
<
RefPtr
<
PlatformDecoderModule
>
>
mCurrentPDMs
;
RefPtr
<
PlatformDecoderModule
>
mEMEPDM
;
RefPtr
<
PlatformDecoderModule
>
mBlankPDM
;
bool
mWMFFailedToLoad
=
false
;
bool
mFFmpegFailedToLoad
=
false
;
bool
mGMPPDMFailedToStartup
=
false
;
void
EnsureInit
(
)
const
;
template
<
class
T
>
friend
class
StaticAutoPtr
;
static
StaticAutoPtr
<
PDMFactoryImpl
>
sInstance
;
static
StaticMutex
sMonitor
;
}
;
}
#
endif
