#
if
!
defined
(
PDMFactory_h_
)
#
define
PDMFactory_h_
#
include
"
DecoderDoctorDiagnostics
.
h
"
#
include
"
PlatformDecoderModule
.
h
"
#
include
"
mozilla
/
StaticMutex
.
h
"
class
CDMProxy
;
namespace
mozilla
{
class
PDMFactoryImpl
;
template
<
class
T
>
class
StaticAutoPtr
;
class
PDMFactory
final
{
public
:
NS_INLINE_DECL_THREADSAFE_REFCOUNTING
(
PDMFactory
)
PDMFactory
(
)
;
already_AddRefed
<
MediaDataDecoder
>
CreateDecoder
(
const
CreateDecoderParams
&
aParams
)
;
bool
SupportsMimeType
(
const
nsACString
&
aMimeType
DecoderDoctorDiagnostics
*
aDiagnostics
)
const
;
bool
Supports
(
const
SupportDecoderParams
&
aParams
DecoderDoctorDiagnostics
*
aDiagnostics
)
const
;
void
SetCDMProxy
(
CDMProxy
*
aProxy
)
;
static
constexpr
int
kYUV400
=
0
;
static
constexpr
int
kYUV420
=
1
;
static
constexpr
int
kYUV422
=
2
;
static
constexpr
int
kYUV444
=
3
;
private
:
virtual
~
PDMFactory
(
)
=
default
;
void
CreatePDMs
(
)
;
void
CreateNullPDM
(
)
;
void
CreateGpuPDMs
(
)
;
void
CreateRddPDMs
(
)
;
void
CreateDefaultPDMs
(
)
;
template
<
typename
DECODER_MODULE
typename
.
.
.
ARGS
>
bool
CreateAndStartupPDM
(
ARGS
&
&
.
.
.
aArgs
)
{
return
StartupPDM
(
DECODER_MODULE
:
:
Create
(
std
:
:
forward
<
ARGS
>
(
aArgs
)
.
.
.
)
)
;
}
bool
StartupPDM
(
already_AddRefed
<
PlatformDecoderModule
>
aPDM
bool
aInsertAtBeginning
=
false
)
;
already_AddRefed
<
PlatformDecoderModule
>
GetDecoderModule
(
const
SupportDecoderParams
&
aParams
DecoderDoctorDiagnostics
*
aDiagnostics
)
const
;
already_AddRefed
<
MediaDataDecoder
>
CreateDecoderWithPDM
(
PlatformDecoderModule
*
aPDM
const
CreateDecoderParams
&
aParams
)
;
nsTArray
<
RefPtr
<
PlatformDecoderModule
>
>
mCurrentPDMs
;
RefPtr
<
PlatformDecoderModule
>
mEMEPDM
;
RefPtr
<
PlatformDecoderModule
>
mNullPDM
;
DecoderDoctorDiagnostics
:
:
FlagsSet
mFailureFlags
;
friend
class
RemoteVideoDecoderParent
;
static
void
EnsureInit
(
)
;
template
<
class
T
>
friend
class
StaticAutoPtr
;
static
StaticAutoPtr
<
PDMFactoryImpl
>
sInstance
;
static
StaticMutex
sMonitor
;
}
;
}
#
endif
