#
if
!
defined
(
PDMFactory_h_
)
#
define
PDMFactory_h_
#
include
"
PlatformDecoderModule
.
h
"
class
CDMProxy
;
namespace
mozilla
{
class
PDMFactory
final
{
public
:
NS_INLINE_DECL_THREADSAFE_REFCOUNTING
(
PDMFactory
)
PDMFactory
(
)
;
static
void
Init
(
)
;
already_AddRefed
<
MediaDataDecoder
>
CreateDecoder
(
const
TrackInfo
&
aConfig
FlushableTaskQueue
*
aTaskQueue
MediaDataDecoderCallback
*
aCallback
layers
:
:
LayersBackend
aLayersBackend
=
layers
:
:
LayersBackend
:
:
LAYERS_NONE
layers
:
:
ImageContainer
*
aImageContainer
=
nullptr
)
;
bool
SupportsMimeType
(
const
nsACString
&
aMimeType
)
const
;
#
ifdef
MOZ_EME
void
SetCDMProxy
(
CDMProxy
*
aProxy
)
;
#
endif
private
:
virtual
~
PDMFactory
(
)
;
void
CreatePDMs
(
)
;
bool
StartupPDM
(
PlatformDecoderModule
*
aPDM
)
;
already_AddRefed
<
PlatformDecoderModule
>
GetDecoder
(
const
nsACString
&
aMimeType
)
const
;
already_AddRefed
<
MediaDataDecoder
>
CreateDecoderWithPDM
(
PlatformDecoderModule
*
aPDM
const
TrackInfo
&
aConfig
FlushableTaskQueue
*
aTaskQueue
MediaDataDecoderCallback
*
aCallback
layers
:
:
LayersBackend
aLayersBackend
layers
:
:
ImageContainer
*
aImageContainer
)
;
static
bool
sUseBlankDecoder
;
#
ifdef
MOZ_GONK_MEDIACODEC
static
bool
sGonkDecoderEnabled
;
#
endif
#
ifdef
MOZ_WIDGET_ANDROID
static
bool
sAndroidMCDecoderPreferred
;
static
bool
sAndroidMCDecoderEnabled
;
#
endif
static
bool
sGMPDecoderEnabled
;
#
ifdef
MOZ_FFVPX
static
bool
sFFVPXDecoderEnabled
;
#
endif
#
ifdef
MOZ_FFMPEG
static
bool
sFFmpegDecoderEnabled
;
#
endif
#
ifdef
XP_WIN
static
bool
sWMFDecoderEnabled
;
#
endif
static
bool
sEnableFuzzingWrapper
;
static
uint32_t
sVideoOutputMinimumInterval_ms
;
static
bool
sDontDelayInputExhausted
;
nsTArray
<
RefPtr
<
PlatformDecoderModule
>
>
mCurrentPDMs
;
RefPtr
<
PlatformDecoderModule
>
mEMEPDM
;
}
;
}
#
endif
