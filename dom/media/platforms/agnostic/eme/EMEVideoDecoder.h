#
ifndef
EMEVideoDecoder_h_
#
define
EMEVideoDecoder_h_
#
include
"
GMPVideoDecoder
.
h
"
#
include
"
PlatformDecoderModule
.
h
"
namespace
mozilla
{
class
CDMProxy
;
class
TaskQueue
;
class
EMEVideoCallbackAdapter
:
public
VideoCallbackAdapter
{
public
:
EMEVideoCallbackAdapter
(
MediaDataDecoderCallbackProxy
*
aCallback
VideoInfo
aVideoInfo
layers
:
:
ImageContainer
*
aImageContainer
)
:
VideoCallbackAdapter
(
aCallback
aVideoInfo
aImageContainer
)
{
}
void
Error
(
GMPErr
aErr
)
override
;
}
;
class
EMEVideoDecoder
:
public
GMPVideoDecoder
{
public
:
EMEVideoDecoder
(
CDMProxy
*
aProxy
const
VideoInfo
&
aConfig
layers
:
:
LayersBackend
aLayersBackend
layers
:
:
ImageContainer
*
aImageContainer
TaskQueue
*
aTaskQueue
MediaDataDecoderCallbackProxy
*
aCallback
)
:
GMPVideoDecoder
(
aConfig
aLayersBackend
aImageContainer
aTaskQueue
aCallback
new
EMEVideoCallbackAdapter
(
aCallback
VideoInfo
(
aConfig
.
mDisplay
.
width
aConfig
.
mDisplay
.
height
)
aImageContainer
)
)
mProxy
(
aProxy
)
{
}
private
:
void
InitTags
(
nsTArray
<
nsCString
>
&
aTags
)
override
;
nsCString
GetNodeId
(
)
override
;
GMPUniquePtr
<
GMPVideoEncodedFrame
>
CreateFrame
(
MediaRawData
*
aSample
)
override
;
nsRefPtr
<
CDMProxy
>
mProxy
;
}
;
}
#
endif
