#
ifndef
mozilla_VideoEngine_h
#
define
mozilla_VideoEngine_h
#
include
"
MediaEngine
.
h
"
#
include
"
VideoFrameUtils
.
h
"
#
include
"
mozilla
/
media
/
MediaUtils
.
h
"
#
include
"
webrtc
/
modules
/
video_capture
/
video_capture_impl
.
h
"
#
include
"
webrtc
/
modules
/
video_capture
/
video_capture_defines
.
h
"
#
include
"
webrtc
/
modules
/
video_capture
/
video_capture_factory
.
h
"
#
include
"
webrtc
/
video_engine
/
desktop_capture_impl
.
h
"
#
include
<
memory
>
#
include
<
functional
>
namespace
mozilla
{
namespace
camera
{
class
VideoEngine
{
private
:
virtual
~
VideoEngine
(
)
{
}
;
static
const
int64_t
kCacheExpiryPeriodMs
=
2000
;
public
:
VideoEngine
(
)
:
mId
(
0
)
{
}
;
NS_INLINE_DECL_REFCOUNTING
(
VideoEngine
)
static
already_AddRefed
<
VideoEngine
>
Create
(
UniquePtr
<
const
webrtc
:
:
Config
>
&
&
aConfig
)
;
#
if
defined
(
ANDROID
)
static
int
SetAndroidObjects
(
)
;
#
endif
void
CreateVideoCapture
(
int32_t
&
id
const
char
*
deviceUniqueIdUTF8
)
;
int
ReleaseVideoCapture
(
const
int32_t
id
)
;
static
void
Delete
(
VideoEngine
*
engine
)
{
}
std
:
:
shared_ptr
<
webrtc
:
:
VideoCaptureModule
:
:
DeviceInfo
>
GetOrCreateVideoCaptureDeviceInfo
(
)
;
const
UniquePtr
<
const
webrtc
:
:
Config
>
&
GetConfiguration
(
)
;
class
CaptureEntry
{
public
:
CaptureEntry
(
int32_t
aCapnum
rtc
:
:
scoped_refptr
<
webrtc
:
:
VideoCaptureModule
>
aCapture
)
;
int32_t
Capnum
(
)
const
;
rtc
:
:
scoped_refptr
<
webrtc
:
:
VideoCaptureModule
>
VideoCapture
(
)
;
private
:
int32_t
mCapnum
;
rtc
:
:
scoped_refptr
<
webrtc
:
:
VideoCaptureModule
>
mVideoCaptureModule
;
friend
class
VideoEngine
;
}
;
bool
WithEntry
(
const
int32_t
entryCapnum
const
std
:
:
function
<
void
(
CaptureEntry
&
entry
)
>
&
&
fn
)
;
private
:
explicit
VideoEngine
(
UniquePtr
<
const
webrtc
:
:
Config
>
&
&
aConfig
)
;
int32_t
mId
;
webrtc
:
:
CaptureDeviceInfo
mCaptureDevInfo
;
std
:
:
shared_ptr
<
webrtc
:
:
VideoCaptureModule
:
:
DeviceInfo
>
mDeviceInfo
;
UniquePtr
<
const
webrtc
:
:
Config
>
mConfig
;
std
:
:
map
<
int32_t
CaptureEntry
>
mCaps
;
std
:
:
map
<
int32_t
int32_t
>
mIdMap
;
int64_t
mExpiryTimeInMs
=
0
;
int32_t
GenerateId
(
)
;
static
int32_t
sId
;
}
;
}
}
#
endif
