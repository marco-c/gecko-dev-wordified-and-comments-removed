#
include
"
MP3Decoder
.
h
"
#
include
"
MediaContainerType
.
h
"
#
include
"
MediaDecoderStateMachine
.
h
"
#
include
"
MediaFormatReader
.
h
"
#
include
"
MP3Demuxer
.
h
"
#
include
"
PDMFactory
.
h
"
namespace
mozilla
{
MediaDecoder
*
MP3Decoder
:
:
Clone
(
MediaDecoderOwner
*
aOwner
)
{
if
(
!
IsEnabled
(
)
)
{
return
nullptr
;
}
return
new
MP3Decoder
(
aOwner
)
;
}
MediaDecoderStateMachine
*
MP3Decoder
:
:
CreateStateMachine
(
)
{
RefPtr
<
MediaDecoderReader
>
reader
=
new
MediaFormatReader
(
this
new
mp3
:
:
MP3Demuxer
(
GetResource
(
)
)
)
;
return
new
MediaDecoderStateMachine
(
this
reader
)
;
}
bool
MP3Decoder
:
:
IsEnabled
(
)
{
RefPtr
<
PDMFactory
>
platform
=
new
PDMFactory
(
)
;
return
platform
-
>
SupportsMimeType
(
NS_LITERAL_CSTRING
(
"
audio
/
mpeg
"
)
nullptr
)
;
}
bool
MP3Decoder
:
:
IsSupportedType
(
const
MediaContainerType
&
aContainerType
)
{
if
(
aContainerType
.
Type
(
)
=
=
MEDIAMIMETYPE
(
"
audio
/
mp3
"
)
|
|
aContainerType
.
Type
(
)
=
=
MEDIAMIMETYPE
(
"
audio
/
mpeg
"
)
)
{
return
IsEnabled
(
)
&
&
(
aContainerType
.
ExtendedType
(
)
.
Codecs
(
)
.
IsEmpty
(
)
|
|
aContainerType
.
ExtendedType
(
)
.
Codecs
(
)
.
AsString
(
)
.
EqualsASCII
(
"
mp3
"
)
)
;
}
return
false
;
}
}
