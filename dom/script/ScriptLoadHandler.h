#
ifndef
mozilla_dom_ScriptLoadHandler_h
#
define
mozilla_dom_ScriptLoadHandler_h
#
include
"
nsIIncrementalStreamLoader
.
h
"
namespace
mozilla
{
namespace
dom
{
class
ScriptLoadRequest
;
class
ScriptLoader
;
class
SRICheckDataVerifier
;
class
ScriptLoadHandler
final
:
public
nsIIncrementalStreamLoaderObserver
{
public
:
explicit
ScriptLoadHandler
(
ScriptLoader
*
aScriptLoader
ScriptLoadRequest
*
aRequest
SRICheckDataVerifier
*
aSRIDataVerifier
)
;
NS_DECL_ISUPPORTS
NS_DECL_NSIINCREMENTALSTREAMLOADEROBSERVER
private
:
virtual
~
ScriptLoadHandler
(
)
;
template
<
typename
Unit
>
nsresult
DecodeRawDataHelper
(
const
uint8_t
*
aData
uint32_t
aDataLength
bool
aEndOfStream
)
;
nsresult
DecodeRawData
(
const
uint8_t
*
aData
uint32_t
aDataLength
bool
aEndOfStream
)
;
bool
EnsureDecoder
(
nsIIncrementalStreamLoader
*
aLoader
const
uint8_t
*
aData
uint32_t
aDataLength
bool
aEndOfStream
)
{
if
(
mDecoder
)
{
return
true
;
}
return
TrySetDecoder
(
aLoader
aData
aDataLength
aEndOfStream
)
;
}
bool
TrySetDecoder
(
nsIIncrementalStreamLoader
*
aLoader
const
uint8_t
*
aData
uint32_t
aDataLength
bool
aEndOfStream
)
;
nsresult
MaybeDecodeSRI
(
)
;
nsresult
EnsureKnownDataType
(
nsIIncrementalStreamLoader
*
aLoader
)
;
RefPtr
<
ScriptLoader
>
mScriptLoader
;
RefPtr
<
ScriptLoadRequest
>
mRequest
;
nsAutoPtr
<
SRICheckDataVerifier
>
mSRIDataVerifier
;
nsresult
mSRIStatus
;
mozilla
:
:
UniquePtr
<
mozilla
:
:
Decoder
>
mDecoder
;
}
;
}
}
#
endif
