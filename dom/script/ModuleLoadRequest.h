#
ifndef
mozilla_dom_ModuleLoadRequest_h
#
define
mozilla_dom_ModuleLoadRequest_h
#
include
"
ScriptLoadRequest
.
h
"
#
include
"
nsURIHashKey
.
h
"
#
include
"
mozilla
/
MozPromise
.
h
"
namespace
mozilla
{
namespace
dom
{
class
ModuleScript
;
class
ScriptLoader
;
class
VisitedURLSet
:
public
nsTHashtable
<
nsURIHashKey
>
{
NS_INLINE_DECL_REFCOUNTING
(
VisitedURLSet
)
private
:
~
VisitedURLSet
(
)
=
default
;
}
;
class
ModuleLoadRequest
final
:
public
ScriptLoadRequest
{
~
ModuleLoadRequest
(
)
=
default
;
ModuleLoadRequest
(
const
ModuleLoadRequest
&
aOther
)
=
delete
;
ModuleLoadRequest
(
ModuleLoadRequest
&
&
aOther
)
=
delete
;
public
:
NS_DECL_ISUPPORTS_INHERITED
NS_DECL_CYCLE_COLLECTION_CLASS_INHERITED
(
ModuleLoadRequest
ScriptLoadRequest
)
ModuleLoadRequest
(
nsIURI
*
aURI
nsIScriptElement
*
aElement
ValidJSVersion
aValidJSVersion
CORSMode
aCORSMode
const
SRIMetadata
&
aIntegrity
ScriptLoader
*
aLoader
)
;
ModuleLoadRequest
(
nsIURI
*
aURI
ModuleLoadRequest
*
aParent
)
;
bool
IsTopLevel
(
)
const
{
return
mIsTopLevel
;
}
void
SetReady
(
)
override
;
void
Cancel
(
)
override
;
void
ModuleLoaded
(
)
;
void
ModuleErrored
(
)
;
void
DependenciesLoaded
(
)
;
void
LoadFailed
(
)
;
private
:
void
LoadFinished
(
)
;
void
CancelImports
(
)
;
public
:
const
bool
mIsTopLevel
;
nsCOMPtr
<
nsIURI
>
mBaseURL
;
RefPtr
<
ScriptLoader
>
mLoader
;
RefPtr
<
ModuleScript
>
mModuleScript
;
MozPromiseHolder
<
GenericPromise
>
mReady
;
nsTArray
<
RefPtr
<
ModuleLoadRequest
>
>
mImports
;
RefPtr
<
VisitedURLSet
>
mVisitedSet
;
}
;
}
}
#
endif
