#
include
"
ScriptTrace
.
h
"
namespace
mozilla
{
namespace
dom
{
namespace
script
{
static
nsresult
TestingDispatchEvent
(
nsIScriptElement
*
aScriptElement
const
nsAString
&
aEventType
)
{
static
bool
sExposeTestInterfaceEnabled
=
false
;
static
bool
sExposeTestInterfacePrefCached
=
false
;
if
(
!
sExposeTestInterfacePrefCached
)
{
sExposeTestInterfacePrefCached
=
true
;
Preferences
:
:
AddBoolVarCache
(
&
sExposeTestInterfaceEnabled
"
dom
.
expose_test_interfaces
"
false
)
;
}
if
(
!
sExposeTestInterfaceEnabled
)
{
return
NS_OK
;
}
nsCOMPtr
<
nsINode
>
target
(
do_QueryInterface
(
aScriptElement
)
)
;
if
(
!
target
)
{
return
NS_OK
;
}
RefPtr
<
AsyncEventDispatcher
>
dispatcher
=
new
AsyncEventDispatcher
(
target
aEventType
CanBubble
:
:
eYes
ChromeOnlyDispatch
:
:
eNo
)
;
return
dispatcher
-
>
PostDOMEvent
(
)
;
}
}
}
}
