#
ifndef
mozilla_dom_timeout_handler_h
#
define
mozilla_dom_timeout_handler_h
#
include
"
nsCOMPtr
.
h
"
#
include
"
nsIGlobalObject
.
h
"
#
include
"
nsISupports
.
h
"
#
include
"
nsCycleCollectionParticipant
.
h
"
#
include
"
nsString
.
h
"
#
include
"
mozilla
/
Attributes
.
h
"
#
include
"
mozilla
/
dom
/
FunctionBinding
.
h
"
namespace
mozilla
{
namespace
dom
{
class
TimeoutHandler
:
public
nsISupports
{
public
:
NS_DECL_CYCLE_COLLECTING_ISUPPORTS
NS_DECL_CYCLE_COLLECTION_CLASS
(
TimeoutHandler
)
MOZ_CAN_RUN_SCRIPT
virtual
bool
Call
(
const
char
*
)
;
virtual
void
GetLocation
(
const
char
*
*
aFileName
uint32_t
*
aLineNo
uint32_t
*
aColumn
)
;
virtual
void
GetDescription
(
nsACString
&
aOutString
)
;
virtual
void
MarkForCC
(
)
{
}
protected
:
TimeoutHandler
(
)
:
mFileName
(
"
"
)
mLineNo
(
0
)
mColumn
(
0
)
{
}
explicit
TimeoutHandler
(
JSContext
*
aCx
)
;
virtual
~
TimeoutHandler
(
)
{
}
nsCString
mFileName
;
uint32_t
mLineNo
;
uint32_t
mColumn
;
private
:
TimeoutHandler
(
const
TimeoutHandler
&
)
=
delete
;
TimeoutHandler
&
operator
=
(
const
TimeoutHandler
&
)
=
delete
;
TimeoutHandler
&
operator
=
(
const
TimeoutHandler
&
&
)
=
delete
;
}
;
class
ScriptTimeoutHandler
:
public
TimeoutHandler
{
public
:
NS_DECL_ISUPPORTS_INHERITED
NS_DECL_CYCLE_COLLECTION_CLASS_INHERITED
(
ScriptTimeoutHandler
TimeoutHandler
)
ScriptTimeoutHandler
(
JSContext
*
aCx
nsIGlobalObject
*
aGlobal
const
nsAString
&
aExpression
)
;
MOZ_CAN_RUN_SCRIPT
virtual
bool
Call
(
const
char
*
)
override
{
return
false
;
}
;
virtual
void
GetDescription
(
nsACString
&
aOutString
)
override
;
protected
:
virtual
~
ScriptTimeoutHandler
(
)
{
}
nsCOMPtr
<
nsIGlobalObject
>
mGlobal
;
nsString
mExpr
;
}
;
class
CallbackTimeoutHandler
final
:
public
TimeoutHandler
{
public
:
NS_DECL_ISUPPORTS_INHERITED
NS_DECL_CYCLE_COLLECTION_SCRIPT_HOLDER_CLASS_INHERITED
(
CallbackTimeoutHandler
TimeoutHandler
)
CallbackTimeoutHandler
(
JSContext
*
aCx
nsIGlobalObject
*
aGlobal
Function
*
aFunction
nsTArray
<
JS
:
:
Heap
<
JS
:
:
Value
>
>
&
&
aArguments
)
;
MOZ_CAN_RUN_SCRIPT
virtual
bool
Call
(
const
char
*
aExecutionReason
)
override
;
virtual
void
MarkForCC
(
)
override
;
virtual
void
GetDescription
(
nsACString
&
aOutString
)
override
;
void
ReleaseJSObjects
(
)
;
private
:
virtual
~
CallbackTimeoutHandler
(
)
{
ReleaseJSObjects
(
)
;
}
nsCOMPtr
<
nsIGlobalObject
>
mGlobal
;
RefPtr
<
Function
>
mFunction
;
nsTArray
<
JS
:
:
Heap
<
JS
:
:
Value
>
>
mArgs
;
}
;
}
}
#
endif
