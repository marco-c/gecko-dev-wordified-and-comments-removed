const
{
classes
:
Cc
interfaces
:
Ci
utils
:
Cu
}
=
Components
;
Cu
.
import
(
"
resource
:
/
/
gre
/
modules
/
XPCOMUtils
.
jsm
"
)
;
Cu
.
import
(
'
resource
:
/
/
gre
/
modules
/
Services
.
jsm
'
)
;
function
RandomSelector
(
)
{
}
RandomSelector
.
prototype
=
{
classID
:
Components
.
ID
(
"
{
c616fcfd
-
9737
-
41f1
-
aa74
-
cee72a38f91b
}
"
)
QueryInterface
:
XPCOMUtils
.
generateQI
(
[
Ci
.
nsIContentProcessProvider
]
)
provideProcess
(
aType
aOpener
aProcesses
aCount
aMaxCount
)
{
if
(
aCount
<
aMaxCount
)
{
return
Ci
.
nsIContentProcessProvider
.
NEW_PROCESS
;
}
let
startIdx
=
Math
.
floor
(
Math
.
random
(
)
*
aMaxCount
)
;
let
curIdx
=
startIdx
;
do
{
if
(
aProcesses
[
curIdx
]
.
opener
=
=
=
aOpener
)
{
return
curIdx
;
}
curIdx
=
(
curIdx
+
1
)
%
aMaxCount
;
}
while
(
curIdx
!
=
=
startIdx
)
;
return
Ci
.
nsIContentProcessProvider
.
NEW_PROCESS
;
}
}
;
function
MinTabSelector
(
)
{
}
MinTabSelector
.
prototype
=
{
classID
:
Components
.
ID
(
"
{
2dc08eaf
-
6eef
-
4394
-
b1df
-
a3a927c1290b
}
"
)
QueryInterface
:
XPCOMUtils
.
generateQI
(
[
Ci
.
nsIContentProcessProvider
]
)
provideProcess
(
aType
aOpener
aProcesses
aCount
aMaxCount
)
{
if
(
aCount
<
aMaxCount
)
{
return
Ci
.
nsIContentProcessProvider
.
NEW_PROCESS
;
}
let
min
=
Number
.
MAX_VALUE
;
let
candidate
=
Ci
.
nsIContentProcessProvider
.
NEW_PROCESS
;
for
(
let
i
=
0
;
i
<
aMaxCount
;
i
+
+
)
{
let
process
=
aProcesses
[
i
]
;
let
tabCount
=
process
.
tabCount
;
if
(
process
.
opener
=
=
=
aOpener
&
&
tabCount
<
min
)
{
min
=
tabCount
;
candidate
=
i
;
}
}
return
candidate
;
}
}
;
var
components
=
[
RandomSelector
MinTabSelector
]
;
this
.
NSGetFactory
=
XPCOMUtils
.
generateNSGetFactory
(
components
)
;
