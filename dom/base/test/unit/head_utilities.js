ChromeUtils
.
import
(
"
resource
:
/
/
testing
-
common
/
httpd
.
js
"
)
;
ChromeUtils
.
import
(
"
resource
:
/
/
gre
/
modules
/
NetUtil
.
jsm
"
)
;
const
nsIDocumentEncoder
=
Ci
.
nsIDocumentEncoder
;
const
replacementChar
=
Ci
.
nsIConverterInputStream
.
DEFAULT_REPLACEMENT_CHARACTER
;
function
loadContentFile
(
aFile
aCharset
)
{
if
(
aCharset
=
=
undefined
)
aCharset
=
"
UTF
-
8
"
;
var
file
=
do_get_file
(
aFile
)
;
var
ios
=
Cc
[
"
mozilla
.
org
/
network
/
io
-
service
;
1
"
]
.
getService
(
Ci
.
nsIIOService
)
;
var
chann
=
NetUtil
.
newChannel
(
{
uri
:
ios
.
newFileURI
(
file
)
loadUsingSystemPrincipal
:
true
}
)
;
chann
.
contentCharset
=
aCharset
;
var
inputStream
=
Cc
[
"
mozilla
.
org
/
intl
/
converter
-
input
-
stream
;
1
"
]
.
createInstance
(
Ci
.
nsIConverterInputStream
)
;
inputStream
.
init
(
chann
.
open2
(
)
aCharset
1024
replacementChar
)
;
var
str
=
{
}
content
=
"
"
;
while
(
inputStream
.
readString
(
4096
str
)
!
=
0
)
{
content
+
=
str
.
value
;
}
return
content
;
}
