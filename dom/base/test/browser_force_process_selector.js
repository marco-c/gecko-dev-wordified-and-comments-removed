"
use
strict
"
;
const
CONTENT_CREATED
=
"
ipc
:
content
-
created
"
;
async
function
spawnNewAndTest
(
recur
pids
)
{
await
BrowserTestUtils
.
withNewTab
(
{
gBrowser
url
:
"
about
:
blank
"
forceNewProcess
:
true
}
async
function
(
browser
)
{
let
newPid
=
browser
.
frameLoader
.
remoteTab
.
osPid
;
ok
(
!
pids
.
has
(
newPid
)
"
new
tab
is
in
its
own
process
:
"
+
recur
)
;
pids
.
add
(
newPid
)
;
if
(
recur
)
{
await
spawnNewAndTest
(
recur
-
1
pids
)
;
}
else
{
await
BrowserTestUtils
.
withNewTab
(
{
gBrowser
url
:
"
about
:
blank
"
}
function
(
lastBrowser
)
{
let
lastPid
=
lastBrowser
.
frameLoader
.
remoteTab
.
osPid
;
ok
(
pids
.
has
(
lastPid
)
"
final
tab
cannot
be
in
its
own
process
"
)
;
}
)
;
}
}
)
;
}
add_task
(
async
function
test
(
)
{
let
curPid
=
gBrowser
.
selectedBrowser
.
frameLoader
.
remoteTab
.
osPid
;
let
maxCount
=
Services
.
prefs
.
getIntPref
(
"
dom
.
ipc
.
processCount
"
)
;
await
spawnNewAndTest
(
Math
.
max
(
maxCount
+
1
5
)
new
Set
(
[
curPid
]
)
)
;
}
)
;
