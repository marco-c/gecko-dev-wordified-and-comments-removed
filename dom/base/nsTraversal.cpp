#
include
"
nsTraversal
.
h
"
#
include
"
nsError
.
h
"
#
include
"
nsINode
.
h
"
#
include
"
mozilla
/
AutoRestore
.
h
"
#
include
"
mozilla
/
dom
/
NodeFilterBinding
.
h
"
#
include
"
nsGkAtoms
.
h
"
using
namespace
mozilla
;
using
namespace
mozilla
:
:
dom
;
nsTraversal
:
:
nsTraversal
(
nsINode
*
aRoot
uint32_t
aWhatToShow
NodeFilter
*
aFilter
)
:
mRoot
(
aRoot
)
mWhatToShow
(
aWhatToShow
)
mFilter
(
aFilter
)
mInAcceptNode
(
false
)
{
NS_ASSERTION
(
aRoot
"
invalid
root
in
call
to
nsTraversal
constructor
"
)
;
}
nsTraversal
:
:
~
nsTraversal
(
)
{
}
int16_t
nsTraversal
:
:
TestNode
(
nsINode
*
aNode
mozilla
:
:
ErrorResult
&
aResult
nsCOMPtr
<
nsINode
>
*
aUnskippedNode
)
{
if
(
mInAcceptNode
)
{
aResult
.
Throw
(
NS_ERROR_DOM_INVALID_STATE_ERR
)
;
return
0
;
}
uint16_t
nodeType
=
aNode
-
>
NodeType
(
)
;
if
(
nodeType
<
=
12
&
&
!
(
(
1
<
<
(
nodeType
-
1
)
)
&
mWhatToShow
)
)
{
return
NodeFilter_Binding
:
:
FILTER_SKIP
;
}
if
(
aUnskippedNode
)
{
*
aUnskippedNode
=
aNode
;
}
if
(
!
mFilter
)
{
return
NodeFilter_Binding
:
:
FILTER_ACCEPT
;
}
AutoRestore
<
bool
>
inAcceptNode
(
mInAcceptNode
)
;
mInAcceptNode
=
true
;
return
mFilter
-
>
AcceptNode
(
*
aNode
aResult
nullptr
CallbackObject
:
:
eRethrowExceptions
)
;
}
