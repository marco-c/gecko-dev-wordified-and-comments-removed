#
ifndef
mozilla_dom_AutoPrintEventDispatcher_h
#
define
mozilla_dom_AutoPrintEventDispatcher_h
#
include
"
mozilla
/
dom
/
Document
.
h
"
#
include
"
nsContentUtils
.
h
"
namespace
mozilla
:
:
dom
{
class
AutoPrintEventDispatcher
{
static
void
CollectInProcessSubdocuments
(
Document
&
aDoc
nsTArray
<
nsCOMPtr
<
Document
>
>
&
aDocs
)
{
aDocs
.
AppendElement
(
&
aDoc
)
;
auto
recurse
=
[
&
aDocs
]
(
Document
&
aSubDoc
)
{
CollectInProcessSubdocuments
(
aSubDoc
aDocs
)
;
return
CallState
:
:
Continue
;
}
;
aDoc
.
EnumerateSubDocuments
(
recurse
)
;
}
void
DispatchEvent
(
bool
aBefore
)
{
for
(
nsCOMPtr
<
Document
>
&
doc
:
mDocuments
)
{
nsContentUtils
:
:
DispatchTrustedEvent
(
doc
doc
-
>
GetWindow
(
)
aBefore
?
u
"
beforeprint
"
_ns
:
u
"
afterprint
"
_ns
CanBubble
:
:
eNo
Cancelable
:
:
eNo
nullptr
)
;
}
}
public
:
explicit
AutoPrintEventDispatcher
(
Document
&
aDoc
)
{
if
(
!
aDoc
.
IsStaticDocument
(
)
)
{
CollectInProcessSubdocuments
(
aDoc
mDocuments
)
;
}
DispatchEvent
(
true
)
;
}
~
AutoPrintEventDispatcher
(
)
{
DispatchEvent
(
false
)
;
}
AutoTArray
<
nsCOMPtr
<
Document
>
8
>
mDocuments
;
}
;
}
#
endif
