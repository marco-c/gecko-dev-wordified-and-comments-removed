#
ifndef
mozilla_dom_AutoPrintEventDispatcher_h
#
define
mozilla_dom_AutoPrintEventDispatcher_h
#
include
"
mozilla
/
dom
/
Document
.
h
"
#
include
"
mozilla
/
dom
/
DocumentInlines
.
h
"
#
include
"
nsContentUtils
.
h
"
#
include
"
nsGlobalWindowOuter
.
h
"
#
include
"
nsIPrintSettings
.
h
"
namespace
mozilla
:
:
dom
{
class
AutoPrintEventDispatcher
{
static
void
CollectInProcessSubdocuments
(
Document
&
aDoc
nsTArray
<
nsCOMPtr
<
Document
>
>
&
aDocs
)
{
aDoc
.
EnumerateSubDocuments
(
[
&
aDocs
]
(
Document
&
aSubDoc
)
{
aDocs
.
AppendElement
(
&
aSubDoc
)
;
CollectInProcessSubdocuments
(
aSubDoc
aDocs
)
;
return
CallState
:
:
Continue
;
}
)
;
}
MOZ_CAN_RUN_SCRIPT
void
DispatchEvent
(
bool
aBefore
)
{
for
(
auto
&
doc
:
mDocuments
)
{
nsContentUtils
:
:
DispatchTrustedEvent
(
doc
nsGlobalWindowOuter
:
:
Cast
(
doc
-
>
GetWindow
(
)
)
aBefore
?
u
"
beforeprint
"
_ns
:
u
"
afterprint
"
_ns
CanBubble
:
:
eNo
Cancelable
:
:
eNo
nullptr
)
;
if
(
RefPtr
<
nsPresContext
>
presContext
=
doc
-
>
GetPresContext
(
)
)
{
presContext
-
>
EmulateMedium
(
aBefore
?
nsGkAtoms
:
:
print
:
nullptr
)
;
doc
-
>
EvaluateMediaQueriesAndReportChanges
(
false
)
;
}
}
}
public
:
MOZ_CAN_RUN_SCRIPT
explicit
AutoPrintEventDispatcher
(
Document
&
aDoc
)
{
if
(
!
aDoc
.
IsStaticDocument
(
)
)
{
mDocuments
.
AppendElement
(
&
aDoc
)
;
CollectInProcessSubdocuments
(
aDoc
mDocuments
)
;
}
DispatchEvent
(
true
)
;
}
MOZ_CAN_RUN_SCRIPT
~
AutoPrintEventDispatcher
(
)
{
DispatchEvent
(
false
)
;
}
AutoTArray
<
nsCOMPtr
<
Document
>
8
>
mDocuments
;
const
nsSize
mPageSize
;
nsRect
mVisibleAreaToRestore
;
}
;
}
#
endif
