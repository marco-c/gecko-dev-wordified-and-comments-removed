#
ifndef
mozilla_dom_Console_h
#
define
mozilla_dom_Console_h
#
include
"
mozilla
/
dom
/
BindingDeclarations
.
h
"
#
include
"
mozilla
/
ErrorResult
.
h
"
#
include
"
mozilla
/
JSObjectHolder
.
h
"
#
include
"
nsCycleCollectionParticipant
.
h
"
#
include
"
nsDataHashtable
.
h
"
#
include
"
nsHashKeys
.
h
"
#
include
"
nsIObserver
.
h
"
#
include
"
nsWeakReference
.
h
"
#
include
"
nsWrapperCache
.
h
"
#
include
"
nsDOMNavigationTiming
.
h
"
#
include
"
nsPIDOMWindow
.
h
"
class
nsIConsoleAPIStorage
;
class
nsIPrincipal
;
namespace
mozilla
{
namespace
dom
{
class
AnyCallback
;
class
ConsoleCallData
;
class
ConsoleRunnable
;
class
ConsoleCallDataRunnable
;
class
ConsoleProfileRunnable
;
struct
ConsoleStackEntry
;
class
Console
final
:
public
nsIObserver
public
nsWrapperCache
public
nsSupportsWeakReference
{
~
Console
(
)
;
public
:
NS_DECL_CYCLE_COLLECTING_ISUPPORTS
NS_DECL_CYCLE_COLLECTION_SCRIPT_HOLDER_CLASS_AMBIGUOUS
(
Console
nsIObserver
)
NS_DECL_NSIOBSERVER
static
already_AddRefed
<
Console
>
Create
(
nsPIDOMWindowInner
*
aWindow
ErrorResult
&
aRv
)
;
nsPIDOMWindowInner
*
GetParentObject
(
)
const
{
return
mWindow
;
}
virtual
JSObject
*
WrapObject
(
JSContext
*
aCx
JS
:
:
Handle
<
JSObject
*
>
aGivenProto
)
override
;
void
Log
(
JSContext
*
aCx
const
Sequence
<
JS
:
:
Value
>
&
aData
)
;
void
Info
(
JSContext
*
aCx
const
Sequence
<
JS
:
:
Value
>
&
aData
)
;
void
Warn
(
JSContext
*
aCx
const
Sequence
<
JS
:
:
Value
>
&
aData
)
;
void
Error
(
JSContext
*
aCx
const
Sequence
<
JS
:
:
Value
>
&
aData
)
;
void
Exception
(
JSContext
*
aCx
const
Sequence
<
JS
:
:
Value
>
&
aData
)
;
void
Debug
(
JSContext
*
aCx
const
Sequence
<
JS
:
:
Value
>
&
aData
)
;
void
Table
(
JSContext
*
aCx
const
Sequence
<
JS
:
:
Value
>
&
aData
)
;
void
Trace
(
JSContext
*
aCx
)
;
void
Dir
(
JSContext
*
aCx
const
Sequence
<
JS
:
:
Value
>
&
aData
)
;
void
Dirxml
(
JSContext
*
aCx
const
Sequence
<
JS
:
:
Value
>
&
aData
)
;
void
Group
(
JSContext
*
aCx
const
Sequence
<
JS
:
:
Value
>
&
aData
)
;
void
GroupCollapsed
(
JSContext
*
aCx
const
Sequence
<
JS
:
:
Value
>
&
aData
)
;
void
GroupEnd
(
JSContext
*
aCx
const
Sequence
<
JS
:
:
Value
>
&
aData
)
;
void
Time
(
JSContext
*
aCx
const
JS
:
:
Handle
<
JS
:
:
Value
>
aTime
)
;
void
TimeEnd
(
JSContext
*
aCx
const
JS
:
:
Handle
<
JS
:
:
Value
>
aTime
)
;
void
TimeStamp
(
JSContext
*
aCx
const
JS
:
:
Handle
<
JS
:
:
Value
>
aData
)
;
void
Profile
(
JSContext
*
aCx
const
Sequence
<
JS
:
:
Value
>
&
aData
)
;
void
ProfileEnd
(
JSContext
*
aCx
const
Sequence
<
JS
:
:
Value
>
&
aData
)
;
void
Assert
(
JSContext
*
aCx
bool
aCondition
const
Sequence
<
JS
:
:
Value
>
&
aData
)
;
void
Count
(
JSContext
*
aCx
const
Sequence
<
JS
:
:
Value
>
&
aData
)
;
void
NoopMethod
(
)
;
void
ClearStorage
(
)
;
void
RetrieveConsoleEvents
(
JSContext
*
aCx
nsTArray
<
JS
:
:
Value
>
&
aEvents
ErrorResult
&
aRv
)
;
void
SetConsoleEventHandler
(
AnyCallback
&
aHandler
)
;
private
:
explicit
Console
(
nsPIDOMWindowInner
*
aWindow
)
;
void
Initialize
(
ErrorResult
&
aRv
)
;
void
Shutdown
(
)
;
enum
MethodName
{
MethodLog
MethodInfo
MethodWarn
MethodError
MethodException
MethodDebug
MethodTable
MethodTrace
MethodDir
MethodDirxml
MethodGroup
MethodGroupCollapsed
MethodGroupEnd
MethodTime
MethodTimeEnd
MethodTimeStamp
MethodAssert
MethodCount
}
;
void
Method
(
JSContext
*
aCx
MethodName
aName
const
nsAString
&
aString
const
Sequence
<
JS
:
:
Value
>
&
aData
)
;
void
ProcessCallData
(
ConsoleCallData
*
aData
JS
:
:
Handle
<
JSObject
*
>
aGlobal
const
Sequence
<
JS
:
:
Value
>
&
aArguments
)
;
void
StoreCallData
(
ConsoleCallData
*
aData
)
;
void
UnstoreCallData
(
ConsoleCallData
*
aData
)
;
void
ReleaseCallData
(
ConsoleCallData
*
aCallData
)
;
void
NotifyHandler
(
JSContext
*
aCx
JS
:
:
Handle
<
JSObject
*
>
aGlobal
const
Sequence
<
JS
:
:
Value
>
&
aArguments
ConsoleCallData
*
aData
)
const
;
bool
PopulateEvent
(
JSContext
*
aCx
JS
:
:
Handle
<
JSObject
*
>
aGlobal
const
Sequence
<
JS
:
:
Value
>
&
aArguments
JS
:
:
MutableHandle
<
JS
:
:
Value
>
aValue
ConsoleCallData
*
aData
)
const
;
bool
ProcessArguments
(
JSContext
*
aCx
const
Sequence
<
JS
:
:
Value
>
&
aData
Sequence
<
JS
:
:
Value
>
&
aSequence
Sequence
<
nsString
>
&
aStyles
)
const
;
void
MakeFormatString
(
nsCString
&
aFormat
int32_t
aInteger
int32_t
aMantissa
char
aCh
)
const
;
void
ComposeGroupName
(
JSContext
*
aCx
const
Sequence
<
JS
:
:
Value
>
&
aData
nsAString
&
aName
)
const
;
bool
StartTimer
(
JSContext
*
aCx
const
JS
:
:
Value
&
aName
DOMHighResTimeStamp
aTimestamp
nsAString
&
aTimerLabel
DOMHighResTimeStamp
*
aTimerValue
)
;
JS
:
:
Value
CreateStartTimerValue
(
JSContext
*
aCx
const
nsAString
&
aTimerLabel
DOMHighResTimeStamp
aTimerValue
bool
aTimerStatus
)
const
;
bool
StopTimer
(
JSContext
*
aCx
const
JS
:
:
Value
&
aName
DOMHighResTimeStamp
aTimestamp
nsAString
&
aTimerLabel
double
*
aTimerDuration
)
;
JS
:
:
Value
CreateStopTimerValue
(
JSContext
*
aCx
const
nsAString
&
aTimerLabel
double
aTimerDuration
bool
aTimerStatus
)
const
;
bool
ArgumentsToValueList
(
const
Sequence
<
JS
:
:
Value
>
&
aData
Sequence
<
JS
:
:
Value
>
&
aSequence
)
const
;
void
ProfileMethod
(
JSContext
*
aCx
const
nsAString
&
aAction
const
Sequence
<
JS
:
:
Value
>
&
aData
)
;
uint32_t
IncreaseCounter
(
JSContext
*
aCx
const
ConsoleStackEntry
&
aFrame
const
Sequence
<
JS
:
:
Value
>
&
aData
nsAString
&
aCountLabel
)
;
JS
:
:
Value
CreateCounterValue
(
JSContext
*
aCx
const
nsAString
&
aCountLabel
uint32_t
aCountValue
)
const
;
bool
ShouldIncludeStackTrace
(
MethodName
aMethodName
)
const
;
JSObject
*
GetOrCreateSandbox
(
JSContext
*
aCx
nsIPrincipal
*
aPrincipal
)
;
void
AssertIsOnOwningThread
(
)
const
;
nsCOMPtr
<
nsPIDOMWindowInner
>
mWindow
;
nsCOMPtr
<
nsIConsoleAPIStorage
>
mStorage
;
RefPtr
<
JSObjectHolder
>
mSandbox
;
nsDataHashtable
<
nsStringHashKey
DOMHighResTimeStamp
>
mTimerRegistry
;
nsDataHashtable
<
nsStringHashKey
uint32_t
>
mCounterRegistry
;
nsTArray
<
RefPtr
<
ConsoleCallData
>
>
mCallDataStorage
;
nsTArray
<
RefPtr
<
ConsoleCallData
>
>
mCallDataStoragePending
;
RefPtr
<
AnyCallback
>
mConsoleEventNotifier
;
#
ifdef
DEBUG
PRThread
*
mOwningThread
;
#
endif
uint64_t
mOuterID
;
uint64_t
mInnerID
;
enum
{
eUnknown
eInitialized
eShuttingDown
}
mStatus
;
friend
class
ConsoleCallData
;
friend
class
ConsoleRunnable
;
friend
class
ConsoleCallDataRunnable
;
friend
class
ConsoleProfileRunnable
;
}
;
}
}
#
endif
