#
include
"
mozilla
/
dom
/
BindContext
.
h
"
#
include
"
mozilla
/
StaticPrefs_browser
.
h
"
#
include
"
mozilla
/
dom
/
BrowsingContext
.
h
"
#
include
"
mozilla
/
dom
/
Document
.
h
"
#
include
"
nsContentUtils
.
h
"
#
include
"
nsError
.
h
"
#
include
"
nsPIDOMWindow
.
h
"
namespace
mozilla
:
:
dom
{
bool
BindContext
:
:
AllowsAutoFocus
(
)
const
{
if
(
!
StaticPrefs
:
:
browser_autofocus
(
)
)
{
return
false
;
}
if
(
!
InUncomposedDoc
(
)
)
{
return
false
;
}
if
(
mDoc
.
IsBeingUsedAsImage
(
)
)
{
return
false
;
}
return
IsSameOriginAsTop
(
)
;
}
bool
BindContext
:
:
IsSameOriginAsTop
(
)
const
{
BrowsingContext
*
browsingContext
=
mDoc
.
GetBrowsingContext
(
)
;
if
(
!
browsingContext
)
{
return
false
;
}
nsPIDOMWindowOuter
*
topWindow
=
browsingContext
-
>
Top
(
)
-
>
GetDOMWindow
(
)
;
if
(
!
topWindow
)
{
return
false
;
}
Document
*
topLevelDocument
=
topWindow
-
>
GetExtantDoc
(
)
;
if
(
!
topLevelDocument
)
{
return
false
;
}
return
NS_SUCCEEDED
(
nsContentUtils
:
:
CheckSameOrigin
(
topLevelDocument
&
mDoc
)
)
;
}
}
