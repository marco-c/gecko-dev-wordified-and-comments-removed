#
ifndef
mozilla_dom_timeoutbudgetmanager_h
#
define
mozilla_dom_timeoutbudgetmanager_h
#
include
"
mozilla
/
Telemetry
.
h
"
#
include
"
mozilla
/
TimeStamp
.
h
"
namespace
mozilla
{
namespace
dom
{
class
Timeout
;
class
TimeoutBudgetManager
{
public
:
static
TimeoutBudgetManager
&
Get
(
)
;
void
StartRecording
(
const
TimeStamp
&
aNow
)
;
void
StopRecording
(
)
;
void
RecordExecution
(
const
TimeStamp
&
aNow
const
Timeout
*
aTimeout
bool
aIsBackground
)
;
void
MaybeCollectTelemetry
(
const
TimeStamp
&
aNow
)
;
private
:
TimeoutBudgetManager
(
)
:
mLastCollection
(
TimeStamp
:
:
Now
(
)
)
{
}
struct
TelemetryData
{
TimeDuration
mForegroundTracking
;
TimeDuration
mForegroundNonTracking
;
TimeDuration
mBackgroundTracking
;
TimeDuration
mBackgroundNonTracking
;
}
;
void
Accumulate
(
Telemetry
:
:
HistogramID
aId
const
TimeDuration
&
aSample
)
;
TelemetryData
mTelemetryData
;
TimeStamp
mStart
;
TimeStamp
mLastCollection
;
}
;
}
}
#
endif
