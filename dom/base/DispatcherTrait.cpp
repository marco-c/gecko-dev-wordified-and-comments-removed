#
include
"
mozilla
/
dom
/
DispatcherTrait
.
h
"
#
include
"
mozilla
/
AbstractThread
.
h
"
#
include
"
nsINamed
.
h
"
using
namespace
mozilla
;
using
namespace
mozilla
:
:
dom
;
nsresult
DispatcherTrait
:
:
Dispatch
(
const
char
*
aName
TaskCategory
aCategory
already_AddRefed
<
nsIRunnable
>
&
&
aRunnable
)
{
nsCOMPtr
<
nsIRunnable
>
runnable
(
aRunnable
)
;
if
(
aName
)
{
if
(
nsCOMPtr
<
nsINamed
>
named
=
do_QueryInterface
(
runnable
)
)
{
named
-
>
SetName
(
aName
)
;
}
}
if
(
NS_IsMainThread
(
)
)
{
return
NS_DispatchToCurrentThread
(
runnable
.
forget
(
)
)
;
}
else
{
return
NS_DispatchToMainThread
(
runnable
.
forget
(
)
)
;
}
}
nsIEventTarget
*
DispatcherTrait
:
:
EventTargetFor
(
TaskCategory
aCategory
)
const
{
nsCOMPtr
<
nsIEventTarget
>
main
=
do_GetMainThread
(
)
;
return
main
;
}
AbstractThread
*
DispatcherTrait
:
:
AbstractMainThreadFor
(
TaskCategory
aCategory
)
{
return
AbstractThread
:
:
MainThread
(
)
;
}
