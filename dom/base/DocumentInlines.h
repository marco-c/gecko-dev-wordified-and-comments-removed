#
ifndef
mozilla_dom_DocumentInlines_h
#
define
mozilla_dom_DocumentInlines_h
#
include
"
mozilla
/
dom
/
Document
.
h
"
#
include
"
mozilla
/
dom
/
HTMLBodyElement
.
h
"
#
include
"
nsContentUtils
.
h
"
#
include
"
nsIPresShell
.
h
"
#
include
"
nsPresContext
.
h
"
#
include
"
nsStyleSheetService
.
h
"
namespace
mozilla
{
namespace
dom
{
inline
PresShell
*
Document
:
:
GetObservingPresShell
(
)
const
{
return
mPresShell
&
&
mPresShell
-
>
IsObservingDocument
(
)
?
mPresShell
:
nullptr
;
}
inline
nsPresContext
*
Document
:
:
GetPresContext
(
)
const
{
PresShell
*
presShell
=
GetPresShell
(
)
;
return
presShell
?
presShell
-
>
GetPresContext
(
)
:
nullptr
;
}
inline
HTMLBodyElement
*
Document
:
:
GetBodyElement
(
)
{
return
static_cast
<
HTMLBodyElement
*
>
(
GetHtmlChildElement
(
nsGkAtoms
:
:
body
)
)
;
}
template
<
typename
T
>
size_t
Document
:
:
FindDocStyleSheetInsertionPoint
(
const
nsTArray
<
T
>
&
aDocSheets
const
StyleSheet
&
aSheet
)
{
nsStyleSheetService
*
sheetService
=
nsStyleSheetService
:
:
GetInstance
(
)
;
int32_t
newDocIndex
=
IndexOfSheet
(
aSheet
)
;
size_t
count
=
aDocSheets
.
Length
(
)
;
size_t
index
=
0
;
for
(
;
index
<
count
;
index
+
+
)
{
auto
*
sheet
=
static_cast
<
StyleSheet
*
>
(
aDocSheets
[
index
]
)
;
MOZ_ASSERT
(
sheet
)
;
int32_t
sheetDocIndex
=
IndexOfSheet
(
*
sheet
)
;
if
(
sheetDocIndex
>
newDocIndex
)
break
;
if
(
sheetDocIndex
<
0
)
{
if
(
sheetService
)
{
auto
&
authorSheets
=
*
sheetService
-
>
AuthorStyleSheets
(
)
;
if
(
authorSheets
.
IndexOf
(
sheet
)
!
=
authorSheets
.
NoIndex
)
{
break
;
}
}
if
(
sheet
=
=
GetFirstAdditionalAuthorSheet
(
)
)
{
break
;
}
}
}
return
size_t
(
index
)
;
}
inline
void
Document
:
:
SetServoRestyleRoot
(
nsINode
*
aRoot
uint32_t
aDirtyBits
)
{
MOZ_ASSERT
(
aRoot
)
;
MOZ_ASSERT
(
!
mServoRestyleRoot
|
|
mServoRestyleRoot
=
=
aRoot
|
|
nsContentUtils
:
:
ContentIsFlattenedTreeDescendantOfForStyle
(
mServoRestyleRoot
aRoot
)
)
;
MOZ_ASSERT
(
aRoot
=
=
aRoot
-
>
OwnerDocAsNode
(
)
|
|
aRoot
-
>
IsElement
(
)
)
;
mServoRestyleRoot
=
aRoot
;
SetServoRestyleRootDirtyBits
(
aDirtyBits
)
;
}
inline
void
Document
:
:
SetServoRestyleRootDirtyBits
(
uint32_t
aDirtyBits
)
{
MOZ_ASSERT
(
aDirtyBits
)
;
MOZ_ASSERT
(
(
aDirtyBits
&
~
Element
:
:
kAllServoDescendantBits
)
=
=
0
)
;
MOZ_ASSERT
(
(
aDirtyBits
&
mServoRestyleRootDirtyBits
)
=
=
mServoRestyleRootDirtyBits
)
;
MOZ_ASSERT
(
mServoRestyleRoot
)
;
mServoRestyleRootDirtyBits
=
aDirtyBits
;
}
}
}
#
endif
