#
ifndef
mozilla_dom_DocumentInlines_h
#
define
mozilla_dom_DocumentInlines_h
#
include
"
mozilla
/
PresShell
.
h
"
#
include
"
mozilla
/
ServoStyleSet
.
h
"
#
include
"
mozilla
/
dom
/
Document
.
h
"
#
include
"
mozilla
/
dom
/
HTMLBodyElement
.
h
"
#
include
"
nsContentUtils
.
h
"
#
include
"
nsPresContext
.
h
"
#
include
"
nsStyleSheetService
.
h
"
namespace
mozilla
:
:
dom
{
inline
PresShell
*
Document
:
:
GetObservingPresShell
(
)
const
{
return
mPresShell
&
&
mPresShell
-
>
IsObservingDocument
(
)
?
mPresShell
:
nullptr
;
}
inline
nsPresContext
*
Document
:
:
GetPresContext
(
)
const
{
PresShell
*
presShell
=
GetPresShell
(
)
;
return
presShell
?
presShell
-
>
GetPresContext
(
)
:
nullptr
;
}
inline
HTMLBodyElement
*
Document
:
:
GetBodyElement
(
const
nsIContent
*
aContentToIgnore
)
const
{
return
static_cast
<
HTMLBodyElement
*
>
(
GetHtmlChildElement
(
nsGkAtoms
:
:
body
aContentToIgnore
)
)
;
}
inline
void
Document
:
:
SetServoRestyleRoot
(
nsINode
*
aRoot
uint32_t
aDirtyBits
)
{
MOZ_ASSERT
(
aRoot
)
;
MOZ_ASSERT
(
!
mServoRestyleRoot
|
|
mServoRestyleRoot
=
=
aRoot
|
|
nsContentUtils
:
:
ContentIsFlattenedTreeDescendantOfForStyle
(
mServoRestyleRoot
aRoot
)
)
;
MOZ_ASSERT
(
aRoot
=
=
aRoot
-
>
OwnerDocAsNode
(
)
|
|
aRoot
-
>
IsElement
(
)
)
;
mServoRestyleRoot
=
aRoot
;
SetServoRestyleRootDirtyBits
(
aDirtyBits
)
;
}
inline
void
Document
:
:
SetServoRestyleRootDirtyBits
(
uint32_t
aDirtyBits
)
{
MOZ_ASSERT
(
aDirtyBits
)
;
MOZ_ASSERT
(
(
aDirtyBits
&
~
Element
:
:
kAllServoDescendantBits
)
=
=
0
)
;
MOZ_ASSERT
(
(
aDirtyBits
&
mServoRestyleRootDirtyBits
)
=
=
mServoRestyleRootDirtyBits
)
;
MOZ_ASSERT
(
mServoRestyleRoot
)
;
mServoRestyleRootDirtyBits
=
aDirtyBits
;
}
inline
ServoStyleSet
&
Document
:
:
EnsureStyleSet
(
)
const
{
MOZ_ASSERT
(
NS_IsMainThread
(
)
)
;
if
(
!
mStyleSet
)
{
Document
*
doc
=
const_cast
<
Document
*
>
(
this
)
;
doc
-
>
mStyleSet
=
MakeUnique
<
ServoStyleSet
>
(
*
doc
)
;
}
return
*
(
mStyleSet
.
get
(
)
)
;
}
}
#
endif
