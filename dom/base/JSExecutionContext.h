#
ifndef
DOM_BASE_JSEXECUTIONCONTEXT_H_
#
define
DOM_BASE_JSEXECUTIONCONTEXT_H_
#
include
"
js
/
GCVector
.
h
"
#
include
"
js
/
TypeDecls
.
h
"
#
include
"
js
/
Value
.
h
"
#
include
"
js
/
experimental
/
JSStencil
.
h
"
#
include
"
jsapi
.
h
"
#
include
"
mozilla
/
Assertions
.
h
"
#
include
"
mozilla
/
Attributes
.
h
"
#
include
"
mozilla
/
ErrorResult
.
h
"
#
include
"
mozilla
/
ProfilerLabels
.
h
"
#
include
"
mozilla
/
Vector
.
h
"
#
include
"
nsStringFwd
.
h
"
#
include
"
nscore
.
h
"
class
nsIScriptContext
;
class
nsIScriptElement
;
class
nsIScriptGlobalObject
;
class
nsXBLPrototypeBinding
;
namespace
mozilla
{
union
Utf8Unit
;
namespace
dom
{
class
ScriptLoadContext
;
nsresult
EvaluationExceptionToNSResult
(
ErrorResult
&
aRv
)
;
class
MOZ_STACK_CLASS
JSExecutionContext
final
{
JS
:
:
Rooted
<
JS
:
:
Value
>
mDebuggerPrivateValue
;
JS
:
:
Rooted
<
JSScript
*
>
mDebuggerIntroductionScript
;
RefPtr
<
JS
:
:
Stencil
>
mStencil
;
bool
mSkip
;
bool
mKeepStencil
=
false
;
private
:
template
<
typename
Unit
>
void
InternalCompile
(
JSContext
*
aCx
JS
:
:
CompileOptions
&
aCompileOptions
JS
:
:
SourceText
<
Unit
>
&
aSrcBuf
JS
:
:
MutableHandle
<
JSScript
*
>
aScript
bool
aEncodeBytecode
ErrorResult
&
aRv
)
;
public
:
JSExecutionContext
(
JSContext
*
aCx
JS
:
:
Handle
<
JSObject
*
>
aGlobal
JS
:
:
CompileOptions
&
aCompileOptions
ErrorResult
&
aRv
JS
:
:
Handle
<
JS
:
:
Value
>
aDebuggerPrivateValue
=
JS
:
:
UndefinedHandleValue
JS
:
:
Handle
<
JSScript
*
>
aDebuggerIntroductionScript
=
nullptr
)
;
JSExecutionContext
(
const
JSExecutionContext
&
)
=
delete
;
JSExecutionContext
(
JSExecutionContext
&
&
)
=
delete
;
~
JSExecutionContext
(
)
{
}
void
SetKeepStencil
(
)
{
mKeepStencil
=
true
;
}
already_AddRefed
<
JS
:
:
Stencil
>
StealStencil
(
)
{
return
mStencil
.
forget
(
)
;
}
void
JoinOffThread
(
JSContext
*
aCx
JS
:
:
CompileOptions
&
aCompileOptions
ScriptLoadContext
*
aContext
JS
:
:
MutableHandle
<
JSScript
*
>
aScript
ErrorResult
&
aRv
bool
aEncodeBytecode
=
false
)
;
void
Compile
(
JSContext
*
aCx
JS
:
:
CompileOptions
&
aCompileOptions
JS
:
:
SourceText
<
char16_t
>
&
aSrcBuf
JS
:
:
MutableHandle
<
JSScript
*
>
aScript
ErrorResult
&
aRv
bool
aEncodeBytecode
=
false
)
;
void
Compile
(
JSContext
*
aCx
JS
:
:
CompileOptions
&
aCompileOptions
JS
:
:
SourceText
<
mozilla
:
:
Utf8Unit
>
&
aSrcBuf
JS
:
:
MutableHandle
<
JSScript
*
>
aScript
ErrorResult
&
aRv
bool
aEncodeBytecode
=
false
)
;
void
Compile
(
JSContext
*
aCx
JS
:
:
CompileOptions
&
aCompileOptions
const
nsAString
&
aScript
JS
:
:
MutableHandle
<
JSScript
*
>
aScriptOut
ErrorResult
&
aRv
bool
aEncodeBytecode
=
false
)
;
void
Decode
(
JSContext
*
aCx
JS
:
:
CompileOptions
&
aCompileOptions
const
JS
:
:
TranscodeRange
&
aBytecodeBuf
JS
:
:
MutableHandle
<
JSScript
*
>
aScript
ErrorResult
&
aRv
)
;
void
InstantiateStencil
(
JSContext
*
aCx
JS
:
:
CompileOptions
&
aCompileOptions
RefPtr
<
JS
:
:
Stencil
>
&
&
aStencil
JS
:
:
MutableHandle
<
JSScript
*
>
aScript
bool
&
incrementalEncodingAlreadyStarted
ErrorResult
&
aRv
bool
aEncodeBytecode
=
false
JS
:
:
InstantiationStorage
*
aStorage
=
nullptr
)
;
void
ExecScript
(
JSContext
*
aCx
JS
:
:
Handle
<
JSScript
*
>
aScript
ErrorResult
&
aRv
)
;
void
ExecScript
(
JSContext
*
aCx
JS
:
:
Handle
<
JSScript
*
>
aScript
JS
:
:
MutableHandle
<
JS
:
:
Value
>
aRetValue
ErrorResult
&
aRv
bool
aCoerceToString
=
false
)
;
}
;
}
}
#
endif
