#
ifndef
nsIGlobalObject_h__
#
define
nsIGlobalObject_h__
#
include
"
mozilla
/
LinkedList
.
h
"
#
include
"
mozilla
/
Maybe
.
h
"
#
include
"
mozilla
/
dom
/
ClientInfo
.
h
"
#
include
"
mozilla
/
dom
/
DispatcherTrait
.
h
"
#
include
"
mozilla
/
dom
/
ServiceWorkerDescriptor
.
h
"
#
include
"
nsHashKeys
.
h
"
#
include
"
nsISupports
.
h
"
#
include
"
nsStringFwd
.
h
"
#
include
"
nsTArray
.
h
"
#
include
"
nsTHashtable
.
h
"
#
include
"
js
/
TypeDecls
.
h
"
#
define
NS_IGLOBALOBJECT_IID
\
{
\
0x11afa8be
0xd997
0x4e07
{
\
0xa6
0xa3
0x6f
0x87
0x2e
0xc3
0xee
0x7f
\
}
\
}
class
nsCycleCollectionTraversalCallback
;
class
nsIPrincipal
;
class
nsPIDOMWindowInner
;
namespace
mozilla
{
class
DOMEventTargetHelper
;
enum
class
StorageAccess
;
namespace
dom
{
class
VoidFunction
;
class
DebuggerNotificationManager
;
class
Report
;
class
ReportBody
;
class
ReportingObserver
;
class
ServiceWorker
;
class
ServiceWorkerRegistration
;
class
ServiceWorkerRegistrationDescriptor
;
}
}
class
nsIGlobalObject
:
public
nsISupports
public
mozilla
:
:
dom
:
:
DispatcherTrait
{
nsTArray
<
nsCString
>
mHostObjectURIs
;
mozilla
:
:
LinkedList
<
mozilla
:
:
DOMEventTargetHelper
>
mEventTargetObjects
;
bool
mIsDying
;
bool
mIsScriptForbidden
;
protected
:
bool
mIsInnerWindow
;
nsIGlobalObject
(
)
;
public
:
NS_DECLARE_STATIC_IID_ACCESSOR
(
NS_IGLOBALOBJECT_IID
)
bool
IsDying
(
)
const
{
return
mIsDying
;
}
bool
IsScriptForbidden
(
JSObject
*
aCallback
bool
aIsJSImplementedWebIDL
=
false
)
const
;
virtual
JSObject
*
GetGlobalJSObject
(
)
=
0
;
virtual
JSObject
*
GetGlobalJSObjectPreserveColor
(
)
const
=
0
;
bool
HasJSGlobal
(
)
const
{
return
GetGlobalJSObjectPreserveColor
(
)
;
}
nsIPrincipal
*
PrincipalOrNull
(
)
;
void
RegisterHostObjectURI
(
const
nsACString
&
aURI
)
;
void
UnregisterHostObjectURI
(
const
nsACString
&
aURI
)
;
void
UnlinkObjectsInGlobal
(
)
;
void
TraverseObjectsInGlobal
(
nsCycleCollectionTraversalCallback
&
aCb
)
;
void
AddEventTargetObject
(
mozilla
:
:
DOMEventTargetHelper
*
aObject
)
;
void
RemoveEventTargetObject
(
mozilla
:
:
DOMEventTargetHelper
*
aObject
)
;
void
ForEachEventTargetObject
(
const
std
:
:
function
<
void
(
mozilla
:
:
DOMEventTargetHelper
*
bool
*
aDoneOut
)
>
&
aFunc
)
const
;
virtual
bool
IsInSyncOperation
(
)
{
return
false
;
}
virtual
mozilla
:
:
dom
:
:
DebuggerNotificationManager
*
GetOrCreateDebuggerNotificationManager
(
)
{
return
nullptr
;
}
virtual
mozilla
:
:
dom
:
:
DebuggerNotificationManager
*
GetExistingDebuggerNotificationManager
(
)
{
return
nullptr
;
}
virtual
mozilla
:
:
Maybe
<
mozilla
:
:
dom
:
:
ClientInfo
>
GetClientInfo
(
)
const
;
virtual
mozilla
:
:
Maybe
<
nsID
>
GetAgentClusterId
(
)
const
;
virtual
bool
CrossOriginIsolated
(
)
const
{
return
false
;
}
virtual
bool
IsSharedMemoryAllowed
(
)
const
{
return
false
;
}
virtual
mozilla
:
:
Maybe
<
mozilla
:
:
dom
:
:
ServiceWorkerDescriptor
>
GetController
(
)
const
;
virtual
RefPtr
<
mozilla
:
:
dom
:
:
ServiceWorker
>
GetOrCreateServiceWorker
(
const
mozilla
:
:
dom
:
:
ServiceWorkerDescriptor
&
aDescriptor
)
;
virtual
RefPtr
<
mozilla
:
:
dom
:
:
ServiceWorkerRegistration
>
GetServiceWorkerRegistration
(
const
mozilla
:
:
dom
:
:
ServiceWorkerRegistrationDescriptor
&
aDescriptor
)
const
;
virtual
RefPtr
<
mozilla
:
:
dom
:
:
ServiceWorkerRegistration
>
GetOrCreateServiceWorkerRegistration
(
const
mozilla
:
:
dom
:
:
ServiceWorkerRegistrationDescriptor
&
aDescriptor
)
;
virtual
mozilla
:
:
StorageAccess
GetStorageAccess
(
)
;
nsPIDOMWindowInner
*
AsInnerWindow
(
)
;
void
QueueMicrotask
(
mozilla
:
:
dom
:
:
VoidFunction
&
aCallback
)
;
void
RegisterReportingObserver
(
mozilla
:
:
dom
:
:
ReportingObserver
*
aObserver
bool
aBuffered
)
;
void
UnregisterReportingObserver
(
mozilla
:
:
dom
:
:
ReportingObserver
*
aObserver
)
;
void
BroadcastReport
(
mozilla
:
:
dom
:
:
Report
*
aReport
)
;
MOZ_CAN_RUN_SCRIPT
void
NotifyReportingObservers
(
)
;
void
RemoveReportRecords
(
)
;
virtual
bool
ShouldResistFingerprinting
(
)
const
;
virtual
uint32_t
GetPrincipalHashValue
(
)
const
{
return
0
;
}
protected
:
virtual
~
nsIGlobalObject
(
)
;
void
StartDying
(
)
{
mIsDying
=
true
;
}
void
StartForbiddingScript
(
)
{
mIsScriptForbidden
=
true
;
}
void
StopForbiddingScript
(
)
{
mIsScriptForbidden
=
false
;
}
void
DisconnectEventTargetObjects
(
)
;
size_t
ShallowSizeOfExcludingThis
(
mozilla
:
:
MallocSizeOf
aSizeOf
)
const
;
private
:
nsTArray
<
RefPtr
<
mozilla
:
:
dom
:
:
ReportingObserver
>
>
mReportingObservers
;
nsTArray
<
RefPtr
<
mozilla
:
:
dom
:
:
Report
>
>
mReportRecords
;
}
;
NS_DEFINE_STATIC_IID_ACCESSOR
(
nsIGlobalObject
NS_IGLOBALOBJECT_IID
)
#
endif
