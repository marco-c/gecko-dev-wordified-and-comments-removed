#
ifndef
mozilla_dom_BindContext_h__
#
define
mozilla_dom_BindContext_h__
#
include
"
mozilla
/
Attributes
.
h
"
#
include
"
mozilla
/
AutoRestore
.
h
"
#
include
"
mozilla
/
dom
/
Document
.
h
"
#
include
"
mozilla
/
dom
/
Element
.
h
"
#
include
"
mozilla
/
dom
/
ShadowRoot
.
h
"
namespace
mozilla
{
namespace
dom
{
struct
MOZ_STACK_CLASS
BindContext
final
{
struct
NestingLevel
;
friend
struct
NestingLevel
;
Document
&
OwnerDoc
(
)
const
{
return
mDoc
;
}
bool
InComposedDoc
(
)
const
{
return
mInComposedDoc
;
}
bool
InUncomposedDoc
(
)
const
{
return
mInUncomposedDoc
;
}
Document
*
GetComposedDoc
(
)
const
{
return
mInComposedDoc
?
&
mDoc
:
nullptr
;
}
Document
*
GetUncomposedDoc
(
)
const
{
return
mInUncomposedDoc
?
&
mDoc
:
nullptr
;
}
bool
SubtreeRootChanges
(
)
const
{
return
mSubtreeRootChanges
;
}
bool
AllowsAutoFocus
(
)
const
;
explicit
BindContext
(
nsINode
&
aParent
)
:
mDoc
(
*
aParent
.
OwnerDoc
(
)
)
mInComposedDoc
(
aParent
.
IsInComposedDoc
(
)
)
mInUncomposedDoc
(
aParent
.
IsInUncomposedDoc
(
)
)
mSubtreeRootChanges
(
true
)
{
}
explicit
BindContext
(
ShadowRoot
&
aShadowRoot
)
:
mDoc
(
*
aShadowRoot
.
OwnerDoc
(
)
)
mInComposedDoc
(
aShadowRoot
.
IsInComposedDoc
(
)
)
mInUncomposedDoc
(
false
)
mSubtreeRootChanges
(
false
)
{
}
enum
ForNativeAnonymous
{
ForNativeAnonymous
}
;
BindContext
(
Element
&
aParentElement
enum
ForNativeAnonymous
)
:
mDoc
(
*
aParentElement
.
OwnerDoc
(
)
)
mInComposedDoc
(
aParentElement
.
IsInComposedDoc
(
)
)
mInUncomposedDoc
(
aParentElement
.
IsInUncomposedDoc
(
)
)
mSubtreeRootChanges
(
true
)
{
MOZ_ASSERT
(
mInComposedDoc
"
Binding
NAC
in
a
disconnected
subtree
?
"
)
;
}
private
:
static
bool
IsLikelyUndisplayed
(
const
nsINode
&
aParent
)
{
return
aParent
.
IsAnyOfHTMLElements
(
nsGkAtoms
:
:
style
nsGkAtoms
:
:
script
)
;
}
bool
IsSameOriginAsTop
(
)
const
;
Document
&
mDoc
;
const
bool
mInComposedDoc
;
const
bool
mInUncomposedDoc
;
const
bool
mSubtreeRootChanges
;
}
;
}
}
#
endif
