#
include
"
DateCacheCleaner
.
h
"
#
include
"
js
/
Date
.
h
"
#
include
"
mozilla
/
dom
/
ScriptSettings
.
h
"
#
include
"
mozilla
/
ClearOnShutdown
.
h
"
#
include
"
mozilla
/
Hal
.
h
"
#
include
"
mozilla
/
StaticPtr
.
h
"
using
namespace
mozilla
:
:
hal
;
namespace
mozilla
{
namespace
dom
{
namespace
time
{
class
DateCacheCleaner
:
public
SystemTimezoneChangeObserver
{
public
:
DateCacheCleaner
(
)
{
RegisterSystemTimezoneChangeObserver
(
this
)
;
}
~
DateCacheCleaner
(
)
{
UnregisterSystemTimezoneChangeObserver
(
this
)
;
}
void
Notify
(
const
SystemTimezoneChangeInformation
&
aSystemTimezoneChangeInfo
)
override
{
JS
:
:
ResetTimeZone
(
)
;
}
}
;
StaticAutoPtr
<
DateCacheCleaner
>
sDateCacheCleaner
;
void
InitializeDateCacheCleaner
(
)
{
if
(
!
sDateCacheCleaner
)
{
sDateCacheCleaner
=
new
DateCacheCleaner
(
)
;
ClearOnShutdown
(
&
sDateCacheCleaner
)
;
}
}
}
}
}
