#
ifndef
mozilla_dom_FileSystemBase_h
#
define
mozilla_dom_FileSystemBase_h
#
include
"
nsString
.
h
"
#
include
"
Directory
.
h
"
namespace
mozilla
{
namespace
dom
{
class
BlobImpl
;
class
FileSystemBase
{
public
:
NS_INLINE_DECL_REFCOUNTING
(
FileSystemBase
)
static
already_AddRefed
<
FileSystemBase
>
DeserializeDOMPath
(
const
nsAString
&
aString
)
;
FileSystemBase
(
)
;
virtual
void
Shutdown
(
)
;
virtual
void
SerializeDOMPath
(
nsAString
&
aOutput
)
const
=
0
;
virtual
already_AddRefed
<
FileSystemBase
>
Clone
(
)
=
0
;
virtual
bool
ShouldCreateDirectory
(
)
=
0
;
virtual
nsISupports
*
GetParentObject
(
)
const
;
virtual
void
GetDirectoryName
(
nsIFile
*
aFile
nsAString
&
aRetval
ErrorResult
&
aRv
)
const
;
void
GetDOMPath
(
nsIFile
*
aFile
nsAString
&
aRetval
ErrorResult
&
aRv
)
const
;
const
nsAString
&
LocalOrDeviceStorageRootPath
(
)
const
{
return
mLocalOrDeviceStorageRootPath
;
}
bool
IsShutdown
(
)
const
{
return
mShutdown
;
}
virtual
bool
IsSafeFile
(
nsIFile
*
aFile
)
const
;
virtual
bool
IsSafeDirectory
(
Directory
*
aDir
)
const
;
bool
GetRealPath
(
BlobImpl
*
aFile
nsIFile
*
*
aPath
)
const
;
const
nsCString
&
GetPermission
(
)
const
{
return
mPermission
;
}
enum
ePermissionCheckType
{
ePermissionCheckByTestingPref
ePermissionCheckNotRequired
ePermissionCheckRequired
eNotSet
}
;
ePermissionCheckType
PermissionCheckType
(
)
const
{
MOZ_ASSERT
(
mPermissionCheckType
!
=
eNotSet
)
;
return
mPermissionCheckType
;
}
virtual
bool
NeedToGoToMainThread
(
)
const
{
return
false
;
}
virtual
nsresult
MainThreadWork
(
)
{
return
NS_ERROR_FAILURE
;
}
virtual
bool
ClonableToDifferentThreadOrProcess
(
)
const
{
return
false
;
}
virtual
void
Unlink
(
)
{
}
virtual
void
Traverse
(
nsCycleCollectionTraversalCallback
&
cb
)
{
}
void
AssertIsOnOwningThread
(
)
const
;
protected
:
virtual
~
FileSystemBase
(
)
;
nsString
mLocalOrDeviceStorageRootPath
;
bool
mShutdown
;
nsCString
mPermission
;
ePermissionCheckType
mPermissionCheckType
;
#
ifdef
DEBUG
PRThread
*
mOwningThread
;
#
endif
}
;
}
}
#
endif
