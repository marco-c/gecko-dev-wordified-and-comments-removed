#
ifndef
mozilla_dom_ErrorCallbackRunnable_h
#
define
mozilla_dom_ErrorCallbackRunnable_h
#
include
"
FileSystemDirectoryEntry
.
h
"
#
include
"
mozilla
/
dom
/
BindingDeclarations
.
h
"
#
include
"
mozilla
/
dom
/
PromiseNativeHandler
.
h
"
#
include
"
nsThreadUtils
.
h
"
class
nsIGlobalObject
;
namespace
mozilla
{
namespace
dom
{
class
FileSystemEntriesCallback
;
class
EntryCallbackRunnable
final
:
public
Runnable
{
public
:
EntryCallbackRunnable
(
FileSystemEntryCallback
*
aCallback
FileSystemEntry
*
aEntry
)
;
MOZ_CAN_RUN_SCRIPT_BOUNDARY
NS_IMETHOD
Run
(
)
override
;
private
:
const
RefPtr
<
FileSystemEntryCallback
>
mCallback
;
const
RefPtr
<
FileSystemEntry
>
mEntry
;
}
;
class
ErrorCallbackRunnable
final
:
public
Runnable
{
public
:
ErrorCallbackRunnable
(
nsIGlobalObject
*
aGlobalObject
ErrorCallback
*
aCallback
nsresult
aError
)
;
MOZ_CAN_RUN_SCRIPT_BOUNDARY
NS_IMETHOD
Run
(
)
override
;
private
:
nsCOMPtr
<
nsIGlobalObject
>
mGlobal
;
const
RefPtr
<
ErrorCallback
>
mCallback
;
nsresult
mError
;
}
;
class
EmptyEntriesCallbackRunnable
final
:
public
Runnable
{
public
:
explicit
EmptyEntriesCallbackRunnable
(
FileSystemEntriesCallback
*
aCallback
)
;
MOZ_CAN_RUN_SCRIPT_BOUNDARY
NS_IMETHOD
Run
(
)
override
;
private
:
const
RefPtr
<
FileSystemEntriesCallback
>
mCallback
;
}
;
class
GetEntryHelper
final
:
public
PromiseNativeHandler
{
public
:
NS_DECL_ISUPPORTS
GetEntryHelper
(
FileSystemDirectoryEntry
*
aParentEntry
Directory
*
aDirectory
nsTArray
<
nsString
>
&
aParts
FileSystem
*
aFileSystem
FileSystemEntryCallback
*
aSuccessCallback
ErrorCallback
*
aErrorCallback
FileSystemDirectoryEntry
:
:
GetInternalType
aType
)
;
void
Run
(
)
;
MOZ_CAN_RUN_SCRIPT
virtual
void
ResolvedCallback
(
JSContext
*
aCx
JS
:
:
Handle
<
JS
:
:
Value
>
aValue
)
override
;
virtual
void
RejectedCallback
(
JSContext
*
aCx
JS
:
:
Handle
<
JS
:
:
Value
>
aValue
)
override
;
private
:
~
GetEntryHelper
(
)
;
void
Error
(
nsresult
aError
)
;
void
ContinueRunning
(
JSObject
*
aObj
)
;
MOZ_CAN_RUN_SCRIPT
void
CompleteOperation
(
JSObject
*
aObj
)
;
RefPtr
<
FileSystemDirectoryEntry
>
mParentEntry
;
RefPtr
<
Directory
>
mDirectory
;
nsTArray
<
nsString
>
mParts
;
RefPtr
<
FileSystem
>
mFileSystem
;
const
RefPtr
<
FileSystemEntryCallback
>
mSuccessCallback
;
RefPtr
<
ErrorCallback
>
mErrorCallback
;
FileSystemDirectoryEntry
:
:
GetInternalType
mType
;
}
;
class
FileSystemEntryCallbackHelper
{
public
:
static
void
Call
(
nsIGlobalObject
*
aGlobalObject
const
Optional
<
OwningNonNull
<
FileSystemEntryCallback
>
>
&
aEntryCallback
FileSystemEntry
*
aEntry
)
;
}
;
class
ErrorCallbackHelper
{
public
:
static
void
Call
(
nsIGlobalObject
*
aGlobal
const
Optional
<
OwningNonNull
<
ErrorCallback
>
>
&
aErrorCallback
nsresult
aError
)
;
}
;
}
}
#
endif
