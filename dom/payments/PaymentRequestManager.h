#
ifndef
mozilla_dom_PaymentRequestManager_h
#
define
mozilla_dom_PaymentRequestManager_h
#
include
"
nsISupports
.
h
"
#
include
"
PaymentRequest
.
h
"
#
include
"
mozilla
/
dom
/
PaymentRequestBinding
.
h
"
#
include
"
mozilla
/
dom
/
PaymentRequestUpdateEventBinding
.
h
"
#
include
"
mozilla
/
dom
/
PaymentResponseBinding
.
h
"
#
include
"
nsCOMPtr
.
h
"
#
include
"
nsTArray
.
h
"
namespace
mozilla
{
namespace
dom
{
class
PaymentRequestChild
;
class
IPCPaymentActionRequest
;
class
PaymentRequestManager
final
{
public
:
NS_INLINE_DECL_REFCOUNTING
(
PaymentRequestManager
)
static
already_AddRefed
<
PaymentRequestManager
>
GetSingleton
(
)
;
already_AddRefed
<
PaymentRequest
>
GetPaymentRequestById
(
const
nsAString
&
aRequestId
)
;
nsresult
CreatePayment
(
JSContext
*
aCx
nsPIDOMWindowInner
*
aWindow
nsIPrincipal
*
aTopLevelPrincipal
const
Sequence
<
PaymentMethodData
>
&
aMethodData
const
PaymentDetailsInit
&
aDetails
const
PaymentOptions
&
aOptions
PaymentRequest
*
*
aRequest
)
;
nsresult
CanMakePayment
(
PaymentRequest
*
aRequest
)
;
nsresult
ShowPayment
(
PaymentRequest
*
aRequest
)
;
nsresult
AbortPayment
(
PaymentRequest
*
aRequest
bool
aDeferredShow
)
;
nsresult
CompletePayment
(
PaymentRequest
*
aRequest
const
PaymentComplete
&
aComplete
)
;
nsresult
UpdatePayment
(
JSContext
*
aCx
const
nsAString
&
aRequestId
const
PaymentDetailsUpdate
&
aDetails
bool
aRequestShipping
bool
aDeferredShow
)
;
nsresult
RespondPayment
(
const
IPCPaymentActionResponse
&
aResponse
)
;
nsresult
ChangeShippingAddress
(
const
nsAString
&
aRequestId
const
IPCPaymentAddress
&
aAddress
)
;
nsresult
ChangeShippingOption
(
const
nsAString
&
aRequestId
const
nsAString
&
aOption
)
;
nsresult
ReleasePaymentChild
(
const
nsAString
&
aId
)
;
private
:
PaymentRequestManager
(
)
=
default
;
~
PaymentRequestManager
(
)
{
MOZ_ASSERT
(
mActivePayments
.
Count
(
)
=
=
0
)
;
}
PaymentRequestChild
*
GetPaymentChild
(
PaymentRequest
*
aRequest
)
;
nsresult
SendRequestPayment
(
PaymentRequest
*
aRequest
const
IPCPaymentActionRequest
&
action
bool
aResponseExpected
=
true
)
;
void
NotifyRequestDone
(
PaymentRequest
*
aRequest
)
;
nsDataHashtable
<
nsStringHashKey
PaymentRequest
*
>
mPaymentChildHash
;
nsDataHashtable
<
nsRefPtrHashKey
<
PaymentRequest
>
uint32_t
>
mActivePayments
;
RefPtr
<
PaymentRequest
>
mShowingRequest
;
}
;
}
}
#
endif
