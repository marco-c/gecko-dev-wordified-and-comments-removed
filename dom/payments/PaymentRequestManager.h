#
ifndef
mozilla_dom_PaymentRequestManager_h
#
define
mozilla_dom_PaymentRequestManager_h
#
include
"
PaymentRequest
.
h
"
#
include
"
mozilla
/
dom
/
PaymentRequestBinding
.
h
"
#
include
"
mozilla
/
dom
/
PaymentRequestUpdateEventBinding
.
h
"
#
include
"
mozilla
/
dom
/
PaymentResponseBinding
.
h
"
#
include
"
nsCOMPtr
.
h
"
#
include
"
nsISupports
.
h
"
#
include
"
nsTArray
.
h
"
namespace
mozilla
:
:
dom
{
class
PaymentRequestChild
;
class
IPCMethodChangeDetails
;
class
IPCPaymentAddress
;
class
IPCPaymentActionResponse
;
class
IPCPaymentActionRequest
;
class
PaymentRequestManager
final
{
public
:
NS_INLINE_DECL_REFCOUNTING
(
PaymentRequestManager
)
static
already_AddRefed
<
PaymentRequestManager
>
GetSingleton
(
)
;
void
CreatePayment
(
JSContext
*
aCx
nsPIDOMWindowInner
*
aWindow
nsIPrincipal
*
aTopLevelPrincipal
const
Sequence
<
PaymentMethodData
>
&
aMethodData
const
PaymentDetailsInit
&
aDetails
const
PaymentOptions
&
aOptions
PaymentRequest
*
*
aRequest
ErrorResult
&
aRv
)
;
void
CanMakePayment
(
PaymentRequest
*
aRequest
ErrorResult
&
aRv
)
;
void
ShowPayment
(
PaymentRequest
*
aRequest
ErrorResult
&
aRv
)
;
void
AbortPayment
(
PaymentRequest
*
aRequest
ErrorResult
&
aRv
)
;
void
CompletePayment
(
PaymentRequest
*
aRequest
const
PaymentComplete
&
aComplete
ErrorResult
&
aRv
bool
aTimedOut
=
false
)
;
void
UpdatePayment
(
JSContext
*
aCx
PaymentRequest
*
aRequest
const
PaymentDetailsUpdate
&
aDetails
bool
aRequestShipping
ErrorResult
&
aRv
)
;
nsresult
ClosePayment
(
PaymentRequest
*
aRequest
)
;
void
RetryPayment
(
JSContext
*
aCx
PaymentRequest
*
aRequest
const
PaymentValidationErrors
&
aErrors
ErrorResult
&
aRv
)
;
nsresult
RespondPayment
(
PaymentRequest
*
aRequest
const
IPCPaymentActionResponse
&
aResponse
)
;
nsresult
ChangeShippingAddress
(
PaymentRequest
*
aRequest
const
IPCPaymentAddress
&
aAddress
)
;
nsresult
ChangeShippingOption
(
PaymentRequest
*
aRequest
const
nsAString
&
aOption
)
;
nsresult
ChangePayerDetail
(
PaymentRequest
*
aRequest
const
nsAString
&
aPayerName
const
nsAString
&
aPayerEmail
const
nsAString
&
aPayerPhone
)
;
nsresult
ChangePaymentMethod
(
PaymentRequest
*
aRequest
const
nsAString
&
aMethodName
const
IPCMethodChangeDetails
&
aMethodDetails
)
;
bool
IsRegionSupported
(
const
nsAString
&
region
)
const
;
void
RequestIPCOver
(
PaymentRequest
*
aRequest
)
;
private
:
PaymentRequestManager
(
)
;
~
PaymentRequestManager
(
)
;
PaymentRequestChild
*
GetPaymentChild
(
PaymentRequest
*
aRequest
)
;
nsresult
SendRequestPayment
(
PaymentRequest
*
aRequest
const
IPCPaymentActionRequest
&
action
bool
aResponseExpected
=
true
)
;
void
NotifyRequestDone
(
PaymentRequest
*
aRequest
)
;
nsTHashMap
<
nsRefPtrHashKey
<
PaymentRequest
>
uint32_t
>
mActivePayments
;
nsTArray
<
nsString
>
mSupportedRegions
;
}
;
}
#
endif
