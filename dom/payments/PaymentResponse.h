#
ifndef
mozilla_dom_PaymentResponse_h
#
define
mozilla_dom_PaymentResponse_h
#
include
"
mozilla
/
DOMEventTargetHelper
.
h
"
#
include
"
mozilla
/
dom
/
PaymentResponseBinding
.
h
"
#
include
"
nsITimer
.
h
"
#
include
"
nsPIDOMWindow
.
h
"
namespace
mozilla
:
:
dom
{
class
PaymentAddress
;
class
PaymentRequest
;
struct
PaymentValidationErrors
;
class
Promise
;
class
GeneralData
final
{
public
:
GeneralData
(
)
=
default
;
~
GeneralData
(
)
=
default
;
nsString
data
;
}
;
class
BasicCardData
final
{
public
:
struct
Address
{
nsString
country
;
CopyableTArray
<
nsString
>
addressLine
;
nsString
region
;
nsString
regionCode
;
nsString
city
;
nsString
dependentLocality
;
nsString
postalCode
;
nsString
sortingCode
;
nsString
organization
;
nsString
recipient
;
nsString
phone
;
}
;
BasicCardData
(
)
=
default
;
~
BasicCardData
(
)
=
default
;
nsString
cardholderName
;
nsString
cardNumber
;
nsString
expiryMonth
;
nsString
expiryYear
;
nsString
cardSecurityCode
;
Address
billingAddress
;
}
;
class
ResponseData
final
{
public
:
enum
Type
{
Unknown
=
0
GeneralResponse
=
1
BasicCardResponse
}
;
ResponseData
(
)
:
mType
(
ResponseData
:
:
Unknown
)
{
}
explicit
ResponseData
(
const
GeneralData
&
aGeneralData
)
:
mType
(
GeneralResponse
)
mGeneralData
(
aGeneralData
)
{
}
explicit
ResponseData
(
const
BasicCardData
&
aBasicCardData
)
:
mType
(
BasicCardResponse
)
mBasicCardData
(
aBasicCardData
)
{
}
ResponseData
&
operator
=
(
const
GeneralData
&
aGeneralData
)
{
mType
=
GeneralResponse
;
mGeneralData
=
aGeneralData
;
mBasicCardData
=
BasicCardData
(
)
;
return
*
this
;
}
ResponseData
&
operator
=
(
const
BasicCardData
&
aBasicCardData
)
{
mType
=
BasicCardResponse
;
mGeneralData
=
GeneralData
(
)
;
mBasicCardData
=
aBasicCardData
;
return
*
this
;
}
~
ResponseData
(
)
=
default
;
const
Type
&
type
(
)
const
{
return
mType
;
}
const
GeneralData
&
generalData
(
)
const
{
return
mGeneralData
;
}
const
BasicCardData
&
basicCardData
(
)
const
{
return
mBasicCardData
;
}
private
:
Type
mType
;
GeneralData
mGeneralData
;
BasicCardData
mBasicCardData
;
}
;
class
PaymentResponse
final
:
public
DOMEventTargetHelper
public
nsITimerCallback
{
public
:
NS_DECL_ISUPPORTS_INHERITED
NS_DECL_CYCLE_COLLECTION_SCRIPT_HOLDER_CLASS_INHERITED
(
PaymentResponse
DOMEventTargetHelper
)
NS_IMETHOD
Notify
(
nsITimer
*
aTimer
)
override
;
PaymentResponse
(
nsPIDOMWindowInner
*
aWindow
PaymentRequest
*
aRequest
const
nsAString
&
aRequestId
const
nsAString
&
aMethodName
const
nsAString
&
aShippingOption
PaymentAddress
*
aShippingAddress
const
ResponseData
&
aDetails
const
nsAString
&
aPayerName
const
nsAString
&
aPayerEmail
const
nsAString
&
aPayerPhone
)
;
virtual
JSObject
*
WrapObject
(
JSContext
*
aCx
JS
:
:
Handle
<
JSObject
*
>
aGivenProto
)
override
;
void
GetRequestId
(
nsString
&
aRetVal
)
const
;
void
GetMethodName
(
nsString
&
aRetVal
)
const
;
void
GetDetails
(
JSContext
*
cx
JS
:
:
MutableHandle
<
JSObject
*
>
aRetVal
)
const
;
already_AddRefed
<
PaymentAddress
>
GetShippingAddress
(
)
const
;
void
GetShippingOption
(
nsString
&
aRetVal
)
const
;
void
GetPayerName
(
nsString
&
aRetVal
)
const
;
void
GetPayerEmail
(
nsString
&
aRetVal
)
const
;
void
GetPayerPhone
(
nsString
&
aRetVal
)
const
;
already_AddRefed
<
Promise
>
Complete
(
PaymentComplete
result
ErrorResult
&
aRv
)
;
void
RespondComplete
(
)
;
IMPL_EVENT_HANDLER
(
payerdetailchange
)
;
nsresult
UpdatePayerDetail
(
const
nsAString
&
aPayerName
const
nsAString
&
aPayerEmail
const
nsAString
&
aPayerPhone
)
;
already_AddRefed
<
Promise
>
Retry
(
JSContext
*
aCx
const
PaymentValidationErrors
&
errorField
ErrorResult
&
aRv
)
;
void
RespondRetry
(
const
nsAString
&
aMethodName
const
nsAString
&
aShippingOption
PaymentAddress
*
aShippingAddress
const
ResponseData
&
aDetails
const
nsAString
&
aPayerName
const
nsAString
&
aPayerEmail
const
nsAString
&
aPayerPhone
)
;
void
RejectRetry
(
ErrorResult
&
&
aRejectReason
)
;
protected
:
~
PaymentResponse
(
)
;
void
ValidatePaymentValidationErrors
(
const
PaymentValidationErrors
&
aErrors
ErrorResult
&
aRv
)
;
void
ConvertPaymentMethodErrors
(
JSContext
*
aCx
const
PaymentValidationErrors
&
aErrors
ErrorResult
&
aRv
)
const
;
nsresult
DispatchUpdateEvent
(
const
nsAString
&
aType
)
;
private
:
bool
mCompleteCalled
;
PaymentRequest
*
mRequest
;
nsString
mRequestId
;
nsString
mMethodName
;
ResponseData
mDetails
;
nsString
mShippingOption
;
nsString
mPayerName
;
nsString
mPayerEmail
;
nsString
mPayerPhone
;
RefPtr
<
PaymentAddress
>
mShippingAddress
;
RefPtr
<
Promise
>
mPromise
;
nsCOMPtr
<
nsITimer
>
mTimer
;
RefPtr
<
Promise
>
mRetryPromise
;
}
;
}
#
endif
