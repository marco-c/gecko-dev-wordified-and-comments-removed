#
ifndef
mozilla_dom_PaymentResponse_h
#
define
mozilla_dom_PaymentResponse_h
#
include
"
mozilla
/
DOMEventTargetHelper
.
h
"
#
include
"
mozilla
/
dom
/
BasicCardPaymentBinding
.
h
"
#
include
"
mozilla
/
dom
/
PaymentResponseBinding
.
h
"
#
include
"
nsPIDOMWindow
.
h
"
#
include
"
nsITimer
.
h
"
namespace
mozilla
{
namespace
dom
{
class
PaymentAddress
;
class
PaymentRequest
;
class
Promise
;
class
ResponseData
final
{
public
:
enum
TYPE
{
UNKNOWN
=
0
GENERAL_RESPONSE
BASICCARD_RESPONSE
}
;
ResponseData
(
)
;
~
ResponseData
(
)
=
default
;
const
TYPE
&
GetType
(
)
const
{
return
mType
;
}
void
GetData
(
JSContext
*
aCx
JS
:
:
MutableHandle
<
JSObject
*
>
aRetVal
)
const
;
void
Init
(
const
nsString
&
aGeneralResponse
)
;
void
Init
(
const
BasicCardResponse
&
aBasicCardResponse
)
;
private
:
TYPE
mType
;
nsString
mGeneralResponse
;
BasicCardResponse
mBasicCardResponse
;
}
;
class
PaymentResponse
final
:
public
DOMEventTargetHelper
public
nsITimerCallback
{
public
:
NS_DECL_ISUPPORTS_INHERITED
NS_DECL_CYCLE_COLLECTION_SCRIPT_HOLDER_CLASS_INHERITED
(
PaymentResponse
DOMEventTargetHelper
)
NS_IMETHOD
Notify
(
nsITimer
*
aTimer
)
override
;
PaymentResponse
(
nsPIDOMWindowInner
*
aWindow
PaymentRequest
*
aRequest
const
nsAString
&
aRequestId
const
nsAString
&
aMethodName
const
nsAString
&
aShippingOption
PaymentAddress
*
aShippingAddress
const
ResponseData
&
aDetails
const
nsAString
&
aPayerName
const
nsAString
&
aPayerEmail
const
nsAString
&
aPayerPhone
)
;
virtual
JSObject
*
WrapObject
(
JSContext
*
aCx
JS
:
:
Handle
<
JSObject
*
>
aGivenProto
)
override
;
void
GetRequestId
(
nsString
&
aRetVal
)
const
;
void
GetMethodName
(
nsString
&
aRetVal
)
const
;
void
GetDetails
(
JSContext
*
cx
JS
:
:
MutableHandle
<
JSObject
*
>
aRetVal
)
const
;
already_AddRefed
<
PaymentAddress
>
GetShippingAddress
(
)
const
;
void
GetShippingOption
(
nsString
&
aRetVal
)
const
;
void
GetPayerName
(
nsString
&
aRetVal
)
const
;
void
GetPayerEmail
(
nsString
&
aRetVal
)
const
;
void
GetPayerPhone
(
nsString
&
aRetVal
)
const
;
already_AddRefed
<
Promise
>
Complete
(
PaymentComplete
result
ErrorResult
&
aRv
)
;
void
RespondComplete
(
)
;
IMPL_EVENT_HANDLER
(
payerdetailchange
)
;
nsresult
UpdatePayerDetail
(
const
nsAString
&
aPayerName
const
nsAString
&
aPayerEmail
const
nsAString
&
aPayerPhone
)
;
already_AddRefed
<
Promise
>
Retry
(
JSContext
*
aCx
const
PaymentValidationErrors
&
errorField
ErrorResult
&
aRv
)
;
void
RespondRetry
(
const
nsAString
&
aMethodName
const
nsAString
&
aShippingOption
PaymentAddress
*
aShippingAddress
const
ResponseData
&
aDetails
const
nsAString
&
aPayerName
const
nsAString
&
aPayerEmail
const
nsAString
&
aPayerPhone
)
;
void
RejectRetry
(
nsresult
aRejectReason
)
;
protected
:
~
PaymentResponse
(
)
;
nsresult
ValidatePaymentValidationErrors
(
const
PaymentValidationErrors
&
aErrors
)
;
nsresult
ConvertPaymentMethodErrors
(
JSContext
*
aCx
const
PaymentValidationErrors
&
aErrors
nsAString
&
aErrorMsg
)
const
;
nsresult
DispatchUpdateEvent
(
const
nsAString
&
aType
)
;
private
:
bool
mCompleteCalled
;
PaymentRequest
*
mRequest
;
nsString
mRequestId
;
nsString
mMethodName
;
ResponseData
mDetails
;
nsString
mShippingOption
;
nsString
mPayerName
;
nsString
mPayerEmail
;
nsString
mPayerPhone
;
RefPtr
<
PaymentAddress
>
mShippingAddress
;
RefPtr
<
Promise
>
mPromise
;
nsCOMPtr
<
nsITimer
>
mTimer
;
RefPtr
<
Promise
>
mRetryPromise
;
}
;
}
}
#
endif
