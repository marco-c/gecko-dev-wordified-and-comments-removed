#
ifndef
mozilla_dom_Lock_h
#
define
mozilla_dom_Lock_h
#
include
"
js
/
TypeDecls
.
h
"
#
include
"
mozilla
/
Attributes
.
h
"
#
include
"
mozilla
/
ErrorResult
.
h
"
#
include
"
mozilla
/
WeakPtr
.
h
"
#
include
"
mozilla
/
dom
/
BindingDeclarations
.
h
"
#
include
"
mozilla
/
dom
/
LockManagerBinding
.
h
"
#
include
"
mozilla
/
dom
/
PromiseNativeHandler
.
h
"
#
include
"
nsCycleCollectionParticipant
.
h
"
#
include
"
nsWrapperCache
.
h
"
namespace
mozilla
:
:
dom
{
class
LockManager
;
namespace
locks
{
class
LockRequestChild
;
}
class
Lock
final
:
public
PromiseNativeHandler
public
nsWrapperCache
{
friend
class
LockManager
;
public
:
NS_DECL_CYCLE_COLLECTING_ISUPPORTS
NS_DECL_CYCLE_COLLECTION_WRAPPERCACHE_CLASS
(
Lock
)
Lock
(
nsIGlobalObject
*
aGlobal
const
WeakPtr
<
locks
:
:
LockRequestChild
>
&
aLockRequestChild
const
nsString
&
aName
LockMode
aMode
const
RefPtr
<
Promise
>
&
aReleasedPromise
ErrorResult
&
aRv
)
;
protected
:
~
Lock
(
)
=
default
;
public
:
nsIGlobalObject
*
GetParentObject
(
)
const
{
return
mOwner
;
}
;
JSObject
*
WrapObject
(
JSContext
*
aCx
JS
:
:
Handle
<
JSObject
*
>
aGivenProto
)
override
;
void
GetName
(
nsString
&
aRetVal
)
const
;
LockMode
Mode
(
)
const
;
Promise
&
GetWaitingPromise
(
)
;
virtual
void
ResolvedCallback
(
JSContext
*
aCx
JS
:
:
Handle
<
JS
:
:
Value
>
aValue
ErrorResult
&
aRv
)
override
;
virtual
void
RejectedCallback
(
JSContext
*
aCx
JS
:
:
Handle
<
JS
:
:
Value
>
aValue
ErrorResult
&
aRv
)
override
;
private
:
nsCOMPtr
<
nsIGlobalObject
>
mOwner
;
WeakPtr
<
locks
:
:
LockRequestChild
>
mLockRequestChild
;
nsString
mName
;
LockMode
mMode
;
RefPtr
<
Promise
>
mWaitingPromise
;
RefPtr
<
Promise
>
mReleasedPromise
;
}
;
}
#
endif
