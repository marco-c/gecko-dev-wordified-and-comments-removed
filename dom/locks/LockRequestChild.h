#
ifndef
DOM_LOCKS_LOCKREQUESTCHILD_H_
#
define
DOM_LOCKS_LOCKREQUESTCHILD_H_
#
include
"
LockManagerChild
.
h
"
#
include
"
mozilla
/
dom
/
Lock
.
h
"
#
include
"
mozilla
/
dom
/
WorkerRef
.
h
"
#
include
"
mozilla
/
dom
/
locks
/
PLockRequestChild
.
h
"
#
include
"
nsISupportsImpl
.
h
"
namespace
mozilla
:
:
dom
:
:
locks
{
struct
LockRequest
{
nsString
mName
;
RefPtr
<
Promise
>
mPromise
;
RefPtr
<
LockGrantedCallback
>
mCallback
;
}
;
class
LockRequestChild
final
:
public
PLockRequestChild
public
AbortFollower
public
SupportsWeakPtr
{
using
IPCResult
=
mozilla
:
:
ipc
:
:
IPCResult
;
NS_DECL_ISUPPORTS
public
:
explicit
LockRequestChild
(
const
LockRequest
&
aRequest
const
Optional
<
OwningNonNull
<
AbortSignal
>
>
&
aSignal
)
;
void
MaybeSetWorkerRef
(
)
;
MOZ_CAN_RUN_SCRIPT_BOUNDARY
IPCResult
RecvResolve
(
const
LockMode
&
aLockMode
bool
aIsAvailable
)
;
IPCResult
Recv__delete__
(
bool
aAborted
)
;
void
ActorDestroy
(
ActorDestroyReason
aReason
)
final
;
void
RunAbortAlgorithm
(
)
final
;
private
:
~
LockRequestChild
(
)
=
default
;
LockManagerChild
*
CastedManager
(
)
const
;
const
LockRequest
mRequest
;
RefPtr
<
StrongWorkerRef
>
mWorkerRef
;
}
;
}
#
endif
