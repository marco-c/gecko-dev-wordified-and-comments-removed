#
include
"
LockManagerParent
.
h
"
#
include
"
LockRequestParent
.
h
"
#
include
"
mozilla
/
dom
/
Promise
.
h
"
namespace
mozilla
:
:
dom
:
:
locks
{
mozilla
:
:
ipc
:
:
IPCResult
LockRequestParent
:
:
Recv__delete__
(
bool
aAborted
)
{
RefPtr
<
LockManagerParent
>
manager
=
static_cast
<
LockManagerParent
*
>
(
Manager
(
)
)
;
ManagedLocks
&
managed
=
manager
-
>
Locks
(
)
;
DebugOnly
<
bool
>
unheld
=
managed
.
mHeldLocks
.
RemoveElement
(
this
)
;
MOZ_ASSERT_IF
(
!
aAborted
unheld
)
;
if
(
auto
queue
=
managed
.
mQueueMap
.
Lookup
(
mRequest
.
name
(
)
)
)
{
if
(
aAborted
)
{
DebugOnly
<
bool
>
dequeued
=
queue
.
Data
(
)
.
RemoveElement
(
this
)
;
MOZ_ASSERT_IF
(
!
unheld
dequeued
)
;
}
manager
-
>
ProcessRequestQueue
(
queue
.
Data
(
)
)
;
if
(
queue
.
Data
(
)
.
IsEmpty
(
)
)
{
queue
.
Remove
(
)
;
}
}
return
IPC_OK
(
)
;
}
}
