#
include
"
ClientManagerOpChild
.
h
"
#
include
"
mozilla
/
dom
/
ClientManager
.
h
"
#
include
"
mozilla
/
ipc
/
ProtocolUtils
.
h
"
namespace
mozilla
:
:
dom
{
void
ClientManagerOpChild
:
:
ActorDestroy
(
ActorDestroyReason
aReason
)
{
mClientManager
=
nullptr
;
if
(
mPromise
)
{
CopyableErrorResult
rv
;
rv
.
ThrowAbortError
(
"
Client
aborted
"
)
;
mPromise
-
>
Reject
(
rv
__func__
)
;
mPromise
=
nullptr
;
}
}
mozilla
:
:
ipc
:
:
IPCResult
ClientManagerOpChild
:
:
Recv__delete__
(
const
ClientOpResult
&
aResult
)
{
mClientManager
=
nullptr
;
if
(
aResult
.
type
(
)
=
=
ClientOpResult
:
:
TCopyableErrorResult
&
&
aResult
.
get_CopyableErrorResult
(
)
.
Failed
(
)
)
{
mPromise
-
>
Reject
(
aResult
.
get_CopyableErrorResult
(
)
__func__
)
;
mPromise
=
nullptr
;
return
IPC_OK
(
)
;
}
mPromise
-
>
Resolve
(
aResult
__func__
)
;
mPromise
=
nullptr
;
return
IPC_OK
(
)
;
}
ClientManagerOpChild
:
:
ClientManagerOpChild
(
ClientManager
*
aClientManager
const
ClientOpConstructorArgs
&
aArgs
ClientOpPromise
:
:
Private
*
aPromise
)
:
mClientManager
(
aClientManager
)
mPromise
(
aPromise
)
{
MOZ_DIAGNOSTIC_ASSERT
(
mClientManager
)
;
MOZ_DIAGNOSTIC_ASSERT
(
mPromise
)
;
}
ClientManagerOpChild
:
:
~
ClientManagerOpChild
(
)
{
MOZ_DIAGNOSTIC_ASSERT
(
!
mPromise
)
;
}
}
