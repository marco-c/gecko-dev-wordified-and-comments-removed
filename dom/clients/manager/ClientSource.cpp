#
include
"
ClientSource
.
h
"
#
include
"
ClientManager
.
h
"
#
include
"
ClientManagerChild
.
h
"
#
include
"
ClientSourceChild
.
h
"
#
include
"
ClientValidation
.
h
"
#
include
"
mozilla
/
dom
/
ClientIPCTypes
.
h
"
namespace
mozilla
{
namespace
dom
{
using
mozilla
:
:
ipc
:
:
PrincipalInfo
;
void
ClientSource
:
:
Shutdown
(
)
{
NS_ASSERT_OWNINGTHREAD
(
ClientSource
)
;
if
(
IsShutdown
(
)
)
{
return
;
}
ShutdownThing
(
)
;
mManager
=
nullptr
;
}
ClientSource
:
:
ClientSource
(
ClientManager
*
aManager
const
ClientSourceConstructorArgs
&
aArgs
)
:
mManager
(
aManager
)
mClientInfo
(
aArgs
.
id
(
)
aArgs
.
type
(
)
aArgs
.
principalInfo
(
)
aArgs
.
creationTime
(
)
)
{
MOZ_ASSERT
(
mManager
)
;
}
void
ClientSource
:
:
Activate
(
PClientManagerChild
*
aActor
)
{
NS_ASSERT_OWNINGTHREAD
(
ClientSource
)
;
MOZ_ASSERT
(
!
GetActor
(
)
)
;
if
(
IsShutdown
(
)
)
{
return
;
}
if
(
NS_WARN_IF
(
!
ClientIsValidPrincipalInfo
(
mClientInfo
.
PrincipalInfo
(
)
)
)
)
{
Shutdown
(
)
;
return
;
}
ClientSourceConstructorArgs
args
(
mClientInfo
.
Id
(
)
mClientInfo
.
Type
(
)
mClientInfo
.
PrincipalInfo
(
)
mClientInfo
.
CreationTime
(
)
)
;
PClientSourceChild
*
actor
=
aActor
-
>
SendPClientSourceConstructor
(
args
)
;
if
(
!
actor
)
{
Shutdown
(
)
;
return
;
}
ActivateThing
(
static_cast
<
ClientSourceChild
*
>
(
actor
)
)
;
}
ClientSource
:
:
~
ClientSource
(
)
{
Shutdown
(
)
;
}
}
}
