#
include
"
ClientValidation
.
h
"
#
include
"
mozilla
/
net
/
MozURL
.
h
"
namespace
mozilla
{
namespace
dom
{
using
mozilla
:
:
ipc
:
:
ContentPrincipalInfo
;
using
mozilla
:
:
ipc
:
:
PrincipalInfo
;
using
mozilla
:
:
net
:
:
MozURL
;
bool
ClientIsValidPrincipalInfo
(
const
PrincipalInfo
&
aPrincipalInfo
)
{
switch
(
aPrincipalInfo
.
type
(
)
)
{
case
PrincipalInfo
:
:
TSystemPrincipalInfo
:
case
PrincipalInfo
:
:
TNullPrincipalInfo
:
{
return
true
;
}
case
PrincipalInfo
:
:
TContentPrincipalInfo
:
{
const
ContentPrincipalInfo
&
content
=
aPrincipalInfo
.
get_ContentPrincipalInfo
(
)
;
RefPtr
<
MozURL
>
specURL
;
nsresult
rv
=
MozURL
:
:
Init
(
getter_AddRefs
(
specURL
)
content
.
spec
(
)
)
;
NS_ENSURE_SUCCESS
(
rv
false
)
;
RefPtr
<
MozURL
>
originURL
;
rv
=
MozURL
:
:
Init
(
getter_AddRefs
(
originURL
)
content
.
originNoSuffix
(
)
.
get_nsCString
(
)
)
;
NS_ENSURE_SUCCESS
(
rv
false
)
;
nsAutoCString
originOrigin
;
rv
=
originURL
-
>
GetOrigin
(
originOrigin
)
;
NS_ENSURE_SUCCESS
(
rv
false
)
;
nsAutoCString
specOrigin
;
rv
=
specURL
-
>
GetOrigin
(
specOrigin
)
;
NS_ENSURE_SUCCESS
(
rv
false
)
;
return
specOrigin
=
=
originOrigin
;
}
default
:
{
break
;
}
}
return
false
;
}
}
}
