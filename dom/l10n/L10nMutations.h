#
ifndef
mozilla_dom_l10n_L10nMutations_h
#
define
mozilla_dom_l10n_L10nMutations_h
#
include
"
nsRefreshDriver
.
h
"
#
include
"
nsStubMutationObserver
.
h
"
#
include
"
nsTHashtable
.
h
"
#
include
"
mozilla
/
dom
/
DOMLocalization
.
h
"
namespace
mozilla
{
namespace
dom
{
class
L10nMutations
final
:
public
nsStubMutationObserver
public
nsARefreshObserver
{
public
:
NS_DECL_CYCLE_COLLECTING_ISUPPORTS
NS_DECL_CYCLE_COLLECTION_CLASS_AMBIGUOUS
(
L10nMutations
nsIMutationObserver
)
NS_DECL_NSIMUTATIONOBSERVER_CONTENTAPPENDED
NS_DECL_NSIMUTATIONOBSERVER_CONTENTINSERTED
NS_DECL_NSIMUTATIONOBSERVER_ATTRIBUTECHANGED
explicit
L10nMutations
(
DOMLocalization
*
aDOMLocalization
)
;
void
PauseObserving
(
)
;
void
ResumeObserving
(
)
;
void
Disconnect
(
)
;
void
OnCreatePresShell
(
)
;
protected
:
bool
mObserving
=
false
;
bool
mRefreshObserver
=
false
;
RefPtr
<
nsRefreshDriver
>
mRefreshDriver
;
DOMLocalization
*
mDOMLocalization
;
nsTHashtable
<
nsRefPtrHashKey
<
Element
>
>
mPendingElementsHash
;
nsTArray
<
RefPtr
<
Element
>
>
mPendingElements
;
virtual
void
WillRefresh
(
mozilla
:
:
TimeStamp
aTime
)
override
;
void
StartRefreshObserver
(
)
;
void
StopRefreshObserver
(
)
;
void
L10nElementChanged
(
Element
*
aElement
)
;
void
FlushPendingTranslations
(
)
;
private
:
~
L10nMutations
(
)
{
StopRefreshObserver
(
)
;
MOZ_ASSERT
(
!
mDOMLocalization
"
DOMLocalization
<
-
-
>
L10nMutations
cycle
should
be
broken
.
"
)
;
}
bool
IsInRoots
(
nsINode
*
aNode
)
;
}
;
}
}
#
endif
