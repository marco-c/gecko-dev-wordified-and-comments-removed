#
ifndef
mozilla_dom_l10n_Mutations_h__
#
define
mozilla_dom_l10n_Mutations_h__
#
include
"
nsRefreshDriver
.
h
"
#
include
"
nsStubMutationObserver
.
h
"
#
include
"
nsTHashtable
.
h
"
#
include
"
mozilla
/
dom
/
DocumentL10n
.
h
"
namespace
mozilla
{
namespace
dom
{
namespace
l10n
{
class
Mutations
final
:
public
nsStubMutationObserver
public
nsARefreshObserver
{
public
:
NS_DECL_CYCLE_COLLECTING_ISUPPORTS
NS_DECL_CYCLE_COLLECTION_CLASS_AMBIGUOUS
(
Mutations
nsIMutationObserver
)
NS_DECL_NSIMUTATIONOBSERVER_CONTENTAPPENDED
NS_DECL_NSIMUTATIONOBSERVER_CONTENTINSERTED
NS_DECL_NSIMUTATIONOBSERVER_ATTRIBUTECHANGED
explicit
Mutations
(
DocumentL10n
*
aDocumentL10n
)
;
void
PauseObserving
(
)
;
void
ResumeObserving
(
)
;
void
Disconnect
(
)
;
protected
:
bool
mObserving
=
false
;
bool
mRefreshObserver
=
false
;
RefPtr
<
nsRefreshDriver
>
mRefreshDriver
;
DocumentL10n
*
mDocumentL10n
;
nsTHashtable
<
nsRefPtrHashKey
<
Element
>
>
mPendingElementsHash
;
nsTArray
<
RefPtr
<
Element
>
>
mPendingElements
;
virtual
void
WillRefresh
(
mozilla
:
:
TimeStamp
aTime
)
override
;
void
StartRefreshObserver
(
)
;
void
StopRefreshObserver
(
)
;
void
L10nElementChanged
(
Element
*
aElement
)
;
void
FlushPendingTranslations
(
)
;
private
:
~
Mutations
(
)
{
StopRefreshObserver
(
)
;
MOZ_ASSERT
(
!
mDocumentL10n
"
DocumentL10n
<
-
-
>
Mutations
cycle
should
be
broken
.
"
)
;
}
}
;
}
}
}
#
endif
