#
ifndef
WEBGPU_CHILD_H_
#
define
WEBGPU_CHILD_H_
#
include
"
mozilla
/
webgpu
/
PWebGPUChild
.
h
"
#
include
"
mozilla
/
MozPromise
.
h
"
namespace
mozilla
{
namespace
dom
{
struct
GPURequestAdapterOptions
;
}
namespace
layers
{
class
CompositorBridgeChild
;
}
namespace
webgpu
{
namespace
ffi
{
struct
WGPUClient
;
}
typedef
MozPromise
<
RawId
Maybe
<
ipc
:
:
ResponseRejectReason
>
true
>
RawIdPromise
;
class
WebGPUChild
final
:
public
PWebGPUChild
{
public
:
friend
class
layers
:
:
CompositorBridgeChild
;
NS_DECL_CYCLE_COLLECTION_NATIVE_CLASS
(
WebGPUChild
)
NS_INLINE_DECL_CYCLE_COLLECTING_NATIVE_REFCOUNTING
(
WebGPUChild
)
public
:
explicit
WebGPUChild
(
)
;
bool
IsOpen
(
)
const
{
return
mIPCOpen
;
}
RefPtr
<
RawIdPromise
>
InstanceRequestAdapter
(
const
dom
:
:
GPURequestAdapterOptions
&
aOptions
)
;
Maybe
<
RawId
>
AdapterRequestDevice
(
RawId
aSelfId
const
dom
:
:
GPUDeviceDescriptor
&
aDesc
)
;
RawId
DeviceCreateBuffer
(
RawId
aSelfId
const
dom
:
:
GPUBufferDescriptor
&
aDesc
)
;
RawId
DeviceCreateCommandEncoder
(
RawId
aSelfId
const
dom
:
:
GPUCommandEncoderDescriptor
&
aDesc
)
;
RawId
CommandEncoderFinish
(
RawId
aSelfId
const
dom
:
:
GPUCommandBufferDescriptor
&
aDesc
)
;
RawId
DeviceCreateBindGroupLayout
(
RawId
aSelfId
const
dom
:
:
GPUBindGroupLayoutDescriptor
&
aDesc
)
;
RawId
DeviceCreatePipelineLayout
(
RawId
aSelfId
const
dom
:
:
GPUPipelineLayoutDescriptor
&
aDesc
)
;
RawId
DeviceCreateBindGroup
(
RawId
aSelfId
const
dom
:
:
GPUBindGroupDescriptor
&
aDesc
)
;
RawId
DeviceCreateShaderModule
(
RawId
aSelfId
const
dom
:
:
GPUShaderModuleDescriptor
&
aDesc
)
;
RawId
DeviceCreateComputePipeline
(
RawId
aSelfId
const
dom
:
:
GPUComputePipelineDescriptor
&
aDesc
)
;
void
QueueSubmit
(
RawId
aSelfId
const
nsTArray
<
RawId
>
&
aCommandBufferIds
)
;
void
DestroyAdapter
(
RawId
aId
)
;
void
DestroyBuffer
(
RawId
aId
)
;
void
DestroyCommandEncoder
(
RawId
aId
)
;
void
DestroyCommandBuffer
(
RawId
aId
)
;
void
DestroyBindGroupLayout
(
RawId
aId
)
;
void
DestroyPipelineLayout
(
RawId
aId
)
;
void
DestroyBindGroup
(
RawId
aId
)
;
void
DestroyShaderModule
(
RawId
aId
)
;
void
DestroyComputePipeline
(
RawId
aId
)
;
void
DestroyRenderPipeline
(
RawId
aId
)
;
private
:
virtual
~
WebGPUChild
(
)
;
void
AddIPDLReference
(
)
{
MOZ_ASSERT
(
!
mIPCOpen
)
;
mIPCOpen
=
true
;
AddRef
(
)
;
}
void
ReleaseIPDLReference
(
)
{
MOZ_ASSERT
(
mIPCOpen
)
;
mIPCOpen
=
false
;
Release
(
)
;
}
ffi
:
:
WGPUClient
*
const
mClient
;
bool
mIPCOpen
;
}
;
}
}
#
endif
