import
{
keysOf
}
from
'
.
.
/
common
/
util
/
data_tables
.
js
'
;
import
{
assert
unreachable
}
from
'
.
.
/
common
/
util
/
util
.
js
'
;
import
{
align
}
from
'
.
/
util
/
math
.
js
'
;
import
{
ImageCopyType
}
from
'
.
/
util
/
texture
/
layout
.
js
'
;
const
kFormatUniversalDefaults
=
{
blockWidth
:
undefined
blockHeight
:
undefined
color
:
undefined
depth
:
undefined
stencil
:
undefined
colorRender
:
undefined
multisample
:
undefined
feature
:
undefined
baseFormat
:
undefined
bytesPerBlock
:
undefined
}
as
const
;
function
formatTableWithDefaults
<
Defaults
extends
{
}
Table
extends
{
readonly
[
K
:
string
]
:
{
}
}
>
(
{
defaults
table
}
:
{
defaults
:
Defaults
;
table
:
Table
;
}
)
:
{
readonly
[
F
in
keyof
Table
]
:
{
readonly
[
K
in
keyof
typeof
kFormatUniversalDefaults
]
:
K
extends
keyof
Table
[
F
]
?
Table
[
F
]
[
K
]
:
K
extends
keyof
Defaults
?
Defaults
[
K
]
:
(
typeof
kFormatUniversalDefaults
)
[
K
]
;
}
;
}
{
return
Object
.
fromEntries
(
Object
.
entries
(
table
)
.
map
(
(
[
k
row
]
)
=
>
[
k
{
.
.
.
kFormatUniversalDefaults
.
.
.
defaults
.
.
.
row
}
]
)
)
as
any
;
}
const
kRegularTextureFormatInfo
=
formatTableWithDefaults
(
{
defaults
:
{
blockWidth
:
1
blockHeight
:
1
}
table
:
{
r8unorm
:
{
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
1
}
colorRender
:
{
blend
:
true
resolve
:
true
byteCost
:
1
alignment
:
1
}
multisample
:
true
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
r8snorm
:
{
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
1
}
multisample
:
false
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
r8uint
:
{
color
:
{
type
:
'
uint
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
1
}
colorRender
:
{
blend
:
false
resolve
:
false
byteCost
:
1
alignment
:
1
}
multisample
:
true
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
r8sint
:
{
color
:
{
type
:
'
sint
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
1
}
colorRender
:
{
blend
:
false
resolve
:
false
byteCost
:
1
alignment
:
1
}
multisample
:
true
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
rg8unorm
:
{
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
2
}
colorRender
:
{
blend
:
true
resolve
:
true
byteCost
:
2
alignment
:
1
}
multisample
:
true
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
rg8snorm
:
{
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
2
}
multisample
:
false
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
rg8uint
:
{
color
:
{
type
:
'
uint
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
2
}
colorRender
:
{
blend
:
false
resolve
:
false
byteCost
:
2
alignment
:
1
}
multisample
:
true
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
rg8sint
:
{
color
:
{
type
:
'
sint
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
2
}
colorRender
:
{
blend
:
false
resolve
:
false
byteCost
:
2
alignment
:
1
}
multisample
:
true
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
rgba8unorm
:
{
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
true
readWriteStorage
:
false
bytes
:
4
}
colorRender
:
{
blend
:
true
resolve
:
true
byteCost
:
8
alignment
:
1
}
multisample
:
true
baseFormat
:
'
rgba8unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
rgba8unorm
-
srgb
'
:
{
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
4
}
colorRender
:
{
blend
:
true
resolve
:
true
byteCost
:
8
alignment
:
1
}
multisample
:
true
baseFormat
:
'
rgba8unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
rgba8snorm
:
{
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
true
readWriteStorage
:
false
bytes
:
4
}
multisample
:
false
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
rgba8uint
:
{
color
:
{
type
:
'
uint
'
copySrc
:
true
copyDst
:
true
storage
:
true
readWriteStorage
:
false
bytes
:
4
}
colorRender
:
{
blend
:
false
resolve
:
false
byteCost
:
4
alignment
:
1
}
multisample
:
true
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
rgba8sint
:
{
color
:
{
type
:
'
sint
'
copySrc
:
true
copyDst
:
true
storage
:
true
readWriteStorage
:
false
bytes
:
4
}
colorRender
:
{
blend
:
false
resolve
:
false
byteCost
:
4
alignment
:
1
}
multisample
:
true
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
bgra8unorm
:
{
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
4
}
colorRender
:
{
blend
:
true
resolve
:
true
byteCost
:
8
alignment
:
1
}
multisample
:
true
baseFormat
:
'
bgra8unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
bgra8unorm
-
srgb
'
:
{
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
4
}
colorRender
:
{
blend
:
true
resolve
:
true
byteCost
:
8
alignment
:
1
}
multisample
:
true
baseFormat
:
'
bgra8unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
r16uint
:
{
color
:
{
type
:
'
uint
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
2
}
colorRender
:
{
blend
:
false
resolve
:
false
byteCost
:
2
alignment
:
2
}
multisample
:
true
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
r16sint
:
{
color
:
{
type
:
'
sint
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
2
}
colorRender
:
{
blend
:
false
resolve
:
false
byteCost
:
2
alignment
:
2
}
multisample
:
true
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
r16float
:
{
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
2
}
colorRender
:
{
blend
:
true
resolve
:
true
byteCost
:
2
alignment
:
2
}
multisample
:
true
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
rg16uint
:
{
color
:
{
type
:
'
uint
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
4
}
colorRender
:
{
blend
:
false
resolve
:
false
byteCost
:
4
alignment
:
2
}
multisample
:
true
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
rg16sint
:
{
color
:
{
type
:
'
sint
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
4
}
colorRender
:
{
blend
:
false
resolve
:
false
byteCost
:
4
alignment
:
2
}
multisample
:
true
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
rg16float
:
{
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
4
}
colorRender
:
{
blend
:
true
resolve
:
true
byteCost
:
4
alignment
:
2
}
multisample
:
true
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
rgba16uint
:
{
color
:
{
type
:
'
uint
'
copySrc
:
true
copyDst
:
true
storage
:
true
readWriteStorage
:
false
bytes
:
8
}
colorRender
:
{
blend
:
false
resolve
:
false
byteCost
:
8
alignment
:
2
}
multisample
:
true
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
rgba16sint
:
{
color
:
{
type
:
'
sint
'
copySrc
:
true
copyDst
:
true
storage
:
true
readWriteStorage
:
false
bytes
:
8
}
colorRender
:
{
blend
:
false
resolve
:
false
byteCost
:
8
alignment
:
2
}
multisample
:
true
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
rgba16float
:
{
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
true
readWriteStorage
:
false
bytes
:
8
}
colorRender
:
{
blend
:
true
resolve
:
true
byteCost
:
8
alignment
:
2
}
multisample
:
true
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
r32uint
:
{
color
:
{
type
:
'
uint
'
copySrc
:
true
copyDst
:
true
storage
:
true
readWriteStorage
:
true
bytes
:
4
}
colorRender
:
{
blend
:
false
resolve
:
false
byteCost
:
4
alignment
:
4
}
multisample
:
false
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
r32sint
:
{
color
:
{
type
:
'
sint
'
copySrc
:
true
copyDst
:
true
storage
:
true
readWriteStorage
:
true
bytes
:
4
}
colorRender
:
{
blend
:
false
resolve
:
false
byteCost
:
4
alignment
:
4
}
multisample
:
false
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
r32float
:
{
color
:
{
type
:
'
unfilterable
-
float
'
copySrc
:
true
copyDst
:
true
storage
:
true
readWriteStorage
:
true
bytes
:
4
}
colorRender
:
{
blend
:
false
resolve
:
false
byteCost
:
4
alignment
:
4
}
multisample
:
true
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
rg32uint
:
{
color
:
{
type
:
'
uint
'
copySrc
:
true
copyDst
:
true
storage
:
true
readWriteStorage
:
false
bytes
:
8
}
colorRender
:
{
blend
:
false
resolve
:
false
byteCost
:
8
alignment
:
4
}
multisample
:
false
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
rg32sint
:
{
color
:
{
type
:
'
sint
'
copySrc
:
true
copyDst
:
true
storage
:
true
readWriteStorage
:
false
bytes
:
8
}
colorRender
:
{
blend
:
false
resolve
:
false
byteCost
:
8
alignment
:
4
}
multisample
:
false
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
rg32float
:
{
color
:
{
type
:
'
unfilterable
-
float
'
copySrc
:
true
copyDst
:
true
storage
:
true
readWriteStorage
:
false
bytes
:
8
}
colorRender
:
{
blend
:
false
resolve
:
false
byteCost
:
8
alignment
:
4
}
multisample
:
false
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
rgba32uint
:
{
color
:
{
type
:
'
uint
'
copySrc
:
true
copyDst
:
true
storage
:
true
readWriteStorage
:
false
bytes
:
16
}
colorRender
:
{
blend
:
false
resolve
:
false
byteCost
:
16
alignment
:
4
}
multisample
:
false
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
rgba32sint
:
{
color
:
{
type
:
'
sint
'
copySrc
:
true
copyDst
:
true
storage
:
true
readWriteStorage
:
false
bytes
:
16
}
colorRender
:
{
blend
:
false
resolve
:
false
byteCost
:
16
alignment
:
4
}
multisample
:
false
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
rgba32float
:
{
color
:
{
type
:
'
unfilterable
-
float
'
copySrc
:
true
copyDst
:
true
storage
:
true
readWriteStorage
:
false
bytes
:
16
}
colorRender
:
{
blend
:
false
resolve
:
false
byteCost
:
16
alignment
:
4
}
multisample
:
false
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
rgb10a2uint
:
{
color
:
{
type
:
'
uint
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
4
}
colorRender
:
{
blend
:
false
resolve
:
false
byteCost
:
8
alignment
:
4
}
multisample
:
true
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
rgb10a2unorm
:
{
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
4
}
colorRender
:
{
blend
:
true
resolve
:
true
byteCost
:
8
alignment
:
4
}
multisample
:
true
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
rg11b10ufloat
:
{
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
4
}
multisample
:
false
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
rgb9e5ufloat
:
{
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
4
}
multisample
:
false
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
}
}
as
const
)
;
const
kSizedDepthStencilFormatInfo
=
formatTableWithDefaults
(
{
defaults
:
{
blockWidth
:
1
blockHeight
:
1
multisample
:
true
}
table
:
{
stencil8
:
{
stencil
:
{
type
:
'
uint
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
1
}
bytesPerBlock
:
1
}
depth16unorm
:
{
depth
:
{
type
:
'
depth
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
2
}
bytesPerBlock
:
2
}
depth32float
:
{
depth
:
{
type
:
'
depth
'
copySrc
:
true
copyDst
:
false
storage
:
false
readWriteStorage
:
false
bytes
:
4
}
bytesPerBlock
:
4
}
}
}
as
const
)
;
const
kUnsizedDepthStencilFormatInfo
=
formatTableWithDefaults
(
{
defaults
:
{
blockWidth
:
1
blockHeight
:
1
multisample
:
true
}
table
:
{
depth24plus
:
{
depth
:
{
type
:
'
depth
'
copySrc
:
false
copyDst
:
false
storage
:
false
readWriteStorage
:
false
bytes
:
undefined
}
}
'
depth24plus
-
stencil8
'
:
{
depth
:
{
type
:
'
depth
'
copySrc
:
false
copyDst
:
false
storage
:
false
readWriteStorage
:
false
bytes
:
undefined
}
stencil
:
{
type
:
'
uint
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
1
}
}
'
depth32float
-
stencil8
'
:
{
depth
:
{
type
:
'
depth
'
copySrc
:
true
copyDst
:
false
storage
:
false
readWriteStorage
:
false
bytes
:
4
}
stencil
:
{
type
:
'
uint
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
1
}
feature
:
'
depth32float
-
stencil8
'
}
}
}
as
const
)
;
const
kBCTextureFormatInfo
=
formatTableWithDefaults
(
{
defaults
:
{
blockWidth
:
4
blockHeight
:
4
multisample
:
false
feature
:
'
texture
-
compression
-
bc
'
}
table
:
{
'
bc1
-
rgba
-
unorm
'
:
{
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
8
}
baseFormat
:
'
bc1
-
rgba
-
unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
bc1
-
rgba
-
unorm
-
srgb
'
:
{
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
8
}
baseFormat
:
'
bc1
-
rgba
-
unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
bc2
-
rgba
-
unorm
'
:
{
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
16
}
baseFormat
:
'
bc2
-
rgba
-
unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
bc2
-
rgba
-
unorm
-
srgb
'
:
{
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
16
}
baseFormat
:
'
bc2
-
rgba
-
unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
bc3
-
rgba
-
unorm
'
:
{
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
16
}
baseFormat
:
'
bc3
-
rgba
-
unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
bc3
-
rgba
-
unorm
-
srgb
'
:
{
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
16
}
baseFormat
:
'
bc3
-
rgba
-
unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
bc4
-
r
-
unorm
'
:
{
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
8
}
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
bc4
-
r
-
snorm
'
:
{
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
8
}
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
bc5
-
rg
-
unorm
'
:
{
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
16
}
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
bc5
-
rg
-
snorm
'
:
{
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
16
}
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
bc6h
-
rgb
-
ufloat
'
:
{
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
16
}
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
bc6h
-
rgb
-
float
'
:
{
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
16
}
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
bc7
-
rgba
-
unorm
'
:
{
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
16
}
baseFormat
:
'
bc7
-
rgba
-
unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
bc7
-
rgba
-
unorm
-
srgb
'
:
{
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
16
}
baseFormat
:
'
bc7
-
rgba
-
unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
}
}
as
const
)
;
const
kETC2TextureFormatInfo
=
formatTableWithDefaults
(
{
defaults
:
{
blockWidth
:
4
blockHeight
:
4
multisample
:
false
feature
:
'
texture
-
compression
-
etc2
'
}
table
:
{
'
etc2
-
rgb8unorm
'
:
{
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
8
}
baseFormat
:
'
etc2
-
rgb8unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
etc2
-
rgb8unorm
-
srgb
'
:
{
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
8
}
baseFormat
:
'
etc2
-
rgb8unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
etc2
-
rgb8a1unorm
'
:
{
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
8
}
baseFormat
:
'
etc2
-
rgb8a1unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
etc2
-
rgb8a1unorm
-
srgb
'
:
{
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
8
}
baseFormat
:
'
etc2
-
rgb8a1unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
etc2
-
rgba8unorm
'
:
{
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
16
}
baseFormat
:
'
etc2
-
rgba8unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
etc2
-
rgba8unorm
-
srgb
'
:
{
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
16
}
baseFormat
:
'
etc2
-
rgba8unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
eac
-
r11unorm
'
:
{
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
8
}
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
eac
-
r11snorm
'
:
{
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
8
}
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
eac
-
rg11unorm
'
:
{
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
16
}
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
eac
-
rg11snorm
'
:
{
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
16
}
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
}
}
as
const
)
;
const
kASTCTextureFormatInfo
=
formatTableWithDefaults
(
{
defaults
:
{
multisample
:
false
feature
:
'
texture
-
compression
-
astc
'
}
table
:
{
'
astc
-
4x4
-
unorm
'
:
{
blockWidth
:
4
blockHeight
:
4
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
16
}
baseFormat
:
'
astc
-
4x4
-
unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
astc
-
4x4
-
unorm
-
srgb
'
:
{
blockWidth
:
4
blockHeight
:
4
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
16
}
baseFormat
:
'
astc
-
4x4
-
unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
astc
-
5x4
-
unorm
'
:
{
blockWidth
:
5
blockHeight
:
4
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
16
}
baseFormat
:
'
astc
-
5x4
-
unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
astc
-
5x4
-
unorm
-
srgb
'
:
{
blockWidth
:
5
blockHeight
:
4
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
16
}
baseFormat
:
'
astc
-
5x4
-
unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
astc
-
5x5
-
unorm
'
:
{
blockWidth
:
5
blockHeight
:
5
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
16
}
baseFormat
:
'
astc
-
5x5
-
unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
astc
-
5x5
-
unorm
-
srgb
'
:
{
blockWidth
:
5
blockHeight
:
5
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
16
}
baseFormat
:
'
astc
-
5x5
-
unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
astc
-
6x5
-
unorm
'
:
{
blockWidth
:
6
blockHeight
:
5
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
16
}
baseFormat
:
'
astc
-
6x5
-
unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
astc
-
6x5
-
unorm
-
srgb
'
:
{
blockWidth
:
6
blockHeight
:
5
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
16
}
baseFormat
:
'
astc
-
6x5
-
unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
astc
-
6x6
-
unorm
'
:
{
blockWidth
:
6
blockHeight
:
6
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
16
}
baseFormat
:
'
astc
-
6x6
-
unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
astc
-
6x6
-
unorm
-
srgb
'
:
{
blockWidth
:
6
blockHeight
:
6
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
16
}
baseFormat
:
'
astc
-
6x6
-
unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
astc
-
8x5
-
unorm
'
:
{
blockWidth
:
8
blockHeight
:
5
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
16
}
baseFormat
:
'
astc
-
8x5
-
unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
astc
-
8x5
-
unorm
-
srgb
'
:
{
blockWidth
:
8
blockHeight
:
5
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
16
}
baseFormat
:
'
astc
-
8x5
-
unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
astc
-
8x6
-
unorm
'
:
{
blockWidth
:
8
blockHeight
:
6
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
16
}
baseFormat
:
'
astc
-
8x6
-
unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
astc
-
8x6
-
unorm
-
srgb
'
:
{
blockWidth
:
8
blockHeight
:
6
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
16
}
baseFormat
:
'
astc
-
8x6
-
unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
astc
-
8x8
-
unorm
'
:
{
blockWidth
:
8
blockHeight
:
8
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
16
}
baseFormat
:
'
astc
-
8x8
-
unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
astc
-
8x8
-
unorm
-
srgb
'
:
{
blockWidth
:
8
blockHeight
:
8
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
16
}
baseFormat
:
'
astc
-
8x8
-
unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
astc
-
10x5
-
unorm
'
:
{
blockWidth
:
10
blockHeight
:
5
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
16
}
baseFormat
:
'
astc
-
10x5
-
unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
astc
-
10x5
-
unorm
-
srgb
'
:
{
blockWidth
:
10
blockHeight
:
5
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
16
}
baseFormat
:
'
astc
-
10x5
-
unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
astc
-
10x6
-
unorm
'
:
{
blockWidth
:
10
blockHeight
:
6
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
16
}
baseFormat
:
'
astc
-
10x6
-
unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
astc
-
10x6
-
unorm
-
srgb
'
:
{
blockWidth
:
10
blockHeight
:
6
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
16
}
baseFormat
:
'
astc
-
10x6
-
unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
astc
-
10x8
-
unorm
'
:
{
blockWidth
:
10
blockHeight
:
8
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
16
}
baseFormat
:
'
astc
-
10x8
-
unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
astc
-
10x8
-
unorm
-
srgb
'
:
{
blockWidth
:
10
blockHeight
:
8
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
16
}
baseFormat
:
'
astc
-
10x8
-
unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
astc
-
10x10
-
unorm
'
:
{
blockWidth
:
10
blockHeight
:
10
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
16
}
baseFormat
:
'
astc
-
10x10
-
unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
astc
-
10x10
-
unorm
-
srgb
'
:
{
blockWidth
:
10
blockHeight
:
10
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
16
}
baseFormat
:
'
astc
-
10x10
-
unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
astc
-
12x10
-
unorm
'
:
{
blockWidth
:
12
blockHeight
:
10
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
16
}
baseFormat
:
'
astc
-
12x10
-
unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
astc
-
12x10
-
unorm
-
srgb
'
:
{
blockWidth
:
12
blockHeight
:
10
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
16
}
baseFormat
:
'
astc
-
12x10
-
unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
astc
-
12x12
-
unorm
'
:
{
blockWidth
:
12
blockHeight
:
12
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
16
}
baseFormat
:
'
astc
-
12x12
-
unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
'
astc
-
12x12
-
unorm
-
srgb
'
:
{
blockWidth
:
12
blockHeight
:
12
color
:
{
type
:
'
float
'
copySrc
:
true
copyDst
:
true
storage
:
false
readWriteStorage
:
false
bytes
:
16
}
baseFormat
:
'
astc
-
12x12
-
unorm
'
get
bytesPerBlock
(
)
{
return
this
.
color
.
bytes
;
}
}
}
}
as
const
)
;
const
kCompressedTextureFormatInfo
=
{
.
.
.
kBCTextureFormatInfo
.
.
.
kETC2TextureFormatInfo
.
.
.
kASTCTextureFormatInfo
}
as
const
;
const
kColorTextureFormatInfo
=
{
.
.
.
kRegularTextureFormatInfo
.
.
.
kCompressedTextureFormatInfo
}
as
const
;
const
kEncodableTextureFormatInfo
=
{
.
.
.
kRegularTextureFormatInfo
.
.
.
kSizedDepthStencilFormatInfo
}
as
const
;
const
kSizedTextureFormatInfo
=
{
.
.
.
kRegularTextureFormatInfo
.
.
.
kSizedDepthStencilFormatInfo
.
.
.
kCompressedTextureFormatInfo
}
as
const
;
const
kDepthStencilFormatInfo
=
{
.
.
.
kSizedDepthStencilFormatInfo
.
.
.
kUnsizedDepthStencilFormatInfo
}
as
const
;
const
kUncompressedTextureFormatInfo
=
{
.
.
.
kRegularTextureFormatInfo
.
.
.
kSizedDepthStencilFormatInfo
.
.
.
kUnsizedDepthStencilFormatInfo
}
as
const
;
const
kAllTextureFormatInfo
=
{
.
.
.
kUncompressedTextureFormatInfo
.
.
.
kCompressedTextureFormatInfo
}
as
const
;
export
type
RegularTextureFormat
=
keyof
typeof
kRegularTextureFormatInfo
;
export
type
SizedDepthStencilFormat
=
keyof
typeof
kSizedDepthStencilFormatInfo
;
export
type
UnsizedDepthStencilFormat
=
keyof
typeof
kUnsizedDepthStencilFormatInfo
;
export
type
CompressedTextureFormat
=
keyof
typeof
kCompressedTextureFormatInfo
;
export
type
ColorTextureFormat
=
keyof
typeof
kColorTextureFormatInfo
;
export
type
EncodableTextureFormat
=
keyof
typeof
kEncodableTextureFormatInfo
;
export
type
SizedTextureFormat
=
keyof
typeof
kSizedTextureFormatInfo
;
export
type
DepthStencilFormat
=
keyof
typeof
kDepthStencilFormatInfo
;
export
type
UncompressedTextureFormat
=
keyof
typeof
kUncompressedTextureFormatInfo
;
export
const
kRegularTextureFormats
:
readonly
RegularTextureFormat
[
]
=
keysOf
(
kRegularTextureFormatInfo
)
;
export
const
kSizedDepthStencilFormats
:
readonly
SizedDepthStencilFormat
[
]
=
keysOf
(
kSizedDepthStencilFormatInfo
)
;
export
const
kUnsizedDepthStencilFormats
:
readonly
UnsizedDepthStencilFormat
[
]
=
keysOf
(
kUnsizedDepthStencilFormatInfo
)
;
export
const
kCompressedTextureFormats
:
readonly
CompressedTextureFormat
[
]
=
keysOf
(
kCompressedTextureFormatInfo
)
;
export
const
kColorTextureFormats
:
readonly
ColorTextureFormat
[
]
=
keysOf
(
kColorTextureFormatInfo
)
;
export
const
kEncodableTextureFormats
:
readonly
EncodableTextureFormat
[
]
=
keysOf
(
kEncodableTextureFormatInfo
)
;
export
const
kSizedTextureFormats
:
readonly
SizedTextureFormat
[
]
=
keysOf
(
kSizedTextureFormatInfo
)
;
export
const
kDepthStencilFormats
:
readonly
DepthStencilFormat
[
]
=
keysOf
(
kDepthStencilFormatInfo
)
;
export
const
kUncompressedTextureFormats
:
readonly
UncompressedTextureFormat
[
]
=
keysOf
(
kUncompressedTextureFormatInfo
)
;
export
const
kAllTextureFormats
:
readonly
GPUTextureFormat
[
]
=
keysOf
(
kAllTextureFormatInfo
)
;
export
const
kRenderableColorTextureFormats
=
kRegularTextureFormats
.
filter
(
v
=
>
kColorTextureFormatInfo
[
v
]
.
colorRender
)
;
interface
TextureFormatAspectInfo
{
copySrc
:
boolean
;
copyDst
:
boolean
;
storage
:
boolean
;
readWriteStorage
:
boolean
;
bytes
:
number
|
undefined
;
}
interface
TextureFormatColorAspectInfo
extends
TextureFormatAspectInfo
{
bytes
:
number
;
type
:
'
float
'
|
'
uint
'
|
'
sint
'
|
'
unfilterable
-
float
'
;
}
interface
TextureFormatDepthAspectInfo
extends
TextureFormatAspectInfo
{
type
:
'
depth
'
;
}
interface
TextureFormatStencilAspectInfo
extends
TextureFormatAspectInfo
{
bytes
:
1
;
type
:
'
uint
'
;
}
type
TextureFormatInfo_TypeCheck
=
{
blockWidth
:
number
;
blockHeight
:
number
;
multisample
:
boolean
;
baseFormat
:
GPUTextureFormat
|
undefined
;
feature
:
GPUFeatureName
|
undefined
;
bytesPerBlock
:
number
|
undefined
;
}
&
(
|
{
color
:
TextureFormatColorAspectInfo
;
colorRender
:
|
undefined
|
{
blend
:
boolean
;
resolve
:
boolean
;
byteCost
:
number
;
alignment
:
number
;
}
;
}
|
(
|
{
depth
:
TextureFormatDepthAspectInfo
;
stencil
:
undefined
|
TextureFormatStencilAspectInfo
;
multisample
:
true
;
}
|
{
stencil
:
TextureFormatStencilAspectInfo
;
multisample
:
true
;
}
)
)
;
export
const
kTextureFormatInfo
=
{
.
.
.
kRegularTextureFormatInfo
.
.
.
kSizedDepthStencilFormatInfo
.
.
.
kUnsizedDepthStencilFormatInfo
.
.
.
kBCTextureFormatInfo
.
.
.
kETC2TextureFormatInfo
.
.
.
kASTCTextureFormatInfo
}
as
const
;
const
kTextureFormatInfo_TypeCheck
:
{
readonly
[
F
in
GPUTextureFormat
]
:
TextureFormatInfo_TypeCheck
;
}
=
kTextureFormatInfo
;
export
const
kValidTextureFormatsForCopyE2T
=
[
'
r8unorm
'
'
r16float
'
'
r32float
'
'
rg8unorm
'
'
rg16float
'
'
rg32float
'
'
rgba8unorm
'
'
rgba8unorm
-
srgb
'
'
bgra8unorm
'
'
bgra8unorm
-
srgb
'
'
rgb10a2unorm
'
'
rgba16float
'
'
rgba32float
'
]
as
const
;
const
kDepthStencilFormatCapabilityInBufferTextureCopy
=
{
depth24plus
:
{
CopyB2T
:
[
]
CopyT2B
:
[
]
texelAspectSize
:
{
'
depth
-
only
'
:
-
1
'
stencil
-
only
'
:
-
1
}
}
'
depth24plus
-
stencil8
'
:
{
CopyB2T
:
[
'
stencil
-
only
'
]
CopyT2B
:
[
'
stencil
-
only
'
]
texelAspectSize
:
{
'
depth
-
only
'
:
-
1
'
stencil
-
only
'
:
1
}
}
depth16unorm
:
{
CopyB2T
:
[
'
all
'
'
depth
-
only
'
]
CopyT2B
:
[
'
all
'
'
depth
-
only
'
]
texelAspectSize
:
{
'
depth
-
only
'
:
2
'
stencil
-
only
'
:
-
1
}
}
depth32float
:
{
CopyB2T
:
[
]
CopyT2B
:
[
'
all
'
'
depth
-
only
'
]
texelAspectSize
:
{
'
depth
-
only
'
:
4
'
stencil
-
only
'
:
-
1
}
}
'
depth32float
-
stencil8
'
:
{
CopyB2T
:
[
'
stencil
-
only
'
]
CopyT2B
:
[
'
depth
-
only
'
'
stencil
-
only
'
]
texelAspectSize
:
{
'
depth
-
only
'
:
4
'
stencil
-
only
'
:
1
}
}
stencil8
:
{
CopyB2T
:
[
'
all
'
'
stencil
-
only
'
]
CopyT2B
:
[
'
all
'
'
stencil
-
only
'
]
texelAspectSize
:
{
'
depth
-
only
'
:
-
1
'
stencil
-
only
'
:
1
}
}
}
as
const
;
export
const
kDepthStencilFormatResolvedAspect
:
{
readonly
[
k
in
DepthStencilFormat
]
:
{
readonly
[
a
in
GPUTextureAspect
]
:
DepthStencilFormat
|
undefined
;
}
;
}
=
{
depth24plus
:
{
all
:
'
depth24plus
'
'
depth
-
only
'
:
'
depth24plus
'
'
stencil
-
only
'
:
undefined
}
'
depth24plus
-
stencil8
'
:
{
all
:
'
depth24plus
-
stencil8
'
'
depth
-
only
'
:
'
depth24plus
'
'
stencil
-
only
'
:
'
stencil8
'
}
depth16unorm
:
{
all
:
'
depth16unorm
'
'
depth
-
only
'
:
'
depth16unorm
'
'
stencil
-
only
'
:
undefined
}
depth32float
:
{
all
:
'
depth32float
'
'
depth
-
only
'
:
'
depth32float
'
'
stencil
-
only
'
:
undefined
}
'
depth32float
-
stencil8
'
:
{
all
:
'
depth32float
-
stencil8
'
'
depth
-
only
'
:
'
depth32float
'
'
stencil
-
only
'
:
'
stencil8
'
}
stencil8
:
{
all
:
'
stencil8
'
'
depth
-
only
'
:
undefined
'
stencil
-
only
'
:
'
stencil8
'
}
}
as
const
;
export
function
resolvePerAspectFormat
(
format
:
GPUTextureFormat
aspect
?
:
GPUTextureAspect
)
:
GPUTextureFormat
{
if
(
aspect
=
=
=
'
all
'
|
|
aspect
=
=
=
undefined
)
{
return
format
;
}
assert
(
!
!
kTextureFormatInfo
[
format
]
.
depth
|
|
!
!
kTextureFormatInfo
[
format
]
.
stencil
)
;
const
resolved
=
kDepthStencilFormatResolvedAspect
[
format
as
DepthStencilFormat
]
[
aspect
?
?
'
all
'
]
;
assert
(
resolved
!
=
=
undefined
)
;
return
resolved
;
}
export
function
sampleTypeForFormatAndAspect
(
format
:
GPUTextureFormat
aspect
:
GPUTextureAspect
)
:
'
uint
'
|
'
depth
'
|
'
float
'
|
'
sint
'
|
'
unfilterable
-
float
'
{
const
info
=
kTextureFormatInfo
[
format
]
;
if
(
info
.
color
)
{
assert
(
aspect
=
=
=
'
all
'
color
format
{
format
}
used
with
aspect
{
aspect
}
)
;
return
info
.
color
.
type
;
}
else
if
(
info
.
depth
&
&
info
.
stencil
)
{
if
(
aspect
=
=
=
'
depth
-
only
'
)
{
return
info
.
depth
.
type
;
}
else
if
(
aspect
=
=
=
'
stencil
-
only
'
)
{
return
info
.
stencil
.
type
;
}
else
{
unreachable
(
depth
-
stencil
format
{
format
}
used
with
aspect
{
aspect
}
)
;
}
}
else
if
(
info
.
depth
)
{
assert
(
aspect
!
=
=
'
stencil
-
only
'
depth
-
only
format
{
format
}
used
with
aspect
{
aspect
}
)
;
return
info
.
depth
.
type
;
}
else
if
(
info
.
stencil
)
{
assert
(
aspect
!
=
=
'
depth
-
only
'
stencil
-
only
format
{
format
}
used
with
aspect
{
aspect
}
)
;
return
info
.
stencil
.
type
;
}
unreachable
(
)
;
}
export
function
depthStencilFormatCopyableAspects
(
type
:
ImageCopyType
format
:
DepthStencilFormat
)
:
readonly
GPUTextureAspect
[
]
{
const
appliedType
=
type
=
=
=
'
WriteTexture
'
?
'
CopyB2T
'
:
type
;
return
kDepthStencilFormatCapabilityInBufferTextureCopy
[
format
]
[
appliedType
]
;
}
export
function
depthStencilBufferTextureCopySupported
(
type
:
ImageCopyType
format
:
DepthStencilFormat
aspect
:
GPUTextureAspect
)
:
boolean
{
const
supportedAspects
:
readonly
GPUTextureAspect
[
]
=
depthStencilFormatCopyableAspects
(
type
format
)
;
return
supportedAspects
.
includes
(
aspect
)
;
}
export
function
depthStencilFormatAspectSize
(
format
:
DepthStencilFormat
aspect
:
'
depth
-
only
'
|
'
stencil
-
only
'
)
{
const
texelAspectSize
=
kDepthStencilFormatCapabilityInBufferTextureCopy
[
format
]
.
texelAspectSize
[
aspect
]
;
assert
(
texelAspectSize
>
0
)
;
return
texelAspectSize
;
}
export
function
textureDimensionAndFormatCompatible
(
dimension
:
undefined
|
GPUTextureDimension
format
:
GPUTextureFormat
)
:
boolean
{
const
info
=
kAllTextureFormatInfo
[
format
]
;
return
!
(
(
dimension
=
=
=
'
1d
'
|
|
dimension
=
=
=
'
3d
'
)
&
&
(
info
.
blockWidth
>
1
|
|
info
.
depth
|
|
info
.
stencil
)
)
;
}
export
function
viewCompatible
(
compatibilityMode
:
boolean
a
:
GPUTextureFormat
b
:
GPUTextureFormat
)
:
boolean
{
return
compatibilityMode
?
a
=
=
=
b
:
a
=
=
=
b
|
|
a
+
'
-
srgb
'
=
=
=
b
|
|
b
+
'
-
srgb
'
=
=
=
a
;
}
export
function
getFeaturesForFormats
<
T
>
(
formats
:
readonly
(
T
&
(
GPUTextureFormat
|
undefined
)
)
[
]
)
:
readonly
(
GPUFeatureName
|
undefined
)
[
]
{
return
Array
.
from
(
new
Set
(
formats
.
map
(
f
=
>
(
f
?
kTextureFormatInfo
[
f
]
.
feature
:
undefined
)
)
)
)
;
}
export
function
filterFormatsByFeature
<
T
>
(
feature
:
GPUFeatureName
|
undefined
formats
:
readonly
(
T
&
(
GPUTextureFormat
|
undefined
)
)
[
]
)
:
readonly
(
T
&
(
GPUTextureFormat
|
undefined
)
)
[
]
{
return
formats
.
filter
(
f
=
>
f
=
=
=
undefined
|
|
kTextureFormatInfo
[
f
]
.
feature
=
=
=
feature
)
;
}
export
function
isCompressedTextureFormat
(
format
:
GPUTextureFormat
)
{
return
format
in
kCompressedTextureFormatInfo
;
}
export
function
isDepthTextureFormat
(
format
:
GPUTextureFormat
)
{
return
!
!
kTextureFormatInfo
[
format
]
.
depth
;
}
export
function
isStencilTextureFormat
(
format
:
GPUTextureFormat
)
{
return
!
!
kTextureFormatInfo
[
format
]
.
stencil
;
}
export
function
isDepthOrStencilTextureFormat
(
format
:
GPUTextureFormat
)
{
return
isDepthTextureFormat
(
format
)
|
|
isStencilTextureFormat
(
format
)
;
}
export
function
isEncodableTextureFormat
(
format
:
GPUTextureFormat
)
{
return
kEncodableTextureFormats
.
includes
(
format
as
EncodableTextureFormat
)
;
}
export
function
canUseAsRenderTarget
(
format
:
GPUTextureFormat
)
{
return
kTextureFormatInfo
[
format
]
.
colorRender
|
|
isDepthOrStencilTextureFormat
(
format
)
;
}
export
const
kCompatModeUnsupportedStorageTextureFormats
:
readonly
GPUTextureFormat
[
]
=
[
'
rg32float
'
'
rg32sint
'
'
rg32uint
'
]
as
const
;
export
function
isTextureFormatUsableAsStorageFormat
(
format
:
GPUTextureFormat
isCompatibilityMode
:
boolean
)
:
boolean
{
if
(
isCompatibilityMode
)
{
if
(
kCompatModeUnsupportedStorageTextureFormats
.
indexOf
(
format
)
>
=
0
)
{
return
false
;
}
}
const
info
=
kTextureFormatInfo
[
format
]
;
return
!
!
(
info
.
color
?
.
storage
|
|
info
.
depth
?
.
storage
|
|
info
.
stencil
?
.
storage
)
;
}
export
function
isRegularTextureFormat
(
format
:
GPUTextureFormat
)
{
return
format
in
kRegularTextureFormatInfo
;
}
export
function
isCompressedFloatTextureFormat
(
format
:
GPUTextureFormat
)
{
return
isCompressedTextureFormat
(
format
)
&
&
format
.
includes
(
'
float
'
)
;
}
export
function
isMultisampledTextureFormat
(
format
:
GPUTextureFormat
)
:
boolean
{
return
kAllTextureFormatInfo
[
format
]
.
multisample
;
}
export
const
kFeaturesForFormats
=
getFeaturesForFormats
(
kAllTextureFormats
)
;
export
function
computeBytesPerSampleFromFormats
(
formats
:
readonly
GPUTextureFormat
[
]
)
{
let
bytesPerSample
=
0
;
for
(
const
format
of
formats
)
{
const
info
=
kTextureFormatInfo
[
format
]
;
const
alignedBytesPerSample
=
align
(
bytesPerSample
info
.
colorRender
!
.
alignment
)
;
bytesPerSample
=
alignedBytesPerSample
+
info
.
colorRender
!
.
byteCost
;
}
return
bytesPerSample
;
}
export
function
computeBytesPerSample
(
targets
:
GPUColorTargetState
[
]
)
{
return
computeBytesPerSampleFromFormats
(
targets
.
map
(
(
{
format
}
)
=
>
format
)
)
;
}
