#
ifndef
ExternalTexture_H_
#
define
ExternalTexture_H_
#
include
<
array
>
#
include
"
ObjectModel
.
h
"
#
include
"
mozilla
/
Span
.
h
"
#
include
"
mozilla
/
gfx
/
Types
.
h
"
#
include
"
mozilla
/
webgpu
/
WebGPUTypes
.
h
"
#
include
"
nsIGlobalObject
.
h
"
#
include
"
nsTArrayForwardDeclare
.
h
"
namespace
mozilla
{
namespace
dom
{
class
OwningHTMLVideoElementOrVideoFrame
;
}
namespace
layers
{
class
BufferDescriptor
;
class
Image
;
}
namespace
webgpu
{
class
Device
;
class
WebGPUParent
;
class
ExternalTexture
:
public
ObjectBase
{
public
:
GPU_DECL_CYCLE_COLLECTION
(
ExternalTexture
)
GPU_DECL_JS_WRAP
(
ExternalTexture
)
explicit
ExternalTexture
(
nsIGlobalObject
*
const
aGlobal
)
:
mGlobal
(
aGlobal
)
{
}
nsIGlobalObject
*
GetParentObject
(
)
const
{
return
mGlobal
;
}
private
:
nsCOMPtr
<
nsIGlobalObject
>
mGlobal
;
~
ExternalTexture
(
)
=
default
;
void
Cleanup
(
)
{
}
}
;
class
ExternalTextureSourceClient
{
NS_INLINE_DECL_REFCOUNTING
(
ExternalTextureSourceClient
)
public
:
static
already_AddRefed
<
ExternalTextureSourceClient
>
Create
(
Device
*
aDevice
const
dom
:
:
OwningHTMLVideoElementOrVideoFrame
&
aSource
ErrorResult
&
aRv
)
;
const
RawId
mId
;
const
std
:
:
array
<
RawId
3
>
mTextureIds
;
const
std
:
:
array
<
RawId
3
>
mViewIds
;
private
:
ExternalTextureSourceClient
(
WebGPUChild
*
aBridge
RawId
aId
const
std
:
:
array
<
RawId
3
>
&
aTextureIds
const
std
:
:
array
<
RawId
3
>
&
aViewIds
)
;
~
ExternalTextureSourceClient
(
)
;
const
WeakPtr
<
WebGPUChild
>
mBridge
;
}
;
class
ExternalTextureSourceHost
{
public
:
static
ExternalTextureSourceHost
Create
(
WebGPUParent
*
aParent
RawId
aDeviceId
RawId
aQueueId
const
ExternalTextureSourceDescriptor
&
aDesc
)
;
Span
<
const
RawId
>
TextureIds
(
)
const
{
return
mTextureIds
;
}
Span
<
const
RawId
>
ViewIds
(
)
const
{
return
mViewIds
;
}
private
:
ExternalTextureSourceHost
(
Span
<
const
RawId
>
aTextureIds
Span
<
const
RawId
>
aViewIds
gfx
:
:
IntSize
aSize
gfx
:
:
SurfaceFormat
aFormat
gfx
:
:
YUVRangedColorSpace
aColorSpace
const
std
:
:
array
<
float
6
>
&
aSampleTransform
const
std
:
:
array
<
float
6
>
&
aLoadTransform
)
;
static
ExternalTextureSourceHost
CreateFromBufferDesc
(
WebGPUParent
*
aParent
RawId
aDeviceId
RawId
aQueueId
const
ExternalTextureSourceDescriptor
&
aDesc
const
layers
:
:
BufferDescriptor
&
aSd
uint8_t
*
aBuffer
)
;
static
ExternalTextureSourceHost
CreateError
(
)
;
public
:
AutoTArray
<
RawId
3
>
mTextureIds
;
AutoTArray
<
RawId
3
>
mViewIds
;
const
gfx
:
:
IntSize
mSize
;
const
gfx
:
:
SurfaceFormat
mFormat
;
const
gfx
:
:
YUVRangedColorSpace
mColorSpace
;
const
std
:
:
array
<
float
6
>
mSampleTransform
;
const
std
:
:
array
<
float
6
>
mLoadTransform
;
}
;
}
}
#
endif
