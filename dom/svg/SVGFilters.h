#
ifndef
DOM_SVG_SVGFILTERS_H_
#
define
DOM_SVG_SVGFILTERS_H_
#
include
"
mozilla
/
Attributes
.
h
"
#
include
"
mozilla
/
dom
/
SVGElement
.
h
"
#
include
"
FilterDescription
.
h
"
#
include
"
nsImageLoadingContent
.
h
"
#
include
"
SVGAnimatedLength
.
h
"
#
include
"
SVGAnimatedNumber
.
h
"
#
include
"
SVGAnimatedNumberPair
.
h
"
#
include
"
SVGAnimatedString
.
h
"
namespace
mozilla
{
class
SVGFilterInstance
;
namespace
dom
{
struct
SVGStringInfo
{
SVGStringInfo
(
const
SVGAnimatedString
*
aString
SVGElement
*
aElement
)
:
mString
(
aString
)
mElement
(
aElement
)
{
}
const
SVGAnimatedString
*
mString
;
SVGElement
*
mElement
;
}
;
using
SVGFEBase
=
SVGElement
;
#
define
NS_SVG_FE_CID
\
{
\
0x60483958
0xd229
0x4a77
{
\
0x96
0xb2
0x62
0x3e
0x69
0x95
0x1e
0x0e
\
}
\
}
class
SVGFE
:
public
SVGFEBase
{
friend
class
mozilla
:
:
SVGFilterInstance
;
protected
:
using
SourceSurface
=
mozilla
:
:
gfx
:
:
SourceSurface
;
using
Size
=
mozilla
:
:
gfx
:
:
Size
;
using
IntRect
=
mozilla
:
:
gfx
:
:
IntRect
;
using
ColorSpace
=
mozilla
:
:
gfx
:
:
ColorSpace
;
using
FilterPrimitiveDescription
=
mozilla
:
:
gfx
:
:
FilterPrimitiveDescription
;
explicit
SVGFE
(
already_AddRefed
<
mozilla
:
:
dom
:
:
NodeInfo
>
&
&
aNodeInfo
)
:
SVGFEBase
(
std
:
:
move
(
aNodeInfo
)
)
{
}
virtual
~
SVGFE
(
)
=
default
;
public
:
using
PrimitiveAttributes
=
mozilla
:
:
gfx
:
:
PrimitiveAttributes
;
ColorSpace
GetInputColorSpace
(
int32_t
aInputIndex
ColorSpace
aUnchangedInputColorSpace
)
{
return
OperatesOnSRGB
(
aInputIndex
aUnchangedInputColorSpace
=
=
ColorSpace
:
:
SRGB
)
?
ColorSpace
:
:
SRGB
:
ColorSpace
:
:
LinearRGB
;
}
ColorSpace
GetOutputColorSpace
(
)
{
return
ProducesSRGB
(
)
?
ColorSpace
:
:
SRGB
:
ColorSpace
:
:
LinearRGB
;
}
virtual
bool
SubregionIsUnionOfRegions
(
)
{
return
true
;
}
NS_DECLARE_STATIC_IID_ACCESSOR
(
NS_SVG_FE_CID
)
NS_DECL_ISUPPORTS_INHERITED
NS_IMETHOD_
(
bool
)
IsAttributeMapped
(
const
nsAtom
*
aAttribute
)
const
override
;
nsresult
Clone
(
mozilla
:
:
dom
:
:
NodeInfo
*
nsINode
*
*
aResult
)
const
override
=
0
;
bool
HasValidDimensions
(
)
const
override
;
virtual
SVGAnimatedString
&
GetResultImageName
(
)
=
0
;
virtual
void
GetSourceImageNames
(
nsTArray
<
SVGStringInfo
>
&
aSources
)
;
virtual
FilterPrimitiveDescription
GetPrimitiveDescription
(
SVGFilterInstance
*
aInstance
const
IntRect
&
aFilterSubregion
const
nsTArray
<
bool
>
&
aInputsAreTainted
nsTArray
<
RefPtr
<
SourceSurface
>
>
&
aInputImages
)
=
0
;
virtual
bool
AttributeAffectsRendering
(
int32_t
aNameSpaceID
nsAtom
*
aAttribute
)
const
;
virtual
bool
OutputIsTainted
(
const
nsTArray
<
bool
>
&
aInputsAreTainted
nsIPrincipal
*
aReferencePrincipal
)
;
static
nsIntRect
GetMaxRect
(
)
{
return
nsIntRect
(
INT32_MIN
/
2
INT32_MIN
/
2
INT32_MAX
INT32_MAX
)
;
}
operator
nsISupports
*
(
)
{
return
static_cast
<
nsIContent
*
>
(
this
)
;
}
already_AddRefed
<
DOMSVGAnimatedLength
>
X
(
)
;
already_AddRefed
<
DOMSVGAnimatedLength
>
Y
(
)
;
already_AddRefed
<
DOMSVGAnimatedLength
>
Width
(
)
;
already_AddRefed
<
DOMSVGAnimatedLength
>
Height
(
)
;
already_AddRefed
<
DOMSVGAnimatedString
>
Result
(
)
;
protected
:
virtual
bool
OperatesOnSRGB
(
int32_t
aInputIndex
bool
aInputIsAlreadySRGB
)
{
return
StyleIsSetToSRGB
(
)
;
}
virtual
bool
ProducesSRGB
(
)
{
return
StyleIsSetToSRGB
(
)
;
}
bool
StyleIsSetToSRGB
(
)
;
LengthAttributesInfo
GetLengthInfo
(
)
override
;
Size
GetKernelUnitLength
(
SVGFilterInstance
*
aInstance
SVGAnimatedNumberPair
*
aKernelUnitLength
)
;
enum
{
ATTR_X
ATTR_Y
ATTR_WIDTH
ATTR_HEIGHT
}
;
SVGAnimatedLength
mLengthAttributes
[
4
]
;
static
LengthInfo
sLengthInfo
[
4
]
;
}
;
NS_DEFINE_STATIC_IID_ACCESSOR
(
SVGFE
NS_SVG_FE_CID
)
using
SVGFEUnstyledElementBase
=
SVGElement
;
class
SVGFEUnstyledElement
:
public
SVGFEUnstyledElementBase
{
protected
:
explicit
SVGFEUnstyledElement
(
already_AddRefed
<
mozilla
:
:
dom
:
:
NodeInfo
>
&
&
aNodeInfo
)
:
SVGFEUnstyledElementBase
(
std
:
:
move
(
aNodeInfo
)
)
{
}
public
:
nsresult
Clone
(
mozilla
:
:
dom
:
:
NodeInfo
*
nsINode
*
*
aResult
)
const
override
=
0
;
virtual
bool
AttributeAffectsRendering
(
int32_t
aNameSpaceID
nsAtom
*
aAttribute
)
const
=
0
;
}
;
using
SVGFELightingElementBase
=
SVGFE
;
class
SVGFELightingElement
:
public
SVGFELightingElementBase
{
protected
:
explicit
SVGFELightingElement
(
already_AddRefed
<
mozilla
:
:
dom
:
:
NodeInfo
>
&
&
aNodeInfo
)
:
SVGFELightingElementBase
(
std
:
:
move
(
aNodeInfo
)
)
{
}
virtual
~
SVGFELightingElement
(
)
=
default
;
public
:
NS_INLINE_DECL_REFCOUNTING_INHERITED
(
SVGFELightingElement
SVGFELightingElementBase
)
bool
AttributeAffectsRendering
(
int32_t
aNameSpaceID
nsAtom
*
aAttribute
)
const
override
;
SVGAnimatedString
&
GetResultImageName
(
)
override
{
return
mStringAttributes
[
RESULT
]
;
}
void
GetSourceImageNames
(
nsTArray
<
SVGStringInfo
>
&
aSources
)
override
;
NS_IMETHOD_
(
bool
)
IsAttributeMapped
(
const
nsAtom
*
aAttribute
)
const
override
;
protected
:
bool
OperatesOnSRGB
(
int32_t
aInputIndex
bool
aInputIsAlreadySRGB
)
override
{
return
true
;
}
NumberAttributesInfo
GetNumberInfo
(
)
override
;
NumberPairAttributesInfo
GetNumberPairInfo
(
)
override
;
StringAttributesInfo
GetStringInfo
(
)
override
;
mozilla
:
:
gfx
:
:
LightType
ComputeLightAttributes
(
SVGFilterInstance
*
aInstance
nsTArray
<
float
>
&
aFloatAttributes
)
;
bool
AddLightingAttributes
(
mozilla
:
:
gfx
:
:
DiffuseLightingAttributes
*
aAttributes
SVGFilterInstance
*
aInstance
)
;
enum
{
SURFACE_SCALE
DIFFUSE_CONSTANT
SPECULAR_CONSTANT
SPECULAR_EXPONENT
}
;
SVGAnimatedNumber
mNumberAttributes
[
4
]
;
static
NumberInfo
sNumberInfo
[
4
]
;
enum
{
KERNEL_UNIT_LENGTH
}
;
SVGAnimatedNumberPair
mNumberPairAttributes
[
1
]
;
static
NumberPairInfo
sNumberPairInfo
[
1
]
;
enum
{
RESULT
IN1
}
;
SVGAnimatedString
mStringAttributes
[
2
]
;
static
StringInfo
sStringInfo
[
2
]
;
}
;
using
SVGFELightElementBase
=
SVGFEUnstyledElement
;
class
SVGFELightElement
:
public
SVGFELightElementBase
{
protected
:
explicit
SVGFELightElement
(
already_AddRefed
<
mozilla
:
:
dom
:
:
NodeInfo
>
&
&
aNodeInfo
)
:
SVGFELightElementBase
(
std
:
:
move
(
aNodeInfo
)
)
{
}
public
:
using
PrimitiveAttributes
=
gfx
:
:
PrimitiveAttributes
;
virtual
mozilla
:
:
gfx
:
:
LightType
ComputeLightAttributes
(
SVGFilterInstance
*
aInstance
nsTArray
<
float
>
&
aFloatAttributes
)
=
0
;
}
;
}
}
#
endif
