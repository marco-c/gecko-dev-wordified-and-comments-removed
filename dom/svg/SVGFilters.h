#
ifndef
__NS_SVGFILTERSELEMENT_H__
#
define
__NS_SVGFILTERSELEMENT_H__
#
include
"
mozilla
/
Attributes
.
h
"
#
include
"
mozilla
/
dom
/
SVGElement
.
h
"
#
include
"
FilterSupport
.
h
"
#
include
"
nsImageLoadingContent
.
h
"
#
include
"
nsSVGLength2
.
h
"
#
include
"
SVGString
.
h
"
#
include
"
nsSVGNumber2
.
h
"
#
include
"
SVGNumberPair
.
h
"
class
nsSVGFilterInstance
;
namespace
mozilla
{
namespace
dom
{
struct
SVGStringInfo
{
SVGStringInfo
(
const
SVGString
*
aString
SVGElement
*
aElement
)
:
mString
(
aString
)
mElement
(
aElement
)
{
}
const
SVGString
*
mString
;
SVGElement
*
mElement
;
}
;
typedef
SVGElement
SVGFEBase
;
#
define
NS_SVG_FE_CID
\
{
\
0x60483958
0xd229
0x4a77
{
\
0x96
0xb2
0x62
0x3e
0x69
0x95
0x1e
0x0e
\
}
\
}
class
SVGFE
:
public
SVGFEBase
{
friend
class
:
:
nsSVGFilterInstance
;
protected
:
typedef
mozilla
:
:
gfx
:
:
SourceSurface
SourceSurface
;
typedef
mozilla
:
:
gfx
:
:
Size
Size
;
typedef
mozilla
:
:
gfx
:
:
IntRect
IntRect
;
typedef
mozilla
:
:
gfx
:
:
ColorSpace
ColorSpace
;
typedef
mozilla
:
:
gfx
:
:
FilterPrimitiveDescription
FilterPrimitiveDescription
;
explicit
SVGFE
(
already_AddRefed
<
mozilla
:
:
dom
:
:
NodeInfo
>
&
&
aNodeInfo
)
:
SVGFEBase
(
std
:
:
move
(
aNodeInfo
)
)
{
}
virtual
~
SVGFE
(
)
{
}
public
:
typedef
mozilla
:
:
gfx
:
:
PrimitiveAttributes
PrimitiveAttributes
;
ColorSpace
GetInputColorSpace
(
int32_t
aInputIndex
ColorSpace
aUnchangedInputColorSpace
)
{
return
OperatesOnSRGB
(
aInputIndex
aUnchangedInputColorSpace
=
=
ColorSpace
:
:
SRGB
)
?
ColorSpace
:
:
SRGB
:
ColorSpace
:
:
LinearRGB
;
}
ColorSpace
GetOutputColorSpace
(
)
{
return
ProducesSRGB
(
)
?
ColorSpace
:
:
SRGB
:
ColorSpace
:
:
LinearRGB
;
}
virtual
bool
SubregionIsUnionOfRegions
(
)
{
return
true
;
}
NS_DECLARE_STATIC_IID_ACCESSOR
(
NS_SVG_FE_CID
)
NS_DECL_ISUPPORTS_INHERITED
NS_IMETHOD_
(
bool
)
IsAttributeMapped
(
const
nsAtom
*
aAttribute
)
const
override
;
virtual
nsresult
Clone
(
mozilla
:
:
dom
:
:
NodeInfo
*
nsINode
*
*
aResult
)
const
override
=
0
;
virtual
bool
HasValidDimensions
(
)
const
override
;
bool
IsNodeOfType
(
uint32_t
aFlags
)
const
override
{
return
!
(
aFlags
&
~
eFILTER
)
;
}
virtual
SVGString
&
GetResultImageName
(
)
=
0
;
virtual
void
GetSourceImageNames
(
nsTArray
<
SVGStringInfo
>
&
aSources
)
;
virtual
FilterPrimitiveDescription
GetPrimitiveDescription
(
nsSVGFilterInstance
*
aInstance
const
IntRect
&
aFilterSubregion
const
nsTArray
<
bool
>
&
aInputsAreTainted
nsTArray
<
RefPtr
<
SourceSurface
>
>
&
aInputImages
)
=
0
;
virtual
bool
AttributeAffectsRendering
(
int32_t
aNameSpaceID
nsAtom
*
aAttribute
)
const
;
virtual
bool
OutputIsTainted
(
const
nsTArray
<
bool
>
&
aInputsAreTainted
nsIPrincipal
*
aReferencePrincipal
)
;
static
nsIntRect
GetMaxRect
(
)
{
return
nsIntRect
(
INT32_MIN
/
2
INT32_MIN
/
2
INT32_MAX
INT32_MAX
)
;
}
operator
nsISupports
*
(
)
{
return
static_cast
<
nsIContent
*
>
(
this
)
;
}
already_AddRefed
<
mozilla
:
:
dom
:
:
DOMSVGAnimatedLength
>
X
(
)
;
already_AddRefed
<
mozilla
:
:
dom
:
:
DOMSVGAnimatedLength
>
Y
(
)
;
already_AddRefed
<
mozilla
:
:
dom
:
:
DOMSVGAnimatedLength
>
Width
(
)
;
already_AddRefed
<
mozilla
:
:
dom
:
:
DOMSVGAnimatedLength
>
Height
(
)
;
already_AddRefed
<
mozilla
:
:
dom
:
:
DOMSVGAnimatedString
>
Result
(
)
;
protected
:
virtual
bool
OperatesOnSRGB
(
int32_t
aInputIndex
bool
aInputIsAlreadySRGB
)
{
return
StyleIsSetToSRGB
(
)
;
}
virtual
bool
ProducesSRGB
(
)
{
return
StyleIsSetToSRGB
(
)
;
}
bool
StyleIsSetToSRGB
(
)
;
virtual
LengthAttributesInfo
GetLengthInfo
(
)
override
;
Size
GetKernelUnitLength
(
nsSVGFilterInstance
*
aInstance
SVGNumberPair
*
aKernelUnitLength
)
;
enum
{
ATTR_X
ATTR_Y
ATTR_WIDTH
ATTR_HEIGHT
}
;
nsSVGLength2
mLengthAttributes
[
4
]
;
static
LengthInfo
sLengthInfo
[
4
]
;
}
;
NS_DEFINE_STATIC_IID_ACCESSOR
(
SVGFE
NS_SVG_FE_CID
)
typedef
SVGElement
SVGFEUnstyledElementBase
;
class
SVGFEUnstyledElement
:
public
SVGFEUnstyledElementBase
{
protected
:
explicit
SVGFEUnstyledElement
(
already_AddRefed
<
mozilla
:
:
dom
:
:
NodeInfo
>
&
&
aNodeInfo
)
:
SVGFEUnstyledElementBase
(
std
:
:
move
(
aNodeInfo
)
)
{
}
public
:
virtual
nsresult
Clone
(
mozilla
:
:
dom
:
:
NodeInfo
*
nsINode
*
*
aResult
)
const
override
=
0
;
virtual
bool
AttributeAffectsRendering
(
int32_t
aNameSpaceID
nsAtom
*
aAttribute
)
const
=
0
;
}
;
typedef
SVGFE
SVGFELightingElementBase
;
class
SVGFELightingElement
:
public
SVGFELightingElementBase
{
protected
:
explicit
SVGFELightingElement
(
already_AddRefed
<
mozilla
:
:
dom
:
:
NodeInfo
>
&
&
aNodeInfo
)
:
SVGFELightingElementBase
(
std
:
:
move
(
aNodeInfo
)
)
{
}
virtual
~
SVGFELightingElement
(
)
{
}
public
:
NS_INLINE_DECL_REFCOUNTING_INHERITED
(
SVGFELightingElement
SVGFELightingElementBase
)
virtual
bool
AttributeAffectsRendering
(
int32_t
aNameSpaceID
nsAtom
*
aAttribute
)
const
override
;
virtual
SVGString
&
GetResultImageName
(
)
override
{
return
mStringAttributes
[
RESULT
]
;
}
virtual
void
GetSourceImageNames
(
nsTArray
<
SVGStringInfo
>
&
aSources
)
override
;
NS_IMETHOD_
(
bool
)
IsAttributeMapped
(
const
nsAtom
*
aAttribute
)
const
override
;
protected
:
virtual
bool
OperatesOnSRGB
(
int32_t
aInputIndex
bool
aInputIsAlreadySRGB
)
override
{
return
true
;
}
virtual
NumberAttributesInfo
GetNumberInfo
(
)
override
;
virtual
NumberPairAttributesInfo
GetNumberPairInfo
(
)
override
;
virtual
StringAttributesInfo
GetStringInfo
(
)
override
;
mozilla
:
:
gfx
:
:
LightType
ComputeLightAttributes
(
nsSVGFilterInstance
*
aInstance
nsTArray
<
float
>
&
aFloatAttributes
)
;
bool
AddLightingAttributes
(
mozilla
:
:
gfx
:
:
DiffuseLightingAttributes
*
aAttributes
nsSVGFilterInstance
*
aInstance
)
;
enum
{
SURFACE_SCALE
DIFFUSE_CONSTANT
SPECULAR_CONSTANT
SPECULAR_EXPONENT
}
;
nsSVGNumber2
mNumberAttributes
[
4
]
;
static
NumberInfo
sNumberInfo
[
4
]
;
enum
{
KERNEL_UNIT_LENGTH
}
;
SVGNumberPair
mNumberPairAttributes
[
1
]
;
static
NumberPairInfo
sNumberPairInfo
[
1
]
;
enum
{
RESULT
IN1
}
;
SVGString
mStringAttributes
[
2
]
;
static
StringInfo
sStringInfo
[
2
]
;
}
;
typedef
SVGFEUnstyledElement
SVGFELightElementBase
;
class
SVGFELightElement
:
public
SVGFELightElementBase
{
protected
:
explicit
SVGFELightElement
(
already_AddRefed
<
mozilla
:
:
dom
:
:
NodeInfo
>
&
&
aNodeInfo
)
:
SVGFELightElementBase
(
std
:
:
move
(
aNodeInfo
)
)
{
}
public
:
typedef
gfx
:
:
PrimitiveAttributes
PrimitiveAttributes
;
virtual
mozilla
:
:
gfx
:
:
LightType
ComputeLightAttributes
(
nsSVGFilterInstance
*
aInstance
nsTArray
<
float
>
&
aFloatAttributes
)
=
0
;
}
;
}
}
#
endif
