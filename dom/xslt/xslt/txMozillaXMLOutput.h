#
ifndef
TRANSFRMX_MOZILLA_XML_OUTPUT_H
#
define
TRANSFRMX_MOZILLA_XML_OUTPUT_H
#
include
"
mozilla
/
Attributes
.
h
"
#
include
"
nsCOMPtr
.
h
"
#
include
"
nsICSSLoaderObserver
.
h
"
#
include
"
nsIScriptLoaderObserver
.
h
"
#
include
"
nsTArray
.
h
"
#
include
"
txOutputFormat
.
h
"
#
include
"
txStack
.
h
"
#
include
"
txXMLEventHandler
.
h
"
class
nsIContent
;
class
nsAtom
;
class
nsITransformObserver
;
class
nsNodeInfoManager
;
class
nsINode
;
namespace
mozilla
:
:
dom
{
class
Document
;
class
DocumentFragment
;
class
Element
;
}
class
txTransformNotifier
final
:
public
nsIScriptLoaderObserver
public
nsICSSLoaderObserver
{
public
:
explicit
txTransformNotifier
(
mozilla
:
:
dom
:
:
Document
*
aSourceDocument
)
;
NS_DECL_ISUPPORTS
NS_DECL_NSISCRIPTLOADEROBSERVER
NS_IMETHOD
StyleSheetLoaded
(
mozilla
:
:
StyleSheet
*
aSheet
bool
aWasDeferred
nsresult
aStatus
)
override
;
void
Init
(
nsITransformObserver
*
aObserver
)
;
void
AddScriptElement
(
nsIScriptElement
*
aElement
)
;
void
AddPendingStylesheet
(
)
;
void
OnTransformEnd
(
nsresult
aResult
=
NS_OK
)
;
void
OnTransformStart
(
)
;
nsresult
SetOutputDocument
(
mozilla
:
:
dom
:
:
Document
*
aDocument
)
;
private
:
~
txTransformNotifier
(
)
;
void
SignalTransformEnd
(
nsresult
aResult
=
NS_OK
)
;
nsCOMPtr
<
mozilla
:
:
dom
:
:
Document
>
mSourceDocument
;
nsCOMPtr
<
mozilla
:
:
dom
:
:
Document
>
mDocument
;
nsCOMPtr
<
nsITransformObserver
>
mObserver
;
nsTArray
<
nsCOMPtr
<
nsIScriptElement
>
>
mScriptElements
;
uint32_t
mPendingStylesheetCount
;
bool
mInTransform
;
}
;
class
txMozillaXMLOutput
:
public
txAOutputXMLEventHandler
{
public
:
txMozillaXMLOutput
(
mozilla
:
:
dom
:
:
Document
*
aSourceDocument
txOutputFormat
*
aFormat
nsITransformObserver
*
aObserver
)
;
txMozillaXMLOutput
(
txOutputFormat
*
aFormat
mozilla
:
:
dom
:
:
DocumentFragment
*
aFragment
bool
aNoFixup
)
;
~
txMozillaXMLOutput
(
)
;
TX_DECL_TXAXMLEVENTHANDLER
TX_DECL_TXAOUTPUTXMLEVENTHANDLER
nsresult
closePrevious
(
bool
aFlushText
)
;
nsresult
createResultDocument
(
const
nsAString
&
aName
int32_t
aNsID
mozilla
:
:
dom
:
:
Document
*
aSourceDocument
bool
aLoadedAsData
)
;
private
:
nsresult
createTxWrapper
(
)
;
nsresult
startHTMLElement
(
nsIContent
*
aElement
bool
aXHTML
)
;
void
endHTMLElement
(
nsIContent
*
aElement
)
;
nsresult
createHTMLElement
(
nsAtom
*
aName
mozilla
:
:
dom
:
:
Element
*
*
aResult
)
;
nsresult
attributeInternal
(
nsAtom
*
aPrefix
nsAtom
*
aLocalName
int32_t
aNsID
const
nsString
&
aValue
)
;
nsresult
startElementInternal
(
nsAtom
*
aPrefix
nsAtom
*
aLocalName
int32_t
aNsID
)
;
RefPtr
<
mozilla
:
:
dom
:
:
Document
>
mDocument
;
nsCOMPtr
<
nsINode
>
mCurrentNode
;
nsCOMPtr
<
mozilla
:
:
dom
:
:
Element
>
mOpenedElement
;
RefPtr
<
nsNodeInfoManager
>
mNodeInfoManager
;
nsTArray
<
nsCOMPtr
<
nsINode
>
>
mCurrentNodeStack
;
nsCOMPtr
<
nsIContent
>
mNonAddedNode
;
RefPtr
<
txTransformNotifier
>
mNotifier
;
uint32_t
mTreeDepth
mBadChildLevel
;
txStack
mTableStateStack
;
enum
TableState
{
NORMAL
TABLE
ADDED_TBODY
}
;
TableState
mTableState
;
nsAutoString
mText
;
txOutputFormat
mOutputFormat
;
bool
mCreatingNewDocument
;
bool
mOpenedElementIsHTML
;
bool
mRootContentCreated
;
bool
mNoFixup
;
enum
txAction
{
eCloseElement
=
1
eFlushText
=
2
}
;
}
;
#
endif
