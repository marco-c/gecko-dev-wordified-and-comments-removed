#
ifndef
mozilla_dom_AnimationTimeline_h
#
define
mozilla_dom_AnimationTimeline_h
#
include
"
nsISupports
.
h
"
#
include
"
nsWrapperCache
.
h
"
#
include
"
nsCycleCollectionParticipant
.
h
"
#
include
"
js
/
TypeDecls
.
h
"
#
include
"
mozilla
/
AnimationUtils
.
h
"
#
include
"
mozilla
/
Attributes
.
h
"
#
include
"
nsHashKeys
.
h
"
#
include
"
nsIGlobalObject
.
h
"
#
include
"
nsTHashtable
.
h
"
#
ifdef
GetCurrentTime
#
undef
GetCurrentTime
#
endif
class
nsIDocument
;
namespace
mozilla
{
namespace
dom
{
class
Animation
;
class
AnimationTimeline
:
public
nsISupports
public
nsWrapperCache
{
public
:
explicit
AnimationTimeline
(
nsIGlobalObject
*
aWindow
)
:
mWindow
(
aWindow
)
{
MOZ_ASSERT
(
mWindow
)
;
}
protected
:
virtual
~
AnimationTimeline
(
)
{
mAnimationOrder
.
clear
(
)
;
}
public
:
NS_DECL_CYCLE_COLLECTING_ISUPPORTS
NS_DECL_CYCLE_COLLECTION_SCRIPT_HOLDER_CLASS
(
AnimationTimeline
)
nsIGlobalObject
*
GetParentObject
(
)
const
{
return
mWindow
;
}
virtual
Nullable
<
TimeDuration
>
GetCurrentTime
(
)
const
=
0
;
Nullable
<
double
>
GetCurrentTimeAsDouble
(
)
const
{
return
AnimationUtils
:
:
TimeDurationToDouble
(
GetCurrentTime
(
)
)
;
}
TimeStamp
GetCurrentTimeAsTimeStamp
(
)
const
{
Nullable
<
TimeDuration
>
currentTime
=
GetCurrentTime
(
)
;
return
!
currentTime
.
IsNull
(
)
?
ToTimeStamp
(
currentTime
.
Value
(
)
)
:
TimeStamp
(
)
;
}
virtual
bool
TracksWallclockTime
(
)
const
=
0
;
virtual
Nullable
<
TimeDuration
>
ToTimelineTime
(
const
TimeStamp
&
aTimeStamp
)
const
=
0
;
virtual
TimeStamp
ToTimeStamp
(
const
TimeDuration
&
aTimelineTime
)
const
=
0
;
virtual
void
NotifyAnimationUpdated
(
Animation
&
aAnimation
)
;
bool
HasAnimations
(
)
const
{
return
!
mAnimations
.
IsEmpty
(
)
;
}
virtual
void
RemoveAnimation
(
Animation
*
aAnimation
)
;
virtual
nsIDocument
*
GetDocument
(
)
const
=
0
;
protected
:
nsCOMPtr
<
nsIGlobalObject
>
mWindow
;
typedef
nsTHashtable
<
nsRefPtrHashKey
<
dom
:
:
Animation
>
>
AnimationSet
;
AnimationSet
mAnimations
;
LinkedList
<
dom
:
:
Animation
>
mAnimationOrder
;
}
;
}
}
#
endif
