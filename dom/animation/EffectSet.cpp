#
include
"
EffectSet
.
h
"
#
include
"
mozilla
/
dom
/
Element
.
h
"
namespace
mozilla
{
void
EffectSet
:
:
PropertyDtor
(
void
*
aObject
nsIAtom
*
aPropertyName
void
*
aPropertyValue
void
*
aData
)
{
EffectSet
*
effectSet
=
static_cast
<
EffectSet
*
>
(
aPropertyValue
)
;
#
ifdef
DEBUG
MOZ_ASSERT
(
!
effectSet
-
>
mCalledPropertyDtor
"
Should
not
call
dtor
twice
"
)
;
effectSet
-
>
mCalledPropertyDtor
=
true
;
#
endif
delete
effectSet
;
}
EffectSet
*
EffectSet
:
:
GetEffectSet
(
dom
:
:
Element
*
aElement
nsCSSPseudoElements
:
:
Type
aPseudoType
)
{
nsIAtom
*
propName
=
GetEffectSetPropertyAtom
(
aPseudoType
)
;
return
static_cast
<
EffectSet
*
>
(
aElement
-
>
GetProperty
(
propName
)
)
;
}
EffectSet
*
EffectSet
:
:
GetOrCreateEffectSet
(
dom
:
:
Element
*
aElement
nsCSSPseudoElements
:
:
Type
aPseudoType
)
{
EffectSet
*
effectSet
=
GetEffectSet
(
aElement
aPseudoType
)
;
if
(
effectSet
)
{
return
effectSet
;
}
nsIAtom
*
propName
=
GetEffectSetPropertyAtom
(
aPseudoType
)
;
effectSet
=
new
EffectSet
(
)
;
nsresult
rv
=
aElement
-
>
SetProperty
(
propName
effectSet
&
EffectSet
:
:
PropertyDtor
false
)
;
if
(
NS_FAILED
(
rv
)
)
{
NS_WARNING
(
"
SetProperty
failed
"
)
;
EffectSet
:
:
PropertyDtor
(
aElement
propName
effectSet
nullptr
)
;
return
nullptr
;
}
if
(
aPseudoType
=
=
nsCSSPseudoElements
:
:
ePseudo_NotPseudoElement
)
{
aElement
-
>
SetMayHaveAnimations
(
)
;
}
return
effectSet
;
}
nsIAtom
*
EffectSet
:
:
GetEffectSetPropertyAtom
(
nsCSSPseudoElements
:
:
Type
aPseudoType
)
{
switch
(
aPseudoType
)
{
case
nsCSSPseudoElements
:
:
ePseudo_NotPseudoElement
:
return
nsGkAtoms
:
:
animationEffectsProperty
;
case
nsCSSPseudoElements
:
:
ePseudo_before
:
return
nsGkAtoms
:
:
animationEffectsForBeforeProperty
;
case
nsCSSPseudoElements
:
:
ePseudo_after
:
return
nsGkAtoms
:
:
animationEffectsForAfterProperty
;
default
:
NS_NOTREACHED
(
"
Should
not
try
to
get
animation
effects
for
a
pseudo
"
"
other
that
:
before
or
:
after
"
)
;
return
nullptr
;
}
}
void
EffectSet
:
:
AddEffect
(
dom
:
:
KeyframeEffectReadOnly
&
aEffect
)
{
mEffects
.
PutEntry
(
&
aEffect
)
;
}
void
EffectSet
:
:
RemoveEffect
(
dom
:
:
KeyframeEffectReadOnly
&
aEffect
)
{
mEffects
.
RemoveEntry
(
&
aEffect
)
;
}
}
