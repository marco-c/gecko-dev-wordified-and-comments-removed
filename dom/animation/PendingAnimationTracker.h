#
ifndef
mozilla_dom_PendingAnimationTracker_h
#
define
mozilla_dom_PendingAnimationTracker_h
#
include
"
mozilla
/
dom
/
Animation
.
h
"
#
include
"
mozilla
/
TypedEnumBits
.
h
"
#
include
"
nsCycleCollectionParticipant
.
h
"
#
include
"
nsTHashtable
.
h
"
class
nsIFrame
;
namespace
mozilla
{
namespace
dom
{
class
Document
;
}
class
PendingAnimationTracker
final
{
public
:
explicit
PendingAnimationTracker
(
dom
:
:
Document
*
aDocument
)
;
NS_INLINE_DECL_CYCLE_COLLECTING_NATIVE_REFCOUNTING
(
PendingAnimationTracker
)
NS_DECL_CYCLE_COLLECTION_NATIVE_CLASS
(
PendingAnimationTracker
)
void
AddPlayPending
(
dom
:
:
Animation
&
aAnimation
)
{
AddPending
(
aAnimation
mPlayPendingSet
)
;
mHasPlayPendingGeometricAnimations
=
CheckState
:
:
Indeterminate
;
}
void
RemovePlayPending
(
dom
:
:
Animation
&
aAnimation
)
{
RemovePending
(
aAnimation
mPlayPendingSet
)
;
mHasPlayPendingGeometricAnimations
=
CheckState
:
:
Indeterminate
;
}
bool
IsWaitingToPlay
(
const
dom
:
:
Animation
&
aAnimation
)
const
{
return
IsWaiting
(
aAnimation
mPlayPendingSet
)
;
}
void
AddPausePending
(
dom
:
:
Animation
&
aAnimation
)
{
AddPending
(
aAnimation
mPausePendingSet
)
;
}
void
RemovePausePending
(
dom
:
:
Animation
&
aAnimation
)
{
RemovePending
(
aAnimation
mPausePendingSet
)
;
}
bool
IsWaitingToPause
(
const
dom
:
:
Animation
&
aAnimation
)
const
{
return
IsWaiting
(
aAnimation
mPausePendingSet
)
;
}
void
TriggerPendingAnimationsOnNextTick
(
const
TimeStamp
&
aReadyTime
)
;
void
TriggerPendingAnimationsNow
(
)
;
bool
HasPendingAnimations
(
)
const
{
return
mPlayPendingSet
.
Count
(
)
>
0
|
|
mPausePendingSet
.
Count
(
)
>
0
;
}
void
MarkAnimationsThatMightNeedSynchronization
(
)
;
private
:
~
PendingAnimationTracker
(
)
=
default
;
void
EnsurePaintIsScheduled
(
)
;
typedef
nsTHashtable
<
nsRefPtrHashKey
<
dom
:
:
Animation
>
>
AnimationSet
;
void
AddPending
(
dom
:
:
Animation
&
aAnimation
AnimationSet
&
aSet
)
;
void
RemovePending
(
dom
:
:
Animation
&
aAnimation
AnimationSet
&
aSet
)
;
bool
IsWaiting
(
const
dom
:
:
Animation
&
aAnimation
const
AnimationSet
&
aSet
)
const
;
AnimationSet
mPlayPendingSet
;
AnimationSet
mPausePendingSet
;
RefPtr
<
dom
:
:
Document
>
mDocument
;
public
:
enum
class
CheckState
{
Indeterminate
=
0
Absent
=
1
<
<
0
AnimationsPresent
=
1
<
<
1
TransitionsPresent
=
1
<
<
2
}
;
private
:
CheckState
mHasPlayPendingGeometricAnimations
=
CheckState
:
:
Indeterminate
;
}
;
MOZ_MAKE_ENUM_CLASS_BITWISE_OPERATORS
(
PendingAnimationTracker
:
:
CheckState
)
}
#
endif
