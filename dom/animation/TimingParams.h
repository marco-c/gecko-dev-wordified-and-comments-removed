#
ifndef
mozilla_TimingParams_h
#
define
mozilla_TimingParams_h
#
include
"
nsStringFwd
.
h
"
#
include
"
mozilla
/
dom
/
Nullable
.
h
"
#
include
"
mozilla
/
dom
/
UnionTypes
.
h
"
#
include
"
mozilla
/
ComputedTimingFunction
.
h
"
#
include
"
mozilla
/
Maybe
.
h
"
#
include
"
mozilla
/
StickyTimeDuration
.
h
"
#
include
"
mozilla
/
TimeStamp
.
h
"
#
ifdef
None
#
undef
None
#
endif
#
include
"
mozilla
/
dom
/
AnimationEffectReadOnlyBinding
.
h
"
class
nsIDocument
;
namespace
mozilla
{
namespace
dom
{
class
UnrestrictedDoubleOrKeyframeEffectOptions
;
class
UnrestrictedDoubleOrKeyframeAnimationOptions
;
}
struct
TimingParams
{
TimingParams
(
)
=
default
;
static
TimingParams
FromOptionsUnion
(
const
dom
:
:
UnrestrictedDoubleOrKeyframeEffectOptions
&
aOptions
nsIDocument
*
aDocument
ErrorResult
&
aRv
)
;
static
TimingParams
FromOptionsUnion
(
const
dom
:
:
UnrestrictedDoubleOrKeyframeAnimationOptions
&
aOptions
nsIDocument
*
aDocument
ErrorResult
&
aRv
)
;
template
<
class
DoubleOrString
>
static
Maybe
<
StickyTimeDuration
>
ParseDuration
(
DoubleOrString
&
aDuration
ErrorResult
&
aRv
)
{
Maybe
<
StickyTimeDuration
>
result
;
if
(
aDuration
.
IsUnrestrictedDouble
(
)
)
{
double
durationInMs
=
aDuration
.
GetAsUnrestrictedDouble
(
)
;
if
(
durationInMs
>
=
0
)
{
result
.
emplace
(
StickyTimeDuration
:
:
FromMilliseconds
(
durationInMs
)
)
;
}
else
{
aRv
.
ThrowTypeError
<
dom
:
:
MSG_ENFORCE_RANGE_OUT_OF_RANGE
>
(
NS_LITERAL_STRING
(
"
duration
"
)
)
;
}
}
else
if
(
!
aDuration
.
GetAsString
(
)
.
EqualsLiteral
(
"
auto
"
)
)
{
aRv
.
ThrowTypeError
<
dom
:
:
MSG_INVALID_DURATION_ERROR
>
(
aDuration
.
GetAsString
(
)
)
;
}
return
result
;
}
static
void
ValidateIterationStart
(
double
aIterationStart
ErrorResult
&
aRv
)
{
if
(
aIterationStart
<
0
)
{
aRv
.
ThrowTypeError
<
dom
:
:
MSG_ENFORCE_RANGE_OUT_OF_RANGE
>
(
NS_LITERAL_STRING
(
"
iterationStart
"
)
)
;
}
}
static
void
ValidateIterations
(
double
aIterations
ErrorResult
&
aRv
)
{
if
(
IsNaN
(
aIterations
)
|
|
aIterations
<
0
)
{
aRv
.
ThrowTypeError
<
dom
:
:
MSG_ENFORCE_RANGE_OUT_OF_RANGE
>
(
NS_LITERAL_STRING
(
"
iterations
"
)
)
;
}
}
static
Maybe
<
ComputedTimingFunction
>
ParseEasing
(
const
nsAString
&
aEasing
nsIDocument
*
aDocument
ErrorResult
&
aRv
)
;
Maybe
<
StickyTimeDuration
>
mDuration
;
TimeDuration
mDelay
;
TimeDuration
mEndDelay
;
double
mIterations
=
1
.
0
;
double
mIterationStart
=
0
.
0
;
dom
:
:
PlaybackDirection
mDirection
=
dom
:
:
PlaybackDirection
:
:
Normal
;
dom
:
:
FillMode
mFill
=
dom
:
:
FillMode
:
:
Auto
;
Maybe
<
ComputedTimingFunction
>
mFunction
;
bool
operator
=
=
(
const
TimingParams
&
aOther
)
const
;
bool
operator
!
=
(
const
TimingParams
&
aOther
)
const
{
return
!
(
*
this
=
=
aOther
)
;
}
}
;
}
#
endif
