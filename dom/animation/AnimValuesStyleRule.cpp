#
include
"
AnimValuesStyleRule
.
h
"
#
include
"
mozilla
/
GeckoStyleContext
.
h
"
#
include
"
nsRuleData
.
h
"
namespace
mozilla
{
NS_IMPL_ISUPPORTS
(
AnimValuesStyleRule
nsIStyleRule
)
void
AnimValuesStyleRule
:
:
MapRuleInfoInto
(
nsRuleData
*
aRuleData
)
{
GeckoStyleContext
*
contextParent
=
aRuleData
-
>
mStyleContext
-
>
GetParent
(
)
;
if
(
contextParent
&
&
contextParent
-
>
HasPseudoElementData
(
)
)
{
aRuleData
-
>
mConditions
.
SetUncacheable
(
)
;
return
;
}
for
(
auto
iter
=
mAnimationValues
.
ConstIter
(
)
;
!
iter
.
Done
(
)
;
iter
.
Next
(
)
)
{
nsCSSPropertyID
property
=
static_cast
<
nsCSSPropertyID
>
(
iter
.
Key
(
)
)
;
if
(
aRuleData
-
>
mSIDs
&
nsCachedStyleData
:
:
GetBitForSID
(
nsCSSProps
:
:
kSIDTable
[
property
]
)
)
{
nsCSSValue
*
prop
=
aRuleData
-
>
ValueFor
(
property
)
;
if
(
prop
-
>
GetUnit
(
)
=
=
eCSSUnit_Null
)
{
DebugOnly
<
bool
>
ok
=
StyleAnimationValue
:
:
UncomputeValue
(
property
iter
.
Data
(
)
*
prop
)
;
MOZ_ASSERT
(
ok
"
could
not
store
computed
value
"
)
;
}
}
}
}
bool
AnimValuesStyleRule
:
:
MightMapInheritedStyleData
(
)
{
return
mStyleBits
&
NS_STYLE_INHERITED_STRUCT_MASK
;
}
bool
AnimValuesStyleRule
:
:
GetDiscretelyAnimatedCSSValue
(
nsCSSPropertyID
aProperty
nsCSSValue
*
aValue
)
{
MOZ_ASSERT
(
false
"
GetDiscretelyAnimatedCSSValue
is
not
implemented
yet
"
)
;
return
false
;
}
void
AnimValuesStyleRule
:
:
AddValue
(
nsCSSPropertyID
aProperty
const
StyleAnimationValue
&
aValue
)
{
MOZ_ASSERT
(
aProperty
!
=
eCSSProperty_UNKNOWN
"
Unexpected
css
property
"
)
;
mAnimationValues
.
Put
(
aProperty
aValue
)
;
mStyleBits
|
=
nsCachedStyleData
:
:
GetBitForSID
(
nsCSSProps
:
:
kSIDTable
[
aProperty
]
)
;
}
void
AnimValuesStyleRule
:
:
AddValue
(
nsCSSPropertyID
aProperty
StyleAnimationValue
&
&
aValue
)
{
MOZ_ASSERT
(
aProperty
!
=
eCSSProperty_UNKNOWN
"
Unexpected
css
property
"
)
;
mAnimationValues
.
Put
(
aProperty
Move
(
aValue
)
)
;
mStyleBits
|
=
nsCachedStyleData
:
:
GetBitForSID
(
nsCSSProps
:
:
kSIDTable
[
aProperty
]
)
;
}
bool
AnimValuesStyleRule
:
:
GetValue
(
nsCSSPropertyID
aProperty
StyleAnimationValue
&
aValue
)
const
{
return
mAnimationValues
.
Get
(
aProperty
&
aValue
)
;
}
#
ifdef
DEBUG
void
AnimValuesStyleRule
:
:
List
(
FILE
*
out
int32_t
aIndent
)
const
{
nsAutoCString
str
;
for
(
int32_t
index
=
aIndent
;
-
-
index
>
=
0
;
)
{
str
.
AppendLiteral
(
"
"
)
;
}
str
.
AppendLiteral
(
"
[
anim
values
]
{
"
)
;
for
(
auto
iter
=
mAnimationValues
.
ConstIter
(
)
;
!
iter
.
Done
(
)
;
iter
.
Next
(
)
)
{
nsCSSPropertyID
property
=
static_cast
<
nsCSSPropertyID
>
(
iter
.
Key
(
)
)
;
str
.
Append
(
nsCSSProps
:
:
GetStringValue
(
property
)
)
;
str
.
AppendLiteral
(
"
:
"
)
;
nsAutoString
value
;
Unused
<
<
StyleAnimationValue
:
:
UncomputeValue
(
property
iter
.
Data
(
)
value
)
;
AppendUTF16toUTF8
(
value
str
)
;
str
.
AppendLiteral
(
"
;
"
)
;
}
str
.
AppendLiteral
(
"
}
\
n
"
)
;
fprintf_stderr
(
out
"
%
s
"
str
.
get
(
)
)
;
}
#
endif
}
