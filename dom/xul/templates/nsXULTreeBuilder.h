#
ifndef
nsXULTreeBuilder_h__
#
define
nsXULTreeBuilder_h__
#
include
"
nsCOMPtr
.
h
"
#
include
"
nsITreeView
.
h
"
#
include
"
nsTreeRows
.
h
"
#
include
"
nsXULTemplateBuilder
.
h
"
class
nsIContent
;
class
nsIRDFResource
;
class
nsITreeSelection
;
class
nsIXULStore
;
class
nsIXULTemplateResult
;
class
nsTreeColumn
;
namespace
mozilla
{
namespace
dom
{
class
DataTransfer
;
class
TreeBoxObject
;
class
XULTreeBuilderObserver
;
}
}
class
nsXULTreeBuilder
:
public
nsXULTemplateBuilder
public
nsIXULTreeBuilder
public
nsINativeTreeView
{
public
:
explicit
nsXULTreeBuilder
(
Element
*
aElement
)
;
NS_DECL_ISUPPORTS_INHERITED
NS_DECL_CYCLE_COLLECTION_CLASS_INHERITED
(
nsXULTreeBuilder
nsXULTemplateBuilder
)
virtual
JSObject
*
WrapObject
(
JSContext
*
aCx
JS
:
:
Handle
<
JSObject
*
>
aGivenProto
)
override
;
already_AddRefed
<
nsIRDFResource
>
GetResourceAtIndex
(
int32_t
aIndex
mozilla
:
:
ErrorResult
&
aError
)
;
int32_t
GetIndexOfResource
(
nsIRDFResource
*
aResource
mozilla
:
:
ErrorResult
&
aError
)
;
void
AddObserver
(
mozilla
:
:
dom
:
:
XULTreeBuilderObserver
&
aObserver
)
;
void
RemoveObserver
(
mozilla
:
:
dom
:
:
XULTreeBuilderObserver
&
aObserver
)
;
void
Sort
(
Element
&
)
;
int32_t
RowCount
(
)
{
return
mRows
.
Count
(
)
;
}
nsITreeSelection
*
GetSelection
(
)
{
return
mSelection
;
}
void
SetSelection
(
nsITreeSelection
*
aSelection
mozilla
:
:
ErrorResult
&
aError
)
;
void
GetRowProperties
(
int32_t
aRow
nsAString
&
aProperties
mozilla
:
:
ErrorResult
&
aError
)
;
void
GetCellProperties
(
int32_t
aRow
nsTreeColumn
&
aColumn
nsAString
&
aProperties
mozilla
:
:
ErrorResult
&
aError
)
;
void
GetColumnProperties
(
nsTreeColumn
&
aColumn
nsAString
&
aProperties
)
{
}
bool
IsContainer
(
int32_t
aRow
mozilla
:
:
ErrorResult
&
aError
)
;
bool
IsContainerOpen
(
int32_t
aRow
mozilla
:
:
ErrorResult
&
aError
)
;
bool
IsContainerEmpty
(
int32_t
aRow
mozilla
:
:
ErrorResult
&
aError
)
;
bool
IsSeparator
(
int32_t
aRow
mozilla
:
:
ErrorResult
&
aError
)
;
bool
IsSorted
(
)
{
return
mSortVariable
!
=
nullptr
;
}
bool
CanDrop
(
int32_t
aRow
int32_t
aOrientation
mozilla
:
:
dom
:
:
DataTransfer
*
aDataTransfer
mozilla
:
:
ErrorResult
&
aError
)
;
void
Drop
(
int32_t
aRow
int32_t
aOrientation
mozilla
:
:
dom
:
:
DataTransfer
*
aDataTransfer
mozilla
:
:
ErrorResult
&
aError
)
;
int32_t
GetParentIndex
(
int32_t
aRow
mozilla
:
:
ErrorResult
&
aError
)
;
bool
HasNextSibling
(
int32_t
aRow
int32_t
aAfterIndex
mozilla
:
:
ErrorResult
&
aError
)
;
int32_t
GetLevel
(
int32_t
aRow
mozilla
:
:
ErrorResult
&
aError
)
;
void
GetImageSrc
(
int32_t
aRow
nsTreeColumn
&
aColumn
nsAString
&
aSrc
mozilla
:
:
ErrorResult
&
aError
)
;
int32_t
GetProgressMode
(
int32_t
aRow
nsTreeColumn
&
aColumn
mozilla
:
:
ErrorResult
&
aError
)
;
void
GetCellValue
(
int32_t
aRow
nsTreeColumn
&
aColumn
nsAString
&
aValue
mozilla
:
:
ErrorResult
&
aError
)
;
void
GetCellText
(
int32_t
aRow
nsTreeColumn
&
aColumn
nsAString
&
aText
mozilla
:
:
ErrorResult
&
aError
)
;
void
SetTree
(
mozilla
:
:
dom
:
:
TreeBoxObject
*
aTree
mozilla
:
:
ErrorResult
&
aError
)
;
void
ToggleOpenState
(
int32_t
aRow
mozilla
:
:
ErrorResult
&
aError
)
;
void
CycleHeader
(
nsTreeColumn
&
aColumn
mozilla
:
:
ErrorResult
&
aError
)
;
void
CycleCell
(
int32_t
aRow
nsTreeColumn
&
aColumn
)
;
bool
IsEditable
(
int32_t
aRow
nsTreeColumn
&
aColumn
mozilla
:
:
ErrorResult
&
aError
)
;
bool
IsSelectable
(
int32_t
aRow
nsTreeColumn
&
aColumn
mozilla
:
:
ErrorResult
&
aError
)
;
void
SetCellValue
(
int32_t
aRow
nsTreeColumn
&
aColumn
const
nsAString
&
aValue
mozilla
:
:
ErrorResult
&
aError
)
{
}
void
SetCellText
(
int32_t
aRow
nsTreeColumn
&
aColumn
const
nsAString
&
aText
mozilla
:
:
ErrorResult
&
aError
)
{
}
void
PerformAction
(
const
nsAString
&
aAction
)
;
void
PerformActionOnRow
(
const
nsAString
&
aAction
int32_t
aRow
)
;
void
PerformActionOnCell
(
const
nsAString
&
aAction
int32_t
aRow
nsTreeColumn
&
aColumn
)
;
using
nsIXULTemplateBuilder
:
:
HasGeneratedContent
;
virtual
bool
HasGeneratedContent
(
nsIRDFResource
*
aResource
const
nsAString
&
aTag
mozilla
:
:
ErrorResult
&
aError
)
override
;
NS_DECL_NSIXULTREEBUILDER
NS_DECL_NSITREEVIEW
NS_IMETHOD
EnsureNative
(
)
override
{
return
NS_OK
;
}
NS_DECL_NSIMUTATIONOBSERVER_NODEWILLBEDESTROYED
protected
:
friend
struct
ResultComparator
;
~
nsXULTreeBuilder
(
)
;
virtual
void
Uninit
(
bool
aIsFinal
)
override
;
nsresult
EnsureSortVariables
(
)
;
virtual
nsresult
RebuildAll
(
)
override
;
nsresult
GetTemplateActionRowFor
(
int32_t
aRow
nsIContent
*
*
aResult
)
;
nsIContent
*
GetTemplateActionCellFor
(
int32_t
aRow
nsTreeColumn
&
aCol
)
;
nsresult
GetResourceFor
(
int32_t
aRow
nsIRDFResource
*
*
aResource
)
;
nsresult
OpenContainer
(
int32_t
aIndex
nsIXULTemplateResult
*
aResult
)
;
nsresult
OpenSubtreeOf
(
nsTreeRows
:
:
Subtree
*
aSubtree
int32_t
aIndex
nsIXULTemplateResult
*
aResult
int32_t
*
aDelta
)
;
nsresult
OpenSubtreeForQuerySet
(
nsTreeRows
:
:
Subtree
*
aSubtree
int32_t
aIndex
nsIXULTemplateResult
*
aResult
nsTemplateQuerySet
*
aQuerySet
int32_t
*
aDelta
nsTArray
<
int32_t
>
&
open
)
;
nsresult
CloseContainer
(
int32_t
aIndex
)
;
nsresult
RemoveMatchesFor
(
nsTreeRows
:
:
Subtree
&
subtree
)
;
bool
IsContainerOpen
(
nsIXULTemplateResult
*
aResource
)
;
static
int
Compare
(
const
void
*
aLeft
const
void
*
aRight
void
*
aClosure
)
;
int32_t
CompareResults
(
nsIXULTemplateResult
*
aLeft
nsIXULTemplateResult
*
aRight
)
;
nsresult
SortSubtree
(
nsTreeRows
:
:
Subtree
*
aSubtree
)
;
bool
GetInsertionLocations
(
nsIXULTemplateResult
*
aResult
nsCOMArray
<
nsIContent
>
*
*
aLocations
)
override
;
virtual
nsresult
ReplaceMatch
(
nsIXULTemplateResult
*
aOldResult
nsTemplateMatch
*
aNewMatch
nsTemplateRule
*
aNewMatchRule
void
*
aContext
)
override
;
virtual
nsresult
SynchronizeResult
(
nsIXULTemplateResult
*
aResult
)
override
;
bool
IsValidRowIndex
(
int32_t
aRowIndex
)
;
nsCOMPtr
<
nsITreeBoxObject
>
mBoxObject
;
nsCOMPtr
<
nsITreeSelection
>
mSelection
;
nsCOMPtr
<
nsIRDFDataSource
>
mPersistStateStore
;
nsTreeRows
mRows
;
RefPtr
<
nsIAtom
>
mSortVariable
;
enum
Direction
{
eDirection_Descending
=
-
1
eDirection_Natural
=
0
eDirection_Ascending
=
+
1
}
;
Direction
mSortDirection
;
uint32_t
mSortHints
;
nsTArray
<
nsCOMPtr
<
nsIXULTreeBuilderObserver
>
>
mObservers
;
nsCOMPtr
<
nsIXULStore
>
mLocalStore
;
}
;
#
endif
