#
ifndef
nsXULPrototypeDocument_h__
#
define
nsXULPrototypeDocument_h__
#
include
"
js
/
TracingAPI
.
h
"
#
include
"
mozilla
/
Attributes
.
h
"
#
include
"
nsCOMArray
.
h
"
#
include
"
nsCOMPtr
.
h
"
#
include
"
nsTArray
.
h
"
#
include
"
nsISerializable
.
h
"
#
include
"
nsCycleCollectionParticipant
.
h
"
#
include
<
functional
>
class
nsAtom
;
class
nsIPrincipal
;
class
nsIURI
;
class
nsNodeInfoManager
;
class
nsXULPrototypeElement
;
class
nsXULPrototypePI
;
class
nsXULPrototypeDocument
final
:
public
nsISerializable
{
public
:
static
nsresult
Create
(
nsIURI
*
aURI
nsXULPrototypeDocument
*
*
aResult
)
;
typedef
std
:
:
function
<
void
(
)
>
Callback
;
NS_DECL_CYCLE_COLLECTING_ISUPPORTS
NS_DECL_NSISERIALIZABLE
nsresult
InitPrincipal
(
nsIURI
*
aURI
nsIPrincipal
*
aPrincipal
)
;
nsIURI
*
GetURI
(
)
;
nsXULPrototypeElement
*
GetRootElement
(
)
;
void
SetRootElement
(
nsXULPrototypeElement
*
aElement
)
;
nsresult
AddProcessingInstruction
(
nsXULPrototypePI
*
aPI
)
;
const
nsTArray
<
RefPtr
<
nsXULPrototypePI
>
>
&
GetProcessingInstructions
(
)
const
;
nsIPrincipal
*
DocumentPrincipal
(
)
;
void
SetDocumentPrincipal
(
nsIPrincipal
*
aPrincipal
)
;
nsresult
AwaitLoadDone
(
Callback
&
&
aCallback
bool
*
aResult
)
;
nsresult
NotifyLoadDone
(
)
;
nsNodeInfoManager
*
GetNodeInfoManager
(
)
;
void
MarkInCCGeneration
(
uint32_t
aCCGeneration
)
;
NS_DECL_CYCLE_COLLECTION_CLASS
(
nsXULPrototypeDocument
)
void
TraceProtos
(
JSTracer
*
aTrc
)
;
protected
:
nsCOMPtr
<
nsIURI
>
mURI
;
RefPtr
<
nsXULPrototypeElement
>
mRoot
;
nsTArray
<
RefPtr
<
nsXULPrototypePI
>
>
mProcessingInstructions
;
bool
mLoaded
;
nsTArray
<
Callback
>
mPrototypeWaiters
;
RefPtr
<
nsNodeInfoManager
>
mNodeInfoManager
;
uint32_t
mCCGeneration
;
uint32_t
mGCNumber
;
nsXULPrototypeDocument
(
)
;
virtual
~
nsXULPrototypeDocument
(
)
;
nsresult
Init
(
)
;
friend
NS_IMETHODIMP
NS_NewXULPrototypeDocument
(
nsXULPrototypeDocument
*
*
aResult
)
;
static
uint32_t
gRefCnt
;
}
;
#
endif
