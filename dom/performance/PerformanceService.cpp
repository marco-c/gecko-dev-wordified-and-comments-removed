#
include
"
PerformanceService
.
h
"
#
include
"
mozilla
/
ClearOnShutdown
.
h
"
#
include
"
mozilla
/
StaticMutex
.
h
"
#
include
"
mozilla
/
StaticPtr
.
h
"
#
include
"
prtime
.
h
"
namespace
mozilla
:
:
dom
{
static
StaticRefPtr
<
PerformanceService
>
gPerformanceService
;
static
StaticMutex
gPerformanceServiceMutex
;
PerformanceService
*
PerformanceService
:
:
GetOrCreate
(
)
{
StaticMutexAutoLock
al
(
gPerformanceServiceMutex
)
;
if
(
!
gPerformanceService
)
{
gPerformanceService
=
new
PerformanceService
(
)
;
ClearOnShutdown
(
&
gPerformanceService
)
;
}
return
gPerformanceService
;
}
DOMHighResTimeStamp
PerformanceService
:
:
TimeOrigin
(
const
TimeStamp
&
aCreationTimeStamp
)
const
{
return
(
aCreationTimeStamp
-
mCreationTimeStamp
)
.
ToMilliseconds
(
)
+
(
mCreationEpochTime
/
PR_USEC_PER_MSEC
)
;
}
PerformanceService
:
:
PerformanceService
(
)
{
mCreationTimeStamp
=
TimeStamp
:
:
Now
(
)
;
mCreationEpochTime
=
PR_Now
(
)
;
}
}
