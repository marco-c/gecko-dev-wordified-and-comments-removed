#
ifndef
DOM_SMIL_SMILCOMPOSITOR_H_
#
define
DOM_SMIL_SMILCOMPOSITOR_H_
#
include
<
utility
>
#
include
"
PLDHashTable
.
h
"
#
include
"
SMILTargetIdentifier
.
h
"
#
include
"
mozilla
/
SMILAnimationFunction
.
h
"
#
include
"
mozilla
/
SMILCompositorTable
.
h
"
#
include
"
mozilla
/
UniquePtr
.
h
"
#
include
"
nsCSSPropertyID
.
h
"
#
include
"
nsString
.
h
"
#
include
"
nsTHashtable
.
h
"
namespace
mozilla
{
class
ComputedStyle
;
class
SMILCompositor
:
public
PLDHashEntryHdr
{
public
:
using
KeyType
=
SMILTargetIdentifier
;
using
KeyTypeRef
=
const
KeyType
&
;
using
KeyTypePointer
=
const
KeyType
*
;
explicit
SMILCompositor
(
KeyTypePointer
aKey
)
:
mKey
(
*
aKey
)
mForceCompositing
(
false
)
{
}
SMILCompositor
(
SMILCompositor
&
&
toMove
)
noexcept
:
PLDHashEntryHdr
(
std
:
:
move
(
toMove
)
)
mKey
(
std
:
:
move
(
toMove
.
mKey
)
)
mAnimationFunctions
(
std
:
:
move
(
toMove
.
mAnimationFunctions
)
)
mForceCompositing
(
false
)
{
}
KeyTypeRef
GetKey
(
)
const
{
return
mKey
;
}
bool
KeyEquals
(
KeyTypePointer
aKey
)
const
;
static
KeyTypePointer
KeyToPointer
(
KeyTypeRef
aKey
)
{
return
&
aKey
;
}
static
PLDHashNumber
HashKey
(
KeyTypePointer
aKey
)
;
enum
{
ALLOW_MEMMOVE
=
false
}
;
void
AddAnimationFunction
(
SMILAnimationFunction
*
aFunc
)
;
void
ComposeAttribute
(
bool
&
aMightHavePendingStyleUpdates
)
;
void
ClearAnimationEffects
(
)
;
void
Traverse
(
nsCycleCollectionTraversalCallback
*
aCallback
)
;
void
ToggleForceCompositing
(
)
{
mForceCompositing
=
true
;
}
void
StealCachedBaseValue
(
SMILCompositor
*
aOther
)
{
mCachedBaseValue
=
std
:
:
move
(
aOther
-
>
mCachedBaseValue
)
;
}
private
:
UniquePtr
<
SMILAttr
>
CreateSMILAttr
(
ComputedStyle
*
aBaseComputedStyle
)
;
nsCSSPropertyID
GetCSSPropertyToAnimate
(
)
const
;
bool
MightNeedBaseStyle
(
)
const
;
uint32_t
GetFirstFuncToAffectSandwich
(
)
;
void
UpdateCachedBaseValue
(
const
SMILValue
&
aBaseValue
)
;
KeyType
mKey
;
nsTArray
<
SMILAnimationFunction
*
>
mAnimationFunctions
;
bool
mForceCompositing
;
SMILValue
mCachedBaseValue
;
}
;
}
#
endif
