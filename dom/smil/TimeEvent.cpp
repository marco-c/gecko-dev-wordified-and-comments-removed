#
include
"
mozilla
/
ContentEvents
.
h
"
#
include
"
mozilla
/
dom
/
TimeEvent
.
h
"
#
include
"
nsIDocShell
.
h
"
#
include
"
nsIInterfaceRequestorUtils
.
h
"
#
include
"
nsPresContext
.
h
"
#
include
"
nsGlobalWindowInner
.
h
"
#
include
"
nsGlobalWindowOuter
.
h
"
namespace
mozilla
:
:
dom
{
TimeEvent
:
:
TimeEvent
(
EventTarget
*
aOwner
nsPresContext
*
aPresContext
InternalSMILTimeEvent
*
aEvent
)
:
Event
(
aOwner
aPresContext
aEvent
?
aEvent
:
new
InternalSMILTimeEvent
(
false
eVoidEvent
)
)
mDetail
(
mEvent
-
>
AsSMILTimeEvent
(
)
-
>
mDetail
)
{
if
(
aEvent
)
{
mEventIsInternal
=
false
;
}
else
{
mEventIsInternal
=
true
;
}
if
(
mPresContext
)
{
nsCOMPtr
<
nsIDocShell
>
docShell
=
mPresContext
-
>
GetDocShell
(
)
;
if
(
docShell
)
{
mView
=
docShell
-
>
GetWindow
(
)
;
}
}
}
NS_IMPL_CYCLE_COLLECTION_INHERITED
(
TimeEvent
Event
mView
)
NS_IMPL_ISUPPORTS_CYCLE_COLLECTION_INHERITED_0
(
TimeEvent
Event
)
void
TimeEvent
:
:
InitTimeEvent
(
const
nsAString
&
aType
nsGlobalWindowInner
*
aView
int32_t
aDetail
)
{
NS_ENSURE_TRUE_VOID
(
!
mEvent
-
>
mFlags
.
mIsBeingDispatched
)
;
Event
:
:
InitEvent
(
aType
false
false
)
;
mDetail
=
aDetail
;
mView
=
aView
?
aView
-
>
GetOuterWindow
(
)
:
nullptr
;
}
}
using
namespace
mozilla
;
using
namespace
mozilla
:
:
dom
;
already_AddRefed
<
TimeEvent
>
NS_NewDOMTimeEvent
(
EventTarget
*
aOwner
nsPresContext
*
aPresContext
InternalSMILTimeEvent
*
aEvent
)
{
RefPtr
<
TimeEvent
>
it
=
new
TimeEvent
(
aOwner
aPresContext
aEvent
)
;
return
it
.
forget
(
)
;
}
