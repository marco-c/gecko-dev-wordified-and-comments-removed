#
ifndef
NS_SMILTIMEVALUESPEC_H_
#
define
NS_SMILTIMEVALUESPEC_H_
#
include
"
mozilla
/
Attributes
.
h
"
#
include
"
mozilla
/
dom
/
IDTracker
.
h
"
#
include
"
nsSMILTimeValueSpecParams
.
h
"
#
include
"
nsStringFwd
.
h
"
#
include
"
nsIDOMEventListener
.
h
"
class
nsSMILTimeValue
;
class
nsSMILTimeContainer
;
class
nsSMILInstanceTime
;
class
nsSMILInterval
;
namespace
mozilla
{
class
SMILTimedElement
;
namespace
dom
{
class
Event
;
}
class
EventListenerManager
;
}
class
nsSMILTimeValueSpec
{
public
:
typedef
mozilla
:
:
SMILTimedElement
SMILTimedElement
;
typedef
mozilla
:
:
dom
:
:
Element
Element
;
typedef
mozilla
:
:
dom
:
:
Event
Event
;
typedef
mozilla
:
:
dom
:
:
IDTracker
IDTracker
;
nsSMILTimeValueSpec
(
SMILTimedElement
&
aOwner
bool
aIsBegin
)
;
~
nsSMILTimeValueSpec
(
)
;
nsresult
SetSpec
(
const
nsAString
&
aStringSpec
Element
&
aContextElement
)
;
void
ResolveReferences
(
Element
&
aContextElement
)
;
bool
IsEventBased
(
)
const
;
void
HandleNewInterval
(
nsSMILInterval
&
aInterval
const
nsSMILTimeContainer
*
aSrcContainer
)
;
void
HandleTargetElementChange
(
Element
*
aNewTarget
)
;
bool
DependsOnBegin
(
)
const
;
void
HandleChangedInstanceTime
(
const
nsSMILInstanceTime
&
aBaseTime
const
nsSMILTimeContainer
*
aSrcContainer
nsSMILInstanceTime
&
aInstanceTimeToUpdate
bool
aObjectChanged
)
;
void
HandleDeletedInstanceTime
(
nsSMILInstanceTime
&
aInstanceTime
)
;
void
Traverse
(
nsCycleCollectionTraversalCallback
*
aCallback
)
;
void
Unlink
(
)
;
protected
:
void
UpdateReferencedElement
(
Element
*
aFrom
Element
*
aTo
)
;
void
UnregisterFromReferencedElement
(
Element
*
aElement
)
;
SMILTimedElement
*
GetTimedElement
(
Element
*
aElement
)
;
bool
IsWhitelistedEvent
(
)
;
void
RegisterEventListener
(
Element
*
aElement
)
;
void
UnregisterEventListener
(
Element
*
aElement
)
;
void
HandleEvent
(
Event
*
aEvent
)
;
bool
CheckRepeatEventDetail
(
Event
*
aEvent
)
;
nsSMILTimeValue
ConvertBetweenTimeContainers
(
const
nsSMILTimeValue
&
aSrcTime
const
nsSMILTimeContainer
*
aSrcContainer
)
;
bool
ApplyOffset
(
nsSMILTimeValue
&
aTime
)
const
;
SMILTimedElement
*
mOwner
;
bool
mIsBegin
;
nsSMILTimeValueSpecParams
mParams
;
class
TimeReferenceTracker
final
:
public
IDTracker
{
public
:
explicit
TimeReferenceTracker
(
nsSMILTimeValueSpec
*
aOwner
)
:
mSpec
(
aOwner
)
{
}
void
ResetWithElement
(
Element
*
aTo
)
{
RefPtr
<
Element
>
from
=
get
(
)
;
Unlink
(
)
;
ElementChanged
(
from
aTo
)
;
}
protected
:
virtual
void
ElementChanged
(
Element
*
aFrom
Element
*
aTo
)
override
{
IDTracker
:
:
ElementChanged
(
aFrom
aTo
)
;
mSpec
-
>
UpdateReferencedElement
(
aFrom
aTo
)
;
}
virtual
bool
IsPersistent
(
)
override
{
return
true
;
}
private
:
nsSMILTimeValueSpec
*
mSpec
;
}
;
TimeReferenceTracker
mReferencedElement
;
class
EventListener
final
:
public
nsIDOMEventListener
{
~
EventListener
(
)
{
}
public
:
explicit
EventListener
(
nsSMILTimeValueSpec
*
aOwner
)
:
mSpec
(
aOwner
)
{
}
void
Disconnect
(
)
{
mSpec
=
nullptr
;
}
NS_DECL_ISUPPORTS
NS_DECL_NSIDOMEVENTLISTENER
private
:
nsSMILTimeValueSpec
*
mSpec
;
}
;
RefPtr
<
EventListener
>
mEventListener
;
}
;
#
endif
