option
(
"
-
-
enable
-
warnings
-
as
-
errors
"
env
=
"
MOZ_ENABLE_WARNINGS_AS_ERRORS
"
default
=
moz_automation
help
=
"
{
Enable
|
Disable
}
treating
warnings
as
errors
"
)
depends
(
"
-
-
enable
-
warnings
-
as
-
errors
"
)
def
warnings_as_errors
(
warnings_as_errors
)
:
if
not
warnings_as_errors
:
return
"
"
return
"
-
Werror
"
set_config
(
"
WARNINGS_AS_ERRORS
"
warnings_as_errors
)
not_clang_cl
=
depends
(
c_compiler
)
(
lambda
c
:
c
.
type
!
=
"
clang
-
cl
"
)
not_clang
=
depends
(
c_compiler
)
(
lambda
c
:
c
.
type
!
=
"
clang
"
)
not_clang_based
=
depends
(
c_compiler
)
(
lambda
c
:
c
.
type
not
in
(
"
clang
"
"
clang
-
cl
"
)
)
add_warning
(
"
-
Wall
"
when
=
not_clang_cl
)
add_warning
(
"
-
W3
"
when
=
depends
(
c_compiler
)
(
lambda
c
:
c
.
type
=
=
"
clang
-
cl
"
)
)
check_and_add_warning
(
"
-
Wbitfield
-
enum
-
conversion
"
min_clang_version
=
"
5
.
0
.
0
"
)
add_warning
(
"
-
Wempty
-
body
"
)
check_and_add_warning
(
"
-
Wformat
-
type
-
confusion
"
min_clang_version
=
"
10
.
0
.
0
"
)
add_warning
(
"
-
Wignored
-
qualifiers
"
)
add_warning
(
"
-
Wpointer
-
arith
"
)
check_and_add_warning
(
"
-
Wshadow
-
field
-
in
-
constructor
-
modified
"
min_clang_version
=
"
4
.
0
.
0
"
)
add_warning
(
"
-
Wsign
-
compare
"
)
check_and_add_warning
(
"
-
Wtautological
-
constant
-
in
-
range
-
compare
"
min_clang_version
=
"
6
.
0
.
0
"
)
add_warning
(
"
-
Wtype
-
limits
"
)
check_and_add_warning
(
"
-
Wno
-
error
=
tautological
-
type
-
limit
-
compare
"
min_clang_version
=
"
6
.
0
.
0
"
)
add_warning
(
"
-
Wunreachable
-
code
"
)
check_and_add_warning
(
"
-
Wunreachable
-
code
-
return
"
min_clang_version
=
"
4
.
0
.
0
"
)
check_and_add_warning
(
"
-
Wunused
-
but
-
set
-
parameter
"
min_clang_version
=
"
13
.
0
.
0
"
when
=
depends
(
c_compiler
)
(
lambda
c
:
c
.
type
in
(
"
clang
"
"
clang
-
cl
"
)
)
)
add_warning
(
"
-
Wno
-
invalid
-
offsetof
"
cxx_compiler
)
check_and_add_warning
(
"
-
Wclass
-
varargs
"
min_clang_version
=
"
4
.
0
.
0
"
)
check_and_add_warning
(
"
-
Wempty
-
init
-
stmt
"
cxx_compiler
min_clang_version
=
"
8
.
0
.
0
"
)
check_and_add_warning
(
"
-
Wfloat
-
overflow
-
conversion
"
min_clang_version
=
"
4
.
0
.
0
"
)
check_and_add_warning
(
"
-
Wfloat
-
zero
-
conversion
"
min_clang_version
=
"
4
.
0
.
0
"
)
check_and_add_warning
(
"
-
Wloop
-
analysis
"
min_clang_version
=
"
4
.
0
.
0
"
)
check_and_add_warning
(
"
-
Wno
-
range
-
loop
-
analysis
"
min_clang_version
=
"
4
.
0
.
0
"
)
check_and_add_warning
(
"
-
Wno
-
deprecated
-
anon
-
enum
-
enum
-
conversion
"
cxx_compiler
min_clang_version
=
"
10
.
0
.
0
"
)
check_and_add_warning
(
"
-
Wno
-
deprecated
-
enum
-
enum
-
conversion
"
cxx_compiler
min_clang_version
=
"
10
.
0
.
0
"
)
check_and_add_warning
(
"
-
Wno
-
deprecated
-
this
-
capture
"
cxx_compiler
min_clang_version
=
"
6
.
0
.
0
"
)
check_and_add_warning
(
"
-
Wno
-
error
=
deprecated
"
when
=
building_with_gcc
)
check_and_add_warning
(
"
-
Wdeprecated
-
literal
-
operator
"
cxx_compiler
)
check_and_add_warning
(
"
-
Winvalid
-
utf8
"
)
check_and_add_warning
(
"
-
Wcomma
"
cxx_compiler
min_clang_version
=
"
4
.
0
.
0
"
)
check_and_add_warning
(
"
-
Wduplicated
-
cond
"
when
=
not_clang_based
)
check_and_add_warning
(
"
-
Wimplicit
-
fallthrough
"
cxx_compiler
min_clang_version
=
"
4
.
0
.
0
"
)
check_and_add_warning
(
"
-
Wlogical
-
op
"
when
=
not_clang_based
)
with
only_when
(
depends
(
target
)
(
lambda
t
:
t
.
kernel
=
=
"
Darwin
"
)
)
:
check_and_add_warning
(
"
-
Wduplicate
-
method
-
arg
"
)
check_and_add_warning
(
"
-
Wduplicate
-
method
-
match
"
)
check_and_add_warning
(
"
-
Wmissing
-
method
-
return
-
type
"
)
check_and_add_warning
(
"
-
Wobjc
-
signed
-
char
-
bool
"
)
check_and_add_warning
(
"
-
Wsemicolon
-
before
-
method
-
body
"
)
check_and_add_warning
(
"
-
Wsuper
-
class
-
method
-
mismatch
"
)
check_and_add_warning
(
"
-
Wstring
-
conversion
"
min_clang_version
=
"
4
.
0
.
0
"
)
check_and_add_warning
(
"
-
Wno
-
inline
-
new
-
delete
"
cxx_compiler
min_clang_version
=
"
4
.
0
.
0
"
)
check_and_add_warning
(
"
-
Wno
-
error
=
maybe
-
uninitialized
"
when
=
not_clang_based
)
check_and_add_warning
(
"
-
Wno
-
error
=
deprecated
-
declarations
"
min_clang_version
=
"
4
.
0
.
0
"
)
check_and_add_warning
(
"
-
Wno
-
error
=
array
-
bounds
"
min_clang_version
=
"
4
.
0
.
0
"
)
check_and_add_warning
(
"
-
Wno
-
error
=
free
-
nonheap
-
object
"
min_clang_version
=
"
12
.
0
.
0
"
)
check_and_add_warning
(
"
-
Wno
-
multistatement
-
macros
"
when
=
not_clang_based
)
check_and_add_warning
(
"
-
Wno
-
error
=
class
-
memaccess
"
when
=
not_clang_based
)
check_and_add_warning
(
"
-
Wno
-
error
=
atomic
-
alignment
"
min_clang_version
=
"
7
.
0
.
0
"
)
check_and_add_warning
(
"
-
Wno
-
error
=
deprecated
-
builtins
"
min_clang_version
=
"
15
.
0
.
0
"
)
c_format_warning
cxx_format_warning
=
check_and_add_warning
(
"
-
Wformat
"
when
=
depends
(
target
)
(
lambda
t
:
t
.
kernel
!
=
"
WINNT
"
)
)
check_and_add_warning
(
"
-
Wformat
-
security
"
when
=
c_format_warning
&
cxx_format_warning
min_clang_version
=
"
4
.
0
.
0
"
)
check_and_add_warning
(
"
-
Wformat
-
overflow
=
2
"
when
=
c_format_warning
&
cxx_format_warning
&
not_clang_based
)
with
only_when
(
target_is_windows
)
:
check_and_add_warning
(
"
-
Wno
-
unknown
-
pragmas
"
)
with
only_when
(
depends
(
c_compiler
)
(
lambda
c
:
c
.
type
=
=
"
clang
-
cl
"
)
)
:
check_and_add_warning
(
"
-
Wno
-
ignored
-
pragmas
"
)
check_and_add_warning
(
"
-
Wno
-
deprecated
-
declarations
"
)
check_and_add_warning
(
"
-
Wno
-
microsoft
-
enum
-
value
"
cxx_compiler
)
check_and_add_warning
(
"
-
Wno
-
microsoft
-
include
"
cxx_compiler
)
check_and_add_warning
(
"
-
Wno
-
invalid
-
noreturn
"
)
check_and_add_warning
(
"
-
Wno
-
inconsistent
-
missing
-
override
"
cxx_compiler
)
check_and_add_warning
(
"
-
Wno
-
implicit
-
exception
-
spec
-
mismatch
"
cxx_compiler
)
check_and_add_warning
(
"
-
Wno
-
microsoft
-
exception
-
spec
"
cxx_compiler
)
check_and_add_warning
(
"
-
Wno
-
unused
-
local
-
typedef
"
cxx_compiler
)
check_and_add_warning
(
"
-
Wno
-
ignored
-
attributes
"
cxx_compiler
)
check_and_add_warning
(
"
-
Wno
-
used
-
but
-
marked
-
unused
"
cxx_compiler
)
with
only_when
(
depends
(
c_compiler
)
(
lambda
c
:
c
.
type
!
=
"
clang
-
cl
"
)
)
:
check_and_add_warning
(
"
-
Wno
-
unused
-
function
"
)
check_and_add_warning
(
"
-
Wno
-
conversion
-
null
"
)
check_and_add_warning
(
"
-
Wno
-
switch
"
)
check_and_add_warning
(
"
-
Wno
-
enum
-
compare
"
)
check_and_add_warning
(
"
-
Werror
=
implicit
-
function
-
declaration
"
c_compiler
min_clang_version
=
"
4
.
0
.
0
"
)
check_and_add_warning
(
"
-
Wno
-
psabi
"
min_clang_version
=
"
11
.
0
.
0
"
)
check_and_add_warning
(
"
-
Wno
-
missing
-
braces
"
when
=
depends
(
c_compiler
)
(
lambda
c
:
c
.
type
=
=
"
clang
"
and
c
.
version
<
"
6
.
0
"
)
min_clang_version
=
"
4
.
0
.
0
"
)
check_and_add_warning
(
"
-
Wthread
-
safety
"
when
=
depends
(
c_compiler
)
(
lambda
c
:
c
.
type
in
(
"
clang
"
"
clang
-
cl
"
)
and
c
.
version
>
=
"
8
.
0
"
)
min_clang_version
=
"
4
.
0
.
0
"
)
check_and_add_warning
(
"
-
Werror
=
unguarded
-
availability
-
new
"
when
=
target_is_osx
min_clang_version
=
"
5
.
0
.
0
"
)
check_and_add_warning
(
"
-
Wno
-
error
=
builtin
-
macro
-
redefined
"
min_clang_version
=
"
4
.
0
.
0
"
)
check_and_add_warning
(
"
-
Wno
-
vla
-
cxx
-
extension
"
cxx_compiler
min_clang_version
=
"
18
.
0
.
0
"
)
check_and_add_warning
(
"
-
Wno
-
unknown
-
warning
-
option
"
min_clang_version
=
"
4
.
0
.
0
"
)
check_and_add_warning
(
"
-
Wno
-
character
-
conversion
"
min_clang_version
=
"
21
.
0
.
0
"
)
set_config
(
"
WARNINGS_CFLAGS
"
warnings_flags
.
cflags
)
set_config
(
"
WARNINGS_CXXFLAGS
"
warnings_flags
.
cxxflags
)
set_config
(
"
WARNINGS_HOST_CFLAGS
"
warnings_flags
.
host_cflags
)
set_config
(
"
WARNINGS_HOST_CXXFLAGS
"
warnings_flags
.
host_cxxflags
)
