#
if
defined
(
MOZ_PROFILE_GENERATE
)
&
&
defined
(
XP_LINUX
)
&
&
!
defined
(
ANDROID
)
#
include
<
pthread
.
h
>
#
include
<
stdio
.
h
>
#
include
<
stdlib
.
h
>
#
include
<
unistd
.
h
>
#
include
<
errno
.
h
>
#
if
defined
(
__cplusplus
)
extern
"
C
"
{
#
endif
void
__llvm_profile_initialize
(
void
)
;
void
__llvm_profile_initialize_file
(
void
)
;
void
__llvm_profile_set_filename
(
const
char
*
)
;
static
void
updateFilenameAfterFork
(
void
)
{
__llvm_profile_set_filename
(
"
default
.
profraw
"
)
;
__llvm_profile_initialize_file
(
)
;
__llvm_profile_set_filename
(
getenv
(
"
LLVM_PROFILE_FILE
"
)
)
;
__llvm_profile_initialize_file
(
)
;
}
static
int
CustomRegisterRuntime
(
void
)
{
__llvm_profile_initialize
(
)
;
if
(
pthread_atfork
(
NULL
NULL
updateFilenameAfterFork
)
<
0
)
{
fprintf
(
stderr
"
[
%
d
]
[
%
s
]
pthread_atfork
(
)
=
%
d
\
n
"
getpid
(
)
__PRETTY_FUNCTION__
errno
)
;
}
return
0
;
}
int
__llvm_profile_runtime
=
CustomRegisterRuntime
(
)
;
#
if
defined
(
__cplusplus
)
}
#
endif
#
endif
