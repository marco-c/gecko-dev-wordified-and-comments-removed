#
include
"
nsTString
.
h
"
#
include
"
nsString
.
h
"
#
include
"
prdtoa
.
h
"
template
<
typename
T
>
bool
nsTString
<
T
>
:
:
SetCharAt
(
char16_t
aChar
index_type
aIndex
)
{
if
(
aIndex
>
=
this
-
>
mLength
)
{
return
false
;
}
if
(
!
this
-
>
EnsureMutable
(
)
)
{
this
-
>
AllocFailed
(
this
-
>
mLength
)
;
}
this
-
>
mData
[
aIndex
]
=
char_type
(
aChar
)
;
return
true
;
}
template
<
>
double
nsTString
<
char
>
:
:
ToDouble
(
bool
aAllowTrailingChars
nsresult
*
aErrorCode
)
const
{
double
res
=
0
.
0
;
if
(
this
-
>
Length
(
)
>
0
)
{
char
*
conv_stopped
;
const
char
*
str
=
this
-
>
get
(
)
;
res
=
PR_strtod
(
str
&
conv_stopped
)
;
if
(
aAllowTrailingChars
&
&
conv_stopped
!
=
str
)
{
*
aErrorCode
=
NS_OK
;
}
else
if
(
!
aAllowTrailingChars
&
&
conv_stopped
=
=
str
+
this
-
>
Length
(
)
)
{
*
aErrorCode
=
NS_OK
;
}
else
{
*
aErrorCode
=
NS_ERROR_ILLEGAL_VALUE
;
}
}
else
{
*
aErrorCode
=
NS_ERROR_ILLEGAL_VALUE
;
}
return
res
;
}
template
<
>
double
nsTString
<
char16_t
>
:
:
ToDouble
(
bool
aAllowTrailingChars
nsresult
*
aErrorCode
)
const
{
NS_LossyConvertUTF16toASCII
cString
(
BeginReading
(
)
Length
(
)
)
;
return
aAllowTrailingChars
?
cString
.
ToDoubleAllowTrailingChars
(
aErrorCode
)
:
cString
.
ToDouble
(
aErrorCode
)
;
}
template
<
typename
T
>
void
nsTString
<
T
>
:
:
Rebind
(
const
char_type
*
data
size_type
length
)
{
this
-
>
Finalize
(
)
;
this
-
>
SetData
(
const_cast
<
char_type
*
>
(
data
)
length
DataFlags
:
:
TERMINATED
)
;
this
-
>
AssertValidDependentString
(
)
;
}
