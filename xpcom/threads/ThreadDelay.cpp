#
include
"
ThreadDelay
.
h
"
#
include
"
mozilla
/
Assertions
.
h
"
#
include
"
mozilla
/
ChaosMode
.
h
"
#
if
defined
(
XP_WIN
)
#
include
<
windows
.
h
>
#
else
#
include
<
unistd
.
h
>
#
endif
namespace
mozilla
{
void
DelayForChaosMode
(
ChaosFeature
aFeature
const
uint32_t
aMicrosecondLimit
)
{
if
(
!
ChaosMode
:
:
isActive
(
aFeature
)
)
{
return
;
}
MOZ_ASSERT
(
aMicrosecondLimit
<
=
1000
)
;
#
if
defined
(
XP_WIN
)
#
else
const
uint32_t
duration
=
ChaosMode
:
:
randomUint32LessThan
(
aMicrosecondLimit
)
;
:
:
usleep
(
duration
)
;
#
endif
}
}
