#
ifndef
mozilla_SchedulerGroup_h
#
define
mozilla_SchedulerGroup_h
#
include
"
mozilla
/
RefPtr
.
h
"
#
include
"
mozilla
/
TaskCategory
.
h
"
#
include
"
nsCOMPtr
.
h
"
#
include
"
nsID
.
h
"
#
include
"
nsIRunnable
.
h
"
#
include
"
nsISupports
.
h
"
#
include
"
nsStringFwd
.
h
"
#
include
"
nsThreadUtils
.
h
"
#
include
"
nscore
.
h
"
class
nsIEventTarget
;
class
nsIRunnable
;
class
nsISerialEventTarget
;
namespace
mozilla
{
class
AbstractThread
;
namespace
dom
{
class
DocGroup
;
}
#
define
NS_SCHEDULERGROUPRUNNABLE_IID
\
{
\
0xd31b7420
0x872b
0x4cfb
{
\
0xa9
0xc6
0xae
0x4c
0x0f
0x06
0x36
0x74
\
}
\
}
class
SchedulerGroup
{
public
:
SchedulerGroup
(
)
;
NS_INLINE_DECL_PURE_VIRTUAL_REFCOUNTING
class
Runnable
final
:
public
mozilla
:
:
Runnable
public
nsIRunnablePriority
{
public
:
Runnable
(
already_AddRefed
<
nsIRunnable
>
&
&
aRunnable
dom
:
:
DocGroup
*
aDocGroup
)
;
dom
:
:
DocGroup
*
DocGroup
(
)
const
;
#
ifdef
MOZ_COLLECTING_RUNNABLE_TELEMETRY
NS_IMETHOD
GetName
(
nsACString
&
aName
)
override
;
#
endif
NS_DECL_ISUPPORTS_INHERITED
NS_DECL_NSIRUNNABLE
NS_DECL_NSIRUNNABLEPRIORITY
NS_DECLARE_STATIC_IID_ACCESSOR
(
NS_SCHEDULERGROUPRUNNABLE_IID
)
;
private
:
friend
class
SchedulerGroup
;
~
Runnable
(
)
=
default
;
nsCOMPtr
<
nsIRunnable
>
mRunnable
;
RefPtr
<
dom
:
:
DocGroup
>
mDocGroup
;
}
;
friend
class
Runnable
;
static
nsresult
Dispatch
(
TaskCategory
aCategory
already_AddRefed
<
nsIRunnable
>
&
&
aRunnable
)
;
static
nsresult
UnlabeledDispatch
(
TaskCategory
aCategory
already_AddRefed
<
nsIRunnable
>
&
&
aRunnable
)
;
static
void
MarkVsyncReceived
(
)
;
static
void
MarkVsyncRan
(
)
;
static
nsresult
DispatchWithDocGroup
(
TaskCategory
aCategory
already_AddRefed
<
nsIRunnable
>
&
&
aRunnable
dom
:
:
DocGroup
*
aDocGroup
)
;
protected
:
static
nsresult
InternalUnlabeledDispatch
(
TaskCategory
aCategory
already_AddRefed
<
Runnable
>
&
&
aRunnable
)
;
static
nsresult
LabeledDispatch
(
TaskCategory
aCategory
already_AddRefed
<
nsIRunnable
>
&
&
aRunnable
dom
:
:
DocGroup
*
aDocGroup
)
;
void
Shutdown
(
bool
aXPCOMShutdown
)
;
bool
mIsRunning
;
size_t
mEventCount
=
0
;
}
;
NS_DEFINE_STATIC_IID_ACCESSOR
(
SchedulerGroup
:
:
Runnable
NS_SCHEDULERGROUPRUNNABLE_IID
)
;
}
#
endif
