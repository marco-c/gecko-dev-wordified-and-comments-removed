#
ifndef
mozilla_ThreadEventTarget_h
#
define
mozilla_ThreadEventTarget_h
#
include
"
mozilla
/
MemoryReporting
.
h
"
#
include
"
mozilla
/
Mutex
.
h
"
#
include
"
mozilla
/
SynchronizedEventQueue
.
h
"
#
include
"
nsIDelayedRunnableObserver
.
h
"
#
include
"
nsISerialEventTarget
.
h
"
namespace
mozilla
{
class
DelayedRunnable
;
class
ThreadEventTarget
final
:
public
nsISerialEventTarget
public
nsIDelayedRunnableObserver
{
public
:
ThreadEventTarget
(
ThreadTargetSink
*
aSink
bool
aIsMainThread
)
;
NS_DECL_THREADSAFE_ISUPPORTS
NS_DECL_NSIEVENTTARGET_FULL
void
OnDelayedRunnableCreated
(
DelayedRunnable
*
aRunnable
)
override
;
void
OnDelayedRunnableScheduled
(
DelayedRunnable
*
aRunnable
)
override
;
void
OnDelayedRunnableRan
(
DelayedRunnable
*
aRunnable
)
override
;
void
NotifyShutdown
(
)
;
void
Disconnect
(
const
MutexAutoLock
&
aProofOfLock
)
{
mSink
-
>
Disconnect
(
aProofOfLock
)
;
}
void
SetCurrentThread
(
PRThread
*
aThread
)
;
void
ClearCurrentThread
(
)
;
size_t
SizeOfIncludingThis
(
mozilla
:
:
MallocSizeOf
aMallocSizeOf
)
const
{
size_t
n
=
0
;
if
(
mSink
)
{
n
+
=
mSink
-
>
SizeOfIncludingThis
(
aMallocSizeOf
)
;
}
return
aMallocSizeOf
(
this
)
+
n
;
}
private
:
~
ThreadEventTarget
(
)
;
RefPtr
<
ThreadTargetSink
>
mSink
;
bool
mIsMainThread
;
nsTArray
<
RefPtr
<
mozilla
:
:
DelayedRunnable
>
>
mScheduledDelayedRunnables
;
}
;
}
#
endif
