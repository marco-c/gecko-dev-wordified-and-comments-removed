#
ifndef
nsAtom_h
#
define
nsAtom_h
#
include
"
nsISupportsImpl
.
h
"
#
include
"
nsString
.
h
"
#
include
"
nsStringBuffer
.
h
"
namespace
mozilla
{
struct
AtomsSizes
;
}
class
nsAtom
{
public
:
void
AddSizeOfIncludingThis
(
mozilla
:
:
MallocSizeOf
aMallocSizeOf
mozilla
:
:
AtomsSizes
&
aSizes
)
const
;
enum
class
AtomKind
:
uint8_t
{
DynamicAtom
=
0
StaticAtom
=
1
HTML5Atom
=
2
}
;
bool
Equals
(
char16ptr_t
aString
uint32_t
aLength
)
const
{
return
mLength
=
=
aLength
&
&
memcmp
(
mString
aString
mLength
*
sizeof
(
char16_t
)
)
=
=
0
;
}
bool
Equals
(
const
nsAString
&
aString
)
const
{
return
Equals
(
aString
.
BeginReading
(
)
aString
.
Length
(
)
)
;
}
AtomKind
Kind
(
)
const
{
return
static_cast
<
AtomKind
>
(
mKind
)
;
}
bool
IsDynamic
(
)
const
{
return
Kind
(
)
=
=
AtomKind
:
:
DynamicAtom
;
}
bool
IsHTML5
(
)
const
{
return
Kind
(
)
=
=
AtomKind
:
:
HTML5Atom
;
}
bool
IsStatic
(
)
const
{
return
Kind
(
)
=
=
AtomKind
:
:
StaticAtom
;
}
char16ptr_t
GetUTF16String
(
)
const
{
return
mString
;
}
uint32_t
GetLength
(
)
const
{
return
mLength
;
}
void
ToString
(
nsAString
&
aString
)
const
;
void
ToUTF8String
(
nsACString
&
aString
)
const
;
nsStringBuffer
*
GetStringBuffer
(
)
const
{
MOZ_ASSERT
(
IsDynamic
(
)
|
|
IsHTML5
(
)
)
;
return
nsStringBuffer
:
:
FromData
(
const_cast
<
char16_t
*
>
(
mString
)
)
;
}
uint32_t
hash
(
)
const
{
MOZ_ASSERT
(
!
IsHTML5
(
)
)
;
return
mHash
;
}
MozExternalRefCountType
AddRef
(
)
;
MozExternalRefCountType
Release
(
)
;
typedef
mozilla
:
:
TrueType
HasThreadSafeRefCnt
;
private
:
friend
class
nsAtomTable
;
friend
class
nsAtomSubTable
;
friend
class
nsHtml5AtomEntry
;
protected
:
nsAtom
(
AtomKind
aKind
const
nsAString
&
aString
uint32_t
aHash
)
;
nsAtom
(
const
char16_t
*
aString
uint32_t
aLength
uint32_t
aHash
)
;
~
nsAtom
(
)
;
const
uint32_t
mLength
:
30
;
const
uint32_t
mKind
:
2
;
const
uint32_t
mHash
;
const
char16_t
*
const
mString
;
}
;
class
nsStaticAtom
:
public
nsAtom
{
public
:
MozExternalRefCountType
AddRef
(
)
=
delete
;
MozExternalRefCountType
Release
(
)
=
delete
;
already_AddRefed
<
nsAtom
>
ToAddRefed
(
)
{
return
already_AddRefed
<
nsAtom
>
(
static_cast
<
nsAtom
*
>
(
this
)
)
;
}
private
:
friend
class
nsAtomTable
;
nsStaticAtom
(
const
char16_t
*
aString
uint32_t
aLength
uint32_t
aHash
)
:
nsAtom
(
aString
aLength
aHash
)
{
}
}
;
already_AddRefed
<
nsAtom
>
NS_Atomize
(
const
char
*
aUTF8String
)
;
already_AddRefed
<
nsAtom
>
NS_Atomize
(
const
nsACString
&
aUTF8String
)
;
already_AddRefed
<
nsAtom
>
NS_Atomize
(
const
char16_t
*
aUTF16String
)
;
already_AddRefed
<
nsAtom
>
NS_Atomize
(
const
nsAString
&
aUTF16String
)
;
already_AddRefed
<
nsAtom
>
NS_AtomizeMainThread
(
const
nsAString
&
aUTF16String
)
;
nsrefcnt
NS_GetNumberOfAtoms
(
)
;
nsStaticAtom
*
NS_GetStaticAtom
(
const
nsAString
&
aUTF16String
)
;
void
NS_SetStaticAtomsDone
(
)
;
class
nsAtomString
:
public
nsString
{
public
:
explicit
nsAtomString
(
const
nsAtom
*
aAtom
)
{
aAtom
-
>
ToString
(
*
this
)
;
}
}
;
class
nsAtomCString
:
public
nsCString
{
public
:
explicit
nsAtomCString
(
nsAtom
*
aAtom
)
{
aAtom
-
>
ToUTF8String
(
*
this
)
;
}
}
;
class
nsDependentAtomString
:
public
nsDependentString
{
public
:
explicit
nsDependentAtomString
(
const
nsAtom
*
aAtom
)
:
nsDependentString
(
aAtom
-
>
GetUTF16String
(
)
aAtom
-
>
GetLength
(
)
)
{
}
}
;
#
endif
