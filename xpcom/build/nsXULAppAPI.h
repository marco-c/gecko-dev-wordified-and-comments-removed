#
ifndef
_nsXULAppAPI_h__
#
define
_nsXULAppAPI_h__
#
include
"
js
/
TypeDecls
.
h
"
#
include
"
mozilla
/
ArrayUtils
.
h
"
#
include
"
mozilla
/
TimeStamp
.
h
"
#
include
"
nscore
.
h
"
#
include
"
xrecore
.
h
"
#
if
defined
(
MOZ_WIDGET_ANDROID
)
#
include
<
jni
.
h
>
#
endif
class
JSString
;
class
MessageLoop
;
class
nsIDirectoryServiceProvider
;
class
nsIFile
;
class
nsISupports
;
struct
JSContext
;
struct
XREChildData
;
struct
XREShellData
;
namespace
mozilla
{
class
XREAppData
;
struct
BootstrapConfig
;
struct
Module
;
}
#
define
XRE_USER_APP_DATA_DIR
"
UAppData
"
#
define
XRE_EXECUTABLE_FILE
"
XREExeF
"
#
define
NS_APP_PROFILE_DIR_STARTUP
"
ProfDS
"
#
define
NS_APP_PROFILE_LOCAL_DIR_STARTUP
"
ProfLDS
"
#
define
XRE_SYS_LOCAL_EXTENSION_PARENT_DIR
"
XRESysLExtPD
"
#
define
XRE_SYS_SHARE_EXTENSION_PARENT_DIR
"
XRESysSExtPD
"
#
if
defined
(
XP_UNIX
)
|
|
defined
(
XP_MACOSX
)
#
define
XRE_SYS_NATIVE_MANIFESTS
"
XRESysNativeManifests
"
#
define
XRE_USER_NATIVE_MANIFESTS
"
XREUserNativeManifests
"
#
endif
#
define
XRE_USER_SYS_EXTENSION_DIR
"
XREUSysExt
"
#
define
XRE_USER_SYS_EXTENSION_DEV_DIR
"
XRESysExtDev
"
#
define
XRE_APP_DISTRIBUTION_DIR
"
XREAppDist
"
#
define
XRE_APP_FEATURES_DIR
"
XREAppFeat
"
#
define
XRE_ADDON_APP_DIR
"
XREAddonAppDir
"
#
define
XRE_USER_RUNTIME_DIR
"
XREUserRunTimeDir
"
#
define
XRE_UPDATE_ROOT_DIR
"
UpdRootD
"
#
define
XRE_OLD_UPDATE_ROOT_DIR
"
OldUpdRootD
"
XRE_API
(
int
XRE_main
(
int
argc
char
*
argv
[
]
const
mozilla
:
:
BootstrapConfig
&
aConfig
)
)
XRE_API
(
nsresult
XRE_GetFileFromPath
(
const
char
*
aPath
nsIFile
*
*
aResult
)
)
XRE_API
(
nsresult
XRE_GetBinaryPath
(
nsIFile
*
*
aResult
)
)
XRE_API
(
const
mozilla
:
:
Module
*
XRE_GetStaticModule
(
)
)
XRE_API
(
nsresult
XRE_LockProfileDirectory
(
nsIFile
*
aDirectory
nsISupports
*
*
aLockObject
)
)
XRE_API
(
nsresult
XRE_InitEmbedding2
(
nsIFile
*
aLibXULDirectory
nsIFile
*
aAppDirectory
nsIDirectoryServiceProvider
*
aAppDirProvider
)
)
XRE_API
(
nsresult
XRE_AddStaticComponent
(
const
mozilla
:
:
Module
*
aComponent
)
)
enum
NSLocationType
{
NS_APP_LOCATION
NS_EXTENSION_LOCATION
NS_SKIN_LOCATION
NS_BOOTSTRAPPED_LOCATION
}
;
XRE_API
(
nsresult
XRE_AddManifestLocation
(
NSLocationType
aType
nsIFile
*
aLocation
)
)
XRE_API
(
nsresult
XRE_AddJarManifestLocation
(
NSLocationType
aType
nsIFile
*
aLocation
)
)
XRE_API
(
void
XRE_NotifyProfile
(
)
)
XRE_API
(
void
XRE_TermEmbedding
(
)
)
XRE_API
(
nsresult
XRE_ParseAppData
(
nsIFile
*
aINIFile
mozilla
:
:
XREAppData
&
aAppData
)
)
enum
GeckoProcessType
{
#
define
GECKO_PROCESS_TYPE
(
enum_name
string_name
xre_name
bin_type
)
\
GeckoProcessType_
#
#
enum_name
#
include
"
mozilla
/
GeckoProcessTypes
.
h
"
#
undef
GECKO_PROCESS_TYPE
GeckoProcessType_End
GeckoProcessType_Invalid
=
GeckoProcessType_End
}
;
static
const
char
*
const
kGeckoProcessTypeString
[
]
=
{
#
define
GECKO_PROCESS_TYPE
(
enum_name
string_name
xre_name
bin_type
)
\
string_name
#
include
"
mozilla
/
GeckoProcessTypes
.
h
"
#
undef
GECKO_PROCESS_TYPE
}
;
static_assert
(
MOZ_ARRAY_LENGTH
(
kGeckoProcessTypeString
)
=
=
GeckoProcessType_End
"
Array
length
mismatch
"
)
;
XRE_API
(
const
char
*
XRE_GeckoProcessTypeToString
(
GeckoProcessType
aProcessType
)
)
XRE_API
(
const
char
*
XRE_ChildProcessTypeToAnnotation
(
GeckoProcessType
aProcessType
)
)
#
if
defined
(
MOZ_WIDGET_ANDROID
)
struct
XRE_AndroidChildFds
{
int
mPrefsFd
;
int
mPrefMapFd
;
int
mIpcFd
;
int
mCrashFd
;
int
mCrashAnnotationFd
;
}
;
XRE_API
(
void
XRE_SetAndroidChildFds
(
JNIEnv
*
env
const
XRE_AndroidChildFds
&
fds
)
)
#
endif
XRE_API
(
void
XRE_SetProcessType
(
const
char
*
aProcessTypeString
)
)
XRE_API
(
nsresult
XRE_InitChildProcess
(
int
aArgc
char
*
aArgv
[
]
const
XREChildData
*
aChildData
)
)
XRE_API
(
GeckoProcessType
XRE_GetProcessType
(
)
)
XRE_API
(
const
char
*
XRE_GetProcessTypeString
(
)
)
XRE_API
(
bool
XRE_IsE10sParentProcess
(
)
)
#
define
GECKO_PROCESS_TYPE
(
enum_name
string_name
xre_name
bin_type
)
\
XRE_API
(
bool
XRE_Is
#
#
xre_name
#
#
Process
(
)
)
#
include
"
mozilla
/
GeckoProcessTypes
.
h
"
#
undef
GECKO_PROCESS_TYPE
XRE_API
(
bool
XRE_IsSocketProcess
(
)
)
XRE_API
(
bool
XRE_UseNativeEventProcessing
(
)
)
typedef
void
(
*
MainFunction
)
(
void
*
aData
)
;
XRE_API
(
nsresult
XRE_InitParentProcess
(
int
aArgc
char
*
aArgv
[
]
MainFunction
aMainFunction
void
*
aMainFunctionExtraData
)
)
XRE_API
(
int
XRE_RunIPDLTest
(
int
aArgc
char
*
aArgv
[
]
)
)
XRE_API
(
nsresult
XRE_RunAppShell
(
)
)
XRE_API
(
nsresult
XRE_InitCommandLine
(
int
aArgc
char
*
aArgv
[
]
)
)
XRE_API
(
nsresult
XRE_DeinitCommandLine
(
)
)
XRE_API
(
void
XRE_ShutdownChildProcess
(
)
)
XRE_API
(
MessageLoop
*
XRE_GetIOMessageLoop
(
)
)
XRE_API
(
bool
XRE_SendTestShellCommand
(
JSContext
*
aCx
JSString
*
aCommand
JS
:
:
Value
*
aCallback
)
)
XRE_API
(
bool
XRE_ShutdownTestShell
(
)
)
XRE_API
(
void
XRE_InstallX11ErrorHandler
(
)
)
XRE_API
(
void
XRE_TelemetryAccumulate
(
int
aID
uint32_t
aSample
)
)
XRE_API
(
void
XRE_StartupTimelineRecord
(
int
aEvent
mozilla
:
:
TimeStamp
aWhen
)
)
XRE_API
(
void
XRE_InitOmnijar
(
nsIFile
*
aGreOmni
nsIFile
*
aAppOmni
)
)
XRE_API
(
void
XRE_StopLateWriteChecks
(
void
)
)
XRE_API
(
void
XRE_EnableSameExecutableForContentProc
(
)
)
namespace
mozilla
{
enum
class
BinPathType
{
Self
PluginContainer
}
;
}
XRE_API
(
mozilla
:
:
BinPathType
XRE_GetChildProcBinPathType
(
GeckoProcessType
aProcessType
)
)
;
XRE_API
(
int
XRE_XPCShellMain
(
int
argc
char
*
*
argv
char
*
*
envp
const
XREShellData
*
aShellData
)
)
#
ifdef
LIBFUZZER
#
include
"
FuzzerRegistry
.
h
"
XRE_API
(
void
XRE_LibFuzzerSetDriver
(
LibFuzzerDriver
)
)
#
endif
#
ifdef
MOZ_ENABLE_FORKSERVER
XRE_API
(
int
XRE_ForkServer
(
int
*
aArgc
char
*
*
*
aArgv
)
)
#
endif
#
endif
