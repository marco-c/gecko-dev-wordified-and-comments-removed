#
include
"
nsObjCExceptions
.
h
"
#
import
<
Foundation
/
Foundation
.
h
>
#
include
<
unistd
.
h
>
#
include
<
signal
.
h
>
#
include
"
nsICrashReporter
.
h
"
#
include
"
nsCOMPtr
.
h
"
#
include
"
nsServiceManagerUtils
.
h
"
#
include
"
nsError
.
h
"
void
nsObjCExceptionLog
(
NSException
*
aException
)
{
NSLog
(
"
Mozilla
has
caught
an
Obj
-
C
exception
[
%
:
%
]
"
[
aException
name
]
[
aException
reason
]
)
;
nsCOMPtr
<
nsICrashReporter
>
crashReporter
=
do_GetService
(
"
mozilla
.
org
/
toolkit
/
crash
-
reporter
;
1
"
)
;
if
(
crashReporter
)
{
crashReporter
-
>
AppendObjCExceptionInfoToAppNotes
(
static_cast
<
void
*
>
(
aException
)
)
;
}
#
ifdef
DEBUG
NSLog
(
"
Stack
trace
:
\
n
%
"
[
aException
callStackSymbols
]
)
;
#
endif
}
namespace
mozilla
{
bool
ShouldIgnoreObjCException
(
NSException
*
aException
)
{
if
(
aException
.
name
=
=
NSInternalInconsistencyException
)
{
if
(
[
aException
.
reason
containsString
:
"
Missing
Touches
.
"
]
)
{
return
true
;
}
}
return
false
;
}
}
