#
include
"
AvailableMemoryWatcher
.
h
"
#
include
"
mozilla
/
ClearOnShutdown
.
h
"
#
include
"
mozilla
/
RefPtr
.
h
"
#
include
"
mozilla
/
StaticPtr
.
h
"
#
include
"
nsXULAppAPI
.
h
"
namespace
mozilla
{
StaticRefPtr
<
nsAvailableMemoryWatcherBase
>
nsAvailableMemoryWatcherBase
:
:
sSingleton
;
already_AddRefed
<
nsAvailableMemoryWatcherBase
>
nsAvailableMemoryWatcherBase
:
:
GetSingleton
(
)
{
if
(
!
sSingleton
)
{
sSingleton
=
CreateAvailableMemoryWatcher
(
)
;
ClearOnShutdown
(
&
sSingleton
)
;
}
return
do_AddRef
(
sSingleton
)
;
}
NS_IMPL_ISUPPORTS
(
nsAvailableMemoryWatcherBase
nsIAvailableMemoryWatcherBase
)
;
nsAvailableMemoryWatcherBase
:
:
nsAvailableMemoryWatcherBase
(
)
{
MOZ_ASSERT
(
XRE_IsParentProcess
(
)
"
Watching
memory
only
in
the
main
process
.
"
)
;
}
#
if
!
defined
(
XP_WIN
)
already_AddRefed
<
nsAvailableMemoryWatcherBase
>
CreateAvailableMemoryWatcher
(
)
{
RefPtr
instance
(
new
nsAvailableMemoryWatcherBase
)
;
return
do_AddRef
(
instance
)
;
}
#
endif
}
