#
ifndef
_nsLocalFileWIN_H_
#
define
_nsLocalFileWIN_H_
#
include
"
nscore
.
h
"
#
include
"
nsError
.
h
"
#
include
"
nsString
.
h
"
#
include
"
nsCRT
.
h
"
#
include
"
nsIFile
.
h
"
#
include
"
nsILocalFileWin
.
h
"
#
include
"
nsIClassInfoImpl
.
h
"
#
include
"
prio
.
h
"
#
include
"
mozilla
/
Attributes
.
h
"
#
include
<
windows
.
h
>
#
include
<
shlobj
.
h
>
#
include
<
sys
/
stat
.
h
>
class
nsLocalFile
final
:
public
nsILocalFileWin
{
public
:
NS_DEFINE_STATIC_CID_ACCESSOR
(
NS_LOCAL_FILE_CID
)
nsLocalFile
(
)
;
static
nsresult
nsLocalFileConstructor
(
const
nsIID
&
aIID
void
*
*
aInstancePtr
)
;
NS_DECL_THREADSAFE_ISUPPORTS
NS_DECL_NSIFILE
NS_DECL_NSILOCALFILEWIN
public
:
static
bool
CleanupCmdHandlerPath
(
nsAString
&
aCommandHandler
)
;
static
nsresult
RevealFile
(
const
nsString
&
aResolvedPath
)
;
static
bool
CheckForReservedFileName
(
const
nsString
&
aFileName
)
;
struct
FileInfo
{
PRFileType
type
;
PROffset64
size
;
PRTime
creationTime
;
PRTime
accessTime
;
PRTime
modifyTime
;
}
;
private
:
enum
CopyFileOption
{
FollowSymlinks
=
1u
<
<
0
Move
=
1u
<
<
1
SkipNtfsAclReset
=
1u
<
<
2
Rename
=
1u
<
<
3
}
;
nsLocalFile
(
const
nsLocalFile
&
aOther
)
;
~
nsLocalFile
(
)
{
}
bool
mDirty
;
bool
mResolveDirty
;
bool
mUseDOSDevicePathSyntax
;
nsString
mWorkingPath
;
nsString
mResolvedPath
;
nsString
mShortWorkingPath
;
FileInfo
mFileInfo
;
void
MakeDirty
(
)
{
mDirty
=
true
;
mResolveDirty
=
true
;
mShortWorkingPath
.
Truncate
(
)
;
}
nsresult
LookupExtensionIn
(
const
char
*
const
*
aExtensionsArray
size_t
aArrayLength
bool
*
aResult
)
;
nsresult
ResolveAndStat
(
)
;
nsresult
Resolve
(
)
;
nsresult
ResolveSymlink
(
)
;
void
EnsureShortPath
(
)
;
nsresult
CopyMove
(
nsIFile
*
aNewParentDir
const
nsAString
&
aNewName
uint32_t
aOptions
)
;
nsresult
MoveOrCopyAsSingleFileOrDir
(
nsIFile
*
aDest
const
nsAString
&
aNewName
uint32_t
aOptions
)
;
enum
class
TimeField
{
AccessedTime
ModifiedTime
}
;
nsresult
SetDateImpl
(
int64_t
aTime
TimeField
aTimeField
)
;
nsresult
GetDateImpl
(
PRTime
*
aTime
TimeField
aTimeField
bool
aFollowLinks
)
;
nsresult
HasFileAttribute
(
DWORD
aFileAttrib
bool
*
aResult
)
;
nsresult
AppendInternal
(
const
nsString
&
aNode
bool
aMultipleComponents
)
;
nsresult
OpenNSPRFileDescMaybeShareDelete
(
int32_t
aFlags
int32_t
aMode
bool
aShareDelete
PRFileDesc
*
*
aResult
)
;
}
;
#
endif
