#
include
"
gtest
/
gtest
.
h
"
#
include
"
.
.
/
.
.
/
io
/
nsSegmentedBuffer
.
h
"
#
include
"
nsIEventTarget
.
h
"
using
namespace
mozilla
;
TEST
(
SegmentedBuffer
AppendAndDelete
)
{
auto
buf
=
MakeUnique
<
nsSegmentedBuffer
>
(
)
;
buf
-
>
Init
(
4
16
)
;
char
*
seg
;
bool
empty
;
seg
=
buf
-
>
AppendNewSegment
(
)
;
EXPECT_TRUE
(
seg
)
<
<
"
AppendNewSegment
failed
"
;
seg
=
buf
-
>
AppendNewSegment
(
)
;
EXPECT_TRUE
(
seg
)
<
<
"
AppendNewSegment
failed
"
;
seg
=
buf
-
>
AppendNewSegment
(
)
;
EXPECT_TRUE
(
seg
)
<
<
"
AppendNewSegment
failed
"
;
empty
=
buf
-
>
DeleteFirstSegment
(
)
;
EXPECT_TRUE
(
!
empty
)
<
<
"
DeleteFirstSegment
failed
"
;
empty
=
buf
-
>
DeleteFirstSegment
(
)
;
EXPECT_TRUE
(
!
empty
)
<
<
"
DeleteFirstSegment
failed
"
;
seg
=
buf
-
>
AppendNewSegment
(
)
;
EXPECT_TRUE
(
seg
)
<
<
"
AppendNewSegment
failed
"
;
seg
=
buf
-
>
AppendNewSegment
(
)
;
EXPECT_TRUE
(
seg
)
<
<
"
AppendNewSegment
failed
"
;
seg
=
buf
-
>
AppendNewSegment
(
)
;
EXPECT_TRUE
(
seg
)
<
<
"
AppendNewSegment
failed
"
;
empty
=
buf
-
>
DeleteFirstSegment
(
)
;
EXPECT_TRUE
(
!
empty
)
<
<
"
DeleteFirstSegment
failed
"
;
empty
=
buf
-
>
DeleteFirstSegment
(
)
;
EXPECT_TRUE
(
!
empty
)
<
<
"
DeleteFirstSegment
failed
"
;
empty
=
buf
-
>
DeleteFirstSegment
(
)
;
EXPECT_TRUE
(
!
empty
)
<
<
"
DeleteFirstSegment
failed
"
;
empty
=
buf
-
>
DeleteFirstSegment
(
)
;
EXPECT_TRUE
(
empty
)
<
<
"
DeleteFirstSegment
failed
"
;
}
