#
include
"
nsEscape
.
h
"
#
include
"
gtest
/
gtest
.
h
"
using
namespace
mozilla
;
TEST
(
EscapeURL
FallibleNoEscape
)
{
nsCString
toEscape
(
"
data
:
Hello
%
2C
%
20World
!
"
)
;
nsCString
escaped
;
nsresult
rv
=
NS_EscapeURL
(
toEscape
esc_OnlyNonASCII
escaped
fallible
)
;
EXPECT_EQ
(
rv
NS_OK
)
;
EXPECT_STREQ
(
toEscape
.
BeginReading
(
)
escaped
.
BeginReading
(
)
)
;
EXPECT_EQ
(
toEscape
.
BeginReading
(
)
escaped
.
BeginReading
(
)
)
;
}
TEST
(
EscapeURL
FallibleEscape
)
{
nsCString
toEscape
(
"
data
:
Hello
%
2C
%
20World
!
\
xC4
\
x9F
"
)
;
nsCString
escaped
;
nsresult
rv
=
NS_EscapeURL
(
toEscape
esc_OnlyNonASCII
escaped
fallible
)
;
EXPECT_EQ
(
rv
NS_OK
)
;
EXPECT_STRNE
(
toEscape
.
BeginReading
(
)
escaped
.
BeginReading
(
)
)
;
const
char
*
const
kExpected
=
"
data
:
Hello
%
2C
%
20World
!
%
C4
%
9F
"
;
EXPECT_STREQ
(
escaped
.
BeginReading
(
)
kExpected
)
;
}
