package
org
.
mozilla
.
thirdparty
.
com
.
google
.
android
.
exoplayer2
;
import
android
.
annotation
.
SuppressLint
;
import
android
.
content
.
Context
;
import
android
.
os
.
PowerManager
;
import
android
.
os
.
PowerManager
.
WakeLock
;
import
androidx
.
annotation
.
Nullable
;
import
org
.
mozilla
.
thirdparty
.
com
.
google
.
android
.
exoplayer2
.
util
.
Log
;
final
class
WakeLockManager
{
private
static
final
String
TAG
=
"
WakeLockManager
"
;
private
static
final
String
WAKE_LOCK_TAG
=
"
ExoPlayer
:
WakeLockManager
"
;
Nullable
private
final
PowerManager
powerManager
;
Nullable
private
WakeLock
wakeLock
;
private
boolean
enabled
;
private
boolean
stayAwake
;
public
WakeLockManager
(
Context
context
)
{
powerManager
=
(
PowerManager
)
context
.
getApplicationContext
(
)
.
getSystemService
(
Context
.
POWER_SERVICE
)
;
}
public
void
setEnabled
(
boolean
enabled
)
{
if
(
enabled
)
{
if
(
wakeLock
=
=
null
)
{
if
(
powerManager
=
=
null
)
{
Log
.
w
(
TAG
"
PowerManager
is
null
therefore
not
creating
the
WakeLock
.
"
)
;
return
;
}
wakeLock
=
powerManager
.
newWakeLock
(
PowerManager
.
PARTIAL_WAKE_LOCK
WAKE_LOCK_TAG
)
;
wakeLock
.
setReferenceCounted
(
false
)
;
}
}
this
.
enabled
=
enabled
;
updateWakeLock
(
)
;
}
public
void
setStayAwake
(
boolean
stayAwake
)
{
this
.
stayAwake
=
stayAwake
;
updateWakeLock
(
)
;
}
SuppressLint
(
"
WakelockTimeout
"
)
private
void
updateWakeLock
(
)
{
if
(
wakeLock
=
=
null
)
{
return
;
}
if
(
enabled
&
&
stayAwake
)
{
wakeLock
.
acquire
(
)
;
}
else
{
wakeLock
.
release
(
)
;
}
}
}
