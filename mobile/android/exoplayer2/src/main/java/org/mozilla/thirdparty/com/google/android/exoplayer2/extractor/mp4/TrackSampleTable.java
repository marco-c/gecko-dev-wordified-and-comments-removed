package
org
.
mozilla
.
thirdparty
.
com
.
google
.
android
.
exoplayer2
.
extractor
.
mp4
;
import
org
.
mozilla
.
thirdparty
.
com
.
google
.
android
.
exoplayer2
.
C
;
import
org
.
mozilla
.
thirdparty
.
com
.
google
.
android
.
exoplayer2
.
util
.
Assertions
;
import
org
.
mozilla
.
thirdparty
.
com
.
google
.
android
.
exoplayer2
.
util
.
Util
;
final
class
TrackSampleTable
{
public
final
Track
track
;
public
final
int
sampleCount
;
public
final
long
[
]
offsets
;
public
final
int
[
]
sizes
;
public
final
int
maximumSize
;
public
final
long
[
]
timestampsUs
;
public
final
int
[
]
flags
;
public
final
long
durationUs
;
public
TrackSampleTable
(
Track
track
long
[
]
offsets
int
[
]
sizes
int
maximumSize
long
[
]
timestampsUs
int
[
]
flags
long
durationUs
)
{
Assertions
.
checkArgument
(
sizes
.
length
=
=
timestampsUs
.
length
)
;
Assertions
.
checkArgument
(
offsets
.
length
=
=
timestampsUs
.
length
)
;
Assertions
.
checkArgument
(
flags
.
length
=
=
timestampsUs
.
length
)
;
this
.
track
=
track
;
this
.
offsets
=
offsets
;
this
.
sizes
=
sizes
;
this
.
maximumSize
=
maximumSize
;
this
.
timestampsUs
=
timestampsUs
;
this
.
flags
=
flags
;
this
.
durationUs
=
durationUs
;
sampleCount
=
offsets
.
length
;
if
(
flags
.
length
>
0
)
{
flags
[
flags
.
length
-
1
]
|
=
C
.
BUFFER_FLAG_LAST_SAMPLE
;
}
}
public
int
getIndexOfEarlierOrEqualSynchronizationSample
(
long
timeUs
)
{
int
startIndex
=
Util
.
binarySearchFloor
(
timestampsUs
timeUs
true
false
)
;
for
(
int
i
=
startIndex
;
i
>
=
0
;
i
-
-
)
{
if
(
(
flags
[
i
]
&
C
.
BUFFER_FLAG_KEY_FRAME
)
!
=
0
)
{
return
i
;
}
}
return
C
.
INDEX_UNSET
;
}
public
int
getIndexOfLaterOrEqualSynchronizationSample
(
long
timeUs
)
{
int
startIndex
=
Util
.
binarySearchCeil
(
timestampsUs
timeUs
true
false
)
;
for
(
int
i
=
startIndex
;
i
<
timestampsUs
.
length
;
i
+
+
)
{
if
(
(
flags
[
i
]
&
C
.
BUFFER_FLAG_KEY_FRAME
)
!
=
0
)
{
return
i
;
}
}
return
C
.
INDEX_UNSET
;
}
}
