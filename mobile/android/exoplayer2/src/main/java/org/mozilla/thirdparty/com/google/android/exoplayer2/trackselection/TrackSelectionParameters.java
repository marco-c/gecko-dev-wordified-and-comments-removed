package
org
.
mozilla
.
thirdparty
.
com
.
google
.
android
.
exoplayer2
.
trackselection
;
import
android
.
annotation
.
TargetApi
;
import
android
.
content
.
Context
;
import
android
.
os
.
Looper
;
import
android
.
os
.
Parcel
;
import
android
.
os
.
Parcelable
;
import
android
.
text
.
TextUtils
;
import
android
.
view
.
accessibility
.
CaptioningManager
;
import
androidx
.
annotation
.
Nullable
;
import
org
.
mozilla
.
thirdparty
.
com
.
google
.
android
.
exoplayer2
.
C
;
import
org
.
mozilla
.
thirdparty
.
com
.
google
.
android
.
exoplayer2
.
util
.
Util
;
import
java
.
util
.
Locale
;
public
class
TrackSelectionParameters
implements
Parcelable
{
public
static
class
Builder
{
Nullable
String
preferredAudioLanguage
;
Nullable
String
preferredTextLanguage
;
C
.
RoleFlags
int
preferredTextRoleFlags
;
boolean
selectUndeterminedTextLanguage
;
C
.
SelectionFlags
int
disabledTextTrackSelectionFlags
;
SuppressWarnings
(
{
"
deprecation
"
"
initialization
:
method
.
invocation
.
invalid
"
}
)
public
Builder
(
Context
context
)
{
this
(
)
;
setPreferredTextLanguageAndRoleFlagsToCaptioningManagerSettings
(
context
)
;
}
Deprecated
public
Builder
(
)
{
preferredAudioLanguage
=
null
;
preferredTextLanguage
=
null
;
preferredTextRoleFlags
=
0
;
selectUndeterminedTextLanguage
=
false
;
disabledTextTrackSelectionFlags
=
0
;
}
Builder
(
TrackSelectionParameters
initialValues
)
{
preferredAudioLanguage
=
initialValues
.
preferredAudioLanguage
;
preferredTextLanguage
=
initialValues
.
preferredTextLanguage
;
preferredTextRoleFlags
=
initialValues
.
preferredTextRoleFlags
;
selectUndeterminedTextLanguage
=
initialValues
.
selectUndeterminedTextLanguage
;
disabledTextTrackSelectionFlags
=
initialValues
.
disabledTextTrackSelectionFlags
;
}
public
Builder
setPreferredAudioLanguage
(
Nullable
String
preferredAudioLanguage
)
{
this
.
preferredAudioLanguage
=
preferredAudioLanguage
;
return
this
;
}
public
Builder
setPreferredTextLanguageAndRoleFlagsToCaptioningManagerSettings
(
Context
context
)
{
if
(
Util
.
SDK_INT
>
=
19
)
{
setPreferredTextLanguageAndRoleFlagsToCaptioningManagerSettingsV19
(
context
)
;
}
return
this
;
}
public
Builder
setPreferredTextLanguage
(
Nullable
String
preferredTextLanguage
)
{
this
.
preferredTextLanguage
=
preferredTextLanguage
;
return
this
;
}
public
Builder
setPreferredTextRoleFlags
(
C
.
RoleFlags
int
preferredTextRoleFlags
)
{
this
.
preferredTextRoleFlags
=
preferredTextRoleFlags
;
return
this
;
}
public
Builder
setSelectUndeterminedTextLanguage
(
boolean
selectUndeterminedTextLanguage
)
{
this
.
selectUndeterminedTextLanguage
=
selectUndeterminedTextLanguage
;
return
this
;
}
public
Builder
setDisabledTextTrackSelectionFlags
(
C
.
SelectionFlags
int
disabledTextTrackSelectionFlags
)
{
this
.
disabledTextTrackSelectionFlags
=
disabledTextTrackSelectionFlags
;
return
this
;
}
public
TrackSelectionParameters
build
(
)
{
return
new
TrackSelectionParameters
(
preferredAudioLanguage
preferredTextLanguage
preferredTextRoleFlags
selectUndeterminedTextLanguage
disabledTextTrackSelectionFlags
)
;
}
TargetApi
(
19
)
private
void
setPreferredTextLanguageAndRoleFlagsToCaptioningManagerSettingsV19
(
Context
context
)
{
if
(
Util
.
SDK_INT
<
23
&
&
Looper
.
myLooper
(
)
=
=
null
)
{
return
;
}
CaptioningManager
captioningManager
=
(
CaptioningManager
)
context
.
getSystemService
(
Context
.
CAPTIONING_SERVICE
)
;
if
(
captioningManager
=
=
null
|
|
!
captioningManager
.
isEnabled
(
)
)
{
return
;
}
preferredTextRoleFlags
=
C
.
ROLE_FLAG_CAPTION
|
C
.
ROLE_FLAG_DESCRIBES_MUSIC_AND_SOUND
;
Locale
preferredLocale
=
captioningManager
.
getLocale
(
)
;
if
(
preferredLocale
!
=
null
)
{
preferredTextLanguage
=
Util
.
getLocaleLanguageTag
(
preferredLocale
)
;
}
}
}
SuppressWarnings
(
"
deprecation
"
)
public
static
final
TrackSelectionParameters
DEFAULT_WITHOUT_CONTEXT
=
new
Builder
(
)
.
build
(
)
;
Deprecated
public
static
final
TrackSelectionParameters
DEFAULT
=
DEFAULT_WITHOUT_CONTEXT
;
public
static
TrackSelectionParameters
getDefaults
(
Context
context
)
{
return
new
Builder
(
context
)
.
build
(
)
;
}
Nullable
public
final
String
preferredAudioLanguage
;
Nullable
public
final
String
preferredTextLanguage
;
C
.
RoleFlags
public
final
int
preferredTextRoleFlags
;
public
final
boolean
selectUndeterminedTextLanguage
;
C
.
SelectionFlags
public
final
int
disabledTextTrackSelectionFlags
;
TrackSelectionParameters
(
Nullable
String
preferredAudioLanguage
Nullable
String
preferredTextLanguage
C
.
RoleFlags
int
preferredTextRoleFlags
boolean
selectUndeterminedTextLanguage
C
.
SelectionFlags
int
disabledTextTrackSelectionFlags
)
{
this
.
preferredAudioLanguage
=
Util
.
normalizeLanguageCode
(
preferredAudioLanguage
)
;
this
.
preferredTextLanguage
=
Util
.
normalizeLanguageCode
(
preferredTextLanguage
)
;
this
.
preferredTextRoleFlags
=
preferredTextRoleFlags
;
this
.
selectUndeterminedTextLanguage
=
selectUndeterminedTextLanguage
;
this
.
disabledTextTrackSelectionFlags
=
disabledTextTrackSelectionFlags
;
}
TrackSelectionParameters
(
Parcel
in
)
{
this
.
preferredAudioLanguage
=
in
.
readString
(
)
;
this
.
preferredTextLanguage
=
in
.
readString
(
)
;
this
.
preferredTextRoleFlags
=
in
.
readInt
(
)
;
this
.
selectUndeterminedTextLanguage
=
Util
.
readBoolean
(
in
)
;
this
.
disabledTextTrackSelectionFlags
=
in
.
readInt
(
)
;
}
public
Builder
buildUpon
(
)
{
return
new
Builder
(
this
)
;
}
Override
SuppressWarnings
(
"
EqualsGetClass
"
)
public
boolean
equals
(
Nullable
Object
obj
)
{
if
(
this
=
=
obj
)
{
return
true
;
}
if
(
obj
=
=
null
|
|
getClass
(
)
!
=
obj
.
getClass
(
)
)
{
return
false
;
}
TrackSelectionParameters
other
=
(
TrackSelectionParameters
)
obj
;
return
TextUtils
.
equals
(
preferredAudioLanguage
other
.
preferredAudioLanguage
)
&
&
TextUtils
.
equals
(
preferredTextLanguage
other
.
preferredTextLanguage
)
&
&
preferredTextRoleFlags
=
=
other
.
preferredTextRoleFlags
&
&
selectUndeterminedTextLanguage
=
=
other
.
selectUndeterminedTextLanguage
&
&
disabledTextTrackSelectionFlags
=
=
other
.
disabledTextTrackSelectionFlags
;
}
Override
public
int
hashCode
(
)
{
int
result
=
1
;
result
=
31
*
result
+
(
preferredAudioLanguage
=
=
null
?
0
:
preferredAudioLanguage
.
hashCode
(
)
)
;
result
=
31
*
result
+
(
preferredTextLanguage
=
=
null
?
0
:
preferredTextLanguage
.
hashCode
(
)
)
;
result
=
31
*
result
+
preferredTextRoleFlags
;
result
=
31
*
result
+
(
selectUndeterminedTextLanguage
?
1
:
0
)
;
result
=
31
*
result
+
disabledTextTrackSelectionFlags
;
return
result
;
}
Override
public
int
describeContents
(
)
{
return
0
;
}
Override
public
void
writeToParcel
(
Parcel
dest
int
flags
)
{
dest
.
writeString
(
preferredAudioLanguage
)
;
dest
.
writeString
(
preferredTextLanguage
)
;
dest
.
writeInt
(
preferredTextRoleFlags
)
;
Util
.
writeBoolean
(
dest
selectUndeterminedTextLanguage
)
;
dest
.
writeInt
(
disabledTextTrackSelectionFlags
)
;
}
public
static
final
Creator
<
TrackSelectionParameters
>
CREATOR
=
new
Creator
<
TrackSelectionParameters
>
(
)
{
Override
public
TrackSelectionParameters
createFromParcel
(
Parcel
in
)
{
return
new
TrackSelectionParameters
(
in
)
;
}
Override
public
TrackSelectionParameters
[
]
newArray
(
int
size
)
{
return
new
TrackSelectionParameters
[
size
]
;
}
}
;
}
