package
org
.
mozilla
.
thirdparty
.
com
.
google
.
android
.
exoplayer2
.
text
;
import
androidx
.
annotation
.
Nullable
;
import
org
.
mozilla
.
thirdparty
.
com
.
google
.
android
.
exoplayer2
.
C
;
import
org
.
mozilla
.
thirdparty
.
com
.
google
.
android
.
exoplayer2
.
decoder
.
SimpleDecoder
;
import
org
.
mozilla
.
thirdparty
.
com
.
google
.
android
.
exoplayer2
.
util
.
Assertions
;
import
java
.
nio
.
ByteBuffer
;
public
abstract
class
SimpleSubtitleDecoder
extends
SimpleDecoder
<
SubtitleInputBuffer
SubtitleOutputBuffer
SubtitleDecoderException
>
implements
SubtitleDecoder
{
private
final
String
name
;
SuppressWarnings
(
"
initialization
:
method
.
invocation
.
invalid
"
)
protected
SimpleSubtitleDecoder
(
String
name
)
{
super
(
new
SubtitleInputBuffer
[
2
]
new
SubtitleOutputBuffer
[
2
]
)
;
this
.
name
=
name
;
setInitialInputBufferSize
(
1024
)
;
}
Override
public
final
String
getName
(
)
{
return
name
;
}
Override
public
void
setPositionUs
(
long
timeUs
)
{
}
Override
protected
final
SubtitleInputBuffer
createInputBuffer
(
)
{
return
new
SubtitleInputBuffer
(
)
;
}
Override
protected
final
SubtitleOutputBuffer
createOutputBuffer
(
)
{
return
new
SimpleSubtitleOutputBuffer
(
this
)
;
}
Override
protected
final
SubtitleDecoderException
createUnexpectedDecodeException
(
Throwable
error
)
{
return
new
SubtitleDecoderException
(
"
Unexpected
decode
error
"
error
)
;
}
Override
protected
final
void
releaseOutputBuffer
(
SubtitleOutputBuffer
buffer
)
{
super
.
releaseOutputBuffer
(
buffer
)
;
}
SuppressWarnings
(
"
ByteBufferBackingArray
"
)
Override
Nullable
protected
final
SubtitleDecoderException
decode
(
SubtitleInputBuffer
inputBuffer
SubtitleOutputBuffer
outputBuffer
boolean
reset
)
{
try
{
ByteBuffer
inputData
=
Assertions
.
checkNotNull
(
inputBuffer
.
data
)
;
Subtitle
subtitle
=
decode
(
inputData
.
array
(
)
inputData
.
limit
(
)
reset
)
;
outputBuffer
.
setContent
(
inputBuffer
.
timeUs
subtitle
inputBuffer
.
subsampleOffsetUs
)
;
outputBuffer
.
clearFlag
(
C
.
BUFFER_FLAG_DECODE_ONLY
)
;
return
null
;
}
catch
(
SubtitleDecoderException
e
)
{
return
e
;
}
}
protected
abstract
Subtitle
decode
(
byte
[
]
data
int
size
boolean
reset
)
throws
SubtitleDecoderException
;
}
