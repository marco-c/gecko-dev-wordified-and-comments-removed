package
org
.
mozilla
.
thirdparty
.
com
.
google
.
android
.
exoplayer2
.
audio
;
import
static
org
.
mozilla
.
thirdparty
.
com
.
google
.
android
.
exoplayer2
.
util
.
Util
.
castNonNull
;
import
android
.
os
.
Handler
;
import
android
.
os
.
SystemClock
;
import
androidx
.
annotation
.
Nullable
;
import
org
.
mozilla
.
thirdparty
.
com
.
google
.
android
.
exoplayer2
.
C
;
import
org
.
mozilla
.
thirdparty
.
com
.
google
.
android
.
exoplayer2
.
Format
;
import
org
.
mozilla
.
thirdparty
.
com
.
google
.
android
.
exoplayer2
.
Renderer
;
import
org
.
mozilla
.
thirdparty
.
com
.
google
.
android
.
exoplayer2
.
decoder
.
DecoderCounters
;
import
org
.
mozilla
.
thirdparty
.
com
.
google
.
android
.
exoplayer2
.
util
.
Assertions
;
public
interface
AudioRendererEventListener
{
default
void
onAudioEnabled
(
DecoderCounters
counters
)
{
}
default
void
onAudioSessionId
(
int
audioSessionId
)
{
}
default
void
onAudioDecoderInitialized
(
String
decoderName
long
initializedTimestampMs
long
initializationDurationMs
)
{
}
default
void
onAudioInputFormatChanged
(
Format
format
)
{
}
default
void
onAudioSinkUnderrun
(
int
bufferSize
long
bufferSizeMs
long
elapsedSinceLastFeedMs
)
{
}
default
void
onAudioDisabled
(
DecoderCounters
counters
)
{
}
final
class
EventDispatcher
{
Nullable
private
final
Handler
handler
;
Nullable
private
final
AudioRendererEventListener
listener
;
public
EventDispatcher
(
Nullable
Handler
handler
Nullable
AudioRendererEventListener
listener
)
{
this
.
handler
=
listener
!
=
null
?
Assertions
.
checkNotNull
(
handler
)
:
null
;
this
.
listener
=
listener
;
}
public
void
enabled
(
final
DecoderCounters
decoderCounters
)
{
if
(
handler
!
=
null
)
{
handler
.
post
(
(
)
-
>
castNonNull
(
listener
)
.
onAudioEnabled
(
decoderCounters
)
)
;
}
}
public
void
decoderInitialized
(
final
String
decoderName
final
long
initializedTimestampMs
final
long
initializationDurationMs
)
{
if
(
handler
!
=
null
)
{
handler
.
post
(
(
)
-
>
castNonNull
(
listener
)
.
onAudioDecoderInitialized
(
decoderName
initializedTimestampMs
initializationDurationMs
)
)
;
}
}
public
void
inputFormatChanged
(
final
Format
format
)
{
if
(
handler
!
=
null
)
{
handler
.
post
(
(
)
-
>
castNonNull
(
listener
)
.
onAudioInputFormatChanged
(
format
)
)
;
}
}
public
void
audioTrackUnderrun
(
final
int
bufferSize
final
long
bufferSizeMs
final
long
elapsedSinceLastFeedMs
)
{
if
(
handler
!
=
null
)
{
handler
.
post
(
(
)
-
>
castNonNull
(
listener
)
.
onAudioSinkUnderrun
(
bufferSize
bufferSizeMs
elapsedSinceLastFeedMs
)
)
;
}
}
public
void
disabled
(
final
DecoderCounters
counters
)
{
counters
.
ensureUpdated
(
)
;
if
(
handler
!
=
null
)
{
handler
.
post
(
(
)
-
>
{
counters
.
ensureUpdated
(
)
;
castNonNull
(
listener
)
.
onAudioDisabled
(
counters
)
;
}
)
;
}
}
public
void
audioSessionId
(
final
int
audioSessionId
)
{
if
(
handler
!
=
null
)
{
handler
.
post
(
(
)
-
>
castNonNull
(
listener
)
.
onAudioSessionId
(
audioSessionId
)
)
;
}
}
}
}
