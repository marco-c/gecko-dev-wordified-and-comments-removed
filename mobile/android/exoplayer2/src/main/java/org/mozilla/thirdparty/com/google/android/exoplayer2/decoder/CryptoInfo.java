package
org
.
mozilla
.
thirdparty
.
com
.
google
.
android
.
exoplayer2
.
decoder
;
import
android
.
annotation
.
TargetApi
;
import
org
.
mozilla
.
thirdparty
.
com
.
google
.
android
.
exoplayer2
.
C
;
import
org
.
mozilla
.
thirdparty
.
com
.
google
.
android
.
exoplayer2
.
util
.
Util
;
public
final
class
CryptoInfo
{
public
byte
[
]
iv
;
public
byte
[
]
key
;
C
.
CryptoMode
public
int
mode
;
public
int
[
]
numBytesOfClearData
;
public
int
[
]
numBytesOfEncryptedData
;
public
int
numSubSamples
;
public
int
encryptedBlocks
;
public
int
clearBlocks
;
private
final
android
.
media
.
MediaCodec
.
CryptoInfo
frameworkCryptoInfo
;
private
final
PatternHolderV24
patternHolder
;
public
CryptoInfo
(
)
{
frameworkCryptoInfo
=
new
android
.
media
.
MediaCodec
.
CryptoInfo
(
)
;
patternHolder
=
Util
.
SDK_INT
>
=
24
?
new
PatternHolderV24
(
frameworkCryptoInfo
)
:
null
;
}
public
void
set
(
int
numSubSamples
int
[
]
numBytesOfClearData
int
[
]
numBytesOfEncryptedData
byte
[
]
key
byte
[
]
iv
C
.
CryptoMode
int
mode
int
encryptedBlocks
int
clearBlocks
)
{
this
.
numSubSamples
=
numSubSamples
;
this
.
numBytesOfClearData
=
numBytesOfClearData
;
this
.
numBytesOfEncryptedData
=
numBytesOfEncryptedData
;
this
.
key
=
key
;
this
.
iv
=
iv
;
this
.
mode
=
mode
;
this
.
encryptedBlocks
=
encryptedBlocks
;
this
.
clearBlocks
=
clearBlocks
;
frameworkCryptoInfo
.
numSubSamples
=
numSubSamples
;
frameworkCryptoInfo
.
numBytesOfClearData
=
numBytesOfClearData
;
frameworkCryptoInfo
.
numBytesOfEncryptedData
=
numBytesOfEncryptedData
;
frameworkCryptoInfo
.
key
=
key
;
frameworkCryptoInfo
.
iv
=
iv
;
frameworkCryptoInfo
.
mode
=
mode
;
if
(
Util
.
SDK_INT
>
=
24
)
{
patternHolder
.
set
(
encryptedBlocks
clearBlocks
)
;
}
}
public
android
.
media
.
MediaCodec
.
CryptoInfo
getFrameworkCryptoInfo
(
)
{
return
frameworkCryptoInfo
;
}
Deprecated
public
android
.
media
.
MediaCodec
.
CryptoInfo
getFrameworkCryptoInfoV16
(
)
{
return
getFrameworkCryptoInfo
(
)
;
}
TargetApi
(
24
)
private
static
final
class
PatternHolderV24
{
private
final
android
.
media
.
MediaCodec
.
CryptoInfo
frameworkCryptoInfo
;
private
final
android
.
media
.
MediaCodec
.
CryptoInfo
.
Pattern
pattern
;
private
PatternHolderV24
(
android
.
media
.
MediaCodec
.
CryptoInfo
frameworkCryptoInfo
)
{
this
.
frameworkCryptoInfo
=
frameworkCryptoInfo
;
pattern
=
new
android
.
media
.
MediaCodec
.
CryptoInfo
.
Pattern
(
0
0
)
;
}
private
void
set
(
int
encryptedBlocks
int
clearBlocks
)
{
pattern
.
set
(
encryptedBlocks
clearBlocks
)
;
frameworkCryptoInfo
.
setPattern
(
pattern
)
;
}
}
}
