package
org
.
mozilla
.
thirdparty
.
com
.
google
.
android
.
exoplayer2
.
metadata
.
scte35
;
import
android
.
os
.
Parcel
;
import
org
.
mozilla
.
thirdparty
.
com
.
google
.
android
.
exoplayer2
.
C
;
import
org
.
mozilla
.
thirdparty
.
com
.
google
.
android
.
exoplayer2
.
util
.
ParsableByteArray
;
import
org
.
mozilla
.
thirdparty
.
com
.
google
.
android
.
exoplayer2
.
util
.
TimestampAdjuster
;
public
final
class
TimeSignalCommand
extends
SpliceCommand
{
public
final
long
ptsTime
;
public
final
long
playbackPositionUs
;
private
TimeSignalCommand
(
long
ptsTime
long
playbackPositionUs
)
{
this
.
ptsTime
=
ptsTime
;
this
.
playbackPositionUs
=
playbackPositionUs
;
}
static
TimeSignalCommand
parseFromSection
(
ParsableByteArray
sectionData
long
ptsAdjustment
TimestampAdjuster
timestampAdjuster
)
{
long
ptsTime
=
parseSpliceTime
(
sectionData
ptsAdjustment
)
;
long
playbackPositionUs
=
timestampAdjuster
.
adjustTsTimestamp
(
ptsTime
)
;
return
new
TimeSignalCommand
(
ptsTime
playbackPositionUs
)
;
}
static
long
parseSpliceTime
(
ParsableByteArray
sectionData
long
ptsAdjustment
)
{
long
firstByte
=
sectionData
.
readUnsignedByte
(
)
;
long
ptsTime
=
C
.
TIME_UNSET
;
if
(
(
firstByte
&
0x80
)
!
=
0
)
{
ptsTime
=
(
firstByte
&
0x01
)
<
<
32
|
sectionData
.
readUnsignedInt
(
)
;
ptsTime
+
=
ptsAdjustment
;
ptsTime
&
=
0x1FFFFFFFFL
;
}
return
ptsTime
;
}
Override
public
void
writeToParcel
(
Parcel
dest
int
flags
)
{
dest
.
writeLong
(
ptsTime
)
;
dest
.
writeLong
(
playbackPositionUs
)
;
}
public
static
final
Creator
<
TimeSignalCommand
>
CREATOR
=
new
Creator
<
TimeSignalCommand
>
(
)
{
Override
public
TimeSignalCommand
createFromParcel
(
Parcel
in
)
{
return
new
TimeSignalCommand
(
in
.
readLong
(
)
in
.
readLong
(
)
)
;
}
Override
public
TimeSignalCommand
[
]
newArray
(
int
size
)
{
return
new
TimeSignalCommand
[
size
]
;
}
}
;
}
