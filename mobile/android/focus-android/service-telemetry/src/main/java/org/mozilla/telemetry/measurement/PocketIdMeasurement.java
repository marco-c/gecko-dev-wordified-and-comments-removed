package
org
.
mozilla
.
telemetry
.
measurement
;
import
android
.
content
.
SharedPreferences
;
import
org
.
mozilla
.
telemetry
.
config
.
TelemetryConfiguration
;
import
java
.
util
.
UUID
;
public
class
PocketIdMeasurement
extends
TelemetryMeasurement
{
private
static
final
String
FIELD_NAME
=
"
pocketId
"
;
private
static
final
String
PREFERENCE_POCKET_ID
=
"
pocket_id
"
;
private
TelemetryConfiguration
configuration
;
private
String
pocketId
;
public
PocketIdMeasurement
(
TelemetryConfiguration
configuration
)
{
super
(
FIELD_NAME
)
;
this
.
configuration
=
configuration
;
}
Override
public
Object
flush
(
)
{
if
(
pocketId
=
=
null
)
{
pocketId
=
generateClientId
(
configuration
)
;
}
return
pocketId
;
}
private
static
synchronized
String
generateClientId
(
final
TelemetryConfiguration
configuration
)
{
final
SharedPreferences
preferences
=
configuration
.
getSharedPreferences
(
)
;
if
(
preferences
.
contains
(
PREFERENCE_POCKET_ID
)
)
{
return
preferences
.
getString
(
PREFERENCE_POCKET_ID
null
)
;
}
final
String
pocketId
=
UUID
.
randomUUID
(
)
.
toString
(
)
;
preferences
.
edit
(
)
.
putString
(
PREFERENCE_POCKET_ID
pocketId
)
.
apply
(
)
;
return
pocketId
;
}
}
