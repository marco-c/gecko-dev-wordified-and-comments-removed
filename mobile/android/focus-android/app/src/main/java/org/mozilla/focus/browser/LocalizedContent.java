package
org
.
mozilla
.
focus
.
browser
;
import
android
.
content
.
Context
;
import
android
.
content
.
pm
.
PackageInfo
;
import
android
.
content
.
pm
.
PackageManager
;
import
android
.
content
.
res
.
Resources
;
import
android
.
support
.
annotation
.
NonNull
;
import
android
.
support
.
v4
.
util
.
ArrayMap
;
import
android
.
support
.
v4
.
view
.
ViewCompat
;
import
android
.
view
.
View
;
import
android
.
webkit
.
WebView
;
import
org
.
mozilla
.
focus
.
R
;
import
org
.
mozilla
.
focus
.
locale
.
Locales
;
import
org
.
mozilla
.
focus
.
utils
.
HtmlLoader
;
import
org
.
mozilla
.
focus
.
utils
.
SupportUtils
;
import
java
.
util
.
Map
;
public
class
LocalizedContent
{
public
static
final
String
URL_ABOUT
=
"
focus
:
about
"
;
public
static
final
String
URL_RIGHTS
=
"
focus
:
rights
"
;
public
static
boolean
handleInternalContent
(
String
url
WebView
webView
)
{
if
(
URL_ABOUT
.
equals
(
url
)
)
{
loadAbout
(
webView
)
;
return
true
;
}
else
if
(
URL_RIGHTS
.
equals
(
url
)
)
{
loadRights
(
webView
)
;
return
true
;
}
return
false
;
}
private
static
void
loadAbout
(
NonNull
final
WebView
webView
)
{
final
Context
context
=
webView
.
getContext
(
)
;
final
Resources
resources
=
Locales
.
getLocalizedResources
(
context
)
;
final
Map
<
String
String
>
substitutionMap
=
new
ArrayMap
<
>
(
)
;
final
String
appName
=
context
.
getResources
(
)
.
getString
(
R
.
string
.
app_name
)
;
final
String
learnMoreURL
=
SupportUtils
.
getManifestoURL
(
)
;
String
aboutVersion
=
"
"
;
try
{
final
PackageInfo
packageInfo
=
context
.
getPackageManager
(
)
.
getPackageInfo
(
context
.
getPackageName
(
)
0
)
;
aboutVersion
=
String
.
format
(
"
%
s
(
Build
#
%
s
)
"
packageInfo
.
versionName
packageInfo
.
versionCode
)
;
}
catch
(
PackageManager
.
NameNotFoundException
e
)
{
}
substitutionMap
.
put
(
"
%
about
-
version
%
"
aboutVersion
)
;
final
String
aboutContent
=
resources
.
getString
(
R
.
string
.
about_content
appName
learnMoreURL
)
;
substitutionMap
.
put
(
"
%
about
-
content
%
"
aboutContent
)
;
final
String
wordmark
=
HtmlLoader
.
loadPngAsDataURI
(
context
R
.
drawable
.
wordmark
)
;
substitutionMap
.
put
(
"
%
wordmark
%
"
wordmark
)
;
putLayoutDirectionIntoMap
(
webView
substitutionMap
)
;
final
String
data
=
HtmlLoader
.
loadResourceFile
(
context
R
.
raw
.
about
substitutionMap
)
;
webView
.
loadDataWithBaseURL
(
"
file
:
/
/
/
android_res
/
raw
/
about
.
html
"
data
"
text
/
html
"
"
UTF
-
8
"
null
)
;
}
private
static
void
loadRights
(
NonNull
final
WebView
webView
)
{
final
Context
context
=
webView
.
getContext
(
)
;
final
Resources
resources
=
Locales
.
getLocalizedResources
(
context
)
;
final
Map
<
String
String
>
substitutionMap
=
new
ArrayMap
<
>
(
)
;
final
String
appName
=
context
.
getResources
(
)
.
getString
(
R
.
string
.
app_name
)
;
final
String
mplUrl
=
"
https
:
/
/
www
.
mozilla
.
org
/
en
-
US
/
MPL
/
"
;
final
String
trademarkPolicyUrl
=
"
https
:
/
/
www
.
mozilla
.
org
/
foundation
/
trademarks
/
policy
/
"
;
final
String
gplUrl
=
"
gpl
.
html
"
;
final
String
trackingProtectionUrl
=
"
https
:
/
/
wiki
.
mozilla
.
org
/
Security
/
Tracking_protection
#
Lists
"
;
final
String
licensesUrl
=
"
licenses
.
html
"
;
final
String
content
=
resources
.
getString
(
R
.
string
.
your_rights_content
appName
mplUrl
trademarkPolicyUrl
gplUrl
trackingProtectionUrl
licensesUrl
)
;
substitutionMap
.
put
(
"
%
your
-
rights
-
content
%
"
content
)
;
putLayoutDirectionIntoMap
(
webView
substitutionMap
)
;
final
String
data
=
HtmlLoader
.
loadResourceFile
(
context
R
.
raw
.
rights
substitutionMap
)
;
webView
.
loadDataWithBaseURL
(
"
file
:
/
/
/
android_asset
/
rights
.
html
"
data
"
text
/
html
"
"
UTF
-
8
"
null
)
;
}
private
static
void
putLayoutDirectionIntoMap
(
WebView
webView
Map
<
String
String
>
substitutionMap
)
{
ViewCompat
.
setLayoutDirection
(
webView
View
.
LAYOUT_DIRECTION_LOCALE
)
;
final
int
layoutDirection
=
ViewCompat
.
getLayoutDirection
(
webView
)
;
final
String
direction
;
if
(
layoutDirection
=
=
View
.
LAYOUT_DIRECTION_LTR
)
{
direction
=
"
ltr
"
;
}
else
if
(
layoutDirection
=
=
View
.
LAYOUT_DIRECTION_RTL
)
{
direction
=
"
rtl
"
;
}
else
{
direction
=
"
auto
"
;
}
substitutionMap
.
put
(
"
%
dir
%
"
direction
)
;
}
}
