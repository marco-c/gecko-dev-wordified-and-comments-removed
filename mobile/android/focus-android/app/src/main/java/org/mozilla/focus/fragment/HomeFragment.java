package
org
.
mozilla
.
focus
.
fragment
;
import
android
.
content
.
Context
;
import
android
.
content
.
Intent
;
import
android
.
os
.
Bundle
;
import
android
.
support
.
annotation
.
Nullable
;
import
android
.
support
.
v4
.
app
.
Fragment
;
import
android
.
support
.
v4
.
app
.
FragmentActivity
;
import
android
.
support
.
v4
.
app
.
FragmentManager
;
import
android
.
support
.
v7
.
widget
.
PopupMenu
;
import
android
.
view
.
Gravity
;
import
android
.
view
.
LayoutInflater
;
import
android
.
view
.
MenuItem
;
import
android
.
view
.
View
;
import
android
.
view
.
ViewGroup
;
import
org
.
mozilla
.
focus
.
R
;
import
org
.
mozilla
.
focus
.
activity
.
InfoActivity
;
import
org
.
mozilla
.
focus
.
locale
.
LocaleAwareAppCompatActivity
;
import
org
.
mozilla
.
focus
.
locale
.
LocaleAwareFragment
;
public
class
HomeFragment
extends
LocaleAwareFragment
implements
View
.
OnClickListener
PopupMenu
.
OnMenuItemClickListener
{
public
static
final
String
FRAGMENT_TAG
=
"
home
"
;
public
static
HomeFragment
create
(
)
{
return
new
HomeFragment
(
)
;
}
private
View
fakeUrlBarView
;
Override
public
void
applyLocale
(
)
{
getActivity
(
)
.
getSupportFragmentManager
(
)
.
beginTransaction
(
)
.
replace
(
R
.
id
.
container
HomeFragment
.
create
(
)
HomeFragment
.
FRAGMENT_TAG
)
.
commit
(
)
;
}
Override
public
void
onAttach
(
Context
context
)
{
super
.
onAttach
(
context
)
;
final
FragmentActivity
activity
=
getActivity
(
)
;
if
(
activity
!
=
null
&
&
Intent
.
ACTION_VIEW
.
equals
(
activity
.
getIntent
(
)
.
getAction
(
)
)
)
{
activity
.
setIntent
(
new
Intent
(
Intent
.
ACTION_MAIN
)
)
;
}
}
Override
public
View
onCreateView
(
LayoutInflater
inflater
Nullable
ViewGroup
container
Nullable
Bundle
savedInstanceState
)
{
final
View
view
=
inflater
.
inflate
(
R
.
layout
.
fragment_home
container
false
)
;
fakeUrlBarView
=
view
.
findViewById
(
R
.
id
.
fake_urlbar
)
;
fakeUrlBarView
.
setOnClickListener
(
this
)
;
view
.
findViewById
(
R
.
id
.
menu
)
.
setOnClickListener
(
this
)
;
return
view
;
}
Override
public
void
onClick
(
View
view
)
{
switch
(
view
.
getId
(
)
)
{
case
R
.
id
.
fake_urlbar
:
showUrlInput
(
)
;
break
;
case
R
.
id
.
menu
:
final
PopupMenu
popupMenu
=
new
PopupMenu
(
view
.
getContext
(
)
view
)
;
popupMenu
.
getMenuInflater
(
)
.
inflate
(
R
.
menu
.
menu_home
popupMenu
.
getMenu
(
)
)
;
popupMenu
.
setOnMenuItemClickListener
(
this
)
;
popupMenu
.
setGravity
(
Gravity
.
TOP
)
;
popupMenu
.
show
(
)
;
break
;
default
:
throw
new
IllegalStateException
(
"
Unhandled
view
ID
in
onClick
(
)
"
)
;
}
}
private
synchronized
void
showUrlInput
(
)
{
final
FragmentManager
fragmentManager
=
getActivity
(
)
.
getSupportFragmentManager
(
)
;
final
Fragment
existingFragment
=
fragmentManager
.
findFragmentByTag
(
UrlInputFragment
.
FRAGMENT_TAG
)
;
if
(
existingFragment
!
=
null
&
&
existingFragment
.
isAdded
(
)
&
&
!
existingFragment
.
isRemoving
(
)
)
{
return
;
}
final
UrlInputFragment
fragment
=
UrlInputFragment
.
createWithHomeScreenAnimation
(
fakeUrlBarView
)
;
fragmentManager
.
beginTransaction
(
)
.
add
(
R
.
id
.
container
fragment
UrlInputFragment
.
FRAGMENT_TAG
)
.
commit
(
)
;
}
Override
public
boolean
onMenuItemClick
(
MenuItem
item
)
{
final
int
id
=
item
.
getItemId
(
)
;
switch
(
id
)
{
case
R
.
id
.
settings
:
(
(
LocaleAwareAppCompatActivity
)
getActivity
(
)
)
.
openPreferences
(
)
;
return
true
;
case
R
.
id
.
about
:
Intent
aboutIntent
=
InfoActivity
.
getAboutIntent
(
getActivity
(
)
)
;
startActivity
(
aboutIntent
)
;
return
true
;
case
R
.
id
.
rights
:
Intent
rightsIntent
=
InfoActivity
.
getRightsIntent
(
getActivity
(
)
)
;
startActivity
(
rightsIntent
)
;
return
true
;
case
R
.
id
.
help
:
Intent
helpIntent
=
InfoActivity
.
getHelpIntent
(
getActivity
(
)
)
;
startActivity
(
helpIntent
)
;
return
true
;
default
:
throw
new
IllegalStateException
(
"
Unhandled
view
ID
in
onMenuItemClick
(
)
"
)
;
}
}
}
