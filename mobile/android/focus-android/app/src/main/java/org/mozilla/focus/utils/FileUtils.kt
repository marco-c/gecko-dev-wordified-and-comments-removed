package
org
.
mozilla
.
focus
.
utils
import
android
.
content
.
Context
import
java
.
io
.
File
private
const
val
WEBVIEW_DIRECTORY
=
"
app_webview
"
private
const
val
LOCAL_STORAGE_DIR
=
"
Local
Storage
"
private
const
val
WEBVIEW_CACHE_DIR
=
"
org
.
chromium
.
android_webview
"
private
const
val
SENTRY_CACHE_DIR
=
"
sentry
-
buffered
-
events
"
class
FileUtils
{
companion
object
{
JvmStatic
fun
truncateCacheDirectory
(
context
:
Context
)
=
deleteContent
(
context
.
cacheDir
doNotEraseWhitelist
=
setOf
(
WEBVIEW_CACHE_DIR
SENTRY_CACHE_DIR
)
)
JvmStatic
fun
deleteWebViewDirectory
(
context
:
Context
)
:
Boolean
{
val
webviewDirectory
=
File
(
context
.
applicationInfo
.
dataDir
WEBVIEW_DIRECTORY
)
return
deleteContent
(
webviewDirectory
doNotEraseWhitelist
=
setOf
(
LOCAL_STORAGE_DIR
)
)
}
private
fun
deleteContent
(
directory
:
File
doNotEraseWhitelist
:
Set
<
String
>
=
emptySet
(
)
)
:
Boolean
{
val
filesToDelete
=
directory
.
listFiles
(
)
?
.
filter
{
!
doNotEraseWhitelist
.
contains
(
it
.
name
)
}
?
:
return
false
return
filesToDelete
.
all
{
it
.
deleteRecursively
(
)
}
}
}
}
