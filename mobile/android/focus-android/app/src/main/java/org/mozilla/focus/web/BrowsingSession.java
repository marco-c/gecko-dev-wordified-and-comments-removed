package
org
.
mozilla
.
focus
.
web
;
import
java
.
lang
.
ref
.
WeakReference
;
import
android
.
content
.
Intent
;
import
android
.
support
.
annotation
.
NonNull
;
import
android
.
support
.
annotation
.
Nullable
;
import
org
.
mozilla
.
focus
.
utils
.
SafeIntent
;
public
class
BrowsingSession
{
private
static
BrowsingSession
instance
;
public
interface
TrackingCountListener
{
void
onTrackingCountChanged
(
int
trackingCount
)
;
}
public
static
synchronized
BrowsingSession
getInstance
(
)
{
if
(
instance
=
=
null
)
{
instance
=
new
BrowsingSession
(
)
;
}
return
instance
;
}
private
boolean
isActive
;
private
int
blockedTrackers
;
private
WeakReference
<
TrackingCountListener
>
listenerWeakReference
;
private
Nullable
CustomTabConfig
customTabConfig
;
private
BrowsingSession
(
)
{
listenerWeakReference
=
new
WeakReference
<
>
(
null
)
;
}
public
void
start
(
)
{
isActive
=
true
;
}
public
void
stop
(
)
{
isActive
=
false
;
customTabConfig
=
null
;
}
public
boolean
isActive
(
)
{
return
isActive
;
}
public
void
countBlockedTracker
(
)
{
blockedTrackers
+
+
;
final
TrackingCountListener
listener
=
listenerWeakReference
.
get
(
)
;
if
(
listener
!
=
null
)
{
listener
.
onTrackingCountChanged
(
blockedTrackers
)
;
}
}
public
void
setTrackingCountListener
(
TrackingCountListener
listener
)
{
listenerWeakReference
=
new
WeakReference
<
>
(
listener
)
;
listener
.
onTrackingCountChanged
(
blockedTrackers
)
;
}
public
void
resetTrackerCount
(
)
{
blockedTrackers
=
0
;
}
public
void
loadCustomTabConfig
(
final
NonNull
SafeIntent
intent
)
{
if
(
!
CustomTabConfig
.
isCustomTabIntent
(
intent
)
)
{
customTabConfig
=
null
;
return
;
}
customTabConfig
=
CustomTabConfig
.
parseCustomTabIntent
(
intent
)
;
}
public
boolean
isCustomTab
(
)
{
return
customTabConfig
!
=
null
;
}
public
NonNull
CustomTabConfig
getCustomTabConfig
(
)
{
if
(
!
isCustomTab
(
)
)
{
throw
new
IllegalStateException
(
"
Can
'
t
retrieve
custom
tab
config
for
normal
browsing
session
"
)
;
}
return
customTabConfig
;
}
}
