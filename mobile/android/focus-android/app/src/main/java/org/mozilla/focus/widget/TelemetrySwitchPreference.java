package
org
.
mozilla
.
focus
.
widget
;
import
android
.
content
.
Context
;
import
android
.
content
.
Intent
;
import
android
.
content
.
res
.
Resources
;
import
android
.
content
.
res
.
TypedArray
;
import
android
.
graphics
.
Paint
;
import
android
.
graphics
.
drawable
.
Drawable
;
import
android
.
preference
.
Preference
;
import
android
.
support
.
v4
.
content
.
ContextCompat
;
import
android
.
util
.
AttributeSet
;
import
android
.
view
.
View
;
import
android
.
widget
.
CompoundButton
;
import
android
.
widget
.
Switch
;
import
android
.
widget
.
TextView
;
import
org
.
mozilla
.
focus
.
R
;
import
org
.
mozilla
.
focus
.
activity
.
InfoActivity
;
import
org
.
mozilla
.
focus
.
telemetry
.
TelemetryWrapper
;
import
org
.
mozilla
.
focus
.
utils
.
SupportUtils
;
class
TelemetrySwitchPreference
extends
Preference
{
public
TelemetrySwitchPreference
(
Context
context
AttributeSet
attrs
)
{
super
(
context
attrs
)
;
init
(
)
;
}
public
TelemetrySwitchPreference
(
Context
context
AttributeSet
attrs
int
defStyle
)
{
super
(
context
attrs
defStyle
)
;
init
(
)
;
}
private
void
init
(
)
{
setLayoutResource
(
R
.
layout
.
preference_telemetry
)
;
setPersistent
(
false
)
;
}
Override
protected
void
onBindView
(
final
View
view
)
{
super
.
onBindView
(
view
)
;
final
Switch
switchWidget
=
view
.
findViewById
(
R
.
id
.
switch_widget
)
;
switchWidget
.
setChecked
(
TelemetryWrapper
.
isTelemetryEnabled
(
getContext
(
)
)
)
;
switchWidget
.
setOnCheckedChangeListener
(
new
CompoundButton
.
OnCheckedChangeListener
(
)
{
Override
public
void
onCheckedChanged
(
CompoundButton
buttonView
boolean
isChecked
)
{
TelemetryWrapper
.
setTelemetryEnabled
(
getContext
(
)
isChecked
)
;
}
}
)
;
final
Resources
resources
=
view
.
getResources
(
)
;
final
TextView
summary
=
view
.
findViewById
(
android
.
R
.
id
.
summary
)
;
summary
.
setText
(
resources
.
getString
(
R
.
string
.
preference_mozilla_telemetry_summary2
resources
.
getString
(
R
.
string
.
app_name
)
)
)
;
final
TextView
learnMoreLink
=
view
.
findViewById
(
R
.
id
.
link
)
;
learnMoreLink
.
setPaintFlags
(
learnMoreLink
.
getPaintFlags
(
)
|
Paint
.
UNDERLINE_TEXT_FLAG
)
;
learnMoreLink
.
setTextColor
(
ContextCompat
.
getColor
(
view
.
getContext
(
)
R
.
color
.
colorAction
)
)
;
learnMoreLink
.
setOnClickListener
(
new
View
.
OnClickListener
(
)
{
Override
public
void
onClick
(
View
v
)
{
final
String
url
=
SupportUtils
.
getSumoURLForTopic
(
getContext
(
)
SupportUtils
.
SumoTopic
.
USAGE_DATA
)
;
final
String
title
=
getTitle
(
)
.
toString
(
)
;
final
Intent
intent
=
InfoActivity
.
getIntentFor
(
getContext
(
)
url
title
)
;
getContext
(
)
.
startActivity
(
intent
)
;
}
}
)
;
final
TypedArray
backgroundDrawableArray
=
view
.
getContext
(
)
.
obtainStyledAttributes
(
new
int
[
]
{
R
.
attr
.
selectableItemBackground
}
)
;
final
Drawable
backgroundDrawable
=
backgroundDrawableArray
.
getDrawable
(
0
)
;
backgroundDrawableArray
.
recycle
(
)
;
learnMoreLink
.
setBackground
(
backgroundDrawable
)
;
setOnPreferenceClickListener
(
new
OnPreferenceClickListener
(
)
{
Override
public
boolean
onPreferenceClick
(
Preference
preference
)
{
switchWidget
.
toggle
(
)
;
return
true
;
}
}
)
;
}
}
