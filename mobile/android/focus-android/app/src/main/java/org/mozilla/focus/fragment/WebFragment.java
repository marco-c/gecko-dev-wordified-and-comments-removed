package
org
.
mozilla
.
focus
.
fragment
;
import
android
.
os
.
Bundle
;
import
android
.
support
.
annotation
.
NonNull
;
import
android
.
support
.
annotation
.
Nullable
;
import
android
.
view
.
LayoutInflater
;
import
android
.
view
.
View
;
import
android
.
view
.
ViewGroup
;
import
android
.
webkit
.
WebView
;
import
org
.
mozilla
.
focus
.
R
;
import
org
.
mozilla
.
focus
.
locale
.
LocaleAwareFragment
;
import
org
.
mozilla
.
focus
.
web
.
IWebView
;
public
abstract
class
WebFragment
extends
LocaleAwareFragment
{
private
IWebView
webView
;
private
boolean
isWebViewAvailable
;
NonNull
public
abstract
View
inflateLayout
(
LayoutInflater
inflater
Nullable
ViewGroup
container
Nullable
Bundle
savedInstanceState
)
;
public
abstract
IWebView
.
Callback
createCallback
(
)
;
Nullable
public
abstract
String
getInitialUrl
(
)
;
public
abstract
void
onCreateViewCalled
(
)
;
Override
public
final
View
onCreateView
(
LayoutInflater
inflater
Nullable
ViewGroup
container
Nullable
Bundle
savedInstanceState
)
{
final
View
view
=
inflateLayout
(
inflater
container
savedInstanceState
)
;
webView
=
(
IWebView
)
view
.
findViewById
(
R
.
id
.
webview
)
;
isWebViewAvailable
=
true
;
webView
.
setCallback
(
createCallback
(
)
)
;
if
(
savedInstanceState
=
=
null
)
{
final
String
url
=
getInitialUrl
(
)
;
if
(
url
!
=
null
)
{
webView
.
loadUrl
(
url
)
;
}
}
else
{
webView
.
restoreWebviewState
(
savedInstanceState
)
;
}
onCreateViewCalled
(
)
;
return
view
;
}
Override
public
void
applyLocale
(
)
{
final
WebView
unneeded
=
new
WebView
(
getContext
(
)
)
;
unneeded
.
destroy
(
)
;
}
Override
public
void
onPause
(
)
{
webView
.
onPause
(
)
;
super
.
onPause
(
)
;
}
Override
public
void
onResume
(
)
{
webView
.
onResume
(
)
;
super
.
onResume
(
)
;
}
Override
public
void
onSaveInstanceState
(
Bundle
outState
)
{
webView
.
onSaveInstanceState
(
outState
)
;
super
.
onSaveInstanceState
(
outState
)
;
}
Override
public
void
onDestroy
(
)
{
if
(
webView
!
=
null
)
{
webView
.
setCallback
(
null
)
;
webView
.
destroy
(
)
;
webView
=
null
;
}
super
.
onDestroy
(
)
;
}
Override
public
void
onDestroyView
(
)
{
isWebViewAvailable
=
false
;
super
.
onDestroyView
(
)
;
}
Nullable
protected
IWebView
getWebView
(
)
{
return
isWebViewAvailable
?
webView
:
null
;
}
}
