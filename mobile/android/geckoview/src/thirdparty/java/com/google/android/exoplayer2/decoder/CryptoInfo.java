package
com
.
google
.
android
.
exoplayer2
.
decoder
;
import
android
.
annotation
.
TargetApi
;
import
com
.
google
.
android
.
exoplayer2
.
C
;
import
com
.
google
.
android
.
exoplayer2
.
util
.
Util
;
public
final
class
CryptoInfo
{
public
byte
[
]
iv
;
public
byte
[
]
key
;
C
.
CryptoMode
public
int
mode
;
public
int
[
]
numBytesOfClearData
;
public
int
[
]
numBytesOfEncryptedData
;
public
int
numSubSamples
;
public
int
patternBlocksToEncrypt
;
public
int
patternBlocksToSkip
;
private
final
android
.
media
.
MediaCodec
.
CryptoInfo
frameworkCryptoInfo
;
private
final
PatternHolderV24
patternHolder
;
public
CryptoInfo
(
)
{
frameworkCryptoInfo
=
Util
.
SDK_INT
>
=
16
?
newFrameworkCryptoInfoV16
(
)
:
null
;
patternHolder
=
Util
.
SDK_INT
>
=
24
?
new
PatternHolderV24
(
frameworkCryptoInfo
)
:
null
;
}
public
void
set
(
int
numSubSamples
int
[
]
numBytesOfClearData
int
[
]
numBytesOfEncryptedData
byte
[
]
key
byte
[
]
iv
C
.
CryptoMode
int
mode
)
{
this
.
numSubSamples
=
numSubSamples
;
this
.
numBytesOfClearData
=
numBytesOfClearData
;
this
.
numBytesOfEncryptedData
=
numBytesOfEncryptedData
;
this
.
key
=
key
;
this
.
iv
=
iv
;
this
.
mode
=
mode
;
patternBlocksToEncrypt
=
0
;
patternBlocksToSkip
=
0
;
if
(
Util
.
SDK_INT
>
=
16
)
{
updateFrameworkCryptoInfoV16
(
)
;
}
}
public
void
setPattern
(
int
patternBlocksToEncrypt
int
patternBlocksToSkip
)
{
this
.
patternBlocksToEncrypt
=
patternBlocksToEncrypt
;
this
.
patternBlocksToSkip
=
patternBlocksToSkip
;
if
(
Util
.
SDK_INT
>
=
24
)
{
patternHolder
.
set
(
patternBlocksToEncrypt
patternBlocksToSkip
)
;
}
}
TargetApi
(
16
)
public
android
.
media
.
MediaCodec
.
CryptoInfo
getFrameworkCryptoInfoV16
(
)
{
return
frameworkCryptoInfo
;
}
TargetApi
(
16
)
private
android
.
media
.
MediaCodec
.
CryptoInfo
newFrameworkCryptoInfoV16
(
)
{
return
new
android
.
media
.
MediaCodec
.
CryptoInfo
(
)
;
}
TargetApi
(
16
)
private
void
updateFrameworkCryptoInfoV16
(
)
{
frameworkCryptoInfo
.
numSubSamples
=
numSubSamples
;
frameworkCryptoInfo
.
numBytesOfClearData
=
numBytesOfClearData
;
frameworkCryptoInfo
.
numBytesOfEncryptedData
=
numBytesOfEncryptedData
;
frameworkCryptoInfo
.
key
=
key
;
frameworkCryptoInfo
.
iv
=
iv
;
frameworkCryptoInfo
.
mode
=
mode
;
if
(
Util
.
SDK_INT
>
=
24
)
{
patternHolder
.
set
(
patternBlocksToEncrypt
patternBlocksToSkip
)
;
}
}
TargetApi
(
24
)
private
static
final
class
PatternHolderV24
{
private
final
android
.
media
.
MediaCodec
.
CryptoInfo
frameworkCryptoInfo
;
private
PatternHolderV24
(
android
.
media
.
MediaCodec
.
CryptoInfo
frameworkCryptoInfo
)
{
this
.
frameworkCryptoInfo
=
frameworkCryptoInfo
;
}
private
void
set
(
int
blocksToEncrypt
int
blocksToSkip
)
{
}
}
}
