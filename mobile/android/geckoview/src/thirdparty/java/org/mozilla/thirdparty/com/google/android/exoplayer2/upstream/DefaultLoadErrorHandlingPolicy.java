package
org
.
mozilla
.
thirdparty
.
com
.
google
.
android
.
exoplayer2
.
upstream
;
import
org
.
mozilla
.
thirdparty
.
com
.
google
.
android
.
exoplayer2
.
C
;
import
org
.
mozilla
.
thirdparty
.
com
.
google
.
android
.
exoplayer2
.
ParserException
;
import
org
.
mozilla
.
thirdparty
.
com
.
google
.
android
.
exoplayer2
.
upstream
.
HttpDataSource
.
InvalidResponseCodeException
;
import
org
.
mozilla
.
thirdparty
.
com
.
google
.
android
.
exoplayer2
.
upstream
.
Loader
.
UnexpectedLoaderException
;
import
java
.
io
.
FileNotFoundException
;
import
java
.
io
.
IOException
;
public
class
DefaultLoadErrorHandlingPolicy
implements
LoadErrorHandlingPolicy
{
public
static
final
int
DEFAULT_MIN_LOADABLE_RETRY_COUNT
=
3
;
public
static
final
int
DEFAULT_MIN_LOADABLE_RETRY_COUNT_PROGRESSIVE_LIVE
=
6
;
public
static
final
long
DEFAULT_TRACK_BLACKLIST_MS
=
60000
;
private
static
final
int
DEFAULT_BEHAVIOR_MIN_LOADABLE_RETRY_COUNT
=
-
1
;
private
final
int
minimumLoadableRetryCount
;
public
DefaultLoadErrorHandlingPolicy
(
)
{
this
(
DEFAULT_BEHAVIOR_MIN_LOADABLE_RETRY_COUNT
)
;
}
public
DefaultLoadErrorHandlingPolicy
(
int
minimumLoadableRetryCount
)
{
this
.
minimumLoadableRetryCount
=
minimumLoadableRetryCount
;
}
Override
public
long
getBlacklistDurationMsFor
(
int
dataType
long
loadDurationMs
IOException
exception
int
errorCount
)
{
if
(
exception
instanceof
InvalidResponseCodeException
)
{
int
responseCode
=
(
(
InvalidResponseCodeException
)
exception
)
.
responseCode
;
return
responseCode
=
=
404
|
|
responseCode
=
=
410
|
|
responseCode
=
=
416
?
DEFAULT_TRACK_BLACKLIST_MS
:
C
.
TIME_UNSET
;
}
return
C
.
TIME_UNSET
;
}
Override
public
long
getRetryDelayMsFor
(
int
dataType
long
loadDurationMs
IOException
exception
int
errorCount
)
{
return
exception
instanceof
ParserException
|
|
exception
instanceof
FileNotFoundException
|
|
exception
instanceof
UnexpectedLoaderException
?
C
.
TIME_UNSET
:
Math
.
min
(
(
errorCount
-
1
)
*
1000
5000
)
;
}
Override
public
int
getMinimumLoadableRetryCount
(
int
dataType
)
{
if
(
minimumLoadableRetryCount
=
=
DEFAULT_BEHAVIOR_MIN_LOADABLE_RETRY_COUNT
)
{
return
dataType
=
=
C
.
DATA_TYPE_MEDIA_PROGRESSIVE_LIVE
?
DEFAULT_MIN_LOADABLE_RETRY_COUNT_PROGRESSIVE_LIVE
:
DEFAULT_MIN_LOADABLE_RETRY_COUNT
;
}
else
{
return
minimumLoadableRetryCount
;
}
}
}
