package
org
.
mozilla
.
thirdparty
.
com
.
google
.
android
.
exoplayer2
.
source
.
hls
.
playlist
;
import
androidx
.
annotation
.
IntDef
;
import
androidx
.
annotation
.
Nullable
;
import
org
.
mozilla
.
thirdparty
.
com
.
google
.
android
.
exoplayer2
.
C
;
import
org
.
mozilla
.
thirdparty
.
com
.
google
.
android
.
exoplayer2
.
drm
.
DrmInitData
;
import
org
.
mozilla
.
thirdparty
.
com
.
google
.
android
.
exoplayer2
.
offline
.
StreamKey
;
import
java
.
lang
.
annotation
.
Documented
;
import
java
.
lang
.
annotation
.
Retention
;
import
java
.
lang
.
annotation
.
RetentionPolicy
;
import
java
.
util
.
Collections
;
import
java
.
util
.
List
;
public
final
class
HlsMediaPlaylist
extends
HlsPlaylist
{
SuppressWarnings
(
"
ComparableType
"
)
public
static
final
class
Segment
implements
Comparable
<
Long
>
{
public
final
String
url
;
Nullable
public
final
Segment
initializationSegment
;
public
final
long
durationUs
;
public
final
String
title
;
public
final
int
relativeDiscontinuitySequence
;
public
final
long
relativeStartTimeUs
;
Nullable
public
final
DrmInitData
drmInitData
;
Nullable
public
final
String
fullSegmentEncryptionKeyUri
;
Nullable
public
final
String
encryptionIV
;
public
final
long
byterangeOffset
;
public
final
long
byterangeLength
;
public
final
boolean
hasGapTag
;
public
Segment
(
String
uri
long
byterangeOffset
long
byterangeLength
Nullable
String
fullSegmentEncryptionKeyUri
Nullable
String
encryptionIV
)
{
this
(
uri
null
"
"
0
-
1
C
.
TIME_UNSET
null
fullSegmentEncryptionKeyUri
encryptionIV
byterangeOffset
byterangeLength
false
)
;
}
public
Segment
(
String
url
Nullable
Segment
initializationSegment
String
title
long
durationUs
int
relativeDiscontinuitySequence
long
relativeStartTimeUs
Nullable
DrmInitData
drmInitData
Nullable
String
fullSegmentEncryptionKeyUri
Nullable
String
encryptionIV
long
byterangeOffset
long
byterangeLength
boolean
hasGapTag
)
{
this
.
url
=
url
;
this
.
initializationSegment
=
initializationSegment
;
this
.
title
=
title
;
this
.
durationUs
=
durationUs
;
this
.
relativeDiscontinuitySequence
=
relativeDiscontinuitySequence
;
this
.
relativeStartTimeUs
=
relativeStartTimeUs
;
this
.
drmInitData
=
drmInitData
;
this
.
fullSegmentEncryptionKeyUri
=
fullSegmentEncryptionKeyUri
;
this
.
encryptionIV
=
encryptionIV
;
this
.
byterangeOffset
=
byterangeOffset
;
this
.
byterangeLength
=
byterangeLength
;
this
.
hasGapTag
=
hasGapTag
;
}
Override
public
int
compareTo
(
Long
relativeStartTimeUs
)
{
return
this
.
relativeStartTimeUs
>
relativeStartTimeUs
?
1
:
(
this
.
relativeStartTimeUs
<
relativeStartTimeUs
?
-
1
:
0
)
;
}
}
Documented
Retention
(
RetentionPolicy
.
SOURCE
)
IntDef
(
{
PLAYLIST_TYPE_UNKNOWN
PLAYLIST_TYPE_VOD
PLAYLIST_TYPE_EVENT
}
)
public
interface
PlaylistType
{
}
public
static
final
int
PLAYLIST_TYPE_UNKNOWN
=
0
;
public
static
final
int
PLAYLIST_TYPE_VOD
=
1
;
public
static
final
int
PLAYLIST_TYPE_EVENT
=
2
;
PlaylistType
public
final
int
playlistType
;
public
final
long
startOffsetUs
;
public
final
long
startTimeUs
;
public
final
boolean
hasDiscontinuitySequence
;
public
final
int
discontinuitySequence
;
public
final
long
mediaSequence
;
public
final
int
version
;
public
final
long
targetDurationUs
;
public
final
boolean
hasEndTag
;
public
final
boolean
hasProgramDateTime
;
Nullable
public
final
DrmInitData
protectionSchemes
;
public
final
List
<
Segment
>
segments
;
public
final
long
durationUs
;
public
HlsMediaPlaylist
(
PlaylistType
int
playlistType
String
baseUri
List
<
String
>
tags
long
startOffsetUs
long
startTimeUs
boolean
hasDiscontinuitySequence
int
discontinuitySequence
long
mediaSequence
int
version
long
targetDurationUs
boolean
hasIndependentSegments
boolean
hasEndTag
boolean
hasProgramDateTime
Nullable
DrmInitData
protectionSchemes
List
<
Segment
>
segments
)
{
super
(
baseUri
tags
hasIndependentSegments
)
;
this
.
playlistType
=
playlistType
;
this
.
startTimeUs
=
startTimeUs
;
this
.
hasDiscontinuitySequence
=
hasDiscontinuitySequence
;
this
.
discontinuitySequence
=
discontinuitySequence
;
this
.
mediaSequence
=
mediaSequence
;
this
.
version
=
version
;
this
.
targetDurationUs
=
targetDurationUs
;
this
.
hasEndTag
=
hasEndTag
;
this
.
hasProgramDateTime
=
hasProgramDateTime
;
this
.
protectionSchemes
=
protectionSchemes
;
this
.
segments
=
Collections
.
unmodifiableList
(
segments
)
;
if
(
!
segments
.
isEmpty
(
)
)
{
Segment
last
=
segments
.
get
(
segments
.
size
(
)
-
1
)
;
durationUs
=
last
.
relativeStartTimeUs
+
last
.
durationUs
;
}
else
{
durationUs
=
0
;
}
this
.
startOffsetUs
=
startOffsetUs
=
=
C
.
TIME_UNSET
?
C
.
TIME_UNSET
:
startOffsetUs
>
=
0
?
startOffsetUs
:
durationUs
+
startOffsetUs
;
}
Override
public
HlsMediaPlaylist
copy
(
List
<
StreamKey
>
streamKeys
)
{
return
this
;
}
public
boolean
isNewerThan
(
HlsMediaPlaylist
other
)
{
if
(
other
=
=
null
|
|
mediaSequence
>
other
.
mediaSequence
)
{
return
true
;
}
if
(
mediaSequence
<
other
.
mediaSequence
)
{
return
false
;
}
int
segmentCount
=
segments
.
size
(
)
;
int
otherSegmentCount
=
other
.
segments
.
size
(
)
;
return
segmentCount
>
otherSegmentCount
|
|
(
segmentCount
=
=
otherSegmentCount
&
&
hasEndTag
&
&
!
other
.
hasEndTag
)
;
}
public
long
getEndTimeUs
(
)
{
return
startTimeUs
+
durationUs
;
}
public
HlsMediaPlaylist
copyWith
(
long
startTimeUs
int
discontinuitySequence
)
{
return
new
HlsMediaPlaylist
(
playlistType
baseUri
tags
startOffsetUs
startTimeUs
true
discontinuitySequence
mediaSequence
version
targetDurationUs
hasIndependentSegments
hasEndTag
hasProgramDateTime
protectionSchemes
segments
)
;
}
public
HlsMediaPlaylist
copyWithEndTag
(
)
{
if
(
this
.
hasEndTag
)
{
return
this
;
}
return
new
HlsMediaPlaylist
(
playlistType
baseUri
tags
startOffsetUs
startTimeUs
hasDiscontinuitySequence
discontinuitySequence
mediaSequence
version
targetDurationUs
hasIndependentSegments
true
hasProgramDateTime
protectionSchemes
segments
)
;
}
}
