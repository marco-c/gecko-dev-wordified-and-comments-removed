package
org
.
mozilla
.
thirdparty
.
com
.
google
.
android
.
exoplayer2
.
util
;
import
android
.
os
.
SystemClock
;
import
org
.
mozilla
.
thirdparty
.
com
.
google
.
android
.
exoplayer2
.
C
;
import
org
.
mozilla
.
thirdparty
.
com
.
google
.
android
.
exoplayer2
.
PlaybackParameters
;
public
final
class
StandaloneMediaClock
implements
MediaClock
{
private
boolean
started
;
private
long
baseUs
;
private
long
baseElapsedMs
;
private
PlaybackParameters
playbackParameters
;
public
StandaloneMediaClock
(
)
{
playbackParameters
=
PlaybackParameters
.
DEFAULT
;
}
public
void
start
(
)
{
if
(
!
started
)
{
baseElapsedMs
=
SystemClock
.
elapsedRealtime
(
)
;
started
=
true
;
}
}
public
void
stop
(
)
{
if
(
started
)
{
setPositionUs
(
getPositionUs
(
)
)
;
started
=
false
;
}
}
public
void
setPositionUs
(
long
positionUs
)
{
baseUs
=
positionUs
;
if
(
started
)
{
baseElapsedMs
=
SystemClock
.
elapsedRealtime
(
)
;
}
}
public
void
synchronize
(
MediaClock
clock
)
{
setPositionUs
(
clock
.
getPositionUs
(
)
)
;
playbackParameters
=
clock
.
getPlaybackParameters
(
)
;
}
Override
public
long
getPositionUs
(
)
{
long
positionUs
=
baseUs
;
if
(
started
)
{
long
elapsedSinceBaseMs
=
SystemClock
.
elapsedRealtime
(
)
-
baseElapsedMs
;
if
(
playbackParameters
.
speed
=
=
1f
)
{
positionUs
+
=
C
.
msToUs
(
elapsedSinceBaseMs
)
;
}
else
{
positionUs
+
=
playbackParameters
.
getSpeedAdjustedDurationUs
(
elapsedSinceBaseMs
)
;
}
}
return
positionUs
;
}
Override
public
PlaybackParameters
setPlaybackParameters
(
PlaybackParameters
playbackParameters
)
{
if
(
started
)
{
setPositionUs
(
getPositionUs
(
)
)
;
}
this
.
playbackParameters
=
playbackParameters
;
return
playbackParameters
;
}
Override
public
PlaybackParameters
getPlaybackParameters
(
)
{
return
playbackParameters
;
}
}
