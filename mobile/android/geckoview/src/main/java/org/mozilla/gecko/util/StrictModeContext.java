package
org
.
mozilla
.
gecko
.
util
;
import
android
.
os
.
StrictMode
;
import
java
.
io
.
Closeable
;
public
final
class
StrictModeContext
implements
Closeable
{
private
final
StrictMode
.
ThreadPolicy
mThreadPolicy
;
private
final
StrictMode
.
VmPolicy
mVmPolicy
;
private
StrictModeContext
(
final
StrictMode
.
ThreadPolicy
threadPolicy
final
StrictMode
.
VmPolicy
vmPolicy
)
{
mThreadPolicy
=
threadPolicy
;
mVmPolicy
=
vmPolicy
;
}
private
StrictModeContext
(
final
StrictMode
.
ThreadPolicy
threadPolicy
)
{
this
(
threadPolicy
null
)
;
}
private
StrictModeContext
(
final
StrictMode
.
VmPolicy
vmPolicy
)
{
this
(
null
vmPolicy
)
;
}
public
static
StrictModeContext
allowAllVmPolicies
(
)
{
final
StrictMode
.
VmPolicy
oldPolicy
=
StrictMode
.
getVmPolicy
(
)
;
StrictMode
.
setVmPolicy
(
StrictMode
.
VmPolicy
.
LAX
)
;
return
new
StrictModeContext
(
oldPolicy
)
;
}
public
static
StrictModeContext
allowDiskWrites
(
)
{
final
StrictMode
.
ThreadPolicy
oldPolicy
=
StrictMode
.
allowThreadDiskWrites
(
)
;
return
new
StrictModeContext
(
oldPolicy
)
;
}
public
static
StrictModeContext
allowDiskReads
(
)
{
final
StrictMode
.
ThreadPolicy
oldPolicy
=
StrictMode
.
allowThreadDiskReads
(
)
;
return
new
StrictModeContext
(
oldPolicy
)
;
}
public
static
StrictModeContext
allowSlowCalls
(
)
{
final
StrictMode
.
ThreadPolicy
oldPolicy
=
StrictMode
.
getThreadPolicy
(
)
;
StrictMode
.
setThreadPolicy
(
new
StrictMode
.
ThreadPolicy
.
Builder
(
oldPolicy
)
.
permitCustomSlowCalls
(
)
.
build
(
)
)
;
return
new
StrictModeContext
(
oldPolicy
)
;
}
Override
public
void
close
(
)
{
if
(
mThreadPolicy
!
=
null
)
{
StrictMode
.
setThreadPolicy
(
mThreadPolicy
)
;
}
if
(
mVmPolicy
!
=
null
)
{
StrictMode
.
setVmPolicy
(
mVmPolicy
)
;
}
}
}
