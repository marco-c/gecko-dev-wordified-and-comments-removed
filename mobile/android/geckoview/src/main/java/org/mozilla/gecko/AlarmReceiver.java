package
org
.
mozilla
.
gecko
;
import
org
.
mozilla
.
gecko
.
annotation
.
WrapForJNI
;
import
android
.
app
.
IntentService
;
import
android
.
content
.
Context
;
import
android
.
content
.
Intent
;
import
android
.
content
.
BroadcastReceiver
;
import
android
.
os
.
PowerManager
;
import
android
.
os
.
PowerManager
.
WakeLock
;
import
android
.
util
.
Log
;
import
java
.
util
.
Timer
;
import
java
.
util
.
TimerTask
;
public
class
AlarmReceiver
extends
BroadcastReceiver
{
Override
public
void
onReceive
(
Context
context
Intent
intent
)
{
PowerManager
powerManager
=
(
PowerManager
)
context
.
getSystemService
(
Context
.
POWER_SERVICE
)
;
final
WakeLock
wakeLock
=
powerManager
.
newWakeLock
(
PowerManager
.
SCREEN_DIM_WAKE_LOCK
|
PowerManager
.
ACQUIRE_CAUSES_WAKEUP
"
GeckoAlarm
"
)
;
wakeLock
.
acquire
(
)
;
AlarmReceiver
.
notifyAlarmFired
(
)
;
TimerTask
releaseLockTask
=
new
TimerTask
(
)
{
Override
public
void
run
(
)
{
wakeLock
.
release
(
)
;
}
}
;
Timer
timer
=
new
Timer
(
)
;
timer
.
schedule
(
releaseLockTask
5
*
1000
)
;
}
WrapForJNI
(
calledFrom
=
"
ui
"
dispatchTo
=
"
gecko
"
)
private
static
native
void
notifyAlarmFired
(
)
;
}
