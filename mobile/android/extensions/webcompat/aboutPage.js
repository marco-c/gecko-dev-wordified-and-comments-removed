"
use
strict
"
;
ChromeUtils
.
defineModuleGetter
(
this
"
AppConstants
"
"
resource
:
/
/
gre
/
modules
/
AppConstants
.
jsm
"
)
;
ChromeUtils
.
defineModuleGetter
(
this
"
Services
"
"
resource
:
/
/
gre
/
modules
/
Services
.
jsm
"
)
;
XPCOMUtils
.
defineLazyServiceGetter
(
this
"
resProto
"
"
mozilla
.
org
/
network
/
protocol
;
1
?
name
=
resource
"
"
nsISubstitutingProtocolHandler
"
)
;
const
ResourceSubstitution
=
"
webcompat
"
;
const
ProcessScriptURL
=
"
resource
:
/
/
webcompat
/
aboutPageProcessScript
.
js
"
;
const
ShouldStart
=
[
"
default
"
"
nightly
"
"
nightly
-
try
"
]
.
includes
(
AppConstants
.
MOZ_UPDATE_CHANNEL
)
;
this
.
aboutPage
=
class
extends
ExtensionAPI
{
onStartup
(
)
{
const
{
rootURI
}
=
this
.
extension
;
resProto
.
setSubstitution
(
ResourceSubstitution
Services
.
io
.
newURI
(
"
chrome
/
res
/
"
null
rootURI
)
)
;
Services
.
ppmm
.
loadProcessScript
(
ProcessScriptURL
true
)
;
}
onShutdown
(
)
{
resProto
.
setSubstitution
(
ResourceSubstitution
null
)
;
Services
.
ppmm
.
removeDelayedProcessScript
(
ProcessScriptURL
)
;
}
}
;
