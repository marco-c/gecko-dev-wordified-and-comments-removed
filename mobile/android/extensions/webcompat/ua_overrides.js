"
use
strict
"
;
let
UAOverridesEnabled
=
true
;
for
(
const
override
of
[
{
id
:
"
testoverride
"
platform
:
"
all
"
domain
:
"
webcompat
-
addon
-
testcases
.
schub
.
io
"
bug
:
"
1287966
"
config
:
{
matches
:
[
"
*
:
/
/
webcompat
-
addon
-
testcases
.
schub
.
io
/
*
"
]
uaTransformer
:
originalUA
=
>
{
return
(
UAHelpers
.
getPrefix
(
originalUA
)
+
"
AppleWebKit
/
537
.
36
(
KHTML
like
Gecko
)
Chrome
/
54
.
0
.
2840
.
98
Safari
/
537
.
36
"
)
;
}
}
}
{
id
:
"
bug1563839
"
platform
:
"
all
"
domain
:
"
rolb
.
santanderbank
.
com
"
bug
:
"
1563839
"
config
:
{
matches
:
[
"
*
:
/
/
rolb
.
santanderbank
.
com
/
*
"
]
uaTransformer
:
originalUA
=
>
{
return
originalUA
.
replace
(
"
Gecko
"
"
like
Gecko
"
)
;
}
}
}
{
id
:
"
bug1480710
"
platform
:
"
android
"
domain
:
"
m
.
imgur
.
com
"
bug
:
"
1480710
"
config
:
{
matches
:
[
"
*
:
/
/
m
.
imgur
.
com
/
*
"
]
uaTransformer
:
originalUA
=
>
{
return
(
UAHelpers
.
getPrefix
(
originalUA
)
+
"
AppleWebKit
/
537
.
36
(
KHTML
like
Gecko
)
Chrome
/
68
.
0
.
3440
.
85
Mobile
Safari
/
537
.
36
"
)
;
}
}
}
{
id
:
"
bug945963
"
platform
:
"
android
"
domain
:
"
tieba
.
baidu
.
com
"
bug
:
"
945963
"
config
:
{
matches
:
[
"
*
:
/
/
tieba
.
baidu
.
com
/
*
"
"
*
:
/
/
tiebac
.
baidu
.
com
/
*
"
]
uaTransformer
:
originalUA
=
>
{
return
originalUA
+
"
AppleWebKit
/
537
.
36
(
KHTML
like
Gecko
)
"
;
}
}
}
{
id
:
"
bug1177298
-
2
"
platform
:
"
android
"
domain
:
"
lohaco
.
jp
"
bug
:
"
1177298
"
config
:
{
matches
:
[
"
*
:
/
/
*
.
lohaco
.
jp
/
*
"
]
uaTransformer
:
_
=
>
{
return
"
Mozilla
/
5
.
0
(
Linux
;
Android
5
.
0
.
2
;
Galaxy
Nexus
Build
/
IMM76B
)
AppleWebKit
/
537
.
36
(
KHTML
like
Gecko
)
Chrome
/
43
.
0
.
2357
.
93
Mobile
Safari
/
537
.
36
"
;
}
}
}
{
id
:
"
bug1177298
-
3
"
platform
:
"
android
"
domain
:
"
nhk
.
or
.
jp
"
bug
:
"
1177298
"
config
:
{
matches
:
[
"
*
:
/
/
*
.
nhk
.
or
.
jp
/
*
"
]
uaTransformer
:
originalUA
=
>
{
return
originalUA
+
"
AppleWebKit
"
;
}
}
}
{
id
:
"
bug1338260
"
platform
:
"
android
"
domain
:
"
directv
.
com
"
bug
:
"
1338260
"
config
:
{
matches
:
[
"
*
:
/
/
*
.
directv
.
com
/
*
"
]
uaTransformer
:
_
=
>
{
return
"
Mozilla
/
5
.
0
(
Linux
;
Android
6
.
0
.
1
;
SM
-
G920F
Build
/
MMB29K
)
AppleWebKit
/
537
.
36
(
KHTML
like
Gecko
)
Chrome
/
55
.
0
.
2883
.
91
Mobile
Safari
/
537
.
36
"
;
}
}
}
{
id
:
"
bug1385206
"
platform
:
"
android
"
domain
:
"
rakuten
.
co
.
jp
"
bug
:
"
1385206
"
config
:
{
matches
:
[
"
*
:
/
/
*
.
rakuten
.
co
.
jp
/
*
"
]
uaTransformer
:
originalUA
=
>
{
return
originalUA
.
replace
(
/
Firefox
.
+
/
"
"
)
;
}
}
}
{
id
:
"
bug969844
"
platform
:
"
android
"
domain
:
"
mobile
.
de
"
bug
:
"
969844
"
config
:
{
matches
:
[
"
*
:
/
/
*
.
mobile
.
de
/
*
"
]
uaTransformer
:
_
=
>
{
return
"
Mozilla
/
5
.
0
(
Linux
;
Android
6
.
0
.
1
;
SM
-
G920F
Build
/
MMB29K
)
AppleWebKit
/
537
.
36
(
KHTML
like
Gecko
)
Chrome
/
55
.
0
.
2883
.
91
Mobile
Safari
/
537
.
36
"
;
}
}
}
{
id
:
"
bug1509831
"
platform
:
"
android
"
domain
:
"
cc
.
com
"
bug
:
"
1509831
"
config
:
{
matches
:
[
"
*
:
/
/
*
.
cc
.
com
/
*
"
]
uaTransformer
:
_
=
>
{
return
"
Mozilla
/
5
.
0
(
Linux
;
Android
6
.
0
.
1
;
SM
-
G920F
Build
/
MMB29K
)
AppleWebKit
/
537
.
36
(
KHTML
like
Gecko
)
Chrome
/
55
.
0
.
2883
.
91
Mobile
Safari
/
537
.
36
"
;
}
}
}
{
id
:
"
bug1508516
"
platform
:
"
android
"
domain
:
"
cineflix
.
com
.
br
"
bug
:
"
1508516
"
config
:
{
matches
:
[
"
*
:
/
/
*
.
cineflix
.
com
.
br
/
m
/
*
"
]
uaTransformer
:
originalUA
=
>
{
return
(
UAHelpers
.
getPrefix
(
originalUA
)
+
"
AppleWebKit
/
537
.
36
(
KHTML
like
Gecko
)
Chrome
/
55
.
0
.
2883
.
91
Mobile
Safari
/
537
.
36
"
)
;
}
}
}
{
id
:
"
bug1509852
"
platform
:
"
android
"
domain
:
"
redbull
.
com
"
bug
:
"
1509852
"
config
:
{
matches
:
[
"
*
:
/
/
*
.
redbull
.
com
/
*
"
]
uaTransformer
:
originalUA
=
>
{
return
(
UAHelpers
.
getPrefix
(
originalUA
)
+
"
AppleWebKit
/
537
.
36
(
KHTML
like
Gecko
)
Chrome
/
55
.
0
.
2883
.
91
Mobile
Safari
/
537
.
36
"
)
;
}
}
}
{
id
:
"
bug1509873
"
platform
:
"
android
"
domain
:
"
zmags
.
com
"
bug
:
"
1509873
"
config
:
{
matches
:
[
"
*
:
/
/
*
.
viewer
.
zmags
.
com
/
*
"
]
uaTransformer
:
originalUA
=
>
{
return
(
UAHelpers
.
getPrefix
(
originalUA
)
+
"
AppleWebKit
/
537
.
36
(
KHTML
like
Gecko
)
Chrome
/
55
.
0
.
2883
.
91
Mobile
Safari
/
537
.
36
"
)
;
}
}
}
]
)
{
UAOverrides
.
push
(
override
)
;
}
const
UAHelpers
=
{
getPrefix
(
originalUA
)
{
return
originalUA
.
substr
(
0
originalUA
.
indexOf
(
"
)
"
)
+
1
)
;
}
}
;
const
ActiveListeners
=
new
Map
(
)
;
function
enableOverride
(
override
)
{
if
(
override
.
active
)
{
return
;
}
const
{
matches
uaTransformer
}
=
override
.
config
;
const
listener
=
details
=
>
{
for
(
var
header
of
details
.
requestHeaders
)
{
if
(
header
.
name
.
toLowerCase
(
)
=
=
=
"
user
-
agent
"
)
{
header
.
value
=
uaTransformer
(
header
.
value
)
;
}
}
return
{
requestHeaders
:
details
.
requestHeaders
}
;
}
;
browser
.
webRequest
.
onBeforeSendHeaders
.
addListener
(
listener
{
urls
:
matches
}
[
"
blocking
"
"
requestHeaders
"
]
)
;
ActiveListeners
.
set
(
override
listener
)
;
override
.
active
=
true
;
}
async
function
registerUAOverrides
(
)
{
const
platformMatches
=
[
"
all
"
]
;
let
platformInfo
=
await
browser
.
runtime
.
getPlatformInfo
(
)
;
platformMatches
.
push
(
platformInfo
.
os
=
=
"
android
"
?
"
android
"
:
"
desktop
"
)
;
for
(
const
override
of
UAOverrides
)
{
if
(
platformMatches
.
includes
(
override
.
platform
)
)
{
override
.
availableOnPlatform
=
true
;
enableOverride
(
override
)
;
}
}
UAOverridesEnabled
=
true
;
portsToAboutCompatTabs
.
broadcast
(
{
overridesChanged
:
filterOverrides
(
UAOverrides
)
}
)
;
}
function
unregisterUAOverrides
(
)
{
for
(
const
override
of
UAOverrides
)
{
disableOverride
(
override
)
;
}
UAOverridesEnabled
=
false
;
portsToAboutCompatTabs
.
broadcast
(
{
overridesChanged
:
false
}
)
;
}
function
disableOverride
(
override
)
{
if
(
!
override
.
active
)
{
return
;
}
browser
.
webRequest
.
onBeforeSendHeaders
.
removeListener
(
ActiveListeners
.
get
(
override
)
)
;
override
.
active
=
false
;
ActiveListeners
.
delete
(
override
)
;
}
const
OVERRIDE_PREF
=
"
perform_ua_overrides
"
;
function
checkOverridePref
(
)
{
browser
.
aboutConfigPrefs
.
getPref
(
OVERRIDE_PREF
)
.
then
(
value
=
>
{
if
(
value
=
=
=
undefined
)
{
browser
.
aboutConfigPrefs
.
setPref
(
OVERRIDE_PREF
true
)
;
}
else
if
(
value
=
=
=
false
)
{
unregisterUAOverrides
(
)
;
}
else
{
registerUAOverrides
(
)
;
}
}
)
;
}
browser
.
aboutConfigPrefs
.
onPrefChange
.
addListener
(
checkOverridePref
OVERRIDE_PREF
)
;
checkOverridePref
(
)
;
