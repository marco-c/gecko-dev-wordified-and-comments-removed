package
org
.
mozilla
.
gecko
.
sync
.
stage
;
import
java
.
net
.
URISyntaxException
;
import
org
.
mozilla
.
gecko
.
sync
.
MetaGlobalException
;
import
org
.
mozilla
.
gecko
.
sync
.
middleware
.
BufferingMiddlewareRepository
;
import
org
.
mozilla
.
gecko
.
sync
.
middleware
.
storage
.
MemoryBufferStorage
;
import
org
.
mozilla
.
gecko
.
sync
.
repositories
.
ConfigurableServer15Repository
;
import
org
.
mozilla
.
gecko
.
sync
.
repositories
.
NonPersistentRepositoryStateProvider
;
import
org
.
mozilla
.
gecko
.
sync
.
repositories
.
RecordFactory
;
import
org
.
mozilla
.
gecko
.
sync
.
repositories
.
Repository
;
import
org
.
mozilla
.
gecko
.
sync
.
repositories
.
android
.
AndroidBrowserBookmarksRepository
;
import
org
.
mozilla
.
gecko
.
sync
.
repositories
.
domain
.
BookmarkRecordFactory
;
import
org
.
mozilla
.
gecko
.
sync
.
repositories
.
domain
.
VersionConstants
;
public
class
AndroidBrowserBookmarksServerSyncStage
extends
ServerSyncStage
{
protected
static
final
String
LOG_TAG
=
"
BookmarksStage
"
;
private
static
final
String
BOOKMARKS_SORT
=
"
oldest
"
;
private
static
final
long
BOOKMARKS_BATCH_LIMIT
=
5000
;
Override
protected
String
getCollection
(
)
{
return
"
bookmarks
"
;
}
Override
protected
String
getEngineName
(
)
{
return
"
bookmarks
"
;
}
Override
public
Integer
getStorageVersion
(
)
{
return
VersionConstants
.
BOOKMARKS_ENGINE_VERSION
;
}
Override
protected
HighWaterMark
getAllowedToUseHighWaterMark
(
)
{
return
HighWaterMark
.
Disabled
;
}
Override
protected
MultipleBatches
getAllowedMultipleBatches
(
)
{
return
MultipleBatches
.
Enabled
;
}
Override
protected
Repository
getRemoteRepository
(
)
throws
URISyntaxException
{
return
new
ConfigurableServer15Repository
(
getCollection
(
)
session
.
getSyncDeadline
(
)
session
.
config
.
storageURL
(
)
session
.
getAuthHeaderProvider
(
)
session
.
config
.
infoCollections
session
.
config
.
infoConfiguration
BOOKMARKS_BATCH_LIMIT
BOOKMARKS_SORT
getAllowedMultipleBatches
(
)
getAllowedToUseHighWaterMark
(
)
getRepositoryStateProvider
(
)
)
;
}
Override
protected
Repository
getLocalRepository
(
)
{
return
new
BufferingMiddlewareRepository
(
session
.
getSyncDeadline
(
)
new
MemoryBufferStorage
(
)
new
AndroidBrowserBookmarksRepository
(
)
)
;
}
Override
protected
RecordFactory
getRecordFactory
(
)
{
return
new
BookmarkRecordFactory
(
)
;
}
Override
protected
boolean
isEnabled
(
)
throws
MetaGlobalException
{
if
(
session
=
=
null
|
|
session
.
getContext
(
)
=
=
null
)
{
return
false
;
}
return
super
.
isEnabled
(
)
;
}
}
