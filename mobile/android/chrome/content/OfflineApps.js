"
use
strict
"
;
var
OfflineApps
=
{
allowSite
:
function
(
aDocument
)
{
Services
.
perms
.
addFromPrincipal
(
aDocument
.
nodePrincipal
"
offline
-
app
"
Services
.
perms
.
ALLOW_ACTION
)
;
this
.
_startFetching
(
aDocument
)
;
}
disallowSite
:
function
(
aDocument
)
{
Services
.
perms
.
addFromPrincipal
(
aDocument
.
nodePrincipal
"
offline
-
app
"
Services
.
perms
.
DENY_ACTION
)
;
}
_startFetching
:
function
(
aDocument
)
{
if
(
!
aDocument
.
documentElement
)
{
return
;
}
let
manifest
=
aDocument
.
documentElement
.
getAttribute
(
"
manifest
"
)
;
if
(
!
manifest
)
{
return
;
}
let
manifestURI
=
Services
.
io
.
newURI
(
manifest
aDocument
.
characterSet
aDocument
.
documentURIObject
)
;
let
updateService
=
Cc
[
"
mozilla
.
org
/
offlinecacheupdate
-
service
;
1
"
]
.
getService
(
Ci
.
nsIOfflineCacheUpdateService
)
;
updateService
.
scheduleUpdate
(
manifestURI
aDocument
.
documentURIObject
aDocument
.
nodePrincipal
window
)
;
}
}
;
