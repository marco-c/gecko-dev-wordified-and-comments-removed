var
{
classes
:
Cc
interfaces
:
Ci
utils
:
Cu
}
=
Components
;
var
dump
=
Cu
.
import
(
"
resource
:
/
/
gre
/
modules
/
AndroidLog
.
jsm
"
{
}
)
.
AndroidLog
.
d
.
bind
(
null
"
ViewContent
"
)
;
function
debug
(
aMsg
)
{
}
var
DOMTitleChangedListener
=
{
init
:
function
(
)
{
addEventListener
(
"
DOMTitleChanged
"
this
false
)
;
addEventListener
(
"
MozDOMFullscreen
:
Entered
"
this
false
)
;
addEventListener
(
"
MozDOMFullscreen
:
Exit
"
this
false
)
;
addEventListener
(
"
MozDOMFullscreen
:
Exited
"
this
false
)
;
addEventListener
(
"
MozDOMFullscreen
:
Request
"
this
false
)
;
addMessageListener
(
"
GeckoView
:
DOMFullscreenEntered
"
this
)
;
addMessageListener
(
"
GeckoView
:
DOMFullscreenExited
"
this
)
;
}
receiveMessage
:
function
(
aMsg
)
{
debug
(
"
receiveMessage
"
+
aMsg
.
name
)
;
switch
(
aMsg
.
name
)
{
case
"
GeckoView
:
DOMFullscreenEntered
"
:
if
(
content
)
{
content
.
QueryInterface
(
Ci
.
nsIInterfaceRequestor
)
.
getInterface
(
Ci
.
nsIDOMWindowUtils
)
.
handleFullscreenRequests
(
)
;
}
break
;
case
"
GeckoView
:
DOMFullscreenExited
"
:
if
(
content
)
{
content
.
QueryInterface
(
Ci
.
nsIInterfaceRequestor
)
.
getInterface
(
Ci
.
nsIDOMWindowUtils
)
.
exitFullscreen
(
)
;
}
break
;
}
}
handleEvent
:
function
(
aEvent
)
{
if
(
aEvent
.
originalTarget
.
defaultView
!
=
content
)
{
return
;
}
debug
(
"
handleEvent
"
+
aEvent
.
type
)
;
switch
(
aEvent
.
type
)
{
case
"
MozDOMFullscreen
:
Request
"
:
sendAsyncMessage
(
"
GeckoView
:
DOMFullscreenRequest
"
)
;
break
;
case
"
MozDOMFullscreen
:
Entered
"
:
case
"
MozDOMFullscreen
:
Exited
"
:
if
(
content
&
&
content
.
document
.
fullscreenElement
)
{
break
;
}
case
"
MozDOMFullscreen
:
Exit
"
:
sendAsyncMessage
(
"
GeckoView
:
DOMFullscreenExit
"
)
;
break
;
case
"
DOMTitleChanged
"
:
sendAsyncMessage
(
"
GeckoView
:
DOMTitleChanged
"
{
title
:
content
.
document
.
title
}
)
;
break
;
}
}
}
;
DOMTitleChangedListener
.
init
(
)
;
