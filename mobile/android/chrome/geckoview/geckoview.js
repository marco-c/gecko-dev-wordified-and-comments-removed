"
use
strict
"
;
ChromeUtils
.
import
(
"
resource
:
/
/
gre
/
modules
/
XPCOMUtils
.
jsm
"
)
;
XPCOMUtils
.
defineLazyModuleGetters
(
this
{
EventDispatcher
:
"
resource
:
/
/
gre
/
modules
/
Messaging
.
jsm
"
GeckoViewUtils
:
"
resource
:
/
/
gre
/
modules
/
GeckoViewUtils
.
jsm
"
Services
:
"
resource
:
/
/
gre
/
modules
/
Services
.
jsm
"
}
)
;
XPCOMUtils
.
defineLazyGetter
(
this
"
WindowEventDispatcher
"
(
)
=
>
EventDispatcher
.
for
(
window
)
)
;
var
ModuleManager
=
{
init
:
function
(
aBrowser
)
{
this
.
browser
=
aBrowser
;
this
.
modules
=
new
Map
(
)
;
}
add
:
function
(
aResource
aType
.
.
.
aArgs
)
{
this
.
remove
(
aType
)
;
const
scope
=
{
}
;
const
global
=
ChromeUtils
.
import
(
aResource
scope
)
;
const
tag
=
aType
.
replace
(
"
GeckoView
"
"
GeckoView
.
"
)
;
GeckoViewUtils
.
initLogging
(
tag
global
)
;
this
.
modules
.
set
(
aType
new
scope
[
aType
]
(
aType
window
this
.
browser
WindowEventDispatcher
.
.
.
aArgs
)
)
;
}
remove
:
function
(
aType
)
{
this
.
modules
.
delete
(
aType
)
;
}
forEach
:
function
(
aCallback
)
{
this
.
modules
.
forEach
(
aCallback
this
)
;
}
}
;
function
createBrowser
(
)
{
const
browser
=
window
.
browser
=
document
.
createElement
(
"
browser
"
)
;
browser
.
setAttribute
(
"
type
"
"
content
"
)
;
browser
.
setAttribute
(
"
primary
"
"
true
"
)
;
browser
.
setAttribute
(
"
flex
"
"
1
"
)
;
return
browser
;
}
function
startup
(
)
{
GeckoViewUtils
.
initLogging
(
"
GeckoView
.
XUL
"
window
)
;
const
browser
=
createBrowser
(
)
;
ModuleManager
.
init
(
browser
)
;
ModuleManager
.
add
(
"
resource
:
/
/
gre
/
modules
/
GeckoViewNavigation
.
jsm
"
"
GeckoViewNavigation
"
)
;
ModuleManager
.
add
(
"
resource
:
/
/
gre
/
modules
/
GeckoViewSettings
.
jsm
"
"
GeckoViewSettings
"
)
;
ModuleManager
.
add
(
"
resource
:
/
/
gre
/
modules
/
GeckoViewContent
.
jsm
"
"
GeckoViewContent
"
)
;
ModuleManager
.
add
(
"
resource
:
/
/
gre
/
modules
/
GeckoViewProgress
.
jsm
"
"
GeckoViewProgress
"
)
;
ModuleManager
.
add
(
"
resource
:
/
/
gre
/
modules
/
GeckoViewScroll
.
jsm
"
"
GeckoViewScroll
"
)
;
ModuleManager
.
add
(
"
resource
:
/
/
gre
/
modules
/
GeckoViewTab
.
jsm
"
"
GeckoViewTab
"
)
;
ModuleManager
.
add
(
"
resource
:
/
/
gre
/
modules
/
GeckoViewTrackingProtection
.
jsm
"
"
GeckoViewTrackingProtection
"
)
;
ModuleManager
.
add
(
"
resource
:
/
/
gre
/
modules
/
GeckoViewSelectionAction
.
jsm
"
"
GeckoViewSelectionAction
"
)
;
ModuleManager
.
add
(
"
resource
:
/
/
gre
/
modules
/
GeckoViewAccessibility
.
jsm
"
"
GeckoViewAccessibility
"
)
;
window
.
document
.
documentElement
.
appendChild
(
browser
)
;
ModuleManager
.
forEach
(
module
=
>
{
module
.
onInit
(
)
;
module
.
onSettingsUpdate
(
)
;
}
)
;
browser
.
focus
(
)
;
}
