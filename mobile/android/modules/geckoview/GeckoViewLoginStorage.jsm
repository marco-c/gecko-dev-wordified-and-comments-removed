"
use
strict
"
;
const
EXPORTED_SYMBOLS
=
[
"
GeckoViewLoginStorage
"
"
LoginEntry
"
]
;
const
{
XPCOMUtils
}
=
ChromeUtils
.
import
(
"
resource
:
/
/
gre
/
modules
/
XPCOMUtils
.
jsm
"
)
;
const
{
GeckoViewUtils
}
=
ChromeUtils
.
import
(
"
resource
:
/
/
gre
/
modules
/
GeckoViewUtils
.
jsm
"
)
;
XPCOMUtils
.
defineLazyModuleGetters
(
this
{
EventDispatcher
:
"
resource
:
/
/
gre
/
modules
/
Messaging
.
jsm
"
}
)
;
XPCOMUtils
.
defineLazyGetter
(
this
"
LoginInfo
"
(
)
=
>
Components
.
Constructor
(
"
mozilla
.
org
/
login
-
manager
/
loginInfo
;
1
"
"
nsILoginInfo
"
"
init
"
)
)
;
class
LoginEntry
{
constructor
(
)
{
this
.
origin
=
null
;
this
.
formActionOrigin
=
null
;
this
.
httpRealm
=
null
;
this
.
username
=
null
;
this
.
password
=
null
;
this
.
guid
=
null
;
this
.
timeCreated
=
null
;
this
.
timeLastUsed
=
null
;
this
.
timePasswordChanged
=
null
;
this
.
timesUsed
=
null
;
}
toLoginInfo
(
)
{
const
info
=
new
LoginInfo
(
this
.
origin
this
.
formActionOrigin
this
.
httpRealm
this
.
username
this
.
password
)
;
info
.
QueryInterface
(
Ci
.
nsILoginMetaInfo
)
;
info
.
guid
=
this
.
guid
;
info
.
timeCreated
=
this
.
timeCreated
;
info
.
timeLastUsed
=
this
.
timeLastUsed
;
info
.
timePasswordChanged
=
this
.
timePasswordChanged
;
info
.
timesUsed
=
this
.
timesUsed
;
return
info
;
}
static
fromBundle
(
aObj
)
{
const
entry
=
new
LoginEntry
(
)
;
Object
.
assign
(
entry
aObj
)
;
return
entry
;
}
static
fromLoginInfo
(
aInfo
)
{
const
entry
=
new
LoginEntry
(
)
;
entry
.
origin
=
aInfo
.
origin
;
entry
.
formActionOrigin
=
aInfo
.
formActionOrigin
;
entry
.
httpRealm
=
aInfo
.
httpRealm
;
entry
.
username
=
aInfo
.
username
;
entry
.
password
=
aInfo
.
password
;
aInfo
.
QueryInterface
(
Ci
.
nsILoginMetaInfo
)
;
entry
.
guid
=
aInfo
.
guid
;
entry
.
timeCreated
=
aInfo
.
timeCreated
;
entry
.
timeLastUsed
=
aInfo
.
timeLastUsed
;
entry
.
timePasswordChanged
=
aInfo
.
timePasswordChanged
;
entry
.
timesUsed
=
aInfo
.
timesUsed
;
return
entry
;
}
}
const
UsedField
=
{
PASSWORD
:
1
}
;
const
GeckoViewLoginStorage
=
{
fetchLogins
(
aDomain
)
{
debug
fetchLogins
for
{
aDomain
}
;
return
EventDispatcher
.
instance
.
sendRequestForResult
(
{
type
:
"
GeckoView
:
LoginStorage
:
Fetch
"
domain
:
aDomain
}
)
;
}
onLoginSave
(
aLogin
)
{
debug
onLoginSave
{
aLogin
}
;
EventDispatcher
.
instance
.
sendRequest
(
{
type
:
"
GeckoView
:
LoginStorage
:
Save
"
login
:
aLogin
}
)
;
}
onLoginPasswordUsed
(
aLogin
)
{
debug
onLoginUsed
{
aLogin
}
;
EventDispatcher
.
instance
.
sendRequest
(
{
type
:
"
GeckoView
:
LoginStorage
:
Used
"
usedFields
:
UsedField
.
PASSWORD
login
:
aLogin
}
)
;
}
}
;
const
{
debug
}
=
GeckoViewUtils
.
initLogging
(
"
GeckoViewLoginStorage
"
)
;
