"
use
strict
"
;
var
EXPORTED_SYMBOLS
=
[
"
Accounts
"
]
;
const
{
EventDispatcher
}
=
ChromeUtils
.
import
(
"
resource
:
/
/
gre
/
modules
/
Messaging
.
jsm
"
)
;
const
{
Services
}
=
ChromeUtils
.
import
(
"
resource
:
/
/
gre
/
modules
/
Services
.
jsm
"
)
;
var
Accounts
=
Object
.
freeze
(
{
_accountsExist
:
function
(
kind
)
{
return
EventDispatcher
.
instance
.
sendRequestForResult
(
{
type
:
"
Accounts
:
Exist
"
kind
:
kind
}
)
.
then
(
data
=
>
data
.
exists
)
;
}
firefoxAccountsExist
:
function
(
)
{
return
this
.
_accountsExist
(
"
fxa
"
)
;
}
anySyncAccountsExist
:
function
(
)
{
return
this
.
_accountsExist
(
"
any
"
)
;
}
launchSetup
:
function
(
extras
)
{
EventDispatcher
.
instance
.
sendRequest
(
{
type
:
"
Accounts
:
Create
"
extras
:
extras
}
)
;
}
_addDefaultEndpoints
:
function
(
json
)
{
let
newData
=
Cu
.
cloneInto
(
json
{
}
{
cloneFunctions
:
false
}
)
;
let
associations
=
{
authServerEndpoint
:
"
identity
.
fxaccounts
.
auth
.
uri
"
profileServerEndpoint
:
"
identity
.
fxaccounts
.
remote
.
profile
.
uri
"
tokenServerEndpoint
:
"
identity
.
sync
.
tokenserver
.
uri
"
}
;
for
(
let
key
in
associations
)
{
newData
[
key
]
=
newData
[
key
]
|
|
Services
.
urlFormatter
.
formatURLPref
(
associations
[
key
]
)
;
}
return
newData
;
}
createFirefoxAccountFromJSON
:
function
(
json
)
{
return
EventDispatcher
.
instance
.
sendRequestForResult
(
{
type
:
"
Accounts
:
CreateFirefoxAccountFromJSON
"
json
:
this
.
_addDefaultEndpoints
(
json
)
}
)
;
}
updateFirefoxAccountFromJSON
:
function
(
json
)
{
return
EventDispatcher
.
instance
.
sendRequestForResult
(
{
type
:
"
Accounts
:
UpdateFirefoxAccountFromJSON
"
json
:
this
.
_addDefaultEndpoints
(
json
)
}
)
;
}
notifyFirefoxAccountProfileChanged
:
function
(
)
{
EventDispatcher
.
instance
.
sendRequest
(
{
type
:
"
Accounts
:
ProfileUpdated
"
}
)
;
}
getFirefoxAccount
:
function
(
)
{
return
EventDispatcher
.
instance
.
sendRequestForResult
(
{
type
:
"
Accounts
:
Exist
"
kind
:
"
fxa
"
}
)
.
then
(
data
=
>
{
if
(
!
data
|
|
!
data
.
exists
)
{
return
null
;
}
delete
data
.
exists
;
return
data
;
}
)
;
}
deleteFirefoxAccount
:
function
(
)
{
return
EventDispatcher
.
instance
.
sendRequestForResult
(
{
type
:
"
Accounts
:
DeleteFirefoxAccount
"
}
)
;
}
showSyncPreferences
:
function
(
)
{
return
Accounts
.
getFirefoxAccount
(
)
.
then
(
account
=
>
{
if
(
!
account
)
{
throw
new
Error
(
"
Can
'
t
show
Sync
preferences
of
non
-
existent
Firefox
Account
!
"
)
;
}
return
EventDispatcher
.
instance
.
sendRequestForResult
(
{
type
:
"
Accounts
:
ShowSyncPreferences
"
}
)
;
}
)
;
}
}
)
;
