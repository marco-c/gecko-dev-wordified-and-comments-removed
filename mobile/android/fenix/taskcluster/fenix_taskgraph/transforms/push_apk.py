"
"
"
Apply
some
defaults
and
minor
modifications
to
the
jobs
defined
in
the
build
kind
.
"
"
"
from
__future__
import
absolute_import
print_function
unicode_literals
from
taskgraph
.
transforms
.
base
import
TransformSequence
from
taskgraph
.
util
.
schema
import
resolve_keyed_by
transforms
=
TransformSequence
(
)
transforms
.
add
def
resolve_keys
(
config
tasks
)
:
    
for
task
in
tasks
:
        
for
key
in
(
"
worker
.
channel
"
"
worker
.
commit
"
"
worker
.
dep
"
)
:
            
resolve_keyed_by
(
                
task
                
key
                
item_name
=
task
[
"
name
"
]
                
*
*
{
                    
'
build
-
type
'
:
task
[
"
attributes
"
]
[
"
build
-
type
"
]
                    
'
level
'
:
config
.
params
[
"
level
"
]
                
}
            
)
        
yield
task
transforms
.
add
def
build_worker_definition
(
config
tasks
)
:
    
for
task
in
tasks
:
        
worker_definition
=
{
}
        
worker_definition
[
"
certificate
-
alias
"
]
=
"
{
}
-
{
}
"
.
format
(
            
task
[
"
worker
"
]
[
"
product
"
]
task
[
"
worker
"
]
[
"
channel
"
]
        
)
        
if
task
[
"
attributes
"
]
[
"
build
-
type
"
]
=
=
"
production
"
:
            
worker_definition
[
"
certificate
-
alias
"
]
=
"
fenix
"
        
elif
task
[
"
attributes
"
]
[
"
build
-
type
"
]
=
=
"
fennec
-
nightly
"
:
            
worker_definition
[
"
certificate
-
alias
"
]
=
"
fennec
-
nightly
"
        
task
[
"
worker
"
]
.
update
(
worker_definition
)
        
yield
task
