package
com
.
leanplum
;
import
android
.
content
.
Context
;
import
com
.
leanplum
.
internal
.
Constants
;
import
com
.
leanplum
.
internal
.
Log
;
import
com
.
leanplum
.
utils
.
SharedPreferencesUtil
;
abstract
class
LeanplumCloudMessagingProvider
{
static
final
String
PUSH_REGISTRATION_SERVICE
=
"
com
.
leanplum
.
LeanplumPushRegistrationService
"
;
static
final
String
PUSH_RECEIVER
=
"
com
.
leanplum
.
LeanplumPushReceiver
"
;
private
static
String
registrationId
;
public
abstract
String
getRegistrationId
(
)
;
public
abstract
boolean
isManifestSetUp
(
)
;
public
abstract
boolean
isInitialized
(
)
;
public
abstract
void
unregister
(
)
;
static
String
getCurrentRegistrationId
(
)
{
return
registrationId
;
}
void
onRegistrationIdReceived
(
Context
context
String
registrationId
)
{
if
(
registrationId
=
=
null
)
{
Log
.
w
(
"
Registration
ID
is
undefined
.
"
)
;
return
;
}
LeanplumCloudMessagingProvider
.
registrationId
=
registrationId
;
if
(
!
LeanplumCloudMessagingProvider
.
registrationId
.
equals
(
SharedPreferencesUtil
.
getString
(
context
Constants
.
Defaults
.
LEANPLUM_PUSH
Constants
.
Defaults
.
PROPERTY_REGISTRATION_ID
)
)
)
{
Log
.
i
(
"
Device
registered
for
push
notifications
with
registration
token
"
registrationId
)
;
storePreferences
(
context
.
getApplicationContext
(
)
)
;
}
sendRegistrationIdToBackend
(
LeanplumCloudMessagingProvider
.
registrationId
)
;
}
private
static
void
sendRegistrationIdToBackend
(
String
registrationId
)
{
Leanplum
.
setRegistrationId
(
registrationId
)
;
}
public
void
storePreferences
(
Context
context
)
{
Log
.
v
(
"
Saving
the
registration
ID
in
the
shared
preferences
.
"
)
;
SharedPreferencesUtil
.
setString
(
context
Constants
.
Defaults
.
LEANPLUM_PUSH
Constants
.
Defaults
.
PROPERTY_REGISTRATION_ID
registrationId
)
;
}
}
