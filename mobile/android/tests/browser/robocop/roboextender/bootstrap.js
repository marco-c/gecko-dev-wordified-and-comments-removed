ChromeUtils
.
import
(
"
resource
:
/
/
gre
/
modules
/
Messaging
.
jsm
"
)
;
ChromeUtils
.
import
(
"
resource
:
/
/
gre
/
modules
/
Services
.
jsm
"
)
;
function
loadIntoWindow
(
window
)
{
}
function
unloadFromWindow
(
window
)
{
}
var
windowListener
=
{
onOpenWindow
:
function
(
aWindow
)
{
let
domWindow
=
aWindow
.
QueryInterface
(
Ci
.
nsIInterfaceRequestor
)
.
getInterface
(
Ci
.
nsIDOMWindow
)
;
domWindow
.
addEventListener
(
"
load
"
function
(
)
{
if
(
domWindow
)
{
domWindow
.
addEventListener
(
"
scroll
"
function
(
e
)
{
let
message
=
{
type
:
"
Robocop
:
Scroll
"
y
:
XPCNativeWrapper
.
unwrap
(
e
.
target
)
.
documentElement
.
scrollTop
height
:
XPCNativeWrapper
.
unwrap
(
e
.
target
)
.
documentElement
.
scrollHeight
cheight
:
XPCNativeWrapper
.
unwrap
(
e
.
target
)
.
documentElement
.
clientHeight
}
;
EventDispatcher
.
instance
.
sendRequest
(
message
)
;
}
)
;
}
}
{
once
:
true
}
)
;
}
onCloseWindow
:
function
(
aWindow
)
{
}
}
;
function
startup
(
aData
aReason
)
{
Services
.
wm
.
addListener
(
windowListener
)
;
EventDispatcher
.
instance
.
registerListener
(
function
(
event
data
callback
)
{
dump
(
"
Robocop
:
Quit
received
-
-
requesting
quit
"
)
;
Services
.
startup
.
quit
(
Ci
.
nsIAppStartup
.
eForceQuit
)
;
}
"
Robocop
:
Quit
"
)
;
}
function
shutdown
(
aData
aReason
)
{
if
(
aReason
=
=
APP_SHUTDOWN
)
return
;
Services
.
wm
.
removeListener
(
windowListener
)
;
}
function
install
(
aData
aReason
)
{
}
function
uninstall
(
aData
aReason
)
{
}
