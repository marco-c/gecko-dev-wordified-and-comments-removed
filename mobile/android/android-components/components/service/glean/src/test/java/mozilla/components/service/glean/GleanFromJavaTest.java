package
mozilla
.
components
.
service
.
glean
;
import
androidx
.
test
.
core
.
app
.
ApplicationProvider
;
import
androidx
.
work
.
testing
.
WorkManagerTestInitHelper
;
import
android
.
content
.
Context
;
import
org
.
junit
.
Test
;
import
org
.
junit
.
runner
.
RunWith
;
import
org
.
robolectric
.
RobolectricTestRunner
;
import
java
.
util
.
HashMap
;
import
java
.
util
.
Map
;
import
mozilla
.
components
.
lib
.
fetch
.
httpurlconnection
.
HttpURLConnectionClient
;
import
mozilla
.
components
.
service
.
glean
.
config
.
Configuration
;
import
mozilla
.
components
.
service
.
glean
.
net
.
ConceptFetchHttpUploader
;
RunWith
(
RobolectricTestRunner
.
class
)
public
class
GleanFromJavaTest
{
Test
public
void
testInitGleanWithDefaults
(
)
{
Context
context
=
ApplicationProvider
.
getApplicationContext
(
)
;
WorkManagerTestInitHelper
.
initializeTestWorkManager
(
context
)
;
ConceptFetchHttpUploader
httpClient
=
ConceptFetchHttpUploader
.
fromClient
(
new
HttpURLConnectionClient
(
)
)
;
Configuration
config
=
new
Configuration
(
httpClient
)
;
Glean
.
INSTANCE
.
initialize
(
context
true
config
)
;
}
Test
public
void
testInitGleanWithConfiguration
(
)
{
Context
context
=
ApplicationProvider
.
getApplicationContext
(
)
;
WorkManagerTestInitHelper
.
initializeTestWorkManager
(
context
)
;
ConceptFetchHttpUploader
httpClient
=
ConceptFetchHttpUploader
.
fromClient
(
new
HttpURLConnectionClient
(
)
)
;
Configuration
config
=
new
Configuration
(
httpClient
Configuration
.
DEFAULT_TELEMETRY_ENDPOINT
"
test
-
channel
"
)
;
Glean
.
INSTANCE
.
initialize
(
context
true
config
)
;
}
Test
public
void
testGleanExperimentsAPIWithDefaults
(
)
{
Glean
.
INSTANCE
.
setExperimentActive
(
"
test
-
exp
-
id
-
1
"
"
test
-
branch
-
1
"
)
;
}
Test
public
void
testGleanExperimentsAPIWithOptional
(
)
{
Map
<
String
String
>
experimentProperties
=
new
HashMap
<
>
(
)
;
experimentProperties
.
put
(
"
test
-
prop1
"
"
test
-
prop
-
result1
"
)
;
Glean
.
INSTANCE
.
setExperimentActive
(
"
test
-
exp
-
id
-
1
"
"
test
-
branch
-
1
"
experimentProperties
)
;
}
}
