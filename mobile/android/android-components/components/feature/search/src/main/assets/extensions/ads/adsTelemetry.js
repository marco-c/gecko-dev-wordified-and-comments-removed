function
sendCurrentState
(
)
{
let
message
=
{
url
:
document
.
location
.
href
urls
:
getLinks
(
)
cookies
:
getCookies
(
)
}
;
browser
.
runtime
.
sendNativeMessage
(
"
MozacBrowserAdsMessage
"
message
)
;
}
function
getLinks
(
)
{
let
urls
=
[
]
;
let
anchors
=
document
.
getElementsByTagName
(
"
a
"
)
;
for
(
let
anchor
of
anchors
)
{
if
(
!
anchor
.
href
)
{
continue
;
}
urls
.
push
(
anchor
.
href
)
;
}
return
urls
;
}
function
getCookies
(
)
{
let
cookiesList
=
document
.
cookie
.
split
(
"
;
"
)
;
let
result
=
[
]
;
cookiesList
.
forEach
(
cookie
=
>
{
var
[
name
.
.
.
value
]
=
cookie
.
split
(
"
=
"
)
;
value
=
value
.
join
(
"
=
"
)
;
result
.
push
(
{
name
:
name
value
:
value
}
)
;
}
)
;
return
result
;
}
const
events
=
[
"
pageshow
"
"
load
"
]
;
const
eventLogger
=
event
=
>
{
switch
(
event
.
type
)
{
case
"
load
"
:
sendCurrentState
(
)
;
break
;
case
"
pageshow
"
:
if
(
event
.
persisted
)
{
sendCurrentState
(
)
;
}
break
;
default
:
console
.
log
(
"
Event
:
"
event
.
type
)
;
}
}
;
events
.
forEach
(
eventName
=
>
window
.
addEventListener
(
eventName
eventLogger
)
)
;
