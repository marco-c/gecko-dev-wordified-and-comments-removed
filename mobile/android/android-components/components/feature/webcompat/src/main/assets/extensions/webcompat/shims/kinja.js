"
use
-
strict
"
;
const
STORAGE_ACCESS_ORIGIN
=
"
https
:
/
/
kinja
.
com
"
;
const
OAUTH_PATH_PREFIX
=
"
/
oauthlogin
?
provider
=
"
;
console
.
warn
(
When
using
oauth
Firefox
calls
the
Storage
Access
API
on
behalf
of
the
site
.
See
https
:
/
/
bugzilla
.
mozilla
.
org
/
show_bug
.
cgi
?
id
=
1656171
for
details
.
)
;
const
origOpen
=
window
.
wrappedJSObject
.
open
;
Object
.
defineProperty
(
window
.
wrappedJSObject
"
open
"
{
value
:
exportFunction
(
(
url
.
.
.
args
)
=
>
{
if
(
!
url
.
startsWith
(
OAUTH_PATH_PREFIX
)
)
{
return
origOpen
(
url
.
.
.
args
)
;
}
document
.
requestStorageAccessForOrigin
(
STORAGE_ACCESS_ORIGIN
)
.
then
(
(
)
=
>
{
origOpen
(
url
.
.
.
args
)
;
}
)
;
return
null
;
}
window
)
}
)
;
