"
use
strict
"
;
const
STORAGE_ACCESS_ORIGIN
=
"
https
:
/
/
figshare
.
com
"
;
console
.
warn
(
When
logging
in
Firefox
calls
the
Storage
Access
API
on
behalf
of
the
site
.
See
https
:
/
/
bugzilla
.
mozilla
.
org
/
show_bug
.
cgi
?
id
=
1895990
for
details
.
)
;
document
.
documentElement
.
addEventListener
(
"
click
"
e
=
>
{
const
{
target
isTrusted
}
=
e
;
if
(
!
isTrusted
)
{
return
;
}
const
link
=
target
.
closest
(
a
[
href
^
=
"
https
:
/
/
login
.
figshare
.
com
"
]
)
;
if
(
!
link
)
{
return
;
}
console
.
warn
(
"
Calling
the
Storage
Access
API
on
behalf
of
"
+
STORAGE_ACCESS_ORIGIN
)
;
e
.
stopPropagation
(
)
;
e
.
preventDefault
(
)
;
document
.
requestStorageAccessForOrigin
(
STORAGE_ACCESS_ORIGIN
)
.
then
(
(
)
=
>
{
link
.
click
(
)
;
}
)
;
}
true
)
;
function
watchFirefoxNotificationDialogAndHide
(
)
{
const
observer
=
new
MutationObserver
(
(
mutations
obs
)
=
>
{
const
element
=
document
.
querySelector
(
"
div
[
data
-
alerts
-
channel
=
'
firefox
-
notifications
'
]
"
)
;
if
(
element
)
{
element
.
style
.
display
=
"
none
"
;
obs
.
disconnect
(
)
;
}
}
)
;
observer
.
observe
(
document
.
body
{
childList
:
true
subtree
:
true
}
)
;
}
const
notificationElement
=
document
.
querySelector
(
"
div
[
data
-
alerts
-
channel
=
'
firefox
-
notifications
'
]
"
)
;
if
(
notificationElement
)
{
notificationElement
.
style
.
display
=
"
none
"
;
}
else
{
window
.
addEventListener
(
"
DOMContentLoaded
"
watchFirefoxNotificationDialogAndHide
)
;
}
