"
use
strict
"
;
const
onMessageFromTab
=
(
function
(
)
{
const
handlers
=
new
Set
(
)
;
browser
.
runtime
.
onMessage
.
addListener
(
(
msg
sender
)
=
>
{
const
promises
=
[
.
.
.
handlers
.
values
(
)
]
.
map
(
fn
=
>
fn
(
msg
sender
)
)
;
return
Promise
.
allSettled
(
promises
)
.
then
(
results
=
>
{
for
(
const
{
reason
value
}
of
results
)
{
if
(
reason
)
{
console
.
error
(
reason
)
;
}
else
if
(
value
!
=
=
undefined
)
{
return
value
;
}
}
return
undefined
;
}
)
;
}
)
;
return
function
(
handler
)
{
handlers
.
add
(
handler
)
;
}
;
}
)
(
)
;
