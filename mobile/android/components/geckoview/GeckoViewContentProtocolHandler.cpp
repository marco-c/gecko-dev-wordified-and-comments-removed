#
include
"
GeckoViewContentProtocolHandler
.
h
"
#
include
"
GeckoViewContentChannel
.
h
"
#
include
"
GeckoViewContentChannelChild
.
h
"
#
include
"
nsStandardURL
.
h
"
#
include
"
nsURLHelper
.
h
"
#
include
"
nsIURIMutator
.
h
"
#
include
"
nsNetUtil
.
h
"
#
include
"
mozilla
/
ResultExtensions
.
h
"
nsresult
GeckoViewContentProtocolHandler
:
:
Init
(
)
{
return
NS_OK
;
}
NS_IMPL_ISUPPORTS
(
GeckoViewContentProtocolHandler
nsIProtocolHandler
nsISupportsWeakReference
)
NS_IMETHODIMP
GeckoViewContentProtocolHandler
:
:
GetScheme
(
nsACString
&
result
)
{
result
.
AssignLiteral
(
"
content
"
)
;
return
NS_OK
;
}
NS_IMETHODIMP
GeckoViewContentProtocolHandler
:
:
NewChannel
(
nsIURI
*
uri
nsILoadInfo
*
aLoadInfo
nsIChannel
*
*
result
)
{
nsresult
rv
;
RefPtr
<
nsBaseChannel
>
channel
;
if
(
XRE_IsParentProcess
(
)
)
{
channel
=
new
GeckoViewContentChannel
(
uri
)
;
}
else
{
channel
=
new
mozilla
:
:
net
:
:
GeckoViewContentChannelChild
(
uri
)
;
}
rv
=
channel
-
>
SetLoadInfo
(
aLoadInfo
)
;
if
(
NS_FAILED
(
rv
)
)
{
return
rv
;
}
*
result
=
channel
.
forget
(
)
.
take
(
)
;
return
NS_OK
;
}
NS_IMETHODIMP
GeckoViewContentProtocolHandler
:
:
AllowPort
(
int32_t
port
const
char
*
scheme
bool
*
result
)
{
*
result
=
false
;
return
NS_OK
;
}
