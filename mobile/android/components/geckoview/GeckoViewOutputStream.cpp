#
include
"
GeckoViewOutputStream
.
h
"
#
include
"
mozilla
/
fallible
.
h
"
using
namespace
mozilla
;
NS_IMPL_ISUPPORTS
(
GeckoViewOutputStream
nsIOutputStream
)
;
NS_IMETHODIMP
GeckoViewOutputStream
:
:
Close
(
)
{
mStream
-
>
SendEof
(
)
;
return
NS_OK
;
}
NS_IMETHODIMP
GeckoViewOutputStream
:
:
Flush
(
)
{
return
NS_ERROR_NOT_IMPLEMENTED
;
}
NS_IMETHODIMP
GeckoViewOutputStream
:
:
StreamStatus
(
)
{
return
mStream
-
>
IsStreamClosed
(
)
?
NS_BASE_STREAM_CLOSED
:
NS_OK
;
}
NS_IMETHODIMP
GeckoViewOutputStream
:
:
Write
(
const
char
*
buf
uint32_t
count
uint32_t
*
retval
)
{
jni
:
:
ByteArray
:
:
LocalRef
buffer
=
jni
:
:
ByteArray
:
:
New
(
reinterpret_cast
<
const
int8_t
*
>
(
buf
)
count
fallible
)
;
if
(
!
buffer
)
{
return
NS_ERROR_OUT_OF_MEMORY
;
}
if
(
NS_FAILED
(
mStream
-
>
AppendBuffer
(
buffer
)
)
)
{
return
NS_BASE_STREAM_CLOSED
;
}
*
retval
=
count
;
return
NS_OK
;
}
NS_IMETHODIMP
GeckoViewOutputStream
:
:
WriteFrom
(
nsIInputStream
*
fromStream
uint32_t
count
uint32_t
*
retval
)
{
return
NS_ERROR_NOT_IMPLEMENTED
;
}
NS_IMETHODIMP
GeckoViewOutputStream
:
:
WriteSegments
(
nsReadSegmentFun
reader
void
*
closure
uint32_t
count
uint32_t
*
retval
)
{
return
NS_ERROR_NOT_IMPLEMENTED
;
}
NS_IMETHODIMP
GeckoViewOutputStream
:
:
IsNonBlocking
(
bool
*
retval
)
{
*
retval
=
true
;
return
NS_OK
;
}
