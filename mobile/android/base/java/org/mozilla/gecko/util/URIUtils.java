package
org
.
mozilla
.
gecko
.
util
;
import
android
.
content
.
Context
;
import
android
.
support
.
annotation
.
NonNull
;
import
android
.
support
.
annotation
.
Nullable
;
import
android
.
support
.
annotation
.
WorkerThread
;
import
ch
.
boye
.
httpclientandroidlib
.
util
.
TextUtils
;
import
org
.
mozilla
.
gecko
.
util
.
publicsuffix
.
PublicSuffix
;
import
java
.
net
.
URI
;
import
java
.
net
.
URISyntaxException
;
public
class
URIUtils
{
private
URIUtils
(
)
{
}
WorkerThread
public
static
String
getHostSecondLevelDomain
(
NonNull
final
Context
context
NonNull
final
String
uriString
)
throws
URISyntaxException
{
if
(
context
=
=
null
)
{
throw
new
NullPointerException
(
"
Expected
non
-
null
Context
argument
"
)
;
}
if
(
uriString
=
=
null
)
{
throw
new
NullPointerException
(
"
Expected
non
-
null
uri
argument
"
)
;
}
final
URI
uri
=
new
URI
(
uriString
)
;
final
String
baseDomain
=
getBaseDomain
(
context
uri
)
;
if
(
baseDomain
=
=
null
)
{
final
String
normalizedHost
=
StringUtils
.
stripCommonSubdomains
(
uri
.
getHost
(
)
)
;
return
!
TextUtils
.
isEmpty
(
normalizedHost
)
?
normalizedHost
:
uriString
;
}
return
PublicSuffix
.
stripPublicSuffix
(
context
baseDomain
)
;
}
Nullable
WorkerThread
public
static
String
getBaseDomain
(
NonNull
final
Context
context
final
URI
uri
)
{
final
String
host
=
uri
.
getHost
(
)
;
if
(
isIPv6
(
uri
)
|
|
TextUtils
.
isEmpty
(
host
)
)
{
return
null
;
}
if
(
!
host
.
contains
(
"
.
"
)
)
{
return
host
;
}
final
String
publicSuffixWithDomain
=
PublicSuffix
.
getPublicSuffix
(
context
host
1
)
;
return
!
TextUtils
.
isEmpty
(
publicSuffixWithDomain
)
?
publicSuffixWithDomain
:
null
;
}
private
static
boolean
isIPv6
(
final
URI
uri
)
{
final
String
host
=
uri
.
getHost
(
)
;
return
!
TextUtils
.
isEmpty
(
host
)
&
&
host
.
contains
(
"
:
"
)
;
}
}
