package
org
.
mozilla
.
gecko
.
util
;
import
android
.
content
.
Context
;
import
android
.
util
.
Log
;
import
org
.
mozilla
.
gecko
.
mozglue
.
ContextUtils
.
SafeIntent
;
import
android
.
text
.
TextUtils
;
import
com
.
keepsafe
.
switchboard
.
Preferences
;
import
com
.
keepsafe
.
switchboard
.
SwitchBoard
;
import
org
.
mozilla
.
gecko
.
GeckoSharedPrefs
;
import
java
.
util
.
LinkedList
;
import
java
.
util
.
List
;
public
class
Experiments
{
private
static
final
String
LOGTAG
=
"
GeckoExperiments
"
;
public
static
final
String
SEARCH_TERM
=
"
search
-
term
"
;
public
static
final
String
WHATSNEW_NOTIFICATION
=
"
whatsnew
-
notification
"
;
public
static
final
String
CONTENT_NOTIFICATIONS_12HRS
=
"
content
-
notifications
-
12hrs
"
;
public
static
final
String
CONTENT_NOTIFICATIONS_8AM
=
"
content
-
notifications
-
8am
"
;
public
static
final
String
CONTENT_NOTIFICATIONS_5PM
=
"
content
-
notifications
-
5pm
"
;
public
static
final
String
ONBOARDING2_A
=
"
onboarding2
-
a
"
;
public
static
final
String
ONBOARDING2_B
=
"
onboarding2
-
b
"
;
public
static
final
String
ONBOARDING2_C
=
"
onboarding2
-
c
"
;
public
static
final
String
DOWNLOAD_CONTENT_CATALOG_SYNC
=
"
download
-
content
-
catalog
-
sync
"
;
public
static
final
String
PROMOTE_ADD_TO_HOMESCREEN
=
"
promote
-
add
-
to
-
homescreen
"
;
public
static
final
String
PREF_ONBOARDING_VERSION
=
"
onboarding_version
"
;
public
static
final
String
TRIPLE_READERVIEW_BOOKMARK_PROMPT
=
"
triple
-
readerview
-
bookmark
-
prompt
"
;
private
static
volatile
Boolean
disabled
=
null
;
public
static
boolean
isDisabled
(
SafeIntent
intent
)
{
if
(
disabled
!
=
null
)
{
return
disabled
;
}
String
env
=
intent
.
getStringExtra
(
"
env0
"
)
;
for
(
int
i
=
1
;
env
!
=
null
;
i
+
+
)
{
if
(
env
.
startsWith
(
"
MOZ_DISABLE_SWITCHBOARD
=
"
)
)
{
if
(
!
env
.
endsWith
(
"
=
"
)
)
{
Log
.
d
(
LOGTAG
"
Switchboard
disabled
by
MOZ_DISABLE_SWITCHBOARD
environment
variable
"
)
;
disabled
=
true
;
return
disabled
;
}
}
env
=
intent
.
getStringExtra
(
"
env
"
+
i
)
;
}
disabled
=
false
;
return
disabled
;
}
public
static
boolean
isInExperimentLocal
(
Context
context
String
experiment
)
{
if
(
SwitchBoard
.
isInBucket
(
context
0
33
)
)
{
return
Experiments
.
ONBOARDING2_A
.
equals
(
experiment
)
;
}
else
if
(
SwitchBoard
.
isInBucket
(
context
33
66
)
)
{
return
Experiments
.
ONBOARDING2_B
.
equals
(
experiment
)
;
}
else
if
(
SwitchBoard
.
isInBucket
(
context
66
100
)
)
{
return
Experiments
.
ONBOARDING2_C
.
equals
(
experiment
)
;
}
else
{
return
false
;
}
}
public
static
List
<
String
>
getActiveExperiments
(
Context
c
)
{
final
List
<
String
>
experiments
=
new
LinkedList
<
>
(
)
;
experiments
.
addAll
(
SwitchBoard
.
getActiveExperiments
(
c
)
)
;
final
String
onboardingExperiment
=
GeckoSharedPrefs
.
forProfile
(
c
)
.
getString
(
Experiments
.
PREF_ONBOARDING_VERSION
null
)
;
if
(
!
TextUtils
.
isEmpty
(
onboardingExperiment
)
)
{
experiments
.
add
(
onboardingExperiment
)
;
}
return
experiments
;
}
public
static
void
setOverride
(
Context
c
String
experimentName
boolean
isEnabled
)
{
Log
.
d
(
LOGTAG
"
setOverride
:
"
+
experimentName
+
"
=
"
+
isEnabled
)
;
Preferences
.
setOverrideValue
(
c
experimentName
isEnabled
)
;
}
public
static
void
clearOverride
(
Context
c
String
experimentName
)
{
Log
.
d
(
LOGTAG
"
clearOverride
:
"
+
experimentName
)
;
Preferences
.
clearOverrideValue
(
c
experimentName
)
;
}
}
