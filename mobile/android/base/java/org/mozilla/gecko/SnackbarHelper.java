package
org
.
mozilla
.
gecko
;
import
org
.
mozilla
.
gecko
.
util
.
EventCallback
;
import
org
.
mozilla
.
gecko
.
util
.
NativeJSObject
;
import
android
.
app
.
Activity
;
import
android
.
support
.
design
.
widget
.
Snackbar
;
import
android
.
support
.
v4
.
content
.
ContextCompat
;
import
android
.
text
.
TextUtils
;
import
android
.
view
.
View
;
import
java
.
lang
.
ref
.
WeakReference
;
public
class
SnackbarHelper
{
public
static
abstract
class
SnackbarCallback
extends
Snackbar
.
Callback
implements
View
.
OnClickListener
{
}
private
static
class
SnackbarEventCallback
extends
SnackbarCallback
{
private
EventCallback
callback
;
public
SnackbarEventCallback
(
EventCallback
callback
)
{
this
.
callback
=
callback
;
}
Override
public
synchronized
void
onClick
(
View
view
)
{
if
(
callback
=
=
null
)
{
return
;
}
callback
.
sendSuccess
(
null
)
;
callback
=
null
;
}
Override
public
synchronized
void
onDismissed
(
Snackbar
snackbar
int
event
)
{
if
(
callback
=
=
null
|
|
event
=
=
Snackbar
.
Callback
.
DISMISS_EVENT_ACTION
)
{
return
;
}
callback
.
sendError
(
null
)
;
callback
=
null
;
}
}
private
static
final
Object
currentSnackbarLock
=
new
Object
(
)
;
private
static
WeakReference
<
Snackbar
>
currentSnackbar
=
new
WeakReference
<
>
(
null
)
;
public
static
void
showSnackbar
(
Activity
activity
String
message
int
duration
)
{
showSnackbarWithAction
(
activity
message
duration
null
null
)
;
}
public
static
void
showSnackbar
(
Activity
activity
final
NativeJSObject
object
final
EventCallback
callback
)
{
final
String
message
=
object
.
getString
(
"
message
"
)
;
final
int
duration
=
object
.
getInt
(
"
duration
"
)
;
NativeJSObject
action
=
object
.
optObject
(
"
action
"
null
)
;
showSnackbarWithAction
(
activity
message
duration
action
!
=
null
?
action
.
optString
(
"
label
"
null
)
:
null
new
SnackbarHelper
.
SnackbarEventCallback
(
callback
)
)
;
}
public
static
void
showSnackbarWithAction
(
Activity
activity
String
message
int
duration
String
action
SnackbarCallback
callback
)
{
final
View
parentView
=
findBestParentView
(
activity
)
;
final
Snackbar
snackbar
=
Snackbar
.
make
(
parentView
message
duration
)
;
if
(
callback
!
=
null
&
&
!
TextUtils
.
isEmpty
(
action
)
)
{
snackbar
.
setAction
(
action
callback
)
;
snackbar
.
setActionTextColor
(
ContextCompat
.
getColor
(
activity
R
.
color
.
fennec_ui_orange
)
)
;
snackbar
.
setCallback
(
callback
)
;
}
snackbar
.
show
(
)
;
synchronized
(
currentSnackbarLock
)
{
currentSnackbar
=
new
WeakReference
<
>
(
snackbar
)
;
}
}
public
static
void
dismissCurrentSnackbar
(
)
{
synchronized
(
currentSnackbarLock
)
{
final
Snackbar
snackbar
=
currentSnackbar
.
get
(
)
;
if
(
snackbar
!
=
null
&
&
snackbar
.
isShown
(
)
)
{
snackbar
.
dismiss
(
)
;
}
}
}
private
static
View
findBestParentView
(
Activity
activity
)
{
if
(
activity
instanceof
GeckoApp
)
{
return
activity
.
findViewById
(
R
.
id
.
root_layout
)
;
}
return
activity
.
findViewById
(
android
.
R
.
id
.
content
)
;
}
}
