package
org
.
mozilla
.
gecko
.
dlc
;
import
android
.
content
.
Context
;
import
android
.
support
.
annotation
.
VisibleForTesting
;
import
org
.
mozilla
.
gecko
.
dlc
.
catalog
.
DownloadContent
;
import
org
.
mozilla
.
gecko
.
dlc
.
catalog
.
DownloadContentCatalog
;
import
java
.
io
.
File
;
public
class
CleanupAction
extends
BaseAction
{
Override
public
void
perform
(
Context
context
DownloadContentCatalog
catalog
)
{
for
(
DownloadContent
content
:
catalog
.
getContentToDelete
(
)
)
{
if
(
!
content
.
isAssetArchive
(
)
)
{
continue
;
}
cleanupContent
(
context
catalog
content
)
;
}
}
VisibleForTesting
void
cleanupContent
(
Context
context
DownloadContentCatalog
catalog
DownloadContent
content
)
{
try
{
final
File
file
=
getDestinationFile
(
context
content
)
;
if
(
!
file
.
exists
(
)
)
{
catalog
.
remove
(
content
)
;
return
;
}
if
(
file
.
delete
(
)
)
{
catalog
.
remove
(
content
)
;
}
}
catch
(
UnrecoverableDownloadContentException
e
)
{
catalog
.
remove
(
content
)
;
}
catch
(
RecoverableDownloadContentException
e
)
{
}
}
}
