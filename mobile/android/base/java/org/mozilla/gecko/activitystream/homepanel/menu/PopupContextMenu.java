package
org
.
mozilla
.
gecko
.
activitystream
.
homepanel
.
menu
;
import
android
.
content
.
Context
;
import
android
.
graphics
.
Color
;
import
android
.
graphics
.
drawable
.
ColorDrawable
;
import
android
.
support
.
design
.
widget
.
NavigationView
;
import
android
.
view
.
LayoutInflater
;
import
android
.
view
.
MenuItem
;
import
android
.
view
.
View
;
import
android
.
view
.
ViewGroup
;
import
android
.
widget
.
PopupWindow
;
import
org
.
mozilla
.
gecko
.
AppConstants
;
import
org
.
mozilla
.
gecko
.
R
;
import
org
.
mozilla
.
gecko
.
activitystream
.
ActivityStreamTelemetry
;
import
org
.
mozilla
.
gecko
.
home
.
HomePager
;
import
org
.
mozilla
.
gecko
.
activitystream
.
homepanel
.
model
.
WebpageModel
;
class
PopupContextMenu
extends
ActivityStreamContextMenu
{
private
final
PopupWindow
popupWindow
;
private
final
NavigationView
navigationView
;
private
final
View
contextMenuAnchor
;
public
PopupContextMenu
(
final
View
contextMenuAnchor
final
View
snackbarAnchor
final
ActivityStreamTelemetry
.
Extras
.
Builder
telemetryExtraBuilder
final
MenuMode
mode
final
WebpageModel
item
HomePager
.
OnUrlOpenListener
onUrlOpenListener
HomePager
.
OnUrlOpenInBackgroundListener
onUrlOpenInBackgroundListener
)
{
super
(
snackbarAnchor
telemetryExtraBuilder
mode
item
onUrlOpenListener
onUrlOpenInBackgroundListener
)
;
final
Context
context
=
contextMenuAnchor
.
getContext
(
)
;
this
.
contextMenuAnchor
=
contextMenuAnchor
;
final
LayoutInflater
inflater
=
LayoutInflater
.
from
(
context
)
;
View
card
=
inflater
.
inflate
(
R
.
layout
.
activity_stream_contextmenu_popupmenu
null
)
;
navigationView
=
(
NavigationView
)
card
.
findViewById
(
R
.
id
.
menu
)
;
navigationView
.
setNavigationItemSelectedListener
(
this
)
;
popupWindow
=
new
PopupWindow
(
context
)
;
popupWindow
.
setContentView
(
card
)
;
popupWindow
.
setBackgroundDrawable
(
new
ColorDrawable
(
Color
.
TRANSPARENT
)
)
;
popupWindow
.
setFocusable
(
true
)
;
if
(
AppConstants
.
Versions
.
preMarshmallow
)
{
popupWindow
.
setHeight
(
ViewGroup
.
LayoutParams
.
WRAP_CONTENT
)
;
popupWindow
.
setWidth
(
ViewGroup
.
LayoutParams
.
WRAP_CONTENT
)
;
}
super
.
postInit
(
)
;
}
Override
public
MenuItem
getItemByID
(
int
id
)
{
return
navigationView
.
getMenu
(
)
.
findItem
(
id
)
;
}
Override
public
void
show
(
)
{
popupWindow
.
showAsDropDown
(
contextMenuAnchor
0
-
(
contextMenuAnchor
.
getHeight
(
)
+
contextMenuAnchor
.
getPaddingBottom
(
)
)
)
;
}
public
void
dismiss
(
)
{
popupWindow
.
dismiss
(
)
;
}
}
