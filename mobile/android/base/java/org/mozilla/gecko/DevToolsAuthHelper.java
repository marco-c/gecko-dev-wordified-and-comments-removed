package
org
.
mozilla
.
gecko
;
import
android
.
app
.
Activity
;
import
android
.
content
.
Context
;
import
android
.
content
.
Intent
;
import
android
.
content
.
pm
.
PackageManager
;
import
android
.
util
.
Log
;
import
org
.
mozilla
.
gecko
.
util
.
ActivityResultHandler
;
import
org
.
mozilla
.
gecko
.
util
.
EventCallback
;
import
org
.
mozilla
.
gecko
.
util
.
InputOptionsUtils
;
public
class
DevToolsAuthHelper
{
private
static
final
String
LOGTAG
=
"
GeckoDevToolsAuthHelper
"
;
public
static
void
scan
(
Context
context
final
EventCallback
callback
)
{
final
Intent
intent
=
InputOptionsUtils
.
createQRCodeReaderIntent
(
)
;
intent
.
putExtra
(
"
PROMPT_MESSAGE
"
context
.
getString
(
R
.
string
.
devtools_auth_scan_header
)
)
;
PackageManager
pm
=
context
.
getPackageManager
(
)
;
if
(
pm
.
resolveActivity
(
intent
0
)
=
=
null
)
{
Log
.
w
(
LOGTAG
"
PackageManager
can
'
t
resolve
the
activity
.
"
)
;
callback
.
sendError
(
"
PackageManager
can
'
t
resolve
the
activity
.
"
)
;
return
;
}
ActivityHandlerHelper
.
startIntent
(
intent
new
ActivityResultHandler
(
)
{
Override
public
void
onActivityResult
(
int
resultCode
Intent
intent
)
{
if
(
resultCode
=
=
Activity
.
RESULT_OK
)
{
String
text
=
intent
.
getStringExtra
(
"
SCAN_RESULT
"
)
;
callback
.
sendSuccess
(
text
)
;
}
else
{
callback
.
sendError
(
resultCode
)
;
}
}
}
)
;
}
}
