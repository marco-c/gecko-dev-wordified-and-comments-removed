package
org
.
mozilla
.
gecko
;
import
com
.
google
.
android
.
gms
.
cast
.
CastPresentation
;
import
com
.
google
.
android
.
gms
.
cast
.
CastRemoteDisplayLocalService
;
import
android
.
util
.
DisplayMetrics
;
import
android
.
util
.
Log
;
import
android
.
view
.
Display
;
import
android
.
view
.
WindowManager
;
public
class
RemotePresentationService
extends
CastRemoteDisplayLocalService
{
private
static
final
String
LOGTAG
=
"
RemotePresentationService
"
;
private
CastPresentation
presentation
;
private
String
deviceId
;
private
int
screenId
;
public
void
setDeviceId
(
String
deviceId
)
{
this
.
deviceId
=
deviceId
;
}
public
String
getDeviceId
(
)
{
return
deviceId
;
}
Override
public
void
onCreatePresentation
(
Display
display
)
{
createPresentation
(
)
;
}
Override
public
void
onDismissPresentation
(
)
{
dismissPresentation
(
)
;
}
private
void
dismissPresentation
(
)
{
if
(
presentation
!
=
null
)
{
presentation
.
dismiss
(
)
;
presentation
=
null
;
ScreenManagerHelper
.
removeDisplay
(
screenId
)
;
MediaPlayerManager
.
getInstance
(
)
.
setPresentationMode
(
false
)
;
}
}
private
void
createPresentation
(
)
{
dismissPresentation
(
)
;
MediaPlayerManager
.
getInstance
(
)
.
setPresentationMode
(
true
)
;
DisplayMetrics
metrics
=
new
DisplayMetrics
(
)
;
getDisplay
(
)
.
getMetrics
(
metrics
)
;
screenId
=
ScreenManagerHelper
.
addDisplay
(
ScreenManagerHelper
.
DISPLAY_VIRTUAL
metrics
.
widthPixels
metrics
.
heightPixels
metrics
.
density
)
;
VirtualPresentation
virtualPresentation
=
new
VirtualPresentation
(
this
getDisplay
(
)
)
;
virtualPresentation
.
setDeviceId
(
deviceId
)
;
virtualPresentation
.
setScreenId
(
screenId
)
;
presentation
=
(
CastPresentation
)
virtualPresentation
;
try
{
presentation
.
show
(
)
;
}
catch
(
WindowManager
.
InvalidDisplayException
ex
)
{
Log
.
e
(
LOGTAG
"
Unable
to
show
presentation
display
was
removed
.
"
ex
)
;
dismissPresentation
(
)
;
}
}
}
