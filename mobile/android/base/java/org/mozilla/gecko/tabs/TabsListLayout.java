package
org
.
mozilla
.
gecko
.
tabs
;
import
org
.
mozilla
.
gecko
.
R
;
import
org
.
mozilla
.
gecko
.
Tabs
;
import
org
.
mozilla
.
gecko
.
animation
.
PropertyAnimator
;
import
org
.
mozilla
.
gecko
.
util
.
ThreadUtils
;
import
android
.
content
.
Context
;
import
android
.
support
.
v7
.
widget
.
LinearLayoutManager
;
import
android
.
support
.
v7
.
widget
.
helper
.
ItemTouchHelper
;
import
android
.
util
.
AttributeSet
;
import
android
.
view
.
View
;
public
class
TabsListLayout
extends
TabsLayout
{
private
static
final
int
ANIMATION_DURATION
=
250
;
private
static
final
int
ANIMATION_CASCADE_DELAY
=
75
;
private
int
closeAllAnimationCount
;
public
TabsListLayout
(
Context
context
AttributeSet
attrs
)
{
super
(
context
attrs
R
.
layout
.
tabs_list_item_view
)
;
setHasFixedSize
(
true
)
;
setLayoutManager
(
new
LinearLayoutManager
(
context
)
)
;
final
int
dragDirections
=
ItemTouchHelper
.
UP
|
ItemTouchHelper
.
DOWN
;
tabTouchCallback
=
new
TabsTouchHelperCallback
(
this
dragDirections
this
)
{
Override
protected
float
alphaForItemSwipeDx
(
float
dX
int
distanceToAlphaMin
)
{
return
Math
.
max
(
0
.
1f
Math
.
min
(
1f
1f
-
2f
*
Math
.
abs
(
dX
)
/
distanceToAlphaMin
)
)
;
}
}
;
final
ItemTouchHelper
touchHelper
=
new
ItemTouchHelper
(
tabTouchCallback
)
;
touchHelper
.
attachToRecyclerView
(
this
)
;
setItemAnimator
(
new
TabsListLayoutAnimator
(
ANIMATION_DURATION
)
)
;
}
Override
public
void
onCloseAll
(
)
{
final
int
childCount
=
getChildCount
(
)
;
if
(
childCount
=
=
0
)
{
autoHidePanel
(
)
;
return
;
}
setEnabled
(
false
)
;
int
cascadeDelay
=
0
;
closeAllAnimationCount
=
0
;
for
(
int
i
=
childCount
-
1
;
i
>
=
0
;
i
-
-
)
{
final
View
view
=
getChildAt
(
i
)
;
if
(
view
=
=
null
)
{
continue
;
}
final
PropertyAnimator
animator
=
new
PropertyAnimator
(
ANIMATION_DURATION
)
;
animator
.
attach
(
view
PropertyAnimator
.
Property
.
ALPHA
0
)
;
animator
.
attach
(
view
PropertyAnimator
.
Property
.
TRANSLATION_X
view
.
getWidth
(
)
)
;
closeAllAnimationCount
+
+
;
animator
.
addPropertyAnimationListener
(
new
PropertyAnimator
.
PropertyAnimationListener
(
)
{
Override
public
void
onPropertyAnimationStart
(
)
{
}
Override
public
void
onPropertyAnimationEnd
(
)
{
closeAllAnimationCount
-
-
;
if
(
closeAllAnimationCount
>
0
)
{
return
;
}
autoHidePanel
(
)
;
TabsListLayout
.
this
.
setEnabled
(
true
)
;
if
(
isNormal
(
)
)
{
Tabs
.
getInstance
(
)
.
closeAllTabs
(
)
;
}
else
{
Tabs
.
getInstance
(
)
.
closeAllPrivateTabs
(
)
;
}
}
}
)
;
ThreadUtils
.
postDelayedToUiThread
(
new
Runnable
(
)
{
Override
public
void
run
(
)
{
animator
.
start
(
)
;
}
}
cascadeDelay
)
;
cascadeDelay
+
=
ANIMATION_CASCADE_DELAY
;
}
}
Override
protected
boolean
addAtIndexRequiresScroll
(
int
index
)
{
return
index
=
=
0
|
|
index
=
=
getAdapter
(
)
.
getItemCount
(
)
-
1
;
}
}
