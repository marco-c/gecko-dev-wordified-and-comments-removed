package
org
.
mozilla
.
gecko
.
toolbar
;
import
android
.
support
.
annotation
.
NonNull
;
import
android
.
support
.
annotation
.
Nullable
;
import
android
.
text
.
TextUtils
;
import
org
.
mozilla
.
gecko
.
AboutPages
;
import
org
.
mozilla
.
gecko
.
SiteIdentity
;
import
org
.
mozilla
.
gecko
.
SiteIdentity
.
MixedMode
;
import
org
.
mozilla
.
gecko
.
SiteIdentity
.
SecurityMode
;
import
org
.
mozilla
.
gecko
.
SiteIdentity
.
TrackingMode
;
import
java
.
util
.
HashMap
;
import
java
.
util
.
Map
;
public
class
SecurityModeUtil
{
public
enum
IconType
{
UNKNOWN
DEFAULT
SEARCH
LOCK_SECURE
LOCK_WARNING
LOCK_INSECURE
WARNING
TRACKING_CONTENT_BLOCKED
TRACKING_CONTENT_LOADED
}
private
static
final
Map
<
IconType
Integer
>
imgLevelMap
=
new
HashMap
<
>
(
)
;
static
{
imgLevelMap
.
put
(
IconType
.
UNKNOWN
0
)
;
imgLevelMap
.
put
(
IconType
.
DEFAULT
0
)
;
imgLevelMap
.
put
(
IconType
.
LOCK_SECURE
1
)
;
imgLevelMap
.
put
(
IconType
.
WARNING
2
)
;
imgLevelMap
.
put
(
IconType
.
LOCK_INSECURE
3
)
;
imgLevelMap
.
put
(
IconType
.
TRACKING_CONTENT_BLOCKED
4
)
;
imgLevelMap
.
put
(
IconType
.
TRACKING_CONTENT_LOADED
5
)
;
imgLevelMap
.
put
(
IconType
.
SEARCH
6
)
;
}
private
static
final
Map
<
SecurityMode
IconType
>
securityModeMap
;
static
{
securityModeMap
=
new
HashMap
<
>
(
)
;
securityModeMap
.
put
(
SecurityMode
.
UNKNOWN
IconType
.
UNKNOWN
)
;
securityModeMap
.
put
(
SecurityMode
.
IDENTIFIED
IconType
.
LOCK_SECURE
)
;
securityModeMap
.
put
(
SecurityMode
.
VERIFIED
IconType
.
LOCK_SECURE
)
;
securityModeMap
.
put
(
SecurityMode
.
CHROMEUI
IconType
.
UNKNOWN
)
;
}
public
static
int
getImageLevel
(
NonNull
final
IconType
type
)
{
return
imgLevelMap
.
containsKey
(
type
)
?
imgLevelMap
.
get
(
type
)
:
imgLevelMap
.
get
(
IconType
.
UNKNOWN
)
;
}
public
static
IconType
resolve
(
Nullable
final
SiteIdentity
identity
)
{
return
resolve
(
identity
null
)
;
}
public
static
IconType
resolve
(
Nullable
final
SiteIdentity
identity
Nullable
final
String
url
)
{
if
(
!
TextUtils
.
isEmpty
(
url
)
&
&
AboutPages
.
isTitlelessAboutPage
(
url
)
)
{
return
IconType
.
SEARCH
;
}
if
(
identity
=
=
null
)
{
return
IconType
.
UNKNOWN
;
}
final
SecurityMode
securityMode
=
identity
.
getSecurityMode
(
)
;
final
MixedMode
activeMixedMode
=
identity
.
getMixedModeActive
(
)
;
final
MixedMode
displayMixedMode
=
identity
.
getMixedModeDisplay
(
)
;
final
TrackingMode
trackingMode
=
identity
.
getTrackingMode
(
)
;
final
boolean
securityException
=
identity
.
isSecurityException
(
)
;
if
(
securityException
)
{
return
IconType
.
WARNING
;
}
else
if
(
trackingMode
=
=
TrackingMode
.
TRACKING_CONTENT_LOADED
)
{
return
IconType
.
TRACKING_CONTENT_LOADED
;
}
else
if
(
trackingMode
=
=
TrackingMode
.
TRACKING_CONTENT_BLOCKED
)
{
return
IconType
.
TRACKING_CONTENT_BLOCKED
;
}
else
if
(
activeMixedMode
=
=
MixedMode
.
LOADED
)
{
return
IconType
.
LOCK_INSECURE
;
}
else
if
(
displayMixedMode
=
=
MixedMode
.
LOADED
)
{
return
IconType
.
WARNING
;
}
if
(
securityMode
=
=
SiteIdentity
.
SecurityMode
.
CHROMEUI
)
{
return
IconType
.
DEFAULT
;
}
return
securityModeMap
.
containsKey
(
securityMode
)
?
securityModeMap
.
get
(
securityMode
)
:
IconType
.
UNKNOWN
;
}
public
static
boolean
isTrackingProtectionEnabled
(
final
Nullable
SiteIdentity
identity
)
{
final
TrackingMode
trackingMode
=
(
identity
=
=
null
)
?
TrackingMode
.
UNKNOWN
:
identity
.
getTrackingMode
(
)
;
return
(
trackingMode
=
=
TrackingMode
.
TRACKING_CONTENT_BLOCKED
)
;
}
}
