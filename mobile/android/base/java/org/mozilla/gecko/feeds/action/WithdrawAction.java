package
org
.
mozilla
.
gecko
.
feeds
.
action
;
import
android
.
content
.
Context
;
import
android
.
content
.
Intent
;
import
android
.
util
.
Log
;
import
org
.
mozilla
.
gecko
.
GeckoProfile
;
import
org
.
mozilla
.
gecko
.
db
.
BrowserDB
;
import
org
.
mozilla
.
gecko
.
feeds
.
subscriptions
.
FeedSubscription
;
import
org
.
mozilla
.
gecko
.
feeds
.
subscriptions
.
SubscriptionStorage
;
import
java
.
util
.
List
;
public
class
WithdrawAction
implements
BaseAction
{
private
static
final
String
LOGTAG
=
"
FeedWithdrawAction
"
;
private
Context
context
;
private
SubscriptionStorage
storage
;
public
WithdrawAction
(
Context
context
SubscriptionStorage
storage
)
{
this
.
context
=
context
;
this
.
storage
=
storage
;
}
Override
public
void
perform
(
Intent
intent
)
{
BrowserDB
db
=
GeckoProfile
.
get
(
context
)
.
getDB
(
)
;
List
<
FeedSubscription
>
subscriptions
=
storage
.
getSubscriptions
(
)
;
Log
.
d
(
LOGTAG
"
Checking
"
+
subscriptions
.
size
(
)
+
"
subscriptions
"
)
;
for
(
FeedSubscription
subscription
:
subscriptions
)
{
if
(
!
db
.
hasBookmarkWithGuid
(
context
.
getContentResolver
(
)
subscription
.
getBookmarkGUID
(
)
)
)
{
unsubscribe
(
subscription
)
;
}
}
}
Override
public
boolean
requiresNetwork
(
)
{
return
false
;
}
private
void
unsubscribe
(
FeedSubscription
subscription
)
{
Log
.
d
(
LOGTAG
"
Unsubscribing
from
:
(
"
+
subscription
.
getBookmarkGUID
(
)
+
"
)
"
+
subscription
.
getFeedUrl
(
)
)
;
storage
.
removeSubscription
(
subscription
)
;
}
}
