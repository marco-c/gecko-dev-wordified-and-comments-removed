package
org
.
mozilla
.
gecko
.
feeds
;
import
android
.
app
.
IntentService
;
import
android
.
content
.
Intent
;
import
android
.
util
.
Log
;
import
com
.
keepsafe
.
switchboard
.
SwitchBoard
;
import
org
.
mozilla
.
gecko
.
AppConstants
;
import
org
.
mozilla
.
gecko
.
feeds
.
action
.
CheckAction
;
import
org
.
mozilla
.
gecko
.
feeds
.
subscriptions
.
SubscriptionStorage
;
import
org
.
mozilla
.
gecko
.
util
.
Experiments
;
public
class
FeedService
extends
IntentService
{
private
static
final
String
LOGTAG
=
"
GeckoFeedService
"
;
public
static
final
String
ACTION_CHECK
=
AppConstants
.
ANDROID_PACKAGE_NAME
+
"
.
FEEDS
.
CHECK
"
;
private
SubscriptionStorage
storage
;
public
FeedService
(
)
{
super
(
LOGTAG
)
;
}
Override
public
void
onCreate
(
)
{
super
.
onCreate
(
)
;
storage
=
new
SubscriptionStorage
(
getApplicationContext
(
)
)
;
}
Override
protected
void
onHandleIntent
(
Intent
intent
)
{
if
(
intent
=
=
null
)
{
return
;
}
if
(
!
SwitchBoard
.
isInExperiment
(
this
Experiments
.
CONTENT_NOTIFICATIONS
)
)
{
Log
.
d
(
LOGTAG
"
Not
in
content
notifications
experiment
.
Skipping
.
"
)
;
return
;
}
switch
(
intent
.
getAction
(
)
)
{
case
ACTION_CHECK
:
new
CheckAction
(
this
storage
)
.
perform
(
)
;
break
;
default
:
Log
.
e
(
LOGTAG
"
Unknown
action
:
"
+
intent
.
getAction
(
)
)
;
}
storage
.
persistChanges
(
)
;
}
}
