package
org
.
mozilla
.
gecko
.
push
;
import
android
.
support
.
annotation
.
NonNull
;
import
org
.
mozilla
.
gecko
.
push
.
RegisterUserAgentResponse
;
import
org
.
mozilla
.
gecko
.
push
.
SubscribeChannelResponse
;
import
org
.
mozilla
.
gecko
.
push
.
autopush
.
AutopushClient
;
import
org
.
mozilla
.
gecko
.
push
.
autopush
.
AutopushClientException
;
import
org
.
mozilla
.
gecko
.
sync
.
Utils
;
import
java
.
util
.
concurrent
.
Executor
;
public
class
PushClient
{
public
static
class
LocalException
extends
Exception
{
private
static
final
long
serialVersionUID
=
2387554736L
;
public
LocalException
(
Throwable
throwable
)
{
super
(
throwable
)
;
}
}
private
final
AutopushClient
autopushClient
;
public
PushClient
(
String
serverURI
)
{
this
.
autopushClient
=
new
AutopushClient
(
serverURI
Utils
.
newSynchronousExecutor
(
)
)
;
}
protected
static
class
Delegate
<
T
>
implements
AutopushClient
.
RequestDelegate
<
T
>
{
Object
result
;
SuppressWarnings
(
"
unchecked
"
)
public
T
responseOrThrow
(
)
throws
LocalException
AutopushClientException
{
if
(
result
instanceof
LocalException
)
{
throw
(
LocalException
)
result
;
}
if
(
result
instanceof
AutopushClientException
)
{
throw
(
AutopushClientException
)
result
;
}
return
(
T
)
result
;
}
Override
public
void
handleError
(
Exception
e
)
{
if
(
result
=
=
null
)
{
result
=
new
LocalException
(
e
)
;
}
}
Override
public
void
handleFailure
(
AutopushClientException
e
)
{
if
(
result
=
=
null
)
{
result
=
e
;
}
}
Override
public
void
handleSuccess
(
T
response
)
{
if
(
result
=
=
null
)
{
result
=
response
;
}
}
}
public
RegisterUserAgentResponse
registerUserAgent
(
NonNull
String
token
)
throws
LocalException
AutopushClientException
{
final
Delegate
<
RegisterUserAgentResponse
>
delegate
=
new
Delegate
<
>
(
)
;
autopushClient
.
registerUserAgent
(
token
delegate
)
;
return
delegate
.
responseOrThrow
(
)
;
}
public
void
reregisterUserAgent
(
NonNull
String
uaid
NonNull
String
secret
NonNull
String
token
)
throws
LocalException
AutopushClientException
{
final
Delegate
<
Void
>
delegate
=
new
Delegate
<
>
(
)
;
autopushClient
.
reregisterUserAgent
(
uaid
secret
token
delegate
)
;
delegate
.
responseOrThrow
(
)
;
}
public
void
unregisterUserAgent
(
NonNull
String
uaid
NonNull
String
secret
)
throws
LocalException
AutopushClientException
{
final
Delegate
<
Void
>
delegate
=
new
Delegate
<
>
(
)
;
autopushClient
.
unregisterUserAgent
(
uaid
secret
delegate
)
;
delegate
.
responseOrThrow
(
)
;
}
public
SubscribeChannelResponse
subscribeChannel
(
NonNull
String
uaid
NonNull
String
secret
)
throws
LocalException
AutopushClientException
{
final
Delegate
<
SubscribeChannelResponse
>
delegate
=
new
Delegate
<
>
(
)
;
autopushClient
.
subscribeChannel
(
uaid
secret
delegate
)
;
return
delegate
.
responseOrThrow
(
)
;
}
public
void
unsubscribeChannel
(
NonNull
String
uaid
NonNull
String
secret
NonNull
String
chid
)
throws
LocalException
AutopushClientException
{
final
Delegate
<
Void
>
delegate
=
new
Delegate
<
>
(
)
;
autopushClient
.
unsubscribeChannel
(
uaid
secret
chid
delegate
)
;
delegate
.
responseOrThrow
(
)
;
}
}
