package
org
.
mozilla
.
gecko
;
import
android
.
app
.
Activity
;
import
android
.
app
.
Application
;
import
android
.
content
.
Context
;
import
android
.
os
.
Bundle
;
import
java
.
lang
.
ref
.
WeakReference
;
public
class
GeckoActivityMonitor
implements
Application
.
ActivityLifecycleCallbacks
{
private
static
final
String
LOGTAG
=
"
GeckoActivityMonitor
"
;
private
static
final
GeckoActivityMonitor
instance
=
new
GeckoActivityMonitor
(
)
;
private
WeakReference
<
Activity
>
currentActivity
=
new
WeakReference
<
>
(
null
)
;
private
boolean
currentActivityInBackground
=
true
;
public
static
GeckoActivityMonitor
getInstance
(
)
{
return
instance
;
}
private
GeckoActivityMonitor
(
)
{
}
private
void
updateActivity
(
final
Activity
activity
)
{
if
(
currentActivityInBackground
)
{
(
(
GeckoApplication
)
activity
.
getApplication
(
)
)
.
onApplicationForeground
(
)
;
currentActivityInBackground
=
false
;
}
currentActivity
=
new
WeakReference
<
>
(
activity
)
;
}
private
void
checkAppGoingIntoBackground
(
final
Activity
activity
boolean
clearActivity
)
{
if
(
currentActivity
.
get
(
)
!
=
activity
)
{
return
;
}
if
(
clearActivity
)
{
currentActivity
.
clear
(
)
;
}
if
(
!
currentActivityInBackground
)
{
(
(
GeckoApplication
)
activity
.
getApplication
(
)
)
.
onApplicationBackground
(
)
;
currentActivityInBackground
=
true
;
}
}
public
Activity
getCurrentActivity
(
)
{
return
currentActivity
.
get
(
)
;
}
public
synchronized
void
initialize
(
final
GeckoApplication
app
)
{
app
.
registerActivityLifecycleCallbacks
(
this
)
;
}
Override
public
void
onActivityCreated
(
Activity
activity
Bundle
savedInstanceState
)
{
}
Override
public
void
onActivityStarted
(
Activity
activity
)
{
updateActivity
(
activity
)
;
}
Override
public
void
onActivityResumed
(
Activity
activity
)
{
updateActivity
(
activity
)
;
}
Override
public
void
onActivityPaused
(
Activity
activity
)
{
}
Override
public
void
onActivitySaveInstanceState
(
Activity
activity
Bundle
outState
)
{
checkAppGoingIntoBackground
(
activity
false
)
;
}
Override
public
void
onActivityStopped
(
Activity
activity
)
{
checkAppGoingIntoBackground
(
activity
true
)
;
}
Override
public
void
onActivityDestroyed
(
Activity
activity
)
{
}
}
