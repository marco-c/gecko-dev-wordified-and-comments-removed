package
org
.
mozilla
.
gecko
.
icons
;
import
android
.
support
.
annotation
.
NonNull
;
import
org
.
mozilla
.
gecko
.
icons
.
loader
.
ContentProviderLoader
;
import
org
.
mozilla
.
gecko
.
icons
.
loader
.
DataUriLoader
;
import
org
.
mozilla
.
gecko
.
icons
.
loader
.
DiskLoader
;
import
org
.
mozilla
.
gecko
.
icons
.
loader
.
IconDownloader
;
import
org
.
mozilla
.
gecko
.
icons
.
loader
.
IconGenerator
;
import
org
.
mozilla
.
gecko
.
icons
.
loader
.
IconLoader
;
import
org
.
mozilla
.
gecko
.
icons
.
loader
.
JarLoader
;
import
org
.
mozilla
.
gecko
.
icons
.
loader
.
LegacyLoader
;
import
org
.
mozilla
.
gecko
.
icons
.
loader
.
MemoryLoader
;
import
org
.
mozilla
.
gecko
.
icons
.
loader
.
SuggestedSiteLoader
;
import
org
.
mozilla
.
gecko
.
icons
.
preparation
.
AboutPagesPreparer
;
import
org
.
mozilla
.
gecko
.
icons
.
preparation
.
AddDefaultIconUrl
;
import
org
.
mozilla
.
gecko
.
icons
.
preparation
.
FilterKnownFailureUrls
;
import
org
.
mozilla
.
gecko
.
icons
.
preparation
.
FilterMimeTypes
;
import
org
.
mozilla
.
gecko
.
icons
.
preparation
.
FilterPrivilegedUrls
;
import
org
.
mozilla
.
gecko
.
icons
.
preparation
.
LookupIconUrl
;
import
org
.
mozilla
.
gecko
.
icons
.
preparation
.
Preparer
;
import
org
.
mozilla
.
gecko
.
icons
.
preparation
.
SuggestedSitePreparer
;
import
org
.
mozilla
.
gecko
.
icons
.
processing
.
ColorProcessor
;
import
org
.
mozilla
.
gecko
.
icons
.
processing
.
DiskProcessor
;
import
org
.
mozilla
.
gecko
.
icons
.
processing
.
MemoryProcessor
;
import
org
.
mozilla
.
gecko
.
icons
.
processing
.
MinimumSizeProcessor
;
import
org
.
mozilla
.
gecko
.
icons
.
processing
.
Processor
;
import
org
.
mozilla
.
gecko
.
icons
.
processing
.
ResizingProcessor
;
import
java
.
util
.
Arrays
;
import
java
.
util
.
List
;
import
java
.
util
.
concurrent
.
ExecutorService
;
import
java
.
util
.
concurrent
.
Future
;
import
java
.
util
.
concurrent
.
LinkedBlockingQueue
;
import
java
.
util
.
concurrent
.
ThreadFactory
;
import
java
.
util
.
concurrent
.
ThreadPoolExecutor
;
import
java
.
util
.
concurrent
.
TimeUnit
;
class
IconRequestExecutor
{
private
static
final
IconLoader
GENERATOR
=
new
IconGenerator
(
)
;
private
static
final
List
<
Preparer
>
PREPARERS
=
Arrays
.
asList
(
new
LookupIconUrl
(
)
new
FilterMimeTypes
(
)
new
FilterPrivilegedUrls
(
)
new
AboutPagesPreparer
(
)
new
SuggestedSitePreparer
(
)
new
AddDefaultIconUrl
(
)
new
FilterKnownFailureUrls
(
)
)
;
private
static
final
List
<
IconLoader
>
LOADERS
=
Arrays
.
asList
(
new
MemoryLoader
(
)
new
DataUriLoader
(
)
new
JarLoader
(
)
new
ContentProviderLoader
(
)
new
DiskLoader
(
)
new
SuggestedSiteLoader
(
)
new
LegacyLoader
(
)
new
IconDownloader
(
)
)
;
private
static
final
List
<
Processor
>
PROCESSORS
=
Arrays
.
asList
(
new
DiskProcessor
(
)
new
ResizingProcessor
(
)
new
ColorProcessor
(
)
new
MemoryProcessor
(
)
new
MinimumSizeProcessor
(
)
)
;
private
static
final
ExecutorService
EXECUTOR
;
static
{
final
ThreadFactory
factory
=
new
ThreadFactory
(
)
{
Override
public
Thread
newThread
(
NonNull
Runnable
runnable
)
{
Thread
thread
=
new
Thread
(
runnable
"
GeckoIconTask
"
)
;
thread
.
setDaemon
(
false
)
;
thread
.
setPriority
(
Thread
.
NORM_PRIORITY
)
;
return
thread
;
}
}
;
EXECUTOR
=
new
ThreadPoolExecutor
(
1
1
0L
TimeUnit
.
MILLISECONDS
new
LinkedBlockingQueue
<
Runnable
>
(
)
factory
)
;
}
static
Future
<
IconResponse
>
submit
(
IconRequest
request
)
{
return
EXECUTOR
.
submit
(
new
IconTask
(
request
PREPARERS
LOADERS
PROCESSORS
GENERATOR
)
)
;
}
}
