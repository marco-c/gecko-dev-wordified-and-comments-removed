package
org
.
mozilla
.
gecko
;
import
android
.
app
.
Activity
;
import
android
.
content
.
Intent
;
import
android
.
os
.
Bundle
;
import
android
.
support
.
customtabs
.
CustomTabsIntent
;
import
org
.
mozilla
.
gecko
.
customtabs
.
CustomTabsActivity
;
import
org
.
mozilla
.
gecko
.
db
.
BrowserContract
;
import
org
.
mozilla
.
gecko
.
tabqueue
.
TabQueueHelper
;
import
org
.
mozilla
.
gecko
.
tabqueue
.
TabQueueService
;
public
class
LauncherActivity
extends
Activity
{
Override
protected
void
onCreate
(
Bundle
savedInstanceState
)
{
super
.
onCreate
(
savedInstanceState
)
;
GeckoAppShell
.
ensureCrashHandling
(
)
;
if
(
AppConstants
.
MOZ_ANDROID_CUSTOM_TABS
&
&
isCustomTabsIntent
(
)
)
{
dispatchCustomTabsIntent
(
)
;
}
else
if
(
isViewIntentWithURL
(
)
)
{
dispatchViewIntent
(
)
;
}
else
{
dispatchNormalIntent
(
)
;
}
finish
(
)
;
}
private
void
dispatchViewIntent
(
)
{
if
(
TabQueueHelper
.
TAB_QUEUE_ENABLED
&
&
TabQueueHelper
.
isTabQueueEnabled
(
this
)
&
&
!
getIntent
(
)
.
getBooleanExtra
(
BrowserContract
.
SKIP_TAB_QUEUE_FLAG
false
)
)
{
dispatchTabQueueIntent
(
)
;
}
else
{
dispatchNormalIntent
(
)
;
}
}
private
void
dispatchTabQueueIntent
(
)
{
Intent
intent
=
new
Intent
(
getIntent
(
)
)
;
intent
.
setClass
(
getApplicationContext
(
)
TabQueueService
.
class
)
;
startService
(
intent
)
;
}
private
void
dispatchNormalIntent
(
)
{
Intent
intent
=
new
Intent
(
getIntent
(
)
)
;
intent
.
setClassName
(
getApplicationContext
(
)
AppConstants
.
MOZ_ANDROID_BROWSER_INTENT_CLASS
)
;
startActivity
(
intent
)
;
}
private
void
dispatchCustomTabsIntent
(
)
{
Intent
intent
=
new
Intent
(
getIntent
(
)
)
;
intent
.
setClassName
(
getApplicationContext
(
)
CustomTabsActivity
.
class
.
getName
(
)
)
;
startActivity
(
intent
)
;
}
private
boolean
isViewIntentWithURL
(
)
{
final
Intent
intent
=
getIntent
(
)
;
return
Intent
.
ACTION_VIEW
.
equals
(
intent
.
getAction
(
)
)
&
&
intent
.
getDataString
(
)
!
=
null
;
}
private
boolean
isCustomTabsIntent
(
)
{
return
isViewIntentWithURL
(
)
&
&
getIntent
(
)
.
hasExtra
(
CustomTabsIntent
.
EXTRA_SESSION
)
;
}
}
