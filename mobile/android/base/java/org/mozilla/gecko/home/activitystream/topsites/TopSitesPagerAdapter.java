package
org
.
mozilla
.
gecko
.
home
.
activitystream
.
topsites
;
import
android
.
content
.
Context
;
import
android
.
database
.
Cursor
;
import
android
.
support
.
v4
.
view
.
PagerAdapter
;
import
android
.
view
.
LayoutInflater
;
import
android
.
view
.
View
;
import
android
.
view
.
ViewGroup
;
import
org
.
mozilla
.
gecko
.
R
;
import
org
.
mozilla
.
gecko
.
home
.
HomePager
;
import
java
.
util
.
LinkedList
;
public
class
TopSitesPagerAdapter
extends
PagerAdapter
{
public
static
final
int
GRID_HEIGHT
=
1
;
public
static
final
int
GRID_WIDTH
=
4
;
public
static
final
int
PAGES
=
4
;
public
static
final
int
ITEMS_PER_PAGE
=
GRID_HEIGHT
*
GRID_WIDTH
;
public
static
final
int
TOTAL_ITEMS
=
ITEMS_PER_PAGE
*
PAGES
;
private
LinkedList
<
TopSitesPage
>
pages
=
new
LinkedList
<
>
(
)
;
private
final
Context
context
;
private
final
HomePager
.
OnUrlOpenListener
onUrlOpenListener
;
private
int
count
=
0
;
public
TopSitesPagerAdapter
(
Context
context
HomePager
.
OnUrlOpenListener
onUrlOpenListener
)
{
this
.
context
=
context
;
this
.
onUrlOpenListener
=
onUrlOpenListener
;
}
Override
public
int
getCount
(
)
{
return
count
;
}
Override
public
boolean
isViewFromObject
(
View
view
Object
object
)
{
return
view
=
=
object
;
}
Override
public
Object
instantiateItem
(
ViewGroup
container
int
position
)
{
TopSitesPage
page
=
pages
.
get
(
position
)
;
container
.
addView
(
page
)
;
return
page
;
}
Override
public
void
destroyItem
(
ViewGroup
container
int
position
Object
object
)
{
container
.
removeView
(
(
View
)
object
)
;
}
public
void
swapCursor
(
Cursor
cursor
)
{
final
int
oldPages
=
getCount
(
)
;
if
(
cursor
!
=
null
)
{
count
=
(
cursor
.
getCount
(
)
-
1
)
/
ITEMS_PER_PAGE
+
1
;
}
else
{
count
=
0
;
}
final
int
pageDelta
=
count
-
oldPages
;
if
(
pageDelta
>
0
)
{
final
LayoutInflater
inflater
=
LayoutInflater
.
from
(
context
)
;
for
(
int
i
=
0
;
i
<
pageDelta
;
i
+
+
)
{
final
TopSitesPage
page
=
(
TopSitesPage
)
inflater
.
inflate
(
R
.
layout
.
activity_stream_topsites_page
null
false
)
;
page
.
setOnUrlOpenListener
(
onUrlOpenListener
)
;
page
.
setAdapter
(
new
TopSitesPageAdapter
(
)
)
;
pages
.
add
(
page
)
;
}
}
else
if
(
pageDelta
<
0
)
{
for
(
int
i
=
0
;
i
>
pageDelta
;
i
-
-
)
{
final
TopSitesPage
page
=
pages
.
getLast
(
)
;
page
.
getAdapter
(
)
.
swapCursor
(
null
0
)
;
pages
.
removeLast
(
)
;
}
}
else
{
}
int
startIndex
=
0
;
for
(
TopSitesPage
page
:
pages
)
{
page
.
getAdapter
(
)
.
swapCursor
(
cursor
startIndex
)
;
startIndex
+
=
ITEMS_PER_PAGE
;
}
notifyDataSetChanged
(
)
;
}
}
