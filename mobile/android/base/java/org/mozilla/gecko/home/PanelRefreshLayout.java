package
org
.
mozilla
.
gecko
.
home
;
import
org
.
mozilla
.
gecko
.
R
;
import
org
.
mozilla
.
gecko
.
EventDispatcher
;
import
org
.
mozilla
.
gecko
.
home
.
PanelLayout
.
DatasetBacked
;
import
org
.
mozilla
.
gecko
.
home
.
PanelLayout
.
FilterManager
;
import
org
.
mozilla
.
gecko
.
util
.
GeckoBundle
;
import
android
.
content
.
Context
;
import
android
.
database
.
Cursor
;
import
android
.
support
.
v4
.
widget
.
SwipeRefreshLayout
;
import
android
.
view
.
View
;
class
PanelRefreshLayout
extends
SwipeRefreshLayout
implements
DatasetBacked
{
private
static
final
String
LOGTAG
=
"
GeckoPanelRefreshLayout
"
;
private
static
final
String
BUNDLE_KEY_PANEL_ID
=
"
panelId
"
;
private
static
final
String
BUNDLE_KEY_VIEW_INDEX
=
"
viewIndex
"
;
private
final
String
panelId
;
private
final
int
viewIndex
;
private
final
DatasetBacked
datasetBacked
;
public
PanelRefreshLayout
(
Context
context
View
childView
String
panelId
int
viewIndex
)
{
super
(
context
)
;
if
(
!
(
childView
instanceof
DatasetBacked
)
)
{
throw
new
IllegalArgumentException
(
"
View
must
implement
DatasetBacked
to
be
refreshed
"
)
;
}
this
.
panelId
=
panelId
;
this
.
viewIndex
=
viewIndex
;
this
.
datasetBacked
=
(
DatasetBacked
)
childView
;
setOnRefreshListener
(
new
RefreshListener
(
)
)
;
addView
(
childView
)
;
setColorSchemeResources
(
R
.
color
.
fennec_ui_accent
R
.
color
.
action_accent
)
;
}
Override
public
void
setDataset
(
Cursor
cursor
)
{
datasetBacked
.
setDataset
(
cursor
)
;
setRefreshing
(
false
)
;
}
Override
public
void
setFilterManager
(
FilterManager
manager
)
{
datasetBacked
.
setFilterManager
(
manager
)
;
}
private
class
RefreshListener
implements
OnRefreshListener
{
Override
public
void
onRefresh
(
)
{
final
GeckoBundle
response
=
new
GeckoBundle
(
2
)
;
response
.
putString
(
BUNDLE_KEY_PANEL_ID
panelId
)
;
response
.
putInt
(
BUNDLE_KEY_VIEW_INDEX
viewIndex
)
;
EventDispatcher
.
getInstance
(
)
.
dispatch
(
"
HomePanels
:
RefreshView
"
response
)
;
}
}
}
