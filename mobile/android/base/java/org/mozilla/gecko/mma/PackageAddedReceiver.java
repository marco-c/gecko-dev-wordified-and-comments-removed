package
org
.
mozilla
.
gecko
.
mma
;
import
android
.
content
.
BroadcastReceiver
;
import
android
.
content
.
Context
;
import
android
.
content
.
Intent
;
import
android
.
content
.
IntentFilter
;
import
android
.
content
.
pm
.
PackageInfo
;
import
android
.
content
.
pm
.
PackageManager
;
import
android
.
net
.
Uri
;
import
android
.
support
.
annotation
.
NonNull
;
public
class
PackageAddedReceiver
extends
BroadcastReceiver
{
private
static
final
String
intentAction
=
Intent
.
ACTION_PACKAGE_ADDED
;
private
static
final
String
dataScheme
=
"
package
"
;
Override
public
void
onReceive
(
Context
context
Intent
intent
)
{
if
(
intent
.
getAction
(
)
!
=
null
&
&
intent
.
getData
(
)
!
=
null
)
{
final
String
updatedPackage
=
getInstalledPackageName
(
intent
.
getData
(
)
)
;
try
{
MmaDelegate
.
trackJustInstalledPackage
(
context
updatedPackage
getIfFirstTimeInstall
(
context
updatedPackage
)
)
;
}
catch
(
PackageManager
.
NameNotFoundException
e
)
{
}
}
}
public
static
IntentFilter
getIntentFilter
(
)
{
final
IntentFilter
intentFilter
=
new
IntentFilter
(
)
;
intentFilter
.
addAction
(
intentAction
)
;
intentFilter
.
addDataScheme
(
dataScheme
)
;
return
intentFilter
;
}
private
String
getInstalledPackageName
(
NonNull
Uri
intentData
)
{
return
intentData
.
getSchemeSpecificPart
(
)
;
}
private
boolean
getIfFirstTimeInstall
(
NonNull
Context
context
NonNull
final
String
packageName
)
throws
PackageManager
.
NameNotFoundException
{
final
PackageInfo
packageInfo
=
context
.
getPackageManager
(
)
.
getPackageInfo
(
packageName
0
)
;
return
packageInfo
.
firstInstallTime
=
=
packageInfo
.
lastUpdateTime
;
}
}
