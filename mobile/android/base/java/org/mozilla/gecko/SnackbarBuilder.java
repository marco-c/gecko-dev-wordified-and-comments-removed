package
org
.
mozilla
.
gecko
;
import
org
.
mozilla
.
gecko
.
util
.
EventCallback
;
import
org
.
mozilla
.
gecko
.
util
.
NativeJSObject
;
import
android
.
app
.
Activity
;
import
android
.
graphics
.
Color
;
import
android
.
graphics
.
drawable
.
Drawable
;
import
android
.
graphics
.
drawable
.
InsetDrawable
;
import
android
.
support
.
annotation
.
StringRes
;
import
android
.
support
.
design
.
widget
.
Snackbar
;
import
android
.
support
.
v4
.
content
.
ContextCompat
;
import
android
.
text
.
TextUtils
;
import
android
.
util
.
Log
;
import
android
.
util
.
TypedValue
;
import
android
.
view
.
View
;
import
android
.
widget
.
TextView
;
import
java
.
lang
.
ref
.
WeakReference
;
public
class
SnackbarBuilder
{
public
static
abstract
class
SnackbarCallback
extends
Snackbar
.
Callback
implements
View
.
OnClickListener
{
}
public
static
final
String
LOGTAG
=
"
GeckoSnackbarBuilder
"
;
private
static
class
SnackbarEventCallback
extends
SnackbarCallback
{
private
EventCallback
callback
;
public
SnackbarEventCallback
(
EventCallback
callback
)
{
this
.
callback
=
callback
;
}
Override
public
synchronized
void
onClick
(
View
view
)
{
if
(
callback
=
=
null
)
{
return
;
}
callback
.
sendSuccess
(
null
)
;
callback
=
null
;
}
Override
public
synchronized
void
onDismissed
(
Snackbar
snackbar
int
event
)
{
if
(
callback
=
=
null
|
|
event
=
=
Snackbar
.
Callback
.
DISMISS_EVENT_ACTION
)
{
return
;
}
callback
.
sendError
(
null
)
;
callback
=
null
;
}
}
private
static
final
Object
currentSnackbarLock
=
new
Object
(
)
;
private
static
WeakReference
<
Snackbar
>
currentSnackbar
=
new
WeakReference
<
>
(
null
)
;
private
final
Activity
activity
;
private
String
message
;
private
int
duration
;
private
String
action
;
private
SnackbarCallback
callback
;
private
Drawable
icon
;
private
Integer
backgroundColor
;
private
Integer
actionColor
;
private
SnackbarBuilder
(
final
Activity
activity
)
{
this
.
activity
=
activity
;
}
public
static
SnackbarBuilder
builder
(
final
Activity
activity
)
{
return
new
SnackbarBuilder
(
activity
)
;
}
public
SnackbarBuilder
message
(
final
String
message
)
{
this
.
message
=
message
;
return
this
;
}
public
SnackbarBuilder
message
(
StringRes
final
int
id
)
{
message
=
activity
.
getResources
(
)
.
getString
(
id
)
;
return
this
;
}
public
SnackbarBuilder
duration
(
final
int
duration
)
{
this
.
duration
=
duration
;
return
this
;
}
public
SnackbarBuilder
action
(
final
String
action
)
{
this
.
action
=
action
;
return
this
;
}
public
SnackbarBuilder
action
(
StringRes
final
int
id
)
{
action
=
activity
.
getResources
(
)
.
getString
(
id
)
;
return
this
;
}
public
SnackbarBuilder
callback
(
final
SnackbarCallback
callback
)
{
this
.
callback
=
callback
;
return
this
;
}
public
SnackbarBuilder
callback
(
final
EventCallback
callback
)
{
this
.
callback
=
new
SnackbarEventCallback
(
callback
)
;
return
this
;
}
public
SnackbarBuilder
icon
(
final
Drawable
icon
)
{
this
.
icon
=
icon
;
return
this
;
}
public
SnackbarBuilder
backgroundColor
(
final
Integer
backgroundColor
)
{
this
.
backgroundColor
=
backgroundColor
;
return
this
;
}
public
SnackbarBuilder
actionColor
(
final
Integer
actionColor
)
{
this
.
actionColor
=
actionColor
;
return
this
;
}
public
SnackbarBuilder
fromEvent
(
final
NativeJSObject
object
)
{
message
=
object
.
getString
(
"
message
"
)
;
duration
=
object
.
getInt
(
"
duration
"
)
;
if
(
object
.
has
(
"
backgroundColor
"
)
)
{
final
String
providedColor
=
object
.
getString
(
"
backgroundColor
"
)
;
try
{
backgroundColor
=
Color
.
parseColor
(
providedColor
)
;
}
catch
(
IllegalArgumentException
e
)
{
Log
.
w
(
LOGTAG
"
Failed
to
parse
color
string
:
"
+
providedColor
)
;
}
}
NativeJSObject
actionObject
=
object
.
optObject
(
"
action
"
null
)
;
if
(
actionObject
!
=
null
)
{
action
=
actionObject
.
optString
(
"
label
"
null
)
;
}
return
this
;
}
public
void
buildAndShow
(
)
{
final
View
parentView
=
findBestParentView
(
activity
)
;
final
Snackbar
snackbar
=
Snackbar
.
make
(
parentView
message
duration
)
;
if
(
callback
!
=
null
&
&
!
TextUtils
.
isEmpty
(
action
)
)
{
snackbar
.
setAction
(
action
callback
)
;
if
(
actionColor
=
=
null
)
{
snackbar
.
setActionTextColor
(
ContextCompat
.
getColor
(
activity
R
.
color
.
fennec_ui_orange
)
)
;
}
else
{
snackbar
.
setActionTextColor
(
actionColor
)
;
}
snackbar
.
setCallback
(
callback
)
;
}
if
(
icon
!
=
null
)
{
int
leftPadding
=
(
int
)
TypedValue
.
applyDimension
(
TypedValue
.
COMPLEX_UNIT_DIP
10
activity
.
getResources
(
)
.
getDisplayMetrics
(
)
)
;
final
InsetDrawable
paddedIcon
=
new
InsetDrawable
(
icon
0
0
leftPadding
0
)
;
paddedIcon
.
setBounds
(
0
0
leftPadding
+
icon
.
getIntrinsicWidth
(
)
icon
.
getIntrinsicHeight
(
)
)
;
TextView
textView
=
(
TextView
)
snackbar
.
getView
(
)
.
findViewById
(
android
.
support
.
design
.
R
.
id
.
snackbar_text
)
;
textView
.
setCompoundDrawables
(
paddedIcon
null
null
null
)
;
}
if
(
backgroundColor
!
=
null
)
{
snackbar
.
getView
(
)
.
setBackgroundColor
(
backgroundColor
)
;
}
snackbar
.
show
(
)
;
synchronized
(
currentSnackbarLock
)
{
currentSnackbar
=
new
WeakReference
<
>
(
snackbar
)
;
}
}
public
static
void
dismissCurrentSnackbar
(
)
{
synchronized
(
currentSnackbarLock
)
{
final
Snackbar
snackbar
=
currentSnackbar
.
get
(
)
;
if
(
snackbar
!
=
null
&
&
snackbar
.
isShown
(
)
)
{
snackbar
.
dismiss
(
)
;
}
}
}
private
static
View
findBestParentView
(
Activity
activity
)
{
if
(
activity
instanceof
GeckoApp
)
{
final
View
view
=
activity
.
findViewById
(
R
.
id
.
root_layout
)
;
if
(
view
!
=
null
)
{
return
view
;
}
}
return
activity
.
findViewById
(
android
.
R
.
id
.
content
)
;
}
}
