add_task
(
async
function
test_failsafe_close_of_async_connection
(
)
{
let
db
=
getOpenedDatabase
(
)
;
let
callbackInvoked
=
new
Promise
(
(
resolve
)
=
>
{
db
.
executeSimpleSQLAsync
(
"
CREATE
TABLE
test
(
id
INTEGER
)
"
{
handleCompletion
:
resolve
}
)
;
}
)
;
db
=
gDBConn
=
null
;
Cu
.
forceGC
(
)
;
await
callbackInvoked
;
Assert
.
ok
(
true
"
if
we
shutdown
cleanly
and
do
not
crash
then
we
succeeded
"
)
;
}
)
;
