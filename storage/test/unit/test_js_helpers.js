function
test_params_enumerate
(
)
{
let
stmt
=
createStatement
(
"
SELECT
*
FROM
test
WHERE
id
IN
(
:
a
:
b
:
c
)
"
)
;
let
expected
=
[
"
a
"
"
b
"
"
c
"
]
;
let
index
=
0
;
for
(
let
name
in
stmt
.
params
)
{
if
(
name
=
=
"
QueryInterface
"
)
continue
;
do_check_eq
(
name
expected
[
index
+
+
]
)
;
}
do_check_eq
(
index
3
)
;
}
function
test_params_prototype
(
)
{
let
stmt
=
createStatement
(
"
SELECT
*
FROM
sqlite_master
"
)
;
Object
.
getPrototypeOf
(
stmt
.
params
)
.
test
=
2
;
do_check_eq
(
stmt
.
params
.
test
2
)
;
delete
Object
.
getPrototypeOf
(
stmt
.
params
)
.
test
;
stmt
.
finalize
(
)
;
}
function
test_row_prototype
(
)
{
let
stmt
=
createStatement
(
"
SELECT
*
FROM
sqlite_master
"
)
;
do_check_true
(
stmt
.
executeStep
(
)
)
;
Object
.
getPrototypeOf
(
stmt
.
row
)
.
test
=
2
;
do_check_eq
(
stmt
.
row
.
test
2
)
;
delete
Object
.
getPrototypeOf
(
stmt
.
row
)
.
test
;
stmt
.
finalize
(
)
;
}
function
test_row_enumerate
(
)
{
let
stmt
=
createStatement
(
"
SELECT
*
FROM
test
"
)
;
do_check_true
(
stmt
.
executeStep
(
)
)
;
let
expected
=
[
"
id
"
"
string
"
]
;
let
expected_values
=
[
123
"
foo
"
]
;
let
index
=
0
;
for
(
let
name
in
stmt
.
row
)
{
do_check_eq
(
name
expected
[
index
]
)
;
do_check_eq
(
stmt
.
row
[
name
]
expected_values
[
index
]
)
;
index
+
+
;
}
do_check_eq
(
index
2
)
;
let
savedOffRow
=
stmt
.
row
;
stmt
=
null
;
Components
.
utils
.
forceGC
(
)
;
Assert
.
throws
(
(
)
=
>
{
return
savedOffRow
.
string
;
}
"
GC
'
ed
statement
should
throw
"
)
;
}
function
test_params_gets_sync
(
)
{
}
function
test_params_gets_async
(
)
{
}
var
tests
=
[
test_params_enumerate
test_params_prototype
test_row_enumerate
test_row_prototype
test_params_gets_sync
test_params_gets_async
]
;
function
run_test
(
)
{
cleanup
(
)
;
getOpenedDatabase
(
)
.
executeSimpleSQL
(
"
CREATE
TABLE
test
(
"
+
"
id
INTEGER
PRIMARY
KEY
string
TEXT
"
+
"
)
"
)
;
getOpenedDatabase
(
)
.
executeSimpleSQL
(
"
INSERT
INTO
test
(
id
string
)
VALUES
(
123
'
foo
'
)
"
)
;
tests
.
forEach
(
test
=
>
test
(
)
)
;
}
