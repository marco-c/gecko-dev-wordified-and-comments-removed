#
include
"
mozilla
/
CondVar
.
h
"
#
include
"
mozilla
/
ReentrantMonitor
.
h
"
#
include
"
SQLiteMutex
.
h
"
#
include
"
gtest
/
gtest
.
h
"
using
namespace
mozilla
;
class
TestMutex
:
public
mozilla
:
:
storage
:
:
SQLiteMutex
{
public
:
explicit
TestMutex
(
const
char
*
aName
)
:
mozilla
:
:
storage
:
:
SQLiteMutex
(
aName
)
mInner
(
sqlite3_mutex_alloc
(
SQLITE_MUTEX_FAST
)
)
{
NS_ASSERTION
(
mInner
"
could
not
allocate
a
sqlite3_mutex
"
)
;
initWithMutex
(
mInner
)
;
}
~
TestMutex
(
)
{
sqlite3_mutex_free
(
mInner
)
;
}
void
Lock
(
)
{
lock
(
)
;
}
void
Unlock
(
)
{
unlock
(
)
;
}
private
:
sqlite3_mutex
*
mInner
;
}
;
extern
unsigned
int
_gdb_sleep_duration
;
#
define
MUTEX
TestMutex
#
define
TESTNAME
(
name
)
storage_
#
#
name
namespace
storage
{
#
include
"
.
.
/
.
.
/
.
.
/
xpcom
/
tests
/
gtest
/
TestDeadlockDetector
.
cpp
"
}
