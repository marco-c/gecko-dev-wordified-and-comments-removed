"
"
"
Transform
the
beetmover
-
source
task
to
also
append
build
as
dependency
"
"
"
from
gecko_taskgraph
.
transforms
.
base
import
TransformSequence
transforms
=
TransformSequence
(
)
transforms
.
add
def
remove_build_dependency_in_beetmover_source
(
config
jobs
)
:
    
for
job
in
jobs
:
        
for
depname
in
job
[
"
dependencies
"
]
:
            
if
"
signing
"
not
in
depname
:
                
del
job
[
"
dependencies
"
]
[
depname
]
                
break
        
else
:
            
raise
Exception
(
"
Can
'
t
find
build
dep
in
beetmover
source
!
"
)
        
all_upstream_artifacts
=
job
[
"
worker
"
]
[
"
upstream
-
artifacts
"
]
        
upstream_artifacts_without_build
=
[
            
upstream_artifact
            
for
upstream_artifact
in
all_upstream_artifacts
            
if
upstream_artifact
[
"
taskId
"
]
[
"
task
-
reference
"
]
!
=
f
"
<
{
depname
}
>
"
        
]
        
job
[
"
worker
"
]
[
"
upstream
-
artifacts
"
]
=
upstream_artifacts_without_build
        
yield
job
