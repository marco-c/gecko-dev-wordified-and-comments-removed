from
taskgraph
.
optimize
.
base
import
All
OptimizationStrategy
register_strategy
from
gecko_taskgraph
.
util
.
backstop
import
BACKSTOP_PUSH_INTERVAL
register_strategy
(
"
skip
-
unless
-
backstop
"
)
class
SkipUnlessBackstop
(
OptimizationStrategy
)
:
    
"
"
"
Always
removes
tasks
except
on
backstop
pushes
.
"
"
"
    
def
should_remove_task
(
self
task
params
_
)
:
        
return
not
params
[
"
backstop
"
]
class
SkipUnlessPushInterval
(
OptimizationStrategy
)
:
    
"
"
"
Always
removes
tasks
except
every
N
pushes
.
    
Args
:
        
push_interval
(
int
)
:
Number
of
pushes
    
"
"
"
    
def
__init__
(
self
push_interval
remove_on_projects
=
None
)
:
        
self
.
push_interval
=
push_interval
    
property
    
def
description
(
self
)
:
        
return
f
"
skip
-
unless
-
push
-
interval
-
{
self
.
push_interval
}
"
    
def
should_remove_task
(
self
task
params
_
)
:
        
return
int
(
params
[
"
pushlog_id
"
]
)
%
self
.
push_interval
!
=
0
register_strategy
(
    
"
skip
-
unless
-
expanded
"
    
args
=
(
        
"
skip
-
unless
-
backstop
"
        
SkipUnlessPushInterval
(
BACKSTOP_PUSH_INTERVAL
/
2
)
    
)
)
(
All
)
