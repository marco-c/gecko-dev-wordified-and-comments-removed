#
-
*
-
coding
:
utf
-
8
-
*
-
from
__future__
import
absolute_import
print_function
unicode_literals
import
json
import
logging
import
requests
from
mozbuild
.
util
import
memoize
from
redo
import
retry
from
requests
import
exceptions
ALLTHETHINGS_URL
=
"
https
:
/
/
secure
.
pub
.
build
.
mozilla
.
org
/
builddata
/
reports
/
allthethings
.
json
.
gz
"
logger
=
logging
.
getLogger
(
__name__
)
def
fetch_all_the_things
(
)
:
    
response
=
retry
(
requests
.
get
attempts
=
2
sleeptime
=
10
                     
args
=
(
ALLTHETHINGS_URL
)
                     
kwargs
=
{
'
timeout
'
:
60
}
)
    
return
response
.
content
memoize
def
valid_bbb_builders
(
)
:
    
try
:
        
allthethings
=
fetch_all_the_things
(
)
        
builders
=
set
(
json
.
loads
(
allthethings
)
.
get
(
'
builders
'
{
}
)
.
keys
(
)
)
        
return
builders
    
except
exceptions
.
Timeout
:
        
logger
.
warning
(
"
Timeout
fetching
list
of
buildbot
builders
.
"
)
    
except
exceptions
.
ConnectionError
:
        
logger
.
warning
(
"
Connection
Error
while
fetching
list
of
buildbot
builders
"
)
    
except
exceptions
.
RequestException
as
error
:
        
logger
.
warning
(
error
)
    
except
ValueError
as
error
:
        
logger
.
warning
(
"
Invalid
JSON
possible
server
error
:
{
}
"
.
format
(
error
)
)
    
return
None
