#
-
*
-
coding
:
utf
-
8
-
*
-
from
__future__
import
absolute_import
print_function
unicode_literals
from
voluptuous
import
Schema
Any
Required
All
MultipleInvalid
def
even_15_minutes
(
minutes
)
:
    
if
minutes
%
15
!
=
0
:
        
raise
ValueError
(
"
minutes
must
be
evenly
divisible
by
15
"
)
cron_yml_schema
=
Schema
(
{
    
'
jobs
'
:
[
{
        
Required
(
'
name
'
)
:
basestring
        
Required
(
'
job
'
)
:
Any
(
{
            
Required
(
'
type
'
)
:
'
decision
-
task
'
            
Required
(
'
treeherder
-
symbol
'
)
:
basestring
            
'
triggered
-
by
'
:
basestring
            
'
target
-
tasks
-
method
'
:
basestring
        
}
)
        
'
run
-
on
-
projects
'
:
[
basestring
]
        
'
when
'
:
[
{
'
hour
'
:
int
'
minute
'
:
All
(
int
even_15_minutes
)
}
]
    
}
]
}
)
def
validate
(
cron_yml
)
:
    
try
:
        
cron_yml_schema
(
cron_yml
)
    
except
MultipleInvalid
as
exc
:
        
msg
=
[
"
Invalid
.
cron
.
yml
:
"
]
        
for
error
in
exc
.
errors
:
            
msg
.
append
(
str
(
error
)
)
        
raise
Exception
(
'
\
n
'
.
join
(
msg
)
)
