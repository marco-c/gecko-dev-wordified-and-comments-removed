#
-
*
-
coding
:
utf
-
8
-
*
-
from
__future__
import
absolute_import
print_function
unicode_literals
from
voluptuous
import
Schema
Any
Required
All
from
taskgraph
.
util
.
schema
import
(
    
optionally_keyed_by
    
validate_schema
)
def
even_15_minutes
(
minutes
)
:
    
if
minutes
%
15
!
=
0
:
        
raise
ValueError
(
"
minutes
must
be
evenly
divisible
by
15
"
)
cron_yml_schema
=
Schema
(
{
    
'
jobs
'
:
[
{
        
Required
(
'
name
'
)
:
basestring
        
Required
(
'
job
'
)
:
Any
(
{
            
Required
(
'
type
'
)
:
'
decision
-
task
'
            
Required
(
'
treeherder
-
symbol
'
)
:
basestring
            
'
triggered
-
by
'
:
basestring
            
'
target
-
tasks
-
method
'
:
basestring
        
}
)
        
'
run
-
on
-
projects
'
:
[
basestring
]
        
'
when
'
:
optionally_keyed_by
(
            
'
project
'
            
[
{
'
hour
'
:
int
'
minute
'
:
All
(
int
even_15_minutes
)
}
]
)
    
}
]
}
)
def
validate
(
cron_yml
)
:
    
validate_schema
(
cron_yml_schema
cron_yml
"
Invalid
.
cron
.
yml
:
"
)
