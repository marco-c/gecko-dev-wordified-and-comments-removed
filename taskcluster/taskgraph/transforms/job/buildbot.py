"
"
"
Support
for
running
jobs
via
buildbot
.
"
"
"
from
__future__
import
absolute_import
print_function
unicode_literals
import
slugid
from
taskgraph
.
util
.
schema
import
Schema
from
voluptuous
import
Required
Any
from
taskgraph
.
transforms
.
job
import
run_job_using
buildbot_run_schema
=
Schema
(
{
    
Required
(
'
using
'
)
:
'
buildbot
'
    
Required
(
'
buildername
'
)
:
basestring
    
Required
(
'
product
'
)
:
Any
(
'
firefox
'
'
mobile
'
'
devedition
'
'
thunderbird
'
)
}
)
run_job_using
(
'
buildbot
-
bridge
'
'
buildbot
'
schema
=
buildbot_run_schema
)
def
mozharness_on_buildbot_bridge
(
config
job
taskdesc
)
:
    
run
=
job
[
'
run
'
]
    
worker
=
taskdesc
[
'
worker
'
]
    
branch
=
config
.
params
[
'
project
'
]
    
product
=
run
[
'
product
'
]
    
worker
.
pop
(
'
env
'
None
)
    
buildername
=
run
[
'
buildername
'
]
.
format
(
branch
=
branch
)
    
worker
.
update
(
{
        
'
buildername
'
:
buildername
        
'
sourcestamp
'
:
{
            
'
branch
'
:
branch
            
'
repository
'
:
config
.
params
[
'
head_repository
'
]
            
'
revision
'
:
config
.
params
[
'
head_rev
'
]
        
}
        
'
properties
'
:
{
            
'
product
'
:
product
            
'
who
'
:
config
.
params
[
'
owner
'
]
            
'
upload_to_task_id
'
:
slugid
.
nice
(
)
        
}
    
}
)
