"
"
"
Support
for
running
mach
python
-
test
tasks
(
via
run
-
task
)
"
"
"
from
__future__
import
absolute_import
print_function
unicode_literals
from
six
import
text_type
from
taskgraph
.
transforms
.
job
import
run_job_using
configure_taskdesc_for_run
from
taskgraph
.
util
.
schema
import
Schema
from
voluptuous
import
Required
Optional
python_test_schema
=
Schema
(
{
    
Required
(
'
using
'
)
:
'
python
-
test
'
    
Required
(
'
python
-
version
'
)
:
int
    
Required
(
'
subsuite
'
)
:
text_type
    
Optional
(
'
workdir
'
)
:
text_type
}
)
defaults
=
{
    
'
python
-
version
'
:
2
    
'
subsuite
'
:
'
default
'
}
run_job_using
(
'
docker
-
worker
'
'
python
-
test
'
schema
=
python_test_schema
defaults
=
defaults
)
run_job_using
(
'
generic
-
worker
'
'
python
-
test
'
schema
=
python_test_schema
defaults
=
defaults
)
def
configure_python_test
(
config
job
taskdesc
)
:
    
run
=
job
[
'
run
'
]
    
worker
=
job
[
'
worker
'
]
    
if
worker
[
'
os
'
]
=
=
'
macosx
'
and
run
[
'
python
-
version
'
]
=
=
3
:
        
run
[
'
python
-
version
'
]
=
'
/
tools
/
python37
/
bin
/
python3
.
7
'
        
if
job
[
'
worker
-
type
'
]
.
endswith
(
'
1014
'
)
:
            
run
[
'
python
-
version
'
]
=
'
/
usr
/
local
/
bin
/
python3
'
    
run
[
'
mach
'
]
=
(
"
python
-
test
-
-
python
{
python
-
version
}
-
-
subsuite
{
subsuite
}
"
                   
"
-
-
run
-
slow
"
)
.
format
(
*
*
run
)
    
run
[
'
using
'
]
=
'
mach
'
    
del
run
[
'
python
-
version
'
]
    
del
run
[
'
subsuite
'
]
    
configure_taskdesc_for_run
(
config
job
taskdesc
worker
[
'
implementation
'
]
)
