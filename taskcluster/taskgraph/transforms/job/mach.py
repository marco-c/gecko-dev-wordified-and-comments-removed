"
"
"
Support
for
running
mach
tasks
(
via
run
-
task
)
"
"
"
from
__future__
import
absolute_import
print_function
unicode_literals
from
taskgraph
.
transforms
.
job
import
run_job_using
configure_taskdesc_for_run
from
taskgraph
.
util
.
schema
import
Schema
from
voluptuous
import
Required
Optional
Any
mach_schema
=
Schema
(
{
    
Required
(
'
using
'
)
:
'
mach
'
    
Required
(
'
mach
'
)
:
basestring
    
Optional
(
'
sparse
-
profile
'
)
:
Any
(
basestring
None
)
    
Required
(
'
comm
-
checkout
'
)
:
bool
    
Required
(
'
workdir
'
)
:
basestring
}
)
defaults
=
{
    
'
comm
-
checkout
'
:
False
}
run_job_using
(
"
docker
-
worker
"
"
mach
"
schema
=
mach_schema
defaults
=
defaults
)
run_job_using
(
"
native
-
engine
"
"
mach
"
schema
=
mach_schema
defaults
=
defaults
)
run_job_using
(
"
generic
-
worker
"
"
mach
"
schema
=
mach_schema
defaults
=
defaults
)
def
configure_mach
(
config
job
taskdesc
)
:
    
run
=
job
[
'
run
'
]
    
run
[
'
command
'
]
=
'
cd
GECKO_PATH
&
&
.
/
mach
{
mach
}
'
.
format
(
*
*
run
)
    
run
[
'
using
'
]
=
'
run
-
task
'
    
del
run
[
'
mach
'
]
    
configure_taskdesc_for_run
(
config
job
taskdesc
job
[
'
worker
'
]
[
'
implementation
'
]
)
