"
"
"
This
file
defines
the
schema
for
tests
-
-
the
things
in
tests
.
yml
.
It
should
be
run
both
before
and
after
the
kind
-
specific
transforms
to
ensure
that
the
transforms
do
not
generate
invalid
tests
.
"
"
"
from
__future__
import
absolute_import
print_function
unicode_literals
from
taskgraph
.
transforms
.
base
import
validate_schema
from
voluptuous
import
(
    
Any
    
Optional
    
Required
    
Schema
)
test_description_schema
=
Schema
(
{
    
'
description
'
:
basestring
    
Required
(
'
suite
'
)
:
Any
(
        
basestring
        
{
'
by
-
test
-
platform
'
:
{
basestring
:
basestring
}
}
    
)
    
Optional
(
'
unittest
-
try
-
name
'
)
:
basestring
    
'
treeherder
-
symbol
'
:
basestring
    
Optional
(
'
treeherder
-
machine
-
platform
'
)
:
basestring
    
Optional
(
'
attributes
'
)
:
{
basestring
:
object
}
    
Optional
(
'
run
-
on
-
projects
'
default
=
[
'
all
'
]
)
:
Any
(
        
[
basestring
]
        
{
'
by
-
test
-
platform
'
:
{
basestring
:
[
basestring
]
}
}
    
)
    
Optional
(
'
tier
'
)
:
int
    
Required
(
'
chunks
'
default
=
1
)
:
Any
(
        
int
        
{
'
by
-
test
-
platform
'
:
{
basestring
:
int
}
}
    
)
    
Optional
(
'
expires
-
after
'
)
:
basestring
    
Required
(
'
e10s
'
default
=
'
both
'
)
:
Any
(
        
bool
'
both
'
        
{
'
by
-
test
-
platform
'
:
{
basestring
:
Any
(
bool
'
both
'
)
}
}
    
)
    
Required
(
'
instance
-
size
'
default
=
'
default
'
)
:
Any
(
        
Any
(
'
default
'
'
large
'
'
xlarge
'
'
legacy
'
)
        
{
'
by
-
test
-
platform
'
:
{
basestring
:
Any
(
'
default
'
'
large
'
'
xlarge
'
'
legacy
'
)
}
}
    
)
    
Required
(
'
loopback
-
audio
'
default
=
False
)
:
bool
    
Required
(
'
loopback
-
video
'
default
=
False
)
:
bool
    
Optional
(
'
allow
-
software
-
gl
-
layers
'
default
=
True
)
:
bool
    
Optional
(
'
worker
-
implementation
'
)
:
Any
(
        
'
docker
-
worker
'
        
'
generic
-
worker
'
        
'
docker
-
engine
'
        
'
buildbot
-
bridge
'
    
)
    
Required
(
'
docker
-
image
'
default
=
{
'
in
-
tree
'
:
'
desktop
-
test
'
}
)
:
Any
(
        
basestring
        
{
'
in
-
tree
'
:
basestring
}
    
)
    
Required
(
'
max
-
run
-
time
'
default
=
3600
)
:
Any
(
        
int
        
{
'
by
-
test
-
platform
'
:
{
basestring
:
int
}
}
    
)
    
Optional
(
'
retry
-
exit
-
status
'
)
:
int
    
Required
(
'
checkout
'
default
=
False
)
:
bool
    
Required
(
'
mozharness
'
)
:
Any
(
{
        
Required
(
'
script
'
)
:
basestring
        
Required
(
'
config
'
)
:
Any
(
            
[
basestring
]
            
{
'
by
-
test
-
platform
'
:
{
basestring
:
[
basestring
]
}
}
        
)
        
Optional
(
'
actions
'
)
:
[
basestring
]
        
Required
(
'
extra
-
options
'
default
=
[
]
)
:
Any
(
            
[
basestring
]
            
{
'
by
-
test
-
platform
'
:
{
basestring
:
[
basestring
]
}
}
        
)
        
Optional
(
'
build
-
artifact
-
name
'
)
:
basestring
        
Required
(
'
tooltool
-
downloads
'
default
=
False
)
:
bool
        
Required
(
'
no
-
read
-
buildbot
-
config
'
default
=
False
)
:
bool
        
Optional
(
'
download
-
symbols
'
)
:
Any
(
True
'
ondemand
'
)
        
Required
(
'
set
-
moz
-
node
-
path
'
default
=
False
)
:
bool
        
Required
(
'
chunked
'
default
=
False
)
:
bool
        
Required
(
'
chunking
-
args
'
default
=
'
this
-
chunk
'
)
:
Any
(
            
'
this
-
chunk
'
            
'
test
-
suite
-
suffix
'
        
)
        
Optional
(
'
chunk
-
suffix
'
)
:
basestring
    
}
)
    
Optional
(
'
this
-
chunk
'
)
:
int
    
Optional
(
'
os
-
groups
'
default
=
[
]
)
:
Any
(
        
[
basestring
]
        
{
'
by
-
test
-
platform
'
:
{
basestring
:
[
basestring
]
}
}
    
)
    
'
build
-
platform
'
:
basestring
    
'
build
-
label
'
:
basestring
    
'
test
-
platform
'
:
basestring
    
'
test
-
name
'
:
basestring
}
required
=
True
)
def
validate
(
config
tests
)
:
    
for
test
in
tests
:
        
yield
validate_schema
(
test_description_schema
test
                              
"
In
test
{
!
r
}
:
"
.
format
(
test
[
'
test
-
name
'
]
)
)
