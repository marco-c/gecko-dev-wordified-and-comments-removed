"
"
"
These
transforms
construct
a
task
description
to
run
the
given
test
based
on
a
test
description
.
The
implementation
here
is
shared
among
all
test
kinds
but
contains
specific
support
for
how
we
run
tests
in
Gecko
(
via
mozharness
invoked
in
particular
ways
)
.
This
is
a
good
place
to
translate
a
test
-
description
option
such
as
single
-
core
:
true
to
the
implementation
of
that
option
in
a
task
description
(
worker
options
mozharness
commandline
environment
variables
etc
.
)
The
test
description
should
be
fully
formed
by
the
time
it
reaches
these
transforms
and
these
transforms
should
not
embody
any
specific
knowledge
about
what
should
run
where
.
this
is
the
wrong
place
for
special
-
casing
platforms
for
example
-
use
all_tests
.
py
instead
.
"
"
"
from
__future__
import
absolute_import
print_function
unicode_literals
from
taskgraph
.
transforms
.
base
import
TransformSequence
from
taskgraph
.
util
.
schema
import
resolve_keyed_by
from
taskgraph
.
util
.
treeherder
import
split_symbol
join_symbol
from
taskgraph
.
util
.
schema
import
(
    
validate_schema
    
optionally_keyed_by
)
from
voluptuous
import
(
    
Any
    
Optional
    
Required
    
Schema
)
import
copy
import
logging
WORKER_TYPE
=
{
    
'
large
'
:
'
aws
-
provisioner
-
v1
/
gecko
-
t
-
linux
-
large
'
    
'
xlarge
'
:
'
aws
-
provisioner
-
v1
/
gecko
-
t
-
linux
-
xlarge
'
    
'
legacy
'
:
'
aws
-
provisioner
-
v1
/
gecko
-
t
-
linux
-
medium
'
    
'
default
'
:
'
aws
-
provisioner
-
v1
/
gecko
-
t
-
linux
-
large
'
    
'
windows7
-
32
-
vm
'
:
'
aws
-
provisioner
-
v1
/
gecko
-
t
-
win7
-
32
'
    
'
windows7
-
32
'
:
'
aws
-
provisioner
-
v1
/
gecko
-
t
-
win7
-
32
-
gpu
'
    
'
windows10
-
64
-
vm
'
:
'
aws
-
provisioner
-
v1
/
gecko
-
t
-
win10
-
64
'
    
'
windows10
-
64
'
:
'
aws
-
provisioner
-
v1
/
gecko
-
t
-
win10
-
64
-
gpu
'
}
logger
=
logging
.
getLogger
(
__name__
)
transforms
=
TransformSequence
(
)
test_description_schema
=
Schema
(
{
    
'
description
'
:
basestring
    
Required
(
'
suite
'
)
:
optionally_keyed_by
(
        
'
test
-
platform
'
        
basestring
)
    
Optional
(
'
unittest
-
try
-
name
'
)
:
basestring
    
Optional
(
'
talos
-
try
-
name
'
)
:
basestring
    
Optional
(
'
tags
'
)
:
{
basestring
:
object
}
    
'
treeherder
-
symbol
'
:
basestring
    
Optional
(
'
treeherder
-
machine
-
platform
'
)
:
basestring
    
Optional
(
'
attributes
'
)
:
{
basestring
:
object
}
    
Optional
(
'
run
-
on
-
projects
'
default
=
[
'
all
'
]
)
:
optionally_keyed_by
(
        
'
test
-
platform
'
        
[
basestring
]
)
    
Optional
(
'
tier
'
)
:
optionally_keyed_by
(
        
'
test
-
platform
'
        
Any
(
int
'
default
'
)
)
    
Required
(
'
chunks
'
default
=
1
)
:
optionally_keyed_by
(
        
'
test
-
platform
'
        
int
)
    
Optional
(
'
expires
-
after
'
)
:
basestring
    
Required
(
'
e10s
'
default
=
'
both
'
)
:
optionally_keyed_by
(
        
'
test
-
platform
'
'
project
'
        
Any
(
bool
'
both
'
)
)
    
Required
(
'
instance
-
size
'
default
=
'
default
'
)
:
optionally_keyed_by
(
        
'
test
-
platform
'
        
Any
(
'
default
'
'
large
'
'
xlarge
'
'
legacy
'
)
)
    
Required
(
'
loopback
-
audio
'
default
=
False
)
:
bool
    
Required
(
'
loopback
-
video
'
default
=
False
)
:
bool
    
Optional
(
'
allow
-
software
-
gl
-
layers
'
)
:
bool
    
Optional
(
'
worker
-
implementation
'
)
:
Any
(
        
'
docker
-
worker
'
        
'
native
-
engine
'
        
'
generic
-
worker
'
        
'
docker
-
engine
'
        
'
buildbot
-
bridge
'
    
)
    
Required
(
'
docker
-
image
'
default
=
{
'
in
-
tree
'
:
'
desktop
-
test
'
}
)
:
optionally_keyed_by
(
        
'
test
-
platform
'
'
test
-
platform
-
phylum
'
        
Any
(
            
basestring
            
{
'
in
-
tree
'
:
basestring
}
        
)
    
)
    
Required
(
'
max
-
run
-
time
'
default
=
3600
)
:
optionally_keyed_by
(
        
'
test
-
platform
'
        
int
)
    
Optional
(
'
retry
-
exit
-
status
'
)
:
int
    
Required
(
'
checkout
'
default
=
False
)
:
bool
    
Optional
(
'
reboot
'
default
=
False
)
:
bool
    
Required
(
'
mozharness
'
)
:
optionally_keyed_by
(
        
'
test
-
platform
'
'
test
-
platform
-
phylum
'
{
            
Required
(
'
script
'
)
:
basestring
            
Required
(
'
config
'
)
:
optionally_keyed_by
(
                
'
test
-
platform
'
                
[
basestring
]
)
            
Optional
(
'
actions
'
)
:
[
basestring
]
            
Required
(
'
extra
-
options
'
default
=
[
]
)
:
optionally_keyed_by
(
                
'
test
-
platform
'
                
[
basestring
]
)
            
Optional
(
'
build
-
artifact
-
name
'
)
:
basestring
            
Required
(
'
tooltool
-
downloads
'
default
=
False
)
:
bool
            
Required
(
'
no
-
read
-
buildbot
-
config
'
default
=
False
)
:
bool
            
Optional
(
'
include
-
blob
-
upload
-
branch
'
)
:
bool
            
Optional
(
'
download
-
symbols
'
)
:
Any
(
True
'
ondemand
'
)
            
Required
(
'
set
-
moz
-
node
-
path
'
default
=
False
)
:
bool
            
Required
(
'
chunked
'
default
=
False
)
:
bool
            
Required
(
'
chunking
-
args
'
default
=
'
this
-
chunk
'
)
:
Any
(
                
'
this
-
chunk
'
                
'
test
-
suite
-
suffix
'
            
)
            
Optional
(
'
chunk
-
suffix
'
)
:
basestring
        
}
    
)
    
Optional
(
'
this
-
chunk
'
)
:
int
    
Optional
(
'
os
-
groups
'
default
=
[
]
)
:
optionally_keyed_by
(
        
'
test
-
platform
'
        
[
basestring
]
)
    
'
build
-
platform
'
:
basestring
    
'
build
-
label
'
:
basestring
    
'
test
-
platform
'
:
basestring
    
'
test
-
name
'
:
basestring
    
Optional
(
'
product
'
)
:
basestring
}
required
=
True
)
transforms
.
add
def
validate
(
config
tests
)
:
    
for
test
in
tests
:
        
yield
validate_schema
(
test_description_schema
test
                              
"
In
test
{
!
r
}
:
"
.
format
(
test
[
'
test
-
name
'
]
)
)
transforms
.
add
def
handle_keyed_by_mozharness
(
config
tests
)
:
    
"
"
"
Resolve
a
mozharness
field
if
it
is
keyed
by
something
"
"
"
    
for
test
in
tests
:
        
resolve_keyed_by
(
test
'
mozharness
'
item_name
=
test
[
'
test
-
name
'
]
)
        
yield
test
transforms
.
add
def
set_defaults
(
config
tests
)
:
    
for
test
in
tests
:
        
build_platform
=
test
[
'
build
-
platform
'
]
        
if
build_platform
.
startswith
(
'
android
'
)
:
            
test
[
'
mozharness
'
]
[
'
tooltool
-
downloads
'
]
=
True
            
test
[
'
mozharness
'
]
[
'
actions
'
]
=
[
'
get
-
secrets
'
]
            
test
[
'
e10s
'
]
=
False
            
test
[
'
loopback
-
video
'
]
=
True
        
else
:
            
test
[
'
mozharness
'
]
[
'
set
-
moz
-
node
-
path
'
]
=
True
            
test
.
setdefault
(
'
e10s
'
'
both
'
)
        
if
test
[
'
test
-
platform
'
]
.
startswith
(
'
linux
'
)
:
            
test
.
setdefault
(
'
allow
-
software
-
gl
-
layers
'
True
)
        
else
:
            
test
[
'
allow
-
software
-
gl
-
layers
'
]
=
False
        
test
.
setdefault
(
'
os
-
groups
'
[
]
)
        
test
.
setdefault
(
'
chunks
'
1
)
        
test
.
setdefault
(
'
run
-
on
-
projects
'
[
'
all
'
]
)
        
test
.
setdefault
(
'
instance
-
size
'
'
default
'
)
        
test
.
setdefault
(
'
max
-
run
-
time
'
3600
)
        
test
.
setdefault
(
'
reboot
'
False
)
        
test
[
'
mozharness
'
]
.
setdefault
(
'
extra
-
options
'
[
]
)
        
yield
test
transforms
.
add
def
set_target
(
config
tests
)
:
    
for
test
in
tests
:
        
build_platform
=
test
[
'
build
-
platform
'
]
        
if
build_platform
.
startswith
(
'
macosx
'
)
:
            
target
=
'
target
.
dmg
'
        
elif
build_platform
.
startswith
(
'
android
'
)
:
            
target
=
'
target
.
apk
'
        
else
:
            
target
=
'
target
.
tar
.
bz2
'
        
test
[
'
mozharness
'
]
[
'
build
-
artifact
-
name
'
]
=
'
public
/
build
/
'
+
target
        
yield
test
transforms
.
add
def
set_treeherder_machine_platform
(
config
tests
)
:
    
"
"
"
Set
the
appropriate
task
.
extra
.
treeherder
.
machine
.
platform
"
"
"
    
translation
=
{
        
'
linux64
-
asan
/
opt
'
:
'
linux64
/
asan
'
        
'
linux64
-
pgo
/
opt
'
:
'
linux64
/
pgo
'
        
'
macosx64
/
debug
'
:
'
osx
-
10
-
10
/
debug
'
        
'
macosx64
/
opt
'
:
'
osx
-
10
-
10
/
opt
'
        
'
android
-
api
-
15
/
debug
'
:
'
android
-
4
-
3
-
armv7
-
api15
/
debug
'
        
'
android
-
api
-
15
/
opt
'
:
'
android
-
4
-
3
-
armv7
-
api15
/
opt
'
        
'
android
-
x86
/
opt
'
:
'
android
-
4
-
2
-
x86
/
opt
'
        
'
android
-
api
-
15
-
gradle
/
opt
'
:
'
android
-
api
-
15
-
gradle
/
opt
'
    
}
    
for
test
in
tests
:
        
test
[
'
treeherder
-
machine
-
platform
'
]
=
translation
.
get
(
            
test
[
'
build
-
platform
'
]
test
[
'
test
-
platform
'
]
)
        
yield
test
transforms
.
add
def
set_asan_docker_image
(
config
tests
)
:
    
"
"
"
Set
the
appropriate
task
.
extra
.
treeherder
.
docker
-
image
"
"
"
    
for
test
in
tests
:
        
if
test
[
'
suite
'
]
=
=
'
mochitest
/
mochitest
-
media
'
and
\
           
test
[
'
build
-
platform
'
]
=
=
'
linux64
-
asan
/
opt
'
:
            
test
[
'
docker
-
image
'
]
=
{
"
in
-
tree
"
:
"
desktop
-
test
"
}
        
yield
test
transforms
.
add
def
set_worker_implementation
(
config
tests
)
:
    
"
"
"
Set
the
worker
implementation
based
on
the
test
platform
.
"
"
"
    
for
test
in
tests
:
        
if
test
.
get
(
'
suite
'
'
'
)
=
=
'
talos
'
:
            
test
[
'
worker
-
implementation
'
]
=
'
buildbot
-
bridge
'
        
elif
test
[
'
test
-
platform
'
]
.
startswith
(
'
win
'
)
:
            
test
[
'
worker
-
implementation
'
]
=
'
generic
-
worker
'
        
elif
test
[
'
test
-
platform
'
]
.
startswith
(
'
macosx
'
)
:
            
test
[
'
worker
-
implementation
'
]
=
'
native
-
engine
'
        
else
:
            
test
[
'
worker
-
implementation
'
]
=
'
docker
-
worker
'
        
yield
test
transforms
.
add
def
set_tier
(
config
tests
)
:
    
"
"
"
Set
the
tier
based
on
policy
for
all
test
descriptions
that
do
not
    
specify
a
tier
otherwise
.
"
"
"
    
for
test
in
tests
:
        
if
'
tier
'
in
test
:
            
resolve_keyed_by
(
test
'
tier
'
item_name
=
test
[
'
test
-
name
'
]
)
        
if
'
tier
'
not
in
test
or
test
[
'
tier
'
]
=
=
'
default
'
:
            
if
test
[
'
test
-
platform
'
]
in
[
'
linux32
/
opt
'
                                         
'
linux32
/
debug
'
                                         
'
linux64
/
opt
'
                                         
'
linux64
/
debug
'
                                         
'
linux64
-
pgo
/
opt
'
                                         
'
linux64
-
asan
/
opt
'
                                         
'
android
-
4
.
3
-
arm7
-
api
-
15
/
opt
'
                                         
'
android
-
4
.
3
-
arm7
-
api
-
15
/
debug
'
                                         
'
android
-
4
.
2
-
x86
/
opt
'
]
:
                
test
[
'
tier
'
]
=
1
            
elif
test
[
'
test
-
platform
'
]
.
startswith
(
'
windows
'
)
:
                
test
[
'
tier
'
]
=
3
            
else
:
                
test
[
'
tier
'
]
=
2
        
yield
test
transforms
.
add
def
set_expires_after
(
config
tests
)
:
    
"
"
"
Try
jobs
expire
after
2
weeks
;
everything
else
lasts
1
year
.
This
helps
    
keep
storage
costs
low
.
"
"
"
    
for
test
in
tests
:
        
if
'
expires
-
after
'
not
in
test
:
            
if
config
.
params
[
'
project
'
]
=
=
'
try
'
:
                
test
[
'
expires
-
after
'
]
=
"
14
days
"
            
else
:
                
test
[
'
expires
-
after
'
]
=
"
1
year
"
        
yield
test
transforms
.
add
def
set_download_symbols
(
config
tests
)
:
    
"
"
"
In
general
we
download
symbols
immediately
for
debug
builds
but
only
    
on
demand
for
everything
else
.
ASAN
builds
shouldn
'
t
download
    
symbols
since
they
don
'
t
product
symbol
zips
see
bug
1283879
"
"
"
    
for
test
in
tests
:
        
if
test
[
'
test
-
platform
'
]
.
split
(
'
/
'
)
[
-
1
]
=
=
'
debug
'
:
            
test
[
'
mozharness
'
]
[
'
download
-
symbols
'
]
=
True
        
elif
test
[
'
build
-
platform
'
]
=
=
'
linux64
-
asan
/
opt
'
:
            
if
'
download
-
symbols
'
in
test
[
'
mozharness
'
]
:
                
del
test
[
'
mozharness
'
]
[
'
download
-
symbols
'
]
        
else
:
            
test
[
'
mozharness
'
]
[
'
download
-
symbols
'
]
=
'
ondemand
'
        
yield
test
transforms
.
add
def
handle_keyed_by
(
config
tests
)
:
    
"
"
"
Resolve
fields
that
can
be
keyed
by
platform
etc
.
"
"
"
    
fields
=
[
        
'
instance
-
size
'
        
'
docker
-
image
'
        
'
max
-
run
-
time
'
        
'
chunks
'
        
'
e10s
'
        
'
suite
'
        
'
run
-
on
-
projects
'
        
'
os
-
groups
'
        
'
mozharness
.
config
'
        
'
mozharness
.
extra
-
options
'
    
]
    
for
test
in
tests
:
        
for
field
in
fields
:
            
resolve_keyed_by
(
test
field
item_name
=
test
[
'
test
-
name
'
]
                             
project
=
config
.
params
[
'
project
'
]
)
        
yield
test
transforms
.
add
def
enable_code_coverage
(
config
tests
)
:
    
"
"
"
Enable
code
coverage
for
the
linux64
-
ccov
/
opt
&
linux64
-
jsdcov
/
opt
build
-
platforms
"
"
"
    
for
test
in
tests
:
        
if
test
[
'
build
-
platform
'
]
=
=
'
linux64
-
ccov
/
opt
'
:
            
test
[
'
mozharness
'
]
.
setdefault
(
'
extra
-
options
'
[
]
)
.
append
(
'
-
-
code
-
coverage
'
)
            
test
[
'
run
-
on
-
projects
'
]
=
[
]
        
elif
test
[
'
build
-
platform
'
]
=
=
'
linux64
-
jsdcov
/
opt
'
:
            
test
[
'
run
-
on
-
projects
'
]
=
[
]
        
yield
test
transforms
.
add
def
split_e10s
(
config
tests
)
:
    
for
test
in
tests
:
        
e10s
=
test
[
'
e10s
'
]
        
test
.
setdefault
(
'
attributes
'
{
}
)
        
test
[
'
e10s
'
]
=
False
        
test
[
'
attributes
'
]
[
'
e10s
'
]
=
False
        
if
e10s
=
=
'
both
'
:
            
yield
copy
.
deepcopy
(
test
)
            
e10s
=
True
        
if
e10s
:
            
test
[
'
test
-
name
'
]
+
=
'
-
e10s
'
            
test
[
'
e10s
'
]
=
True
            
test
[
'
attributes
'
]
[
'
e10s
'
]
=
True
            
group
symbol
=
split_symbol
(
test
[
'
treeherder
-
symbol
'
]
)
            
if
group
!
=
'
?
'
:
                
group
+
=
'
-
e10s
'
            
test
[
'
treeherder
-
symbol
'
]
=
join_symbol
(
group
symbol
)
            
test
[
'
mozharness
'
]
[
'
extra
-
options
'
]
.
append
(
'
-
-
e10s
'
)
        
yield
test
transforms
.
add
def
split_chunks
(
config
tests
)
:
    
"
"
"
Based
on
the
'
chunks
'
key
split
tests
up
into
chunks
by
duplicating
    
them
and
assigning
'
this
-
chunk
'
appropriately
and
updating
the
treeherder
    
symbol
.
"
"
"
    
for
test
in
tests
:
        
if
test
[
'
chunks
'
]
=
=
1
:
            
test
[
'
this
-
chunk
'
]
=
1
            
yield
test
            
continue
        
for
this_chunk
in
range
(
1
test
[
'
chunks
'
]
+
1
)
:
            
chunked
=
copy
.
deepcopy
(
test
)
            
chunked
[
'
this
-
chunk
'
]
=
this_chunk
            
group
symbol
=
split_symbol
(
chunked
[
'
treeherder
-
symbol
'
]
)
            
symbol
+
=
str
(
this_chunk
)
            
chunked
[
'
treeherder
-
symbol
'
]
=
join_symbol
(
group
symbol
)
            
yield
chunked
transforms
.
add
def
allow_software_gl_layers
(
config
tests
)
:
    
"
"
"
    
Handle
the
"
allow
-
software
-
gl
-
layers
"
property
for
platforms
where
it
    
applies
.
    
"
"
"
    
for
test
in
tests
:
        
if
test
.
get
(
'
allow
-
software
-
gl
-
layers
'
)
:
            
assert
test
[
'
instance
-
size
'
]
!
=
'
legacy
'
\
                
'
Software
GL
layers
on
a
legacy
instance
is
disallowed
(
bug
1296086
)
.
'
            
test
[
'
mozharness
'
]
.
setdefault
(
'
extra
-
options
'
[
]
)
\
                              
.
append
(
"
-
-
allow
-
software
-
gl
-
layers
"
)
        
yield
test
transforms
.
add
def
set_retry_exit_status
(
config
tests
)
:
    
"
"
"
Set
the
retry
exit
status
to
TBPL_RETRY
the
value
returned
by
mozharness
       
scripts
to
indicate
a
transient
failure
that
should
be
retried
.
"
"
"
    
for
test
in
tests
:
        
test
[
'
retry
-
exit
-
status
'
]
=
4
        
yield
test
transforms
.
add
def
set_profile
(
config
tests
)
:
    
"
"
"
Set
profiling
mode
for
tests
.
"
"
"
    
for
test
in
tests
:
        
if
config
.
config
[
'
args
'
]
.
profile
and
test
[
'
suite
'
]
=
=
'
talos
'
:
            
test
[
'
mozharness
'
]
[
'
extra
-
options
'
]
.
append
(
'
-
-
spsProfile
'
)
        
yield
test
transforms
.
add
def
set_tag
(
config
tests
)
:
    
"
"
"
Set
test
for
a
specific
tag
.
"
"
"
    
for
test
in
tests
:
        
tag
=
config
.
config
[
'
args
'
]
.
tag
        
if
tag
:
            
test
[
'
mozharness
'
]
[
'
extra
-
options
'
]
.
extend
(
[
'
-
-
tag
'
tag
]
)
        
yield
test
transforms
.
add
def
remove_linux_pgo_try_talos
(
config
tests
)
:
    
"
"
"
linux64
-
pgo
talos
tests
don
'
t
run
on
try
.
"
"
"
    
def
predicate
(
test
)
:
        
return
not
(
            
test
[
'
test
-
platform
'
]
=
=
'
linux64
-
pgo
/
opt
'
            
and
test
[
'
suite
'
]
=
=
'
talos
'
            
and
config
.
params
[
'
project
'
]
=
=
'
try
'
        
)
    
for
test
in
filter
(
predicate
tests
)
:
        
yield
test
transforms
.
add
def
remove_native
(
config
tests
)
:
    
"
"
"
Remove
native
-
engine
jobs
if
-
w
is
not
given
.
"
"
"
    
for
test
in
tests
:
        
if
test
[
'
worker
-
implementation
'
]
!
=
'
native
-
engine
'
\
                
or
config
.
config
[
'
args
'
]
.
taskcluster_worker
:
            
yield
test
transforms
.
add
def
make_job_description
(
config
tests
)
:
    
"
"
"
Convert
*
test
*
descriptions
to
*
job
*
descriptions
(
input
to
    
taskgraph
.
transforms
.
job
)
"
"
"
    
for
test
in
tests
:
        
label
=
'
{
}
-
{
}
-
{
}
'
.
format
(
config
.
kind
test
[
'
test
-
platform
'
]
test
[
'
test
-
name
'
]
)
        
if
test
[
'
chunks
'
]
>
1
:
            
label
+
=
'
-
{
}
'
.
format
(
test
[
'
this
-
chunk
'
]
)
        
build_label
=
test
[
'
build
-
label
'
]
        
if
'
talos
-
try
-
name
'
in
test
:
            
try_name
=
test
[
'
talos
-
try
-
name
'
]
            
attr_try_name
=
'
talos_try_name
'
        
else
:
            
try_name
=
test
.
get
(
'
unittest
-
try
-
name
'
test
[
'
test
-
name
'
]
)
            
attr_try_name
=
'
unittest_try_name
'
        
attr_build_platform
attr_build_type
=
test
[
'
build
-
platform
'
]
.
split
(
'
/
'
1
)
        
suite
=
test
[
'
suite
'
]
        
if
'
/
'
in
suite
:
            
suite
flavor
=
suite
.
split
(
'
/
'
1
)
        
else
:
            
flavor
=
suite
        
attributes
=
test
.
get
(
'
attributes
'
{
}
)
        
attributes
.
update
(
{
            
'
build_platform
'
:
attr_build_platform
            
'
build_type
'
:
attr_build_type
            
'
test_platform
'
:
test
[
'
test
-
platform
'
]
.
split
(
'
/
'
)
[
0
]
            
'
test_chunk
'
:
str
(
test
[
'
this
-
chunk
'
]
)
            
'
unittest_suite
'
:
suite
            
'
unittest_flavor
'
:
flavor
            
attr_try_name
:
try_name
        
}
)
        
jobdesc
=
{
}
        
name
=
'
{
}
-
{
}
'
.
format
(
test
[
'
test
-
platform
'
]
test
[
'
test
-
name
'
]
)
        
jobdesc
[
'
name
'
]
=
name
        
jobdesc
[
'
label
'
]
=
label
        
jobdesc
[
'
description
'
]
=
test
[
'
description
'
]
        
jobdesc
[
'
attributes
'
]
=
attributes
        
jobdesc
[
'
dependencies
'
]
=
{
'
build
'
:
build_label
}
        
jobdesc
[
'
expires
-
after
'
]
=
test
[
'
expires
-
after
'
]
        
jobdesc
[
'
routes
'
]
=
[
]
        
jobdesc
[
'
run
-
on
-
projects
'
]
=
test
.
get
(
'
run
-
on
-
projects
'
[
'
all
'
]
)
        
jobdesc
[
'
scopes
'
]
=
[
]
        
jobdesc
[
'
tags
'
]
=
test
.
get
(
'
tags
'
{
}
)
        
jobdesc
[
'
extra
'
]
=
{
            
'
chunks
'
:
{
                
'
current
'
:
test
[
'
this
-
chunk
'
]
                
'
total
'
:
test
[
'
chunks
'
]
            
}
            
'
suite
'
:
{
                
'
name
'
:
suite
                
'
flavor
'
:
flavor
            
}
        
}
        
jobdesc
[
'
treeherder
'
]
=
{
            
'
symbol
'
:
test
[
'
treeherder
-
symbol
'
]
            
'
kind
'
:
'
test
'
            
'
tier
'
:
test
[
'
tier
'
]
            
'
platform
'
:
test
.
get
(
'
treeherder
-
machine
-
platform
'
test
[
'
build
-
platform
'
]
)
        
}
        
run
=
jobdesc
[
'
run
'
]
=
{
}
        
run
[
'
using
'
]
=
'
mozharness
-
test
'
        
run
[
'
test
'
]
=
test
        
worker
=
jobdesc
[
'
worker
'
]
=
{
}
        
implementation
=
worker
[
'
implementation
'
]
=
test
[
'
worker
-
implementation
'
]
        
if
implementation
=
=
'
buildbot
-
bridge
'
:
            
jobdesc
[
'
worker
-
type
'
]
=
'
buildbot
-
bridge
/
buildbot
-
bridge
'
        
elif
implementation
=
=
'
native
-
engine
'
:
            
jobdesc
[
'
worker
-
type
'
]
=
'
tc
-
worker
-
provisioner
/
gecko
-
t
-
osx
-
10
-
10
'
        
elif
implementation
=
=
'
generic
-
worker
'
:
            
test_platform
=
test
[
'
test
-
platform
'
]
.
split
(
'
/
'
)
[
0
]
            
jobdesc
[
'
worker
-
type
'
]
=
WORKER_TYPE
[
test_platform
]
        
elif
implementation
=
=
'
docker
-
worker
'
or
implementation
=
=
'
docker
-
engine
'
:
            
jobdesc
[
'
worker
-
type
'
]
=
WORKER_TYPE
[
test
[
'
instance
-
size
'
]
]
            
worker
=
jobdesc
[
'
worker
'
]
            
worker
[
'
docker
-
image
'
]
=
test
[
'
docker
-
image
'
]
            
worker
[
'
allow
-
ptrace
'
]
=
True
            
worker
[
'
loopback
-
video
'
]
=
test
[
'
loopback
-
video
'
]
            
worker
[
'
loopback
-
audio
'
]
=
test
[
'
loopback
-
audio
'
]
            
worker
[
'
max
-
run
-
time
'
]
=
test
[
'
max
-
run
-
time
'
]
            
worker
[
'
retry
-
exit
-
status
'
]
=
test
[
'
retry
-
exit
-
status
'
]
        
yield
jobdesc
def
normpath
(
path
)
:
    
return
path
.
replace
(
'
/
'
'
\
\
'
)
def
get_firefox_version
(
)
:
    
with
open
(
'
browser
/
config
/
version
.
txt
'
'
r
'
)
as
f
:
        
return
f
.
readline
(
)
.
strip
(
)
