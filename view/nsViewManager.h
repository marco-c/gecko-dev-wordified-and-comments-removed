#
ifndef
nsViewManager_h___
#
define
nsViewManager_h___
#
include
"
nscore
.
h
"
#
include
"
nsView
.
h
"
#
include
"
nsCOMPtr
.
h
"
#
include
"
nsCRT
.
h
"
#
include
"
nsTArray
.
h
"
#
include
"
nsDeviceContext
.
h
"
#
include
"
nsTArray
.
h
"
#
include
"
mozilla
/
Attributes
.
h
"
#
include
"
mozilla
/
EventForwards
.
h
"
class
nsIWidget
;
struct
nsRect
;
class
nsRegion
;
class
nsDeviceContext
;
namespace
mozilla
{
class
PresShell
;
}
class
nsViewManager
final
{
~
nsViewManager
(
)
;
public
:
friend
class
nsView
;
typedef
mozilla
:
:
LayoutDeviceIntRect
LayoutDeviceIntRect
;
typedef
mozilla
:
:
LayoutDeviceIntRegion
LayoutDeviceIntRegion
;
NS_INLINE_DECL_REFCOUNTING
(
nsViewManager
)
explicit
nsViewManager
(
nsDeviceContext
*
aContext
)
;
nsresult
Init
(
nsDeviceContext
*
aContext
)
;
nsView
*
CreateView
(
const
nsSize
&
aSize
)
;
nsView
*
GetRootView
(
)
{
return
mRootView
;
}
void
SetRootView
(
nsView
*
aView
)
;
void
GetWindowDimensions
(
nscoord
*
aWidth
nscoord
*
aHeight
)
;
void
SetWindowDimensions
(
nscoord
aWidth
nscoord
aHeight
bool
aDelayResize
=
false
)
;
void
FlushDelayedResize
(
)
;
MOZ_CAN_RUN_SCRIPT
void
DispatchEvent
(
mozilla
:
:
WidgetGUIEvent
*
aEvent
nsView
*
aViewTarget
nsEventStatus
*
aStatus
)
;
void
ResizeView
(
nsView
*
aView
const
nsRect
&
aRect
)
;
void
SetPresShell
(
mozilla
:
:
PresShell
*
aPresShell
)
{
mPresShell
=
aPresShell
;
}
mozilla
:
:
PresShell
*
GetPresShell
(
)
const
{
return
mPresShell
;
}
nsDeviceContext
*
GetDeviceContext
(
)
const
{
return
mContext
;
}
public
:
void
IsPainting
(
bool
&
aIsPainting
)
;
static
uint32_t
GetLastUserEventTime
(
)
{
return
gLastUserEventTime
;
}
MOZ_CAN_RUN_SCRIPT
void
ProcessPendingUpdates
(
)
;
MOZ_CAN_RUN_SCRIPT
void
UpdateWidgetGeometry
(
)
;
int32_t
AppUnitsPerDevPixel
(
)
const
{
return
mContext
-
>
AppUnitsPerDevPixel
(
)
;
}
private
:
static
uint32_t
gLastUserEventTime
;
void
FlushPendingInvalidates
(
)
;
MOZ_CAN_RUN_SCRIPT
void
ProcessPendingUpdatesForView
(
nsView
*
aView
bool
aFlushDirtyRegion
=
true
)
;
void
ProcessPendingUpdatesRecurse
(
nsView
*
aView
AutoTArray
<
nsCOMPtr
<
nsIWidget
>
1
>
&
aWidgets
)
;
MOZ_CAN_RUN_SCRIPT
void
ProcessPendingUpdatesPaint
(
nsIWidget
*
aWidget
)
;
MOZ_CAN_RUN_SCRIPT_BOUNDARY
void
CallWillPaintOnObservers
(
)
;
static
void
CollectVMsForWillPaint
(
nsView
*
aView
nsViewManager
*
aParentVM
nsTArray
<
RefPtr
<
nsViewManager
>
>
&
aVMs
)
;
MOZ_CAN_RUN_SCRIPT
void
Refresh
(
nsView
*
aView
const
LayoutDeviceIntRegion
&
aRegion
)
;
MOZ_CAN_RUN_SCRIPT_BOUNDARY
void
DoSetWindowDimensions
(
nscoord
aWidth
nscoord
aHeight
)
;
bool
ShouldDelayResize
(
)
const
;
bool
IsPainting
(
)
const
{
return
RootViewManager
(
)
-
>
mPainting
;
}
void
SetPainting
(
bool
aPainting
)
{
RootViewManager
(
)
-
>
mPainting
=
aPainting
;
}
nsViewManager
*
RootViewManager
(
)
const
;
nsViewManager
*
GetParentViewManager
(
)
const
;
bool
IsRootVM
(
)
const
{
return
!
GetParentViewManager
(
)
;
}
MOZ_CAN_RUN_SCRIPT
void
WillPaintWindow
(
nsIWidget
*
aWidget
)
;
MOZ_CAN_RUN_SCRIPT
bool
PaintWindow
(
nsIWidget
*
aWidget
const
LayoutDeviceIntRegion
&
aRegion
)
;
MOZ_CAN_RUN_SCRIPT
void
DidPaintWindow
(
)
;
void
PostPendingUpdate
(
)
;
RefPtr
<
nsDeviceContext
>
mContext
;
mozilla
:
:
PresShell
*
mPresShell
;
nsSize
mDelayedResize
;
nsView
*
mRootView
;
bool
mPainting
;
bool
mHasPendingWidgetGeometryChanges
;
}
;
#
endif
