#
include
<
stdlib
.
h
>
#
if
!
defined
(
_WIN32
)
#
include
<
stdint
.
h
>
#
include
<
netinet
/
sctp_os_userspace
.
h
>
#
endif
#
include
<
user_environment
.
h
>
#
include
<
sys
/
types
.
h
>
#
if
!
defined
(
MIN
)
#
define
MIN
(
arg1
arg2
)
(
(
arg1
)
<
(
arg2
)
?
(
arg1
)
:
(
arg2
)
)
#
endif
#
include
<
string
.
h
>
#
define
uHZ
1000
int
maxsockets
=
25600
;
int
hz
=
uHZ
;
int
ip_defttl
=
64
;
int
ipport_firstauto
=
49152
ipport_lastauto
=
65535
;
int
nmbclusters
=
65536
;
u_short
ip_id
=
0
;
userland_mutex_t
atomic_mtx
;
#
ifdef
FUZZING_BUILD_MODE_UNSAFE_FOR_PRODUCTION
void
init_random
(
void
)
{
return
;
}
int
read_random
(
void
*
buf
int
count
)
{
memset
(
buf
'
A
'
count
)
;
return
(
count
)
;
}
#
elif
defined
(
__FreeBSD__
)
|
|
defined
(
__DragonFly__
)
|
|
defined
(
__OpenBSD__
)
|
|
defined
(
__OpenBSD__
)
|
|
defined
(
__APPLE__
)
void
init_random
(
void
)
{
return
;
}
int
read_random
(
void
*
buf
int
count
)
{
if
(
count
>
=
0
)
{
arc4random_buf
(
buf
count
)
;
}
return
(
count
)
;
}
#
else
void
init_random
(
void
)
{
struct
timeval
now
;
unsigned
int
seed
;
(
void
)
SCTP_GETTIME_TIMEVAL
(
&
now
)
;
seed
=
0
;
seed
|
=
(
unsigned
int
)
now
.
tv_sec
;
seed
|
=
(
unsigned
int
)
now
.
tv_usec
;
#
if
!
defined
(
_WIN32
)
&
&
!
defined
(
__native_client__
)
seed
|
=
getpid
(
)
;
#
endif
#
if
defined
(
_WIN32
)
|
|
defined
(
__native_client__
)
srand
(
seed
)
;
#
else
srandom
(
seed
)
;
#
endif
return
;
}
int
read_random
(
void
*
buf
int
count
)
{
uint32_t
randval
;
int
size
i
;
for
(
i
=
0
;
i
<
count
;
i
+
=
(
int
)
sizeof
(
uint32_t
)
)
{
randval
=
random
(
)
;
size
=
MIN
(
count
-
i
(
int
)
sizeof
(
uint32_t
)
)
;
memcpy
(
&
(
(
char
*
)
buf
)
[
i
]
&
randval
(
size_t
)
size
)
;
}
return
(
count
)
;
}
#
endif
