#
include
"
mozilla
/
net
/
TRRServiceChild
.
h
"
#
include
"
mozilla
/
ClearOnShutdown
.
h
"
#
include
"
mozilla
/
StaticPtr
.
h
"
#
include
"
nsIDNService
.
h
"
#
include
"
nsIObserverService
.
h
"
#
include
"
nsServiceManagerUtils
.
h
"
#
include
"
TRRService
.
h
"
namespace
mozilla
{
namespace
net
{
static
StaticRefPtr
<
nsIDNSService
>
sDNSService
;
void
TRRServiceChild
:
:
Init
(
const
bool
&
aCaptiveIsPassed
const
bool
&
aParentalControlEnabled
nsTArray
<
nsCString
>
&
&
aDNSSuffixList
)
{
nsCOMPtr
<
nsIDNSService
>
dns
=
do_GetService
(
"
mozilla
.
org
/
network
/
dns
-
service
;
1
"
)
;
sDNSService
=
dns
;
ClearOnShutdown
(
&
sDNSService
)
;
MOZ_ASSERT
(
sDNSService
)
;
MOZ_ASSERT
(
gTRRService
)
;
gTRRService
-
>
mCaptiveIsPassed
=
aCaptiveIsPassed
;
gTRRService
-
>
mParentalControlEnabled
=
aParentalControlEnabled
;
gTRRService
-
>
RebuildSuffixList
(
std
:
:
move
(
aDNSSuffixList
)
)
;
}
mozilla
:
:
ipc
:
:
IPCResult
TRRServiceChild
:
:
RecvUpdatePlatformDNSInformation
(
nsTArray
<
nsCString
>
&
&
aDNSSuffixList
)
{
gTRRService
-
>
RebuildSuffixList
(
std
:
:
move
(
aDNSSuffixList
)
)
;
return
IPC_OK
(
)
;
}
mozilla
:
:
ipc
:
:
IPCResult
TRRServiceChild
:
:
RecvUpdateParentalControlEnabled
(
const
bool
&
aEnabled
)
{
gTRRService
-
>
mParentalControlEnabled
=
aEnabled
;
return
IPC_OK
(
)
;
}
mozilla
:
:
ipc
:
:
IPCResult
TRRServiceChild
:
:
RecvClearDNSCache
(
const
bool
&
aTrrToo
)
{
Unused
<
<
sDNSService
-
>
ClearCache
(
aTrrToo
)
;
return
IPC_OK
(
)
;
}
mozilla
:
:
ipc
:
:
IPCResult
TRRServiceChild
:
:
RecvSetDetectedTrrURI
(
const
nsCString
&
aURI
)
{
gTRRService
-
>
SetDetectedTrrURI
(
aURI
)
;
return
IPC_OK
(
)
;
}
}
}
