#
ifndef
nsIDNService_h__
#
define
nsIDNService_h__
#
include
"
nsIIDNService
.
h
"
#
include
"
nsCOMPtr
.
h
"
#
include
"
nsIObserver
.
h
"
#
include
"
nsUnicodeScriptCodes
.
h
"
#
include
"
nsWeakReference
.
h
"
#
include
"
unicode
/
uidna
.
h
"
#
include
"
nsString
.
h
"
class
nsIPrefBranch
;
class
nsIDNService
final
:
public
nsIIDNService
public
nsSupportsWeakReference
{
public
:
NS_DECL_THREADSAFE_ISUPPORTS
NS_DECL_NSIIDNSERVICE
nsIDNService
(
)
;
nsresult
Init
(
)
;
protected
:
virtual
~
nsIDNService
(
)
;
private
:
enum
stringPrepFlag
{
eStringPrepForDNS
eStringPrepForUI
eStringPrepIgnoreErrors
}
;
void
normalizeFullStops
(
nsAString
&
s
)
;
nsresult
stringPrepAndACE
(
const
nsAString
&
in
nsACString
&
out
stringPrepFlag
flag
)
;
nsresult
stringPrep
(
const
nsAString
&
in
nsAString
&
out
stringPrepFlag
flag
)
;
nsresult
decodeACE
(
const
nsACString
&
in
nsACString
&
out
stringPrepFlag
flag
)
;
nsresult
UTF8toACE
(
const
nsACString
&
input
nsACString
&
ace
stringPrepFlag
flag
)
;
nsresult
ACEtoUTF8
(
const
nsACString
&
input
nsACString
&
_retval
stringPrepFlag
flag
)
;
bool
isInWhitelist
(
const
nsACString
&
host
)
;
void
prefsChanged
(
const
char
*
pref
)
;
static
void
PrefChanged
(
const
char
*
aPref
nsIDNService
*
aSelf
)
{
mozilla
:
:
MutexAutoLock
lock
(
aSelf
-
>
mLock
)
;
aSelf
-
>
prefsChanged
(
aPref
)
;
}
bool
isLabelSafe
(
const
nsAString
&
label
)
;
bool
illegalScriptCombo
(
mozilla
:
:
unicode
:
:
Script
script
int32_t
&
savedScript
)
;
nsresult
IDNA2008ToUnicode
(
const
nsACString
&
input
nsAString
&
output
)
;
nsresult
IDNA2008StringPrep
(
const
nsAString
&
input
nsAString
&
output
stringPrepFlag
flag
)
;
UIDNA
*
mIDNA
;
mozilla
:
:
Mutex
mLock
;
nsString
mIDNBlacklist
;
bool
mShowPunycode
;
enum
restrictionProfile
{
eASCIIOnlyProfile
eHighlyRestrictiveProfile
eModeratelyRestrictiveProfile
}
;
restrictionProfile
mRestrictionProfile
;
nsCOMPtr
<
nsIPrefBranch
>
mIDNWhitelistPrefBranch
;
bool
mIDNUseWhitelist
;
}
;
#
endif
