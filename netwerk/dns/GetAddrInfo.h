#
ifndef
netwerk_dns_GetAddrInfo_h
#
define
netwerk_dns_GetAddrInfo_h
#
include
"
nsError
.
h
"
#
include
"
nscore
.
h
"
#
include
"
nsINativeDNSResolverOverride
.
h
"
#
include
"
nsHashKeys
.
h
"
#
include
"
nsTHashMap
.
h
"
#
include
"
mozilla
/
RWLock
.
h
"
#
include
"
nsTArray
.
h
"
#
include
"
prio
.
h
"
#
include
"
mozilla
/
net
/
DNS
.
h
"
#
include
"
nsIDNSByTypeRecord
.
h
"
#
include
"
mozilla
/
Logging
.
h
"
#
if
defined
(
XP_WIN
)
#
define
DNSQUERY_AVAILABLE
1
#
else
#
undef
DNSQUERY_AVAILABLE
#
endif
namespace
mozilla
{
namespace
net
{
extern
LazyLogModule
gGetAddrInfoLog
;
class
AddrInfo
;
class
DNSPacket
;
nsresult
GetAddrInfo
(
const
nsACString
&
aHost
uint16_t
aAddressFamily
uint16_t
aFlags
AddrInfo
*
*
aAddrInfo
bool
aGetTtl
)
;
nsresult
GetAddrInfoInit
(
)
;
nsresult
GetAddrInfoShutdown
(
)
;
void
DNSThreadShutdown
(
)
;
nsresult
ResolveHTTPSRecord
(
const
nsACString
&
aHost
uint16_t
aFlags
TypeRecordResultType
&
aResult
uint32_t
&
aTTL
)
;
nsresult
ResolveHTTPSRecordImpl
(
const
nsACString
&
aHost
uint16_t
aFlags
TypeRecordResultType
&
aResult
uint32_t
&
aTTL
)
;
nsresult
ParseHTTPSRecord
(
nsCString
&
aHost
DNSPacket
&
aDNSPacket
TypeRecordResultType
&
aResult
uint32_t
&
aTTL
)
;
class
NativeDNSResolverOverride
:
public
nsINativeDNSResolverOverride
{
NS_DECL_THREADSAFE_ISUPPORTS
NS_DECL_NSINATIVEDNSRESOLVEROVERRIDE
public
:
NativeDNSResolverOverride
(
)
=
default
;
static
already_AddRefed
<
nsINativeDNSResolverOverride
>
GetSingleton
(
)
;
private
:
virtual
~
NativeDNSResolverOverride
(
)
=
default
;
mozilla
:
:
RWLock
mLock
MOZ_UNANNOTATED
{
"
NativeDNSResolverOverride
"
}
;
nsTHashMap
<
nsCStringHashKey
nsTArray
<
NetAddr
>
>
mOverrides
;
nsTHashMap
<
nsCStringHashKey
nsCString
>
mCnames
;
nsTHashMap
<
nsCStringHashKey
nsTArray
<
uint8_t
>
>
mHTTPSRecordOverrides
;
friend
bool
FindAddrOverride
(
const
nsACString
&
aHost
uint16_t
aAddressFamily
uint16_t
aFlags
AddrInfo
*
*
aAddrInfo
)
;
friend
bool
FindHTTPSRecordOverride
(
const
nsACString
&
aHost
TypeRecordResultType
&
aResult
)
;
}
;
}
}
#
endif
