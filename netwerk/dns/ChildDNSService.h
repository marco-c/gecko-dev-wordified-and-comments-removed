#
ifndef
mozilla_net_ChildDNSService_h
#
define
mozilla_net_ChildDNSService_h
#
include
"
nsPIDNSService
.
h
"
#
include
"
nsIObserver
.
h
"
#
include
"
mozilla
/
Attributes
.
h
"
#
include
"
mozilla
/
Mutex
.
h
"
#
include
"
DNSRequestChild
.
h
"
#
include
"
nsHashKeys
.
h
"
#
include
"
nsClassHashtable
.
h
"
namespace
mozilla
{
namespace
net
{
class
ChildDNSService
final
:
public
nsPIDNSService
public
nsIObserver
{
public
:
NS_DECL_THREADSAFE_ISUPPORTS
NS_DECL_NSPIDNSSERVICE
NS_DECL_NSIDNSSERVICE
NS_DECL_NSIOBSERVER
ChildDNSService
(
)
;
static
already_AddRefed
<
ChildDNSService
>
GetSingleton
(
)
;
void
NotifyRequestDone
(
DNSRequestChild
*
aDnsRequest
)
;
bool
GetOffline
(
)
const
;
private
:
virtual
~
ChildDNSService
(
)
;
void
MOZ_ALWAYS_INLINE
GetDNSRecordHashKey
(
const
nsACString
&
aHost
const
OriginAttributes
&
aOriginAttributes
uint32_t
aFlags
const
nsACString
&
aNetworkInterface
nsIDNSListener
*
aListener
nsACString
&
aHashKey
)
;
bool
mFirstTime
;
bool
mDisablePrefetch
;
nsClassHashtable
<
nsCStringHashKey
nsTArray
<
RefPtr
<
DNSRequestChild
>
>
>
mPendingRequests
;
Mutex
mPendingRequestsLock
;
}
;
}
}
#
endif
