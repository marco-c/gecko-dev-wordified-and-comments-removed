#
ifndef
mozilla_net_DocumentChannelParent_h
#
define
mozilla_net_DocumentChannelParent_h
#
include
"
mozilla
/
net
/
PDocumentChannelParent
.
h
"
#
include
"
mozilla
/
net
/
DocumentLoadListener
.
h
"
namespace
mozilla
{
namespace
net
{
class
DocumentChannelParent
final
:
public
ADocumentChannelBridge
public
PDocumentChannelParent
{
public
:
NS_INLINE_DECL_REFCOUNTING
(
DocumentChannelParent
override
)
;
explicit
DocumentChannelParent
(
const
dom
:
:
PBrowserOrId
&
aIframeEmbedding
nsILoadContext
*
aLoadContext
PBOverrideStatus
aOverrideStatus
)
{
mParent
=
new
DocumentLoadListener
(
aIframeEmbedding
aLoadContext
aOverrideStatus
this
)
;
}
bool
Init
(
const
DocumentChannelCreationArgs
&
aArgs
)
;
bool
RecvCancel
(
const
nsresult
&
aStatus
)
{
mParent
-
>
Cancel
(
aStatus
)
;
return
true
;
}
void
ActorDestroy
(
ActorDestroyReason
aWhy
)
override
{
mParent
-
>
DocumentChannelBridgeDisconnected
(
)
;
mParent
=
nullptr
;
}
private
:
void
DisconnectChildListeners
(
nsresult
aStatus
)
override
{
if
(
CanSend
(
)
)
{
Unused
<
<
SendDisconnectChildListeners
(
aStatus
)
;
}
}
void
Delete
(
)
override
{
if
(
CanSend
(
)
)
{
Unused
<
<
SendDeleteSelf
(
)
;
}
}
RefPtr
<
PDocumentChannelParent
:
:
ConfirmRedirectPromise
>
ConfirmRedirect
(
const
LoadInfoArgs
&
aLoadInfo
nsIURI
*
aNewURI
)
override
{
return
SendConfirmRedirect
(
aLoadInfo
aNewURI
)
;
}
virtual
ProcessId
OtherPid
(
)
const
override
{
return
IProtocol
:
:
OtherPid
(
)
;
}
virtual
bool
AttachStreamFilter
(
Endpoint
<
mozilla
:
:
extensions
:
:
PStreamFilterParent
>
&
&
aEndpoint
)
override
{
return
SendAttachStreamFilter
(
std
:
:
move
(
aEndpoint
)
)
;
}
RefPtr
<
PDocumentChannelParent
:
:
RedirectToRealChannelPromise
>
RedirectToRealChannel
(
uint32_t
aRedirectFlags
uint32_t
aLoadFlags
)
override
;
~
DocumentChannelParent
(
)
=
default
;
RefPtr
<
DocumentLoadListener
>
mParent
;
}
;
}
}
#
endif
