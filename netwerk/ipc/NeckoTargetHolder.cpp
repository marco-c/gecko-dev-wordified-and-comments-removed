#
include
"
NeckoTargetHolder
.
h
"
#
include
"
nsContentUtils
.
h
"
namespace
mozilla
{
namespace
net
{
already_AddRefed
<
nsISerialEventTarget
>
NeckoTargetHolder
:
:
GetNeckoTarget
(
)
{
nsCOMPtr
<
nsISerialEventTarget
>
target
=
mNeckoTarget
;
if
(
!
target
)
{
target
=
GetMainThreadSerialEventTarget
(
)
;
}
return
target
.
forget
(
)
;
}
nsresult
NeckoTargetHolder
:
:
Dispatch
(
already_AddRefed
<
nsIRunnable
>
&
&
aRunnable
nsIEventTarget
:
:
DispatchFlags
aDispatchFlags
)
{
if
(
mNeckoTarget
)
{
return
mNeckoTarget
-
>
Dispatch
(
std
:
:
move
(
aRunnable
)
aDispatchFlags
)
;
}
nsCOMPtr
<
nsISerialEventTarget
>
mainThreadTarget
=
GetMainThreadSerialEventTarget
(
)
;
MOZ_ASSERT
(
mainThreadTarget
)
;
return
mainThreadTarget
-
>
Dispatch
(
std
:
:
move
(
aRunnable
)
aDispatchFlags
)
;
}
}
}
