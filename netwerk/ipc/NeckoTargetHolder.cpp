#
include
"
NeckoTargetHolder
.
h
"
#
include
"
nsContentUtils
.
h
"
#
include
"
nsILoadInfo
.
h
"
namespace
mozilla
{
namespace
net
{
already_AddRefed
<
nsIEventTarget
>
NeckoTargetHolder
:
:
GetNeckoTarget
(
)
{
nsCOMPtr
<
nsIEventTarget
>
target
=
mNeckoTarget
;
if
(
!
target
)
{
target
=
GetMainThreadEventTarget
(
)
;
}
return
target
.
forget
(
)
;
}
nsresult
NeckoTargetHolder
:
:
Dispatch
(
already_AddRefed
<
nsIRunnable
>
&
&
aRunnable
uint32_t
aDispatchFlags
)
{
if
(
mNeckoTarget
)
{
return
mNeckoTarget
-
>
Dispatch
(
std
:
:
move
(
aRunnable
)
aDispatchFlags
)
;
}
nsCOMPtr
<
nsIEventTarget
>
mainThreadTarget
=
GetMainThreadEventTarget
(
)
;
MOZ_ASSERT
(
mainThreadTarget
)
;
return
mainThreadTarget
-
>
Dispatch
(
std
:
:
move
(
aRunnable
)
aDispatchFlags
)
;
}
}
}
