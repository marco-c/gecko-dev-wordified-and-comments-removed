#
include
"
ExtensionProtocolHandler
.
h
"
#
include
"
nsIAddonPolicyService
.
h
"
#
include
"
nsServiceManagerUtils
.
h
"
namespace
mozilla
{
NS_IMPL_QUERY_INTERFACE
(
ExtensionProtocolHandler
nsISubstitutingProtocolHandler
nsIProtocolHandler
nsIProtocolHandlerWithDynamicFlags
nsISupportsWeakReference
)
NS_IMPL_ADDREF_INHERITED
(
ExtensionProtocolHandler
SubstitutingProtocolHandler
)
NS_IMPL_RELEASE_INHERITED
(
ExtensionProtocolHandler
SubstitutingProtocolHandler
)
nsresult
ExtensionProtocolHandler
:
:
GetFlagsForURI
(
nsIURI
*
aURI
uint32_t
*
aFlags
)
{
nsCOMPtr
<
nsIAddonPolicyService
>
aps
=
do_GetService
(
"
mozilla
.
org
/
addons
/
policy
-
service
;
1
"
)
;
bool
loadableByAnyone
=
false
;
if
(
aps
)
{
nsresult
rv
=
aps
-
>
ExtensionURILoadableByAnyone
(
aURI
&
loadableByAnyone
)
;
NS_ENSURE_SUCCESS
(
rv
rv
)
;
}
*
aFlags
=
URI_STD
|
URI_IS_LOCAL_RESOURCE
|
(
loadableByAnyone
?
(
URI_LOADABLE_BY_ANYONE
|
URI_FETCHABLE_BY_ANYONE
)
:
URI_DANGEROUS_TO_LOAD
)
;
return
NS_OK
;
}
}
