#
include
"
TrackingDummyChannelParent
.
h
"
#
include
"
mozilla
/
Unused
.
h
"
#
include
"
nsChannelClassifier
.
h
"
#
include
"
nsIChannel
.
h
"
#
include
"
nsIPrincipal
.
h
"
#
include
"
nsNetUtil
.
h
"
namespace
mozilla
{
namespace
net
{
TrackingDummyChannelParent
:
:
TrackingDummyChannelParent
(
)
:
mIPCActive
(
true
)
{
}
TrackingDummyChannelParent
:
:
~
TrackingDummyChannelParent
(
)
=
default
;
void
TrackingDummyChannelParent
:
:
Init
(
nsIURI
*
aURI
nsIURI
*
aTopWindowURI
nsresult
aTopWindowURIResult
nsILoadInfo
*
aLoadInfo
)
{
MOZ_ASSERT
(
mIPCActive
)
;
RefPtr
<
TrackingDummyChannelParent
>
self
=
this
;
auto
onExit
=
MakeScopeExit
(
[
self
]
{
Unused
<
<
Send__delete__
(
self
false
)
;
}
)
;
if
(
!
aURI
)
{
return
;
}
RefPtr
<
TrackingDummyChannel
>
channel
=
new
TrackingDummyChannel
(
aURI
aTopWindowURI
aTopWindowURIResult
aLoadInfo
)
;
RefPtr
<
nsChannelClassifier
>
channelClassifier
=
new
nsChannelClassifier
(
channel
)
;
bool
willCallback
=
NS_SUCCEEDED
(
channelClassifier
-
>
CheckIsTrackerWithLocalTable
(
[
self
=
std
:
:
move
(
self
)
channel
]
(
)
{
if
(
self
-
>
mIPCActive
)
{
Unused
<
<
Send__delete__
(
self
channel
-
>
IsTrackingResource
(
)
)
;
}
}
)
)
;
if
(
willCallback
)
{
onExit
.
release
(
)
;
}
}
void
TrackingDummyChannelParent
:
:
ActorDestroy
(
ActorDestroyReason
aWhy
)
{
mIPCActive
=
false
;
}
}
}
