#
ifndef
__ClassOfService_h__
#
define
__ClassOfService_h__
#
include
"
nsIClassOfService
.
h
"
#
include
"
ipc
/
IPCMessageUtils
.
h
"
#
include
<
bitset
>
namespace
mozilla
:
:
net
{
class
ClassOfService
{
public
:
ClassOfService
(
)
:
mClassFlags
(
0
)
mIncremental
(
false
)
{
}
ClassOfService
(
unsigned
long
flags
bool
incremental
)
:
mClassFlags
(
flags
)
mIncremental
(
incremental
)
{
}
unsigned
long
Flags
(
)
const
{
return
mClassFlags
;
}
void
SetFlags
(
unsigned
long
flags
)
{
mClassFlags
=
flags
;
}
bool
Incremental
(
)
const
{
return
mIncremental
;
}
void
SetIncremental
(
bool
incremental
)
{
mIncremental
=
incremental
;
}
static
nsCString
ToString
(
const
ClassOfService
cos
)
{
return
ToString
(
cos
.
Flags
(
)
)
;
}
static
nsCString
ToString
(
unsigned
long
flags
)
{
return
nsCString
(
std
:
:
bitset
<
32
>
(
flags
)
.
to_string
(
)
)
;
}
private
:
unsigned
long
mClassFlags
;
bool
mIncremental
;
friend
IPC
:
:
ParamTraits
<
mozilla
:
:
net
:
:
ClassOfService
>
;
friend
bool
operator
=
=
(
const
ClassOfService
&
lhs
const
ClassOfService
&
rhs
)
;
friend
bool
operator
!
=
(
const
ClassOfService
&
lhs
const
ClassOfService
&
rhs
)
;
}
;
inline
bool
operator
=
=
(
const
ClassOfService
&
lhs
const
ClassOfService
&
rhs
)
{
return
lhs
.
mClassFlags
=
=
rhs
.
mClassFlags
&
&
lhs
.
mIncremental
=
=
rhs
.
mIncremental
;
}
inline
bool
operator
!
=
(
const
ClassOfService
&
lhs
const
ClassOfService
&
rhs
)
{
return
!
(
lhs
=
=
rhs
)
;
}
}
namespace
IPC
{
template
<
>
struct
ParamTraits
<
mozilla
:
:
net
:
:
ClassOfService
>
{
typedef
mozilla
:
:
net
:
:
ClassOfService
paramType
;
static
void
Write
(
MessageWriter
*
aWriter
const
paramType
&
aParam
)
{
WriteParam
(
aWriter
aParam
.
mClassFlags
)
;
WriteParam
(
aWriter
aParam
.
mIncremental
)
;
}
static
bool
Read
(
MessageReader
*
aReader
paramType
*
aResult
)
{
if
(
!
ReadParam
(
aReader
&
aResult
-
>
mClassFlags
)
|
|
!
ReadParam
(
aReader
&
aResult
-
>
mIncremental
)
)
return
false
;
return
true
;
}
}
;
}
#
endif
