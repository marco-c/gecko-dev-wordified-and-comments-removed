#
include
"
Capsule
.
h
"
#
include
"
CapsuleEncoder
.
h
"
#
include
"
Http2Session
.
h
"
namespace
mozilla
:
:
net
{
void
Capsule
:
:
LogBuffer
(
const
uint8_t
*
aBuffer
uint32_t
aLength
)
{
#
ifdef
DEBUG
Http2Session
:
:
LogIO
(
nullptr
nullptr
"
Capsule
"
reinterpret_cast
<
const
char
*
>
(
aBuffer
)
aLength
)
;
#
endif
}
Capsule
Capsule
:
:
CloseWebTransportSession
(
uint32_t
aStatus
const
nsACString
&
aReason
)
{
CloseWebTransportSessionCapsule
capsule
;
capsule
.
mStatus
=
aStatus
;
capsule
.
mReason
=
aReason
;
return
Capsule
(
std
:
:
move
(
capsule
)
)
;
}
Capsule
Capsule
:
:
WebTransportMaxData
(
uint64_t
aValue
)
{
WebTransportMaxDataCapsule
capsule
;
capsule
.
mMaxDataSize
=
aValue
;
return
Capsule
(
std
:
:
move
(
capsule
)
)
;
}
Capsule
Capsule
:
:
WebTransportStreamData
(
uint64_t
aID
bool
aFin
nsTArray
<
uint8_t
>
&
&
aData
)
{
WebTransportStreamDataCapsule
capsule
;
capsule
.
mID
=
aID
;
capsule
.
mFin
=
aFin
;
capsule
.
mData
.
AppendElements
(
std
:
:
move
(
aData
)
)
;
return
Capsule
(
std
:
:
move
(
capsule
)
)
;
}
Capsule
Capsule
:
:
WebTransportStreamsBlocked
(
uint64_t
aLimit
bool
aBidi
)
{
WebTransportStreamsBlockedCapsule
capsule
;
capsule
.
mLimit
=
aLimit
;
capsule
.
mBidi
=
aBidi
;
return
Capsule
(
std
:
:
move
(
capsule
)
)
;
}
Capsule
Capsule
:
:
Unknown
(
uint64_t
aType
nsTArray
<
uint8_t
>
&
&
aData
)
{
UnknownCapsule
capsule
;
capsule
.
mType
=
aType
;
capsule
.
mData
=
std
:
:
move
(
aData
)
;
return
Capsule
(
std
:
:
move
(
capsule
)
)
;
}
CapsuleType
Capsule
:
:
Type
(
)
const
{
return
mCapsule
.
match
(
[
]
(
const
UnknownCapsule
&
aCapsule
)
{
return
aCapsule
.
Type
(
)
;
}
[
]
(
const
CloseWebTransportSessionCapsule
&
aCapsule
)
{
return
aCapsule
.
Type
(
)
;
}
[
]
(
const
WebTransportMaxDataCapsule
&
aCapsule
)
{
return
aCapsule
.
Type
(
)
;
}
[
]
(
const
WebTransportStreamDataCapsule
&
aCapsule
)
{
return
aCapsule
.
Type
(
)
;
}
[
]
(
const
WebTransportStreamsBlockedCapsule
&
aCapsule
)
{
return
aCapsule
.
Type
(
)
;
}
)
;
}
}
