#
ifndef
ConnectionEntry_h__
#
define
ConnectionEntry_h__
#
include
"
PendingTransactionInfo
.
h
"
#
include
"
HalfOpenSocket
.
h
"
namespace
mozilla
{
namespace
net
{
class
ConnectionEntry
{
public
:
NS_INLINE_DECL_THREADSAFE_REFCOUNTING
(
ConnectionEntry
)
explicit
ConnectionEntry
(
nsHttpConnectionInfo
*
ci
)
;
RefPtr
<
nsHttpConnectionInfo
>
mConnInfo
;
nsTArray
<
RefPtr
<
PendingTransactionInfo
>
>
mUrgentStartQ
;
nsClassHashtable
<
nsUint64HashKey
nsTArray
<
RefPtr
<
PendingTransactionInfo
>
>
>
mPendingTransactionTable
;
nsTArray
<
RefPtr
<
HttpConnectionBase
>
>
mActiveConns
;
nsTArray
<
RefPtr
<
nsHttpConnection
>
>
mIdleConns
;
nsTArray
<
HalfOpenSocket
*
>
mHalfOpens
;
nsTArray
<
RefPtr
<
HalfOpenSocket
>
>
mHalfOpenFastOpenBackups
;
bool
AvailableForDispatchNow
(
)
;
uint32_t
UnconnectedHalfOpens
(
)
;
void
RemoveHalfOpen
(
HalfOpenSocket
*
)
;
nsTArray
<
nsCString
>
mCoalescingKeys
;
bool
mUsingSpdy
:
1
;
bool
mCanUseSpdy
:
1
;
bool
mPreferIPv4
:
1
;
bool
mPreferIPv6
:
1
;
bool
mUsedForConnection
:
1
;
bool
mUseFastOpen
:
1
;
bool
mDoNotDestroy
:
1
;
bool
AllowHttp2
(
)
const
{
return
mCanUseSpdy
;
}
void
DisallowHttp2
(
)
;
void
DontReuseHttp3Conn
(
)
;
void
RecordIPFamilyPreference
(
uint16_t
family
)
;
void
ResetIPFamilyPreference
(
)
;
bool
PreferenceKnown
(
)
const
;
size_t
PendingQLength
(
)
const
;
void
InsertTransaction
(
PendingTransactionInfo
*
info
bool
aInsertAsFirstForTheSamePriority
=
false
)
;
void
AppendPendingQForFocusedWindow
(
uint64_t
windowId
nsTArray
<
RefPtr
<
PendingTransactionInfo
>
>
&
result
uint32_t
maxCount
=
0
)
;
void
AppendPendingQForNonFocusedWindows
(
uint64_t
windowId
nsTArray
<
RefPtr
<
PendingTransactionInfo
>
>
&
result
uint32_t
maxCount
=
0
)
;
void
RemoveEmptyPendingQ
(
)
;
private
:
~
ConnectionEntry
(
)
;
}
;
}
}
#
endif
