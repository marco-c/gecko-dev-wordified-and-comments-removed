#
ifndef
nsHttpConnectionInfo_h__
#
define
nsHttpConnectionInfo_h__
#
include
"
nsHttp
.
h
"
#
include
"
nsProxyInfo
.
h
"
#
include
"
nsCOMPtr
.
h
"
#
include
"
nsStringFwd
.
h
"
#
include
"
mozilla
/
Logging
.
h
"
#
include
"
mozilla
/
BasePrincipal
.
h
"
#
include
"
ARefBase
.
h
"
namespace
mozilla
{
namespace
net
{
extern
LazyLogModule
gHttpLog
;
class
nsHttpConnectionInfo
:
public
ARefBase
{
public
:
nsHttpConnectionInfo
(
const
nsACString
&
originHost
int32_t
originPort
const
nsACString
&
npnToken
const
nsACString
&
username
nsProxyInfo
*
proxyInfo
const
OriginAttributes
&
originAttributes
bool
endToEndSSL
=
false
)
;
nsHttpConnectionInfo
(
const
nsACString
&
originHost
int32_t
originPort
const
nsACString
&
npnToken
const
nsACString
&
username
nsProxyInfo
*
proxyInfo
const
OriginAttributes
&
originAttributes
const
nsACString
&
routedHost
int32_t
routedPort
)
;
private
:
virtual
~
nsHttpConnectionInfo
(
)
{
MOZ_LOG
(
gHttpLog
LogLevel
:
:
Debug
(
"
Destroying
nsHttpConnectionInfo
%
p
\
n
"
this
)
)
;
}
void
BuildHashKey
(
)
;
public
:
const
nsCString
&
HashKey
(
)
const
{
return
mHashKey
;
}
const
nsCString
&
GetOrigin
(
)
const
{
return
mOrigin
;
}
const
char
*
Origin
(
)
const
{
return
mOrigin
.
get
(
)
;
}
int32_t
OriginPort
(
)
const
{
return
mOriginPort
;
}
const
nsCString
&
GetRoutedHost
(
)
const
{
return
mRoutedHost
;
}
const
char
*
RoutedHost
(
)
const
{
return
mRoutedHost
.
get
(
)
;
}
int32_t
RoutedPort
(
)
const
{
return
mRoutedPort
;
}
void
SetNetworkInterfaceId
(
const
nsACString
&
aNetworkInterfaceId
)
;
nsHttpConnectionInfo
*
Clone
(
)
const
;
void
CloneAsDirectRoute
(
nsHttpConnectionInfo
*
*
outParam
)
;
MOZ_MUST_USE
nsresult
CreateWildCard
(
nsHttpConnectionInfo
*
*
outParam
)
;
const
char
*
ProxyHost
(
)
const
{
return
mProxyInfo
?
mProxyInfo
-
>
Host
(
)
.
get
(
)
:
nullptr
;
}
const
nsCString
&
GetProxyHost
(
)
const
{
return
mProxyInfo
?
mProxyInfo
-
>
Host
(
)
:
EmptyCString
(
)
;
}
int32_t
ProxyPort
(
)
const
{
return
mProxyInfo
?
mProxyInfo
-
>
Port
(
)
:
-
1
;
}
const
char
*
ProxyType
(
)
const
{
return
mProxyInfo
?
mProxyInfo
-
>
Type
(
)
:
nullptr
;
}
const
char
*
ProxyUsername
(
)
const
{
return
mProxyInfo
?
mProxyInfo
-
>
Username
(
)
.
get
(
)
:
nullptr
;
}
const
char
*
ProxyPassword
(
)
const
{
return
mProxyInfo
?
mProxyInfo
-
>
Password
(
)
.
get
(
)
:
nullptr
;
}
bool
Equals
(
const
nsHttpConnectionInfo
*
info
)
{
return
mHashKey
.
Equals
(
info
-
>
HashKey
(
)
)
;
}
const
char
*
Username
(
)
const
{
return
mUsername
.
get
(
)
;
}
nsProxyInfo
*
ProxyInfo
(
)
const
{
return
mProxyInfo
;
}
int32_t
DefaultPort
(
)
const
{
return
mEndToEndSSL
?
NS_HTTPS_DEFAULT_PORT
:
NS_HTTP_DEFAULT_PORT
;
}
void
SetAnonymous
(
bool
anon
)
{
mHashKey
.
SetCharAt
(
anon
?
'
A
'
:
'
.
'
2
)
;
}
bool
GetAnonymous
(
)
const
{
return
mHashKey
.
CharAt
(
2
)
=
=
'
A
'
;
}
void
SetPrivate
(
bool
priv
)
{
mHashKey
.
SetCharAt
(
priv
?
'
P
'
:
'
.
'
3
)
;
}
bool
GetPrivate
(
)
const
{
return
mHashKey
.
CharAt
(
3
)
=
=
'
P
'
;
}
void
SetInsecureScheme
(
bool
insecureScheme
)
{
mHashKey
.
SetCharAt
(
insecureScheme
?
'
I
'
:
'
.
'
4
)
;
}
bool
GetInsecureScheme
(
)
const
{
return
mHashKey
.
CharAt
(
4
)
=
=
'
I
'
;
}
void
SetNoSpdy
(
bool
aNoSpdy
)
{
mHashKey
.
SetCharAt
(
aNoSpdy
?
'
X
'
:
'
.
'
5
)
;
}
bool
GetNoSpdy
(
)
const
{
return
mHashKey
.
CharAt
(
5
)
=
=
'
X
'
;
}
void
SetBeConservative
(
bool
aBeConservative
)
{
mHashKey
.
SetCharAt
(
aBeConservative
?
'
C
'
:
'
.
'
6
)
;
}
bool
GetBeConservative
(
)
const
{
return
mHashKey
.
CharAt
(
6
)
=
=
'
C
'
;
}
void
SetTlsFlags
(
uint32_t
aTlsFlags
)
;
uint32_t
GetTlsFlags
(
)
const
{
return
mTlsFlags
;
}
const
nsCString
&
GetNetworkInterfaceId
(
)
const
{
return
mNetworkInterfaceId
;
}
const
nsCString
&
GetNPNToken
(
)
{
return
mNPNToken
;
}
const
nsCString
&
GetUsername
(
)
{
return
mUsername
;
}
const
OriginAttributes
&
GetOriginAttributes
(
)
{
return
mOriginAttributes
;
}
bool
UsingProxy
(
)
;
bool
UsingHttpProxy
(
)
const
{
return
mUsingHttpProxy
|
|
mUsingHttpsProxy
;
}
bool
UsingHttpsProxy
(
)
const
{
return
mUsingHttpsProxy
;
}
bool
EndToEndSSL
(
)
const
{
return
mEndToEndSSL
;
}
bool
FirstHopSSL
(
)
const
{
return
mEndToEndSSL
|
|
mUsingHttpsProxy
;
}
bool
UsingConnect
(
)
const
{
return
mUsingConnect
;
}
bool
HostIsLocalIPLiteral
(
)
const
;
private
:
void
Init
(
const
nsACString
&
host
int32_t
port
const
nsACString
&
npnToken
const
nsACString
&
username
nsProxyInfo
*
proxyInfo
const
OriginAttributes
&
originAttributes
bool
EndToEndSSL
)
;
void
SetOriginServer
(
const
nsACString
&
host
int32_t
port
)
;
nsCString
mOrigin
;
int32_t
mOriginPort
;
nsCString
mRoutedHost
;
int32_t
mRoutedPort
;
nsCString
mHashKey
;
nsCString
mNetworkInterfaceId
;
nsCString
mUsername
;
nsCOMPtr
<
nsProxyInfo
>
mProxyInfo
;
bool
mUsingHttpProxy
;
bool
mUsingHttpsProxy
;
bool
mEndToEndSSL
;
bool
mUsingConnect
;
nsCString
mNPNToken
;
OriginAttributes
mOriginAttributes
;
uint32_t
mTlsFlags
;
NS_INLINE_DECL_THREADSAFE_REFCOUNTING
(
nsHttpConnectionInfo
)
}
;
}
}
#
endif
