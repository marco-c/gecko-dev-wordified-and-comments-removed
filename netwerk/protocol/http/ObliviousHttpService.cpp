#
include
"
ObliviousHttpService
.
h
"
#
include
"
DNSUtils
.
h
"
#
include
"
ObliviousHttpChannel
.
h
"
namespace
mozilla
:
:
net
{
NS_IMPL_ISUPPORTS
(
ObliviousHttpService
nsIObliviousHttpService
)
NS_IMETHODIMP
ObliviousHttpService
:
:
NewChannel
(
nsIURI
*
relayURI
nsIURI
*
targetURI
const
nsTArray
<
uint8_t
>
&
encodedConfig
nsIChannel
*
*
result
)
{
nsCOMPtr
<
nsIChannel
>
innerChannel
;
nsresult
rv
=
DNSUtils
:
:
CreateChannelHelper
(
relayURI
getter_AddRefs
(
innerChannel
)
)
;
if
(
NS_FAILED
(
rv
)
)
{
return
rv
;
}
nsCOMPtr
<
nsIHttpChannel
>
innerHttpChannel
(
do_QueryInterface
(
innerChannel
)
)
;
if
(
!
innerHttpChannel
)
{
return
NS_ERROR_FAILURE
;
}
nsCOMPtr
<
nsIChannel
>
obliviousHttpChannel
(
new
ObliviousHttpChannel
(
targetURI
encodedConfig
innerHttpChannel
)
)
;
obliviousHttpChannel
.
forget
(
result
)
;
return
NS_OK
;
}
}
