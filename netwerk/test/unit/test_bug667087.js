"
use
strict
"
;
add_task
(
async
(
)
=
>
{
Services
.
prefs
.
setBoolPref
(
"
dom
.
security
.
https_first
"
false
)
;
var
expiry
=
(
Date
.
now
(
)
+
1000
)
*
1000
;
const
cv
=
Services
.
cookies
.
add
(
"
a
"
"
/
"
"
foo
"
"
bar
"
false
false
true
expiry
{
}
Ci
.
nsICookie
.
SAMESITE_UNSET
Ci
.
nsICookie
.
SCHEME_HTTP
)
;
Assert
.
equal
(
cv
.
result
Ci
.
nsICookieValidation
.
eOK
"
Valid
cookie
"
)
;
Assert
.
equal
(
Services
.
cookies
.
countCookiesFromHost
(
"
a
"
)
1
)
;
CookieXPCShellUtils
.
createServer
(
{
hosts
:
[
"
a
"
]
}
)
;
const
cookies
=
await
CookieXPCShellUtils
.
getCookieStringFromDocument
(
"
http
:
/
/
a
/
"
)
;
Assert
.
equal
(
cookies
"
foo
=
bar
"
)
;
Services
.
prefs
.
clearUserPref
(
"
dom
.
security
.
https_first
"
)
;
}
)
;
