"
use
strict
"
;
const
idnService
=
Cc
[
"
mozilla
.
org
/
network
/
idn
-
service
;
1
"
]
.
getService
(
Ci
.
nsIIDNService
)
;
add_task
(
async
function
test_simple
(
)
{
let
reference
=
[
[
"
asciihost
"
"
asciihost
"
false
]
[
"
b
\
u00FCcher
"
"
xn
-
-
bcher
-
kva
"
true
]
]
;
for
(
var
i
=
0
;
i
<
reference
.
length
;
+
+
i
)
{
dump
(
"
Testing
"
+
reference
[
i
]
+
"
\
n
"
)
;
Assert
.
equal
(
idnService
.
convertUTF8toACE
(
reference
[
i
]
[
0
]
)
reference
[
i
]
[
1
]
)
;
Assert
.
equal
(
idnService
.
convertUTF8toACE
(
reference
[
i
]
[
1
]
)
reference
[
i
]
[
1
]
)
;
Assert
.
equal
(
idnService
.
convertACEtoUTF8
(
reference
[
i
]
[
1
]
)
reference
[
i
]
[
0
]
)
;
Assert
.
equal
(
idnService
.
isACE
(
reference
[
i
]
[
1
]
)
reference
[
i
]
[
2
]
)
;
}
}
)
;
add_task
(
async
function
test_extra_blocked
(
)
{
equal
(
idnService
.
convertToDisplayIDN
(
"
xn
-
-
gou
-
2lb
.
ro
"
)
"
go
u
.
ro
"
)
;
Services
.
prefs
.
setStringPref
(
"
network
.
IDN
.
extra_blocked_chars
"
"
"
)
;
equal
(
idnService
.
convertToDisplayIDN
(
"
xn
-
-
gou
-
2lb
.
ro
"
)
"
xn
-
-
gou
-
2lb
.
ro
"
)
;
Services
.
prefs
.
clearUserPref
(
"
network
.
IDN
.
extra_blocked_chars
"
)
;
}
)
;
