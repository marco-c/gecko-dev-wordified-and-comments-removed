"
use
strict
"
;
var
Cc
=
Components
.
classes
;
var
Ci
=
Components
.
interfaces
;
const
StandardURL
=
Components
.
Constructor
(
"
mozilla
.
org
/
network
/
standard
-
url
;
1
"
"
nsIStandardURL
"
"
init
"
)
;
function
run_test
(
)
{
function
stringToURL
(
str
)
{
return
(
new
StandardURL
(
Ci
.
nsIStandardURL
.
URLTYPE_AUTHORITY
80
str
"
UTF
-
8
"
null
)
)
.
QueryInterface
(
Ci
.
nsIStandardURL
)
;
}
var
origUrlStr
=
"
http
:
/
/
foo
.
com
/
"
;
var
stdUrl
=
stringToURL
(
origUrlStr
)
;
var
stdUrlAsUri
=
stdUrl
.
QueryInterface
(
Ci
.
nsIURI
)
;
do_check_eq
(
-
1
stdUrlAsUri
.
port
)
;
stdUrl
.
setDefaultPort
(
100
)
;
do_check_eq
(
-
1
stdUrlAsUri
.
port
)
;
do_check_eq
(
stdUrlAsUri
.
spec
origUrlStr
)
;
stdUrlAsUri
.
port
=
"
200
"
;
do_check_eq
(
200
stdUrlAsUri
.
port
)
;
do_check_eq
(
stdUrlAsUri
.
spec
"
http
:
/
/
foo
.
com
:
200
/
"
)
;
stdUrl
.
setDefaultPort
(
200
)
;
do_check_eq
(
-
1
stdUrlAsUri
.
port
)
;
do_check_eq
(
stdUrlAsUri
.
spec
origUrlStr
)
;
stdUrl
.
setDefaultPort
(
300
)
;
do_check_eq
(
-
1
stdUrlAsUri
.
port
)
;
do_check_eq
(
stdUrlAsUri
.
spec
origUrlStr
)
;
}
