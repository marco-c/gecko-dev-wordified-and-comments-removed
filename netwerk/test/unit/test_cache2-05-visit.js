"
use
strict
"
;
function
run_test
(
)
{
do_get_profile
(
)
;
var
storage
=
getCacheStorage
(
"
disk
"
)
;
var
mc
=
new
MultipleCallbacks
(
4
function
(
)
{
executeSoon
(
function
(
)
{
syncWithCacheIOThread
(
function
(
)
{
var
expectedConsumption
=
4096
;
storage
.
asyncVisitStorage
(
new
VisitCallback
(
4
expectedConsumption
[
"
http
:
/
/
a
/
"
"
http
:
/
/
b
/
"
"
http
:
/
/
c
/
"
"
http
:
/
/
d
/
"
]
function
(
)
{
storage
.
asyncVisitStorage
(
new
VisitCallback
(
4
expectedConsumption
null
function
(
)
{
finish_cache2_test
(
)
;
}
)
false
)
;
}
)
true
)
;
}
)
;
}
)
;
}
)
;
asyncOpenCacheEntry
(
"
http
:
/
/
a
/
"
"
disk
"
Ci
.
nsICacheStorage
.
OPEN_NORMALLY
null
new
OpenCallback
(
NEW
"
a1m
"
"
a1d
"
function
(
)
{
asyncOpenCacheEntry
(
"
http
:
/
/
a
/
"
"
disk
"
Ci
.
nsICacheStorage
.
OPEN_NORMALLY
null
new
OpenCallback
(
NORMAL
"
a1m
"
"
a1d
"
function
(
)
{
mc
.
fired
(
)
;
}
)
)
;
}
)
)
;
asyncOpenCacheEntry
(
"
http
:
/
/
b
/
"
"
disk
"
Ci
.
nsICacheStorage
.
OPEN_NORMALLY
null
new
OpenCallback
(
NEW
"
b1m
"
"
b1d
"
function
(
)
{
asyncOpenCacheEntry
(
"
http
:
/
/
b
/
"
"
disk
"
Ci
.
nsICacheStorage
.
OPEN_NORMALLY
null
new
OpenCallback
(
NORMAL
"
b1m
"
"
b1d
"
function
(
)
{
mc
.
fired
(
)
;
}
)
)
;
}
)
)
;
asyncOpenCacheEntry
(
"
http
:
/
/
c
/
"
"
disk
"
Ci
.
nsICacheStorage
.
OPEN_NORMALLY
null
new
OpenCallback
(
NEW
"
c1m
"
"
c1d
"
function
(
)
{
asyncOpenCacheEntry
(
"
http
:
/
/
c
/
"
"
disk
"
Ci
.
nsICacheStorage
.
OPEN_NORMALLY
null
new
OpenCallback
(
NORMAL
"
c1m
"
"
c1d
"
function
(
)
{
mc
.
fired
(
)
;
}
)
)
;
}
)
)
;
asyncOpenCacheEntry
(
"
http
:
/
/
d
/
"
"
disk
"
Ci
.
nsICacheStorage
.
OPEN_NORMALLY
null
new
OpenCallback
(
NEW
"
d1m
"
"
d1d
"
function
(
)
{
asyncOpenCacheEntry
(
"
http
:
/
/
d
/
"
"
disk
"
Ci
.
nsICacheStorage
.
OPEN_NORMALLY
null
new
OpenCallback
(
NORMAL
"
d1m
"
"
d1d
"
function
(
)
{
mc
.
fired
(
)
;
}
)
)
;
}
)
)
;
do_test_pending
(
)
;
}
