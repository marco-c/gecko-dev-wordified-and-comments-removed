load
(
"
.
.
/
unit
/
test_http3_prio_helpers
.
js
"
)
;
if
(
!
inChildProcess
(
)
)
{
registerCleanupFunction
(
async
(
)
=
>
{
Services
.
prefs
.
clearUserPref
(
"
network
.
http
.
http3
.
priority
"
)
;
Services
.
prefs
.
clearUserPref
(
"
network
.
http
.
priority_header
.
enabled
"
)
;
http3_clear_prefs
(
)
;
}
)
;
}
add_task
(
async
function
setup
(
)
{
if
(
!
inChildProcess
(
)
)
{
await
http3_setup_tests
(
"
h3
-
29
"
)
;
}
}
)
;
async
function
test_http3_prio_disabled
(
incremental
)
{
await
test_flag_priority
(
"
disabled
(
none
)
"
null
null
null
null
)
;
await
test_flag_priority
(
"
disabled
(
urgent_start
)
"
Ci
.
nsIClassOfService
.
UrgentStart
null
incremental
null
)
;
await
test_flag_priority
(
"
disabled
(
leader
)
"
Ci
.
nsIClassOfService
.
Leader
null
incremental
null
)
;
await
test_flag_priority
(
"
disabled
(
unblocked
)
"
Ci
.
nsIClassOfService
.
Unblocked
null
incremental
null
)
;
await
test_flag_priority
(
"
disabled
(
follower
)
"
Ci
.
nsIClassOfService
.
Follower
null
incremental
null
)
;
await
test_flag_priority
(
"
disabled
(
speculative
)
"
Ci
.
nsIClassOfService
.
Speculative
null
incremental
null
)
;
await
test_flag_priority
(
"
disabled
(
background
)
"
Ci
.
nsIClassOfService
.
Background
null
incremental
null
)
;
await
test_flag_priority
(
"
disabled
(
tail
)
"
Ci
.
nsIClassOfService
.
Tail
null
incremental
null
)
;
}
add_task
(
async
function
test_http3_prio_disabled_inc_true
(
)
{
if
(
!
inChildProcess
(
)
)
{
Services
.
prefs
.
setBoolPref
(
"
network
.
http
.
http3
.
priority
"
false
)
;
Services
.
prefs
.
setBoolPref
(
"
network
.
http
.
priority_header
.
enabled
"
false
)
;
}
await
test_http3_prio_disabled
(
true
)
;
}
)
;
add_task
(
async
function
test_http3_prio_disabled_inc_false
(
)
{
if
(
!
inChildProcess
(
)
)
{
Services
.
prefs
.
setBoolPref
(
"
network
.
http
.
http3
.
priority
"
false
)
;
Services
.
prefs
.
setBoolPref
(
"
network
.
http
.
priority_header
.
enabled
"
false
)
;
}
await
test_http3_prio_disabled
(
false
)
;
}
)
;
