"
use
strict
"
;
Services
.
prefs
.
setBoolPref
(
"
network
.
early
-
hints
.
enabled
"
true
)
;
Services
.
prefs
.
setBoolPref
(
"
security
.
mixed_content
.
upgrade_display_content
"
false
)
;
const
{
request_count_checking
test_hint_preload_internal
test_hint_preload
}
=
ChromeUtils
.
import
(
"
resource
:
/
/
testing
-
common
/
early_hint_preload_test_helper
.
jsm
"
)
;
add_task
(
async
function
test_103_preload_disabled
(
)
{
Services
.
prefs
.
setBoolPref
(
"
network
.
early
-
hints
.
enabled
"
false
)
;
await
test_hint_preload
(
"
test_103_preload_disabled
"
"
https
:
/
/
example
.
com
"
"
https
:
/
/
example
.
com
/
browser
/
netwerk
/
test
/
browser
/
early_hint_pixel
.
sjs
"
{
hinted
:
0
normal
:
1
}
)
;
Services
.
prefs
.
setBoolPref
(
"
network
.
early
-
hints
.
enabled
"
true
)
;
}
)
;
add_task
(
async
function
test_103_preload_disabled
(
)
{
Services
.
prefs
.
setBoolPref
(
"
network
.
preload
"
false
)
;
await
test_hint_preload
(
"
test_103_preload_disabled
"
"
https
:
/
/
example
.
com
"
"
https
:
/
/
example
.
com
/
browser
/
netwerk
/
test
/
browser
/
early_hint_pixel
.
sjs
"
{
hinted
:
0
normal
:
1
}
)
;
Services
.
prefs
.
clearUserPref
(
"
network
.
preload
"
)
;
}
)
;
add_task
(
async
function
test_103_preload_https
(
)
{
await
test_hint_preload
(
"
test_103_preload_https
"
"
https
:
/
/
example
.
org
"
"
/
browser
/
netwerk
/
test
/
browser
/
early_hint_pixel
.
sjs
"
{
hinted
:
1
normal
:
0
}
)
;
}
)
;
add_task
(
async
function
test_103_preload
(
)
{
await
test_hint_preload
(
"
test_103_preload
"
"
https
:
/
/
example
.
com
"
"
https
:
/
/
example
.
com
/
browser
/
netwerk
/
test
/
browser
/
early_hint_pixel
.
sjs
"
{
hinted
:
1
normal
:
0
}
)
;
}
)
;
add_task
(
async
function
test_103_preload_cor
(
)
{
await
test_hint_preload
(
"
test_103_preload_cor
"
"
https
:
/
/
example
.
com
"
"
https
:
/
/
example
.
net
/
browser
/
netwerk
/
test
/
browser
/
early_hint_pixel
.
sjs
"
{
hinted
:
1
normal
:
0
}
)
;
}
)
;
add_task
(
async
function
test_103_preload_insecure_cor
(
)
{
await
test_hint_preload
(
"
test_103_preload_insecure_cor
"
"
https
:
/
/
example
.
com
"
"
http
:
/
/
mochi
.
test
:
8888
/
browser
/
netwerk
/
test
/
browser
/
early_hint_pixel
.
sjs
"
{
hinted
:
0
normal
:
1
}
)
;
}
)
;
add_task
(
async
function
test_103_relative_preload
(
)
{
await
test_hint_preload
(
"
test_103_relative_preload
"
"
https
:
/
/
example
.
com
"
"
/
browser
/
netwerk
/
test
/
browser
/
early_hint_pixel
.
sjs
"
{
hinted
:
1
normal
:
0
}
)
;
}
)
;
add_task
(
async
function
test_103_insecure_preload
(
)
{
await
test_hint_preload
(
"
test_103_insecure_preload
"
"
http
:
/
/
mochi
.
test
:
8888
"
"
/
browser
/
netwerk
/
test
/
browser
/
early_hint_pixel
.
sjs
"
{
hinted
:
0
normal
:
1
}
)
;
}
)
;
add_task
(
async
function
test_103_preload_mixed_content
(
)
{
await
test_hint_preload
(
"
test_103_preload_mixed_content
"
"
https
:
/
/
example
.
org
"
"
http
:
/
/
example
.
org
/
browser
/
netwerk
/
test
/
browser
/
early_hint_pixel
.
sjs
"
{
hinted
:
0
normal
:
1
}
)
;
}
)
;
add_task
(
async
function
test_103_preload_only_file
(
)
{
await
test_hint_preload
(
"
test_103_preload_only_file
"
"
https
:
/
/
example
.
com
"
"
early_hint_pixel
.
sjs
"
{
hinted
:
1
normal
:
0
}
)
;
}
)
;
