#
ifndef
NSNOTIFYADDRLISTENER_H_
#
define
NSNOTIFYADDRLISTENER_H_
#
include
<
windows
.
h
>
#
include
<
winsock2
.
h
>
#
include
<
iptypes
.
h
>
#
include
"
nsINetworkLinkService
.
h
"
#
include
"
nsIRunnable
.
h
"
#
include
"
nsIObserver
.
h
"
#
include
"
nsString
.
h
"
#
include
"
nsTArray
.
h
"
#
include
"
nsThreadUtils
.
h
"
#
include
"
nsThreadPool
.
h
"
#
include
"
nsCOMPtr
.
h
"
#
include
"
mozilla
/
Atomics
.
h
"
#
include
"
mozilla
/
TimeStamp
.
h
"
#
include
"
mozilla
/
Mutex
.
h
"
#
include
"
mozilla
/
SHA1
.
h
"
#
include
"
mozilla
/
net
/
DNS
.
h
"
class
nsIThreadPool
;
class
nsNotifyAddrListener
:
public
nsINetworkLinkService
public
nsIRunnable
public
nsIObserver
{
virtual
~
nsNotifyAddrListener
(
)
;
public
:
NS_DECL_THREADSAFE_ISUPPORTS
NS_DECL_NSINETWORKLINKSERVICE
NS_DECL_NSIRUNNABLE
NS_DECL_NSIOBSERVER
nsNotifyAddrListener
(
)
;
nsresult
Init
(
void
)
;
void
CheckLinkStatus
(
void
)
;
static
void
HashSortedNetworkIds
(
const
std
:
:
vector
<
GUID
>
nwGUIDS
mozilla
:
:
SHA1Sum
&
sha1
)
;
protected
:
bool
mLinkUp
;
bool
mStatusKnown
;
bool
mCheckAttempted
;
nsresult
Shutdown
(
void
)
;
nsresult
NotifyObservers
(
const
char
*
aTopic
const
char
*
aData
)
;
DWORD
CheckAdaptersAddresses
(
void
)
;
nsCOMPtr
<
nsIThreadPool
>
mThread
;
private
:
DWORD
nextCoalesceWaitTime
(
)
;
nsresult
NetworkChanged
(
)
;
void
calculateNetworkId
(
void
)
;
bool
findMac
(
char
*
gateway
)
;
mozilla
:
:
Mutex
mMutex
;
nsCString
mNetworkId
;
nsTArray
<
nsCString
>
mDnsSuffixList
;
nsTArray
<
mozilla
:
:
net
:
:
NetAddr
>
mDNSResolvers
;
HANDLE
mCheckEvent
;
mozilla
:
:
Atomic
<
bool
>
mShutdown
;
mozilla
:
:
Atomic
<
uint32_t
mozilla
:
:
Relaxed
>
mPlatformDNSIndications
;
ULONG
mIPInterfaceChecksum
;
mozilla
:
:
TimeStamp
mStartTime
;
bool
mCoalescingActive
;
mozilla
:
:
TimeStamp
mChangeTime
;
}
;
#
endif
