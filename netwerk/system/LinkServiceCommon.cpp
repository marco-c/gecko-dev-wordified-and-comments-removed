#
include
"
LinkServiceCommon
.
h
"
#
include
"
mozilla
/
Maybe
.
h
"
#
include
"
mozilla
/
SHA1
.
h
"
#
include
"
mozilla
/
TimeStamp
.
h
"
#
include
"
nsID
.
h
"
using
namespace
mozilla
;
void
SeedNetworkId
(
SHA1Sum
&
aSha1
)
{
static
Maybe
<
nsID
>
seed
=
(
[
]
(
)
{
Maybe
<
nsID
>
uuid
(
std
:
:
in_place
)
;
if
(
NS_FAILED
(
nsID
:
:
GenerateUUIDInPlace
(
*
uuid
)
)
)
{
uuid
.
reset
(
)
;
}
return
uuid
;
}
)
(
)
;
if
(
seed
)
{
aSha1
.
update
(
seed
.
ptr
(
)
sizeof
(
*
seed
)
)
;
}
else
{
TimeStamp
timestamp
=
TimeStamp
:
:
ProcessCreation
(
)
;
aSha1
.
update
(
&
timestamp
sizeof
(
timestamp
)
)
;
}
}
