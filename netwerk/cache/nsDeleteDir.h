#
ifndef
nsDeleteDir_h__
#
define
nsDeleteDir_h__
#
include
"
nsCOMPtr
.
h
"
#
include
"
nsCOMArray
.
h
"
#
include
"
mozilla
/
Mutex
.
h
"
#
include
"
mozilla
/
CondVar
.
h
"
class
nsIFile
;
class
nsISerialEventTarget
;
class
nsITimer
;
class
nsDeleteDir
{
public
:
nsDeleteDir
(
)
;
~
nsDeleteDir
(
)
;
static
nsresult
Init
(
)
;
static
nsresult
Shutdown
(
bool
finishDeleting
)
;
static
nsresult
DeleteDir
(
nsIFile
*
dir
bool
moveToTrash
uint32_t
delay
=
0
)
;
static
nsresult
GetTrashDir
(
nsIFile
*
target
nsCOMPtr
<
nsIFile
>
*
result
)
;
static
nsresult
RemoveOldTrashes
(
nsIFile
*
cacheDir
)
;
static
void
TimerCallback
(
nsITimer
*
aTimer
void
*
arg
)
;
private
:
friend
class
nsBlockOnBackgroundThreadEvent
;
friend
class
nsDestroyThreadEvent
;
nsresult
InitThread
(
)
;
void
DestroyThread
(
)
;
nsresult
PostTimer
(
void
*
arg
uint32_t
delay
)
;
nsresult
RemoveDir
(
nsIFile
*
file
bool
*
stopDeleting
)
;
static
nsDeleteDir
*
gInstance
;
mozilla
:
:
Mutex
mLock
;
mozilla
:
:
CondVar
mCondVar
;
bool
mNotified
{
false
}
;
nsCOMArray
<
nsITimer
>
mTimers
;
nsCOMPtr
<
nsISerialEventTarget
>
mBackgroundET
;
bool
mShutdownPending
{
false
}
;
bool
mStopDeleting
{
false
}
;
}
;
#
endif
