"
use
strict
"
;
var
EXPORTED_SYMBOLS
=
[
"
CookieXPCShellUtils
"
]
;
const
{
ExtensionTestUtils
}
=
ChromeUtils
.
import
(
"
resource
:
/
/
testing
-
common
/
ExtensionXPCShellUtils
.
jsm
"
)
;
const
{
AddonTestUtils
}
=
ChromeUtils
.
import
(
"
resource
:
/
/
testing
-
common
/
AddonTestUtils
.
jsm
"
)
;
const
CookieXPCShellUtils
=
{
init
(
scope
)
{
AddonTestUtils
.
maybeInit
(
scope
)
;
ExtensionTestUtils
.
init
(
scope
)
;
}
createServer
(
args
)
{
const
server
=
AddonTestUtils
.
createHttpServer
(
args
)
;
server
.
registerPathHandler
(
"
/
"
(
metadata
response
)
=
>
{
response
.
setStatusLine
(
metadata
.
httpVersion
200
"
OK
"
)
;
response
.
setHeader
(
"
Content
-
Type
"
"
text
/
html
"
false
)
;
let
body
=
"
<
body
>
<
h1
>
Hello
world
!
<
/
h1
>
<
/
body
>
"
;
response
.
bodyOutputStream
.
write
(
body
body
.
length
)
;
}
)
;
return
server
;
}
async
loadContentPage
(
uri
options
=
{
}
)
{
return
ExtensionTestUtils
.
loadContentPage
(
uri
options
)
;
}
async
getCookieStringFromDocument
(
uri
options
=
{
}
)
{
const
contentPage
=
await
this
.
loadContentPage
(
uri
options
)
;
const
cookies
=
await
contentPage
.
spawn
(
null
(
)
=
>
content
.
document
.
cookie
)
;
await
contentPage
.
close
(
)
;
return
cookies
;
}
async
setCookieToDocument
(
uri
set
options
=
{
}
)
{
const
contentPage
=
await
this
.
loadContentPage
(
uri
options
)
;
await
contentPage
.
spawn
(
set
cookies
=
>
(
content
.
document
.
cookie
=
cookies
)
)
;
await
contentPage
.
close
(
)
;
}
}
;
