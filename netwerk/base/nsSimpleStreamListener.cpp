#
include
"
nsSimpleStreamListener
.
h
"
namespace
mozilla
{
namespace
net
{
NS_IMPL_ISUPPORTS
(
nsSimpleStreamListener
nsISimpleStreamListener
nsIStreamListener
nsIRequestObserver
)
NS_IMETHODIMP
nsSimpleStreamListener
:
:
OnStartRequest
(
nsIRequest
*
aRequest
)
{
return
mObserver
?
mObserver
-
>
OnStartRequest
(
aRequest
)
:
NS_OK
;
}
NS_IMETHODIMP
nsSimpleStreamListener
:
:
OnStopRequest
(
nsIRequest
*
request
nsISupports
*
aContext
nsresult
aStatus
)
{
return
mObserver
?
mObserver
-
>
OnStopRequest
(
request
aContext
aStatus
)
:
NS_OK
;
}
NS_IMETHODIMP
nsSimpleStreamListener
:
:
OnDataAvailable
(
nsIRequest
*
request
nsISupports
*
aContext
nsIInputStream
*
aSource
uint64_t
aOffset
uint32_t
aCount
)
{
uint32_t
writeCount
;
nsresult
rv
=
mSink
-
>
WriteFrom
(
aSource
aCount
&
writeCount
)
;
if
(
NS_SUCCEEDED
(
rv
)
&
&
(
writeCount
=
=
0
)
)
return
NS_BASE_STREAM_CLOSED
;
return
rv
;
}
NS_IMETHODIMP
nsSimpleStreamListener
:
:
Init
(
nsIOutputStream
*
aSink
nsIRequestObserver
*
aObserver
)
{
MOZ_ASSERT
(
aSink
"
null
output
stream
"
)
;
mSink
=
aSink
;
mObserver
=
aObserver
;
return
NS_OK
;
}
}
}
