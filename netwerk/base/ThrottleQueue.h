#
ifndef
mozilla_net_ThrottleQueue_h
#
define
mozilla_net_ThrottleQueue_h
#
include
"
mozilla
/
TimeStamp
.
h
"
#
include
"
nsINamed
.
h
"
#
include
"
nsIThrottledInputChannel
.
h
"
#
include
"
nsITimer
.
h
"
namespace
mozilla
{
namespace
net
{
class
ThrottleInputStream
;
class
ThrottleQueue
:
public
nsIInputChannelThrottleQueue
public
nsITimerCallback
public
nsINamed
{
public
:
static
already_AddRefed
<
nsIInputChannelThrottleQueue
>
Create
(
)
;
NS_DECL_THREADSAFE_ISUPPORTS
NS_DECL_NSIINPUTCHANNELTHROTTLEQUEUE
NS_DECL_NSITIMERCALLBACK
NS_DECL_NSINAMED
void
QueueStream
(
ThrottleInputStream
*
aStream
)
;
void
DequeueStream
(
ThrottleInputStream
*
aStream
)
;
protected
:
ThrottleQueue
(
)
;
virtual
~
ThrottleQueue
(
)
;
struct
ThrottleEntry
{
TimeStamp
mTime
;
uint32_t
mBytesRead
=
0
;
}
;
nsTArray
<
ThrottleEntry
>
mReadEvents
;
uint32_t
mMeanBytesPerSecond
;
uint32_t
mMaxBytesPerSecond
;
uint64_t
mBytesProcessed
;
nsTArray
<
RefPtr
<
ThrottleInputStream
>
>
mAsyncEvents
;
nsCOMPtr
<
nsITimer
>
mTimer
;
bool
mTimerArmed
;
}
;
}
}
#
endif
