#
ifndef
mozilla_LoadInfo_h
#
define
mozilla_LoadInfo_h
#
include
"
nsIContentSecurityPolicy
.
h
"
#
include
"
nsILoadInfo
.
h
"
#
include
"
nsIPrincipal
.
h
"
#
include
"
nsIWeakReferenceUtils
.
h
"
#
include
"
nsIURI
.
h
"
#
include
"
nsContentUtils
.
h
"
#
include
"
nsString
.
h
"
#
include
"
nsTArray
.
h
"
#
include
"
mozilla
/
BasePrincipal
.
h
"
#
include
"
mozilla
/
dom
/
ClientInfo
.
h
"
#
include
"
mozilla
/
dom
/
ServiceWorkerDescriptor
.
h
"
class
nsICookieSettings
;
class
nsINode
;
class
nsPIDOMWindowOuter
;
namespace
mozilla
{
namespace
dom
{
class
PerformanceStorage
;
class
XMLHttpRequestMainThread
;
}
namespace
net
{
class
LoadInfoArgs
;
class
LoadInfo
;
}
namespace
ipc
{
nsresult
LoadInfoArgsToLoadInfo
(
const
Maybe
<
mozilla
:
:
net
:
:
LoadInfoArgs
>
&
aLoadInfoArgs
nsINode
*
aLoadingContext
nsINode
*
aCspToInheritLoadingContext
net
:
:
LoadInfo
*
*
outLoadInfo
)
;
}
namespace
net
{
typedef
nsTArray
<
nsCOMPtr
<
nsIRedirectHistoryEntry
>
>
RedirectHistoryArray
;
class
LoadInfo
final
:
public
nsILoadInfo
{
public
:
NS_DECL_ISUPPORTS
NS_DECL_NSILOADINFO
LoadInfo
(
nsIPrincipal
*
aLoadingPrincipal
nsIPrincipal
*
aTriggeringPrincipal
nsINode
*
aLoadingContext
nsSecurityFlags
aSecurityFlags
nsContentPolicyType
aContentPolicyType
const
Maybe
<
mozilla
:
:
dom
:
:
ClientInfo
>
&
aLoadingClientInfo
=
Maybe
<
mozilla
:
:
dom
:
:
ClientInfo
>
(
)
const
Maybe
<
mozilla
:
:
dom
:
:
ServiceWorkerDescriptor
>
&
aController
=
Maybe
<
mozilla
:
:
dom
:
:
ServiceWorkerDescriptor
>
(
)
uint32_t
aSandboxFlags
=
0
)
;
LoadInfo
(
nsPIDOMWindowOuter
*
aOuterWindow
nsIPrincipal
*
aTriggeringPrincipal
nsISupports
*
aContextForTopLevelLoad
nsSecurityFlags
aSecurityFlags
uint32_t
aSandboxFlags
)
;
already_AddRefed
<
nsILoadInfo
>
Clone
(
)
const
;
already_AddRefed
<
nsILoadInfo
>
CloneWithNewSecFlags
(
nsSecurityFlags
aSecurityFlags
)
const
;
already_AddRefed
<
nsILoadInfo
>
CloneForNewRequest
(
)
const
;
void
SetIsPreflight
(
)
;
void
SetUpgradeInsecureRequests
(
)
;
void
SetBrowserUpgradeInsecureRequests
(
)
;
void
SetBrowserWouldUpgradeInsecureRequests
(
)
;
void
SetIsFromProcessingFrameAttributes
(
)
;
void
SetCSPToInherit
(
nsIContentSecurityPolicy
*
aCspToInherit
)
{
mCspToInherit
=
aCspToInherit
;
}
private
:
LoadInfo
(
nsIPrincipal
*
aLoadingPrincipal
nsIPrincipal
*
aTriggeringPrincipal
nsIPrincipal
*
aPrincipalToInherit
nsIPrincipal
*
aSandboxedLoadingPrincipal
nsIPrincipal
*
aTopLevelPrincipal
nsIPrincipal
*
aTopLevelStorageAreaPrincipal
nsIURI
*
aResultPrincipalURI
nsICookieSettings
*
aCookieSettings
nsIContentSecurityPolicy
*
aCspToInherit
const
Maybe
<
mozilla
:
:
dom
:
:
ClientInfo
>
&
aClientInfo
const
Maybe
<
mozilla
:
:
dom
:
:
ClientInfo
>
&
aReservedClientInfo
const
Maybe
<
mozilla
:
:
dom
:
:
ClientInfo
>
&
aInitialClientInfo
const
Maybe
<
mozilla
:
:
dom
:
:
ServiceWorkerDescriptor
>
&
aController
nsSecurityFlags
aSecurityFlags
uint32_t
aSandboxFlags
nsContentPolicyType
aContentPolicyType
LoadTainting
aTainting
bool
aBlockAllMixedContent
bool
aUpgradeInsecureRequests
bool
aBrowserUpgradeInsecureRequests
bool
aBrowserWouldUpgradeInsecureRequests
bool
aForceAllowDataURI
bool
aAllowInsecureRedirectToDataURI
bool
aBypassCORSChecks
bool
aSkipContentPolicyCheckForWebRequest
bool
aForceInheritPrincipalDropped
uint64_t
aInnerWindowID
uint64_t
aOuterWindowID
uint64_t
aParentOuterWindowID
uint64_t
aTopOuterWindowID
uint64_t
aFrameOuterWindowID
uint64_t
aBrowsingContextID
uint64_t
aFrameBrowsingContextID
bool
aInitialSecurityCheckDone
bool
aIsThirdPartyRequest
bool
aIsDocshellReload
bool
aIsFormSubmission
bool
aSendCSPViolationEvents
const
OriginAttributes
&
aOriginAttributes
RedirectHistoryArray
&
aRedirectChainIncludingInternalRedirects
RedirectHistoryArray
&
aRedirectChain
nsTArray
<
nsCOMPtr
<
nsIPrincipal
>
>
&
&
aAncestorPrincipals
const
nsTArray
<
uint64_t
>
&
aAncestorOuterWindowIDs
const
nsTArray
<
nsCString
>
&
aUnsafeHeaders
bool
aForcePreflight
bool
aIsPreflight
bool
aLoadTriggeredFromExternal
bool
aServiceWorkerTaintingSynthesized
bool
aDocumentHasUserInteracted
bool
aDocumentHasLoaded
bool
aAllowListFutureDocumentsCreatedFromThisRedirectChain
const
nsAString
&
aCspNonce
bool
aSkipContentSniffing
uint32_t
aRequestBlockingReason
nsINode
*
aLoadingContext
)
;
LoadInfo
(
const
LoadInfo
&
rhs
)
;
NS_IMETHOD
GetRedirects
(
JSContext
*
aCx
JS
:
:
MutableHandle
<
JS
:
:
Value
>
aRedirects
const
RedirectHistoryArray
&
aArra
)
;
friend
nsresult
mozilla
:
:
ipc
:
:
LoadInfoArgsToLoadInfo
(
const
Maybe
<
mozilla
:
:
net
:
:
LoadInfoArgs
>
&
aLoadInfoArgs
nsINode
*
aLoadingContext
nsINode
*
aCspToInheritLoadingContext
net
:
:
LoadInfo
*
*
outLoadInfo
)
;
~
LoadInfo
(
)
=
default
;
void
ComputeIsThirdPartyContext
(
nsPIDOMWindowOuter
*
aOuterWindow
)
;
void
SetIncludeCookiesSecFlag
(
)
;
friend
class
mozilla
:
:
dom
:
:
XMLHttpRequestMainThread
;
friend
class
:
:
nsDocShell
;
void
UpdateBrowsingContextID
(
uint64_t
aBrowsingContextID
)
{
mBrowsingContextID
=
aBrowsingContextID
;
}
void
UpdateFrameBrowsingContextID
(
uint64_t
aFrameBrowsingContextID
)
{
mFrameBrowsingContextID
=
aFrameBrowsingContextID
;
}
nsCOMPtr
<
nsIPrincipal
>
mLoadingPrincipal
;
nsCOMPtr
<
nsIPrincipal
>
mTriggeringPrincipal
;
nsCOMPtr
<
nsIPrincipal
>
mPrincipalToInherit
;
nsCOMPtr
<
nsIPrincipal
>
mSandboxedLoadingPrincipal
;
nsCOMPtr
<
nsIPrincipal
>
mTopLevelPrincipal
;
nsCOMPtr
<
nsIPrincipal
>
mTopLevelStorageAreaPrincipal
;
nsCOMPtr
<
nsIURI
>
mResultPrincipalURI
;
nsCOMPtr
<
nsICSPEventListener
>
mCSPEventListener
;
nsCOMPtr
<
nsICookieSettings
>
mCookieSettings
;
nsCOMPtr
<
nsIContentSecurityPolicy
>
mCspToInherit
;
Maybe
<
mozilla
:
:
dom
:
:
ClientInfo
>
mClientInfo
;
UniquePtr
<
mozilla
:
:
dom
:
:
ClientSource
>
mReservedClientSource
;
Maybe
<
mozilla
:
:
dom
:
:
ClientInfo
>
mReservedClientInfo
;
Maybe
<
mozilla
:
:
dom
:
:
ClientInfo
>
mInitialClientInfo
;
Maybe
<
mozilla
:
:
dom
:
:
ServiceWorkerDescriptor
>
mController
;
RefPtr
<
mozilla
:
:
dom
:
:
PerformanceStorage
>
mPerformanceStorage
;
nsWeakPtr
mLoadingContext
;
nsWeakPtr
mContextForTopLevelLoad
;
nsSecurityFlags
mSecurityFlags
;
uint32_t
mSandboxFlags
;
nsContentPolicyType
mInternalContentPolicyType
;
LoadTainting
mTainting
;
bool
mBlockAllMixedContent
;
bool
mUpgradeInsecureRequests
;
bool
mBrowserUpgradeInsecureRequests
;
bool
mBrowserWouldUpgradeInsecureRequests
;
bool
mForceAllowDataURI
;
bool
mAllowInsecureRedirectToDataURI
;
bool
mBypassCORSChecks
;
bool
mSkipContentPolicyCheckForWebRequest
;
bool
mOriginalFrameSrcLoad
;
bool
mForceInheritPrincipalDropped
;
uint64_t
mInnerWindowID
;
uint64_t
mOuterWindowID
;
uint64_t
mParentOuterWindowID
;
uint64_t
mTopOuterWindowID
;
uint64_t
mFrameOuterWindowID
;
uint64_t
mBrowsingContextID
;
uint64_t
mFrameBrowsingContextID
;
bool
mInitialSecurityCheckDone
;
bool
mIsThirdPartyContext
;
bool
mIsDocshellReload
;
bool
mIsFormSubmission
;
bool
mSendCSPViolationEvents
;
OriginAttributes
mOriginAttributes
;
RedirectHistoryArray
mRedirectChainIncludingInternalRedirects
;
RedirectHistoryArray
mRedirectChain
;
nsTArray
<
nsCOMPtr
<
nsIPrincipal
>
>
mAncestorPrincipals
;
nsTArray
<
uint64_t
>
mAncestorOuterWindowIDs
;
nsTArray
<
nsCString
>
mCorsUnsafeHeaders
;
uint32_t
mRequestBlockingReason
;
bool
mForcePreflight
;
bool
mIsPreflight
;
bool
mLoadTriggeredFromExternal
;
bool
mServiceWorkerTaintingSynthesized
;
bool
mDocumentHasUserInteracted
;
bool
mDocumentHasLoaded
;
bool
mAllowListFutureDocumentsCreatedFromThisRedirectChain
;
nsString
mCspNonce
;
bool
mSkipContentSniffing
;
bool
mIsFromProcessingFrameAttributes
;
}
;
}
}
#
endif
