#
ifndef
mozilla_LoadInfo_h
#
define
mozilla_LoadInfo_h
#
include
"
nsIContentPolicy
.
h
"
#
include
"
nsILoadInfo
.
h
"
#
include
"
nsIPrincipal
.
h
"
#
include
"
nsIWeakReferenceUtils
.
h
"
#
include
"
nsIURI
.
h
"
#
include
"
nsTArray
.
h
"
#
include
"
mozilla
/
BasePrincipal
.
h
"
class
nsINode
;
class
nsPIDOMWindowOuter
;
namespace
mozilla
{
namespace
dom
{
class
XMLHttpRequestMainThread
;
}
namespace
net
{
class
OptionalLoadInfoArgs
;
}
namespace
ipc
{
nsresult
LoadInfoArgsToLoadInfo
(
const
mozilla
:
:
net
:
:
OptionalLoadInfoArgs
&
aLoadInfoArgs
nsILoadInfo
*
*
outLoadInfo
)
;
}
namespace
net
{
typedef
nsTArray
<
nsCOMPtr
<
nsIRedirectHistoryEntry
>
>
RedirectHistoryArray
;
class
LoadInfo
final
:
public
nsILoadInfo
{
public
:
NS_DECL_ISUPPORTS
NS_DECL_NSILOADINFO
LoadInfo
(
nsIPrincipal
*
aLoadingPrincipal
nsIPrincipal
*
aTriggeringPrincipal
nsINode
*
aLoadingContext
nsSecurityFlags
aSecurityFlags
nsContentPolicyType
aContentPolicyType
)
;
LoadInfo
(
nsPIDOMWindowOuter
*
aOuterWindow
nsIPrincipal
*
aTriggeringPrincipal
nsISupports
*
aContextForTopLevelLoad
nsSecurityFlags
aSecurityFlags
)
;
already_AddRefed
<
nsILoadInfo
>
Clone
(
)
const
;
already_AddRefed
<
nsILoadInfo
>
CloneWithNewSecFlags
(
nsSecurityFlags
aSecurityFlags
)
const
;
already_AddRefed
<
nsILoadInfo
>
CloneForNewRequest
(
)
const
;
void
SynthesizeServiceWorkerTainting
(
LoadTainting
aTainting
)
;
void
SetIsPreflight
(
)
;
void
SetUpgradeInsecureRequests
(
)
;
private
:
LoadInfo
(
nsIPrincipal
*
aLoadingPrincipal
nsIPrincipal
*
aTriggeringPrincipal
nsIPrincipal
*
aPrincipalToInherit
nsIPrincipal
*
aSandboxedLoadingPrincipal
nsIURI
*
aResultPrincipalURI
nsSecurityFlags
aSecurityFlags
nsContentPolicyType
aContentPolicyType
LoadTainting
aTainting
bool
aUpgradeInsecureRequests
bool
aVerifySignedContent
bool
aEnforceSRI
bool
aForceInheritPrincipalDropped
uint64_t
aInnerWindowID
uint64_t
aOuterWindowID
uint64_t
aParentOuterWindowID
uint64_t
aTopOuterWindowID
uint64_t
aFrameOuterWindowID
bool
aEnforceSecurity
bool
aInitialSecurityCheckDone
bool
aIsThirdPartyRequest
const
OriginAttributes
&
aOriginAttributes
RedirectHistoryArray
&
aRedirectChainIncludingInternalRedirects
RedirectHistoryArray
&
aRedirectChain
const
nsTArray
<
nsCString
>
&
aUnsafeHeaders
bool
aForcePreflight
bool
aIsPreflight
bool
aForceHSTSPriming
bool
aMixedContentWouldBlock
bool
aIsHSTSPriming
bool
aIsHSTSPrimingUpgrade
)
;
LoadInfo
(
const
LoadInfo
&
rhs
)
;
NS_IMETHOD
GetRedirects
(
JSContext
*
aCx
JS
:
:
MutableHandle
<
JS
:
:
Value
>
aRedirects
const
RedirectHistoryArray
&
aArra
)
;
friend
nsresult
mozilla
:
:
ipc
:
:
LoadInfoArgsToLoadInfo
(
const
mozilla
:
:
net
:
:
OptionalLoadInfoArgs
&
aLoadInfoArgs
nsILoadInfo
*
*
outLoadInfo
)
;
~
LoadInfo
(
)
;
void
ComputeIsThirdPartyContext
(
nsPIDOMWindowOuter
*
aOuterWindow
)
;
void
SetIncludeCookiesSecFlag
(
)
;
friend
class
mozilla
:
:
dom
:
:
XMLHttpRequestMainThread
;
nsCOMPtr
<
nsIPrincipal
>
mLoadingPrincipal
;
nsCOMPtr
<
nsIPrincipal
>
mTriggeringPrincipal
;
nsCOMPtr
<
nsIPrincipal
>
mPrincipalToInherit
;
nsCOMPtr
<
nsIPrincipal
>
mSandboxedLoadingPrincipal
;
nsCOMPtr
<
nsIURI
>
mResultPrincipalURI
;
nsWeakPtr
mLoadingContext
;
nsWeakPtr
mContextForTopLevelLoad
;
nsSecurityFlags
mSecurityFlags
;
nsContentPolicyType
mInternalContentPolicyType
;
LoadTainting
mTainting
;
bool
mUpgradeInsecureRequests
;
bool
mVerifySignedContent
;
bool
mEnforceSRI
;
bool
mForceInheritPrincipalDropped
;
uint64_t
mInnerWindowID
;
uint64_t
mOuterWindowID
;
uint64_t
mParentOuterWindowID
;
uint64_t
mTopOuterWindowID
;
uint64_t
mFrameOuterWindowID
;
bool
mEnforceSecurity
;
bool
mInitialSecurityCheckDone
;
bool
mIsThirdPartyContext
;
OriginAttributes
mOriginAttributes
;
RedirectHistoryArray
mRedirectChainIncludingInternalRedirects
;
RedirectHistoryArray
mRedirectChain
;
nsTArray
<
nsCString
>
mCorsUnsafeHeaders
;
bool
mForcePreflight
;
bool
mIsPreflight
;
bool
mForceHSTSPriming
:
1
;
bool
mMixedContentWouldBlock
:
1
;
bool
mIsHSTSPriming
:
1
;
bool
mIsHSTSPrimingUpgrade
:
1
;
}
;
}
}
#
endif
